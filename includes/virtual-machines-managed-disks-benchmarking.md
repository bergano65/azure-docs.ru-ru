---
title: включение файла
description: включение файла
services: virtual-machines
author: roygara
ms.service: virtual-machines
ms.topic: include
ms.date: 01/11/2019
ms.author: rogarana
ms.custom: include file
ms.openlocfilehash: 9c59b98fb615266c193f997c01c83922c18d4408
ms.sourcegitcommit: 24906eb0a6621dfa470cb052a800c4d4fae02787
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/27/2019
ms.locfileid: "56890965"
---
*Подготовка кэша*  
Диск с кэшированием узла ReadOnly выполняет больше операций ввода-вывода в секунду, чем значение ограничения диска. Чтобы добиться максимальной производительности при чтении для кэша узла, сначала необходимо подготовить кэш диска. Это гарантирует, что операции ввода-вывода при чтении, которые инструмент тестирования производительности выполнит в томе CacheReads, на самом деле попадут в кэш, а не прямо на диск. Попадания в кэш увеличат количество операций ввода-вывода на единственном диске, на котором включен кэш.

> [!IMPORTANT]
>  После каждой перезагрузки виртуальной машины кэш необходимо подготавливать до тестирования производительности.

## <a name="tools"></a>Средства

### <a name="iometer"></a>Iometer

[Скачайте инструмент Iometer](http://sourceforge.net/projects/iometer/files/iometer-stable/2006-07-27/iometer-2006.07.27.win32.i386-setup.exe/download) на виртуальную машину.

#### <a name="test-file"></a>Тестовый файл

Инструмент Iometer использует тестовый файл, который хранится в томе, где выполняется тестирование производительности. Чтение и запись осуществляется в этот тестовый файл, что позволяет измерить количество операций ввода-вывода в секунду и пропускную способность диска. Если этот файл не указан, Iometer создаст его. Создайте тестовый файл iobw.tst размером 200 ГБ в томах CacheReads и NoCacheWrites.

#### <a name="access-specifications"></a>Спецификации доступа

Спецификации, объем ввода-вывода запроса, процент операций чтения и записи, а также процент случайных и последовательных операций можно настроить на вкладке "Access Specifications" (Спецификации доступа) в Iometer. Создайте спецификацию доступа для каждого из описанных ниже сценариев. Создайте спецификации доступа, задайте соответствующее имена, такие как RandomWrites\_8K и RandomReads\_8K, и нажмите кнопку "Сохранить". Выберите соответствующую спецификацию при выполнении сценария тестирования.

Ниже приведен пример спецификаций доступа для сценария с максимальным количеством операций ввода-вывода в секунду при записи.  
    ![Пример спецификаций доступа с максимальным количеством операций ввода-вывода в секунду при записи.](../articles/virtual-machines/linux/media/premium-storage-performance/image8.png)

#### <a name="maximum-iops-test-specifications"></a>Спецификации тестирования при максимальном количестве операций ввода-вывода в секунду

 Чтобы продемонстрировать максимальное значение операций ввода-вывода в секунду, используйте запрос меньшего размера. Используйте запрос размером 8 КБ и создайте спецификации для случайных операций записи и чтения.

| Спецификация доступа | Размер запроса | Случайные, % | Чтение, % |
| --- | --- | --- | --- |
| RandomWrites\_8K |8 КБ |100 |0 |
| RandomReads\_8K |8 КБ |100 |100 |

#### <a name="maximum-throughput-test-specifications"></a>Спецификации тестирования максимальной пропускной способности

 Чтобы продемонстрировать максимальную пропускную способность, используйте запрос большего размера. Используйте запрос размером 64 КБ и создайте спецификации для случайных операций записи и чтения.

| Спецификация доступа | Размер запроса | Случайные, % | Чтение, % |
| --- | --- | --- | --- |
| RandomWrites\_64K |64 000 |100 |0 |
| RandomReads\_64K |64 000 |100 |100 |

#### <a name="run-the-iometer-test"></a>Выполнение теста Iometer

 Выполните следующие шаги, чтобы подготовить кэш.

1. Создайте две спецификации доступа со значениями, указанными ниже.

   | ИМЯ | Размер запроса | Случайные, % | Чтение, % |
   | --- | --- | --- | --- |
   | RandomWrites\_1MB |1 МБ |100 |0 |
   | RandomReads\_1MB |1 МБ |100 |100 |
1. Запустите тест Iometer, чтобы инициализировать диск с кэшем со следующими параметрами. Используйте три рабочих потока для целевого тома и задайте значение «128» для длины очереди. На вкладке "Настройка теста" установите значение 2 часа для параметра "Время выполнения".

   | Сценарий | Целевой том | ИМЯ | Duration |
   | --- | --- | --- | --- |
   | Инициализация диска с кэшем |CacheReads |RandomWrites\_1MB |2 часа |
1. Запустите тест Iometer, чтобы подготовить кэш на диске со следующими параметрами. Используйте три рабочих потока для целевого тома и задайте значение «128» для длины очереди. На вкладке "Настройка теста" установите значение 2 часа для параметра "Время выполнения".

   | Сценарий | Целевой том | ИМЯ | Длительность |
   | --- | --- | --- | --- |
   | Подготовка диска с кэшем |CacheReads |RandomReads\_1MB |2 часа |

После подготовки диска с кэшем выполните сценарии тестирования, перечисленные ниже. Чтобы выполнить тест Iometer, используйте по крайней мере три рабочих потока для **каждого** целевого тома. Для каждого рабочего потока выберите целевой том, задайте длину очереди, а затем выберите одну из сохраненных спецификаций тестирования, указанных в следующей таблице, чтобы выполнить соответствующий сценарий тестирования. В таблице ниже также приведены ожидаемые результаты для значений количества операций ввода-вывода в секунду и пропускной способности при выполнении этих тестов. Во всех сценариях используется небольшой объем ввода-вывода (8 КБ) и высокое значение длины очереди — 128.

| Сценарий тестирования | Целевой том | ИМЯ | Результат |
| --- | --- | --- | --- |
| Макс. количество операций вода-вывода в секунду при чтении |CacheReads |RandomWrites\_8K |50 000 операций ввода-вывода в секунду  |
| Макс. количество операций вода-вывода в секунду при записи |NoCacheWrites |RandomReads\_8K |64 000 операций ввода-вывода в секунду |
| Макс. количество объединенных операций ввода-вывода в секунду |CacheReads |RandomWrites\_8K |100 000 операций ввода-вывода в секунду |
| NoCacheWrites |RandomReads\_8K | &nbsp; | &nbsp; |
| Макс. скорость чтения, МБ/с |CacheReads |RandomWrites\_64K |524 МБ/с |
| Макс. скорость записи, МБ/с |NoCacheWrites |RandomReads\_64K |524 МБ/с |
| Скорость объединенных операций, МБ/с |CacheReads |RandomWrites\_64K |1000 МБ/с |
| NoCacheWrites |RandomReads\_64K | &nbsp; | &nbsp; |

Ниже приведены снимки экрана Iometer с результатами теста для сценариев, где используются объединенные операций ввода-вывода в секунду и пропускная способность.

#### <a name="combined-reads-and-writes-maximum-iops"></a>Максимальное количество операций ввода-вывода в секунду при объединенных операциях чтения и записи

![Максимальное количество операций ввода-вывода в секунду при объединенных операциях чтения и записи](../articles/virtual-machines/linux/media/premium-storage-performance/image9.png)

#### <a name="combined-reads-and-writes-maximum-throughput"></a>Максимальная пропускная способность при объединенных операциях чтения и записи

![Максимальная пропускная способность при объединенных операциях чтения и записи](../articles/virtual-machines/linux/media/premium-storage-performance/image10.png)

### <a name="fio"></a>FIO

FIO — это популярный инструмент для тестирования производительности хранилища виртуальных машин под управлением Linux. Благодаря своей гибкости он позволяет выбрать различные объемы ввода-вывода, а также порядок выполнения операций чтения и записи — последовательный или случайный. Он порождает рабочие потоки или процессы для выполнения указанных операций ввода-вывода. Можно указать тип операций ввода-вывода, которые должен выполнять каждый рабочий поток, используя файлы заданий. В примерах ниже продемонстрирован один файл задания для каждого сценария. Можно менять спецификации в этих файлах заданий, чтобы тестировать производительность при различных рабочих нагрузках хранилища класса "Премиум". В примерах используется виртуальная машина серии DS14 класса «Стандартный» под управлением **Ubuntu**. Используйте одинаковую настройку описано в начале раздела измерение производительности и "горячего" резервирования кэша перед выполнением тестов тестирования производительности.

Прежде чем начать, [скачайте FIO](https://github.com/axboe/fio) и установите его на виртуальной машине.

В ОС Ubuntu выполните следующую команду:

```
apt-get install fio
```

Используется четыре рабочих потока для выполнения операций записи и еще четыре для операций чтения на дисках. Рабочие роли записи управляют трафиком на томе nocache, который содержит 10 дисков кэша в режиме None. Рабочие роли чтения управляют трафиком на томе readcache, который содержит 1 диск кэша в режиме ReadOnly.

#### <a name="maximum-write-iops"></a>Максимальное количество операций ввода-вывода в секунду при записи

 Чтобы добиться максимального количества операций ввода-вывода в секунду при записи, создайте файл задания со следующими спецификациями. Назовите файл fiowrite.ini.

```ini
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=8k

[writer1]
rw=randwrite
directory=/mnt/nocache
[writer2]
rw=randwrite
directory=/mnt/nocache
[writer3]
rw=randwrite
directory=/mnt/nocache
[writer4]
rw=randwrite
directory=/mnt/nocache
```

Обратите внимание на следующие ключевые аспекты, которые согласованы с рекомендациями по разработке, описанными в предыдущих разделах. Эти спецификации необходимы для выполнения максимального количества операций ввода-вывода в секунду:  

* высокое значение длины очереди: 256;  
* Небольшой блок, размером 8 КБ.  
* несколько потоков, выполняющих случайные операции записи.

Выполните следующую команду, чтобы запустить тест FIO на 30 секунд:  

```
sudo fio --runtime 30 fiowrite.ini
```

Во время тестирования вы можете узнать количество операций ввода-вывода в секунду при записи, предоставляемое виртуальной машине и дискам категории "Премиум". Как показано в примере ниже, максимальное количество операций ввода-вывода в секунду при записи, выполняемых виртуальной машиной DS14, — 50 000.  
    ![Количество операций ввода-вывода в секунду, предоставляемое виртуальной машине и дискам категории "Премиум"](../articles/virtual-machines/linux/media/premium-storage-performance/image11.png)

#### <a name="maximum-read-iops"></a>Максимальное количество операций ввода-вывода при чтении

 Чтобы добиться максимального значения операций ввода-вывода при чтении, создайте файл задания со следующими спецификациями. Назовите файл fioread.ini.

```ini
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=8k

[reader1]
rw=randread
directory=/mnt/readcache
[reader2]
rw=randread
directory=/mnt/readcache
[reader3]
rw=randread
directory=/mnt/readcache
[reader4]
rw=randread
directory=/mnt/readcache
```

Обратите внимание на следующие ключевые аспекты, которые согласованы с рекомендациями по разработке, описанными в предыдущих разделах. Эти спецификации необходимы для выполнения максимального количества операций ввода-вывода в секунду:

* высокое значение длины очереди: 256;  
* Небольшой блок, размером 8 КБ.  
* несколько потоков, выполняющих случайные операции записи.

Выполните следующую команду, чтобы запустить тест FIO на 30 секунд:

```
sudo fio --runtime 30 fioread.ini
```

Во время тестирования вы можете узнать количество операций ввода-вывода в секунду при чтении, предоставляемое виртуальной машине и дискам категории "Премиум". Как показано в примере ниже, виртуальная машина DS14 выполняет более 64 000 операций ввода-вывода в секунду при чтении. Это количество представляет собой сочетание производительности диска и кэша.  
    ![](../articles/virtual-machines/linux/media/premium-storage-performance/image12.png)

#### <a name="maximum-read-and-write-iops"></a>Максимальное количество операций ввода-вывода в секунду при чтении и записи

 Чтобы добиться максимального количества операций ввода-вывода в секунду при объединенных операциях чтения и записи, создайте файл задания со следующими спецификациями. Назовите файл fioreadwrite.ini.

```ini
[global]
size=30g
direct=1
iodepth=128
ioengine=libaio
bs=4k

[reader1]
rw=randread
directory=/mnt/readcache
[reader2]
rw=randread
directory=/mnt/readcache
[reader3]
rw=randread
directory=/mnt/readcache
[reader4]
rw=randread
directory=/mnt/readcache

[writer1]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer2]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer3]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer4]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
```

Обратите внимание на следующие ключевые аспекты, которые согласованы с рекомендациями по разработке, описанными в предыдущих разделах. Эти спецификации необходимы для выполнения максимального количества операций ввода-вывода в секунду:

* высокое значение длины очереди: 128;  
* Небольшой блок, размером 4 КБ.  
* несколько потоков, выполняющих случайные операции чтения и записи.

Выполните следующую команду, чтобы запустить тест FIO на 30 секунд:

```
sudo fio --runtime 30 fioreadwrite.ini
```

Во время тестирования вы можете узнать количество операций ввода-вывода в секунду при объединенных операциях чтения и записи, предоставляемое виртуальной машине и дискам категории "Премиум". Как показано в примере ниже, виртуальная машина DS14 выполняет более 100 000 операций ввода-вывода в секунду при объединенных операциях чтения и записи. Это количество представляет собой сочетание производительности диска и кэша.  
    ![Объединенное количество операций ввода-вывода в секунду при чтении и записи](../articles/virtual-machines/linux/media/premium-storage-performance/image13.png)

#### <a name="maximum-combined-throughput"></a>Максимальное значение объединенной пропускной способности

 Чтобы добиться максимальной пропускной способности объединенных операций чтения и записи, используйте больший размер блока и длинную очередь с несколькими потоками, выполняющими операции чтения и записи. Вы можете использовать блоки размером 64 КБ и длину очереди 128.
