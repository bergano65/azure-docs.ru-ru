---
author: cynthn
ms.author: cynthn
ms.date: 08/03/2020
ms.topic: include
ms.service: virtual-machines-linux
manager: daberry
ms.openlocfilehash: a5a201a9f993db2be00645d8d60a11c5be9cdbe0
ms.sourcegitcommit: c94a177b11a850ab30f406edb233de6923ca742a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/01/2020
ms.locfileid: "89304091"
---
Стандартизированные образы виртуальных машин позволяют организациям выполнять миграцию в облако и обеспечивать согласованность в развертываниях. Образы обычно включают стандартные параметры безопасности и конфигурации, а также необходимое программное обеспечение. Для настройки собственного конвейера создания образов требуется время, инфраструктура и подготовка, но с помощью Конструктора образов виртуальных машин Azure вы просто предоставляете простую конфигурацию, описывающую образ, отправляете его в службу, после чего образ конструируется и распространяется.
 
Конструктор образов виртуальных машин Azure позволяет начать работу с образом Azure Marketplace на основе Windows или Linux, существующими пользовательскими образами или ISO Red Hat Enterprise Linux (RHEL) ISO и начать добавлять собственные настройки. Поскольку Конструктор образов создан на основе [HashiCorp Pack](https://packer.io/), можно также импортировать существующие скрипты подготовки оболочки упаковки. Кроме того, вы можете указать, где должны размещаться образы: в [Общей коллекции образов Azure](https://docs.microsoft.com/azure/virtual-machines/windows/shared-image-galleries), как управляемые образы или виртуальные жесткие диски.

> [!IMPORTANT]
> Конструктор образов Azure сейчас находится на этапе общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="preview-features"></a>Функции предварительной версии

Для предварительной версии поддерживаются следующие функции.

- Создание эталонных базовых образов, включающих минимальные конфигурации безопасности и корпоративные конфигурации, и позволяющих подразделениям модифицировать эти конфигурации в соответствии с их потребностями.
- Исправление существующих образов. Конструктор образов позволит постоянно обновлять существующие пользовательские образы.
- Подключите Конструктор образов к существующим виртуальным сетям, чтобы можно было подключаться к существующим серверам конфигурации (DSC, Chef, Puppet и т. д.), общим файловым ресурсам или любым другим маршрутизируемым серверам и службам.
- Интеграция с Общей коллекцией образов Azure позволяет глобально распространять и масштабировать образы, а также предоставляет систему управления образами.
- Интеграция с существующими конвейерами сборки образов. Просто вызовите Конструктор образов из конвейера или используйте простую задачу Azure DevOps для предварительной версии Конструктора образов.
- Перенос существующего конвейера настройки образов в Azure. Используйте уже существующие сценарии, команды и процессы для настройки образов.
- Создание образов в формате VHD для поддержки Azure Stack.
 

## <a name="regions"></a>Регионы
Служба "Конструктор образов Azure" будет доступна как предварительная версия в следующих регионах. Изображения можно распространять за пределами этих регионов.
- Восточная часть США
- восточная часть США 2
- центрально-западная часть США
- западная часть США
- западная часть США 2
- Северная Европа
- Западная Европа

## <a name="os-support"></a>Поддержка ОС
AIB будет поддерживать базовые образы ОС Azure Marketplace:
- Ubuntu 18.04
- Ubuntu 16.04
- RHEL 7.6, 7.7
- CentOS 7.6, 7.7
- SLES 12 SP4
- SLES 15, SLES 15 SP1
- Windows 10 RS5 Корпоративная/Корпоративная с поддержкой нескольких сеансов/Профессиональная
- Windows 2016
- Windows 2019

Поддержка ISO RHEL прекращена.

## <a name="how-it-works"></a>Принцип работы


![Концептуальный рисунок Конструктора образов Azure](./media/virtual-machines-image-builder-overview/image-builder.png)

Конструктор образов Azure — это полностью управляемая служба Azure, доступная через поставщика ресурсов Azure. Процесс Конструктора образов Azure состоит из трех основных частей: источника, настройки и распространения, которые представлены в шаблоне. На схеме ниже показаны компоненты, а также некоторые их свойства. 
 


**Процесс Конструктора образов** 

![Концептуальный рисунок процесса Конструктора образов Azure](./media/virtual-machines-image-builder-overview/image-builder-process.png)

1. Создайте шаблон образа в виде JSON-файла. Этот JSON-файл содержит сведения об источнике образа, его настройках и распространении. Несколько примеров таких файлов есть в [репозитории GitHub Конструктора образов Azure](https://github.com/danielsollondon/azvmimagebuilder/tree/master/quickquickstarts).
1. Отправьте его в службу, при этом будет создан артефакт шаблона образа в указанной группе ресурсов. В фоновом режиме Конструктор образов загрузит исходный образ или ISO-файл и скрипты по мере необходимости. Они хранятся в отдельной группе ресурсов, которая автоматически создается в подписке в формате: IT_ \<DestinationResourceGroup> _ \<TemplateName> . 
1. После создания шаблона образа можно создать образ. В построителе фоновых изображений использует шаблон и исходные файлы для создания виртуальной машины (размер по умолчанию: Standard_D1_v2), сети, общедоступного IP-адреса, NSG и хранилища в \<DestinationResourceGroup> \<TemplateName> группе ресурсов IT_ _.
1. В ходе создания образа построитель образов распределяет изображение в соответствии с шаблоном, а затем удаляет дополнительные ресурсы в \<DestinationResourceGroup> \<TemplateName> группе ресурсов IT_ _, которая была создана для процесса.


## <a name="permissions"></a>Разрешения
При регистрации для (AIB) это предоставляет службе AIB разрешение на создание, удаление и администрирование промежуточной группы ресурсов (IT_ *) и имеет права на добавление в нее ресурсов, необходимых для сборки образа. Это делается с помощью имени субъекта-службы AIB, которое предоставляется в вашей подписке во время успешной регистрации.

Чтобы разрешить Конструктору образов виртуальных машин Azure распространять образы в управляемые образы или в Общую коллекцию образов, необходимо создать назначенное пользователем удостоверение Azure с разрешениями на чтение и запись образов. При доступе к службе хранилища Azure для чтения закрытых контейнеров потребуются разрешения.

Сначала необходимо выполнить действия, описанные в документации по [созданию назначаемого пользователем управляемого удостоверения Azure](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-cli).

После получения удостоверения, необходимого для предоставления разрешений, можно использовать определение пользовательской роли Azure, а затем указать назначенному пользователем управляемому удостоверению использовать определение пользовательской роли.

Разрешения описаны более подробно [здесь](https://github.com/danielsollondon/azvmimagebuilder/blob/master/aibPermissions.md#azure-vm-image-builder-permissions-explained-and-requirements), а в примерах показано, как это реализовано.

> [!Note]
> Ранее в AIB пользователи использовали имя субъекта-службы AIB и предоставляли этому имени участника-службы разрешения для групп ресурсов образов. Мы отходим от этой модели, чтобы расширить возможности в будущем. С 26 мая 2020 года Конструктор образов не будет принимать шаблоны, не имеющие назначенного пользователем удостоверения. Существующие шаблоны потребуется повторно отправить в службу с помощью [удостоверений пользователя](https://docs.microsoft.com/azure/virtual-machines/linux/image-builder-json?toc=%2Fazure%2Fvirtual-machines%2Fwindows%2Ftoc.json&bc=%2Fazure%2Fvirtual-machines%2Fwindows%2Fbreadcrumb%2Ftoc.json#identity). В примерах здесь уже показано, как можно создать пользовательское удостоверение и добавить его в шаблон. Дополнительные сведения см. в этой [документации](https://github.com/danielsollondon/azvmimagebuilder#service-updates-and-latest-release-information) по данному изменению и сведениях о выпусках.

## <a name="costs"></a>Затраты
При создании, сборке и хранении образов с помощью Конструктора образов Azure потребуются некоторые затраты ресурсов на вычисления, работу сети и хранение. Эти затраты схожи с затратами, возникающими при создании пользовательских образов вручную. Плата за ресурсы будет взиматься по тарифам Azure. 

В процессе создания образа файлы загружаются и сохраняются в группе ресурсов `IT_<DestinationResourceGroup>_<TemplateName>`, что приводит к небольшим затратам на хранение. Если они больше не нужны, удалите **Шаблон образа** после сборки образа.
 
Конструктор образов создает виртуальную машину, используя размер виртуальной машины D1v2, а также хранилище и сетевые подключения, необходимые для виртуальной машины. Эти ресурсы будут существовать на протяжении процесса сборки и удалены после того, как Конструктор образов завершит создание образа. 
 
Конструктор образов Azure распространит образ в выбранные регионы, что может повлечь оплату за исходящий сетевой трафик.

## <a name="hyper-v-generation"></a>Поколение Hyper-V
В настоящее время построитель образов поддерживает создание образов Hyper-V (GEN1) 1 в галерее образов (SIG) или управляемом образе Azure. Если вы хотите создать образы Gen2, необходимо использовать исходный образ Gen2 и распространить его на виртуальный жесткий диск. После этого потребуется создать управляемый образ из виртуального жесткого диска и вставить его в подпись в качестве образа Gen2.
 
## <a name="next-steps"></a>Дальнейшие действия 
 
Чтобы испытать Конструктор образов Azure, ознакомьтесь со статьями о сборке образов [Linux](../articles/virtual-machines/linux/image-builder.md) или [Windows](../articles/virtual-machines/windows/image-builder.md).
 
