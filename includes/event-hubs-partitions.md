---
title: включить файл
description: включить файл
services: event-hubs
author: spelluru
ms.service: event-hubs
ms.topic: include
ms.date: 01/05/2021
ms.author: spelluru
ms.custom: include file
ms.openlocfilehash: 780da47e6f071d854a16ca1d1c5cd02dbdd6bef0
ms.sourcegitcommit: 19ffdad48bc4caca8f93c3b067d1cf29234fef47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97955656"
---
Концентратор событий упорядочивает последовательности событий в одну или несколько секций. По мере поступления новых событий они добавляются в конец этой последовательности. Секцию можно рассматривать как «журнал фиксации».

Секции содержат данные событий: тело события, контейнер определяемых пользователем свойств для описания события, а также метаданные, такие как смещение в секции, номер события в последовательности потока и метка времени, когда событие было принято, на стороне службы.

![Схема, на которой показана последовательность событий (от старых до более новых).](./media/event-hubs-partitions/partition.png)

Служба "Центры событий" предназначена для обработки больших объемов событий, а секционирование помогает при этом двумя способами.

Во-первых, хотя "Центры событий" — это служба PaaS, в ее основе лежит физическая реальность, и для поддержания журнала, сохраняющего порядок событий, необходимо, чтобы эти события хранились вместе в базовом хранилище и его репликах, что приводит к достижению верхнего порога пропускной способности для такого журнала. Секционирование позволяет использовать для одного концентратора событий несколько параллельных журналов и, следовательно, умножить доступную пропускную способность необработанных операций ввода-вывода.

Во-вторых, ваши приложения должны справляться с обработкой объема событий, отправляемых в концентратор событий. Это может оказаться сложной задачей, для которой требуется значительная масштабируемая емкость параллельной обработки. Обоснование для использования секций совпадает с приведенным выше. Для отдельного процесса емкость обработки событий ограничена, поэтому требуется несколько процессов, а секции — это то, как ваше решение обеспечивает эти процессы и в то же время гарантирует, что у каждого события есть четко определенный владелец обработки. 

Центры событий сохраняют события в течение указанного времени хранения, которое применяется для всех секций. События автоматически удаляются по окончании периода хранения. Если указать период хранения в один день, событие станет недоступным ровно через 24 часа после его приема. События нельзя удалять явно. 

Допустимое время хранения — до 7 дней для Центров событий ценовой категории "Стандартный" и до 90 дней для Центров событий ценовой категории "Выделенный". Если по истечении допустимого периода хранения события нужно архивировать, их можно будет [автоматически сохранить в службе хранилища Azure или в Azure Data Lake, включив функцию "Сбор" в Центрах событий](../articles/event-hubs/event-hubs-capture-overview.md), а если вам нужно искать или анализировать такие глубокие архивы, вы можете [легко импортировать их в Azure Synapse](../articles/event-hubs/store-captured-data-data-warehouse.md) или в другие хранилища либо на другие платформы аналитики подобного рода. 

Причина, по которой в Центрах событий устанавливается ограничение на хранение данных по времени, заключается в том, чтобы предотвратить попадание больших объемов исторических данных клиентов в глубокое хранилище, которое индексируется только по метке времени и допускает только последовательный доступ. Философия такой архитектуры заключается в том, что исторические данные нуждаются в более подробном индексировании и более прямом доступе, чем обеспечивает интерфейс событий в реальном времени, который предоставляют Центры событий или Kafka. Обработчики потока событий плохо подходят на роль озер данных или долгосрочных архивов, используемых в качестве источников событий. 

Так как секции независимы и содержат собственные последовательности данных, они часто расширяются с разной скоростью. В Центрах событий это не является проблемой, требующей вмешательства администратора (как например, в Apache Kafka), но неравномерное распределение приведет к неравномерной нагрузке на обработчики событий нижестоящего уровня.

![Центры событий](./media/event-hubs-partitions/multiple-partitions.png)

Количество секций определяется во время создания. В Центрах событий ценовой категории "Стандартный" рабочий диапазон — от 1 до 32. В Центрах событий ценовой категории "Выделенный" число секций на единицу емкости может доходить до 2000. 

Рекомендуем выбрать как минимум столько секций, сколько может потребоваться для поддержания постоянного количества [единиц пропускной способности](../articles/event-hubs/event-hubs-faq.md#what-are-event-hubs-throughput-units) во время пиковой нагрузки вашего приложения для этого концентратора событий. При расчетах следует иметь в виду, что пропускная способность одной секции соответствует 1 единице пропускной способности (1 МБ входящих данных, 2 МБ исходящих данных). Вы можете масштабировать единицы пропускной способности в пространстве имен или единицы емкости в кластере независимо от числа секций. Стоимость концентратора событий с 32 секциями и концентратора событий с одной секцией будет одинаковой, если для пространства имен задана емкость в 1 единицу пропускной способности. 

Приложения сопоставляют события с секциями одним из трех следующих способов:

- указывая ключ секции, который постоянно сопоставляется (с помощью хэш-функции) с одной из доступных секций; 
- не указывая ключ секции, что позволяет брокеру случайным образом выбирать секцию для того или иного события;
- явно отправляя события в определенную секцию.

Указание ключа секции позволяет хранить связанные события в одной и той же секции и в точно таком же порядке, в котором они были отправлены. Ключ секции — это строка, которая является производной от контекста приложения и определяет взаимосвязь событий.

Последовательность событий, определяемых ключом секции, называется *потоком*. Секция — это мультиплексное хранилище журналов для множества таких потоков. 

Число секций концентратора событий в [выделенном кластере службы "Центры событий"](../articles/event-hubs/event-hubs-dedicated-overview.md) можно [увеличить](../articles/event-hubs/dynamically-add-partitions.md) после создания концентратора событий, но распределение потоков между секциями изменится, если изменится сопоставление ключей секций c секциями. Поэтому, если для вашего приложения важен относительный порядок событий, старайтесь избегать таких изменений.

Установить для количества секций максимально допустимое значение может быть заманчиво, но всегда помните, что ваши потоки событий должны быть структурированы так, чтобы вы действительно могли воспользоваться преимуществами нескольких секций. Если требуется абсолютное сохранение порядка по всем событиям или только небольшому количеству подпотоков, вы не сможете воспользоваться преимуществами нескольких секций. Кроме того, наличие большого количества секций усложняет обработку. 

Хотя события можно отправлять в секции напрямую, делать это не рекомендуется. Вместо этого можно использовать конструкции более высокого уровня, описанные в разделе [Издатели событий](../articles/event-hubs/event-hubs-features.md#event-publishers). 

Дополнительные сведения о секциях и компромиссе между доступностью и надежностью см. в статье [Руководство по программированию Центров событий](../articles/event-hubs/event-hubs-programming-guide.md#partition-key) и [Доступность и согласованность в Центрах событий](../articles/event-hubs/event-hubs-availability-and-consistency.md).
