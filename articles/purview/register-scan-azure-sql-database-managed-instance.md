---
title: Регистрация и сканирование Управляемого экземпляра Базы данных SQL Azure
description: В этом учебнике описано, как проверить Управляемый экземпляр Базы данных SQL Azure
author: hophanms
ms.author: hophan
ms.service: purview
ms.subservice: purview-data-catalog
ms.topic: tutorial
ms.date: 12/01/2020
ms.openlocfilehash: 6eb17537fd64b192f64c36b38bab57e11d751328
ms.sourcegitcommit: cc13f3fc9b8d309986409276b48ffb77953f4458
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2020
ms.locfileid: "97400783"
---
# <a name="register-and-scan-an-azure-sql-database-managed-instance"></a>Регистрация и сканирование Управляемого экземпляра Базы данных SQL Azure

В этой статье описано, как зарегистрировать Управляемый экземпляр Базы данных SQL Azure в качестве источника данных в Purview и настроить сканирование.

## <a name="supported-capabilities"></a>Поддерживаемые возможности

Источник данных Управляемого экземпляра Базы данных SQL Azure поддерживает следующие функциональные возможности.

- **Полное и добавочное сканирование** для сохранения метаданных и классификации в Управляемом экземпляре Базы данных SQL Azure.

- **Отслеживание происхождения данных** по нескольким ресурсам данных для операций копирования и потоков данных в Фабрике данных Azure.

### <a name="known-limitations"></a>Известные ограничения

Azure Purview не поддерживает сканирование [представлений](https://docs.microsoft.com/sql/relational-databases/views/views?view=sql-server-ver15) в Управляемом экземпляре Базы данных SQL Azure.

## <a name="prerequisites"></a>Предварительные требования

- Создайте новую учетную запись Azure Purview, если у вас ее еще нет.

- [Configure public endpoint in Azure SQL Managed Instance](https://docs.microsoft.com/azure/azure-sql/managed-instance/public-endpoint-configure) (Настройка общедоступной конечной точки в управляемом экземпляре SQL Azure)
    > [!Note]
    > Ваша организация должна иметь возможность разрешить общедоступную конечную точку, так как **частная конечная точка еще не поддерживается** Purview. Если вы используете частную конечную точку, проверка не будет выполнена.

### <a name="setting-up-authentication-for-a-scan"></a>Настройка проверки подлинности для сканирования

Проверка подлинности для проверки Управляемого экземпляра Базы данных SQL Azure. Если вам нужно создать новую проверку подлинности, [авторизуйте доступ к базе данных в Управляемом экземпляре Базы данных SQL](https://docs.microsoft.com/azure/azure-sql/database/logins-create-manage). Сейчас служба Purview поддерживает три метода проверки подлинности:

- Проверка подлинности SQL
- Субъект-служба
- Управляемое удостоверение

#### <a name="sql-authentication"></a>Проверка подлинности SQL

> [!Note]
> Создавать имена входа могут только имена входа участника уровня сервера (созданного процессом подготовки) или члены роли базы данных `loginmanager` в базе данных master. Процесс предоставления разрешений займет примерно **15 минут**, и после этого Purview будет иметь нужные разрешения для сканирования ресурсов.

Если у вас еще нет имени входа для Управляемого экземпляра Базы данных SQL Azure, создайте его по инструкциям из раздела документации по команде [CREATE LOGIN](https://docs.microsoft.com/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-current&preserve-view=true#examples-1). Значения **имя пользователя** и **пароль** вам потребуются для последующих шагов.

1. На портале Azure перейдите к хранилищу ключей.
1. Выберите **Параметры > Секреты**.
1. Выберите **Создать или импортировать** и введите **Имя** и **Значение** для *пароля* от Управляемого экземпляра Базы данных SQL Azure.
1. Чтобы завершить процесс, щелкните **Создать**.
1. Если хранилище ключей еще не подключено к службе Purview, вам придется [создать новое подключение к хранилищу ключей](manage-credentials.md#create-azure-key-vaults-connections-in-your-azure-purview-account).
1. Наконец, [создайте новые учетные данные](manage-credentials.md#create-a-new-credential) для сканирования, указав **имя пользователя** и **пароль**.

#### <a name="service-principal-and-managed-identity"></a>Субъект-служба и управляемое удостоверение

Чтобы позволить Purview использовать субъект-службу для проверки Управляемого экземпляра Базы данных SQL Azure, нужно выполнить несколько действий

##### <a name="create-or-use-an-existing-service-principal"></a>Создание нового субъекта-службы или выбор существующего

> [!Note]
> Пропустите этот шаг, если вы используете **управляемое удостоверение**

Чтобы использовать субъект-службу, вам нужно выбрать существующий субъект-службу или создать новый. 

> [!Note]
> Если необходимо создать субъект-службу, выполните следующие действия:
> 1. Перейдите на [портал Azure](https://portal.azure.com).
> 1. В меню слева выберите **Azure Active Directory**.
> 1. Щелкните **Регистрация приложений**.
> 1. Выберите **Регистрация нового приложения**.
> 1. Введите имя **приложения** (имя субъекта-службы).
> 1. Установите флажок **Учетные записи только в этом каталоге организации**.
> 1. Для URI перенаправления выберите тип **Интернет** и введите произвольный URL-адрес, не обязательно существующий и работающий.
> 1. Нажмите кнопку **Зарегистрировать**.

##### <a name="configure-azure-ad-authentication-in-the-database-account"></a>Настройка проверки подлинности Azure AD в учетной записи базы данных

Субъект-служба или управляемое удостоверение должны иметь разрешение на получение метаданных для базы данных, схем и таблиц. Кроме того, требуется возможность запрашивать из таблиц примеры для классификации.
- [Настройка и администрирование проверки подлинности Azure Active Directory с помощью Azure SQL](https://docs.microsoft.com/azure/azure-sql/database/authentication-aad-configure)
- Создайте пользователя Azure AD в Управляемом экземпляре Базы данных SQL Azure, следуя предварительным требованиям и учебнику по [созданию автономных пользователей, сопоставленных с удостоверениями Azure AD.](https://docs.microsoft.com/azure/azure-sql/database/authentication-aad-configure?tabs=azure-powershell#create-contained-users-mapped-to-azure-ad-identities)
- Назначьте этому удостоверению разрешение `db_owner` (**рекомендуется**)

##### <a name="add-service-principal-to-key-vault-and-purviews-credential"></a>Добавление субъекта-службы в хранилище ключей и учетные данные Purview

> [!Note]
> Если вы планируете использовать **управляемое удостоверение**, этот шаг можно пропустить, так как удостоверение Purview по умолчанию уже находится в **Purview-MSI**

Оно потребуется для получения идентификатора приложения и секрета для субъекта-службы:

1. Откройте страницу субъекта-службы на [портале Azure](https://portal.azure.com).
1. Скопируйте значения **Идентификатор приложения (клиент)** из раздела **Обзор** и **Секрет клиента** из раздела **Сертификаты и секреты**.
1. Перейдите в хранилище ключей.
1. Выберите **Параметры > Секреты**.
1. Выберите **+ Создать или импортировать**, а затем введите **Имя** и **Значение**, содержащее **секрет клиента** для вашего субъекта-службы.
1. Чтобы завершить процесс, щелкните **Создать**.
1. Если хранилище ключей еще не подключено к службе Purview, вам придется [создать новое подключение к хранилищу ключей](manage-credentials.md#create-azure-key-vaults-connections-in-your-azure-purview-account).
1. Наконец, [создайте новые учетные данные](manage-credentials.md#create-a-new-credential) для сканирования, указав субъект-службу.

### <a name="firewall-settings"></a>Параметры брандмауэра

Сервер базы данных должен разрешать подключения к Azure. Это нужно Azure Purview для доступа к серверу и его подключения. Вы можете воспользоваться практическим руководством по [подключению из среды Azure](../azure-sql/database/firewall-configure.md#connections-from-inside-azure).

1. Перейдите к учетной записи базы данных.
1. На странице **Обзор** выберите имя сервера.
1. Выберите **Безопасность > Брандмауэры и виртуальные сети**.
1. Выберите значение **Да** для параметра **Разрешить доступ к серверу службам и ресурсам Azure**.

    :::image type="content" source="media/register-scan-azure-sql-database/sql-firewall.png" alt-text="Параметры регистрации источников" border="true":::
    
> [!Note]
> В настоящее время Azure Purview не поддерживает конфигурацию виртуальной сети. Это означает, что вы не сможете использовать параметры брандмауэра на основе IP-адресов.

## <a name="register-an-azure-sql-database-managed-instance-data-source"></a>Регистрация источника данных Управляемого экземпляра Базы данных SQL Azure

1. Перейдите к учетной записи Purview.

1. В области навигации слева выберите **Источники**.

1. Нажмите кнопку **Зарегистрировать**.

1. Выберите **Управляемый экземпляр базы данных SQL Microsoft Azure** и щелкните **Продолжить**.

    :::image type="content" source="media/register-scan-azure-sql-database-managed-instance/set-up-the-sql-data-source.png" alt-text="Настройка источника данных SQL":::

1. Выберите **Ввести вручную**.

1. Укажите **полное доменное имя общедоступной конечной точки** и **номер порта**. Затем щелкните **Готово**, чтобы зарегистрировать источник данных.

    :::image type="content" source="media/register-scan-azure-sql-database-managed-instance/add-azure-sql-database-managed-instance.png" alt-text="Добавление Управляемого экземпляра Базы данных SQL Azure":::

    Пример: `foobar.public.123.database.windows.net,3342`

[!INCLUDE [create and manage scans](includes/manage-scans.md)]

> [!NOTE]
> Удаление сканирования не приводит к удалению ресурсов из других сканирований Управляемого экземпляра Базы данных SQL Azure.

## <a name="next-steps"></a>Дальнейшие действия

- [Обзор каталога данных Azure Purview](how-to-browse-catalog.md)
- [Поиск по каталогу данных Azure Purview](how-to-search-catalog.md)
