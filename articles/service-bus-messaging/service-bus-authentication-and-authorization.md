---
title: Аутентификация и авторизация в служебной шине Azure | Документация Майкрософт
description: Аутентификация приложений в служебной шине с помощью аутентификации на основе подписанного URL-адреса (SAS).
ms.topic: article
ms.date: 06/23/2020
ms.openlocfilehash: a71cef6aad973f3c39ef61a8dbab313ebfca44ef
ms.sourcegitcommit: 59f506857abb1ed3328fda34d37800b55159c91d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/24/2020
ms.locfileid: "92517286"
---
# <a name="service-bus-authentication-and-authorization"></a>Аутентификация и авторизация в служебной шине
Существует два способа проверки подлинности и авторизации доступа к ресурсам служебной шины Azure: Каталог действий Azure (Azure AD) и подписанные URL-адрес (SAS). В этой статье приводятся подробные сведения об использовании этих двух типов механизмов безопасности. 

## <a name="azure-active-directory"></a>Azure Active Directory
Интеграция Azure AD для ресурсов служебной шины обеспечивает контроль доступа на основе ролей Azure (Azure RBAC) для точного управления доступом клиента к ресурсам. Можно использовать Azure RBAC для предоставления разрешений субъекту безопасности, который может быть пользователем, группой или субъектом-службой приложения. Проверка подлинности субъекта безопасности в Azure AD возвращает маркер OAuth 2,0. Токен можно использовать для авторизации запроса на доступ к ресурсу служебной шины (очередь, раздел и т. д.).

Дополнительные сведения о проверке подлинности в Azure AD см. в следующих статьях:

- [Аутентификация на основе управляемых удостоверений](service-bus-managed-service-identity.md)
- [Аутентификация из приложения](authenticate-application.md)

> [!NOTE]
> [REST API служебной шины](/rest/api/servicebus/) поддерживает аутентификацию OAuth в Azure AD.

> [!IMPORTANT]
> Авторизация пользователей или приложений с помощью токена OAuth 2,0, возвращенного Azure AD, обеспечивает более высокую безопасность и простоту использования подписей общего доступа (SAS). В Azure AD нет необходимости хранить маркеры в коде и угрожать потенциальным уязвимостям безопасности. Мы рекомендуем использовать Azure AD с приложениями служебной шины Azure, когда это возможно. 

## <a name="shared-access-signature"></a>Подписанный URL-адрес
[Проверка подлинности SAS](service-bus-sas.md) позволяет предоставлять пользователю доступ к ресурсам служебной шины с определенными правами. Проверка подлинности SAS в служебной шине предусматривает настройку соответствующих прав для криптографического ключа в ресурсе служебной шины. Затем клиенты могут получить доступ к этому ресурсу. Для этого им нужно предоставить маркер SAS, который состоит из универсального кода ресурса (URI) данного ресурса, а также указать срок действия, подписанный с использованием настроенного ключа.

Ключи для SAS можно настроить в пространстве имен служебной шины. Ключ применяется ко всем сущностям обмена сообщениями в пределах этого пространства имен. Также можно настроить ключи для очередей и разделов служебной шины. Кроме того, SAS поддерживается в [ретрансляторе Azure](../azure-relay/relay-authentication-and-authorization.md).

Чтобы использовать SAS, в пространстве имен, очереди или разделе можно настроить объект [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule). Это правило состоит из трех элементов:

* *KeyName* — определяет правило.
* *PrimaryKey* — криптографический ключ, используемый для подписи и проверки маркеров SAS.
* *SecondaryKey* — криптографический ключ, используемый для подписи и проверки маркеров SAS.
* *Rights* — набор прав **Listen** (Прослушивание), **Send** (Отправка) или **Manage** (Управление).

Правила авторизации, настроенные на уровне пространства имен, могут предоставлять доступ ко всем сущностям в пространстве имен для клиентов с маркерами, подписанными с использованием соответствующего ключа. В пространстве имен, очереди или разделе служебной шины можно настроить до 12 таких правил авторизации. По умолчанию правило [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule) со всеми правами настраивается для каждого пространства имен в ходе первоначальной подготовки.

Чтобы получить доступ к сущности, клиенту требуется маркер SAS, созданный с помощью определенного правила [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule). Маркер SAS создается с помощью хэш-функции HMAC-SHA256 строки ресурса, состоящей из URI ресурса, к которому запрашивается доступ, и срока действия с криптографическим ключом, связанным с правилом авторизации.

Поддержка проверки подлинности SAS для служебной шины включена в пакет Azure SDK для .NET 2.0 и более поздних версий. SAS включает в себя поддержку правила [SharedAccessAuthorizationRule](/dotnet/api/microsoft.servicebus.messaging.sharedaccessauthorizationrule). Все интерфейсы API, которые принимают строку подключения в качестве параметра, поддерживают строки подключения SAS.

> [!IMPORTANT]
> Если вы используете Azure Active Directory управления доступом (также известный как служба контроля доступа или ACS) с служебной шиной, обратите внимание, что поддержка этого метода теперь ограничена, и вы должны [перенести приложение для использования SAS](service-bus-migrate-acs-sas.md) или использовать проверку подлинности OAuth 2,0 в Azure AD (рекомендуется). Дополнительные сведения об устаревании ACS см. в [этой записи блога](/archive/blogs/servicebus/upcoming-changes-to-acs-enabled-namespaces).

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о проверке подлинности в Azure AD см. в следующих статьях:

- [Проверка подлинности с помощью управляемых удостоверений](service-bus-managed-service-identity.md)
- [Проверка подлинности из приложения](authenticate-application.md)

Дополнительные сведения о проверке подлинности с помощью SAS см. в следующих статьях:

- [Аутентификация с помощью SAS](service-bus-sas.md)