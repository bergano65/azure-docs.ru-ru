---
title: Последовательность сообщений и метки времени служебной шины Azure | Документация Майкрософт
description: Сохранение последовательности и порядка сообщений служебной шины с помощью меток времени
services: service-bus-messaging
documentationcenter: ''
author: axisc
manager: timlt
editor: spelluru
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/23/2019
ms.author: aschhab
ms.openlocfilehash: 8665d0a1fccecf5521a553a894e2a55e52384ec3
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60402724"
---
# <a name="message-sequencing-and-timestamps"></a>Последовательность сообщений и метки времени

Функции последовательности и меток времени всегда включены на всех сущностях служебной шины и их можно найти через свойства [SequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber) и [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc) полученных или просмотренных сообщений.

В случаях, когда важен абсолютный порядок сообщений и/или когда потребителю нужен доверенный уникальный идентификатор для сообщений, брокер помечает сообщения безинтервальным, увеличивающимся порядковым номером относительно очереди или темы. Для секционированных сущностей порядковый номер выдается в соответствии с секцией.

Значение **SequenceNumber** — это уникальное 64-битное целое число, присваиваемое сообщению, когда оно принимается и сохраняется брокером, и функциям в качестве внутреннего идентификатора. Для секционированных сущностей верхние 16 бит отражают идентификатор раздела. Порядковые номера сбрасываются до нуля после исчерпания диапазона 48/64 бит.

Порядковый номер может быть доверенным в качестве уникального идентификатора, так как он назначается центральным и нейтральным центрами, а не клиентами. Он также представляет истинный порядок прибытия и в качестве критерия порядка более точен по сравнению с временной меткой, так как временные метки могут не иметь достаточно высокого разрешения при слишком большом числе сообщений и могут подвергаться (хотя и минимальному) отклонению от времени при переходах собственности брокера между узлами.

Абсолютный порядок прибытия имеет значение, например в бизнес-сценариях с обслуживанием ограниченного количества предлагаемых товаров в порядке поступления по мере доступности в запасах (например, продажа билетов на концерт).

Метки времени действуют в качестве нейтрального и надежного центра, который точно фиксирует время прибытия сообщения в формате UTC, отображенное в свойстве **EnqueuedTimeUtc**. Это значение полезно, если бизнес-сценарий зависит от крайних сроков, например, если рабочий элемент был отправлен на определенную дату до полуночи, но обработка очень отстает от очереди невыполненных работ.

## <a name="scheduled-messages"></a>Запланированные сообщения

Сообщения можно отправлять в очередь или раздел для отложенной обработки (например, чтобы запланировать задание для обработки системой в определенное время). Таким образом можно обнаружить надежный распределенный планировщик на основе времени.

Запланированные сообщения не появляются в очереди до определенного времени. Запланированные сообщения можно отменить до истечения этого срока. После отмены сообщение удаляется.

Сообщения можно запланировать путем задания свойства [ScheduledEnqueueTimeUtc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc) при отправке сообщения через обычный путь отправки или явно с помощью программного интерфейса [ScheduleMessageAsync](/dotnet/api/microsoft.azure.servicebus.queueclient.schedulemessageasync#Microsoft_Azure_ServiceBus_QueueClient_ScheduleMessageAsync_Microsoft_Azure_ServiceBus_Message_System_DateTimeOffset_). При втором способе значение запланированного сообщения **SequenceNumber**, которое позже можно использовать для отмены запланированного сообщения, немедленно возвращается. Запланированные сообщения и их номера последовательности можно также обнаружить при [просмотре сообщений](message-browsing.md).

Значение **SequenceNumber** для запланированного сообщения допустимо, только если сообщение находится в этом состоянии. После перехода сообщения в активное состояние оно добавляется в очередь (как в случае добавления в очередь в текущий момент), включая присваивание нового значения **SequenceNumber**.

Так как эта функция привязана к отдельным сообщениям, а они могут быть поставлены в очередь только один раз, служебная шина не поддерживает повторяющиеся расписания для сообщений.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об обмене сообщениями через служебную шину см. в следующих статьях:

* [Очереди, разделы и подписки служебной шины](service-bus-queues-topics-subscriptions.md)
* [Начало работы с очередями служебной шины](service-bus-dotnet-get-started-with-queues.md)
* [Как использовать разделы и подписки служебной шины](service-bus-dotnet-how-to-use-topics-subscriptions.md)