---
title: Сравнение очередей службы хранилища Azure и очередей Служебной шины
description: Анализ сходства и различий между двумя типами очередей, предлагаемых в Azure.
ms.topic: article
ms.date: 11/04/2020
ms.openlocfilehash: 31992aa2012009c51cbeae78010ae8ced65fc872
ms.sourcegitcommit: 1756a8a1485c290c46cc40bc869702b8c8454016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/09/2020
ms.locfileid: "96928313"
---
# <a name="storage-queues-and-service-bus-queues---compared-and-contrasted"></a>Очереди службы хранилища и очереди служебной шины: сходства и различия
В этой статье анализируются различия и сходства двух типов очередей, предлагаемых Microsoft Azure: очередей хранилища и очередей служебной шины. Используя эти сведения, вы можете принять более обоснованное решение о том, какое решение наилучшим образом соответствует вашим потребностям.

## <a name="introduction"></a>Введение
Azure поддерживает два типа очередей: **очереди службы хранилища** и **очереди служебной шины**.

**Очереди службы хранилища** являются частью инфраструктуры службы [хранилища Azure](https://azure.microsoft.com/services/storage/) . Они позволяют хранить большое количество сообщений. Доступ к сообщениям возможен из любой точки мира с помощью вызовов с проверкой подлинности по протоколу HTTP или HTTPS. Максимальный размер сообщения в очереди составляет 64 КБ. Очередь может содержать миллионы сообщений вплоть до лимита всей емкости учетной записи хранения. Очереди обычно используются для создания списка невыполненных заданий для асинхронной обработки. Дополнительные сведения см. в статье [что такое очереди службы хранилища Azure](../storage/queues/storage-queues-introduction.md).

**Очереди служебной шины** являются частью более широкой инфраструктуры [обмена сообщениями Azure](https://azure.microsoft.com/services/service-bus/) , которая поддерживает очередь, публикацию, подписывание и более сложные шаблоны интеграции. Они предназначены для интеграции приложений или компонентов приложений, которые могут охватывать несколько протоколов связи, контрактов данных, доверенных доменов или сетевых сред. Дополнительные сведения об очередях, разделах и подписках служебной шины см. в статье [очереди, разделы и подписки](service-bus-queues-topics-subscriptions.md)служебной шины.


## <a name="technology-selection-considerations"></a>Рекомендации по выбору технологии
Очереди хранилища и очереди служебной шины имеют немного другой набор функций. В зависимости от потребностей конкретного решения можно выбрать один или оба варианта.

При определении того, какая технология очередей подходит для данного решения, архитекторам и разработчикам решений следует учитывать эти рекомендации. 

### <a name="consider-using-storage-queues"></a>Рассмотрите возможность использования очередей хранилища
Ниже приведены случаи, в которых архитекторам и разработчикам решений **рекомендуется использовать очереди службы хранилища**.

* Приложение должно хранить свыше 80 ГБ сообщений в очереди.
* Приложению требуется отслеживать ход обработки сообщения в очереди. Это полезно в случае сбоя рабочей роли при обработке сообщения. После этого другая рабочая роль может использовать эти сведения, чтобы продолжить работу с предыдущей рабочей ролью.
* Вам требуются серверные журналы всех примененных к очередям транзакций.

### <a name="consider-using-service-bus-queues"></a>Рассмотрите возможность использования очередей служебной шины
В следующих случаях архитекторам и разработчикам решений **рекомендуется использовать очереди служебной шины**:

* Вашему решению необходимо получить сообщения без опроса очереди. С помощью служебной шины можно достичь длительного опроса, используя протоколы на основе TCP, поддерживаемые служебной шиной.
* В решении требуется, чтобы очередь гарантированно доставляла сообщения в порядке их добавления в очередь (FIFO).
* Решение должно поддерживать автоматическое обнаружение дубликатов.
* Вы хотите, чтобы приложение обрабатывало сообщения как параллельные долговременные потоки (сообщения связываются с потоком с помощью свойства [SessionId](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sessionid) сообщения). В этой модели каждый узел принимающего приложения конкурирует за потоки, а не за сообщения. Когда для принимающего узла выделяется поток, узел может проверить состояние потока приложения с помощью транзакций.
* В решении требуется реализовать транзакционный режим работы и атомарность при отправке или получении нескольких сообщений из очереди.
* Приложение обрабатывает сообщения, размер которых может превышать 64 КБ, но, скорее всего, приближается к ограничению 256 КБ.
* Вам требуется обеспечить доступ к очередям на основе ролей, а также предусмотреть различные права или разрешения для отправителей и получателей. Дополнительные сведения см. в следующих статьях:
    - [Аутентификация на основе управляемых удостоверений](service-bus-managed-service-identity.md)
    - [Аутентификация из приложения](authenticate-application.md)
* Размер очереди не будет расти свыше 80 ГБ.
* Вы хотите использовать протокол обмена сообщениями на основе стандартов AMQP 1.0. Дополнительные сведения об AMQP см. в статье [Общие сведения о протоколе AMQP для служебной шины](service-bus-amqp-overview.md).
* Вы представите пошаговую миграцию из очереди обмена сообщениями между точками на основе очередей и шаблонами сообщений публикации и подписки. Этот шаблон обеспечивает интеграцию дополнительных получателей (подписчиков). Каждый получатель получает независимые копии некоторых или всех сообщений, отправленных в очередь. 
* Решение для обмена сообщениями должно поддерживать гарантию доставки "не более одного раза" без необходимости создавать дополнительные компоненты инфраструктуры.
* Вашему решению необходимо публиковать и использовать пакеты сообщений.

## <a name="compare-storage-queues-and-service-bus-queues"></a>Сравнение очередей хранилища и очередей служебной шины
В таблицах в следующих разделах приводится логическая группировка функций очереди. Они позволяют быстро сравнить возможности, доступные как в очередях службы хранилища Azure, так и в очередях служебной шины.

## <a name="foundational-capabilities"></a>Основные возможности
В этом разделе сравниваются некоторые из основных возможностей, предоставляемых очередями служебной шины и службы хранилища.

| Критерии сравнения | Очереди службы хранилища | Очереди служебной шины |
| --- | --- | --- |
| Гарантированный метод упорядочивания |**Нет** <br/><br>Дополнительные сведения см. в первом примечании в разделе [Дополнительные сведения](#additional-information) .</br> | **Да — "первым прибыл, первым обслужен" (FIFO)**<br/><br>(с использованием [сеансов сообщений](message-sessions.md)) |
| Гарантированный метод доставки |**Как минимум один раз** |**По крайней мере один раз** (с использованием режима получения PeekLock. Это значение по умолчанию) <br/><br/>" **Один раз** " (с использованием режима получения ReceiveAndDelete) <br/> <br/> Дополнительные сведения о различных [режимах приема](service-bus-queues-topics-subscriptions.md#receive-modes)  |
| Поддержка атомарной операции |**Нет** |**Да**<br/><br/> |
| Поведение при получении |**Без блокировки**<br/><br/>(немедленно завершается, если новые сообщения не найдены) |**Блокировка с временем ожидания или без него**<br/><br/>(продолжительный опрос, или ["метод Comet"](https://go.microsoft.com/fwlink/?LinkId=613759))<br/><br/>**Без блокировки**<br/><br/>(только с помощью управляемого интерфейса API для .NET) |
| API push-уведомлений |**Нет** |**Да**<br/><br/>[QueueClient. onmessage](/dotnet/api/microsoft.servicebus.messaging.queueclient.onmessage#Microsoft_ServiceBus_Messaging_QueueClient_OnMessage_System_Action_Microsoft_ServiceBus_Messaging_BrokeredMessage__) и [Мессажесессионхандлер. onmessage](/dotnet/api/microsoft.servicebus.messaging.messagesessionhandler.onmessage#Microsoft_ServiceBus_Messaging_MessageSessionHandler_OnMessage_Microsoft_ServiceBus_Messaging_MessageSession_Microsoft_ServiceBus_Messaging_BrokeredMessage__) Sessions API .NET. |
| Режим получения |**Просмотр и аренда** |**Просмотр и блокировка**<br/><br/>**Получение и удаление** |
| Режим монопольного доступа |**На основе аренды** |**На основе блокировки** |
| Продолжительность аренды или блокировки |**30 секунд (по умолчанию)**<br/><br/>**7 дней (максимум)** (можно продлить или отменить аренду сообщения с помощью метода API [UpdateMessage](/dotnet/api/microsoft.azure.storage.queue.cloudqueue.updatemessage)) |**60 секунд (по умолчанию)**<br/><br/>Можно возобновить блокировку сообщения с помощью метода API [RenewLock](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.renewlock#Microsoft_ServiceBus_Messaging_BrokeredMessage_RenewLock). |
| Степень детализации аренды или блокировки |**Уровень сообщения**<br/><br/>Каждое сообщение может иметь другое значение времени ожидания, которое затем можно обновить по мере необходимости при обработке сообщения с помощью API [UpdateMessage](/dotnet/api/microsoft.azure.storage.queue.cloudqueue.updatemessage) . |**Уровень очереди**<br/><br/>(для каждой очереди определена степень детализации блокировки, применяемая ко всем сообщениям в ней, однако блокировку можно продлить с помощью метода API [RenewLock](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.renewlock#Microsoft_ServiceBus_Messaging_BrokeredMessage_RenewLock)) |
| Получение в пакетном режиме |**Да**<br/><br/>(явно, путем указания количества сообщений при их извлечении; до 32 сообщений) |**Да**<br/><br/>(неявно, путем включения свойства предварительной выборки, или явно, с помощью транзакций) |
| Отправка в пакетном режиме |**Нет** |**Да**<br/><br/>(с помощью транзакций или пакетной обработки на стороне клиента) |

### <a name="additional-information"></a>Дополнительные сведения
* Сообщения в очередях хранилища обычно являются первыми сквозными, но иногда они могут быть неупорядоченными. Например, если время ожидания видимости сообщения истекло из-за сбоя клиентского приложения при обработке сообщения. По истечении времени ожидания сообщение снова становится видимым, и следующий рабочий процесс может вывести его из очереди. В этот момент вновь видимое сообщение может быть помещено в очередь для повторного вывода из очереди.
* Для гарантированного упорядочения сообщений по методу FIFO в очередях служебной шины необходимо использовать сеансы обмена сообщениями. Если приложение аварийно завершает работу во время обработки сообщения, полученного в режиме **просмотра &** , в следующий раз, когда получатель очереди принимает сеанс обмена сообщениями, он начнется с ошибочного сообщения после истечения срока жизни сообщения.
* Очереди службы хранилища предназначены для поддержки стандартных сценариев, таких как следующие:
    - Отделение компонентов приложения для повышения масштабируемости и допустимости сбоев
    - Выравнивание нагрузки
    - Создание рабочих процессов процесса.
* Несоответствия в отношении обработки сообщений в контексте сеансов служебной шины можно избежать, используя состояние сеанса для хранения состояния приложения относительно хода обработки последовательности сообщений сеанса и с помощью транзакций, связанных с разрешениями полученных сообщений и обновления состояния сеанса. Этот тип функции согласованности иногда помечается *только один раз при обработке* в продуктах других поставщиков. Любые сбои транзакций, очевидно, приводят к тому, что сообщения будут доставлены и именно поэтому термин не вполне достаточно.
* Очереди службы хранилища предоставляют единообразную и согласованную модель программирования для очередей, таблиц и больших двоичных объектов как разработчикам, так и специалистам по эксплуатации.
* Очереди служебной шины обеспечивают поддержку локальных транзакций в контексте одной очереди.
* Режим **Получение и удаление**, поддерживаемый служебной шиной, позволяет сократить число операций обмена сообщениями (и связанные с этим расходы) за счет понижения уровня гарантии доставки.
* Очереди службы хранилища поддерживают аренду сообщений с возможностью продления, Эта функция позволяет рабочим процессам сохранять короткие аренды сообщений. Таким образом, если Рабочая роль завершается сбоем, сообщение может быть быстро обработано другим работником. Кроме того, Рабочая роль может продлить аренду сообщения, если требуется обработать его дольше, чем текущее время аренды.
* Очереди службы хранилища поддерживают время ожидания видимости, которое можно задавать при добавлении сообщения в очередь или выведении из нее. Кроме того, можно обновить сообщение с разными значениями аренды во время выполнения и обновить разные значения в сообщениях в одной очереди. Время ожидания блокировки служебной шины определяется в метаданных очереди. Однако можно продлить блокировку, вызвав метод [RenewLock](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.renewlock#Microsoft_ServiceBus_Messaging_BrokeredMessage_RenewLock) .
* Максимальное время ожидания для операции получения с блокировкой в очередях служебной шины составляет 24 дня. Однако для очередей на основе REST время ожидания не может превышать 55 секунд.
* Служебная шина позволяет выполнять пакетную обработку на стороне клиента. Это означает, что клиент очереди может отправлять несколько сообщений в рамках одной операции отправки. Пакетная обработка возможна только для операций асинхронной отправки.
* Такие функции, как 200-ТБ поверх очереди хранилища (дополнительно при виртуализации учетных записей) и неограниченные очереди, делают ее идеальной платформой для поставщиков SaaS.
* Очереди службы хранилища предоставляют гибкий и эффективный механизм управления делегированным доступом.

## <a name="advanced-capabilities"></a>Расширенные возможности
В этом разделе сравниваются расширенные возможности очередей службы хранилища и очередей служебной шины.

| Критерии сравнения | Очереди службы хранилища | Очереди служебной шины |
| --- | --- | --- |
| Доставка по расписанию |**Да** |**Да** |
| Автоматическое перемещение в "мертвую очередь" |**Нет** |**Да** |
| Увеличение срока жизни очереди |**Да**<br/><br/>(посредством обновления времени ожидания видимости "на месте") |**Да**<br/><br/>(используется выделенная функция API) |
| Поддержка сообщений о сбое |**Да** |**Да** |
| Обновление "на месте" |**Да** |**Да** |
| Журнал транзакций на стороне сервера |**Да** |**Нет** |
| Метрики хранения |**Да**<br/><br/>Эти **метрики** позволяют получить метрики в реальном времени для обеспечения доступности, технической платы, количества вызовов API, количества ошибок и многого другого. Все они находятся в режиме реального времени, объединяются в минуту и передаются в течение нескольких минут с момента, когда это произошло в рабочей среде. Дополнительные сведения см. в разделе [О метриках аналитики хранилища](/rest/api/storageservices/fileservices/About-Storage-Analytics-Metrics). |**Да**<br/><br/>(массовые запросы путем вызова [GetQueues](/dotnet/api/microsoft.servicebus.namespacemanager.getqueues#Microsoft_ServiceBus_NamespaceManager_GetQueues)) |
| Управление состоянием |**Нет** |**Да**<br/><br/>[Microsoft.ServiceBus.Messaging.EntityStatus.Active](/dotnet/api/microsoft.servicebus.messaging.entitystatus), [Microsoft.ServiceBus.Messaging.EntityStatus.Disabled](/dotnet/api/microsoft.servicebus.messaging.entitystatus), [Microsoft.ServiceBus.Messaging.EntityStatus.SendDisabled](/dotnet/api/microsoft.servicebus.messaging.entitystatus), [Microsoft.ServiceBus.Messaging.EntityStatus.ReceiveDisabled](/dotnet/api/microsoft.servicebus.messaging.entitystatus) |
| Пересылка сообщений |**Нет** |**Да** |
| Функция очистки очереди |**Да** |**Нет** |
| Группы сообщений |**Нет** |**Да**<br/><br/>(используются сеансы обмена сообщениями) |
| Состояние приложений по группам сообщений |**Нет** |**Да** |
| Обнаружение дубликатов |**Нет** |**Да**<br/><br/>(настраивается на стороне отправителя) |
| Просмотр групп сообщений |**Нет** |**Да** |
| Выборка сеансов сообщений по идентификатору |**Нет** |**Да** |

### <a name="additional-information"></a>Дополнительные сведения
* Обе технологии очередей позволяют запланировать доставку сообщения в более позднее время.
* Пересылка очереди позволяет тысячам очередей пересылать свои сообщения в одну очередь, из которой принимающее приложение получает сообщение. Этот механизм можно использовать для обеспечения безопасности, управления потоком и изоляции хранилищ разных создателей сообщений.
* Очереди службы хранилища поддерживают обновление содержимого сообщений. Вы можете использовать эту возможность для сохранения в сообщении сведений о состоянии и поэтапного обновления хода выполнения операций. Это позволит продолжать обработку сообщений с последней известной контрольной точки, а не с самого начала. В очередях служебной шины тот же сценарий реализуется с использованием сеансов сообщений. Сеансы позволяют сохранять и извлекать состояние обработки приложения (с помощью методов [SetState](/dotnet/api/microsoft.servicebus.messaging.messagesession.setstate#Microsoft_ServiceBus_Messaging_MessageSession_SetState_System_IO_Stream_) и [GetState](/dotnet/api/microsoft.servicebus.messaging.messagesession.getstate#Microsoft_ServiceBus_Messaging_MessageSession_GetState)).
* Очереди служебной шины поддерживают [недоставленное письмо](service-bus-dead-letter-queues.md). Это может быть полезно для изоляции сообщений, соответствующих следующим критериям.
    - Не удается успешно обработать сообщения принимающим приложением 
    - Сообщения не достигают места назначения из-за просроченного свойства срока жизни (TTL). Значение TTL определяет время, в течение которого сообщение остается в очереди. Если используется служебная шина, после истечения срока жизни сообщение перемещается в специальную очередь $DeadLetterQueue.
* Чтобы найти подозрительные сообщения в очередях службы хранилища, приложение проверяет свойство сообщения [DequeueCount](/dotnet/api/microsoft.azure.storage.queue.cloudqueuemessage.dequeuecount) при выведении его из очереди. Если значение **DequeueCount** превышает заданное пороговое значение, сообщение перемещается в определяемую приложением "мертвую очередь".
* Очереди службы хранилища позволяют получить подробный журнал всех транзакций, выполняемых в очереди, и статистические метрики. Обе функции полезны для отладки и понимания принципов использования очередей службы хранилища в приложении. Они также полезны для настройки производительности приложения и снижения затрат на использование очередей.
* Сеансы сообщений, поддерживаемые служебной шиной, позволяют связать сообщения, принадлежащие логической группе, к получателю. Он создает сходство между сообщениями и соответствующими получателями. Чтобы включить эту функцию в служебной шине, нужно задать свойство сообщения [SessionID](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sessionid#Microsoft_ServiceBus_Messaging_BrokeredMessage_SessionId). Получатели смогут выполнять прослушку по конкретному идентификатору сеанса и получать сообщения с этим идентификатором.
* Функция обнаружения дубликатов в очередях служебной шины автоматически удаляет повторяющиеся сообщения, отправленные в очередь или раздел, в зависимости от значения свойства [MessageId](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.messageid#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) .

## <a name="capacity-and-quotas"></a>Емкость и квоты
В этом разделе сравниваются допустимые значения [емкости и квот](service-bus-quotas.md), которые могут использоваться в очередях служебной шины и службы хранилища.

| Критерии сравнения | Очереди службы хранилища | Очереди служебной шины |
| --- | --- | --- |
| Максимальный размер очереди |**500 TБ**<br/><br/>(ограничено [одной емкостью учетной записи хранения](../storage/common/storage-introduction.md#queue-storage)) |**От 1 до 80 ГБ**<br/><br/>(определяется при создании очереди и [включении секционирования](service-bus-partitioning.md); см. раздел "Дополнительные сведения") |
| Максимальный размер сообщения |**64 КБ**<br/><br/>(48 КБ при использовании кодировки **Base64**)<br/><br/>Azure поддерживает большие сообщения за счет сочетания очередей и больших двоичных объектов; благодаря этому можно поставить в очередь до 200 ГБ данных на один элемент. |**256 КБ** или **1 МБ**<br/><br/>(включая заголовок и текст; максимальный размер заголовка — 64 КБ).<br/><br/>Зависит от [уровня служб](service-bus-premium-messaging.md). |
| Максимальный срок жизни сообщения |**Infinite** (api версии 2017-07-27 или более поздней) |**TimeSpan.Max** |
| Максимальное количество очередей |**Unlimited** |**10 000**<br/><br/>(на пространство имен службы) |
| Максимальное количество параллельных клиентов |**Unlimited** |**5 000** |

### <a name="additional-information"></a>Дополнительные сведения
* В служебной шине ограничения по размеру применяются принудительно. Максимальный размер очереди указывается при создании очереди. Это может быть от 1 ГБ до 80 ГБ. Если размер очереди достигает этого предела, дополнительные входящие сообщения будут отклонены, и вызывающий объект получит исключение. Дополнительные сведения о квотах в служебной шине см. в разделе [Квоты на служебную шину](service-bus-quotas.md).
* Секционирование не поддерживается на [уровне Premium](service-bus-premium-messaging.md). В стандартном уровне обмена сообщениями можно создавать очереди и разделы служебной шины в размере 1 (по умолчанию), 2, 3, 4 или 5 ГБ. Если секционирование включено, служебная шина создает 16 копий (16 секций) сущности, каждый из которых указан в одном и том же размере. Таким образом, при создании очереди размером 5 ГБ размер очереди составляет 16 секций (5 * 16) = 80 ГБ.  Максимальный размер секционированной очереди или раздела можно узнать в [портал Azure][Azure portal].
* При использовании очередей хранилища, если содержимое сообщения не является XML-совместимым, оно должно быть закодировано в **формате Base64** . При кодировке сообщения методом **Base64** размер полезных данных может достигать 48 KБ (а не 64 КБ).
* Каждое сообщение, сохраненное в очереди служебной шины, состоит из двух частей: заголовка и текста. Общий размер сообщения не может превышать максимальный размер сообщения, поддерживаемый уровнем службы.
* Когда клиенты взаимодействуют с очередями служебной шины по протоколу TCP, максимальное количество одновременных подключений к отдельной очереди служебной шины не может превышать 100. Это число распределяется между отправителями и получателями. При достижении этой квоты запросы на дополнительные соединения будут отклонены, и вызывающий код получит исключение. Это ограничение не накладывается на клиенты, подключающиеся к очередям с помощью API на основе RESTFUL.
* Если требуется более 10 000 очередей в одном пространстве имен служебной шины, можно отправить запрос на увеличение в службу поддержки Azure. Чтобы увеличить количество очередей служебной шины сверх ограничения в 10 000, создайте дополнительные пространства имен на [портале Azure][Azure portal].

## <a name="management-and-operations"></a>Управление и использование
В этом разделе сравниваются возможности управления, предоставляемые очередями служебной шины и службы хранилища.

| Критерии сравнения | Очереди службы хранилища | Очереди служебной шины |
| --- | --- | --- |
| Протокол управления |**REST по протоколу HTTP/HTTPS** |**REST по протоколу HTTPS** |
| Протокол выполнения |**REST по протоколу HTTP/HTTPS** |**REST по протоколу HTTPS**<br/><br/>**Стандарт AMQP 1.0 (TCP с TLS)** |
| API для .NET |**Да**<br/><br/>(API клиента службы хранилища для .NET) |**Да**<br/><br/>(API служебной шины для .NET) |
| Машинный C++ |**Да** |**Да** |
| API Java |**Да** |**Да** |
| API для PHP |**Да** |**Да** |
| API для Node.js |**Да** |**Да** |
| Поддержка произвольных метаданных |**Да** |**Нет** |
| Правила именования очередей |**Может содержать до 63 символов**<br/><br/>(Буквы в имени очереди должны быть строчными.) |**Может содержать до 260 символов**<br/><br/>(В путях и именах очередей регистр не учитывается.) |
| Функция получения длины очереди |**Да**<br/><br/>(Приблизительное значение, если сообщение не удаляется после истечения срока жизни.) |**Да**<br/><br/>(Точное значение в определенный момент времени.) |
| Функция просмотра |**Да** |**Да** |

### <a name="additional-information"></a>Дополнительные сведения
* Очереди службы хранилища поддерживают произвольные атрибуты, которые могут применяться к описанию очереди, в формате пары "имя/значение"
* Обе технологии также позволяют просматривать сообщения без их блокировки, что может пригодиться при реализации браузера или проводника для очередей.
* API обмена сообщениями через брокер служебной шины .NET используют дуплексные TCP-подключения для повышения производительности по сравнению с ОСТАВШИМся по протоколу HTTP и поддерживают стандартный протокол AMQP 1,0.
* Имена очередей службы хранилища могут содержать от 3 до 63 знаков, включая строчные буквы, цифры и дефисы (-). Дополнительные сведения см. в статье [Именование очередей и метаданных](/rest/api/storageservices/fileservices/Naming-Queues-and-Metadata).
* Имя очереди служебной шины может содержать до 260 символов. При этом действуют менее жесткие правила именования: имена очереди служебной шины могут содержать буквы, цифры, точки, дефисы и знаки подчеркивания.

## <a name="authentication-and-authorization"></a>Аутентификация и авторизация
В этом разделе рассматриваются функции аутентификации и авторизации, поддерживаемые очередями служебной шины и службы хранилища.

| Критерии сравнения | Очереди службы хранилища | Очереди служебной шины |
| --- | --- | --- |
| Аутентификация |**Симметричный ключ** |**Симметричный ключ** |
| Модель безопасности |Делегирование доступа через маркеры SAS |SAS |
| Федерация поставщика удостоверений |**Нет** |**Да** |

### <a name="additional-information"></a>Дополнительные сведения
* В обеих технологиях очередей требуется аутентификация при каждом запросе. Общие очереди с анонимным доступом не поддерживаются. При использовании [SAS](service-bus-sas.md) вы можете публиковать SAS только для записи, SAS только для чтения или даже SAS для полного доступа.
* Схема проверки подлинности, предоставляемая очередями хранилища, включает использование симметричного ключа. Этот ключ представляет собой хэш-код проверки подлинности сообщения (HMAC), вычисленный с помощью алгоритма SHA-256 и закодированный в виде строки **Base64** . Дополнительные сведения о соответствующем протоколе см. в статье [Проверка подлинности для служб хранилища Azure](/rest/api/storageservices/fileservices/Authentication-for-the-Azure-Storage-Services). Очереди служебной шины поддерживают аналогичную модель с использованием симметричных ключей. Дополнительные сведения см. в статье [Проверка подлинности подписанного URL-адреса с помощью служебной шины](service-bus-sas.md).

## <a name="conclusion"></a>Заключение
Получив более глубокое представление о двух технологиях, вы можете принять более обоснованное решение о том, какую технологию очереди использовать и когда. Решение о том, когда следует использовать очереди службы хранилища, а когда очереди служебной шины, зависит от целого ряда факторов. Все они могут в значительной степени зависеть от конкретных требований приложения и его архитектуры. 

Вы можете выбрать очереди хранилища по следующим причинам:

- Если приложение уже использует основные возможности Microsoft Azure 
- Если требуется базовая связь и обмен сообщениями между службами 
- Требуются очереди размером более 80 ГБ

Очереди служебной шины предоставляют ряд дополнительных функций, таких как следующие. Поэтому они могут быть предпочтительнее, если вы создаете гибридное приложение или если приложению требуются эти функции.

- [Сеансы](message-sessions.md)
- [Транзакции](service-bus-transactions.md)
- [Обнаружение дубликатов](duplicate-detection.md)
- [Автоматическое недоставленное письмо](service-bus-dead-letter-queues.md)
- [Устойчивые возможности публикации и подписки](service-bus-queues-topics-subscriptions.md#topics-and-subscriptions) 



## <a name="next-steps"></a>Дальнейшие действия
Для получения подробной информации и рекомендаций по использованию очередей служебной шины и службы хранилища ознакомьтесь со следующими статьями.

* [Начало работы с очередями служебной шины](service-bus-dotnet-get-started-with-queues.md)
* [Как использовать службу хранилища очередей](../storage/queues/storage-dotnet-how-to-use-queues.md)
* [Рекомендации по повышению производительности с помощью обмена сообщениями через брокер в служебной шине](service-bus-performance-improvements.md)
* [Introducing Queues and Topics in Azure Service Bus](https://www.serverless360.com/blog/azure-service-bus-queues-vs-topics) (Введение в очереди и разделы служебной шины Azure) (запись блога)
* [Руководство разработчика по служебной шине](http://www.cloudcasts.net/devguide/Default.aspx?id=11030)
* [Использование службы очередей в Azure ](https://www.developerfusion.com/article/120197/using-the-queuing-service-in-windows-azure/)

[Azure portal]: https://portal.azure.com

