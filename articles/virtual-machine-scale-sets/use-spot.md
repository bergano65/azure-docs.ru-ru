---
title: Создание масштабируемого набора, использующего виртуальные машины Azure (Предварительная версия)
description: Узнайте, как создавать масштабируемые наборы виртуальных машин Azure, использующие плашечные виртуальные машины, чтобы сэкономить на затратах.
services: virtual-machine-scale-sets
author: cynthn
manager: gwallace
tags: azure-resource-manager
ms.service: virtual-machine-scale-sets
ms.workload: infrastructure-services
ms.topic: article
ms.date: 10/23/2019
ms.author: cynthn
ms.openlocfilehash: 68315b1b0d290b107fe2d28a9e3b49be009b78b8
ms.sourcegitcommit: 6bb98654e97d213c549b23ebb161bda4468a1997
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/03/2019
ms.locfileid: "74782246"
---
# <a name="preview-azure-spot-vms-for-virtual-machine-scale-sets"></a>Предварительная версия: виртуальные машины Azure для масштабируемых наборов виртуальных машин 

Использование точки Azure в масштабируемых наборах позволяет использовать преимущества нашей неиспользуемой емкости с значительной экономией затрат. В любой момент, когда Azure нужна емкость, инфраструктура Azure будет выключать экземпляры смесевых цветов. Таким образом, плашечные экземпляры отлично подходят для рабочих нагрузок, которые могут обрабатывать прерывания, такие как задания пакетной обработки, среды разработки и тестирования, большие вычислительные рабочие нагрузки и многое другое.

Объем доступной емкости может изменяться в зависимости от размера, региона, времени суток и других возможностей. При развертывании смесевых экземпляров в масштабируемых наборах Azure выделит экземпляр только при наличии доступной емкости, но соглашение об уровне обслуживания для этих экземпляров отсутствует. Масштабируемый набор развертывается в одном домене сбоя и не предоставляет гарантии высокого уровня доступности.

> [!IMPORTANT]
> Экземпляры смесевых цветов в настоящее время доступны в общедоступной предварительной версии.
> Эта предварительная версия не рекомендуется для рабочих нагрузок в рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).
>
> На ранних этапах общедоступной предварительной версии экземпляры смесевых цветов будут иметь фиксированную цену, поэтому на основе цен не будет никаких вытеснения.

## <a name="pricing"></a>Стоимость

Цены на экземпляры смесевых переменных основаны на регионе и номере SKU. Дополнительные сведения см. в статье цены на [Linux](https://azure.microsoft.com/pricing/details/virtual-machine-scale-sets/linux/) и [Windows](https://azure.microsoft.com/pricing/details/virtual-machine-scale-sets/windows/). 


С помощью переменных цен вы можете задать максимальную цену в долларах США (USD), используя до 5 десятичных разрядов. Например, значение `0.98765`будет максимальной ценой $0,98765 долл. США в час. Если задать максимальную цену `-1`, то экземпляр не будет удален на основе цены. Цена для экземпляра будет представлять собой текущую цену на точку или цену для стандартного экземпляра, который когда-либо будет меньше, пока есть доступная емкость и квота.

## <a name="eviction-policy"></a>Политика вытеснения

При создании наборов точечных масштабирования можно задать политику вытеснения для отмены *распределения* (по умолчанию) или *Удалить*. 

Политика *освобождения* перемещает вытесненные экземпляры в остановленное состояние, что позволяет повторно развертывать исключенные экземпляры. Однако нет гарантии, что распределение будет выполнено успешно. Виртуальные машины, распределение которых отменено, будут учитываться в квоте экземпляра масштабируемого набора, и вам будет выставлен счет за базовые диски. 

Если вы хотите, чтобы экземпляры в плашечном наборе были удалены при удалении, можно задать политику вытеснения для *удаления*. Если установлена политика вытеснения с действием удаления, то можно создавать новые виртуальные машины, увеличивая свойство количества экземпляров масштабируемого набора. Вытесненные виртуальные машины удаляются вместе с их базовыми дисками, и поэтому вы не будете платить за хранение. Также можно использовать функцию автомасштабирования масштабируемых наборов, чтобы автоматически попытаться компенсировать вытесненные виртуальные машины, однако нет гарантии, что распределение будет успешным. Рекомендуется использовать функцию автомасштабирования только в плашечных наборах, если вы установили политику вытеснений для удаления во избежание затрат на диски и попадания в квоты. 

Пользователи могут принять участие в получении уведомлений в виртуальной машине с помощью [Azure запланированные события](../virtual-machines/linux/scheduled-events.md). Это позволит уведомить вас о том, что ваши виртуальные машины будут вытеснены, и у вас будет 30 секунд для завершения всех заданий и выполнения задач завершения работы до удаления. 


## <a name="deploying-spot-vms-in-scale-sets"></a>Развертывание точечных виртуальных машин в масштабируемых наборах

Чтобы развернуть плашечные виртуальные машины в масштабируемых наборах, можно установить для нового флага *приоритета* значение « *плашечный*». Все виртуальные машины в масштабируемом наборе будут иметь значение "точечная". Чтобы создать масштабируемый набор с точечными виртуальными машинами, используйте один из следующих методов.
- [Портал Azure](#portal)
- [Azure CLI](#azure-cli)
- [Azure PowerShell](#powershell)
- [Шаблоны диспетчера ресурсов Azure](#resource-manager-templates)

## <a name="portal"></a>Microsoft Azure

Процесс создания масштабируемого набора, использующего плашечные виртуальные машины, аналогичен описанному в [статье Приступая к работе](quick-create-portal.md). При развертывании масштабируемого набора можно задать параметр точки и политику вытеснения: ![создать масштабируемый набор с развернутыми виртуальными машинами](media/virtual-machine-scale-sets-use-spot/vmss-spot-portal-max-price.png)


## <a name="azure-cli"></a>Azure CLI

Процесс создания масштабируемого набора с плашечными виртуальными машинами аналогичен описанному в [статье Приступая к работе](quick-create-cli.md). Просто добавьте точку с приоритетом "--Priority" и добавьте `--max-price`. В этом примере мы используем `-1` для `--max-price`, поэтому экземпляр не будет удален на основе цены.

```azurecli
az vmss create \
    --resource-group myResourceGroup \
    --name myScaleSet \
    --image UbuntuLTS \
    --upgrade-policy-mode automatic \
    --admin-username azureuser \
    --generate-ssh-keys \
    --priority Spot \
    --max-price -1 
```

## <a name="powershell"></a>PowerShell

Процесс создания масштабируемого набора с плашечными виртуальными машинами аналогичен описанному в [статье Приступая к работе](quick-create-powershell.md).
Просто добавьте точку с приоритетом и укажите `-max-price` [New-азвмссконфиг](/powershell/module/az.compute/new-azvmssconfig).

```powershell
$vmssConfig = New-AzVmssConfig `
    -Location "East US 2" `
    -SkuCapacity 2 `
    -SkuName "Standard_DS2" `
    -UpgradePolicyMode Automatic `
    -Priority "Spot" `
    --max-price -1
```

## <a name="resource-manager-templates"></a>Шаблоны Resource Manager

Процесс создания масштабируемого набора, использующего плашечные виртуальные машины, аналогичен описанному в статье Приступая к работе для [Linux](quick-create-template-linux.md) или [Windows](quick-create-template-windows.md). Добавьте свойство "Priority" в тип ресурса *Microsoft. COMPUTE/virtualMachineScaleSets/virtualMachineProfile* в шаблоне и укажите в качестве значения *точку* . Обязательно используйте версию API *2019-03-01* или более позднюю. 

Чтобы установить политику вытеснения с действием удаления, добавьте параметр "evictionPolicy" и задайте для него значение *delete*.

В следующем примере создается набор точечных масштабируемых Linux с именем *myScaleSet* в *западной центральной части США*, который *удаляет* виртуальные машины в масштабируемом наборе при вытеснении:

```json
{
  "type": "Microsoft.Compute/virtualMachineScaleSets",
  "name": "myScaleSet",
  "location": "East US 2",
  "apiVersion": "2019-03-01",
  "sku": {
    "name": "Standard_DS2_v2",
    "capacity": "2"
  },
  "properties": {
    "upgradePolicy": {
      "mode": "Automatic"
    },
    "virtualMachineProfile": {
       "priority": "Spot",
       "evictionPolicy": "delete",
       "storageProfile": {
        "osDisk": {
          "caching": "ReadWrite",
          "createOption": "FromImage"
        },
        "imageReference":  {
          "publisher": "Canonical",
          "offer": "UbuntuServer",
          "sku": "16.04-LTS",
          "version": "latest"
        }
      },
      "osProfile": {
        "computerNamePrefix": "myvmss",
        "adminUsername": "azureuser",
        "adminPassword": "P@ssw0rd!"
      }
    }
  }
}
```
## <a name="faq"></a>Вопросы и ответы

**Вопрос.** После создания экземпляр будет таким же, как и стандартный экземпляр?

Ответ **.** Да, за исключением соглашений об уровне обслуживания для отдельных виртуальных машин, которые могут быть исключены в любое время.


**Вопрос.** Что делать, когда вы получаете исключение, но по-прежнему нужна емкость?

Ответ **.** Рекомендуется использовать стандартные виртуальные машины вместо плашечных виртуальных машин, если вам нужна достаточная емкость.


**Вопрос.** Как осуществляется управление квотами для точки?

Ответ **.** Экземпляры смесевых и стандартные экземпляры будут иметь отдельные пулы квот. Квота на точки будет совместно использоваться виртуальными машинами и экземплярами масштабируемых наборов. Дополнительные сведения см. в статье [Подписка Azure, границы, квоты и ограничения службы](https://docs.microsoft.com/azure/azure-subscription-service-limits).


**Вопрос.** Можно ли запросить дополнительную квоту для точки?

Ответ **.** Да, вы сможете отправить запрос на увеличение квоты для точечных виртуальных машин с помощью [стандартного процесса запроса квоты](https://docs.microsoft.com/azure/azure-supportability/per-vm-quota-requests).


**Вопрос.** Можно ли преобразовать существующие масштабируемые наборы в наборы смесевых красок?

Ответ **.** Нет, установка флага `Spot` поддерживается только во время создания.


**Вопрос.** Если я использовал `low` для масштабируемых наборов с низким приоритетом, мне нужно начать использовать `Spot`?

Ответ **.** Пока `low` и `Spot` будут работать, но следует начать переход на использование `Spot`.


**Вопрос.** Можно ли создать масштабируемый набор с обычными виртуальными машинами и плашечными виртуальными машинами?

Ответ **.** Нет, масштабируемый набор не поддерживает более одного типа приоритета.


**Вопрос.**  Можно ли использовать Автомасштабирование с наборами плашечных масштабируемых наборов?

Ответ **.** Да, можно задать правила автоматического масштабирования для плашечного набора. При удалении виртуальных машин Автомасштабирование может попытаться создать новые плашечные виртуальные машины. Однако помните, что получение этой емкости не гарантируется. 


**Вопрос.**  Работает ли автомасштабирование с обеими политиками вытеснения (освобождение и удаление)?

Ответ **.** При использовании автомасштабирования рекомендуется задать удаление политики вытеснения. Причина этого состоит в том, что экземпляры, распределение которых отменено, учитываются в емкости масштабируемого набора. При использовании автомасштабирования, скорее всего, вы быстро достигнете целевого количества из-за вытесненных экземпляров, распределение которых отменено. 


**Вопрос.** Какие каналы поддерживают точечные виртуальные машины?

Ответ **.** Сведения о доступности виртуальных машин см. в следующей таблице.

<a name="channel"></a>

| Каналы Azure               | Доступность виртуальных машин в точке Azure       |
|------------------------------|-----------------------------------|
| Соглашение Enterprise         | ДА                               |
| Оплата по мере использования                | ДА                               |
| Поставщик облачных служб (CSP) | [Обратитесь к партнеру](https://docs.microsoft.com/partner-center/azure-plan-get-started) |
| Преимущества                     | Недоступно                     |
| Организованные спонсорами презентации                    | Недоступно                     |
| Бесплатное пробное использование                   | Недоступно                     |


**Вопрос.** Где можно разместить вопросы?

Ответ **.** Вы можете разместить и пометить свой вопрос с помощью `azure-spot` в [Q & A](https://docs.microsoft.com/answers/topics/azure-spot.html). 

## <a name="next-steps"></a>Дальнейшие действия
Теперь, когда вы создали масштабируемый набор с развернутыми виртуальными машинами, попробуйте развернуть [шаблон автомасштабирования, используя место](https://github.com/Azure/vm-scale-sets/tree/master/preview/lowpri).

Ознакомьтесь со сведениями о ценах на [странице для определения тарифа масштабируемых наборов виртуальных машин](https://azure.microsoft.com/pricing/details/virtual-machine-scale-sets/linux/).
