---
title: Непрерывность бизнес-процессов Azure HDInsight
description: В этой статье приводятся общие сведения о рекомендациях, доступности в одном регионе и вариантах оптимизации для планирования непрерывности бизнес-процессов Azure HDInsight.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
keywords: Высокая доступность Hadoop
ms.service: hdinsight
ms.topic: conceptual
ms.date: 10/08/2020
ms.openlocfilehash: f83f5aec264aeae1a729e81932843825a0ce6673
ms.sourcegitcommit: d767156543e16e816fc8a0c3777f033d649ffd3c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/26/2020
ms.locfileid: "92546948"
---
# <a name="azure-hdinsight-business-continuity"></a>Непрерывность бизнес-процессов Azure HDInsight

Кластеры Azure HDInsight зависят от многих служб Azure, таких как хранилище, базы данных, Active Directory, домен Active Directory служб, сети и Key Vault. Хорошо спроектированное, высокодоступное и отказоустойчивое приложение аналитики должно быть спроектировано с достаточной избыточностью, чтобы обеспечить защиту региональных или локальных нарушений в одной или нескольких службах. В этой статье приводятся общие сведения о рекомендациях, доступности в одном регионе и вариантах оптимизации для планирования непрерывности бизнес-процессов.

## <a name="general-best-practices"></a>Общие рекомендации

В этом разделе рассматриваются некоторые рекомендации по планированию непрерывности бизнес-процессов.

* Определите минимальные бизнес-функции, которые понадобятся в случае аварии и причин. Например, оцените, требуются ли возможности отработки отказа для слоя преобразования данных (отображается желтым цветом) *и* уровня обслуживания данных (отображается синим цветом), или если требуется только отработка отказа для уровня службы данных.

   :::image type="content" source="media/hdinsight-business-continuity/data-layers.png" alt-text="уровни преобразования данных и обслуживания данных":::

* Сегментирование кластеров на основе рабочей нагрузки, жизненного цикла разработки и отделов. Наличие большего количества кластеров снижает вероятность одного большого сбоя, влияющего на несколько различных бизнес-процессов.

* Сделайте дополнительные регионы доступны только для чтения. Регионы отработки отказа с возможностью чтения и записи могут привести к сложным архитектурам.

* Временные кластеры проще в управлении при аварии. Разработайте рабочие нагрузки таким образом, чтобы кластеры можно было циклически использовать, и в кластерах состояние не поддерживается.

* Часто рабочие нагрузки остаются незавершенными, если возникают аварии и необходимо перезапустить в новом регионе. Разработайте рабочие нагрузки так, чтобы они идемпотентными по своей природе.

* Используйте автоматизацию во время развертывания кластера и убедитесь, что параметры конфигурации кластера включены в скрипты, чтобы обеспечить быстрое и полностью автоматизированное развертывание в случае аварии.

* Использование средств мониторинга Azure в HDInsight для обнаружения ненормального поведения в кластере и установки соответствующих уведомлений об оповещениях. Вы можете развернуть предварительно настроенные решения управления для конкретных кластеров HDInsight, собирающие важные метрики производительности конкретного типа кластера. Дополнительные сведения см. в статье [мониторинг Azure для HDInsight](./hdinsight-hadoop-oms-log-analytics-tutorial.md).  

* Подпишитесь на оповещения о работоспособности Azure, чтобы получать уведомления о проблемах службы, плановом обслуживании, работоспособности и помощниках по безопасности для подписки, службы или региона. Уведомления о работоспособности, включающие причину проблемы и ресолуте, помогают лучше выполнять отработку отказа и тестовое. Дополнительные сведения см. в [документации по службе работоспособности служб Azure](../service-health/index.yml).

## <a name="single-region-availability"></a>Доступность в одном регионе

В базовой системе HDInsight имеются следующие компоненты. Все компоненты имеют собственные механизмы отказоустойчивости в одном регионе.

* Вычисление (виртуальные машины): кластер Azure HDInsight
* Хранилище метаданных: база данных SQL Azure
* Хранилище: Azure Data Lake Gen2 или хранилище BLOB-объектов
* Проверка подлинности: Azure Active Directory, Azure Active Directory доменных служб Корпоративный пакет безопасности
* Разрешение доменных имен: Azure DNS

Существуют другие необязательные службы, которые можно использовать, например Azure Key Vault и фабрику данных Azure.

:::image type="content" source="media/hdinsight-business-continuity/hdinsight-components.png" alt-text="уровни преобразования данных и обслуживания данных":::

### <a name="azure-hdinsight-cluster-compute"></a>Кластер Azure HDInsight (вычисление)

HDInsight предлагает соглашение об уровне обслуживания для уровня доступности 99,9%. Чтобы обеспечить высокий уровень доступности в одном развертывании, HDInsight сопровождается многими службами, которые по умолчанию находятся в режиме высокой доступности. Механизмы отказоустойчивости в HDInsight предоставляются службами высокой доступности Microsoft и Apache OSS в составе экосистемы.

Следующие службы предназначены для обеспечения высокой доступности:

#### <a name="infrastructure"></a>Инфраструктура

* Активный и резервный головных узлах
* Несколько узлов шлюза
* Три узла кворума Zookeeper
* Рабочие узлы, распределенные по доменам сбоя и обновления

#### <a name="service"></a>Служба

* Сервер Apache Ambari
* Уровни временной шкалы приложения для YARN
* Сервер журнала заданий для Hadoop MapReduce
* Apache Livy
* HDFS
* YARN диспетчер ресурсов
* HBase Master

Дополнительные сведения см. в документации по [службам высокого уровня доступности, поддерживаемым Azure HDInsight](./hdinsight-high-availability-components.md) .

Это не всегда повлияет на функциональность бизнеса. Инциденты службы в одной или нескольких из следующих служб в одном регионе могут также привести к утрате ожидаемых бизнес-функций.

### <a name="hdinsight-metastore"></a>Хранилище метаданных HDInsight

HDInsight использует [базу данных SQL Azure](https://azure.microsoft.com/support/legal/sla/sql-database/v1_4/) в качестве хранилище метаданных, которая обеспечивает соглашение об уровне обслуживания 99,99%. Три реплики данных хранятся в центре обработки данных с синхронной репликацией. В случае потери реплики альтернативная реплика будет беспрепятственно обслуживаться. [Активная Георепликация](../azure-sql/database/active-geo-replication-overview.md) поддерживается в режиме с максимум четырьмя центрами обработки данных. При отработке отказа (вручную или в центре обработки данных) первая реплика в иерархии автоматически становится доступной для чтения и записи. Дополнительные сведения см. в статье [непрерывность бизнес-процессов базы данных SQL Azure](../azure-sql/database/business-continuity-high-availability-disaster-recover-hadr-overview.md).

### <a name="hdinsight-storage"></a>Хранилище HDInsight

HDInsight рекомендует Azure Data Lake Storage 2-го поколения как базовый уровень хранилища. Служба [хранилища Azure](https://azure.microsoft.com/support/legal/sla/storage/v1_5/), включая Azure Data Lake Storage 2-го поколения, предоставляет соглашение об уровне обслуживания 99,9%. HDInsight использует службу LRS, в которой три реплики данных хранятся в центре обработки данных, а репликация выполняется синхронно. При утере реплики реплика обрабатываются без проблем.

### <a name="azure-active-directory"></a>Azure Active Directory

[Azure Active Directory](https://azure.microsoft.com/support/legal/sla/active-directory/v1_0/) предоставляет соглашение об уровне обслуживания 99,9%. Active Directory — это глобальная служба с несколькими уровнями внутренней избыточности и автоматической восстанавливаемостью. Дополнительные сведения см. [в статье как постоянно повысить надежность Azure Active Directory](https://azure.microsoft.com/blog/advancing-azure-active-directory-availability/).

### <a name="azure-active-directory-domain-services-ad-ds"></a>Azure Active Directory доменных служб (AD DS)

[Azure Active Directory доменных служб](https://azure.microsoft.com/support/legal/sla/active-directory-ds/v1_0/) предоставляет соглашение об уровне обслуживания 99,9%. Azure AD DS — это служба высокой доступности, размещенная в глобально распределенных центрах обработки данных. Наборы реплик являются функцией предварительной версии в AD DS Azure, которая обеспечивает географическое аварийное восстановление, если регион Azure переходит в автономный режим. Дополнительные сведения см. в разделе [Основные понятия и функции наборов реплик для Azure Active Directory доменных служб](../active-directory-domain-services/concepts-replica-sets.md) , чтобы получить дополнительные сведения.  

### <a name="azure-dns"></a>Azure DNS

[Azure DNS](https://azure.microsoft.com/support/legal/sla/dns/v1_1/) предоставляет соглашение об уровне обслуживания 100%. HDInsight использует Azure DNS в различных местах для разрешения доменных имен.

## <a name="multi-region-cost-and-complexity-optimizations"></a>Оптимизация стоимости и сложности в нескольких регионах

Повышение непрерывности бизнес-процессов с помощью аварийного восстановления с высоким уровнем доступности требует архитектурного проектирования с более высокой степенью сложности и более высокой стоимостью. В следующих таблицах подробно рассматриваются некоторые технические области, которые могут увеличить общую стоимость владения.

### <a name="cost-optimizations"></a>Оптимизация затрат

|Область|Причина эскалации затрат|Стратегии оптимизации|
|----|------------------------|-----------------------|
|Хранилище данных|Дублирование первичных данных и таблиц в дополнительном регионе|Репликация только проверенных данных|
|Исходящие данные|За передачу данных в исходящей кросс-регион приходится цена. Обзор руководств по ценам пропускной способности|Репликация только проверенных данных для уменьшения объема исходящего трафика региона|
|Вычисление кластера|Дополнительные кластеры HDInsight в дополнительном регионе|Используйте автоматизированные сценарии для развертывания вторичных вычислений после основного сбоя. Используйте Автомасштабирование для сохранения минимального размера вторичного кластера. Используйте более дешевые номера SKU виртуальных машин. Создание вторичных баз данных в регионах, где номера SKU виртуальных машин могут быть отсечены.|
|Аутентификация |Многопользовательские сценарии в дополнительном регионе потребуют дополнительных настроек Azure AD DS|Избегайте многопользовательской настройки в дополнительном регионе.|

### <a name="complexity-optimizations"></a>Оптимизация сложности

|Область|Причина укрупнения сложности|Стратегии оптимизации|
|----|------------------------|-----------------------|
|Чтение шаблонов записи |Включение первичной и вторичной реплики для чтения и записи |Создать базу-Получатель только для чтения|
|Нулевое значение RPO & RTO |Требует нулевой потери данных (RPO = 0) и нулевого времени простоя (RTO = 0) |Проектирование RPO и RTO в целях сокращения количества компонентов, для которых требуется отработка отказа.|
|Бизнес-функциональность |Обязательное полное бизнес-функционирование первичного во вторичном |Оцените, можно ли запустить с минимальным критически важным подмножеством бизнес-функций во вторичной реплике.|
|Соединение |Требуется, чтобы все вышестоящее и подчиненные системы из основного сервера подключались к базе данных-получателю.|Ограничьте вторичное подключение до исходного минимального подмножества.|

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об элементах, обсуждаемых в этой статье, см. в следующих статьях:

* [Архитектура обеспечения непрерывности бизнес-процессов Azure HDInsight](./hdinsight-business-continuity-architecture.md)
* [Пример использования архитектуры высокодоступного решения Azure HDInsight](./hdinsight-high-availability-case-study.md)
* [Обзор Apache Hive и HiveQL в Azure HDInsight](./hadoop/hdinsight-use-hive.md)