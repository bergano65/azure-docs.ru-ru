---
title: Использование туннелирования SSH для доступа к Azure HDInsight
description: Узнайте, как безопасно просматривать веб-ресурсы, размещенные на узлах HDInsight под управлением Linux, с помощью туннеля SSH.
ms.service: hdinsight
ms.topic: how-to
ms.custom: hdinsightactive
ms.date: 04/14/2020
ms.openlocfilehash: 5bbc770fa6ae5ac69b2aa939f9d2c70bb01f5403
ms.sourcegitcommit: 2f9f306fa5224595fa5f8ec6af498a0df4de08a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2021
ms.locfileid: "98945291"
---
# <a name="use-ssh-tunneling-to-access-apache-ambari-web-ui-jobhistory-namenode-apache-oozie-and-other-uis"></a>Использование туннелирования SSH для доступа к веб-интерфейсу Apache Ambari, JobHistory, NameNode, Apache Oozie и другим пользовательским интерфейсам

Кластеры HDInsight предоставляют доступ к веб-ИНТЕРФЕЙСу Apache Ambari через Интернет. Для некоторых функций требуется туннель SSH. Например, веб-интерфейс Apache Oozie не может быть доступен через Интернет без туннеля SSH.

## <a name="why-use-an-ssh-tunnel"></a>Причины для использования туннеля SSH

Некоторые меню в Ambari работают только через туннель SSH. Для этих меню используются веб-сайты и службы, выполняющиеся на узлах других типов, например рабочих узлах.

Туннель SSH требуется для следующих пользовательских веб-интерфейсов:

* Журнал заданий
* узел имен;
* стеки потоков;
* веб-интерфейс Oozie
* веб-интерфейс главного узла и журналов HBase

Для служб, установленных с действиями сценария, которые предоставляют веб-службе, потребуется туннель SSH. Для оттенок, установленного с помощью действия сценария, требуется туннель SSH для доступа к веб-ИНТЕРФЕЙСу.

> [!IMPORTANT]  
> Если у вас есть прямой доступ к HDInsight через виртуальную сеть, то вам не нужно использовать туннели SSH. Пример прямого доступа к HDInsight через виртуальную сеть см. в статье о [подключении HDInsight к локальной сети](connect-on-premises-network.md).

## <a name="what-is-an-ssh-tunnel"></a>Что такое туннель SSH?

С помощью [туннелирования Secure Shell (SSH)](https://en.wikipedia.org/wiki/Tunneling_protocol#Secure_Shell_tunneling) порт на локальном компьютере подключается к головному узлу в HDInsight. Трафик, отправленный в локальный порт, маршрутизируется по SSH-подключению к головному узлу. на котором запрос разрешается так же, как если бы он был создан на головном узле. Ответ рабочей станции отправляется обратно через туннель.

## <a name="prerequisites"></a>Предварительные требования

* Клиент SSH. Дополнительные сведения см. в руководстве по [подключению к HDInsight (Apache Hadoop) с помощью SSH](hdinsight-hadoop-linux-use-ssh-unix.md).

* Веб-браузер, который можно настроить на использование прокси-сервера SOCKS5.

    > [!WARNING]  
    > Встроенная в параметры Интернета в Windows поддержка прокси-сервера SOCKS не применяется к SOCKS5 и не работает при выполнении действий в этом документе. Следующие браузеры используют параметры прокси-сервера Windows и в настоящее время не будут работать при выполнении действий в этом документе.
    >
    > * Microsoft Edge
    > * Microsoft Internet Explorer
    >
    > Google Chrome также использует параметры прокси-сервера Windows. Но можно установить расширения, которые поддерживают SOCKS5. Рекомендуется использовать [FoxyProxy Standard](https://chrome.google.com/webstore/detail/foxyproxy-standard/gcknhkkoolaabfmlnjonogaaifnjlfnp).

## <a name="create-a-tunnel-using-the-ssh-command"></a><a name="usessh"></a>Создание туннеля с помощью команды SSH

Используйте следующую команду для создания туннеля SSH с помощью команды `ssh` . Замените `sshuser` пользователем SSH для кластера hdinsight и замените `CLUSTERNAME` именем своего кластера hdinsight:

```cmd
ssh -C2qTnNf -D 9876 sshuser@CLUSTERNAME-ssh.azurehdinsight.net
```

Эта команда создает подключение, через которое направляется трафик, поступающий на локальный порт 9876, в кластер по протоколу SSH. Допустимые значения:

|Параметр |Описание |
|---|---|
|Г 9876|Локальный порт, который направляет трафик через туннель.|
|C|Сжимать все данные, так как веб-трафик в основном является текстом.|
|2|Принудительно использовать протокол SSH для использования только протокола версии 2.|
|q|Тихий режим.|
|T|Отключите выделение псевдо-TTY, так как вы просто пересылаете порт.|
|n|Запрет на чтение STDIN, так как выполняется только пересылка порта.|
|Нет|Не выполняйте удаленную команду, так как выполняется только пересылка порта.|
|f|Запустите в фоновом режиме.|

После завершения команды трафик, отправленный на порт 9876 локального компьютера, будет направляться на головной узел кластера.

## <a name="create-a-tunnel-using-putty"></a><a name="useputty"></a>Создание туннеля с помощью PuTTY

[PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty) — это графический клиент SSH для Windows. Если вы не знакомы с выводимыми данными, см. [документацию по](https://www.chiark.greenend.org.uk/~sgtatham/putty/docs.html)выводимым сведениям. Для создания туннеля SSH с помощью PuTTY выполните следующие действия.

### <a name="create-or-load-a-session"></a>Создание или загрузка сеанса

1. Откройте PuTTY и выберите **Session** (Сеанс) в меню слева. Если сеанс уже сохранен, выберите имя сеанса из списка **сохраненные сеансы** и нажмите кнопку **загрузить**.

1. Если же у вас еще нет сохраненного сеанса, введите информацию о подключении.

    |Свойство |Значение |
    |---|---|
    |Имя узла (или IP-адрес)|SSH-адрес для кластера HDInsight. Например, **mycluster-SSH.azurehdinsight.NET**.|
    |Порт|22|
    |Тип соединения|SSH|

1. Нажмите кнопку **Сохранить**.

    ![Создание выводимого сеанса HDInsight](./media/hdinsight-linux-ambari-ssh-tunnel/hdinsight-create-putty-session.png)

1. В разделе **Категории** в левой части диалогового окна последовательно разверните **Подключение**, **SSH** и выберите **Туннели**.

1. Укажите следующие сведения в форме **Параметры, управляющие перенаправлением портов SSH** .

    |Свойство |Значение |
    |---|---|
    |Исходный порт|Порт на клиенте, который вы хотите перенаправить. Например, **9876**.|
    |Назначение|SSH-адрес для кластера HDInsight. Например, **mycluster-SSH.azurehdinsight.NET**.|
    |Динамический|Включает динамическую маршрутизацию прокси-сервера SOCKS.|

    ![Выводимые параметры туннелирования конфигурации](./media/hdinsight-linux-ambari-ssh-tunnel/hdinsight-putty-tunnel.png)

1. Выберите **Добавить** , чтобы добавить параметры, а затем нажмите кнопку **Открыть** , чтобы открыть SSH-подключение.

1. При появлении запроса войдите на сервер.

## <a name="use-the-tunnel-from-your-browser"></a>Использование туннеля из браузера

> [!IMPORTANT]  
> Для действий, описанных в этом разделе, используется браузер FireFox, так как предоставляет те же параметры прокси-сервера на всех платформах. Для других современных браузеров, например Google Chrome, может потребоваться расширение, например FoxyProxy, для работы с туннелем.

1. Настроить браузер для использования **localhost** и порта, использованного при создании туннеля, в качестве прокси-сервера **SOCKS 5**. Вот как выглядят параметры Firefox. Если используется порт, отличный от 9876, измените номер порта соответствующим образом.

    ![параметры прокси-сервера браузера Firefox](./media/hdinsight-linux-ambari-ssh-tunnel/firefox-proxy-settings.png)

   > [!NOTE]  
   > Если выбрать параметр **Remote DNS** (Удаленная служба DNS), то запросы службы доменных имен (DNS) будут разрешаться с помощью кластера HDInsight. Этот параметр разрешает запросы DNS с помощью головного узла кластера.

2. Убедитесь, что туннель работает, посетив сайт, например [https://www.whatismyip.com/](https://www.whatismyip.com/) . Возвращаемый IP-адрес должен быть адресом, который используется центром обработки данных Microsoft Azure.

## <a name="verify-with-ambari-web-ui"></a>Проверка для веб-интерфейса Ambari

После настройки кластера выполните следующие действия, чтобы удостовериться, что веб-интерфейсы служб доступны из веб-интерфейса Ambari.

1. В браузере перейдите по адресу `http://headnodehost:8080`. Адрес `headnodehost` отправляется через туннель в кластер и разрешается в головном узле, где выполняется Ambari. При появлении запроса введите имя пользователя (admin) и пароль учетной записи администратора кластера. Веб-интерфейс Ambari может потребовать повторного ввода имени пользователя и пароля. В этом случае повторно введите имя пользователя и пароль.

   > [!NOTE]  
   > При использовании адреса `http://headnodehost:8080` для подключения к кластеру вы подключаетесь через туннель. Безопасность обмена данными обеспечивает туннель SSH, а не протокол HTTPS. Чтобы подключиться через Интернет по протоколу HTTPS, используйте `https://clustername.azurehdinsight.net` , где `clustername` — это имя кластера.

2. В веб-интерфейсе Ambari выберите HDFS в списке в левой части страницы.

    ![Выбрана служба Apache Ambari HDFS](./media/hdinsight-linux-ambari-ssh-tunnel/hdfs-service-selected.png)

3. После появления информации о службе HDFS выберите **Быстрые ссылки**. Появится список головных узлов кластера. Выберите один из головных узлов, а затем выберите **NameNode UI**(Пользовательский интерфейс NameNode).

    ![Изображение с развернутым меню "Быстрые ссылки"](./media/hdinsight-linux-ambari-ssh-tunnel/namenode-drop-down-menu.png)

    > [!NOTE]  
    > При выборе меню __Быстрые ссылки__ может появиться индикатор ожидания. Это может произойти, если подключение к Интернету медленное. Подождите одну-две минуты для получения данных с сервера, а затем повторите попытку.
    >
    > Некоторые записи в меню **Быстрые ссылки** могут быть обрезаны правым краем экрана. В этом случае разверните меню с помощью мыши и используйте клавишу со стрелкой вправо, чтобы прокрутить экран вправо и увидеть остальную часть меню.

4. Откроется страница, аналогичная следующей:

    ![Изображение пользовательского интерфейса Hadoop NameNode](./media/hdinsight-linux-ambari-ssh-tunnel/hdinsight-namenode-ui.png)

    > [!NOTE]  
    > URL-адрес для этой страницы должен быть в таком формате: `http://hn1-CLUSTERNAME.randomcharacters.cx.internal.cloudapp.net:8088/cluster`. Этот URI использует полное внутреннее доменное имя узла (FQDN), и он доступен только при использовании туннеля SSH.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как создать и использовать туннель SSH, ознакомьтесь со следующим документом, чтобы узнать о других способах использования Ambari:

* [Управление кластерами HDInsight с помощью веб-интерфейса Apache Ambari](hdinsight-hadoop-manage-ambari.md)
