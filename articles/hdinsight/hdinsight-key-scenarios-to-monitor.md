---
title: Мониторинг производительности кластера в Azure HDInsight
description: Как отслеживать работоспособность и производительность кластеров Apache Hadoop в Azure HDInsight.
author: hrasheed-msft
ms.author: hrasheed
ms.reviewer: jasonh
ms.service: hdinsight
ms.topic: conceptual
ms.custom: hdinsightactive
ms.date: 11/27/2019
ms.openlocfilehash: c6e60474f74a23add429bf13ca7744afb8e8e1a3
ms.sourcegitcommit: 6bb98654e97d213c549b23ebb161bda4468a1997
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/03/2019
ms.locfileid: "74777612"
---
# <a name="monitor-cluster-performance-in-azure-hdinsight"></a>Мониторинг производительности кластера в Azure HDInsight

Мониторинг работоспособности и производительности кластера HDInsight важен для обеспечения оптимальной производительности и эффективного использования ресурсов. Мониторинг может также помочь вам обнаружить и устранить ошибки конфигурации кластера и проблемы с пользовательским кодом.

В следующих разделах описывается, как отслеживать и оптимизировать нагрузку на кластеры, очереди Apache Hadoop YARN и обнаруживать проблемы регулирования хранилища.

## <a name="monitor-cluster-load"></a>Мониторинг загрузки кластера

Кластеры Hadoop могут обеспечить наиболее оптимальную производительность, когда нагрузка на кластер равномерно распределена по всем узлам. Это позволяет избежать ограничения задач обработки из-за нехватки ресурсов ОЗУ, ЦП и дисков на отдельных узлах.

Чтобы получить общий взгляд на узлы кластера и их загрузку, войдите в [веб-интерфейс Ambari](hdinsight-hadoop-manage-ambari.md), а затем выберите вкладку **узлы** . Узлы указываются по полным доменным именам. Состояние каждого узла обозначается цветным индикатором работоспособности.

| Цвет | Описание |
| --- | --- |
| Красный | Как минимум один ведущий компонент на узле не работает. Наведите указатель мыши, чтобы просмотреть подсказку с перечнем затронутых компонентов. |
| Orange | По крайней мере один дополнительный компонент на узле не работает. Наведите указатель мыши, чтобы просмотреть подсказку с перечнем затронутых компонентов. |
| Желтый | Сервер Ambari не получил пульс от узла более 3 минут. |
| Зеленый | Нормальное рабочее состояние. |
 
Вы также увидите столбцы с указанием количества ядер и объема ОЗУ для каждого узла, сведений об использовании дисков и средней загрузки.

![Обзор вкладки "узлы Apache Ambari"](./media/hdinsight-key-scenarios-to-monitor/apache-ambari-hosts-tab.png)

Выберите любое имя узла, чтобы подробное изучить компоненты, работающие на этом узле, и их метрики. Метрики отображаются в виде доступной для выбора временной шкалы использования ЦП, загрузки, использование диска, использование памяти, использование сети и числа процессов.

![Общие сведения об узле Apache Ambari](./media/hdinsight-key-scenarios-to-monitor/apache-ambari-host-details.png)

Подробные сведения о настройке оповещений и просмотре метрик см. в статье [Управление кластерами HDInsight с помощью веб-интерфейса Ambari](hdinsight-hadoop-manage-ambari.md).

## <a name="yarn-queue-configuration"></a>Конфигурация очереди YARN

На распределенной платформе Hadoop выполняются различные службы. YARN (Yet Another Resource Negotiator, что переводится как "Еще одна система управления ресурсами") координирует эти службы, выделяет ресурсы кластера для обеспечения равномерного распределения нагрузки по кластеру.

YARN разделяет две обязанности JobTracker: управление ресурсами и планирование и мониторинг заданий — между двумя управляющими программами: глобальным приложением Resource Manager и приложением ApplicationMaster для каждого приложения (AM).

Resource Manager является *только планировщиком* и единолично управляет доступными ресурсами для всех конкурирующих приложений. Resource Manager обеспечивает постоянное использование всех ресурсов, оптимизируя различные константы, такие как соглашения об уровне обслуживания, гарантии емкости и т. д. ApplicationMaster согласовывает ресурсы, полученные от Resource Manager, и работает с экземплярами NodeManager для выполнения и отслеживания контейнеров и их потребления ресурсов.

Если несколько клиентов совместно используют большой кластер, существует конкуренция за ресурсы кластера. CapacityScheduler является подключаемым планировщиком, который упрощает предоставление общего доступа к ресурсам, ставя запросы в очередь. Кроме того, CapacityScheduler поддерживает *иерархические очереди*, чтобы обеспечить совместное использование ресурсов подочередями организации прежде, чем очереди других приложений смогут использовать свободные ресурсы.

YARN позволяет выделять ресурсы для этих очередей, а также показывает, назначены ли все доступные ресурсы. Чтобы просмотреть сведения об очередях, войдите в пользовательский веб-интерфейс Ambari и в верхнем меню щелкните **YARN Queue Manager** (Диспетчер очередей YARN).

![Диспетчер очереди YARN Apache Ambari](./media/hdinsight-key-scenarios-to-monitor/apache-yarn-queue-manager.png)

В левой части страницы "YARN Queue Manager" (Диспетчер очередей YARN) отображается список очередей, а также назначенный каждой из них процент емкости.

![Страница сведений диспетчера очередей YARN](./media/hdinsight-key-scenarios-to-monitor/yarn-queue-manager-details.png)

Чтобы более подробно изучить очереди, на панели мониторинга Ambari из списка слева выберите службу **YARN**. Затем из раскрывающегося меню **Quick Links** (Быстрые ссылки) выберите **Resource Manager UI** (Пользовательский интерфейс Resource Manager) под активным узлом.

![Ссылки на меню пользовательского интерфейса диспетчер ресурсов](./media/hdinsight-key-scenarios-to-monitor/resource-manager-ui-menu-link.png)

В пользовательском интерфейсе Resource Manager в меню слева выберите **Scheduler** (Планировщик). Список очередей отобразится в разделе *Application Queues* (Очереди приложений). Здесь можно просмотреть емкость, используемую для каждой из очередей, узнать, насколько хорошо задания распределены между ними, и имеются ли задания, которым не хватает ресурсов.

![Меню пользовательского интерфейса диспетчер ресурсов Apache HAdoop](./media/hdinsight-key-scenarios-to-monitor/resource-manager-ui-menu.png)

## <a name="storage-throttling"></a>Регулирование хранилища

Узкое место производительности кластера может возникнуть на уровне хранилища. Этот тип узкого места чаще всего происходит из-за *блокировки* операций ввода-вывода, которые происходят, когда выполняемые задачи отправляют больше операций ввода/вывода, чем служба хранилища может справиться. Эта блокировка приводит к образованию очереди запросов на ввод-вывод, ожидающих обработки после завершения обработки текущих операций ввода-вывода. Блоки обусловлены *регулированием хранилища*, которое не является физическим ограничением, а ограничением, наложенным службой хранилища соглашением об уровне обслуживания (SLA). Это ограничение гарантирует невозможность монополизации службы каким-ибо одним клиентом. Соглашения об уровне обслуживания ограничивает число операций ввода-вывода в секунду (IOPS) для службы хранилища Azure. Дополнительные сведения см. в разделе [Целевые показатели масштабируемости и производительности службы хранилища Azure](https://docs.microsoft.com/azure/storage/storage-scalability-targets).

Если вы используете службу хранилища Azure, дополнительные сведения о мониторинге проблем, связанных с хранилищем, включая регулирование, см. в разделе [мониторинг, диагностика и устранение неполадок служба хранилища Microsoft Azure](https://docs.microsoft.com/azure/storage/storage-monitoring-diagnosing-troubleshooting).

Если резервное хранилище кластера находится Azure Data Lake Storage (ADLS), регулирование скорее всего обусловлено ограничениями пропускной способности. В данном случае регулирование можно заметить, отслеживая ошибки регулирования в журналах задач. Сведения об использовании ADLS приведены в разделе о регулировании для соответствующей службы в следующих статьях:

* [Рекомендации по настройке производительности для Hive в HDInsight и Azure Data Lake Storage](../data-lake-store/data-lake-store-performance-tuning-hive.md)
* [Рекомендации по настройке производительности для MapReduce в HDInsight и Azure Data Lake Storage](../data-lake-store/data-lake-store-performance-tuning-mapreduce.md)
* [Рекомендации по настройке производительности для Storm в HDInsight и Azure Data Lake Storage](../data-lake-store/data-lake-store-performance-tuning-storm.md)

## <a name="next-steps"></a>Дальнейшие действия

Перейдите по следующим ссылкам, чтобы получить дополнительные сведения об устранении неполадок и мониторинге кластеров:

* [Анализ журналов HDInsight](hdinsight-debug-jobs.md)
* [Доступ к журналам приложений Apache Hadoop YARN в HDInsight под управлением Linux](hdinsight-hadoop-access-yarn-app-logs-linux.md)
* [Включение дампов кучи для служб Apache Hadoop в HDInsight под управлением Linux](hdinsight-hadoop-collect-debug-heap-dump-linux.md)
