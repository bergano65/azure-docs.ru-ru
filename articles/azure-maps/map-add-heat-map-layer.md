---
title: Добавление слоя тепловой карт в карту | Карты Microsoft Azure
description: В этой статье вы узнаете, как добавить слой тепловой карты в карту с помощью веб-пакета SDK Microsoft Azure Maps.
author: rbrundritt
ms.author: richbrun
ms.date: 07/29/2019
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: ''
ms.custom: codepen, devx-track-javascript
ms.openlocfilehash: 2558f30c0d2d1e9d652efec1693e7f056426255b
ms.sourcegitcommit: dccb85aed33d9251048024faf7ef23c94d695145
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87282914"
---
# <a name="add-a-heat-map-layer"></a>Добавление слоя тепловой карты

Тепловая карта, которую также называют картой точек плотности, представляет собой тип визуализации данных. Они используются для представления плотности данных с использованием диапазона цветов и отображения «горячих точек» данных на карте. Тепловые карты — это отличный способ отображения наборов данных с большим количеством точек. 

Отрисовка десятков тысяч точек в виде символов может охватывать большую часть области карт. В этом случае, скорее всего, происходит перекрытие нескольких символов. Затрудняете понимание данных. Однако визуализация этого же набора данных в качестве тепловой карт позволяет легко увидеть плотность и относительную плотность каждой точки данных.

Карты рисков можно использовать в различных сценариях, в том числе:

- **Данные температуры**: выводит приблизительные показатели температуры между двумя точками данных.
- **Данные для датчиков шума**. показывает не только интенсивность шума, в которой находится датчик, но также позволяет получить представление о расположении на расстоянии. Уровень шума на одном сайте может быть невысоким. Если область действия шума из нескольких датчиков перекрывается, возможно, эта перекрывающаяся область может иметь более высокие уровни шума. Таким образом, область перекрытия будет видна на тепловой карте.
- **Трассировка GPS**: включает скорость как карту взвешенной высоты, где интенсивность каждой точки данных зависит от скорости. Например, эта функция позволяет узнать, где был ускорен процесс.

> [!TIP]
> По умолчанию уровни тепловой карт отображают координаты всех геометрических объектов в источнике данных. Чтобы ограничить слой таким образом, чтобы он отображал только возможности геометрических точек, установите `filter` для свойства слоя значение `['==', ['geometry-type'], 'Point']` . Если вы хотите включить компоненты MultiPoint, установите `filter` для свойства слоя значение `['any', ['==', ['geometry-type'], 'Point'], ['==', ['geometry-type'], 'MultiPoint']]` .

<br/>

<iframe src="https://channel9.msdn.com/Shows/Internet-of-Things-Show/Heat-Maps-and-Image-Overlays-in-Azure-Maps/player" width="960" height="540" allowFullScreen frameBorder="0"></iframe>

## <a name="add-a-heat-map-layer"></a>Добавление слоя тепловой карты

Для отображения источника данных точек в качестве тепловой карты передайте источник данных в экземпляр `HeatMapLayer` класса и добавьте его на карту.

В следующем коде каждая тепловая точка имеет радиус на 10 пикселей на всех уровнях масштабирования. Чтобы обеспечить лучшую работу пользователей, тепловая схема ниже слоя меток. Метки остаются четко видимыми. Данные в этом примере находятся в [программе USGS землетрясения опасные программы](https://earthquake.usgs.gov/). Он предназначен для значительных землетрясения, произошедших за последние 30 дней.

```javascript
//Create a data source and add it to the map.
var datasource = new atlas.source.DataSource();
map.sources.add(datasource);

//Load a dataset of points, in this case earthquake data from the USGS.
datasource.importDataFromUrl('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_week.geojson');

//Create a heat map and add it to the map.
map.layers.add(new atlas.layer.HeatMapLayer(datasource, null, {
  radius: 10,
  opacity: 0.8
}), 'labels');
```

Ниже приведен полный пример выполнения кода предыдущего кода.

<br/>

<iframe height='500' scrolling='no' title='Простой слой тепловой карты' src='//codepen.io/azuremaps/embed/gQqdQB/?height=500&theme-id=0&default-tab=js,result&embed-version=2&editable=true' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>Изучите фрагмент кода <a href='https://codepen.io/azuremaps/pen/gQqdQB/'>простого слоя тепловой карты</a>, опубликованный для Azure Maps (<a href='https://codepen.io/azuremaps'>@azuremaps</a>) в репозитории <a href='https://codepen.io'>CodePen</a>.
</iframe>

## <a name="customize-the-heat-map-layer"></a>Настройка слоя тепловой карт

В предыдущем примере настройка тепловой карты заключалась в установке параметров радиуса и прозрачности. Слой тепловой карт предоставляет несколько вариантов настройки, включая следующие:

* `radius`: Определяет пиксельный радиус для отрисовки каждой точки данных. Вы можете задать для радиуса фиксированное число или как выражение. С помощью выражения можно масштабировать радиус в зависимости от уровня масштаба и представить единообразную пространственное область на карте (например, радиус 5 км).
* `color`: Указывает, как раскрасить тепловую карту. Цветовой градиент — это общая функция карт рисков. Результат можно добиться с помощью `interpolate` выражения. Можно также использовать `step` выражение для раскрашивания тепловой карт, разбивая его на диапазоны, похожие на карту в виде контура или лепестковой диаграммы. Эти цветовые палитры определяют цвета в диапазоне от минимальной до максимальной плотности. 

  Значения цвета для тепловых карт задаются в виде выражения для `heatmap-density` значения. Цвет области, в которой отсутствуют данные в индексе 0 выражения интерполяции, или цвет по умолчанию для "пошагового" выражения. Это значение можно использовать для определения цвета фона. Часто это значение равно прозрачному или полупрозрачному черному. 
   
  Ниже приведены примеры выражений цвета.

  | Выражение цвета интерполяции | Выражение пошагового цвета | 
  |--------------------------------|--------------------------|
  | \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;'interpolate',<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['linear'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['heatmap-density'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;0, 'transparent',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.01, 'purple',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.5, '#fb00fb',<br/>&nbsp;&nbsp;&nbsp;&nbsp;1, '#00c3ff'<br/>\] | \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;'step',<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['heatmap-density'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;'transparent',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.01, 'navy',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0,25, "зеленый",<br/>&nbsp;&nbsp;&nbsp;&nbsp;0,50, "желтый",<br/>&nbsp;&nbsp;&nbsp;&nbsp;0,75, "красный"<br/>\] |   

- `opacity`: Определяет степень непрозрачности или прозрачности слоя тепловой карт.
- `intensity`: Применяет множитель к весу каждой точки данных, чтобы увеличить общую интенсивность тепловой карты. Это приводит к разнице в весе точек данных, что упрощает визуализацию.
- `weight`: По умолчанию все точки данных имеют вес 1 и имеют одинаковое взвешенное значение. Параметр Weight выступает в качестве множителя, и его можно задать в виде числа или выражения. Если в качестве веса задано число, то это эквивалентное размещение каждой точки данных на карте дважды. Например, если весовой коэффициент равен 2, то плотность удваивается. Фиксированное число в качестве значения параметра weight изменяет тепловую карту точно так же, как изменение параметра intensity. 

  Однако при использовании выражения весовые коэффициенты каждой точки данных могут основываться на свойствах каждой точки данных. Например, предположим, что каждая точка данных представляет землетрясения. Значение величины было важной метрикой для каждой точки данных землетрясения. Землетрясения выполняется все время, но большинство из них имеет низкую величину и не Заметится. Значение величины в выражении используется для назначения веса каждой точке данных. Используя значение величины для назначения веса, вы получаете лучшее представление о значимости землетрясения в тепловой карте.
- `source`и `source-layer` : позволяют обновлять источник данных.

Ниже приведено средство для тестирования различных параметров слоя тепловой карт.

<br/>

<iframe height='700' scrolling='no' title='Параметры слоя тепловой карты' src='//codepen.io/azuremaps/embed/WYPaXr/?height=700&theme-id=0&default-tab=result' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>Просмотрите фрагмент кода с <a href='https://codepen.io/azuremaps/pen/WYPaXr/'>параметрами слоя тепловой карты</a> для службы Azure Maps (<a href='https://codepen.io/azuremaps'>@azuremaps</a>), размещенный в репозитории <a href='https://codepen.io'>CodePen</a>.
</iframe>

## <a name="consistent-zoomable-heat-map"></a>Последовательная тепловая схема масштабируемый

По умолчанию радиусы точек данных, отображаемых на уровне тепловой карт, имеют фиксированный пиксельный радиус для всех уровней масштабирования. По мере масштабирования карт данные объединяются, и слой тепловой карт выглядит иначе. 

Используйте `zoom` выражение для масштабирования радиуса каждого уровня масштаба, чтобы каждая точка данных охватывает одну и ту же физическую область на карте. Это выражение делает внешний вид слоя тепловой карт более статическим и последовательным. Каждый уровень масштаба на карте имеет вдвое больше пикселей по вертикали и горизонтали, чем предыдущий уровень масштаба. 

При масштабировании радиуса, чтобы он вдвое соответствовал каждому уровню масштабирования, создает тепловую карту, которая выглядит единообразно на всех уровнях масштабирования. Чтобы применить это масштабирование, используйте `zoom` с базовым `exponential interpolation` выражением 2 с набором радиуса пикселей для минимального масштаба и масштабируемым радиусом для максимального уровня масштаба, вычисленным как `2 * Math.pow(2, minZoom - maxZoom)` показано в следующем примере. Масштабировать карту, чтобы увидеть, как тепловая схема масштабируется с учетом масштаба.

<br/>

<iframe height="500" style="width: 100%;" scrolling="no" title="Последовательная тепловая схема масштабируемый" src="//codepen.io/azuremaps/embed/OGyMZr/?height=500&theme-id=0&default-tab=js,result&editable=true" frameborder="no" allowtransparency="true" allowfullscreen="true">
См. Azure Maps () на CodePen с помощью <a href='https://codepen.io/azuremaps/pen/OGyMZr/'>масштабируемый</a> ( <a href='https://codepen.io/azuremaps'>@azuremaps</a> ) <a href='https://codepen.io'>CodePen</a>.
</iframe>

> [!TIP]
> При включении кластеризации в источнике данных точки, близкие друг к другу, группируются в виде кластеризованной точки. Количество точек в каждом кластере можно использовать как выражение веса для тепловой карт. Это может значительно сократить количество отображаемых точек. Число точек в кластере хранится в `point_count` свойстве функции Point: 
> ```JavaScript
> var layer = new atlas.layer.HeatMapLayer(datasource, null, {
>    weight: ['get', 'point_count']
> });
> ```
> Если радиус кластеризации составляет всего несколько пикселей, то в отрисовке будет отображаться небольшое визуальное различие. Большая часть радиуса группирует несколько точек в каждый кластер и повышает производительность тепловой карты.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о классах и методах, которые используются в этой статье:

> [!div class="nextstepaction"]
> [HeatMapLayer](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.htmlmarker?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"]
> [HeatMapLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.heatmaplayeroptions?view=azure-iot-typescript-latest)

Дополнительные примеры кода для добавления в карты см. в следующих статьях:

> [!div class="nextstepaction"]
> [Создание источника данных](create-data-source-web-sdk.md)

> [!div class="nextstepaction"]
> [Использование стилистических выражений на основе данных](data-driven-style-expressions-web-sdk.md)
