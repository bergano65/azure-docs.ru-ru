---
title: Проверка подлинности с помощью карт Microsoft Azure
titleSuffix: Azure Maps
description: 'Узнайте о двух способах проверки подлинности запросов в Azure Maps: проверка подлинности с помощью общего ключа и Azure Active Directory (Azure AD).'
author: anastasia-ms
ms.author: v-stharr
ms.date: 07/27/2020
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: philmea
ms.custom: mvc
ms.openlocfilehash: 4a923fd34391137f2064cb338ea180ae3782f5e2
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "88036850"
---
# <a name="authentication-with-azure-maps"></a>Аутентификация в Azure Maps

Azure Maps поддерживает два способа проверки подлинности запросов: Аутентификация с помощью общего ключа и [Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-whatis) . В этой статье описаны методы проверки подлинности, которые помогут вам реализовать Azure Maps служб.

> [!NOTE]
> Чтобы улучшить безопасное взаимодействие с Azure Maps, мы теперь поддерживаем протокол TLS 1,2, и мы исправим поддержку TLS 1,0 и 1,1. Если в настоящее время используется TLS 1. x, оцените готовность TLS 1,2 и разработайте план миграции с помощью тестирования, описанного в статье [решение проблемы tls 1,0](https://docs.microsoft.com/security/solving-tls1-problem).

## <a name="shared-key-authentication"></a>Аутентификация на основе общего ключа

 Первичные и вторичные ключи создаются после создания учетной записи Azure Maps. Рекомендуется использовать первичный ключ в качестве ключа подписки при вызове Azure Maps с проверкой подлинности с помощью общего ключа. Проверка подлинности с помощью общего ключа передает ключ, созданный учетной записью Azure Maps, в службу Azure Maps. Для каждого запроса к Azure Maps службам добавьте *ключ подписки* в качестве параметра в URL-адрес. Вторичный ключ можно использовать в таких сценариях, как изменение ключевых изменений.  

Сведения о просмотре ключей в портал Azure см. в разделе [Управление проверкой подлинности](https://aka.ms/amauthdetails).

> [!TIP]
> В целях безопасности рекомендуется поворачивать первичный и вторичный ключи. Для этого обновите приложение, чтобы использовать вторичный ключ, разверните его, а затем нажмите кнопку цикла/обновления рядом с первичным ключом, чтобы создать первичный ключ. Старый первичный ключ будет отключен. Дополнительные сведения о чередовании ключей см. в статье [Настройка смены ключей и аудита в Azure Key Vault](https://docs.microsoft.com/azure/key-vault/secrets/key-rotation-log-monitoring).

## <a name="azure-ad-authentication"></a>Аутентификация Azure AD

Подписки Azure предоставляются с клиентом Azure AD для обеспечения детального контроля доступа. Azure Maps предлагает проверку подлинности для Azure Maps служб с помощью Azure AD. Azure AD предоставляет проверку подлинности на основе удостоверений для пользователей и приложений, зарегистрированных в клиенте Azure AD.

Azure Maps принимает токены доступа **OAuth 2.0** для клиентов Azure AD с подпиской Azure, которая содержит учетную запись Azure Maps. Azure Maps также принимает маркеры для:

* Пользователи Azure AD
* Партнерские приложения, использующие разрешения, делегированные пользователями
* Управляемые удостоверения для ресурсов Azure

Azure Maps создает *уникальный идентификатор (идентификатор клиента)* для каждой учетной записи Azure Maps. Вы можете запросить токены из Azure AD, если вы объедините этот идентификатор клиента с дополнительными параметрами.

Дополнительные сведения о настройке Azure AD и отправке запросов на получение токенов для Azure Maps см. в статье об [управлении аутентификацией](https://docs.microsoft.com/azure/azure-maps/how-to-manage-authentication).

Общие сведения о проверке подлинности в Azure AD см. в статье [что такое проверка подлинности?](https://docs.microsoft.com/azure/active-directory/develop/authentication-scenarios).

### <a name="managed-identities-for-azure-resources-and-azure-maps"></a>Управляемые удостоверения для ресурсов Azure и Azure Maps

[Управляемые удостоверения для ресурсов Azure](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview) предоставляют службы Azure с автоматически управляемым участником безопасности на основе приложений, который может проходить проверку подлинности в Azure AD. С помощью управления доступом на основе ролей (RBAC) участник безопасности управляемого удостоверения может иметь право доступа к службам Azure Maps. Примеры управляемых удостоверений: служба приложений Azure, функции Azure и виртуальные машины Azure. Список управляемых удостоверений см. в статье [управляемые удостоверения для ресурсов Azure](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities).

### <a name="configuring-application-azure-ad-authentication"></a>Настройка проверки подлинности приложения Azure AD

Приложения будут проходить проверку подлинности в клиенте Azure AD с помощью одного или нескольких поддерживаемых сценариев, предоставляемых Azure AD. Каждый сценарий приложения Azure AD представляет различные требования в зависимости от бизнес-потребностей. Для некоторых приложений может потребоваться вход пользователя в систему, а для работы других приложений может потребоваться вход в приложение. Дополнительные сведения см. в разделе [потоки проверки подлинности и сценарии приложений](https://docs.microsoft.com/azure/active-directory/develop/authentication-flows-app-scenarios).

После того как приложение получит маркер доступа, пакет SDK и/или приложение отправляет HTTPS-запрос со следующим набором обязательных HTTP-заголовков в дополнение к другим REST API заголовкам HTTP:

| Имя заголовка    | Значение               |
| :------------- | :------------------ |
| x-ms-client-id | 30d7cc….9f55        |
| Авторизация  | Bearer eyJ0e….HNIVN |

> [!NOTE]
> `x-ms-client-id` — это GUID Azure Maps на основе учетных записей, который отображается на странице проверки подлинности службы Azure Maps.

Ниже приведен пример запроса маршрута Azure Maps, который использует токен носителя Azure AD OAuth:

```http
GET /route/directions/json?api-version=1.0&query=52.50931,13.42936:52.50274,13.43872
Host: atlas.microsoft.com
x-ms-client-id: 30d7cc….9f55
Authorization: Bearer eyJ0e….HNIVN
```

Сведения о просмотре идентификатора клиента см. в разделе [Просмотр сведений об аутентификации](https://aka.ms/amauthdetails).

## <a name="authorization-with-role-based-access-control"></a>Авторизация с помощью управления доступом на основе ролей

Azure Maps поддерживает доступ ко всем типам участников для [управления доступом на основе ролей Azure (Azure RBAC)](https://docs.microsoft.com/azure/role-based-access-control/overview) , включая отдельных пользователей Azure AD, группы, приложения, ресурсы Azure и управляемые удостоверения Azure. Типам субъектов предоставляется набор разрешений, также известных как определение роли. Определение роли предоставляет разрешения на REST API действий. Применение доступа к одной или нескольким учетным записям Azure Maps называется областью. При применении участника, определения роли и области создается назначение роли. 

В следующих разделах обсуждаются основные понятия и компоненты Azure Maps интеграции с контролем доступа на основе ролей Azure AD. В рамках процесса настройки учетной записи Azure Maps каталог Azure AD связывается с подпиской Azure, в которой находится учетная запись Azure Maps. 

При настройке Azure RBAC вы выбираете субъект безопасности и применяете его к назначению роли. Дополнительные сведения о добавлении назначений ролей в портал Azure см. в статье [Добавление и удаление назначений ролей Azure](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal).

### <a name="picking-a-role-definition"></a>Выбор определения роли

Для поддержки сценариев приложений существуют следующие типы определений ролей.

| Определение роли Azure       | Описание                                                                                              |
| :-------------------------- | :------------------------------------------------------------------------------------------------------- |
| Читатель данных Azure Maps      | Предоставляет доступ к неизменяемым Azure Maps API-интерфейсам RESTFUL.                                                       |
| Участник данных Azure Maps | Предоставляет доступ к изменяемым Azure Maps API-интерфейсам RESTFUL. Изменяемость определяется действиями: Write и DELETE. |
| Определение пользовательской роли      | Создайте специальную роль, чтобы предоставить гибкому ограниченный доступ к Azure Maps интерфейсам API-интерфейса RESTFUL.                      |

Некоторым службам Azure Maps может потребоваться повышенный уровень привилегий для выполнения действий записи или удаления в Azure Maps интерфейсах API служб. Для служб, предоставляющих действия записи или удаления, требуется Azure Maps роль участника данных. В следующей таблице описано, какие службы Azure Maps участник данных применимы при использовании действий записи или удаления для данной службы. Если в службе используются только операции чтения, Azure Maps можно использовать модуль чтения данных вместо участника данных Azure Maps.

| Служба Azure Maps | Определение роли Azure Maps  |
| :----------------- | :-------------------------- |
| Данные               | Участник данных Azure Maps |
| Автор            | Участник данных Azure Maps |
| Пространственные данные            | Участник данных Azure Maps |

Сведения о просмотре параметров RBAC см. в статье [Управление аутентификацией в Azure Maps](https://aka.ms/amrbac).

#### <a name="custom-role-definitions"></a>Пользовательские определения ролей

Одним из аспектов безопасности приложения является применение принципа наименьших привилегий. Этот принцип предполагает, что субъекту безопасности следует разрешить только необходимый доступ и не иметь дополнительных прав доступа. Создание пользовательских определений ролей может поддерживать варианты использования, требующие дополнительной детализации для контроля доступа. Чтобы создать определение пользовательской роли, можно выбрать определенные действия с данными, которые следует включить в определение или исключить из него.

Затем пользовательское определение роли можно использовать в назначении ролей любому субъекту безопасности. Дополнительные сведения об определениях пользовательских ролей Azure см. в статье [пользовательские роли Azure](https://docs.microsoft.com/azure/role-based-access-control/custom-roles).

Ниже приведено несколько примеров сценариев, в которых пользовательские роли могут улучшить безопасность приложений.

| Сценарий                                                                                                                                                                                                                 | Действия с данными настраиваемой роли                                                                                                                  |
| :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------ |
| Общедоступная или интерактивная веб-страница входа с плитками базовых карт и без других интерфейсов API.                                                                                                                              | `Microsoft.Maps/accounts/services/render/read`                                                                                              |
| Приложение, для которого требуется только обратная геокодирование, без других интерфейсов API для интерфейса RESTFUL.                                                                                                                                             | `Microsoft.Maps/accounts/services/search/read`                                                                                              |
| Роль для субъекта безопасности, запрашивающего чтение Azure Maps данных карты на основе создателя и интерфейсов API RESTFUL плитки базовой карты.                                                                                                 | `Microsoft.Maps/accounts/services/data/read`, `Microsoft.Maps/accounts/services/render/read`                                                |
| Роль для субъекта безопасности, требующая чтение, запись и удаление данных карт на основе создателя. Это может быть определено как роль редактора данных Map, но не разрешает доступ к другим API-интерфейсам, таким как плитка базовой схемы. | `Microsoft.Maps/accounts/services/data/read`, `Microsoft.Maps/accounts/services/data/write`, `Microsoft.Maps/accounts/services/data/delete` |

### <a name="understanding-scope"></a>Основные сведения об области

При создании назначения роли она определяется в иерархии ресурсов Azure. В верхней части иерархии находится [Группа управления](https://docs.microsoft.com/azure/governance/management-groups/overview) , а самая низкая — ресурс Azure, например учетная запись Azure Maps.
Назначение роли группе ресурсов может обеспечить доступ к нескольким Azure Maps учетным записям или ресурсам в группе.

> [!TIP]
> Общей рекомендацией корпорации Майкрософт является назначение доступа к области учетной записи Azure Maps, так как она предотвращает **непреднамеренное обращение к другим учетным записям Azure Maps** , существующим в той же подписке Azure.

## <a name="next-steps"></a>Дальнейшие шаги

Дополнительные сведения о RBAC см. в разделе
> [!div class="nextstepaction"]
> [Управление доступом на основе ролей](https://docs.microsoft.com/azure/role-based-access-control/overview)

Дополнительные сведения о проверке подлинности приложения с помощью Azure AD и Azure Maps см. в разделе
> [!div class="nextstepaction"]
> [Управление аутентификацией в Azure Maps](https://docs.microsoft.com/azure/azure-maps/how-to-manage-authentication)

Дополнительные сведения о проверке подлинности Azure Maps Map Control в Azure AD см. в разделе
> [!div class="nextstepaction"]
> [Использование библиотеки Map Control в службе Azure Maps](https://aka.ms/amaadmc)
