---
title: Руководство по Создание геозоны и отслеживание устройств в Azure Maps
description: Сведения о настройке геозоны. Узнайте, как отслеживать положение устройств относительно геозон, с помощью пространственной службы Azure Maps.
author: anastasia-ms
ms.author: v-stharr
ms.date: 8/11/2020
ms.topic: tutorial
ms.service: azure-maps
services: azure-maps
manager: philmea
ms.custom: mvc
ms.openlocfilehash: b374bbe086281c7f7914334be6ca275f0fd05b7f
ms.sourcegitcommit: 814778c54b59169c5899199aeaa59158ab67cf44
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2020
ms.locfileid: "90056515"
---
# <a name="tutorial-set-up-a-geofence-by-using-azure-maps"></a>Руководство по Настройка геозоны с использованием Azure Maps

В этом руководстве показано, как создавать и использовать службы геозон в Azure Maps. Эти инструкции применимы для следующего сценария:

*Руководителю строительного объекта нужно отслеживать оборудование, которое пересекает периметр строительной зоны в любую сторону. Всякий раз, когда оборудование прибывает в зону или покидает ее, руководителю отправляется уведомление по электронной почте.*

Azure Maps предоставляет несколько служб, которые помогут отслеживать оборудование, прибывающее в зону строительства и покидающее ее. Изучив это руководство, вы:

> [!div class="checklist"]
> * Отправка [данных о геозонах в формате GeoJSON](geofence-geojson.md), которые определяют отслеживаемый строительный объект. Вы примените [API отправки данных](https://docs.microsoft.com/rest/api/maps/data/uploadpreview) для передачи геозон в виде координат многоугольника в учетную запись Azure Maps.
> * Настройка двух активируемых [приложений логики](https://docs.microsoft.com/azure/event-grid/handler-webhooks#logic-apps), которые отправляют по электронной почте уведомления руководителю строительного объекта при пересечении оборудованием границ геозоны.
> * Применение [Сетки событий Azure](https://docs.microsoft.com/azure/event-grid/overview) для подписки на события входа в геозону Azure Maps и выхода из нее. Вы настроите две подписки для событий веб-перехватчиков, которые вызывают конечные точки HTTP, определенные в этих двух приложениях логики. После этого Logic Apps будет отправлять уведомления по электронной почте о входе оборудования в геозону и выходе из нее.
> * Применение [API поиска по геозоне](https://docs.microsoft.com/rest/api/maps/spatial/getgeofence) для получения уведомлений о пересечении оборудованием границ геозоны.

## <a name="prerequisites"></a>Предварительные требования

1. [Создайте учетную запись службы Azure Maps.](quick-demo-map-app.md#create-an-azure-maps-account)
2. [Получите первичный ключ подписки](quick-demo-map-app.md#get-the-primary-key-for-your-account), который иногда называется первичным ключом или ключом подписки.

В этом учебнике используется приложение [Postman](https://www.postman.com/), но вы можете выбрать другую среду разработки API.

## <a name="upload-geofencing-geojson-data"></a>Отправка данных о геозоне в формате GeoJSON

В этом руководстве показано, как отправить данные о геозоне в формате JSON с коллекцией `FeatureCollection`. `FeatureCollection` определяет две геозоны в виде многоугольников на строительном объекте. Для первой геозоны какие-либо ограничения, включая временные, отсутствуют. Вторую можно запрашивать только в рабочее время (с 9:00 до 17:00 по тихоокеанскому времени), и с 1 января 2022 г. она не будет недействительна. См. сведения о [формате данных GeoJSON](geofence-geojson.md).

>[!TIP]
>Вы можете в любое время изменить сведения о геозонах. Дополнительные сведения см. в статье об [API отправки данных](https://docs.microsoft.com/rest/api/maps/data/uploadpreview).

1. Откройте приложение Postman. В верхней части экрана выберите **New** (Создать). В окне **Create New** (Создание) выберите **Collection** (Коллекция). Присвойте имя коллекции и нажмите кнопку **Create** (Создать).

2. Чтобы создать запрос, нажмите кнопку **Создать** еще раз. В окне **Create New** (Создание) выберите **Request** (Запрос). Введите **Имя запроса** для запроса. Выберите коллекцию, созданную на предыдущем шаге, а затем нажмите кнопку **Сохранить**.

3. Выберите HTTP-метод **POST** на вкладке построителя и введите следующий URL-адрес, чтобы отправить данные о геозоне в Azure Maps. Для этого запроса и других запросов, упомянутых в этой статье, замените `{Azure-Maps-Primary-Subscription-key}` первичным ключом подписки.

    ```HTTP
    https://atlas.microsoft.com/mapData/upload?subscription-key={Azure-Maps-Primary-Subscription-key}&api-version=1.0&dataFormat=geojson
    ```

    Параметр `geojson` в URL-адресе определяет формат отправляемых данных.

4. Выберите вкладку **Body** (Текст). Выберите формат входных данных **raw** (Необработанные) и **JSON**. Скопируйте и вставьте следующие данные GeoJSON в текстовую область **Body** (Текст).

   ```JSON
   {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [
                  -122.13393688201903,
                  47.63829579223815
                ],
                [
                  -122.13389128446579,
                  47.63782047131512
                ],
                [
                  -122.13240802288054,
                  47.63783312249837
                ],
                [
                  -122.13238388299942,
                  47.63829037035086
                ],
                [
                  -122.13393688201903,
                  47.63829579223815
                ]
              ]
            ]
          },
          "properties": {
            "geometryId": "1"
          }
        },
        {
          "type": "Feature",
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [
                  -122.13374376296996,
                  47.63784758098976
                ],
                [
                  -122.13277012109755,
                  47.63784577367854
                ],
                [
                  -122.13314831256866,
                  47.6382813338708
                ],
                [
                  -122.1334782242775,
                  47.63827591198201
                ],
                [
                  -122.13374376296996,
                  47.63784758098976
                ]
              ]
            ]
          },
          "properties": {
            "geometryId": "2",
            "validityTime": {
            "expiredTime": "2022-01-01T00:00:00",
            "validityPeriod": [
                {
                  "startTime": "2020-07-15T16:00:00",
                  "endTime": "2020-07-15T24:00:00",
                  "recurrenceType": "Daily",
                  "recurrenceFrequency": 1,
                  "businessDayOnly": true
                }
              ]
            }
          }
        }
      ]
   }
   ```

5. Нажмите **Send** (Отправить) и дождитесь обработки запроса. После завершения запроса перейдите на вкладку **Headers** (Заголовки) ответа. Скопируйте значение ключа **Расположение**, который является `status URL`.

    ```http
    https://atlas.microsoft.com/mapData/operations/<operationId>?api-version=1.0
    ```

6. Чтобы проверить состояние вызова API, создайте HTTP-запрос **GET** по `status URL`. Вам потребуется добавить первичный ключ подписки к URL-адресу для проверки подлинности. Запрос **GET** должен быть похож на следующий URL-адрес.

   ```HTTP
   https://atlas.microsoft.com/mapData/<operationId>/status?api-version=1.0&subscription-key={Subscription-key}
   ```

7. Когда HTTP-запрос **GET** завершается успешно, он возвращает `resourceLocation`. `resourceLocation` содержит уникальное значение `udid` для переданного содержимого. Сохраните это значение `udid`, чтобы вы могли отправлять запросы к API получения геозоны, как показано в последнем разделе этого руководства. Также вы можете использовать URL-адрес `resourceLocation`, чтобы получить метаданные из этого ресурса на следующем шаге.

      ```json
      {
          "status": "Succeeded",
          "resourceLocation": "https://atlas.microsoft.com/mapData/metadata/{udid}?api-version=1.0"
      }
      ```

8. Чтобы получить метаданные содержимого, создайте HTTP-запрос **GET** по URL-адресу `resourceLocation`, который вы получили на шаге 7. Не забудьте добавить первичный ключ подписки к этому URL-адресу для проверки подлинности. Запрос **GET** должен быть похож на следующий URL-адрес.

    ```http
   https://atlas.microsoft.com/mapData/metadata/{udid}?api-version=1.0&subscription-key={Azure-Maps-Primary-Subscription-key}
    ```

9. После успешного выполнения HTTP-запроса **GET** текст ответа будет содержать значение `udid`, указанное в `resourceLocation` на шаге 7. Он также будет содержать расположение для доступа к содержимому и его загрузки в будущем, а также другие метаданные, связанные с этим содержимым. Пример общего ответа:

    ```json
    {
        "udid": "{udid}",
        "location": "https://atlas.microsoft.com/mapData/{udid}?api-version=1.0",
        "created": "7/15/2020 6:11:43 PM +00:00",
        "updated": "7/15/2020 6:11:45 PM +00:00",
        "sizeInBytes": 1962,
        "uploadStatus": "Completed"
    }
    ```

## <a name="create-workflows-in-azure-logic-apps"></a>Создание рабочих процессов в Azure Logic Apps

Далее будет показано, как создать две конечные точки [приложения логики](https://docs.microsoft.com/azure/event-grid/handler-webhooks#logic-apps), которые будут отправлять уведомления по электронной почте. Вот как создать первую из них:

1. Войдите на [портал Azure](https://portal.azure.com).

2. В верхнем левом углу окна портала Azure щелкните **Создать ресурс**.

3. В поле **Поиск по Marketplace** введите **Приложение логики**.

4. В списке результатов выберите **Приложение логики** > **Создать**.

5. На странице **Приложение логики** укажите следующее:
    * **Подписка** для этого приложения логики.
    * **Группа ресурсов** для этого приложения логики. Вы можете **создать новую** или **использовать существующую** группу ресурсов.
    * **Имя приложения логики**. В этом примере используется имя `Equipment-Enter`.

    Для работы с этим руководством оставьте значения по умолчанию для всех остальных параметров.

    :::image type="content" source="./media/tutorial-geofence/logic-app-create.png" alt-text="Снимок экрана страницы создания приложения логики.":::

6. Выберите **Review + Create** (Просмотреть и создать). Проверьте параметры и выберите **Создать**, чтобы отправить развертывание. Когда развертывание успешно завершится, щелкните **Перейти к ресурсу**. Вы перейдете в **Конструктор приложений логики**.

7. Выберите тип триггера. Прокрутите страницу вниз до раздела **Начинаем с часто используемого триггера**. Выберите **При получении HTTP-запроса**.

     :::image type="content" source="./media/tutorial-geofence/logic-app-trigger.png" alt-text="Снимок экрана страницы создания приложения логики.":::

8. В правом верхнем углу конструктора приложений логики выберите **Сохранить**. Будет автоматически создан **URL-адрес HTTP-запроса POST**. Сохраните URL-адрес — Он понадобится для создания конечной точки события в следующем разделе.

    :::image type="content" source="./media/tutorial-geofence/logic-app-httprequest.png" alt-text="Снимок экрана страницы создания приложения логики.":::

9. Выберите **+ Новый шаг**. Теперь необходимо выбрать нужное действие. Введите `outlook.com email` в поле поиска. Прокрутите список **Действия** вниз и щелкните **Отправка электронной почты (V2)** .
  
    :::image type="content" source="./media/tutorial-geofence/logic-app-designer.png" alt-text="Снимок экрана страницы создания приложения логики.":::

10. Войдите в учетную запись Outlook. Выберите **Да**, чтобы разрешить приложению логики доступ к этой учетной записи. Заполните поля для отправки сообщения электронной почты.

    :::image type="content" source="./media/tutorial-geofence/logic-app-email.png" alt-text="Снимок экрана страницы создания приложения логики.":::

    >[!TIP]
    > В уведомлениях по электронной почте можно получить данные ответов GeoJSON, например `geometryId` или `deviceId`. В Logic Apps можно настроить чтение данных, отправляемых службой "Сетка событий". Сведения о том, как настроить в приложении логики получение данных о событиях и их передачу в уведомлениях по электронной почте, см. в этом учебнике[: Отправка уведомлений электронной почты о событиях в Центре Интернета вещей Azure с помощью Сетки событий и Logic Apps](https://docs.microsoft.com/azure/event-grid/publish-iot-hub-events-to-logic-apps).

11. В левом верхнем углу конструктора приложений логики выберите **Сохранить**.

Чтобы создать второе приложение логики для информирования руководителя о выходе оборудования из строительной зоны, повторите шаги 3–11. Присвойте этому приложению логики имя `Equipment-Exit`.

## <a name="create-azure-maps-events-subscriptions"></a>Создание подписок на события Azure Maps

Azure Maps поддерживает [три типа событий](https://docs.microsoft.com/azure/event-grid/event-schema-azure-maps). В данном случае вам нужно создать две разные подписки на события: для событий входа в геозону и событий выхода из нее.

В следующих инструкциях показано, как создать подписку на события поступления оборудования в геозону. Создать подписку на события выхода оборудования из геозоны можно аналогичным образом.

1. Перейдите в учетную запись Azure Maps. На панели мониторинга выберите **Подписки**. Выберите имя нужной подписки и выберите **События** в меню параметров.

    :::image type="content" source="./media/tutorial-geofence/events-tab.png" alt-text="Снимок экрана страницы создания приложения логики.":::

2. Чтобы создать подписку на события, выберите **Подписка на события** на странице событий.

    :::image type="content" source="./media/tutorial-geofence/create-event-subscription.png" alt-text="Снимок экрана страницы создания приложения логики.":::

3. На странице **Создание подписки на события** укажите следующее:
    * **Имя** для этой подписки на события.
    * В поле **Схема события** выберите *Схема Сетки событий*.
    * **Имя системного раздела** для этой подписки на события (в данном случае это `Contoso-Construction`).
    * В **фильтре по типам событий** выберите тип события `Geofence Entered`.
    * В поле **Тип конечной точки** выберите `Web Hook`.
    * В поле **Конечная точка** вставьте URL-адрес созданной на предыдущем шаге конечной точки HTTP-запроса POST из приложения логики для событий входа, который вы получили ранее. Если вы забыли сохранить это значение, просто переключитесь в окно конструктора приложений логики и скопируйте адрес из шага создания триггера HTTP.

    :::image type="content" source="./media/tutorial-geofence/events-subscription.png" alt-text="Снимок экрана страницы создания приложения логики.":::

4. Нажмите кнопку **создания**.

Повторите шаги 1–4 для конечной точки приложения логики для событий входа, созданной, как описано в предыдущем разделе. Но теперь на шаге 3 выберите тип события `Geofence Exited`.

## <a name="use-spatial-geofence-get-api"></a>Использование API определения пространственной геозоны

Используйте [API определения пространственной геозоны](https://docs.microsoft.com/rest/api/maps/spatial/getgeofence) для отправки уведомлений по электронной почте руководителю строительного объекта о том, что элемент оборудования входит в границы геозоны или покидает ее.

Каждый элемент оборудования имеет `deviceId`. В этом примере будет отслеживаться только один элемент оборудования с уникальным идентификатором `device_1`.

На следующей схеме представлены пять расположений этого элемента оборудования с течением времени, начиная с позиции *Начало*, которая не входит в пределы наших геозон. Для работы с этим руководством мы не отправляем запрос к устройству в расположении *Начало*, поэтому это расположение не определено.

При отправке запроса [API определения пространственной геозоны](https://docs.microsoft.com/rest/api/maps/spatial/getgeofence) с новым расположением оборудования, которое соответствует первому входу оборудования в зону или выходу из нее, Сетка событий вызовет соответствующую конечную точку приложения логики, чтобы отправить руководителю уведомление строительного объекта по электронной почте.

Каждая из следующих секций выполняет запрос к API с разными координатами расположения оборудования.

![Схема карты геозоны в Azure Maps](./media/tutorial-geofence/geofence.png)

### <a name="equipment-location-1-47638237-122132483"></a>Расположение оборудования 1 (47,638237,-122,132483)

1. В верхней части приложения Postman выберите элемент **Создать**. В окне **Create New** (Создание) выберите **Request** (Запрос). Введите **Имя запроса** для запроса. Назначьте его *расположением 1*. Выберите коллекцию, созданную в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data) и щелкните **Save** (Сохранить).

2. Выберите HTTP-метод **GET** на вкладке конструктора и введите следующий URL-адрес. Обязательно замените `{Azure-Maps-Primary-Subscription-key}` значением первичного ключа подписки, а `{udid}` — значением `udid`, которое вы сохранили при прохождении раздела [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data).

   ```HTTP
   https://atlas.microsoft.com/spatial/geofence/json?subscription-key={subscription-key}&api-version=1.0&deviceId=device_01&udid={udid}&lat=47.638237&lon=-122.1324831&searchBuffer=5&isAsync=True&mode=EnterAndExit
   ```

3. Нажмите кнопку **Отправить**. В окне ответа появится следующий текст в формате GeoJSON.

    ```json
    {
      "geometries": [
        {
          "deviceId": "device_1",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "1",
          "distance": -999.0,
          "nearestLat": 47.638291,
          "nearestLon": -122.132483
        },
        {
          "deviceId": "device_1",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "2",
          "distance": 999.0,
          "nearestLat": 47.638053,
          "nearestLon": -122.13295
        }
      ],
      "expiredGeofenceGeometryId": [],
      "invalidPeriodGeofenceGeometryId": [],
      "isEventPublished": true
    }
    ```

В предыдущем ответе GeoJSON отрицательное значение расстояния от основной геозоны объекта означает, что оборудование находится в этой геозоне. Положительное значение расстояния от дочерней геозоны означает, что оборудование находится за пределами этой геозоны. Так как это устройство впервые оказалось внутри главного сайта геозоны, для параметра `isEventPublished` задано значение `true`. Руководитель строительного объекта получает уведомление по электронной почте о том, что оборудование вошло в геозону.

### <a name="location-2-4763800-122132531"></a>Расположение 2 (47,63800,-122,132531)

1. В верхней части приложения Postman выберите элемент **Создать**. В окне **Create New** (Создание) выберите **Request** (Запрос). Введите **Имя запроса** для запроса. Назначьте его *расположением 2*. Выберите коллекцию, созданную в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data) и щелкните **Save** (Сохранить).

2. Выберите HTTP-метод **GET** на вкладке конструктора и введите следующий URL-адрес. Обязательно замените `{Azure-Maps-Primary-Subscription-key}` значением первичного ключа подписки, а `{udid}` — значением `udid`, которое вы сохранили при прохождении раздела [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data).

   ```HTTP
   https://atlas.microsoft.com/spatial/geofence/json?subscription-key={subscription-key}&api-version=1.0&deviceId=device_01&udId={udId}&lat=47.63800&lon=-122.132531&searchBuffer=5&isAsync=True&mode=EnterAndExit
   ```

3. Нажмите кнопку **Отправить**. В окне ответа появится следующий текст в формате GeoJSON:

    ```json
    {
      "geometries": [
        {
          "deviceId": "device_01",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "1",
          "distance": -999.0,
          "nearestLat": 47.637997,
          "nearestLon": -122.132399
        },
        {
          "deviceId": "device_01",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "2",
          "distance": 999.0,
          "nearestLat": 47.63789,
          "nearestLon": -122.132809
        }
      ],
      "expiredGeofenceGeometryId": [],
      "invalidPeriodGeofenceGeometryId": [],
      "isEventPublished": false
    }
    ````

В предыдущем ответе GeoJSON видно, что оборудование оставалось в основной геозоне объекта и не входило в дополнительную геозону. Поэтому параметр `isEventPublished` получит значение `false`, и уведомление руководителю строительного объекта не будет отправлено по электронной почте.

### <a name="location-3-4763810783315048-12213336020708084"></a>Расположение 3 (47,63810783315048,-122,13336020708084)

1. В верхней части приложения Postman выберите элемент **Создать**. В окне **Create New** (Создание) выберите **Request** (Запрос). Введите **Имя запроса** для запроса. Назначьте его *расположением 3*. Выберите коллекцию, созданную в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data) и щелкните **Save** (Сохранить).

2. Выберите HTTP-метод **GET** на вкладке конструктора и введите следующий URL-адрес. Обязательно замените `{Azure-Maps-Primary-Subscription-key}` значением первичного ключа подписки, а `{udid}` — значением `udid`, которое вы сохранили при прохождении раздела [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data).

    ```HTTP
      https://atlas.microsoft.com/spatial/geofence/json?subscription-key={subscription-key}&api-version=1.0&deviceId=device_01&udid={udid}&lat=47.63810783315048&lon=-122.13336020708084&searchBuffer=5&isAsync=True&mode=EnterAndExit
      ```

3. Нажмите кнопку **Отправить**. В окне ответа появится следующий текст в формате GeoJSON:

    ```json
    {
      "geometries": [
        {
          "deviceId": "device_01",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "1",
          "distance": -999.0,
          "nearestLat": 47.638294,
          "nearestLon": -122.133359
        },
        {
          "deviceId": "device_01",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "2",
          "distance": -999.0,
          "nearestLat": 47.638161,
          "nearestLon": -122.133549
        }
      ],
      "expiredGeofenceGeometryId": [],
      "invalidPeriodGeofenceGeometryId": [],
      "isEventPublished": true
    }
    ````

В предыдущем ответе GeoJSON видно, что оборудование оставалось в основной геозоне объекта, но вошло в дополнительную геозону. В результате для параметра `isEventPublished` будет задано значение `true`. Руководитель строительного объекта получает уведомление по электронной почте о том, что оборудование вошло в геозону.

>[!NOTE]
>Если оборудование переходит в дополнительную геозону в нерабочее время, событие не публикуется и руководитель не получает уведомлений.  

### <a name="location-4-47637988-1221338344"></a>Расположение 4 (47,637988,-122,1338344)

1. В верхней части приложения Postman выберите элемент **Создать**. В окне **Create New** (Создание) выберите **Request** (Запрос). Введите **Имя запроса** для запроса. Назначьте его *расположением 4*. Выберите коллекцию, созданную в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data) и щелкните **Save** (Сохранить).

2. Выберите HTTP-метод **GET** на вкладке конструктора и введите следующий URL-адрес. Обязательно замените `{Azure-Maps-Primary-Subscription-key}` значением первичного ключа подписки, а `{udid}` — значением `udid`, которое вы сохранили при прохождении раздела [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data).

    ```HTTP
    https://atlas.microsoft.com/spatial/geofence/json?subscription-key={subscription-key}&api-version=1.0&deviceId=device_01&udid={udid}&lat=47.637988&userTime=2023-01-16&lon=-122.1338344&searchBuffer=5&isAsync=True&mode=EnterAndExit
    ```

3. Нажмите кнопку **Отправить**. В окне ответа появится следующий текст в формате GeoJSON:

    ```json
    {
      "geometries": [
        {
          "deviceId": "device_01",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "1",
          "distance": -999.0,
          "nearestLat": 47.637985,
          "nearestLon": -122.133907
        }
      ],
      "expiredGeofenceGeometryId": [
        "2"
      ],
      "invalidPeriodGeofenceGeometryId": [],
      "isEventPublished": false
    }
    ````

В предыдущем ответе GeoJSON видно, что оборудование оставалось в основной геозоне объекта, но вышло из дополнительной геозоны. Однако обратите внимание, что значение `userTime` превышает значение `expiredTime`, определенное в данных о геозоне. Поэтому параметр `isEventPublished` получает значение `false`, и уведомление по электронной почте руководителю не отправляется.

### <a name="location-547637988-1221338344"></a>Расположение 5(47,637988,-122,1338344)

1. В верхней части приложения Postman выберите элемент **Создать**. В окне **Create New** (Создание) выберите **Request** (Запрос). Введите **Имя запроса** для запроса. Назначьте его *расположением 5*. Выберите коллекцию, созданную в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data) и щелкните **Save** (Сохранить).

2. Выберите HTTP-метод **GET** на вкладке конструктора и введите следующий URL-адрес. Обязательно замените `{Azure-Maps-Primary-Subscription-key}` значением первичного ключа подписки, а `{udid}` — значением `udid`, которое вы сохранили при прохождении раздела [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data).

    ```HTTP
    https://atlas.microsoft.com/spatial/geofence/json?subscription-key={subscription-key}&api-version=1.0&deviceId=device_01&udid={udid}&lat=47.637988&lon=-122.1338344&searchBuffer=5&isAsync=True&mode=EnterAndExit
    ```

3. Нажмите кнопку **Отправить**. В окне ответа появится следующий текст в формате GeoJSON:

    ```json
    {
      "geometries": [
      {
        "deviceId": "device_01",
        "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
        "geometryId": "1",
        "distance": -999.0,
        "nearestLat": 47.637985,
        "nearestLon": -122.133907
      },
      {
        "deviceId": "device_01",
        "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
        "geometryId": "2",
        "distance": 999.0,
        "nearestLat": 47.637945,
        "nearestLon": -122.133683
      }
      ],
      "expiredGeofenceGeometryId": [],
      "invalidPeriodGeofenceGeometryId": [],
      "isEventPublished": true
    }
    ````

В предыдущем ответе GeoJSON видно, что оборудование покинуло основную геозону объекта. Это означает, что параметр `isEventPublished` получает значение `true`, и руководителю строительного объекта будет отправлено по электронной почте уведомление о том, что оборудование вышло из геозоны.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Обработка типов содержимого в Azure Logic Apps](https://docs.microsoft.com/azure/logic-apps/logic-apps-content-type)

> [!div class="nextstepaction"]
> [Руководство по отправке уведомлений электронной почты о событиях в Центре Интернета вещей Azure с помощью Сетки событий и Logic Apps](https://docs.microsoft.com/azure/event-grid/publish-iot-hub-events-to-logic-apps)

> [!div class="nextstepaction"]
> [Поддерживаемые обработчики событий в Сетке событий](https://docs.microsoft.com/azure/event-grid/event-handlers)
