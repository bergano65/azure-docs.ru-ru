---
title: Поиск расположения с помощью служб поиска Azure Maps
description: Сведения о службе поиска Azure Maps. См. раздел Использование этого набора API для геокодирования, обратная кодировка, Поиск нечетких запросов и обратные поиски в разных улицы.
author: anastasia-ms
ms.author: v-stharr
ms.date: 10/05/2020
ms.topic: how-to
ms.service: azure-maps
services: azure-maps
manager: philmea
ms.openlocfilehash: 00ddb53276c052d538d658f2c40384e86cf72aee
ms.sourcegitcommit: d76108b476259fe3f5f20a91ed2c237c1577df14
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2020
ms.locfileid: "92910990"
---
# <a name="search-for-a-location-using-azure-maps-search-services"></a>Поиск расположения с помощью служб поиска Azure Maps

[Azure Maps служба поиска](/rest/api/maps/search) — это набор интерфейсов API RESTful, предназначенных для поиска адресов, мест и бизнес-вхождений по имени, категории и другим географических сведениям. Помимо поддержки традиционной геокодирования, службы также могут обращаться к геокодированным адресам и перекрестным улиц на основе широт и долгот. Значения широты и долготы, возвращаемые функцией поиска, можно использовать в качестве параметров в других Azure Maps служб, таких как [Route](/rest/api/maps/route) и [weather](/rest/api/maps/weather) Services.


В этой статье вы узнаете, как выполнять следующие задачи.

* Запросите координаты широты и долготы для адреса (расположение геокода адреса) с помощью [API поиска адреса]( https://docs.microsoft.com/rest/api/maps/search/getsearchaddress).
* Поиск адреса или точки интересов (достопримечательности) с помощью [API нечеткого поиска](/rest/api/maps/search/getsearchfuzzy).
* Выполните [обратный поиск адреса](/rest/api/maps/search/getsearchaddressreverse) , чтобы перевести координатное расположение на почтовый адрес.
* Перевод координатного расположения в понятное для человека перекрестное почтовое размещение с помощью [функции поиска обратный крест-адрес](/rest/api/maps/search/getsearchaddressreversecrossstreet).  Чаще всего это необходимо для отслеживания приложений, которые получают канал GPS с устройства или ресурса и хотят понять, где находится координата.

## <a name="prerequisites"></a>Предварительные требования

1. [Создайте учетную запись службы Azure Maps](quick-demo-map-app.md#create-an-azure-maps-account)
2. [Получите первичный ключ подписки](quick-demo-map-app.md#get-the-primary-key-for-your-account), который иногда называется первичным ключом или ключом подписки.

В этом руководстве используется приложение [Postman](https://www.postman.com/), но вы можете выбрать другую среду разработки API.

## <a name="request-latitude-and-longitude-for-an-address-geocoding"></a>Запрос широты и долготы для адреса (геокодирование)

В этом примере мы будем использовать [API-интерфейс получения адреса поиска](/rest/api/maps/search/getsearchaddress) Azure Maps для преобразования адреса в координаты широты и долготы. Этот процесс также называется *геокодированием* . Кроме получения координат, ответ также возвращает подробные свойства адреса, такие как улица, почтовый индекс, орган власти и страна или регион.

>[!TIP]
>Если у вас есть набор адресов для геокодирования, можно использовать [API пакетного поиска POST](/rest/api/maps/search/postsearchaddressbatch) для отправки пакета запросов в одном вызове API.

1. Откройте приложение Postman. В верхней части приложения Postman выберите элемент **Создать** . В окне **Create New** (Создание) выберите **Collection** (Коллекция).  Присвойте имя коллекции и нажмите кнопку **Создать** . Эта коллекция будет использоваться для остальных примеров в этом документе.

2. Чтобы создать запрос, нажмите кнопку **Создать** еще раз. В окне **Create New** (Создание) выберите **Request** (Запрос). Введите **Имя запроса** для запроса. Выберите коллекцию, созданную на предыдущем шаге, а затем нажмите кнопку **Сохранить** .

3. На вкладке Построитель выберите метод **Get** HTTP и введите следующий URL-адрес. В этом запросе мы ищем по определенному адресу: `400 Braod St, Seattle, WA 98109` . Для этого запроса и других запросов, упомянутых в этой статье, замените `{Azure-Maps-Primary-Subscription-key}` первичным ключом подписки.

    ```http
    https://atlas.microsoft.com/search/address/json?&subscription-key={Azure-Maps-Primary-Subscription-key}&api-version=1.0&language=en-US&query=400 Broad St, Seattle, WA 98109
    ```

4. Нажмите синюю кнопку **Отправить** . Текст ответа будет содержать данные для одного расположения.

5. Теперь мы будем искать в адресе несколько возможных расположений. В разделе **params** измените значение `query` параметра на `400 Broad, Seattle` . Нажмите синюю кнопку **Отправить** .

    :::image type="content" source="./media/how-to-search-for-address/search-address.png" alt-text="Поиск адреса":::

6. Затем попробуйте установить `query` ключ в значение `400 Broa` .

7. Нажмите кнопку **Отправить** . Теперь можно увидеть, что ответ содержит ответы из нескольких стран. Чтобы выполнить геосдвиг результатов в соответствующей области для пользователей, всегда добавляйте в запрос как можно больше сведений о местоположении.

## <a name="using-fuzzy-search-api"></a>Использование API нечеткого поиска

API Azure Maps [нечеткий поиск](/rest/api/maps/search/getsearchfuzzy) поддерживает стандартные однострочные и поисковые запросы в свободной форме. Рекомендуется использовать нечеткий API Azure Maps поиска, если пользовательский тип ввода для поискового запроса не известен.  Входные данные запроса могут быть полным или частичным адресом. Это также может быть маркер (достопримечательности), например имя достопримечательности, достопримечательности Category или имя торговой марки. Кроме того, чтобы повысить релевантность результатов поиска, результаты запроса могут быть ограничены координатами и радиусом, или путем определения ограничивающего прямоугольника.

>[!TIP]
>Большинство запросов поиска по умолчанию maxFuzzyLevel = 1 для повышения производительности и уменьшения необычных результатов. Уровни нечеткости можно настроить с помощью `maxFuzzyLevel` параметров или `minFuzzyLevel` . Дополнительные сведения о `maxFuzzyLevel` и полный список всех необязательных параметров см. в разделе [Параметры URI нечеткого поиска](/rest/api/maps/search/getsearchfuzzy#uri-parameters) .

### <a name="search-for-an-address-using-fuzzy-search"></a>Поиск адреса с помощью поиска нечетких соответствий

В этом примере мы будем использовать нечеткий поиск для поиска по всему миру `pizza` .  Затем мы покажем, как выполнить поиск по области определенной страны. Наконец, мы покажем, как использовать координаты координат и RADIUS для определения области поиска в определенной области и ограничения числа возвращаемых результатов.

>[!IMPORTANT]
>Чтобы выполнить геосдвиг результатов в соответствующей области для пользователей, всегда добавляйте как можно больше сведений о расположении. Дополнительные сведения см. в разделе рекомендации [по поиску](how-to-use-best-practices-for-search.md#geobiased-search-results).

1. Откройте приложение POST, щелкните **создать** и выберите **запрос** . Введите **Имя запроса** для запроса. Выберите коллекцию, созданную в предыдущем разделе, или создайте новую, а затем нажмите кнопку **сохранить** .

2. На вкладке Построитель выберите метод **Get** HTTP и введите следующий URL-адрес. Для этого запроса и других запросов, упомянутых в этой статье, замените `{Azure-Maps-Primary-Subscription-key}` первичным ключом подписки.

    ```http
   https://atlas.microsoft.com/search/fuzzy/json?&api-version=1.0&subscription-key={Azure-Maps-Primary-Subscription-key}&language=en-US&query=pizza
    ```

    >[!NOTE]
    >Атрибут _json_ в URL-адресе пути определяет формат ответа. В этой статье для простоты использования и удобочитаемости используется JSON. Чтобы найти другие поддерживаемые форматы ответа, см `format` . Описание параметра в [справочной документации по параметрам URI](/rest/api/maps/search/getsearchfuzzy#uri-parameters).

3. Щелкните **Send** (Отправить), а затем просмотрите текст ответа.

    Неоднозначная строка запроса для "пиццы" вернула 10- [процентный результат](/rest/api/maps/search/getsearchpoi#searchpoiresponse) (достопримечательности) в категориях "Пицца" и "Ресторан". Каждый результат включает такие сведения, как адрес улицы, значения широты и долготы, порт представления и точки входа для расположения. Теперь результаты для этого запроса изменяются и не привязываются ни к одному ссылочному расположению.
  
    На следующем шаге мы будем использовать `countrySet` параметр, чтобы указать только страны или регионы, для которых приложение нуждается в покрытии. Полный список поддерживаемых стран и регионов см. в разделе [Поиск покрытия](./geocoding-coverage.md).

4. Поведение по умолчанию заключается в поиске по всему миру, потенциально возвращая ненужные результаты. Далее мы будем искать пиццу только США. Добавьте `countrySet` ключ в раздел **params** и задайте для него значение `US` . Если задать `countrySet` для ключа значение, `US` результаты будут привязаны к США.

    :::image type="content" source="./media/how-to-search-for-address/search-fuzzy-country.png" alt-text="Поиск адреса":::

    Теперь результаты ограничены кодом страны и запрос возвращает адреса пиццерий в США.

5. Чтобы получить еще более целевой поиск, можно выполнить поиск по области lat./Лон. пара координат. В этом примере мы будем использовать lat./Лон.. Стрелки с пробелом в Сиэтле. Так как нам нужно только вернуть результаты в радиусе 400 метров, мы добавим `radius` параметр. Кроме того, мы добавим `limit` параметр, чтобы ограничить результаты до пяти ближайших мест пиццы.

    В разделе **params** добавьте следующие пары "ключ-значение":

     | Клавиши | Значение |
    |-----|------------|
    | lat | 47,620525 |
    | lon | –122,349274 |
    | radius | 400 |
    | ограничение | 5|

6. Нажмите кнопку **Отправить** . Ответ содержит результаты для ресторанов в пицце рядом с пробелом в Сиэтле.

## <a name="search-for-a-street-address-using-reverse-address-search"></a>Поиск улицы и номера дома с использованием обратного поиска адреса

Функция Azure Maps [получить адрес поиска обратный API]( https://docs.microsoft.com/rest/api/maps/search/getsearchaddressreverse) преобразует координаты в непонятные для человека адреса улицы. Этот API часто используется для приложений, которые используют каналы GPS и хотят находить адреса в конкретных точках координат.

>[!IMPORTANT]
>Чтобы выполнить геосдвиг результатов в соответствующей области для пользователей, всегда добавляйте как можно больше сведений о расположении. Дополнительные сведения см. в разделе рекомендации [по поиску](how-to-use-best-practices-for-search.md#geobiased-search-results).

>[!TIP]
>Если у вас есть набор координатных расположений для обратного геокодирования, можно использовать [обратный поиск адреса API](/rest/api/maps/search/postsearchaddressreversebatch) для отправки пакета запросов в одном вызове API.

В этом примере мы будем выполнять обратный поиск, используя несколько доступных необязательных параметров. Полный список необязательных параметров см. в разделе [Параметры обратных результатов поиска](/rest/api/maps/search/getsearchaddressreverse#uri-parameters).

1. В приложении POST щелкните **создать** и выберите **запрос** . Введите **Имя запроса** для запроса. Выберите коллекцию, созданную в первом разделе, или создайте новую, а затем нажмите кнопку **сохранить** .

2. На вкладке Построитель выберите метод **Get** HTTP и введите следующий URL-адрес. Для этого запроса и других запросов, упомянутых в этой статье, замените `{Azure-Maps-Primary-Subscription-key}` первичным ключом подписки. Запрос должен выглядеть, как в этом URL-адресе:

    ```http
    https://atlas.microsoft.com/search/address/reverse/json?api-version=1.0&subscription-key={Azure-Maps-Primary-Subscription-key}&language=en-US&query=47.591180,-122.332700&number=1
    ```

3. Нажмите кнопку **Отправить** и проверьте текст ответа. Вы должны увидеть один результат запроса. Ответ включает основные сведения об адресе Safeco Field.
  
4. Теперь мы добавим следующие пары "ключ-значение" в раздел **params** :

    | Клавиши | Значение | Возвращает
    |-----|------------|------|
    | number | 1 |Ответ может включать сторону улицы (слева направо), а также смещение для числа.|
    | returnSpeedLimit | true | Возвращает ограничение скорости по адресу.|
    | returnRoadUse | true | Возвращает дорожные типы использования по адресу. Все возможные типы использования в пути см. в разделе [типы использования дорожек](/rest/api/maps/search/getsearchaddressreverse#uri-parameters).|
    | ретурнматчтипе | true| Возвращает тип соответствия. Все возможные значения см. в разделе [обратные результаты поиска адресов](/rest/api/maps/search/getsearchaddressreverse#searchaddressreverseresult) .

   :::image type="content" source="./media/how-to-search-for-address/search-reverse.png" alt-text="Поиск адреса":::

5. Нажмите кнопку **Отправить** и проверьте текст ответа.

6. Далее мы добавим `entityType` ключ и присвоим ему значение `Municipality` . `entityType`Ключ переопределит `returnMatchType` ключ на предыдущем шаге. Также необходимо удалить `returnSpeedLimit` и, `returnRoadUse` так как мы запрашиваем сведения о органе государственной власти.  Все возможные типы сущностей см. в разделе [типы сущностей](/rest/api/maps/search/getsearchaddressreverse#entitytype).

    :::image type="content" source="./media/how-to-search-for-address/search-reverse-entity-type.png" alt-text="Поиск адреса":::

7. Нажмите кнопку **Отправить** . Сравните результаты с результатами, возвращенными на шаге 5.  Так как запрошенный тип сущности теперь является `municipality` , ответ не включает сведения о почтовом адресе. Кроме того, возвращаемое значение `geometryId` можно использовать для запроса многоугольника с помощью Azure Maps получения [API-интерфейса Polygon поиска](/rest/api/maps/search/getsearchpolygon).

>[!TIP]
>Дополнительные сведения об этих параметрах, а также сведения о других см. в [разделе Параметры обратных результатов поиска](/rest/api/maps/search/getsearchaddressreverse#uri-parameters).

## <a name="search-for-cross-street-using-reverse-address-cross-street-search"></a>Поиск перекрестной улицы с помощью обратных адресов Поиск по адресу

В этом примере мы будем искать перекрестные улицы на основе координат адреса.

1. В приложении POST щелкните **создать** и выберите **запрос** . Введите **Имя запроса** для запроса. Выберите коллекцию, созданную в первом разделе, или создайте новую, а затем нажмите кнопку **сохранить** .

2. На вкладке Построитель выберите метод **Get** HTTP и введите следующий URL-адрес. Для этого запроса и других запросов, упомянутых в этой статье, замените `{Azure-Maps-Primary-Subscription-key}` первичным ключом подписки. Запрос должен выглядеть, как в этом URL-адресе:
  
    ```http
   https://atlas.microsoft.com/search/address/reverse/crossstreet/json?&api-version=1.0&subscription-key={Azure-Maps-Primary-Subscription-key}&language=en-US&query=47.591180,-122.332700
    ```

    :::image type="content" source="./media/how-to-search-for-address/search-address-cross.png" alt-text="Поиск адреса":::
  
3. Нажмите кнопку **Отправить** и проверьте текст ответа. Обратите внимание, что ответ содержит `crossStreet` значение `Occidental Avenue South` .

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Azure Maps Служба поиска REST API](/rest/api/maps/search)

> [!div class="nextstepaction"]
> [Рекомендации по Azure Maps Служба поиска](how-to-use-best-practices-for-search.md)