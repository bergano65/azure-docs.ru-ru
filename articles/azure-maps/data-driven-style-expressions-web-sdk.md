---
title: Выражения стиля на основе данных в Azure Maps веб-пакете SDK | Карты Microsoft Azure
description: Сведения о выражениях в стиле, управляемых данными. Сведения об использовании этих выражений в Azure Maps веб-пакете SDK для настройки стилей в картах.
author: rbrundritt
ms.author: richbrun
ms.date: 4/4/2019
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: cpendle
ms.custom: codepen, devx-track-js
ms.openlocfilehash: 41a117c9ea8b47afcedaa1714abc2031d3be6c21
ms.sourcegitcommit: 66b0caafd915544f1c658c131eaf4695daba74c8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/18/2020
ms.locfileid: "97680064"
---
# <a name="data-driven-style-expressions-web-sdk"></a>Выражения стиля на основе данных (веб-пакет SDK)

Выражения позволяют применять бизнес-логику к параметрам стилей, которые задают свойства, определенные в каждой фигуре источника данных. Выражения могут фильтровать данные в источнике данных или слое. Выражения могут состоять из условной логики, например if-операторы. Для работы с данными можно использовать следующие операторы: String, логические операторы и математические операторы.

Стили, управляемые данными, сокращают объем кода, необходимого для реализации бизнес-логики вокруг стилей. При использовании с слоями выражения вычисляются во время отрисовки в отдельном потоке. Эта функция обеспечивает повышенную производительность по сравнению с оценкой бизнес-логики в потоке пользовательского интерфейса.

В этом видео представлен обзор стилизации на основе данных в Azure Maps веб-пакете SDK.

</br>

>[!VIDEO https://channel9.msdn.com/Shows/Internet-of-Things-Show/Data-Driven-Styling-with-Azure-Maps/player?format=ny]

Выражения представлены в виде массивов JSON. Первым элементом выражения в массиве является строка, указывающая имя оператора выражения. Например, "+" или "Case". Следующие элементы (если таковые имеются) являются аргументами выражения. Каждый аргумент является либо литеральным значением (строкой, числом, логическим значением или `null` ), либо другим массивом выражений. Следующий псевдокод определяет базовую структуру выражения. 

```javascript
[ 
    expression_operator, 
    argument0, 
    argument1, 
    …
] 
```

Azure Maps веб-пакет SDK поддерживает много типов выражений. Выражения можно использовать отдельно или в сочетании с другими выражениями.

| Тип выражений | Описание |
|---------------------|-------------|
| [Статистическое выражение](#aggregate-expression) | Выражение, определяющее вычисление, которое обрабатывается по набору данных и может использоваться с `clusterProperties` параметром `DataSource` . |
| [Логические выражения](#boolean-expressions) | Логические выражения предоставляют набор выражений логических операторов для оценки логических сравнений. |
| [Выражения цвета](#color-expressions) | Выражения цвета упрощают создание цветовых значений и манипуляций с ними. |
| [Условные выражения](#conditional-expressions) | Условные выражения предоставляют логические операции, аналогичные операторам if. |
| [Выражения данных](#data-expressions) | Предоставляет доступ к данным свойств в компоненте. |
| [Выражения интерполяции и шага](#interpolate-and-step-expressions) | Выражения интерполяции и шага можно использовать для вычисления значений по кривой с интерполяцией или с пошаговыми функциями. |
| [Выражения для конкретных слоев](#layer-specific-expressions) | Специальные выражения, применимые только к одному слою. |
| [Математические выражения](#math-expressions) | Предоставляет математические операторы для выполнения вычислений на основе данных в платформе выражений. |
| [Выражения строкового оператора](#string-operator-expressions) | Выражения строкового оператора выполняют операции преобразования строк, таких как объединение и преобразование варианта. |
| [Выражения типа](#type-expressions) | Выражения типа предоставляют средства для тестирования и преобразования различных типов данных, таких как строки, числа и логические значения. |
| [Выражения привязки переменных](#variable-binding-expressions) | Выражения привязки переменных хранят результаты вычисления в переменной и ссылаются на другие части выражения несколько раз без необходимости повторного вычисления сохраненного значения. |
| [Выражение масштаба](#zoom-expression) | Возвращает текущий уровень масштаба для отображения во время отрисовки. |

Во всех примерах в этом документе используется следующая функция для демонстрации различных способов использования различных типов выражений. 

```json
{
    "type": "Feature",
    "geometry": {
        "type": "Point",
        "coordinates": [-122.13284, 47.63699]
    },
    "properties": { 
        "id": 123,
        "entityType": "restaurant",
        "revenue": 12345,
        "subTitle": "Building 40", 
        "temperature": 64,
        "title": "Cafeteria", 
        "zoneColor": "purple",
        "abcArray": ["a", "b", "c"],
        "array2d": [["a", "b"], ["x", "y"]],
        "_style": {
            "fillColor": "red"
        }
    }
}
```

## <a name="data-expressions"></a>Выражения данных

Выражения данных предоставляют доступ к данным свойств в компоненте. 

| Выражение | Возвращаемый тип | Описание |
|------------|-------------|-------------|
| `['at', number, array]` | value | Извлекает элемент из массива. |
| `['geometry-type']` | строка | Возвращает тип геометрии компонента: Point, MultiPoint, LineString, MultiLineString, многоугольник, Polygon. |
| `['get', string]` | value | Возвращает значение свойства из свойств текущего компонента. Возвращает значение null, если запрошенное свойство отсутствует. |
| `['get', string, object]` | value | Возвращает значение свойства из свойств указанного объекта. Возвращает значение null, если запрошенное свойство отсутствует. |
| `['has', string]` | Логическое | Определяет, имеют ли свойства компонента указанное свойство. |
| `['has', string, object]` | Логическое | Определяет, имеют ли свойства объекта указанное свойство. |
| `['id']` | value | Возвращает идентификатор компонента, если он имеется. |
| `['in', boolean | string | number, array]` | Логическое | Определяет, существует ли элемент в массиве |
| `['in', substring, string]` | Логическое | Определяет, существует ли подстрока в строке |
| `['index-of', boolean | string | number, array | string]`<br/><br/>`['index-of', boolean | string | number, array | string, number]` | number | Возвращает первую позицию, в которой элемент может быть найден в массиве, или подстрока, может быть найдена в строке или, `-1` Если входные данные не найдены. Принимает необязательный индекс, с которого начинается поиск. |
| `['length', string | array]` | number | Возвращает длину строки или массива. |
| `['slice', array | string, number]`<br/><br/>`['slice', array | string, number, number]` | \|массив строк | Возвращает элемент из массива или подстроки из строки с указанным начальным индексом или между начальным и конечным индексами, если задано значение. Возвращаемое значение является инклюзивным по отношению к начальному индексу, но не к конечному индексу. |

**Примеры**

Доступ к свойствам функции можно получить непосредственно в выражении с помощью `get` выражения. В этом примере используется `zoneColor` значение функции для указания свойства Color пузырькового слоя. 

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: ['get', 'zoneColor'] //Get the zoneColor value.
});
```

Приведенный выше пример будет работать нормально, если все функции точки имеют `zoneColor` свойство. В противном случае цвет скорее всего вернется к «черному». Чтобы изменить цвет резервирования, используйте `case` выражение в сочетании с `has` выражением, чтобы проверить, существует ли свойство. Если свойство не существует, возвращается резервный цвет.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'case', //Use a conditional case expression.

        ['has', 'zoneColor'],   //Check to see if feature has a "zoneColor" property
        ['get', 'zoneColor'],   //If it does, use it.

        'blue'  //If it doesn't, default to blue.
    ]
});
```

Пузырьки и слои символов по умолчанию отображают координаты всех фигур в источнике данных. Это поведение может выделять вершины многоугольника или линии. `filter`Параметр слоя можно использовать для ограничения типа геометрии отображаемых функций с помощью `['geometry-type']` выражения в логическом выражении. В следующем примере уровень пузырьков ограничивается таким образом, чтобы `Point` отображались только функции.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    filter: ['==', ['geometry-type'], 'Point']
});
```

В следующем примере допускаются `Point` `MultiPoint` отрисовка и компонентов, и. 

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    filter: ['any', ['==', ['geometry-type'], 'Point'], ['==', ['geometry-type'], 'MultiPoint']]
});
```

Точно так же контур многоугольников будет отображаться в слоях линий. Чтобы отключить это поведение на уровне линии, добавьте фильтр, допускающий только `LineString` функции и `MultiLineString` .  

Ниже приведены некоторые дополнительные примеры использования выражений данных.

```javascript
//Get item [2] from an array "properties.abcArray[1]" = "c"
['at', 2, ['get', 'abcArray']]

//Get item [0][1] from a 2D array "properties.array2d[0][1]" = "b"
['at', 1, ['at', 0, ['get', 'array2d']]]

//Check to see if a value is in an array "properties.abcArray.indexOf('a') !== -1" = true
['in', 'a', ['get', 'abcArray']]

//Gets the index of the value 'b' in an array "properties.abcArray.indexOf('b')" = 1
['index-of', 'b', ['get', 'abcArray']]

//Get the length of an array "properties.abcArray.length" = 3
['length', ['get', 'abcArray']]

//Get the value of a subproperty "properties._style.fillColor" = "red"
['get', 'fillColor', ['get', '_style']]

//Check that "fillColor" exists as a subproperty of "_style".
['has', 'fillColor', ['get', '_style']]

//Slice an array starting at index 2 "properties.abcArray.slice(2)" = ['c']
['slice', ['get', 'abcArray'], 2]

//Slice a string from index 0 to index 4 "properties.entityType.slice(0, 4)" = 'rest'
['slice', ['get', 'entityType'], 0, 4]
```

## <a name="math-expressions"></a>Математические выражения

Математические выражения предоставляют математические операторы для выполнения вычислений на основе данных в платформе выражений.

| Выражение | Возвращаемый тип | Описание |
|------------|-------------|-------------|
| `['+', number, number, …]` | number | Вычисляет сумму указанных чисел. |
| `['-', number]` | number | Вычитает 0 на указанное число. |
| `['-', number, number]` | number | Вычитает первые цифры по второму числу. |
| `['*', number, number, …]` | number | Умножает указанные числа вместе. |
| `['/', number, number]` | number | Делит первое число на второе число. |
| `['%', number, number]` | number | Вычисляет остаток при делении первого числа на второе число. |
| `['^', number, number]` | number | Вычисляет значение первого значения, возведенного в степень второго числа. |
| `['abs', number]` | number | Вычисляет абсолютное значение заданного числа. |
| `['acos', number]` | number | Вычисляет арккосинус указанного числа. |
| `['asin', number]` | number | Вычисляет арксинус указанного числа. |
| `['atan', number]` | number | Вычисляет арктангенс указанного числа. |
| `['ceil', number]` | number | Округляет число до следующего целого числа. |
| `['cos', number]` | number | Вычисляет COS указанного числа. |
| `['e']` | number | Возвращает математическую константу `e` . |
| `['floor', number]` | number | Округляет число до предыдущего целого числа. |
| `['ln', number]` | number | Вычисляет натуральный логарифм заданного числа. |
| `['ln2']` | number | Возвращает математическую константу `ln(2)` . |
| `['log10', number]` | number | Вычисляет десятичный логарифм указанного числа. |
| `['log2', number]` | number | Вычисляет логарифм указанного числа с основанием 2. |
| `['max', number, number, …]` | number | Вычисляет максимальное число в указанном наборе чисел. |
| `['min', number, number, …]` | number | Вычисляет минимальное число в указанном наборе чисел. |
| `['pi']` | number | Возвращает математическую константу `PI` . |
| `['round', number]` | number | Округляет число до ближайшего целого. Среднее значение округляется с нуля. Например, `['round', -1.5]` принимает значение `-2` . |
| `['sin', number]` | number | Вычисляет синус указанного числа. |
| `['sqrt', number]` | number | Вычисляет квадратный корень заданного числа. |
| `['tan', number]` | number | Вычисляет тангенс указанного числа. |

## <a name="aggregate-expression"></a>Статистическое выражение

Статистическое выражение определяет вычисление, которое обрабатывается по набору данных и может использоваться с `clusterProperties` параметром `DataSource` . Выходные данные этих выражений должны быть числами или логическими значениями. 

Статистическое выражение принимает три значения: значение оператора и начальное значение и выражение для получения свойства из каждого компонента в данных для применения статистической операции. Это выражение имеет следующий формат:

```javascript
[operator: string, initialValue: boolean | number, mapExpression: Expression]
```

- Оператор: функция выражения, которая затем применяется к всем значениям, вычисленным `mapExpression` для каждой точки в кластере. Поддерживаемые операторы: 
    - Для чисел: `+` , `*` , `max` , `min`
    - Для логических значений: `all` , `any`
- Инитиалвалуе: начальное значение, для которого выполняется статистическая обработка первого вычисленного значения.
- Мапекспрессион: выражение, применяемое к каждой точке в наборе данных.

**Примеры**

Если все компоненты в наборе данных имеют `revenue` свойство, которое является числом. Затем можно вычислить общий доход всех точек в кластере, созданных из набора данных. Это вычисление выполняется с помощью следующего статистического выражения: `['+', 0, ['get', 'revenue']]`

### <a name="accumulated-expression"></a>Накопленное выражение

`accumulated`Выражение получает значение свойства кластера, накопленного до сих пор. Его можно использовать только в `clusterProperties` параметре кластеризованного `DataSource` источника.

**Использование**

```javascript
["accumulated"]
```

## <a name="boolean-expressions"></a>Логические выражения

Логические выражения предоставляют набор выражений логических операторов для оценки логических сравнений.

При сравнении значений сравнение строго типизировано. Значения различных типов всегда считаются неравными. Случаи, когда типы во время синтаксического анализа могут различаться, считаются недопустимыми и выдают ошибку синтаксического анализа. 

| Выражение | Возвращаемый тип | Описание |
|------------|-------------|-------------|
| `['!', boolean]` | Логическое | Логическое отрицание. Возвращает `true` , если входные данные имеют значение `false` , и `false` Если вход имеет значение `true` . |
| `['!=', value, value]` | Логическое | Возвращает значение `true` , если входные значения не равны; `false` в противном случае —. |
| `['<', value, value]` | Логическое | Возвращает `true` , если первые входные данные строго меньше второго, `false` в противном случае —. Аргументы должны быть либо строками, либо обоими числами. |
| `['<=', value, value]` | Логическое | Возвращает `true` , если первый вход меньше второго или равен ему; `false` в противном случае — значение. Аргументы должны быть либо строками, либо обоими числами. |
| `['==', value, value]` | Логическое | Возвращает значение `true` , если входные значения равны, `false` в противном случае —. Аргументы должны быть либо строками, либо обоими числами. |
| `['>', value, value]` | Логическое | Возвращает `true` , если первые входные данные строго больше второго, `false` в противном случае —. Аргументы должны быть либо строками, либо обоими числами. |
| `['>=' value, value]` | Логическое | Возвращает `true` , если первый вход больше второго или равен ему; `false` в противном случае — значение. Аргументы должны быть либо строками, либо обоими числами. |
| `['all', boolean, boolean, …]` | Логическое | Возвращает `true` значение, если все входные данные являются `true` , `false` в противном случае —. |
| `['any', boolean, boolean, …]` | Логическое | Возвращает `true` , если какой либо вход имеет `true` `false` значение, в противном случае —. |
| `['within', Polygon | MultiPolygon | Feature<Polygon | MultiPolygon>]` | Логическое | Возвращает `true` значение, если вычисленная функция полностью содержится внутри границы входной геометрии, и false в противном случае. Входное значение может быть допустимым геоформатом JSON типа `Polygon` ,, `MultiPolygon` `Feature` или `FeatureCollection` . Поддерживаемые функции для оценки:<br/><br/>-Point: Возвращает значение, `false` Если точка находится на границе или выходит за пределы границы.<br/>-LineString: возвращает `false` , если любая часть линии находится за пределами границы, строка пересекает границу, или конечная точка линии находится на границе. |

## <a name="conditional-expressions"></a>Условные выражения

Условные выражения предоставляют логические операции, аналогичные операторам if.

Следующие выражения выполняют условные операции логики над входными данными. Например, `case` выражение предоставляет логику "if/then/else", а `match` выражение как "оператор switch". 

### <a name="case-expression"></a>Выражение CASE

`case`Выражение — это тип условного выражения, который предоставляет логику "if/then/else". Этот тип выражения проходит через список логических условий. Он возвращает выходное значение первого логического условия для вычисления значения true.

Следующий псевдокод определяет структуру `case` выражения. 

```javascript
[
    'case',
    condition1: boolean, 
    output1: value,
    condition2: boolean, 
    output2: value,
    ...,
    fallback: value
]
```

**Пример**

В следующем примере выполняется выполнение различных логических условий до тех пор, пока не будет найдено выражение, результатом вычисления которого является `true` , а затем возвращается соответствующее значение. Если результат логического условия не равен `true` , будет возвращено резервное значение. 

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'case',

        //Check to see if the first boolean expression is true, and if it is, return its assigned result.
        ['has', 'zoneColor'],
        ['get', 'zoneColor'],

        //Check to see if the second boolean expression is true, and if it is, return its assigned result.
        ['all', ['has', ' temperature '], ['>', ['get', 'temperature'], 100]],
        'red',

        //Specify a default value to return.
        'green'
    ]
});
```

### <a name="match-expression"></a>Выражение match

`match`Выражение представляет собой тип условного выражения, предоставляющего оператор switch, например логику. Входными данными может быть любое выражение `['get', 'entityType']` , например, возвращающее строку или число. Каждая метка должна быть либо одиночным литеральным значением, либо массивом литеральных значений, значения которых должны быть всеми строками или целыми числами. Входные данные соответствуют, если какое бы то ни было значение в массиве. Каждая метка должна быть уникальной. Если тип входных данных не соответствует типу меток, результатом будет резервное значение.

Следующий псевдокод определяет структуру `match` выражения. 

```javascript
[
    'match',
    input: number | string,
    label1: number | string | (number | string)[], 
    output1: value,
    label2: number | string | (number | string)[], 
    output2: value,
    ...,
    fallback: value
]
```

**Примеры**

В следующем примере рассматривается `entityType` свойство функции Point в пузырьковой слое, где выполняется поиск совпадения. Если найдено совпадение, возвращается указанное значение или возвращается резервное значение.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'match',

        //Get the property to match.
        ['get', 'entityType'],

        //List the values to match and the result to return for each match.
        'restaurant', 'red',
        'park', 'green',

        //Specify a default value to return if no match is found.
        'black'
    ]
});
```

В следующем примере массив используется для перечисления набора меток, которые должны возвращать одно и то же значение. Этот подход гораздо более эффективен, чем вывод каждой метки по отдельности. В этом случае, если `entityType` свойство имеет значение "Ресторан" или "grocery_store", будет возвращен красный цвет.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'match',

        //Get the property to match.
        ['get', 'entityType'],

        //List the values to match and the result to return for each match.
        ['restaurant', 'grocery_store'], 'red',

        'park', 'green',

        //Specify a default value to return if no match is found.
        'black'
    ]
});
```

### <a name="coalesce-expression"></a>Выражение объединения

`coalesce`Выражение проходит через набор выражений до тех пор, пока не будет получено первое значение, отличное от NULL, и не вернет это значение. 

Следующий псевдокод определяет структуру `coalesce` выражения. 

```javascript
[
    'coalesce', 
    value1, 
    value2, 
    …
]
```

**Пример**

В следующем примере выражение используется `coalesce` для задания `textField` параметра уровня символа. Если `title` свойство отсутствует в компоненте или имеет значение `null` , выражение попытается найти `subTitle` свойство, если оно отсутствует или `null` , после этого будет возвращаться к пустой строке. 

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: [
            'coalesce',

            //Try getting the title property.
            ['get', 'title'],

            //If there is no title, try getting the subTitle. 
            ['get', 'subTitle'],

            //Default to an empty string.
            ''
        ]
    }
});
```

В следующем примере выражение используется `coalesce` для извлечения первого доступного значка изображения, доступного в Map Sprite, из списка указанных имен изображений.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    iconOptions: {
        image: [
            'coalesce',

            //Try getting the image with id 'missing-image'.
            ['image', 'missing-image'],

            //Specify an image id to fallback to. 
            'marker-blue'
        ]
    }
});
``` 

## <a name="type-expressions"></a>Выражения типа

Выражения типа предоставляют средства для тестирования и преобразования различных типов данных, таких как строки, числа и логические значения.

| Выражение | Возвращаемый тип | Описание |
|------------|-------------|-------------|
| `['array', value]` \| `['array', type: "string" | "number" | "boolean", value]` | Object [] | Утверждает, что входные данные являются массивом. |
| `['boolean', value]` \| `["boolean", value, fallback: value, fallback: value, ...]` | Логическое | Утверждает, что входное значение является логическим. Если указано несколько значений, каждый из них вычисляется по порядку, пока не будет получено логическое значение. Если ни один из входных данных не является логическим, выражение является ошибкой. |
| `['collator', { 'case-sensitive': boolean, 'diacritic-sensitive': boolean, 'locale': string }]` | collator | Возвращает средство сортировки для использования в операциях сравнения, зависящих от языкового стандарта. Параметры с учетом регистра и диакритические знаки по умолчанию имеют значение false. Аргумент locale указывает тег языка IETF для используемого языкового стандарта. Если значение не указано, используется языковой стандарт по умолчанию. Если запрошенный языковой стандарт недоступен, то в параметрах сортировки будет использоваться определенный системой языковой стандарт. Используйте параметр resolved-locale для проверки результатов работы отката языкового стандарта. |
| `['literal', array]`<br/><br/>`['literal', object]` | Array, \| объект | Возвращает литеральный массив или значение объекта. Используйте это выражение, чтобы предотвратить вычисление массива или объекта в качестве выражения. Это необходимо, если массив или объект должен возвращаться выражением. |
| `['image', string]` | строка | Проверяет, загружен ли указанный идентификатор изображения в спрайт изображений Maps. Если значение равно, возвращается идентификатор, в противном случае возвращается значение null. |
| `['number', value]` \| `["number", value, fallback: value, fallback: value, ...]` | number | Утверждает, что входное значение является числом. Если указано несколько значений, каждый из них вычисляется по порядку, пока не будет получено число. Если ни один из входных данных не является числом, выражение является ошибкой. |
| `['object', value]`  \| `["object", value, fallback: value, fallback: value, ...]` | Объект | Утверждает, что входное значение является объектом.  Если указано несколько значений, каждый из них вычисляется по порядку, пока не будет получен объект. Если ни один из входных данных не является объектами, выражение является ошибкой. |
| `['string', value]` \| `["string", value, fallback: value, fallback: value, ...]` | строка | Утверждает, что входное значение является строкой. Если указано несколько значений, каждый из них вычисляется по порядку, пока не будет получена строка. Если ни один из входных данных не является строкой, выражение является ошибкой. |
| `['to-boolean', value]` | Логическое | Преобразует входное значение в логическое. В результате `false` входные данные представляют собой пустую строку,,, `0` `false` `null` или `NaN` ; в противном случае — значение `true` . |
| `['to-color', value]`<br/><br/>`['to-color', value1, value2…]` | color | Преобразует входное значение в цвет. Если указано несколько значений, каждый из них вычисляется по порядку, пока не будет получено первое успешное преобразование. Если ни один из входных данных не может быть преобразован, выражение является ошибкой. |
| `['to-number', value]`<br/><br/>`['to-number', value1, value2, …]` | number | По возможности преобразует входное значение в число. Если входные данные имеют значение `null` или `false` , результат равен 0. Если входные данные имеют значение `true` , результат равен 1. Если входные данные являются строкой, она преобразуется в число с помощью функции строки [Тонумбер](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) спецификации языка ECMAScript. Если указано несколько значений, каждый из них вычисляется по порядку, пока не будет получено первое успешное преобразование. Если ни один из входных данных не может быть преобразован, выражение является ошибкой. |
| `['to-string', value]` | строка | Преобразует входное значение в строку. Если вход имеет значение `null` , то результатом будет `""` . Если входными данными является логическое значение, результатом является `"true"` или `"false"` . Если входные данные являются числом, оно преобразуется в строку с помощью функции [ToString](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) Number спецификации языка ECMAScript. Если входные данные являются цветом, они преобразуются в строку цвета объекта RGBA CSS `"rgba(r,g,b,a)"` . В противном случае входные данные преобразуются в строку с помощью функции [JSON. stringify](https://tc39.github.io/ecma262/#sec-json.stringify) спецификации языка ECMAScript. |
| `['typeof', value]` | строка | Возвращает строку, описывающую тип данного значения. |

> [!TIP]
> Если в консоли браузера отображается сообщение об ошибке, похожее на, то это `Expression name must be a string, but found number instead. If you wanted a literal array, use ["literal", [...]].` означает, что в коде есть выражение, имеющее массив, в котором нет строки для ее первого значения. Если требуется, чтобы выражение возвращало массив, заключите массив в `literal` выражение. В следующем примере задается `offset` параметр Icon слоя символов, который должен быть массивом, содержащим два числа, с помощью `match` выражения для выбора между двумя значениями смещения, основанными на значении  `entityType` Свойства функции Point.
>
> ```javascript
> var layer = new atlas.layer.SymbolLayer(datasource, null, {
>     iconOptions: {
>         offset: [
>             'match',
>
>             //Get the entityType value.
>             ['get', 'entityType'],
>
>             //If the entity type is 'restaurant', return a different pixel offset. 
>             'restaurant', ['literal', [0, -10]],
>
>             //Default to value.
>             ['literal', [0, 0]]
>         ]
>     }
> });
> ```

## <a name="color-expressions"></a>Выражения цвета

Выражения цвета упрощают создание цветовых значений и манипуляций с ними.

| Выражение | Возвращаемый тип | Описание |
|------------|-------------|-------------|
| `['rgb', number, number, number]` | color | Создает значение цвета из *Красного*, *зеленого* и *синего* компонентов, которое должно находиться в диапазоне от `0` до и `255` альфа-компонент `1` . Если какой-либо компонент выходит за пределы диапазона, выражение является ошибкой. |
| `['rgba', number, number, number, number]` | color | Создает значение цвета из *Красного*, *зеленого*, *синего* компонентов, которое должно находиться между `0` и `255` , и альфа-компонентом в диапазоне `0` и `1` . Если какой-либо компонент выходит за пределы диапазона, выражение является ошибкой. |
| `['to-rgba']` | \[число, число, число, число\] | Возвращает массив из четырех элементов, содержащий *красный*, *зеленый*, *синий* и *альфа* -компоненты цвета ввода в указанном порядке. |

**Пример**

В следующем примере создается значение цвета RGB с *красным* значением `255` , а также *зеленым* и *синим* значениями, которые рассчитываются путем умножения на `2.5` значение `temperature` Свойства. При изменении температуры цвет изменится на другие оттенки *Красного* цвета.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'rgb', //Create a RGB color value.

        255,    //Set red value to 255.

        ['*', 2.5, ['get', 'temperature']], //Multiple the temperature by 2.5 and set the green value.

        ['*', 2.5, ['get', 'temperature']]  //Multiple the temperature by 2.5 and set the blue value.
    ]
});
```

## <a name="string-operator-expressions"></a>Выражения строкового оператора

Выражения строкового оператора выполняют операции преобразования строк, таких как объединение и преобразование варианта. 

| Выражение | Возвращаемый тип | Описание |
|------------|-------------|-------------|
| `['concat', string, string, …]` | строка | Объединяет несколько строк вместе. Каждое значение должно быть строкой. Используйте `to-string` выражение типа для преобразования других типов значений в строку, если это необходимо. |
| `['downcase', string]` | строка | Преобразует заданную строку в нижний регистр. |
| `['is-supported-script', string]` \| `['is-supported-script', Expression]`| Логическое | Определяет, использует ли входная строка кодировку, поддерживаемую текущим стеком шрифтов. Например: `['is-supported-script', 'ಗೌರವಾರ್ಥವಾಗಿ']` |
| `['resolved-locale', string]` | строка | Возвращает тег языка IETF для языкового стандарта, используемого указанными параметрами сортировки. Это можно использовать для определения национальной настройки системы по умолчанию или для определения успешной загрузки запрошенного языкового стандарта. |
| `['upcase', string]` | строка | Преобразует заданную строку в верхний регистр. |

**Пример**

В следующем примере `temperature` свойство функции Point преобразуется в строку, а затем в конец строки объединяется "° f".

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: ['concat', ['to-string', ['get', 'temperature']], '°F'],

        //Some additional style options.
        offset: [0, -1.5],
        size: 12,
        color: 'white'
    }
});
```

Приведенное выше выражение выводит на карту закрепление с текстом "64 ° F", который накладывается поверх него, как показано на рисунке ниже.

<center>

![Пример ](media/how-to-expressions/string-operator-expression.png) выражения строкового оператора </center>

## <a name="interpolate-and-step-expressions"></a>Выражения интерполяции и шага

Выражения интерполяции и шага можно использовать для вычисления значений по кривой с интерполяцией или с пошаговыми функциями. Эти выражения принимают выражение, возвращающее числовое значение в качестве входных данных, например `['get',  'temperature']` . Входное значение вычисляется на основе пар входных и выходных значений, чтобы определить значение, которое лучше подходит для интерполяции кривой или функции Step. Выходные значения называются «остановками». Входные значения для каждой из них должны быть числами и находиться в возрастающем порядке. Выходные значения должны быть числом, массивом чисел или цветом.

### <a name="interpolate-expression"></a>Выражение интерполяции

`interpolate`Выражение можно использовать для вычисления непрерывного гладкого набора значений путем интерполяции между значениями типа «конец». `interpolate`Выражение, возвращающее цветовые значения, создает цветовой градиент, в котором значения результатов выбираются из.

Существует три типа методов интерполяции, которые можно использовать в `interpolate` выражении:
 
* `['linear']` — Выполняет линейную интерполяцию между парой остановок.
* `['exponential', base]` — Выполняет экспоненциальную интерполяцию между остановками. `base`Значение определяет скорость, с которой увеличивается вывод. Более высокие значения приводят к увеличению объема выходных данных в большую сторону диапазона. `base`Значение, близкое к 1, создает выходные данные, которые более линейно увеличиваются.
* `['cubic-bezier', x1, y1, x2, y2]` — Выполняет интерполяцию с использованием [кривой Безье третьего порядка](https://developer.mozilla.org/docs/Web/CSS/timing-function) , определяемой заданными контрольными точками.

Ниже приведен пример того, как выглядят эти различные типы интерполяций. 

| Линейная  | Экспоненциально | Кривая Безье третьего порядка |
|---------|-------------|--------------|
| ![Диаграмма линейной интерполяции](media/how-to-expressions/linear-interpolation.png) | ![Экспоненциальный граф интерполяции](media/how-to-expressions/exponential-interpolation.png) | ![Диаграмма интерполяции Безье третьего порядка](media/how-to-expressions/bezier-curve-interpolation.png) |

Следующий псевдокод определяет структуру `interpolate` выражения. 

```javascript
[
    'interpolate',
    interpolation: ['linear'] | ['exponential', base] | ['cubic-bezier', x1, y1, x2, y2],
    input: number,
    stopInput1: number, 
    stopOutput1: value1,
    stopInput2: number, 
    stopOutput2: value2, 
    ...
]
```

**Пример**

В следующем примере выражение используется `linear interpolate` для задания `color` Свойства пузырькового слоя на основе `temperature` Свойства функции Point. Если `temperature` значение меньше 60, будет возвращен "Blue". Если это значение находится в диапазоне от 60 до 70, будет возвращен желтый цвет. Если он находится в диапазоне от 70 до 80, будет возвращен оранжевый. Если это 80 или более, будет возвращен красный символ.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'interpolate',
        ['linear'],
        ['get', 'temperature'],
        50, 'blue',
        60, 'yellow',
        70, 'orange',
        80, 'red'
    ]
});
```

На следующем рисунке показано, как выбираются цвета для приведенного выше выражения.
 
<center>

![Пример ](media/how-to-expressions/interpolate-expression-example.png) выражения интерполяции </center>

### <a name="step-expression"></a>Выражение шага

`step`Выражение можно использовать для вычисления дискретных пошаговых значений результатов путем вычисления [функции кусочно--Constant](http://mathworld.wolfram.com/PiecewiseConstantFunction.html) , определенной в параметре Stop. 

Следующий псевдокод определяет структуру `step` выражения. 

```javascript
[
    'step',
    input: number,
    output0: value0,
    stop1: number, 
    output1: value1,
    stop2: number, 
    output2: value2, 
    ...
]
```

Выражения шага возвращают выходное значение завершения, непосредственно предшествующее входному значению, или первое входное значение, если входные данные меньше первой позиции. 

**Пример**

В следующем примере выражение используется `step` для задания `color` Свойства пузырькового слоя на основе `temperature` Свойства функции Point. Если `temperature` значение меньше 60, будет возвращен "Blue". Если он находится в диапазоне от 60 до 70, будет возвращен желтый. Если он находится в диапазоне от 70 до 80, будет возвращен оранжевый. Если это 80 или более, будет возвращен красный символ.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'step',
        ['get', 'temperature'],
        'blue',
        60, 'yellow',
        70, 'orange',
        80, 'red'
    ]
});
```

На следующем рисунке показано, как выбираются цвета для приведенного выше выражения.
 
<center>

![Пример выражения шага](media/how-to-expressions/step-expression-example.png)
</center>

## <a name="layer-specific-expressions"></a>Выражения, относящиеся к слою

Специальные выражения, которые применяются только к определенным слоям.

### <a name="heat-map-density-expression"></a>Выражение плотности тепловой карт

Выражение плотности тепловой карт извлекает значение плотности тепловой карт для каждого пикселя на уровне тепловой карт и определяется как `['heatmap-density']` . Это значение является числом между `0` и `1` . Он используется в сочетании с `interpolation` `step` выражением или для определения цветового градиента, используемого для раскрашивания тепловой карт. Это выражение можно использовать только в [параметре Color](/javascript/api/azure-maps-control/atlas.heatmaplayeroptions#color) слоя тепловой карт.

> [!TIP]
> Цвет с индексом 0, в выражении интерполяции или цвет по умолчанию для цвета шага определяет цвет области, в которой нет данных. Цвет с индексом 0 можно использовать для определения цвета фона. Многие пользователи предпочитают использовать для этого прозрачный или полупрозрачный черный цвет.

**Пример**

В этом примере используется выражение интерполяции для создания гладкой цветового градиента для визуализации тепловой карт. 

```javascript 
var layer = new atlas.layer.HeatMapLayer(datasource, null, {
    color: [
        'interpolate',
        ['linear'],
        ['heatmap-density'],
        0, 'transparent',
        0.01, 'purple',
        0.5, '#fb00fb',
        1, '#00c3ff'
    ]
});
```

Помимо использования плавного градиента для выделения тепловой карте, цвета можно указать в наборе диапазонов с помощью `step` выражения. Использование `step` выражения для выделения цветом тепловой карт визуально разбивает плотность на диапазоны, похожие на карту расконтурного или лепесткового стиля.  

```javascript 
var layer = new atlas.layer.HeatMapLayer(datasource, null, {
    color: [
        'step',
        ['heatmap-density'],
        'transparent',
        0.01, 'navy',
        0.25, 'navy',
        0.5, 'green',
        0.75, 'yellow',
        1, 'red'
    ]
});
```

Дополнительные сведения см. в документации по [добавлению слоя тепловой карт](map-add-heat-map-layer.md) .

### <a name="line-progress-expression"></a>Выражение хода выполнения строки

Выражение хода выполнения строки получает ход выполнения вдоль линии градиента в слое линий и определяется как `['line-progress']` . Это значение является числом от 0 до 1. Он используется в сочетании с `interpolation` `step` выражением или. Это выражение можно использовать только с [параметром строкеградиент]( https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.linelayeroptions#strokegradient) слоя Line. 

> [!NOTE]
> Для `strokeGradient` параметра уровня линии необходимо, чтобы `lineMetrics` параметр источника данных был установлен в значение `true` .

**Пример**

В этом примере `['line-progress']` выражение используется для применения градиента цвета к штриху линии.

```javascript
var layer = new atlas.layer.LineLayer(datasource, null, {
    strokeGradient: [
        'interpolate',
        ['linear'],
        ['line-progress'],
        0, "blue",
        0.1, "royalblue",
        0.3, "cyan",
        0.5, "lime",
        0.7, "yellow",
        1, "red"
    ]
});
```

[См. пример в реальном времени](map-add-line-layer.md#line-stroke-gradient)

### <a name="text-field-format-expression"></a>Выражение формата текстового поля

Выражение формата текстового поля можно использовать с `textField` параметром свойства «слои символов» `textOptions` для обеспечения форматирования смешанного текста. Это выражение позволяет указать набор входных строк и параметров форматирования. Для каждой входной строки в этом выражении можно указать следующие параметры.

 * `'font-scale'` — Задает коэффициент масштабирования для размера шрифта. Если указано, это значение переопределит `size` свойство объекта `textOptions` для отдельной строки.
 * `'text-font'` — Указывает одно или несколько семейств шрифтов, которые должны использоваться для этой строки. Если указано, это значение переопределит `font` свойство объекта `textOptions` для отдельной строки.

Следующий псевдокод определяет структуру выражения формата текстового поля. 

```javascript
[
    'format', 
    input1: string, 
    options1: { 
        'font-scale': number, 
        'text-font': string[]
    },
    input2: string, 
    options2: { 
        'font-scale': number, 
        'text-font': string[]
    },
    …
]
```

**Пример**

В следующем примере текстовое поле форматируется путем добавления полужирного шрифта и масштабирования размера шрифта `title` Свойства функции. В этом примере также добавляется `subTitle` свойство функции на новую строку с масштабируемым размером шрифта.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: [
            'format',

            //Bold the title property and scale its font size up.
            ['get', 'title'],
            {
                'text-font': ['literal', ['StandardFont-Bold']],
                'font-scale': 1.25
            },

            '\n', {},   //Add a new line without any formatting.

            //Scale the font size down of the subTitle property. 
            ['get', 'subTitle'],
            { 
                'font-scale': 0.75
            }
        ]
    }
});
```

Этот слой будет отображать функцию Point, как показано на рисунке ниже:
 
<center>

![Изображение компонента Point с форматированным текстовым полем ](media/how-to-expressions/text-field-format-expression.png)</center>

### <a name="number-format-expression"></a>Выражение формата чисел

`number-format`Выражение может использоваться только с `textField` параметром на уровне символов. Это выражение Преобразует предоставленное число в отформатированную строку. Это выражение заключает в оболочку функцию [Number. Толокалстринг](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number/toLocaleString) JavaScript и поддерживает следующий набор параметров.

 * `locale` — Укажите этот параметр для преобразования чисел в строки способом, который соответствует указанному языку. Передайте в этот параметр [тег языка BCP 47](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Intl#Locale_identification_and_negotiation) .
 * `currency` — Для преобразования числа в строку, представляющую валюту. Возможными значениями являются [коды валют ISO 4217](https://en.wikipedia.org/wiki/ISO_4217), например "USD" для доллара США, "EUR" для евро, или "КНИ" для китайского RMB.
 * `'min-fraction-digits'` — Указывает минимальное число десятичных разрядов для включения в строковую версию числа.
 * `'max-fraction-digits'` — Указывает максимальное число десятичных разрядов, включаемых в строковую версию числа.

Следующий псевдокод определяет структуру выражения формата текстового поля. 

```javascript
[
    'number-format', 
    input: number, 
    options: {
        locale: string, 
        currency: string, 
        'min-fraction-digits': number, 
        'max-fraction-digits': number
    }
]
```

**Пример**

В следующем примере выражение используется `number-format` для изменения способа `revenue` отрисовки свойства функции Point в `textField` параметре слоя символов таким образом, что он выглядит как значение доллара США.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: [
            'number-format', 
            ['get', 'revenue'], 
            { 'currency': 'USD' }
        ],

        offset: [0, 0.75]
    }
});
```

Этот слой будет отображать функцию Point, как показано на рисунке ниже:

<center>

![Пример ](media/how-to-expressions/number-format-expression.png) выражения числового формата </center>

### <a name="image-expression"></a>Выражение изображения

Выражение изображения можно использовать с `image` параметрами и на `textField` уровне символов, а также с `fillPattern` параметром слоя многоугольников. Это выражение проверяет, что запрошенное изображение существует в стиле и возвращает либо разрешенное имя изображения, либо `null` , в зависимости от того, находится ли изображение в стиле в данный момент. Этот процесс проверки является синхронным и требует, чтобы изображение было добавлено к стилю перед запросом в аргументе Image.

**Пример**

В следующем примере выражение используется `image` для добавления значка встроенного текста на уровне символов. 

```javascript
 //Load the custom image icon into the map resources.
map.imageSprite.add('wifi-icon', 'wifi.png').then(function () {

    //Create a data source and add it to the map.
    datasource = new atlas.source.DataSource();
    map.sources.add(datasource);

    //Create a point feature and add it to the data source.
    datasource.add(new atlas.data.Point(map.getCamera().center));

    //Add a layer for rendering point data as symbols.
    map.layers.add(new atlas.layer.SymbolLayer(datasource, null, {
        iconOptions: {
            image: 'none'
        },
        textOptions: {
            //Create a formatted text string that has an icon in it.
            textField: ["format", 'Ricky\'s ', ["image", "wifi-icon"], ' Palace']
        }
    }));
});
```

Этот слой будет отображать текстовое поле на уровне символов, как показано на рисунке ниже:

<center>

![Пример ](media/how-to-expressions/image-expression.png) выражения изображения </center>

## <a name="zoom-expression"></a>Выражение масштаба

`zoom`Выражение используется для получения текущего уровня масштаба отображения во время визуализации и определяется как `['zoom']` . Это выражение возвращает число между минимальным и максимальным диапазонами масштаба для сопоставления. Azure Maps Интерактивные элементы управления картой для веб-и Android поддерживают 25 уровней масштабирования с номерами от 0 до 24. Использование `zoom` выражения позволяет динамически изменять стили при изменении масштаба на карте. `zoom`Выражение может использоваться только с `interpolate` `step` выражениями и.

**Пример**

По умолчанию радиусы точек данных, отображаемых на уровне тепловой карт, имеют фиксированный пиксельный радиус для всех уровней масштабирования. По мере масштабирования карт данные объединяются, и слой тепловой карт выглядит иначе. `zoom`Выражение можно использовать для масштабирования радиуса каждого уровня масштаба таким, чтобы каждая точка данных охватывает одну и ту же физическую область на карте. Благодаря этому слой тепловой карт будет выглядеть более статическим и последовательным. Каждый уровень масштаба на карте имеет вдвое больше пикселей по вертикали и горизонтали, чем предыдущий уровень масштаба. При масштабировании радиуса с каждым уровнем масштабирования создается тепловая схема, которая выглядит единообразно на всех уровнях масштабирования. Это можно сделать с помощью `zoom` выражения с `base 2 exponential interpolation` выражением с набором радиуса пикселов для минимального уровня масштаба и масштабируемым радиусом для максимального уровня масштаба, вычисленным как `2 * Math.pow(2, minZoom - maxZoom)` показано ниже.

```javascript 
var layer = new atlas.layer.HeatMapLayer(datasource, null, {
    radius: [
        'interpolate',
        ['exponential', 2],
        ['zoom'],
        
        //For zoom level 1 set the radius to 2 pixels.
        1, 2,

        //Between zoom level 1 and 19, exponentially scale the radius from 2 pixels to 2 * Math.pow(2, 19 - 1) pixels (524,288 pixels).
        19, 2 * Math.pow(2, 19 - 1)
    ]
};
```

[См. пример в реальном времени](map-add-heat-map-layer.md#consistent-zoomable-heat-map)

## <a name="variable-binding-expressions"></a>Выражения привязки переменных

Выражения привязки переменных хранят результаты вычисления в переменной. Таким образом, можно несколько раз ссылаться на результаты вычисления в других местах выражения. Это полезная оптимизация для выражений, в которых участвует много вычислений.

| Выражение | Возвращаемый тип | Описание |
|--------------|---------------|--------------|
| \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;Let,<br/>&nbsp;&nbsp;&nbsp;&nbsp;name1: строка,<br/>&nbsp;&nbsp;&nbsp;&nbsp;Значение1: Any,<br/>&nbsp;&nbsp;&nbsp;&nbsp;имя2: строка,<br/>&nbsp;&nbsp;&nbsp;&nbsp;значение2: Any,<br/>&nbsp;&nbsp;&nbsp;&nbsp;…<br/>&nbsp;&nbsp;&nbsp;&nbsp;чилдекспрессион<br/>\] | | Хранит одно или несколько значений как переменные для использования `var` выражением в дочернем выражении, возвращающем результат. |
| `['var', name: string]` | any | Ссылается на переменную, созданную с помощью `let` выражения. |

**Пример**

В этом примере используется выражение, которое вычисляет доход относительно коэффициента температуры, а затем использует `case` выражение для вычисления различных логических операций с этим значением. `let`Выражение используется для хранения дохода относительно коэффициента температуры, поэтому его необходимо вычислить только один раз. `var`Выражение ссылается на эту переменную так часто, как требуется, без необходимости повторного вычисления.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        //Divide the point features `revenue` property by the `temperature` property and store it in a variable called `ratio`.
        'let', 'ratio', ['/', ['get', 'revenue'], ['get', 'temperature']],
        //Evaluate the child expression in which the stored variable will be used.
        [
            'case',

            //Check to see if the ratio is less than 100, return 'red'.
            ['<', ['var', 'ratio'], 100],
            'red',

            //Check to see if the ratio is less than 200, return 'green'.
            ['<', ['var', 'ratio'], 200],
            'green',

            //Return `blue` for values greater or equal to 200.
            'blue'
        ]
    ]
});
```

## <a name="next-steps"></a>Следующие шаги

Дополнительные примеры кода, реализующие выражения, см. в следующих статьях:

> [!div class="nextstepaction"] 
> [Добавление слоя символов](map-add-pin.md)

> [!div class="nextstepaction"] 
> [Добавление слоя пузырьков](map-add-bubble-layer.md)

> [!div class="nextstepaction"]
> [Добавление слоя линий](map-add-line-layer.md)

> [!div class="nextstepaction"]
> [Добавление слоя многоугольников](map-add-shape.md)

> [!div class="nextstepaction"] 
> [Добавление слоя тепловой карты](map-add-heat-map-layer.md)

Дополнительные сведения о параметрах слоя, поддерживающих выражения:

> [!div class="nextstepaction"] 
> [BubbleLayerOptions](/javascript/api/azure-maps-control/atlas.bubblelayeroptions)

> [!div class="nextstepaction"] 
> [HeatMapLayerOptions](/javascript/api/azure-maps-control/atlas.heatmaplayeroptions)

> [!div class="nextstepaction"] 
> [LineLayerOptions](/javascript/api/azure-maps-control/atlas.linelayeroptions)

> [!div class="nextstepaction"] 
> [PolygonLayerOptions](/javascript/api/azure-maps-control/atlas.polygonlayeroptions)

> [!div class="nextstepaction"] 
> [SymbolLayerOptions interface](/javascript/api/azure-maps-control/atlas.symbollayeroptions) (Интерфейс SymbolLayerOptions)