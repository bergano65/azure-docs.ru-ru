---
title: Выражения стиля на основе данных в Azure Maps веб-пакете SDK | Документация Майкрософт
description: Использование выражений стиля, управляемых данными, в веб-пакете SDK для Azure Maps.
author: rbrundritt
ms.author: richbrun
ms.date: 4/4/2019
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: cpendleton
ms.custom: codepen
ms.openlocfilehash: 6cd69ba8abe243daadf5d517ab7c5a224953cc99
ms.sourcegitcommit: 8cf199fbb3d7f36478a54700740eb2e9edb823e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/25/2019
ms.locfileid: "74480644"
---
# <a name="data-driven-style-expressions-web-sdk"></a>Выражения стиля на основе данных (веб-пакет SDK)

Выражения позволяют применять бизнес-логику к параметрам стилей, которые задают свойства, определенные в каждой фигуре источника данных. Выражения также можно использовать для фильтрации данных в источнике или слое данных. Выражения могут состоять из условной логики, например if-операторы, и также могут использоваться для работы с данными. строковые, логические и математические операторы. 

Стили, управляемые данными, позволяют уменьшить объем кода, необходимого для реализации бизнес-логики вокруг стилей. При использовании с слоями выражения оцениваются во время визуализации в отдельном потоке, что обеспечивает повышенную производительность по сравнению с оценкой бизнес-логики в потоке пользовательского интерфейса.

В следующем видео представлен обзор стилизации на основе данных в Azure Maps веб-пакете SDK.

<br/>

<iframe src="https://channel9.msdn.com/Shows/Internet-of-Things-Show/Data-Driven-Styling-with-Azure-Maps/player" width="960" height="540" allowFullScreen frameBorder="0"></iframe>

Выражения представлены в виде массивов JSON. Первым элементом выражения в массиве является строка, указывающая имя оператора выражения. Например, "+" или "Case". Следующие элементы (если таковые имеются) являются аргументами выражения. Каждый аргумент является либо литеральным значением (строкой, числом, логическим значением или `null`), либо другим массивом выражений. Следующий псевдокод определяет базовую структуру выражения. 

```javascript
[ 
    expression_operator, 
    argument0, 
    argument1, 
    …
] 
```

Azure Maps веб-пакет SDK поддерживает множество типов, которые можно использовать в сочетании с другими выражениями.

| Тип выражений | ОПИСАНИЕ |
|---------------------|-------------|
| [Статистическое выражение](#aggregate-expression) | Выражение, определяющее вычисление, которое обрабатывается по набору данных и может использоваться с параметром `clusterProperties` `DataSource`. |
| [Логические выражения](#boolean-expressions) | Логические выражения предоставляют набор выражений логических операторов для оценки логических сравнений. |
| [Выражения цвета](#color-expressions) | Выражения цвета упрощают создание цветовых значений и манипуляций с ними. |
| [Условные выражения](#conditional-expressions) | Условные выражения предоставляют логические операции, аналогичные операторам if. |
| [Выражения данных](#data-expressions) | Предоставляет доступ к данным свойств в компоненте. |
| [Выражения интерполяции и шага](#interpolate-and-step-expressions) | Выражения интерполяции и шага можно использовать для вычисления значений по кривой с интерполяцией или с пошаговыми функциями. |
| [Выражения для конкретных слоев](#layer-specific-expressions) | Специальные выражения, применимые только к одному слою. |
| [Математические выражения](#math-expressions) | Предоставляет математические операторы для выполнения вычислений на основе данных в платформе выражений. |
| [Выражения строкового оператора](#string-operator-expressions) | Выражения строкового оператора выполняют операции преобразования строк, таких как объединение и преобразование варианта. |
| [Выражения типа](#type-expressions) | Выражения типа предоставляют средства для тестирования и преобразования различных типов данных, таких как строки, числа и логические значения. |
| [Выражения привязки переменных](#variable-binding-expressions) | Выражения привязки переменных позволяют сохранять результаты вычисления в переменной и ссылаться на другие части выражения несколько раз без необходимости повторного вычисления сохраненного значения. |
| [Выражение масштаба](#zoom-expression) | Возвращает текущий уровень масштаба для отображения во время отрисовки. |

Все примеры в этом документе будут использовать следующую функцию для демонстрации различных способов использования различных типов выражений. 

```javascript
{
    "type": "Feature",
    "geometry": {
        "type": "Point",
        "coordinates": [-122.13284, 47.63699]
    },
    "properties": { 
        "id": 123,
        "entityType": "restaurant",
        "revenue": 12345,
        "subTitle": "Building 40", 
        "temperature": 72,
        "title": "Cafeteria", 
        "zoneColor": "red"
    }
}
```

## <a name="data-expressions"></a>Выражения данных

Выражения данных предоставляют доступ к данным свойств в компоненте. 

| Выражение | Тип возвращаемого значения | ОПИСАНИЕ |
|------------|-------------|-------------|
| `['at', number, array]` | object | Извлекает элемент из массива. |
| `['geometry-type']` | строка | Возвращает тип геометрии компонента: Point, MultiPoint, LineString, MultiLineString, многоугольник, Polygon. |
| `['get', string]` | Значение | Возвращает значение свойства из свойств текущего компонента. Возвращает значение null, если запрошенное свойство отсутствует. |
| `['get', string, object]` | Значение | Возвращает значение свойства из свойств указанного объекта. Возвращает значение null, если запрошенное свойство отсутствует. |
| `['has', string]` | логическое значение | Определяет, имеют ли свойства компонента указанное свойство. |
| `['has', string, object]` | логическое значение | Определяет, имеют ли свойства объекта указанное свойство. |
| `['id']` | Значение | Возвращает идентификатор компонента, если он имеется. |
| `['length', string | array]` | number | Возвращает длину строки или массива. |

**Примеры**

Доступ к свойствам функции можно получить непосредственно в выражении с помощью `get` выражения. В следующем примере значение "Зонеколор" функции используется для указания свойства Color пузырькового слоя. 

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: ['get', 'zoneColor'] //Get the zoneColor value.
});
```

Приведенный выше пример будет работать нормально, если все функции-точки имеют свойство `zoneColor`, но в противном случае цвет скорее всего вернется к «черному». Чтобы изменить цвет резервирования, `case` выражение можно использовать в сочетании с выражением `has`, чтобы проверить, существует ли свойство, и, если оно не возвращает цвет отката.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'case', //Use a conditional case expression.

        ['has', 'zoneColor'],   //Check to see if feature has a "zoneColor" property
        ['get', 'zoneColor'],   //If it does, use it.

        'blue'  //If it doesn't, default to blue.
    ]
});
```

Пузырьки и слои символов по умолчанию отображают координаты всех фигур в источнике данных. Это можно сделать, чтобы выделить вершины многоугольника или линии. Параметр `filter` слоя можно использовать для ограничения типа геометрии функций, которые он отображает, с помощью выражения `['geometry-type']` в логическом выражении. В следующем примере уровень пузырькового слоя ограничивается, так что визуализируются только `Point` функции.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    filter: ['==', ['geometry-type'], 'Point']
});
```

В следующем примере разрешается визуализация как `Point`, так `MultiPoint`ных функций. 

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    filter: ['any', ['==', ['geometry-type'], 'Point'], ['==', ['geometry-type'], 'MultiPoint']]
});
```

Точно так же контур многоугольников будет отображаться в слоях линий. Чтобы отключить это поведение на уровне линии, добавьте фильтр, который допускает только функции `LineString` и `MultiLineString`.  

## <a name="math-expressions"></a>Математические выражения

Математические выражения предоставляют математические операторы для выполнения вычислений на основе данных в платформе выражений.

| Выражение | Тип возвращаемого значения | ОПИСАНИЕ |
|------------|-------------|-------------|
| `['+', number, number, …]` | number | Вычисляет сумму указанных чисел. |
| `['-', number]` | number | Вычитает 0 на указанное число. |
| `['-', number, number]` | number | Вычитает первые цифры по второму числу. |
| `['*', number, number, …]` | number | Умножает указанные числа вместе. |
| `['/', number, number]` | number | Делит первое число на второе число. |
| `['%', number, number]` | number | Вычисляет остаток при делении первого числа на второе число. |
| `['^', number, number]` | number | Вычисляет значение первого значения, возведенного в степень второго числа. |
| `['abs', number]` | number | Вычисляет абсолютное значение указанного числа. |
| `['acos', number]` | number | Вычисляет арккосинус указанного числа. |
| `['asin', number]` | number | Вычисляет арксинус указанного числа. |
| `['atan', number]` | number | Вычисляет арктангенс указанного числа. |
| `['ceil', number]` | number | Округляет число до следующего целого числа. |
| `['cos', number]` | number | Вычисляет COS указанного числа. |
| `['e']` | number | Возвращает математическую константу `e`. |
| `['floor', number]` | number | Округляет число до предыдущего целого числа. |
| `['ln', number]` | number | Вычисляет натуральный логарифм заданного числа. |
| `['ln2']` | number | Возвращает математическую константу `ln(2)`. |
| `['log10', number]` | number | Вычисляет десятичный логарифм указанного числа. |
| `['log2', number]` | number | Вычисляет логарифм указанного числа с основанием 2. |
| `['max', number, number, …]` | number | Вычисляет максимальное число в указанном наборе чисел. |
| `['min', number, number, …]` | number | Вычисляет минимальное число в указанном наборе чисел. |
| `['pi']` | number | Возвращает математическую константу `PI`. |
| `['round', number]` | number | Округляет число до ближайшего целого. Среднее значение округляется с нуля. Например, `['round', -1.5]` принимает значение-2. |
| `['sin', number]` | number | Вычисляет синус указанного числа. |
| `['sqrt', number]` | number | Вычисляет квадратный корень из указанного числа. |
| `['tan', number]` | number | Вычисляет тангенс указанного числа. |

## <a name="aggregate-expression"></a>Статистическое выражение

Статистическое выражение определяет вычисление, которое обрабатывается по набору данных и может использоваться с параметром `clusterProperties` `DataSource`. Выходные данные этих выражений должны быть числами или логическими значениями. 

Статистическое выражение принимает три значения; значение оператора, начальное значение и выражение для получения свойства из каждого компонента в данных для применения статистической операции к. Это выражение имеет следующий формат:

```javascript
[operator: string, initialValue: boolean | number, mapExpression: Expression]
```

- Оператор: функция выражения, которая затем применяется к всем значениям, вычисленным `mapExpression` для каждой точки в кластере. Поддерживаемые операторы; 
    - Для чисел: `+`, `*`, `max`, `min`
    - Для логических значений: `all`, `any`
- Инитиалвалуе: начальное значение, для которого выполняется статистическая обработка первого вычисленного значения.
- Мапекспрессион: выражение, применяемое к каждой точке в наборе данных.

**Примеры**

Если все компоненты в наборе данных имеют свойство `revenue`, которое является числом. Общий доход всех точек в кластере, созданных из набора данных, можно вычислить с помощью следующего статистического выражения: `['+', 0, ['get', 'revenue']]`

## <a name="boolean-expressions"></a>Логические выражения

Логические выражения предоставляют набор выражений логических операторов для оценки логических сравнений.

При сравнении значений сравнение строго типизировано. Значения различных типов всегда считаются неравными. Случаи, когда типы во время синтаксического анализа могут различаться, считаются недопустимыми и выдают ошибку синтаксического анализа. 

| Выражение | Тип возвращаемого значения | ОПИСАНИЕ |
|------------|-------------|-------------|
| `['! ', boolean]` | логическое значение | Логическое отрицание. Возвращает `true`, если входные данные `false`, и `false`, если входные данные `true`. |
| `['!= ', value, value]` | логическое значение | Возвращает `true`, если входные значения не равны, `false` в противном случае. |
| `['<', value, value]` | логическое значение | Возвращает `true`, если первые входные данные строго меньше второго, `false` в противном случае. Аргументы должны быть либо строками, либо обоими числами. |
| `['<=', value, value]` | логическое значение | Возвращает `true`, если первые входные данные меньше или равны второму, `false` в противном случае. Аргументы должны быть либо строками, либо обоими числами. |
| `['==', value, value]` | логическое значение | Возвращает `true`, если входные значения равны, `false` в противном случае. Аргументы должны быть либо строками, либо обоими числами. |
| `['>', value, value]` | логическое значение | Возвращает `true`, если первые входные данные строго больше второго, `false` в противном случае. Аргументы должны быть либо строками, либо обоими числами. |
| `['>=' value, value]` | логическое значение | Возвращает `true`, если первый вход больше или равен второму, `false` в противном случае. Аргументы должны быть либо строками, либо обоими числами. |
| `['all', boolean, boolean, …]` | логическое значение | Возвращает `true`, если все входные данные `true`, `false` в противном случае. |
| `['any', boolean, boolean, …]` | логическое значение | Возвращает `true`, если любой из входных данных `true`, `false` в противном случае. |

## <a name="conditional-expressions"></a>Условные выражения

Условные выражения предоставляют логические операции, аналогичные операторам if.

Следующие выражения выполняют условные операции логики над входными данными. Например, выражение `case` предоставляет логику "if/then/else", а `match` выражение как "оператор switch". 

### <a name="case-expression"></a>Выражение CASE

Выражение `case` — это тип условного выражения, который предоставляет оператор if, например, логику (если/then/else). Этот тип выражения выполняет шаги по списку логических условий и возвращает выходное значение первого логического условия, которое имеет значение true.

Следующий псевдокод определяет структуру выражения `case`. 

```javascript
[
    'case',
    condition1: boolean, 
    output1: value,
    condition2: boolean, 
    output2: value,
    ...,
    fallback: value
]
```

**Пример**

В следующем примере выполняется выполнение различных логических условий до тех пор, пока не будет найдено выражение, результатом которого является `true`, а затем возвращается соответствующее значение. Если ни одно логическое условие не `true`, будет возвращено резервное значение. 

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'case',

        //Check to see if the first boolean expression is true, and if it is, return its assigned result.
        ['has', 'zoneColor'],
        ['get', 'zoneColor'],

        //Check to see if the second boolean expression is true, and if it is, return its assigned result.
        ['all', ['has', ' temperature '], ['>', ['get', 'temperature'], 100]],
        'red',

        //Specify a default value to return.
        'green'
    ]
});
```

### <a name="match-expression"></a>Выражение match

Выражение `match` — это тип условного выражения, который предоставляет оператор switch, например логику. Входными данными может быть любое выражение, например `['get', 'entityType']`, возвращающее строку или число. Каждая метка должна быть либо одиночным литеральным значением, либо массивом литеральных значений, значения которых должны быть всеми строками или целыми числами. Входные данные соответствуют, если какое бы то ни было значение в массиве. Каждая метка должна быть уникальной. Если тип входных данных не соответствует типу меток, результатом будет резервное значение.

Следующий псевдокод определяет структуру выражения `match`. 

```javascript
[
    'match',
    input: number | string,
    label1: number | string | (number | string)[], 
    output1: value,
    label2: number | string | (number | string)[], 
    output2: value,
    ...,
    fallback: value
]
```

**Примеры**

В следующем примере показано, как свойство `entityType` функции Point в пузырьковой слое выполняет поиск совпадения. Если найдено совпадение, возвращается указанное значение или возвращается резервное значение.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'match',

        //Get the property to match.
        ['get', 'entityType'],

        //List the values to match and the result to return for each match.
        'restaurant', 'red',
        'park', 'green',

        //Specify a default value to return if no match is found.
        'black'
    ]
});
```

В следующем примере массив используется для перечисления набора меток, которые должны возвращать одно и то же значение. Это гораздо более эффективно, чем перечислять каждую метку по отдельности. В этом случае, если свойство `entityType` имеет значение "Ресторан" или "grocery_store", будет возвращен красный цвет.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'match',

        //Get the property to match.
        ['get', 'entityType'],

        //List the values to match and the result to return for each match.
        ['restaurant', 'grocery_store'], 'red',

        'park', 'green',

        //Specify a default value to return if no match is found.
        'black'
    ]
});
```

В следующем примере используется выражение match для выполнения фильтра типа "в массиве" или "массив содержит", в этом случае выполняется фильтрация данных, имеющих значение идентификатора, которое содержится в списке разрешенных идентификаторов. При использовании выражений с фильтрами результат должен быть логическим значением.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    filter: [
        'match',  

        //Get the property to match.
        ['get', 'id'],  

         //List of values to match.
        [24, 53, 98], 

        //If there is a match, return true.
        true,
    
        //Otherwise return false.
        false
    ]
});
```

### <a name="coalesce-expression"></a>Выражение объединения

`coalesce` выражение проходит через набор выражений до тех пор, пока не будет получено первое значение, отличное от NULL, и не вернет это значение. 

Следующий псевдокод определяет структуру выражения `coalesce`. 

```javascript
[
    'coalesce', 
    value1, 
    value2, 
    …
]
```

**Пример**

В следующем примере используется выражение `coalesce` для задания параметра `textField` слоя символов. Если свойство `title` отсутствует в компоненте или имеет значение `null`, выражение попытается найти свойство `subtitle`, если его отсутствует или `null`, после этого будет возвращаться пустая строка. 

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: [
            'coalesce',

            //Try getting the title property.
            ['get', 'title'],

            //If there is no title, try getting the subtitle. 
            ['get', 'subtitle'],

            //Default to an empty string.
            ''
        ]
    }
});
```

В следующем примере используется выражение `coalesce` для извлечения первого доступного значка изображения, доступного в Map Sprite, из списка указанных имен изображений.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    iconOptions: {
        image: [
            'coalesce',

            //Try getting the image with id 'missing-image'.
            ['image', 'missing-image'],

            //Specify an image id to fallback to. 
            'marker-blue'
        ]
    }
});
``` 

## <a name="type-expressions"></a>Выражения типа

Выражения типа предоставляют средства для тестирования и преобразования различных типов данных, таких как строки, числа и логические значения.

| Выражение | Тип возвращаемого значения | ОПИСАНИЕ |
|------------|-------------|-------------|
| `['literal', array]`<br/><br/>`['literal', object]` | Объект \| массива | Возвращает литеральный массив или значение объекта. Используйте это выражение, чтобы предотвратить вычисление массива или объекта в качестве выражения. Это необходимо, если массив или объект должен возвращаться выражением. |
| `['image', string]` | строка | Проверяет, загружен ли указанный идентификатор изображения в спрайт изображений Maps. Если значение равно, возвращается идентификатор, в противном случае возвращается значение null. |
| `['to-boolean', value]` | логическое значение | Преобразует входное значение в логическое. Результат `false`, если входные данные представляют собой пустую строку, `0`, `false`, `null`или `NaN`; в противном случае его `true`. |
| `['to-color', value]`<br/><br/>`['to-color', value1, value2…]` | color | Преобразует входное значение в цвет. Если указано несколько значений, каждый из них вычисляется по порядку, пока не будет получено первое успешное преобразование. Если ни один из входных данных не может быть преобразован, выражение является ошибкой. |
| `['to-number', value]`<br/><br/>`['to-number', value1, value2, …]` | number | По возможности преобразует входное значение в число. Если входные данные имеют `null` или `false`, результат равен 0. Если входные данные `true`, результат равен 1. Если входные данные являются строкой, она преобразуется в число с помощью функции строки [Тонумбер](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) спецификации языка ECMAScript. Если указано несколько значений, каждый из них вычисляется по порядку, пока не будет получено первое успешное преобразование. Если ни один из входных данных не может быть преобразован, выражение является ошибкой. |
| `['to-string', value]` | строка | Преобразует входное значение в строку. Если входные данные `null`, результат будет `""`. Если входные данные являются логическими, то результатом будет `"true"` или `"false"`. Если входные данные являются числом, оно преобразуется в строку с помощью функции [ToString](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) Number спецификации языка ECMAScript. Если входные данные являются цветом, то они преобразуются в строку цвета в CSS типа RGBA `"rgba(r,g,b,a)"`. В противном случае входные данные преобразуются в строку с помощью функции [JSON. stringify](https://tc39.github.io/ecma262/#sec-json.stringify) спецификации языка ECMAScript. |
| `['typeof', value]` | строка | Возвращает строку, описывающую тип данного значения. |

> [!TIP]
> Если в консоли браузера появляется сообщение об ошибке, похожее на `Expression name must be a string, but found number instead. If you wanted a literal array, use ["literal", [...]].`, значит, в коде есть выражение, которое содержит массив без строки для первого значения. Если требуется, чтобы выражение возвращало массив, заключите массив в выражение `literal`. В следующем примере задается значок `offset` параметра слоя символов, который должен быть массивом, содержащим два числа, с помощью выражения `match` для выбора между двумя значениями смещения на основе значения свойства `entityType` функции Point.
>
> ```javascript
> var layer = new atlas.layer.SymbolLayer(datasource, null, {
>     iconOptions: {
>         offset: [
>             'match',
>
>             //Get the entityType value.
>             ['get', 'entityType'],
>
>             //If the entity type is 'restaurant', return a different pixel offset. 
>             'restaurant', ['literal', [0, -10]],
>
>             //Default to value.
>             ['literal', [0, 0]]
>         ]
>     }
> });
> ```

## <a name="color-expressions"></a>Выражения цвета

Выражения цвета упрощают создание цветовых значений и манипуляций с ними.

| Выражение | Тип возвращаемого значения | ОПИСАНИЕ |
|------------|-------------|-------------|
| `['rgb', number, number, number]` | color | Создает значение цвета из *Красного*, *зеленого*и *синего* компонентов, которые должны находиться между `0` и `255`и альфа-компонентом `1`. Если какой-либо компонент выходит за пределы диапазона, выражение является ошибкой. |
| `['rgba', number, number, number, number]` | color | Создает значение цвета из *Красного*, *зеленого*и *синего* компонентов, которые должны находиться между `0` и `255`и альфа-компонентом в диапазоне `0` и `1`. Если какой-либо компонент выходит за пределы диапазона, выражение является ошибкой. |
| `['to-rgba']` | \[число, число, число, число\] | Возвращает массив из четырех элементов, содержащий *красный*, *зеленый*, *синий*и *альфа* -компоненты цвета ввода в указанном порядке. |

**Пример**

В следующем примере создается и значение цвета RGB с *красным* значением `255`, а также *зеленые* и *синие* значения, вычисляемые путем умножения `2.5` на значение свойства `temperature`. При изменении температуры цвет изменится на другие оттенки *Красного*цвета.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'rgb', //Create a RGB color value.

        255,    //Set red value to 255.

        ['*', 2.5, ['get', 'temperature']], //Multiple the temperature by 2.5 and set the green value.

        ['*', 2.5, ['get', 'temperature']]  //Multiple the temperature by 2.5 and set the blue value.
    ]
});
```

## <a name="string-operator-expressions"></a>Выражения строкового оператора

Выражения строкового оператора выполняют операции преобразования строк, таких как объединение и преобразование варианта. 

| Выражение | Тип возвращаемого значения | ОПИСАНИЕ |
|------------|-------------|-------------|
| `['concat', string, string, …]` | строка | Объединяет несколько строк вместе. Каждое значение должно быть строкой. Используйте выражение типа `to-string` для преобразования других типов значений в строку, если это необходимо. |
| `['downcase', string]` | строка | Преобразует указанную строку в нижний регистр. |
| `['upcase', string]` | строка | Преобразует указанную строку в верхний регистр. |

**Пример**

В следующем примере свойство `temperature` функции Point преобразуется в строку, а затем в конец строки объединяется "° F".

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: ['concat', ['to-string', ['get', 'temperature']], '°F'],

        //Some additional style options.
        offset: [0, -1.5],
        size: 12,
        color: 'white'
    }
});
```

Приведенное выше выражение выводит на карту закрепление с текстом "64 ° F", который накладывается поверх него, как показано на рисунке ниже.

<center>

](media/how-to-expressions/string-operator-expression.png) пример выражения ![строкового оператора </center>

## <a name="interpolate-and-step-expressions"></a>Выражения интерполяции и шага

Выражения интерполяции и шага можно использовать для вычисления значений по кривой с интерполяцией или с пошаговыми функциями. Эти выражения принимают выражение, возвращающее числовое значение в качестве входных данных, например `['get',  'temperature']`. Входное значение вычисляется на основе пар входных и выходных значений, называемых "остановками", для определения значения, которое лучше подходит для интерполяции кривой или функции Step. Входные значения для каждой из них должны быть числами и находиться в возрастающем порядке. Выходные значения должны быть числом, массивом чисел или цветом.

### <a name="interpolate-expression"></a>Выражение интерполяции

Выражение `interpolate` можно использовать для вычисления непрерывного гладкого набора значений путем интерполяции между значениями приостанавливать. Выражение `interpolate`, возвращающее цветовые значения, создает цветовой градиент, в котором значения результатов выбираются из.

Существует три типа методов интерполяции, которые можно использовать в выражении `interpolate`:
 
* `['linear']` — выполняет линейную интерполяцию между парой остановок.
* `['exponential', base]` — выполняет экспоненциальную интерполяцию между остановами. Значение `base` определяет скорость, с которой увеличивается вывод. Более высокие значения приводят к увеличению объема выходных данных в большую сторону диапазона. Значение `base`, близкое к 1, выдает выход, который более линейно увеличивается.
* `['cubic-bezier', x1, y1, x2, y2]` — выполняет интерполяцию с использованием [кривой Безье третьего порядка](https://developer.mozilla.org/docs/Web/CSS/timing-function) , определяемой заданными контрольными точками.

Ниже приведен пример того, как выглядят эти различные типы интерполяций. 

| Линейная  | Экспоненциальная | Кубические Безье |
|---------|-------------|--------------|
| ![Диаграмма линейной интерполяции](media/how-to-expressions/linear-interpolation.png) | ![Экспоненциальный граф интерполяции](media/how-to-expressions/exponential-interpolation.png) | ![Диаграмма интерполяции Безье третьего порядка](media/how-to-expressions/bezier-curve-interpolation.png) |

Следующий псевдокод определяет структуру выражения `interpolate`. 

```javascript
[
    'interpolate',
    interpolation: ['linear'] | ['exponential', base] | ['cubic-bezier', x1, y1, x2, y2],
    input: number,
    stopInput1: number, 
    stopOutput1: value1,
    stopInput2: number, 
    stopOutput2: value2, 
    ...
]
```

**Пример**

В следующем примере используется выражение `linear interpolate` для задания `color` свойства пузырькового слоя на основе свойства `temperature` функции Point. Если значение `temperature` меньше 60, возвращается "Blue", если между 60 и меньше 70, будет возвращен желтый цвет, если между 70 и меньше 80 возвращается "оранжевый", будет возвращено значение "красный".

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'interpolate',
        ['linear'],
        ['get', 'temperature'],
        50,        
        'blue',
        60,
        'yellow',
        70,
        'orange',
        80,
        'red'
    ]
});
```

На следующем рисунке показано, как выбираются цвета для приведенного выше выражения.
 
<center>

Пример](media/how-to-expressions/interpolate-expression-example.png) ![интерполяции выражения </center>

### <a name="step-expression"></a>Выражение шага

`step` выражение можно использовать для вычисления дискретных пошаговых значений результатов путем вычисления [функции кусочно--Constant](http://mathworld.wolfram.com/PiecewiseConstantFunction.html) , определенной в параметре Stop. 

Следующий псевдокод определяет структуру выражения `step`. 

```javascript
[
    'step',
    input: number,
    output0: value0,
    stop1: number, 
    output1: value1,
    stop2: number, 
    output2: value2, 
    ...
]
```

Выражения шага возвращают выходное значение завершения, непосредственно предшествующее входному значению, или первое входное значение, если входные данные меньше первой позиции. 

**Пример**

В следующем примере используется выражение `step` для задания `color` свойства пузырькового слоя на основе свойства `temperature` функции Point. Если значение `temperature` меньше 60, возвращается "Blue", если между 60 и меньше 70, возвращается "Yellow", если между 70 и меньше 80 возвращается "оранжевый", будет возвращено значение "красный".

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'step',
        ['get', 'temperature'],
        'blue',
        60,
        'yellow',
        70,
        'orange',
        80,
        'red'
    ]
});
```

На следующем рисунке показано, как выбираются цвета для приведенного выше выражения.
 
<center>

![пример выражения шага](media/how-to-expressions/step-expression-example.png)
</center>

## <a name="layer-specific-expressions"></a>Выражения для конкретных слоев

Специальные выражения, которые применяются только к определенным слоям.

### <a name="heat-map-density-expression"></a>Выражение плотности тепловой карт

Выражение плотности тепловой карт извлекает значение плотности тепловой карт для каждого пикселя на уровне тепловой карт и определяется как `['heatmap-density']`. Это значение является числом между `0` и `1` и используется в сочетании с выражением `interpolation` или `step` для определения цветового градиента, используемого для раскрашивания тепловой карт. Это выражение можно использовать только в [параметре Color](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.heatmaplayeroptions?view=azure-iot-typescript-latest#color) слоя тепловой карт.

> [!TIP]
> Цвет с индексом 0 в выражении интерполяции или цвет по умолчанию для цвета шага определяет цвет области, в которой нет данных, и может использоваться для определения цвета фона. Многие пользователи предпочитают использовать для этого прозрачный или полупрозрачный черный цвет. 

**Пример**

В этом примере используется выражение интерполяции для создания гладкой цветового градиента для визуализации тепловой карт. 

```javascript 
var layer = new atlas.layer.HeatMapLayer(datasource, null, {
    color: [
        'interpolate',
        ['linear'],
        ['heatmap-density'],
        0, 'transparent',
        0.01, 'purple',
        0.5, '#fb00fb',
        1, '#00c3ff'
    ]
});
```

Помимо использования плавного градиента для выделения тепловой карте, цвета можно указать в наборе диапазонов с помощью выражения `step`. Использование выражения `step` для выделения тепловой карте позволяет разбить плотность на диапазоны, которые более похожи на карту в виде контура или лепестковой диаграммы.  

```javascript 
var layer = new atlas.layer.HeatMapLayer(datasource, null, {
    color: [
        'step',
        ['heatmap-density'],
        'transparent',
        0.01, 'navy',
        0.25, 'navy',
        0.5, 'green',
        0.75, 'yellow',
        1, 'red'
    ]
});
```

Дополнительные сведения см. в документации по [добавлению слоя тепловой карт](map-add-heat-map-layer.md) .

### <a name="line-progress-expression"></a>Выражение хода выполнения строки

Выражение хода выполнения строки получает ход выполнения вдоль линии градиента в слое линий и определяется как `['line-progress']`. Это значение является числом от 0 до 1 и используется в сочетании с выражением `interpolation` или `step`. Это выражение можно использовать только с [параметром строкеградиент]( https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.linelayeroptions?view=azure-iot-typescript-latest#strokegradient) слоя Line. 

> [!NOTE]
> Параметр `strokeGradient` слоя Line требует, чтобы параметр `lineMetrics` источника данных был установлен в значение `true`.

**Пример**

В следующем примере используется выражение `['line-progress']` для применения градиента цвета к штриху линии.

```javascript
var layer = new atlas.layer.LineLayer(datasource, null, {
    strokeGradient: [
        'interpolate',
        ['linear'],
        ['line-progress'],
        0, "blue",
        0.1, "royalblue",
        0.3, "cyan",
        0.5, "lime",
        0.7, "yellow",
        1, "red"
    ]
});
```

[См. пример в реальном времени](map-add-line-layer.md#line-stroke-gradient)

### <a name="text-field-format-expression"></a>Выражение формата текстового поля

Выражение формата текстового поля можно использовать с параметром `textField` в свойстве "слои символов" `textOptions` для обеспечения форматирования смешанного текста. Это выражение позволяет указать набор входных строк и параметров форматирования. Для каждой входной строки в этом выражении можно указать следующие параметры.

 * `'font-scale'` — задает коэффициент масштабирования для размера шрифта. Если указано, это значение переопределит свойство `size` `textOptions` для отдельной строки.
 * `'text-font'` — указывает одно или несколько семейств шрифтов, которые должны использоваться для этой строки. Если указано, это значение переопределит свойство `font` `textOptions` для отдельной строки.
 * `'text-color'` — задает цвет, применяемый к тексту при подготовке к просмотру. 

Следующий псевдокод определяет структуру выражения формата текстового поля. 

```javascript
[
    'format', 
    input1: string, 
    options1: { 
        'font-scale': number, 
        'text-font': string[],
        'text-color': color
    },
    input2: string, 
    options2: { 
        'font-scale': number, 
        'text-font': string[] ,
        'text-color': color
    },
    …
]
```

**Пример**

В следующем примере текстовое поле форматируется путем добавления полужирного шрифта и увеличения размера шрифта для свойства `title` функции. В этом примере также добавляется свойство `subtitle` функции на новую строку с масштабируемым размером шрифта и красным цветом.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: [
            'format',

            //Bold the title property and scale its font size up.
            ['get', 'title'],
            {
                'text-font': ['literal', ['StandardFont-Bold']],
                'font-scale': 1.25
            },

            '\n', {},   //Add a new line without any formatting.

            //Scale the font size down of the subtitle property. 
            ['get', 'subtitle'],
            { 
                'font-scale': 0.75, 
                'text-color': 'red' 
            }
        ]
    }
});
```

Этот слой будет отображать функцию Point, как показано на рисунке ниже:
 
<center>

![изображение компонента Point с форматированным текстовым полем](media/how-to-expressions/text-field-format-expression.png) </center>

### <a name="number-format-expression"></a>Выражение формата чисел

Выражение `number-format` можно использовать только с параметром `textField` слоя символов. Это выражение Преобразует предоставленное число в отформатированную строку. Это выражение заключает в оболочку функцию [Number. Толокалстринг](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number/toLocaleString) JavaScript и поддерживает следующий набор параметров.

 * `locale` — укажите этот параметр для преобразования чисел в строки способом, который соответствует указанному языку. Передайте в этот параметр [тег языка BCP 47](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Intl#Locale_identification_and_negotiation) .
 * `currency` — для преобразования числа в строку, представляющую валюту. Возможными значениями являются [коды валют ISO 4217](https://en.wikipedia.org/wiki/ISO_4217), например "USD" для доллара США, "EUR" для евро, или "КНИ" для китайского RMB.
 * `'min-fraction-digits'` — указывает минимальное число десятичных разрядов для включения в строковую версию числа.
 * `'max-fraction-digits'` — указывает максимальное число десятичных разрядов для включения в строковую версию числа.

Следующий псевдокод определяет структуру выражения формата текстового поля. 

```javascript
[
    'number-format', 
    input: number, 
    options: {
        locale: string, 
        currency: string, 
        'min-fraction-digits': number, 
        'max-fraction-digits': number
    }
]
```

**Пример**

В следующем примере используется выражение `number-format` для изменения способа отрисовки свойства `revenue` функции Point в параметре `textField` слоя символов таким образом, что он выглядит как значение доллара США.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: [
            'number-format', 
            ['get', 'revenue'], 
            { ‘currency’: 'USD' }
        ],

        offset: [0, 0.75]
    }
});
```

Этот слой будет отображать функцию Point, как показано на рисунке ниже:

<center>

](media/how-to-expressions/number-format-expression.png) пример выражения числового формата ![</center>

## <a name="zoom-expression"></a>Выражение масштаба

Выражение `zoom` используется для получения текущего уровня масштаба отображения во время отрисовки и определяется как `['zoom']`. Это выражение возвращает число между минимальным и максимальным диапазонами масштаба для сопоставления. Использование этого выражения позволяет динамически изменять стили при изменении масштаба на карте. Выражение `zoom` может использоваться только с выражениями `interpolate` и `step`.

**Пример**

По умолчанию радиусы точек данных, отображаемых на уровне тепловой карт, имеют фиксированный пиксельный радиус для всех уровней масштабирования. По мере масштабирования на карте объединяются статистические данные, и слой тепловой карт выглядит иначе. `zoom` выражение можно использовать для масштабирования радиуса каждого уровня масштаба таким, чтобы каждая точка данных охватывает одну и ту же физическую область на карте. Это сделает слой тепловой карт более статическим и последовательным. Каждый уровень масштаба на карте имеет вдвое больше пикселей по вертикали и горизонтали, чем предыдущий уровень масштаба. При масштабировании радиуса с каждым уровнем масштабирования будет создана тепловая схема, которая выглядит единообразно на всех уровнях масштабирования. Это можно сделать с помощью выражения `zoom` с выражением `base 2 exponential interpolation`, как показано ниже. 

```javascript 
var layer = new atlas.layer.HeatMapLayer(datasource, null, {
    radius: [
        'interpolate',
        ['exponential', 2],
        ['zoom'],
        
        //For zoom level 1 set the radius to 2 pixels.
        10, 2,

        //Between zoom level 1 and 19, exponentially scale the radius from 2 pixels to 10,000 pixels.
        19, 10000
    ]
};
```

[См. пример в реальном времени](map-add-heat-map-layer.md#consistent-zoomable-heat-map)

## <a name="variable-binding-expressions"></a>Выражения привязки переменных

Выражения привязки переменных хранят результаты вычисления в переменной, чтобы на них можно было ссылаться в других местах выражения несколько раз без необходимости повторного вычисления. Это полезная оптимизация для выражений, в которых задействовано много вычислений.

| Выражение | Тип возвращаемого значения | ОПИСАНИЕ |
|--------------|---------------|--------------|
| \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;Let<br/>&nbsp;&nbsp;&nbsp;&nbsp;name1: String,<br/>&nbsp;&nbsp;&nbsp;&nbsp;значение1: Any,<br/>&nbsp;&nbsp;&nbsp;&nbsp;имя2: String,<br/>&nbsp;&nbsp;&nbsp;&nbsp;value2: Any,<br/>&nbsp;&nbsp;&nbsp;&nbsp;...<br/>&nbsp;&nbsp;&nbsp;&nbsp;Чилдекспрессион<br/>\] | | Хранит одно или несколько значений как переменные для использования выражением `var` в дочернем выражении, возвращающем результат. |
| `['var', name: string]` | любой | Ссылается на переменную, созданную с помощью выражения `let`. |

**Пример**

В этом примере используется выражение, которое вычисляет доход относительно коэффициента температуры, а затем использует выражение `case` для вычисления различных логических операций с этим значением. Выражение `let` используется для хранения дохода относительно коэффициента температуры, чтобы его можно было вычислить только один раз, а выражение `var` ссылается на эту переменную как можно реже, не вычисляя ее повторно.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        //Divide the point features `revenue` property by the `temperature` property and store it in a variable called `ratio`.
        'let', 'ratio', ['/', ['get', 'revenue'], ['get', 'temperature']],
        //Evaluate the child expression in which the stored variable will be used.
        [
            'case',

            //Check to see if the ratio is less than 100, return 'red'.
            ['<', ['var', 'ratio'], 100],
            'red',

            //Check to see if the ratio is less than 200, return 'green'.
            ['<', ['var', 'ratio'], 200],
            'green',

            //Return `blue` for values greater or equal to 200.
            'blue'
        ]
    ]
});
```

## <a name="next-steps"></a>Дополнительная информация

Дополнительные примеры кода, реализующие выражения, см. в следующих статьях:

> [!div class="nextstepaction"] 
> [Добавление слоя символов](map-add-pin.md)

> [!div class="nextstepaction"] 
> [Добавление слоя пузырьков](map-add-bubble-layer.md)

> [!div class="nextstepaction"]
> [Добавить слой линий](map-add-line-layer.md)

> [!div class="nextstepaction"]
> [Добавление слоя многоугольников](map-add-shape.md)

> [!div class="nextstepaction"] 
> [Добавление слоя тепловой карт](map-add-heat-map-layer.md)

Дополнительные сведения о параметрах слоя, поддерживающих выражения:

> [!div class="nextstepaction"] 
> [BubbleLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.bubblelayeroptions?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"] 
> [HeatMapLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.heatmaplayeroptions?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"] 
> [линелайероптионс](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.linelayeroptions?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"] 
> [полигонлайероптионс](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.polygonlayeroptions?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"] 
> [SymbolLayerOptions interface](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.symbollayeroptions?view=azure-iot-typescript-latest) (Интерфейс SymbolLayerOptions) 
