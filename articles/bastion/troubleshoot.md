---
title: Устранение неполадок Azure бастиона | Документация Майкрософт
description: Из этой статьи вы узнаете, как устранять неполадки Azure бастиона.
services: bastion
author: cherylmc
ms.service: bastion
ms.topic: conceptual
ms.date: 10/16/2019
ms.author: cherylmc
ms.openlocfilehash: de112ff441bb53a0b3bc7f4ffa4456f1c241682c
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73512955"
---
# <a name="troubleshoot-azure-bastion"></a>Устранение неполадок Azure бастиона

В этой статье показано, как устранять неполадки Azure бастиона.

## <a name="nsg"></a>Не удалось создать NSG на Азуребастионсубнет

**Вопрос.** При попытке создать NSG в подсети Azure бастиона появляется следующее сообщение об ошибке: *"Группа безопасности сети <NSG name> не имеет необходимых правил для Azure бастиона Subnet азуребастионсубнет"* .

Ответ **.** Если вы создали и примените NSG к *азуребастионсубнет*, убедитесь, что в NSG добавлены следующие правила. Если не добавить эти правила, создание или обновление NSG завершится ошибкой.

1. Подключение к плоскости управления — входящий трафик на 443 из Гатевайманажер
2. Ведение журнала диагностики и другие — исходящий трафик на 443 в AzureCloud (региональные Теги внутри этого тега службы пока не поддерживается).
3. Целевая виртуальная машина — исходящий трафик для 3389 и 22 в VirtualNetwork

Пример правил NSG доступен для справки в [шаблоне](https://github.com/Azure/azure-quickstart-templates/tree/master/101-azure-bastion)быстрого запуска.
Дополнительные сведения см. в [статье Руководство по NSG для Azure бастиона](bastion-nsg.md).

## <a name="sshkey"></a>Не удается использовать ключ SSH с Azure бастиона

**Вопрос.** При попытке просмотра файла ключа SSH возникает следующая ошибка: *"закрытый ключ SSH должен начинаться с-----BEGIN RSA закрытый ключ-----и заканчивается-----End RSA закрытый ключ-----"* .

Ответ **.** Azure бастиона поддерживает только ключи RSA SSH в этот момент времени. Убедитесь, что вы просматриваете файл ключа, который является закрытым ключом RSA для SSH, с открытым ключом, подготовленным на целевой виртуальной машине. 

В качестве примера можно использовать следующую команду, чтобы создать новый ключ RSA SSH.

**SSH-Keygen-t RSA-b 4096-C "email@domain.com"**

Выходные данные:

```
ashishj@dreamcatcher:~$ ssh-keygen -t rsa -b 4096 -C "email@domain.com"
Generating public/private rsa key pair.
Enter file in which to save the key (/home/ashishj/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/ashishj/.ssh/id_rsa.
Your public key has been saved in /home/ashishj/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:c+SBciKXnwceaNQ8Ms8C4h46BsNosYx+9d+AUxdazuE email@domain.com
The key's randomart image is:
+---[RSA 4096]----+
|      .o         |
| .. ..oo+. +     |
|=.o...B==.O o    |
|==o  =.*oO E     |
|++ .. ..S =      |
|oo..   + =       |
|...     o o      |
|         . .     |
|                 |
+----[SHA256]-----+
```

## <a name="domain"></a>Не удается войти в виртуальную машину, присоединенную к домену Windows

**Вопрос.** Мне не удается подключиться к виртуальной машине Windows, присоединенной к домену.

Ответ **.** Azure бастиона поддерживает вход в виртуальную машину, присоединенную к домену, для входа в домен на основе пароля пользователя. При указании учетных данных домена в портал Azure используйте формат имени участника-пользователя (username@domain) вместо формата *домен \ имя_пользователя* для входа. Эта поддержка поддерживается для присоединения к домену или гибридных виртуальных машин (присоединенных к домену, а также к присоединенным к Azure AD). Он не поддерживается для виртуальных машин, присоединенных к Azure AD.

## <a name="filetransfer"></a>Проблемы при переносе файлов

**Вопрос.** Поддерживается ли обмен файлами с Azure бастиона?

Ответ **.** В настоящее время перенос файлов не поддерживается. Мы работаем над добавлением поддержки.

## <a name="blackscreen"></a>Черный экран в портал Azure

**Вопрос.** При попытке подключения с помощью Azure бастиона появляется черный экран на портал Azure.

Ответ **.** Это происходит при возникновении проблемы с сетевым подключением между веб-браузером и Azure бастиона (ваш клиентский брандмауэр Интернета может блокировать трафик WebSocket или аналогичный), а также между бастиона Azure и целевой виртуальной машиной. В большинстве случаев NSG применяется либо к Азуребастионсубнет, либо к целевой подсети виртуальной машины, которая блокирует трафик RDP/SSH в виртуальной сети. Разрешите трафик WebSocket на клиентском брандмауэре Интернета и проверьте группы безопасности сети в подсети целевой виртуальной машины.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в разделе [часто задаваемые вопросы о бастиона](bastion-faq.md).