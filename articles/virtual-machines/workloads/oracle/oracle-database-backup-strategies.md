---
title: Oracle Database стратегий резервного копирования виртуальных машин Azure
description: Варианты резервного копирования баз данных Oracle в среде виртуальных машин Linux в Azure.
author: cro27
ms.service: virtual-machines-linux
ms.subservice: workloads
ms.topic: article
ms.date: 01/28/2021
ms.author: cholse
ms.reviewer: dbakevlar
ms.openlocfilehash: adb455e7a49ead1e8ba8e9845a4e56542528d0b1
ms.sourcegitcommit: 1a98b3f91663484920a747d75500f6d70a6cb2ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2021
ms.locfileid: "99064003"
---
# <a name="oracle-database-in-azure-linux-vm-backup-strategies"></a>Oracle Database в стратегиях резервного копирования виртуальных машин Linux в Azure

Резервные копии базы данных защищают базу данных от потери данных из-за сбоя компонента хранилища и сбоя центра обработки данных. Они также могут быть средством восстановления от человеческого ошибок и способом клонирования базы данных в целях разработки или тестирования. 

В Azure, так как все хранилище очень избыточно и потери одного или нескольких дисков не приводят к сбою базы данных, резервные копии чаще всего используются для защиты от человеческого ошибок, для клонирования операций или хранения данных в соответствии с нормативными требованиями. Они также позволяют защититься от регионального сбоя, когда технология аварийного восстановления, например, не используется. В этом случае резервные копии должны храниться в разных регионах Azure с помощью геоизбыточной репликации, так как они доступны за пределами области базы данных-источника.

## <a name="azure-storage"></a>Хранилище Azure 

[Службы хранилища Azure](../../../storage/common/storage-introduction.md) — это решение облачного хранилища Майкрософт для современных сценариев хранения данных. Служба хранилища Azure предоставляет ряд служб, которые можно использовать для подключения внешнего хранилища к виртуальной машине Linux в Azure, подходящей для баз данных Oracle в качестве носителей резервных копий. Средство резервного копирования, например Oracle RMAN, требуется для инициации операции резервного копирования или восстановления и копирования резервной копии в службу хранилища Azure и обратно.
 
Службы хранилища Azure предлагают следующие преимущества:

-  Надежность и высокая доступность. Избыточность обеспечивает безопасность данных при временных сбоях оборудования. По умолчанию для всех хранилищ используется тройное зеркальное отображение. Также для дополнительной защиты от локальной аварии или стихийного бедствия можно выполнить репликацию данных в другой центр обработки данных или другой географический регион. Таким образом можно обеспечить высокую доступность реплицированных данных в случае неожиданного сбоя.

-  Безопасный уровень. Все данные, записанные в учетную запись хранения Azure, шифруются службой. В службе хранилища Azure предоставляется возможность точного управления доступом к данным.

-  Масштабируемый. Служба хранилища Azure разработана с высокой степенью масштабируемости в соответствии с требованиями к производительности и хранению данных современных приложений.

-  Управляется. Azure обрабатывает аппаратное обслуживание, обновления и критические проблемы.

-  Доступность. Доступ к данным в службе хранилища Azure можно получить из любой точки мира по протоколу HTTP или HTTPS. Корпорация Майкрософт предоставляет клиентские библиотеки для службы хранилища Azure на различных языках, включая .NET, Java, Node.js, Python, PHP, Ruby, Go и т. д., а также на зрелых REST API. Служба хранилища Azure поддерживает скрипты Azure PowerShell и Azure CLI. А портал Azure и Обозреватель службы хранилища Azure обеспечивают удобную визуализацию для работы с данными.

Платформа службы хранилища Azure включает следующие службы данных, которые подходят для использования в качестве носителей резервных копий для базы данных Oracle.

-  Хранилище BLOB-объектов Azure. Высокомасштабируемое хранилище объектов для текстовых и двоичных данных. Также включает поддержку анализа больших данных с помощью Data Lake Storage 2-го поколения.

-  Файлы Azure: управляемые файловые ресурсы для облачных или локальных развертываний.

-  Диски Azure: тома хранилища на уровне блоков для виртуальных машин Azure.

### <a name="cross-regional-storage-mounting"></a>Подключение между региональными хранилищами

Возможность доступа к хранилищу резервных копий в разных регионах является важным аспектом BCDR и полезен для клонирования баз данных из резервных копий в разные географические регионы. Облачное хранилище Azure предоставляет пять уровней [избыточности](../../../storage/common/storage-redundancy.md)
- Локально избыточное хранилище [(LRS)](../../../storage/common/storage-redundancy.md#locally-redundant-storage) , в котором данные реплицируются три раза в одном физическом расположении в основном регионе.  
- Хранилище, избыточное в пределах зоны [(ZRS)](../../../storage/common/storage-redundancy.md#zone-redundant-storage) , где данные защищаются LRS в основном регионе и синхронно реплицируются по трем зонам доступности (AZ) в основном регионе. Каждое AZ также защищено LRS. 
- Geo-Redundant хранилище [(GRS)](../../../storage/common/storage-redundancy.md#geo-redundant-storage) , где данные защищаются LRS в основном регионе и реплицируются асинхронно в дополнительный регион, где он также защищен LRS.
- Хранилище, избыточное в пределах зоны [(гзрс)](../../../storage/common/storage-redundancy.md#geo-redundant-storage) , синхронно копирует данные в трех зонах доступности Azure в основном регионе с помощью ZRS. Затем данные копируются асинхронно в одно физическое расположение в дополнительном регионе. Во всех расположениях данные также защищаются LRS. 
- Доступ для чтения Geo-Redundant хранилище [(RA-GRS)](../../../storage/common/storage-redundancy.md#geo-redundant-storage) и хранилище, избыточное в геозону [(RA-гзрс)](../../../storage/common/storage-redundancy.md#geo-redundant-storage) , допускает доступ только для чтения к данным, реплицируемым в дополнительный регион. 

#### <a name="blob-storage-and-file-storage"></a>Хранилище BLOB-объектов и хранилище файлов

При использовании файлов Azure с протоколами SMB или NFS 4,1 (Предварительная версия) для подключения в качестве хранилища резервных копий Обратите внимание, что файлы Azure не поддерживают геоизбыточное хранилище с доступом на чтение (RA-GRS) и хранилище, избыточное в геозоне с доступом на чтение (RA-ГЗРС). 

Кроме того, если для хранилища резервных копий больше 5 Тиб файлов Azure требуется [функция больших файловых ресурсов](../../../storage/files/storage-files-planning.md) , которая не поддерживает GRS или гзрс избыточность, поддерживается только LRS. 

Хранилище BLOB-объектов Azure с использованием протокола NFS 3,0 (Предварительная версия) в настоящее время поддерживает только избыточность LRS и ZRS.  

Большой двоичный объект Azure, настроенный с любым параметром избыточности, можно подключить с помощью Blobfuse.

#### <a name="recovery-services-vault"></a>Хранилище Служб восстановления 

Хранилище Служб восстановления — это сущность управления, которая хранит точки восстановления, созданные с течением времени, и предоставляет интерфейс для выполнения операций, связанных с резервным копированием (создание резервных копий по требованию, выполнение восстановления и создание политик резервного копирования).
Azure Backup автоматически обрабатывает хранилище для хранилища. Необходимо указать способ репликации хранилища во время создания. Его нельзя изменить после защиты элементов в хранилище. Для параметра региональная избыточность выберите геоизбыточное значение.

Если вы планируете выполнить восстановление на вторичном сервере, в [парном регионе Azure](../../../best-practices-availability-paired-regions.md) включите функцию [восстановления между регионами](../../../backup/backup-create-rs-vault.md) . Если включено восстановление между регионами, хранилище резервных копий перемещается из GRS в геоизбыточное хранилище с доступом на чтение (RA-GRS). 

### <a name="azure-blob-storage"></a>Хранилище BLOB-объектов Azure

Хранилище BLOB-объектов Azure — это экономичная, устойчивая и безопасная облачная служба хранения, которая используется для хранения больших объемов неструктурированных данных и является идеальным носителем для Oracle Database резервных копий. Хранилище BLOB-объектов Azure можно подключить к виртуальной машине Linux в Azure с помощью протокола NFS v 3.0 или Blobfuse (предохранитель Linux).

#### <a name="azure-blob-blobfuse"></a>Blobfuse BLOB-объектов Azure

[Blobfuse](../../../storage/blobs/storage-how-to-mount-container-linux.md) — это проект с открытым исходным кодом, разработанный для предоставления виртуальной файловой системы, поддерживающей хранилище BLOB-объектов Azure. Она использует библиотеку с открытым исходным кодом либфусе для взаимодействия с модулем ядра ПРЕДОХРАНИТЕЛя Linux и реализует операции файловой системы с помощью API-интерфейсов Azure Storage Blob. Blobfuse в настоящее время доступно для дистрибутивов Ubuntu и CentOS/RedHat. Он также доступен для Kubernetes с помощью [драйвера CSI](https://github.com/kubernetes-sigs/blob-csi-driver). 

В то время как общедоступные для всех регионов Azure и работают со всеми типами учетных записей хранения, включая общее назначение v1/v2 и Azure Data Lake Store Gen2, производительность, предлагаемая Blobfuse, была меньше, чем альтернативные протоколы, такие как SMB или NFS. Для пригодности к резервному носителю базы данных мы рекомендуем использовать протоколы SMB или [NFS](../../../storage/blobs/storage-how-to-mount-container-linux.md) для подключения хранилища BLOB-объектов Azure. 

#### <a name="azure-blob-nfs-v30-preview"></a>NFS-версия 3.0 Azure BLOB (Предварительная версия)

Поддержка Azure для протокола NFS v 3.0 теперь доступна в предварительной версии. Поддержка [NFS](../../../storage/blobs/network-file-system-protocol-support.md) позволяет клиентам Windows и Linux подключать контейнер хранилища BLOB-объектов к виртуальной машине Azure. 

NFS 3,0 общедоступная Предварительная версия поддерживает учетные записи хранения GPV2 со стандартными уровнями производительности в следующих регионах: 
- Восточная Австралия
- Республика Корея, центральный регион
- Юго-Центральный регион США. 

Для обеспечения сетевой безопасности учетная запись хранения, используемая для подключения NFS, должна содержаться в виртуальной сети. Безопасность Azure Active Directory (AD), а также списки управления доступом (ACL) пока не поддерживаются в учетных записях с включенной поддержкой протокола NFS 3,0.

### <a name="azure-files"></a>Файлы Azure

Служба " [файлы Azure](../../../storage/files/storage-files-introduction.md) " — это облачная, полностью управляемая распределенная файловая система, которая может быть подключена к локальным или облачным клиентам Windows, Linux или macOS.

Служба файлов Azure предоставляет полностью управляемые межплатформенные файловые ресурсы в облаке, доступные через протокол SMB и протокол NFS (Предварительная версия). В настоящее время служба файлов Azure не поддерживает многопротокольный доступ, поэтому общая папка может быть либо общей папкой NFS, либо общей папкой SMB. Перед созданием файловых ресурсов Azure рекомендуется определить, какой протокол лучше соответствует вашим потребностям.

Файловые ресурсы Azure также можно защищать с помощью Azure Backup в хранилище служб восстановления, предоставляя дополнительный уровень защиты для резервных копий Oracle RMAN.

#### <a name="azure-files-nfs-v41-preview"></a>Служба файлов Azure NFS версии 4.1 (Предварительная версия)

Общие файловые ресурсы Azure можно подключить в дистрибутивах Linux с помощью протокола NFS версии 4.1. В предварительной версии есть ряд ограничений на поддерживаемые функции, которые описаны [здесь](../../../storage/files/storage-files-how-to-mount-nfs-shares.md). 

На этапе предварительной версии служба файлов Azure для NFS v 4.1 также ограничена следующими [регионами](../../../storage/files/storage-files-how-to-mount-nfs-shares.md):
- Восточная часть США (LRS и ZRS)
- восточная часть США 2
- Западная часть США 2
- Западная Европа
- Юго-Восточная Азия
- южная часть Соединенного Королевства
- Восточная Австралия

#### <a name="azure-files-smb-30"></a>Служба файлов Azure SMB 3,0

Файловые ресурсы Azure можно подключить в дистрибутивах Linux с помощью SMB-клиента в ядре. Протокол CIFS, доступный в дистрибутивах Linux, является разновидностью SMB. При подключении SMB-файлов Azure на виртуальных машинах Linux она монтируется в виде файловой системы CIFS типа, и пакет CIFS должен быть установлен. 

Служба "SMB-файлы Azure" общедоступна во всех регионах Azure и отображает те же характеристики производительности, что и протоколы NFS версии 3.0 и v 4.1. Поэтому в настоящее время рекомендуется использовать носители резервного копирования на виртуальных машинах Azure Linux.  

Существует две Поддерживаемые версии SMB, SMB 2,1 и SMB 3,0, с использованием которых можно использовать шифрование при передаче. Однако различные версии ядер Linux имеют разную поддержку SMB 2,1 и 3,0. Кроме того, следует проверить таблицу [здесь](../../../storage/files/storage-how-to-use-files-linux.md) , чтобы убедиться, что приложение поддерживает SMB 3,0. 

Так как служба файлов Azure предназначена для многопользовательского файлового ресурса, существуют определенные характеристики, которые необходимо настроить, чтобы сделать его более подходящим для хранения резервных носителей. Рекомендуется отключить кэширование и задать идентификаторы пользователей и групп для создаваемых файлов.

## <a name="azure-netapp-files"></a>Azure NetApp Files

Служба [Azure NetApp Files](../../../azure-netapp-files/azure-netapp-files-solution-architectures.md) — это комплексное решение для хранения баз данных Oracle на виртуальных машинах Azure. Созданная на основе высокопроизводительного хранилища файлов в корпоративном классе, поддерживает любой тип рабочей нагрузки и обеспечивает высокую доступность по умолчанию. Вместе с драйвером Oracle Direct NFS (Днфс) Azure NetApp Files предоставляет высокооптимизированный уровень хранилища для Oracle Database.

Azure NetApp Files предоставляет эффективные копии моментальных снимков на основе хранилища в базовой системе хранения, которая использует механизм перенаправления при записи (RoW). Хотя копии моментального снимка чрезвычайно быстро поддаются и восстанавливаются, они служат только в качестве первого набора защитных операций, что может учитывать подавляющее большинство из всех необходимых действий по восстановлению любой конкретной организации, что часто является восстановлением из-за ошибки человека. Однако копии моментальных снимков не являются полной резервной копией. Чтобы охватить все требования к резервному копированию и восстановлению, реплики внешних моментальных снимков и (или) другие резервные копии должны быть созданы в удаленной географической области, чтобы защититься от регионального сбоя. Дополнительные сведения об использовании файлов NetApp для баз данных Oracle в Azure см. в этом [отчете](https://www.netapp.com/pdf.html?item=/media/17105-tr4780pdf.pdf).

## <a name="azure-backup-service"></a>Служба Azure Backup

[Azure Backup](../../../backup/backup-overview.md) — это полностью управляемая PaaS, которая предоставляет простые, безопасные и экономичные решения для резервного копирования данных и восстановления их из облака Microsoft Azure. Azure Backup может выполнять резервное копирование и восстановление локальных клиентов, виртуальных машин Azure, общих папок Azure, а также баз данных SQL Server, Oracle, MySQL, PostreSQL и SAP HANA на виртуальных машинах Azure. 

Служба Azure Backup предоставляет независимые и изолированные резервные копии для защиты от случайного удаления исходных данных. Резервные копии хранятся в [хранилище служб восстановления](../../../backup/backup-azure-recovery-services-vault-overview.md) со встроенным управлением точками восстановления. Конфигурация и масштабируемость просты, резервные копии оптимизированы, и вы можете легко восстанавливать их по мере необходимости. Он использует базовую мощность и масштаб в облаке Azure для обеспечения высокого уровня доступности без затрат на обслуживание или мониторинг. Azure Backup не ограничивает объем входящих или исходящих данных, которые вы передаете, или плату за передаваемые данные, а также защиту данных при передаче и хранении. 

Для обеспечения устойчивости Azure Backup предлагает несколько типов репликации для обеспечения высокой доступности резервных копий данных.

- Локально избыточное хранилище [(LRS)](../../../storage/common/storage-redundancy.md#locally-redundant-storage) реплицирует данные три раза (они создают три копии данных) в единице масштабирования хранилища в центре обработки данных.
- Геоизбыточное хранилище [(GRS)](../../../storage/common/storage-redundancy.md#geo-redundant-storage) — это рекомендуемый вариант репликации по умолчанию. Геоизбыточное хранилище реплицирует данные в дополнительный регион, который находится в сотнях километров от основного расположения данных.

Хранилище, созданное с помощью избыточности GRS, включает возможность настройки функции [восстановления по регионам](../../../backup/backup-create-rs-vault.md#set-storage-redundancy) , которая позволяет восстанавливать данные во вторичном регионе в паре с Azure.

Azure Backup служба предоставляет [платформу](../../../backup/backup-azure-linux-app-consistent.md) для обеспечения согласованности приложений во время резервного копирования виртуальных машин Windows и Linux для различных приложений, таких как Oracle, MySQL, Mongo DB, SAP HANA и PostgreSQL, называемых моментальными снимками, согласованными с приложениями. Это подразумевает вызов предварительного сценария (для замораживания приложений) перед созданием моментального снимка дисков и вызовом командлета POST-Script (команды для разморозки приложений) после завершения создания моментального снимка для возврата приложений в нормальный режим. В то время как образцы предварительных и посторонних сценариев предоставляются на сайте GitHub, вы отвечаете за создание и обслуживание этих сценариев. В случае Oracle база данных должна находиться в режиме ARCHIVELOG, чтобы разрешить оперативное резервное копирование, а соответствующие команды начала и окончания резервного копирования базы данных выполняются в сценариях pre и POST, которые необходимо создать и поддерживать. 

Azure Backup теперь предоставляет [расширенную платформу предварительного и последующей обработки сценариев](https://github.com/Azure/azure-linux-extensions/tree/master/VMBackup/main/workloadPatch/DefaultScripts), которая в настоящее время доступна в предварительной версии, где служба Azure Backup предоставляет Упакованные Предварительные сценарии и посторонние скрипты для выбранных приложений. Azure Backup пользователям просто нужно присвоить имя приложению, а затем служба архивации виртуальных машин Azure автоматически вызовет соответствующие предварительные и посторонние скрипты. Упакованные предварительные и посторонние скрипты будут поддерживаться группой Azure Backup, чтобы пользователи могли быть уверены в поддержке, владении и допустимости этих сценариев. В настоящее время поддерживаемыми приложениями для расширенной платформы являются Oracle и MySQL, и в будущем ожидается больше типов приложений. Моментальный снимок будет полной копией хранилища, а не добавочной или копией моментального снимка записи, поэтому он является эффективным носителем для восстановления базы данных.

## <a name="next-steps"></a>Дальнейшие действия

- [Краткое руководство по созданию Oracle Database](oracle-database-quick-create.md)
- [Резервное копирование Oracle Database в службу файлов Azure](oracle-database-backup-azure-storage.md)
- [Резервное копирование Oracle Database с помощью службы Azure Backup](oracle-database-backup-azure-backup.md)


