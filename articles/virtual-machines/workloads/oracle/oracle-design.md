---
title: Разработка базы данных Oracle и ее реализация в Azure | Документация Майкрософт
description: Разработка базы данных Oracle и ее реализация в среду Azure.
author: dbakevlar
ms.service: virtual-machines-linux
ms.subservice: workloads
ms.topic: article
ms.date: 12/17/2020
ms.author: kegorman
ms.reviewer: tigorman
ms.openlocfilehash: 0b6f4e652ca8fef7bee4165bcd0673be2fa11eac
ms.sourcegitcommit: 100390fefd8f1c48173c51b71650c8ca1b26f711
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "98890770"
---
# <a name="design-and-implement-an-oracle-database-in-azure"></a>Разработка базы данных Oracle и ее реализация в Azure

## <a name="assumptions"></a>Допущения

- Вы планируете перенести базу данных Oracle из локальной среды в Azure.
- У вас есть [Пакет диагностики](https://docs.oracle.com/cd/E11857_01/license.111/e11987/database_management.htm) или [Автоматическое хранилище рабочей нагрузки](https://www.oracle.com/technetwork/database/manageability/info/other-manageability/wp-self-managing-database18c-4412450.pdf) для Oracle Database, которые нужно перенести.
- У вас есть представление о различных метриках в Oracle.
- У вас есть базовое представление о производительности приложения и использовании платформы.

## <a name="goals"></a>Цели

- Получить сведения о том, как оптимизировать развертывание Oracle в Azure.
- Изучить параметры настройки производительности для базы данных Oracle в среде Azure.
- Имеют четкие ожидания между ограничениями физической настройки с помощью архитектуры и преимуществ или логической настройки кода базы данных (SQL) и общей структуры базы данных.

## <a name="the-differences-between-an-on-premises-and-azure-implementation"></a>Различия между реализацией в локальной среде и среде Azure 

Ниже перечислены важные факторы, которые следует учитывать при миграции локальных приложений в Azure. 

Важным отличием является то, что при реализации в Azure ресурсы (например, виртуальные машины, диски и виртуальные сети) можно совместно использовать с другими клиентами. Кроме того, ресурс можно регулировать в соответствии с требованиями. В Azure все нацелено не столько на предотвращение сбоев (MTBF), сколько на восстановление после них (MTTR).

В таблице ниже перечислены некоторые различия между реализацией базы данных Oracle в локальной среде и среде Azure.


|  | Локальная реализация | Реализация в Azure |
| --- | --- | --- |
| **Сеть** |Локальная или глобальная сеть  |SDN (программно-конфигурируемая сеть)|
| **Группа безопасности** |Средства ограничения портов и IP-адресов |[Группа безопасности сети (NSG)](https://azure.microsoft.com/blog/network-security-groups) |
| **Устойчивость** |MTBF (среднее время безотказной работы) |MTTR (среднее время восстановления)|
| **Плановое техническое обслуживание** |Установка исправлений и обновлений|[Группы доступности](/previous-versions/azure/virtual-machines/windows/infrastructure-example) (установка исправлений и обновлений, управляемая Azure) |
| **Ресурс** |Выделенные  |Совместное использование с другими клиентами|
| **Регионы** |Центры обработки данных |[Пары регионов](../../regions.md#region-pairs)|
| **Хранилище** |Сеть SAN и физические диски |[Хранилище под управлением Azure](https://azure.microsoft.com/pricing/details/managed-disks/?v=17.23h)|
| **Масштаб** |Вертикальное масштабирование |Горизонтальное масштабирование|


### <a name="requirements"></a>Требования

- Определите реальную загрузку ЦП по мере того, как база Oracle лицензируется по мере использования ядер, для экономии ресурсов виртуальных ЦП может оказаться существенным. 
- Определите размер базы данных, хранилище службы архивации и скорость роста.
- Определите требования к ВВОДу-выводу, которые можно оценить на основе отчетов Oracle Статспакк и AWR или средств наблюдения за хранилищем на уровне ОС.

## <a name="configuration-options"></a>Параметры конфигурации

В среде Azure есть четыре области, которые можно настроить для повышения производительности:

- размер виртуальной машины;
- Пропускная способность сети
- Типы дисков и их конфигурации
- Настройки кэша дисков.

### <a name="generate-an-awr-report"></a>Создание отчета AWR

Если у вас есть база данных Oracle Enterprise Edition, которую планируется перенести в Azure, у вас есть несколько вариантов. Если у вас есть [Пакет диагностики](https://www.oracle.com/technetwork/oem/pdf/511880.pdf) для экземпляров Oracle, можно запустить отчет Oracle AWR для получения метрик (операций ввода-вывода, Мбит/с, ГБ и т. д.). Для этих баз данных без лицензии пакета диагностики или базы данных выпуска Standard эти же важные метрики можно собрать с отчетом Статспакк после сбора моментальных снимков вручную.  Основное различие между этими двумя методами создания отчетов заключается в том, что служба AWR автоматически собирается и предоставляет дополнительные сведения о базе данных, чем вариант Статспакк Reporting.

Вы можете запустить отчет AWR во время обычной и пиковой рабочей нагрузки, чтобы сравнить результаты. Чтобы получить более точную рабочую нагрузку, рассмотрите возможность использования расширенного отчета в течение одной недели, а также 24-часового запуска и учитывайте, что AWR обеспечивает средние значения в рамках вычислений в отчете.  Для миграции центра обработки данных рекомендуется собирать отчеты для определения их размера на рабочих системах и оценки оставшихся копий базы, используемых для тестирования, тестирования, разработки и т. д., в процентах (UAT равно рабочей, тестовой и разработке 50% размера рабочей среды и т. д.)

По умолчанию в репозитории AWR хранятся данные за 8 дней и моментальные снимки занимают Почасовые интервалы.  Для запуска отчета AWR из командной строки можно выполнить следующие действия из терминала:

```bash
$ sqlplus / as sysdba
SQL> @$ORACLE_HOME/rdbms/admin/awrrpt.sql;
```

### <a name="key-metrics"></a>Ключевые метрики

В отчете будут предложены следующие сведения:
- Тип отчета: HTML или TEXT (HTML в 12,1, а также дополнительные сведения, чем формат текста).
- Число дней, в течение которых отображаются моментальные снимки (за один час, в течение одного дня отчет будет 168, отличающийся по идентификатору моментальных снимков).
- Начальный SnapshotID для окна отчета.
- Конец SnapshotId для окна отчета.
- Имя отчета, создаваемого сценарием AWR.

При запуске программы AWR в реальном кластере приложений (RAC) отчет командной строки — это авргрпт. SQL, а не авррпт. SQL.  Отчет «g» создаст отчет для всех узлов в базе данных RAC в одном отчете и запускать его на каждом узле RAC.

Ниже перечислены метрики, которые можно получить из отчета:

- Имя базы данных, имя экземпляра и имя узла
- Версия базы данных (поддержка по Oracle)
- ЦП и ядра
- СГА/PGA (и помощники, позволяющие получить сведения о ненужном размере)
- общий объем памяти в ГБ;
- ЦП% занят
- ЦП базы данных
- Операции ввода-вывода (чтение и запись)
- Мбит/с (чтение и запись)
- Пропускная способность сети
- показатель задержек сети (низкий и высокий уровень);
- Основные события ожидания 
- Настройки параметров для базы данных
- Является RAC базы данных, Ексадата с использованием дополнительных функций или конфигураций

### <a name="virtual-machine-size"></a>размер виртуальной машины;

#### <a name="1-estimate-vm-size-based-on-cpu-memory-and-io-usage-from-the-awr-report"></a>1. Оценка размера виртуальной машины на основе использования ЦП, памяти и операций ввода-вывода из отчета AWR

Обратите внимание на пять первых событий переднего плана с наибольшим временем ожидания, которые указывают на проблемные места системы.

Например, в верхней строке представленной ниже схемы приведены данные синхронизации для файла журнала. В строке указано число периодов ожидания перед тем, как LGWR записывает содержимое буфера журнала в файл журнала повторяемых операций. Эти результаты указывают на то, что требуются более производительные диски или хранилище. Кроме того, на схеме указано объем ЦП (число ядер) и объем памяти.

![Снимок экрана, на котором показана синхронизация файла журнала в верхней части таблицы.](./media/oracle-design/cpu_memory_info.png)

На следующей схеме представлены общие показатели операций ввода-вывода для чтения и записи. На момент создания отчета для операций чтения зафиксирован показатель 59 ГБ, а для операций записи — 247,3 ГБ.

![Снимок экрана, показывающий общий ввод-вывод для чтения и записи.](./media/oracle-design/io_info.png)

#### <a name="2-choose-a-vm"></a>2. Выбор виртуальной машины

Далее на основе данных из отчета AWR следует выбрать размер виртуальной машины, который соответствует вашим требованиям. Список доступных виртуальных машин см. в статье об [оптимизации для памяти](../../sizes-memory.md).

#### <a name="3-fine-tune-the-vm-sizing-with-a-similar-vm-series-based-on-the-acu"></a>3. Настройка размера виртуальной машины с помощью аналогичных серий виртуальных машин на основе ACU

Выбрав виртуальные машины, обратите внимание на связанные единицы вычислений Azure (ACU). Можно выбрать разные виртуальные машины на основе значения ACU, которое соответствует вашим требованиям. Дополнительные сведения см. в статье [Единицы вычислений Azure (ACU)](../../acu.md).

![Снимок экрана со страницей единиц ACU](./media/oracle-design/acu_units.png)

### <a name="network-throughput"></a>Пропускная способность сети

На следующей схеме показана связь между пропускной способностью и числом операций ввода-вывода в секунду:

![Снимок экрана с показателями пропускной способности](./media/oracle-design/throughput.png)

Общая пропускная способность сети зависит от следующих показателей:
- объем трафика SQL*Net;
- Мбит/с x число серверов (исходящий поток, например Oracle Data Guard);
- другие факторы, такие как репликация приложений.

![Снимок экрана пропускной способности SQL*Net](./media/oracle-design/sqlnet_info.png)

С учетом требований к пропускной способности сети можно выбрать разные типы шлюзов. К ним относятся шлюзы категории "Базовый", VpnGw и Azure ExpressRoute. Дополнительные сведения см. на странице с [ценами на VPN-шлюзы](https://azure.microsoft.com/pricing/details/vpn-gateway/?v=17.23h).

**Рекомендации**

- Задержка в сети выше, чем в локальном развертывании. Сокращение круговых путей по сети существенно влияет на производительность.
- Консолидируйте приложения с высоким числом транзакций или активные приложения в пределах одной виртуальной машины, чтобы снизить число круговых путей.
- Используйте виртуальные машины с [ускоренной сетью](../../../virtual-network/create-vm-accelerated-networking-cli.md) для повышения производительности сети.
- Для некоторых дистрибутивов Linux рассмотрите возможность включения [поддержки TRIM/](/previous-versions/azure/virtual-machines/linux/configure-lvm#trimunmap-support)unотмена.
- Установите [Oracle Enterprise Manager](https://www.oracle.com/technetwork/oem/enterprise-manager/overview/index.html) на отдельной виртуальной машине.
- По умолчанию огромные страницы не включены в Linux. Рассмотрите возможность включения огромных страниц и установки `use_large_pages = ONLY` на Oracle DB. Это может повысить производительность. Дополнительные сведения см. [здесь](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/refrn/USE_LARGE_PAGES.html#GUID-1B0F4D27-8222-439E-A01D-E50758C88390).

### <a name="disk-types-and-configurations"></a>Типы дисков и их конфигурации

- *Диски ОС по умолчанию.* Диски этого типа обеспечивают хранение постоянных данных и кэширование. Они оптимизированы для доступа к ОС при запуске и не предназначены для транзакционных рабочих нагрузок или рабочих нагрузок хранилищ данных (аналитических нагрузок).

- *Управляемые диски.* Управлять учетными записями хранения, используемыми для дисков виртуальной машины, будет Azure. Вы указываете тип диска (чаще всего SSD для рабочих нагрузок Oracle) и необходимый размер диска. Azure самостоятельно создаст диск и будет управлять им.  SSD (цен. категория "Премиум") управляемый диск доступен только для оптимизированных для памяти и специально спроектированных серий виртуальных машин. Когда вы выберете определенный размер виртуальной машины, в меню отобразятся только доступные номера SKU для хранилища класса Premium с учетом этого размера.

![Снимок экрана страницы управляемых дисков](./media/oracle-design/premium_disk01.png)

Настроив хранилище на виртуальной машине, вы можете выполнить нагрузочный тест дисков перед созданием базы данных. Зная частоту операций ввода-вывода в контексте задержки и пропускной способности, вы сможете определить, поддерживает ли виртуальная машина ожидаемую пропускную способность с целевыми показателями задержки.

Существует ряд средств для тестирования нагрузки приложений, таких как Oracle Orion, SysBench, СЛОБ и FIO.

Повторно запустите нагрузочный тест после развертывания базы данных Oracle. Запустите обычные и пиковые рабочие нагрузки. В результатах отразятся основные показатели вашей среды.  Будьте реалистичны в тестировании рабочей нагрузки — не имеет смысла запускать рабочую нагрузку, не похожую на ту, что будет выполняться на виртуальной машине в реальности.

Поскольку Oracle является базой данных с интенсивным вводом-выводом, очень важно задать размер хранилища на основе частоты операций ввода-вывода, а не размера хранилища. Например, если требуемый показатель для операций ввода-вывода составляет 5000 ГБ, но вам нужно только 200 ГБ, вы по-прежнему можете использовать диск P30 класса Premium, хоть он и обеспечивает хранилище объемом более 200 ГБ.

Из отчета AWR можно узнать скорость операций ввода-вывода. Она определяется журналом повторяемых операций, показателем физических операций чтения и скоростью операций записи.  Всегда проверяйте, что выбранная серия виртуальных машин имеет возможность управлять требованием ввода-вывода для рабочей нагрузки.  Если на виртуальной машине превышено ограничение ввода-вывода, чем хранилище, то максимальное число будет задано виртуальной машиной.

![Снимок экрана страницы отчета AWR](./media/oracle-design/awr_report.png)

Например, скорость повторяемых операций составляет 12,200,000 байт в секунду, что равно 11,63 Мбит/с.
Число операций ввода-вывода в секунду: 12 200 000 / 2358 = 5174.

Получив четкое представление о требованиях к скорости операций ввода-вывода, можно выбрать оптимальное сочетание дисков.

**Рекомендации**

- Для табличного пространства данных распределите рабочую нагрузку операций ввода-вывода между несколькими дисками с помощью управляемого хранилища или Oracle ASM.
- Используйте расширенное сжатие Oracle, чтобы сократить число операций ввода-вывода (для данных и индексов).
- Разделяйте журналы повторяемости, временные и исменяющие табличные пространства на отдельных дисках данных.
- Не размещайте файлы приложений на дисках операционной системы по умолчанию (/dev/sda). Эти диски не оптимизированы для быстрой загрузки виртуальной машины и не могут обеспечить высокую производительность приложений.
- При использовании виртуальных машин серии M в хранилище класса Premium включите [ускоритель записи](../../how-to-enable-write-accelerator.md) на диске журналы повтора.
- Попробуйте переместить журналы повторов с высокой задержкой на диск Ultra.

### <a name="disk-cache-settings"></a>Настройки кэша дисков.

Существует три варианта кэширования узла, но для базы данных Oracle рекомендуется только кэширование только для чтения для рабочей нагрузки базы данных.  ReadWrite может вызвать существенные уязвимости в файле данных, где целью записи является запись в файл, а не кэширование информации.

В отличие от файловой системы или приложения для базы данных рекомендации для кэширования узла доступны только для *чтения*: все запросы кэшируются для будущих операций чтения. Все операции записи продолжают записываться на диск.

**Рекомендации**

Чтобы максимально увеличить пропускную способность, рекомендуется начать с **ReadOnly** для кэширования узла везде, где это возможно. При использовании хранилища класса Premium следует иметь в виду, что при подключении файловой системы с параметрами **ReadOnly** необходимо отключить барьеры. Внесите значения UUID дисков в файл /etc/fstab.

![Снимок экрана: страница "управляемый диск" с параметрами "только чтение" и "нет".](./media/oracle-design/premium_disk02.png)

- Для дисков ОС используйте кэширование для **чтения и записи** по умолчанию и используйте SSD уровня "Премиум" для виртуальных машин с рабочей нагрузкой Oracle.  Также убедитесь, что том, используемый для переключения, также находится на SSD уровня "Премиум".
- Для кэширования используйте **только ReadOnly** для всех файлов. Кэширование только для чтения доступно только для управляемых дисков уровня "Премиум", P30 и выше.  Существует ограничение 4095GiB тома, которое можно использовать с кэшированием только для чтения.  При любом объеме выделения ресурсов кэширование узла по умолчанию будет отключено.

Если рабочие нагрузки значительно отличаются в течение дня и вечером, а Рабочая нагрузка ввода-вывода может поддерживать эту возможность, P1 P20 SSD (цен. категория "Премиум") с пакетной обработкой может обеспечить производительность, необходимую во время загрузки пакетной службы в ночное время или с ограниченным объемом операций ввода-вывода  

## <a name="security"></a>Безопасность

Установив и настроив среду Azure, вы можете приступать к обеспечению защиты сети. Вот несколько рекомендаций.

- *Политика NSG:* NSG можно определить для подсети или сетевого адаптера. Проще управлять доступом на уровне подсети, как для безопасности, так и для принудительной маршрутизации таких вещей, как брандмауэры приложений.

- *Jumpbox:* для более безопасного доступа администраторы не должны напрямую подключаться к службам приложений или базам данных. jumpbox используется в качестве носителя между ресурсами Azure и компьютером администратора.
![Снимок экрана страницы топологии Jumpbox](./media/oracle-design/jumpbox.png)

    Компьютер администратора должен предоставлять доступ только к Jumpbox. Для Jumpbox следует предоставить доступ к базам данных и приложениям.

- *Частная сеть (подсети):* рекомендуем устанавливать службу приложений и базу данных в разных подсетях, чтобы политика NSG могла настроить расширенные возможности управления.


## <a name="additional-reading"></a>Дополнительные материалы для чтения

- [Настройка Oracle ASM](configure-oracle-asm.md)
- [Настройка Oracle Data Guard](configure-oracle-dataguard.md)
- [Реализация Oracle Golden Gate на виртуальной машине Azure под управлением Linux](configure-oracle-golden-gate.md)
- [Создание резервных копий и восстановление базы данных Oracle Database 12c на виртуальной машине Linux в Azure](./oracle-overview.md)

## <a name="next-steps"></a>Дальнейшие действия

- Изучите [руководство по созданию высокодоступных виртуальных машин](../../linux/create-cli-complete.md).
- [Изучите примеры развертывания виртуальных машин с помощью интерфейса командной строки](https://github.com/Azure-Samples/azure-cli-samples/tree/master/virtual-machine).
