---
title: Установка SAP HANA на сервере SAP HANA в Azure (крупные экземпляры) | Документация Майкрософт
description: Инструкции по установке SAP HANA в SAP HANA в Azure (крупные экземпляры).
services: virtual-machines-linux
documentationcenter: ''
author: hermanndms
manager: gwallace
editor: ''
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 03/05/2019
ms.author: rclaus
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: bbbfad7f9fa1c5515b187114277f054f7c5ea84b
ms.sourcegitcommit: c105ccb7cfae6ee87f50f099a1c035623a2e239b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2019
ms.locfileid: "67709569"
---
# <a name="how-to-install-and-configure-sap-hana-large-instances-on-azure"></a>Как установить и настроить SAP HANA в Azure (крупные экземпляры)

Перед чтением этой статьи ознакомьтесь с [основными терминами в контексте крупных экземпляров HANA](hana-know-terms.md) и [номерами SKU крупных экземпляров HANA](hana-available-skus.md).

Вы ответственны за установку SAP HANA. Установив подключение между виртуальными сетями Azure и единицами крупных экземпляров HANA, можно приступить к установке нового SAP HANA на сервере Azure (крупные экземпляры). 

> [!Note]
> Согласно политике SAP установку SAP HANA должен выполняться лицо, кто прошел Certified SAP технологии экзамен, сертификационный экзамен по установке SAP HANA, либо сертифицированными SAP системного интегратора (SI).

Если вы планируете установить HANA 2.0, см. документ [SAP support note #2235581 — SAP HANA: Supported operating systems](https://launchpad.support.sap.com/#/notes/2235581/E) (Примечание по поддержке SAP №2235581. SAP HANA: поддерживаемые операционные системы), чтобы убедиться, что используемая ОС поддерживается выпуском SAP HANA, который вы устанавливаете. В поддерживаемой ОС для HANA 2.0 больше ограничений, чем в ОС для HANA 1.0. 

> [!IMPORTANT] 
> В настоящее время для единиц типа II поддерживается только ОС версии SLES 12 SP2. 

Прежде чем начать установку HANA, необходимо проверить следующее:
- [единицы HLI](#validate-the-hana-large-instance-units);
- [конфигурацию операционной системы](#operating-system);
- [Конфигурация сети](#networking)
- [Конфигурация хранилища](#storage)


## <a name="validate-the-hana-large-instance-units"></a>Проверка единиц крупного экземпляра HANA

Когда вы получите единицу крупного экземпляра HANA от корпорации Майкрософт, проверьте указанные ниже параметры и внесите необходимые изменения.

**Первый шаг** после получения крупного экземпляра HANA и установки подключения к экземплярам заключается в регистрации ОС экземпляра через поставщика ОС. Этот шаг также включает регистрацию операционной системы SUSE Linux в экземпляре SUSE SMT, который развернут на виртуальной машине в Azure. 

К этому экземпляру SMT может подключаться единица крупного экземпляра HANA. (Дополнительные сведения см. в статье [Настройка сервера SMT для SUSE Linux](hana-setup-smt.md)). Операционную систему Red Hat также можно зарегистрировать в диспетчере подписок Red Hat, к которому нужно подключиться. Для получения дополнительных сведений см. комментарии в [Что такое SAP HANA в Azure (большие экземпляры)?](https://docs.microsoft.com/azure/virtual-machines/linux/sap-hana-overview-architecture?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). 

Этот шаг является обязательным для установки исправлений операционной системы, который отвечает за клиента. Для SUSE на странице [установки SMT](https://www.suse.com/documentation/sles-12/book_smt/data/smt_installation.html) найдите документацию по установке и настройке SMT.

**Второй шаг** заключается в проверке наличия новых обновлений и исправлений для определенного выпуска или версии операционной системы. Проверьте, что используется последняя версия крупного экземпляра HANA. Возможны варианты, которые не включают последние исправления. После получения единицы крупного экземпляра HANA проверьте, нужно ли применить исправления.

**Третий шаг** заключается в получении соответствующих примечаний к заметкам SAP по установке и настройке SAP HANA в определенной версии или выпуске операционной системы. Из-за изменения рекомендаций или примечаний к заметкам SAP, а также конфигураций, которые зависят от отдельных сценариев установки, Майкрософт не всегда может обеспечить правильную настройку единицы крупного экземпляра HANA. 

Вы как клиент должны обязательно ознакомиться с примечаниями к SAP, относящимися к SAP HANA в вашем выпуске Linux. Проверьте настройки выпуска или версии операционной системы и примените параметры конфигурации, если это еще не сделано.

Проверьте приведенные ниже параметры и измените их значения на следующие:

- net.core.rmem_max = 16777216;
- net.core.wmem_max = 16777216;
- net.core.rmem_default = 16777216;
- net.core.wmem_default = 16777216;
- net.core.optmem_max = 16777216;
- net.ipv4.tcp_rmem = 65536 16777216 16777216;
- net.ipv4.tcp_wmem = 65536 16777216 16777216.

Начиная с SLES 12 с пакетом обновления 1 (SP1) и RHEL 7.2, эти параметры необходимо определить в файле конфигурации в каталоге /etc/sysctl.d. Например, в этом каталоге должен находиться файл конфигурации с именем 91-NetApp-HANA.conf. В предыдущих выпусках SLES и RHEL эти параметры необходимо задать в файле /etc/sysctl.conf.

Для всех выпусков RHEL, начиная с RHEL 6.3, необходимо учитывать следующее: 
- параметр sunrpc.tcp_slot_table_entries = 128 необходимо задать в файле in/etc/modprobe.d/sunrpc-local.conf. Если этот файл отсутствует, его необходимо создать, добавив следующую запись: 
    - options sunrpc tcp_max_slot_table_entries=128.

**Четвертый шаг** заключается в проверке системного времени единицы крупного экземпляра HANA. Экземпляры развертываются с помощью часового пояса. Этот часовой пояс — это расположение региона Azure, в котором расположен стек крупных экземпляров HANA. Системное время и часовой пояс экземпляров можно изменить. 

При добавлении новых экземпляров к клиенту необходимо соответствующим образом изменить их часовой пояс. Ресурсы Майкрософт не имеют доступ к сведениям о настройке часового пояса системы в экземплярах после передачи их в эксплуатацию. Поэтому часовой пояс новых экземпляров может отличаться от установленного вами. В результате вы как клиент должны проверить и при необходимости изменить часовой пояс полученных экземпляров. 

**Пятый шаг** заключается в проверке etc/hosts. После передачи в колонках для разных целей назначены отдельные IP-адреса. Проверьте файл/etc/hosts. При добавлении единиц к существующему клиенту в файле etc/hosts новых систем могут быть неправильно настроены IP-адреса предыдущих систем. Вы как пользователь обязаны проверить правильность конфигурации. Это позволит новым экземплярам взаимодействовать с ранее развернутыми единицами в клиенте и разрешать их имена. 


## <a name="operating-system"></a>Операционная система

> [!IMPORTANT] 
> В настоящее время для единиц типа II поддерживается только версия ОС SLES 12 SP2. 

Для области буфера доставленного образа ОС выделено 2 ГБ в соответствии с документом [SAP support note #1999997 — FAQ: SAP HANA memory](https://launchpad.support.sap.com/#/notes/1999997/E) (Примечание по поддержке SAP №1999997. Часто задаваемые вопросы: память SAP HANA). В качестве клиента необходимо самостоятельно задать требуемый параметр.

Для SAP HANA в Azure (большие экземпляры) используется дистрибутив [SUSE Linux Enterprise Server 12 SP1 для приложений SAP](https://www.suse.com/products/sles-for-sap/download/). Этот дистрибутив предоставляет все необходимые для SAP функции без дополнительной настройки (в том числе предварительно настроенные параметры для эффективного запуска SAP на сервере SLES).

В разделе [библиотеки ресурсов и технической документации](https://www.suse.com/products/sles-for-sap/resource-library#white-papers) на веб-сайте SUSE и на [странице SAP для SUSE](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+on+SUSE) в сетевом сообществе SAP (SCN) доступно несколько полезных ресурсов, в которых описывается развертывание SAP HANA на SLES (в том числе настройки высокой доступности, методы обеспечения безопасности для работы SAP и многое другое).

Дополнительные сведения и полезные ссылки по SAP в SUSE см. ниже.

- [SAP HANA на сайте SUSE Linux](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+on+SUSE).
- [Best practices for SAP: Enqueue replication — SAP NetWeaver High Availability on SUSE Linux Enterprise 12](https://www.suse.com/docrepcontent/container.jsp?containerId=9113) (Рекомендации по SAP. Постановка репликации в очередь. Высокая доступность SAP NetWeaver в SUSE Linux Enterprise 12)
- [ClamSAP — SLES Virus Protection for SAP](https://scn.sap.com/community/linux/blog/2014/04/14/clamsap--suse-linux-enterprise-server-integrates-virus-protection-for-sap) (ClamSAP — защита от вирусов на сервере SLES для SAP) (включая SLES 12 для приложений SAP).

Примечания по поддержке SAP, применимые к реализации SAP HANA на SLES 12, см. ниже.

- [SAP Support Note #1944799 — SAP HANA Guidelines for SLES Operating System Installation](https://go.sap.com/documents/2016/05/e8705aae-717c-0010-82c7-eda71af511fa.html) (Примечание по поддержке SAP №1944799. Рекомендации по установке SAP HANA в ОС SLES).
- [SAP Support Note #2205917 — SAP HANA DB Recommended OS Settings for SLES 12 for SAP Applications](https://launchpad.support.sap.com/#/notes/2205917/E) (Примечание по поддержке SAP №2205917. База данных SAP HANA: рекомендуемые параметры ОС для SLES 12 для приложений SAP).
- [SAP Support Note #1984787 — SUSE Linux Enterprise Server 12: Installation Notes](https://launchpad.support.sap.com/#/notes/1984787) (Примечание по поддержке SAP №1984787. Заметки об установке SUSE Linux Enterprise Server 12).
- [SAP support note #171356 — SAP software on Linux:  General information](https://launchpad.support.sap.com/#/notes/1984787) (Примечание по поддержке SAP №171356. Общие сведения о ПО SAP на платформе Linux)
- [SAP Support Note #1391070 — Linux UUID Solutions](https://launchpad.support.sap.com/#/notes/1391070) (Примечание по поддержке SAP №1391070. Решения UUID для Linux).

[Red Hat Enterprise Linux для SAP HANA](https://www.redhat.com/en/resources/red-hat-enterprise-linux-sap-hana) — еще одно решение для запуска SAP HANA на крупных экземплярах HANA. Доступны выпуски RHEL 6.7 и 7.2. Обратите внимание, в отличие от виртуальных машин Azure, где поддерживаются только RHEL 7.2 и более новыми версиями, крупные экземпляры HANA также поддерживают RHEL версии 6.7. Мы рекомендуем использовать выпуск RHEL 7.x.

Дополнительные сведения и полезные ссылки по SAP в Red Hat приведены ниже.
- [Сайт SAP HANA в Red Hat Linux](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+on+Red+Hat).

Примечания по поддержке SAP, применимые к реализации SAP HANA на SLES 12, приведены ниже.

- [SAP Support Note #2009879 — SAP HANA Guidelines for Red Hat Enterprise Linux (RHEL) Operating System](https://launchpad.support.sap.com/#/notes/2009879/E) (Примечание по поддержке SAP №2009879. Рекомендации по установке SAP HANA в ОС Red Hat Enterprise Linux (RHEL)).
- [SAP support note #2292690 — SAP HANA DB: Recommended OS settings for RHEL 7](https://launchpad.support.sap.com/#/notes/2292690) (Примечание по поддержке SAP № 2292690. База данных SAP HANA: рекомендуемые параметры операционной системы для RHEL 7)
- [SAP Support Note #2247020 — SAP HANA DB: Recommended OS settings for RHEL 6.7](https://launchpad.support.sap.com/#/notes/2247020) (Примечание по поддержке SAP № 2292690. База данных SAP HANA: рекомендуемые параметры операционной системы для RHEL 6,7)
- [SAP Support Note #1391070 — Linux UUID Solutions](https://launchpad.support.sap.com/#/notes/1391070) (Примечание по поддержке SAP №1391070. Решения UUID для Linux).
- [SAP support note #2228351 — Linux: SAP HANA Database SPS 11 revision 110 (or higher) on RHEL 6 or SLES 11](https://launchpad.support.sap.com/#/notes/2228351) (Примечание по поддержке SAP №2228351. Linux: база данных SAP HANA SPS 11, редакция 110 (или более поздняя), в RHEL 6 или SLES 11)
- [SAP support note #2397039 — FAQ: SAP on RHEL](https://launchpad.support.sap.com/#/notes/2397039) (Примечание по поддержке SAP №2397039. Часто задаваемые вопросы: SAP в RHEL)
- [SAP support note #1496410 — Red Hat Enterprise Linux 6.x: Installation and upgrade](https://launchpad.support.sap.com/#/notes/1496410) (Примечание по поддержке SAP №1496410. Установка и обновление Red Hat Enterprise Linux 6.x)
- [SAP support note #2002167 — Red Hat Enterprise Linux 7.x: Installation and upgrade](https://launchpad.support.sap.com/#/notes/2002167) (Примечание по поддержке SAP №2002167. Установка и обновление Red Hat Enterprise Linux 7.x)

### <a name="time-synchronization"></a>Синхронизация времени

Приложения SAP, построенные на основе архитектуры SAP NetWeaver, чувствительны к разнице системного времени на разных компонентах, образующих систему SAP. Короткие дампы SAP ABAP с ошибкой, озаглавленной ZDATE\_LARGE\_TIME\_DIFF, похожи. Это связано с тем, что эти короткие дампы появляются, когда системное время разных серверов или виртуальных машинах существенно различается.

Для SAP HANA в Azure (крупные экземпляры) синхронизация времени в Azure не применяется к единицам вычисления в стеках больших экземпляров. Эта синхронизация не относится к приложениям SAP, выполняемым на виртуальных машинах Azure, так как Azure гарантирует правильную синхронизацию времени системы. 

В результате потребуется отдельный сервер времени, который будут использовать серверы приложений SAP, работающие на виртуальных машинах Azure, и экземпляры баз данных SAP HANA, работающие на HANA (крупные экземпляры). Для инфраструктуры хранения в стеках крупных экземпляров время синхронизируется с серверами NTP.


## <a name="networking"></a>Сеть
В этом разделе предполагается, что вы следовали рекомендациям по проектированию виртуальных сетей Azure и их подключению к крупным экземплярам HANA, приведенным в следующих документах:

- [Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-overview-architecture)
- [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

При проектировании сети отдельной единицы следует учитывать некоторые моменты. Каждой единице крупного экземпляра HANA выделяется два или три IP-адреса, которые назначаются соответствующему числу портов сетевого адаптера. Три IP-адреса используются в масштабируемых конфигурациях HANA или в сценарии репликации системы HANA. Один из IP-адресов, назначенных сетевому адаптеру единицы, выделяется из диапазона серверного пула IP-адресов. Дополнительные сведения см. в статье [Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-overview-architecture).

Дополнительные сведения о Ethernet по архитектуре см. в разделе [Поддерживаемые сценарии для крупных экземпляров HANA](hana-supported-scenario.md).

## <a name="storage"></a>Хранилище

Структура хранения для SAP HANA в Azure (крупные экземпляры) настраивается с помощью классической модели развертывания с применением рекомендаций SAP. Рекомендации описаны в техническом документе с описанием [требований к хранилищу SAP HANA](https://go.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html). 

Приблизительные размеры разных томов с различными SKU крупных экземпляров HANA задокументированы в статье [Что такое SAP HANA в Azure (большие экземпляры)?](hana-overview-architecture.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

Соглашения об именовании томов хранилища перечислены в следующей таблице.

| Использование хранилища | Имя подключения | Имя тома | 
| --- | --- | ---|
| Данные HANA | /hana/data/SID/mnt0000\<m> | IP хранилища: /hana_data_SID_mnt00001_tenant_vol |
| Журнал HANA | /hana/log/SID/mnt0000\<m > | IP хранилища: /hana_log_SID_mnt00001_tenant_vol |
| Резервная копия журнала HANA | /hana/log/backups | IP хранилища: /hana_log_backups_SID_mnt00001_tenant_vol |
| Общий HANA | /hana/shared/SID | IP хранилища: /hana_shared_SID_mnt00001_tenant_vol/shared |
| usr/sap | /usr/sap/SID | IP хранилища: /hana_shared_SID_mnt00001_tenant_vol/usr_sap |

*SID* — это системный идентификатор экземпляра HANA. 

*Tenant* — это внутреннее перечисление операций при развертывании клиента.

HANA usr/sap предоставляет общий доступ к тому. В спецификацию точек подключения входит системный идентификатор экземпляров HANA, а также номер подключения. В масштабируемых развертываниях существует только одно подключение, например, mnt00001. В масштабируемом развертывании будет отображаться столько подключений, сколько рабочих и главных узлов находится в вашем распоряжении. 

В масштабируемой среде данные, журнал, тома журнала резервного копирования являются общими и присоединяются к каждому узлу в масштабируемой конфигурации. Для конфигураций с несколькими экземплярами SAP создается другой набор томов, который присоединяется к единице крупного экземпляра HAN. См. статью [Поддерживаемые сценарии для крупных экземпляров HANA](hana-supported-scenario.md) для изучения конфигурации хранилища для вашего сценария.

После ознакомления с этим документом и оценки единицы крупного экземпляра HANA вы поймете, что эти единицы имеют крупный том диска HANA/data, а также наличие тома HANA/log/backup. Причина, почему мы выделили больше места для HANA/data, заключается в том, что на этот том диска также сохраняются моментальные снимки, созданные с помощью предоставленной нами функции. Чем больше моментальных снимков вы сделали, тем больше требуется пространства. 

Том HANA/log/backup не используется как том для хранения резервных копий базы данных. Его размер походит для использования в качестве архивного тома для резервных копий журнала транзакций HANA. Дополнительные сведения см. в статье [Высокий уровень доступности и аварийное восстановление SAP HANA в Azure (крупные экземпляры)](hana-overview-high-availability-disaster-recovery.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). 

Кроме предоставленного хранилища можно приобрести дополнительную емкость хранилища с шагом приращения 1 ТБ. Это дополнительное хранилище добавляется к HANA (крупные экземпляры) как новые тома.

Во время подключения средств управления службой SAP HANA в Azure клиент указывает ИД пользователя (UID) и группы (GID) для пользователя sidadm и группы sapsys (например, 1000,500). Во время установки системы SAP HANA необходимо использовать эти же значения. Так как вы хотите развернуть несколько экземпляров HANA, вы получите несколько наборов томов (один набор для каждого экземпляра). В результате во время развертывания необходимо определить приведенные ниже моменты.

- Идентификатор SID разных экземпляров HANA (на его основе получается sidadm).
- Объемы памяти разных экземпляров HANA. Объем памяти каждого экземпляра определяет размер тома в каждом отдельном наборе томов.

Согласно рекомендациям поставщика хранилища для всех подключенных томов настраиваются следующие параметры подключения (кроме LUN загрузки):

- nfs    rw, vers=4, hard, timeo=600, rsize=1048576, wsize=1048576, intr, noatime, lock 0 0

Эти точки подключения настраиваются в /etc/fstab, как показано на следующих снимках экрана.

![fstab подключенных томов в единице крупного экземпляра HANA](./media/hana-installation/image1_fstab.PNG)

Выходные данные команды df -h в единице крупного экземпляра S72m HANA выглядят следующим образом.

![fstab подключенных томов в единице крупного экземпляра HANA](./media/hana-installation/image2_df_output.PNG)


Контроллер хранилища и узлы в стеках больших экземпляров синхронизируются с NTP-серверами. Если выполняется синхронизация с NTP-сервером для единиц SAP HANA в Azure (крупные экземпляры) и виртуальных машин Azure, не должно быть заметного смещения времени между инфраструктурой и единицами вычислений в Azure или стеками крупных экземпляров.

Чтобы оптимизировать хранилище, используемое SAP HANA, необходимо задать следующие параметры конфигурации:

- max_parallel_io_requests 128;
- async_read_submit on;
- async_write_submit_active on;
- async_write_submit_blocks all.
 
Начиная с версии SAP HANA 1.0 и до SPS 12, эти параметры можно указать во время установки базы данных SAP HANA, как описано в [примечании к SAP 2267798](https://launchpad.support.sap.com/#/notes/2267798).

С помощью средства hdbparam можно настроить эти параметры после установки базы данных SAP HANA. 

Хранилище, используемое в крупных экземплярах HANA имеет ограничение размера файла. [Ограничение размера — 16 ТБ](https://docs.netapp.com/ontap-9/index.jsp?topic=%2Fcom.netapp.doc.dot-cm-vsmg%2FGUID-AA1419CF-50AB-41FF-A73C-C401741C847C.html) каждого файла. В отличие от ограничений на размер файла в файловых системах EXT3, HANA не поддерживает неявно из хранилища ограничение, принудительно хранилища крупных экземпляров HANA. В результате HANA не будет автоматически создавать новый файл данных при достижении максимального размера файла 16 ТБ. Как HANA пытается роста файла 16 ТБ, HANA сообщит, что ошибки и сервер индекса будет завершаться со сбоем в конце.

> [!IMPORTANT]
> Во избежание HANA при попытке увеличения файлов данных за пределы максимального размера файла 16 ТБ хранилища крупных экземпляров HANA, необходимо задать следующие параметры в файле конфигурации global.ini SAP HANA
> 
> - datavolume_striping=true
> - datavolume_striping_size_gb = 15000
> - См. также SAP Примечание [#2400005](https://launchpad.support.sap.com/#/notes/2400005)
> - Помните о примечании SAP [#2631285](https://launchpad.support.sap.com/#/notes/2631285)


Это средство не поддерживается в системе SAP HANA 2.0. В таком случае эти параметры необходимо задать, используя команды SQL. Дополнительные сведения см. в [SAP note #2399079: Elimination of hdbparam in HANA 2](https://launchpad.support.sap.com/#/notes/2399079) (Примечание к SAP №2399079. Устранение hdbparam в HANA 2).

Для изучения макета хранилища вашей архитектуры см. статью [Поддерживаемые сценарии для крупных экземпляров HANA](hana-supported-scenario.md).


**Дальнейшие действия**

- См. статью [Пример установки SAP HANA на крупных экземплярах HANA](hana-example-installation.md).










































 







 




