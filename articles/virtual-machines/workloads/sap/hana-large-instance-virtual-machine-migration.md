---
title: Миграция SAP HANA в Azure (крупные экземпляры) на виртуальные машины Azure | Документация Майкрософт
description: Как выполнить миграцию SAP HANA в Azure (крупные экземпляры) на виртуальные машины Azure
services: virtual-machines-linux
documentationcenter: ''
author: bentrin
manager: juergent
editor: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 02/11/2020
ms.author: bentrin
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: fd1267711871b3e55f1a6229e46ae27b360322f6
ms.sourcegitcommit: f15f548aaead27b76f64d73224e8f6a1a0fc2262
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/26/2020
ms.locfileid: "77617038"
---
# <a name="sap-hana-on-azure-large-instance-migration-to-azure-virtual-machines"></a>SAP HANA миграции крупных экземпляров Azure на виртуальные машины Azure
В этой статье описываются возможные сценарии развертывания крупных экземпляров Azure и предлагается подход к планированию и миграции с минимальным временем простоя перехода.

## <a name="overview"></a>Обзор
Так как объявление о больших экземплярах Azure для SAP HANA (ХЛИ) в сентябре 2016, многие клиенты приняли это оборудование как предложение Услуги для своей платформы вычислений в памяти.  В последние годы расширение размера виртуальной машины Azure, связанное с поддержкой масштабного развертывания HANA, превысило максимальное требование к емкости базы данных ERP для корпоративных клиентов.  Мы начнем с того, что клиенты выражают интерес для переноса рабочей нагрузки SAP HANA с физических серверов на виртуальные машины Azure.
Это не пошаговый документ по настройке. В нем описываются общие модели развертывания и предлагаются рекомендации по планированию и миграции.  Цель — вызвать необходимые вопросы для подготовки к уменьшению времени простоя перехода.

## <a name="assumptions"></a>Предположения
Для работы с этой статьей предполагается следующее:
- Единственная заинтересованная особенность — это однородная миграция службы базы данных HANA с крупных экземпляров Hana (ХЛИ) на виртуальную машину Azure без значительных обновлений программного обеспечения или исправлений. Эти небольшие обновления включают использование более новой версии ОС или версии HANA, явно оговоренной в соответствующих примечаниях SAP. 
- Все действия по обновлению и обновлению необходимо выполнить до или после миграции.  Например, SAP HANA МКОС преобразование в развертывание MDC. 
- Подход к миграции, который предложит наименьшее время простоя, SAP HANA репликации системы. Другие методы миграции не являются частью области этого документа.
- Это руководство применимо как для REV3, так и для rev4 номеров SKU ХЛИ.
- Архитектура развертывания HANA во время миграции остается в основном без изменений.  То есть система с одним экземпляром DR останется таким же образом в месте назначения.
- Клиенты проверили и поняли Соглашение об уровне обслуживания (SLA) целевой архитектуры. 
- Коммерческие условия между Хлис и виртуальными машинами различаются. Клиенты должны отслеживать использование виртуальных машин для управления затратами.
- Клиенты понимают, что ХЛИ является выделенной платформой вычислений, а виртуальные машины работают на общей, но изолированной инфраструктуре.
- Клиенты проверили, что целевые виртуальные машины поддерживают предполагаемую архитектуру. Чтобы просмотреть все поддерживаемые номера SKU виртуальной машины, сертифицированные для SAP HANAного развертывания, см. [каталог SAP HANA оборудования](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure).
- Клиенты прошли проверку плана проектирования и миграции.
- Запланируйте виртуальную машину аварийного восстановления вместе с первичным сайтом.  Клиенты не могут использовать ХЛИ в качестве узла аварийного восстановления для первичного сайта, работающего на виртуальных машинах после миграции.
- Клиенты скопировали необходимые файлы резервных копий на целевые виртуальные машины, исходя из требований к восстановлению и соответствию бизнесу. Резервные копии, доступные для виртуальной машины, позволяют выполнять восстановление на определенный момент времени в течение периода перехода.
- Для HSR высокого уровня доступности клиентам необходимо настроить и настроить STONITH Device per SAP HANA HA Guide for [SLES](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-suse-pacemaker) and [RHEL](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-rhel-pacemaker).  Он не является предварительно настроенным как вариант ХЛИ.
- Такой подход не охватывает номера SKU ХЛИ с конфигурацией Оптане.

## <a name="deployment-scenarios"></a>Сценарии развертывания
Общие модели развертывания с клиентами ХЛИ приведены в следующей таблице.  Возможна миграция на виртуальные машины Azure для всех сценариев ХЛИ.  Чтобы воспользоваться преимуществами дополнительных доступных служб Azure, могут потребоваться небольшие архитектурные изменения.

| Идентификатор сценария | Сценарий ХЛИ | Выполнить миграцию на виртуальную машину буквально? | Комментарий |
| --- | --- | --- | --- |
| 1 | [Один узел с одним идентификатором безопасности](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#single-node-with-one-sid) | Да | - |
| 2 | [Один узел с МКОС](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#single-node-mcos) | Да | - |
| 3 | [Один узел с аварийным восстановлением с помощью репликации хранилища](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#single-node-with-dr-using-storage-replication) | Нет | Репликация хранилища недоступна для виртуальной платформы Azure, измените текущее решение аварийного восстановления на HSR или резервное копирование или восстановление. |
| 4 | [Один узел с аварийным восстановлением (многоцелевые) с использованием репликации хранилища](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#single-node-with-dr-multipurpose-using-storage-replication) | Нет | Репликация хранилища недоступна для виртуальной платформы Azure, измените текущее решение аварийного восстановления на HSR или резервное копирование или восстановление. |
| 5 | [HSR с STONITH для обеспечения высокой доступности](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#hsr-with-stonith-for-high-availability) | Да | Нет предварительно настроенных SBD для целевых виртуальных машин.  Выберите и разверните решение STONITH.  Возможные варианты: агент ограждения Azure (поддерживается для [RHEL](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-rhel-pacemaker), [SLES](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-suse-pacemaker)), SBD |
| 6 | [Высокая доступность с помощью HSR, аварийное восстановление с репликацией хранилища](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#high-availability-with-hsr-and-dr-with-storage-replication) | Нет | Замена репликации хранилища для нужд аварийного восстановления с помощью HSR или резервного копирования или восстановления |
| 7 | [Автоматическая отработка отказа узла (1 + 1)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#host-auto-failover-11) | Да | Использование использовании для общего хранилища с виртуальными машинами Azure |
| 8 | [Горизонтальное масштабирование с резервом](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#scale-out-with-standby) | Да | BW/4HANA с M128s, M416s, M416ms виртуальных машин, использующих использовании только для хранилища |
| 9 | [Горизонтальное масштабирование без резерва](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#scale-out-without-standby) | Да | BW/4HANA с виртуальными машинами M128s, M416s, M416ms (с помощью или без использования использовании для хранилища) |
| 10 | [Масштабирование с помощью аварийного восстановления с использованием репликации хранилища](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#scale-out-with-dr-using-storage-replication) | Нет | Замена репликации хранилища для нужд аварийного восстановления с помощью HSR или резервного копирования или восстановления |
| 11 | [Один узел с аварийным восстановлением с помощью HSR](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#single-node-with-dr-using-hsr) | Да | - |
| 12 | [Один узел HSR в аварийное восстановление (оптимизированные затраты)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#single-node-hsr-to-dr-cost-optimized) | Да | - |
| 13 | [Высокая доступность и аварийное восстановление с помощью HSR](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#high-availability-and-disaster-recovery-with-hsr) | Да | - |
| 14 | [HA и DR с HSR (оптимизированные затраты)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#high-availability-and-disaster-recovery-with-hsr-cost-optimized) | Да | - |
| 15 | [Горизонтальное масштабирование с помощью аварийного восстановления с использованием HSR](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#scale-out-with-dr-using-hsr) | Да | BW/4HANA с M128s. M416s, M416ms виртуальные машины (с помощью или без использования использовании для хранилища) |


## <a name="source-hli-planning"></a>Планирование исходного (ХЛИ)
При подключении сервера ХЛИ как управление службами Майкрософт, так и клиенты проходили планирование вычислений, сети, хранилища и параметров, относящихся к конкретной ОС, для запуска базы данных SAP HANA.  Аналогичное планирование необходимо выполнить для миграции на виртуальную машину Azure.

### <a name="sap-hana-housekeeping"></a>SAP HANA обслуживания 
Это хорошее практическое занятие, которое помещает содержимое базы данных таким образом, что нежелательные, устаревшие данные или устаревшие журналы не переносятся в новую базу данных.  Как правило, для обслуживания используются удаление или архивирование старых, просроченных или неактивных данных.  Эти действия "Data санации" следует тестировать в непроизводственных системах, чтобы проверить правильность их сокращения до использования в рабочей среде.

### <a name="allow-network-connectivity-for-new-vms-and-or-virtual-network"></a>Разрешить сетевое подключение для новых виртуальных машин, или виртуальная сеть 
В развертывании ХЛИ клиента сеть настроена на основе сведений, описанных в статье [SAP HANA (крупные экземпляры) сетевая архитектура](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-network-architecture). Кроме того, маршрутизация сетевого трафика выполняется способом, описанным в разделе "Маршрутизация в Azure".
- При настройке новой виртуальной машины в качестве цели миграции, если она размещена в существующей виртуальной сети с диапазонами IP-адресов, которым уже разрешено подключаться к ХЛИ, дальнейшее обновление подключения не требуется.
- Если новая виртуальная машина Azure размещена в новом виртуальная сеть Microsoft Azure, может находиться в другом регионе и быть подключенной к существующей виртуальной сети, ключ службы ExpressRoute и идентификатор ресурса из исходной подготовки ХЛИ можно использовать, чтобы разрешить доступ для этого нового виртуального диапазон IP-адресов сети.  Координирование с управлением службами Майкрософт позволяет обеспечить ХЛИ подключение виртуальной сети.  Примечание. чтобы избежать задержки в сети между уровнями приложения и базы данных, уровни приложения и базы данных должны находиться в одной виртуальной сети.  

### <a name="existing-app-layer-availability-set-availability-zones-and-proximity-placement-group-ppg"></a>Существующая группа доступности уровня приложения, Зоны доступности и группы размещения близости (ППГ)
Текущая модель развертывания выполняется для удовлетворения определенных целей уровня обслуживания.  В этом перемещении убедитесь, что Целевая инфраструктура соответствует целевым показателям или превышает их.  
Скорее всего, клиенты сервера приложений SAP помещаются в группу доступности.  Если текущим уровнем обслуживания развертывания является удовлетворительная и 
- Если целевая виртуальная машина предполагает имя узла логического имени ХЛИ, обновление разрешения адресов службы доменных имен (DNS), указывающего на IP-адрес виртуальной машины, будет работать без обновления профилей SAP.
- Если вы не используете ППГ, не забудьте разместить все серверы приложений и баз данных в одной зоне, чтобы избежать задержки в сети.
- Если вы используете ППГ, обратитесь к разделу этого документа: "Планирование назначения, Группа доступности, Зоны доступности, а также группу размещения с учетом расположения (ППГ)".

### <a name="storage-replication-discontinuance-process-if-used"></a>Процесс прекращения репликации хранилища (если используется)
Если репликация хранилища используется в качестве решения аварийного восстановления, то после завершения работы приложения SAP оно должно быть завершено (не запланировано).  Кроме того, последний каталог SAP HANA, файл журнала и резервные копии данных были реплицированы на удаленные тома хранилища аварийного восстановления ХЛИ.  Это делается в качестве меры предосторожности в случае аварии во время перехода физического сервера на виртуальную машину Azure.

### <a name="data-backups-preservation-consideration"></a>Важность сохранения резервных копий данных
После перерезания в SAP HANA на виртуальной машине Azure все резервные копии данных и журналов на основе моментальных снимков в ХЛИ не будут легко доступны или restorable на виртуальную машину, если это необходимо. В период раннего перехода до того, как резервное копирование на основе Azure создает достаточное количество журналов для удовлетворения требований к восстановлению на определенный момент времени, мы рекомендуем использовать резервные копии на уровне файлов в дополнение к моментальным снимкам в ХЛИ, днях или неделях, прежде чем выполнять отправку.  Эти резервные копии копируются в учетную запись хранения Azure, доступную для новой виртуальной машины SAP HANA.
В дополнение к резервному копированию содержимого ХЛИ, лучше всего создать полные резервные копии в альбоме SAP, которые доступны в случае необходимости отката.

### <a name="adjusting-system-monitoring"></a>Настройка мониторинга системы 
Клиенты используют множество различных средств для мониторинга и отправки уведомлений об оповещениях для систем в своей ландшафте SAP.  Этот элемент является просто вызовом для соответствующего действия, чтобы внести изменения для мониторинга и обновления получателей уведомлений о предупреждениях при необходимости.

### <a name="microsoft-operations-team-involvement"></a>Участие в группе Microsoft Operations 
Откройте билет из портал Azure на основе существующего экземпляра ХЛИ.  После создания запроса в службу поддержки он свяжется с вами по электронной почте.  

### <a name="engage-microsoft-account-team"></a>Привлекать учетная запись Майкрософт команды
Планируйте миграцию ближе к времени продления ХЛИ контракта, чтобы уменьшить излишние расходы на ресурсы вычислений. Чтобы списать колонку ХЛИ, необходимо координировать завершение контракта и фактическое завершение работы единицы.

## <a name="destination-planning"></a>Планирование назначений
Благодаря новой инфраструктуре, которая принимает место существующего, заслуживает некоторого мышления о том, что новое сложение будет помещаться в большой схеме вещей.  Ниже приведены некоторые ключевые моменты для размышления.

### <a name="resource-availability-in-the-target-region"></a>Доступность ресурсов в целевом регионе 
Текущий регион развертывания серверов приложений SAP, как правило, находится в близком близком к связанному Хлис.  Однако Хлис предлагаются в меньшем объеме, чем доступные регионы Azure.  При переносе физического ХЛИ в виртуальную машину Azure также лучше настроить расстояние в близости от всех связанных служб для оптимизации производительности.  При этом одним из ключевых соображений является обеспечение того, что выбранный регион будет иметь все необходимые ресурсы.  Например, доступность определенного семейства виртуальных машин или предложение зон Azure для настройки высокой доступности.

### <a name="virtual-network"></a>Виртуальная сеть 
Клиентам необходимо выбрать, следует ли запускать новую базу данных HANA в существующей виртуальной сети или создать новую.  Основным конструктивным фактором является текущий макет сети для ландшафта SAP.  Кроме того, когда инфраструктура переходит из одной зоны в среду с двумя зонами и использует ППГ, она накладывает изменения архитектуры. Дополнительные сведения см. в статье [Azure ППГ для обеспечения оптимальной сетевой задержки с помощью приложения SAP](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-proximity-placement-scenarios).   

### <a name="security"></a>Безопасность
Является ли новая виртуальная машина виртуальной машины SAP HANA новой или существующей виртуальной сетью или подсетью, она представляет новую критическую для бизнеса службу, требующую защиты.  Управление доступом, совместимое с политикой безопасности сведений о компании, необходимо оценивать и развертывать для этого нового класса службы.

### <a name="vm-sizing-recommendation"></a>Рекомендации по выбору размера виртуальной машины
Эта миграция также позволяет правильно изменить размер подсистемы вычислений HANA.  Вы можете использовать [системные представления](https://help.sap.com/viewer/7c78579ce9b14a669c1f3295b0d8ca16/Cloud/3859e48180bb4cf8a207e15cf25a7e57.html) Hana совместно с Hana Studio, чтобы понять потребление системных ресурсов, что позволяет правильно изменить размер для повышения эффективности затрат.

### <a name="storage"></a>Память 
Производительность хранилища — это один из факторов, влияющих на взаимодействие пользователей с приложениями SAP.  База данных на указанном номере SKU виртуальной машины — это минимальный макет хранилища, опубликованный [SAP HANA конфигураций хранилища виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-vm-operations-storage). Мы рекомендуем просмотреть эти минимальные спецификации и сравнить существующую статистику системы ХЛИ, чтобы обеспечить достаточную емкость операций ввода-вывода и производительность для новой виртуальной машины HANA.

Если вы настроили ППГ для новой виртуальной машины HANA и связанных с ней серверов, отправьте запрос в службу поддержки для проверки и обеспечения совместного размещения хранилища и виртуальной машины. Так как вам может потребоваться изменить решение резервного копирования, следует также повторно посещать затраты на хранение, чтобы избежать непредвиденных расходов на эксплуатацию.

### <a name="storage-replication-for-disaster-recovery"></a>Репликация хранилища для аварийного восстановления
В ХЛИ репликация хранилища была предложена по умолчанию для аварийного восстановления. Эта функция не является параметром по умолчанию для SAP HANA на виртуальной машине Azure. Рассмотрим HSR, резервное копирование и восстановление или другие поддерживаемые решения, удовлетворяющие потребностям вашего бизнеса.

### <a name="availability-sets-availability-zones-and-proximity-placement-groups"></a>Группы доступности, Зоны доступности и групп размещения с учетом расположения 
Чтобы сократить расстояние между уровнем приложения и SAP HANA, чтобы обеспечить минимальную задержку в сети, Новая виртуальная машина базы данных и текущие серверы приложений SAP должны быть помещены в ППГ. Сведения о том, как группа доступности Azure и Зоны доступности работают с ППГ для развертываний SAP, см. в [группе размещения с близкой](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-proximity-placement-scenarios) назначением.
Если члены целевой системы HANA развернуты в нескольких зонах Azure, клиенты должны иметь четкое представление о профиле задержки выбранных зон. Размещение системных компонентов SAP оптимально в отношении расстояния проксимал между приложением SAP и базой данных.  [Средство тестирования задержки зоны доступности](https://github.com/Azure/SAP-on-Azure-Scripts-and-Utilities/tree/master/AvZone-Latency-Test) общедоступного домена упрощает измерение.  


### <a name="backup-strategy"></a>Стратегия резервного копирования
Многие клиенты уже используют сторонние решения резервного копирования для SAP HANA на ХЛИ.  В этом случае необходимо настроить только дополнительную защищенную виртуальную машину и базы данных HANA.  Текущие задания резервного копирования ХЛИ теперь могут быть отпланированы, если после миграции компьютер выполнит списание.
Azure Backup для SAP HANA на виртуальной машине теперь общедоступна.  Ниже приведены ссылки на подробные сведения о [резервном](https://docs.microsoft.com/azure/backup/backup-azure-sap-hana-database)копировании, [восстановлении](https://docs.microsoft.com/azure/backup/sap-hana-db-restore), [управлении](https://docs.microsoft.com/azure/backup/sap-hana-db-manage) SAP HANA резервным копированием на виртуальных машинах Azure.

### <a name="dr-strategy"></a>Стратегия аварийного восстановления
Если цели уровня обслуживания доходят до более длительного времени восстановления, простое резервное копирование в хранилище BLOB-объектов и восстановление на месте или восстановление на новую виртуальную машину — это простейшая и наименее дорогостоящая стратегия АВАРИЙного восстановления.  
Как и платформа крупных экземпляров, где HANA DR обычно выполняется с помощью HSR; На виртуальной машине Azure HSR является также самым естественным и собственным SAP HANAным решением аварийного восстановления.  Независимо от того, является ли развертывание источника одноэкземплярным или кластеризованным, в регионе аварийного восстановления требуется реплика исходной инфраструктуры.
Эта реплика аварийного восстановления будет настроена после завершения миграции первичной ХЛИ в виртуальную машину.  БД аварийного восстановления будет зарегистрирована в первичной SAP HANA экземпляра виртуальной машины в качестве вторичного сайта репликации.  

### <a name="sap-application-server-connectivity-destination-change"></a>Изменение места назначения для подключения к серверу приложений SAP
HSR миграция приводит к новому узлу БД HANA и, следовательно, новому имени узла базы данных для уровня приложения, профили SAP должны быть изменены для отражения нового имени узла.  Если переключение выполняется с помощью разрешения имен, сохраняя имя узла, изменение профиля не требуется.

### <a name="operating-system"></a>Операционная система
Образы операционной системы для ХЛИ и VM, несмотря на тот же уровень выпуска, например SLES 12 SP4, не идентичны. Клиенты должны проверить необходимые пакеты, исправления, исправления, ядро и исправления безопасности в ХЛИ, чтобы установить на целевом компьютере те же пакеты.  HSR можно использовать для репликации из более старой ОС на виртуальную машину с более новой версией ОС.  Проверьте конкретные Поддерживаемые версии, просмотрев [Примечание SAP 2763388](https://launchpad.support.sap.com/#/notes/2763388).

### <a name="new-sap-license-request"></a>Новый запрос лицензии SAP
Простой вызов для запроса новой лицензии SAP для новой системы HANA теперь, чтобы она была перенесена на виртуальные машины.

### <a name="service-level-agreement-sla-differences"></a>Различия в соглашении об уровне обслуживания (SLA)
Авторы, например, называю разницу между ХЛИ и виртуальной машиной Azure.  Например, Хлисные пары доступности с высоким уровнем доступности обеспечивают доступность 99,99%. Для достижения одного и того же соглашения об уровне обслуживания необходимо развернуть виртуальные машины в зонах доступности. В этой [статье](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_9/) описывается доступность с помощью связанных архитектур развертывания, чтобы клиенты могли соответствующим образом спланировать целевую инфраструктуру.


## <a name="migration-strategy"></a>Стратегия миграции
В этом документе мы рассмотрим только подход к репликации системы HANA для миграции с ХЛИ на виртуальную машину Azure.  Зависит от развернутого целевого решения хранилища. Этот процесс немного отличается. Общие действия описаны ниже.

### <a name="vm-with-premiumultra-disks-for-data"></a>Виртуальная машина с Premium или Ultra-Disks для данных
Для виртуальных машин, развернутых с помощью Premium или Ultra-Disks, стандартная конфигурация репликации SAP HANA системы применима для настройки HSR.  В [справочной статье SAP](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.04/099caa1959ce4b3fa1144562fa09e163.html) представлен обзор действий, связанных с настройкой репликации системы, получением дополнительной системы, возвратом к первичной системе и отключением репликации системы.  Для целей миграции потребуется только Настройка, переработка и отключение этапов репликации.  

### <a name="vm-with-anf-for-data-and-log-volumes"></a>Виртуальная машина с использовании для томов данных и журналов
На высоком уровне последние моментальные снимки хранилища ХЛИ для всех томов данных и журналов должны быть скопированы в службу хранилища Azure, где они доступны и могут быть восстановлены целевой виртуальной машиной HANA.  Процесс копирования можно выполнить с помощью любых собственных средств копирования Linux.  

> [!IMPORTANT]
> Копирование и перенос данных может занять несколько часов, зависит от размера базы данных HANA и пропускной способности сети.  Основная часть процесса копирования должна быть выполнена заранее, чем время простоя первичной базы данных HANA.

### <a name="mcos-to-mdc-conversion"></a>Преобразование МКОС в MDC
Некоторые наши клиенты ХЛИ использовали несколько компонентов в одной модели развертывания системы (МКОС).  Мотивация заключается в обходе ограничения на моментальные снимки хранилища контейнеров нескольких баз данных (MDC) более ранних версий SAP HANA.  В модели МКОС несколько независимых экземпляров SAP HANA помещаются в одну колонку ХЛИ.  Использование HSR для миграции будет работать нормально, но при этом несколько виртуальных машин HANA будут иметь одну базу данных клиента.  Это конечное состояние повышает качество, чем может быть у клиента.  При развертывании SAP HANA 2,0 по умолчанию MDC можно выполнить [перемещение клиента Hana](https://launchpad.support.sap.com/#/notes/2472478) после миграции HSR.  Этот процесс объединяет эти независимые базы данных HANA в клиенты в одном контейнере HANA.  

### <a name="application-layer-consideration"></a>Вопросы о прикладном уровне
Сервер базы данных отображается в качестве центра системы SAP.  Все серверы приложений должны располагаться рядом с SAP HANA DB.  В некоторых случаях, когда требуется новое использование ППГ, переместите существующие серверы приложений на ППГ, где может потребоваться виртуальная машина HANA.  Создание новых серверов приложений может быть проще, если шаблоны развертывания уже имеются под рукой.  
Если существующие серверы приложений и Новая виртуальная машина HANA оптимально расположены, новые серверы приложений создавать не нужно, если не требуется дополнительная емкость.  
Если создана новая инфраструктура для повышения доступности служб, существующие серверы приложений могут оказаться ненужными и должны быть выключены и удалены.
Если имя узла целевой виртуальной машины изменилось и отличается от имени узла ХЛИ, необходимо настроить профили сервера приложений SAP, чтобы они указывали на новый узел.  Если изменился только IP-адрес базы данных HANA, необходимо обновить запись DNS, чтобы привести входящие подключения к новой виртуальной машине HANA.

### <a name="acceptance-test"></a>Приемочный тест
Несмотря на то, что миграция с ХЛИ на виртуальную машину не вносит изменений в содержимое базы данных по сравнению с разнородной миграцией, мы по-прежнему рекомендуем проверять ключевые функциональные возможности и аспекты производительности новой установки.  

### <a name="cutover-plan"></a>План прямую миграцию
Несмотря на то, что миграция выполняется прямо вперед, она включает в себя списание существующей базы данных.  Тщательное планирование сохранения исходной системы со связанным содержимым и изображениями резервных копий очень важно в случае необходимости резервного копирования.  Хорошее планирование предлагает спидиер Сторнирование.   


## <a name="post-migration"></a>Действия после перемещения
Задание миграции не выполняется до тех пор, пока не будут безопасно отключены какие-либо службы или подключения, зависящие от ХЛИ, для обеспечения сохранности данных.  Кроме того, завершите работу ненужных служб.  В этом разделе приводится несколько наиболее подходящих элементов.

### <a name="decommissioning-the-hli"></a>Списание ХЛИ
После успешной миграции базы данных HANA на виртуальную машину Azure убедитесь, что в базе данных ХЛИ DB не выполняются эффективные бизнес-транзакции.  Однако поддержание ХЛИ в течение определенного периода времени, равное его локальному периоду хранения резервных копий, является надежной практикой, гарантируя при необходимости восстановление спидиер.  Только после этого должна быть списана колонка ХЛИ.  Клиенты должны по договору заключить свои обязательства в ХЛИ с корпорацией Майкрософт, обратившись к своим представителям корпорации Майкрософт.

### <a name="remove-any-proxy-ex-iptables-bigip-configured-for-hli"></a>Удалите все прокси-серверы (например: iptables, BIGIP), настроенные для ХЛИ 
Если прокси-служба, такая как IPTables, используется для маршрутизации локального трафика в ХЛИ, после успешной миграции на виртуальную машину она больше не нужна.  Однако эту службу подключения следует хранить до тех пор, пока в колонке ХЛИ все еще находится.  Завершение работы службы только после того, как колонка ХЛИ будет полностью списана.

### <a name="remove-global-reach-for-hli"></a>Удаление Global Reach для ХЛИ 
Global Reach используется для подключения шлюза ExpressRoute клиентов к шлюзу ExpressRoute ХЛИ.  Он позволяет локальному трафику клиентов обращаться к клиенту ХЛИ напрямую без использования прокси-службы.  Это подключение больше не требуется при отсутствии единицы ХЛИ после миграции.  Как и в случае со службой прокси IPTables, Глобалреач также следует хранить до тех пор, пока колонка ХЛИ не будет полностью списана.

### <a name="operating-system-subscription--movereuse"></a>Подписка операционной системы — перемещение и повторное использование
По мере того, как серверы виртуальных машин становятся стоялиами и выводятся колонки ХЛИ, подписки ОС можно заменить или повторно использовать, чтобы избежать двойной оплаты лицензий ОС.



## <a name="next-steps"></a>Следующие шаги
См. следующие статьи:
- [SAP HANA конфигураций и операций инфраструктуры в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-vm-operations).
- [Рабочие нагрузки SAP в Azure: контрольный список для планирования и развертывания](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-deployment-checklist).
