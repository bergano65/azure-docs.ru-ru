---
title: 'SAP в Azure: Поддерживаемые сценарии с виртуальными машинами Azure'
description: Поддерживаемые сценарии в виртуальных машинах Azure с рабочей нагрузкой SAP
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: bburns
editor: ''
tags: azure-resource-manager
keywords: SAP
ms.assetid: d7c59cc1-b2d0-4d90-9126-628f9c7a5538
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 03/11/2020
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: ad1567a3a6cba2c2fbc519ffe5d384aba25ab51d
ms.sourcegitcommit: 271601d3eeeb9422e36353d32d57bd6e331f4d7b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "88648995"
---
# <a name="sap-workload-on-azure-virtual-machine-supported-scenarios"></a>Поддерживаемые сценарии использования рабочей нагрузки SAP в виртуальных машинах Azure
Проектирование архитектуры SAP NetWeaver, Business 1 `Hybris` или S/4HANA в Azure открывает множество различных возможностей для различных архитектур и средств, используемых для перехода к масштабируемому, эффективному и высоко доступному развертыванию. Несмотря на то, что зависит от используемой операционной системы или СУБД, существуют ограничения. Кроме того, не все сценарии, которые поддерживаются в локальной среде, поддерживаются аналогичным образом в Azure. В этом документе приводится пошаговая поддержка конфигураций с высоким уровнем доступности и конфигураций и архитектур с высокой доступностью с использованием виртуальных машин Azure исключительно. Для сценариев, поддерживаемых [крупными экземплярами Hana](./hana-overview-architecture.md), ознакомьтесь со статьей [Поддерживаемые сценарии для крупных экземпляров Hana](./hana-supported-scenario.md). 


## <a name="2-tier-configuration"></a>2-уровневая конфигурация
Конфигурация SAP 2 уровня считается встроенной в Объединенный слой СУБД SAP и уровня приложений, работающих на том же сервере или в одной единице виртуальной машины. Второй уровень считается слоем пользовательского интерфейса. В случае с 2-уровневой конфигурацией СУБД и уровень приложений SAP совместно используют ресурсы виртуальной машины Azure. В результате необходимо настроить различные компоненты так, чтобы они не конкурируют за ресурсы. Также необходимо соблюдать осторожность, чтобы не дописывать ресурсы виртуальной машины. Такая конфигурация не обеспечивает высокий уровень доступности, помимо [соглашений об уровне обслуживания Azure](https://azure.microsoft.com/support/legal/sla/) , связанных с различными компонентами Azure.

Графическое представление такой конфигурации может выглядеть следующим образом:

![Простая 2-уровневая конфигурация](./media/sap-planning-supported-configurations/two-tier-simple-configuration.png)

Такие конфигурации поддерживаются в Windows, Red Hat, SUSE и Oracle Linux для систем СУБД SQL Server, Oracle, DB2, maxDB и SAP ASE для рабочих и нерабочих случаев. Для SAP HANA в качестве СУБД такой тип конфигураций поддерживается только для нерабочих случаев. Сюда также входит вариант развертывания [крупных экземпляров Azure Hana](./hana-overview-architecture.md) .
Для всех сочетаний ОС и СУБД, поддерживаемых в Azure, поддерживается этот тип конфигурации. Тем не менее, необходимо установить конфигурацию СУБД и компонентов SAP таким образом, чтобы СУБД и компоненты SAP не конкурируют за ресурсы памяти и ЦП и, таким образом, превышают физические доступные ресурсы. Это необходимо сделать путем ограниченного объема памяти, выделяемой СУБД. Кроме того, необходимо ограничить расширенную память SAP в экземплярах приложения. Кроме того, необходимо отслеживать потребление ресурсов ЦП виртуальной машиной, чтобы убедиться, что компоненты не максимально максимизирут ресурсы ЦП. 

> [!NOTE]
> Для производственных систем SAP рекомендуется дополнительное обеспечение высокого уровня доступности и конечные конфигурации аварийного восстановления, как описано далее в этом документе.


## <a name="3-tier-configuration"></a>3-уровневая конфигурация
В таких конфигурациях уровень приложений SAP и уровень СУБД разделяются на разные виртуальные машины. Обычно это делается для более крупных систем, а также для повышения гибкости ресурсов уровня приложений SAP. В самой простой установке нет высокого уровня доступности за пределами [соглашений об уровне обслуживания Azure](https://azure.microsoft.com/support/legal/sla/) для различных задействованных компонентов Azure. 

Графическое представление выглядит следующим образом:

![Простая 2-уровневая конфигурация](./media/sap-planning-supported-configurations/three-tier-simple-configuration.png)

Этот тип конфигурации поддерживается в Windows, Red Hat, SUSE и Oracle Linux для систем СУБД SQL Server, Oracle, DB2, SAP HANA, maxDB и SAP ASE для рабочих и нерабочих случаев. Это конфигурация развертывания по умолчанию для [крупных экземпляров Azure Hana](./hana-overview-architecture.md). В целях упрощения не было различий между центральными службами SAP и экземплярами диалоговых окон SAP на уровне приложений SAP. В этой простой трехуровневой конфигурации отсутствует защита высокой доступности для центральных служб SAP.

> [!NOTE]
> Для производственных систем SAP рекомендуется дополнительное обеспечение высокого уровня доступности и конечные конфигурации аварийного восстановления, как описано далее в этом документе.


## <a name="multiple-dbms-instances-per-vm-or-hana-large-instance-unit"></a>Несколько экземпляров СУБД на одну виртуальную машину или единицу крупных экземпляров HANA
В этом типе конфигурации вы размещаете несколько экземпляров СУБД на каждую виртуальную машину Azure или единицу крупных экземпляров HANA. Мотивация может быть меньше операционных систем для обслуживания и снижения затрат. Другие мотивации могут быть более гибкими и более эффективными за счет совместного использования ресурсов более крупной виртуальной машины или единицы крупного экземпляра HANA между несколькими экземплярами СУБД. До сих пор эти конфигурации были показаны преимущественно для непроизводственных систем.

Такая конфигурация может выглядеть следующим образом:

![Несколько экземпляров СУБД в одной единице](./media/sap-planning-supported-configurations/multiple-database-instances.png)

Этот тип развертывания СУБД поддерживается для следующих служб:

- SQL Server в Windows
- IBM DB2. Дополнительные сведения см. в статье [несколько экземпляров (Linux, UNIX)](https://www.ibm.com/support/knowledgecenter/en/SSEPGG_10.5.0/com.ibm.db2.luw.admin.dbobj.doc/doc/c0004904.html) .
- Для Oracle. Дополнительные сведения см. в [примечании по поддержке sap #1778431](https://launchpad.support.sap.com/#/notes/1778431) и связанных с ними ПРИМЕЧАНИЯх SAP.
- Для SAP HANA несколько экземпляров на одной виртуальной машине SAP вызывает этот метод развертывания МКОС, поддерживаемый. Дополнительные сведения см. в статье SAP [несколько SAP HANA Systems на одном узле (МКОС)] (https://help.sap.com/viewer/eb3777d5495d46c5b2fa773206bbfb46/2.0.02/
- /b2751fd43bec41a9a14e01913f1edf18.html)

При выполнении нескольких экземпляров базы данных на одном узле необходимо убедиться, что разные экземпляры не конкурируют за ресурсы и, следовательно, превышают ограничения физического ресурса виртуальной машины. Это особенно верно для памяти, где необходимо ограничить память, которую может выделить любой экземпляр, совместно использующий виртуальную машину. Это также может быть справедливо для ресурсов ЦП, которые могут использовать разные экземпляры базы данных. Все упомянутые СУБД имеют конфигурации, позволяющие ограничить выделение памяти и ресурсы ЦП на уровне экземпляра.
Чтобы обеспечить поддержку такой конфигурации для виртуальных машин Azure, предполагается, что диски или тома, используемые для файлов данных и журналов журнала/повтора для баз данных, управляемых разными экземплярами, являются отдельными. Или другими словами, файлы журнала или журнала операций записи или возврата для баз данных, управляемых разными экземплярами СУБД, не должны совместно использовать одни и те же диски или тома. 

Конфигурация дисков для крупных экземпляров HANA доставляется настроенной и подробно описана в [поддерживаемых сценариях для крупных экземпляров Hana](./hana-supported-scenario.md#single-node-mcos). 

> [!NOTE]
> Для производственных систем SAP рекомендуется дополнительное обеспечение высокого уровня доступности и конечные конфигурации аварийного восстановления, как описано далее в этом документе. Виртуальные машины с несколькими экземплярами СУБД не поддерживаются в конфигурациях с высоким уровнем доступности, описанных далее в этом документе.


## <a name="multiple-sap-dialog-instances-in-one-vm"></a>Несколько экземпляров диалогового окна SAP на одной виртуальной машине
В большинстве случаев развертывание нескольких экземпляров диалогового окна выполняется на серверах без операционной системы или даже на виртуальных машинах, работающих в частных облаках. Причиной таких конфигураций было необходимость адаптации определенных экземпляров диалоговых окон SAP к определенной рабочей нагрузке, бизнес-функциональности или типам рабочих нагрузок. Причина, по которой эти экземпляры не изолируются на отдельные виртуальные машины, была затрачена на обслуживание и эксплуатацию операционной системы. Или во многих случаях затраты на случай, если поставщик услуг размещения или оператор виртуальной машины запрашивает ежемесячную плату за каждую виртуальную машину, которую вы управляете и администрировать. В Azure сценарий размещения нескольких экземпляров диалоговых окон SAP в рамках одной виртуальной машины (США) поддерживается в производственных и непроизводственных целях в операционных системах Windows, Red Hat, SUSE и Oracle Linux. Параметр ядра SAP PHYS_MEMSIZE, доступный в Windows и современных ядрах Linux, должен быть установлен, если на одной виртуальной машине выполняется несколько экземпляров сервера приложений SAP. Также рекомендуется ограничить расширение расширенной памяти SAP в операционных системах, например в Windows, где реализован автоматический рост расширенной памяти SAP. Это можно сделать с помощью параметра профиля SAP `em/max_size_MB` .

В 3-уровневой конфигурации, в которой несколько экземпляров диалоговых окон SAP выполняются в виртуальных машинах Azure, могут выглядеть следующим образом:

![Несколько экземпляров СУБД в одной единице](./media/sap-planning-supported-configurations/multiple-dialog-instances.png)

В целях упрощения не было различий между центральными службами SAP и экземплярами диалоговых окон SAP на уровне приложений SAP. В этой простой трехуровневой конфигурации отсутствует защита высокой доступности для центральных служб SAP. Для рабочих систем не рекомендуется включать незащищенные службы SAP Central Services. Дополнительные сведения о конфигурации с несколькими идентификаторами безопасности для экземпляров SAP Central и высокой доступности таких конфигураций с несколькими идентификаторами безопасности см. в последующих разделах этого документа.

## <a name="high-availability-protection-for-the-sap-dbms-layer"></a>Защита высокой доступности для уровня СУБД SAP
При развертывании производственных систем SAP необходимо учитывать тип высокой доступности в режиме горячей замены. В особенности SAP HANA, где данные должны быть загружены в память, прежде чем можно будет добиться полной производительности и масштабируемости, восстановление службы Azure не является идеальной мерой для обеспечения высокого уровня доступности. 

В целом корпорация Майкрософт поддерживает только конфигурации высокого уровня доступности и пакеты программного обеспечения, описанные в разделе "Рабочая нагрузка SAP" в docs.microsoft.com. Эту же инструкцию можно прочесть в заметке SAP [#1928533](https://launchpad.support.sap.com/#/notes/1928533). Корпорация Майкрософт не предоставляет поддержку других программных платформ с высокой доступностью, которые не документированы корпорацией Майкрософт вместе с рабочей нагрузкой SAP. В таких случаях сторонние поставщики инфраструктуры высокого уровня доступности являются вспомогательной стороной для конфигурации высокого уровня доступности, которую должен использовать клиент в процессе поддержки. Исключения будут упомянуты в этой статье. 

В общем, корпорация Майкрософт поддерживает ограниченный набор конфигураций высокого уровня доступности на виртуальных машинах Azure или единиц крупных экземпляров HANA. Поддерживаемые сценарии крупных экземпляров HANA см. в статье [Поддерживаемые сценарии для крупных экземпляров Hana](./hana-supported-scenario.md).

Для виртуальных машин Azure на уровне СУБД поддерживаются следующие конфигурации высокого уровня доступности:

- SAP HANA репликацию системы на основе Linux Pacemaker в SUSE и Red Hat. См. подробные статьи:
    - [Обеспечение высокого уровня доступности SAP HANA на виртуальных машинах Azure в SUSE Linux Enterprise Server](./sap-hana-high-availability.md)
    - [Обеспечение высокого уровня доступности SAP HANA на виртуальных машинах Azure в Red Hat Enterprise Linux](./sap-hana-high-availability-rhel.md)
- SAP HANA конфигурации горизонтального масштабирования n + m с помощью [Azure NetApp Files](https://azure.microsoft.com/services/netapp/) в SUSE и Red Hat. Подробные сведения приведены в следующих статьях:
    - [Развертывание SAP HANA масштабируемой системы с резервным узлом на виртуальных машинах Azure с помощью Azure NetApp Files на SUSE Linux Enterprise Server}](./sap-hana-scale-out-standby-netapp-files-suse.md)
    - [Развертывание горизонтально масштабируемой системы SAP HANA с резервным узлом на виртуальных машинах Azure с помощью Azure NetApp Files в Red Hat Enterprise Linux](./sap-hana-scale-out-standby-netapp-files-rhel.md)
- SQL Server отказоустойчивый кластер, основанный на масштабируемых файловых службах Windows. Хотя для рабочих систем рекомендуется использовать SQL Server Always On вместо кластеризации. SQL Server Always On обеспечивает лучшую доступность, используя отдельное хранилище. Подробные сведения описаны в этой статье: 
    - [Настройка экземпляра отказоустойчивого кластера SQL Server на виртуальных машинах Azure](../../../azure-sql/virtual-machines/windows/failover-cluster-instance-storage-spaces-direct-manually-configure.md)
- SQL Server Always On поддерживается в операционной системе Windows для SQL Server в Azure. Это рекомендация по умолчанию для рабочих SQL Server экземпляров в Azure. Подробные сведения описаны в следующих статьях:
    - [Введение в группы доступности AlwaysOn SQL Server на виртуальных машинах Azure](../../../azure-sql/virtual-machines/windows/availability-group-overview.md).
    - [Настройка группы доступности AlwaysOn на виртуальных машинах Azure в разных регионах](../../../azure-sql/virtual-machines/windows/availability-group-manually-configure-multiple-regions.md).
    - [Настройка подсистемы балансировки нагрузки для группы доступности AlwaysOn в Azure](../../../azure-sql/virtual-machines/windows/availability-group-load-balancer-portal-configure.md).
- Oracle Data Guard для Windows и Oracle Linux. Подробные сведения о Oracle Linux можно найти в этой статье:
    - [Реализация Oracle Data Guard на виртуальной машине Azure под управлением Linux](../oracle/configure-oracle-dataguard.md)
- Сведения о IBM DB2 HADR на SUSE и RHEL, посвященные SUSE и RHEL с помощью Pacemaker, приведены здесь:
    - [Высокий уровень доступности IBM DB2 LUW на виртуальных машинах Azure на SUSE Linux Enterprise Server с Pacemaker](./dbms-guide-ha-ibm.md)
    - [Обеспечение высокого уровня доступности IBM DB2 LUW на виртуальных машинах Azure в Red Hat Enterprise Linux Server](./high-availability-guide-rhel-ibm-db2-luw.md)
- Конфигурация SAP ASE и SAP maxDB, как описано в следующих документах:
    - [Рабочие нагрузки SAP на Виртуальных машинах Azure. Руководство по развертыванию СУБД SAP ASE](./dbms_guide_sapase.md)
    - [Развертывание SAP MaxDB, liveCache и сервера содержимого на виртуальных машинах Azure](./dbms_guide_maxdb.md)
- Сценарии высокой доступности HANA с большими экземплярами подробно описаны в:
    - [Поддерживаемые сценарии для крупных экземпляров HANA — HSR с STONITH для обеспечения высокой доступности](./hana-supported-scenario.md#hsr-with-stonith-for-high-availability)
    - [Поддерживаемые сценарии для крупных экземпляров HANA — автоматическая отработка отказа узла (1 + 1)](./hana-supported-scenario.md#host-auto-failover-11)

> [!IMPORTANT]
> В описанных выше сценариях мы поддерживаем конфигурации нескольких экземпляров СУБД на одной виртуальной машине. В каждом из вариантов можно развернуть только один экземпляр базы данных на виртуальной машине и защитить с помощью описанных методов высокого уровня доступности. В данный момент **не** поддерживается защита нескольких экземпляров СУБД в одном отказоустойчивом кластере Windows или Pacemaker. Кроме того, Oracle Data Guard поддерживается только для одного экземпляра на случаи развертывания виртуальных машин. 

Различные системы баз данных позволяют размещать несколько баз данных в одном экземпляре СУБД. Как и в случае с SAP HANA, несколько баз данных могут размещаться в нескольких контейнерах (MDC). Для случаев, когда эти конфигурации с несколькими базами данных работают в пределах одного ресурса отказоустойчивого кластера, эти конфигурации поддерживаются. Неподдерживаемые конфигурации — это случаи, когда требуется несколько ресурсов кластера. Как для конфигураций, в которых можно определить несколько SQL Server групп доступности, в одном экземпляре SQL Server.


![Конфигурация высокой доступности СУБД](./media/sap-planning-supported-configurations/database-high-availability-configuration.png)

В зависимости от СУБД (или операционных систем) такие компоненты, как балансировщик нагрузки Azure, могут быть не требуются в рамках архитектуры решения. 

В частности, для maxDB конфигурация хранилища должна отличаться. В maxDB файлы данных и журналов должны находиться в общем хранилище для конфигураций с высоким уровнем доступности. Только в случае с maxDB, общее хранилище поддерживается для обеспечения высокой доступности. Для всех остальных СУБД отдельные стеки хранилища на узел являются единственными поддерживаемыми конфигурациями дисков.

Существуют и другие платформы высокого уровня доступности, которые также известны для запуска на Microsoft Azure. Однако корпорация Майкрософт не проверила эти платформы. Если вы хотите создать конфигурацию высокой доступности с этими платформами, необходимо работать с поставщиком этого программного обеспечения, чтобы:

- Разработка архитектуры развертывания
- Развертывание архитектуры
- Поддержка архитектуры

> [!IMPORTANT]
> Microsoft Azure Marketplace предлагает разнообразные программные устройства, которые предоставляют решения для хранения данных на основе собственного хранилища Azure. Эти программные устройства можно использовать для создания общих папок NFS, а теоретически можно использовать в SAP HANA масштабных развертываниях, где требуется резервный узел. Из-за различных причин ни одно из этих мягких устройств хранения не поддерживается для любых развертываний СУБД Майкрософт и SAP в Azure. В данный момент не поддерживается развертывание СУБД на общих ресурсах SMB. Развертывания СУБД на общих ресурсах NFS ограничены общими папками NFS 4,1 на [Azure NetApp Files](https://azure.microsoft.com/services/netapp/).


## <a name="high-availability-for-sap-central-service"></a>Высокий уровень доступности для Центральной службы SAP
Центральные службы SAP — это вторая единая точка отказа вашей конфигурации SAP. Поэтому необходимо также защитить эти процессы центральных служб. Предложение, поддерживаемое и документированное для рабочих нагрузок SAP, выглядит следующим образом:

- Сервер отказоустойчивого кластера Windows, использующий масштабируемые файловые службы Windows для sapmnt и глобального каталога транспорта. Подробные сведения описаны в статье:
    - [Кластеризация экземпляра SAP ASCS/SCS в отказоустойчивом кластере Windows с помощью файлового ресурса в Azure](./sap-high-availability-guide-wsfc-file-share.md)
    - [Подготовка высокодоступной инфраструктуры Azure для SAP с помощью отказоустойчивого кластера Windows и файлового ресурса для экземпляров SAP ASCS/SCS](./sap-high-availability-infrastructure-wsfc-file-share.md).
- Сервер отказоустойчивого кластера Windows, использующий общую папку SMB на основе [Azure NetApp Files](https://azure.microsoft.com/services/netapp/) для sapmnt и глобального каталога транспорта. Подробные сведения приведены в статье:
    - [Высокий уровень доступности SAP NetWeaver на виртуальных машинах Azure в Windows с Azure NetApp Files (SMB) для приложений SAP](./high-availability-guide-windows-netapp-files-smb.md)
- Сервер отказоустойчивого кластера Windows на основе SIOS `Datakeeper` . Однако в документации Майкрософт требуется связь поддержки с SIOS, поэтому при использовании этого решения вы можете воспользоваться поддержкой SIOS. Подробные сведения описаны в статье:
    - [Кластеризация экземпляра SAP ASCS/SCS в отказоустойчивом кластере Windows с помощью общего диска кластера в Azure](./sap-high-availability-guide-wsfc-shared-disk.md).
    - [Подготовка инфраструктуры Azure для SAP высокого уровня доступности с помощью отказоустойчивого кластера Windows и общего диска для SAP ASCS/SC](./sap-high-availability-infrastructure-wsfc-shared-disk.md)
- Pacemaker в операционной системе SUSE с созданием общего ресурса NFS высокой доступности с использованием двух виртуальных машин SUSE и `drdb` репликации файлов. Сведения описаны в статье
    - [Руководство по обеспечению высокого уровня доступности виртуальных машин Azure для SAP NetWeaver на SUSE Linux Enterprise Server для приложений SAP](./high-availability-guide-suse.md)
    - [Обеспечение высокого уровня доступности NFS на виртуальных машинах Azure в SUSE Linux Enterprise Server](./high-availability-guide-suse-nfs.md)
- Операционная система Pacemaker SUSE с использованием общих папок NFS, предоставляемых [Azure NetApp Files](https://azure.microsoft.com/services/netapp/). Сведения описаны в статье
    - [Обеспечение высокого уровня доступности виртуальных машин Azure для SAP NetWeaver на SUSE Linux Enterprise Server с помощью Azure NetApp Files для приложений SAP](./high-availability-guide-suse-netapp-files.md)
- Pacemaker в операционной системе Red Hat с общим ресурсом NFS, размещенным в `glusterfs` кластере. Подробные сведения можно найти в статьях
    - [Обеспечение высокого уровня доступности SAP NetWeaver в виртуальных машинах Azure с Red Hat Enterprise Linux](./high-availability-guide-rhel.md)
    - [`GlusterFS` на виртуальных машинах Azure на Red Hat Enterprise Linux SAP NetWeaver](./high-availability-guide-rhel-glusterfs.md)
- Pacemaker в операционной системе Red Hat с общим ресурсом NFS, размещенным на [Azure NetApp Files](https://azure.microsoft.com/services/netapp/). Подробные сведения описаны в статье.
    - [Высокая доступность виртуальных машин Azure для SAP NetWeaver на Red Hat Enterprise Linux с Azure NetApp Files для приложений SAP](./high-availability-guide-rhel-netapp-files.md)

Из перечисленных решений требуется связь поддержки с SIOS для поддержки `Datakeeper` продукта и взаимодействия с SIOS непосредственно в случае проблем. В зависимости от способа лицензирования ОС Windows, Red Hat и/или SUSE вы также должны иметь контракт на поддержку у поставщика ОС, чтобы обеспечить полную поддержку перечисленных конфигураций высокого уровня доступности.

Конфигурация также может отображаться следующим образом:

![Конфигурация СУБД и ASCS высокой доступности](./media/sap-planning-supported-configurations/high-available-3-tier-configuration.png)

В правой части графика показана высокодоступная Центральная служба SAP Central Services. Помимо того, что центральные службы SAP защищены с помощью отказоустойчивой кластерной платформы, которая может выполнить отработку отказа в случае проблемы, необходимо наличие высокодоступного общего ресурса NFS или SMB или общего диска Windows, чтобы убедиться, что sapmnt и глобальный каталог транспорта доступны независимо от существования одной виртуальной машины. Дополнительные некоторые решения, например сервер отказоустойчивого кластера Windows и Pacemaker, потребут от балансировщика нагрузки Azure направить или перенаправить трафик на работоспособный узел.

В приведенном списке нет упоминания о Oracle Linux операционной системе. Oracle Linux не поддерживает Pacemaker в качестве платформы кластеризации. Если вы хотите развернуть систему SAP на Oracle Linux и вам нужна платформа высокого уровня доступности для Oracle Linux, необходимо работать со сторонними поставщиками. Один из поставщиков SIOS с набором защиты для Linux, поддерживаемым SAP в Azure. Дополнительные сведения см. в статье SAP Note [#1662610 — сведения о поддержке для SIOS Protection Suite для Linux](https://launchpad.support.sap.com/#/notes/1662610) .



### <a name="supported-storage-with-the-sap-central-services-scenarios-listed-above"></a>Поддерживаемое хранилище с сценариями Центральной службы SAP, приведенными выше
Так как только подмножество типов службы хранилища Azure предоставляет высокодоступные общие папки NFS или SMB, качество использования в кластере центральных служб SAP составляет список поддерживаемых типов хранилищ.

- Сервер отказоустойчивого кластера Windows с масштабируемым файловым сервером Windows можно развернуть во всех собственных типах хранилища Azure, кроме Azure NetApp Files. Однако рекомендуется использовать хранилище класса Premium, так как в пропускной способности и операциях ввода-вывода являются старшими соглашениями об уровне обслуживания.
- Сервер отказоустойчивого кластера Windows с SMB на Azure NetApp Files поддерживается в Azure NetApp Files. Общие ресурсы SMB в файловых службах Azure в данный момент **не** поддерживаются.
- Сервер отказоустойчивого кластера Windows с общим диском Windows на основе SIOS `Datakeeper` можно развернуть во всех собственных типах хранилища Azure, кроме Azure NetApp Files. Однако рекомендуется использовать хранилище класса Premium, так как в пропускной способности и операциях ввода-вывода являются старшими соглашениями об уровне обслуживания.
- В Azure NetApp Files поддерживается SUSE или Red Hat Pacemaker, использующие общие папки NFS на Azure NetApp Files. 
- SUSE Pacemaker, использующий `drdb` конфигурацию между двумя виртуальными машинами, поддерживается с помощью собственных типов хранилища Azure, за исключением Azure NetApp Files. Однако рекомендуется использовать хранилище класса Premium, так как в пропускной способности и операциях ввода-вывода являются старшими соглашениями об уровне обслуживания.
- Red Hat Pacemaker с использованием `glusterfs` для предоставления общего ресурса NFS поддерживается с использованием собственных типов хранилища Azure, за исключением Azure NetApp Files. Однако рекомендуется использовать хранилище класса Premium, так как в пропускной способности и операциях ввода-вывода являются старшими соглашениями об уровне обслуживания.

> [!IMPORTANT]
> Microsoft Azure Marketplace предлагает разнообразные программные устройства, которые предоставляют решения для хранения данных на основе собственного хранилища Azure. Эти программные устройства можно использовать для создания общих папок NFS или SMB, что теоретически может быть использовано в отказоустойчивой кластерной службе SAP Central Services. Эти решения не поддерживаются напрямую корпорацией Майкрософт для рабочей нагрузки SAP. Если вы решили использовать такое решение для создания общего ресурса NFS или SMB, поддержка конфигурации Центральной службы SAP должна предоставляться сторонним лицом, владеющем программным обеспечением в программном обеспечении хранения.


## <a name="multi-sid-sap-central-services-failover-clusters"></a>Отказоустойчивые кластеры SAP Central Services с несколькими ИД безопасности
Чтобы сократить количество виртуальных машин, необходимых для крупных SAP ландшафтов, SAP позволяет запускать экземпляры центральных служб SAP из нескольких различных систем SAP в конфигурации отказоустойчивого кластера. Представьте себе, что у вас есть 30 или более рабочих систем NetWeaver или S/4HANA. Без кластеризации с несколькими ИД безопасности для этих конфигураций потребуется 60 или более виртуальных машин в 30 или более конфигураций отказоустойчивого кластера Windows или Pacemaker. Помимо отказоустойчивых кластеров СУБД. Развертывание нескольких центральных служб SAP на двух узлах в конфигурации отказоустойчивого кластера может значительно сократить число виртуальных машин. Однако развертывание нескольких экземпляров SAP Central Services в одной конфигурации кластера с двумя узлами также имеет некоторые недостатки. Проблемы, связанные с одной виртуальной машиной в конфигурации кластера, применяются к нескольким системам SAP. Обслуживание в гостевой ОС, работающей в конфигурации кластера, требует более координирования, поскольку затрагивается несколько производственных систем SAP. Такие средства, как SAP лама, не поддерживают кластеризацию с несколькими ИД безопасности в процессе клонирования системы.

В Azure конфигурация кластера с несколькими идентификаторами безопасности поддерживается для операционной системы Windows с ENSA1 и ENSA2. Рекомендуется не объединять старую архитектуру службы репликации в очереди (ENSA1) с новой архитектурой (ENSA2) в одном кластере с несколькими ИД безопасности. Сведения об этой архитектуре описаны в статьях

- [Обеспечение высокого уровня доступности с несколькими идентификаторами безопасности для экземпляра SAP ASCS/SCS с помощью отказоустойчивой кластеризации Windows Server и общего диска в Azure](./sap-ascs-ha-multi-sid-wsfc-shared-disk.md) 
- [Обеспечение высокого уровня доступности экземпляра ASCS/SCS с несколькими ИД безопасности с помощью отказоустойчивой кластеризации Windows Server и файлового ресурса в Azure](./sap-ascs-ha-multi-sid-wsfc-file-share.md) 

Для SUSE также поддерживается кластер с несколькими идентификаторами безопасности на основе Pacemaker. До сих пор конфигурация поддерживается для:

- Не более пяти экземпляров SAP ASCS/SCS;
- Старая архитектура сервера репликации в очереди (ENSA1)
- Конфигурации кластера Pacemaker с двумя узлами

Конфигурация описана в статье [высокий уровень доступности SAP NetWeaver на виртуальных машинах Azure SUSE Linux Enterprise Server для МНОГОИД безопасности приложений SAP](./high-availability-guide-suse-multi-sid.md) .

Кластер с несколькими идентификаторами безопасности с постановкой в очередь сервера репликации выглядит так:

![Конфигурация СУБД и ASCS высокой доступности](./media/sap-planning-supported-configurations/high-available-multi-system-configuration.png)


## <a name="sap-hana-scale-out-scenarios"></a>Сценарии горизонтального масштабирования SAP HANA
Сценарии горизонтального масштабирования SAP HANA поддерживаются для подмножества виртуальных машин Azure, сертифицированных HANA, как указано в [каталоге SAP HANA оборудования](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure). Все виртуальные машины, отмеченные "Yes" в столбце "кластеризация", можно использовать для горизонтального масштабирования OLAP или S/4HANA. Конфигурации без резервного режима поддерживаются в следующих типах хранилища Azure: 

- Хранилище Azure класса Premium, включая ускоритель записи Azure для тома/Hana/log
- [Диск (цен. категория "Ультра")](../../disks-enable-ultra-ssd.md)
- [Azure NetApp Files](https://azure.microsoft.com/services/netapp/) 

SAP HANA конфигурации горизонтального масштабирования для OLAP или S/4HANA с резервными узлами поддерживаются только совместно с общим доступом NFS, размещенным на Azure NetApp Files.

Дополнительные сведения о точной конфигурации хранилища с резервным узлом или без него см. в статьях:

- [Конфигурации хранилища виртуальных машин SAP HANA в Azure](./hana-vm-operations-storage.md) 
- [Развертывание горизонтально масштабируемой системы SAP HANA с резервным узлом на виртуальных машинах Azure с помощью Azure NetApp Files в SUSE Linux Enterprise Server](./sap-hana-scale-out-standby-netapp-files-suse.md)
- [Развертывание горизонтально масштабируемой системы SAP HANA с резервным узлом на виртуальных машинах Azure с помощью Azure NetApp Files в Red Hat Enterprise Linux](./sap-hana-scale-out-standby-netapp-files-rhel.md)
- [Примечание о поддержке SAP #2080991](https://launchpad.support.sap.com/#/notes/2080991)

Сведения о поддерживаемых масштабируемых конфигурациях Hana (крупные экземпляры) см. в документации по следующим продуктам.

- [Поддерживаемые сценарии для крупных экземпляров HANA с резервным развертыванием](./hana-supported-scenario.md#scale-out-with-standby)
- [Поддерживаемые сценарии для крупных экземпляров HANA без режима ожидания](./hana-supported-scenario.md#scale-out-without-standby)


## <a name="disaster-recovery-scenario"></a>Сценарий аварийного восстановления
Существует множество поддерживаемых сценариев аварийного восстановления. Мы определим аварийные архитектуры как архитектуры, которые должны компенсировать все регионы Azure, идущие за пределы сетки. Это означает, что нам нужно, чтобы цель аварийного восстановления отличалась от региона Azure в качестве цели для запуска вашей ландшафта SAP. Мы разделяем методы и конфигурации на уровне СУБД и на уровне, отличном от СУБД. 

### <a name="dbms-layer"></a>Уровень СУБД
Для уровня СУБД конфигурации, использующие собственные механизмы репликации СУБД, такие как Always On, Oracle Data Guard, DB2 HADR, SAP ASE Always-on, или репликация системы HANA. Необходимо, чтобы поток репликации в таких случаях был асинхронным, а не синхронно, как в типичных сценариях высокой доступности, развернутых в одном регионе Azure. Типичный пример такой поддерживаемой конфигурации аварийного восстановления СУБД описан в статье [SAP HANA доступность в регионах Azure](./sap-hana-availability-across-regions.md#combine-availability-within-one-region-and-across-regions). На втором рисунке в этом разделе описывается сценарий с HANA в качестве примера. Основные базы данных, поддерживаемые приложениями SAP, можно развернуть в таком сценарии.

Виртуальную машину меньшего размера можно использовать в качестве целевого экземпляра в регионе аварийного восстановления, так как эта виртуальная машина не проходит полный трафик рабочей нагрузки. При этом необходимо помнить о следующих вопросах.

- Небольшие типы виртуальных машин не допускают, что многие диски подключены к небольшим виртуальным машинам.
- Меньшие виртуальные машины имеют меньше пропускной способности сети и хранилища.
- Изменение размера в разных семействах виртуальных машин может стать проблемой при сборе различных виртуальных машин в одной группе доступности Azure или при изменении размера между семейством серии M и Mv2 виртуальных машин.
- Использование ЦП и памяти для экземпляра базы данных, который может получать поток изменений с минимальной задержкой и достаточным объемом ресурсов ЦП и памяти для применения этих изменений с минимальной задержкой к данным  

Дополнительные сведения об ограничениях для различных размеров виртуальных машин можно найти [здесь](../../sizes.md) . 

Еще один поддерживаемый метод развертывания цели аварийного восстановления — установить на виртуальной машине второй экземпляр СУБД, на котором выполняется нерабочий экземпляр СУБД непроизводственного экземпляра SAP. Это может быть немного сложнее, поскольку необходимо выяснить, что именно в памяти, ЦП, пропускной способности сети и пропускной способности хранилища требуется для конкретных целевых экземпляров, которые должны функционировать как основной экземпляр в сценарии аварийного восстановления. В частности, в HANA настоятельно рекомендуется настроить экземпляр, который выступает в качестве цели аварийного восстановления на общем узле, чтобы данные не загружались предварительно в экземпляре цели аварийного восстановления.

Для сценариев восстановления крупных экземпляров HANA проверяйте следующие документы:

- [Один узел с аварийным восстановлением с помощью репликации хранилища](./hana-supported-scenario.md#single-node-with-dr-using-storage-replication)
- [Один узел с аварийным восстановлением (многоцелевые) с использованием репликации хранилища](./hana-supported-scenario.md#single-node-with-dr-multipurpose-using-storage-replication)
- [Один узел с аварийным восстановлением (многоцелевые) с использованием репликации хранилища](./hana-supported-scenario.md#single-node-with-dr-multipurpose-using-storage-replication)
- [Высокий уровень доступности с помощью HSR и DR с репликацией хранилища](./hana-supported-scenario.md#high-availability-with-hsr-and-dr-with-storage-replication)
- [Масштабирование с помощью аварийного восстановления с использованием репликации хранилища](./hana-supported-scenario.md#scale-out-with-dr-using-storage-replication)
- [Один узел с аварийным восстановлением с помощью HSR](./hana-supported-scenario.md#single-node-with-dr-using-hsr)
- [Один узел HSR в аварийное восстановление (оптимизированные затраты)](./hana-supported-scenario.md#single-node-hsr-to-dr-cost-optimized)
- [Высокий уровень доступности и аварийное восстановление с помощью HSR](./hana-supported-scenario.md#high-availability-and-disaster-recovery-with-hsr)
- [Высокий уровень доступности и аварийное восстановление с помощью HSR (оптимизированные затраты)](./hana-supported-scenario.md#high-availability-and-disaster-recovery-with-hsr-cost-optimized)
- [Горизонтальное масштабирование с помощью аварийного восстановления с использованием HSR](./hana-supported-scenario.md#scale-out-with-dr-using-hsr)

> [!NOTE]
> Использование [Azure Site Recovery](https://azure.microsoft.com/services/site-recovery/) не тестировалось для развертываний СУБД в рабочей нагрузке SAP. В результате это не поддерживается для уровня СУБД систем SAP на данный момент времени. Другие методы репликации Майкрософт и SAP, которых нет в списке, не поддерживаются. Использование программного обеспечения сторонних производителей для репликации уровня СУБД SAP между различными регионами Azure должно поддерживаться поставщиком программного обеспечения и не будет поддерживаться в каналах поддержки Майкрософт и SAP. 
 
## <a name="non-dbms-layer"></a>Уровень, не связанный с СУБД
Для уровня приложений SAP и конечных ресурсов или расположений, которые необходимы, клиенты используют два основных сценария:

- Целевые объекты аварийного восстановления в другом регионе Azure не используются в производственных и непроизводственных целях. В этом сценарии виртуальные машины, работающие в качестве цели аварийного восстановления, в идеале не разворачиваются, а образ и изменения в образах рабочего уровня приложений SAP реплицируются в регион аварийного восстановления. Функция, которая может выполнять такую задачу, [Azure Site Recovery](../../../site-recovery/azure-to-azure-move-overview.md). Azure Site Recovery поддерживают такие сценарии репликации Azure в Azure. 
- Целевые объекты аварийного восстановления — это виртуальные машины, которые фактически используются нерабочими системами. Вся ландшафт SAP распределяется между двумя разными регионами Azure с рабочими системами, обычно в одном регионе и в непроизводственных системах в другом регионе. При большом объеме клиентских развертываний у клиента есть непроизводственная система, эквивалентная рабочей системе. У клиента есть предварительно установленные экземпляры приложений на непроизводственных системах уровня приложения. В случае отработки отказа нерабочие экземпляры будут отключены, виртуальные имена рабочих виртуальных машин перемещаются на нерабочие виртуальные машины (после назначения новых IP-адресов в DNS), а предварительно установленные рабочие экземпляры приступают к работе.

### <a name="sap-central-services-clusters"></a>Кластеры центральных служб SAP
Кластеры Центральной службы SAP, использующие общие диски (Windows), общие ресурсы SMB (Windows) или NFS, сложнее реплицировать. На стороне Windows репликация хранилища Windows является возможным решением. В Linux rsync является приемлемым решением.



## <a name="non-supported-scenario"></a>Неподдерживаемый сценарий
Существует список сценариев, которые не поддерживаются для рабочих нагрузок SAP в архитектурах Azure. **Не поддерживается** . Это означает, что SAP и корпорация Майкрософт не смогут поддерживать эти конфигурации и должны откладываться на конечную сторону стороннего производителя, которая предоставляет программное обеспечение для установки таких архитектур. Две категории:

- Мягкие устройства хранения. в Azure Marketplace предлагается ряд мягких устройств хранения. Некоторые поставщики предлагают собственную документацию по использованию таких мягких устройств хранения в Azure, которые связаны с программным обеспечением SAP. Поддержка конфигураций или развертываний с использованием таких мягких устройств хранения должна предоставляться поставщиком этих мягких устройств хранения. Этот факт также является манифестом в [заметке о поддержке SAP #2015553](https://launchpad.support.sap.com/#/notes/2015553)
- Платформы с высоким уровнем доступности: только Pacemaker и отказоустойчивый кластер Windows Server поддерживают платформы высокого уровня доступности для рабочей нагрузки SAP в Azure. Как упоминалось ранее, решение SIOS `Datakeeper` описывается и задокументировано корпорацией Майкрософт. Тем не менее компоненты SIOS `Datakeeper` должны поддерживаться через SIOS, как поставщик, предоставляющий эти компоненты. SAP также перечисляет другие сертифицированные платформы высокого уровня доступности в различных заметках SAP. Некоторые из них были сертифицированы сторонним поставщиком для Azure. Тем не менее, поддержка конфигураций, использующих эти продукты, должна предоставляться поставщиком продукта. Разные поставщики имеют разную интеграцию с процессами поддержки SAP. Перед принятием решения об использовании продукта в конфигурациях SAP, развернутых в Azure, необходимо уточнить, какой процесс поддержки лучше подходит для конкретного поставщика.
- Кластеры общих дисков, в которых файлы базы данных размещены на общих дисках, не поддерживаются за исключением maxDB. Для всех остальных баз данных поддерживаемым решением является использование отдельных расположений хранения вместо общего ресурса SMB или NFS или общего диска для настройки сценариев с высоким уровнем доступности.

Другие сценарии, которые не поддерживаются, такие:

- Сценарии развертывания, представляющие большую задержку в сети между уровнем приложений SAP и уровнем СУБД SAP в общей архитектуре SAP, как показано в NetWeaver, S/4HANA и, например, `Hybris` . В том числе:
    - Развертывание одного из уровней локально, в то время как другой уровень развертывается в Azure
    - Развертывание уровня приложений SAP системы в другом регионе Azure, отличном от региона с уровнем СУБД
    - Развертывание одного уровня в центрах обработки данных, совместно размещенных в Azure, и другого уровня в Azure, за исключением случаев, когда такие шаблоны архитектуры предоставляются собственной службой Azure
    - Развертывание сетевых виртуальных модулей между уровнем приложений SAP и уровнем СУБД
    - Использование хранилища, размещенного в центрах обработки данных, совместно размещенного в центре обработки данных Azure для уровня СУБД SAP или глобального транспортного каталога SAP
    - Развертывание двух слоев с двумя разными поставщиками облачных решений. Например, развертывание уровня СУБД в облачной инфраструктуре Oracle и на уровне приложения в Azure
- Конфигурации кластеров HANA Pacemaker с несколькими экземплярами
- Конфигурации кластера Windows с общими дисками через SOFS или SMB в использовании для баз данных SAP, поддерживаемых в Windows. Вместо этого мы рекомендуем использовать собственную репликацию высокого уровня доступности для конкретных баз данных, а также отдельные стеки хранилища.
- Развертывание баз данных SAP, поддерживаемых в Linux, с файлами базы данных, расположенными в общих папках NFS поверх использовании, за исключением SAP HANA
- Развертывание СУБД Oracle в любой другой гостевой ОС, чем в Windows и Oracle Linux. См. также [Примечание о поддержке SAP #2039619](https://launchpad.support.sap.com/#/notes/2039619)

Сценарии, которые мы не проверили, и поэтому не имеют опыта со списком, например:

- Azure Site Recovery репликация виртуальных машин уровня СУБД. В результате мы рекомендуем использовать собственные функции асинхронной репликации базы данных для потенциальной конфигурации аварийного восстановления.
 

## <a name="next-steps"></a>Дальнейшие действия
Ознакомьтесь со следующими шагами [планирования и внедрения SAP NetWeaver на виртуальных машинах Azure](./planning-guide.md) .




  