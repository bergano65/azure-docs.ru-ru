---
title: Типы хранилища Azure для рабочей нагрузки SAP
description: Планирование типов хранилища Azure для рабочих нагрузок SAP
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: bburns
editor: ''
tags: azure-resource-manager
keywords: ''
ms.assetid: d7c59cc1-b2d0-4d90-9126-628f9c7a5538
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 06/23/2020
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 4ed99145a2d3860849c4a8117a93a9a0f24d227c
ms.sourcegitcommit: 6ab718e1be2767db2605eeebe974ee9e2c07022b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2020
ms.locfileid: "94540932"
---
# <a name="azure-storage-types-for-sap-workload"></a>Типы Службы хранилища Azure для рабочей нагрузки SAP
В Azure существует множество типов хранилищ, которые значительно отличаются возможностями, пропускной способностью, задержкой и ценами. Некоторые типы хранилищ не имеют ограничений, или их можно использовать только для сценариев SAP. В то время как несколько типов хранилища Azure хорошо подходят или оптимизированы для конкретных сценариев рабочей нагрузки SAP. В частности, для SAP HANA некоторые типы хранилищ Azure сертифицированы на использование с SAP HANA. В этом документе мы собираемся выполнять различные типы хранилища и описать их возможности и удобство использования с рабочими нагрузками SAP и компонентами SAP.

Замечания о единицах, используемых в этой статье. Поставщики общедоступного облака перешли на использование гиб ([гибибайт](https://en.wikipedia.org/wiki/Gibibyte)) или Тиб ([тебибите](https://en.wikipedia.org/wiki/Tebibyte) в качестве единиц размера вместо гигабайта или терабайта). Поэтому все эти единицы используются в документации Azure и призинг.  На протяжении всего документа мы ссылающимися на эти единицы размера только для блоков MiB, гиб и тиб. Может потребоваться запланировать МБ, ГБ и ТБ. Таким образом, обратите внимание на некоторые небольшие различия в вычислениях, если необходимо изменить пропускную способность 400 MiB/с, а не пропускную способность 250 MiB/сек.

## <a name="microsoft-azure-storage-resiliency"></a>Устойчивость службы хранилища Microsoft Azure

Microsoft Azure хранения HDD (цен. категория "Стандартный"), SSD (цен. категория "Стандартный"), хранилища Azure класса Premium и Ultra Disk, позволяет хранить базовый виртуальный жесткий диск (с ОС) и диски данных или виртуальные машины, подключенные к виртуальной машине, в трех копиях на трех разных узлах хранилища. Переход на другую реплику и заполнение новой реплики в случае сбоя узла хранилища являются прозрачными. В результате этой избыточности **не** требуется использовать какой-либо уровень избыточности хранилища на нескольких дисках Azure. Такое хранилище называется локально избыточным (LRS). LRS используется по умолчанию для этих типов хранения в Azure. [Azure NetApp Files](https://azure.microsoft.com/services/netapp/) обеспечивает достаточную избыточность для достижения тех же соглашений об уровне обслуживания, что и другая собственная служба хранилища Azure.

Существует несколько дополнительных методов избыточности, которые описаны в статье [репликация службы хранилища Azure](../../../storage/common/storage-redundancy.md?toc=%2fazure%2fstorage%2fqueues%2ftoc.json) , которая применяется к некоторым из различных типов хранилищ, предлагаемых Azure. 

### <a name="azure-managed-disks"></a>Управляемые диски Azure

Управляемые диски — это тип ресурса в Azure Resource Manager, который можно использовать вместо виртуальных жестких дисков, хранящихся в учетных записях хранения Azure. Управляемые диски автоматически согласовываются с [набором доступности] [виртуальные машины — управление-доступность] виртуальной машины, к которой они подключены, и поэтому увеличивают доступность виртуальной машины и служб, работающих на виртуальной машине. Дополнительные сведения см. в [этой обзорной статье](../../managed-disks-overview.md).

В этом примере демонстрируется использование управляемых дисков, связанных с устойчивостью.

- Выполняется развертывание двух виртуальных машин СУБД для системы SAP в группе доступности Azure. 
- Когда Azure развертывает виртуальные машины, диск с образом ОС будет размещен в другом кластере хранилища. Это позволяет избежать того, что обе виртуальные машины повлияют на вопрос одного кластера службы хранилища Azure.
- При создании управляемых дисков, назначаемых этим виртуальным машинам для хранения файлов данных и журналов базы данных, эти новые диски для этих двух виртуальных машин также развертываются в отдельных кластерах хранения, поэтому ни один из дисков первой виртуальной машины не будет совместно использовать кластеры хранения с дисками второй виртуальной машины.

При развертывании без управляемых дисков в учетных записях хранения, определенных пользователем, выделение места на диске является произвольным и не имеет сведений о том, что виртуальные машины развертываются в AvSet для целей обеспечения устойчивости.

> [!NOTE]
> По этой причине и несколько других улучшений, которые доступны через управляемые диски, необходимо, чтобы новые развертывания виртуальных машин, использующих хранилище блоков Azure для своих дисков (все службы хранилища Azure за исключением Azure NetApp Files), использовали управляемые диски Azure для базовых дисков VHD/OS, диски данных, содержащие файлы базы данных SAP. Независимо от того, развертываются ли виртуальные машины с помощью группы доступности, в Зоны доступности или независимо от наборов и зон. Диски, используемые для хранения резервных копий, не обязательно должны быть управляемыми дисками.

> [!NOTE]
> Управляемые диски Azure обеспечивают только локальные избыточность (LRS). 


## <a name="storage-scenarios-with-sap-workloads"></a>Сценарии хранения с рабочими нагрузками SAP
Сохраняемое хранилище требуется в рабочей нагрузке SAP в различных компонентах стека, развертываемого в Azure. Ниже приведен список сценариев, как минимум:

- Сохраните базовый виртуальный жесткий диск виртуальной машины, на котором находится операционная система и другое программное обеспечение, устанавливаемое на этом диске. Этот диск или VHD является корнем виртуальной машины. Все изменения, внесенные в него, должны быть сохранены. Так что в следующий раз вы останавливаете и перезапустите виртуальную машину, все изменения, внесенные до того, как все еще существуют. Особенно в случаях, когда виртуальная машина развертывается в Azure на другом узле, отличном от изначально запущенного.
- Материализованные диски данных. Эти диски подключены к виртуальным жестким дискам, которые вы подключаете для хранения данных приложений. Это могут быть данные и файлы журнала/повтора базы данных, файлы резервных копий или установки программного обеспечения. Означает, что все диски выходят за пределы базового виртуального жесткого диска, содержащего операционную систему.
- Общие файловые ресурсы или общие диски, содержащие глобальный каталог транспорта для NetWeaver или S/4HANA. Содержимое этих общих папок потребляется программным обеспечением, работающим на нескольких виртуальных машинах, или используется для создания сценариев отказоустойчивого кластера с высоким уровнем доступности.
- Каталог/sapmnt или общие файловые ресурсы для процессов EDI или аналогичные. Содержимое этих общих папок потребляется программным обеспечением, работающим на нескольких виртуальных машинах, или используется для создания сценариев отказоустойчивого кластера с высоким уровнем доступности.

В следующих разделах рассматриваются различные типы хранилищ Azure и их удобство использования для рабочей нагрузки SAP, которые относятся к четырем приведенным выше сценариям. Общие сведения о том, как следует использовать различные типы хранилищ Azure, описаны в статье [какие типы дисков доступны в Azure?](../../disks-types.md) Рекомендации по использованию различных типов хранилища Azure для рабочей нагрузки SAP не будут существенно отличаться.

Сведения об ограничениях на поддержку типов хранилища Azure для SAP NetWeaver и уровня приложений S/4HANA см. в статье [Поддержка SAP. примечание 2015553](https://launchpad.support.sap.com/#/notes/2015553) SAP HANA для сертифицированных и поддерживаемых типов хранения Azure прочитайте статью [SAP HANA конфигураций хранилища виртуальных машин Azure](./hana-vm-operations-storage.md).

В разделах, описывающих различные типы хранилищ Azure, вы получите дополнительные сведения об ограничениях и возможностях, использующих хранилище, поддерживаемое SAP. 

## <a name="storage-recommendations-for-sap-storage-scenarios"></a>Рекомендации по хранилищу для сценариев хранения SAP
Прежде чем перейти к деталям, мы представляем сводку и рекомендации, уже имеющиеся в начале документа. В то время как подробные сведения о конкретных типах службы хранилища Azure приведены в этом разделе документа. Сводка рекомендаций по хранилищу для сценариев хранения SAP в таблице выглядит следующим образом:

| Сценарий использования | Диск HDD (цен. категория "Стандартный") | SSD (цен. категория "Стандартный") | Хранилище класса Premium | Диск (цен. категория "Ультра") | Azure NetApp Files |
| --- | --- | --- | --- | --- | --- |
| Диск ОС | не подходит |  только что подходящее (не производственное) | рекомендуется | невозможно | невозможно |
| Глобальный каталог транспорта | Не поддерживается | Не поддерживается | рекомендуется | рекомендуется | рекомендуется |
| /sapmnt | не подходит | только что подходящее (не производственное) | рекомендуется | рекомендуется | рекомендуется |
| Объем данных СУБД SAP HANA семейства виртуальных машин M/Mv2 | Не поддерживается | Не поддерживается | рекомендуется | рекомендуется | рекомендуется<sup>2</sup> |
| Объем журнала СУБД SAP HANA семейства виртуальных машин M/Mv2 | Не поддерживается | Не поддерживается | рекомендуется<sup>1</sup> | рекомендуется | рекомендуется<sup>2</sup> | 
| Объем данных СУБД SAP HANA семейства виртуальных машин Esv3/Edsv4 | Не поддерживается | Не поддерживается | рекомендуется | рекомендуется | рекомендуется<sup>2</sup> |
| Тома журнала СУБД SAP HANA семейства виртуальных машин Esv3/Edsv4 | Не поддерживается | Не поддерживается | Не поддерживается | рекомендуется | рекомендуется<sup>2</sup> | 
| Том данных СУБД, отличный от HANA | не поддерживается | только что подходящее (не производственное) | рекомендуется | рекомендуется | не поддерживается |
| Семейство машин журнала СУБД, не поддерживающее HANA M/Mv2 | не поддерживается | только что подходящее (не производственное) | рекомендуется<sup>1</sup> | рекомендуется | не поддерживается |
| Семейство машин журнала СУБД, не относящегося к HANA и Mv2 | не поддерживается | только что подходящее (не производственное) | подходит для до средней рабочей нагрузки | рекомендуется | не поддерживается |


<sup>1</sup> с использованием [ускоритель записи Azure](../../how-to-enable-write-accelerator.md) для семейств виртуальных машин M/Mv2 для журналов журнала/повторяемости <sup>2</sup> с помощью использовании требуется/Hana/Data, а/Hana/log — в использовании 

Характеристики, которые можно рассчитывать из списка различных типов хранения, например:

| Сценарий использования | Диск HDD (цен. категория "Стандартный") | SSD (цен. категория "Стандартный") | Хранилище класса Premium | Диск (цен. категория "Ультра") | Azure NetApp Files |
| --- | --- | --- | --- | --- | --- |
| Соглашение об уровне обслуживания операций ввода-вывода в секунду | Нет | Нет | да | да | да |
| Операции чтения с задержкой | high | от среднего до высокого | low | часть-миллисекунда | часть-миллисекунда |
| Задержка операций записи | high | от среднего до высокого  | низкая (часть миллисекунд<sup>1</sup>) | часть-миллисекунда | часть-миллисекунда |
| Поддерживаемые HANA | Нет | Нет | Да<sup>1</sup> | да | да |
| Возможные моментальные снимки диска | да | да | да | Нет | да |
| Выделение дисков в разных кластерах хранения при использовании групп доступности | через управляемые диски | через управляемые диски | через управляемые диски | Тип диска не поддерживается для виртуальных машин, развернутых с помощью групп доступности | нет<sup>3</sup> |
| По Зоны доступности | да | да | да | да | требуется участие корпорации Майкрософт |
| Избыточность зональные | не для управляемых дисков | не для управляемых дисков | не для управляемых дисков | Нет | Нет |
| Геоизбыточность | не для управляемых дисков | не для управляемых дисков | Нет | Нет | Нет |


<sup>1</sup> . использование [Azure ускоритель записи](../../how-to-enable-write-accelerator.md) для семейств виртуальных машин M/Mv2 для томов журналов журналов и повторов

<sup>2</sup> затраты зависят от подготовленных операций ввода-вывода и пропускной способности

<sup>3</sup> создание различных ПУЛОВ емкости использовании не гарантирует развертывание пулов емкости на разных единицах хранения.


> [!IMPORTANT]
> Для достижения менее чем 1 миллисекунды задержки ввода-вывода с помощью Azure NetApp Files (использовании) необходимо работать с корпорацией Майкрософт, чтобы организовать правильное размещение между виртуальными машинами и общими папками NFS на основе использовании. Пока нет механизма, обеспечивающего автоматический переход между развернутой виртуальной машиной и томами NFS, размещенными на использовании. Учитывая различные настройки различных регионов Azure, добавленная задержка сети может привести к задержке ввода-вывода в течение 1 миллисекунды, если виртуальная машина и общая папка NFS не распределены по сходству.


> [!IMPORTANT]
> Ни один из доступных в настоящее время управляемых дисков на основе хранилища блоков Azure или Azure NetApp Files не предлагают зональные или географической избыточности. Поэтому необходимо убедиться в том, что архитектуры высокого уровня доступности и аварийного восстановления не полагаются на репликацию собственного хранилища Azure для этих управляемых дисков, общих папок NFS или SMB.


## <a name="azure-premium-storage"></a>Хранилище Azure класса Premium
Хранилище SSD Azure Premium было введено с целью предоставления следующих целей:

* Низкая задержка ввода-вывода
* SLA для операций ввода-вывода и пропускной способности
* Снижение вариативности в задержках ввода-вывода

Этот тип хранилища предназначен для рабочих нагрузок СУБД, трафика хранилища, требующего низкой задержки в миллисекундах, и соглашения об уровне обслуживания для операций ввода-вывода в секунду и стоимости пропускной способности в случае хранилища Azure класса Premium — это не фактический объем данных, хранимый на таких дисках, а категория размера такого диска не зависит от объема данных, хранящихся на диске. Вы также можете создавать диски в хранилище класса Premium, которые не сопоставляются напрямую с категориями размера, приведенными в статье [SSD (цен. Категория "Премиум")](../../disks-types.md#premium-ssd). Выводы из этой статьи:

- Хранилище организовано в диапазоны. Например, диск в диапазоне 513 гиб to 1024 гиб Capacity совместно используют одни и те же ежемесячные затраты.
- Число операций ввода-вывода в секунду на гиб не отслеживает линейную шкалу по категориям размера. Диски меньшего размера ниже 32 гиб имеют более высокие частоты операций ввода-вывода в секунду на гиб. Для дисков, превышающих 32 гиб 1024 гиб, частота операций ввода-вывода в секунду для каждого гиб составляет от 4-5 до гиб операций ввода/вывода в секунду. Для больших дисков размером до 32 767 гиб скорость операций ввода-вывода в секунду на гиб будет ниже 1
- Пропускная способность ввода-вывода для этого хранилища не является линейной с размером категории дисков. Для небольших дисков, например для категории между 65 гиб и 128 гиб, пропускная способность составляет около 780KB/гиб. В то время как для очень больших дисков, таких как диск 32 767 гиб, пропускная способность составляет около 28KB/гиб
- Соглашения об уровне обслуживания операций ввода-вывода и пропускной способности не могут быть изменены без изменения емкости диска

Azure имеет соглашение об уровне обслуживания ВМ с одним экземпляром 99,9%, привязанное к использованию хранилища Azure класса Premium или Azure Ultra Storage. Соглашение об уровне обслуживания описано в [соглашении об уровне обслуживания для виртуальных машин](https://azure.microsoft.com/support/legal/sla/virtual-machines/). Чтобы обеспечить соответствие этому единственному соглашению об уровне обслуживания виртуальной машины, базовый диск виртуального жесткого диска, а также **все** подключенные диски должны быть либо хранилищем Azure уровня "Премиум", либо хранилищем Azure Ultra Disk.

Матрица возможностей для рабочей нагрузки SAP выглядит следующим образом:

| Функция| Комментировать| Заметки и ссылки | 
| --- | --- | --- | 
| Базовый виртуальный жесткий диск ОС | непригодны | Все системы |
| Диск данных | непригодны | Все системы — [специально для SAP HANA](../../how-to-enable-write-accelerator.md) |
| Глобальный каталог транспорта SAP | YES | [Поддерживается](https://launchpad.support.sap.com/#/notes/2015553) |
| Sapmnt SAP | непригодны | Все системы |
| Хранилище резервных копий | непригодны | краткосрочное хранение резервных копий |
| Общие ресурсы и общий диск | недоступно | Требуются файлы Azure Premium или сторонние лица |
| Устойчивость | LRS | Нет GRS или ZRS, доступных для дисков |
| Задержка | от низкого до среднего | - |
| СОГЛАШЕНИЕ ОБ УРОВНЕ ОБСЛУЖИВАНИЯ ВВОДА-ВЫВОДА | YES | - |
| Линейная шкала ввода-вывода | половина линейной скобки  | [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/) |
| Максимальное количество операций ввода-вывода в секунду на диск | 20 000 [зависит от размера диска](https://azure.microsoft.com/pricing/details/managed-disks/) | Также учитывайте [ограничения виртуальной машины](../../sizes.md) |
| SLA пропускной способности | YES | - |
| Линейная пропускная способность для емкости | половина линейной скобки | [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/) |
| Сертифицировано HANA | YES | [специально для SAP HANA](../../how-to-enable-write-accelerator.md) |
| Возможные моментальные снимки диска | YES | - |
| Возможен Azure Backup моментальных снимков виртуальной машины | YES | за исключением [ускоритель записи](../../how-to-enable-write-accelerator.md) кэшированных дисков  |
| Затраты | MEDIUM | - |

Хранилище Azure класса Premium не выполняет SAP HANA, а также общие типы кэширования, предлагаемые в хранилище Azure класса Premium. Чтобы обеспечить соответствие ключевых показателей времени задержки хранилища для SAP HANA записи журнала, необходимо использовать кэширование Azure Ускоритель записи, как описано в статье [включение ускоритель записи](../../how-to-enable-write-accelerator.md). Azure Ускоритель записи использует преимущества всех других систем СУБД для их записи в журнал транзакций и записи журнала повтора. Поэтому рекомендуется использовать его во всех развертываниях СУБД SAP. Для SAP HANA использование Ускоритель записи Azure в сочетании с хранилищем Azure класса Premium является обязательным.



**Сводка:** Хранилище Azure класса Premium — это один из типов хранилища Azure, рекомендуемых для рабочей нагрузки SAP. Эта рекомендация распространяется на нерабочие и рабочие системы. Хранилище Azure класса Premium подходит для работы с рабочими нагрузками базы данных. Использование Ускоритель записи Azure значительно повышает задержку записи на диски Azure уровня "Премиум". Однако для систем СУБД с высокими показателями операций ввода-вывода в секунду и пропускной способностью необходимо либо чрезмерно освободить емкость хранилища, либо использовать такие функции, как дисковые пространства Windows или диспетчеры логических томов в Linux, для создания чередующихся наборов, которые обеспечивают требуемую емкость на одной стороне, но также необходимые операции ввода-вывода или пропускную способность с наибольшей эффективностью.


### <a name="azure-burst-functionality-for-premium-storage"></a>Функция ускорения Azure для хранилища класса Premium
Для дисков хранилища Azure класса Premium, которые меньше или равны 512 гиб, предлагается Пакетная функциональность. Точный способ работы с пакетной обработкой дисков описан в статье об [ускоренном](../../linux/disk-bursting.md)использовании диска. Когда вы прочитаете статью, вы понимаете концепцию начисления операций ввода-вывода и пропускной способности в то время, когда Рабочая нагрузка ввода и ввода превышает номинальную пропускную способность дисков (для получения дополнительных сведений о номинальной пропускной способности см. [цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/)). Вы собираетесь начислять разность операций ввода-вывода в секунду и пропускную способность между текущим использованием и номинальными значениями диска. Максимальное число пакетов ограничено 30 минутами.

В идеале, в котором можно планировать эту функцию, скорее всего, будут тома или диски, содержащие файлы данных для разных СУБД. Ожидаемая рабочая нагрузка ввода-вывода для этих томов, особенно с системами с небольшим и средним диапазоном, должна выглядеть следующим образом:

- Низкая и средняя Рабочая нагрузка чтения, так как в идеале данные кэшируются в памяти, или, как и в случае с HANA, должны полностью находиться в памяти
- Пакеты записи, активируемые контрольными точками базы данных или точки сохранения, которые выдаются регулярно
- Рабочая нагрузка резервного копирования, считывающая данные в непрерывном потоке в случаях, когда резервное копирование не выполняется с помощью моментальных снимков хранилища
- Загрузка данных в память после перезапуска экземпляра SAP HANA

Особенно для систем с меньшими СУБД, в которых Рабочая нагрузка обрабатывает не более сотни транзакций в секунду, такой режим работы может также иметь смысл для дисков или томов, в которых хранятся транзакции или журналы повторов. Ожидаемая рабочая нагрузка на таких дисках или томах выглядит следующим образом:

- Обычная запись на диск, зависящая от рабочей нагрузки, и природа рабочей нагрузки, так как каждая фиксация, выданная приложением, может активировать операцию ввода-вывода.
- Повышение пропускной способности в случае рабочих задач, таких как создание или перестроение индексов
- Пакеты чтения при выполнении журналов транзакций или резервных копий журналов повторов


## <a name="azure-ultra-disk"></a>Ultra Disk в Azure
Диски Azure категории "Ультра" предоставляют для виртуальных машин IaaS Azure дисковое хранилище с высокой пропускной способностью, большим количеством операций ввода-вывода в секунду и постоянной низкой задержкой. К некоторым дополнительным преимуществам использования Ultra дисков относится возможность динамического изменения операций ввода-вывода и пропускной способности диска вместе с рабочими нагрузками без необходимости перезапуска виртуальных машин (ВМ). Ultra Disks подходит для рабочих нагрузок, интенсивно использующих данные, таких как Рабочая нагрузка SAP СУБД. Ultra Disks можно использовать только в качестве дисков данных и не может использоваться в качестве базового диска VHD, в котором хранится операционная система. Мы рекомендуем использовать хранилище Azure уровня "Премиум" как диск на основе VHD.

При создании диска Ultra можно определить три измерения:

- Емкость диска. Диапазоны — от 4 гиб до 65 536 гиб
- Подготовленные операции ввода-вывода для диска. Различные максимальные значения применяются к емкости диска. Дополнительные сведения см. в статье о [Ultra Disk](../../disks-types.md#ultra-disk) .
- Подготовленная пропускная способность хранилища. В зависимости от емкости диска применяется другая максимальная пропускная способность. Дополнительные сведения см. в статье о [Ultra Disk](../../disks-types.md#ultra-disk) .

Стоимость отдельного диска определяется тремя измерениями, которые можно определить отдельно для отдельных дисков. 


Матрица возможностей для рабочей нагрузки SAP выглядит следующим образом:

| Функция| Комментировать| Заметки и ссылки | 
| --- | --- | --- | 
| Базовый виртуальный жесткий диск ОС | не работает | - |
| Диск данных | непригодны | Все системы  |
| Глобальный каталог транспорта SAP | YES | [Поддерживается](https://launchpad.support.sap.com/#/notes/2015553) |
| Sapmnt SAP | непригодны | Все системы |
| Хранилище резервных копий | непригодны | краткосрочное хранение резервных копий |
| Общие ресурсы и общий диск | недоступно | Требуется третья сторона |
| Устойчивость | LRS | Нет GRS или ZRS, доступных для дисков |
| Задержка | очень низкий | - |
| СОГЛАШЕНИЕ ОБ УРОВНЕ ОБСЛУЖИВАНИЯ ВВОДА-ВЫВОДА | YES | - |
| Линейная шкала ввода-вывода | половина линейной скобки  | [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/) |
| Максимальное количество операций ввода-вывода в секунду на диск | от 1 200 до 160 000 | зависит от емкости диска |
| SLA пропускной способности | YES | - |
| Линейная пропускная способность для емкости | половина линейной скобки | [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/) |
| Сертифицировано HANA | YES | - |
| Возможные моментальные снимки диска | NO | - |
| Возможен Azure Backup моментальных снимков виртуальной машины | NO | - |
| Затраты | Выше, чем хранилище класса Premium | - |



**Сводка:** Высокоскоростные диски Azure — это подходящее хранилище с низкой задержкой для всех видов рабочей нагрузки SAP. На данный момент Ultra Disk можно использовать только в сочетании с виртуальными машинами, развернутыми с помощью Зоны доступности (зональные Deployment). На данный момент Ultra Disk не поддерживает моментальные снимки хранилища. В отличие от любого другого хранилища, для базового диска VHD нельзя использовать Ultra Disk. "Ultra Disk" идеально подходит для случаев, когда Рабочая нагрузка ввода-вывода изменяется много времени и требуется адаптировать развернутую пропускную способность хранилища или операций чтения-вывода к шаблонам рабочих нагрузок хранилища вместо определения максимального использования пропускной способности и операций ввода/вывода


## <a name="azure-netapp-files-anf"></a>Файлы Azure NetApp (использовании)
[Azure NetApp Files](https://azure.microsoft.com/services/netapp/) является результатом взаимодействия между корпорацией Майкрософт и NetApp с целью предоставления высокопроизводительных общих ресурсов NFS и SMB в Azure. Основное внимание состоит в том, чтобы обеспечить высокую пропускную способность и хранение с низкой задержкой, которая позволяет выполнять сценарии развертывания СУБД и со временем включать стандартные функциональные возможности хранилища NetApp в Azure. Общие ресурсы NFS и SMB предлагаются на трех разных уровнях обслуживания, которые различают пропускную способность и стоимость хранилища. Уровни обслуживания описаны в статье [уровни служб для Azure NetApp Files](../../../azure-netapp-files/azure-netapp-files-service-levels.md). Для различных типов рабочей нагрузки SAP настоятельно рекомендуется использовать следующие уровни обслуживания:

- Рабочая нагрузка SAP СУБД: производительность, в идеале — Ultra
- Общая папка SAPMNT: производительность, в идеале — Ultra
- Глобальный каталог транспорта: производительность, в идеале — Ultra

> [!NOTE]
> Минимальный размер подготовки — это 4-Тибная единица, называемая пулом ресурсов. Затем вы создадите тома из этого пула емкости. В то время как самый маленький том можно создать в 100 гиб. Пул емкости можно развернуть в Тиб шагах. Сведения о ценах см. в статье [Azure NetApp Files цены](https://azure.microsoft.com/pricing/details/netapp/)

В настоящее время хранилище использовании поддерживается в нескольких сценариях рабочей нагрузки SAP:

- Предоставление общих папок SMB или NFS для глобального транспортного каталога SAP
- Общий ресурс sapmnt в сценариях высокого уровня доступности, как описано в:
    - [Высокий уровень доступности SAP NetWeaver на виртуальных машинах Azure в Windows с Azure NetApp Files (SMB) для приложений SAP](./high-availability-guide-windows-netapp-files-smb.md)
    - [Обеспечение высокого уровня доступности виртуальных машин Azure для SAP NetWeaver на SUSE Linux Enterprise Server с помощью Azure NetApp Files для приложений SAP](./high-availability-guide-suse-netapp-files.md)
    - [Высокая доступность виртуальных машин Azure для SAP NetWeaver на Red Hat Enterprise Linux с Azure NetApp Files для приложений SAP](./high-availability-guide-rhel-netapp-files.md)
- SAP HANA развертываний с помощью общих папок NFS версии 4.1 для томов/Hana/Data и/Hana/log и (или) томов NFS версии 4.1 или NFS v3 для томов/Hana/Shared, как описано в статье [SAP HANA конфигурациях хранилища виртуальных машин Azure](./hana-vm-operations-storage.md) .

> [!NOTE]
> Никакие другие рабочие нагрузки СУБД не поддерживаются для Azure NetApp Files общих папок NFS или SMB. Если это будет изменено, будут предоставлены обновления и изменения.

Как уже с хранилищем Azure класса Premium, фиксированный или линейный размер пропускной способности в ГБ может быть проблемой, если необходимо придерживаться некоторых минимальных значений пропускной способности. Как и в случае с SAP HANA. С использовании эта проблема может стать более произносится по сравнению с диском Azure класса Premium. В случае с диском Azure уровня "Премиум" можно использовать несколько небольших дисков с относительно высокой пропускной способностью на гиб и чередованием, чтобы обеспечить экономичность и повысить пропускную способность при меньшей емкости. Этот тип чередования не работает для общих папок NFS или SMB, размещенных на использовании. Это ограничение привело к развертыванию превышения емкости, например:

- Чтобы добиться этого, например, пропускная способность 250 MiB/сек на томе NFS, размещенном на использовании, необходимо развернуть 1,95 Тиб емкости уровня Ultra Service. 
- Чтобы получить 400 MiB/сек, вам потребуется развернуть Тиб емкость 3,125. Однако для достижения пропускной способности, необходимой для тома, может потребоваться чрезмерная подготовка емкости. Такая чрезмерная подготовка емкости влияет на цену небольших экземпляров HANA. 
- В пространстве, где используется NFS поверх использовании для каталога SAP/sapmnt, обычно применяется минимальная емкость 100 гиб 150 гиб, которая обеспечивается Azure NetApp Files. Однако при работе с клиентами было продемонстрировано, что связанная пропускная способность 12,8 MiB/с (с использованием Ultra Service Level) может быть недостаточно и может негативно сказаться на стабильности системы SAP. В таких случаях клиенты могут избежать проблем, увеличив объем тома/sapmnt, чтобы обеспечить дополнительную пропускную способность для этого тома.

Матрица возможностей для рабочей нагрузки SAP выглядит следующим образом:

| Функция| Комментировать| Заметки и ссылки | 
| --- | --- | --- | 
| Базовый виртуальный жесткий диск ОС | не работает | - |
| Диск данных | непригодны | Только SAP HANA  |
| Глобальный каталог транспорта SAP | YES | SMB и NFS |
| Sapmnt SAP | непригодны | Все системы SMB (только для Windows) или NFS (только для Linux) |
| Хранилище резервных копий | непригодны | - |
| Общие ресурсы и общий диск | YES | SMB 3,0, NFS v3 и NFS v 4.1 |
| Устойчивость | LRS | Нет GRS или ZRS, доступных для дисков |
| Задержка | очень низкий | - |
| СОГЛАШЕНИЕ ОБ УРОВНЕ ОБСЛУЖИВАНИЯ ВВОДА-ВЫВОДА | YES | - |
| Линейная шкала ввода-вывода | строго линейный  | Зависит от [уровня обслуживания](../../../azure-netapp-files/azure-netapp-files-service-levels.md) |
| SLA пропускной способности | YES | - |
| Линейная пропускная способность для емкости | половина линейной скобки | Зависит от [уровня обслуживания](../../../azure-netapp-files/azure-netapp-files-service-levels.md) |
| Сертифицировано HANA | YES | - |
| Возможные моментальные снимки диска | YES | - |
| Возможен Azure Backup моментальных снимков виртуальной машины | NO | - |
| Затраты | Выше, чем хранилище класса Premium | - |


Дополнительные встроенные функции хранилища использовании:

- Возможность создавать моментальные снимки тома
- Клонирование томов использовании из моментальных снимков
- Восстановление томов из моментальных снимков (оснастка-Отмена)

**Сводка**. Azure NetApp Files — это хранилище с низкой задержкой Hana, которое позволяет развертывать тома NFS и SMB, а также общие папки. Хранилище поставляется с тремя различными уровнями обслуживания, которые обеспечивают разную пропускную способность и операции ввода-вывода в одну и ту же гибную емкость тома. Хранилище использовании позволяет развертывать SAP HANA сценарии горизонтального масштабирования с резервным узлом. Хранилище подходит для предоставления файловых ресурсов, необходимых для каталога глобального транспорта/sapmnt или SAP. В использовании хранилище входят функциональные возможности, доступные как собственные функции NetApp.  



## <a name="azure-standard-ssd-storage"></a>Стандартное хранилище SSD Azure
По сравнению с хранилищем стандартных жестких дисков Azure, хранилище стандартных SSD Azure обеспечивает лучшую доступность, согласованность, надежность и задержку. Он оптимизирован для рабочих нагрузок, которым необходима постоянная производительность при более низких уровнях операций ввода-вывода в секунду. Это минимальное хранилище, используемое для непроизводственных систем SAP с низкими требованиями к операциям ввода-вывода в секунду и пропускной способности. Матрица возможностей для рабочей нагрузки SAP выглядит следующим образом:

| Функция| Комментировать| Заметки и ссылки | 
| --- | --- | --- | 
| Базовый виртуальный жесткий диск ОС | подходящее ограничение | нерабочие системы |
| Диск данных | подходящее ограничение | Некоторые непроизводственные системы с низкими требованиями к операциям ввода-вывода и задержкам |
| Глобальный каталог транспорта SAP | NO | [Не поддерживается](https://launchpad.support.sap.com/#/notes/2015553) |
| Sapmnt SAP | подходящее ограничение | нерабочие системы |
| Хранилище резервных копий | непригодны | - |
| Общие ресурсы и общий диск | недоступно | Требуется третья сторона |
| Устойчивость | LRS, GRS | Нет доступных ZRS для дисков |
| Задержка | high | слишком большое для глобального транспортного каталога SAP или рабочих систем |
| СОГЛАШЕНИЕ ОБ УРОВНЕ ОБСЛУЖИВАНИЯ ВВОДА-ВЫВОДА | NO | - |
| Максимальное количество операций ввода-вывода в секунду на диск | 500 | Независимо от размера диска; |
| SLA пропускной способности | NO | - |
| Сертифицировано HANA | NO | - |
| Возможные моментальные снимки диска | YES | - |
| Возможен Azure Backup моментальных снимков виртуальной машины | YES | - |
| Затраты | LOW | - |



**Сводка:** Стандартное хранилище SSD Azure — это минимальная рекомендация для нерабочих виртуальных машин для базового виртуального жесткого диска, в конечном итоге при развертывании СУБД с относительной задержкой и/или низкой скоростью операций ввода-вывода в секунду и пропускной способности. Этот тип хранилища Azure больше не поддерживается для размещения глобального каталога транспорта SAP. 



## <a name="azure-standard-hdd-storage"></a>Хранилище "Стандартный HDD" Azure
Хранилище Azure HDD (цен. категория "Стандартный") является единственным типом хранилища, когда инфраструктура Azure получила сертификат для рабочей нагрузки SAP NetWeaver в 2014 году. В 2014 году виртуальные машины Azure были небольшими и низкими пропускной способностью хранилища. Таким образом, этот тип хранилища мог бы справиться с требованиями. Хранилище идеально подходит для нечувствительных к задержкам рабочих нагрузок, которые вряд ли сталкиваются в пространстве SAP. С увеличением пропускной способности виртуальных машин Azure и повышенной рабочей нагрузкой этих виртуальных машин этот тип хранилища больше не рассматривается для использования в сценариях SAP. Матрица возможностей для рабочей нагрузки SAP выглядит следующим образом:

| Функция| Комментировать| Заметки и ссылки | 
| --- | --- | --- | 
| Базовый виртуальный жесткий диск ОС | не подходит | - |
| Диск данных | не подходит | - |
| Глобальный каталог транспорта SAP | NO | [Не поддерживается](https://launchpad.support.sap.com/#/notes/2015553) |
| Sapmnt SAP | NO | Не поддерживается |
| Хранилище резервных копий | непригодны | - |
| Общие ресурсы и общий диск | недоступно | Требуются файлы Azure или сторонние лица |
| Устойчивость | LRS, GRS | Нет доступных ZRS для дисков |
| Задержка | high | слишком большое для использования СУБД, глобального транспортного каталога SAP или sapmnt/файловый ресурс saploc |
| СОГЛАШЕНИЕ ОБ УРОВНЕ ОБСЛУЖИВАНИЯ ВВОДА-ВЫВОДА | NO | - |
| Максимальное количество операций ввода-вывода в секунду на диск | 500 | Независимо от размера диска; |
| SLA пропускной способности | NO | - |
| Сертифицировано HANA | NO | - |
| Возможные моментальные снимки диска | YES | - |
| Возможен Azure Backup моментальных снимков виртуальной машины | YES | - |
| Затраты | LOW | - |



**Сводка:** HDD (цен. категория "Стандартный") — это тип хранилища Azure, который должен использоваться только для хранения резервных копий SAP. Его следует использовать только в качестве базового виртуального жесткого диска для неактивных систем, таких как устаревшие системы, используемые для поиска данных. Но ни одна из активных виртуальных машин разработки, вопросов и ответов не должна основываться на этом хранилище. И не должны размещать файлы базы данных в этом хранилище


## <a name="azure-vm-limits-in-storage-traffic"></a>Ограничения виртуальной машины Azure в трафике хранилища
В отличие от локальных сценариев, выбираемый тип конкретной виртуальной машины играет важную роль в пропускной способности хранилища, которую можно достичь. Для различных типов хранения необходимо учитывать следующее.

| Тип хранилища| Linux | Windows | Комментарии |
| --- | --- | --- | --- |
| Диск HDD (цен. категория "Стандартный") | [Размеры виртуальных машин Linux в Azure](../../sizes.md) | [Размеры виртуальных машин Windows в Azure](../../sizes.md) | Вероятно, трудно коснуться ограничений хранилища для средних или крупных виртуальных машин. |
| SSD (цен. категория "Стандартный") | [Размеры виртуальных машин Linux в Azure](../../sizes.md) | [Размеры виртуальных машин Windows в Azure](../../sizes.md) | Вероятно, трудно коснуться ограничений хранилища для средних или крупных виртуальных машин. |
| Хранилище класса Premium | [Размеры виртуальных машин Linux в Azure](../../sizes.md) | [Размеры виртуальных машин Windows в Azure](../../sizes.md) | Простота попадания в операции ввода-вывода или ограничение пропускной способности хранилища в конфигурации хранилища |
| Хранилище Ultra Disk | [Размеры виртуальных машин Linux в Azure](../../sizes.md) | [Размеры виртуальных машин Windows в Azure](../../sizes.md) | Простота попадания в операции ввода-вывода или ограничение пропускной способности хранилища в конфигурации хранилища |
| Azure NetApp Files | [Размеры виртуальных машин Linux в Azure](../../sizes.md) | [Размеры виртуальных машин Windows в Azure](../../sizes.md) | Трафик хранилища использует пропускную способность сети, а не пропускную способность хранилища. |

В качестве ограничений можно отметить следующее:

- Чем меньше виртуальная машина, тем меньше дисков можно подключить. Это не относится к использовании. Так как вы подключаете NFS или общие ресурсы SMB, вы не сталкиваетесь с ограничением числа общих томов, подсоединенных
- У виртуальных машин есть ограничения на пропускную способность ввода-вывода и количество операций в секунду, которые легко можно превысить с помощью дисков хранилища Premium и Ultra.
- При использовании использовании трафик к общим томам использует пропускную способность сети виртуальной машины, а не пропускную способность хранилища.
- При наличии больших томов NFS в Тиб пространстве с двойной цифрой пропускная способность, обращающаяся к такому тому из одной виртуальной машины, будет платоа на основе ограничений Linux для одного сеанса, взаимодействующего с общим томом. 

По мере увеличения размера виртуальных машин Azure в жизненном цикле системы SAP необходимо оценить ограничения на количество операций ввода-вывода и пропускную способность хранилища для нового и более крупного типа виртуальной машины. В некоторых случаях также может быть целесообразно настроить конфигурацию хранилища для новых возможностей виртуальной машины Azure. 


## <a name="striping-or-not-striping"></a>Чередование или не чередование
Создание чередующегося набора из нескольких дисков Azure в одном крупном томе позволяет накапливать операции ввода-вывода и пропускную способность отдельных дисков в одном томе. Он используется только для хранилища Azure уровня "Стандартный" и Azure класса Premium. На диске Azure Ultra можно настроить пропускную способность и операции ввода-вывода независимо от емкости диска, не требуя использования чередующихся наборов. Общие тома на основе NFS или SMB не могут быть чередующимися. Из-за нелинейной природы пропускной способности и операций ввода-вывода в хранилище Azure класса Premium можно подготавливать меньшие ресурсы с теми же операциями ввода-вывода и пропускной способностью, чем крупные диски хранилища Azure класса Premium. Это метод для достижения более высокой пропускной способности или операций ввода-вывода с меньшими затратами с использованием хранилища Azure класса Premium. Например, чередование на двух дисках хранилища p15 Premium дает вам пропускную способность: 

- 250 MiB/сек. Такой том будет иметь емкость 512 гиб. Если вы хотите использовать один диск, который предоставляет 250 MiB в секунду, необходимо выбрать диск P40 с 2 Тиб емкостью. 
- 400 MiB/сек путем чередования четырех дисков хранилища класса Premium с общей емкостью 512 гиб. Если вы хотите использовать один диск с минимальной пропускной способностью 500 MiB в секунду, вам потребуется выбрать P60 диск хранилища класса Premium с 8 тиб. Так как стоимость хранилища класса Premium приближается к емкости, вы можете снизить затраты, используя чередование.

Перед чередованием необходимо выполнить некоторые правила.

- Не следует использовать настроенное хранилище в виртуальной машине, так как хранилище Azure хранит данные, которые уже избыточны
- Диски, к которым применяется чередующийся набор, должны иметь одинаковый размер

Чередование на нескольких дисках меньшего размера является лучшим способом достижения хорошего соотношения цены и производительности с помощью хранилища Azure класса Premium. Это означает, что чередование имеет некоторую дополнительную нагрузку по развертыванию и управлению.

Конкретные рекомендации по размеру чередования см. в документации по различным СУБД, например [SAP HANA конфигурациям хранилища виртуальных машин Azure](./hana-vm-operations-storage.md).




## <a name="next-steps"></a>Дальнейшие действия
Ознакомьтесь со статьями:

- [Вопросы развертывания СУБД для рабочей нагрузки SAP на виртуальных машинах Azure](./dbms_guide_general.md)
- [Конфигурации хранилища виртуальных машин SAP HANA в Azure](./hana-vm-operations-storage.md)
 
