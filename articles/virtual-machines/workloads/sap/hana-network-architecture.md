---
title: Сетевая архитектура SAP HANA в Azure (крупные экземпляры) | Документация Майкрософт
description: Сетевая архитектура развертывания SAP HANA в Azure (крупные экземпляры).
services: virtual-machines-linux
documentationcenter: ''
author: RicksterCDN
manager: gwallace
editor: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 07/15/2019
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 24404d6b55f83f96d8e2601afd35b2dec00cc7e9
ms.sourcegitcommit: 44e85b95baf7dfb9e92fb38f03c2a1bc31765415
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2019
ms.locfileid: "70099736"
---
# <a name="sap-hana-large-instances-network-architecture"></a>Сетевая архитектура SAP HANA в Azure (крупные экземпляры)

Архитектура сетевых служб Azure является ключевым компонентом для успешного развертывания приложений SAP в крупных экземплярах HANA. Как правило, развернутое решение "SAP HANA в Azure (крупные экземпляры)" отличается большим ландшафтом SAP, который включает в себя несколько разных решений SAP с различными размерами баз данных, а также показателями потребления ресурсов ЦП и памяти. Скорее всего, не все ИТ – системы уже находятся в Azure. Ландшафт SAP часто используется в сочетании с точкой СУБД и точкой приложения SAP с использованием разных технологий NetWeaver, а также S/4HANA и SAP HANA и других СУБД. Azure предлагает различные службы, которые позволяют запускать различные системы СУБД, NetWeaver и S/4HANA в Azure. Azure также предлагает сетевые технологии, чтобы сделать Azure в качестве виртуального центра обработки данных для локальных развертываний программного обеспечения.

Если в Azure не размещаются все системы ИТ. Функциональные возможности сети Azure используются для подключения к локальному миру с ресурсами Azure, чтобы сделать Azure как виртуальным центром обработки данных. Используются следующие функции сети Azure: 

- Виртуальные сети Azure подключены к каналу [ExpressRoute](https://azure.microsoft.com/services/expressroute/) , который подключается к локальным сетевым ресурсам.
- Канал ExpressRoute, который подключается локально к Azure, должен иметь минимальную пропускную способность [1 Гбит/с или выше](https://azure.microsoft.com/pricing/details/expressroute/). Это позволяет обеспечить достаточную пропускную способность для передачи данных между локальными системами и системами, запущенными на виртуальных машинах, а также подключение к системам Azure из локальной среды конечных пользователей.
- Все системы SAP в Azure настраиваются в виртуальных сетях для взаимодействия друг с другом.
- Active Directory и DNS, размещенные локально, расширяются в Azure с помощью ExpressRoute из локальной среды или выполняются в Azure.

В случае интеграции крупных экземпляров HANA в сетевую структуру центра обработки данных Azure также используется технология Azure ExpressRoute.


> [!NOTE] 
> Только одну подписку Azure можно связать только с одним клиентом в отметке крупных экземпляров HANA в определенном регионе Azure. И наоборот, один клиент метки крупных экземпляров HANA может быть связан только с одной подпиской Azure. Этот факт не отличается от любых других объектов в Azure, которые подлежат оплате.

Если SAP HANA в Azure (крупные экземпляры) развертываются в нескольких разных регионах Azure, в отметке крупных экземпляров HANA развертывается отдельный клиент. Оба клиента могут выполняться в одной подписке Azure, если эти экземпляры являются частью одного ландшафта SAP. 

> [!IMPORTANT] 
> С SAP HANA в Azure (крупные экземпляры) поддерживается только метод развертывания Azure Resource Manager.

 

## <a name="additional-virtual-network-information"></a>Дополнительные сведения о виртуальной сети

Чтобы подключить виртуальную сеть к ExpressRoute, необходимо создать шлюз Azure ExpressRoute. Дополнительные сведения см. в статье [о шлюзах expressroute для expressroute](../../../expressroute/expressroute-about-virtual-network-gateways.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). 

Шлюз Azure ExpressRoute используется с ExpressRoute для инфраструктуры за пределами Azure или штампа крупных экземпляров Azure. Вы можете подключить шлюз Azure ExpressRoute к максимальному числу каналов ExpressRoute, если эти подключения поступают от разных пограничных маршрутизаторов Microsoft. Дополнительные сведения см. в статье [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). 

> [!NOTE] 
> Максимальная пропускная способность, которую можно достичь с помощью шлюза ExpressRoute, составляет 10 Гбит/с с использованием подключения ExpressRoute. При копировании файлов между виртуальной машиной, расположенной в виртуальной сети, и локальной системой (в рамках одного потока копирования) невозможно достичь полной пропускной способности шлюза с разными номерами SKU. Чтобы использовать всю пропускную способность шлюза ExpressRoute, используйте несколько потоков. Также можно копировать разные файлы с помощью параллельных потоков одного файла.


## <a name="networking-architecture-for-hana-large-instance"></a>Архитектура сети для крупных экземпляров HANA
Архитектуру сети для крупных экземпляров HANA можно разделить на четыре части:

- Локальная сеть и подключение ExpressRoute к Azure. Эта часть является доменом пользователей и подключается к Azure через ExpressRoute. Этот канал Expressroute полностью оплачивается вами в качестве клиента. Пропускная способность должна быть достаточно большой, чтобы обрабатывать сетевой трафик между локальными ресурсами и регионом Azure, к которому вы подключаетесь. См. правый нижний угол на схеме ниже.
- Сетевые службы Azure, как описано выше, с виртуальными сетями, которые опять требуют добавления шлюзов ExpressRoute. В этой области необходимо определить подходящую структуру в соответствии с требованиями приложений, безопасности и нормативных требований. При использовании крупных экземпляров HANA также необходимо выбрать число виртуальных сетей и SKU шлюзов Azure. См. правый верхний угол на схеме.
- Подключение крупных экземпляров HANA к Azure с помощью технологии ExpressRoute. Эту часть развертывает и обслуживает корпорация Майкрософт. Вам достаточно предоставить диапазоны IP-адресов и после развертывания ресурсов в крупных экземплярах HANA подключить канал ExpressRoute к виртуальным сетям. Дополнительные сведения см. в статье [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). В качестве клиента для подключения между единицами сети центра обработки данных Azure и крупными экземплярами HANA не взимается дополнительная плата.
- Сеть в отметке крупных экземпляров HANA, которая в основном прозрачна для вас.

![Виртуальная сеть подключена к SAP HANA в Azure (крупные экземпляры) и к локальной сети](./media/hana-overview-architecture/image1-architecture.png)

Использование крупных экземпляров HANA не отменяет требование подключать локальные ресурсы к Azure через ExpressRoute. Также требуется иметь одну или несколько виртуальных сетей с виртуальными машинами, на которых размещен уровень приложений, который подключается к экземплярам HANA, размещенным в единицах крупных экземпляров HANA. 

Отличия развертываний SAP только в Azure заключаются в следующем:

- Единицы крупных экземпляров HANA пользовательского клиента соединены через другой канал ExpressRoute с виртуальными сетями. Для разделения условий загрузки локальная сеть и каналы ExpressRoute виртуальной сети Azure и каналы между виртуальными сетями Azure и крупными экземплярами HANA не используют одни и те же маршрутизаторы.
- Профиль рабочей нагрузки между уровнем приложений SAP и крупным экземпляром HANA является другой причиной возникновения множества небольших запросов и пиков передачи данных (результирующие наборы) между SAP HANA и уровнем приложений.
- Архитектура приложения SAP более чувствительна к задержкам в сети, чем в типичных сценариях, где обмен данными происходит между локальной средой и Azure.
- Шлюз Azure ExpressRoute имеет по крайней мере два подключения ExpressRoute. Один канал, подключенный из локальной сети и другой, подключенный из крупных экземпляров HANA. Это оставляет только место для двух других цепей из разных MSEE для подключения к шлюзу ExpressRoute. Это ограничение не зависит от использования быстрого пути ExpressRoute. Все подключенные цепи имеют максимальную пропускную способность для входящих данных шлюза ExpressRoute.

В версии 3 меток крупных экземпляров HANA задержка в сети между виртуальными машинами и единицами крупных экземпляров HANA может быть выше, чем обычная задержка приема-передачи для ВИРТУАЛЬНОЙ машины в виртуальной сети. В зависимости от региона Azure измеряемые значения могут превышать задержку приема-передачи 0,7 мс, классифицированную ниже среднего в [заметке SAP #1100926 — часто задаваемые вопросы: Производительность](https://launchpad.support.sap.com/#/notes/1100926/E)сети. Измеренная задержка может достигать до 2 миллисекунд. Этот показатель зависит от региона Azure и средства измерения задержки приема-передачи в сети между виртуальной машиной Azure и единицей крупного экземпляра HANA. Тем не менее клиенты успешно развертывают производственные приложения SAP на основе SAP HANA в крупных экземплярах SAP HANA. Следует тщательно протестировать бизнес-процессы в крупных экземплярах HANA в Azure. Новая функциональность, называемая быстрым путем ExpressRoute, может значительно снизить задержку сети между крупными экземплярами HANA и виртуальными машинами уровня приложения в Azure (см. ниже). 

С пометкой 4 крупных экземпляров Hana задержка сети между виртуальными машинами Azure, которые развернуты в соответствии с отметкой крупных экземпляров Hana, может соответствовать среднему или лучшему, чем средняя классификация, [как описано в примечании к SAP. #1100926 ВОПРОСЫ И ОТВЕТЫ: Производительность](https://launchpad.support.sap.com/#/notes/1100926/E) сети, если настроен быстрый путь Azure ExpressRoute (см. ниже). Чтобы развернуть виртуальные машины Azure в близком расположении к единицам крупных экземпляров HANA версии 4, необходимо использовать [группы размещения близости к Azure](https://docs.microsoft.com/azure/virtual-machines/linux/co-location). Способ использования групп размещения с учетом расположения для поиска уровня приложений SAP в том же центре обработки данных Azure, что и размещенные единицы крупных экземпляров HANA версии 4, описывается в разделе [группы размещения службы "близость" Azure для оптимальной сетевой задержки в приложениях SAP. ](sap-proximity-placement-scenarios.md).

Чтобы обеспечить детерминированную задержку в сети между виртуальными машинами и крупным экземпляром HANA, необходимо выбрать номер SKU шлюза ExpressRoute. В отличие от шаблонов трафика между локальными и виртуальными машинами, шаблон трафика между виртуальными машинами и крупными экземплярами HANA может показывать короткий, но высокий пик запросов и объемов передаваемых данных. Для нормальной обработки таких пиков рекомендуется использовать шлюз с номером SKU UltraPerformance. Для номеров SKU крупных экземпляров HANA типа II использование SKU шлюза UltraPerformance в качестве шлюза Експрессротуе является обязательным.

> [!IMPORTANT] 
> Учитывая общий сетевой трафик между уровнями базы данных и приложений SAP, для подключения виртуальных сетей к SAP HANA в Azure (крупные экземпляры) поддерживается только шлюз с номером SKU HighPerformance или UltraPerformance. Для номеров SKU крупных экземпляров HANA типа II в качестве шлюза ExpressRoute поддерживается только номер SKU шлюза UltraPerformance. Исключения применяются при использовании быстрого пути ExpressRoute (см. ниже).

### <a name="expressroute-fast-path"></a>Быстрый путь ExpressRoute
Чтобы снизить задержку, появился быстрый путь ExpressRoute и выпущен в мае 2019 для конкретного подключения крупных экземпляров HANA к виртуальным сетям Azure, на которых размещены виртуальные машины приложений SAP. Основная разница в решении, созданном до сих пор, заключается в том, что потоки данных между виртуальными машинами и крупными экземплярами HANA больше не направляются через шлюз ExpressRoute. Вместо этого виртуальные машины, назначенные в подсетях виртуальной сети Azure, напрямую взаимодействуют с выделенным граничным маршрутизатором предприятия. 

> [!IMPORTANT] 
> Функция быстрого пути ExpressRoute требует, чтобы подсети, в которых выполняются виртуальные машины приложений SAP, были в одной виртуальной сети Azure, подключенной к крупным экземплярам HANA. Виртуальные машины, расположенные в виртуальных сетях Azure, которые связаны с виртуальной сетью Azure, подключенной непосредственно к единицам крупных экземпляров HANA, не используют преимущества быстрого пути ExpressRoute. В результате мы типичными структурами виртуальных сетей на основе концентраторов и периферийных серверов, где каналы ExpressRoute подключаются к виртуальной сети концентратора и к виртуальным сетям, содержащим уровень приложений SAP (периферийные серверы), оптимизируются с помощью ExpressRoute. Путь не будет работать. В помимо быстрый путь ExpressRoute не поддерживает определяемые пользователем правила маршрутизации (UDR) прямо сейчас. Дополнительные сведения см. в статье [шлюз виртуальной сети ExpressRoute и фастпас](https://docs.microsoft.com/azure/expressroute/expressroute-about-virtual-network-gateways). 


Дополнительные сведения о настройке быстрого пути ExpressRoute см. в документе [подключение виртуальной сети к крупным экземплярам Hana](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-connect-vnet-express-route).    

> [!NOTE]
> Для работы с быстрым путем ExpressRoute требуется шлюз UltraPerformance ExpressRoute.


## <a name="single-sap-system"></a>Одна система SAP

Локальная инфраструктура, показанная выше, подключена к Azure через канал ExpressRoute. Канал ExpressRoute подключается к маршрутизатору Microsoft Enterprise пограничной сети (MSEE). Дополнительные сведения см. в статье [Обзор ExpressRoute](../../../expressroute/expressroute-introduction.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). После установки маршрута он подключается к магистрали Azure.

> [!NOTE] 
> Для работы с ландшафтом SAP в Azure выполните подключение к маршрутизатору MSEE, который расположен ближе других к региону Azure в пределах ландшафта SAP. Метки крупных экземпляров HANA подключаются через выделенные устройства корпоративного маршрутизатора для снижения задержки в сети между виртуальными машинами в Azure IaaS и в метках крупных экземпляров HANA.

Шлюз ExpressRoute для виртуальных машин, на которых размещены экземпляры приложений SAP, подключен к одному каналу ExpressRoute, который подключается к локальной среде. Та же виртуальная сеть подключена к отдельному маршрутизатору MSEE, предназначенному для подключения к стекам крупных экземпляров. Используя быстрый путь ExpressRoute, поток данных из крупных экземпляров HANA на виртуальные машины уровня приложений SAP больше не направляется через шлюз ExpressRoute и уменьшается задержка приема-передачи сети.

Это простой пример отдельной системы SAP. В ней уровень приложений SAP размещен в Azure. База данных SAP HANA выполняется в SAP HANA в Azure (крупные экземпляры). Предполагается, что пропускная способность шлюза ExpressRoute, пропускная способность 2 – Гбит/с и 10 Гбит/с не представляет узкие места.

## <a name="multiple-sap-systems-or-large-sap-systems"></a>Несколько обычных или крупных систем SAP

Если несколько систем SAP или крупных систем SAP развертываются для подключения к SAP HANA в Azure (крупные экземпляры), пропускная способность шлюза ExpressRoute может стать узким местом. Или вы хотите изолировать рабочие и нерабочие системы в разных виртуальных сетях Azure. В этом случае необходимо разбить уровни приложений на несколько виртуальных сетей. Также рекомендуется создать специальные виртуальные сети, которые подключаются к крупным экземплярам HANA в таких случаях:

- Выполнение архивации непосредственно из экземпляров HANA в крупных экземплярах HANA на виртуальную машину в Azure, где размещаются общие ресурсы NFS.
- Копирование больших резервных копий и других файлов из крупных экземпляров HANA на диск, управляемый в Azure.

Используйте отдельную виртуальную сеть для размещения виртуальных машин, которые управляют хранилищем для массовой пересылки данных между крупными экземплярами HANA и Azure. Это позволяет избежать влияния больших файлов или данных, передаваемых из крупных экземпляров HANA в Azure, на шлюз ExpressRoute, который обслуживает виртуальные машины, на которых выполняется уровень приложений SAP. 

Для более масштабируемой сетевой архитектуры:

- Используйте несколько виртуальных сетей для одного большего уровня приложений SAP.
- Вместо объединения систем SAP из разных подсетей в одну виртуальную сеть разверните отдельную виртуальную сеть для каждой развернутой системы SAP.

  Более масштабируемая сетевая архитектура для SAP HANA в Azure (крупные экземпляры):

![Развертывание уровня приложений SAP в нескольких виртуальных сетях](./media/hana-overview-architecture/image4-networking-architecture.png)

В зависимости от правил и ограничений, которые необходимо применить между различными виртуальными сетями, на которых размещены виртуальные машины различных систем SAP, следует установить пиринг между этими виртуальными сетями. Дополнительные сведения о пиринге виртуальных сетей см. в [этой статье](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview).


## <a name="routing-in-azure"></a>Маршрутизация в Azure

По умолчанию для SAP HANA в Azure (крупные экземпляры) важны три соглашения о сетевой маршрутизации:

* Доступ к SAP HANA в Azure (крупные экземпляры) возможен только через виртуальные машины Azure и выделенное подключение ExpressRoute, а не напрямую из локальной среды. Прямой доступ из локальной среды к единицам крупных экземпляров HANA, поставляемым корпорацией Майкрософт, сразу невозможен. Это ограничения переходной маршрутизации текущей архитектуры сети Azure, используемой для крупных экземпляров SAP HANA. Таким образом, клиенты администрирования и любые приложения, требующие прямого доступа, например запущенный локально SAP Solution Manager, не могут подключиться к базе данных SAP HANA. Для исключений проверьте раздел "непосредственная маршрутизация в крупные экземпляры HANA".

* При наличии единиц крупных экземпляров HANA, развернутых в двух разных регионах Azure для аварийного восстановления, применяются те же ограничения временной маршрутизации, что и в прошлом. Иными словами, IP-адреса единиц крупного экземпляра HANA в одном регионе (например, Западная часть США) не направляются в единицу крупного экземпляра HANA, развернутую в другом регионе (например, Восточная часть США). Это ограничение не зависит от использования пиринга сети Azure в регионах или перекрестного подключения каналов ExpressRoute, соединяющих единицы крупных экземпляров HANA с виртуальными сетями. См. рисунок в разделе "Использование единиц крупных экземпляров HANA в нескольких регионах". Это ограничение, которое поставляется с развернутой архитектурой, запрещает немедленное использование репликации системы HANA в качестве функции аварийного восстановления. Для последних изменений выполните поиск в разделе "использование единиц крупных экземпляров HANA в нескольких регионах". 

* SAP HANA в единицах Azure (крупные экземпляры) имеют назначенный IP-адрес из диапазона IP-адресов пула серверов, отправленного при запросе развертывания крупного экземпляра HANA. Дополнительные сведения см. в статье [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). Этот IP-адрес доступен через подписки и канал Azure, которые соединяют виртуальные сети Azure с крупными экземплярами HANA. IP-адрес, назначенный из этого диапазона IP-адресов пула серверов, напрямую присваивается аппаратной единице. NAT больше *не* используется, как это имело место в первых развертываниях этого решения. 

### <a name="direct-routing-to-hana-large-instances"></a>Прямая маршрутизация на крупные экземпляры HANA
По умолчанию транзитная маршрутизация между единицами крупных экземпляров HANA и локальной или между маршрутизацией крупных экземпляров HANA, развернутых в двух разных регионах, не работает. Существует несколько возможностей для включения такой транзитной маршрутизации.

- Обратный прокси-сервер для маршрутизации входных и выходных данных. Например, F5 Large-IP, NGINX с диспетчером трафика, развернутым в виртуальной сети Azure, который подключается к крупным экземплярам HANA и локальным образом в качестве виртуального брандмауэра или решения для маршрутизации трафика.
- Используйте [правила IPTables](http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_%3a_Ch14_%3a_Linux_Firewalls_Using_iptables#.Wkv6tI3rtaQ) на виртуальной машине Linux для маршрутизации между локальным расположением и единицами HANA (крупные экземпляры) или между единицами HANA (крупные экземпляры) в разных регионах. Виртуальная машина, на которой выполняется IPTables, должна быть развернута в виртуальной сети Azure, которая подключается к крупным экземплярам HANA и локальной среде. Необходимо соответствующим образом изменить размер виртуальной машины, чтобы пропускная способность сети виртуальной машины была достаточной для ожидаемого сетевого трафика. Дополнительные сведения о пропускной способности сети виртуальной машины см. в статье [размеры виртуальных машин Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/sizes?toc=%2fazure%2fvirtual-network%2ftoc.json).
- [Брандмауэр Azure](https://azure.microsoft.com/services/azure-firewall/) будет еще одним решением для включения прямого трафика между локальными и Hana-единицами крупных экземпляров. 

Весь трафик этих решений будет направляться через виртуальную сеть Azure, так как такой трафик может быть дополнительно ограничен программируемыми устройствами, используемыми или группами безопасности сети Azure, так что определенные IP-адреса или диапазоны IP-адресов Локальная блокировка может быть заблокирована или явно разрешена для доступа к крупным экземплярам HANA. 

> [!NOTE]  
> Имейте в виду, что внедрение и поддержка пользовательских решений с использованием сетевых устройств сторонних производителей или утилиты IPTables не предоставляется корпорацией Майкрософт. Поддержка должна предоставляться поставщиком используемого компонента или интегратором. 

#### <a name="express-route-global-reach"></a>Global Reach Express Route
В корпорации Майкрософт появились новые функциональные возможности [ExpressRoute Global REACH](https://docs.microsoft.com/azure/expressroute/expressroute-global-reach). Global Reach можно использовать для крупных экземпляров HANA в двух сценариях:

- Разрешить прямой доступ из локальной среде к единицам крупных экземпляров HANA, развернутым в разных регионах
- Включить прямую связь между единицами крупных экземпляров HANA, развернутыми в разных регионах


##### <a name="direct-access-from-on-premise"></a>Прямой доступ из локальной
В регионах Azure, где предлагается Global Reach, можно запросить включение функции Global Reach для канала ExpressRoute, который подключает локальную сеть к виртуальной сети Azure, которая также подключается к единицам крупного экземпляра HANA. На локальную сторону канала ExpressRoute приходится влиять на затраты. Для цен ознакомьтесь с ценами на [Global REACH надстройку](https://azure.microsoft.com/pricing/details/expressroute/). Нет дополнительных затрат, связанных с каналом, который подключает единицы крупного экземпляра HANA к Azure. 

> [!IMPORTANT]  
> В случае использования Global Reach для включения прямого доступа между единицами крупных экземпляров HANA и локальными активами данные сети и поток управления не направляются **через виртуальные сети Azure**, а напрямую между Microsoft Enterprise Exchange. маршрутизаторы. В результате каких-либо правил NSG или ASG или любого типа брандмауэра, NVA или прокси, развернутого в виртуальной сети Azure, не затрагивается. **Если вы используете ExpressRoute Global Reach, чтобы разрешить прямой доступ из локальной сети в ограничения единиц крупного экземпляра HANA, а разрешения на доступ к единицам крупных экземпляров HANA должны быть определены в брандмауэрах на локальной стороне** 

##### <a name="connecting-hana-large-instances-in-different-azure-regions"></a>Подключение крупных экземпляров HANA в разных регионах Azure
Аналогичным образом, так как ExpressRoute Global Reach можно использовать для подключения к единицам крупных экземпляров HANA в локальной среде, оно может использоваться для подключения клиентов крупных экземпляров двух HANA, развернутых в двух регионах. Изоляция — это каналы ExpressRoute, которые клиенты крупных экземпляров HANA используют для подключения к Azure в обоих регионах. За подключение двух клиентов крупных экземпляров HANA, развернутых в двух разных регионах, дополнительная плата не взимается. 

> [!IMPORTANT]  
> Поток данных и поток управления сетевого трафика между различными клиентами крупных экземпляров HANA не будут маршрутизироваться через сети Azure. В результате вы не можете использовать функциональность Azure или NVA для обеспечения ограничений связи между двумя клиентами крупных экземпляров HANA. 

Дополнительные сведения о том, как получить Global Reach ExpressRoute, см. в документе [подключение виртуальной сети к крупным экземплярам Hana](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-connect-vnet-express-route).


## <a name="internet-connectivity-of-hana-large-instance"></a>Подключение крупных экземпляров HANA к Интернету
Крупные экземпляры HANA *не* подключены к Интернету напрямую. Это ограничивает ваши возможности, например зарегистрировать образ ОС напрямую с использованием поставщика ОС. Вам может потребоваться поработать с локальным сервером средства для управления подписками SUSE Linux Enterprise Server или Red Hat Enterprise Linux Subscription Manager.

## <a name="data-encryption-between-vms-and-hana-large-instance"></a>Шифрование данных между виртуальными машинами и крупными экземплярами HANA
Данные, передаваемые между виртуальными машинами и крупными экземплярами HANA, не шифруются. Однако исключительно для обмена между СУБД HANA и приложениями на основе JDBC/ODBC вы можете включить шифрование трафика. Дополнительные сведения см. в этой [документации по SAP](http://help-legacy.sap.com/saphelp_hanaplatform/helpdata/en/db/d3d887bb571014bf05ca887f897b99/content.htm?frameset=/en/dd/a2ae94bb571014a48fc3b22f8e919e/frameset.htm&current_toc=/en/de/ec02ebbb57101483bdf3194c301d2e/plain.htm&node_id=20&show_children=false).

## <a name="use-hana-large-instance-units-in-multiple-regions"></a>Использование единиц крупных экземпляров HANA в нескольких регионах

Чтобы реализовать установку аварийного восстановления, необходимо иметь единицы крупного экземпляра Шана в нескольких регионах Azure. Даже при использовании Azure [пиринг глобальной виртуальной сети] транзитная маршрутизация по умолчанию не работает между клиентами крупных экземпляров HANA в двух разных регионах. Однако Global Reach открывает путь обмена данными между единицами крупного экземпляра HANA, подготовленными в двух разных регионах. Этот сценарий использования ExpressRoute Global Reach включает:

 - Репликация системы HANA без дополнительных прокси-серверов или брандмауэров
 - Копирование резервных копий между единицами крупных экземпляров HANA в двух разных регионах для выполнения системных копий или обновлений системы


![Виртуальные сети, подключенные к стекам крупных экземпляров Azure в разных регионах Azure](./media/hana-overview-architecture/image8-multiple-regions.png)

На рисунке показано, как разные виртуальные сети в обоих регионах подключены к двум разным каналам ExpressRoute, которые используются для подключения к SAP HANA в Azure (крупные экземпляры) в обоих регионах Azure (серые линии). Причина этих двух перекрестных подключений заключается в защите от сбоя MSEE на обеих сторонах. Поток связи между двумя виртуальными сетями в двух регионах Azure должен обрабатываться по [глобальному пирингу](https://blogs.msdn.microsoft.com/azureedu/2018/04/24/how-to-setup-global-vnet-peering-in-azure/) двух виртуальных сетей в двух разных регионах (синяя пунктирная линия). Толстая красная линия описывает подключение ExpressRoute Global Reach, которое позволяет единицам крупных экземпляров HANA клиентов в двух разных регионах взаимодействовать друг с другом. 

> [!IMPORTANT] 
> Если используется несколько каналов ExpressRoute, чтобы обеспечить правильную маршрутизацию трафика, следует использовать атрибут AS PATH и настройки локального предпочтения BGP.

**Дальнейшие действия**
- Дополнительные сведения см. в статье [Архитектура хранилища SAP HANA (крупные экземпляры)](hana-storage-architecture.md).