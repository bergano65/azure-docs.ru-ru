---
title: Контрольный список для планирования и развертывания рабочей нагрузки SAP | Документация Майкрософт
description: Контрольный список для планирования развертываний рабочих нагрузок SAP в Azure и развертывания рабочих нагрузок
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: patfilot
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 07/15/2019
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: a77c0e38db06698e714c3d0c3df0d9a5f028787b
ms.sourcegitcommit: 6eecb9a71f8d69851bc962e2751971fccf29557f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2019
ms.locfileid: "71672955"
---
# <a name="sap-workloads-on-azure-planning-and-deployment-checklist"></a>Рабочие нагрузки SAP в Azure: контрольный список для планирования и развертывания

Этот контрольный список предназначен для клиентов, которые перемещают приложения SAP NetWeaver, S/4HANA и Hybris в инфраструктуру Azure как услугу. В течение всего проекта клиент и (или) партнер SAP должны ознакомиться с контрольным списком. Важно отметить, что многие проверки выполняются в начале проекта и на этапе планирования. После завершения развертывания простые изменения в развернутой инфраструктуре Azure или выпусках программного обеспечения SAP могут стать сложными.

Просмотрите контрольный список на ключевых этапах проекта. Это позволит выявить небольшие проблемы, прежде чем они станут большими проблемами. У вас также будет достаточно времени для повторного конструирования и тестирования любых необходимых изменений. Не рассматривайте этот контрольный список как завершенный. В зависимости от ситуации может потребоваться выполнить гораздо больше проверок.

Контрольный список не включает задачи, которые не зависят от Azure. Например, интерфейсы приложений SAP изменяются во время перемещения на платформу Azure или поставщик услуг размещения.

Этот контрольный список можно также использовать для уже развернутых систем. После развертывания могут быть добавлены новые функции, такие как Ускоритель записи и Зоны доступности, а также новые типы виртуальных машин. Поэтому рекомендуется периодически просматривать контрольный список, чтобы убедиться в том, что вы знаете о новых возможностях платформы Azure.

## <a name="project-preparation-and-planning-phase"></a>Этап подготовки проекта и планирования
На этом этапе вы планируете перенос рабочей нагрузки SAP на платформу Azure. На этом этапе как минимум необходимо создать следующие документы, а также определить и обсудить следующие элементы миграции:

1. Высокоуровневый проектный документ. Этот документ должен содержать:
    - Текущий список компонентов и приложений SAP, а также Инвентаризация целевых приложений для Azure.
    - Матрица назначения ответственности (RACI), которая определяет обязанности и назначения заинтересованных сторон. Начните с высокого уровня и поработайте с более детализированными уровнями в рамках планирования и первых развертываний.
    - Архитектура высокого уровня решения.
    - Решение о том, какие регионы Azure необходимо развернуть. См. [список регионов Azure](https://azure.microsoft.com/global-infrastructure/regions/). Сведения о службах, доступных в каждом регионе, см. в разделе [продукты, доступные по регионам](https://azure.microsoft.com/global-infrastructure/services/).
    - Сетевая архитектура для подключения из локальной среды к Azure. Начните с знакомства с [чертежом виртуальных центров обработки данных для Azure](https://docs.microsoft.com/azure/architecture/vdc/).
    - Принципы безопасности для выполнения бизнес-данных с высоким уровнем влияния в Azure. Чтобы узнать о безопасности данных, начните с [документации по безопасности Azure](https://docs.microsoft.com/azure/security/).
2.  Технический документ по проектированию. Этот документ должен содержать:
    - Блок-схема для решения.
    - Размер компонентов вычислений, хранения и сетевых подключений в Azure. Сведения о размере SAP для виртуальных машин Azure см. в разделе [Примечание о поддержке sap #1928533](https://launchpad.support.sap.com/#/notes/1928533).
    - Архитектура непрерывности бизнес-процессов и аварийного восстановления.
    - Подробные сведения о версиях пакета поддержки ОС, базы данных, ядра и SAP. Не обязательно, чтобы каждый выпуск ОС, поддерживаемый SAP NetWeaver или S/4HANA, поддерживался на виртуальных машинах Azure. Это справедливо и для выпусков СУБД. Проверьте следующие источники, чтобы выстроить и при необходимости обновить выпуски SAP, СУБД и выпуски ОС, чтобы обеспечить поддержку SAP и Azure. Для получения полной поддержки от SAP и корпорации Майкрософт необходимо иметь сочетания версий, поддерживаемые SAP и Azure. При необходимости необходимо запланировать обновление некоторых программных компонентов. Дополнительные сведения о поддерживаемых программах SAP, OS и СУБД описаны здесь:
        - [Примечание о поддержке SAP #1928533](https://launchpad.support.sap.com/#/notes/1928533). Это Примечание определяет минимальные выпуски ОС, поддерживаемые виртуальными машинами Azure. Он также определяет минимальные выпуски базы данных, необходимые для большинства баз данных, не являющихся HANA. Наконец, он обеспечивает изменение размера SAP для типов виртуальных машин Azure, поддерживаемых SAP.
        - [Примечание о поддержке SAP #2039619](https://launchpad.support.sap.com/#/notes/2039619). Это Примечание определяет матрицу поддержки Oracle для Azure. Oracle поддерживает только Windows и Oracle Linux как гостевые операционные системы в Azure для рабочих нагрузок SAP. Эта инструкция по поддержке также применяется к уровню приложений SAP, в котором выполняются экземпляры SAP. Однако Oracle не поддерживает высокий уровень доступности для центральных служб SAP в Oracle Linux с помощью Pacemaker. Если требуется высокий уровень доступности для ASCS на Oracle Linux, необходимо использовать SIOS Protection Suite для Linux. Подробные данные о сертификации SAP см. в разделе Примечание [о поддержке sap #1662610 — сведения о поддержке для SIOS Protection Suite для Linux](https://launchpad.support.sap.com/#/notes/1662610). Для Windows решение отказоустойчивой кластеризации Windows Server, поддерживаемое SAP для центральных служб SAP, поддерживается в сочетании с Oracle в качестве уровня СУБД.
        - [Примечание о поддержке SAP #2235581](https://launchpad.support.sap.com/#/notes/2235581). Это Примечание содержит таблицу поддержки для SAP HANA в различных выпусках ОС.
        - На [веб-сайте SAP](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure)перечислены поддерживаемые SAP HANA виртуальные машины Azure и [крупные экземпляры Hana](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-overview-architecture) .
        - [Матрица доступности продуктов SAP](https://support.sap.com/en/).
        - Примечания SAP для других продуктов, связанных с SAP.     
    - Для производственных систем SAP рекомендуется использовать не более трех уровней. Мы не рекомендуем объединять ASCS и серверы приложений на одной виртуальной машине. Использование конфигураций кластера с несколькими идентификаторами безопасности для центральных служб SAP поддерживается в гостевых операционных системах Windows в Azure. Но эта конфигурация не поддерживается для центральных служб SAP в операционных системах Linux в Azure. Документацию по сценарию гостевой ОС Windows можно найти в следующих статьях:
        - [Обеспечение высокого уровня доступности с несколькими идентификаторами безопасности для экземпляра SAP ASCS/SCS с помощью отказоустойчивой кластеризации Windows Server и общего диска в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-ascs-ha-multi-sid-wsfc-shared-disk)
        - [Обеспечение высокого уровня доступности экземпляра ASCS/SCS с несколькими ИД безопасности с помощью отказоустойчивой кластеризации Windows Server и файлового ресурса в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-ascs-ha-multi-sid-wsfc-file-share)
    - Архитектура высокого уровня доступности и аварийного восстановления.
        - На основе RTO и RPO определите, как должна выглядеть архитектура высокого уровня доступности и аварийного восстановления.
        - Чтобы обеспечить высокий уровень доступности в пределах зоны, проверьте, что нужная СУБД должна предлагаться в Azure. Большинство пакетов СУБД предлагают синхронные методы синхронного горячего резервирования, которые мы рекомендуем использовать для рабочих систем. Также ознакомьтесь с документацией по SAP для разных баз данных, начиная с [рекомендаций по развертыванию СУБД Azure для рабочих нагрузок SAP](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/dbms_guide_general) и связанных документов.
           Использование отказоустойчивой кластеризации Windows Server с конфигурацией общих дисков для уровня СУБД, например, [описанного для SQL Server](https://docs.microsoft.com/sql/sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server?view=sql-server-2017), не поддерживается. Вместо этого используйте такие решения, как:
           - [SQL Server Always On](https://docs.microsoft.com/azure/virtual-machines/windows/sqlclassic/virtual-machines-windows-classic-ps-sql-alwayson-availability-groups)
           - [Oracle Data Guard](https://docs.microsoft.com/azure/virtual-machines/workloads/oracle/configure-oracle-dataguard);
           - [репликация системы HANA](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.01/en-US/b74e16a9e09541749a745f41246a065e.html).
        - Для аварийного восстановления в регионах Azure ознакомьтесь с решениями, предлагаемыми разными поставщиками СУБД. Большинство из них поддерживают асинхронную репликацию или доставку журналов.
        - Для уровня приложений SAP определите, будут ли запускаться системы тестовой регрессии, которые в идеале являются репликами рабочих развертываний, в том же регионе Azure или в вашем регионе аварийного восстановления. Во втором случае вы можете ориентироваться на систему бизнес-регрессии в качестве цели аварийного восстановления для рабочих развертываний.
        - Если вы решили не размещать непроизводственные системы на сайте аварийного восстановления, просмотрите Azure Site Recovery как метод репликации приложений SAP в регион Azure DR. Дополнительные сведения см. в разделе [Настройка аварийного восстановления для многоуровневого развертывания приложения SAP NetWeaver](https://docs.microsoft.com/azure/site-recovery/site-recovery-sap).
        - Если вы решили использовать объединенную конфигурацию HADR с помощью [зоны доступности Azure](https://docs.microsoft.com/azure/availability-zones/az-overview), ознакомьтесь с регионами Azure, в которых доступны зоны доступности. Также примите во внимание ограничения, которые могут возникать при увеличении количества сетевых задержек между двумя Зоны доступности.  
3.  Инвентаризация всех интерфейсов SAP (SAP и не SAP).
4.  Проектирование базовых служб. Этот проект должен включать следующие элементы:
    - Active Directory и структура DNS.
    - Топология сети в Azure и назначение различных систем SAP.
    - Структура [доступа на основе ролей](https://docs.microsoft.com/azure/role-based-access-control/overview) для команд, управляющих инфраструктурой и приложениями SAP в Azure.
    - Топология группы ресурсов.
    - [Стратегия тегирования](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-using-tags#tags-and-billing).
    - Соглашения об именовании для виртуальных машин и других компонентов инфраструктуры и (или) логических имен.
5.  Контракт Microsoft поддержка Premier. Найдите свой менеджер по технической поддержке Майкрософт (TAM). Требования поддержки SAP см. в разделе [Примечание о поддержке sap #2015553](https://launchpad.support.sap.com/#/notes/2015553).
6.  Число подписок Azure и квоты ядра для подписок. [Откройте запросы в службу поддержки, чтобы увеличить квоты подписки Azure](https://docs.microsoft.com/azure/azure-supportability/resource-manager-core-quotas-request) по мере необходимости.
7.  План уменьшения и переноса данных для переноса данных SAP в Azure. Для систем SAP NetWeaver SAP содержит рекомендации по ограничению объема больших объемов данных. См. [руководство SAP](https://help.sap.com/http.svc/rc/2eb2fba8f8b1421c9a37a8d7233da545/7.0/en-US/Data_Management_Guide_Version_70E.PDF) об управлении данными в системах SAP ERP. Некоторые материалы также относятся к системам NetWeaver и S/4HANA в целом.
8.  Автоматический подход к развертыванию. Целью автоматизации развертываний инфраструктуры в Azure является детерминированное развертывание и получение детерминированных результатов. Многие клиенты используют PowerShell или сценарии на основе CLI. Но существуют различные технологии с открытым кодом, которые можно использовать для развертывания инфраструктуры Azure для SAP и даже для установки программного обеспечения SAP. Примеры можно найти на сайте GitHub:
    - [Автоматическое развертывание SAP в облаке Azure](https://github.com/Azure/sap-hana)
    - [Установка SAP HANA](https://github.com/AzureCAT-GSI/SAP-HANA-ARM)
9.  Определите регулярное время разработки и проверки развертывания между вами как клиентом, системным интегратором, корпорацией Майкрософт и другими участниками.

 
## <a name="pilot-phase-strongly-recommended"></a>Этап пилотного развертывания (настоятельно рекомендуется)
 
Пилотный проект можно запустить до или во время планирования и подготовки проекта. Вы также можете использовать этап пилотного развертывания, чтобы протестировать подходы и разработки, сделанные на этапе планирования и подготовки. Вы также можете развернуть этап пилотного развертывания, чтобы сделать его реальной проверкой концепции.

Рекомендуется настроить и проверить полное решение HADR и структуру безопасности во время пилотного развертывания. На этом этапе некоторые клиенты выполняют тесты масштабируемости. Другие клиенты используют развертывание систем «песочницы SAP» в качестве пилотного этапа. Предположим, вы уже определили систему, которую вы хотите перенести в Azure для пилотного развертывания.

1. Оптимизируйте перенос данных в Azure. Оптимальный вариант сильно зависит от конкретного сценария. Скорость передачи из локальной среды через [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) самая высокая, если канал ExpressRoute имеет достаточную пропускную способность. В других сценариях передача через Интернет выполняется быстрее.
2. Для гетерогенной миграции платформы SAP, включающей экспорт и импорт данных, протестируйте и оптимизируйте этапы экспорта и импорта. Для больших миграций, в которых SQL Server является целевой платформой, можно найти [рекомендации](https://techcommunity.microsoft.com/t5/Running-SAP-Applications-on-the/SAP-OS-DB-Migration-to-SQL-Server-8211-FAQ-v6-2-April-2017/ba-p/368070). Вы можете использовать монитор миграции/SWPM, если не требуется Объединенное обновление выпуска. Процесс [SAP DMO](https://blogs.sap.com/2013/11/29/database-migration-option-dmo-of-sum-introduction/) можно использовать при объединении миграции с обновлением выпуска SAP. Для этого необходимо выполнить определенные требования к исходному и целевому сочетанию платформ СУБД. Этот процесс описан в статье [о параметре миграции базы данных (DMO) SUM 2,0 SP03](https://launchpad.support.sap.com/#/notes/2631152).
   1.  Экспорт в источник, экспорт файлов в Azure и импорт производительности. Разверните перекрытие между экспортом и импортом.
   2.  Оцените объем базы данных на целевом и целевом платформах в целях определения размера инфраструктуры.
   3.  Время проверки и оптимизации.
1. Техническая проверка.
   1. Типы виртуальных машин.
        - Изучите ресурсы в заметках о поддержке SAP, в каталоге SAP HANA оборудования и в SAP PAM снова. Убедитесь в отсутствии изменений в поддерживаемых виртуальных машинах для Azure, поддерживаемых выпусках ОС для этих типов виртуальных машин и поддерживаемых выпусках SAP и DBMS.
        - Повторно проверьте размер приложения и инфраструктуры, развертываемой в Azure. При перемещении существующих приложений часто можно получить необходимые SAPS из используемой инфраструктуры и [веб-страницу производительности SAP](https://www.sap.com/dmc/exp/2018-benchmark-directory/#/sd) и сравнить ее с номерами SAPS, указанными в [заметке о поддержке SAP #1928533](https://launchpad.support.sap.com/#/notes/1928533). Кроме того, сохраним [эту статью с учетом ОЦЕНОК SAPS](https://techcommunity.microsoft.com/t5/Running-SAP-Applications-on-the/SAPS-ratings-on-Azure-VMs-8211-where-to-look-and-where-you-can/ba-p/368208) .
        - Оцените и протестируйте размеры виртуальных машин Azure в зависимости от максимальной пропускной способности хранилища и пропускной способности сети для типов виртуальных машин, выбранных на этапе планирования. Данные можно найти здесь:
           -  [Размеры виртуальных машин Windows в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/sizes?toc=%2fazure%2fvirtual-network%2ftoc.json). Важно учитывать *максимальную пропускную способность некэшированного диска* для определения размера.
           -  [Размеры виртуальных машин Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/sizes?toc=%2fazure%2fvirtual-network%2ftoc.json). Важно учитывать *максимальную пропускную способность некэшированного диска* для определения размера.
   2. Хранилище.
        - Как минимум, используйте [хранилище Azure SSD (цен. Категория "Стандартный")](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-ssd) для виртуальных машин, представляющих уровни приложений SAP, и для развертывания СУБД без учета производительности.
        - Как правило, использование [дисков Azure HDD (цен. Категория "Стандартный")](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-hdd)не рекомендуется.
        - Используйте [хранилище Azure класса Premium](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#premium-ssd) для любых ВИРТУАЛЬНЫХ машин СУБД с учетом производительности.
        - Используйте [управляемые диски Azure](https://azure.microsoft.com/services/managed-disks/).
        - Использование Ускоритель записи Azure для дисков журналов СУБД серии M. Учитывайте Ускоритель записи ограничения и использование, как описано в [ускоритель записи](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator).
        - Для различных типов СУБД ознакомьтесь с [общей документацией по связанной с SAP СУБД](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/dbms_guide_general) и документацией, относящейся к СУБД, на которую указывает универсальный документ.
        - Дополнительные сведения о SAP HANA см. [в статье конфигурации и операции SAP HANA инфраструктуры в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-vm-operations).
        - Никогда не подключайте диски данных Azure к виртуальной машине Linux Azure через идентификатор устройства. Вместо этого используйте универсальный уникальный идентификатор (UUID). Будьте внимательны, например, при использовании графических средств для подключения дисков данных Azure. Дважды проверьте записи в/etc/fstab, чтобы убедиться, что для подключения дисков используется UUID. Дополнительные сведения можно найти в [этой статье](https://docs.microsoft.com/azure/virtual-machines/linux/attach-disk-portal#connect-to-the-linux-vm-to-mount-the-new-disk).
   3. Сети.
        - Протестируйте и оцените инфраструктуру виртуальной сети и распределение приложений SAP в различных виртуальных сетях Azure.
        -  Оцените подход к архитектуре виртуальной сети hub-and-лучевой или метод микросегментации в одной виртуальной сети Azure. Базовая оценка:
               1. Стоимость обмена данными между [одноранговыми виртуальными сетями Azure](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview). Сведения о затратах см. в статье [цены на виртуальную сеть](https://azure.microsoft.com/pricing/details/virtual-network/).
               2. Преимущества быстрого отключения пиринга между виртуальными сетями Azure, а не изменение группы безопасности сети для изоляции подсети в виртуальной сети. Эта оценка предназначена для случаев, когда приложения или виртуальные машины, размещенные в подсети виртуальной сети, стали угрозой безопасности.
                3. Централизованное ведение журнала и аудит сетевого трафика между локальной средой, внешним миром и виртуальным центром обработки данных, созданным в Azure.
        - Оцените и протестируйте путь к данным между уровнем приложений SAP и уровнем СУБД SAP.
            -  Размещение [виртуальных сетевых устройств Azure](https://azure.microsoft.com/solutions/network-appliances/) в пути обмена данными между приложением SAP и уровнем СУБД SAP в системах SAP NetWeaver, Hybris или S/4HANA не поддерживается.
            -  Размещение уровня приложений SAP и СУБД SAP в разных виртуальных сетях Azure, не являющихся равноправными, не поддерживаются.
            -  [Правила группы безопасности приложений и группы безопасности сети](https://docs.microsoft.com/azure/virtual-network/security-overview) можно использовать для определения маршрутов между уровнем приложений SAP и уровнем СУБД SAP.
        - Убедитесь, что на виртуальных машинах, используемых на уровне приложений SAP и на уровне СУБД SAP, включена [Ускоренная сеть Azure](https://azure.microsoft.com/blog/maximize-your-vm-s-performance-with-accelerated-networking-now-generally-available-for-both-windows-and-linux/) . Имейте в виду, что для поддержки ускоренной сети в Azure требуются разные уровни ОС:
            - Windows Server 2012 R2 или более поздней версии.
            - SUSE Linux 12 SP3 или более поздней версии.
            - RHEL 7,4 или более поздней версии.
            - Oracle Linux 7.5. Если вы используете ядро РХККЛ, требуется Release 3.10.0-862.13.1. el7. Если вы используете ядро Oracle UEK, требуется выпуск 5.
        - Протестируйте и оцените задержку сети между виртуальными машинами приложений SAP и машинами СУБД в соответствии с заметками о поддержке SAP [#500235](https://launchpad.support.sap.com/#/notes/500235) и [#1100926](https://launchpad.support.sap.com/#/notes/1100926/E). Оцените результаты в соответствии с рекомендациями по задержке сети в [заметках о поддержке SAP #1100926](https://launchpad.support.sap.com/#/notes/1100926/E). Задержка сети должна быть в среднем или отличном диапазоне. Исключения применяются к трафику между виртуальными машинами и единицам крупных экземпляров HANA, как описано в [этой статье](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-network-architecture#networking-architecture-for-hana-large-instance).
        - Убедитесь, что для развертываний ILB настроено использование прямого возврата сервера. Этот параметр позволяет сократить задержку при использовании Azure Илбс для конфигураций с высоким уровнем доступности на уровне СУБД.
        - Если вы используете Azure Load Balancer вместе с гостевыми операционными системами Linux, убедитесь, что сетевой параметр Linux **net. IPv4. TCP _timestamps** имеет значение **0**. Эта рекомендация конфликтует с рекомендациями в предыдущих версиях [SAP note #2382421](https://launchpad.support.sap.com/#/notes/2382421). Примечание SAP теперь обновляется, чтобы указать, что этот параметр должен быть установлен в значение **0** для работы с подсистемами балансировки нагрузки Azure.
        - Чтобы получить оптимальную задержку в сети, рассмотрите возможность использования [групп размещения близости к Azure](https://docs.microsoft.com/azure/virtual-machines/linux/co-location) . Дополнительные сведения см. в статье [группы размещения службы "близость в Azure" для оптимальной сетевой задержки в приложениях SAP](sap-proximity-placement-scenarios.md).
   4. Развертывание с высоким уровнем доступности и аварийное восстановление.
        - При развертывании уровня приложений SAP без определения определенной зоны доступности Azure убедитесь, что все виртуальные машины, на которых выполняются экземпляры диалогового окна SAP или экземпляры по промежуточного слоя одной системы SAP, развернуты в [группе доступности](https://docs.microsoft.com/azure/virtual-machines/windows/manage-availability).
        - Если вам не требуется высокая доступность для центральных служб SAP и СУБД, можно развернуть эти виртуальные машины в той же группе доступности, что и уровень приложений SAP.
        - Если вы защищаете центральные службы SAP и уровень СУБД для обеспечения высокой доступности с помощью пассивной репликации, поместите два узла для центральных служб SAP в одну отдельную группу доступности и два узла СУБД в другой группе доступности.
        - При развертывании в Зоны доступности Azure нельзя использовать группы доступности. Но необходимо убедиться, что узлы Active и пассивные центральные службы развернуты на двух разных Зоны доступности. Используйте Зоны доступности с наименьшей задержкой между ними.
          Помните, что [Load Balancer (цен. Категория "Стандартный") Azure](https://docs.microsoft.com/azure/load-balancer/load-balancer-standard-availability-zones) необходимо использовать для установки отказоустойчивых кластеров Windows или Pacemaker на уровне СУБД и центральных служб SAP в зоны доступности. Для развертываний зональные нельзя использовать [базовый Load Balancer](https://docs.microsoft.com/azure/load-balancer/load-balancer-overview#skus) .
   5. Параметры времени ожидания.
        - Проверьте трассировку экземпляров SAP для разработчиков SAP NetWeaver, чтобы убедиться в отсутствии разрывов соединений между сервером очереди и рабочими процессами SAP. Можно избежать этих разрывов соединения, задав следующие два параметра реестра:
            - Хклм\систем\куррентконтролсет\сервицес\ткпип\параметерс\кипаливетиме = 120000. Дополнительные сведения см. в разделе [KeepAliveTime](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-2000-server/cc957549(v=technet.10)).
            - Хклм\систем\куррентконтролсет\сервицес\ткпип\параметерс\кипаливеинтервал = 120000. Дополнительные сведения см. в разделе [keepAliveInterval](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-2000-server/cc957548(v=technet.10)).
        - Чтобы избежать истечения времени ожидания графического пользовательского интерфейса между локальными интерфейсами GUI SAP и уровнями приложений SAP, развернутыми в Azure, проверьте, установлены ли эти параметры в каталоге default. PFL или в профиле экземпляра.
            - rdisp/keepalive_timeout = 3600
            - rdisp/keepalive = 20
        - Чтобы предотвратить нарушение установленных соединений между процессом очереди SAP и рабочими процессами SAP, необходимо задать для параметра **енкуе/енкни/set_so_keepalive** **значение true**. См. также [Примечание SAP #2743751](https://launchpad.support.sap.com/#/notes/2743751).  
        - При использовании конфигурации отказоустойчивого кластера Windows убедитесь, что время реагирования на нереагирующие узлы правильно настроено для Azure. В разделе [пороговые значения сети отказоустойчивого кластера настройки](https://techcommunity.microsoft.com/t5/Failover-Clustering/Tuning-Failover-Cluster-Network-Thresholds/ba-p/371834) перечислены параметры и их влияние на включая учет отработки отказа. Если узлы кластера находятся в одной подсети, следует изменить следующие параметры:
            - Самесубнетделай = 2000
            - SameSubNetThreshold = 15
            - Раутингхисториленгс = 30
1. Протестируйте процедуры высокого уровня доступности и аварийного восстановления.
   1. Имитируйте случаи отработки отказа, выполнив завершение работы виртуальных машин (ОС Windows) или поместив операционные системы в режиме тревоги (гостевые операционные системы Linux). Этот шаг поможет определить, работает ли конфигурация отработки отказа в разработке.
   1. Измеряет время, затрачиваемое на выполнение отработки отказа. Если время слишком длинное, рассмотрите следующие моменты:
        - В SUSE Linux для ускорения отработки отказа используйте устройства SBD вместо агента ограждения Azure.
        - Для SAP HANA, если перезагрузка данных занимает слишком много времени, рассмотрите возможность подготовки дополнительной пропускной способности хранилища.
   3. Протестируйте последовательность резервного копирования, восстановления и времени и при необходимости внесите исправления. Убедитесь, что время архивации достаточно. Кроме того, необходимо протестировать действия восстановления и времени восстановления. Убедитесь, что время восстановления находится в пределах соглашения об уровне обслуживания RTO везде, где в качестве значения RTO используется процесс восстановления базы данных или виртуальной машины.
   4. Протестируйте функциональность и архитектуру аварийного восстановления в разных регионах.
1. Проверки безопасности.
   1. Проверьте правильность архитектуры управления доступом на основе ролей (RBAC) Azure. Целью является отделение и ограничение доступа и разрешений для разных команд. Например, участники группы SAP должны иметь возможность развертывать виртуальные машины и назначать диски из хранилища Azure в заданную виртуальную сеть Azure. Но группа SAP не должна иметь возможности создавать собственные виртуальные сети или изменять параметры существующих виртуальных сетей. Члены сетевой группы не должны иметь возможности развертывать виртуальные машины в виртуальных сетях, в которых работают приложения SAP и DBMS. И члены этой группы не должны иметь возможность изменять атрибуты виртуальных машин или даже удалять виртуальные машины или диски.  
   1.  Убедитесь, что [Группа безопасности сети и правила ASC](https://docs.microsoft.com/azure/virtual-network/security-overview) работают так, как ожидалось, и экранирование защищенных ресурсов.
   1.  Убедитесь, что шифруются все ресурсы, которые требуется зашифровать. Определите и реализуйте процессы для резервного копирования сертификатов, хранения и доступа к этим сертификатам и восстановления зашифрованных сущностей.
   1.  Используйте [Шифрование дисков Azure](https://docs.microsoft.com/azure/security/azure-security-disk-encryption-faq) для дисков ОС, если это возможно, с точки зрения поддержки ОС.
   1.  Убедитесь, что вы используете слишком много уровней шифрования. В некоторых случаях имеет смысл использовать шифрование дисков Azure совместно с одним из методов прозрачное шифрование данных СУБД.
1. Тестирование производительности. В SAP на основе трассировки и измерений SAP выполните следующие сравнения:
   - При необходимости Сравните первые 10 интерактивных отчетов с текущей реализацией.
   - При необходимости Сравните 10 основных заданий в текущей реализации.
   - Сравнение передачи данных через интерфейсы в систему SAP. Сосредоточьтесь на интерфейсах, где вы узнаете, что перенос теперь находится между разными расположениями, например из локальной среды в Azure.


## <a name="non-production-phase"></a>Этап, не относящийся к производству 
На этом этапе мы предполагаем, что после успешного завершения пилотного развертывания или подтверждения концепции вы начинаете развертывать непроизводственные системы SAP в Azure. Включите все, что вы узнали и ознакомились во время подтверждения концепции для этого развертывания. Все критерии и шаги, перечисленные для POC, применяются и к этому развертыванию.

На этом этапе обычно развертываются системы разработки, системы модульного тестирования и системы регрессионного тестирования бизнес-приложений в Azure. Рекомендуется, чтобы по крайней мере одна непроизводственная система в одной строке приложения SAP имела полную конфигурацию высокой доступности, которая будет присутствовать в будущей производственной системе. Ниже приведены некоторые дополнительные действия, которые необходимо выполнить на этом этапе.  

1.  Прежде чем перемещать системы из старой платформы в Azure, собирайте данные о потреблении ресурсов, такие как загрузка ЦП, пропускная способность хранилища и данные операций ввода-вывода. Особенно собирайте эти данные из единиц уровня СУБД, а также собирайте их из единиц уровня приложения. Кроме того, измерьте задержки сети и хранилища.
2.  Запишите шаблоны времени использования доступных систем. Цель состоит в том, чтобы определить, должны ли непроизводственные системы быть доступны каждый день, каждый день или нет непроизводственных систем, которые можно завершить на определенные этапы недели или месяца.
3.  Протестируйте и определите, нужно ли создавать собственные образы ОС для виртуальных машин в Azure или использовать образ из коллекции общих образов Azure. Если вы используете образ из коллекции общих образов, обязательно используйте образ, который отражает контракт на поддержку у поставщика ОС. Для некоторых поставщиков ОС вы можете использовать собственные образы лицензий. Для других образов ОС поддержка предоставляется в виде цены, заключенной в Azure. Если вы решили создать свои собственные образы ОС, то соответствующую документацию можно найти в следующих статьях.
    -   [Создание обобщенного образа виртуальной машины Windows, развернутой в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/capture-image-resource)
    -   [Создание обобщенного образа виртуальной машины Linux, развернутой в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/capture-image)
3.  При использовании образов SUSE и Red Hat Linux из коллекции общих образов необходимо использовать образы для SAP, предоставляемые поставщиками Linux в общей коллекции образов.
4.  Обязательно выполните требования поддержки SAP для соглашений в службу поддержки Майкрософт. См. [Примечание о поддержке SAP #2015553](https://launchpad.support.sap.com/#/notes/2015553). Сведения о подключении крупных экземпляров HANA см. в статье [требования к адаптации](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-onboarding-requirements).
4.  Убедитесь, что сотрудники получают [Запланированные уведомления об обслуживании](https://azure.microsoft.com/blog/a-new-planned-maintenance-experience-for-your-virtual-machines/) , чтобы вы могли выбрать наиболее продолжительные простои.
5.  Часто проверяйте презентации Azure на таких каналах, как [Channel 9](https://channel9.msdn.com/) , для новых функций, которые могут применяться к развертываниям.
6.  Ознакомьтесь с примечаниями SAP, связанными с Azure, например с [примечаниями о поддержке, #1928533](https://launchpad.support.sap.com/#/notes/1928533)для новых номеров SKU виртуальных машин и новых выпусков ОС и СУБД. Сравните цены новых типов виртуальных машин с предыдущими типами виртуальных машин, чтобы можно было развернуть виртуальные машины с оптимальным соотношением цены и производительности.
7.  Проверьте примечания поддержки SAP, каталог SAP HANA оборудования и SAP PAM. Убедитесь в отсутствии изменений в поддерживаемых виртуальных машинах для Azure, поддерживаемых выпусках ОС на этих виртуальных машинах и поддерживаемых выпусках SAP и DBMS.
8.  На [веб-сайте SAP](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure) просмотрите новые сертифицированные для Hana номера SKU в Azure. Сравните цены новых номеров SKU с теми, которые вы планируете использовать. В конечном итоге внесите необходимые изменения, чтобы использовать те из них, которые имеют лучшее соотношение цены и производительности.
9.  Адаптация сценариев развертывания для использования новых типов виртуальных машин и добавления новых функций Azure, которые вы хотите использовать.
10. После развертывания инфраструктуры протестируйте и оцените задержку в сети между виртуальными машинами уровня приложений SAP и виртуальными машинами СУБД, в соответствии с заметками о поддержке SAP [#500235](https://launchpad.support.sap.com/#/notes/500235) и [#1100926](https://launchpad.support.sap.com/#/notes/1100926/E). Оцените результаты в соответствии с рекомендациями по задержке сети в [заметках о поддержке SAP #1100926](https://launchpad.support.sap.com/#/notes/1100926/E). Задержка сети должна быть в среднем или отличном диапазоне. Исключения применяются к трафику между виртуальными машинами и единицам крупных экземпляров HANA, как описано в [этой статье](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-network-architecture#networking-architecture-for-hana-large-instance). Убедитесь, что ни одно из ограничений, упоминаемых в [вопросах развертывания СУБД Azure для рабочих нагрузок SAP](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/dbms_guide_general#azure-network-considerations) и [SAP HANA конфигураций инфраструктуры и операций в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-vm-operations) , применяется к развертыванию.
11. Убедитесь, что виртуальные машины развернуты в соответствующей [группе размещения Azure](https://docs.microsoft.com/azure/virtual-machines/linux/co-location), как описано в разделе [группы размещения службы "близость" Azure для оптимальной сетевой задержки с приложениями SAP](sap-proximity-placement-scenarios.md).
11. Перед применением рабочей нагрузки выполните все остальные проверки, перечисленные для фазы подтверждения концепции.
12. По мере применения рабочей нагрузки запишите потребление ресурсов систем в Azure. Сравните это потребление с записями со старой платформы. Настройте размер виртуальной машины для будущих развертываний, если вы видите значительные отличия. Помните, что при уменьшать их размер также будет уменьшена пропускная способность хранилища и сети для виртуальных машин.
    - [Размеры виртуальных машин Windows в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/sizes?toc=%2fazure%2fvirtual-network%2ftoc.json)
    - [Размеры виртуальных машин Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/sizes?toc=%2fazure%2fvirtual-network%2ftoc.json) 
13. Поэкспериментируйте с функциональностью и процессами копирования системы. Цель состоит в том, чтобы упростить копирование системы разработки или тестовой системы, чтобы группы проекта могли быстро получать новые системы. Для этих задач рекомендуется использовать [SAP лама](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+Landscape+Management+%28SAP+LaMa%29+at+a+Glance) .
14. Оптимизируйте и повышайте эффективность доступа на основе ролей, разрешений и процессов группы в Azure, чтобы обеспечить разделение обязанностей. В то же время убедитесь, что все команды могут выполнять свои задачи в инфраструктуре Azure.
15. Выполните упражнения, тестируйте и задокументируйте процедуры высокого уровня доступности и аварийного восстановления, чтобы предоставить сотрудникам возможность выполнять эти задачи. Выявление недостатков и адаптация новых функций Azure, которые вы интегрируете в развертывания.

 
## <a name="production-preparation-phase"></a>Этап подготовки к производству 
На этом этапе собирайте то, что вы сталкивали и узнали при развертывании в нерабочее время, и примените его к будущим рабочим развертываниям. Кроме того, необходимо подготовить работу по переносу данных между текущим расположением размещения и Azure.

1.  Перед переходом в Azure выполните необходимые обновления выпуска SAP для рабочих систем.
1.  Согласитесь с владельцами бизнеса о функциональных и бизнес-тестах, которые должны быть проведены после миграции рабочей системы.
1.  Убедитесь, что эти тесты завершены с исходными системами в текущем расположении размещения. Не прополняйте тесты в первый раз после перемещения системы в Azure.
1.  Протестируйте процесс миграции рабочих систем в Azure. Если вы не перемещаете все рабочие системы в Azure в течение одного и того же интервала времени, создайте группы рабочих систем, которые должны находиться в одном месте размещения. Тестирование переноса данных. Ниже приведены некоторые распространенные методы.
    - Используйте такие методы СУБД, как резервное копирование и восстановление в сочетании с SQL Server Always On, репликация системы HANA или доставка журналов для заполнения и синхронизации содержимого базы данных в Azure.
    - Используйте резервное копирование и восстановление для небольших баз данных.
    - Используйте монитор миграции SAP, интегрированный в SAP SWPM, для выполнения разнородных миграций.
    - Используйте процесс [SAP DMO](https://blogs.sap.com/2013/11/29/database-migration-option-dmo-of-sum-introduction/) , если необходимо объединить миграцию с обновлением выпуска SAP. Помните, что поддерживаются не все комбинации исходной СУБД и целевой СУБД. Дополнительные сведения см. в заметках о поддержке SAP для различных выпусков DMO. Например, [параметр миграции базы данных (DMO) SUM 2,0 SP04](https://launchpad.support.sap.com/#/notes/2644872).
    - Проверьте, лучше ли пропускная способность передачи данных через Интернет или через ExpressRoute, если необходимо переместить резервные копии или файлы экспорта SAP. При перемещении данных через Интернет может потребоваться изменить некоторые правила группы безопасности сети или группы безопасности приложений, которые понадобятся для будущих рабочих систем.
1.  Прежде чем перемещать системы из старой платформы в Azure, собирайте данные о потреблении ресурсов. Полезные данные включают использование ЦП, пропускную способность хранилища и данные операций ввода-вывода. Особенно собирайте эти данные из единиц уровня СУБД, а также собирайте их из единиц уровня приложения. Кроме того, измерьте задержки сети и хранилища.
1.  Проверьте примечания поддержки SAP, каталог SAP HANA оборудования и SAP PAM. Убедитесь в отсутствии изменений в поддерживаемых виртуальных машинах для Azure, поддерживаемых выпусках ОС на этих виртуальных машинах и поддерживаемых выпусках SAP и DBMS.
1.  Обновите скрипты развертывания, чтобы учитывать последние решения, внесенные в типы виртуальных машин и функциональность Azure.
1.  После развертывания инфраструктуры и приложений проверьте следующее:
    - Правильные типы виртуальных машин развернуты с правильными атрибутами и размерами хранилища.
    - Виртуальные машины находятся в правильном и требуемом выпуске и исправлениях ОС и являются универсальными.
    - Виртуальные машины защищены по мере необходимости и единообразно.
    - Установлены и развернуты правильные выпуски и исправления приложений.
    - Виртуальные машины были развернуты в группах доступности Azure в соответствии с планами.
    - Хранилище Azure класса Premium используется для дисков с учетом задержек или для которых требуется [соглашение об уровне обслуживания для одной виртуальной машины 99,9%](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_8/) .
    - Ускоритель записи Azure развернут правильно.
        - Убедитесь, что в виртуальных машинах, дисковых пространствах или чередующихся наборах правильно построены на дисках, которым требуется Ускоритель записи.
        - Проверьте [конфигурацию программного RAID-массива в Linux](https://docs.microsoft.com/azure/virtual-machines/linux/configure-raid).
        - Проверьте [конфигурацию LVM на виртуальных машинах Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/configure-lvm).
    - [Управляемые диски Azure](https://azure.microsoft.com/services/managed-disks/) используются исключительно.
    - Виртуальные машины развернуты в правильных группах доступности и Зоны доступности.
    - Технология [ускоренной](https://azure.microsoft.com/blog/maximize-your-vm-s-performance-with-accelerated-networking-now-generally-available-for-both-windows-and-linux/) работы в Azure включена на виртуальных машинах, используемых на уровне приложений SAP, и на уровне СУБД SAP.
    - [Виртуальные устройства сети Azure](https://azure.microsoft.com/solutions/network-appliances/) не находятся в пути обмена данными между приложением SAP и уровнем СУБД SAP, основанными на SAP NetWeaver, Hybris или S/4HANA.
    - Правила группы безопасности приложений и группы безопасности сети позволяют обеспечить связь как нужного и запланированного и блокировать обмен данными там, где это необходимо.
    - Параметры времени ожидания заданы правильно, как описано выше.
    - Виртуальные машины развертываются в правильной [группе размещения Azure](https://docs.microsoft.com/azure/virtual-machines/linux/co-location), как описано в разделе [группы размещения службы "близость" Azure для оптимальной сетевой задержки с приложениями SAP](sap-proximity-placement-scenarios.md).
    - Сетевая задержка между виртуальными машинами уровня приложений SAP и машинами СУБД проверяется и проверяется, как описано в разделе Заметки о поддержке SAP [#500235](https://launchpad.support.sap.com/#/notes/500235) и [#1100926](https://launchpad.support.sap.com/#/notes/1100926/E). Оцените результаты в соответствии с рекомендациями по задержке сети в [заметках о поддержке SAP #1100926](https://launchpad.support.sap.com/#/notes/1100926/E). Задержка сети должна быть в среднем или отличном диапазоне. Исключения применяются к трафику между виртуальными машинами и единицам крупных экземпляров HANA, как описано в [этой статье](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-network-architecture#networking-architecture-for-hana-large-instance).
    - Шифрование было реализовано там, где это необходимо, и с соответствующим методом шифрования.
    - Интерфейсы и другие приложения могут подключаться к новой развернутой инфраструктуре.
1.  Создайте сборник тренировочных заданий для реагирования на запланированное обслуживание Azure. Определите порядок, в котором системы и виртуальные машины должны перезагружаться для планового обслуживания.
    

## <a name="go-live-phase"></a>Фаза Go-Live
На этапе Go-Live обязательно следуйте модули PlayBook, разработанным на предыдущих этапах. Выполните шаги, которые вы протестировали и посвященные. Не принимать последние изменения в конфигурациях и процессах. Также выполните следующие действия.

1. Убедитесь, что мониторинг на портале Azure и другие инструменты мониторинга работают. Мы рекомендуем использовать системный монитор Windows (PerfMon) для Windows и "САР для Linux".
    - Счетчики ЦП.
        - Среднее время ЦП, всего (все ЦП)
        - Среднее время ЦП, каждый отдельный процессор (128 процессоров на виртуальных машинах M128)
        - Время ядра ЦП, каждый отдельный процессор
        - Время ЦП пользователя, каждый отдельный процессор
    - Память.
        - объем свободной памяти;
        - Память-страница в секунду
        - Память-страница в секунду
    - (Краткосрочная защита с использованием:) и вариант "Диск".
        - Чтение с диска в КБ/с на отдельный диск
        - Операций чтения с диска в секунду на отдельный диск
        - Чтение с диска в микросекундах/чтение, на отдельный диск
        - Запись на диск в кбит/с на отдельный диск
        - Запись на диск в секунду, на отдельный диск
        - Запись на диск в микросекундах/чтение, на отдельный диск
    - Сети.
        - Сетевых пакетов в секунду
        - Исходящих сетевых пакетов в секунду
        - Сетевая КБ в секунду
        - Сеть КБ в секунду
1.  После переноса данных выполните все проверочные тесты, согласованные с владельцами компании. Примите результаты проверки, только если у вас есть результаты для исходных исходных систем.
1.  Проверьте, работают ли интерфейсы и могут ли другие приложения обмениваться данными с новыми развернутыми рабочими системами.
1.  Проверьте систему транспорта и исправлений с помощью SAP Transaction STMS.
1.  Создавайте резервные копии баз данных после выпуска системы для рабочей среды.
1.  Создайте резервные копии ВИРТУАЛЬНЫХ машин для виртуальных машин уровня приложений SAP после выпуска системы для рабочей среды.
1.  Для систем SAP, не входящих в текущую фазу, но взаимодействующих с системами SAP, перенесенными в Azure на этом этапе, необходимо сбросить буфер имен узлов в SM51. Это приведет к удалению старых кэшированных IP-адресов, связанных с именами экземпляров приложения, которые были перемещены в Azure.  


## <a name="post-production"></a>Этап после запуска рабочих систем
Этот этап относится к мониторингу, эксплуатации и администрированию системы. С точки зрения SAP обычно применяются обычные задачи, которые требовалось выполнить в старом размещении. Также выполните следующие задачи, связанные с Azure:

1. Ознакомьтесь с насчетами Azure для систем с высокой заряжается.
2. Оптимизируйте цены и производительность на стороне виртуальной машины и хранилища.
3. Оптимизируйте время, когда можно завершить работу систем.  


## <a name="next-steps"></a>Дальнейшие действия
См. следующие статьи:

- [SAP NetWeaver на виртуальных машинах Windows. Руководство по планированию и внедрению](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/planning-guide)
- [Развертывание Виртуальных машин Azure для SAP NetWeaver](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/deployment-guide)
- [Рекомендации по развертыванию СУБД для рабочих нагрузок SAP на виртуальных машинах Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/dbms_guide_general)

