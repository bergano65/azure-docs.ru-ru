---
title: Контрольный список для планирования и развертывания рабочей нагрузки SAP | Документация Майкрософт
description: Контрольный список для планирования и развертывания рабочей нагрузки SAP в Azure
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: patfilot
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 04/01/2019
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: fef2d42282291bb0ea6afeea03e60234d3d47a4d
ms.sourcegitcommit: c174d408a5522b58160e17a87d2b6ef4482a6694
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "58878729"
---
# <a name="sap-workload-on-azure-planning-and-deployment-checklist"></a>Контрольный список для планирования и развертывания рабочей нагрузки SAP в Azure 

Этот контрольный список предназначен для клиентов, перемещающих приложения SAP NetWeaver, S/4 HANA и Hybris в IaaS Azure (инфраструктура как услуга).  Данный контрольный список должен проверяться клиентом и (или) партнером SAP на протяжении выполнения проекта. Важно, что многие проверки проводятся в начале проекта и на этапе планирования. По окончании развертывания внести простые изменения в развернутую инфраструктуру Azure или выпуски программного обеспечения SAP может оказаться сложно. Просматривайте этот контрольный список на основных вехах в ходе выполнения проекта.  Мелкие проблемы можно обнаружить, прежде чем они превратятся в большие проблемы. Кроме того, у вас будет достаточно времени, чтобы спроектировать необходимые изменения и протестировать их. Никоим образом не утверждается, что это полный контрольный список. В зависимости от вашей индивидуальной ситуации может потребоваться выполнить намного больше проверок. 

Составленный контрольный список не включает в себя задачи, которые не связаны с Azure.  Пример: Изменение интерфейсов приложения SAP при переносе в общедоступное облако Azure или в среду поставщика услуг размещения.    

Этот контрольный список можно также использовать для уже развернутых систем. Новые функции, такие как Ускоритель записи, зоны доступности и новые типы виртуальных машин, могут быть добавлены уже после развертывания.  Поэтому полезно время от времени просматривать контрольный список, чтобы узнавать о новых возможностях платформы Azure. 

## <a name="project-preparation-and-planning-phase"></a>Этап подготовки проекта и планирования
На этом этапе планируется перенос рабочих нагрузок SAP в общедоступное облако Azure. Рассматривается минимальный набор сущностей и элементов, а также составляется их список, как показано ниже.

1. Общая документация по проекту должна содержать следующее:
    1. Текущий список компонентов и приложений SAP, а также список целевых приложений в Azure.
    2. Матрицу назначения ответственности (ее нужно создать и использовать), которая определяет обязанности и назначения различных участвующих сторон. Начните на высоком уровне и переходите на более детальные уровни во время планирования и первого развертывания.
    2. Общая архитектура решения
    3. Выбранные регионы Azure для развертывания. Список доступных регионов Azure приведен [здесь](https://azure.microsoft.com/global-infrastructure/regions/). Службы, доступные в каждом из регионов Azure, указаны на странице [Доступность продуктов по регионам](https://azure.microsoft.com/global-infrastructure/services/).
    4. Архитектура подключения Azure из локальной сети. Начните с ознакомления со [схемой виртуального центра обработки данных для Azure](https://docs.microsoft.com/azure/architecture/vdc/).
    5. Принципы безопасности критически важных для бизнеса данных в Azure. Ознакомление можно начать с [документации по системе безопасности Azure](https://docs.microsoft.com/azure/security/).
2.  Техническая документация по проекту, которая содержит следующее:
    1.  Блок-схема решения. 
    2.  Размеры вычислительных компонентов, компонентов хранилища и сетевых компонентов в Azure. Сведения о размерах виртуальных машин Azure для SAP приведены в примечании о поддержке SAP [1928533](https://launchpad.support.sap.com/#/notes/1928533). 
    3.  Архитектура непрерывности бизнес-процессов и аварийного восстановления.
    4.  Подробные сведения о поддерживаемых версиях пакетов ОС, баз данных, ядра и SAP. Не гарантируется, что любая версия ОС, поддерживаемая SAP NetWeaver или S/4HANA, поддерживается на виртуальных машинах Azure. Это касается и выпусков СУБД. Обязательно нужно свериться с приведенными ниже источниками, чтобы соотнести и, при необходимости, обновить выпуски SAP, СУБД или ОС для обеспечения совместимости SAP и Azure. Обязательно использовать только поддерживаемые сочетания выпусков SAP и Azure, чтобы обеспечить полную поддержку SAP и корпорации Майкрософт. При необходимости требуется спланировать обновление некоторых компонентов программного обеспечения. Дополнительные сведения о поддерживаемом программном обеспечении SAP, ОС и СУБД:
        1.  Примечание о поддержке SAP [#1928533](https://launchpad.support.sap.com/#/notes/1928533). В этом примечании указаны минимальные выпуски ОС, поддерживаемые на виртуальных машинах Azure. В нем также определены минимальные выпуски базы данных, необходимые для большинства баз данных не на основе HANA. Кроме того, в этом примечании приведены размеры системы SAP для различных поддерживаемых типов виртуальных машин Azure для SAP.
        2.  Примечание о поддержке SAP [2039619](https://launchpad.support.sap.com/#/notes/2039619). В этом примечании приведена матрица поддержки Oracle в Azure. Учтите, что Oracle поддерживает Windows и Oracle Linux для рабочих нагрузок SAP только в качестве гостевой ОС в Azure. Данное заявление о поддержке также относится к прикладному уровню SAP, на котором работают экземпляры SAP. Тем не менее Oracle не поддерживает высокий уровень доступности для центральных служб SAP в Oracle Linux через Pacemaker. Если вам нужна высокая доступность для ASCS в Oracle Linux, необходимо использовать SIOS Protection Suite для Linux. Подробные данные о сертификации SAP см. в примечании о поддержке SAP [1662610 со сведениями о поддержке SIOS Protection Suite для Linux](https://launchpad.support.sap.com/#/notes/1662610). Для Windows поддерживаемое SAP решение отработки отказа отказоустойчивого кластера Windows для центральных служб SAP поддерживается в сочетании с Oracle в качестве уровня СУБД. 
        3.  Примечание о поддержке SAP [2235581](https://launchpad.support.sap.com/#/notes/2235581) для получения матрицы поддержки SAP HANA в разных выпусках ОС.
        4.  Виртуальные машины Azure, поддерживаемые SAP HANA, и [крупные экземпляры HANA](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-overview-architecture) перечислены [здесь](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure).
        5.  [Матрица доступности продуктов SAP](https://support.sap.com/en/).
        6.  Другие примечания SAP для конкретных продуктов SAP.  
    5.  Мы рекомендуем использовать исключительно трехуровневые структуры для рабочих систем SAP. Совмещение серверов ASCS и серверов приложений на одной виртуальной машине не рекомендуется.  Конфигурации кластеров с несколькими идентификаторами безопасности для центральных служб SAP поддерживаются при использовании Windows в качестве гостевой ОС в Azure. Тогда как такие конфигурации кластеров SAP не поддерживаются в операционных системах Linux в Azure. Документация по гостевой ОС Windows:
        1.  [Обеспечение высокого уровня доступности с несколькими идентификаторами безопасности для экземпляра SAP ASCS/SCS с помощью отказоустойчивой кластеризации Windows Server и общего диска в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-ascs-ha-multi-sid-wsfc-shared-disk)
        2.  [Обеспечение высокого уровня доступности экземпляра ASCS/SCS с несколькими ИД безопасности с помощью отказоустойчивой кластеризации Windows Server и файлового ресурса в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-ascs-ha-multi-sid-wsfc-file-share)
    6.  Архитектура обеспечения высокого уровня доступности и аварийного восстановления.
        1.  Определите на основе RTO и RPO, как должна выглядеть архитектура обеспечения высокого уровня доступности и аварийного восстановления.
        2.  Для обеспечения высокой доступности в пределах зоны проверьте, какие возможности требуемая СУБД должна обеспечивать в Azure. Большинство СУБД предлагает синхронные методы сервера горячей замены, которые рекомендуется использовать для рабочих систем. Кроме того, ознакомьтесь со сведениями о разных базах данных в посвященной SAP документации, начиная с [рекомендаций по развертыванию СУБД виртуальных машин Azure для рабочей нагрузки SAP](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/dbms_guide_general), и связанных документах.
            1.  Использование службы отказоустойчивого кластера Windows с конфигурацией общих дисков для уровня СУБД, как, например, для SQL Server [здесь](https://docs.microsoft.com/sql/sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server?view=sql-server-2017), **не** поддерживается. Вместо этого поддерживаются такие решения, как:
                1.  [SQL Server AlwaysOn](https://docs.microsoft.com/azure/virtual-machines/windows/sqlclassic/virtual-machines-windows-classic-ps-sql-alwayson-availability-groups); 
                2.  [Oracle Data Guard](https://docs.microsoft.com/azure/virtual-machines/workloads/oracle/configure-oracle-dataguard);
                3.  [репликация системы HANA](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.01/en-US/b74e16a9e09541749a745f41246a065e.html).
        3.  Для аварийного восстановления в разных регионах Azure проверьте, какие возможности предоставляются различными поставщиками СУБД. Большинство из них поддерживает асинхронную репликацию или доставку журналов.
        4.  Для прикладного уровня SAP определите, будут ли использоваться системы регрессионного тестирования для бизнеса. В идеальном случае это реплики рабочих развертываний, размещенные в том же регионе Azure или в вашем регионе аварийного восстановления. В последнем случае эти системы регрессионного тестирования для бизнеса можно использовать в качестве цели аварийного восстановления рабочей среды.
        5.  Если вы решите не размещать непроизводственные системы на сайте аварийного восстановления, рассмотрите Azure Site Recovery в качестве приемлемого метода репликации на прикладном уровне SAP в регионе аварийного восстановления Azure. Ознакомьтесь также с разделом [Настройка аварийного восстановления для многоуровневого развертывания приложения SAP NetWeaver](https://docs.microsoft.com/azure/site-recovery/site-recovery-sap). 
        6.  Если вы решите использовать объединенную конфигурацию высокой доступности и аварийного восстановления на основе [Зон доступности Azure](https://docs.microsoft.com/azure/availability-zones/az-overview), то ознакомьтесь с регионами Azure, в которых они доступны, а также с ограничениями, которые могут возникнуть из-за увеличения сетевых задержек между двумя Зонами доступности.  
3.  Клиенту или партнеру необходимо создать перечень всех интерфейсов SAP (от SAP и других поставщиков). 
4.  Разработка проекта Foundation Services: этот проект должен содержать следующие элементы:
    1.  Архитектура Active Directory и DNS.
    2.  Топология сети в Azure и назначение различных систем SAP.
    3.  Схема [доступа на основе ролей](https://docs.microsoft.com/azure/role-based-access-control/overview) для разных команд, которые управляют инфраструктурой и приложениями SAP в Azure.
    3.  Топология групп ресурсов. 
    4.  [Стратегия тегов](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-using-tags#tags-and-billing).
    5.  Соглашение об именовании виртуальных машин и других компонентов инфраструктуры и (или) логические имена.
5.  Контракт на поддержку Microsoft Premier — укажите менеджера по технической поддержке Майкрософт (TAM). Требования к поддержке SAP приведены в примечании по поддержке SAP [2015553](https://launchpad.support.sap.com/#/notes/2015553). 
6.  Определите число подписок Azure и квоту ядер для разных подписок. [Отправьте запросы в службу поддержки для увеличения квот подписок Azure](https://docs.microsoft.com/azure/azure-supportability/resource-manager-core-quotas-request), если потребуется. 
7.  План сокращения данных и переноса данных для переноса данных SAP в Azure. Для систем SAP NetWeaver компания SAP разработала рекомендации по уменьшению объема данных. Она опубликовала [это подробное руководство](https://help.sap.com/http.svc/rc/2eb2fba8f8b1421c9a37a8d7233da545/7.0/en-US/Data_Management_Guide_Version_70E.PDF) по управлению данными в системах SAP ERP. Однако часть содержимого относится к системам NetWeaver и S/4 HANA в целом.
8.  Определите и выберите метод автоматизированного развертывания. Цель автоматизации развертывания инфраструктуры в Azure — детерминированное развертывание с детерминированными результатами. Многие клиенты используют сценарии на основе PowerShell или интерфейса командной строки. Однако существуют различные технологии с открытым кодом, которые могут использоваться для развертывания инфраструктуры Azure для SAP и даже установки программного обеспечения SAP. Примеры можно найти в GitHub:
    1.  [Автоматическое развертывание SAP в облаке Azure](https://github.com/Azure/sap-hana)
    2.  [Установка SAP HANA](https://github.com/AzureCAT-GSI/SAP-HANA-ARM)
9.  Определите частоту регулярных проверок проекта и развертывания с участием вас как клиента, системного интегратора, корпорации Майкрософт и других участвующих сторон.

 
## <a name="pilot-phase-strongly-recommended"></a>Этап пилотного развертывания (настоятельно рекомендуется)
 
Пилотный проект может выполняться перед или одновременно с этапом проектирования и подготовки проекта. На этом этапе можно также протестировать различные подходы и проект, созданные во время планирования и подготовки. Этап пилотного развертывания может быть расширен до реального подтверждения концепции. Во время пилотного развертывания рекомендуется настроить и проверить полнофункциональное решение для обеспечения высокой доступности и аварийного восстановления, а также структуру системы безопасности. В случае некоторых клиентов тесты масштабируемости также можно выполнять на этом этапе. Другие клиенты в качестве этапа пилотного развертывания используют развертывание систем SAP в песочнице. Поэтому мы предполагаем, что вы определили систему, которую требуется перенести в Azure, для выполнения пилотного развертывания.

1. Оптимизируйте передачу данных в Azure. Сильно зависит от клиента случаев передачи через [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) из локальной был самый быстрый, если цепь Express достаточно пропускной способности. Для некоторых клиентов лучше подходит передача данных через Интернет.
2. В случае переноса разнородной платформы SAP, когда требуется выполнить экспорт и импорт данных базы данных, протестируйте и оптимизируйте этапы экспорта и импорта. Рекомендации по переносу большого объема данных с SQL Server в качестве целевой платформы можно найти [здесь](https://techcommunity.microsoft.com/t5/Running-SAP-Applications-on-the/SAP-OS-DB-Migration-to-SQL-Server-8211-FAQ-v6-2-April-2017/ba-p/368070). Можно воспользоваться монитором миграции или SWPM, если не требуется совмещенное обновление выпусков, или процессом [SAP DMO](https://blogs.sap.com/2013/11/29/database-migration-option-dmo-of-sum-introduction/), если вы совмещаете перенос с обновлением выпуска SAP и указываете определенные сочетания исходной и целевой платформ СУБД, как указано в документации (например, в статье [Database Migration Option (DMO) of SUM 2.0 SP03](https://launchpad.support.sap.com/#/notes/2631152) (Database Migration Option (DMO) в SUM 2.0 с пакетом обновления 3 (SP03). 
   1.  Оцените производительность экспорта в источник, передачи файлов при экспорте в Azure и производительность импорта.  Максимально увеличьте перекрытие импорта и экспорта.
   2.  Оцените объем базы данных между целевой и конечной платформами, чтобы выбрать соответствующий размер инфраструктуры.    
   3.  Проверьте и оптимизируйте время. 
3. Техническая проверка. 
   1. Типы виртуальных машин.
      1.  Еще раз проверьте ресурсы в соответствии с примечанием о поддержке SAP, каталогом оборудования SAP HANA и SAP PAM. Убедитесь, что поддерживаемые виртуальные машины Azure, поддерживаемые выпуски ОС для этих типов виртуальных машин и поддерживаемые выпуски SAP и СУБД не изменились.
      2.  Повторно проверьте размер приложения и инфраструктуры, развертываемой в Azure. В случае перемещения существующих приложений часто можно получить необходимые стандарты SAPS в используемой инфраструктуре и на [веб-странице измерения производительности SAP](https://www.sap.com/dmc/exp/2018-benchmark-directory/#/sd), и затем сравнить их с числом стандартов SAPS, указанных в примечании о поддержке SAP [1928533](https://launchpad.support.sap.com/#/notes/1928533). Также учтите сведения [в этой статье](https://techcommunity.microsoft.com/t5/Running-SAP-Applications-on-the/SAPS-ratings-on-Azure-VMs-8211-where-to-look-and-where-you-can/ba-p/368208).
      3.  Оцените и протестируйте размеры виртуальных машин Azure на предмет максимальной пропускной способности хранилища и сети для разных типов виртуальных машин, которые вы выбрали на этапе планирования. Эти данные можно найти здесь:
          1.  [Размеры виртуальных машин Windows в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/sizes?toc=%2fazure%2fvirtual-network%2ftoc.json). При выборе размера важно учитывать **максимальную пропускную способность некэшированных дисков**.
          2.  [Размеры виртуальных машин Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/sizes?toc=%2fazure%2fvirtual-network%2ftoc.json). При выборе размера важно учитывать **максимальную пропускную способность некэшированных дисков**.
   2. Хранилище
      1.  Используйте [хранилище Azure Standard SSD](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-ssd) как минимальное, для виртуальных машин, представляющий уровней приложений SAP, а также для конфиденциальных не связанным с производительностью по развертыванию СУБД
      2.  Мы рекомендуем использовать не следует использовать [диски Azure Standard HDD](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-hdd) в целом
      2.  Используйте [хранилище Azure класса Premium](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#premium-ssd) любой виртуальным машинам для СУБД, которые удаленно чувствительны к производительности
      2.  Используйте [управляемые диски Azure](https://azure.microsoft.com/services/managed-disks/).
      3.  Использование Ускоритель записи Azure для дисков журналов СУБД серии M. Следует учитывать ограничения и особенности использования Ускорителя записи, описанные в статье [Ускоритель записи](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator).
      4.  При использовании различных типов СУБД обратитесь к [общей документации SAP по СУБД](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/dbms_guide_general) и указанной в ней документации по конкретным СУБД.
      5.  Системы SAP HANA подробнее описаны в разделе [Конфигурации инфраструктуры SAP HANA и работа с ней в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-vm-operations).
      6.  Никогда не подключайте диски данных Azure к виртуальной машине Linux Azure через идентификатор устройства. Вместо этого используйте универсальный уникальный идентификатор (UUID). Будьте внимательны, например, при использовании графических средств для подключения дисков данных Azure. Дважды проверьте записи в /etc/fstab, чтобы убедиться, что диски подключены с использованием UUID.
          1.  Дополнительные сведения см. [здесь](https://docs.microsoft.com/azure/virtual-machines/linux/attach-disk-portal#connect-to-the-linux-vm-to-mount-the-new-disk).
   3. Сеть
      1.  Протестируйте и оцените инфраструктуру виртуальных сетей и распределение приложений SAP в одной или разных виртуальных сетях Azure.
          1.  Оцените архитектуру виртуальной сети типа "звезда" или микросегментирование в пределах одной виртуальной сети Azure на основе следующих факторов:
              1.  Затраты на обмен данными между [пиринговыми виртуальными сетями Azure](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview). Для этого ознакомьтесь с [ценами на виртуальную сеть](https://azure.microsoft.com/pricing/details/virtual-network/).
              2.  Преимущества быстрого отключения пиринга между виртуальными сетями Azure по сравнению с неизменной группой безопасности сети, предназначенной для изоляции подсети в виртуальной сети для случаев, когда приложения или виртуальные машины, размещенные в подсети виртуальной сети, представляют угрозу безопасности.
              3.  Централизованное ведение журнала и аудит сетевого трафика между локальной средой, внешним миром и виртуальным центром обработки данных, создаваемым в Azure.
          2.  Оцените и протестируйте обмен данными между прикладным уровнем SAP и уровнем СУБД SAP. 
              1.  Размещение [виртуальных сетевых модулей Azure](https://azure.microsoft.com/solutions/network-appliances/) в пути взаимодействия между прикладным уровнем SAP и уровнем СУБД SAP NetWeaver, Hybris или системами SAP на основе S/4 HANA не поддерживается.
              2.  Размещение прикладного уровня SAP и СУБД SAP в разных виртуальных сетях Azure, которые не являются одноранговыми, не поддерживается.
              3.  Поддерживаются [правила ASG и NSG Azure](https://docs.microsoft.com/azure/virtual-network/security-overview) для определения маршрутов между прикладным уровнем SAP и уровнем СУБД SAP.
          3.  Убедитесь, что [ускорение работы в сети Azure](https://azure.microsoft.com/blog/maximize-your-vm-s-performance-with-accelerated-networking-now-generally-available-for-both-windows-and-linux/) включено на виртуальных машинах, используемых на прикладном уровне SAP и уровне СУБД SAP. Имейте в виду, что для поддержки ускоренной сети в Azure требуются разные уровни ОС:
              1.  Windows Server 2012 R2 или более поздние выпуски;
              2.  SUSE Linux 12 с пакетом обновления 3 (SP3) или более поздние выпуски;
              3.  RHEL 7.4 или более поздние выпуски;
              4.  Oracle Linux 7.5. При использовании ядра RHCKL требуется выпуск 3.10.0-862.13.1.el7. При использовании Oracle требуется выпуск 5 ядра UEK.
          4.   Протестируйте и оцените задержки сети между виртуальными машинами на прикладном уровне SAP и уровне СУБД согласно примечаниям о поддержке SAP [500235](https://launchpad.support.sap.com/#/notes/500235) и [1100926](https://launchpad.support.sap.com/#/notes/1100926/E). Оцените результаты в соответствии с рекомендациями по задержки сети в примечании о поддержке SAP [1100926](https://launchpad.support.sap.com/#/notes/1100926/E). Задержка сети должна находиться в диапазоне от умеренной до хорошей. Исключения относятся к трафику между виртуальными машинами и крупными экземплярами HANA, как описано в [этой документации](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-network-architecture#networking-architecture-for-hana-large-instance).
          5.   Убедитесь, что развертывания с внутренней подсистемой балансировки нагрузки настроены для использования прямого ответа от сервера. Этот параметр уменьшит задержку в случаях, когда внутренние подсистемы балансировки нагрузки Azure используются в конфигурациях обеспечения высокой доступности на уровне СУБД.
          6.   При использовании подсистемы балансировки нагрузки Azure в сочетании с проверкой операционных систем Linux гостя, которое Linux сетевой параметр **net.ipv4.tcp_timestamps** присваивается **0**. Соответствие рекомендациям в более старых версиях SAP Обратите внимание, [#2382421](https://launchpad.support.sap.com/#/notes/2382421). Примечание к SAP, в то же время будет обновлена с учетом тот факт, что параметр должен иметь значение 0 для использования в сочетании с подсистемами балансировки нагрузки Azure.
   4. Развертывания с высоким уровнем доступности и аварийным восстановлением. 
      1. Если вы развертываете прикладной уровень SAP без определения конкретной зоны доступности Azure, убедитесь, что все виртуальные машины с экземплярами диалогов или ПО промежуточного слоя SAP для одной системы SAP развернуты в [группе доступности](https://docs.microsoft.com/azure/virtual-machines/windows/manage-availability). 
         1.   В случае, если вам не требуется высокий уровень доступности центральных служб SAP и СУБД, эти виртуальные машины могут быть развернуты в той же группе доступности, что и прикладной уровень SAP.
      2. Если вы защищаете центральные службы SAP и уровень СУБД для обеспечения высокой доступности, используя пассивные реплики, используйте два узла для центральных служб SAP в одной отдельной группе доступности и два узла для СУБД — в другой группе доступности.
      3. При развертывании в Зонах доступности Azure невозможно использовать группы доступности. Тем не менее необходимо убедиться, что активные и пассивные узлы центральных служб развертываются в двух разных зонах доступности, обеспечивающих наименьшее время задержки между собой.
         1.   Имейте в виду, что вам нужно использовать [Azure Load Balancer (цен. категория "Стандартный")](https://docs.microsoft.com/azure/load-balancer/load-balancer-standard-availability-zones) в случае установки отказоустойчивых кластеров Windows или Pacemaker для уровня СУБД и центральных служб SAP в зонах доступности. [Load Balancer (цен. категория "Базовый")](https://docs.microsoft.com/azure/load-balancer/load-balancer-overview#skus) не может использоваться для зональных развертываний. 
   5. Параметры времени ожидания.
      1. Проверьте трассировки разработчика SAP NetWeaver для разных экземпляров SAP и убедитесь, что разрывы подключений между сервером постановки в очередь и рабочими процессами SAP отсутствуют. Этих разрывов подключения можно избежать, задав следующие два параметра реестра:
         1.   HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\KeepAliveTime = 120000. Ознакомьтесь также с [этой статьей](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-2000-server/cc957549(v=technet.10)).
         2.   HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\KeepAliveInterval = 120000. Ознакомьтесь также с [этой статьей](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-2000-server/cc957548(v=technet.10)). 
      2. Чтобы избежать истечения времени ожидания между графическими пользовательскими интерфейсами локального развертывания SAP и прикладным уровнем SAP, развернутым в Azure, проверьте, заданы ли следующие параметры в файле default.pfl или профиля экземпляра:
         1.   rdisp/keepalive_timeout = 3600
         2.   rdisp/keepalive = 20
      3. При использовании конфигурации отказоустойчивого кластера Windows убедитесь, что правильно настроено время реагирования на неотвечающие узлы для Azure. В статье корпорации Майкрософт [Tuning Failover Cluster Network Thresholds](https://blogs.msdn.microsoft.com/clustering/2012/11/21/tuning-failover-cluster-network-thresholds/) (Настройка порогов сети отказоустойчивого кластера) приведен список параметров и их влияние на важные характеристики отработки отказа. Из приведенного списка нужно задать два параметра, присвоив им указанные значения:
         1.   SameSubNetDelay = 2
         2.   SameSubNetThreshold = 15
4. Протестируйте процедуры обеспечения высокой доступности и аварийного восстановления.
   1. Имитируйте ситуации отработки отказа, завершив работу виртуальных машин (гостевая ОС Windows) или переведя операционные системы в режим критической ошибки (гостевая ОС Linux), чтобы узнать, корректно ли работает конфигурация отработки отказа. 
   2. Измерьте время, необходимое для выполнения отработки отказа. Если она занимает слишком много времени, рассмотрите следующие рекомендации.
      1.   Для SUSE Linux: используйте устройства SBD вместо агента ограждения Azure, чтобы ускорить отработку отказа.
      2.   Для SAP HANA: если повторная загрузка данных занимает слишком много времени, рекомендуется подготовить больше пропускной способности хранилища.
   3. Протестируйте последовательность резервного копирования и восстановления. Обратите внимание на время. Настройте их при необходимости. Требуется протестировать не только выполнение резервного копирования. Протестируйте также восстановление и обратите внимание на время выполнения операций восстановления. Убедитесь, что время восстановления находится в пределах Соглашений об уровне обслуживания в отношении RTO, где RTO зависит от процесса восстановления базы данных или виртуальной машины.
   4. Протестируйте функции и архитектуру межрегионального аварийного восстановления.
5. Проверки безопасности.
   1.  Проверьте допустимость архитектуры доступа на основе ролей роли Azure(RBAC), реализованной вами. Целью является разделение и ограничение доступа и разрешений для разных команд. Например, участники команды специалистов по инфраструктуре SAP должны иметь возможность развертывать виртуальные машины и назначать диски из службы хранилища Azure в заданной виртуальной сети Azure. Однако эта команда не должна иметь возможность создавать собственные виртуальные сети или изменять параметры существующих виртуальных сетей. С другой стороны, участники команды специалистов по сетям не должны иметь возможность развертывать виртуальные машины в виртуальных сетях, где работают виртуальные машины СУБД и приложений SAP. Кроме того, участники команды специалистов по сетям не должны иметь возможность изменять атрибуты виртуальных машин или даже удалять виртуальные машины или диски.  
   2.  Проверьте, корректно ли действуют правила [NSG и ASC](https://docs.microsoft.com/azure/virtual-network/security-overview), защищая соответствующие ресурсы.
   3.  Убедитесь, что шифруются все ресурсы, которые требуется зашифровать. Определите и выполните процессы резервного копирования сертификатов, их хранения и получения для восстановления зашифрованных сущностей. 
   4.  Используйте [шифрование дисков Azure](https://docs.microsoft.com/azure/security/azure-security-disk-encryption-faq) и (или) диски ОС, если шифрование поддерживается операционной системой.
   5.  Убедитесь, что используется не слишком много уровней шифрования. Мало смысла одновременно использовать шифрование дисков Azure и один из мощнейших методов прозрачного шифрования базы данных для СУБД.
6. Тестирование производительности.
   1.  В SAP на основе трассировок и измерений сравните 10 лучших отчетов о сети с текущей реализацией, где это возможно. 
   2.  В SAP на основе трассировок и измерений сравните 10 лучших пакетных заданий с текущей реализацией, где это возможно. 
   3.  В SAP на основе трассировок и измерений сравните передачу данных через интерфейсы в систему SAP. Сосредоточьтесь на интерфейсах, когда вы знаете, что передача теперь осуществляется между расположениями, такие как переход на платформу в Azure 


## <a name="non-production-phase"></a>Этап развертывания непроизводственных систем. 
На этом этапе мы предполагаем, что после успешного пилотного развертывания или подтверждения концепции вы начинаете развертывать непроизводственные системы SAP в Azure. Все знания и опыт, полученные из подтверждения концепции, должно быть адаптированы для такого развертывания. Для этого развертывания также применяются все условия и действия, описанные на этапе подтверждения концепции. На этом этапе в Azure обычно развертываются системы разработки, системы модульного тестирования и системы регрессионного тестирования для бизнеса. Как минимум для одной непроизводственной системы в линейке приложений SAP рекомендуется настроить конфигурацию обеспечения высокой доступности, как у будущей рабочей системы. Ниже приведены дополнительные действия, которые следует принять во внимание на этом этапе.  

1.  Перед перемещением систем со старой платформы в Azure соберите данные о потреблении ресурсов, такие как использование ЦП, пропускная способность хранилища и операции ввода-вывода данных. Особенно это касается элементов уровня СУБД, но также и элементов прикладного уровня. Кроме того, измерьте задержки сети и хранилища.
2.  Запишите схемы времени доступности систем. Цель — понять, должны ли непроизводственные системы быть доступны круглосуточно или работу некоторых из них можно завершать в определенные периоды недели или месяца.
3.  Проверьте и определите, требуется ли создание собственных образов ОС для виртуальных машин в Azure или вы будете использовать образ из коллекции образов Azure. При использовании образа не из коллекции Azure убедитесь, что создан правильный образ, который соответствует контракту на поддержку с поставщиком операционной системы. Для некоторых поставщиков ОС коллекции Azure предлагают использовать образы с собственными лицензиями. Для других образов ОС поддержка включена в стоимость Azure. Если вы решили создать свои собственные образы ОС, то соответствующую документацию можно найти в следующих статьях.
    1.  Можно создать универсальный образ виртуальной машины Windows, развертываемый в Azure, следуя [этой документации](https://docs.microsoft.com/azure/virtual-machines/windows/capture-image-resource).
    2.  Можно создать универсальный образ виртуальной машины Linux, развертываемый в Azure, следуя [этой документации](https://docs.microsoft.com/azure/virtual-machines/linux/capture-image).
3.  При использовании образов SUSE и Red Hat Linux из коллекции виртуальных машин Azure необходимо применять образы для SAP, предоставленные поставщиками Linux в коллекции виртуальных машин Azure.
4.  Убедитесь, что вы выполнили требования к поддержке SAP в отношении соглашений о поддержке корпорации Майкрософт. Соответствующие сведения можно найти в примечании о поддержке SAP [2015553](https://launchpad.support.sap.com/#/notes/2015553). Сведения для крупных экземпляров HANA доступны в документе [Требования для подключения](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-onboarding-requirements).
4.  Убедитесь, что соответствующий персонал получает [уведомления о плановом обслуживании](https://azure.microsoft.com/blog/a-new-planned-maintenance-experience-for-your-virtual-machines/). Это позволит выбирать время простоя и своевременно перезагружать виртуальные машины.
5.  Постоянно просматривайте документацию Azure в виде презентаций корпорации Майкрософт на таких каналах, как [Channel9](https://channel9.msdn.com/), чтобы узнавать о новых функциях, которые могут применяться к развертываниям.
6.  Просматривайте примечания SAP, связанные с Azure, такие как примечание о поддержке [1928533](https://launchpad.support.sap.com/#/notes/1928533), чтобы узнавать о новых номерах SKU виртуальных машин, новых поддерживаемых версиях ОС и выпусках СУБД. Сравнивайте новые типы виртуальных машин с более старыми виртуальными машинами с точки зрения затрат. Это позволит развертывать виртуальные машины с лучшим соотношением цены и производительности.
7.  Еще раз проверьте ресурсы в соответствии с примечанием о поддержке SAP, каталогом оборудования SAP HANA и SAP PAM. Убедитесь, что поддерживаемые виртуальные машины Azure, поддерживаемые выпуски ОС для этих виртуальных машин и поддерживаемые выпуски SAP и СУБД не изменились.
8.  Перейдите [сюда](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure), чтобы узнать о новых сертифицированных номерах SKU для HANA в Azure, а также сравнить цены с теми номерами SKU, которые планируется использовать. Внесите соответствующие изменения, чтобы получить элементы с лучшим соотношением цены и производительности. 
9.  Адаптируйте свои сценарии развертывания, чтобы использовать новые типы виртуальных машин и внедрить новые возможности Azure, которые вы хотите использовать.
10. После развертывания инфраструктуры протестируйте и оцените задержки сети между виртуальными машинами на прикладном уровне SAP и уровне СУБД согласно примечаниям о поддержке SAP [500235](https://launchpad.support.sap.com/#/notes/500235) и [1100926](https://launchpad.support.sap.com/#/notes/1100926/E). Оцените результаты в соответствии с рекомендациями по задержки сети в примечании о поддержке SAP [1100926](https://launchpad.support.sap.com/#/notes/1100926/E). Задержка сети должна находиться в диапазоне от умеренной до хорошей. Исключения относятся к трафику между виртуальными машинами и крупными экземплярами HANA, как описано в [этой документации](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-network-architecture#networking-architecture-for-hana-large-instance). Убедитесь, что ни одно из ограничений, упомянутых в разделах [Вопросы развертывания СУБД для рабочей нагрузки SAP на виртуальных машинах Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/dbms_guide_general#azure-network-considerations) и [Конфигурации инфраструктуры SAP HANA и работа с ней в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-vm-operations), не относится к вашему развертыванию.
11. Выполните все прочие проверки, указанные на этапе подтверждения концепции, прежде чем применять рабочую нагрузку.
12. При применении рабочей нагрузки запишите данные о потреблении ресурсов этими системами в Azure и сравните их с записями, полученными на старой платформе. Настройте размер виртуальных машины для использования в будущих развертываниях, если вы предвидите большие различия. Имейте в виду, что в случае уменьшения размера виртуальных машин соответствующим образом сократятся ее пропускные способности хранилища и сети:
    1.  [Размеры виртуальных машин Windows в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/sizes?toc=%2fazure%2fvirtual-network%2ftoc.json). 
    2.  [Размеры виртуальных машин Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/sizes?toc=%2fazure%2fvirtual-network%2ftoc.json) 
13. Проработайте функциональные возможности и процессы копирования системы. Цель — упростить процесс копирования системы разработки или тестирования таким образом, чтобы команды проектов могли быстро получать новые системы. Рассмотрите возможность использования инструмента [SAP LaMa](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+Landscape+Management+%28SAP+LaMa%29+at+a+Glance) для выполнения таких задач.
14. Оптимизируйте и усовершенствуйте права доступа, разрешения и процессы для контроля доступа на основе ролей Azure для своей команды, чтобы обеспечить разделение обязанностей. Это с одной стороны. С другой стороны требуется, чтобы все команды могли выполнять свои задачи в инфраструктуре Azure.
15. Испытайте, протестируйте и задокументируйте процедуры обеспечения высокой доступности и аварийного восстановления, чтобы ваш персонал мог выполнять такие задачи. Определите недостатки новых функциональных возможностей Azure, которые нужно интегрировать в развертывания, и адаптируйте эти возможности.

 
## <a name="production-preparation-phase"></a>Этап подготовки рабочих систем. 
На этом этапе вам нужно собрать весь опыт и знания о непроизводственных развертываниях и применить их в будущих развертываниях рабочих систем. Помимо предыдущих этапов, необходимо также подготовить передачу данных между текущим расположением размещения и Azure. 

1.  Выполните необходимые обновления выпусков SAP в рабочих системах перед перемещением в Azure.
2.  Договоритесь с владельцами предприятий о проведении функциональных тестов и бизнес-тестов, которые нужно будет выполнить после переноса рабочей системы.
    1.  Убедитесь, что все эти тесты выполняются в исходных системах в текущем расположении размещения. Вы же не хотите, чтобы эти тесты впервые были проведены только после переноса системы в Azure?
2.  Протестируйте процесс переноса рабочих систем в Azure. В случае, если не все рабочие системы переносятся в Azure в течение одного интервала времени, составьте группы рабочих систем, которые должны находиться в одном расположении размещения. Выполните упражнение по переносу данных и протестируйте этот процесс. Ниже приведен список общих методов:
    1.  Используйте методы СУБД, такие как резервное копирование и восстановление, в сочетании с SQL Server AlwaysOn, репликацией системы HANA или доставкой журналов, чтобы ввести начальные значения и синхронизировать содержимое базы данных в Azure.
    2.  Используйте резервное копирование и восстановление для небольших баз данных.
    3.  Используйте монитор миграции SAP, внедренный в инструмент SAP SWPM, для переноса разнородных платформ.
    4.  Используйте процесс [SAP DMO](https://blogs.sap.com/2013/11/29/database-migration-option-dmo-of-sum-introduction/), если необходимо совместить перенос с обновлением выпуска SAP. Имейте в виду, что поддерживаются не все комбинации исходной и целевой СУБД. Дополнительные сведения можно найти в конкретных примечаниях о поддержке SAP для разных выпусков DMO. Например, в разделе [Database Migration Option (DMO) of SUM 2.0 SP04](https://launchpad.support.sap.com/#/notes/2644872) (Database Migration Option (DMO) в SUM 2.0 с пакетом обновления 4 (SP04)).
    5.  Если требуется перемещение резервных копий или файлов экспорта SAP, проверьте, что обеспечивает лучшую пропускную способность: Интернет или канал ExpressRoute. В случае перемещения данных через Интернет может потребоваться изменить некоторые из правил безопасности NSG и ASG, которые требуются для будущих рабочих систем.
3.  Перед перемещением систем со старой платформы в Azure соберите данные о потреблении ресурсов, такие как использование ЦП, пропускная способность хранилища и операции ввода-вывода данных. Особенно это касается элементов уровня СУБД, но также и элементов прикладного уровня. Кроме того, измерьте задержки сети и хранилища.
4.  Еще раз проверьте ресурсы в соответствии с примечанием о поддержке SAP, каталогом оборудования SAP HANA и SAP PAM. Убедитесь, что поддерживаемые виртуальные машины Azure, поддерживаемые выпуски ОС для этих виртуальных машин и поддерживаемые выпуски SAP и СУБД не изменились. 
4.  Адаптируйте сценарии развертывания в соответствии с последними изменениями, внесенными в типы виртуальных машин и функциональные возможности Azure.
5.  После развертывания инфраструктуры и приложений выполните ряд проверок, чтобы обеспечить их допустимость.
    1.  Убедитесь, что развернуты правильные типы виртуальных машин с правильными атрибутами и размерами хранилища.
    2.  Убедитесь, что в виртуальных машинах используются правильные целевые выпуски и исправления ОС, которые являются универсальными.
    3.  Убедитесь, что усиление защиты виртуальных машин является обязательным и универсальным.
    4.  Убедитесь, что установлены и развернуты правильные выпуски приложений.
    5.  Виртуальные машины должны быть развернуты в группах доступности Azure согласно плану.
    6.  Для дисков, чувствительных к задержке, или систем, требующих [соглашения об уровне доступности отдельных виртуальных машин 99,9 %](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_8/), используется служба хранилища Azure (цен. категория "Премиум").
    7.  Проверьте правильность развертывания Ускорителя записи Azure.
        1.  Убедитесь, что на дисках виртуальной машины, которым требуется поддержка Ускорителя записи Azure, правильно созданы дисковые пространства или наборы чередующихся томов.
            1.  Ознакомьтесь с [настройкой программного RAID-массива в Linux](https://docs.microsoft.com/azure/virtual-machines/linux/configure-raid).
            2.  Ознакомьтесь с [настройкой диспетчера логических томов на виртуальной машине Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/configure-lvm).
    8.  Были использованы только [управляемые диски Azure](https://azure.microsoft.com/services/managed-disks/).
    9.  Виртуальные машины развернуты в правильных группах доступности и зонах доступности.
    10. Убедитесь, что [ускорение работы в сети Azure](https://azure.microsoft.com/blog/maximize-your-vm-s-performance-with-accelerated-networking-now-generally-available-for-both-windows-and-linux/) включено на виртуальных машинах, используемых на прикладном уровне SAP и уровне СУБД SAP.
    11. Никакие [виртуальные сетевые модули Azure](https://azure.microsoft.com/solutions/network-appliances/) не должны размещаться в пути взаимодействия между прикладным уровнем SAP и уровнем СУБД SAP NetWeaver, Hybris или системами SAP на основе S/4 HANA.
    12. Правила ASG и NSG разрешают обмен данными в соответствии с требованиями и планом и блокируют обмен данными, когда это необходимо.
    13. Параметры времени ожидания, описанные ранее, заданы правильно.
    14. Протестируйте и оцените задержки сети между виртуальными машинами на прикладном уровне SAP и уровне СУБД согласно примечаниям о поддержке SAP [500235](https://launchpad.support.sap.com/#/notes/500235) и [1100926](https://launchpad.support.sap.com/#/notes/1100926/E). Оцените результаты в соответствии с рекомендациями по задержки сети в примечании о поддержке SAP [1100926](https://launchpad.support.sap.com/#/notes/1100926/E). Задержка сети должна находиться в диапазоне от умеренной до хорошей. Исключения относятся к трафику между виртуальными машинами и крупными экземплярами HANA, как описано в [этой документации](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-network-architecture#networking-architecture-for-hana-large-instance).
    15. Проверьте, развернуто ли шифрование, где оно требуется, и используется ли для этого нужный метод шифрования.
    16. Проверьте, могут ли интерфейсы и другие приложения подключиться к только что развернутой инфраструктуре.
6.  Создайте сборник схем для реагирования на плановое обслуживание Azure. Определите порядок перезагрузки систем и виртуальных машин в случае планового обслуживания.
    

## <a name="go-live-phase"></a>Этап запуска
На этапе запуска необходимо следовать сборникам схем, которые вы разработали на предыдущих этапах. Выполните шаги, которые вы протестировали и изучили. Не принимайте изменения, вносимые в конфигурации и процессы в последнюю минуту. Кроме того, следуйте приведенным ниже рекомендациям.

1. Убедитесь, что мониторинг на портале Azure и другие инструменты мониторинга работают.  Рекомендуемые инструменты — монитор производительности (Windows) или САР (Linux). 
    1.  Счетчики ЦП: 
        1.  среднее время ЦП — общее (все ЦП);
        2.  среднее время ЦП — для каждого отдельного процессора (например, 128 процессоров для виртуальной машины m128);
        3.  ядро для времени ЦП — для каждого отдельного процессора;
        4.  пользователь для времени ЦП — для каждого отдельного процессора.
    5.  Память 
        1.  объем свободной памяти;
        2.  число входящих страниц в секунду;
        3.  число исходящих страниц в секунду.
    4.  Диск 
        1.  чтение с диска (КБ/с) — для каждого отдельного диска; 
        2.  число операций чтения с диска в секунду — для каждого отдельного диска;
        3.  длительность операций чтения с диска (мс) — для каждого отдельного диска;
        4.  запись на диск (КБ/с) — для каждого отдельного диска; 
        5.  число операций записи на диск в секунду — для каждого отдельного диска;
        6.  длительность операций записи на диск (мс) — для каждого отдельного диска.
    5.  Сеть 
        1.  число входящих сетевых пакетов в секунду;
        2.  число исходящих сетевых пакетов в секунду;
        3.  входящий сетевой трафик (КБ/с);
        4.  исходящий сетевой трафик (КБ/с). 
2.  После переноса данных необходимо выполнить все проверочные тесты, которые согласованы с владельцами предприятий. Принимайте только результаты проверочных тестов, для которых у вас есть результаты исходных систем.
3.  Проверьте, функционируют ли интерфейсы и могут ли другие приложения взаимодействовать с развернутыми рабочими системами.
4.  Проверьте систему передачи и исправления SAP с помощью транзакций STMS.
5.  Создайте резервные копии баз данных после развертывания системы в рабочей среде.
6.  Выполните резервное копирование виртуальных машины на прикладном уровне SAP после развертывания системы в рабочей среде.
7.  Для систем SAP, которые не обрабатывались на текущем этапе запуска, но которые взаимодействуют с системами SAP, перемещенными в Azure на этом этапе, потребуется выполнить сброс буфера имен узлов в SM51. Это позволит избавиться от старых кэшированных IP-адресов, связанных с именами экземпляров приложений, которые уже перемещены в Azure.  


## <a name="post-production"></a>Этап после запуска рабочих систем
На этом этапе выполняются задачи мониторинга, эксплуатации и администрирования системы. С точки зрения SAP выполняются обычные задачи, которые нужно было выполнять в предыдущем расположении размещения. Вам потребуется выполнять следующие задачи, относящиеся к Azure:

1. анализ счетов Azure для дорогостоящих систем;
2. оптимизации соотношения цены и производительности хранилища и виртуальных машин;
3. оптимизация времени, в течение которого системы можно отключать.  


## <a name="next-steps"></a>Следующие шаги
Изучите следующую документацию:

- [SAP NetWeaver на виртуальных машинах Windows. Руководство по планированию и внедрению](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/planning-guide)
- [Развертывание виртуальных машин Azure для SAP NetWeaver](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/deployment-guide)
- [Вопросы развертывания СУБД для рабочей нагрузки SAP на виртуальных машинах Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/dbms_guide_general)

