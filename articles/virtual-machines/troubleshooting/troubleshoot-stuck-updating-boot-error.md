---
title: Зависание виртуальной машины при запуске во время обновления Windows | Документация Майкрософт
description: Узнайте, как устранить неполадки при зависании виртуальной машины при запуске во время обновления Windows.
services: virtual-machines-windows
documentationCenter: ''
authors: genli
manager: cshepard
editor: v-jesits
ms.service: virtual-machines-windows
ms.devlang: na
ms.topic: troubleshooting
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure
ms.date: 10/09/2018
ms.author: genli
ms.openlocfilehash: 2d42d2014432b72f35e9b0d9543fe499a6ab721b
ms.sourcegitcommit: 8e06d67ea248340a83341f920881092fd2a4163c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2018
ms.locfileid: "49355315"
---
# <a name="azure-vm-startup-is-stuck-at-windows-update"></a>Зависание виртуальной машины при запуске во время обновления Windows

Эта статья помогает решить проблему, когда виртуальная машина зависает на этапе обновления Windows во время запуска. 

> [!NOTE] 
> В Azure предлагаются две модели развертывания для создания ресурсов и работы с ними: [модель диспетчера ресурсов и классическая модель](../../azure-resource-manager/resource-manager-deployment-model.md). В этой статье описывается использование модели развертывания на основе диспетчера ресурсов. Для новых развертываний рекомендуется использовать эту модель развертывания вместо классической.

 ## <a name="symptom"></a>Симптом

 Виртуальная машина Windows не запускается. При проверке снимков экрана в окне [Диагностика загрузки](../troubleshooting/boot-diagnostics.md) вы обнаруживаете, что во время запуска произошло зависание на этапе обновления. Ниже приведены примеры сообщений об ошибках.

- Установка Windows ##%. Не выключайте компьютер. Это займет некоторое время. Компьютер перезагрузится несколько раз.
- Не выключайте компьютер до завершения. Установка обновления # из #... 
- Мы не смогли завершить обновления. Отмена изменений. Не выключайте компьютер.
- Сбой при настройке обновлений Windows. Отмена изменений. Не выключайте компьютер.
- Ошибка <код ошибки> применения операций обновления ##### из ##### (\Regist...)
- Неустранимая ошибка <код ошибки> применения операций обновления ##### из ##### ($$...)


## <a name="solution"></a>Решение

В зависимости от количества обновлений, которые устанавливаются или откатываются, процесс обновления может занять некоторое время. Оставьте виртуальную машину в этом состоянии на 8 часов. Если по прошествии этого периода виртуальная машина по-прежнему пребывает в этом состоянии, перезапустите ее на портале Azure и проверьте, запускается ли она обычным образом. Если этот шаг не помог, попробуйте следующее решение.

### <a name="remove-the-update-that-causes-the-problem"></a>Удаление обновления, вызвавшего проблему

1. Сделайте снимок диска ОС затронутой виртуальной машины в качестве резервной копии. Дополнительные сведения см. в статье [Создание моментального снимка](../windows/snapshot-copy-managed-disk.md). 
2. [Устранение неполадок с виртуальной машиной Windows при подключении диска операционной системы к виртуальной машине восстановления с помощью портала Azure](troubleshoot-recovery-disks-portal-windows.md).
3. После подключения диска операционной системы на виртуальной машине восстановления откройте **диспетчер дисков** и убедитесь, что он находится в состоянии **В сети**. Обратите внимание на букву диска, которая назначается присоединенному диску ОС с папкой \Windows. Если диск зашифрован, расшифруйте его, прежде чем приступать к следующим шагам в этом документе.

3. Получите список пакетов обновления, которые находятся на прилагаемом диске ОС:

        dism /image:<Attached OS disk>:\ /get-packages > c:\temp\Patch_level.txt

    Например, если подключенный диск ОС является диском F, выполните следующую команду:

        dism /image:F:\ /get-packages > c:\temp\Patch_level.txt
4. Откройте файл C:\temp\Patch_level.txt, а затем прочтите его снизу вверх. Найдите обновление, которое находится в состоянии **ожидания установки** или **ожидания удаления**.  Ниже приведен пример состояния обновления.

     ```
    Package Identity : Package_for_RollupFix~31bf3856ad364e35~amd64~~17134.345.1.5
    State : Install Pending
    Release Type : Security Update
    Install Time :
    ```
5. Удалите обновление, вызвавшее проблему:
    
    ```
    dism /Image:<Attached OS disk>:\ /Remove-Package /PackageName:<PACKAGE NAME TO DELETE>
    ```
    Пример: 

    ```
    dism /Image:F:\ /Remove-Package /Package_for_RollupFix~31bf3856ad364e35~amd64~~17134.345.1.5
    ```

    > [!NOTE] 
    > В зависимости от размера пакета инструменту DISM понадобится некоторое время для обработки отмены установки. Обычно процесс завершается в течение 16 минут.

6. Отключите диск операционной системы, а затем [повторно создайте виртуальную машину с помощью диска ОС](troubleshoot-recovery-disks-portal-windows.md). 