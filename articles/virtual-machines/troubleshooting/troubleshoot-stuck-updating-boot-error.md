---
title: Зависание виртуальной машины при запуске во время обновления Windows | Документация Майкрософт
description: Узнайте, как устранить неполадки при зависании виртуальной машины при запуске во время обновления Windows.
services: virtual-machines-windows
documentationCenter: ''
author: genlin
manager: dcscontentpm
editor: v-jesits
ms.service: virtual-machines-windows
ms.topic: troubleshooting
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure
ms.date: 10/09/2018
ms.author: genli
ms.openlocfilehash: 226151d81319dc4e6f132e76ce2d310f88a484e8
ms.sourcegitcommit: c79aa93d87d4db04ecc4e3eb68a75b349448cd17
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/18/2019
ms.locfileid: "71087023"
---
# <a name="azure-vm-startup-is-stuck-at-windows-update"></a>Зависание виртуальной машины при запуске во время обновления Windows

Эта статья помогает решить проблему, когда виртуальная машина зависает на этапе обновления Windows во время запуска. 

> [!NOTE] 
> В Azure предлагаются две модели развертывания для создания ресурсов и работы с ними: [модель развертывания с помощью Resource Manager и классическая модель](../../azure-resource-manager/resource-manager-deployment-model.md). В этой статье описывается использование модели развертывания на основе диспетчера ресурсов. Для новых развертываний рекомендуется использовать эту модель развертывания вместо классической.

## <a name="symptom"></a>Симптом

 Виртуальная машина Windows не запускается. При проверке снимков экрана в окне [Диагностика загрузки](../troubleshooting/boot-diagnostics.md) вы обнаруживаете, что во время запуска произошло зависание на этапе обновления. Ниже приведены примеры сообщений об ошибках.

- Установка Windows ##%. Не выключайте компьютер. Это займет некоторое время. Компьютер перезагрузится несколько раз.
- Не выключайте компьютер до завершения. Установка обновления # из #... 
- Мы не смогли завершить обновления. Отмена изменений. Не выключайте компьютер.
- Сбой при настройке обновлений Windows. Отмена изменений. Не выключайте компьютер.
- Ошибка <код ошибки> применения операций обновления ##### из ##### (\Regist...)
- Неустранимая ошибка <код ошибки> применения операций обновления ##### из ##### ($$...)


## <a name="solution"></a>Решение

В зависимости от количества обновлений, которые устанавливаются или откатываются, процесс обновления может занять некоторое время. Оставьте виртуальную машину в этом состоянии на 8 часов. Если по прошествии этого периода виртуальная машина по-прежнему пребывает в этом состоянии, перезапустите ее на портале Azure и проверьте, запускается ли она обычным образом. Если этот шаг не помог, попробуйте следующее решение.

### <a name="remove-the-update-that-causes-the-problem"></a>Удаление обновления, вызвавшего проблему

1. Сделайте снимок диска ОС затронутой виртуальной машины в качестве резервной копии. Дополнительные сведения см. в статье [Создание моментального снимка](../windows/snapshot-copy-managed-disk.md). 
2. [Устранение неполадок с виртуальной машиной Windows при подключении диска операционной системы к виртуальной машине восстановления с помощью портала Azure](troubleshoot-recovery-disks-portal-windows.md).
3. После подключения диска операционной системы на виртуальной машине восстановления запустите **diskmgmt.msc**, чтобы открыть "Управление дисками", и убедитесь, что подключенный диск **В сети**. Обратите внимание на букву диска, которая назначается присоединенному диску ОС с папкой \Windows. Если диск зашифрован, расшифруйте его, прежде чем приступать к следующим шагам в этом документе.

4. Откройте командную строку с повышенными привилегиями (Запуск от имени администратора). Выполните следующую команду, чтобы получить список пакетов обновления, которые находятся на прилагаемом диске ОС:

        dism /image:<Attached OS disk>:\ /get-packages > c:\temp\Patch_level.txt

    Например, если подключенный диск ОС является диском F, выполните следующую команду:

        dism /image:F:\ /get-packages > c:\temp\Patch_level.txt
5. Откройте файл C:\temp\Patch_level.txt, а затем прочтите его снизу вверх. Найдите обновление, которое находится в состоянии **ожидания установки** или **ожидания удаления**.  Ниже приведен пример состояния обновления.

     ```
    Package Identity : Package_for_RollupFix~31bf3856ad364e35~amd64~~17134.345.1.5
    State : Install Pending
    Release Type : Security Update
    Install Time :
    ```
6. Удалите обновление, вызвавшее проблему:
    
    ```
    dism /Image:<Attached OS disk>:\ /Remove-Package /PackageName:<PACKAGE NAME TO DELETE>
    ```
    Пример: 

    ```
    dism /Image:F:\ /Remove-Package /PackageName:Package_for_RollupFix~31bf3856ad364e35~amd64~~17134.345.1.5
    ```

    > [!NOTE] 
    > В зависимости от размера пакета инструменту DISM понадобится некоторое время для обработки отмены установки. Обычно процесс завершается в течение 16 минут.

7. [Отключение диска операционной системы и повторное создание виртуальной машины](troubleshoot-recovery-disks-portal-windows.md#unmount-and-detach-original-virtual-hard-disk). Затем проверьте, устранена ли проблема.
