---
title: Устранение ошибки диспетчера загрузки Windows 0xC0000225 "Состояние не найдено"
description: Действия по устранению проблем, когда на виртуальной машине Azure отображается код ошибки 0xC0000225.
services: virtual-machines-windows, azure-resource-manager
documentationcenter: ''
author: v-miegge
manager: dcscontentpm
editor: ''
tags: azure-resource-manager
ms.assetid: c17899a4-b270-4725-9530-0dcd829b178c
ms.service: virtual-machines-windows
ms.workload: na
ms.tgt_pltfrm: vm-windows
ms.topic: troubleshooting
ms.date: 05/11/2020
ms.author: v-miegge
ms.openlocfilehash: 3677d67f55cfccdc80245b2ec870ffa76b0a1940
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "87088671"
---
# <a name="troubleshoot-windows-boot-manager-error----0xc0000225-status-not-found"></a>Устранение ошибки диспетчера загрузки Windows 0xC0000225 "Состояние не найдено"
 
В этой статье приведены инструкции по устранению проблем, вызывающих ошибку 0xC0000225 на виртуальной машине Azure. В сообщении об этой ошибке указывается, что состояние или объект не найдены.

## <a name="symptoms"></a>Симптомы

При использовании [диагностики загрузки](./boot-diagnostics.md) для просмотра снимка экрана виртуальной машины вы увидите на нем ошибку запуска Windows кодом *0xc0000225*.

Файл, связанный с этим кодом ошибки, будет содержать инструкции о том, какие действия необходимо предпринять, чтобы устранить проблему. Найдите текст раздела **File:** (Файл:), чтобы определить соответствующий курс действий.

### <a name="drivers-os-related-or-third-party"></a>Проблемы с драйверами, операционной системой или сторонним компонентом

Если файл есть, но ссылается на драйвер (как показано ниже), операционную систему или сторонний компонент, выполните действия, описанные в разделе [Восстановление системного файла](#repair-the-system-file).
 
На следующем рисунке диспетчер загрузки Windows сообщает: "Windows failed to start. A recent hardware or software change might be the cause" (Не удалось запустить Windows. Возможно, причиной является недавнее изменение аппаратного или программного обеспечения). На рисунке также показано состояние "0xc0000225", поле **File:** (Файл:) со значением `\windows\System32\drivers\atapi.sys` и поле **Info:** (Информация:) с сообщением "The operating system couldn’t be loaded because a critical system driver is missing or contains errors" (Не удалось загрузить операционную систему, так как критически важный драйвер системы отсутствует или содержит ошибки).

![Диспетчер загрузки Windows сообщает: "Windows failed to start. A recent hardware or software change might be the cause" (Не удалось запустить Windows. Возможно, причиной является недавнее изменение аппаратного или программного обеспечения). Также отображается состояние "0xC0000225", файл "\windows\System32\drivers\atapi.sys" и сообщение в разделе "Info" (Информация): “The operating system couldn’t be loaded because a critical system driver is missing or contains errors” (Не удалось загрузить операционную систему, так как критически важный драйвер системы отсутствует или содержит ошибки).](./media/troubleshoot-boot-error-status-not-found/1.png)

### <a name="no-file"></a>Файл отсутствует

Если отображается код состояния, но файл не показан, выполните действия, описанные в разделе [Добавление переменной OSDEVICE](#add-the-osdevice-variable).

На следующем рисунке диспетчер загрузки Windows сообщает: "Windows failed to start. A recent hardware or software change might be the cause" (Не удалось запустить Windows. Возможно, причиной является недавнее изменение аппаратного или программного обеспечения). На рисунке также отображается состояние "0xC0000225" и сообщение в поле **Info:** (Информация:) "The boot selection failed because a required device is inaccessible" (Сбой меню загрузки, так как требуемое устройство недоступно).

![Диспетчер загрузки Windows сообщает: "Windows failed to start. A recent hardware or software change might be the cause" (Не удалось запустить Windows. Возможно, причиной является недавнее изменение аппаратного или программного обеспечения). В нем также отображается состояние "0xC0000225", а в разделе "Info" (Информация) — сообщение: "The boot selection failed because a required device is inaccessible" (Сбой меню загрузки, так как требуемое устройство недоступно).](./media/troubleshoot-boot-error-status-not-found/2.png)

### <a name="registry-file"></a>Файл реестра

Если указан какой-либо файл реестра, например \Windows\System32\Config\system, выполните действия, описанные в разделе [Создание запроса в службу поддержки](#contact-support).
 
На следующем рисунке диспетчер загрузки Windows сообщает: "Windows failed to start. A recent hardware or software change might be the cause" (Не удалось запустить Windows. Возможно, причиной является недавнее изменение аппаратного или программного обеспечения). На рисунке также показано состояние "0xc0000225", поле File: (Файл:) со значением `\windows\System32\config\system` и поле **Info:** (Информация:) с сообщением "The operating system couldn’t be loaded because the system registry file is missing or contains errors" (Не удалось загрузить операционную систему, так как файл системного реестра отсутствует или содержит ошибки).

![Диспетчер загрузки Windows сообщает: "Windows failed to start. A recent hardware or software change might be the cause" (Не удалось запустить Windows. Возможно, причиной является недавнее изменение аппаратного или программного обеспечения). Также отображается состояние "0xC0000225", файл "\windows\System32\config\system" и сообщение в разделе "Info" (Информация): "The operating system couldn’t be loaded because the system registry file is missing or contains errors" (Не удалось загрузить операционную систему, так как файл системного реестра отсутствует или содержит ошибки).](./media/troubleshoot-boot-error-status-not-found/3.png)

На следующем рисунке на экране восстановления показано сообщение: "Your PC/Device needs to be repaired. The operating system couldn’t be loaded because the system registry file is missing or contains errors" (Компьютер или устройство нуждается в ремонте. Не удалось загрузить операционную систему, так как файл системного реестра отсутствует или содержит ошибки). На рисунке также отображается код ошибки "0xC0000225" и поле "File" (Файл) со значением `\windows\System32\config\system`.

![На экране восстановления показано сообщение: "Your PC/Device needs to be repaired. The operating system couldn’t be loaded because the system registry file is missing or contains errors" (Компьютер или устройство нуждается в ремонте. Не удалось загрузить операционную систему, так как файл системного реестра отсутствует или содержит ошибки). Также отображается код ошибки "0xC0000225" и поле "File" (Файл) со значением "\windows\System32\config\system".](./media/troubleshoot-boot-error-status-not-found/4.png)

## <a name="causes"></a>Причины

### <a name="missing-binary"></a>Отсутствует двоичный файл

Возможно, в системе отсутствует или поврежден двоичный **SYS**-файл.

### <a name="bcd-corruption-or-improper-vhd-migration"></a>Повреждение BCD или неправильная миграция VHD

В этом случае, возможно, повреждены **данные конфигурации загрузки (BCD)** либо **виртуальный жесткий диск (VHD)** был перенесен из локальной среды, но не был правильно подготовлен. В результате переменная **OSDEVICE** отсутствует, и ее необходимо будет добавить.

### <a name="registry-hive-corruption"></a>Повреждение куста реестра

Повреждение куста реестра может быть вызвано следующими причинами:

- произошли сбои в работе куста;
- куст подключается, но является пустым;
- куст был неправильно закрыт.
## <a name="solution"></a>Решение

### <a name="process-overview"></a>Обзор процесса

1. Создайте виртуальную машину для восстановления и обратитесь к ней.
1. Выберите решение:
   - [восстановление системного файла](#repair-the-system-file);
   - [добавление переменной OSDevice](#add-the-osdevice-variable);
   - [создание запроса в службу поддержки](#contact-support).
1. Включите последовательную консоль и сбор дампов памяти.
1. Перестройте виртуальную машину.

### <a name="create-and-access-a-repair-vm"></a>Создание виртуальной машины для восстановления и получение доступа к ней

1. Выполните шаги 1–3 из списка [команд для восстановления виртуальной машины](./repair-windows-vm-using-azure-virtual-machine-repair-commands.md), чтобы подготовить виртуальную машину для восстановления.
1. Используйте подключение к удаленному рабочему столу, чтобы подключиться к виртуальной машине для восстановления.

### <a name="select-a-solution"></a>Выбор решения

1. Откройте командную строку с повышенными привилегиями.
1. В соответствии с симптомом, который вы определили ранее, выполните действия, описанные в соответствующем решении. Вы можете пропустить шаги в других решениях, так как они не относятся к вашей проблеме:

- [восстановление системного файла](#repair-the-system-file);
- [добавление переменной OSDevice](#add-the-osdevice-variable);
- [создание запроса в службу поддержки](#contact-support).

### <a name="repair-the-system-file"></a>Восстановление системного файла

1. Используя подключенный VHD, перейдите к расположению двоичного файла, показанному на снимке экрана виртуальной машины.
1. Щелкните этот файл правой кнопкой мыши, выберите **Свойства**, а затем выберите вкладку **Сведения**, чтобы просмотреть сведения о файле.
   1. Обратите внимание на версию файла, как показано на рисунке ниже.

      ![Окно свойств файла cng.sys с выделенной версией файла](./media/troubleshoot-boot-error-status-not-found/5.png)

1. Переименуйте файл в **<BINARY.SYS>.old**, заменив **<BINARY.SYS>** именем файла.

   Для рисунка на предыдущем шаге файл **cng.sys** следовало бы переименовать в **cng.sys.old**.

   > [!NOTE]
   > Если при попытке переименовать файл отображается сообщение "The file is corrupted and unreadable" (Файл поврежден и не читается), [обратитесь в службу поддержки за помощью](https://azure.microsoft.com/support/create-ticket/), так как выбранное решение не устранит проблему.

1. Теперь, когда поврежденный файл переименован, исправьте файл, восстановив его из внутреннего репозитория.
   1. Запустите сеанс командной строки **CMD**.
   1. Перейдите в каталог **\windows\winsxs**.

   1. Выполните поиск двоичного файла, расположенного в начале этого раздела, с помощью следующей команды:

      `dir <BINARY WITH ".SYS" EXTENSION>  /s`

      Эта команда выводит список всех версий файла на компьютере, предоставляя журнал путей к этому компоненту.
      
      Например, файл **dir cng.sys** был бы переименован: **dir cng.sys /s**.

   1. Выберите последнюю версию файла в списке (или любую другую на ваш выбор) и скопируйте файл в папку **Windows\System32**, используя предыдущий путь и приведенную ниже команду.

      `copy <drive>:\Windows\WinSxS\<DIRECTORY WHERE FILE IS>\<BINARY WITH ".SYS" EXTENSION> <DRIVE>:\Windows\System32\Drivers\`

      > [!NOTE]
      > Если последняя версия двоичного файла не сработала, попробуйте использовать версию, предшествующую ей, или любую другую версию, которая содержит стабильный файл, например версию до установки исправления.

      Например, если искомый двоичный файл — **cmimcext.sys**, неисправный диск — **F:** и вы только что запустили поиск последней версии, то вы увидите экран как на рисунке ниже, где запрос в командной строке `dir cmim* /s` находит последнюю версию файла cmimcext.sys.

      ![Запрос в командной строке "dir cmim* /s" для поиска последней версии файла cmimcext.sys](./media/troubleshoot-boot-error-status-not-found/6.png)

      На приведенном выше рисунке показан запрос для диска **C:** , в то время как должна быть указана буква неисправного диска **F:** . Это диск операционной системы, подключенный в качестве диска данных на виртуальной машине восстановления.

      Окончательная команда для копирования файла будет выглядеть так: `copy F:\Windows\WinSxS\amd64_xxxxxx\cmimcext.sys F:\Windows\System32\Drivers`.

После завершения этой задачи перейдите к [включению последовательной консоли и сбору дампов памяти](#enable-the-serial-console-and-memory-dump-collection).

### <a name="add-the-osdevice-variable"></a>Добавление переменной OSDEVICE

Соберите сведения о текущей конфигурации загрузки и запишите идентификатор активного раздела. Эти сведения будут использованы для добавления переменной **OSDEVICE** в соответствии с указаниями для поколения вашей виртуальной машины.

Если при сборе этой информации произойдет ошибка из-за отсутствия файла **\boot\bcd**, выполните инструкции в разделе [Восстановление системного файла](#repair-the-system-file). 

1. Если используются виртуальные машины 1-го поколения, откройте сеанс командной строки с повышенными привилегиями от имени администратора и выполните приведенную ниже команду.

   `bcdedit /store <LETTER OF BOOT FOLDER>:\boot\bcd /enum`

   На этом рисунке показан загрузчик Windows на виртуальной машине 1-го поколения с выделенным атрибутом идентификатора. Выделенный атрибут идентификатора содержит уникальную буквенно-цифровую строку.

   ![Показан загрузчик Windows на виртуальной машине 1-го поколения с выделенным атрибутом идентификатора. Выделенный атрибут идентификатора содержит уникальную буквенно-цифровую строку.](./media/troubleshoot-boot-error-status-not-found/7.png)

   Запишите идентификатор загрузчика Windows, путь к которому **\Windows\system32\winload.exe**.

1. Для виртуальных машин 2-го поколения убедитесь, что диск ОС подключен и его разделам назначены буквы диска. Подтвердив это, соберите сведения о конфигурации загрузки.
   1. В **поле поиска Windows** введите **управление дисками**, а затем откройте консоль управления дисками. С помощью этой консоли определите номер диска, подключенного к виртуальной машине восстановления, и раздел EFI, содержащий хранилище данных конфигурации загрузки (BCD).

   На следующем рисунке показано, что к виртуальной машине восстановления подключен диск 2. На рисунке также показан системный раздел EFI на диске 2, размер которого составляет 100 МБ и которому не назначена буква.

   ![Показано, что к виртуальной машине восстановления подключен диск 2. Кроме того, показан системный раздел EFI на диске 2, размер которого составляет 100 МБ и которому не назначена буква.](./media/troubleshoot-boot-error-status-not-found/8.png)

   1. Откройте сеанс командной строки с повышенными привилегиями от имени администратора и выполните приведенную ниже команду.
      1. Откройте инструмент **DISKPART** с помощью команды `diskpart`.
      1. Выведите список всех дисков, а затем выберите подключенный диск, определенный на предыдущем шаге.
      
         ```
         list disk
         sel disk <DISK #>
         ```

         На следующем рисунке показаны результаты вывода списка и выбора диска. Диск 0 (127 Гб/в сети), диск 1 (32 ГБ в сети) и диск 2 (127 Гб в сети) отображаются, если выбран диск 2, с помощью команды `sel disk 2` .

         ![Результаты вывода списка и выбора диска. Выведены диск 0 (127 ГБ, подключен), диск 1 (32 ГБ, подключен) и диск 2 (127 ГБ, подключен). Выбран диск 2.](./media/troubleshoot-boot-error-status-not-found/9.png)

      1. Выведите список разделов и выберите системный раздел EFI, определенный на предыдущем шаге.
      
         ```
         list partition
         sel partition <PARTITION #>
         ```

         На следующем рисунке показаны результаты вывода списка и выбора раздела. Раздел 1 (зарезервировано/16 МБ), Секция 2 (System/100 МБ) и Секция 3 (первичный/126 ГБ) перечислены, а раздел 2 выбирается с помощью команды `sel part 2` .

         ![Результаты вывода списка и выбора раздела. Выведены раздел 1 (зарезервированный, 16 МБ), раздел 2 (системный, 100 МБ) и раздел 3 (первичный, 126 ГБ). Выбран раздел 2.](./media/troubleshoot-boot-error-status-not-found/10.png)

      1. Назначьте букву разделу EFI с помощью команды `assign`.

         На следующем рисунке показаны команда `assign` и новый диск **SYSTEM (F:)** в проводнике.

         ![Команда assign и новый диск SYSTEM (F:), доступный для просмотра в проводнике.](./media/troubleshoot-boot-error-status-not-found/11.png)

      1. Выведите список данных в хранилище данных конфигурации загрузки (BCD) с помощью приведенной ниже команды.
      
         `bcdedit /store <LETTER OF EFI SYSTEM PARTITION>:EFI\Microsoft\boot\bcd /enum`

         На следующем рисунке показан загрузчик Windows на виртуальной машине 2-го поколения с выделенным атрибутом идентификатора. Выделенный атрибут идентификатора имеет значение **{Default}** .

         ![Показан загрузчик Windows на виртуальной машине 2-го поколения с выделенным атрибутом идентификатора. Выделенный атрибут идентификатора отображает значение по умолчанию.](./media/troubleshoot-boot-error-status-not-found/12.png)

         Запишите идентификатор загрузчика Windows, путь к которому **\Windows\system32\winload.efi**.

1. Обратите внимание на то, что переменная OSDEVICE для активного раздела отсутствует.

   ![В командной строке указаны атрибуты диспетчера загрузки Windows и загрузчика Windows; атрибут устройства ОС отсутствует.](./media/troubleshoot-boot-error-status-not-found/13.png)
   
   На этом рисунке показаны атрибуты диспетчера загрузки Windows и загрузчика Windows, выведенные в командной строке, но отсутствует атрибут OSDEVICE.

1. Добавьте переменную OSDEVICE на основе следующих сведений.

   Для дисков ОС с одним разделом добавьте `BOOT`.

   > [!NOTE]
   > Загрузочная папка будет находиться в том же разделе, что и папка Windows, **\Windows**.
   > - В качестве загрузочной папки для виртуальных машин 1-го поколения используется **\boot\bcd**.
   > - В качестве загрузочной папки для виртуальных машин 2-го поколения используется **EFI\Microsoft\boot\bcd**.

   Для виртуальных машин 1-го поколения введите приведенную ниже команду.

   `bcdedit /store <LETTER OF BOOT FOLDER>:\boot\bcd /set {<IDENTIFIER>} OSDEVICE BOOT`

   Для виртуальных машин 2-го поколения введите приведенную ниже команду.

   `bcdedit /store <LETTER OF EFI FOLDER>:EFI\Microsoft\boot\bcd /set {<IDENTIFIER>} OSDEVICE BOOT`

   Для дисков ОС с несколькими разделами добавьте `PARTITION=<LETTER OF WINDOWS FOLDER>:`.

   > [!NOTE]
   > Загрузочная папка, скорее всего, будет находится в разделе, отличном от раздела с папкой Windows, **\Windows**.
   > - В качестве загрузочной папки для виртуальных машин 1-го поколения используется **\boot\bcd**.
   > - В качестве загрузочной папки для виртуальных машин 2-го поколения используется **EFI\Microsoft\boot\bcd**.

   Для виртуальных машин 1-го поколения введите приведенную ниже команду.

   `bcdedit /store <LETTER OF BOOT FOLDER>:\boot\bcd /set {<IDENTIFIER>} OSDEVICE partition=<LETTER OF WINDOWS FOLDER>:`

   Для виртуальных машин 2-го поколения введите приведенную ниже команду.

   `bcdedit /store <LETTER OF EFI FOLDER>:EFI\Microsoft\boot\bcd /set {< IDENTIFIER>} OSDEVICE partition=<LETTER OF WINDOWS FOLDER>:`

После завершения этой задачи перейдите к [включению последовательной консоли и сбору дампов памяти](#enable-the-serial-console-and-memory-dump-collection).

### <a name="contact-support"></a>Обращение в службу поддержки

Для ошибки **файла реестра** есть решение, но для получения дополнительной помощи потребуется [создать запрос в службу поддержки](https://azure.microsoft.com/support/create-ticket/).

### <a name="enable-the-serial-console-and-memory-dump-collection"></a>Включение последовательной консоли и сбор дампов памяти

**Рекомендуется**. Прежде чем перестраивать виртуальную машину, включите последовательную консоль и соберите дампы памяти, выполнив приведенный ниже сценарий.

1. Откройте сеанс командной строки с повышенными привилегиями от имени администратора.
1. Выполните следующие команды:

   **Включите последовательную консоль**.
   
   ```
   bcdedit /store <VOLUME LETTER WHERE THE BCD FOLDER IS>:\boot\bcd /ems {<BOOT LOADER IDENTIFIER>} ON 
   bcdedit /store <VOLUME LETTER WHERE THE BCD FOLDER IS>:\boot\bcd /emssettings EMSPORT:1 EMSBAUDRATE:115200
   ```

1. Убедитесь, что размер свободного места на диске ОС превышает объем памяти (ОЗУ) этой виртуальной машины.

   Если места на диске ОС недостаточно, измените расположение создания для файла дампа памяти на любой подключенный к виртуальной машине диск данных, на котором достаточно свободного места. Чтобы изменить расположение, замените значение **%SystemRoot%** буквой нужного диска данных (например, **F:** ) в приведенных ниже командах.

   Рекомендуемая конфигурация для включения дампа ОС.

   **Загрузите куст реестра с поврежденного диска ОС.**

   ```
   REG LOAD HKLM\BROKENSYSTEM <VOLUME LETTER OF BROKEN OS DISK>:\windows\system32\config\SYSTEM
   ```

   **Включите сбор для ControlSet001**.

   ```
   REG ADD "HKLM\BROKENSYSTEM\ControlSet001\Control\CrashControl" /v CrashDumpEnabled /t REG_DWORD /d 1 /f 
   REG ADD "HKLM\BROKENSYSTEM\ControlSet001\Control\CrashControl" /v DumpFile /t REG_EXPAND_SZ /d "%SystemRoot%\MEMORY.DMP" /f 
   REG ADD "HKLM\BROKENSYSTEM\ControlSet001\Control\CrashControl" /v NMICrashDump /t REG_DWORD /d 1 /f 
   ```

   **Включите сбор для ControlSet002**.

   ```
   REG ADD "HKLM\BROKENSYSTEM\ControlSet002\Control\CrashControl" /v CrashDumpEnabled /t REG_DWORD /d 1 /f 
   REG ADD "HKLM\BROKENSYSTEM\ControlSet002\Control\CrashControl" /v DumpFile /t REG_EXPAND_SZ /d "%SystemRoot%\MEMORY.DMP" /f 
   REG ADD "HKLM\BROKENSYSTEM\ControlSet002\Control\CrashControl" /v NMICrashDump /t REG_DWORD /d 1 /f 
   ```

   **Выгрузите поврежденный диск ОС**.

   ```
   REG UNLOAD HKLM\BROKENSYSTEM
   ```
   
### <a name="rebuild-the-vm"></a>Перестроение виртуальной машины

Чтобы перестроить виртуальную машину, [выполните шаг 5 из списка команд для восстановления виртуальной машины](./repair-windows-vm-using-azure-virtual-machine-repair-commands.md#repair-process-example).
