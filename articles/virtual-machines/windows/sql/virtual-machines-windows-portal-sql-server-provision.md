---
title: Руководство по подготовке виртуальных машин SQL Server на платформе Windows на портале Azure | Документация Майкрософт
description: В этом руководстве описаны варианты создания виртуальных машин Windows SQL Server 2017 на портале Azure.
services: virtual-machines-windows
documentationcenter: na
author: MashaMSFT
manager: craigg
tags: azure-resource-manager
ms.assetid: 1aff691f-a40a-4de2-b6a0-def1384e086e
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: infrastructure-services
ms.date: 05/04/2018
ms.author: mathoma
ms.reviewer: jroth
ms.openlocfilehash: bb051d37f3a1dd82d7d46bfe8b22c2ba1251be85
ms.sourcegitcommit: c174d408a5522b58160e17a87d2b6ef4482a6694
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59259207"
---
# <a name="how-to-provision-a-windows-sql-server-virtual-machine-in-the-azure-portal"></a>Как подготовить виртуальную машину SQL Server на платформе Windows на портале Azure

В этом руководстве рассматриваются различные варианты, доступные при создании виртуальной машины SQL Server на платформе Windows на портале Azure. В этой статье рассматривается больше параметров конфигурации, чем в [кратком руководстве по виртуальным машинам SQL Server](quickstart-sql-vm-create-portal.md), и описывается одна возможная задача подготовки. 

Используйте это руководство, чтобы создать собственную виртуальную машину SQL Server. Его также можно использовать как справочник по параметрам, доступным на портале Azure.

> [!TIP]
> Если у вас есть вопросы по виртуальным машинам SQL Server, см. раздел [часто задаваемых вопросов](virtual-machines-windows-sql-server-iaas-faq.md).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a id="select"></a> Образы из коллекции виртуальных машин SQL Server

При создании виртуальной машины SQL Server можно выбрать один из нескольких предварительно настроенных образов, доступных в коллекции виртуальных машин. Ниже приведены инструкции по выбору одного из образов SQL Server 2017.

1. Войдите на [портал Azure](https://portal.azure.com) , используя свою учетную запись.

1. На портале Azure щелкните **Создать ресурс**. На портале откроется окно **Создать** .

1. В окне **Создать** щелкните **Вычисления** и выберите **See all** (Показать все).

1. В поле поиска введите **SQL Server 2017** и нажмите клавишу ВВОД.

1. В раскрывающемся списке фильтра, выберите _Windows Server 2016_ для **операционной системы** и выберите _Microsoft_ как **издателя**. 

     ![Окно "Новое вычисление"](./media/virtual-machines-windows-portal-sql-server-provision/azure-new-compute-blade.png)

1. Просмотрите доступные образы SQL Server. Каждый образ определяет версию SQL Server и операционную систему.

1. Выберите образ **Free SQL Server License: SQL Server 2017 Developer on Windows Server 2016** (Бесплатная лицензия на SQL Server: SQL Server 2017 Developer на базе Windows Server 2016).

   > [!TIP]
   > В этом пошаговом руководстве используется выпуск Developer, так как это полнофункциональный выпуск SQL Server, предоставляемый бесплатно для тестирования в процессе разработки. Вы оплачиваете только стоимость выполнения виртуальной машины. Но вы можете выбрать для использования в этом пошаговом руководстве любой образ. Описание доступных образов см. в разделе [Начало работы с виртуальными машинами SQL](virtual-machines-windows-sql-server-iaas-overview.md#payasyougo).

   > [!TIP]
   > Стоимость лицензий для SQL Server включена в цену секунды использования создаваемой виртуальной машины и зависит от выпуска и числа ядер. Тем не менее выпуск SQL Server Developer предоставляется бесплатно для разработки и тестирования (не для рабочей среды), а выпуск SQL Express предоставляется бесплатно для упрощенных рабочих нагрузок (требующих менее 1 ГБ памяти и 10 ГБ хранилища). Можно также использовать собственную лицензию (BYOL) и платить только за виртуальную машину. Имена таких образов содержат префикс {BYOL}. 
   >
   > Дополнительные сведения об этих параметрах см. в [руководстве по выбору ценовой категории для виртуальных машин Azure SQL Server](virtual-machines-windows-sql-server-pricing-guidance.md).

1. В разделе **Выбор модели развертывания** выберите **Resource Manager**. Для новых виртуальных машин рекомендуется использовать модель развертывания Resource Manager. 

1. Нажмите кнопку **Создать**.


## <a id="configure"></a> Параметры конфигурации

Есть несколько вкладок для настройки виртуальной машины с SQL Server. В данном руководстве мы сосредоточимся на следующее: 

| Шаг | ОПИСАНИЕ |
| --- | --- |
| **Основы** |[Настройка основных параметров](#1-configure-basic-settings) |
| **Дополнительные компоненты** |[Настройка дополнительных возможностей](#2-configure-optional-features) |
| **Параметры SQL Server** |[Настройка параметров SQL Server](#3-configure-sql-server-settings) |
| **Просмотр и создание** | [Просмотр сводки.](#4-review--create) |

## <a name="1-configure-basic-settings"></a>1. Настройка основных параметров.


На вкладке **Основные сведения** укажите следующую информацию.

* В разделе **сведения о проекте**, убедитесь, что выбрана правильная подписка. 
*  В **группы ресурсов** разделе выберите существующий ресурс в списке группу или выберите **создать** для создания новой группы ресурсов. Группа ресурсов — это коллекция связанных ресурсов в Azure (виртуальные машины, учетные записи хранения, виртуальные сети и т. д.). 

    ![Подписка](media/quickstart-sql-vm-create-portal/basics-project-details.png)

  > [!NOTE]
  > Рекомендуется использовать новую группу ресурсов для тестирования или изучения процесса развертывания SQL Server в Azure. После завершения теста удалите группу ресурсов, чтобы автоматически удалить виртуальную машину и все ресурсы, связанные с этой группой ресурсов. Дополнительные сведения о группах ресурсов см. в статье [Общие сведения об Azure Resource Manager](../../../azure-resource-manager/resource-group-overview.md).


* В разделе **Сведения об экземпляре**:
    1. Введите уникальное **имя виртуальной машины**.  
    1. Выберите расположение для параметра **Регион**. 
    1. В данном руководстве оставьте **параметры доступности** присвоено _избыточность инфраструктуры, не требуется_. Дополнительные сведения о параметрах доступности см. в статье [Регионы и доступность виртуальных машин в Azure](../../windows/regions-and-availability.md). 
    1. В списке **Образ** выберите _Free SQL Server License: SQL Server 2017 Developer on Windows Server 2016_ (Бесплатная лицензия на SQL Server: SQL Server 2017 Developer на базе Windows Server 2016).  
    1. Выберите **Изменить размер** для параметра **Размер** виртуальной машины, а затем выберите предложение **A2 Basic**. Обязательно очистите ресурсы после завершения работы с ними, чтобы предотвратить любые непредвиденные расходы. Для рабочих нагрузок изучите рекомендации по размерам машин SQL Server и их настройке в статье [Рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-performance.md).

    ![Подробности об экземпляре](media/quickstart-sql-vm-create-portal/basics-instance-details.png)

> [!IMPORTANT]
> В расчетную ежемесячную стоимость, указанную в окне **Выбор размера**, не включена стоимость лицензирования SQL Server. Это только стоимость виртуальной машины. Для выпусков SQL Server Express и Developer указана итоговая расчетная стоимость. Получить сведения о других выпусках можно на странице [цен на виртуальные машины Windows](https://azure.microsoft.com/pricing/details/virtual-machines/windows/), где вы можете выбрать целевой выпуск SQL Server. Также см. в разделе [выбору ценовой категории для виртуальных машин Azure SQL Server](virtual-machines-windows-sql-server-pricing-guidance.md) и [размеры виртуальных машин](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).

* В разделе **учетной записи администратора**, укажите имя пользователя и пароль. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../../windows/faq.md#what-are-the-password-requirements-when-creating-a-vm).

   ![Учетная запись администратора](media/quickstart-sql-vm-create-portal/basics-administrator-account.png)

* В разделе **Правила входящего порта** щелкните **Разрешить выбранные порты**, а затем выберите **RDP (3389)** из раскрывающегося списка. 

   ![Правила для входящих портов](media/quickstart-sql-vm-create-portal/basics-inbound-port-rules.png)


## <a name="2-configure-optional-features"></a>2. Настройка дополнительных возможностей

### <a name="disks"></a>диски;

На **дисков** вкладке, настроить параметры диска. 

* В разделе **тип диска ОС**, выберите тип диска, для своей операционной системы из раскрывающегося списка. Premium рекомендуется для производственных систем, но недоступен для простой виртуальной Машины. Чтобы использовать SSD уровня "премиум", измените размер виртуальной машины. 
* В разделе **Дополнительно**выберите **Да** под использование **управляемые диски**.

   > [!NOTE]
   > Корпорация Майкрософт рекомендует использовать управляемые диски для SQL Server. Управляемые диски управляют хранилищем в фоновом режиме. Кроме того, когда виртуальные машины с управляемыми дисками находятся в одной группе доступности, Azure распределяет ресурсы хранения, чтобы обеспечить соответствующую избыточность. Дополнительные сведения см. в [обзоре службы "Управляемые диски Azure"][../managed-disks-overview.md). Подробные сведения об управляемых дисков в группе доступности, см. в разделе [использование управляемых дисков для виртуальных машин в группе доступности] (.. /Manage-Availability.md.

![Параметры диска виртуальной Машины SQL](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-disks.png)
  
  
### <a name="networking"></a>Сеть

На **сети** вкладке, настроить параметры сети. 

* Создайте новый **виртуальной сети**, или использовать существующую виртуальную сеть для виртуальной Машины SQL Server. Назначить **подсети** также. 

* В разделе **группы безопасности для сетевого Адаптера**, выберите группу безопасности или группе повышенной безопасности. С параметром «базовый» можно выбрать входящие порты для виртуальной Машины SQL Server (те же значения, которые были настроены на **основные** вкладке). Выбор параметра "Дополнительно" позволяет выбрать существующую группу безопасности сети, или создайте новую. 

* Вы можете изменить другие параметры сети или оставить их значения по умолчанию.

![Параметры сети виртуальной Машины SQL](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-networking.png)

#### <a name="monitoring"></a>Мониторинг

На **мониторинг** вкладке, настройки, мониторинга и автоматического завершения работы. 

* Microsoft Azure позволяют **мониторинга загрузки** по умолчанию с одной учетной записи, назначенный для виртуальной Машины. Вы можете изменить эти параметры здесь, а также включение **операционной системы на виртуальной машине диагностики**. 
* Вы можете включить **назначаемое системой управляемого удостоверения** и **автоматического завершения работы** на этой вкладке также. 

![Параметры управления виртуальной Машины SQL](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-management.png)


## <a name="3-configure-sql-server-settings"></a>3. Настройка параметров SQL Server

На **параметры SQL Server** вкладке, настройте нужные параметры и оптимизацию для SQL Server. Ниже приведены параметры, которые можно настроить для SQL Server:



| Параметр |
| --- |
| [Соединение](#connectivity) |
| [Проверка подлинности](#authentication) |
| [Интеграция с хранилищем ключей Azure](#azure-key-vault-integration) |
| [Конфигурация хранилища](#storage-configuration) |
| [Автоматическое исправление](#automated-patching) |
| [Автоматическая архивация](#automated-backup) |
| [Службы R (Advanced Analytics)](#r-services-advanced-analytics) |


### <a name="connectivity"></a>Соединение

В разделе **Подключение SQL**укажите необходимый тип доступа к экземпляру SQL Server на этой виртуальной машине. В рамках этого пошагового руководства выберите **Общедоступный (Интернет)** для подключения к SQL Server с компьютеров или из служб в Интернете. Этот параметр выбран Azure автоматически настраивает брандмауэр и группу безопасности сети, чтобы разрешить трафик через порт, который выбран.

> [!TIP]
> По умолчанию сервер SQL Server ожидает передачи данных через стандартный порт **1433**. Для повышения безопасности измените порт в предыдущем диалоговом окне, чтобы ожидать передачи данных через нестандартный порт, например 1401. После изменения порта необходимо выполнить подключение, используя этот порт, с помощью любого клиентского инструмента, например SSMS.

![Защита виртуальных Машин SQL](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-security.png)

Чтобы подключиться к SQL Server через Интернет, также необходимо включить проверку подлинности SQL Server, как описано в следующем разделе.

Если вы не хотите включать подключения к ядру СУБД через Интернет, выберите один из следующих вариантов:

* **Локальное (только в виртуальной машине)** — для подключения к SQL Server только в пределах самой виртуальной машины.
* **Частное (в виртуальной сети)** — для подключения к SQL Server с машин или из служб в той же виртуальной сети.

Как правило, чтобы повысить уровень безопасности, необходимо выбрать наиболее подходящий тип подключения для выполнения вашего сценария. Но все параметры можно защитить с помощью правил группы безопасности сети и проверки подлинности Windows или SQL. Вы можете изменить группу безопасности сети после создания виртуальной машины. Дополнительные сведения см. в статье [Вопросы безопасности SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-security.md).



### <a name="authentication"></a>Authentication

Если требуется проверка подлинности SQL Server, выберите для параметра **Включить** under **Включить**.

![Проверка подлинности SQL Server](./media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-authentication.png)

> [!NOTE]
> Если вы планируете предоставить доступ к SQL Server через Интернет (т. е. включаете параметр общедоступного подключения), включите аутентификацию SQL здесь. Для общего доступа к SQL Server необходимо использовать проверку подлинности SQL.

Если вы включаете проверку подлинности SQL Server, укажите **имя для входа** и **пароль**. Это имя входа настраивается как имя входа проверки подлинности SQL Server и членом **sysadmin** предопределенной роли сервера. Дополнительные сведения о режимах проверки подлинности см. в [этой статье](https://docs.microsoft.com/sql/relational-databases/security/choose-an-authentication-mode).

Если проверка подлинности SQL Server не включена, подключиться к экземпляру SQL Server можно с помощью локальной учетной записи администратора на виртуальной машине.

![Проверка подлинности SQL Server](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-authentication.png)

### <a name="azure-key-vault-integration"></a>Интеграция с хранилищем ключей Azure

Чтобы хранить в Azure секреты безопасности для шифрования, щелкните **Интеграция хранилища ключей Azure** и выберите значение **Включить**.

![Интеграция с хранилищем ключей Azure](media/virtual-machines-windows-ps-sql-keyvault/azure-sql-arm-akv.png)

В следующей таблице перечислены параметры, необходимые для настройки интеграции с хранилищем ключей Azure.

| ПАРАМЕТР | Описание | ПРИМЕР |
| --- | --- | --- |
| **URL-адрес хранилища ключей** |Расположение хранилища ключей. |https:\//contosokeyvault.vault.azure.net/ |
| **Имя субъекта** |Имя субъекта-службы Azure Active Directory. Этот имя также называется идентификатором клиента. |fde2b411-33d5-4e11-af04eb07b669ccf2 |
| **Секрет субъекта** |Секрет субъекта-службы Azure Active Directory. Этот секрет также называется секретом клиента. |9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM= |
| **Имя учетных данных** |**Учетное имя**. Интеграция AKV создает учетные данные в рамках SQL Server, с помощью которых VM будет получать доступ к хранилищу ключей. Выберите имя для этих учетных данных. |mycred1 |

Дополнительные сведения см. в статье [Настройка интеграции хранилища ключей Azure для SQL Server на виртуальных машинах Azure (Resource Manager)](virtual-machines-windows-ps-sql-keyvault.md).

### <a name="storage-configuration"></a>Конфигурация хранилища

В разделе **конфигурации хранилища**выберите **изменение конфигурации** для указания требований к хранилищу.


> [!NOTE]
> Если вы вручную настроили виртуальную машину для использования стандартного хранилища, этот параметр недоступен. Автоматическая оптимизация доступна только для хранилища класса Premium.

> [!TIP]
> Число делений и верхний предел каждого ползунка зависит от выбранного размера виртуальной машины. Чем крупнее и мощнее виртуальная машина, тем больше возможностей увеличения масштаба.

Вы можете указать такие требования, как количество операций ввода-вывода в секунду (IOPs), пропускная способность в МБ/с и общий размер хранилища. Настройте эти значения на скользящих шкалах. Вы можете изменить эти параметры хранилища в зависимости от рабочей нагрузки. На основании этих требований портал автоматически вычисляет количество дисков для установки и настройки.

В разделе **Storage optimized for**(Оптимизация хранилища) выберите один из следующих вариантов.

* **Общая** — это значение по умолчанию, которое поддерживает большинство рабочих нагрузок.
* **Транзакционная** обработка оптимизирует хранилище для рабочих нагрузок OLTP в традиционных базах данных.
* **Хранилище данных** оптимизирует хранилище для рабочих нагрузок аналитики и отчетов.

![Конфигурация хранилища виртуальной Машины SQL](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-storage-configuration.png)

### <a name="sql-server-license"></a>Лицензия SQL Server
Если вы являетесь участником программы Software Assurance, вы можете использовать [Преимущество гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-benefit/) использовать собственную лицензию SQL Server и сохранение на ресурсы. 

![Лицензии виртуальной Машины SQL](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-license.png)

### <a name="automated-patching"></a>Автоматическое исправление

**Automated patching** включен по умолчанию. Автоматическая установка исправлений позволяет Azure автоматически исправлять SQL Server и операционную систему. Укажите день недели, время и длительность периода обслуживания. Azure устанавливает исправления в период обслуживания. Расписание периода обслуживания использует для определения времени региональные параметры VM. Если вы не хотите, чтобы платформа Azure автоматически устанавливала исправления для SQL Server и операционной системы, выберите вариант **Отключить**.  

![Виртуальная машина SQL автоматическая установка исправлений](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-automated-patching.png)

Дополнительные сведения см. в статье [Автоматическая установка исправлений SQL Server на виртуальных машинах Azure (Resource Manager)](virtual-machines-windows-sql-automated-patching.md).

### <a name="automated-backup"></a>Автоматическая архивация

Включите автоматическую архивацию для всех баз данных в разделе **Автоматическая архивация**. По умолчанию автоматическая архивация отключена.

Во время включения автоматического резервного копирования SQL можно настроить следующие параметры:

* срок хранения (в днях) для резервных копий;
* учетная запись хранения, используемая для резервных копий;
* параметр шифрования и пароль для резервных копий.
* архивация системных баз данных;
* настройка расписания архивации баз данных.

Для шифрования резервной копии щелкните **Включить**. Затем введите **пароль**. Azure создает сертификат для шифрования резервных копий и использует указанный пароль для защиты этого сертификата.

Дополнительную информацию см. в статье [Автоматическая архивация SQL Server на виртуальных машинах Azure (Resource Manager)](virtual-machines-windows-sql-automated-backup.md).


### <a name="r-services-advanced-analytics"></a>Службы R (Advanced Analytics)

У вас есть возможность включить [SQL Server R Services (расширенная аналитика)](/sql/advanced-analytics/r/sql-server-r-services/). Этот параметр позволяет использовать в SQL Server 2017 расширенные средства аналитики. Щелкните **Включить** в окне **SQL Server Settings**.


## <a name="4-review--create"></a>4. Отзыв и создание

На вкладке **Отзыв и создание** просмотрите сводные данные и выберите **Создать**, чтобы создать SQL Server, группу ресурсов и ресурсы, указанные для этой виртуальной машины.

Развертывание можно отслеживать на портале Azure. Если нажать кнопку **Уведомления** в верхней части окна, будут показаны основные сведения о состоянии развертывания.

> [!NOTE]
> Чтобы предоставить вам сведения о времени, необходимом для выполнения развертывания, в нашем сценарии виртуальная машина SQL была развернута в восточной части США с параметрами по умолчанию. На выполнение тестового развертывания требуется около 12 минут. Время развертывания зависит от региона и выбранных параметров.

## <a id="remotedesktop"></a> Открытие виртуальных машин с помощью удаленного рабочего стола

Выполните следующие действия, чтобы подключиться к виртуальной машине SQL Server через удаленный рабочий стол.

[!INCLUDE [Connect to SQL Server VM with remote desktop](../../../../includes/virtual-machines-sql-server-remote-desktop-connect.md)]

После подключения к виртуальной машине SQL Server вы можете запустить SQL Server Management Studio и подключиться с проверкой подлинности Windows, используя свои учетные данные локального администратора. Если включена проверка подлинности SQL Server, можно также подключиться с проверкой подлинности SQL, используя имя пользователя и пароль SQL, настроенные во время подготовки.

Доступ к машине позволяет напрямую изменять настройки компьютера и SQL Server в зависимости от ваших требований. Например, можно настроить параметры брандмауэра или изменить параметры конфигурации SQL Server.

## <a id="connect"></a> Удаленное подключение к SQL Server

В рамках этого пошагового руководства для виртуальной машины используется **открытый** доступ и **аутентификация SQL Server**. Эти параметры позволяют автоматически настроить виртуальную машину для получения доступа к экземпляру SQL Server из любого клиента через Интернет (при условии, что будет использоваться правильное имя пользователя SQL).

> [!NOTE]
> Если вы не выбрали открытый доступ во время подготовки, можно изменить параметры подключения к SQL на портале после подготовки. Дополнительные сведения см. в разделе [об изменении параметров подключения SQL](virtual-machines-windows-sql-connect.md#change).

В следующих разделах описано, как подключиться к вашему экземпляру виртуальной машины SQL Server через Интернет.

[!INCLUDE [Connect to SQL Server in a VM Resource Manager](../../../../includes/virtual-machines-sql-server-connection-steps-resource-manager.md)]

  > [!NOTE]
  > В этом примере используется общий порт 1433. Тем не менее это значение нужно будет вносить изменения, если был указан другой порт (например 1401) во время развертывания виртуальной Машины SQL Server. 


## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об использовании SQL Server в Azure см. в статье [Приступая к работе с SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-overview.md) и [Часто задаваемые вопросы об SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-faq.md).