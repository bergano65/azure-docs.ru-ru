---
title: Учебник. Мониторинг виртуальных машин Windows в Azure | Документация Майкрософт
description: Из этого учебника вы узнаете, как отслеживать производительность и обнаруживать компоненты приложений, работающих на виртуальных машинах Windows.
services: virtual-machines-windows
documentationcenter: virtual-machines
author: mgoedtel
manager: carmonm
editor: ''
tags: azure-resource-manager
ms.assetid: ''
ms.service: virtual-machines-windows
ms.topic: tutorial
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure
ms.date: 09/27/2018
ms.author: magoedte
ms.custom: mvc
ms.openlocfilehash: a2f4083841c801db3edf1b2838b8d3271b700731
ms.sourcegitcommit: 5f0f1accf4b03629fcb5a371d9355a99d54c5a7e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/30/2019
ms.locfileid: "71679344"
---
# <a name="tutorial-monitor-a-windows-virtual-machine-in-azure"></a>Руководство по Мониторинг виртуальной машины Windows в Azure

Служба мониторинга Azure использует агенты для сбора данных о производительности и загрузке с виртуальных машин Azure, сохраняет эти данные в хранилище Azure и предоставляет к ним доступ через портал, модуль Azure PowerShell и Azure CLI. Расширенный мониторинг осуществляется с помощью решения "Azure Monitor для виртуальных машин" путем сбора метрик производительности, обнаружения компонентов приложений, установленных на виртуальных машинах, и включает в себя таблицы производительности и карту зависимостей.

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Включение диагностики загрузки на виртуальной машине
> * Просмотр диагностики загрузки
> * Просмотр метрик узла виртуальной машины
> * Включение Azure Monitor для виртуальных машин
> * Просмотр метрик производительности виртуальной машины
> * Создание оповещения

## <a name="launch-azure-cloud-shell"></a>Запуск Azure Cloud Shell

Azure Cloud Shell — это бесплатная интерактивная оболочка, с помощью которой можно выполнять действия, описанные в этой статье. Она включает предварительно установленные общие инструменты Azure и настроена для использования с вашей учетной записью. 

Чтобы открыть Cloud Shell, просто выберите **Попробовать** в правом верхнем углу блока кода. Cloud Shell можно также запустить в отдельной вкладке браузера, перейдя на страницу [https://shell.azure.com/powershell](https://shell.azure.com/powershell). Нажмите кнопку **Копировать**, чтобы скопировать блоки кода. Вставьте код в Cloud Shell и нажмите клавишу "ВВОД", чтобы выполнить его.

## <a name="create-virtual-machine"></a>Создание виртуальной машины

Чтобы настроить мониторинг Azure и администрировать обновления для работы с этим руководством, вам понадобится виртуальная машина Windows в Azure. Сначала укажите имя и пароль администратора для виртуальной машины с помощью командлета [Get-Credential](https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.security/Get-Credential):

```azurepowershell-interactive
$cred = Get-Credential
```

Теперь создайте виртуальную машину с помощью команды [New-AzVM](https://docs.microsoft.com/powershell/module/az.compute/new-azvm). В следующем примере создается виртуальная машина с именем *myVM* в расположении *EastUS*. При необходимости будут созданы поддерживающие сетевые ресурсы и группа доступности *myResourceGroupMonitorMonitor*.

```azurepowershell-interactive
New-AzVm `
    -ResourceGroupName "myResourceGroupMonitor" `
    -Name "myVM" `
    -Location "East US" `
    -Credential $cred
```

Создание этих ресурсов и виртуальной машины может занять несколько минут.

## <a name="view-boot-diagnostics"></a>Просмотр диагностики загрузки

При загрузке виртуальных машин Windows агент диагностики загрузки записывает выходные данные на экране, которые можно использовать в целях устранения неполадок. Эта возможность включена по умолчанию. Записанные снимки экрана сохраняются в учетной записи хранения Azure, которая также создается по умолчанию.

Данные диагностики загрузки можно получить с помощью команды [Get AzureRmVMBootDiagnosticsData](https://docs.microsoft.com/powershell/module/az.compute/get-azvmbootdiagnosticsdata). В следующем примере данные диагностики загрузки загружаются в корень диска *c:\*.

```powershell
Get-AzVMBootDiagnosticsData -ResourceGroupName "myResourceGroupMonitor" -Name "myVM" -Windows -LocalPath "c:\"
```

## <a name="view-host-metrics"></a>Просмотр метрик узла.

Виртуальная машина Windows имеет выделенный узел виртуальной машины в Azure, с которым она взаимодействует. Метрики узла собираются автоматически, и их можно просмотреть на портале Azure.

1. На портале Azure щелкните **Группы ресурсов**, выберите **myResourceGroupMonitor**, а затем в списке ресурсов выберите **myVM**.
2. Чтобы просмотреть данные о производительности узла виртуальной машины, в колонке виртуальной машины щелкните **Метрики**, а затем выберите любую метрику узла в группе **Доступные метрики**.

    ![Просмотр метрик узла.](./media/tutorial-monitoring/tutorial-monitor-host-metrics.png)

## <a name="enable-advanced-monitoring"></a>Включение расширенного мониторинга

Чтобы включить мониторинг виртуальной машины Azure с помощью решения "Azure Monitor для виртуальных машин", выполните следующие действия:

1. На портале Azure щелкните **Группы ресурсов**, выберите **myResourceGroupMonitor**, а затем в списке ресурсов выберите **myVM**.

2. На странице виртуальной машины в разделе **Мониторинг** выберите **Аналитические сведения (предварительная версия)** .

3. На странице **Аналитические сведения (предварительная версия)** выберите **Попробовать**.

    ![Включение Azure Monitor для виртуальной машины](../../azure-monitor/insights/media/vminsights-enable-single-vm/enable-vminsights-vm-portal-01.png)

4. Если имеющаяся рабочая область Log Analytics расположена в той же подписке, что и кластер, выберите ее из раскрывающегося списка на странице **Azure Monitor Insights Onboarding** (Подключение к службе аналитических сведений Azure Monitor).  

    В списке предварительно выбрана рабочая область по умолчанию и место развертывания виртуальной машины в подписке. 

    >[!NOTE]
    >Чтобы создать новую рабочую область Log Analytics для хранения данных мониторинга с виртуальной машины, см. руководство по [созданию рабочей области Log Analytics](../../azure-monitor/learn/quick-create-workspace.md). Ваша рабочая область Log Analytics должна находиться в одном из [поддерживаемых регионов](../../azure-monitor/insights/vminsights-enable-overview.md#log-analytics).

После включения мониторинга может потребоваться подождать несколько минут, прежде чем можно будет просмотреть метрики производительности виртуальной машины.

![Включение Azure Monitor для обработки развертывания мониторинга виртуальных машин](../../azure-monitor/insights/media/vminsights-enable-single-vm/onboard-vminsights-vm-portal-status.png)

## <a name="view-vm-performance-metrics"></a>Просмотр метрик производительности виртуальной машины

Служба Azure Monitor для виртуальных машин включает в себя набор диаграмм производительности, ориентированных на несколько ключевых показателей эффективности (KPI), которые помогают определить, насколько эффективно работает виртуальная машина. Чтобы получить доступ со своей виртуальной машины, выполните указанные ниже действия.

1. На портале Azure щелкните **Группы ресурсов**, выберите **myResourceGroupMonitor**, а затем в списке ресурсов выберите **myVM**.

2. На странице виртуальной машины в разделе **Мониторинг** выберите **Аналитические сведения (предварительная версия)** .

3. Выберите вкладку **Производительность**.

Эта страница содержит не только диаграммы использования производительности, но и таблицу с отображением каждого обнаруженного логического диска, его емкости, использования и общего среднего значения по каждому показателю.

## <a name="create-alerts"></a>Создание оповещений

На основе метрик производительности можно создавать оповещения. Например, оповещения можно использовать для уведомления о том, что средняя загрузка ЦП превышает пороговое значение или свободное место на диске ниже определенного значения. Оповещения отображаются на портале Azure или могут быть отправлены по электронной почте. Вы также можете активировать модули Runbook службы автоматизации Azure или Azure Logic Apps в ответ на создаваемые оповещения.

В следующем примере создается предупреждение на основе среднего показателя использования ЦП.

1. На портале Azure щелкните **Группы ресурсов**, выберите **myResourceGroupMonitor**, а затем в списке ресурсов выберите **myVM**.

2. В колонке виртуальной машины щелкните **Правила оповещения**, а затем выберите **Добавить оповещение метрики**.

3. Укажите **имя** оповещения, например *myAlertRule*.

4. Для активации оповещения о превышении процента использования ЦП на 1.0 в течение пяти минут оставьте все настройки по умолчанию.

5. При необходимости установите флажок возле параметра *Участники, читатели и владельцы электронной почты* для отправки уведомлений по электронной почте. Действие по умолчанию — предоставлять уведомления на портале.

6. Нажмите кнопку **ОК**.

## <a name="next-steps"></a>Дополнительная информация

В этом учебнике вы настроили и просмотрели метрики производительности виртуальной машины. Вы научились выполнять следующие задачи:

> [!div class="checklist"]
> * Создание группы ресурсов и виртуальной машины
> * Включение диагностики загрузки на виртуальной машине
> * Просмотр диагностики загрузки
> * Просмотр метрик узла.
> * Включение Azure Monitor для виртуальных машин
> * Просмотр метрик виртуальной машины.
> * Создание оповещения

Перейдите к следующему руководству, чтобы узнать о центре безопасности Azure.

> [!div class="nextstepaction"]
> [Мониторинг защиты виртуальных машин с помощью центра безопасности Azure](../../security/fundamentals/overview.md)
