---
title: Проблемы с использованием расширений виртуальной машины в системах на виртуальных машинах Linux с поддержкой Python 3
description: Сведения об использовании расширений виртуальных машин в системах Linux с поддержкой Python 3
services: virtual-machines-windows
documentationcenter: ''
author: v-miegge
ms.author: jparrel
manager: dcscontentpm
editor: ''
tags: top-support-issue,azure-resource-manager
ms.service: virtual-machines-windows
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure-services
ms.date: 08/25/2020
ms.assetid: 3cd520fd-eaf7-4ef9-b4d3-4827057e5028
ms.openlocfilehash: 15ece836e172b8316222ea606ca638650795d5d7
ms.sourcegitcommit: b33c9ad17598d7e4d66fe11d511daa78b4b8b330
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/25/2020
ms.locfileid: "88852593"
---
# <a name="issues-using-vm-extensions-in-python-3-enabled-linux-azure-virtual-machines-systems"></a>Проблемы с использованием расширений виртуальной машины в системах на виртуальных машинах Linux с поддержкой Python 3

> [!NOTE]
> Корпорация Майкрософт рекомендует пользователям внедрять **Python 3. x** в свои системы, если для рабочей нагрузки не требуется поддержка **Python 2. x** . К примерам этого требования могут относиться устаревшие сценарии администрирования или расширения, такие как **Шифрование дисков Azure** и **Azure Monitor**.
>
> Перед установкой **Python 2. x** в рабочей среде рассмотрите вопрос долгосрочной поддержки Python 2. x, в частности их возможности получения обновлений для системы безопасности. Как продукты, включая некоторые из упомянутых расширений, обновляются с поддержкой **python 3,8** , следует прекратить использование Python 2. x.

Некоторые дистрибутивы Linux перешли на Python 3,8 и удалили устаревшую `/usr/bin/python` точку входа для Python. Этот переход влияет на встроенное автоматизированное развертывание определенных расширений виртуальной машины с помощью следующих двух условий:

- Расширения, которые все еще переходят в поддержку Python 3. x
- Расширения, использующие устаревшую `/usr/bin/python` точку входа

Пользователи дистрибутива Linux, которые перешли на **Python 3. x** , должны убедиться в наличии устаревшей `/usr/bin/python` точки входа, прежде чем пытаться развернуть эти расширения на их виртуальных машинах. В противном случае развертывание расширения может завершиться ошибкой. 

- Рекомендуемые дистрибутивы Linux, которые затрагиваются, включают **Ubuntu Server 20,04 LTS** и **Ubuntu Pro 20,04 LTS**.

- К затронутым расширениям виртуальных машин относится **Шифрование дисков Azure**, **log Analytics**, **доступ к виртуальной машине** (используется для сброса пароля) и **Диагностика гостей** (используется для дополнительных счетчиков производительности).

Обновления на месте, например обновление с **ubuntu 18,04 LTS** до **Ubuntu 20,04 LTS**, должны сохранять `/usr/bin/python` символьную ссылку и остаться без изменений.

## <a name="resolution"></a>Решение

Рассмотрите эти общие рекомендации перед развертыванием расширений в сценариях, которые описаны ранее в сводке.

1. Перед развертыванием расширения возобновите `/usr/bin/python` символьную ссылку с помощью предоставляемого поставщиком дистрибутива Linux метода.

   - Например, для **Python 2,7**используйте: `sudo apt update && sudo apt install python-is-python2`

1. Эта рекомендация предназначена для клиентов Azure и не поддерживается в Azure Stack:

   - Если вы уже развернули экземпляр, в котором возникла эта проблема, используйте функцию запуска команды в колонке виртуальной машины для выполнения указанных выше команд. Переход на Python 3,8 не влияет на само расширение выполнения команды.

1. Если вы развертываете новый экземпляр и вам нужно задать расширение во время подготовки, используйте пользовательские данные **Cloud-init** для установки пакетов, упомянутых выше.

   Например, для Python 2,7:

   ```python
   # create cloud-init config
   cat > cloudinitConfig.json <<EOF
   #cloud-config
   package_update: true
    
   runcmd:
   - sudo apt update
   - sudo apt install python-is-python2 
   EOF

   # create VM
   az vm create \
       --resource-group <resourceGroupName> \
       --name <vmName> \
       --image <Ubuntu 20.04 Image URN> \
       --admin-username azadmin \
       --ssh-key-value "<sshPubKey>" \
       --custom-data ./cloudinitConfig.json
   ```

1. Если администраторы политики Организации определяют, что расширения не должны развертываться на виртуальных машинах, можно отключить поддержку расширения во время подготовки.

   - REST API

     Отключение и Включение расширений при развертывании виртуальной машины с помощью этого свойства:

     ```python
       "osProfile": {
         "allowExtensionOperations": false
       },
     ```

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. в [других базовых изменениях базовой системы, начиная с 18,04 LTS-Python 3 по умолчанию](https://wiki.ubuntu.com/FocalFossa/ReleaseNotes#Python3_by_default) .
