---
title: Развертывание решения для самостоятельного управления 3,11 платформой OpenShift Container в Azure | Документация Майкрософт
description: Развертывание OpenShift контейнера Platform 3,11 с самостоятельно управляемым предложением Marketplace в Azure.
services: virtual-machines-linux
documentationcenter: virtual-machines
author: haroldwongms
manager: mdotson
editor: ''
tags: azure-resource-manager
ms.assetid: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 10/14/2019
ms.author: haroldw
ms.openlocfilehash: d5028ff6378fec5939aee3218071fe6f4eb1e843
ms.sourcegitcommit: b050c7e5133badd131e46cab144dd5860ae8a98e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2019
ms.locfileid: "72791616"
---
# <a name="configure-prerequisites"></a>Настройка необходимых компонентов

Прежде чем использовать предложение Marketplace для развертывания самостоятельно управляемого кластера OpenShift контейнеров 3,11 в Azure, необходимо настроить несколько предварительных требований.  Инструкции по созданию ключа SSH (без парольной фразы), хранилища ключей Azure, секрета хранилища ключей и субъекта-службы см. в статье [Предварительные требования OpenShift](https://docs.microsoft.com/azure/virtual-machines/linux/openshift-container-platform-3x-prerequisites) .

 
## <a name="deploy-using-the-marketplace-offer"></a>Развертывание с помощью предложения Marketplace

Самый простой способ развертывания самостоятельно управляемого кластера OpenShift контейнеров 3,11 в Azure — использовать [предложение Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/redhat.openshift-container-platform?tab=Overview).

Этот параметр является простейшим, но он также имеет ограниченные возможности настройки. Предложение Marketplace развертывает платформу OpenShift Container 3.11.82 и включает следующие параметры конфигурации:

- **Master Nodes** (Главные узлы): три главных узла, для которых можно указать тип экземпляра.
- **Infra Nodes** (Узлы Infra): три узла Infra, для которых можно указать тип экземпляра.
- **Nodes**: количество узлов (от 1 до 9) и тип экземпляра можно настроить.
- **Disk Type** (Тип диска): используются Управляемые диски.
- **Сети**: поддержка новой или существующей сети и настраиваемого диапазона CIDR.
- **CNS**: позволяет включить CNS.
- **Метрики**. метрики хавкулар можно включить.
- **Ведение журнала**. ведение журнала ЕФК можно включить.
- **Поставщик облачных служб Azure**: включен по умолчанию, может быть отключен.

В левом верхнем углу портал Azure щелкните **создать ресурс**, введите в поле поиска "платформа контейнера openshift" и нажмите клавишу ВВОД.

   ![Новый поиск ресурсов](media/openshift-marketplace-self-managed/ocp-search.png)  
<br>

Откроется страница результатов с **самоуправляемой платформой OpenShift контейнера Red Hat 3,11** в списке. 

   ![Новый результат поиска ресурсов](media/openshift-marketplace-self-managed/ocp-searchresult.png)  
<br>

Щелкните предложение, чтобы просмотреть сведения о предложении. Чтобы развернуть это предложение, нажмите кнопку **создать**. Появится пользовательский интерфейс для ввода необходимых параметров. Первый экран — колонка " **основные** ".

   ![Страница "название предложения"](media/openshift-marketplace-self-managed/ocp-titlepage.png)  
<br>

**Основы**

Чтобы получить справку по любому из входных параметров, наведите указатель мыши на элемент ***i*** рядом с именем параметра.

Введите значения входных параметров и нажмите кнопку **ОК**.

| Входной параметр | Описание параметра |
|-----------------------|-----------------|
| Имя пользователя администратора виртуальной машины | Пользователь с правами администратора, который будет создан на всех экземплярах виртуальных машин |
| Открытый ключ SSH для пользователя с правами администратора | Открытый ключ SSH, используемый для входа на виртуальную машину, не должен иметь парольную фразу |
| Subscription | Подписка Azure для развертывания кластера |
| Группа ресурсов | Создайте новую группу ресурсов или выберите существующую пустую группу ресурсов для ресурсов кластера. |
| Location | Регион Azure для развертывания кластера |

   ![Колонка основы предложения](media/openshift-marketplace-self-managed/ocp-basics.png)  
<br>

**Параметры инфраструктуры**

Введите значения входных параметров и нажмите кнопку **ОК**.

| Входной параметр | Описание параметра |
|-----------------------|-----------------|
| Префикс имени кластера OCP | Префикс кластера, используемый для настройки имен узлов для всех узлов. От 1 до 20 символов |
| Размер главного узла | Примите Размер виртуальной машины по умолчанию или щелкните **изменить размер** , чтобы выбрать другой размер виртуальной машины.  Выбор подходящего размера виртуальной машины для рабочей нагрузки |
| Размер узла инфраструктуры | Примите Размер виртуальной машины по умолчанию или щелкните **изменить размер** , чтобы выбрать другой размер виртуальной машины.  Выбор подходящего размера виртуальной машины для рабочей нагрузки |
| Число узлов приложений | Примите Размер виртуальной машины по умолчанию или щелкните **изменить размер** , чтобы выбрать другой размер виртуальной машины.  Выбор подходящего размера виртуальной машины для рабочей нагрузки |
| Размер узла приложения | Примите Размер виртуальной машины по умолчанию или щелкните **изменить размер** , чтобы выбрать другой размер виртуальной машины.  Выбор подходящего размера виртуальной машины для рабочей нагрузки |
| Размер узла бастиона | Примите Размер виртуальной машины по умолчанию или щелкните **изменить размер** , чтобы выбрать другой размер виртуальной машины.  Выбор подходящего размера виртуальной машины для рабочей нагрузки |
| Новая или Существующая виртуальная сеть | Создание новой виртуальной сети (по умолчанию) или использование существующей виртуальной сети |
| Выбор параметров CIDR по умолчанию или Настройка диапазона IP-адресов (CIDR) | Примите значения в диапазоне CIDR по умолчанию или выберите **Пользовательский диапазон IP-адресов** и введите пользовательские сведения CIDR.  Параметры по умолчанию будут создавать виртуальную сеть с CIDR в качестве значения 10.0.0.0/14, главной подсети с 10.1.0.0/16, подсетью 10.2.0.0/16, а также COMPUTE и CNS Subnet с 10.3.0.0/16. |
| Имя группы ресурсов Key Vault | Имя группы ресурсов, которая содержит Key Vault |
| Имя хранилища ключей | Имя Key Vault, содержащее секретный код с закрытым ключом SSH.  Разрешается использовать только буквы, цифры и дефисы, а их длина должна составлять от 3 до 24 символов. |
| Имя секрета | Имя секрета, содержащего закрытый ключ SSH.  Допускаются только буквенно-цифровые символы и тире. |

   ![Колонка "инфраструктура предложений"](media/openshift-marketplace-self-managed/ocp-inframain.png)  
<br>

**Изменить размер**

Чтобы выбрать другой размер виртуальной машины, нажмите кнопку ***изменить размер***.  Откроется окно выбора виртуальной машины.  Выберите нужный размер виртуальной машины и нажмите кнопку **выбрать**.

   ![Выбор размера виртуальной машины](media/openshift-marketplace-self-managed/ocp-selectvmsize.png)  
<br>

**Существующая виртуальная сеть**

| Входной параметр | Описание параметра |
|-----------------------|-----------------|
| Имя существующей виртуальной сети | Имя существующей виртуальной сети |
| Имя подсети для главных узлов | Имя существующей подсети для главных узлов.  Должен содержать не менее 16 IP-адресов и следовать RFC 1918 |
| Имя подсети для узлов | Имя существующей подсети для кластерных узлов.  Должен содержать по крайней мере 32 IP-адресов и следовать RFC 1918 |
| Имя подсети для узлов COMPUTE и CNS | Имя существующей подсети для узлов COMPUTE и CNS.  Должен содержать по крайней мере 32 IP-адресов и следовать RFC 1918 |
| Группа ресурсов для существующей виртуальной сети | Имя группы ресурсов, которая содержит существующую виртуальную сеть |

   ![Инфраструктура предложений существующей виртуальной сети](media/openshift-marketplace-self-managed/ocp-existingvnet.png)  
<br>

**Диапазон настраиваемых IP-адресов**

| Входной параметр | Описание параметра |
|-----------------------|-----------------|
| Диапазон адресов для виртуальной сети | Настраиваемая CIDR для виртуальной сети |
| Диапазон адресов для подсети, содержащей главные узлы | Настраиваемая CIDR для основной подсети |
| Диапазон адресов для подсети, содержащей узлы инфраструктуры | Настраиваемая CIDR для подсети инфраструктуры |
| Диапазон адресов для подсети, содержащей узлы COMPUTE и CNS | Настраиваемый CIDR для узлов COMPUTE и CNS |

   ![Диапазон настраиваемых IP-адресов инфраструктуры предложений](media/openshift-marketplace-self-managed/ocp-customiprange.png)  
<br>

**Платформа OpenShift Container 3,11**

Введите значения входных параметров и нажмите кнопку **ОК** .

| Входной параметр | Описание параметра |
|-----------------------|-----------------|
| Пароль администратора OpenShift | Пароль для первоначального пользователя OpenShift.  Этот пользователь также будет администратором кластера. |
| Подтвердите пароль администратора OpenShift | Введите пароль администратора OpenShift. |
| Имя пользователя диспетчера подписки Red Hat | Имя пользователя для доступа к подписке Red Hat или ИДЕНТИФИКАТОРу Организации.  Эти учетные данные используются для регистрации экземпляра RHEL в подписке и не будут храниться корпорацией Майкрософт или Red Hat. |
| Пароль пользователя диспетчера подписки Red Hat | Пароль для доступа к подписке Red Hat или ключу активации.  Эти учетные данные используются для регистрации экземпляра RHEL в подписке и не будут храниться корпорацией Майкрософт или Red Hat. |
| Идентификатор пула OpenShift диспетчера подписки Red Hat | Идентификатор пула, который содержит права на использование платформы контейнеров OpenShift. Убедитесь, что у вас достаточно прав для платформы контейнеров OpenShift для установки кластера. |
| Идентификатор пула OpenShift для диспетчера подписки Red Hat для брокера/главного узла | Идентификатор пула, содержащий права на платформу контейнеров OpenShift для узлов брокера/Master. Убедитесь, что у вас достаточно прав для платформы контейнеров OpenShift для установки кластера. Если не используется брокер или идентификатор главного пула, введите идентификатор пула для узлов приложений. |
| Настройка поставщика облачных служб Azure | Настройте OpenShift для использования поставщика облачных служб Azure. Требуется, если для постоянных томов используется подключение к диску Azure.  По умолчанию — Да |
| Идентификатор GUID идентификатора клиента субъекта-службы Azure AD | Идентификатор GUID клиента субъекта-службы Azure AD — также называется AppID. Требуется только при настройке поставщика облачных служб Azure в значение **"Да"** |
| Секрет идентификатора клиента субъекта-службы Azure AD | Секрет идентификатора клиента субъекта-службы Azure AD. Требуется только при настройке поставщика облачных служб Azure в значение **"Да"** |
 
   ![Колонка предложения OpenShift](media/openshift-marketplace-self-managed/ocp-ocpmain.png)  
<br>

**Дополнительные параметры**

В колонке дополнительные параметры можно настроить параметр CNS для хранилища глустерфс, ведения журнала, метрик и поддомена маршрутизатора.  По умолчанию ни один из этих параметров не устанавливается и в целях тестирования будет использоваться nip.io в качестве поддомена маршрутизатора. При включении функции CNS устанавливаются три дополнительных подключаемых узла с тремя дополнительными подключенными дисками, на которых будут размещаться модули глустерфс.  

Введите значения входных параметров и нажмите кнопку **ОК** .

| Входной параметр | Описание параметра |
|-----------------------|-----------------|
| Настройка собственного хранилища контейнера (CNS) | Устанавливает CNS в кластере OpenShift и включает его в качестве хранилища. Будет использоваться по умолчанию, если поставщик Azure отключен |
| Настройка ведения журнала кластера | Устанавливает функции ведения журнала ЕФК в кластер.  Оптимальное изменение размера бессерверных узлов для размещения модулей ЕФК |
| Настройка метрик для кластера | Устанавливает метрики Хавкулар в кластер OpenShift.  Правильно изменяйте подходящие узлы для размещения Хавкулар метрик |
| Поддомен маршрутизатора по умолчанию | Выберите нипио для тестирования или Custom, чтобы ввести собственный поддомен для рабочей среды. |
 
   ![Дополнительная колонка предложения](media/openshift-marketplace-self-managed/ocp-additionalmain.png)  
<br>

**Дополнительные параметры — Дополнительные параметры**

| Входной параметр | Описание параметра |
|-----------------------|-----------------|
| CNS Размер узла | Примите Размер узла по умолчанию или выберите **изменить размер** , чтобы выбрать новый размер виртуальной машины. |
| Введите пользовательский поддомен | Пользовательский домен маршрутизации, используемый для предоставления приложений через маршрутизатор в кластере OpenShift.  Не забудьте создать соответствующую DNS-запись с подстановочными знаками] |
 
   ![Предложение дополнительной установки CNS](media/openshift-marketplace-self-managed/ocp-additionalcnsall.png)  
<br>

**Сводка**

На этом этапе выполняется проверка квоты ядра для развертывания общего числа виртуальных машин, выбранных для кластера.  Проверьте все указанные параметры.  Если входные данные приемлемы, нажмите кнопку " **ОК** ", чтобы продолжить.

   ![Колонка сводки предложения](media/openshift-marketplace-self-managed/ocp-summary.png)  
<br>

**Купить**

Подтвердите контактную информацию на странице покупки и щелкните **купить** , чтобы принять условия использования и запустить развертывание кластера платформы контейнера OpenShift.

   ![Колонка "предложение покупки"](media/openshift-marketplace-self-managed/ocp-purchase.png)  
<br>


## <a name="connect-to-the-openshift-cluster"></a>Подключение к кластеру OpenShift

Когда завершится развертывание, получите данные для подключения из раздела выходных данных развертывания. Подключитесь к консоли OpenShift в браузере с помощью **URL-адреса консоли OpenShift**. Вы также можете SSH-подключение к узлу бастиона. В следующем примере в качестве имени администратора указано clusteradmin, а для полного доменного имени DNS с общедоступным IP-адресом узла-бастиона — bastiondns4hawllzaavu6g.eastus.cloudapp.azure.com.

```bash
$ ssh clusteradmin@bastiondns4hawllzaavu6g.eastus.cloudapp.azure.com
```

## <a name="clean-up-resources"></a>Очистка ресурсов

Если группа ресурсов, кластер OpenShift и все связанные ресурсы больше не нужны, их можно удалить с помощью команды [az group delete](/cli/azure/group).

```azurecli 
az group delete --name openshiftrg
```

## <a name="next-steps"></a>Дальнейшие действия

- [Задачи, выполняемые после развертывания](./openshift-container-platform-3x-post-deployment.md)
- [Устранение неполадок с развертыванием OpenShift в Azure](./openshift-container-platform-3x-troubleshooting.md)
- [Overview](https://docs.openshift.com) (Обзор)
- 