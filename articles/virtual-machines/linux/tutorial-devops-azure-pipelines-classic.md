---
title: Руководство. Настройка последовательного развертывания для виртуальных машины Linux в Azure
description: Из этого руководства вы узнаете, как настроить конвейер непрерывного развертывания (CD). Этот конвейер добавочно обновляет группу виртуальных машин Linux в Azure с использованием стратегии последовательного развертывания.
author: moala
manager: jpconnock
tags: azure-devops-pipelines
ms.assetid: ''
ms.service: virtual-machines-linux
ms.topic: tutorial
ms.tgt_pltfrm: azure-pipelines
ms.workload: infrastructure
ms.date: 4/10/2020
ms.author: moala
ms.custom: devops
ms.openlocfilehash: 6cc4fdb82e98c30ca33eec58675f2175dfcc2607
ms.sourcegitcommit: f845ca2f4b626ef9db73b88ca71279ac80538559
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/09/2020
ms.locfileid: "89612778"
---
# <a name="tutorial---configure-the-rolling-deployment-strategy-for-azure-linux-virtual-machines"></a>Руководство. Настройка стратегии последовательного развертывания для виртуальных машин Linux в Azure

Azure DevOps — это встроенная служба Azure, которая автоматизирует выполнение каждой части процесса DevOps для любого ресурса Azure. Независимо от того, использует ли ваше приложение виртуальные машины, веб-приложения, Kubernetes или любой другой ресурс, вы можете реализовать подход IaC (инфраструктура как код), включая непрерывную интеграцию, непрерывное тестирование, непрерывную поставку и непрерывный мониторинг с использованием Azure и Azure DevOps.

![Портал Azure, где выбран элемент Azure DevOps в разделе "Службы"](media/tutorial-devops-azure-pipelines-classic/azdevops-view.png)

## <a name="infrastructure-as-a-service-iaas---configure-cicd"></a>Инфраструктура как услуга (IaaS). Настройка CI/CD

Azure Pipelines предоставляет полнофункциональный набор инструментов для автоматизации CI/CD при развертывании на виртуальных машинах. Вы можете настроить на портале Azure конвейер непрерывной поставки для виртуальной машины Azure.

В этой статье описывается, как настроить на портале Azure конвейер CI/CD, который использует стратегию последовательного развертывания для нескольких компьютеров. Также портал Azure поддерживает другие стратегии, например [раннего](https://aka.ms/AA7jdrz) и [сине-зеленого](https://aka.ms/AA83fwu) обновления.

### <a name="configure-cicd-on-virtual-machines"></a>Настройка CI/CD для виртуальных машин

Вы можете добавить целевые виртуальные машины в [группу развертывания](/azure/devops/pipelines/release/deployment-groups). Это позволит организовать для них многокомпьютерное обновление. После развертывания на компьютерах просмотрите **журнал развертывания** в группе развертывания. Это представление позволяет выполнять трассировку действий от виртуальной машины до конвейера и далее до фиксации.

### <a name="rolling-deployments"></a>Последовательные развертывания

На каждой итерации последовательного развертывания заменяются экземпляры предыдущей версии приложения. Вместо них на определенном наборе компьютеров (набор последовательного обновления) устанавливаются экземпляры новой версии того же приложения. В следующем пошаговом руководстве мы подробно рассмотрим настройку последовательного обновления для виртуальных машин.

С помощью механизма непрерывной поставки вы можете настроить на портале Azure последовательные обновления для виртуальных машин. Ниже представлены пошаговые инструкции.

1. Войдите на портал Azure и перейдите к нужной виртуальной машине.
1. На крайней левой панели параметров виртуальной машины выберите **Непрерывная поставка**. Затем выберите **Настроить**.

   ![Панель непрерывной поставки с кнопкой настройки](media/tutorial-devops-azure-pipelines-classic/azure-devops-configure.png)

1. На панели конфигурации щелкните **Организация Azure DevOps**, чтобы выбрать существующую учетную запись или создать новую. Затем выберите проект, в котором вы хотите настроить конвейер.  

   ![Панель непрерывной поставки](media/tutorial-devops-azure-pipelines-classic/azure-devops-rolling.png)

1. Группа развертывания — это логический набор целевых компьютеров для развертывания, который представляет определенную физическую среду. Это может быть среда разработки, тестирования или пользовательского приемочного тестирования, а также рабочая среда. Вы можете создать новую группу развертывания или выбрать существующую.
1. Выберите конвейер сборки, который публикует пакет для развертывания на виртуальной машине. Опубликованный пакет должен содержать скрипт развертывания deploy.ps1 или deploy.sh в папке deployscripts, расположенной в корневой папке пакета. Конвейер запускает этот скрипт развертывания.
1. В списке **Стратегия развертывания** выберите вариант **Последовательное**.
1. При желании можно присвоить каждому компьютеру тег, обозначающий роль. Например, теги "Web" и "DB". Эти теги помогут правильно выбрать целевые виртуальные машины с определенной ролью.
1. Щелкните **ОК**, чтобы настроить конвейер непрерывной поставки.
1. Когда настройка завершится, вы получите конвейер непрерывной поставки, в котором настроено развертывание на виртуальной машине.  

   ![Панель непрерывной поставки с журналом развертывания](media/tutorial-devops-azure-pipelines-classic/azure-devops-deployment-history.png)

1. Отобразятся сведения о развертывании для виртуальной машины. Вы можете щелкнуть ссылку для перехода к конвейеру, **Release-1** для просмотра развертывания или **Изменить** для редактирования определения конвейера выпуска.

1. Если вы настраиваете несколько виртуальных машин, повторите шаги 2–4 для добавления других виртуальных машин в группу развертывания. Если в выбранной группе развертывания уже запущен конвейер, то виртуальные машины просто добавляются в группу развертывания. Новые конвейеры не создаются.
1. Когда настройка завершится, щелкните определение конвейера, перейдите к организации Azure DevOps и выберите **Изменить** для конвейера выпуска.

   ![Изменение конвейера последовательного обновления](media/tutorial-devops-azure-pipelines-classic/azure-devops-rolling-pipeline.png)

1. Выберите **1 задание, 1 задача** для этапа **dev**. Выберите этап **Развертывание**.

   ![Задачи конвейера последовательного обновления с выбранной задачей "Развертывание"](media/tutorial-devops-azure-pipelines-classic/azure-devops-rolling-pipeline-tasks.png)

1. На панели конфигурации справа можно указать количество компьютеров, которые будут параллельно развертываться на каждой итерации. Если вы хотите выполнить одновременное развертывание на нескольких компьютерах, укажите нужное количество в процентах с помощью ползунка.  

1. Задача выполнения скрипта развертывания по умолчанию запускает скрипт развертывания deploy.ps1 или deploy.sh. Этот скрипт размещается в подпапке deployscripts корневой папки опубликованного пакета.

   ![Панель "Артефакты", где отображается файл deploy.sh в папке deployscripts](media/tutorial-deployment-strategy/package.png)

## <a name="other-deployment-strategies"></a>Другие стратегии развертывания

- [Настройка стратегии раннего развертывания](https://aka.ms/AA7jdrz)
- [Настройка стратегии развертывания по схеме "синий-зеленый"](https://aka.ms/AA83fwu)

## <a name="azure-devops-projects"></a>Azure DevOps Projects

Вам будет легко начать работу с Azure. Функция Azure DevOps Projects позволяет запустить приложение в любой службе Azure, выполнив всего три шага:

- выбор языка приложения;
- выбор среды выполнения;
- выбор службы Azure.
 
[Подробнее](https://azure.microsoft.com/features/devops-projects/).
 
## <a name="additional-resources"></a>Дополнительные ресурсы

- [Развертывание на виртуальных машинах Azure с помощью Azure DevOps Projects](../../devops-project/azure-devops-project-vms.md)
- [Реализация непрерывного развертывания приложения в масштабируемом наборе виртуальных машин Azure](/azure/devops/pipelines/apps/cd/azure/deploy-azure-scaleset)
