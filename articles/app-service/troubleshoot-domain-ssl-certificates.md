---
title: Устранение неполадок с доменом и SSL-сертификатом в Службе приложений Azure | Документация Майкрософт
description: Устранение неполадок с доменами и SSL-сертификатами в Службе приложений Azure
services: app-service\web
documentationcenter: ''
author: genlin
manager: cshepard
editor: ''
tags: top-support-issue
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/01/2019
ms.author: genli
ms.custom: seodec18
ms.openlocfilehash: 8ae6c9d5238f2853a12c20edfd3dba6d3f529b2c
ms.sourcegitcommit: 9f4eb5a3758f8a1a6a58c33c2806fa2986f702cb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2019
ms.locfileid: "58905823"
---
# <a name="troubleshoot-domain-and-ssl-certificate-problems-in-azure-app-service"></a>Устранение неполадок с доменами и SSL-сертификатами в Службе приложений Azure

Эта статья содержит сведения о распространенных проблемах, которые могут возникнуть при настройке домена или SSL-сертификата для веб-приложений Azure в Службе приложений Azure. Кроме того, здесь описаны возможные причины этих проблем и способы их устранения.

Если в любой момент при изучении этой статьи вам потребуется дополнительная помощь, вы можете обратиться к экспертам по Azure на [форумах MSDN и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт поддержки Azure](https://azure.microsoft.com/support/options/) и выберите **Получить поддержку**.


[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

## <a name="certificate-problems"></a>Проблемы сертификата

### <a name="you-cant-add-an-ssl-certificate-binding-to-an-app"></a>Не удается добавить привязку SSL-сертификата к приложению 

#### <a name="symptom"></a>Симптом

При добавлении привязки SSL появляется следующее сообщение об ошибке:

"Не удалось добавить привязку SSL. Не удалось назначить сертификат для существующего виртуального IP-адреса, так как этот сертификат уже используется для другого виртуального IP-адреса."

#### <a name="cause"></a>Причина:

Эта проблема может возникнуть, если у вас есть несколько привязок SSL на основе IP-адреса для одного IP-адреса в нескольких приложениях. Например, у приложения A есть привязка SSL на основе IP-адреса со старым сертификатом. У приложения B есть привязка SSL на основе IP-адреса с новым сертификатом для того же IP-адреса. При обновлении привязки SSL приложения с помощью нового сертификата появится указанное выше сообщение об ошибке, так как этот же IP-адрес уже используется для другого приложения. 

#### <a name="solution"></a>Решение 

Чтобы устранить эту проблему, используйте один из следующих способов:

- Удалите привязку SSL на основе IP-адреса в приложении, в котором используется старый сертификат. 
- Создайте привязку SSL на основе IP-адреса, которая использует новый сертификат.

### <a name="you-cant-delete-a-certificate"></a>Не удается удалить сертификат 

#### <a name="symptom"></a>Симптом

При попытке удалить сертификат, появляется следующее сообщение об ошибке:

"Невозможно удалить сертификат, так как он сейчас используется в SSL-привязке. Ее необходимо удалить, чтобы можно было удалить сертификат."

#### <a name="cause"></a>Причина:

Эта проблема может возникнуть, если сертификат используется другим приложением.

#### <a name="solution"></a>Решение

Удалите привязку SSL для этого сертификата из приложений. Затем попробуйте удалить сертификат. Если сертификат по-прежнему не удается удалить, очистите кэш веб-браузера, повторно откройте портал Azure в новом окне браузера. Затем попробуйте удалить сертификат.

### <a name="you-cant-purchase-an-app-service-certificate"></a>Не удается приобрести сертификат службы приложений 

#### <a name="symptom"></a>Симптом
Приобрести [сертификат службы приложений Azure](./web-sites-purchase-ssl-web-site.md) на портале Azure нельзя.

#### <a name="cause-and-solution"></a>Причина и решение
Эта проблема может возникать из-за любой из следующих причин:

- Служба приложений имеет план уровня "Бесплатный" или "Общий". Эти ценовые категории не поддерживают SSL. 

    **Решение** Обновите план службы приложений для приложения до уровня "Стандартный".

- Подписка не имеет действительной кредитной карты.

    **Решение** Добавьте действительную кредитную карту в подписку. 

- Предложение подписки не поддерживает покупку сертификата службы приложений, такого как Microsoft Student.  

    **Решение** Обновите подписку. 

- Достигнуто максимальное количество покупок, предусмотренных для подписки.

    **Решение** Для типов подписок с оплатой по мере использования и с Соглашением Enterprise предусмотрено не больше 10 покупок сертификатов службы приложений. Для других типов подписок ограничение равно 3. Чтобы увеличить это количество, обратитесь в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).
- Сертификат службы приложений помечен как мошеннический. Отображается следующее сообщение об ошибке: "Сертификат помечен как возможно мошеннический. Запрос находится на рассмотрении. Если сертификат не станет доступен в течение 24 часов, обратитесь в службу поддержки Azure.»

    **Решение** Если сертификат помечен как мошеннический и проблема не будет устранена по прошествии 24 часов, сделайте следующее:

    1. Войдите на [портале Azure](https://portal.azure.com).
    2. Перейдите к области **Сертификаты службы приложений**, а затем выберите сертификат.
    3. Выберите **Конфигурация сертификата** > **Шаг 2. Проверка** > **Проверка домена**. В результате будет отправлено электронное уведомление поставщику сертификата Azure для устранения проблемы.

## <a name="custom-domain-problems"></a>Проблемы пользовательского домена

### <a name="a-custom-domain-returns-a-404-error"></a>Личный домен возвращает сообщение об ошибке 404 

#### <a name="symptom"></a>Симптом

При переходе на сайт с помощью имени личного домена отображается следующее сообщение об ошибке:

"Error 404-Web app not found" (Ошибка 404 — веб-приложение не найдено).

#### <a name="cause-and-solution"></a>Причина и решение

**Причина 1** 

На настроенном личном домене отсутствует запись A или CNAME. 

**Решение для причины 1**

- Если вы добавили запись A, убедитесь, что запись типа TXT также добавлена. Дополнительные сведения см. в разделе [Создание записи A](./app-service-web-tutorial-custom-domain.md#create-the-a-record).
- Если вам не нужно использовать корневой домен для приложения, рекомендуется использовать запись CNAME вместо записи A.
- Не используйте обе записи CNAME и A для одного домена. Эту проблему можно вызвать конфликт и предотвратить домена необходимо разрешить. 

**Причина 2** 

Веб-браузер может по-прежнему кэшировать старый IP-адрес для домена. 

**Решение для причины 2**

Очистите браузер. Для устройств Windows можно выполнить команду `ipconfig /flushdns`. С помощью [WhatsmyDNS.net](https://www.whatsmydns.net/) можно проверить, указывает ли домен на IP-адрес приложения. 

### <a name="you-cant-add-a-subdomain"></a>Не удалось добавить дочерний домен 

#### <a name="symptom"></a>Симптом

Не удается добавить новое имя узла в приложение, чтобы назначить поддомен.

#### <a name="solution"></a>Решение

- Обратитесь к администратору подписки, чтобы убедиться, что у вас есть разрешение на добавление имени узла в приложение.
- Если вам требуется несколько дочерних доменов, рекомендуется изменить размещение домена в Azure службы доменных имен (DNS). С помощью Azure DNS можно добавить в приложение до 500 имен узлов. Дополнительные сведения см. в записи блога о [добавлении поддомена](https://blogs.msdn.microsoft.com/waws/2014/10/01/mapping-a-custom-subdomain-to-an-azure-website/).

### <a name="dns-cant-be-resolved"></a>Не удается распознать службу доменных имен

#### <a name="symptom"></a>Симптом

Отображается следующее сообщение об ошибке:

"Не удается найти запись DNS".

#### <a name="cause"></a>Причина:
Эта ошибка возникает по одной из следующих причин:

- Срок жизни не истек. Проверьте конфигурацию DNS своего домена, чтобы определить значение срока жизни, а затем подождите его окончания.
- Недопустимая конфигурация DNS.

#### <a name="solution"></a>Решение
- Подождите 48 часов. Спустя это время проблема устранится самостоятельно.
- Если вы можете изменить параметры срока жизни в конфигурации DNS, измените значение на 5 минут, чтобы увидеть, устранена ли проблема.
- С помощью [WhatsmyDNS.net](https://www.whatsmydns.net/) можно проверить, указывает ли домен на IP-адрес приложения. Если нет, настройте для записи A правильный IP-адрес приложения.

### <a name="you-need-to-restore-a-deleted-domain"></a>Нужно восстановить удаленный домен 

#### <a name="symptom"></a>Симптом
Домен больше не отображается на портале Azure.

#### <a name="cause"></a>Причина: 
Возможно, домен случайно удален владельцем подписки.

#### <a name="solution"></a>Решение
Если домен удален меньше семи дней назад, процесс удаления не был запущен. В этом случае можно приобрести тот же домен снова на портале Azure в рамках одной подписки (убедитесь, что в поле поиска введено точное доменное имя). Плата за этот домен повторно не взимается. Если домен был удален более семи дней назад, обратитесь в службу [поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) для получения справки по восстановлению домена.

## <a name="domain-problems"></a>Проблемы домена

### <a name="you-purchased-an-ssl-certificate-for-the-wrong-domain"></a>Приобретен SSL-сертификат для неверного домена

#### <a name="symptom"></a>Симптом

Приобретен сертификат службы приложений для неверного домена. Не удается обновить сертификат для использования правильного домена.

#### <a name="solution"></a>Решение

Удалите этот сертификат, а затем приобретите новый.

Если текущий сертификат, который использует неверный домен, имеет состояние "Выдан", за него также выставляется счет. Плата за сертификаты службы приложений не возвращается, но вы можете обратиться в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade), чтобы рассмотреть другие варианты. 

### <a name="an-app-service-certificate-was-renewed-but-the-app-shows-the-old-certificate"></a>Сертификат службы приложений был обновлен, но в приложении по-прежнему отображается старый сертификат 

#### <a name="symptom"></a>Симптом

Сертификат службы приложений обновлен, но приложение, использующее сертификат службы приложений, по-прежнему использует старый сертификат. Кроме того, вы получили предупреждение о том, что необходим протокол HTTP.

#### <a name="cause"></a>Причина: 
Служба приложений Azure выполняет фоновое задание каждые восемь часов и в случае изменений синхронизирует ресурсы сертификата. Если вы изменяете или обновляете сертификат, иногда приложение по-прежнему извлекает старый сертификат, а не только что обновленный. Это связано с тем, что задание для синхронизации ресурсов сертификата еще не запущено. 
 
#### <a name="solution"></a>Решение

Вы можете принудительно выполнить синхронизацию сертификата. Для этого сделайте следующее:

1. Войдите на [портале Azure](https://portal.azure.com). Выберите **Сертификаты службы приложений**, а затем — сертификат.
2. Выберите **повторное создание ключей и синхронизацию**, а затем — **Синхронизировать**. Этот процесс занимает некоторое время. 
3. После выполнения синхронизации вы увидите следующее уведомление: "Все ресурсы обновлены с использованием нового сертификата".

### <a name="domain-verification-is-not-working"></a>Проверка домена не работает 

#### <a name="symptom"></a>Симптом 
Прежде чем использовать сертификат службы приложений, необходимо выполнить проверку домена. Если щелкнуть **Проверить**, процесс завершится ошибкой.

#### <a name="solution"></a>Решение
Проверьте домен вручную, добавив запись типа TXT:
 
1.  Перейдите к поставщику службы доменных имен (DNS), на котором размещено доменное имя.
2.  Добавьте запись типа TXT для домена, использующего значение токена домена, показанного на портале Azure. 

Подождите несколько минут до запуска распространения данных в DNS, а затем нажмите кнопку **Обновить** для запуска проверки. 

В качестве альтернативы вы можете использовать метод веб-страницы HTML, чтобы вручную подтвердить свой домен. Этот метод позволяет центру сертификации подтвердить права на владение доменом, для которого выдан сертификат.

1.  Создайте HTML-файл с именем {токен проверки домена}.html. Содержимым этого файла должно быть значение токена проверки домена.
3.  Отправьте этот файл в корень веб-сервера, на котором размещается ваш домен.
4.  Выберите **Обновить**, чтобы проверить состояние сертификата. Проверка может занять несколько минут.

Например, если вы приобретаете стандартный сертификат для azure.com с токеном проверки домена 1234abcd, то веб-запрос, направленный по адресу https://azure.com/1234abcd.html, должен возвратить 1234abcd. 

> [!IMPORTANT]
> При заказе сертификата на проверку домена отводится всего 15 дней, по истечении которых сертификат отклоняется центром сертификации, а счет за этот сертификат не выставляется. В такой ситуации удалите этот сертификат и повторите попытку.
>
> 

### <a name="you-cant-purchase-a-domain"></a>Не удается приобрести домен

#### <a name="symptom"></a>Симптом
Не удается приобрести домен службы приложений на портале Azure.

#### <a name="cause-and-solution"></a>Причина и решение

Эта ошибка возникает по одной из следующих причин:

- Кредитная карта для подписки Azure отсутствует или недействительна.

    **Решение** Добавьте действительную кредитную карту в подписку.

- Вы не являетесь владельцем подписки, поэтому у вас нет разрешения на покупку домена.

    **Решение** [Назначьте роль "Владелец"](../role-based-access-control/role-assignments-portal.md) своей учетной записи. Или свяжитесь с администратором, чтобы получить разрешение на приобретение домена.
- Вы достигли предельного числа приобретений доменов для подписки. Текущее ограничение — 20.

    **Решение** Чтобы отправить запрос на увеличение ограничения, обратитесь в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).
- Тип подписки Azure не поддерживает покупку домена службы приложений.

    **Решение** Обновите подписку Azure до других типов подписки, например до подписки с оплатой по мере использования.

### <a name="you-cant-add-a-host-name-to-an-app"></a>Не удается добавить имя узла в приложение 

#### <a name="symptom"></a>Симптом

При добавлении имени узла процесс проверки и утверждения домена завершается ошибкой.

#### <a name="cause"></a>Причина: 

Эта ошибка возникает по одной из следующих причин:

- У вас нет разрешения на добавление имени узла.

    **Решение** Попросите администратора подписки дать вам разрешение на добавление имени узла.
- Не удается выполнить проверку владельца домена.

    **Решение** Убедитесь, что запись CNAME или A настроены правильно. Чтобы сопоставить личный домен с приложением, создайте запись CNAME или A. Если вы хотите использовать корневой домен, необходимо воспользоваться записями типа A и TXT.

    |Тип записи|Узел|На что указывает|
    |------|------|-----|
    |A|@|IP-адрес приложения|
    |TXT|@|<app-name>.azurewebsites.net|
    |CNAME|www|<app-name>.azurewebsites.net|

## <a name="faq"></a>Часто задаваемые вопросы

**Нужно ли Настройка пользовательского домена для веб-узла, когда мне не купить такой?**

При покупке домена на портале Azure, приложение службы приложений автоматически настраивается для использования этого домена. Вам не нужно предпринимать никаких дополнительных действий. Дополнительные сведения см. [Azure App Service Self помочь: Добавление имени личного домена](https://channel9.msdn.com/blogs/Azure-App-Service-Self-Help/Add-a-Custom-Domain-Name) на канале Channel 9.

**Можно использовать домен, приобретенные на портале Azure для указания на виртуальных машинах Azure, вместо этого?**

Да, домен может указывать на виртуальной Машине. Дополнительные сведения см. в статье [Использование Azure DNS для указания параметров личного домена для службы Azure](../dns/dns-custom-domain.md).

**Мой домен управляется GoDaddy или Azure DNS?**

Домены службы приложений используют GoDaddy для регистрации домена и Azure DNS для размещения доменов. 

**У меня есть автоматическое возобновление включена, но по-прежнему получено для домена по электронной почте уведомления об обновлении. Что делать?**

Если у вас есть автоматическое возобновление включена, не нужно предпринимать никаких действий. Обратите внимание, что адрес электронной почты предоставляется, чтобы сообщить о том, что домен является рядом с истекающим сроком действия, а также для обновления вручную, если автоматическое возобновление не включено.

**Взимается ли Azure DNS для размещения в моем домене?**

Начальная стоимость покупки домена относится к регистрации домена. Помимо стоимости регистрации существует каких-либо затрат для Azure DNS, в зависимости от использования. Дополнительные сведения см. в разделе [цены на Azure DNS](https://azure.microsoft.com/pricing/details/dns/) для получения дополнительных сведений.

**Я приобрести Мой домен ранее с помощью портала Azure и хотите перенести из GoDaddy размещения с размещением в Azure DNS. Как это сделать?**

Он не является обязательным для переноса в Azure DNS размещения. Если вы хотите перенести в Azure DNS, в среду управления домена на портале Azure, о сведения на шаги, необходимые для перехода в Azure DNS. Если домен приобретенного в рамках службы приложений, миграции GoDaddy, на котором размещается в Azure DNS является относительно простой процедурой.

**Я бы хотел приобрести Мой домен из домена службы приложений, но можно ли разместить Мой домен на GoDaddy, а не Azure DNS?**

Начиная с 24 июля 2017 г., домены службы приложений, приобретенных в портале размещаются в Azure DNS. Если вы предпочитаете использовать другого поставщика услуг размещения, то необходимо перейти веб-узла, чтобы получить решение для размещения домена.

**Нужно ли платить за защиту конфиденциальности в домене?**

Когда вы приобретаете домен на портале Azure, вы можете добавить конфиденциальности без дополнительной платы. Это одно из преимуществ покупки домена через службу приложений Azure.

**Если я решу, что мой домен больше не требуется, можно вернуть моей деньги?**

Когда вы приобретаете домен, плата не взимается в течение пяти дней, во время которого вам нужно решить, что вы не домена. Если вы решили, что вы не хотите домена за указанный период пять дней, плата не взимается. (.uk домены являются исключением. Если вы приобретаете домен .uk, плата взимается немедленно и не будет возмещена.)

**Можно ли использовать домен, в другом приложении службы приложений Azure в подписку?**

Да. Когда вы обращаетесь в колонке пользовательские домены и SSL на портале Azure, вы видите доменов, которые вы приобрели. Можно настроить приложение для использования любого из этих доменов.

**Можно ли перенести домена из одной подписки в другую подписку?**

Вы можете переместить домен в другую подписку или группу ресурсов с помощью [AzResource перемещения](https://docs.microsoft.com/powershell/module/az.Resources/Move-azResource) командлета PowerShell.

**Как управлять пользовательского домена при отсутствии в данный момент приложение службы приложений Azure?**

Вы можете управлять доменом, даже если у вас нет веб-приложение службы приложений. Домен можно использовать для служб Azure, как виртуальной машины, хранилища и т.д. Если вы планируете использовать домен для веб-приложения службы, необходимо включить веб-приложение, который отсутствует в плане бесплатной службы приложений для привязки домена к веб-приложения.

**Можно ли переместить веб-приложения с личным доменом в другую подписку или из среды службы приложений версии 1 до версии 2?**

Да, веб-приложения можно переместить между подписками. Следуйте указаниям в [как переместить ресурсы в Azure](../azure-resource-manager/resource-group-move-resources.md). Существуют некоторые ограничения при перемещении веб-приложения. Дополнительные сведения см. в разделе [ограничения для перемещения ресурсов службы приложений](../azure-resource-manager/resource-group-move-resources.md#app-service-limitations
).

После перемещения веб-приложения, привязок имен узлов из доменов в пределах Настройка личных доменов должен оставаться неизменным. Дополнительные действия не требуются для настройки привязок имен узлов.
