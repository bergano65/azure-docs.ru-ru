---
title: Приобретение и настройка SSL-сертификата в Службе приложений Azure | Документация Майкрософт
description: Узнайте, как приобрести сертификат службы приложений и привязать его к приложению службы приложений.
services: app-service
documentationcenter: .net
author: cephalin
manager: cfowler
tags: buy-ssl-certificates
ms.assetid: cdb9719a-c8eb-47e5-817f-e15eaea1f5f8
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/16/2018
ms.author: apurvajo;cephalin
ms.custom: seodec18
ms.openlocfilehash: 78b7668dee892841ced1a06626ff09a534a88b69
ms.sourcegitcommit: 549070d281bb2b5bf282bc7d46f6feab337ef248
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2018
ms.locfileid: "53714306"
---
# <a name="buy-and-configure-an-ssl-certificate-for-azure-app-service"></a>Приобретение и настройка сертификата SSL для службы приложений Azure

В этом руководстве описано, как защитить свои веб-приложения с помощью созданного (приобретенного) сертификата службы приложений в [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-whatis), а затем связать его с приложением службы приложений.

> [!TIP]
> Сертификаты службы приложений можно использовать для любой службы Azure или сторонней службы, а не только в службах приложений. Для этого нужно создать локальную копию (PFX-файл) сертификата службы приложений, чтобы использовать ее с любой службой. Дополнительные сведения см. в записи блога о [создании локальной копии (PFX-файла) сертификата службы приложения](https://blogs.msdn.microsoft.com/appserviceteam/2017/02/24/creating-a-local-pfx-copy-of-app-service-certificate/).
>

## <a name="prerequisites"></a>Предварительные требования

Ознакомьтесь со следующими статьями:

- [Создано приложение службы приложений](/azure/app-service/).
- [Руководство. Сопоставление существующего настраиваемого DNS-имени с веб-приложениями Azure](app-service-web-tutorial-custom-domain.md) или [Приобретение имени личного домена для веб-приложений Azure](manage-custom-dns-buy-domain.md)

[!INCLUDE [Prepare your web app](../../includes/app-service-ssl-prepare-app.md)]

## <a name="start-certificate-order"></a>Порядок работы с сертификатом

Порядок работы с сертификатом службы приложений находится на <a href="https://portal.azure.com/#create/Microsoft.SSL" target="_blank">странице создания сертификаты службы приложений</a>.

![Создание сертификата](./media/app-service-web-purchase-ssl-web-site/createssl.png)

Чтобы выполнить настройку сертификата, воспользуйтесь сведениями из следующей таблицы. По завершении нажмите кнопку **Создать**.

| Параметр | ОПИСАНИЕ |
|-|-|
| ИМЯ | Понятное имя сертификата службы приложений. |
| Имя узла незащищенного домена | Это один из наиболее важных этапов процесса покупки. Используйте имя корневого домена, которое было сопоставлено в приложении. _Не_ добавляйте к доменному имени префикс `www`. |
| Подписка | Центр обработки данных, где размещается веб-приложение. |
| Группа ресурсов | Группа ресурсов, в которой содержится сертификат. Например, можно использовать новую группу ресурсов или ту же группу ресурсов, что и для приложения службы приложений. |
| SKU сертификата | Определяет тип создаваемого сертификата независимо от того, является ли сертификат стандартным или [групповым](https://wikipedia.org/wiki/Wildcard_certificate). |
| Условия использования | Щелкните, чтобы подтвердить, что вы принимаете условия использования. |

## <a name="store-in-azure-key-vault"></a>Хранение в Azure Key Vault

После завершения процесса приобретения сертификата нужно выполнить еще некоторые действия, прежде чем его можно будет использовать. 

На странице [Сертификаты службы приложений](https://portal.azure.com/#blade/HubsExtension/Resources/resourceType/Microsoft.CertificateRegistration%2FcertificateOrders) выберите сертификат и щелкните **Конфигурация сертификата** > **Шаг 1. Сохранение**.

![вставить изображение для готовности к размещению в хранилище ключей](./media/app-service-web-purchase-ssl-web-site/ReadyKV.png)

[Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-whatis) — это служба Azure, которая помогает защитить криптографические ключи и секреты, используемые облачными приложениями и службами. Данное хранилище можно выбрать для сертификатов службы приложений.

Чтобы создать новое хранилище или выбрать существующее, на странице **Состояние Key Vault** щелкните **Репозиторий Key Vault**. Если был выбран вариант создать новое хранилище, то для его настройки используйте сведения из следующей таблицы, а затем щелкните "Создать". Узнайте, как создать хранилище ключей в той же подписке и группе ресурсов.

| Параметр | ОПИСАНИЕ |
|-|-|
| ИМЯ | Уникальное имя, содержащее буквы, цифры и дефисы. |
| Группа ресурсов | Рекомендуется выбирать группу ресурсов, идентичную сертификату службы приложений. |
| Расположение | Предназначено для выбора расположения, идентичного тому, где находится приложение службы приложений. |
| Ценовой уровень | Дополнительные сведения см. в статье [Цены на Key Vault ](https://azure.microsoft.com/pricing/details/key-vault/). |
| Политики доступа| Определяет приложения и разрешает доступ к ресурсам хранилища. Ее можно настроить позднее, воспользовавшись сведениями из статьи [Предоставление разрешения на доступ к хранилищу ключей нескольким приложениям](../key-vault/key-vault-group-permissions-for-apps.md). |
| Доступ к виртуальной сети | Ограничьте доступ к хранилищу для определенных виртуальных сетей Azure. Воспользовавшись сведениями из статьи [Настройка брандмауэров и виртуальных сетей Azure Key Vault](../key-vault/key-vault-network-security.md), его можно настроить потом. |

После выбора хранилища закройте страницу **Репозиторий Key Vault**. Возле параметра **Хранилище** должен отображаться зеленый значок галочки, который оповещает об успехе. На протяжении выполнении следующего шага данная страница должна быть открыта.

## <a name="verify-domain-ownership"></a>проверка принадлежности домена;

На той же странице **Конфигурация сертификата**, которую вы использовали в последнем шаге, щелкните **Шаг 2. Проверка**.

![](./media/app-service-web-purchase-ssl-web-site/verify-domain.png)

Выберите **Проверка службы приложений**. Так как домен уже был сопоставлен веб-приложением ранее (см. раздел [Предварительные требования](#prerequisites)), он считается проверенным. Щелкните **Проверка** для завершения. Нажимайте кнопку **Обновить** до того момента, пока не появится сообщение**Домен для сертификата проверен**.

> [!NOTE]
> Поддерживаются четыре метода проверки домена. 
> 
> - **Служба приложений** —это наиболее удобный вариант проверки домена, который уже был сопоставлен с приложением службы приложений в одной подписке. Преимущество этого метода в том, что приложение службы приложений уже проверило владельца домена.
> - **Домен**. Выполняется проверка [домена службы приложений, который вы приобрели в Azure](manage-custom-dns-buy-domain.md). Azure автоматически добавляет проверочную запись типа TXT и завершает процесс.
> - **Почта**. Выполняется проверка домена путем отправки электронной почты администратору домена. После выбора данного параметра будут предоставлены инструкции.
> - **Вручную**. Выполняется проверка, используется ли в домене HTML-страница (только для сертификата типа **Стандартный**) или запись типа TXT DNS. После выбора данного параметра будут предоставлены инструкции.

## <a name="bind-certificate-to-app"></a>Привязка сертификата к приложению

На **[портале Azure](https://portal.azure.com/)** в меню слева выберите **Службы приложений** > **\<your_ app>**.

В левой панели навигации приложения выберите **Параметры SSL** > **Закрытые сертификаты (PFX)** > **Импортировать сертификат службы приложений**.

![вставить изображение для импорта сертификата](./media/app-service-web-purchase-ssl-web-site/ImportCertificate.png)

Выберите приобретенный сертификат.

После импорта сертификата необходимо привязать его к сопоставленному имени домена в приложении. Выберите **Привязки** > **Добавить привязку SSL**. 

![вставить изображение для импорта сертификата](./media/app-service-web-purchase-ssl-web-site/AddBinding.png)

Чтобы настроить привязки в диалоговом окне **Привязки SSL**, воспользуйтесь сведениями из следующей таблицы и щелкните **Добавить привязку**.

| Параметр | ОПИСАНИЕ |
|-|-|
| имя узла; | Имя домена, которое будет добавлено для привязки SSL. |
| Отпечаток закрытого сертификата | Привязка сертификата. |
| Тип SSL | <ul><li>**SNI SSL** позволяет добавить несколько привязок SSL на основе SNI. Этот параметр позволяет использовать несколько SSL-сертификатов для защиты нескольких доменов с одним IP-адресом. Большинство современных браузеров (включая Internet Explorer, Chrome, Firefox и Opera) поддерживает SNI (более подробную информацию о поддержки браузеров можно найти в статье [Server Name Indication](https://wikipedia.org/wiki/Server_Name_Indication) (Указание имени сервера)).</li><li>**SSL на основе IP-адреса** позволяет добавить только одну привязку SSL на основе IP-адреса. Этот параметр позволяет использовать только один SSL-сертификат для защиты выделенного общедоступного IP-адреса. После настройки привязки воспользуйтесь сведениями из раздела [Переназначение записи A для SSL на основе IP-адреса](app-service-web-tutorial-custom-ssl.md#remap-a-record-for-ip-ssl). </li></ul> |

## <a name="verify-https-access"></a>Проверка доступа к HTTPS

Откройте приложение с использованием `HTTPS://<domain_name>`, а не `HTTP://<domain_name>`, что подтверждает правильность настройки сертификата.

## <a name="rekey-and-sync-certificate"></a>Повторное создание ключей и синхронизация сертификата

Если потребуется выполнить повторное создание ключей для сертификата, выберите его на странице [Сертификаты службы приложений.](https://portal.azure.com/#blade/HubsExtension/Resources/resourceType/Microsoft.CertificateRegistration%2FcertificateOrders), а затем в области навигации слева выберите **Повторное создание ключей и синхронизация**.

Для запуска процесса нажмите кнопку **Повторное создание ключей**. Этот процесс может занять от 1 до 10 минут.

![Добавить изображение для повторного создания ключа SSL](./media/app-service-web-purchase-ssl-web-site/Rekey.png)

При создании ключа развертывается новый сертификат, выданный центром сертификации.

## <a name="renew-certificate"></a>Обновление сертификата

Чтобы включить автоматическое обновление сертификата в любое время, на странице [Сертификаты службы приложений](https://portal.azure.com/#blade/HubsExtension/Resources/resourceType/Microsoft.CertificateRegistration%2FcertificateOrders) выберите сертификат, а затем в области навигации слева щелкните **Параметры автовозобновления**. 

Выберите **Вкл.** и нажмите кнопку **Сохранить**. Если автоматическое обновление включено, сертификаты начнут автоматически обновляться за 60 дней до истечения их срока действия.

![](./media/app-service-web-purchase-ssl-web-site/auto-renew.png)

Чтобы обновить сертификат вручную, щелкните **Обновление вручную**. Вы можете запросить обновление сертификата вручную за 60 дней до истечения срока действия.

> [!NOTE]
> Обновленный сертификат автоматически не привязан к вашему приложению, независимо от способа обновления (вручную или автоматически). Чтобы связать его с вашим приложением, см. раздел [Обновление сертификатов](./app-service-web-tutorial-custom-ssl.md#renew-certificates). 

## <a name="automate-with-scripts"></a>Автоматизация с помощью сценариев

### <a name="azure-cli"></a>Инфраструктура CLI Azure

[!code-azurecli[main](../../cli_scripts/app-service/configure-ssl-certificate/configure-ssl-certificate.sh?highlight=3-5 "Bind a custom SSL certificate to a web app")] 

### <a name="powershell"></a>PowerShell

[!code-powershell[main](../../powershell_scripts/app-service/configure-ssl-certificate/configure-ssl-certificate.ps1?highlight=1-3 "Bind a custom SSL certificate to a web app")]

## <a name="more-resources"></a>Дополнительные ресурсы

* [Принудительное использование HTTPS](app-service-web-tutorial-custom-ssl.md#enforce-https)
* [Принудительное применение TLS 1.1/1.2](app-service-web-tutorial-custom-ssl.md#enforce-tls-versions)
* [Использование SSL-сертификата в коде приложения службы приложений Azure](app-service-web-ssl-cert-load.md)
* [FAQ: SSL certificates for Web Apps and App Service Certificates](https://blogs.msdn.microsoft.com/appserviceteam/2017/07/24/faq-app-service-certificates/) (SSL-сертификаты для веб-приложений и сертификаты Службы приложений: вопросы и ответы)
