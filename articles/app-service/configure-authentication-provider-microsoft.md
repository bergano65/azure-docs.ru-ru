---
title: Настройка проверки подлинности Майкрософт
description: Сведения о настройке проверки подлинности учетной записи Майкрософт в качестве поставщика удостоверений для приложения в Службе приложений или службе "Функции Azure".
ms.assetid: ffbc6064-edf6-474d-971c-695598fd08bf
ms.topic: article
ms.date: 08/08/2019
ms.custom:
- seodec18
- fasttrack-edit
ms.openlocfilehash: 68af882bf240b354bdad1afe322135c048576ed4
ms.sourcegitcommit: 318d1bafa70510ea6cdcfa1c3d698b843385c0f6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2020
ms.locfileid: "83772842"
---
# <a name="configure-your-app-service-or-azure-functions-app-to-use-microsoft-account-login"></a>Настройка приложения в Службе приложений или службе "Функции Azure" для использования входа по учетной записи Майкрософт

[!INCLUDE [app-service-mobile-selector-authentication](../../includes/app-service-mobile-selector-authentication.md)]

В этой статье показано, как настроить в Службе приложений Azure или Функциях Azure взаимодействие с AAD для поддержки входа с использованием личных учетных записей Майкрософт.

> [!NOTE]
> Как личные, так и рабочие учетные записи Майкрософт используют поставщик удостоверений AAD. В настоящее время нет возможности настроить поддержку обоих типов входа для этого поставщика удостоверений.

## <a name="register-your-app-with-microsoft-account"></a><a name="register-microsoft-account"> </a>Регистрация приложения с использованием учетной записи Майкрософт

1. Перейдите на страницу [**Регистрация приложений**](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade) на портале Azure. Если потребуется, войдите в систему с учетной записью Майкрософт.
1. Выберите **Новая регистрация** и введите имя приложения.
1. В поле **Поддерживаемые типы учетных записей** выберите вариант **Учетные записи в любом каталоге организации (любой каталог Azure AD — мультитенантный) и персональные учетные записи Майкрософт (например, Skype, Xbox)** .
1. В разделе **URI перенаправления** выберите **Интернет** и введите `https://<app-domain-name>/.auth/login/aad/callback`. Замените заполнитель *\<app-domain-name>* доменным именем реального приложения.  Например, `https://contoso.azurewebsites.net/.auth/login/aad/callback`. Убедитесь, что в URL-адресе используется схема HTTPS.

1. Выберите **Зарегистрировать**.
1. Скопируйте значение в поле **Идентификатор приложения (клиента)** . Он понадобится вам позднее.
1. На панели слева выберите **Сертификаты и секреты** > **Новый секрет клиента**. Введите описание, выберите срок действия и щелкните **Добавить**.
1. Скопируйте значение, которое отображается на странице **Сертификаты и секреты**. Если страница закроется, это значение больше не отобразится.

    > [!IMPORTANT]
    > Значение секрета (пароля) клиента используется как учетные данные и является важным элементом системы безопасности. Не сообщайте пароль никому и не раскрывайте его в клиентском приложении.

## <a name="add-microsoft-account-information-to-your-app-service-application"></a><a name="secrets"> </a>Добавление данных об учетной записи Майкрософт в приложение Службы приложений

1. Найдите нужное приложение на [Портал Azure].
1. Последовательно выберите **Параметры** > **Аутентификация или авторизация** и установите для параметра **Проверка подлинности Службы приложений** значение **Вкл**.
1. В разделе **Поставщики проверки подлинности** выберите **Azure Active Directory**. В разделе **Дополнительно** выберите **Режим управления**. Вставьте значения идентификатора приложения (клиента) и секрета клиента, полученные ранее. Укажите **`https://login.microsoftonline.com/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0`** в поле **URL-адрес издателя**.
1. Щелкните **ОК**.

   Служба приложений обеспечивает проверку подлинности, но не ограничивает авторизованный доступ к содержимому сайта и API. Авторизация пользователей должна быть включена в код приложения.

1. (Необязательно.) Чтобы предоставлять доступ только учетным записям Майкрософт, установите для параметра **Предпринимаемое действие, если проверка подлинности для запроса не выполнена** значение **Войти с использованием Azure Active Directory**. При установке этой функции приложению требуется выполнить проверку подлинности всех запросов. Также она перенаправляет все запросы, не прошедшие проверку подлинности, в AAD для проверки подлинности. Обратите внимание, что проверка подлинности будет успешной только для личных учетных записей, так как для параметра **URL-адрес поставщика** вы указали адрес арендатора учетной записи Майкрософт.

   > [!CAUTION]
   > Таким образом, ограниченный доступ применяется ко всем вызовам приложения, что может быть нежелательно для приложений, у которых есть общедоступная домашняя страница (как во многих одностраничных приложениях). Для таких приложений, возможно, стоит установить параметр **Разрешить анонимные запросы (нет действия)** , чтобы приложение самостоятельно обрабатывало проверку подлинности. Дополнительные сведения см. в разделе [Поток проверки подлинности](overview-authentication-authorization.md#authentication-flow).

1. Щелкните **Сохранить**.

Теперь вы можете использовать учетную запись Майкрософт для проверки подлинности в приложении.

## <a name="next-steps"></a><a name="related-content"> </a>Дальнейшие действия

[!INCLUDE [app-service-mobile-related-content-get-started-users](../../includes/app-service-mobile-related-content-get-started-users.md)]

<!-- URLs. -->

[My Applications]: https://go.microsoft.com/fwlink/p/?LinkId=262039
[Портал Azure]: https://portal.azure.com/
