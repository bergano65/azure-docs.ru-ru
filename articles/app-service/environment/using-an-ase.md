---
title: Использование и управление Среда службы приложений
description: Узнайте, как создавать, публиковать и масштабировать приложения в Среда службы приложений. Поиск всех типичных задач в этой статье.
author: ccompy
ms.assetid: a22450c4-9b8b-41d4-9568-c4646f4cf66b
ms.topic: article
ms.date: 5/10/2020
ms.author: ccompy
ms.custom: seodec18
ms.openlocfilehash: 64798e22a893c87a17e3f17077860537c7694c40
ms.sourcegitcommit: cee72954f4467096b01ba287d30074751bcb7ff4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/30/2020
ms.locfileid: "87448197"
---
# <a name="use-an-app-service-environment"></a>Использование среды службы приложений

Среда службы приложений (ASE) — это развертывание службы приложений Azure в подсети в экземпляре виртуальной сети Azure клиента. ASE состоит из следующих компонентов:

- **Внешние интерфейсы**: где HTTP или HTTPS завершается в среда службы приложений
- **Рабочие роли**: ресурсы, в которых размещены ваши приложения
- **База данных**: содержит сведения, определяющие окружение.
- **Хранилище**: используется для размещения опубликованных клиентом приложений.

Вы можете развернуть ASE с внешним или внутренним виртуальным IP-адресом (VIP) для доступа к приложениям. Развертывание с внешним виртуальным IP-адресом обычно называется *внешним ASE*. Развертывание с внутренним виртуальным IP-адресом называется *ilB ASE* , так как оно использует внутренний балансировщик нагрузки (ilB). Дополнительные сведения об ASE с ILB см. в статье [Создание и использование внутренней подсистемы балансировки нагрузки со средой службы приложений][MakeILBASE].

## <a name="create-an-app-in-an-ase"></a>Создание приложения в ASE

Чтобы создать приложение в ASE, используйте тот же процесс, что и при обычном создании приложения, но с небольшими различиями. При создании плана службы приложений:

- Вместо выбора географического расположения, в котором будет развернуто приложение, выберите ASE в качестве расположения.
- Все планы службы приложений, созданные в ASE, могут иметь только изолированную ценовую категорию.

Если у вас нет ASE, можно создать его, следуя инструкциям в разделе [создание среда службы приложений][MakeExternalASE].

Создание приложения в ASE.

1. Выберите **создать ресурс**  >  **Интернет и мобильные устройства**  >  **веб-приложение**.

1. Введите имя приложения. Если вы уже выбрали план службы приложений в ASE, доменное имя приложения будет соответствовать доменному имени ASE:

    ![Выбор имени приложения][1]

1. Выберите подписку.

1. Введите имя для новой группы ресурсов или щелкните **Использовать существующий** и выберите вариант имени из раскрывающегося списка.

1. Выберите используемую операционную систему.

1. Выберите имеющийся план службы приложений в своей среде ASE или создайте его, сделав следующее:

    a. В портал Azure левой части меню выберите **создать ресурс > веб-приложение**.

    b. Выберите подписку.

    c. Выберите или создайте группу ресурсов.

    d. Введите имя веб-приложения.

    д. Выберите **код** или **доккерконтаинер**.

    е) Выберите стек среды выполнения.

    ж. Выберите **Linux** или **Windows**. 

    h. Выберите ASE в раскрывающемся списке **регион** . 

    i. Выберите или создайте новый план службы приложений. При создании нового плана службы приложений выберите соответствующий размер **изолированного** SKU.

    ![Ценовая категория Isolated][2]

    > [!NOTE]
    > Приложения Linux и приложения Windows не могут находиться в одном плане службы приложений, но могут находиться в одном Среда службы приложений.
    >

1. Выберите **Проверка + создать**, убедитесь, что сведения верны, а затем нажмите кнопку **создать**.

## <a name="how-scale-works"></a>Как работает масштабирование

Каждая служба приложений выполняется в плане службы приложений. В средах службы приложений содержатся планы службы приложений, которые в свою очередь содержат приложения. При масштабировании приложения также масштабируется план службы приложений и все приложения в том же плане.

При масштабировании плана службы приложений необходимая инфраструктура добавляется автоматически. Существует временная задержка для масштабирования операций во время добавления инфраструктуры. Если выполнить несколько операций масштабирования последовательно, первый запрос на масштабирование инфраструктуры будет обрабатываться, а другие — в очереди. По завершении первой операции масштабирования все запросы инфраструктуры работают вместе. При добавлении инфраструктуры планы службы приложений назначаются соответствующим образом. Создание нового плана службы приложений — это операция масштабирования, так как она требует дополнительного оборудования.

В службе приложений для клиентов масштабирование выполняется немедленно, так как для его поддержки доступен пул ресурсов. В ASE нет такого буфера, и ресурсы выделяются в зависимости от нужды.

В ASE можно масштабировать план службы приложений до 100 экземпляров. ASE может иметь до 201 всего экземпляров во всех планах службы приложений в этой ASE.

## <a name="ip-addresses"></a>IP-адреса

Служба приложений может выделить для приложения выделенный IP-адрес. Эта возможность доступна после настройки SSL на основе IP-адреса, как описано в статье [Привязка существующего настраиваемого сертификата TLS/SSL к службе приложений Azure][ConfigureSSL]. В ILB ASE нельзя добавить дополнительные IP-адреса, которые будут использоваться для SSL на основе IP-адресов.

С помощью внешнего ASE можно настроить SSL на основе IP для приложения так же, как и в службе многоклиентских приложений. В ASE всегда есть один запасной адрес, до 30 IP-адресов. Каждый раз, когда вы используете одну, добавляется другой, чтобы адрес всегда был доступен. Для выделения другого IP-адреса требуется временная задержка. Эта задержка предотвращает быстрое добавление IP-адресов.

## <a name="front-end-scaling"></a>Масштабирование внешнего интерфейса

При масштабировании планов службы приложений для их поддержки автоматически добавляются рабочие роли. Каждый ASE создается с двумя внешними интерфейсами. Внешний интерфейс автоматически масштабируется по скорости одного внешнего интерфейса для каждого набора из 15 экземпляров плана службы приложений. Например, если у вас есть три плана службы приложений с пятью экземплярами, то у вас будет всего 15 экземпляров и три внешних интерфейса. Если выполнить масштабирование до 30 экземпляров, у вас будет четыре внешних интерфейса. Этот шаблон будет продолжаться при горизонтальном масштабировании.

Число внешних интерфейсов, выделенных по умолчанию, хорошо для средней нагрузки. Можно уменьшить соотношение до одного внешнего интерфейса для каждых пяти экземпляров. Также можно изменить размер внешних интерфейсов. По умолчанию они являются одним ядром. В портал Azure можно изменить их размер на два или четыре ядра.

За изменение соотношения или размеров внешних интерфейсов взимается плата. Дополнительные сведения см. на странице [цен на службу приложений Azure][Pricing]. Если вы хотите увеличить емкость ASE, вы получите дополнительные улучшения, выполнив масштабирование до двух основных интерфейсов, прежде чем изменять коэффициент масштабирования. Изменение основного размера внешних интерфейсов приведет к обновлению ASE и должно выполняться за пределами обычного рабочего времени.

Ресурсы внешних интерфейсов являются конечной точкой HTTP/HTTPS для среды ASE. При сохранении конфигурации внешних интерфейсов по умолчанию показатель использования памяти на каждый внешний интерфейс обычно составляет примерно 60 %. Основная причина масштабирования внешних интерфейсов — загрузка ЦП, которая в основном управляется трафиком HTTPS.

## <a name="app-access"></a>Доступ к приложениям

Во внешнем ASE суффиксом домена, используемым для создания приложения, является *. &lt; asename &gt; . p.azurewebsites.NET*. Если ASE имеет имя _External-ASE_ и вы размещаете приложение _contoso_ в этом ASEе, вы дойдете его по следующим URL-адресам:

- contoso.external-ase.p.azurewebsites.net
- contoso.scm.external-ase.p.azurewebsites.net

Сведения о создании внешнего ASE см. в разделе [создание среда службы приложений][MakeExternalASE].

В ILB ASE суффикс домена, используемый для создания приложения, — это *. &lt; asename &gt; . appserviceenvironment.NET*. Если ASE имеет имя _ilB-ASE_ и вы размещаете приложение _contoso_ в этом ASE, вы пойдете по следующим URL-адресам:

- contoso.ilb-ase.appserviceenvironment.net
- contoso.scm.ilb-ase.appserviceenvironment.net

Сведения о создании ASE ILB см. в статье [Создание и использование ilB ASE][MakeILBASE].

URL-адрес SCM используется для доступа к консоли KUDU или для публикации приложения с помощью веб-развертывание. Сведения о консоли Kudu см. на странице [Kudu console for Azure App Service][Kudu] (Консоль Kudu для службы приложений Azure). Консоль Kudu предоставляет веб-интерфейс для отладки, передачи и редактирования файлов, а также многих других возможностей.

### <a name="dns-configuration"></a>Настройка DNS 

При использовании внешнего ASE приложения, сделанные в ASE, регистрируются в Azure DNS. В внешних ASE нет дополнительных шагов, чтобы ваши приложения были общедоступными. С помощью ILB ASE необходимо управлять собственными DNS. Это можно сделать на собственном DNS-сервере или с помощью Azure DNS частных зон.

Чтобы настроить DNS на собственном DNS-сервере с помощью ILB ASE, выполните следующие действия.

1. создайте зону для &lt;имя_ASE&gt;.appserviceenvironment.net;
1. создайте запись A в этой зоне, которая указывает (*) на IP-адрес внутренней подсистемы балансировки нагрузки;
1. создайте запись A в этой зоне, которая указывает (@) на IP-адрес внутренней подсистемы балансировки нагрузки.
1. создайте зону scm в &lt;имя_ASE&gt;.appserviceenvironment.net;
1. создайте запись A в зоне scm, которая указывает (*) на IP-адрес внутренней подсистемы балансировки нагрузки.

Чтобы настроить DNS в частных зонах Azure DNS, выполните следующие действия.

1. Создайте Azure DNSую частную зону с именем &lt; ASE Name &gt; . appserviceenvironment.NET
1. создайте запись A в этой зоне, которая указывает (*) на IP-адрес внутренней подсистемы балансировки нагрузки;
1. создайте запись A в этой зоне, которая указывает (@) на IP-адрес внутренней подсистемы балансировки нагрузки.
1. Создайте в этой зоне запись A, указывающую *. SCM на IP-адрес ILB.

Параметры DNS для суффикса домена по умолчанию ASE не ограничивают доступ к приложениям только по этим именам. Вы можете задать имя личного домена без проверки приложений в ILB ASE. Если вы хотите создать зону с именем *contoso.NET*, это можно сделать и указать на IP-адрес ilB. Имя пользовательского домена работает для запросов приложений, но не для сайта SCM. Сайт SCM доступен только в * &lt; AppName &gt; . SCM. &lt; asename &gt; . appserviceenvironment.NET*. 

Зона с именем *. &lt; asename &gt; . appserviceenvironment.NET* является глобально уникальным. До 2019 мая клиенты смогли указать суффикс домена ILB ASE. Если вы хотите использовать *. contoso.com* для суффикса домена, это можно сделать и включить сайт SCM. С этой моделью возникли проблемы, включая. Управление SSL-сертификатом по умолчанию, отсутствие единого входа с сайтом SCM и требование использования подстановочного сертификата. Процесс обновления сертификата ILB ASE по умолчанию также привело к нарушению работы и привел к перезапуску приложения. Для решения этих проблем поведение ILB ASE было изменено для использования суффикса домена на основе имени ASE и суффикса, принадлежащего корпорации Майкрософт. Изменение поведения ILB ASE влияет только на ILB среды ASE, выполненные после 2019 мая. Существовавший ранее ILB среды ASE должен по-прежнему управлять сертификатом по умолчанию ASE и их конфигурацией DNS.

## <a name="publishing"></a>Публикация

В ASE, как и в службе многоклиентских приложений, вы можете опубликовать эти методы:

- Веб-развертывание
- FTP
- Непрерывная интеграция (CI)
- функция перетаскивания в консоли Kudu;
- Интегрированная среда разработки, например Visual Studio, Eclipse или IntelliJ

При использовании внешнего ASE эти параметры публикации работают одинаково. Дополнительные сведения см. в статье [Развертывание приложения в службе приложений Azure][AppDeploy].

В ILB ASE конечные точки публикации доступны только через ILB. Внутренняя подсистема балансировки нагрузки расположена на частном IP-адресе в подсети ASE в виртуальной сети. Если у вас нет сетевого доступа к ILB, вы не сможете опубликовать приложения на этом ASE. Как отмечалось при [создании и использовании ilB ASE][MakeILBASE], необходимо настроить DNS для приложений в системе. Это требование включает конечную точку SCM. Если конечные точки не определены должным образом, опубликовать нельзя. IDE также должен иметь сетевой доступ к ILB для непосредственной публикации.

Без дополнительных изменений такие системы непрерывной интеграции на основе Интернета, как GitHub и Azure DevOps, не работают с ASE ILB, так как конечная точка публикации не доступна в Интернете. Вы можете включить публикацию в ILB ASE из DevOps Azure, установив собственный агент выпуска в виртуальной сети, содержащей ILB ASE. Кроме того, можно использовать систему CI, которая использует модель извлечения, например Dropbox.

Для конечных точек публикации приложений в среде ASE с ILB используется домен, созданный вместе со средой. Его можно увидеть в профиле публикации приложения и в области портала приложения (в разделе **Обзор**  >  **основы** и также в разделе **Свойства**).

## <a name="storage"></a>Служба хранилища

У ASE есть 1 ТБ хранилища для всех приложений в ASE. План службы приложений в SKU "изолированная цена" имеет ограничение в 250 ГБ. В ASE хранилище 250 ГБ добавляется в план службы приложений вплоть до ограничения в 1 ТБ. Вы можете использовать больше планов службы приложений, чем четыре, но больше не нужно добавлять хранилище сверх ограничения в 1 ТБ.

## <a name="logging"></a>Logging

Вы можете интегрировать ASE с Azure Monitor для отправки журналов о ASE в службу хранилища Azure, в концентраторы событий Azure или Log Analytics. Эти элементы регистрируются сегодня:

| Ситуация | Сообщение |
|---------|----------|
| ASE неработоспособен | Указанный ASE является неработоспособным из-за недопустимой конфигурации виртуальной сети. Если неработоспособное состояние продолжает работать, ASE будет приостановлен. Убедитесь, что выполнены указанные здесь рекомендации: https://docs.microsoft.com/azure/app-service/environment/network-info . |
| В подсети ASE почти недостаточно свободного пространства | Указанный ASE находится в подсети, в которой почти не хватает свободного пространства. Существуют {0} оставшиеся адреса. Когда эти адреса будут исчерпаны, ASE не сможет масштабироваться.  |
| ASE приближается к общему ограничению экземпляров | Указанный ASE приближается к общему ограничению экземпляра ASE. В настоящее время он содержит {0} экземпляры плана службы приложений максимум 201 экземпляров. |
| ASE не удалось связаться с зависимостью | Указанный ASE не может быть достигнут {0} .  Убедитесь, что выполнены указанные здесь рекомендации: https://docs.microsoft.com/azure/app-service/environment/network-info . |
| ASE приостановлен | Указанный ASE приостановлен. Приостановка ASE может быть вызвана тем, что учетная запись шортфалл или недопустимая конфигурация виртуальной сети. Устраните основную причину и возобновите ASE, чтобы продолжить обслуживание трафика. |
| Начато обновление ASE | Начато обновление платформы до указанного ASE. В операциях масштабирования должны возникать задержки. |
| Обновление ASE завершено | Обновление платформы до указанного ASE завершено. |
| Операции масштабирования запущены | План службы приложений ( {0} ) начал масштабирование. Требуемое состояние {1} : {2} сотрудники.
| Операции масштабирования завершены | Масштабирование плана службы приложений ( {0} ) завершено. Текущее состояние: {1} {2} исполнители. |
| Сбой операций масштабирования | Не удалось масштабировать план службы приложений ( {0} ). Текущее состояние: {1} {2} исполнители. |

Чтобы включить ведение журнала в ASE, выполните следующие действия.

1. На портале выберите **параметры диагностики**.
1. Выберите **Добавить параметр диагностики**.
1. Укажите имя для интеграции журналов.
1. Выберите и настройте нужные назначения журналов.
1. Выберите **аппсервицеенвиронментплатформлогс**.

![Параметры журнала диагностики ASE][4]

При интеграции с Log Analytics можно просмотреть журналы, выбрав **журналы** на портале ASE и создав запрос к **аппсервицеенвиронментплатформлогс**. Журналы создаются только в том случае, если у ASE есть событие, которое запустит его. Если у вашего ASE нет такого события, журналы не будут существовать. Чтобы быстро просмотреть пример журналов в рабочей области Log Analytics, выполните операцию масштабирования с одним из планов службы приложений в ASE. Затем можно выполнить запрос к **аппсервицеенвиронментплатформлогс** , чтобы просмотреть эти журналы. 

**Создание предупреждения**

Чтобы создать оповещение для журналов, следуйте инструкциям в статье [Создание, просмотр и Управление оповещениями журнала с помощью Azure Monitor][logalerts]. Краткое описание

* Открытие страницы "оповещения" на портале ASE
* Выберите **новое правило генерации оповещений**
* Выберите ресурс для рабочей области Log Analytics
* Задайте условие с помощью пользовательского поиска по журналам, чтобы использовать запрос, например "Аппсервицеенвиронментплатформлогс | где Ресултдескриптион содержит "начало масштабирования" или что угодно. Установите соответствующее пороговое значение. 
* При необходимости добавьте или создайте группу действий. Группа действий определяет реакцию на предупреждение, например отправку сообщения электронной почты или SMS.
* Назовите оповещение и сохраните его.

## <a name="upgrade-preference"></a>Параметры обновления

При наличии нескольких среды ASE может потребоваться обновить некоторые среды ASE перед другими. В объекте ASE **HostingEnvironment диспетчер ресурсов** можно задать значение для **упградепреференце**. Параметр **упградепреференце** можно настроить с помощью шаблона, ARMClient или https://resources.azure.com . Возможны следующие три значения:

- **Нет**. Azure обновит ASE без какого бы то ни было конкретного пакета. Это значение по умолчанию.
- **Рано**. ваш ASE будет обновлен в первой половине обновлений службы приложений.
- **Позднее**: ваш ASE будет обновлен во второй половине обновлений службы приложений.

Если вы используете https://resources.azure.com , выполните следующие действия, чтобы задать значение **упградепреференцес** :

1. Перейдите по адресу resources.azure.com и войдите с помощью своей учетной записи Azure.
1. Пройдите по адресу подписки Resources to Subscriptions \/ \[ Name \] \/ resourceGroups имя \/ \[ группы ресурсов \] \/ providers \/ Microsoft. Web \/ hostingEnvironments \/ \[ ASE Name \] .
1. В верхней части выберите **чтение и запись** .
1. Нажмите кнопку **Изменить**.
1. Задайте для **упградепреференце** любое из трех значений.
1. Выберите **исправление**.

![ресурсы, отображаемые в Azure com][5]

Функция **упградепреференцес** наиболее важна при наличии нескольких среды ASE, так как "раннее" среды ASE будет обновлен до "поздней" среды ASE. Если у вас несколько среды ASE, следует задать для разработки и тестирования среды ASE значение "рано", а рабочий среды ASE — "поздно".

## <a name="pricing"></a>Цены

SKU ценообразования под названием " *изолированный* " предназначен для использования только с среды ASE. Все планы службы приложений, размещенные в ASE, относятся к категории SKU "изолированная цена". Изолированные тарифы для планов службы приложений могут различаться по регионам.

Помимо цены на планы службы приложений, существует фиксированная ставка для самого ASE. Фиксированная ставка не изменяется с учетом размера ASE. Он оплачивает инфраструктуру ASE с коэффициентом масштабирования по умолчанию для одного дополнительного внешнего интерфейса для каждых 15 экземпляров плана службы приложений.

Если коэффициент масштабирования по умолчанию для одного внешнего интерфейса для каждых 15 экземпляров плана службы приложений не достаточен, можно настроить отношение, в котором добавляются внешние интерфейсы, или размер внешних интерфейсов. При изменении этого соотношения или размера оплачивается число ядер внешних интерфейсов, которые не были бы добавлены при использовании параметров по умолчанию.

Например, если установить значение коэффициента масштабирования 10, то внешний интерфейс будет добавляться для каждых 10 экземпляров в планах службы приложений. Фиксированная плата охватывает масштаб "1 внешний интерфейс на каждые 15 экземпляров". При значении коэффициента масштабирования 10 вам придется заплатить за третий внешний интерфейс, который добавляется при 10 экземплярах плана службы приложений. Но когда число дойдет до 15 экземпляров, вам не нужно будет ничего доплачивать, так как интерфейс был бы добавлен автоматически.

Если изменить размер внешних интерфейсов на два ядра, но не скорректировать соотношение, вы платите за дополнительные ядра. ASE создается с двумя внешними интерфейсами, поэтому даже под пороговым значением автоматического масштабирования можно платить за два дополнительных ядра, если увеличить размер до двух основных интерфейсов.

Дополнительные сведения см. на странице [цен на службу приложений Azure][Pricing].

## <a name="delete-an-ase"></a>Удаление ASE

Чтобы удалить ASE, сделайте следующее:

1. Выберите **Удалить** в верхней части области **Среда службы приложений** .

1. Введите имя среды ASE, чтобы подтвердить ее удаление. При удалении ASE также удаляется все содержимое внутри него.

    ![Удаление ASE][3]

1. Нажмите кнопку **ОК**.

## <a name="ase-cli"></a>ASE CLI

Существуют возможности командной строки для администрирования в ASE.  Ниже перечислены команды AZ CLI.

```azurecli
C:\>az appservice ase --help

Group
    az appservice ase : Manage App Service Environments v2.
        This command group is in preview. It may be changed/removed in a future release.
Commands:
    create         : Create app service environment.
    delete         : Delete app service environment.
    list           : List app service environments.
    list-addresses : List VIPs associated with an app service environment.
    list-plans     : List app service plans associated with an app service environment.
    show           : Show details of an app service environment.
    update         : Update app service environment.

For more specific examples, use: az find "az appservice ase"
```



<!--Image references-->
[1]: ./media/using_an_app_service_environment/usingase-appcreate.png
[2]: ./media/using_an_app_service_environment/usingase-pricingtiers.png
[3]: ./media/using_an_app_service_environment/usingase-delete.png
[4]: ./media/using_an_app_service_environment/usingase-logsetup.png
[4]: ./media/using_an_app_service_environment/usingase-logs.png
[5]: ./media/using_an_app_service_environment/usingase-upgradepref.png

<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/security-overview.md
[ConfigureASEv1]: app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: app-service-app-service-environment-intro.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: https://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/management/overview.md
[ConfigureSSL]: ../configure-ssl-certificate.md
[Kudu]: https://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../deploy-local-git.md
[ASEWAF]: app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
[logalerts]: ../../azure-monitor/platform/alerts-log.md
