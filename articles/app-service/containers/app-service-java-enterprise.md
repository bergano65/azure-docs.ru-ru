---
title: Поддержка Java Enterprise для Службы приложений Azure в Linux | Документация Майкрософт
description: Руководство разработчика по развертыванию приложений Java Enterprise с помощью Wildfly и Службы приложений Azure в Linux.
keywords: azure app service, web app, linux, oss, java, wildfly, enterprise
services: app-service
author: rloutlaw
manager: angerobe
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: java
ms.topic: article
ms.date: 08/29/2018
ms.author: routlaw
ms.custom: seodec18
ms.openlocfilehash: 408141650a11a81f0c6000c6e7927af8333e2afe
ms.sourcegitcommit: 71ee622bdba6e24db4d7ce92107b1ef1a4fa2600
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/17/2018
ms.locfileid: "53548482"
---
# <a name="java-enterprise-guide-for-app-service-on-linux"></a>Руководство разработчика по Java Enterprise для Службы приложений в Linux

Служба приложений Azure в Linux позволяет разработчикам Java создавать, развертывать и масштабировать приложения Java Enterprise (JEE) в полностью управляемой службе на базе Linux.  Базовой средой выполнения Java Enterprise является сервер приложений [Wildfly](https://wildfly.org/) в открытым кодом.

Это руководство содержит основные понятия и инструкции для разработчиков Java Enterprise, использующих Службу приложений в Linux. Если вы раньше не использовали Службу приложений Azure в Linux для разработки приложений Java, мы рекомендуем сначала ознакомиться с [кратким руководством по Java](quickstart-java.md). См. ответы на вопросы об использовании Службы приложений в Linux, не относящиеся к разработке для Java Enterprise, [здесь](app-service-linux-java.md) и [здесь](app-service-linux-faq.md).

## <a name="scale-with-app-service"></a>Масштабирование с помощью Службы приложений 

Сервер приложений WildFly работает в Службе приложений на платформе Linux в автономном режиме, а не в конфигурации домена. При масштабировании плана службы приложений каждый экземпляр WildFly настраивается как отдельный сервер.

 Вы можете выполнять вертикальное или горизонтальное масштабирование своего приложения, придерживаясь [правил масштабирования](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-autoscale-get-started?toc=%2Fazure%2Fapp-service%2Fcontainers%2Ftoc.json) и [увеличивая число экземпляров](https://docs.microsoft.com/azure/app-service/web-sites-scale?toc=%2fazure%2fapp-service%2fcontainers%2ftoc.json). 

## <a name="customize-application-server-configuration"></a>Настройка параметров сервера приложений

В экземплярах веб-приложений не отслеживается состояние, поэтому каждый новый экземпляр необходимо настроить при запуске для поддержки конфигурации WildFly, необходимой для приложения.
Вы можете написать скрипт запуска Bash для вызова интерфейса командной строки WildFly и выполнения таких действий:

- настройка источников данных;
- настройка поставщиков службы обмена сообщениями;
- добавление других модулей и зависимостей Wildfly в конфигурацию сервера.

 Скрипт выполняется после запуска Wildfly, но перед запуском приложения. Для настройки запущенного сервера приложений с применением требуемых конфигурации или изменений скрипт должен использовать [интерфейс командной строки JBOSS](https://docs.jboss.org/author/display/WFLY/Command+Line+Interface), вызываемый из `/opt/jboss/wildfly/bin/jboss-cli.sh`. 

Не используйте для настройки Wildfly интерактивный режим интерфейса командной строки. Вместо этого можно передать скрипт с командами в интерфейс командной строки JBoss с помощью команды `--file`, например:

```bash
/opt/jboss/wildfly/bin/jboss-cli.sh -c --file=/path/to/your/jboss_commands.cli
```

Отправьте скрипт запуска в каталог `/home/site/deployments/tools` своего экземпляра Службы приложений. См. инструкции по [получению учетных данных FTP](/azure/app-service/deploy-configure-credentials#userscope). 

Укажите в поле **Сценарий запуска** на портале Azure расположение скрипта запуска оболочки, например `/home/site/deployments/tools/your-startup-script.sh`.

Укажите [параметры приложения](/azure/app-service/web-sites-configure#application-settings) в конфигурации приложения, чтобы передать переменные среды для использования в скрипте. В параметрах приложения хранятся строки подключения и другие секретные данные, необходимые для настройки приложения из системы управления версиями.

## <a name="modules-and-dependencies"></a>Модули и зависимости

Чтобы установить модули и связанные зависимости в пути к классам Wildfly из интерфейса командной строки JBoss, нужно создать следующие файлы в соответствующем каталоге.  Для некоторых модулей и зависимостей может понадобиться дополнительная настройка (например, JNDI или других API). Следующий список включает минимальный набор параметров для настройки зависимостей, применимый в большинстве случаев.

- [Дескриптор модуля XML](https://jboss-modules.github.io/jboss-modules/manual/#descriptors). Этот XML-файл определяет имя, атрибуты и зависимости вашего модуля. Этот [пример файла module.xml](https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform/6/html/administration_and_configuration_guide/example_postgresql_xa_datasource) определяет модуль Postgres, зависимость JDBC (файл с расширением .jar) и другие требуемые зависимости модуля.
- Все необходимые зависимости для вашего модуля (файлы с расширением .jar).
- Скрипт с командами интерфейса командной строки JBoss CLI для настройки нового модуля. Этот файл будет содержать команды для выполнения в интерфейсе командной строки JBoss, благодаря которым сервер сможет использовать зависимости. См. [документацию по командам для добавления модулей, источников данных и поставщиков службы обмена сообщениями ](https://access.redhat.com/documentation/red_hat_jboss_enterprise_application_platform/7.0/html-single/management_cli_guide/#how_to_cli).
-  Скрипт запуска Bash для вызова интерфейса командной строки JBoss и выполнения скрипта из предыдущего шага. Этот файл будет выполняться при перезапуске экземпляра Службы приложений или подготовке новых экземпляров в ходе горизонтального масштабирования.  Этот скрипт запуска позволяет реализовать и другие конфигурации для приложения, так как команды JBoss передаются в интерфейс командной строки JBoss. Как минимум, этот файл можно использовать как отдельную команду для передачи соответствующего скрипта JBoss в интерфейс командной строки JBoss: 
   
```bash
`/opt/jboss/wildfly/bin/jboss-cli.sh -c --file=/path/to/your/jboss_commands.cli` 
``` 

Получив файлы и содержимое для модуля, выполните следующие действия, чтобы добавить модуль Wildfly на сервер приложений. 

1. Передайте файлы по FTP в каталог `/home/site/deployments/tools` своего экземпляра Службы приложений. См. инструкции по получению учетных данных FTP. 
2. В колонке "Параметры приложения" на портале Azure, укажите в поле "Скрипт запуска" расположение скрипта запуска оболочки, например `/home/site/deployments/tools/your-startup-script.sh`.
3. Перезапустите экземпляр Службы приложений, нажав клавишу **Перезапустить** в разделе **Обзор** на портале или используя Azure CLI.

## <a name="data-sources"></a>Источники данных

Процесс настройки Wildfly для подключения к источнику данных аналогичен действиям, описанным выше в разделе "Установка модулей и зависимостей". Эти действия можно выполнять для любой службы базы данных Azure.

1. Скачайте драйвер JDBC для своей версии базы данных. Отсюда можно скачать драйверы для [Postgres](https://jdbc.postgresql.org/download.html) и [MySQL](https://dev.mysql.com/downloads/connector/j/). Распакуйте архив, чтобы получить файл с расширением .jar.
2. Выполните действия, описанные в разделе "Модули и зависимости", чтобы создать и передать дескриптор модуля XML, скрипт интерфейса командной строки JBoss CLI, скрипт запуска и JDBC-зависимость (файл с расширением .jar).


См. дополнительные сведения о настройке Wildfly для использования с [PostgreSQL](https://developer.jboss.org/blogs/amartin-blog/2012/02/08/how-to-set-up-a-postgresql-jdbc-driver-on-jboss-7), [MySQL](https://docs.jboss.org/jbossas/docs/Installation_And_Getting_Started_Guide/5/html/Using_other_Databases.html#Using_other_Databases-Using_MySQL_as_the_Default_DataSource) и [Базы данных SQL](https://docs.jboss.org/jbossas/docs/Installation_And_Getting_Started_Guide/5/html/Using_other_Databases.html#d0e3898). Чтобы добавить определения источников данных на сервер, можно использовать разные подходы.

## <a name="messaging-providers"></a>Поставщики службы обмена сообщениями

Чтобы включить компоненты, управляемые сообщениями (Message Driven Beans), используя в качестве механизма обмена сообщениями Служебную шину, сделайте следующее:

1. Используйте [библиотеку обмена сообщениями Apache QPId JMS](https://qpid.apache.org/proton/index.html). Включите эту зависимость в файл pom.xml (или другой файл сборки) для приложения.

2.  Создайте [ресурсы Служебной шины](/azure/service-bus-messaging/service-bus-java-how-to-use-jms-api-amqp). Создайте пространство имен Служебной шины Azure и очередь в пределах этого пространства имен, а также политику общего доступа с возможностью отправки и получения.

3. Передайте ключ политики общего доступа в код путем URL-кодирования первичного ключа политики или [используйте для этого пакет SDK Служебной шины](/azure/service-bus-messaging/service-bus-java-how-to-use-jms-api-amqp#setup-jndi-context-and-configure-the-connectionfactory).

4. Выполните шаги, описанные в разделе "Установка модулей и зависимостей", используя дескриптор модуля XML, зависимости .jar, команды интерфейса командной строки JBoss и скрипт запуска для поставщика JMS. В дополнение к существующим четырем файлам вам также нужно создать XML-файл, определяющий имя JNDI для очереди и раздела JMS. См. дополнительные сведения о соответствующих [файлах конфигурации](https://github.com/JasonFreeberg/widlfly-server-configs/tree/master/appconfig).


## <a name="configure-session-management-caching"></a>Настройка кэширования управления сеансами

По умолчанию Служба приложений в Linux будет использовать файлы cookie сходства сеансов, чтобы убедиться, что клиентские запросы с существующими сеансами направляются в один и тот же экземпляр приложения. Это поведение по умолчанию не требует настройки, но имеет некоторые ограничения:

- Если экземпляр приложения перезапущен или его масштаб уменьшен, состояние сеанса пользователя на сервере приложений будет утеряно.
- Если для приложений настроены параметры длительного времени ожидания сеанса или фиксированное число пользователей, автомасштабирование новых экземпляров для получения нагрузки может занять некоторое время, так как только новые сеансы будут направляться в новые запущенные экземпляры.

Вы можете настроить Wildfly для использования внешнего хранилища сеанса, например [кэша Azure для Redis](/azure/azure-cache-for-redis/). Вам нужно будет [отключить сходство существующих экземпляров ARR](https://azure.microsoft.com/blog/disabling-arrs-instance-affinity-in-windows-azure-web-sites/), чтобы отключить маршрутизацию на основе файлов cookie для сеанса и обеспечить бесперебойную работу настроенного хранилища сеансов Wildfly.

## <a name="enable-web-sockets"></a>Включение протокола WebSocket

По умолчанию протокол WebSocket поддерживается в Службе приложений. См. дополнительные сведения о [начале работы с WebSocket в приложении](https://github.com/wildfly/quickstart/tree/master/websocket-hello).

## <a name="logs-and-troubleshooting"></a>Ведение журналов и устранение неполадок

Служба приложений предоставляет средства для устранения проблем с приложением.

-   Включите ведение журналов, щелкнув **Журналы диагностики** в области навигации слева. Щелкните **Файловая система**, чтобы задать квоту хранилища и период хранения, и сохраните изменения. Эти журналы можно найти в каталоге `/home/LogFiles/`.
-   [Используйте SSH для подключения к экземпляру приложения](app-service-linux-ssh-support.md), чтобы просматривать журналы для запущенных приложений.
-   Журналы диагностики можно просматривать на панели **Журналы диагностики** на портале или с помощью команды Azure CLI: ` az webapp log tail --name <your-app-name> --resource-group <your-apps-resource-group> `.
