---
title: Настройка приложений Python для Службы приложений Azure под управлением Linux
description: В этом руководстве описываются возможности создания и настройки приложений Python для Службы приложений Azure под управлением Linux.
services: app-service\web
documentationcenter: ''
author: cephalin
manager: jeconnoc
editor: ''
ms.assetid: ''
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: quickstart
ms.date: 10/09/2018
ms.author: astay;cephalin;kraigb
ms.custom: mvc
ms.openlocfilehash: a29f0f4be6286f8acf367a3ea0b4b0e6b31e7d98
ms.sourcegitcommit: 07a09da0a6cda6bec823259561c601335041e2b9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2018
ms.locfileid: "49406472"
---
# <a name="configure-your-python-app-for-the-azure-app-service-on-linux"></a>Настройка приложений Python для Службы приложений Azure под управлением Linux

В этой статье описывается, как [Служба приложений Azure под управлением Linux](app-service-linux-intro.md) запускает приложения Python, а также как вы можете настроить поведение службы приложений при необходимости.

## <a name="container-characteristics"></a>Характеристики контейнера

Приложения Python, развернутые в службе приложений под управлением Linux, выполняются в контейнере Docker, который определен в репозитории GitHub, [контейнере Azure-App-Service/python](https://github.com/Azure-App-Service/python/tree/master/3.7.0).

Этот контейнер отличается следующими характеристиками.

- Образ базового контейнера — `python-3.7.0-slim-stretch`, это означает, что приложения запускаются с помощью Python 3.7. Если требуется другая версия Python, вместо этого образа контейнера необходимо создать и развернуть собственный. Дополнительные сведения см. в статье [Использование пользовательского образа Docker для платформы "Веб-приложения для контейнеров"](tutorial-custom-docker-image.md).

- Приложения запускаются с помощью [HTTP-сервера Gunicorn WSGI](http://gunicorn.org/), используя дополнительные аргументы `--bind=0.0.0.0 --timeout 600`.

- По умолчанию базовый образ включает в себя веб-платформу Flask, но контейнер также поддерживает другие платформы, совместимые с WSGI и с Python 3.7, например Django.

- Чтобы установить дополнительные пакеты, такие как Django, создайте файл [*requirements.txt*](https://pip.pypa.io/en/stable/user_guide/#requirements-files) в корневой папке проекта, используя `pip freeze > requirements.txt`. Затем опубликуйте проект в службе приложений с помощью развертывания Git, которое автоматически выполняет `pip install -r requirements.txt` в контейнере для установки зависимостей приложения.

## <a name="container-startup-process-and-customizations"></a>Процесс запуска и настройка контейнера

Во время запуска служба приложений под управлением контейнера Linux выполнит следующие действия.

1. Проверит наличие пользовательских команд запуска и применит их, если они указаны.
1. Проверит наличие файла приложения Django *wsgi.py* и, если он есть, запустит Gunicorn с помощью этого файла.
1. Проверит наличие файла с именем *application.py* и, если он найден, запустит Gunicorn с помощью `application:app`, где предполагается приложение Flask.
1. Если другие приложения не найдены, запускается приложение по умолчанию, встроенное в контейнер.

В следующих разделах приведены дополнительные сведения о каждом параметре.

### <a name="django-app"></a>Приложение Django

Для приложений Django служба приложений выполняет поиск файла с именем `wsgi.py` в вашем коде приложения, а затем запускает Gunicorn, используя следующую команду:

```bash
# <module> is the path to the folder containing wsgi.py
gunicorn --bind=0.0.0.0 --timeout 600 <module>.wsgi
```

Если необходим определенный контроль над командой запуска, используйте [пользовательские команды запуска](#custom-startup-command) и замените `<module>` именем модуля, который содержит *wsgi.py*.

### <a name="flask-app"></a>Приложение Flask

Для Flask служба приложений выполняет поиск файла с именем *application.py* и запускает Gunicorn следующим образом:

```bash
gunicorn --bind=0.0.0.0 --timeout 600 application:app
```

Если модуль основного приложения содержится в другом файле, используйте другое имя для объекта приложения или, если вы хотите указать дополнительные аргументы для Gunicorn, используйте [пользовательские команды запуска](#custom-startup-command). В этом разделе приводится пример для Flask с использованием записанного кода в файле *hello.py* и объекта приложения Flask с именем `myapp`.

### <a name="custom-startup-command"></a>Пользовательская команда запуска

Вы можете задать поведение при запуске контейнера, указав пользовательскую команду запуска Gunicorn. Например, если вы используете приложение Flask, главным модулем которого является *hello.py*, и объект приложения Flask в этом файле имеет имя `myapp`, тогда команда будет выглядеть следующим образом:

```bash
gunicorn --bind=0.0.0.0 --timeout 600 hello:myapp
```

Если главный модуль находится в подпапке, например `website`, укажите эту подпапку с помощью аргумента `--chdir`:

```bash
gunicorn --bind=0.0.0.0 --timeout 600 --chdir website hello:myapp
```

Кроме того, вы можете добавить любые дополнительные аргументы в командную строку для Gunicorn, например `--workers=4`. Дополнительные сведения см. в статье [Running Gunicorn](http://docs.gunicorn.org/en/stable/run.html) (Запуск Gunicorn) (docs.gunicorn.org).

Чтобы предоставить пользовательскую команду, выполните следующие действия:

1. Перейдите на страницу [Параметры приложения](../web-sites-configure.md?toc=%2fazure%2fapp-service%2fcontainers%2ftoc.json) на портале Azure.

1. В настройках **среды выполнения** установите для параметра **Стек** значение **Python 3.7** и введите команду непосредственно в поле **Загрузочный файл**.

    Кроме того, вы можете сохранить команду в текстовый файл в корневом каталоге проекта, используя имя, например *startup.txt* (или любое другое). Затем разверните этот файл в службе приложений и замените имя файла в поле **Загрузочный файл**. Этот параметр позволяет управлять командой в репозитории исходного кода, а не на портале Azure.

1. Щелкните **Сохранить**. Служба приложений автоматически перезапустится, и через несколько секунд вы увидите применение команды запуска.

> [!Note]
> Служба приложений игнорирует все ошибки, возникающие при обработке файла с пользовательской командой, и продолжает процесс запуска путем поиска приложений Django и Flask. Если вы не видите ожидаемое поведение, убедитесь, что файл запуска развернут в службе приложений и что в нем нет ошибок.

### <a name="default-behavior"></a>Поведение по умолчанию

Если в службе приложений не найдена пользовательская команда, приложение Django или Flask, тогда она запускает приложение по умолчанию с разрешением только для чтения, расположенное в папке _opt/defaultsite_. Приложение по умолчанию выглядит следующим образом:

![Служба приложений по умолчанию на веб-странице Linux](media/how-to-configure-python/default-python-app.png)

## <a name="troubleshooting"></a>Устранение неполадок

- **После развертывания кода приложения отображается приложение по умолчанию.**  Приложение по умолчанию отображается, потому что вы либо фактически не использовали код приложения для службы приложений, либо она не смогла найти ваш код приложения и вместо этого использовала приложение по умолчанию.
  - Перезапустите службу приложений, подождите 15–20 секунд и снова проверьте приложение.
  - Убедитесь, что вы используете службу приложений для Linux, а не экземпляр для Windows. В Azure CLI выполните команду `az webapp show --resource-group <resource_group_name> --name <app_service_name> --query kind`, заменив `<resource_group_name>` и `<app_service_name>` соответствующими значениями. Команда должна вывести строку `app,linux`. Если этого не произошло, заново создайте службу приложений и выберите Linux.
    - Используйте SSH или консоль Kudu для подключения непосредственно к службе приложений и убедитесь, что файлы существуют в каталоге *site/wwwroot*. Если файлов нет, проверьте процесс развертывания и повторно разверните приложение.
  - Если файлы имеются, значит службе приложений не удалось определить конкретный загрузочный файл. Убедитесь, что ваше приложение структурировано, так как служба приложений ожидает [Djangо](#django-app) или [Flask](#flask-app) или использует [пользовательскую команду запуска](#custom-startup-command).
  
- **В браузере появилось сообщение "Служба недоступна".** Истекло время ожидания браузером ответа от службы приложений, что указывает, что она запустила сервер Gunicorn, но аргументы, указывающие код приложения, неверные.
  - Обновите браузер, особенно если вы используете самую низкую ценовую категорию в плане службы приложений. Приложению может потребоваться больше времени для запуска, например при использовании бесплатных уровней, и оно начнет отвечать после обновления браузера.
  - Убедитесь, что ваше приложение структурировано, так как служба приложений ожидает [Djangо](#django-app) или [Flask](#flask-app) или использует [пользовательскую команду запуска](#custom-startup-command).
  - Используйте SSH или консоль Kudu для подключения к службе приложений, а затем изучите журналы диагностики, которые хранятся в папке *LogFiles*. Дополнительные сведения о ведении журналов см. в статье [Включение ведения журнала диагностики для веб-приложений в службе приложений Azure](../web-sites-enable-diagnostic-log.md).
