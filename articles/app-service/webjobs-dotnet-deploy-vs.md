---
title: Разработка и развертывание веб-заданий с помощью Visual Studio
description: Узнайте, как разрабатывать веб-задания Azure в Visual Studio и развертывать их в службе приложений Azure, включая создание запланированной задачи.
author: ggailey777
ms.assetid: a3a9d320-1201-4ac8-9398-b4c9535ba755
ms.topic: conceptual
ms.custom: devx-track-csharp, vs-azure
ms.date: 07/30/2020
ms.author: glenga
ms.reviewer: david.ebbo;suwatch;pbatum;naren.soni
ms.openlocfilehash: ed473568fbad5bad380001cd2e2faccd90994099
ms.sourcegitcommit: 648c8d250106a5fca9076a46581f3105c23d7265
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/27/2020
ms.locfileid: "88959907"
---
# <a name="develop-and-deploy-webjobs-using-visual-studio"></a>Разработка и развертывание веб-заданий с помощью Visual Studio

В этой статье объясняется, как использовать Visual Studio для развертывания проекта консольного приложения в веб-приложении в [службе приложений Azure](overview.md) в качестве [задания Azure](https://go.microsoft.com/fwlink/?LinkId=390226). Сведения о развертывании веб-заданий с помощью [портал Azure](https://portal.azure.com)см. в статье [выполнение фоновых задач с помощью веб-заданий в службе приложений Azure](webjobs-create.md).

Можно выбрать разработку веб-задания, которое выполняется как [приложение .NET Core](#webjobs-as-net-core-console-apps) или как [приложение .NET Framework](#webjobs-as-net-framework-console-apps). Версия 3. x пакета SDK для веб- [заданий Azure](webjobs-sdk-how-to.md) позволяет разрабатывать веб-задания, которые выполняются как приложения .NET Core или как приложения .NET Framework, а версия 2. x поддерживает только .NET Framework. Способ развертывания проекта веб-заданий отличается для проектов .NET Core, а не для проектов .NET Framework.

В одно веб-приложение можно опубликовать несколько заданий, при условии что каждое веб-задание имеет уникальное имя.

## <a name="webjobs-as-net-core-console-apps"></a>Веб-задания в виде консольных приложений .NET Core

В версии 3. x пакета SDK веб-заданий Azure можно создавать и публиковать веб-задания в виде консольных приложений .NET Core. Пошаговые инструкции по созданию и публикации консольного приложения .NET Core в Azure в качестве веб-задания см. в статье [Начало работы с пакетом SDK веб-заданий Azure для обработки событий, управляемых событиями в фоновом режиме](webjobs-sdk-get-started.md).

> [!NOTE]
> Веб-задания .NET Core не могут быть связаны с проектами. Если вы хотите развернуть веб-задание в приложении, создайте его в [качестве .NET Framework консольного приложения](#webjobs-as-net-framework-console-apps).  

### <a name="deploy-to-azure-app-service"></a>Развертывание в службе приложений Azure

Публикация веб-задания .NET Core в службе приложений Azure из Visual Studio использует те же средства, что и публикация ASP.NET Core приложения.

[!INCLUDE [webjobs-publish-net-core](../../includes/webjobs-publish-net-core.md)] 

## <a name="webjobs-as-net-framework-console-apps"></a>Веб-задания как .NET Framework консольные приложения  

Если вы используете Visual Studio для развертывания .NET Framework проекта консольного приложения с поддержкой веб-заданий, он копирует файлы среды выполнения в соответствующую папку в веб-приложении (*App_Data/Жобс/континуаус* для непрерывной работы и *App_Data/Жобс/тригжеред* по запланированным или веб-заданиям по запросу).

Visual Studio добавляет следующие элементы в проект с поддержкой веб-заданий:

* Пакет NuGet [Microsoft.Web.WebJobs.Publish](https://www.nuget.org/packages/Microsoft.Web.WebJobs.Publish/) .
* Файл [webjob-publish-settings.json](#publishsettings) , который содержит параметры развертывания и планировщика. 

![Схема, показывающая, что добавляется в консольное приложение для включения развертывания в качестве веб-задания](./media/webjobs-dotnet-deploy-vs/convert.png)

Эти элементы можно добавить в существующий проект консольного приложения или использовать шаблон для создания нового проекта консольного приложения с поддержкой веб-заданий. 

Развертывайте проект как веб-задание самостоятельно или свяжите его с проектом, чтобы он автоматически развертывается при развертывании веб-проекта. Чтобы связать проекты, Visual Studio включает имя проекта с поддержкой веб-заданий в файле [webjobs-list.json](#webjobslist) веб-проекта.

![Диаграмма, отображающая проект веб-задания, связанный с веб-проектом](./media/webjobs-dotnet-deploy-vs/link.png)

### <a name="prerequisites"></a>Предварительные требования

Установите Visual Studio 2017 или Visual Studio 2019 с [рабочей нагрузкой разработки Azure](/visualstudio/install/install-visual-studio#step-4---choose-workloads).

### <a name="enable-webjobs-deployment-for-an-existing-console-app-project"></a><a id="convert"></a> Включение развертывания веб-заданий для существующего проекта консольного приложения

Имеются две возможности.

* [Включение автоматического развертывания с веб-проектом](#convertlink).

  Настройте существующий проект консольного приложения таким образом, чтобы он автоматически развертывается как веб-задание при развертывании проекта. Используйте этот параметр, если нужно запустить веб-задание в том же веб-приложении, в котором запущено связанное веб-приложение.

* [Включение развертывания без веб-проекта](#convertnolink).

  Настройте существующий проект консольного приложения для развертывания в качестве веб-задания самостоятельно, без ссылки на проект. Используйте этот параметр, если нужно запустить веб-задание в веб-приложении самостоятельно, без веб-приложения, запущенного в веб-приложении. Это может потребоваться для масштабирования ресурсов веб-задания независимо от ресурсов вашего приложения.

#### <a name="enable-automatic-webjobs-deployment-with-a-web-project"></a><a id="convertlink"></a> Включение автоматического развертывания веб-заданий с помощью веб-проекта

1. Щелкните правой кнопкой мыши веб-проект в **Обозреватель решений**, а затем выберите **Добавить**  >  **существующий проект в качестве задания Azure**.
   
    ![Существующий проект как веб-задание Azure](./media/webjobs-dotnet-deploy-vs/eawj.png)
   
    Откроется диалоговое окно [Добавление веб-задания Azure](#configure) .
2. В раскрывающемся списке **имя проекта** выберите проект консольного приложения для добавления в качестве веб-задания.
   
    ![Выбор проекта в диалоговом окне "Добавление веб-задания Azure"](./media/webjobs-dotnet-deploy-vs/aaw1.png)
3. Заполните диалоговое окно [Добавление веб-задания Azure](#configure) и нажмите кнопку **ОК**. 

#### <a name="enable-webjobs-deployment-without-a-web-project"></a><a id="convertnolink"></a> Включение развертывания веб-заданий без веб-проекта
1. Щелкните правой кнопкой мыши проект консольного приложения в **Обозреватель решений**и выберите **Опубликовать как веб-задание Azure**. 
   
    ![Опубликовать как веб-задание Azure](./media/webjobs-dotnet-deploy-vs/paw.png)
   
    Появится диалоговое окно [Добавление веб-задания Azure](#configure) с проектом, выбранным в поле **Имя проекта** .
2. Заполните диалоговое окно [Добавление веб-задания Azure](#configure) и нажмите кнопку **ОК**.
   
   Откроется мастер **веб-публикации** . Если вы не хотите сразу выполнить публикацию, закройте мастер. Указанные параметры сохраняются до момента [развертывания проекта](#deploy).

### <a name="create-a-new-webjobs-enabled-project"></a><a id="create"></a>Создание нового проекта с поддержкой веб-заданий
Чтобы создать новый проект с поддержкой веб-заданий, используйте шаблон проекта Консольное приложение и включите развертывание заданий, как описано в [предыдущем разделе](#convert). В качестве альтернативы можно использовать шаблон создания проекта с поддержкой веб-заданий:

* [Использование шаблона нового проекта веб-заданий для независимого задания](#createnolink)
  
    Создайте проект и настройте его для развертывания в качестве веб-задания без ссылки на веб-проект. Используйте этот параметр, если нужно запустить веб-задание в веб-приложении самостоятельно, без веб-приложения, запущенного в веб-приложении. Это может потребоваться для масштабирования ресурсов веб-задания независимо от ресурсов вашего приложения.
* [Использование шаблона нового проекта веб-заданий для задания, связанного с проектом](#createlink)
  
    Создайте проект, настроенный для автоматического развертывания в качестве веб-задания при развертывании в том же решении. Используйте этот параметр, если нужно запустить веб-задание в том же веб-приложении, в котором запущено связанное веб-приложение.

> [!NOTE]
> Шаблон нового проекта веб-задания автоматически устанавливает пакеты NuGet и включает в файл *Program.cs* код для [пакета SDK веб-заданий](https://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/getting-started-with-windows-azure-webjobs). Если вы не хотите использовать пакет SDK для веб-заданий, удалите или измените инструкцию `host.RunAndBlock` в файле *Program.cs*.
> 
> 

#### <a name="use-the-webjobs-new-project-template-for-an-independent-webjob"></a><a id="createnolink"></a> Использование шаблона создания проекта веб-заданий для отдельного веб-задания
1. Выберите **Файл** > **Создать** > **Проект**. В диалоговом окне **создавайте a New Project (создание проекта** ) найдите и выберите **веб-задание Azure (.NET Framework)** для C#.
   
2. Следуйте приведенным выше инструкциям, чтобы [сделать проект консольного приложения независимым проектом](#convertnolink)веб-заданий.

#### <a name="use-the-webjobs-new-project-template-for-a-webjob-linked-to-a-web-project"></a><a id="createlink"></a> Использование шаблона создания проекта с поддержкой веб-заданий для веб-задания, связанного с веб-проектом
1. Щелкните правой кнопкой мыши веб-проект в **Обозреватель решений**, а затем выберите **Добавить**  >  **Новый проект веб-задания Azure**.
   
    ![Запись меню "Новый проект веб-задания Azure"](./media/webjobs-dotnet-deploy-vs/nawj.png)
   
    Откроется диалоговое окно [Добавление веб-задания Azure](#configure) .
2. Заполните диалоговое окно [Добавление веб-задания Azure](#configure) и нажмите кнопку **ОК**.


### <a name="webjob-publish-settingsjson-file"></a><a id="publishsettings"></a>webjob-publish-settings.jsв файле
Когда вы настраиваете консольное приложение для развертывания веб-заданий, Visual Studio устанавливает пакет NuGet [Microsoft. Web.. Publish](https://www.nuget.org/packages/Microsoft.Web.WebJobs.Publish/) и сохраняет сведения о расписании в *webjob-publish-settings.js* файле в папке " *Свойства* проекта" проекта веб-заданий. Вот пример этого файла:

```json
{
  "$schema": "http://schemastore.org/schemas/json/webjob-publish-settings.json",
  "webJobName": "WebJob1",
  "startTime": "null",
  "endTime": "null",
  "jobRecurrenceFrequency": "null",
  "interval": null,
  "runMode": "Continuous"
}
```

Вы можете изменить этот файл напрямую, и Visual Studio предоставит IntelliSense. Схема файла хранится в файле [https://schemastore.org](http://schemastore.org/schemas/json/webjob-publish-settings.json) и может быть просмотрена.  

### <a name="webjobs-listjson-file"></a><a id="webjobslist"></a>webjobs-list.jsв файле
При связывании проекта с поддержкой веб-заданий с веб-проектом Visual Studio сохраняет имя проекта веб-заданий в файле *webjobs-list.json* в папке веб-проекта *Properties*. Список может содержать несколько проектов веб-заданий, как показано в следующем примере:

```json
{
  "$schema": "http://schemastore.org/schemas/json/webjobs-list.json",
  "WebJobs": [
    {
      "filePath": "../ConsoleApplication1/ConsoleApplication1.csproj"
    },
    {
      "filePath": "../WebJob1/WebJob1.csproj"
    }
  ]
}
```

Этот файл можно изменить непосредственно в Visual Studio с помощью IntelliSense. Схема файла хранится в [https://schemastore.org](http://schemastore.org/schemas/json/webjobs-list.json) .

### <a name="deploy-a-webjobs-project"></a><a id="deploy"></a>Развертывание проекта веб-заданий
Проект веб-заданий, который вы связали с проектом, автоматически развертывается вместе с веб-проектом. Дополнительные сведения о развертывании веб-проектов см. в разделе **руководства**по  >  **развертыванию приложения** в левой области навигации.

Чтобы развернуть проект веб-заданий, щелкните правой кнопкой мыши проект в **Обозреватель решений** и выберите **Опубликовать как задание Azure**. 

![Опубликовать как веб-задание Azure](./media/webjobs-dotnet-deploy-vs/paw.png)

Для независимого веб-задания отобразится тот же мастер **веб-публикации** , который использовался для веб-проектов, но некоторые параметры будут недоступны для изменения.

### <a name="add-azure-webjob-dialog-box"></a><a id="configure"></a>Диалоговое окно "Добавление веб-задания Azure"
Диалоговое окно **Добавление веб-задания Azure** позволяет ввести имя веб-задания и параметр режим выполнения для веб-задания. 

![Диалоговое окно "Добавление веб-задания Azure"](./media/webjobs-dotnet-deploy-vs/aaw2.png)

Некоторые поля в этом диалоговом окне соответствуют полям в диалоговом окне " **Добавление веб-задания** " портал Azure. Дополнительные сведения см. [в статье выполнение фоновых задач с помощью веб-заданий в службе приложений Azure](webjobs-create.md).

Сведения о развертывании веб-задания:

* Дополнительные сведения о развертывании из командной строки см. в разделе [Включение предоставления веб-заданий Azure из командной строки или постоянно](https://azure.microsoft.com/blog/2014/08/18/enabling-command-line-or-continuous-delivery-of-azure-webjobs/).

* Если вы развертываете веб-задание, а затем принимаете решение о том, что необходимо изменить тип задания и повторное развертывание, удалите *webjobs-publish-settings.jsв* файле. Это приводит к тому, что Visual Studio повторно отображает параметры публикации, поэтому вы можете изменить тип веб-задания.

* Если вы развертываете веб-задание, а затем изменяете режим выполнения с постоянного на непостоянный или наоборот, Visual Studio создаст новое веб-задание в Azure при повторном развертывании. Если изменить другие параметры планирования, но оставить режим выполнения одинаковым или переключаться между запланированными и по запросу, Visual Studio обновит существующее задание, а не создает новое.

## <a name="webjob-types"></a>Типы веб-заданий

Тип веб-задания может быть *активирован* или *непрерывно*:

- Активировано (по умолчанию). активируемое веб-задание запускается на основе события привязки по [расписанию](#scheduling-a-triggered-webjob)или при активации вручную (по запросу). Он выполняется на всех экземплярах, на которых выполняется веб-приложение, но при необходимости можно ограничить задание единственным экземпляром.

- Непрерывно. [непрерывное](#continuous-execution) веб-задание запускается сразу после создания веб-задания. Этот тип веб-задания лучше всего подходит для неограниченных или долго выполняющихся заданий. Если задание завершается, его можно перезапустить.  

[!INCLUDE [webjobs-alwayson-note](../../includes/webjobs-always-on-note.md)]

### <a name="scheduling-a-triggered-webjob"></a>Планирование активируемого веб-задания

При публикации консольного приложения в Azure Visual Studio задает тип веб-задания, который **активируется** по умолчанию, и добавляет новый файл *Settings. job* в проект. Для активируемых типов веб-заданий этот файл можно использовать для задания расписания выполнения веб-задания.

Используйте файл *Settings. job* , чтобы задать расписание выполнения веб-задания. В следующем примере выполняется раз в час с 9 до 17:00:

```json
{
    "schedule": "0 0 9-17 * * *"
}
```

Этот файл находится в корне папки веб-заданий с помощью скрипта задания, например `wwwroot\app_data\jobs\triggered\{job name}` или `wwwroot\app_data\jobs\continuous\{job name}` . При развертывании веб-задания из Visual Studio пометьте *Параметры.* свойства файла задания в Visual Studio как **Copy, если новее**.

Если вы [создаете веб-задание из портал Azure](webjobs-create.md), файл *Settings. job* создается для вас.

#### <a name="cron-expressions"></a>Выражения CRON

Веб-задания используют те же выражения CRON для планирования, что и триггер таймера в функциях Azure. Дополнительные сведения о поддержке CRON см. в статье [триггер таймера для функций Azure](../azure-functions/functions-bindings-timer.md#ncrontab-expressions).

[!INCLUDE [webjobs-cron-timezone-note](../../includes/webjobs-cron-timezone-note.md)]

#### <a name="settingsjob-reference"></a>Справочник по параметрам. job

Веб-задания поддерживают следующие параметры:

| **Параметр** | **Тип**  | **Описание** |
| ----------- | --------- | --------------- |
| `is_in_place` | Все | Разрешает выполнение веб-задания без предварительного копирования во временную папку. Дополнительные сведения см. в разделе [веб-задание рабочий каталог](https://github.com/projectkudu/kudu/wiki/WebJobs#webjob-working-directory). |
| `is_singleton` | С задержкой | Запускать веб-задание только в одном экземпляре при масштабировании. Дополнительные сведения см. в разделе [Задание непрерывного задания как singleton](https://github.com/projectkudu/kudu/wiki/WebJobs-API#set-a-continuous-job-as-singleton). |
| `schedule` | Активируемые | Запуск веб-задания по расписанию на основе CRON. Дополнительные сведения см. в разделе [нкронтаб Expressions](../azure-functions/functions-bindings-timer.md#ncrontab-expressions). |
| `stopping_wait_time`| Все | Позволяет управлять поведением при завершении работы. Дополнительные сведения см. в статье о [корректном завершении работы](https://github.com/projectkudu/kudu/wiki/WebJobs#graceful-shutdown). |

### <a name="continuous-execution"></a>Непрерывное выполнение

При включении **Always on** в Azure можно использовать Visual Studio, чтобы изменить веб-задание для непрерывного запуска:

1. [Опубликуйте проект в Azure](#deploy-to-azure-app-service), если вы еще этого не сделали.

1. Щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите пункт **Опубликовать**.

1. На вкладке **Публикация** нажмите кнопку **изменить**. 

1. В диалоговом окне **Параметры профиля** выберите значение **непрерывно** для параметра **тип веб-задания**, а затем нажмите кнопку **сохранить**.

    ![Диалоговое окно "Параметры публикации" для веб-задания](./media/webjobs-dotnet-deploy-vs/publish-settings.png)

1. Выберите **опубликовать** на вкладке **Публикация** , чтобы повторно опубликовать веб-задание с обновленными параметрами.

## <a name="next-steps"></a>Следующие шаги

> [!div class="nextstepaction"]
> [Подробнее о пакете SDK веб-заданий](webjobs-sdk-how-to.md)