---
title: Учебник. Добавление ресурса в шаблон
description: Описание создания первого шаблона Azure Resource Manager Вы узнаете о синтаксисе файла шаблона и о том, как развернуть учетную запись хранения.
author: mumian
ms.date: 10/04/2019
ms.topic: tutorial
ms.author: jgao
ms.openlocfilehash: 924c369465bf53ea5f58de906bd0894ce822cac3
ms.sourcegitcommit: 5cfe977783f02cd045023a1645ac42b8d82223bd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2019
ms.locfileid: "74148199"
---
# <a name="tutorial-add-a-resource-to-your-resource-manager-template"></a>Руководство по добавлению ресурсов в шаблон Azure Resource Manager

Из [предыдущего учебника](template-tutorial-create-first-template.md) вы узнали, как создавать пустой шаблон и развертывать его. Теперь все готово для развертывания ресурса. В этом учебнике вы узнаете, как добавить учетную запись хранения. Для работы с этим учебником потребуется около **9 минут**.

## <a name="prerequisites"></a>Предварительные требования

Советуем выполнить инструкции из [ознакомительного учебника по шаблонам](template-tutorial-create-first-template.md), но это необязательно.

Вам понадобится Visual Studio Code с расширением инструментов Resource Manager и либо Azure PowerShell, либо Azure CLI. Дополнительные сведения см. в разделе об [инструментах шаблона](template-tutorial-create-first-template.md#get-tools).

## <a name="add-resource"></a>Добавление ресурса

Чтобы добавить определение учетной записи хранения в имеющийся шаблон, посмотрите на выделенный JSON в следующем примере. Вместо того, чтобы пытаться скопировать разделы шаблона, скопируйте весь файл и замените свой шаблон его содержимым.

Замените **{provide-unique-name}** на уникальное имя учетной записи хранения. Имя учетной записи хранения должно быть уникальным в среде Azure. Имя должно содержать только строчные буквы или цифры. Оно должно содержать не больше 24 знаков. Вы можете попробовать использовать шаблон именования (например, **store1**) в качестве префикса, а затем добавить свои инициалы и сегодняшнюю дату. Например, имя, которое вы используете, может выглядеть таким образом: **store1abc09092019**.

[!code-json[](~/resourcemanager-templates/get-started-with-templates/add-storage/azuredeploy.json?range=1-19&highlight=5-17)]

Подобрать уникальное имя для учетной записи хранения не так просто и не подходит для автоматизации больших развертываний. Далее в этой серии учебников вы будете использовать функции шаблонов, которые облегчат создание уникального имени.

## <a name="resource-properties"></a>Свойства ресурса

Вам может быть интересно, как найти свойства для использования для каждого типа ресурса. Вы можете использовать [ссылку на шаблон Resource Manager](/azure/templates/), чтобы найти типы ресурсов, которые вы хотите развернуть.

Каждый развернутый ресурс имеет как минимум следующие три свойства:

- **type**. Тип ресурса. Это значение представляет собой сочетание пространства имен поставщика ресурсов и типа ресурса (например, Microsoft.Storage/storageAccounts).
- **ApiVersion**. Версия REST API, которая будет использована для создания ресурса. Каждый поставщик ресурсов опубликовал собственные версии API, поэтому это значение зависит от типа.
- **name**. Имя ресурса.

Большинство ресурсов также имеют свойство **расположения**, которое задает регион, где развернут ресурс.

Другие свойства зависят от типа ресурса и версии API. Важно понимать связь между версией API и доступными свойствами, поэтому давайте перейдем к более подробным сведениям.

В рамках этого учебника вы добавили в шаблон учетную запись хранения. В [storageAccounts 2019-04-01](/azure/templates/microsoft.storage/2019-04-01/storageaccounts) можно увидеть эту версию API. Обратите внимание, что вы не добавили все свойства в свой шаблон. Многие из свойств являются необязательными. Поставщик ресурсов Microsoft.Storage может выпустить новую версию API, но развертываемая версия не должна изменяться. Вы можете продолжать использовать эту версию и знать, что результаты развертывания будут согласованы.

Если вы просмотрите более старую версию API, такую как [storageAccounts 2016-05-01](/azure/templates/microsoft.storage/2016-05-01/storageaccounts), вы увидите, что доступен меньший набор свойств.

Если вы решите изменить версию API для ресурса, убедитесь, что вы оценили свойства этой версии и соответствующим образом изменили свой шаблон.

## <a name="deploy-template"></a>Развертывание шаблона

Вы можете развернуть шаблон для создания учетной записи хранения. Присвойте развертыванию другое имя, чтобы вы могли легко найти его в журнале.

Если вы еще не создали группу ресурсов, см. [этот раздел](template-tutorial-create-first-template.md#create-resource-group). В этом примере предполагается, что для переменной **templateFile** указан путь к файлу шаблона, как показано в [первом учебнике](template-tutorial-create-first-template.md#deploy-template).

# <a name="powershelltabazure-powershell"></a>[PowerShell](#tab/azure-powershell)

```azurepowershell
New-AzResourceGroupDeployment `
  -Name addstorage `
  -ResourceGroupName myResourceGroup `
  -TemplateFile $templateFile
```

# <a name="azure-clitabazure-cli"></a>[Интерфейс командной строки Azure](#tab/azure-cli)

```azurecli
az group deployment create \
  --name addstorage \
  --resource-group myResourceGroup \
  --template-file $templateFile
```

---

Ниже приведены два возможных сбоя развертывания, с которыми вы можете столкнуться.

- Ошибка: Code=AccountNameInvalid; Message={provide-unique-name} не является допустимым именем учетной записи хранения. Имя учетной записи хранения должно содержать от 3 до 24 знаков и состоять только из цифр и букв нижнего регистра.

    В шаблоне замените **{provide-unique-name}** уникальным именем учетной записи хранения.  Ознакомьтесь с разделом [Добавление ресурса](#add-resource).

- Ошибка: Code=StorageAccountAlreadyTaken; Message=Учетная запись хранения с именем store1abc09092019 уже используется.

    Попробуйте использовать другое имя учетной записи хранения в шаблоне.

Это развертывание занимает больше времени, чем развертывание пустого шаблона, так как создается учетная запись хранения. Это может занять около минуты, но обычно выполняется быстрее.

## <a name="verify-deployment"></a>Проверка развертывания

Чтобы проверить развертывание, просмотрите группу ресурсов на портале Azure.

1. Войдите на [портале Azure](https://portal.azure.com).
1. В меню слева выберите **Группы ресурсов**.
1. Выберите группу ресурсов, в которую выполнено развертывание.
1. Вы увидите, что учетная запись хранения развернута.
1. Обратите внимание: на метке развертывания теперь указано: **Развертывания: 2 выполнены успешно**.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы переходите к следующему учебнику, вам не нужно удалять группу ресурсов.

Если вы останавливаете работу сейчас, вам может потребоваться очистить развернутые ресурсы, удалив группу ресурсов.

1. На портале Azure в меню слева выберите **Группа ресурсов**.
2. В поле **Filter by name** (Фильтровать по имени) введите имя группы ресурсов.
3. Выберите имя группы ресурсов.
4. В главном меню выберите **Удалить группу ресурсов**.

## <a name="next-steps"></a>Дополнительная информация

Вы создали простой шаблон для развертывания учетной записи хранения Azure.  В последующих учебниках вы узнаете, как добавлять параметры, переменные, ресурсы и выходные данные в шаблон. Эти функции являются строительными блоками для более сложных шаблонов.

> [!div class="nextstepaction"]
> [Учебник по добавлению параметров в шаблон Resource Manager](template-tutorial-add-parameters.md)