---
title: Структура и синтаксис шаблона Azure Resource Manager | Документация Майкрософт
description: Описывается создание структуры и свойств шаблонов Azure Resource Manager с помощью декларативного синтаксиса JSON.
author: tfitzmac
ms.service: azure-resource-manager
ms.topic: conceptual
ms.date: 10/09/2019
ms.author: tomfitz
ms.openlocfilehash: e5ef3dcd7c2eec08237d5eb31fb95a0e450d9ac9
ms.sourcegitcommit: e0a1a9e4a5c92d57deb168580e8aa1306bd94723
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2019
ms.locfileid: "72286715"
---
# <a name="understand-the-structure-and-syntax-of-azure-resource-manager-templates"></a>Описание структуры и синтаксиса шаблонов Azure Resource Manager

В этой статье описана структура шаблона Azure Resource Manager. Статья содержит информацию о разных разделах шаблона и свойствах, которые доступны в этих разделах.

Эта статья предназначена для пользователей, знакомых с шаблонами диспетчер ресурсов. Он предоставляет подробные сведения о структуре шаблона. Если вы хотите ознакомиться с созданием шаблона, см. раздел [Azure Resource Manager Templates](template-deployment-overview.md).

## <a name="template-format"></a>Формат шаблона

Шаблон с самой простой структурой содержит следующие элементы:

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "",
  "apiProfile": "",
  "parameters": {  },
  "variables": {  },
  "functions": [  ],
  "resources": [  ],
  "outputs": {  }
}
```

| Имя элемента | Обязательно для заполнения | Описание |
|:--- |:--- |:--- |
| $schema |Да |Расположение файла схемы JSON, который описывает версию языка шаблона.<br><br> Для развертывания групп ресурсов используйте `https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#`<br><br>Для развертывания подписки используйте `https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#` |
| contentVersion |Да |Версия шаблона (например, 1.0.0.0). Для этого элемента можно предоставить любое значение. Это значение позволяет задокументировать важные изменения в шаблоне. При развертывании ресурсов с помощью шаблона это значение позволяет убедиться в том, что используется нужный шаблон. |
| апипрофиле |Нет | Версия API, которая служит коллекцией версий API для типов ресурсов. Используйте это значение, чтобы не указывать версии API для каждого ресурса в шаблоне. Если указана версия профиля API и не указана версия API для типа ресурса, диспетчер ресурсов использует версию API для этого типа ресурсов, который определен в профиле.<br><br>Свойство профиля API особенно полезно при развертывании шаблона в различных средах, таких как Azure Stack и глобальные Azure. Используйте версию профиля API, чтобы убедиться, что шаблон автоматически использует версии, поддерживаемые в обеих средах. Список текущих версий профиля API и версий API ресурсов, определенных в профиле, см. в разделе [профиль API](https://github.com/Azure/azure-rest-api-specs/tree/master/profile).<br><br>Дополнительные сведения см. в статье [Tracking Versions using API Profiles](templates-cloud-consistency.md#track-versions-using-api-profiles). |
| [parameters](#parameters) |Нет |Значения, которые предоставляются при выполнении развертывания для настройки развертывания ресурсов. |
| [variables](#variables) |Нет |Значения, используемые в виде фрагментов JSON в шаблоне для упрощения выражений на языке шаблона. |
| [functions](#functions) |Нет |Определяемые пользователем функции, доступные в шаблоне. |
| [resources](#resources) |Да |Типы ресурсов, которые развертываются или обновляются в группе ресурсов или подписке. |
| [outputs](#outputs) |Нет |Значения, возвращаемые после развертывания. |

Каждый элемент содержит свойства, которые можно задать. В этой статье подробнее описаны разделы шаблона.

## <a name="parameters"></a>Параметры

В разделе параметров шаблона указываются значения, которые вы можете вводить во время развертывания ресурсов. Существует ограничение в 256 параметров на один шаблон. Количество параметров можно уменьшить с помощью объектов, содержащих несколько свойств.

Для параметра доступны следующие свойства:

```json
"parameters": {
  "<parameter-name>" : {
    "type" : "<type-of-parameter-value>",
    "defaultValue": "<default-value-of-parameter>",
    "allowedValues": [ "<array-of-allowed-values>" ],
    "minValue": <minimum-value-for-int>,
    "maxValue": <maximum-value-for-int>,
    "minLength": <minimum-length-for-string-or-array>,
    "maxLength": <maximum-length-for-string-or-array-parameters>,
    "metadata": {
      "description": "<description-of-the parameter>"
    }
  }
}
```

| Имя элемента | Обязательно для заполнения | Описание |
|:--- |:--- |:--- |
| имя параметра |Да |Имя параметра. Должно быть допустимым идентификатором JavaScript. |
| type |Да |Тип значения параметра. Допустимые типы и значения: **string**, **securestring**, **int**, **bool**, **object**, **secureObject** и **array**. См. раздел [типы данных](#data-types). |
| defaultValue |Нет |Значение параметра, используемое по умолчанию, если пользователь не задал иное значение. |
| allowedValues |Нет |Массив допустимых значений параметра, по которому сверяются правильные значения. |
| minValue |Нет |Минимальное значение для параметров типа int. Это включающее значение. |
| maxValue |Нет |Максимальное значение для параметров типа int. Это включающее значение. |
| minLength |Нет |Минимальная длина (включительно) параметров типа string, secure string и array. |
| maxLength |Нет |Максимальная длина (включительно) параметров типа string, secure string и array. |
| description |Нет |Описание параметра, отображаемого для пользователей на портале. Дополнительные сведения см. в разделе [комментариев в шаблонах](#comments). |

Примеры использования параметров см. [в разделе Параметры в Azure Resource Manager Templates](template-parameters.md).

### <a name="data-types"></a>Типы данных

Для целых чисел, переданных в качестве встроенных параметров, диапазон значений может быть ограничен пакетом SDK или программой командной строки, используемой для развертывания. Например, при использовании PowerShell для развертывания шаблона целочисленные типы могут находиться в диапазоне от-2147483648 до 2147483647. Чтобы избежать этого ограничения, укажите большие целочисленные значения в [файле параметров](resource-manager-parameter-files.md). Типы ресурсов применяют собственные ограничения для целочисленных свойств.

При указании в шаблоне значений типа Boolean и целых чисел не следует заключать значение в кавычки. Начальные и конечные строковые значения заключаются в двойные кавычки.

Объекты начинаются с левой скобки и заканчиваются правой фигурной скобкой. Массивы начинаются с левой скобки и заканчиваются правой скобкой.

Защищенные строки и защищенные объекты не могут быть прочитаны после развертывания ресурсов.

Примеры типов данных форматирования см. в разделе [форматы типов параметров](resource-manager-parameter-files.md#parameter-type-formats).

## <a name="variables"></a>Переменные

В разделе переменных вы создаете значения, которые можно использовать в разных частях шаблона. Переменные определять не обязательно, однако они часто упрощают шаблон, снижая число сложных выражений.

В следующем примере показаны доступные параметры для определения переменной.

```json
"variables": {
  "<variable-name>": "<variable-value>",
  "<variable-name>": {
    <variable-complex-type-value>
  },
  "<variable-object-name>": {
    "copy": [
      {
        "name": "<name-of-array-property>",
        "count": <number-of-iterations>,
        "input": <object-or-value-to-repeat>
      }
    ]
  },
  "copy": [
    {
      "name": "<variable-array-name>",
      "count": <number-of-iterations>,
      "input": <object-or-value-to-repeat>
    }
  ]
}
```

Сведения об использовании `copy` для создания нескольких значений переменной см. в разделе [Переменная iteration](resource-group-create-multiple.md#variable-iteration).

Примеры использования переменных см. [в разделе переменные в шаблоне Azure Resource Manager](template-variables.md).

## <a name="functions"></a>Функции

В шаблоне можно создать свои собственные функции. Эти функции доступны для использования в шаблоне. Как правило, вы определяете сложные выражения, которые не должны повторяться на протяжении всего шаблона. Создаются определяемые пользователем функции на основе выражений и [функции](resource-group-template-functions.md), которые поддерживаются в шаблонах.

При определении пользовательской функции есть несколько ограничений:

* Функция не может обращаться к переменным.
* Функция может использовать только параметры, определенные в самой функции. При использовании [функции Parameters](resource-group-template-functions-deployment.md#parameters) в определяемой пользователем функции вы можете использовать только параметры этой функции.
* Функция не может вызывать другие функции, определяемые пользователем.
* Для функции нельзя использовать [ссылочную функцию](resource-group-template-functions-resource.md#reference).
* Для параметров этой функции нельзя задавать значения по умолчанию.

```json
"functions": [
  {
    "namespace": "<namespace-for-functions>",
    "members": {
      "<function-name>": {
        "parameters": [
          {
            "name": "<parameter-name>",
            "type": "<type-of-parameter-value>"
          }
        ],
        "output": {
          "type": "<type-of-output-value>",
          "value": "<function-return-value>"
        }
      }
    }
  }
],
```

| Имя элемента | Обязательно для заполнения | Описание |
|:--- |:--- |:--- |
| пространство_имен |Да |Пространство имен для пользовательских функций. Используйте, чтобы избежать конфликтов имен с функциями шаблонов. |
| имя функции |Да |Имя пользовательской функции. При вызове функции объедините имя функции с пространством имен. Например, чтобы вызвать функцию с именем uniqueName в пространстве имен contoso, используйте `"[contoso.uniqueName()]"`. |
| имя параметра |Нет |Имя параметра, который будет использоваться в пользовательской функции. |
| параметр-значение |Нет |Тип значения параметра. Допустимые типы и значения: **string**, **securestring**, **int**, **bool**, **object**, **secureObject** и **array**. |
| Тип выходных данных |Да |Тип выходного значения. Выходные значения поддерживают те же типы, что и входные параметры функции. |
| Выходное значение |Да |Выражение языка шаблона, которое вычисляется и возвращается из функции. |

Примеры использования пользовательских функций см. [в разделе определяемые пользователем функции в Azure Resource Manager шаблоне](template-user-defined-functions.md).

## <a name="resources"></a>Ресурсы

В разделе resources определяются ресурсы, которые развертываются или обновляются.

Ресурсы определяются с помощью следующей структуры:

```json
"resources": [
  {
      "condition": "<true-to-deploy-this-resource>",
      "apiVersion": "<api-version-of-resource>",
      "type": "<resource-provider-namespace/resource-type-name>",
      "name": "<name-of-the-resource>",
      "location": "<location-of-resource>",
      "tags": {
          "<tag-name1>": "<tag-value1>",
          "<tag-name2>": "<tag-value2>"
      },
      "comments": "<your-reference-notes>",
      "copy": {
          "name": "<name-of-copy-loop>",
          "count": <number-of-iterations>,
          "mode": "<serial-or-parallel>",
          "batchSize": <number-to-deploy-serially>
      },
      "dependsOn": [
          "<array-of-related-resource-names>"
      ],
      "properties": {
          "<settings-for-the-resource>",
          "copy": [
              {
                  "name": ,
                  "count": ,
                  "input": {}
              }
          ]
      },
      "sku": {
          "name": "<sku-name>",
          "tier": "<sku-tier>",
          "size": "<sku-size>",
          "family": "<sku-family>",
          "capacity": <sku-capacity>
      },
      "kind": "<type-of-resource>",
      "plan": {
          "name": "<plan-name>",
          "promotionCode": "<plan-promotion-code>",
          "publisher": "<plan-publisher>",
          "product": "<plan-product>",
          "version": "<plan-version>"
      },
      "resources": [
          "<array-of-child-resources>"
      ]
  }
]
```

| Имя элемента | Обязательно для заполнения | Описание |
|:--- |:--- |:--- |
| condition | Нет | Логическое значение, указывающее, будет ли подготавливаться ресурс во время этого развертывания. Если установлено значение `true`, при развертывании создается ресурс. Если установлено значение `false`, при развертывании ресурс не создается. См. [условие](conditional-resource-deployment.md). |
| apiVersion |Да |Версия REST API, которая будет использована для создания ресурса. Чтобы определить доступные значения, см. раздел [Справочник по шаблону](/azure/templates/). |
| type |Да |Тип ресурса. Это значение представляет собой сочетание пространства имен поставщика ресурсов и типа ресурса (например, **Microsoft.Storage/storageAccounts**). Чтобы определить доступные значения, см. раздел [Справочник по шаблону](/azure/templates/). Для дочернего ресурса формат типа зависит от того, является ли он вложенным в родительский ресурс или определен за пределами родительского ресурса. См. о [настройке имени и типа дочернего ресурса](child-resource-name-type.md). |
| name |Да |Имя ресурса. Имя должно соответствовать ограничениям компонентов URI, определенным в RFC3986. Службы Azure, предоставляющие имя ресурса внешним сторонам, проверяют имя, чтобы убедиться, что это не попытка подмены другого удостоверения. Для дочернего ресурса формат имени зависит от того, является ли он вложенным в родительский ресурс или определен за пределами родительского ресурса. См. о [настройке имени и типа дочернего ресурса](child-resource-name-type.md). |
| location |Varies |Поддерживаемые географические расположения указанного ресурса. Вы можете выбрать любое из доступных расположений. Но обычно имеет смысл выбрать расположение, которое находится недалеко от пользователей. Кроме того, целесообразно разместить взаимодействующие ресурсы в одном регионе. Большинству типов ресурсов нужно расположение, но некоторым типам (например, назначению роли) оно не требуется. См. раздел [Задание расположения ресурса](resource-location.md). |
| tags |Нет |Теги, связанные с ресурсом. Примените теги, чтобы логически организовать ресурсы в подписке. |
| комментарии |Нет |Заметки по ресурсам в шаблоне. Дополнительные сведения см. в разделе [комментариев в шаблонах](resource-group-authoring-templates.md#comments). |
| копирование |Нет |Количество создаваемых ресурсов (если нужно несколько экземпляров). Параллельный режим используется по умолчанию. Используйте последовательный режим, если вы не хотите развертывать все ресурсы одновременно. Дополнительные сведения см. в статье [Создание нескольких экземпляров ресурсов в Azure Resource Manager](resource-group-create-multiple.md). |
| dependsOn |Нет |Ресурсы, которые должны быть развернуты перед развертыванием этого ресурса. Resource Manager оценивает зависимости между ресурсами и развертывает эти ресурсы в правильном порядке. Если ресурсы не зависят друг от друга, они развертываются параллельно. Значение может представлять собой разделенный запятыми список имен ресурсов или уникальных идентификаторов ресурсов. Выводится только список ресурсов, развертываемых в этом шаблоне. Ресурсы, которые не определены в этом шаблоне, уже должны существовать. Избегайте добавления ненужных зависимостей, так как это может замедлить развертывание и привести к созданию циклических зависимостей. Рекомендации по настройке зависимостей см. в статье [Определение зависимостей в шаблонах диспетчера ресурсов Azure](resource-group-define-dependencies.md). |
| properties |Нет |Параметры конфигурации ресурса. Значения свойств совпадают со значениями, указываемыми в тексте запроса для операции REST API (метод PUT) для создания ресурса. Кроме того, можно указать массив copy для создания нескольких экземпляров свойства. Чтобы определить доступные значения, см. раздел [Справочник по шаблону](/azure/templates/). |
| sku | Нет | В некоторых ресурсах допускается использовать значения, определяющие номер SKU для развертывания. Например, можно указать тип избыточности для учетной записи хранения. |
| kind | Нет | В некоторых ресурсах допускается использовать значение, которое определяет тип развертываемого ресурса. Например, можно указать в качестве типа создаваемой базы данных Cosmos DB. |
| План | Нет | В некоторых ресурсах допускается использовать значения, определяющие номер плана для развертывания. Например, можно указать образ Marketplace для виртуальной машины. |
| ресурсов |Нет |Дочерние ресурсы, которые зависят от определяемого ресурса. Следует указать только те типы ресурсов, которые разрешены в схеме родительского ресурса. Зависимость от родительского ресурса не подразумевается. Ее необходимо определить явным образом. См. о [настройке имени и типа дочернего ресурса](child-resource-name-type.md). |

## <a name="outputs"></a>outputs

В разделе выходных данных следует указать значения, которые возвращаются после развертывания. Как правило, значения возвращаются из ресурсов, которые были развернуты.

В следующем примере показана структура определения выходных данных:

```json
"outputs": {
  "<output-name>" : {
    "condition": "<boolean-value-whether-to-output-value>",
    "type" : "<type-of-output-value>",
    "value": "<output-value-expression>"
  }
}
```

| Имя элемента | Обязательно для заполнения | Описание |
|:--- |:--- |:--- |
| Имя выходных данных |Да |Имя выходного значения. Должно быть допустимым идентификатором JavaScript. |
| condition |Нет | Логическое значение, которое указывает, возвращается ли выходное значение. Если установлено значение `true`, то при развертывании значение является частью выходных данных. Если установлено значение `false`, при развертывании выходное значение не создается. Когда не задано, по умолчанию используется значение `true`. |
| type |Да |Тип выходного значения. Выходные значения поддерживает те же типы, что и входные параметры шаблона. Если для типа выходных данных указано значение **SecureString** , оно не отображается в журнале развертывания и не может быть извлечено из другого шаблона. Чтобы использовать значение секрета в нескольких шаблонах, сохраните секрет в Key Vault и сослаться на секрет в файле параметров. Дополнительные сведения см. в статье [Использование Azure Key Vault для передачи защищенного значения параметра во время развертывания](resource-manager-keyvault-parameter.md). |
| value |Да |Выражение на языке шаблона, которое вычисляется и возвращается в качестве выходного значения. |

Примеры использования выходных данных см. [в разделе выходные данные в шаблоне Azure Resource Manager](template-outputs.md).

<a id="comments" />

## <a name="comments-and-metadata"></a>Комментарии и метаданные

Есть несколько вариантов добавления комментариев и метаданных к шаблону.

Вы можете добавить объект `metadata` практически в любом месте шаблона. Resource Manager игнорирует объект, но ваш редактор JSON может предупредить вас, что свойство недопустимо. Определите необходимые свойства в объекте.

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "comments": "This template was developed for demonstration purposes.",
    "author": "Example Name"
  },
```

В разделе **параметров** добавьте объект `metadata` со свойством `description`.

```json
"parameters": {
  "adminUsername": {
    "type": "string",
    "metadata": {
      "description": "User name for the Virtual Machine."
    }
  },
```

При развертывании шаблона через портал текст, который вы указываете в описании, автоматически используется в качестве подсказки для этого параметра.

![Отображается подсказка для параметра](./media/resource-group-authoring-templates/show-parameter-tip.png)

В разделе **ресурсов** добавьте элемент `comments` или объект метаданных. В следующем примере показан и элемент комментариев, и объект метаданных.

```json
"resources": [
  {
    "comments": "Storage account used to store VM disks",
    "apiVersion": "2018-07-01",
    "type": "Microsoft.Storage/storageAccounts",
    "name": "[concat('storage', uniqueString(resourceGroup().id))]",
    "location": "[parameters('location')]",
    "metadata": {
      "comments": "These tags are needed for policy compliance."
    },
    "tags": {
      "Dept": "[parameters('deptName')]",
      "Environment": "[parameters('environment')]"
    },
    "sku": {
      "name": "Standard_LRS"
    },
    "kind": "Storage",
    "properties": {}
  }
]
```

В разделе **выходных данных** добавьте объект метаданных в выходное значение.

```json
"outputs": {
  "hostname": {
    "type": "string",
    "value": "[reference(variables('publicIPAddressName')).dnsSettings.fqdn]",
    "metadata": {
      "comments": "Return the fully qualified domain name"
    }
  },
```

Добавить объект метаданных в определяемые пользователем функции невозможно.

Для встроенных комментариев можно использовать либо `//`, либо `/* ... */`, но этот синтаксис не работает со всеми инструментами. Редактор шаблонов портала нельзя использовать для работы с шаблонами со встроенными комментариями. Если вы добавляете этот стиль комментариев, убедитесь, что используемые инструменты поддерживают встроенные комментарии JSON.

> [!NOTE]
> Чтобы развернуть шаблоны с комментариями с помощью Azure CLI, необходимо использовать параметр `--handle-extended-json-format`.

```json
{
  "type": "Microsoft.Compute/virtualMachines",
  "name": "[variables('vmName')]", // to customize name, change it in variables
  "location": "[parameters('location')]", //defaults to resource group location
  "apiVersion": "2018-10-01",
  "dependsOn": [ /* storage account and network interface must be deployed first */
    "[resourceId('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]",
    "[resourceId('Microsoft.Network/networkInterfaces/', variables('nicName'))]"
  ],
```

В Visual Studio Code вы можете установить языковой режим, поддерживающий JSON-файл с комментариями. В таком случае встроенные комментарии больше не будут помечены как недопустимые. Чтобы изменить режим:

1. Откройте раздел выбора языкового режима, нажав клавиши CTRL+K+M.

1. Выберите **JSON with Comments** (JSON с комментариями).

   ![Выбор языкового режима](./media/resource-group-authoring-templates/select-json-comments.png)

## <a name="multi-line-strings"></a>Многострочные строки

Строку можно разбить на несколько строк. Например, свойство Location и одно из комментариев в следующем примере JSON.

```json
{
  "type": "Microsoft.Compute/virtualMachines",
  "name": "[variables('vmName')]", // to customize name, change it in variables
  "location": "[
    parameters('location')
    ]", //defaults to resource group location
  "apiVersion": "2018-10-01",
  /*
    storage account and network interface
    must be deployed first
  */
  "dependsOn": [
    "[resourceId('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]",
    "[resourceId('Microsoft.Network/networkInterfaces/', variables('nicName'))]"
  ],
```

Чтобы развернуть шаблоны с многострочными строками с помощью Azure CLI, необходимо использовать параметр `--handle-extended-json-format`.

## <a name="next-steps"></a>Следующие шаги

* Полные шаблоны для различных типов решений доступны на странице [Шаблоны быстрого запуска Azure](https://azure.microsoft.com/documentation/templates/).
* Дополнительные сведения о функциях, которые можно использовать в шаблонах, см. в статье [Функции шаблонов Azure Resource Manager](resource-group-template-functions.md).
* Инструкции по объединению нескольких шаблонов при развертывании см. в статье [Использование связанных шаблонов в Azure Resource Manager](resource-group-linked-templates.md).
* Дополнительные рекомендации по созданию шаблонов см. в статье [Рекомендации по работе с шаблонами Azure Resource Manager](template-best-practices.md).
* Рекомендации по созданию шаблонов Resource Manager, которые можно использовать для Azure Stack и всех окружений Azure, см. в статье [Разработка шаблонов Azure Resource Manager для обеспечения согласованности с облаком](templates-cloud-consistency.md).
