---
title: Передняя дверца Azure — методы маршрутизации трафика | Документация Майкрософт
description: Эта статья поможет вам разобраться в различных методах маршрутизации трафика, используемых Front Door.
services: front-door
documentationcenter: ''
author: duongau
ms.service: frontdoor
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/28/2020
ms.author: duau
ms.openlocfilehash: 2bc056620ff964747dfd83e7525cb5bfd2eb8e52
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91449134"
---
# <a name="front-door-routing-methods"></a>Методы маршрутизации Front Door

Передняя дверца Azure поддерживает различные методы маршрутизации трафика для определения способа маршрутизации трафика HTTP/HTTPS к разным конечным точкам службы. Когда клиент запрашивает достижение передней дверцы, настроенный метод маршрутизации применяется, чтобы обеспечить перенаправление запросов на лучший экземпляр сервера. 

В передней дверце доступно четыре метода маршрутизации трафика:

* **[Задержка](#latency)**. Маршрутизация на основе задержки гарантирует, что запросы отправляются на внутренние серверы с минимальной допустимой задержкой в диапазоне чувствительности. По сути, запросы пользователей отправляются на «ближайший» набор в отношении задержки сети.
* ** [Приоритет](#priority):** Если вы хотите настроить основной сервер для обслуживания всего трафика, можно назначить приоритеты для своих конечных серверов. Вторичная Серверная часть может быть резервной копией в случае, если основная Серверная часть становится недоступной.
* ** [Взвешенный](#weighted):** Вы можете назначить весовые коэффициенты для своих конечных точек, если нужно распределить трафик по набору интерфейсов. Требуется ли равномерное распределение или согласно коэффициентам веса.
* ** [Сходство сеансов](#affinity):** Вы можете настроить сходство сеансов для интерфейсных узлов или доменов, чтобы обеспечить отправку запросов от одного и того же конечного пользователя на тот же сервер.

Все конфигурации Front Door включают в себя мониторинг работоспособности внутренних серверов и немедленную глобальную автоматическую отработку отказа. Дополнительные сведения см. в разделе [Пробы работоспособности](front-door-health-probes.md). Передняя дверца может работать на основе одного метода маршрутизации. Но в зависимости от потребностей приложения можно также сочетать несколько методов маршрутизации для создания оптимальной топологии маршрутизации.

## <a name="lowest-latencies-based-traffic-routing"></a><a name = "latency"></a>Маршрутизация трафика на основе минимальной задержки

Развертывание серверной части в двух или более расположениях по всему миру может повысить скорость реагирования приложений за счет маршрутизации трафика в целевое расположение, которое является ближайшим к конечным пользователям. Метод маршрутизации трафика по умолчанию для конфигурации передней дверцы направляет запросы от конечных пользователей к ближайшему серверной части среды передней дверцы, которая получила запрос. В сочетании с архитектурой первого уровня для передней дверцы Azure этот подход гарантирует, что каждый пользователь будет получать максимальную производительность в соответствии с их расположением.

"Ближайший" серверный внутренний объект не обязательно должен быть ближе к измерению по географическому расстоянию. Вместо этого Front Door определяет ближайший внутренний сервер, измеряя сетевую задержку. Узнайте больше об [архитектуре маршрутизации Front Door](front-door-routing-architecture.md). 

Ниже приведен общий процесс принятия решений.

| Доступные внутренние серверы | Приоритет | Задержка (с учетом пробы работоспособности) | Веса |
|-------------| ----------- | ----------- | ----------- |
| Во-первых, выберите все включенные и возвращаемые работоспособные интерфейсы (200 ОК) для проверки работоспособности. Если имеется шесть конечных элементов A, B, C, D, E и F, а между ними есть неработоспособные, а E отключено. Список доступных однодисковых интерфейсов — A, B, D и F.  | Далее выбираются однородные элементы с наивысшим приоритетом среди доступных. Если серверная часть A, B и D имеет приоритет 1, а Серверная часть F имеет приоритет 2. В этом случае выбранные элементы будут иметь значение A, B и D.| Выберите внутренние серверы с диапазоном задержки (минимальная задержка и чувствительность к задержке в миллисекундах). Если серверная часть A — 15 мс, B — 30 мс, а D — 60 мс из среды передней дверцы, где запрашивается запрос, а задержка — 30 мс, то самый низкий пул задержки состоит из серверной части A и B, так как D находится за пределами 30 мс от ближайшей серверной части. | Наконец, Front Door будет циклически перебирать трафик в окончательном выбранном пуле внутренних серверов с учетом указанных весовых коэффициентов. Например, если внутренний сервер A имеет вес 5, а внутренний сервер B имеет вес 8, то трафик между внутренним серверами A и B будет распределяться в соотношении 5:8. |

>[!NOTE]
> По умолчанию задано значение свойства чувствительности к задержке, равное 0 мс, то есть запрос всегда пересылается на самый быстрый внутренний сервер.

## <a name="priority-based-traffic-routing"></a><a name = "priority"></a>Маршрутизация трафика по приоритету

Часто Организация хочет обеспечить высокий уровень доступности для своих служб путем развертывания нескольких служб резервного копирования в случае, если основная одна из них выходит из строя. В отрасли эта топология также называется топологией развертывания "активный — резервный" или "активный — пассивный". Метод маршрутизации трафика "По приоритету" позволяет клиентам Azure легко реализовать эту схему отработки отказа.

По умолчанию Front Door содержит список внутренних серверов с одинаковым приоритетом. По умолчанию Front Door отправляет трафик только на внутренние серверы с максимальным приоритетом (наименьшим значением приоритета), то есть в основной набор внутренних серверов. Если основная Серверная часть недоступна, то передняя дверца направляет трафик на дополнительный набор серверных интерфейсов (второе наименьшее значение приоритета). Если первичная и вторичная серверные недоступны, трафик переходит к третьему и т. д. Доступность внутреннего сервера основывается на настроенном состоянии (включен или отключен) и текущем состоянии работоспособности внутреннего сервера, которое определяют пробы работоспособности.

### <a name="configuring-priority-for-backends"></a>Настройка приоритета внутренних серверов

Каждая серверная часть серверного пула в конфигурации передней дверцы имеет свойство Priority, которое может быть числом от 1 до 5. С помощью передней дверцы Azure вы настраиваете приоритет серверной части явным образом, используя это свойство для каждой серверной части. Это свойство может принимать значения от 1 до 5. Чем меньше значение, тем выше приоритет. У внутренних серверов могут быть одинаковые значения приоритета.

## <a name="weighted-traffic-routing-method"></a><a name = "weighted"></a>Метод маршрутизации трафика со взвешиванием
Маршрутизация трафика по методу взвешивания позволяет распределять трафик равномерно или в соответствии с предустановленными весовыми коэффициентами.

При использовании метода маршрутизации трафика со взвешиванием каждому внутреннему серверу в конфигурации Front Door присваивается определенный вес. Это целое число в диапазоне от 1 до 1000. По умолчанию этот параметр задает вес, равный 50.

Список доступных серверных интерфейсов с приемлемой чувствительностью к задержке трафика распределяется с помощью механизма циклического перебора с использованием указанного коэффициента веса. Если задержка задается равным 0 миллисекундам, это свойство не вступит в силу, если не существует двух незавершенных операций с одинаковой сетевой задержкой. 

Метод взвешивания позволяет реализовать некоторые полезные сценарии.

* **Постепенное обновление приложения**: дает процент трафика для маршрутизации в новую серверную часть и постепенно увеличивает трафик, чтобы привести его в действие с другими серверными интерфейсами.
* **Перенос приложений в Azure**. Создайте внутренний пул, который включает в себя внутренние серверы, расположенные в среде Azure и за ее пределами. Настройте веса внутренних серверов так, чтобы приоритет отдавался новым внутренним серверам. Это можно делать постепенно, начиная с отключенных новых внутренних серверов, а затем назначая им наименьшие веса, медленно увеличивая их до уровня, при котором они будут принимать большую часть трафика. Затем можно будет отключить менее предпочтительные внутренние серверы и удалить их из пула.  
* **Переход в облако для получения дополнительной емкости**. Быстро расширьте локальное развертывание в облако, воспользовавшись службой Front Door. Если вам требуется дополнительная емкость в облаке, можно добавить или включить дополнительные внутренние серверы и указать, какая часть трафика направляется на каждый из них.

## <a name="session-affinity"></a><a name = "affinity"></a>Сходство сеансов
По умолчанию, без сходства сеансов, передняя дверца перенаправляет запросы, поступающие от одного и того же клиента, в различные серверные части. Некоторые приложения с отслеживанием состояния или в некоторых сценариях, исключающих запросы от одного пользователя, предпочитают ту же серверную часть, которая обработала первоначальный запрос. Функция сходства сеансов на основе файлов cookie удобна, если нужно, чтобы сеанс пользователя выполнялся на одном и том же внутреннем сервере. С помощью управляемых файлов cookie Передняя дверца Azure может направить трафик из сеанса пользователя в ту же серверную часть для обработки.

Сходство сеансов можно включить на уровне интерфейсного узла для всех настроенных доменов (или поддоменов). После включения служба Front Door добавляет файл cookie в сеанс пользователя. Используя сходство сеансов на основе файлов cookie, служба Front Door может идентифицировать различных пользователей, даже если они используют один и тот же IP-адрес. В свою очередь, это обеспечивает более равномерное распределение трафика между различными внутренними серверами.

Время существования файла cookie и сеанса пользователя одинаковы, так как сейчас Front Door поддерживает только файл cookie сеанса. 

> [!NOTE]
> Общедоступные прокси-серверы могут мешать использовать сходство сеансов. Это обусловлено тем, что для установления сеанса службе Front Door требуется добавить файл cookie сходства сеансов в ответ. Это невозможно сделать в том случае, если ответ может быть сохранен в кэше, так как это помешает использовать файлы cookie из других клиентов, запрашивающих тот же ресурс. Чтобы избежать этого, сходство сеансов **не** устанавливается, если внутренний сервер отправляет кэшируемый ответ при попытке установить сеанс. Если сеанс уже установлен, то не важно, кэшируется ли ответ от внутреннего сервера.
> В следующих обстоятельствах будет установлено сходство сеансов, **если только** ответ не содержит код состояния HTTP 304:
> - В ответе заданы определенные значения ```Cache-Control``` заголовка, которые предотвращают кэширование, например "Private" или "No-Store".
> - Ответ содержит заголовок ```Authorization```, срок действия которого не истек.
> - Ответ содержит код состояния HTTP 302.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о [создании Front Door](quickstart-create-front-door.md).
- Дополнительные сведения о том, [как работает Front Door](front-door-routing-architecture.md).
