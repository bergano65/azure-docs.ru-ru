---
title: Использование шаблона для приподключения виртуальной машины Windows к Azure AD DS | Документация Майкрософт
description: Узнайте, как использовать шаблоны Azure Resource Manager, чтобы присоединить новую или существующую виртуальную машину Windows Server к домену Azure Active Directory, управляемому службами домена.
services: active-directory-ds
author: iainfoulds
manager: daveba
ms.assetid: 4eabfd8e-5509-4acd-86b5-1318147fddb5
ms.service: active-directory
ms.subservice: domain-services
ms.workload: identity
ms.topic: how-to
ms.date: 07/09/2020
ms.author: iainfou
ms.openlocfilehash: fdef11fec93d4ba6254957ad14e0612e2fd05580
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "86221363"
---
# <a name="join-a-windows-server-virtual-machine-to-an-azure-active-directory-domain-services-managed-domain-using-a-resource-manager-template"></a>Присоединение виртуальной машины Windows Server к управляемому домену доменных служб Azure Active Directory с помощью шаблона диспетчер ресурсов

Чтобы автоматизировать развертывание и настройку виртуальных машин Azure, можно использовать шаблон диспетчер ресурсов. Эти шаблоны позволяют создавать последовательные развертывания каждый раз. Расширения также можно включить в шаблоны для автоматической настройки виртуальной машины в ходе развертывания. Одно из полезных расширений присоединяет виртуальные машины к домену, который можно использовать с управляемыми доменами доменных служб Azure Active Directory (Azure AD DS).

В этой статье показано, как создать и присоединить виртуальную машину Windows Server к управляемому домену Azure AD DS с помощью шаблонов диспетчер ресурсов. Вы также узнаете, как присоединить существующую виртуальную машину Windows Server к домену AD DS Azure.

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим учебником требуются следующие ресурсы и разрешения:

* Активная подписка Azure.
    * Если у вас еще нет подписки Azure, [создайте учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* Связанный с вашей подпиской клиент Azure Active Directory, синхронизированный с локальным или облачным каталогом.
    * Если потребуется, [создайте клиент Azure Active Directory][create-azure-ad-tenant] или [свяжите подписку Azure со своей учетной записью][associate-azure-ad-tenant].
* Управляемый домен доменных служб Azure Active Directory, включенный и настроенный в клиенте Azure AD.
    * Если потребуется, по инструкциям из первого руководства [создайте и настройте управляемый домен доменных служб Azure Active Directory][create-azure-ad-ds-instance].
* Учетная запись пользователя, входящая в управляемый домен.

## <a name="azure-resource-manager-template-overview"></a>Общие сведения о шаблоне Azure Resource Manager

Шаблоны диспетчер ресурсов позволяют определить инфраструктуру Azure в коде. В шаблоне можно определить необходимые ресурсы, сетевые подключения или конфигурацию виртуальных машин. Эти шаблоны создают единообразные, воспроизводимые развертывания каждый раз, и их можно изменять путем изменения версии. Дополнительные сведения см. в разделе [Azure Resource Manager Templates Overview][template-overview].

Каждый ресурс определяется в шаблоне с помощью нотация объектов JavaScript (JSON). В следующем примере JSON используется тип ресурса *Microsoft. COMPUTE/virtualMachines/Extensions* для установки расширения Active Directoryного присоединение к домену. Используются параметры, указанные во время развертывания. При развертывании расширения виртуальная машина присоединяется к указанному управляемому домену.

```json
 {
      "apiVersion": "2015-06-15",
      "type": "Microsoft.Compute/virtualMachines/extensions",
      "name": "[concat(parameters('dnsLabelPrefix'),'/joindomain')]",
      "location": "[parameters('location')]",
      "dependsOn": [
        "[concat('Microsoft.Compute/virtualMachines/', parameters('dnsLabelPrefix'))]"
      ],
      "properties": {
        "publisher": "Microsoft.Compute",
        "type": "JsonADDomainExtension",
        "typeHandlerVersion": "1.3",
        "autoUpgradeMinorVersion": true,
        "settings": {
          "Name": "[parameters('domainToJoin')]",
          "OUPath": "[parameters('ouPath')]",
          "User": "[concat(parameters('domainToJoin'), '\\', parameters('domainUsername'))]",
          "Restart": "true",
          "Options": "[parameters('domainJoinOptions')]"
        },
        "protectedSettings": {
          "Password": "[parameters('domainPassword')]"
        }
      }
    }
```

Это расширение виртуальной машины можно развернуть, даже если вы не создаете виртуальную машину в том же шаблоне. В примерах, приведенных в этой статье, демонстрируются оба следующих подхода.

* [Создание виртуальной машины Windows Server и присоединение к управляемому домену](#create-a-windows-server-vm-and-join-to-a-managed-domain)
* [Присоединение существующей виртуальной машины Windows Server к управляемому домену](#join-an-existing-windows-server-vm-to-a-managed-domain)

## <a name="create-a-windows-server-vm-and-join-to-a-managed-domain"></a>Создание виртуальной машины Windows Server и присоединение к управляемому домену

Если требуется виртуальная машина Windows Server, можно создать и настроить ее с помощью шаблона диспетчер ресурсов. После развертывания виртуальной машины устанавливается расширение, чтобы присоединить виртуальную машину к управляемому домену. Если у вас уже есть виртуальная машина, которую вы хотите присоединить к управляемому домену, перейдите к [присоединению существующей виртуальной машины Windows Server к управляемому домену](#join-an-existing-windows-server-vm-to-a-managed-domain).

Чтобы создать виртуальную машину Windows Server, присоедините ее к управляемому домену, выполните следующие действия.

1. Перейдите к [шаблону](https://azure.microsoft.com/resources/templates/201-vm-domain-join/)быстрого запуска. Выберите параметр для **развертывания в Azure**.
1. На странице **Настраиваемое развертывание** введите следующие сведения, чтобы создать виртуальную машину Windows Server и присоединить ее к управляемому домену.

    | Параметр                   | Значение |
    |---------------------------|-------|
    | Подписка              | Выберите ту подписку Azure, в которой включены доменные службы Azure AD. |
    | Группа ресурсов            | Выберите группу ресурсов для виртуальной машины. |
    | Расположение                  | Выберите расположение для виртуальной машины. |
    | Имя существующей виртуальной сети        | Имя существующей виртуальной сети, к которой подключается виртуальная машина, например *myVnet*. |
    | Существующее имя подсети      | Имя существующей подсети виртуальной сети, например *рабочие нагрузки*. |
    | Префикс метки DNS          | Введите DNS-имя, которое будет использоваться для виртуальной машины, например *myvm*. |
    | Размер виртуальной машины                   | Укажите размер виртуальной машины, например *Standard_DS2_v2*. |
    | Домен для присоединение            | Имя DNS управляемого домена, например *aaddscontoso.com*. |
    | Имя пользователя домена           | Учетная запись пользователя в управляемом домене, которая должна использоваться для приподключения виртуальной машины к управляемому домену, например `contosoadmin@aaddscontoso.com` . Эта учетная запись должна быть частью управляемого домена. |
    | Пароль домена           | Пароль для учетной записи пользователя, указанной в предыдущем параметре. |
    | Необязательный путь подразделения          | Настраиваемое подразделение, в которое добавляется виртуальная машина. Если не указать значение для этого параметра, виртуальная машина будет добавлена в подразделение по умолчанию *AAD DC Computers* . |
    | Имя пользователя администратора виртуальной машины         | Укажите учетную запись локального администратора для создания на виртуальной машине. |
    | Пароль администратора виртуальной машины         | Укажите пароль локального администратора для виртуальной машины. Создайте надежный пароль локального администратора для защиты от атак методом подбора пароля. |

1. Просмотрите условия, а затем установите флажок **я принимаю указанные выше условия**. Когда все будет готово, выберите **приобрести** , чтобы создать виртуальную машину и присоединить ее к управляемому домену.

> [!WARNING]
> **С осторожностью обращайтесь с паролями.**
> Файл параметров шаблона запрашивает пароль для учетной записи пользователя, которая является частью управляемого домена. Не вводите значения вручную в этот файл и оставьте его доступным в общих папках или в других общих расположениях.

Успешное завершение развертывания занимает несколько минут. По завершении виртуальная машина Windows будет создана и присоединена к управляемому домену. Виртуальную машину можно управлять или выполнять вход с помощью учетных записей домена.

## <a name="join-an-existing-windows-server-vm-to-a-managed-domain"></a>Присоединение существующей виртуальной машины Windows Server к управляемому домену

Если у вас есть виртуальная машина или группа виртуальных машин, которые вы хотите присоединить к управляемому домену, можно использовать шаблон диспетчер ресурсов, чтобы просто развернуть расширение виртуальной машины.

Чтобы присоединить существующую виртуальную машину Windows Server к управляемому домену, выполните следующие действия.

1. Перейдите к [шаблону](https://azure.microsoft.com/resources/templates/201-vm-domain-join-existing/)быстрого запуска. Выберите параметр для **развертывания в Azure**.
1. На странице **Настраиваемое развертывание** введите следующие сведения, чтобы ПРИсоединить виртуальную машину к управляемому домену:

    | Параметр                   | Значение |
    |---------------------------|-------|
    | Подписка              | Выберите ту подписку Azure, в которой включены доменные службы Azure AD. |
    | Группа ресурсов            | Выберите группу ресурсов с существующей виртуальной машиной. |
    | Расположение                  | Выберите расположение существующей виртуальной машины. |
    | Список виртуальных машин                   | Введите разделенный запятыми список существующих виртуальных машин, которые нужно присоединить к управляемому домену, например *myVM1, myVM2*. |
    | Имя пользователя присоединение к домену     | Учетная запись пользователя в управляемом домене, которая должна использоваться для приподключения виртуальной машины к управляемому домену, например `contosoadmin@aaddscontoso.com` . Эта учетная запись должна быть частью управляемого домена. |
    | Пароль пользователя присоединение к домену | Пароль для учетной записи пользователя, указанной в предыдущем параметре. |
    | Необязательный путь подразделения          | Настраиваемое подразделение, в которое добавляется виртуальная машина. Если не указать значение для этого параметра, виртуальная машина будет добавлена в подразделение по умолчанию *AAD DC Computers* . |

1. Просмотрите условия, а затем установите флажок **я принимаю указанные выше условия**. Когда все будет готово, выберите **приобрести** , чтобы ПРИсоединить виртуальную машину к управляемому домену.

> [!WARNING]
> **С осторожностью обращайтесь с паролями.**
> Файл параметров шаблона запрашивает пароль для учетной записи пользователя, которая является частью управляемого домена. Не вводите значения вручную в этот файл и оставьте его доступным в общих папках или в других общих расположениях.

Для успешного завершения развертывания потребуется несколько секунд. По завершении указанные виртуальные машины Windows присоединяются к управляемому домену и могут управляться или входить с помощью учетных записей домена.

## <a name="next-steps"></a>Дальнейшие действия

В этой статье вы использовали портал Azure для настройки и развертывания ресурсов с помощью шаблонов. Вы также можете развертывать ресурсы с помощью шаблонов диспетчер ресурсов, используя [Azure PowerShell][deploy-powershell] или [Azure CLI][deploy-cli].

<!-- INTERNAL LINKS -->
[create-azure-ad-tenant]: ../active-directory/fundamentals/sign-up-organization.md
[associate-azure-ad-tenant]: ../active-directory/fundamentals/active-directory-how-subscriptions-associated-directory.md
[create-azure-ad-ds-instance]: tutorial-create-instance.md
[template-overview]: ../azure-resource-manager/templates/overview.md
[deploy-powershell]: ../azure-resource-manager/templates/deploy-powershell.md
[deploy-cli]: ../azure-resource-manager/templates/deploy-cli.md
