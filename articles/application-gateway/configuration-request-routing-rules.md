---
title: Конфигурация правил маршрутизации запросов шлюза приложений Azure
description: В этой статье описывается, как настроить правила маршрутизации запросов шлюза приложений Azure.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: conceptual
ms.date: 09/09/2020
ms.author: surmb
ms.openlocfilehash: 047ce9b33836e2c23a37b1383942323d7c382485
ms.sourcegitcommit: 0ce1ccdb34ad60321a647c691b0cff3b9d7a39c8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2020
ms.locfileid: "93397541"
---
# <a name="application-gateway-request-routing-rules"></a>Правила маршрутизации запросов шлюза приложений

При создании шлюза приложений с помощью портал Azure создается правило по умолчанию ( *Rule1* ). Это правило связывает прослушиватель по умолчанию ( *appGatewayHttpListener* ) с внутренним пулом по умолчанию ( *appGatewayBackendPool* ) и параметрами HTTP серверной части по умолчанию ( *appGatewayBackendHttpSettings* ). После создания шлюза можно изменить параметры правила по умолчанию или создать новые правила.

## <a name="rule-type"></a>Тип правила

При создании правила выбирается между [ *базовым* и *основанным на пути*](./application-gateway-components.md#request-routing-rules).

- Выберите базовый, если хотите перенаправить все запросы к связанному прослушивателю (например, *Blog <i></i> . contoso.com/ \* )* в один пул серверной части.
- Выберите путь на основе пути, если требуется направить запросы с конкретных URL-путей к конкретным внутренним пулам. Шаблон пути применяется только к пути URL-адреса, а не к его параметрам запроса.

### <a name="order-of-processing-rules"></a>Порядок правил обработки

Для номеров SKU v1 и v2 шаблон сопоставления входящих запросов обрабатывается в том порядке, в котором пути указаны на карте URL-пути правила на основе пути. Если запрос соответствует шаблону в двух или более путях на карте пути, то сначала соответствует указанному пути. И запрос перенаправляется в серверную части, связанную с этим путем.

## <a name="associated-listener"></a>Связанный прослушиватель

Свяжите прослушиватель с правилом таким образом, чтобы *правило маршрутизации запросов* , связанное с прослушивателем, было оценено для определения серверного пула, направляющего запрос.

## <a name="associated-back-end-pool"></a>Связанный серверный пул

Свяжите с правилом серверный пул, содержащий серверные целевые объекты, которые обслуживают запросы, получаемые прослушивателем.

 - Для базового правила допускается только один серверный пул. Все запросы к связанному прослушивателю перенаправляются в этот пул серверной части.

 - Для правила на основе пути добавьте несколько внутренних пулов, соответствующих каждому пути URL-адреса. Запросы, которые соответствуют указанному URL-адресу, перенаправляются в соответствующий пул серверной части. Кроме того, добавьте пул серверной части по умолчанию. Запросы, которые не соответствуют ни одному из URL-пути в правиле, перенаправляются в этот пул.

## <a name="associated-back-end-http-setting"></a>Связанный параметр HTTP серверной части

Добавьте параметр HTTP серверной части для каждого правила. Запросы направляются из шлюза приложений на серверные цели с использованием номера порта, протокола и других сведений, указанных в этом параметре.

Для базового правила допускается только один параметр HTTP серверной части. Все запросы к связанному прослушивателю перенаправляются в соответствующие целевые серверные цели с помощью этого параметра HTTP.

Для правила на основе пути добавьте несколько внутренних параметров HTTP, соответствующих каждому пути URL-адреса. Запросы, соответствующие URL-адресу в этом параметре, перенаправляются в соответствующие целевые объекты, используя параметры HTTP, соответствующие каждому пути URL-адреса. Кроме того, добавьте параметр HTTP по умолчанию. Запросы, которые не соответствуют ни одному URL-адресу в этом правиле, перенаправляются в пул серверной части по умолчанию, используя параметр HTTP по умолчанию.

## <a name="redirection-setting"></a>Параметр перенаправления

Если перенаправление настроено для базового правила, все запросы к связанному прослушивателю перенаправляются на целевой объект. Это *глобальное* перенаправление. Если перенаправление настроено для правила на основе пути, перенаправляются только запросы в определенной области сайта. Примером является область корзины для покупок, обозначенная */карт/ \**. Это перенаправление *на основе пути* .

Дополнительные сведения о перенаправлениях см. в статье [Обзор перенаправления шлюза приложений](redirect-overview.md).

### <a name="redirection-type"></a>Тип перенаправления

Выберите тип нужного перенаправления: *Постоянный (301)* , *временный (307)* , *найденный (302* ) или *другой (303)*.

### <a name="redirection-target"></a>Цель перенаправления

Выберите другой прослушиватель или внешний сайт в качестве цели перенаправления.

#### <a name="listener"></a>Прослушиватель

Выберите прослушиватель в качестве цели перенаправления, чтобы перенаправить трафик от одного прослушивателя к другому на шлюзе. Этот параметр необходим, если требуется включить перенаправление HTTP в HTTPS. Он перенаправляет трафик от прослушивателя источника, который проверяет наличие входящих HTTP-запросов на прослушиватель назначения, который проверяет наличие входящих запросов HTTPS. Можно также включить строку запроса и путь из исходного запроса в запрос, перенаправляемый целевому объекту перенаправления.

![Диалоговое окно "компоненты шлюза приложений"](./media/configuration-overview/configure-redirection.png)

Дополнительные сведения о перенаправлении HTTP в HTTPS см. в следующих статьях:
- [Перенаправление HTTP-to-HTTPS с помощью портал Azure](redirect-http-to-https-portal.md)
- [Перенаправление HTTP в HTTPS с помощью PowerShell](redirect-http-to-https-powershell.md)
- [Перенаправление HTTP-to-HTTPS с помощью Azure CLI](redirect-http-to-https-cli.md)

#### <a name="external-site"></a>Внешний сайт

Выберите внешний сайт, если требуется перенаправить трафик прослушивателя, связанного с этим правилом, на внешний сайт. Можно выбрать включение строки запроса из исходного запроса в запрос, перенаправляемый цели перенаправления. Невозможно переадресовать путь к внешнему сайту, который был в исходном запросе.

Дополнительные сведения о перенаправлении см. в следующих статьях:
- [Перенаправление трафика на внешний сайт с помощью PowerShell](redirect-external-site-powershell.md)
- [Перенаправление трафика на внешний сайт с помощью интерфейса командной строки](redirect-external-site-cli.md)

## <a name="rewrite-http-headers-and-url"></a>Перезапись заголовков HTTP и URL-адреса

С помощью правил перезаписи можно добавлять, удалять или обновлять заголовки запросов и ответов HTTP (S), а также URL-пути и параметры строки запроса, так как пакеты запросов и ответов перемещаются между клиентом и серверным пулом через шлюз приложений.

Для заголовков и параметров URL-адреса можно задать статические значения или другие заголовки и серверные переменные. Это позволяет использовать важные варианты использования, такие как извлечение IP-адресов клиентов, удаление конфиденциальных сведений о серверной части, добавление дополнительной защиты и т. д.
Дополнительные сведения см. в разделе:

 - [Перезапись заголовков HTTP и обзора URL-адресов](rewrite-http-headers-url.md)
 - [Настройка перезаписи HTTP-заголовка](rewrite-http-headers-portal.md)
 - [Настройка переопределения URL-адресов](rewrite-url-portal.md)

## <a name="next-steps"></a>Дальнейшие шаги

- [Сведения о параметрах HTTP](configuration-http-settings.md)