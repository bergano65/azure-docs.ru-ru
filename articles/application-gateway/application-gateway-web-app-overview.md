---
title: Общие сведения о мультитенантных серверных частей, таких как служба приложений Azure, с помощью шлюза приложений Azure
description: На этой странице предоставлен обзор поддержки мультитенантных серверных частей в шлюзе приложений.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: article
ms.date: 03/18/2019
ms.author: victorh
ms.openlocfilehash: 8434340bb7ed95cc36115c05048b2b67682b5796
ms.sourcegitcommit: 12d67f9e4956bb30e7ca55209dd15d51a692d4f6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2019
ms.locfileid: "58224504"
---
# <a name="application-gateway-support-for-multi-tenant-back-ends-such-as-app-service"></a>Поддерживает ли шлюз приложений мультитенантные серверные части заканчивается, таких как служба приложений

В мультитенантной архитектуры в веб-серверы на один и тот же экземпляр сервера веб запущено несколько веб-сайтов. Имена узлов используются для различения между различными приложениями, которые размещены. По умолчанию шлюз приложений не изменяет заголовок узла входящих данных HTTP от клиента и без изменений отправляет его на серверную часть. Этот метод хорошо работает для членов внутреннего пула, например сетевых карт, масштабируемых наборов виртуальных машин, общедоступных IP-адресов, внутренний IP-адреса и полного доменного ИМЕНИ, так как они не зависят от конкретного заголовка узла или расширения SNI при разрешении в правильную конечную точку. Тем не менее существует множество служб, таких как веб-приложениях службы приложений Azure и управления Azure API, которые мультитенантны по своей природе и зависят от конкретного заголовка узла или расширения SNI при разрешении в правильную конечную точку. Как правило DNS-имя приложения, который в свою очередь является DNS-имя, связанное со шлюзом приложений, отличается от имени домена во внутреннюю службу. Таким образом заголовок узла в исходном запросе, полученных с помощью шлюза приложений не совпадает с именем узла в серверной службе. По этой причине до изменения имени узла службы серверной части, заголовок узла в запросе к серверной части, шлюз приложений мультитенантные серверные части не может разрешить запрос на правильную конечную точку. 

Шлюз приложений предоставляет возможность, которая позволяет пользователям переопределять заголовок узла HTTP в запрос в зависимости от имени узла серверной части. Эта возможность обеспечивает поддержку мультитенантных серверных частей, например веб-приложениях службы приложений Azure и службы управления API. Эта возможность доступна для v1 и v2 standard и номера SKU WAF. 

![Переопределение узла](./media/application-gateway-web-app-overview/host-override.png)

> [!NOTE]
> Это не применимо к среде службы приложений Azure (ASE), так как ASE — это выделенный ресурс, в отличие от службы приложений Azure, которая находится ресурсов несколькими клиентами.

## <a name="override-host-header-in-the-request"></a>Переопределить заголовок узла в запросе

Возможность указывать переопределение узла определяется в [параметры HTTP](https://docs.microsoft.com/azure/application-gateway/configuration-overview#http-settings) и может применяться к любому пулу серверной части при создании правила. Поддерживается два следующих способа переопределения заголовка узла и расширения SNI для мультитенантных серверных частей:

- Возможность задать имя узла в параметрах HTTP фиксированное значение. Эта возможность гарантирует, что заголовок узла переопределяется этим значением для всего трафика в пул серверной части, где применяются определенных параметров HTTP. При использовании сквозного шифрования SSL переопределенное имя узла используется в расширении SNI. Эта возможность позволяет использовать сценарии, в которых ферма серверных пулов ожидает заголовок узла, который отличается от входящего заголовка узла клиента.

- Возможность получать имя узла из IP-адреса или полного доменного имени участников серверного пула. Параметры HTTP также обеспечивают возможность динамически получить имя узла из полного доменного ИМЕНИ участника пула серверной части, если настроена такая возможность получать имя узла из члена отдельных пула серверной части. При использовании сквозного шифрования SSL имя узла извлекается из полного доменного имени и используется в расширении SNI. Эта возможность позволяет использовать сценарии, в которых серверный пул имеет несколько мультитенатных служб PaaS, таких как Веб-приложения Azure, а заголовок узла в запросе к каждому участнику содержит имя узла, извлеченное из полного доменного имени. Для реализации этого сценария, мы используем параметр в параметрах HTTP вызывается [выбрать имя узла из адресов серверной части](https://docs.microsoft.com/azure/application-gateway/configuration-overview#pick-host-name-from-backend-address) которого будет динамически переопределять заголовок узла в исходном запросе к упомянутой в серверном пуле.  Например если полное доменное имя внутреннего пула содержит «contoso11.azurewebsites.net» и «contoso22.azurewebsites.net», заголовок узла исходного запроса, который является contoso.com будут переопределены contoso11.azurewebsites.net или contoso22.azurewebsites.net Когда запрос отправляется на соответствующий внутренний сервер. 

  ![сценарий веб-приложения](./media/application-gateway-web-app-overview/scenario.png)

Благодаря этой возможности клиенты настраивают параметры HTTP и пользовательские пробы для соответствующей конфигурации. Этот параметр затем привязывается к прослушивателю и серверному пулу с помощью правила.

## <a name="special-considerations"></a>Специальные рекомендации

### <a name="ssl-termination-and-end-to-end-ssl-with-multi-tenant-services"></a>Завершение запросов SSL и сквозного режима связи SSL с несколькими клиентами служб

Сквозное шифрование SSL и завершение SSL-запросов поддерживается с несколькими клиентами служб. Для завершения запросов SSL на шлюзе приложений SSL-сертификат остается необходимо добавить прослушиватель шлюза приложения. Тем не менее в случае сквозного режима связи SSL, доверенным Azure служб, таких как веб-приложениях службы приложений Azure не требуют утвержденный список серверных частей в шлюзе приложений. Таким образом нет необходимости добавлять сертификаты проверки подлинности. 

![сквозного шифрования SSL](./media/application-gateway-web-app-overview/end-to-end-ssl.png)

Обратите внимание, что на приведенном выше рисунке, не требуется, чтобы добавить сертификаты проверки подлинности, при выборе службы приложений в качестве серверной части.

### <a name="health-probe"></a>Проверка работоспособности

Переопределение заголовок узла в **параметры HTTP** влияет только на запрос и его маршрут. она не влияет на поведение проверки работоспособности. Для комплексной работы функции и пробы, и параметры HTTP необходимо изменить в соответствии с правильной конфигурацией. Помимо возможность указать заголовок узла в конфигурации пробы, пользовательские пробы также поддерживают возможность извлекать заголовок узла на основе настроенных параметров HTTP. Эту конфигурацию можно указать с помощью параметра `PickHostNameFromBackendHttpSettings` в конфигурации пробы.

### <a name="redirection-to-app-services-url-scenario"></a>Перенаправление на URL-адрес сценария службы приложений

Может существовать сценарии, где имя узла в ответе от службы приложений может направлять в браузере конечного пользователя *. azurewebsites.net имя узла, а не в домен, связанный со шлюзом приложений. Эта проблема может происходить при:

- У вас есть перенаправления, настроены в вашей службе приложений. Перенаправления может быть простым добавлением к запросу конечной косой чертой.
- У вас есть проверка подлинности Azure AD, которая вызывает перенаправление.

Для устранения таких случаях, см. в разделе [Устранение перенаправление к проблеме URL-адрес службы приложений](https://docs.microsoft.com/azure/application-gateway/troubleshoot-app-service-redirection-app-service-url).

## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как настроить шлюз приложений с помощью мультитенантного приложения, такие как веб-приложение службы приложений Azure, как элемент внутреннего пула, посетив [Настройка приложения службы веб-приложений с помощью шлюза приложений](https://docs.microsoft.com/azure/application-gateway/create-web-app)
