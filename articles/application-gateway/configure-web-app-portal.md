---
title: Управление трафиком для приложений с несколькими клиентами с помощью портала
titleSuffix: Azure Application Gateway
description: В этой статье содержатся инструкции по настройке веб-приложений службы приложений Azure в качестве членов серверного пула в существующем или новом шлюзе приложений.
services: application-gateway
author: surajmb
ms.service: application-gateway
ms.topic: how-to
ms.date: 09/23/2020
ms.author: victorh
ms.openlocfilehash: df92e08e91761d77c606ccb5389eee7dc219c101
ms.sourcegitcommit: 32c521a2ef396d121e71ba682e098092ac673b30
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2020
ms.locfileid: "91323394"
---
# <a name="configure-app-service-with-application-gateway"></a>Настройка службы приложений с помощью шлюза приложений

Так как служба приложений является многоклиентской службой, а не выделенным развертыванием, она использует заголовок узла во входящем запросе, чтобы разрешить запрос к правильной конечной точке службы приложений. Как правило, DNS-имя приложения, которое, в свою очередь, является DNS-именем, связанным с шлюзом приложений, которое находится за презвеном службы приложений, отличается от доменного имени службы серверных приложений. Таким образом, заголовок узла в исходном запросе, полученный шлюзом приложений, не совпадает с именем узла внутренней службы. По этой причине, если заголовок узла в запросе от шлюза приложений к серверной части не изменится на имя узла внутренней службы, серверные части с несколькими клиентами не смогут разрешить запрос в правильную конечную точку.

Шлюз приложений предоставляет переключатель `Pick host name from backend target` , который переопределяет заголовок узла в запросе с именем узла серверной части, когда запрос направляется из шлюза приложений в серверную часть. Эта возможность позволяет поддерживать многоклиентские серверные возможности, такие как служба приложений Azure и управление API. 

Вы узнаете, как выполнять следующие задачи:

- Изменение серверного пула и добавление в него службы приложений
- Изменить параметры HTTP с включенным параметром "выбрать имя узла"

## <a name="prerequisites"></a>Предварительные требования

- Шлюз приложений. Создайте шлюз приложений без целевого сервера пула. Дополнительные сведения см. в разделе [Краткое руководство. прямой веб-трафик с помощью шлюза приложений Azure. портал Azure](quick-create-portal.md)

- Служба приложений. Если у вас нет существующей службы приложений, см. [документацию по службе приложений](https://docs.microsoft.com/azure/app-service/).

## <a name="add-app-service-as-backend-pool"></a>Добавить службу приложений в качестве серверного пула

1. В портал Azure выберите свой шлюз приложений.

2. В разделе **серверные пулы**выберите внутренний пул.

4. В разделе **тип целевого объекта**выберите **службы приложений**.

5. В разделе **Цель** выберите службу приложений.

   :::image type="content" source="./media/configure-web-app-portal/backend-pool.png" alt-text="Серверная часть службы приложений":::
   
   > [!NOTE]
   > В раскрывающемся списке заполняются только те службы приложений, которые находятся в той же подписке, что и шлюз приложений. Если вы хотите использовать службу приложений, которая находится в другой подписке, чем та, в которой находится шлюз приложений, то вместо выбора **служб приложений** в раскрывающемся списке **целевые объекты** выберите параметр **IP-адрес или имя узла** и введите имя узла (например,. azurewebsites.net) службы приложений.
1. Щелкните **Сохранить**.

## <a name="edit-http-settings-for-app-service"></a>Изменить параметры HTTP для службы приложений

1. В разделе **Параметры HTTP**выберите существующий параметр HTTP.

2. В разделе **переопределить с новым именем узла**выберите **Да**.
3. В разделе **переопределение имени узла**выберите выбрать **имя узла из серверного целевого объекта**.
4. Щелкните **Сохранить**.

   :::image type="content" source="./media/configure-web-app-portal/http-settings.png" alt-text="Выбор имени узла из серверных параметров HTTP":::

## <a name="additional-configuration-in-case-of-redirection-to-app-services-relative-path"></a>Дополнительная настройка в случае перенаправления в относительный путь службы приложений

Когда служба приложений отправляет клиенту ответ перенаправления для перенаправления на относительный путь (например, перенаправление с `contoso.azurewebsites.net/path1` на `contoso.azurewebsites.net/path2` ), он использует то же имя узла в заголовке Location своего ответа, что и в запросе, полученном от шлюза приложений. Поэтому клиент сделает запрос напрямую, `contoso.azurewebsites.net/path2` а не через шлюз приложений ( `contoso.com/path2` ). Обход шлюза приложений нежелательно.

В случае использования в сценариях, где службе приложений потребуется отправить ответ перенаправления клиенту, выполните [Дополнительные действия для перезаписи заголовка Location](https://docs.microsoft.com/azure/application-gateway/troubleshoot-app-service-redirection-app-service-url#sample-configuration).

## <a name="restrict-access"></a>Ограничение доступа

Веб-приложения, развернутые в этих примерах, используют общедоступные IP-адреса, доступ к которым можно получить напрямую из Интернета. Это помогает устранить неполадки, когда вы знакомитесь с новыми функциями и пробуете новинки. Однако, если вы хотите развернуть функцию в производственной среде, необходимо добавить дополнительные ограничения.

Один из способов ограничения доступа к веб-приложению — использовать [ограничения статических IP-адресов в Службе приложений Azure](../app-service/app-service-ip-restrictions.md). Например, можно ограничить веб-приложение, чтобы получать трафик только из шлюза приложения. Используйте функцию ограничения IP-адреса для службы приложения, чтобы сделать виртуальный IP-адрес шлюза приложения единственным адресом с доступом.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о службе приложений и другой поддержке нескольких клиентов с помощью шлюза приложений см. в разделе [Поддержка службы с несколькими клиентами с помощью шлюза приложений](https://docs.microsoft.com/azure/application-gateway/application-gateway-web-app-overview).
