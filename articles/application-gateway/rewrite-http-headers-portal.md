---
title: Перезапись заголовков HTTP-запроса и ответа на портале — шлюз приложений Azure
description: Узнайте, как использовать портал Azure для настройки шлюза приложений Azure на перезапись заголовков HTTP в запросах и ответах, передаваемых через шлюз.
services: application-gateway
author: abshamsft
ms.service: application-gateway
ms.topic: article
ms.date: 11/13/2019
ms.author: absha
ms.custom: mvc
ms.openlocfilehash: b90736b3ed1c1f69488fde4a386cf215d751c362
ms.sourcegitcommit: ae8b23ab3488a2bbbf4c7ad49e285352f2d67a68
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/13/2019
ms.locfileid: "74012857"
---
# <a name="rewrite-http-request-and-response-headers-with-azure-application-gateway---azure-portal"></a>Перезапись заголовков HTTP-запроса и ответа с помощью шлюза приложений Azure — портал Azure

В этой статье описывается, как использовать портал Azure для настройки экземпляра [SKU шлюза приложений версии 2](<https://docs.microsoft.com/azure/application-gateway/application-gateway-autoscaling-zone-redundant>) для перезаписи заголовков HTTP в запросах и ответах.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) , прежде чем начинать работу.

## <a name="before-you-begin"></a>Перед началом работы

Для выполнения действий, описанных в этой статье, необходимо иметь экземпляр SKU шлюза приложений версии 2. Перезапись заголовков не поддерживается в номере SKU v1. Если у вас нет номера SKU v2, создайте экземпляр [шлюза приложений версии 2 (SKU](https://docs.microsoft.com/azure/application-gateway/tutorial-autoscale-ps) ) перед началом.

## <a name="create-required-objects"></a>Создание необходимых объектов

Чтобы настроить перезапись HTTP-заголовка, необходимо выполнить следующие действия.

1. Создайте объекты, необходимые для перезаписи заголовка HTTP:

   - **Действие перезаписи**: используется для указания полей заголовка запроса и запроса, которые требуется перезаписать, и нового значения для заголовков. Можно связать одно или несколько условий перезаписи с действием перезаписи.

   - **Условие перезаписи**: Необязательная конфигурация. Условия перезаписи оценивают содержимое запросов HTTP (S) и ответов. Действие перезаписи будет выполнено, если запрос HTTP (S) или ответ соответствует условию перезаписи.

     При связывании более одного условия с действием действие выполняется только при соблюдении всех условий. Иными словами, операция является логической операцией и.

   - **Правило перезаписи**: содержит несколько сочетаний "действие перезаписи" и "Перезапись".

   - **Последовательность правил**. помогает определить порядок выполнения правил перезаписи. Эта конфигурация полезна при наличии нескольких правил перезаписи в наборе перезаписи. Сначала выполняется правило перезаписи с более низким значением последовательности правил. Если присвоить одно и то же значение последовательности правил двум правилам перезаписи, порядок выполнения не детерминирован.

   - **Набор перезаписи**: содержит несколько правил перезаписи, которые будут связаны с правилом маршрутизации запросов.

2. Присоедините набор перезаписи к правилу маршрутизации. Конфигурация перезаписи прикрепляется к исходному прослушивателю с помощью правила маршрутизации. При использовании базового правила маршрутизации конфигурация перезаписи заголовка связана с прослушивателем источника и переписывается глобальным заголовком. При использовании правила маршрутизации на основе пути конфигурация перезаписи заголовка определяется на карте URL-пути. В этом случае он применяется только к определенной области пути сайта.

Можно создать несколько наборов перезаписи заголовков HTTP и применить каждый набор перезаписи к нескольким прослушивателям. Но для конкретного прослушивателя можно применить только один набор перезаписи.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com/) с помощью своей учетной записи Azure.

## <a name="configure-header-rewrite"></a>Настройка перезаписи заголовков

В этом примере мы изменим URL-адрес перенаправления, перезаписав заголовок Location в HTTP-ответе, отправленном внутренним приложением.

1. Выберите **все ресурсы**, а затем выберите свой шлюз приложений.

2. Выберите **Перезапись** в левой области.

3. Выберите **набор перезаписи**:

   ![Добавить набор перезаписи](media/rewrite-http-headers-portal/add-rewrite-set.png)

4. Укажите имя для набора перезаписи и свяжите его с правилом маршрутизации:

   - Введите имя набора перезаписи в поле **имя** .
   - Выберите одно или несколько правил, перечисленных в списке **связанные правила маршрутизации** . Можно выбрать только те правила, которые не связаны с другими наборами перезаписи. Правила, которые уже связаны с другими наборами перезаписи, недоступны.
   - Нажмите кнопку **Далее**.
   
     ![Добавить имя и сопоставление](media/rewrite-http-headers-portal/name-and-association.png)

5. Создайте правило перезаписи:

   - Выберите **Добавить правило перезаписи**.

     ![Добавить правило перезаписи](media/rewrite-http-headers-portal/add-rewrite-rule.png)

   - Введите имя для правила перезаписи в поле **имя правила перезаписи** . Введите число в поле **последовательность правил** .

     ![Добавить имя правила перезаписи](media/rewrite-http-headers-portal/rule-name.png)

6. В этом примере заголовок Location будет перезаписан только в том случае, если он содержит ссылку на azurewebsites.net. Для этого добавьте условие, определяющее, содержит ли заголовок Location в ответе azurewebsites.net:

   - Выберите **Добавить условие** , а затем выберите поле, содержащее инструкции **If** , чтобы развернуть его.

     ![Добавить условие](media/rewrite-http-headers-portal/add-condition.png)

   - В списке **тип** проверяемой переменной выберите **заголовок HTTP**.

   - В списке **тип заголовка** выберите **ответ**.

   - Так как в этом примере мы тестируем заголовок Location, который является общим заголовком, выберите **общий заголовок** под **заголовком Имя**.

   - В списке **общий заголовок** выберите **Расположение**.

   - В разделе **с учетом регистра**выберите **нет**.

   - В списке **оператор** выберите **равно (=)** .

   - Введите шаблон регулярного выражения. В этом примере мы будем использовать шаблон `(https?):\/\/.*azurewebsites\.net(.*)$`.

   - Нажмите кнопку **ОК**.

     ![Настройка условия If](media/rewrite-http-headers-portal/condition.png)

7. Добавьте действие для перезаписи заголовка расположения:

   - В списке **тип действия** выберите **задать**.

   - В списке **тип заголовка** выберите **ответ**.

   - В разделе **имя заголовка**выберите **общий заголовок**.

   - В списке **общий заголовок** выберите **Расположение**.

   - Введите значение заголовка. В этом примере в качестве значения заголовка будет использоваться `{http_resp_Location_1}://contoso.com{http_resp_Location_2}`. Это значение заменит *azurewebsites.NET* на *contoso.com* в заголовке Location.

   - Нажмите кнопку **ОК**.

     ![Добавление действия](media/rewrite-http-headers-portal/action.png)

8. Выберите **создать** , чтобы создать набор перезаписи:

   ![Нажмите кнопку "Создать"](media/rewrite-http-headers-portal/create.png)

9. Откроется представление перезаписи набора. Убедитесь, что созданный набор перезаписи находится в списке наборов перезаписи:

   ![Представление перезаписи набора](media/rewrite-http-headers-portal/rewrite-set-list.png)

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о том, как настроить некоторые распространенные варианты использования, см. в статье [Общие сценарии перезаписи заголовков](https://docs.microsoft.com/azure/application-gateway/rewrite-http-headers).