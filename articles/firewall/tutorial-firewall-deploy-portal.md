---
title: Руководство по развертыванию и настройке службы "Брандмауэр Azure" с помощью портала Azure
description: В этом руководстве вы можете узнать, как развернуть и настроить службу "Брандмауэр Azure" с помощью портала Azure.
services: firewall
author: vhorne
ms.service: firewall
ms.topic: tutorial
ms.date: 11/15/2018
ms.author: victorh
ms.custom: mvc
ms.openlocfilehash: 8a3a9e4019be0b6039fe43df11a5f6093545f9cd
ms.sourcegitcommit: db2cb1c4add355074c384f403c8d9fcd03d12b0c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2018
ms.locfileid: "51685369"
---
# <a name="tutorial-deploy-and-configure-azure-firewall-using-the-azure-portal"></a>Руководство по развертыванию и настройке службы "Брандмауэр Azure" с помощью портала Azure

Управление доступом исходящих сетевых подключений является важной частью общего плана безопасности сети. Например, вы можете ограничить доступ к веб-сайтам или исходящим IP-адресам и портам, которые могут быть доступными.

Вы можете управлять доступом к исходящей сети из подсети Azure только с помощью Брандмауэра Azure. Брандмауэр Azure позволяет настроить:

* Правила приложений, определяющие полные доменные имена (FQDN), к которым можно получить доступ из подсети.
* Правила сети, определяющие адрес источника, протокол, порт назначения и адрес назначения.

При маршрутизации трафика на брандмауэр, используемый в качестве шлюза по умолчанию, для подсети к трафику применяются настроенные правила брандмауэра.

В этом руководстве вы создадите упрощенную виртуальную сеть с тремя подсетями для легкого развертывания: Для рабочих развертываний рекомендуется использовать [звездообразную модель](https://docs.microsoft.com/azure/architecture/reference-architectures/hybrid-networking/hub-spoke), в которой брандмауэр находится в собственной виртуальной сети, а серверы рабочей нагрузки размещены в пиринговых виртуальных сетях в одном регионе с одной или несколькими подсетями.

- **AzureFirewallSubnet** — в этой подсети находится брандмауэр.
- **Workload-SN** — в этой подсети находится сервер рабочей нагрузки. Трафик этой подсети проходит через брандмауэр.
- **Jump-SN** — в этой подсети находится сервер перехода. Сервер перехода имеет общедоступный IP-адрес, к которому можно подключиться с помощью удаленного рабочего стола. Затем вы можете подключиться к серверу рабочей нагрузки (используя другой удаленный рабочий стол).

![Инфраструктура сети, используемая в руководстве](media/tutorial-firewall-rules-portal/Tutorial_network.png)

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * настройка тестовой сетевой среды;
> * развертывание брандмауэра;
> * создание маршрута по умолчанию;
> * настройка приложения для предоставления доступа к github.com;
> * настройка сетевых правил для предоставления доступа к внешним DNS-серверам;
> * тестирование брандмауэра.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="set-up-the-network"></a>Настройка сети

Сначала создайте группу ресурсов, необходимых для развертывания брандмауэра. Затем создайте виртуальную сеть, подсети и тестовые серверы.

### <a name="create-a-resource-group"></a>Создание группы ресурсов

Группа ресурсов содержит все ресурсы, необходимые для работы с этим руководством.

1. Войдите на портал Azure по адресу [http://portal.azure.com](http://portal.azure.com).
2. На домашней странице портала Azure щелкните **Группы ресурсов** > **Добавить**.
3. В качестве **имени группы ресурсов** введите **Test-FW-RG**.
4. В качестве **подписки** выберите свою подписку.
5. В качестве **расположения группы ресурсов** выберите расположение. Все следующие ресурсы, которые вы будете создавать, должны находиться в одном расположении.
6. Нажмите кнопку **Создать**.

### <a name="create-a-vnet"></a>Создание виртуальной сети

В этой виртуальной сети будет содержаться три подсети.

1. На домашней странице портала Azure щелкните **Все службы**.
2. В разделе **Сети** щелкните **Виртуальные сети**.
3. Щелкните **Добавить**.
4. В качестве **имени** введите **Test-FW-VN**.
5. В поле **адресного пространства** введите **10.0.0.0/16**.
6. В качестве **подписки** выберите свою подписку.
7. Для параметра **Группа ресурсов** выберите **Использовать существующую** > **Test-FW-RG**.
8. В поле **Расположение** выберите использованное ранее расположение.
9. В разделе **Подсеть** в качестве **имени** введите **AzureFirewallSubnet**. Брандмауэр будет размещен в этой подсети. Для подсети **необходимо** указать имя AzureFirewallSubnet.
10. В поле **Диапазон адресов** введите **10.0.1.0/24**.
11. Другие параметры оставьте настроенными по умолчанию, а затем нажмите кнопку **Создать**.

> [!NOTE]
> Минимальный размер подсети AzureFirewallSubnet равен /25.

### <a name="create-additional-subnets"></a>Создание дополнительных подсетей

Затем создайте подсети для сервера перехода и подсеть для серверов рабочей нагрузки.

1. На домашней странице портала Azure щелкните **Группы ресурсов** > **Test-FW-RG**.
2. Выберите виртуальную сеть **Test-FW-VN**.
3. Щелкните **Подсети** > **+Subnet** (+Подсеть).
4. В качестве **имени** введите **Workload-SN**.
5. В поле **Диапазон адресов** введите **10.0.2.0/24**.
6. Последовательно выберите **ОК**.

Создайте еще одну подсеть с именем **Jump-SN** и диапазоном адресов **10.0.3.0/24**.

### <a name="create-virtual-machines"></a>Создание виртуальных машин

Теперь создайте виртуальные машины для перехода и рабочей нагрузки и поместите их в соответствующие подсети.

1. На портале Azure щелкните **Создать ресурс**.
2. Щелкните **Вычисления**, а затем в списке "Рекомендованные" выберите **Windows Server 2016 Datacenter**.
3. Введите следующие значения для виртуальной машины:

    - *Test-FW-RG* для группы ресурсов.
    - *Srv-Jump* в качестве имени виртуальной машины.
    - *azureuser* — для имени пользователя учетной записи администратора;
    - *Azure123456!* — в качестве пароля.

4. В разделе **Правила входящего порта** для параметра **Общедоступные входящие порты** выберите **Разрешить выбранные порты**.
5. В поле **Выбрать входящие порты** выберите **RDP (3389)**.

6. Примите остальные значения по умолчанию и щелкните кнопку **Далее: Диски**.
7. Примите параметры дисков по умолчанию и щелкните кнопку **Далее: Сеть**.
8. Убедитесь, что выбрана виртуальная сеть **Test-FW-VN** и подсеть **Jump-SN**.
9. Для параметра **Общедоступный IP-адрес** щелкните кнопку **Создать**.
10. Введите **Srv-Jump-PIP** в качестве имени общедоступного IP-адреса и щелкните **ОК**.
11. Примите остальные параметры по умолчанию и щелкните кнопку **Далее: Управление**.
12. Выберите **Выкл.**, чтобы выключить диагностику загрузки. Примите другие параметры по умолчанию и щелкните кнопку **Просмотр и создание**.
13. Просмотрите параметры на странице сводки и нажмите кнопку **Создать**.

Повторите этот процесс, чтобы создать еще одну виртуальную машину с именем **Srv-Work**.

Используйте сведения в таблице ниже, чтобы настроить виртуальную машину Srv-Work. Остальная конфигурация такая же, как и для виртуальной машины Srv-Jump.

|Параметр  |Значение  |
|---------|---------|
|Подсеть|Workload-SN|
|Общедоступный IP-адрес|Нет|
|Общедоступные входящие порты|Нет|

## <a name="deploy-the-firewall"></a>Развертывание брандмауэра

Разверните брандмауэр в виртуальной сети.

1. На домашней странице портала щелкните **Создать ресурс**.
2. Выберите **Сети**, а затем — **Рекомендованные** и щелкните **Просмотреть все**.
3. Щелкните **Брандмауэр** > **Создать**. 
4. Используйте сведения в следующей таблице, чтобы настроить брандмауэр на странице **Создание брандмауэра**:
   
   |Параметр  |Значение  |
   |---------|---------|
   |ИМЯ     |Test-FW01|
   |Подписка     |\<ваша подписка\>|
   |Группа ресурсов     |**Use existing** (Использовать имеющуюся): Test-FW-RG |
   |Расположение     |Выберите использованное ранее расположение|
   |Выберите виртуальную сеть     |**Use existing** (Использовать имеющуюся): Test-FW-VN|
   |Общедоступный IP-адрес     |**Создать**. Общедоступный IP-адрес должен быть типа SKU "Стандартный".|

2. Щелкните **Review + create** (Просмотреть и создать).
3. Просмотрите информацию на странице сводки. Для создания брандмауэра нажмите кнопку **Создать**.

   Развертывание может занять несколько минут.
4. По завершении развертывания перейдите в группу ресурсов **Test-FW-RG** и щелкните брандмауэр **Test-FW01**.
6. Запишите частный IP-адрес. Вы будете использовать его позже при создании маршрута по умолчанию.

## <a name="create-a-default-route"></a>создание маршрута по умолчанию;

Для подсети **Workload-SN** настройте исходящий маршрут по умолчанию, чтобы пройти через брандмауэр.

1. На домашней странице портала Azure щелкните **Все службы**.
2. В разделе **Сети** щелкните **Таблицы маршрутов**.
3. Щелкните **Добавить**.
4. В качестве **имени** введите **Firewall-route**.
5. В качестве **подписки** выберите свою подписку.
6. В разделе **Группа ресурсов** выберите **Use existing** (Использовать имеющуюся), а затем — **Test-FW-RG**.
7. В поле **Расположение** выберите использованное ранее расположение.
8. Нажмите кнопку **Создать**.
9. Щелкните **Обновить**, а затем выберите таблицу маршрутов **Firewall-route**.
10. Щелкните **Подсети** > **Привязать**.
11. Щелкните **Виртуальная сеть** > **Test-FW-VN**.
12. В поле **Подсеть** щелкните **Workload-SN**. Убедитесь, что для этого маршрута выбрана только подсеть **рабочей нагрузки SN**. В противном случае брандмауэр не будет работать правильно.

13. Последовательно выберите **ОК**.
14. Щелкните **Маршруты** > **Добавить**.
15. В поле **Имя маршрута** введите **FW-DG**.
16. В поле **Префикс адреса** укажите **0.0.0.0/0**.
17. В поле **Тип следующего прыжка** выберите **Виртуальный модуль**.

    На самом деле, Брандмауэр Azure является управляемой службой, но в этой ситуации подходит виртуальный модуль.
18. В поле **Адрес следующего прыжка** введите частный IP-адрес для брандмауэра, который вы записали ранее.
19. Последовательно выберите **ОК**.

## <a name="configure-an-application-rule"></a>Настройка правила приложения

Это правило приложения, разрешающее исходящий доступ к github.com.

1. Откройте группу ресурсов **Test-FW-RG** и щелкните брандмауэр **Test-FW01**.
2. На странице **Test-FW01** в разделе **Параметры** щелкните **Правила**.
3. Щелкните вкладку **Коллекция правил приложения**.
4. Выберите **Добавление коллекции правил приложений**.
5. В поле **Имя** введите **App-Coll01**.
6. В поле **Приоритет** введите **200**.
7. В поле **Действие** выберите **Разрешить**.
8. В подразделе **Целевые полные доменные имена** раздела **Правила** в поле **Имя** введите **AllowGH**.
9. В поле **Адреса источника** введите **10.0.2.0/24**.
10. В поле **Протокол:порт** введите **http, https**.
11. В поле **Целевые полные доменные имена** введите **github.com**
12. Щелкните **Добавить**.

Брандмауэр Azure содержит встроенную коллекцию правил для целевых полных доменных имен инфраструктуры, которые разрешены по умолчанию. Эти доменные имена предназначены для платформы и не могут использоваться для других целей. См. дополнительные сведения об [FQDN инфраструктуры](infrastructure-fqdns.md).

## <a name="configure-a-network-rule"></a>Настройка правила сети

Это сетевое правило, предоставляющее двум IP-адресам исходящий доступ на порт 53 (DNS).

1. Щелкните вкладку **Коллекция правил сети**.
1. Щелкните **Добавление коллекции правил сети**.
2. В качестве **имени** введите **Net-Coll01**.
3. В поле **Приоритет** введите **200**.
4. В поле **Действие** выберите **Разрешить**.

6. В разделе **Правила** в поле **Имя** введите **AllowDNS**.
8. В поле **Протокол** выберите **UDP**.
9. В поле **Адреса источника** введите **10.0.2.0/24**.
10. В поле "Адрес назначения" введите **209.244.0.3,209.244.0.4**.
11. В поле **Порты назначения** введите **53**.
12. Щелкните **Добавить**.

### <a name="change-the-primary-and-secondary-dns-address-for-the-srv-work-network-interface"></a>Изменение первичного и вторичного адресов DNS для сетевого интерфейса **Srv-Work**

В целях тестирования в этом руководстве вы настраиваете первичный и вторичный адреса DNS. Это не является общим требованием службы "Брандмауэр Azure".

1. На портале Azure откройте группу ресурсов **Test-FW-RG**.
2. Выберите сетевой интерфейс для виртуальной машины **Srv-Work**.
3. В разделе **Параметры** выберите **DNS-серверы**.
4. В разделе **DNS-серверы** щелкните **Настраиваемый**.
5. Введите **209.244.0.3** в текстовое поле **Добавить DNS-сервер** и **209.244.0.4** — в следующее текстовое поле.
6. Выберите команду **Сохранить**. 
7. Перезапустите виртуальную машину **Srv-Work**.

## <a name="test-the-firewall"></a>тестирование брандмауэра.

Теперь проверьте брандмауэр, чтобы убедиться, что он работает должным образом.

1. На портале Azure просмотрите параметры сети для виртуальной машины **Srv-Work** и запишите частный IP-адрес.
2. Подключите удаленный рабочий стол к виртуальной машине **Srv-Jump** и откройте подключение удаленного рабочего стола к частному IP-адресу **Srv-Work**.

5. Откройте браузер Internet Explorer и перейдите на сайт http://github.com.
6. В оповещениях безопасности щелкните **ОК** > **Закрыть**.

   Откроется домашняя страница GitHub.

7. Перейдите по адресу http://www.msn.com.

   Брандмауэр должен вас заблокировать.

Итак, теперь вы убедились в том, что правила брандмауэра работают:

- Вы можете перейти только к одному разрешенному имени FQDN.
- Вы можете разрешать имена DNS с помощью настроенного внешнего DNS-сервера.

## <a name="clean-up-resources"></a>Очистка ресурсов

Вы можете сохранить ресурсы брандмауэра для следующего руководства или, если он больше не нужен, удалить группу ресурсов **Test-FW-RG**, чтобы удалить ресурсы, связанные с брандмауэром.

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Руководство по мониторингу журналов Брандмауэра Azure](./tutorial-diagnostics.md)
