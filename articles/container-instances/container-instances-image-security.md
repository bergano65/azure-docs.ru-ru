---
title: Вопросы безопасности для службы "экземпляры контейнеров Azure"
description: Рекомендации по защите образов и секретов для экземпляров контейнеров Azure, а также общие вопросы безопасности для любой платформы контейнеров
services: container-instances
author: dlepow
manager: gwallace
ms.service: container-instances
ms.topic: article
ms.date: 04/29/2019
ms.author: danlep
ms.custom: ''
ms.openlocfilehash: 618d3a901698e46760d970f6d4fbc4157c5d2ea3
ms.sourcegitcommit: 4b431e86e47b6feb8ac6b61487f910c17a55d121
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/18/2019
ms.locfileid: "68325924"
---
# <a name="security-considerations-for-azure-container-instances"></a>Вопросы безопасности для экземпляров контейнеров Azure

В этой статье рассматриваются вопросы безопасности при использовании службы "экземпляры контейнеров Azure" для запуска приложений контейнеров. Будут рассмотрены следующие задачи:

> [!div class="checklist"]
> * **Рекомендации по безопасности** для управления образами и секретами для экземпляров контейнеров Azure
> * **Рекомендации для экосистемы** контейнеров в течение жизненного цикла контейнера для любой платформы контейнеров

## <a name="security-recommendations-for-azure-container-instances"></a>Рекомендации по безопасности для службы "экземпляры контейнеров Azure"

### <a name="use-a-private-registry"></a>Использование частного реестра

Контейнеры состоят из образов, которые хранятся в одном или нескольких репозиториях. Эти репозитории могут принадлежать общедоступному реестру, например [DOCKER Hub](https://hub.docker.com)или частному реестру. Примером частного реестра является [Docker Trusted Registry](https://docs.docker.com/datacenter/dtr/2.0/), который можно установить локально или в виртуальном частном облаке. Вы также можете использовать закрытые облачные службы реестра контейнеров, включая [Реестр контейнеров Azure](../container-registry/container-registry-intro.md). 

Общедоступный образ контейнера не гарантирует безопасность. Образы контейнеров состоят из нескольких программных уровней, и у каждого уровня программного обеспечения могут быть уязвимости. Чтобы снизить опасность атак, следует хранить и извлекать образы из частного реестра, например реестра контейнеров Azure или доверенного реестра DOCKER. Помимо предоставления управляемого частного реестра, реестр контейнеров Azure поддерживает [проверку подлинности на основе субъекта-службы](../container-registry/container-registry-authentication.md) с помощью Azure Active Directory для обычных потоков проверки подлинности. Эта проверка подлинности включает доступ на основе ролей для разрешений только для чтения (Pull), записи (Push) и владельца.

### <a name="monitor-and-scan-container-images"></a>Мониторинг и сканирование образов контейнеров

Решения для мониторинга безопасности и сканирования, такие как [Twistlock](https://azuremarketplace.microsoft.com/marketplace/apps/twistlock.twistlock?tab=Overview) и [голубой уровень безопасности](https://azuremarketplace.microsoft.com/marketplace/apps/aqua-security.aqua-security?tab=Overview) , доступны в Azure Marketplace. Их можно использовать для сканирования образов контейнеров в частном реестре и выявления потенциальных уязвимостей. Важно понимать глубину сканирования, предоставляемую различными решениями. 

### <a name="protect-credentials"></a>Защита учетных данных

Контейнеры могут распределяться по нескольким кластерам и регионам Azure. Поэтому необходимо защитить учетные данные, необходимые для имен входа или доступа к API, таких как пароли или токены. Убедитесь, что только привилегированные пользователи могут получить доступ к этим контейнерам во время передачи и неактивных данных. Выполните инвентаризацию всех секретов учетных данных, а затем потребуйте от разработчиков использования новых средств управления секретами, предназначенных для платформ контейнеров.  Убедитесь, что решение включает зашифрованные базы данных, TLS-шифрование для секретных данных при передаче и [Управление доступом на основе ролей](../role-based-access-control/overview.md)с минимальными правами доступа. [Azure Key Vault](../key-vault/key-vault-secure-your-key-vault.md) — это облачная служба, которая защищает ключи и секреты шифрования (например, сертификаты, строки подключения и пароли) для контейнерных приложений. Так как эти данные являются конфиденциальными и являются критически важными для бизнеса, обеспечьте безопасный доступ к вашим хранилищам ключей, чтобы только разрешенные приложения и пользователи могли получить к ним доступ.

## <a name="considerations-for-the-container-ecosystem"></a>Рекомендации по экосистеме контейнеров

Следующие меры безопасности, реализуемые хорошо и управляемыми эффективно, могут помочь в защите и защите экосистемы контейнеров. Эти меры применяются на протяжении жизненного цикла контейнера, от разработки до развертывания в рабочей среде, а также для ряда оркестрации контейнеров, узлов и платформ. 

### <a name="use-vulnerability-management-as-part-of-your-container-development-lifecycle"></a>Использование управления уязвимостью в рамках жизненного цикла разработки контейнеров 

Используя эффективное управление уязвимостью в течение жизненного цикла разработки контейнеров, вы повышаете вероятность того, что Вы выявляете и устраняете проблемы безопасности, прежде чем они станут более серьезной проблемой. 

### <a name="scan-for-vulnerabilities"></a>Проверка на наличие уязвимостей 

Новые уязвимости обнаруживаются все время, поэтому поиск и идентификация уязвимостей — непрерывный процесс. Включение проверки уязвимостей в течение жизненного цикла контейнера:

* В качестве финальной проверки в конвейере разработки перед отправкой образов в общедоступный или частный реестр следует выполнить проверку наличия уязвимостей в контейнерах. 
* Продолжайте сканировать образы контейнеров в реестре как для выявления изъянов, которые по каким бы то ни было пропущены во время разработки, так и для устранения недавно обнаруженных уязвимостей, которые могут существовать в коде, используемом в образах контейнеров.  

### <a name="map-image-vulnerabilities-to-running-containers"></a>Преобразование уязвимостей изображений в выполняющиеся контейнеры 

Необходимо иметь средства сопоставления уязвимостей, определенных в образах контейнеров, для выполнения контейнеров, поэтому проблемы безопасности могут быть устранены или устранены.  

### <a name="ensure-that-only-approved-images-are-used-in-your-environment"></a>Убедитесь, что в вашей среде используются только утвержденные образы 

В экосистеме контейнеров достаточно изменить и изменчивости, не разрешив также неизвестные контейнеры. Разрешить только утвержденные образы контейнеров. Поставьте средства и процессы для отслеживания и предотвращения использования неутвержденных образов контейнеров. 

Эффективный способ снижения уязвимой зоны и предотвращения критических ошибок безопасности разработчиками является управление потоком образов контейнеров в среде разработки. Например, вы можете подвергнуть отдельный дистрибутив Linux как базовый образ, лучше всего такой, который является экономичным (Alpine или CoreOS, а не Ubuntu), чтобы снизить потенциальные атаки. 

Подписывание образов или отпечатки пальцев могут предоставлять цепочку поставок, которая позволяет проверять целостность контейнеров. Например, реестр контейнеров Azure поддерживает модель [доверия содержимого](https://docs.docker.com/engine/security/trust/content_trust) DOCKER, которая позволяет издателям изображений подписывать изображения, которые передаются в реестр, и потребители изображений, чтобы получать только подписанные изображения.

### <a name="permit-only-approved-registries"></a>Разрешите только утвержденные реестры 

Расширение, обеспечивающее использование только утвержденных образов в среде, позволяет только использовать утвержденные реестры контейнеров. Необходимость использования утвержденных реестров контейнеров уменьшает риск риска, ограничивая возможности для введения неизвестных уязвимостей или проблем безопасности. 

### <a name="ensure-the-integrity-of-images-throughout-the-lifecycle"></a>Обеспечение целостности образов в течение жизненного цикла 

Для управления безопасностью на протяжении жизненного цикла контейнера необходимо обеспечить целостность образов контейнеров в реестре, а также их изменения или развертывания в рабочей среде. 

* Образы с уязвимостями, даже небольшие, не должны быть разрешены для выполнения в рабочей среде. В идеале все образы, развернутые в рабочей среде, должны быть сохранены в частном реестре, доступном для нескольких выбранных. Чтобы обеспечить эффективное управление, следите за тем, чтобы количество рабочих образов было небольшим.

* Так как трудно определить происхождение программного обеспечения от общедоступного образа контейнера, создайте образы из источника, чтобы убедиться в том, что он является источником. Когда в автоматически созданном образе контейнера появляется уязвимость, клиенты могут достаточно быстро устранить эту проблему. С помощью общедоступного образа клиентам необходимо найти корень общедоступного образа, чтобы исправить его или получить другой защищенный образ от издателя. 

* Тщательно сканированное изображение, развернутое в рабочей среде, не обязательно должно быть актуальным в течение всего времени существования приложения. Вы можете получить сообщения об уязвимостях системы безопасности для слоев образа, с которыми вы не сталкивались ранее или которые были представлены после развертывания в рабочей среде. 

  Периодически проверяйте образы, развернутые в рабочей среде, чтобы определить, какие образы устарели или не были обновлены в течение определенного времени. Для обновления образов контейнеров без простоев можно использовать методологии развертывания "синий-зеленый" и последовательные механизмы обновления. Изображения можно сканировать с помощью средств, описанных в предыдущем разделе. 

* Используйте конвейер непрерывной интеграции (CI) с интегрированным сканированием безопасности для создания защищенных образов и их отправки в частный реестр. Сканирование уязвимостей, встроенное в решение непрерывной интеграции, обеспечивает отправку прошедших все проверки образов в частный реестр, из которого развертываются производственные рабочие нагрузки. 

  Сбой конвейера CI гарантирует, что уязвимые образы не помещаются в частный реестр, используемый для развертывания рабочей нагрузки в рабочей среде. Он также автоматизирует сканирование системы безопасности образа, если имеется значительное количество образов. Выполнение аудита образов вручную для обнаружения уязвимостей системы безопасности очень долгий процесс, подверженный ошибкам. 

### <a name="enforce-least-privileges-in-runtime"></a>Принудительное применение минимальных привилегий во время выполнения 

Концепция наименьших привилегий представляет собой базовую рекомендацию по обеспечению безопасности, которая также применяется к контейнерам. При использовании уязвимости она обычно предоставляет злоумышленнику доступ и привилегии, равные тем, которые были скомпрометированы в приложении или процессе. Обеспечение работы контейнеров с наименьшими привилегиями и доступом, необходимым для выполнения задания, сокращает риск риска. 

### <a name="reduce-the-container-attack-surface-by-removing-unneeded-privileges"></a>Сократите поверхность атаки контейнера, удалив ненужные привилегии 

Вы также можете уменьшить потенциальную угрозу для атак, удалив все неиспользуемые или ненужные процессы или привилегии из среды выполнения контейнера. Привилегированные контейнеры запускаются как корневые. Если злонамеренный пользователь или рабочая нагрузка перейдет в привилегированный контейнер, контейнер будет выполняться как корневой элемент в этой системе.

### <a name="whitelist-files-and-executables-that-the-container-is-allowed-to-access-or-run"></a>Список разрешений файлы и исполняемые объекты, которым контейнеру разрешен доступ или запуск 

Сокращение числа переменных или неизвестных элементов помогает поддерживать устойчивую и надежную среду. Ограничение контейнеров для доступа или выполнения только предварительно утвержденных или список разрешений файлов, а также исполняемые файлы — проверенный метод ограничения риска.  

Гораздо проще управлять список разрешений, когда он реализован с самого начала. Список разрешений предоставляет меры по управлению и управлению, так как вы узнаете, какие файлы и исполняемые объекты необходимы для правильной работы приложения. 

Список разрешений не только сокращает уязвимую зону, но также может предоставлять базовые показатели аномалий и предотвращать случаи использования бесшумного соседа и сценариев создания контейнеров. 

### <a name="enforce-network-segmentation-on-running-containers"></a>Применять сегментацию сети в выполняющихся контейнерах  

Чтобы защитить контейнеры в одной подсети от угроз безопасности в другой подсети, настройте сегментацию сети (или сегментацию) или разделение между работающими контейнерами. Поддержка сегментации сети также может потребоваться для использования контейнеров в отраслях, которые необходимы для удовлетворения требований соответствия требованиям.  

Например, инструмент Partner [голубой](https://azuremarketplace.microsoft.com/marketplace/apps/aqua-security.aqua-security?tab=Overview) предоставляет автоматизированный подход к Nano-сегментации. Голубой монитор выполняет действия сети контейнера во время выполнения. Он определяет все входящие и исходящие сетевые подключения к другим контейнерам, службам, IP-адресам и общедоступному Интернету. На основе наблюдаемого трафика автоматически создается сегментация. 

### <a name="monitor-container-activity-and-user-access"></a>Мониторинг активности контейнера и доступа пользователей 

Как и в случае с любой ИТ – средой, следует постоянно отслеживать доступ пользователей и действий к экосистеме контейнеров, чтобы быстро выявить подозрительные или вредоносные действия. Azure предоставляет решения для мониторинга контейнеров, в том числе:

* [Azure Monitor для контейнеров](../azure-monitor/insights/container-insights-overview.md) , чтобы отслеживать производительность рабочих нагрузок, развернутых в Kubernetes средах, размещенных в службе Kubernetes Azure (AKS). С помощью Azure Monitor для контейнеров можно отслеживать производительность, собирая данные метрик памяти и процессора из контроллеров, узлов и контейнеров, доступных в Kubernetes, используя API метрик. 

* [Решение для мониторинга контейнеров Azure](../azure-monitor/insights/containers.md) помогает просматривать другие узлы контейнеров DOCKER и Windows и управлять ими в одном расположении. Пример:

  * Просмотр подробных сведений аудита, показывающих команды, используемые с контейнерами. 
  * Устранение неполадок в контейнерах путем просмотра и поиска централизованных журналов без необходимости удаленного просмотра узлов DOCKER или Windows.  
  * Поиск контейнеров, которые могут представлять помехи и потреблять избыточные ресурсы на узле.
  * Просмотр централизованных сведений об использовании ЦП, памяти, хранилища, сети и производительности для контейнеров.  

  Решение поддерживает оркестрации контейнеров, включая DOCKER Swarm, DC/OS, неуправляемые Kubernetes, Service Fabric и Red Hat OpenShift. 

### <a name="monitor-container-resource-activity"></a>Мониторинг активности ресурсов контейнера 

Отслеживайте действия с ресурсами, например файлы, сети и другие ресурсы, доступ к которым имеют контейнеры. Мониторинг активности и потребления ресурсов полезен и для мониторинга производительности, и в качестве меры безопасности. 

[Azure Monitor](../azure-monitor/overview.md) обеспечивает базовый мониторинг служб Azure, позволяя собирать метрики, журналы действий и журналы диагностики. Например, журнал действий содержит сведения о создании ресурсов или их изменении. 

Доступны метрики, которые предоставляют статистику производительности разных ресурсов, а также операционной системы в виртуальной машине. Вы можете просмотреть эти данные с помощью нескольких инструментов на портале Azure, а также создать предупреждения на базе этих метрик. Azure Monitor предоставляет самый быстрый конвейер метрик (от 5 минут до 1 минуты), поэтому его следует использовать для критических оповещений и уведомлений по времени. 

### <a name="log-all-container-administrative-user-access-for-auditing"></a>Записывать в журнал все права администратора контейнера для аудита 

Поддерживайте точный журнал аудита административного доступа к экосистеме контейнеров, реестру контейнеров и образам контейнеров. Эти журналы могут потребоваться в целях аудита и будут полезны в качестве судебных доказательств после любых инцидентов безопасности. Для достижения этой цели можно использовать [решение для мониторинга контейнеров Azure](../azure-monitor/insights/containers.md) . 

## <a name="next-steps"></a>Следующие шаги

* Узнайте больше об управлении уязвимостями контейнеров с помощью решений от [Twistlock](https://www.twistlock.com/solutions/microsoft-azure-container-security/) и [голубого уровня безопасности](https://www.aquasec.com/solutions/azure-container-security/).

* Дополнительные сведения о [безопасности контейнеров в Azure](https://azure.microsoft.com/resources/container-security-in-microsoft-azure/).