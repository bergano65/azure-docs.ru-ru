---
title: Обновление с базового общедоступного до уровня Standard Public-Azure Load Balancer
description: В этой статье показано, как обновить общедоступный Load Balancer Azure с SKU "базовый" на "Стандартный"
services: load-balancer
author: irenehua
ms.service: load-balancer
ms.topic: how-to
ms.date: 01/23/2020
ms.author: irenehua
ms.openlocfilehash: f97facd8d184be05cbfd79af92dbcaab3a022ebd
ms.sourcegitcommit: ad83be10e9e910fd4853965661c5edc7bb7b1f7c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/06/2020
ms.locfileid: "96746307"
---
# <a name="upgrade-azure-public-load-balancer"></a>Обновление общедоступных Load Balancer Azure
[Azure Load Balancer (цен. Категория "Стандартный")](load-balancer-overview.md) предлагает широкий набор функций и высокий уровень доступности через избыточность зоны. Дополнительные сведения о Load Balancer SKU см. в разделе [Таблица сравнения](./skus.md#skus).

Обновление выполняется в два этапа.

1. Измените метод выделения IP-адресов с динамического на статический.
2. Запустите сценарий PowerShell, чтобы завершить обновление и перенос трафика.

## <a name="upgrade-overview"></a>Общие сведения об обновлении

Доступен сценарий Azure PowerShell, который выполняет следующие действия:

* Создает Load Balancer SKU "Стандартный" в группе ресурсов и расположении, которое вы указали.
* Обновляет общедоступный IP-адрес с SKU "базовый" на "Стандартный" на месте.
* Без проблем копирует конфигурации базового номера SKU Load Balancer на новую Load Balancer (цен. категория "Стандартный") создания.
* Создает правило исходящего трафика по умолчанию, которое разрешает исходящие подключения.

### <a name="caveatslimitations"></a>кавеатс\лимитатионс

* Скрипт поддерживает только общедоступные Load Balancer обновления. Инструкции по внутреннему обновлению базового Load Balancer см. на [этой странице](./upgrade-basicinternal-standard.md) .
* Перед выполнением скрипта необходимо изменить метод выделения общедоступного IP-адреса на "static". 
* Если у Load Balancer нет внешней IP-конфигурации или серверного пула, то, скорее всего, будет обнаружена ошибка, которая вызвала бы выполнение скрипта. Убедитесь, что они не пусты.

### <a name="change-allocation-method-of-the-public-ip-address-to-static"></a>Изменить метод выделения общедоступного IP-адреса на статический

* * * Вот наши рекомендуемые действия:

    1. Для выполнения задач в этом кратком руководстве войдите на [портал Azure](https://portal.azure.com).
 
    1. Выберите **все ресурсы** в меню слева, а затем выберите **базовый общедоступный IP-адрес, связанный с базовыми Load Balancer** из списка ресурсов.
   
    1. В разделе **Параметры** выберите **конфигурации**.
   
    1. В поле **Назначение** выберите **Статический**.
    1. Нажмите **Сохранить**.
    >[!NOTE]
    >Для виртуальных машин, имеющих общедоступные IP-адреса, необходимо сначала создать стандартные, но не гарантируют, что IP-адрес не гарантируется. Отменяйте связь между виртуальными машинами и свяжите их с новыми стандартными IP-адресами. Затем вы сможете выполнить инструкции по добавлению виртуальных машин в серверный пул Load Balancer (цен. категория "Стандартный"). 

* **Создание новых виртуальных машин для добавления в серверные пулы вновь созданного стандартного Общедоступного Load Balancer**.
    * Дополнительные инструкции о том, как создать виртуальную машину и связать ее с Load Balancer (цен. категория "Стандартный"), можно найти [здесь](./quickstart-load-balancer-standard-public-portal.md#create-virtual-machines).


## <a name="download-the-script"></a>Скачивание скрипта

Скачайте скрипт миграции из  [коллекция PowerShell](https://www.powershellgallery.com/packages/AzurePublicLBUpgrade/2.0).
## <a name="use-the-script"></a>Использование скрипта

В зависимости от настроек и настроек локальной среды PowerShell существует два варианта.

* Если вы не установили модули Azure az или не хотите удалять модули Azure AZ, лучшим вариантом будет использование `Install-Script` параметра для запуска сценария.
* Если вам нужно разместить модули Azure AZ, лучше скачать сценарий и запустить его напрямую.

Чтобы определить, установлены ли модули Azure AZ, запустите `Get-InstalledModule -Name az` . Если вы не видите ни одного установленного модуля AZ, то можете использовать `Install-Script` метод.

### <a name="install-using-the-install-script-method"></a>Установка с помощью метода Install-Script

Чтобы использовать этот параметр, на компьютере не должны быть установлены модули Azure AZ. Если они установлены, следующая команда выводит сообщение об ошибке. Можно либо удалить модули Azure AZ, либо воспользоваться другим параметром, чтобы скачать скрипт вручную и запустить его.
  
Выполните скрипт с помощью следующей команды:

`Install-Script -Name AzurePublicLBUpgrade`

Эта команда также устанавливает необходимые модули AZ.  

### <a name="install-using-the-script-directly"></a>Установка непосредственно с помощью скрипта

Если у вас установлены некоторые модули Azure AZ и их невозможно удалить (или не хотите удалять их), можно вручную скачать скрипт, используя вкладку **Загрузка вручную** в ссылке Загрузить скрипт. Скрипт загружается как необработанный файл nupkg. Сведения об установке скрипта из этого файла nupkg см. в разделе [Загрузка пакета вручную](/powershell/scripting/gallery/how-to/working-with-packages/manual-download).

Выполните следующее, чтобы запустить этот сценарий.

1. Используйте `Connect-AzAccount` для подключения к Azure.

1. Используйте `Import-Module Az` для импорта модулей AZ.

1. Проверьте обязательные параметры:

   * **олдргнаме: [строка]: обязательно** — это группа ресурсов для существующих базовых Load Balancer, которые требуется обновить. Чтобы найти это строковое значение, перейдите к портал Azure, выберите основной источник Load Balancer и щелкните **Обзор** подсистемы балансировки нагрузки. Группа ресурсов находится на этой странице.
   * **олдлбнаме: [строка]: обязательно** — это имя существующего балансировщика базовой подсистемы, которую требуется обновить. 
   * **невргнаме: [строка]: обязательно** — это группа ресурсов, в которой будет создана Load Balancer (цен. Категория "Стандартный"). Это может быть новая группа ресурсов или существующая. При выборе существующей группы ресурсов Обратите внимание, что имя Load Balancer должно быть уникальным в пределах группы ресурсов. 
   * **невлбнаме: [строка]: required** — это имя создаваемого Load Balancer (цен. Категория "Стандартный").
1. Запустите скрипт, используя соответствующие параметры. Для завершения может потребоваться от 5 до семи минут.

    **Пример**

   ```azurepowershell
   AzurePublicLBUpgrade.ps1 -oldRgName "test_publicUpgrade_rg" -oldLBName "LBForPublic" -newrgName "test_userInput3_rg" -newLbName "LBForUpgrade"
   ```

### <a name="create-an-outbound-rule-for-outbound-connection"></a>Создание правила исходящего трафика для исходящего подключения

Следуйте [инструкциям](./quickstart-load-balancer-standard-public-powershell.md#create-outbound-rule-configuration) , чтобы создать правило исходящего трафика, чтобы можно было
* Определение исходящего NAT с нуля.
* Масштабирование и Настройка поведения существующего исходящего NAT.

## <a name="common-questions"></a>Часто задаваемые вопросы

### <a name="are-there-any-limitations-with-the-azure-powershell-script-to-migrate-the-configuration-from-v1-to-v2"></a>Существуют ли какие либо ограничения в сценарии Azure PowerShell для переноса конфигурации с версии v1 на версию 2?

Да. См. раздел [предостережения/ограничения](#caveatslimitations).

### <a name="how-long-does-the-upgrade-take"></a>Сколько времени займет обновление?

Для завершения сценария обычно требуется около 5-10 минут, и это может занять больше времени в зависимости от сложности конфигурации Load Balancer. Поэтому следует учитывать время простоя и планировать отработку отказа при необходимости.

### <a name="does-the-azure-powershell-script-also-switch-over-the-traffic-from-my-basic-load-balancer-to-the-newly-created-standard-load-balancer"></a>Также будет ли сценарий Azure PowerShell переключать трафик с базового Load Balancer на только что созданный Load Balancer (цен. категория "Стандартный")?

Да. Сценарий Azure PowerShell не только обновляет общедоступный IP-адрес, копирует конфигурацию с базового на Load Balancer (цен. категория "Стандартный"), а также переносит виртуальную машину на вновь созданную стандартную общедоступную Load Balancer. 

### <a name="i-ran-into-some-issues-with-using-this-script-how-can-i-get-help"></a>При использовании этого сценария возникли проблемы. Как получить помощь?
  
Вы можете отправить сообщение электронной почты slbupgradesupport@microsoft.com , открыть обращение в службу поддержки Azure или выполнить оба действия.

## <a name="next-steps"></a>Дальнейшие действия

[Дополнительные сведения о Load Balancer (цен. категория "Стандартный")](load-balancer-overview.md)
