---
title: Устранение неполадок состояния проверки работоспособности Azure Load Balancer
description: Узнайте, как устранять известные проблемы с состоянием проверки работоспособности Azure Load Balancer.
services: load-balancer
documentationcenter: na
author: asudbring
manager: dcscontentpm
ms.custom: seodoc18
ms.service: load-balancer
ms.devlang: na
ms.topic: troubleshooting
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/02/2020
ms.author: allensu
ms.openlocfilehash: 28823c997cd974d5061829df88680ed52075caa0
ms.sourcegitcommit: e46f9981626751f129926a2dae327a729228216e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98029230"
---
# <a name="troubleshoot-azure-load-balancer-health-probe-status"></a>Устранение неполадок состояния проверки работоспособности Azure Load Balancer

На этой странице приведены общие сведения об устранении неполадок Azure Load Balancer.

## <a name="symptom-vms-behind-the-load-balancer-are-not-responding-to-health-probes"></a>Симптом. Виртуальные машины, находящиеся за подсистемой балансировки нагрузки, не отвечают на пробы работоспособности.
Чтобы внутренние серверы могли входить в набор подсистемы балансировки нагрузки, они должны пройти проверку работоспособности. Дополнительные сведения о пробах работоспособности см. в статье [Проверки балансировщика нагрузки](load-balancer-custom-probe-overview.md). 

Виртуальные машины внутреннего пула подсистемы балансировки нагрузки могут не отвечать на пробы по одной из следующих причин: 
- Виртуальная машина внутреннего пула подсистемы балансировки нагрузки неработоспособна. 
- Виртуальная машина внутреннего пула подсистемы балансировки нагрузки не ожидает передачи данных через порт пробы. 
- Брандмауэр или группа безопасности сети блокирует порт на виртуальных машинах внутреннего пула подсистемы балансировки нагрузки. 
- Другие неправильные настройки в подсистеме балансировки нагрузки.

### <a name="cause-1-load-balancer-backend-pool-vm-is-unhealthy"></a>Причина 1. Виртуальная машина внутреннего пула подсистемы балансировки нагрузки неработоспособна.

**Проверка и способы устранения**

Чтобы устранить эту проблему, войдите в виртуальную машину, входящую в пул, и проверьте, находится ли она в работоспособном состоянии и может ли отвечать на запросы **PsPing** или **TCPing** от другой виртуальной машины в пуле. Если виртуальная машина неработоспособна или не отвечает на пробу, то необходимо устранить эту проблему и вернуть виртуальную машину в работоспособное состояние, прежде чем она сможет участвовать в балансировке нагрузки.

### <a name="cause-2-load-balancer-backend-pool-vm-is-not-listening-on-the-probe-port"></a>Причина 2. Виртуальная машина внутреннего пула подсистемы балансировки нагрузки не ожидает передачи данных через порт пробы.
Если виртуальная машина работоспособна, но не отвечает на пробу, то одной из возможных причин может быть то, что порт пробы не открыт на виртуальной машине, входящей в пул, или виртуальная машина не ожидает передачи данных через этот порт.

**Проверка и способы устранения**

1. Войдите в виртуальную машину внутреннего пула.
2. Откройте командную строку и выполните следующую команду, чтобы проверить, что приложение ожидает передачи данных через порт пробы: netstat-a
3. Если для состояния порта не указано значение **Ожидает вызова**, то настройте соответствующий порт. 
4. Можно также выбрать другой порт, который находится в состоянии **Ожидает вызова**, и соответствующим образом обновить конфигурацию подсистемы балансировки нагрузки.

### <a name="cause-3-firewall-or-a-network-security-group-is-blocking-the-port-on-the-load-balancer-backend-pool-vms"></a>Причина 3. Брандмауэр или группа безопасности сети блокирует порт на виртуальных машинах внутреннего пула подсистемы балансировки нагрузки.
Если брандмауэр на виртуальной машине блокирует порт пробы, либо одна или несколько групп безопасности сети, настроенных в подсети или на виртуальной машине, не позволяют пробе достигнуть порта, то виртуальная машина не может ответить на пробу работоспособности.

**Проверка и способы устранения**

1. Если брандмауэр включен, то проверьте, разрешен ли в его настройках порт пробы. В противном случае настройте брандмауэр таким образом, чтобы он разрешал трафик через порт пробы, и повторите проверку.
2. В списке групп безопасности сети проверьте входящий и исходящий трафик через порт пробы на наличие помех.
3. Проверьте также наличие правила групп безопасности сети **Запретить все** в сетевой карте виртуальной машины или подсети, которое имеет более высокий приоритет, чем правило по умолчанию, позволяющее выполнение проб и трафик подсистемы балансировки нагрузки (в группах безопасности сети необходимо разрешить IP-адрес подсистемы балансировки нагрузки 168.63.129.16).
4. Если любое из этих правил блокирует трафик проб, то удалите и перенастройте правила, чтобы они разрешали такой трафик.  
5. Проверьте, начала ли виртуальная машина отвечать на пробы работоспособности.

### <a name="cause-4-other-misconfigurations-in-load-balancer"></a>Причина 4. Другие неправильные настройки в подсистеме балансировки нагрузки.
Если все выше перечисленные причины уже проверены, а способы устранения проблем опробованы, но виртуальная машины внутреннего пула по-прежнему не отвечает на пробу работоспособности, то необходимо вручную проверить подключение и собрать данные трассировок, чтобы понять ситуацию с подключением.

**Проверка и способы устранения**

1. Воспользуйтесь командой **Psping** с любой другой виртуальной машины в виртуальной сети, чтобы проверить ответ порта пробы (пример: \psping.exe -t 10.0.0.4:3389), и запишите результаты. 
2. Воспользуйтесь командой **TCPing** с любой другой виртуальной машины в виртуальной сети, чтобы проверить ответ порта пробы (пример: \tcping.exe 10.0.0.4 3389), и запишите результаты. 
3. Если в результате этих проверок связи ответ не получен, то выполните следующие действия:
    - Выполните команду netsh trace одновременно на целевой виртуальной машине внутреннего пула и на другой тестовой виртуальной машине из той же виртуальной сети. Теперь запустите на некоторое время проверку PsPing, соберите данные трассировки сети, а затем остановите проверку. 
    - Проанализируйте запись сетевых данных и проверьте наличие входящих и исходящих пакетов, связанных с запросом проверки связи. 
        - Если на виртуальной машине внутреннего пула не обнаруживаются входящие пакеты, то, возможно, были неправильно настроены группы безопасности сети или определяемые пользователем маршруты, из-за чего блокируется трафик. 
        - Если на виртуальной машине внутреннего пула не обнаруживаются исходящие пакеты, то эту виртуальную машину необходимо проверить на наличие любых несвязанных проблем (например, порт пробы блокируется приложением). 
    - Проверьте, не передаются ли пакеты пробы принудительно в другое назначение (возможно, с помощью параметров определяемых пользователем маршрутов), прежде чем они достигают подсистемы балансировки нагрузки. Из-за этого трафик может не достигать виртуальной машины внутреннего пула. 
4. Измените тип пробы (например, с HTTP на TCP) и настройте соответствующий порт в списках ACL групп безопасности сети и брандмауэре, чтобы выполнялась проверка наличия проблем с настройкой ответа пробы. Дополнительные сведения о настройке проб работоспособности см. в записи блога [Endpoint Load Balancing Heath Probe Configuration Details](/archive/blogs/mast/endpoint-load-balancing-heath-probe-configuration-details) (Сведения о настройке проб работоспособности балансировки нагрузки для конечных точек).

## <a name="next-steps"></a>Дальнейшие действия

Если описанные выше шаги не устранят проблему, отправьте [запрос в службу поддержки](https://azure.microsoft.com/support/options/).