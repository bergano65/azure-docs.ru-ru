---
title: Краткое руководство. Создание общедоступной подсистемы балансировки нагрузки — портал Azure
titleSuffix: Azure Load Balancer
description: В этом кратком руководстве показано, как создать подсистему балансировки нагрузки с помощью портала Azure.
services: load-balancer
documentationcenter: na
author: asudbring
manager: KumudD
Customer intent: I want to create a load balancer so that I can load balance internet traffic to VMs.
ms.service: load-balancer
ms.devlang: na
ms.topic: quickstart
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/22/2020
ms.author: allensu
ms.custom: mvc
ms.openlocfilehash: f7d9389eb0a0118f2c1be8375531f58b6bed94b6
ms.sourcegitcommit: 3bcce2e26935f523226ea269f034e0d75aa6693a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2020
ms.locfileid: "92488101"
---
# <a name="quickstart-create-a-public-load-balancer-to-load-balance-vms-using-the-azure-portal"></a>Краткое руководство. Создание общедоступной подсистемы балансировки нагрузки с помощью портала Azure для распределения нагрузки между виртуальными машинами

Начните работу с Azure Load Balancer, создав с помощью портала Azure общедоступную подсистему балансировки нагрузки и три виртуальные машины.

## <a name="prerequisites"></a>Предварительные требования

- Учетная запись Azure с активной подпиской. [Создайте учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) бесплатно.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com).

---

# <a name="standard-sku"></a>[**SKU "Стандартный"**](#tab/option-1-create-load-balancer-standard)

>[!NOTE]
>Для производственных рабочих нагрузок рекомендуется использовать подсистему балансировки нагрузки ценовой категории "Стандартный".  Дополнительные сведения о доступных ценовых категориях см. в статье **[Номера SKU для Azure Load Balancer](skus.md)** .

В этом разделе показано, как создать подсистему балансировки нагрузки, которая распределяет нагрузку между виртуальными машинами. 

Вместе с общедоступной подсистемой балансировки нагрузки необходимо создать новый общедоступный IP-адрес и настроить его в качестве внешнего интерфейсного адреса (с именем **LoadBalancerFrontend** по умолчанию) для этой подсистемы балансировки нагрузки.

1. Вверху слева выберите последовательно **Создать ресурс** > **Сети** > **Load Balancer**.

2. На странице **Создание подсистемы балансировки нагрузки** на вкладке **Основные сведения** укажите следующее. 

    | Параметр                 | Значение                                              |
    | ---                     | ---                                                |
    | Подписка               | Выберите свою подписку.    |    
    | Группа ресурсов         | Выберите **Создать** и введите **CreatePubLBQS-rg** в текстовом поле.|
    | Имя                   | Введите **myLoadBalancer**.                                   |
    | Регион         | Выберите **Западная Европа**.                                        |
    | Тип          | Щелкните **Общедоступный**.                                        |
    | номер SKU           | Выберите **Стандартный** |
    | Общедоступный IP-адрес | Выберите **Создать**. Если вы хотите использовать существующий общедоступный IP-адрес, выберите **Использовать существующий**. |
    | Имя общедоступного IP-адреса | Введите **myPublicIP** в текстовом поле.|
    | Зона доступности | Введите **Избыточная между зонами** , чтобы создать устойчивую подсистему балансировки нагрузки. Чтобы создать подсистему балансировки нагрузки в определенной зоне, выберите нужную зону (1, 2 или 3). |
    | Добавление общедоступного IPv6-адреса | Выберите вариант **Нет**. </br> Дополнительные сведения об IPv6-адресах и подсистеме балансировки нагрузки см. в статье [Что такое IPv6 для виртуальной сети Azure?](https://docs.microsoft.com/azure/virtual-network/ipv6-overview)  |

3. Оставьте значения по умолчанию для остальных параметров и нажмите кнопку **Просмотр и создание**.

4. На вкладке **Отзыв и создание** выберите **Создать**.   
    
    :::image type="content" source="./media/quickstart-load-balancer-standard-public-portal/create-standard-load-balancer.png" alt-text="Создание подсистемы балансировки нагрузки уровня Стандартный" border="true":::
 
## <a name="create-load-balancer-resources"></a>Создание ресурсов подсистемы балансировки нагрузки

В этом разделе показано, как настроить следующее:

* параметры подсистемы балансировки нагрузки для пула адресов внутренней части;
* пробу работоспособности;
* Правило подсистемы балансировки нагрузки:

### <a name="create-a-backend-pool"></a>Создание внутреннего пула.

Внутренний пул адресов содержит IP-адреса виртуальных сетевых карт, подключенных к подсистеме балансировки нагрузки. 

Создайте внутренний пул адресов **myBackendPool** , чтобы включить виртуальные машины для балансировки нагрузки интернет-трафика.

1. В меню слева щелкните **Все службы** , выберите **Все ресурсы** , а затем из списка ресурсов выберите **myLoadBalancer**.

2. В разделе **Параметры** выберите **Серверные пулы** , затем щелкните **Добавить**.

3. На странице **Добавление серверного пула** введите имя **myBackEndPool** для серверного пула и выберите **Добавить**.

### <a name="create-a-health-probe"></a>Создание пробы работоспособности

Подсистема балансировки нагрузки отслеживает состояние приложения, выполняя пробу работоспособности. 

Проба работоспособности добавляет виртуальные машины в балансировщик нагрузки или удаляет их оттуда на основе их ответа на проверки работоспособности. 

Создайте зонд работоспособности с именем **myHealthProbe** , чтобы отслеживать работоспособность виртуальных машин.

1. В меню слева щелкните **Все службы** , выберите **Все ресурсы** , а затем из списка ресурсов выберите **myLoadBalancer**.

2. В разделе **Параметры** выберите **Пробы работоспособности** , а затем щелкните **Добавить**.
    
    | Параметр | Значение |
    | ------- | ----- |
    | Имя | Введите **myHealthProbe**. |
    | Протокол | Выберите **HTTP**. |
    | Порт | Введите **80**.|
    | Интервал | В качестве **интервала** между попытками выполнения пробы (в секундах) введите **15**. |
    | Пороговое значение сбоя | Выберите **2** в качестве значения **порога состояния неработоспособности** или количества последовательных сбоев пробы, после которых виртуальная машина будет считаться неработоспособной.|
    | | |

3. Сохраните остальные значения по умолчанию и нажмите кнопку **OK**.

### <a name="create-a-load-balancer-rule"></a>Создание правила балансировщика нагрузки

Правило балансировщика нагрузки позволяет определить распределение трафика между виртуальными машинами. Вы определяете конфигурацию внешнего IP-адреса для входящего трафика и пул внутренних IP-адресов для приема трафика. В этом правиле определяются исходный и конечный порты. 

В этом разделе показано, как создать правило подсистемы балансировки нагрузки, которая имеет следующие характеристики:

* имеет имя **myHTTPRule** ;
* находится в интерфейсной части с именем **LoadBalancerFrontEnd** ;
* ожидает передачи данных на **порт 80** ;
* отправляет трафик балансировки нагрузки на внутреннюю часть с именем **myBackendPool** через **порт 80**.

1. В меню слева щелкните **Все службы** , выберите **Все ресурсы** , а затем из списка ресурсов выберите **myLoadBalancer**.

2. В разделе **Параметры** выберите **Правила балансировки нагрузки** , а затем щелкните **Добавить**.

3. Для настройки правила балансировки нагрузки используйте следующие значения.
    
    | Параметр | Значение |
    | ------- | ----- |
    | Имя | Введите **myHTTPRule**. |
    | Версия IP-адреса | Выберите **IPv4**. |
    | Интерфейсный IP-адрес | Выберите **LoadBalancerFrontEnd**. |
    | Протокол | Выберите **TCP**. |
    | Порт | Введите **80**.|
    | Серверный порт | Введите **80**. |
    | Серверный пул | Выберите **myBackendPool**.|
    | Проверка работоспособности | Выберите **myHealthProbe**. |
    | Время ожидания простоя (в минутах) | Переместите ползунок на **15 минут**. |
    | Сброс TCP | Щелкните **Включено**. |
    | Преобразование исходных сетевых адресов (SNAT) для исходящего трафика | Выберите **(Рекомендуется) Использовать правила для исходящего трафика, чтобы предоставить участникам внутреннего пула доступ к Интернету**. |

4. Сохраните остальные значения по умолчанию и нажмите кнопку **ОК**.

## <a name="create-backend-servers"></a>Создание внутренних серверов

В этом разделе выполняются следующие действия:

* Создайте виртуальную сеть.
* Создайте три виртуальные машины для внутреннего пула подсистемы балансировки нагрузки.
* Установите службы IIS на этих виртуальных машинах, чтобы протестировать подсистему балансировки нагрузки.

## <a name="create-the-virtual-network"></a>Создание виртуальной сети

С помощью этого раздела вы создадите виртуальную сеть и подсеть.

1. Слева вверху экрана щелкните **Создать ресурс > Сеть > Виртуальная сеть** или выполните поиск по фразе **виртуальная сеть**.

2. В подменю **Создать виртуальную сеть** введите или выберите следующую информацию на вкладке **Основные сведения** :

    | **Параметр**          | **Значение**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **Сведения о проекте**  |                                                                 |
    | Подписка     | Выбор подписки Azure                                  |
    | Группа ресурсов   | Выберите **CreatePubLBQS-rg**. |
    | **Сведения об экземпляре** |                                                                 |
    | Имя             | Введите **myVNet**.                                    |
    | Регион           | Выберите **Западная Европа**. |

3. Откройте вкладку **IP-адрес** или нажмите кнопку **Далее: IP-адреса** внизу страницы.

4. На вкладке **IP-адреса** укажите следующие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Диапазон IPv4-адресов | Введите **10.1.0.0/16**. |

5. В разделе **Имя подсети** выберите **по умолчанию**.

6. В окне **Изменение подсети** введите следующие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Имя подсети | Введите **myBackendSubnet**. |
    | Диапазон адресов подсети | Введите **10.1.0.0/24**. |

7. Щелкните **Сохранить**.

8. Перейдите на вкладку **Безопасность**.

9. В разделе **BastionHost** выберите **Включить**. Введите такие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Имя бастиона | Введите **myBastionHost**. |
    | Адресное пространство AzureBastionSubnet | Введите **10.1.1.0/24**. |
    | Общедоступный IP-адрес | Выберите **Создать**. </br> В поле **Имя** введите **myBastionIP**. </br> Щелкните **ОК**. |


8. Перейдите на вкладку **Просмотр и создание** или нажмите кнопку **Просмотр и создание**.

9. Нажмите кнопку **создания**.

### <a name="create-virtual-machines"></a>Создание виртуальных машин

В этом разделе показано, как создать три виртуальные машины ( **myVM1** , **myVM2** и **myVM3** ) в трех разных зонах ( **зона 1** , **зона 2** и **зона 3** ). 

Эти виртуальные машины добавляются во внутренний пул подсистемы балансировки нагрузки, которую вы создали ранее.

1. В верхнем левом углу страницы портала выберите **Создать ресурс** > **Вычисления** > **Виртуальная машина**. 
   
2. В разделе **Создание виртуальной машины** на вкладке **Основные сведения** укажите следующее.

    | Параметр | Значение                                          |
    |-----------------------|----------------------------------|
    | **Сведения о проекте** |  |
    | Подписка | Выбор подписки Azure |
    | Группа ресурсов | Выберите **CreatePubLBQS-rg**. |
    | **Сведения об экземпляре** |  |
    | Имя виртуальной машины | Введите **myVM1**. |
    | Регион | Выберите **Западная Европа**. |
    | Параметры доступности | Выберите **Зоны доступности**. |
    | Зона доступности | Выберите **1**. |
    | Образ — | Выберите **Windows Server 2019 Datacenter**. |
    | Точечный экземпляр Azure | Выберите **Нет**. |
    | Размер | Выберите размер виртуальной машины или подтвердите значение по умолчанию. |
    | **Учетная запись администратора** |  |
    | Имя пользователя | Введите имя пользователя. |
    | Пароль | Введите пароль. |
    | Подтверждение пароля | Введите пароль еще раз. |
    | **Правила входящего порта** |  |
    | Общедоступные входящие порты | Выберите **Нет**. |

3. Выберите вкладку **Сеть** или **Далее: диски** , затем **Далее: сеть**.
  
4. На вкладке "Сеть" укажите следующее.

    | Параметр | Значение |
    |-|-|
    | **Сетевой интерфейс** |  |
    | Виртуальная сеть | **myVNet** |
    | Подсеть | **myBackendSubnet** |
    | Общедоступный IP-адрес | Выберите **Отсутствует**. |
    | Сетевая группа безопасности сетевого адаптера | Нажмите кнопку **Дополнительно**.|
    | Настройка группы безопасности сети | Выберите **Создать**. </br> В разделе **Создание группы безопасности сети** введите строку **myNSG** в поле **Имя**. </br> В разделе **Правила для входящего трафика** выберите **+ Добавить правило для входящих подключений**. </br> В поле **Диапазоны портов назначения** введите значение **80**. </br> В поле **Приоритет** введите значение **100**. </br> В поле **Имя** введите **myHTTPRule**. </br> Выберите **Добавить**. </br> Нажмите кнопку **ОК**. |
    | **Балансировка нагрузки**  |
    | Настроить эту виртуальную машину для работы с существующим решением по балансировке нагрузки? | Выберите **Да**. |
    | **Параметры балансировки нагрузки** |
    | Параметры балансировки нагрузки | Выберите **Балансировка нагрузки Azure**. |
    | Выберите подсистему балансировки нагрузки | Выберите **myLoadBalancer**.  |
    | Выберите серверный пул | Выберите **MyBackendPool**. |

5. Выберите вкладку **Управление** или **Далее** > **Управление**.

6. На вкладке **Управление** укажите следующее.
    
    | Параметр | Значение |
    |-|-|
    | **Мониторинг** |  |
    | Диагностика загрузки | Выберите **Выкл.** |
   
7. Выберите **Review + create** (Просмотреть и создать). 
  
8. Проверьте параметры, а затем нажмите кнопку **Создать**.

9. Выполните шаги 1–8, чтобы создать еще две виртуальные машины со следующими значениями (все остальные параметры совпадают с параметрами виртуальной машины **myVM1** ).

    | Параметр | Виртуальная машина 2| Виртуальная машина 3|
    | ------- | ----- |---|
    | Имя |  **myVM2** |**myVM3**|
    | Зона доступности | **2** |**3**|
    | Группа безопасности сети | Выберите существующий вариант **myNSG**.| Выберите существующий вариант **myNSG**.|

## <a name="create-outbound-rule-configuration"></a>Создание конфигурации правила для исходящего трафика
Правила для исходящего трафика подсистемы балансировки нагрузки настраивают исходящий SNAT для виртуальных машин во внутреннем пуле. 

Дополнительные сведения об исходящих подключениях см. в статье [Исходящие подключения в Azure](load-balancer-outbound-connections.md).

### <a name="create-outbound-rule"></a>Создание правила для исходящего трафика

1. В меню слева щелкните **Все службы** , выберите **Все ресурсы** , а затем из списка ресурсов выберите **myLoadBalancer**.

2. В разделе **Параметры** выберите **Правила для исходящего трафика** , а затем — **Добавить**.

3. Для настройки правила для исходящего трафика используйте следующие значения:

    | Параметр | Значение |
    | ------- | ----- |
    | Название | Введите **myOutboundRule**. |
    | Интерфейсный IP-адрес | Выберите **Создать**. </br> В разделе **Имя** введите **LoadBalancerFrontEndOutbound**. </br> Выберите **IP-адрес** или **IP-префикс**. </br> Выберите **Создать** в разделе **Общедоступный IP-адрес** или **Общедоступный IP-префикс**. </br> В качестве имени введите **myPublicIPOutbound** или **myPublicIPPrefixOutbound**. </br> Выберите **Добавить**.|
    | Время ожидания простоя (в минутах) | Переместите ползунок на **15 минут**.|
    | Сброс TCP | Щелкните **Включено**.|
    | Серверный пул | Выберите **Создать**. </br> Введите **myBackendPoolOutbound** в разделе **Имя**. </br> Выберите **Добавить**. |
    | "Выделение портов" -> "Выделение портов" | Выберите **Выбрать число исходящих портов вручную** |
    | "Исходящие порты" -> "Выбор по" | Выберите **Число портов для каждого экземпляра** |
    | "Исходящие порты"-> "Число портов для каждого экземпляра" | Введите **10000**. |

4. Выберите **Добавить**.

### <a name="add-virtual-machines-to-outbound-pool"></a>Добавление виртуальных машин в исходящий пул

1. В меню слева щелкните **Все службы** , выберите **Все ресурсы** , а затем из списка ресурсов выберите **myLoadBalancer**.

2. В разделе **Параметры** выберите **Внутренние пулы**.

3. Выберите **myBackendPoolOutbound**.

4. В разделе **Виртуальная сеть** выберите **myVNet**.

5. В разделе **Виртуальные машины** выберите **+ Добавить**.

6. Установите флажки рядом с **myVM1** , **myVM2** и **myVM3**. 

7. Выберите **Добавить**.

8. Щелкните **Сохранить**.

# <a name="basic-sku"></a>[**SKU "Базовый"**](#tab/option-1-create-load-balancer-basic)

>[!NOTE]
>Для производственных рабочих нагрузок рекомендуется использовать подсистему балансировки нагрузки ценовой категории "Стандартный".  Дополнительные сведения о доступных ценовых категориях см. в статье **[Номера SKU для Azure Load Balancer](skus.md)** .

В этом разделе показано, как создать подсистему балансировки нагрузки, которая распределяет нагрузку между виртуальными машинами. 

Вместе с общедоступной подсистемой балансировки нагрузки необходимо создать новый общедоступный IP-адрес и настроить его в качестве внешнего интерфейсного адреса (с именем **LoadBalancerFrontend** по умолчанию) для этой подсистемы балансировки нагрузки.

1. Вверху слева выберите последовательно **Создать ресурс** > **Сети** > **Load Balancer**.

2. На странице **Создание подсистемы балансировки нагрузки** на вкладке **Основные сведения** укажите следующее. 

    | Параметр                 | Значение                                              |
    | ---                     | ---                                                |
    | Подписка               | Выберите свою подписку.    |    
    | Группа ресурсов         | Выберите **Создать** и введите **CreatePubLBQS-rg** в текстовом поле.|
    | Имя                   | Введите **myLoadBalancer**.                                   |
    | Регион         | Выберите **Западная Европа**.                                        |
    | Тип          | Щелкните **Общедоступный**.                                        |
    | номер SKU           | Выберите **Базовый**. |
    | Общедоступный IP-адрес | Выберите **Создать**. Если вы хотите использовать существующий общедоступный IP-адрес, выберите **Использовать существующий**. |
    | Имя общедоступного IP-адреса | Введите **myPublicIP** в текстовом поле.|
    | Назначение | Выберите **Динамический**. |
    | Добавление общедоступного IPv6-адреса | Выберите вариант **Нет**. </br> Дополнительные сведения об IPv6-адресах и подсистеме балансировки нагрузки см. в статье [Что такое IPv6 для виртуальной сети Azure?](https://docs.microsoft.com/azure/virtual-network/ipv6-overview)  |

3. Оставьте значения по умолчанию для остальных параметров и нажмите кнопку **Просмотр и создание**.

4. На вкладке **Отзыв и создание** выберите **Создать**.   

    :::image type="content" source="./media/quickstart-load-balancer-standard-public-portal/create-basic-load-balancer.png" alt-text="Создание подсистемы балансировки нагрузки уровня Базовый" border="true":::

## <a name="create-load-balancer-resources"></a>Создание ресурсов подсистемы балансировки нагрузки

В этом разделе показано, как настроить следующее:

* Создайте виртуальную сеть.
* параметры подсистемы балансировки нагрузки для пула адресов внутренней части;
* пробу работоспособности;
* Правило подсистемы балансировки нагрузки:

## <a name="create-the-virtual-network"></a>Создание виртуальной сети

С помощью этого раздела вы создадите виртуальную сеть и подсеть.

1. Слева вверху экрана щелкните **Создать ресурс > Сеть > Виртуальная сеть** или выполните поиск по фразе **виртуальная сеть**.

2. В подменю **Создать виртуальную сеть** введите или выберите следующую информацию на вкладке **Основные сведения** :

    | **Параметр**          | **Значение**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **Сведения о проекте**  |                                                                 |
    | Подписка     | Выбор подписки Azure                                  |
    | Группа ресурсов   | Выберите **CreatePubLBQS-rg**. |
    | **Сведения об экземпляре** |                                                                 |
    | Имя             | Введите **myVNet**.                                    |
    | Регион           | Выберите **Западная Европа**. |

3. Откройте вкладку **IP-адрес** или нажмите кнопку **Далее: IP-адреса** внизу страницы.

4. На вкладке **IP-адреса** укажите следующие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Диапазон IPv4-адресов | Введите **10.1.0.0/16**. |

5. В разделе **Имя подсети** выберите **по умолчанию**.

6. В окне **Изменение подсети** введите следующие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Имя подсети | Введите **myBackendSubnet**. |
    | Диапазон адресов подсети | Введите **10.1.0.0/24**. |

7. Щелкните **Сохранить**.

8. Перейдите на вкладку **Безопасность**.

9. В разделе **BastionHost** выберите **Включить**. Введите такие сведения:

    | Параметр            | Значение                      |
    |--------------------|----------------------------|
    | Имя бастиона | Введите **myBastionHost**. |
    | Адресное пространство AzureBastionSubnet | Введите **10.1.1.0/24**. |
    | Общедоступный IP-адрес | Выберите **Создать**. </br> В поле **Имя** введите **myBastionIP**. </br> Щелкните **ОК**. |


8. Перейдите на вкладку **Просмотр и создание** или нажмите кнопку **Просмотр и создание**.

9. Нажмите кнопку **создания**.
### <a name="create-a-backend-pool"></a>Создание внутреннего пула.

Внутренний пул адресов содержит IP-адреса виртуальных сетевых карт, подключенных к подсистеме балансировки нагрузки. 

Создайте внутренний пул адресов **myBackendPool** , чтобы включить виртуальные машины для балансировки нагрузки интернет-трафика.

1. В меню слева щелкните **Все службы** , выберите **Все ресурсы** , а затем из списка ресурсов выберите **myLoadBalancer**.

2. В разделе **Параметры** выберите **Серверные пулы** , затем щелкните **Добавить**.

3. На странице **Добавление серверного пула** введите или выберите следующие данные.
    
    | Параметр | Значение |
    | ------- | ----- |
    | Имя | Введите **MyBackendPool**. |
    | Виртуальная сеть | Выберите **myVNet**. |
    | Сопоставлено с | Выберите **Виртуальные машины**. |

### <a name="create-a-health-probe"></a>Создание пробы работоспособности

Подсистема балансировки нагрузки отслеживает состояние приложения, выполняя пробу работоспособности. 

Проба работоспособности добавляет виртуальные машины в балансировщик нагрузки или удаляет их оттуда на основе их ответа на проверки работоспособности. 

Создайте зонд работоспособности с именем **myHealthProbe** , чтобы отслеживать работоспособность виртуальных машин.

1. В меню слева щелкните **Все службы** , выберите **Все ресурсы** , а затем из списка ресурсов выберите **myLoadBalancer**.

2. В разделе **Параметры** выберите **Пробы работоспособности** , а затем щелкните **Добавить**.
    
    | Параметр | Значение |
    | ------- | ----- |
    | Имя | Введите **myHealthProbe**. |
    | Протокол | Выберите **HTTP**. |
    | Порт | Введите **80**.|
    | путь | Введите **/** . |
    | Интервал | В качестве **интервала** между попытками выполнения пробы (в секундах) введите **15**. |
    | Пороговое значение сбоя | Выберите **2** в качестве значения **порога состояния неработоспособности** или количества последовательных сбоев пробы, после которых виртуальная машина будет считаться неработоспособной.|

3. Щелкните **ОК**.

### <a name="create-a-load-balancer-rule"></a>Создание правила балансировщика нагрузки

Правило балансировщика нагрузки позволяет определить распределение трафика между виртуальными машинами. Вы определяете конфигурацию внешнего IP-адреса для входящего трафика и пул внутренних IP-адресов для приема трафика. В этом правиле определяются исходный и конечный порты. 

В этом разделе показано, как создать правило подсистемы балансировки нагрузки, которая имеет следующие характеристики:

* имеет имя **myHTTPRule** ;
* находится в интерфейсной части с именем **LoadBalancerFrontEnd** ;
* ожидает передачи данных на **порт 80** ;
* отправляет трафик балансировки нагрузки на внутреннюю часть с именем **myBackendPool** через **порт 80**.

1. В меню слева щелкните **Все службы** , выберите **Все ресурсы** , а затем из списка ресурсов выберите **myLoadBalancer**.

2. В разделе **Параметры** выберите **Правила балансировки нагрузки** , а затем щелкните **Добавить**.

3. Для настройки правила балансировки нагрузки используйте следующие значения.
    
    | Параметр | Значение |
    | ------- | ----- |
    | Имя | Введите **myHTTPRule**. |
    | Версия IP-адреса | Выберите **IPv4**. |
    | Интерфейсный IP-адрес | Выберите **LoadBalancerFrontEnd**. |
    | Протокол | Выберите **TCP**. |
    | Порт | Введите **80**.|
    | Серверный порт | Введите **80**. |
    | Серверный пул | Выберите **myBackendPool**.|
    | Проверка работоспособности | Выберите **myHealthProbe**. |
    | Время ожидания простоя (в минутах) | Переместите ползунок на **15 минут**. |
 
4. Сохраните остальные значения по умолчанию и нажмите кнопку **ОК**.

## <a name="create-backend-servers"></a>Создание внутренних серверов

В этом разделе выполняются следующие действия:

* Создайте три виртуальные машины для внутреннего пула подсистемы балансировки нагрузки.
* Создайте группу доступности для виртуальных машин.
* Установите службы IIS на этих виртуальных машинах, чтобы протестировать подсистему балансировки нагрузки.

### <a name="create-virtual-machines"></a>Создание виртуальных машин

В этом разделе вы создадите три виртуальные машины ( **myVM1** , **myVM2** и **myVM3** ) с общедоступным IP-адресом ценовой категории "Базовый".  

Эти три виртуальные машины будут добавлены в группу доступности с именем **myAvailabilitySet**.

Эти виртуальные машины добавляются во внутренний пул подсистемы балансировки нагрузки, которую вы создали ранее.

1. В верхнем левом углу страницы портала выберите **Создать ресурс** > **Вычисления** > **Виртуальная машина**. 
   
2. В разделе **Создание виртуальной машины** на вкладке **Основные сведения** укажите следующее.

    | Параметр | Значение                                          |
    |-----------------------|----------------------------------|
    | **Сведения о проекте** |  |
    | Подписка | Выбор подписки Azure |
    | Группа ресурсов | Выберите **CreatePubLBQS-rg**. |
    | **Сведения об экземпляре** |  |
    | Имя виртуальной машины | Введите **myVM1**. |
    | Регион | Выберите **Западная Европа**. |
    | Параметры доступности | Выберите **Группа доступности**. |
    | Группа доступности | Выберите **Создать**. </br> Введите **myAvailabilitySet** в поле **Имя**. </br> Нажмите кнопку **ОК**. |
    | Образ — | **Windows Server 2019 Datacenter** |
    | Точечный экземпляр Azure | Выберите **Нет**. |
    | Размер | Выберите размер виртуальной машины или подтвердите значение по умолчанию. |
    | **Учетная запись администратора** |  |
    | Имя пользователя | Введите имя пользователя. |
    | Пароль | Введите пароль. |
    | Подтверждение пароля | Введите пароль еще раз. |

3. Выберите вкладку **Сеть** или **Далее: диски** , затем **Далее: сеть**.
  
4. На вкладке "Сеть" укажите следующее.

    | Параметр | Значение |
    |-|-|
    | **Сетевой интерфейс** |  |
    | Виртуальная сеть | Выберите **myVNet**. |
    | Подсеть | Выберите **myBackendSubnet** |
    | Общедоступный IP-адрес | Выберите **Нет**. |
    | Сетевая группа безопасности сетевого адаптера | Нажмите кнопку **Дополнительно**.|
    | Настройка группы безопасности сети | Выберите **Создать**. </br> В разделе **Создание группы безопасности сети** введите строку **myNSG** в поле **Имя**. </br> В разделе **Правила для входящего трафика** выберите **+ Добавить правило для входящих подключений**. </br> В поле **Диапазоны портов назначения** введите значение **80**. </br> В поле **Приоритет** введите значение **100**. </br> В поле **Имя** введите **myHTTPRule**. </br> Выберите **Добавить**. </br> Нажмите кнопку **ОК**. |
    | **Балансировка нагрузки**  |
    | Настроить эту виртуальную машину для работы с существующим решением по балансировке нагрузки? | Выберите **Нет**. |
 
5. Выберите вкладку **Управление** или **Далее** > **Управление**.

6. На вкладке **Управление** укажите следующее.
    
    | Параметр | Значение |
    |---|---|
    | **Мониторинг** | |
    | Диагностика загрузки | Выберите **Выкл.** |

7. Выберите **Review + create** (Просмотреть и создать). 
  
8. Проверьте параметры, а затем нажмите кнопку **Создать**.

9. Выполните шаги 1–8, чтобы создать еще две виртуальные машины со следующими значениями (все остальные параметры совпадают с параметрами виртуальной машины **myVM1** ).

    | Параметр | Виртуальная машина 2| Виртуальная машина 3|
    | ------- | ----- |---|
    | Имя |  **myVM2** |**myVM3**|
    | Группа доступности| Выберите **myAvailabilitySet**. | Выберите **myAvailabilitySet**.|
    | Группа безопасности сети | Выберите существующий вариант **myNSG**.| Выберите существующий вариант **myNSG**.|

### <a name="add-virtual-machines-to-the-backend-pool"></a>Добавление виртуальных машин во внутренний пул

Виртуальные машины, созданные на предыдущих шагах, необходимо добавить во внутренний пул **myLoadBalancer**.

1. В меню слева щелкните **Все службы** , выберите **Все ресурсы** , а затем из списка ресурсов выберите **myLoadBalancer**.

2. В разделе **Параметры** выберите **Серверные пулы** , а затем — **myBackendPool**.

3. В разделе **Сопоставлено с** выберите **Виртуальные машины**.

4. В разделе **Виртуальные машины** выберите **+ Добавить**.

5. Установите флажки рядом с **myVM1** , **myVM2** и **myVM3**.

6. Выберите **Добавить**.

7. Щелкните **Сохранить**.

---

## <a name="install-iis"></a>Установка служб IIS

1. В меню слева щелкните **Все службы** , выберите **Все ресурсы** , а затем в списке ресурсов выберите виртуальную машину **myVM1** , расположенную в группе ресурсов **CreateStdLBQS-rg**.

2. На странице **Обзор** выберите **Подключиться** и **Бастион**.

4. Введите имя пользователя и пароль, введенные в процессе создания виртуальной машины.

5. Выберите **Подключиться**.

6. На рабочем столе сервера перейдите к **Средства администрирования Windows** > **Windows PowerShell**.

7. В окне PowerShell выполните команды, чтобы:

    * установить сервер IIS;
    * удалить файл iisstart.htm по умолчанию;
    * добавить новый файл iisstart.htm, в котором отображается имя виртуальной машины.

   ```powershell
    
    # install IIS server role
    Install-WindowsFeature -name Web-Server -IncludeManagementTools
    
    # remove default htm file
     remove-item  C:\inetpub\wwwroot\iisstart.htm
    
    # Add a new htm file that displays server name
     Add-Content -Path "C:\inetpub\wwwroot\iisstart.htm" -Value $("Hello World from " + $env:computername)
   ```
8. Закройте сеанс Бастиона с **myVM1**.

9. Повторите шаги 1–6, чтобы установить IIS и добавить обновленный файл iisstart.htm на **myVM2** и **myVM3**.

## <a name="test-the-load-balancer"></a>Тестирование подсистемы балансировки нагрузки

1. Найдите общедоступный IP-адрес для подсистемы балансировки нагрузки на экране **обзора**. В меню слева щелкните **Все службы** , выберите **Все ресурсы** , а затем — **myPublicIP**.

2. Скопируйте общедоступный IP-адрес и вставьте его в адресную строку браузера. В браузере отобразится страница по умолчанию веб-сервера IIS.

   ![Веб-сервер IIS](./media/tutorial-load-balancer-standard-zonal-portal/load-balancer-test.png)

Чтобы подсистема балансировки нагрузки распределяла трафик между всеми тремя виртуальными машинами, вы можете настроить стандартную страницу веб-сервера IIS каждой из них, а затем принудительно обновить браузер с клиентского компьютера.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если созданные ресурсы вам больше не нужны, удалите группу ресурсов, подсистему балансировки нагрузки и всех связанные с ней ресурсы. Для этого выберите группу ресурсов **CreatePubLBQS-rg** , которая содержит все эти ресурсы, и щелкните **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

В этом кратком руководстве показано, как:

* создать Azure Load Balancer ценовой категории "Стандартный" или "Базовый";
* подключить три виртуальных машины к подсистеме балансировки нагрузки;
* настроить правило для трафика подсистемы балансировки нагрузки и пробу работоспособности, а затем протестировать подсистему балансировки нагрузки. 

Чтобы узнать больше об Azure Load Balancer, ознакомьтесь со следующей статьей:
> [!div class="nextstepaction"]
> [Что такое Azure Load Balancer](load-balancer-overview.md)
