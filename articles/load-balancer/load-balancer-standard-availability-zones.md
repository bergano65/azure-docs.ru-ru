---
title: Load Balancer ценовой категории "Стандартный" и зоны доступности
titleSuffix: Azure Load Balancer
description: По этой схеме обучения приступайте к работе с Azure Load Balancer (цен. категория "Стандартный") и Зоны доступности.
services: load-balancer
documentationcenter: na
author: asudbring
ms.custom: seodec18
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/07/2019
ms.author: allensu
ms.openlocfilehash: 63a7db6e7078df978f47a6d53ea82df83c22c800
ms.sourcegitcommit: a107430549622028fcd7730db84f61b0064bf52f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2019
ms.locfileid: "74076981"
---
# <a name="standard-load-balancer-and-availability-zones"></a>Azure Load Balancer ценовой категории "Стандартный" и зоны доступности

Azure Load Balancer (цен. категория "Стандартный") поддерживает сценарии [зон доступности](../availability-zones/az-overview.md) . Load Balancer (цен. категория "Стандартный") можно использовать для оптимизации доступности в комплексном сценарии путем согласования ресурсов с зонами и распределения их между зонами.  Ознакомьтесь с [зонами доступности](../availability-zones/az-overview.md) , чтобы получить рекомендации о том, какие зоны доступности доступны, какие регионы в настоящее время поддерживают зоны доступности, а другие связанные понятия и продукты. зоны доступности в сочетании с Load Balancer (цен. категория "Стандартный") — это обширный и гибкий набор функций, который может создавать множество различных сценариев.  Просмотрите этот документ, чтобы получить представление об этих [понятиях](#concepts) и [руководство по разработке](#design) основного сценария.

>[!IMPORTANT]
>Ознакомьтесь [зоны доступности](../availability-zones/az-overview.md) по связанным темам, включая сведения о различных регионах.

## <a name="concepts"></a> Концепции зон доступности, применимые к Load Balancer

Между ресурсами Load Balancer и фактической инфраструктурой прямая связь отсутствует. При создании Load Balancer экземпляр не создается. Ресурсы Load Balancer представляют собой объекты, в которых можно выразить, как служба Azure должна запрограммировать свою готовую мультитенантную инфраструктуру, чтобы получить сценарий, который вы хотите создать.  Это важно в контексте зон доступности, поскольку один Load Balancer ресурс может управлять программированием инфраструктуры в нескольких зонах доступности, в то время как служба, избыточная в рамках зоны, отображается как один ресурс из точки зрения клиента.  

Ресурс Load Balancer сам по себе является региональным и никогда не бывает зональным.  И виртуальная сеть, и подсеть всегда являются региональными и никогда не бывают зональными. Степень детализации, которую можно настроить, ограничивается каждой конфигурацией внешнего интерфейса, правила и определения внутреннего пула.

В контексте зон доступности поведение и свойства правила Load Balancer описываются как избыточные в виде зоны или зональные.  Избыточные между зонами и зональные описывают зональность свойства.  В контексте Load Balancer избыточность в зонах всегда означает, что *несколько зон* и зональные означают изоляцию службы в *одной зоне*.

Как внешний, так и внутренний Load Balancer поддерживают избыточные между зонами и зональные сценарии и могут направлять трафик в различных зонах при необходимости (*распределение нагрузки между зонами*). 

### <a name="frontend"></a>Внешний интерфейс

Load Balancerный интерфейс — это внешняя IP-конфигурация, ссылающаяся на ресурс общедоступного IP-адреса или на частный IP-адрес в подсети ресурса виртуальной сети.  Он формирует конечную точку с балансировкой нагрузки, где предоставляется ваша служба.

Load Balancer ресурс может содержать правила с зональные и внешними интерфейсами, избыточными в зонах одновременно. 

Если ресурс общедоступного IP-адреса или частный IP-адрес был гарантирован в зоне, то зональность (или их отсутствие) не изменяется.  Если вы хотите изменить или опустить зональность для интерфейса общедоступного или частного IP-адреса, необходимо повторно создать общедоступный IP-адрес в соответствующей зоне.  Зоны доступности не изменяют ограничения для нескольких интерфейсов. Дополнительные сведения об этой возможности см. в [нескольких внешних интерфейсах для Load Balancer](load-balancer-multivip-overview.md) .

#### <a name="zone-redundant-by-default"></a>Избыточность в пределах зоны по умолчанию

В регионе с зонами доступности Load Balancer (цен. категория "Стандартный") интерфейсный сервер является избыточным по умолчанию в пределах зоны.  Избыточность в пределах зоны означает, что все входящие или исходящие потоки обслуживаются несколькими зонами доступности в регионе одновременно с использованием одного IP-адреса. Схемы избыточности DNS не являются обязательными. Один интерфейсный IP-адрес может выдерживать сбой зоны и использоваться для доступа ко всем (нетронутым) членам внутреннего пула независимо от зоны. Одна или несколько зон доступности могут завершиться ошибкой, и путь к данным останется в рабочем состоянии, если одна зона в регионе остается работоспособной. Один IP-адрес внешнего интерфейса обрабатывается одновременно несколькими независимыми развертываниями инфраструктуры в нескольких зонах доступности.  Это не означает, что хитлесс путь к данным, но все повторные попытки или повторное выполнение будут успешно выполнены в других зонах, не влияющих на сбой зоны.   

В следующем фрагменте показано, как определить общедоступный IP-адрес, избыточный в виде зоны, для использования с общедоступной Load Balancer (цен. категория "Стандартный"). Если вы используете существующие шаблоны Resource Manager в конфигурации, добавьте раздел **sku** в эти шаблоны.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
```

В следующем фрагменте показано, как определить избыточный в зоне IP-адрес внутреннего Load Balancer (цен. категория "Стандартный"). Если вы используете существующие шаблоны Resource Manager в конфигурации, добавьте раздел **sku** в эти шаблоны.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "zone_redundant_frontend",
                        "properties": {
                            "subnet": {
                                "Id": "[variables('subnetRef')]"
                            },
                            "privateIPAddress": "10.0.0.6",
                            "privateIPAllocationMethod": "Static"
                        }
                    },
                ],
```

Приведенные выше фрагменты не являются полными шаблонами, но они показывают, как выразить свойства зон доступности.  Эти инструкции необходимо включить в шаблоны.

#### <a name="optional-zone-isolation"></a>Необязательная изоляция зоны

Вы можете гарантировать внешний интерфейс одной зоне, что называется *зональным внешним интерфейсом*.  Это означает, что любой входящий и исходящий поток обслуживается одной зоной в регионе.  Ваш внешний интерфейс разделяет работоспособность зоны.  На путь к данным не оказывают влияние сбои в зонах за исключением случаев, где это гарантировано. Зональные внешние интерфейсы можно использовать для предоставления IP-адреса каждой зоне доступности.  

Кроме того, вы можете использовать внешние интерфейсы зональные непосредственно для конечных точек с балансировкой нагрузки в каждой зоне. Их также можно использовать для предоставления каждой зоне конечных точек с балансировкой нагрузки, чтобы выполнять мониторинг каждой зоны по отдельности.  Или для общедоступных конечных точек их можно интегрировать с такими продуктами балансировки нагрузки DNS, как [диспетчер трафика](../traffic-manager/traffic-manager-overview.md) , и использовать одно DNS-имя. Затем клиент будет разрешать это DNS-имя в несколько IP-адресов зональные.  

Если вы хотите использовать эти концепции совместно (избыточные между зонами и зональные для одной и той же серверной части), см. [этот документ](load-balancer-multivip-overview.md).

Для общедоступного внешнего интерфейса Load Balancer необходимо добавить параметр *Zones* в ресурс общедоступного IP-адреса, на который ссылается IP-конфигурация внешнего интерфейса, используемая соответствующим правилом.

При использовании внутреннего интерфейса Load Balancer добавьте параметр *zones* во внешнюю IP-конфигурацию внутреннего IP-адреса. Зональный внешний интерфейс приводит к тому, что Load Balancer гарантирует IP-адрес в подсети для конкретной зоны.

В следующем фрагменте показано, как определить стандартный общедоступный IP-адрес зональные в зона 1 доступности. Если вы используете существующие шаблоны Resource Manager в конфигурации, добавьте раздел **sku** в эти шаблоны.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "zones": [ "1" ],
            "sku":
            {
                "name": "Standard"
            },
```

В следующем фрагменте показано, как определить внутреннюю Load Balancer (цен. категория "Стандартный") внешний интерфейс в зона 1 доступности. Если вы используете существующие шаблоны Resource Manager в конфигурации, добавьте раздел **sku** в эти шаблоны. Кроме того, задайте свойство **zones** в IP-конфигурации внешнего интерфейса дочернего ресурса.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "zonal_frontend_in_az1",
                        "zones": [ "1" ],
                        "properties": {
                            "subnet": {
                                "Id": "[variables('subnetRef')]"
                            },
                            "privateIPAddress": "10.0.0.6",
                            "privateIPAllocationMethod": "Static"
                        }
                    },
                ],
```

Предшествующие фрагменты не являются полными шаблонами, но они показывают, как выразить свойства зон доступности.  Эти инструкции необходимо включить в шаблоны.

### <a name="cross-zone-load-balancing"></a>Распределение нагрузки между зонами

Распределение нагрузки между зонами — это возможность Load Balancer достичь конечной точки серверной части в любой из зон. Она не зависит от внешнего интерфейса и его зональности.  Любое правило балансировки нагрузки может ориентироваться на экземпляр серверной части в любой зоне доступности или региональных экземплярах.

Необходимо соблюдать осторожность при создании сценария, который выражает представление о зонах доступности. Например, необходимо гарантировать развертывание виртуальной машины в пределах одной зоны или нескольких зон, а также согласовать зональные интерфейсные и зональные серверные ресурсы с одной и той же зоной.  Если вы пересекаете зоны доступности только с зональные ресурсами, сценарий будет работать, но может не иметь четкого режима сбоя в отношении зон доступности. 

### <a name="backend"></a>Серверная часть

Load Balancer работает с экземплярами виртуальных машин.  Это могут быть автономные наборы доступности или масштабируемые наборы виртуальных машин.  Любой экземпляр виртуальной машины в одной виртуальной сети может быть частью внутреннего пула независимо от того, был ли он гарантирован для зоны или какая зона гарантирована.

Если вы хотите Выровняйте и гарантировать внешний интерфейс и серверную часть с одной зоной, разместите виртуальные машины в одной зоне в соответствующем внутреннем пуле.

Если вы хотите устранить виртуальные машины в нескольких зонах, просто поместите виртуальные машины из нескольких зон в один серверный пул.  При использовании наборов для масштабирования виртуальных машин можно поместить один или несколько этих наборов в один и тот же внутренний пул.  И каждый из этих наборов для масштабирования виртуальных машин может находиться в одной или нескольких зонах.

### <a name="outbound-connections"></a>Исходящие подключения

Те же свойства избыточности в пределах зоны и зональные применяются к [исходящим подключениям](load-balancer-outbound-connections.md).  Общедоступный IP-адрес, избыточный в виде зоны, используемый для исходящих соединений, обслуживается всеми зонами. Общедоступный IP-адрес зональные обслуживается только той зоной, в которой он гарантирован.  Распределение портов SNAT исходящего подключения неустойчиво к сбоям зоны, и ваш сценарий продолжит предоставлять исходящие подключения SNAT, если это не повлияло на сбой зоны.  Это может потребовать передачи или повторного установления соединений для сценариев, избыточных в зоне, если поток был обслужен затронутой зоной.  Потоки в зонах, отличных от затронутых зон, не затрагиваются.

Алгоритм предварительного выделения портов SNAT аналогичен и без зон доступности.

### <a name="health-probes"></a>Пробы работоспособности

Существующие определения проверки работоспособности остаются без зон доступности.  Однако мы расширили модель работоспособности на уровне инфраструктуры. 

При использовании внешних интерфейсов, избыточных в пределах зоны, Load Balancer расширяет свою внутреннюю модель работоспособности, чтобы независимо проверять достижимость виртуальной машины из каждой зоны доступности и завершать пути между зонами, которые могли завершиться сбоем без вмешательства пользователя.  Если данный путь недоступен из инфраструктуры Load Balancer одной зоны в виртуальную машину в другой зоне, Load Balancer может обнаружить и избежать этой ошибки. Другие зоны, которые могут достичь этой виртуальной машины, могут продолжать обслуживать виртуальную машину из своих соответствующих внешних интерфейсов.  Таким образом, во время событий сбоя в каждой зоне могут присутствовать несколько разных распределений новых потоков, одновременно защищая общую работоспособность вашей комплексной службы.

## <a name="design"></a> Рекомендации по проектированию

Load Balancer является гибким в контексте зон доступности. Вы можете выбрать подразделение для зон или выбрать избыточную в виде зоны для каждого правила.  Повышение доступности достигается за счет возрастающей сложности. Вам необходимо выполнять проектирование для обеспечения доступности оптимальной производительности.  Давайте рассмотрим некоторые важные рекомендации по проектированию.

### <a name="automatic-zone-redundancy"></a>Автоматическая избыточность в пределах зоны

С помощью Load Balancer можно использовать всего один IP-адрес в качестве внешнего интерфейса, избыточного между зонами. Избыточный между зонами IP-адрес может безопасно обслуживать зональный ресурс в любой из зон и выдерживает один или несколько сбоев зоны, пока одна зона остается работоспособной внутри региона. И наоборот, зональный внешний интерфейс является уменьшением службы в единую зону и разделяет участь соответствующей зоны.

Избыточность зон не подразумевает отсутствие помех в пути к данным или плоскости управления. Это явно плоскость данных. Избыточные между зонами потоки могут использовать любые зоны, а потоки клиента будут использовать все работоспособные зоны в регионе. В случае сбоя зоны потоки трафика, поступающие с помощью работоспособных зон на тот момент времени, не затрагиваются.  Потоки трафика, использующие зону во время сбоя зоны, могут быть затронуты, но приложения могут быть восстановлены. Эти потоки могут продолжать работу в оставшихся работоспособных зонах в регионе при повторной передаче или повторной установке, когда в Azure соблюдается сбой зоны.

### <a name="xzonedesign"></a> Границы между зонами

Важно понимать, что каждый раз, когда комплексная служба пересекает границу зоны, вы разделяете участь не одной зоны, а потенциально нескольких зон.  В результате комплексная служба может быть недоступной в незональных развертываниях.

Старайтесь не использовать нежелательные зависимости между зонами, что будет аннулируются с ростом доступности при использовании зон доступности.  Если ваше приложение состоит из нескольких компонентов и вы хотите быть устойчивым к сбоям зоны, необходимо обеспечить стойкость достаточного количества важных компонентов в случае сбоя зоны.  Например, один критически важный компонент для вашего приложения может повлиять на все приложение, если он просто находится в зоне, которая не выдерживает сбоев.  Кроме того, также рассмотрите возможность восстановления зоны и каким образом ваше приложение будет объединяться. Необходимо понимать, как именно ваши приложения должны учитывать сбои частей ИТ. Давайте рассмотрим некоторые ключевые моменты, которые вы можете использовать для поиска вопросов о вашем конкретном сценарии.

- Если в приложении есть два компонента, такие как IP-адрес и виртуальная машина с управляемым диском, и они гарантированно находятся в зоне 1 и зоне 2, то при сбое зоны 1 Ваша сквозная служба не будет выдерживаться при сбое зоны 1.  Не следует пересекать зоны с зональные сценариями, если вы не знаете полное представление о создании потенциально опасного режима сбоя.  Этот сценарий может обеспечить гибкость.

- Если в приложении есть два компонента, такие как IP-адрес и виртуальная машина с управляемым диском, и они гарантированно избыточны в зоне, и зона 1 соответственно, то ваша комплексная служба будет выдерживать сбой зоны 2, зоны 3 или и то, и другое, если только зона 1 не была выполнена.  Тем не менее вы не сможете узнать о работоспособности службы, если наблюдаете только за достижимостью внешнего интерфейса.  Рассмотрите возможность разработки более сложной модели работоспособности и производительности.  Чтобы получить больше информации и расширить возможности управляемости, концепции избыточности между зонами и зональности можно использовать совместно.

- Если приложение состоит из двух компонентов, таких как внешний интерфейс Load Balancer, избыточный между зонами, и набор для масштабирования виртуальных машин между зонами в трех зонах, ваши ресурсы в зонах, которые не подвержены влиянию сбоя будут доступны, но производительность вашей комплексной службы может снизиться во время сбоя зоны. С точки зрения инфраструктуры ваше развертывание может выдержать один или несколько сбоев зоны, и в результате этого возникают следующие вопросы:
  - Понимаете ли вы, каким образом приложение получает сведения о таких сбоях и сниженной производительности?
  - Необходимо ли вам принять меры безопасности в службе, чтобы принудительно выполнить отработку отказа в пару регионов при необходимости?
  - Каким образом вы будете отслеживать, обнаруживать и избегать такую ситуацию? Возможно, вы сможете расширить возможности мониторинга производительности вашей комплексной службы с помощью диагностики Load Balancer уровня "Стандартный". Выясните, что доступно, а также что может потребоваться расширить для получения полного представления.

- Зоны помогут упростить распознавание сбоев.  Тем не менее сбой зоны не отличается от других сбоев, когда дело доходит до основных понятий, таких как истечение времени ожидания, повторные попытки и алгоритмы отсрочки. Несмотря на то, что Azure Load Balancer предоставляет пути, избыточные между зонами, и пытается выполнить восстановление быстро на уровне пакетов в реальном времени, в начале сбоя могут возникнуть повторные передачи или повторные установки подключения, и важно понимать, каким образом приложение справляется со сбоями. Схема балансировки нагрузки выдержит сбой, но необходимо оценить следующее:
  - При сбое зоны распознает ли его комплексная служба и каким образом вы выполните восстановление в случае утери сведений о состоянии?
  - При возврате из зоны понимает ли приложение, как безопасно выполнить объединение?

Ознакомьтесь с [шаблонами разработки облачных служб Azure](https://docs.microsoft.com/azure/architecture/patterns/) , чтобы повысить устойчивость приложения к сценариям сбоя.

### <a name="zonalityguidance"></a> Избыточность между зонами и зональность

Избыточность в пределах зоны может обеспечить простоту с помощью параметра, не зависящего от зоны, и с помощью отказоустойчивого параметра с одним IP-адресом для службы.  Это в свою очередь может упростить работу.  Избыточность между зонами также предусматривает мобильность между зонами, а также может безопасно использоваться с ресурсами в любой зоне.  Кроме того, это будущее подтверждение в регионах без зон доступности, что позволяет ограничить изменения, необходимые после того, как регион получит зоны доступности.  Синтаксис конфигурации для IP-адреса или переднего плана, избыточного в пределах зоны, выполняется в любом регионе, включая без зон доступности. зона не указывается в свойстве Zones: ресурса.

Зональные может обеспечить явную гарантию для зоны, явно предоставляя доступ к судьба с работоспособностью зоны. Создание правила Load Balancer с зональные IP-адресом или внутренним Load Balancer внешним интерфейсом может быть желательно, особенно если подключенный ресурс является зональные виртуальной машиной в той же зоне.  Или, возможно, вашему приложению требуются явные знания о том, в какой зоне находится ресурс за определенный период времени, и вам нужно явно указать доступность в отдельных зонах.  Вы можете предоставить несколько зональных внешних интерфейсов для комплексной службы, распределенных между зонами (то есть, зональные внешние интерфейсы на зону для нескольких зональных наборов для масштабирования виртуальных машин).  И если ваши зональные внешние интерфейсы являются общедоступными IP-адресами, несколько этих внешних интерфейсов можно использовать, чтобы предоставить службе [диспетчер трафика](../traffic-manager/traffic-manager-overview.md).  Или можно использовать несколько зональных внешних интерфейсов для получения сведений о работоспособности и производительности каждой зоны с помощью решений мониторинга сторонних производителей и предоставить полную службу с внешним интерфейсом, избыточным между зонами. Необходимо только обслуживать зональные ресурсы с помощью зональных внешних интерфейсов, выровненных с той же зоной, и избегать потенциально опасных сценариев работы между зонами для зональных ресурсов.  Ресурсы зональные существуют только в регионах, где существуют зоны доступности.

Не зная архитектуры службы, невозможно определить, какая рекомендация является наиболее предпочтительной.  Ознакомьтесь с [шаблонами разработки облачных служб Azure](https://docs.microsoft.com/azure/architecture/patterns/) , чтобы повысить устойчивость приложения к сценариям сбоя.

## <a name="limitations"></a>Ограничения

- Хотя плоскость данных является полностью избыточной между зонами (если не указана зональная гарантия), операции плоскости управления не являются полностью избыточными между зонами.

## <a name="next-steps"></a>Дополнительная информация
- Узнайте о [зонах доступности](../availability-zones/az-overview.md)
- Узнайте больше об [Azure Load Balancer уровня "Стандартный"](load-balancer-standard-overview.md).
- Узнайте, как [распределять нагрузку виртуальных машин в рамках зоны с помощью Load Balancer уровня "Стандартный" с зональным внешним интерфейсом](load-balancer-standard-public-zonal-cli.md).
- Узнайте, как [распределять нагрузку виртуальных машин по зонам с помощью Load Balancer уровня "Стандартный" с избыточным между зонами интерфейсным сервером](load-balancer-standard-public-zone-redundant-cli.md).
- Узнайте о [шаблонах разработки облачных служб Azure](https://docs.microsoft.com/azure/architecture/patterns/) , чтобы повысить устойчивость приложения к сценариям сбоя.
