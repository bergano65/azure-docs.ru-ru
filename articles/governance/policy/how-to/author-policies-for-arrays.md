---
title: Создание политик для свойств массива в ресурсах
description: Научитесь работать с параметрами массива и выражениями языка массива, оценивать псевдоним [*] и добавлять элементы с помощью правил определения политики Azure.
ms.date: 03/06/2019
ms.topic: conceptual
ms.openlocfilehash: 96598918f0dbcc2f56e8ccc316844ee768306b75
ms.sourcegitcommit: 95931aa19a9a2f208dedc9733b22c4cdff38addc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/25/2019
ms.locfileid: "74463500"
---
# <a name="author-policies-for-array-properties-on-azure-resources"></a>Создание политик для свойств массива в ресурсах Azure

Azure Resource Manager свойства обычно определяются как строки и логические значения. Если существует связь «один ко многим», то сложные свойства определяются как массивы. В политике Azure массивы используются несколькими различными способами.

- Тип [параметра определения](../concepts/definition-structure.md#parameters)для предоставления нескольких параметров
- Часть [правила политики](../concepts/definition-structure.md#policy-rule) , использующая условия **в** или **notIn**
- Часть правила политики, которая оценивает [\[\*\] псевдоним](../concepts/definition-structure.md#understanding-the--alias) для вычисления конкретных сценариев, таких как **None**, **ANY**или **ALL** .
- В [результате добавления](../concepts/effects.md#append) для замены или добавления в существующий массив

В этой статье рассматривается каждое использование в политике Azure и приводится несколько примеров определений.

## <a name="parameter-arrays"></a>Массивы параметров

### <a name="define-a-parameter-array"></a>Определение массива параметров

Определение параметра в качестве массива обеспечивает гибкость политики, если требуется более одного значения.
Это определение политики допускает любое одно расположение параметра **allowedLocations** и значение по умолчанию _eastus2_:

```json
"parameters": {
    "allowedLocations": {
        "type": "string",
        "metadata": {
            "description": "The list of allowed locations for resources.",
            "displayName": "Allowed locations",
            "strongType": "location"
        },
        "defaultValue": "eastus2"
    }
}
```

Как **тип** _String_, при назначении политики может быть задано только одно значение. Если эта политика назначена, ресурсы в области разрешены только в пределах одного региона Azure. Большинству определений политик необходимо предоставить список утвержденных параметров, например разрешить _eastus2_, _eastus_и _westus2_.

Чтобы создать определение политики, разрешающее несколько параметров, используйте **тип**массива. Эту же политику можно переписывать следующим образом:

```json
"parameters": {
    "allowedLocations": {
        "type": "array",
        "metadata": {
            "description": "The list of allowed locations for resources.",
            "displayName": "Allowed locations",
            "strongType": "location"
        },
        "defaultValue": "eastus2",
        "allowedValues": [
            "eastus2",
            "eastus",
            "westus2"
        ]

    }
}
```

> [!NOTE]
> После сохранения определения политики невозможно изменить свойство **Type** в параметре.

Это новое определение параметра принимает более одного значения во время назначения политики. Если определено свойство массива **allowedValues** , значения, доступные во время назначения, дополнительно ограничиваются предопределенным списком вариантов выбора. Использование **allowedValues** является необязательным.

### <a name="pass-values-to-a-parameter-array-during-assignment"></a>Передача значений в массив параметров во время назначения

При назначении политики с помощью портал Azure параметр _массива_ **типа** отображается как одно текстовое поле. В подсказке указано "use; для разделения значений. (например, Лондон; Нью-Йорк) ". Чтобы передать допустимые значения расположения _eastus2_, _eastus_и _westus2_ в параметр, используйте следующую строку:

`eastus2;eastus;westus2`

Формат значения параметра отличается при использовании Azure CLI, Azure PowerShell или REST API. Значения передаются через строку JSON, которая также содержит имя параметра.

```json
{
    "allowedLocations": {
        "value": [
            "eastus2",
            "eastus",
            "westus2"
        ]
    }
}
```

Чтобы использовать эту строку вместе с каждым пакетом SDK, используйте следующие команды:

- Azure CLI: команда [AZ назначение политики создать](/cli/azure/policy/assignment?view=azure-cli-latest#az-policy-assignment-create) с параметрами **параметров**
- Azure PowerShell: командлет [New-азполициассигнмент](/powershell/module/az.resources/New-Azpolicyassignment) с параметром **полиципараметер**
- REST API: в операции _размещения_ [создания](/rest/api/resources/policyassignments/create) как часть текста запроса как значение свойства **. parameters**

## <a name="policy-rules-and-arrays"></a>Правила и массивы политики

### <a name="array-conditions"></a>Условия массива

[Условие правила политики](../concepts/definition-structure.md#conditions) , в котором _массив_
**тип** параметра, может использоваться с, ограничен `in` и `notIn`. В качестве примера возьмем следующее определение политики с условием `equals`.

```json
{
  "policyRule": {
    "if": {
      "not": {
        "field": "location",
        "equals": "[parameters('allowedLocations')]"
      }
    },
    "then": {
      "effect": "audit"
    }
  },
  "parameters": {
    "allowedLocations": {
      "type": "Array",
      "metadata": {
        "description": "The list of allowed locations for resources.",
        "displayName": "Allowed locations",
        "strongType": "location"
      }
    }
  }
}
```

Попытка создать определение политики с помощью портал Azure приводит к ошибке, такой как следующее сообщение об ошибке:

- "Не удалось выполнить параметризацию политики" {GUID} "из-за ошибок проверки. Убедитесь, что параметры политики определены правильно. Результатом вычисления внутреннего исключения "выражение языка" [Parameters (' allowedLocations ')] ' является тип ' Array ', ожидаемым типом является String. '. '

Ожидаемый **тип** условия `equals` является _строковым_. Так как **allowedLocations** определен как _массив_типов, обработчик политики вычисляет выражение языка и выдает ошибку. При условии `in` и `notIn` обработчик политики ждет, что _массив_ **типов** будет в выражении языка. Чтобы устранить это сообщение об ошибке, измените значение `equals` на `in` или `notIn`.

### <a name="evaluating-the--alias"></a>Вычисление псевдонима [*]

Псевдонимы, имеющие **[\*]** , прикрепленные к имени, указывают, что этот **тип** является _массивом_. Вместо вычисления значения всего массива **[\*]** позволяет оценивать каждый элемент массива. Существует три сценария, которые могут быть полезны для оценки каждого элемента: None, Any и ALL.

Обработчик политики активирует этот **результат** **только в том случае** , если правило **If** имеет значение true.
Этот факт важен для понимания в контексте способа, с помощью которого **[\*]** оценивает каждый отдельный элемент массива.

Пример правила политики для следующей таблицы сценария:

```json
"policyRule": {
    "if": {
        "allOf": [
            {
                "field": "Microsoft.Storage/storageAccounts/networkAcls.ipRules",
                "exists": "true"
            },
            <-- Condition (see table below) -->
        ]
    },
    "then": {
        "effect": "[parameters('effectType')]"
    }
}
```

Массив **ипрулес** выглядит следующим образом в таблице сценариев ниже:

```json
"ipRules": [
    {
        "value": "127.0.0.1",
        "action": "Allow"
    },
    {
        "value": "192.168.1.1",
        "action": "Allow"
    }
]
```

Для каждого примера условия ниже замените `<field>` `"field": "Microsoft.Storage/storageAccounts/networkAcls.ipRules[*].value"`.

Следующие результаты являются результатом сочетания условия, а также правила для примера политики и массива существующих значений, приведенных выше.

|Условие |Результат |Пояснение |
|-|-|-|
|`{<field>,"notEquals":"127.0.0.1"}` |Возмож |Один элемент массива вычисляется как false (127.0.0.1! = 127.0.0.1), а другой — как true (127.0.0.1! = 192.168.1.1), поэтому условие **notEquals** имеет _значение false_ и этот результат не срабатывает. |
|`{<field>,"notEquals":"10.0.4.1"}` |Воздействие политики |Оба элемента массива оцениваются как true (10.0.4.1! = 127.0.0.1 и 10.0.4.1! = 192.168.1.1), поэтому условие **notEquals** имеет _значение true_ и срабатывает. |
|`"not":{<field>,"Equals":"127.0.0.1"}` |Воздействие политики |Один элемент массива вычисляется как true (127.0.0.1 = = 127.0.0.1), а другой — как false (127.0.0.1 = = 192.168.1.1), поэтому условие **Equals** имеет _значение false_. Логический оператор принимает значение true (**не** _false_), поэтому срабатывает. |
|`"not":{<field>,"Equals":"10.0.4.1"}` |Воздействие политики |Оба элемента массива оцениваются как false (10.0.4.1 = = 127.0.0.1 и 10.0.4.1 = = 192.168.1.1), поэтому условие **Equals** имеет _значение false_. Логический оператор принимает значение true (**не** _false_), поэтому срабатывает. |
|`"not":{<field>,"notEquals":"127.0.0.1" }` |Воздействие политики |Один элемент массива вычисляется как false (127.0.0.1! = 127.0.0.1) и один как true (127.0.0.1! = 192.168.1.1), поэтому условие **notEquals** имеет _значение false_. Логический оператор принимает значение true (**не** _false_), поэтому срабатывает. |
|`"not":{<field>,"notEquals":"10.0.4.1"}` |Возмож |Оба элемента массива оцениваются как true (10.0.4.1! = 127.0.0.1 и 10.0.4.1! = 192.168.1.1), поэтому условие **notEquals** имеет _значение true_. Логический оператор вычисляет значение false (**не** _Истина_), поэтому этот результат не срабатывает. |
|`{<field>,"Equals":"127.0.0.1"}` |Возмож |Один элемент массива вычисляется как true (127.0.0.1 = = 127.0.0.1), а другой — как false (127.0.0.1 = = 192.168.1.1), поэтому условие **Equals** имеет _значение false_ , а сам результат не срабатывает. |
|`{<field>,"Equals":"10.0.4.1"}` |Возмож |Оба элемента массива оцениваются как false (10.0.4.1 = = 127.0.0.1 и 10.0.4.1 = = 192.168.1.1), поэтому условие **Equals** имеет _значение false_ , а сам результат не срабатывает. |

## <a name="the-append-effect-and-arrays"></a>Действие добавления и массивы

[Результат действия Append](../concepts/effects.md#append) по-разному зависит от того, является ли **Details. Field** псевдонимом **[\*]** .

- Если не является псевдонимом **[\*]** , Append заменяет весь массив свойством **value**
- Если псевдоним **[\*]** , Append добавляет свойство **value** в существующий массив или создает новый массив.

Дополнительные сведения см. в разделе [Примеры добавления](../concepts/effects.md#append-examples).

## <a name="next-steps"></a>Дополнительная информация

- Просмотрите примеры в [примерах политики Azure](../samples/index.md).
- Изучите статью о [структуре определения Политики Azure](../concepts/definition-structure.md).
- См. дополнительные сведения о [действиях политик](../concepts/effects.md).
- Узнайте, как [программно создавать политики](programmatically-create.md).
- Узнайте, как [исправлять несоответствующие ресурсы](remediate-resources.md).
- Дополнительные сведения о группе управления см. в статье [Упорядочивание ресурсов с помощью групп управления Azure](../../management-groups/overview.md).