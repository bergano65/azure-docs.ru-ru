---
title: Создание среды из образца схемы
description: Используйте образец схемы для создания определения схемы, с помощью которого настраиваются две группы ресурсов и назначения роли для каждой из них.
services: blueprints
author: DCtheGeek
ms.author: dacoulte
ms.date: 03/05/2019
ms.topic: tutorial
ms.service: blueprints
ms.custom: mvc
manager: carmonm
ms.openlocfilehash: 68bd6e3942d2b2e2c8bcf39bfcff10540e564315
ms.sourcegitcommit: 94305d8ee91f217ec98039fde2ac4326761fea22
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2019
ms.locfileid: "57411176"
---
# <a name="create-an-environment-from-a-blueprint-sample"></a>Создание среды из образца схемы

Образцы схем приведены как примеры того, что можно сделать с помощью Azure Blueprints. Каждый образец содержит определенное намерение или цель, но самостоятельно не создает полную среду. Он предназначен в качестве отправной точки для изучения с помощью Azure Blueprints с различными сочетаниями включенных артефактов, макетов и параметров.

В следующем руководстве используется образец схемы **Группы ресурсов с RBAC** для демонстрации различных аспектов службы Blueprints. В этой статье рассматриваются следующие этапы:

> [!div class="checklist"]
> - создание определения схемы на основе образца;
> - установка метки копии образца **Опубликовано**;
> - назначение копии схемы существующей подписке;
> - просмотр ресурсов, развернутых для назначения;
> - отмена назначения схемы для удаления блокировок.

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством вам потребуется подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/), прежде чем начинать работу.

## <a name="create-blueprint-definition-from-sample"></a>Создание определения схемы на основе образца

Сначала реализуйте образец схемы. При импорте в вашей среде создается новая схема на основе образца.

1. Выберите **Все службы** в левой области. Найдите и выберите пункт **Схемы**.

1. На странице **Начало работы** с левой стороны в разделе _Создание схемы_ щелкните кнопку **Создать**.

1. В разделе _Other Samples_ (Другие образцы) найдите образец схемы **Группы ресурсов с RBAC** и щелкните **Использовать этот пример**.

1. Введите _основные данные_ образца схемы.

   - **Имя схемы**. Укажите имя для копии образца схемы. В этом руководстве мы будем использовать имя _two-rgs-with-role-assignments_.
   - **Расположение определения**. Используйте кнопку с многоточием и выберите группу управления или подписку, в которой необходимо сохранить копию образца.

1. В верхней части страницы выберите вкладку _Артефакты_ или внизу страницы щелкните **Далее: Артефакты**.

1. Просмотрите список артефактов, из которых состоит образец схемы. Этот образец определяет две группы ресурсов с отображаемыми именами _ProdRG_ и _PreProdRG_. Окончательное имя и расположение каждой группы ресурсов задаются во время назначения схемы. Группе ресурсов _ProdRG_ назначается роль _Участник_, а группе _PreProdRG_ — роли _Владелец_ и _Читатели_. Роли, назначенные в определении, являются статическими, но пользователь, приложение или группа, которым назначена роль, устанавливаются во время назначения схемы.

1. После завершения просмотра образца схемы выберите **Сохранить черновик**.

На этом шаге в выбранной группе управления или подписке создается копия образца определения схемы. Управление сохраненным определением схемы осуществляется так же, как и любой другой схемой, созданной с нуля. Вы можете сохранять образец в группу управления или подписку любое количество раз. Однако, каждая копия должна обладать уникальным именем.

Когда появится уведомление портала **Определение схемы успешно сохранено**, перейдите к следующему шагу.

## <a name="publish-the-sample-copy"></a>Публикации копии образца

Теперь в вашей среде создана копия образца схемы. Она создана в режиме **Черновик**, и прежде чем назначить и развернуть эту копию, ее необходимо **опубликовать**. Копию образца схемы можно настроить согласно вашей среде и потребностям. В этом руководстве мы ничего не изменяем.

1. Выберите **Все службы** в левой области. Найдите и выберите пункт **Схемы**.

1. В меню слева выберите страницу **Определения схем**. Используйте фильтры, чтобы найти определение схемы _two-rgs-with-role-assignments_, а затем выберите его.

1. В верхней части страницы выберите **Опубликовать схему**. В правой части новой панели задайте параметру **Версия** вашей копии образца схемы значение _1.0_. Это свойство позволяет вносить изменения позднее. Укажите **Сведения об изменениях**, например "Первая версия, опубликованная из групп ресурсов с образцом схемы RBAC". Затем щелкните **Опубликовать** в нижней части страницы.

На этом шаге можно назначить схему подписке. Вносить изменения можно и после публикации. Дополнительные изменения необходимо опубликовать с новым значением параметра **Версия**, чтобы отслеживать различия между разными версиями одного определения схемы.

Когда появится уведомление портала **Определение схемы опубликовано**, перейдите к следующему шагу.

## <a name="assign-the-sample-copy"></a>Назначение копии образца

После успешной **публикации** копию образца схемы можно назначить подписке в группе управления, в которой ее сохранили. На этом шаге указывают параметры, которые позволяют сделать каждое развертывание образца схемы уникальным.

1. Выберите **Все службы** в левой области. Найдите и выберите пункт **Схемы**.

1. В меню слева выберите страницу **Определения схем**. Используйте фильтры, чтобы найти определение схемы _two-rgs-with-role-assignments_, а затем выберите его.

1. В верхней части страницы определения схемы выберите **Назначить схему**.

1. Укажите значения параметра для назначения схемы.

   - Основы

     - **Подписки**. Выберите одну или несколько подписок, которые находятся в группе управления, в которой вы сохранили копию образца схемы. Если вы выберите более одной подписки, для каждой из них будет создано назначение с использованием введенных параметров.
     - **Имя назначения.** Имя предварительно заполняется на основе имени определения схемы.
     - **Расположение.** Выберите регион, в котором будет создано управляемое удостоверение. Azure Blueprint использует это управляемое удостоверение для развертывания всех артефактов в назначенную схему. Дополнительные сведения см. в статье [Управляемые удостоверения для ресурсов Azure](../../../active-directory/managed-identities-azure-resources/overview.md).
       Для этого руководства выберите регион _Восточная часть США 2_.
     - **Версия определения схемы**. Выберите **опубликованную** версию _1.0_ образца определения схемы.

   - Блокировка назначения

     Выберите режим блокировки схемы _Только для чтения_. Дополнительные сведения см. в разделе [Блокировка ресурсов схем](../concepts/resource-locking.md).

   - Управляемое удостоверение

     Оставьте параметр по умолчанию _Назначено системой_. Дополнительные сведения см. в статье [Что такое управляемые удостоверения для ресурсов Azure?](../../../active-directory/managed-identities-azure-resources/overview.md)

   - Параметры артефакта

     Параметры, определенные в этом разделе, применяются к артефакту, под которым они определены. Поскольку эти параметры определяются во время назначения схемы, они являются [динамическими](../concepts/parameters.md#dynamic-parameters). Для каждого артефакта задайте значение параметра, определенное в столбце **Значение**. Выберите учетную запись пользователя Azure для `{Your ID}`.

     |Имя артефакта|Тип артефакта|Имя параметра|Значение|ОПИСАНИЕ|
     |-|-|-|-|-|
     |Группа ресурсов ProdRG|Группа ресурсов|ИМЯ|ProductionRG|Определяет имя первой группы ресурсов.|
     |Группа ресурсов ProdRG|Группа ресурсов|Расположение|Западный регион США 2|Задает расположение первой группы ресурсов.|
     |участник;|Назначение роли|Пользователь или группа|{Ваш ИД}|Определяет, какому пользователю или группе предоставить назначение роли _Участник_ в пределах первой группы ресурсов.|
     |Группа ресурсов PreProdRG|Группа ресурсов|ИМЯ|PreProductionRG|Определяет имя второй группы ресурсов.|
     |Группа ресурсов PreProdRG|Группа ресурсов|Расположение|Запад США|Задает расположение второй группы ресурсов.|
     |Владелец.|Назначение роли|Пользователь или группа|{Ваш ИД}|Определяет, какому пользователю или группе предоставить назначение роли _Владелец_ в пределах второй группы ресурсов.|
     |читатели;|Назначение роли|Пользователь или группа|{Ваш ИД}|Определяет, какому пользователю или группе предоставить назначение роли _Читатель_ в пределах второй группы ресурсов.|

1. После ввода всех параметров в нижней части страницы выберите **Назначить**.

На этом шаге происходит развертывание определенных ресурсов и настройка выбранного **назначения блокировки**. Для применения блокировок схемы понадобится до 30 минут.

Когда появится уведомление портала **Определение схемы назначено**, перейдите к следующему шагу.

## <a name="inspect-resources-deployed-by-the-assignment"></a>Просмотр ресурсов, развернутых назначением

Назначение схемы создает и отслеживает артефакты, заданные в определении схемы. Состояние ресурсов можно увидеть на странице назначения схемы и непосредственно в ресурсах.

1. Выберите **Все службы** в левой области. Найдите и выберите пункт **Схемы**.

1. Слева выберите страницу **Назначенные схемы**. Используйте фильтры, чтобы найти назначение схемы _Assignment-two-rgs-with-role-assignments_, а затем выберите его.

   На этой странице отображаются успешно развернутое назначение и список созданных ресурсов с состоянием блокировки схемы. При обновлении назначения в раскрывающемся списке **Операция назначения** отображаются сведения о развертывании каждой версии определения. При щелчке на указанный в списке созданный ресурс откроется страница его свойств.

1. Выберите группу ресурсов **ProductionRG**.

   Мы видим, что имя группы ресурсов — **ProductionRG**, а не отображаемое имя артефакта _ProdRG_. Это имя совпадает со значением, которое задается во время назначения схемы.

1. В меню слева выберите страницу **Управление доступом (IAM)** и перейдите на вкладку **Назначения ролей**.

   Здесь мы видим, что в области _Этот ресурс_ вашей учетной записи присвоена роль _Участник_. Назначению схемы _Assignment-two-rgs-with-role-assignments_ принадлежит роль _Владелец_, так как оно использовалось для создания группы ресурсов. Эти разрешения также используются для управления ресурсами с настроенными блокировками схемы.

1. В элементе навигации портала Azure выберите **Assignment-two-rgs-with-role-assignments**, чтобы вернуться на одну страницу назад, а затем выберите группу ресурсов **PreProductionRG**.

1. В меню слева выберите страницу **Управление доступом (IAM)** и перейдите на вкладку **Назначения ролей**.

   Здесь мы видим, что в области _Этот ресурс_ вашей учетной записи присвоены роли _Владелец_ и _Читатель_. Назначению схемы, также как и первой группе ресурсов, принадлежит роль _Владелец_.

1. Выберите вкладку **Запрет назначений**.

   В развернутой группе ресурсов назначение схемы создало [запрет назначения](../../../role-based-access-control/deny-assignments.md), чтобы принудительно применить режим блокировки схемы _Только для чтения_. Запрет назначения не дает пользователю с соответствующими правами выполнять определенные действия на вкладке _Назначения ролей_. Запрет назначения влияет на _все субъекты_.

1. Выберите запрет назначения, а затем перейдите на страницу **Отклоненные разрешения** слева.

   Запрет назначения блокирует все операции с конфигурацией **\*** и **Действие**, но разрешает доступ на чтение, исключая **\*/read** через **NotActions**.

1. В элементе навигации портала Azure выберите **PreProductionRG — Управление доступом (IAM)**. Затем в левом меню перейдите на страницу **Обзор** и щелкните кнопку **Удалить группу ресурсов**. Чтобы подтвердить удаление, введите имя _PreProductionRG_ и в нижней части панели выберите **Удалить**.

   Отобразится уведомление портала **Удаление группы ресурсов PreProductionRG завершилось сбоем**. Ошибка указывает на то, что хоть в вашей учетной записи есть разрешение на удаление группы ресурсов, назначение схемы запрещает доступ к ней. Помните, что при назначении схемы мы выбрали режим блокировки схемы _Только для чтения_. Блокировка схемы предотвращает удаление ресурсов учетной записью с разрешением (даже с ролью _Владелец_). Дополнительные сведения см. в разделе [Блокировка ресурсов схем](../concepts/resource-locking.md).

Согласно этим действиям, ресурсы были созданы определенным образом, а блокировки схемы не позволяли нежелательные удаления даже из учетной записи с разрешением.

## <a name="unassign-the-blueprint"></a>Отмена назначения схемы

Последнее, что нужно сделать, — удалить назначение схемы и развернутые им ресурсы.
Удаление назначения не удаляет развернутые артефакты.

1. Выберите **Все службы** в левой области. Найдите и выберите пункт **Схемы**.

1. Слева выберите страницу **Назначенные схемы**. Используйте фильтры, чтобы найти назначение схемы _Assignment-two-rgs-with-role-assignments_, а затем выберите его.

1. В верхней части страницы нажмите кнопку **Отменить назначение схемы**. Прочтите предупреждение в диалоговом окне подтверждения, а затем щелкните **ОК**.

   Блокировки схемы удаляются вместе с назначением схемы. Удаление созданных ресурсов из учетных записей с разрешениями снова возможно.

1. В меню Azure выберите **Группы ресурсов**, а затем щелкните **ProductionRG**.

1. В меню слева выберите страницу **Управление доступом (IAM)** и перейдите на вкладку **Назначения ролей**.

Параметры безопасности каждой группы ресурсов по-прежнему содержат развернутые назначения ролей, но назначение схемы больше не имеет доступа уровня _Владелец_.

Когда появится уведомление портала **Назначение схемы удалено**, перейдите к следующему шагу.

## <a name="clean-up-resources"></a>Очистка ресурсов

После работы с этим руководством удалите следующие ресурсы:

- группу ресурсов _ProductionRG_;
- группу ресурсов _PreProductionRG_;
- определение схемы _two-rgs-with-role-assignments_.

## <a name="next-steps"></a>Дополнительная информация

- Ознакомьтесь с [жизненным циклом схемы](../concepts/lifecycle.md).
- Узнайте, как использовать [статические и динамические параметры](../concepts/parameters.md)
- Узнайте, как применять [блокировку ресурсов схемы](../concepts/resource-locking.md)
- Научитесь настраивать [последовательность схемы](../concepts/sequencing-order.md)
- Узнайте, как [обновлять существующие назначения](../how-to/update-existing-assignments.md)
- Устраняйте проблемы, возникающие во время назначения схемы, с помощью [общих инструкций по устранению неполадок](../troubleshoot/general.md)