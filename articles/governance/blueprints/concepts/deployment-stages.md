---
title: Этапы развертывания схемы
description: Изучите шаги, связанные с безопасностью и артефактами, с помощью которых осуществляется служба "схемы Azure" при создании назначения схемы.
ms.date: 08/27/2020
ms.topic: conceptual
ms.openlocfilehash: 73d5d67cf77d4ccc48517c895630b8299081e2e0
ms.sourcegitcommit: 8a7b82de18d8cba5c2cec078bc921da783a4710e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2020
ms.locfileid: "89049780"
---
# <a name="stages-of-a-blueprint-deployment"></a>Этапы развертывания схемы

При развертывании проекта служба "схемы Azure" предпринимает ряд действий для развертывания ресурсов, определенных в проекте. В этой статье приводятся сведения о том, что включает каждый шаг.

Развертывание схемы активируется путем назначения схемы подписке или [обновления существующего назначения](../how-to/update-existing-assignments.md). Во время развертывания схемы Azure выполняются в следующих общих действиях:

> [!div class="checklist"]
> - Планы Azure, которым предоставлены права владельца
> - Объект назначения схемы создан
> - Необязательная схема Azure создает управляемое удостоверение, **назначенное системой** .
> - Управляемые удостоверения развертывает артефакты схемы
> - Служба "схемы Azure" и права управляемого удостоверения, **назначенные системой** , отозваны

## <a name="azure-blueprints-granted-owner-rights"></a>Планы Azure, которым предоставлены права владельца

Субъекту-службе схем Azure предоставляются права владельца для назначенной подписки или подписок, если используется управляемое системой удостоверение управляемого [удостоверения](../../../active-directory/managed-identities-azure-resources/overview.md) . Предоставленная роль позволяет проектам Azure создавать и позднее отменять **назначенное системой** управляемое удостоверение. При использовании **назначенного пользователем** управляемого удостоверения субъект-служба схем Azure не получает и не требует прав владельца для подписки.

Права предоставляются автоматически, если назначение выполняется на портале. Однако, если назначение выполняется с помощью REST API, предоставление прав необходимо выполнять с помощью отдельного вызова API. В проекте схемы Azure AppId является `f71766dc-90d9-4b7d-bd9d-4499c4331c3f` , но субъект-служба зависит от клиента. Для получения субъекта-службы используйте [Azure Active Directory API Graph](../../../active-directory/develop/active-directory-graph-api.md) и конечную точку RESTful [Свойства serviceprincipals](/graph/api/resources/serviceprincipal) . Затем предоставьте роль _владельца_ в Azure на [портале](../../../role-based-access-control/role-assignments-portal.md), [Azure CLI](../../../role-based-access-control/role-assignments-cli.md), [Azure PowerShell](../../../role-based-access-control/role-assignments-powershell.md), [REST API](../../../role-based-access-control/role-assignments-rest.md)или [шаблоне Azure Resource Manager](../../../role-based-access-control/role-assignments-template.md).

Службы схем Azure не развертывают ресурсы напрямую.

## <a name="the-blueprint-assignment-object-is-created"></a>Объект назначения схемы создан

Пользователь, группа или субъект-служба назначает проект для подписки. Объект назначения существует на уровне подписки, где был назначен проект. Ресурсы, созданные при развертывании, не выполняются в контексте сущности развертывания.

При создании назначения схемы выбирается тип [управляемого удостоверения](../../../active-directory/managed-identities-azure-resources/overview.md) . Значение по умолчанию — управляемое **системой** удостоверение. Можно выбрать **назначаемое пользователем** управляемое удостоверение. При использовании управляемого удостоверения, **назначенного пользователем** , его необходимо определить и предоставить разрешения перед созданием назначения схемы. Роли " [владелец](../../../role-based-access-control/built-in-roles.md#owner) " и " [оператор](../../../role-based-access-control/built-in-roles.md#blueprint-operator) построения" имеют необходимые `blueprintAssignment/write` разрешения для создания назначения, использующего управляемое удостоверение, **назначенное пользователем** .

## <a name="optional---azure-blueprints-creates-system-assigned-managed-identity"></a>Необязательная схема Azure создает управляемое удостоверение, назначенное системой.

При выборе [управляемого удостоверения, назначенного системой](../../../active-directory/managed-identities-azure-resources/overview.md) во время назначения, схемы Azure создают удостоверение и предоставляют управляемому удостоверению роль [владельца](../../../role-based-access-control/built-in-roles.md#owner) . Если [существующее назначение Обновлено](../how-to/update-existing-assignments.md), в проектных схемах Azure используется ранее созданное управляемое удостоверение.

Управляемое удостоверение, связанное с назначением схемы, используется для развертывания или повторного развертывания ресурсов, определенных в проекте. Такая схема позволяет избежать непреднамеренного влияния на назначения друг на друга.
Эта схема также поддерживает функцию [блокировки ресурсов](./resource-locking.md) , контролируя безопасность каждого развернутого ресурса из схемы.

## <a name="the-managed-identity-deploys-blueprint-artifacts"></a>Управляемые удостоверения развертывает артефакты схемы

Затем управляемое удостоверение активирует диспетчер ресурсов развертывания артефактов в пределах схемы в определенном [порядке последовательности](./sequencing-order.md). Заказ можно изменить, чтобы убедиться, что артефакты, зависящие от других артефактов, развернуты в правильном порядке.

Сбой доступа при развертывании часто является результатом уровня доступа, предоставляемого управляемому удостоверению. Служба схем Azure управляет жизненным циклом безопасности управляемого удостоверения, **назначенного системой** . Однако пользователь несет ответственность за управление правами и жизненным циклом управляемого удостоверения, **назначаемого пользователем** .

## <a name="blueprint-service-and-system-assigned-managed-identity-rights-are-revoked"></a>Служба схемы и назначенные системой управляемые удостоверения отменяются

После завершения развертывания схемы Azure отменяют права управляемого **системой** удостоверения из подписки. Затем служба схем Azure отзывает свои права из подписки. Удаление прав не допускало, что планы Azure станут постоянным владельцем подписки.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как использовать [статические и динамические параметры](./parameters.md).
- Научитесь настраивать [последовательность схемы](./sequencing-order.md).
- Узнайте, как применять [блокировку ресурсов схемы](./resource-locking.md).
- Узнайте, как [обновлять существующие назначения](../how-to/update-existing-assignments.md).
- Устраняйте проблемы, возникающие во время назначения схемы, с помощью [общих инструкций по устранению неполадок](../troubleshoot/general.md).
