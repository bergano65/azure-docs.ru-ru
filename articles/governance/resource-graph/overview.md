---
title: Обзор Azure Resource Graph
description: Узнайте, как служба Azure Resource Graph позволяет выполнять сложные запросы ресурсов в нужном масштабе в подписках и клиентах.
ms.date: 07/25/2020
ms.topic: overview
ms.openlocfilehash: 5a2be5e65ecd5590d992e1883f432c173660e78d
ms.sourcegitcommit: 8def3249f2c216d7b9d96b154eb096640221b6b9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2020
ms.locfileid: "87541793"
---
# <a name="what-is-azure-resource-graph"></a>Что такое Azure Resource Graph?

Azure Resource Graph — это служба в Azure, призванная расширить управление ресурсами Azure за счет действенных средств для оценки ресурсов и возможности масштабных запросов к выбранному набору подписок, которые позволят вам эффективно контролировать вашу среду. Такие запросы предоставляют следующие возможности:

- Возможность запрашивать ресурсы, используя сложные фильтры, группирование и сортировку по свойствам ресурсов.
- Возможность итеративно изучать ресурсы в соответствии с требованиями системы управления.
- Возможность оценить эффект от применения политик в обширной облачной среде.
- Возможность [детализировать изменения, внесенные в свойства ресурса](./how-to/get-resource-changes.md) (предварительная версия).

В этой документации мы рассмотрим каждую из этих возможностей подробно.

> [!NOTE]
> Azure Resource Graph обеспечивает работу панели поиска портала Azure, новой возможности обзора "Все ресурсы", а также _отличия визуальных элементов_[Изменение журнала](../policy/how-to/determine-non-compliance.md#change-history) политики Azure
> . Этот компонент предназначен для клиентов, которым нужно управлять масштабными средами.

[!INCLUDE [azure-lighthouse-supported-service](../../../includes/azure-lighthouse-supported-service.md)]

## <a name="how-does-resource-graph-complement-azure-resource-manager"></a>Как Azure Resource Graph дополняет Azure Resource Manager

Сейчас Resource Manager поддерживает запросы к основным полям ресурсов: "Имя ресурса", "Идентификатор", "Тип", "Группа ресурсов", "Подписка" и "Расположение". Resource Manager также предоставляет средства вызова отдельных поставщиков ресурсов, позволяя получить подробные свойства для каждого из ресурсов.

Azure Resource Graph дает вам доступ к свойствам, возвращаемым поставщиками ресурсов, без необходимости вызывать каждый поставщик ресурсов отдельно. Список поддерживаемых типов ресурсов см. в [таблице и справочнике по типам ресурсов](./reference/supported-tables-resources.md). Альтернативный способ просмотра поддерживаемых типов ресурсов — с помощью [обозревателя схемы обозревателя Azure Resource Graph](./first-query-portal.md#schema-browser).

Возможности Azure Resource Graph:

- Доступ к свойствам, возвращаемым поставщиками ресурсов, без необходимости вызывать каждый поставщик ресурсов отдельно.
- Просмотр журнала изменений, внесенных в ресурс за последние 14 дней, чтобы узнать, какие свойства были изменены и когда. (предварительная версия)

## <a name="how-resource-graph-is-kept-current"></a>Обновление Resource Graph

При обновлении ресурса Azure Resource Graph получает от Resource Manager уведомление об изменении.
Затем Resource Graph обновляет свою базу данных. Resource Graph также выполняет обычное _полное сканирование_. Такое сканирование обеспечивает обновление данных Resource Graph при наличии пропущенных уведомлений или при обновлении ресурса за пределами Resource Manager.

> [!NOTE]
> Resource Graph применяет `GET` к последнему API-интерфейсу (не предварительной версии) каждого поставщика ресурсов для сбора свойств и значений. В результате ожидаемое свойство может быть недоступно. В некоторых случаях используемая версия API была переопределена, чтобы предоставить больше текущих или широко используемых свойств в результатах. Полный список в среде можно найти в статье [Продвинутые запросы графика ресурсов](./samples/advanced.md#apiversion).

## <a name="the-query-language"></a>Язык запросов

Теперь, когда вы разобрались, что такое Azure Resource Graph, рассмотрим порядок создания запросов.

Важно понимать, что язык запросов Azure Resource Graph похож на [язык запросов Kusto](/azure/data-explorer/data-explorer-overview), используемый в Azure Data Explorer.

Сведения об операциях и функциях, которые можно использовать с Azure Resource Graph, см. в статье [Язык запросов Resource Graph](./concepts/query-language.md). Информацию о ресурсах см. в статье о [просмотре ресурсов](./concepts/explore-resources.md).

## <a name="permissions-in-azure-resource-graph"></a>Разрешения в Azure Resource Graph

Чтобы использовать Resource Graph, необходимо иметь соответствующие права для [управления доступом на основе ролей](../../role-based-access-control/overview.md) (RBAC) как минимум с доступом на чтение ресурсов, которые вы планируете запрашивать. Без минимального разрешения `read` для объекта или группы объектов Azure результаты не будут возвращаться.

> [!NOTE]
> Resource Graph использует подписки, доступные субъекту на момент входа. Чтобы просмотреть ресурсы новой подписки, добавленные во время активного сеанса, субъекту необходимо обновить контекст. Это происходит автоматически при выходе и повторном входе.

Azure CLI и Azure PowerShell используют подписки, к которым у пользователя есть доступ. При непосредственном использовании REST API список подписок предоставляется пользователем. Если пользователь имеет доступ к любой из подписок в списке, результаты запроса возвращаются для подписок, к которым у пользователя есть доступ. Такое поведение аналогично тому, когда вы вызываете [Resource Groups - List](/rest/api/resources/resourcegroups/list) — вы получаете группы ресурсов, к которым у вас есть доступ, без указания на то, что результат может быть неполным. Если в списке подписки нет подписок, на доступ к которым у пользователя есть соответствующие права, ответ будет _403 (Forbidden)_ (запрещено).

> [!NOTE]
> В **предварительной версии** REST API `2020-04-01-preview` список подписок может отсутствовать.
> Если в запросе не определены оба свойства `subscriptions` и `managementGroupId`, арендатору задается _область_. Дополнительные сведения см. в разделе [Область запроса](./concepts/query-language.md#query-scope).

## <a name="throttling"></a>Регулирование

Так как Resource Graph — бесплатная служба, запросы можно регулировать, чтобы обеспечить лучшие возможности и время отклика для всех клиентов. Если организации нужно использовать API Resource Graph для крупномасштабных и частых запросов, оставьте отзыв в соответствующем разделе на [странице портала Resource Graph](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/ResourceGraph).
Предоставьте экономическое обоснование и установите флажок "Майкрософт может связаться с вами по электронной почте по поводу вашего отзыва", чтобы наша команда могла связаться с вами.

Resource Graph регулирует запросы на уровне пользователя. Ответ службы содержит следующие заголовки HTTP:

- `x-ms-user-quota-remaining` (целое число): оставшаяся квота ресурсов для пользователя. Это значение соответствует количеству запросов.
- `x-ms-user-quota-resets-after` (чч:мм:сс): время, оставшееся до сброса квоты потребления пользователя.

Дополнительные сведения см. в разделе [рекомендаций для регулируемых запросов](./concepts/guidance-for-throttled-requests.md).

## <a name="running-your-first-query"></a>Выполнение первого запроса

Обозреватель Azure Resource Graph — это компонент портала Azure, который позволяет выполнять запросы Resource Graph непосредственно на портале Azure. Закрепите результаты в виде динамических диаграмм, чтобы оперативно получать сведения, используемые в рабочем процессе портала. См. сведения об [отправке запросов с помощью обозревателя Azure Resource Graph](./first-query-portal.md).

Resource Graph поддерживает Azure CLI, Azure PowerShell, пакет SDK Azure для Python и другие средства. Запрос имеет одинаковую структуру для всех языков. Узнайте, как включить Resource Graph:

- [использование портала Azure и обозревателя Resource Graph](./first-query-portal.md) 
- [Azure CLI](./first-query-azurecli.md#add-the-resource-graph-extension)
- [Azure PowerShell](./first-query-powershell.md#add-the-resource-graph-module)
- [Python](./first-query-python.md#add-the-resource-graph-library)

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте больше о [языке запросов](./concepts/query-language.md).
- См. описание используемого языка в статье [Примеры запросов к Resource Graph для начинающих](./samples/starter.md).
- Описание расширенных вариантов использования см. в статье [Примеры расширенных запросов к Resource Graph](./samples/advanced.md).
