---
title: Начало работы с сертификатами Key Vault
description: Следующие сценарии описывают некоторые основные примеры использования службы управления сертификатами Key Vault, включая дополнительные действия, необходимые для создания первого сертификата в хранилище ключей.
services: key-vault
author: msmbaldwin
tags: azure-resource-manager
ms.service: key-vault
ms.subservice: certificates
ms.topic: conceptual
ms.date: 06/13/2020
ms.author: mbaldwin
ms.openlocfilehash: 9c1a08161dafa500e9cab2038621c2329cfe6d27
ms.sourcegitcommit: 7863fcea618b0342b7c91ae345aa099114205b03
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/03/2020
ms.locfileid: "93286887"
---
# <a name="get-started-with-key-vault-certificates"></a>Начало работы с сертификатами Key Vault
Следующие сценарии описывают некоторые основные примеры использования службы управления сертификатами Key Vault, включая дополнительные действия, необходимые для создания первого сертификата в хранилище ключей.

Ниже описано:
- Создание первого сертификата Key Vault
- Создание сертификата в центре сертификации (партнер Key Vault).
- Создание сертификата в центре сертификации (не партнер Key Vault).
- Импорт сертификата

## <a name="certificates-are-complex-objects"></a>Сертификаты — составные объекты
Сертификаты состоят из трех взаимосвязанных ресурсов: метаданные сертификата, ключ и секрет; связанных друг с другом в виде сертификата Key Vault.


![Сертификаты являются составными](../media/azure-key-vault.png)


## <a name="creating-your-first-key-vault-certificate"></a>Создание первого сертификата Key Vault  
 Перед созданием сертификата в Key Vault должны быть успешно выполнены обязательные шаги 1 и 2, а также должно существовать хранилище ключей для этого пользователя или организации.  

**Шаг 1** — поставщики центра сертификации (ЦС)  
-   Подключение ИТ-администратора, администратора PKI или любого управляющего учетными записями в центрах сертификации для данной компании (например, Contoso) является необходимым условием для использования сертификатов Key Vault.  
    Следующие центры сертификации — это текущие партнерские поставщики с Key Vault. Дополнительные сведения см. [здесь](./create-certificate.md#partnered-ca-providers).   
    -   DigiCert-Key Vault предлагает OV TLS/SSL-сертификаты с DigiCert.  
    -   Глобалсигн-Key Vault предлагает OV TLS/SSL-сертификаты с Глобалсигн.  

**Шаг 2** . Администратор учетной записи для поставщика ЦС создает учетные данные, которые используются Key Vault для регистрации, продления и использования сертификатов TLS/SSL с помощью Key Vault.

**Шаг 3** — администратор Contoso вместе с сотрудником Contoso (пользователь Key Vault), владеющим сертификатами, в зависимости от центра сертификации, может получить сертификат от администратора или непосредственно из учетной записи ЦС.  

- Начните операцию добавления учетных данных в хранилище ключей с [настройки ресурса издателя сертификата](/rest/api/keyvault/setcertificateissuer/setcertificateissuer). Издатель сертификата — это сущность, представленная в Azure Key Vault (KV) как ресурс CertificateIssuer. Она используется для предоставления сведений об источнике сертификата KV, имени издателя, поставщика, учетных данных и других административных сведений.
  - Например: MyDigiCertIssuer  
    -   Поставщик  
    -   Учетные данные — учетные данные учетной записи ЦС. Каждый ЦС имеет собственные данные.  

    Дополнительные сведения о создании учетных записей с помощью поставщиков ЦС см. в соответствующей записи [блога Key Vault](/archive/blogs/kv/manage-certificates-via-azure-key-vault).  

**Шаг 3,1** . Настройка [контактов сертификатов](/rest/api/keyvault/setcertificatecontacts/setcertificatecontacts) для уведомлений. Это контакт для пользователя Key Vault. Key Vault не требует этот шаг.  

Примечание. Этот процесс, шаг 3.1, — это разовая операция.  

## <a name="creating-a-certificate-with-a-ca-partnered-with-key-vault"></a>Создание сертификата в ЦС (партнер Key Vault)

![Создание сертификата с помощью партнерского центра сертификации Key Vault](../media/certificate-authority-2.png)

**Шаг 4** — следующие описания соответствуют шагам, обозначенным зеленым цветом на предыдущей схеме.  
  (1) — На приведенной выше схеме приложение создает сертификат, который начинает создание ключа в хранилище ключей.  
  (2) — Key Vault отправляет в ЦС запрос на сертификат TLS/SSL.  
  (3) — Приложение выполняет опрос (в процессе "цикл — ожидание") для Key Vault для завершения создания сертификата. Создание сертификата завершено, когда Key Vault получает от ЦС ответ с сертификатом x509.  
  (4) — центр сертификации отвечает на запрос сертификата TLS/SSL Key Vault с сертификатом X509 TLS/SSL.  
  (5) — Создание сертификата завершается слиянием сертификата X509 из ЦС.  

  Пользователь Key Vault создает сертификат согласно определенной политике.

  -   Повтор при необходимости.  
  -   Политика ограничений:  
      -   свойства X509;  
      -   свойства ключа;  
      -   ссылка на поставщика - > например, MyDigiCertIssure;  
      -   информация о продлении - > например, 90 дней до истечения срока действия.  

  - Процесс создания сертификата обычно асинхронный и включает опрос состояния операции создания сертификата в вашем хранилище ключей.  
[Получение операции с сертификатом](/rest/api/keyvault/getcertificateoperation/getcertificateoperation)  
      -   Состояние: выполнено, сбой с информацией об ошибке или отменено.  
      -   Из-за задержки создания может инициироваться операция отмены. Отмена может подействовать или нет.  

### <a name="network-security-and-access-policies-associated-with-integrated-ca"></a>Политики безопасности сети и доступа, связанные с интегрированным ЦС
Служба Key Vault отправляет запросы в центр сертификации (исходящий трафик). Таким образом, он полностью совместим с включенными в брандмауэре хранилищами ключей. Key Vault не использует политики доступа к ЦС. ЦС должен быть настроен на прием запросов на подписывание независимо друг от друга. [Инструкции по интеграции доверенного ЦС](./how-to-integrate-certificate-authority.md)

## <a name="import-a-certificate"></a>Импорт сертификата  
 Альтернативный вариант: сертификат можно импортировать в Key Vault в виде файла формата PFX или PEM.  

 Импорт сертификата требует наличия на диске файла формата PEM или PFX и закрытого ключа. 
-   Необходимо указать имя хранилища и сертификата (политика необязательна).

-   PEM- или PFX-файлы содержат атрибуты, которые Key Vault может анализировать и использовать для заполнения политики сертификата. Если политика сертификата уже определена, то Key Vault попытается сопоставить данные из PFX- или PEM-файла.  

-   После окончания импорта в последующих операциях будет использоваться новая политика (новые версии).  

-   Если нет дополнительных операций, Key Vault в первую очередь отправит предупреждение об истечении срока. 

-   Кроме того, пользователь может редактировать политику, которая работает во время импорта, но содержит значения по умолчанию там, где информацию не указали при импорте. Например: нет информации по издателю  

### <a name="formats-of-import-we-support"></a>Форматы поддерживаемых импортов
Azure Key Vault поддерживает файлы сертификатов PEM и PFX для импорта сертификатов в хранилище ключей.
Поддерживается следующий тип импорта для файлового формата PEM. Один сертификат в кодировке PEM вместе с незашифрованным ключом в кодировке PKCS # 8, который имеет следующий код:

-----НАЧАТЬ СЕРТИФИКАТ----------КОНЕЧНЫЙ СЕРТИФИКАТ-----

-----BEGIN ЗАКРЫТЫЙ КЛЮЧ----------КОНЕЧНЫЙ ЗАКРЫТЫЙ КЛЮЧ-----

При импорте сертификата необходимо убедиться, что ключ включен в сам файл. Если закрытый ключ имеется по отдельности в другом формате, необходимо объединить ключ с сертификатом. Некоторые центры сертификации предоставляют сертификаты в различных форматах, поэтому перед импортом сертификата убедитесь, что они находятся в формате PEM или PFX. 

### <a name="formats-of-merge-csr-we-support"></a>Форматы поддержки слияния CSR
AKV поддерживает два формата на основе PEM. Можно выполнить слияние одного сертификата в кодировке PKCS # 8 или типа, закодированного с помощью Base64 (цепочка сертификатов, подписанных ЦС). 

-----НАЧАТЬ СЕРТИФИКАТ----------КОНЕЧНЫЙ СЕРТИФИКАТ-----

Сейчас мы не поддерживаем ключи EC в формате PEM.

## <a name="creating-a-certificate-with-a-ca-not-partnered-with-key-vault"></a>Создание сертификата в ЦС (не партнер Key Vault)  
 Этот метод позволяет работать с ЦС, отличными от поставщиков, сотрудничающих с Key Vault. Это означает, что ваша организация может работать с ЦС по своему выбору.  

![Создание сертификата с помощью собственного центра сертификации](../media/certificate-authority-1.png)  

 Следующие описания соответствуют шагам, обозначенным зеленым цветом на предыдущей схеме.  

  (1) — На приведенной выше схеме приложение создает сертификат, который начинает создание ключа в хранилище ключей.  

  (2) — Key Vault возвращает приложению запрос на подпись сертификата (CSR).  

  (3) — Приложение передает CSR выбранному ЦС.  

  (4) — Выбранный ЦС отправляет сертификат X509.  

  (5) — Приложение завершает создание сертификата путем слияния сертификата X509 из ЦС.