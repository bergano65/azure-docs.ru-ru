---
title: Настройка отправки сообщений электронной почты об изменении состояния секретов в Key Vault
description: Инструкции по использованию Logic Apps для реагирования на изменения секретов в Key Vault
services: key-vault
author: msmbaldwin
manager: rkarlin
tags: azure-resource-manager
ms.service: key-vault
ms.topic: tutorial
ms.date: 11/11/2019
ms.author: mbaldwin
ms.openlocfilehash: 7ccc4aaed8e5827fbc06b252c8c88b814d9a31fb
ms.sourcegitcommit: 2d3740e2670ff193f3e031c1e22dcd9e072d3ad9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/16/2019
ms.locfileid: "74134001"
---
# <a name="use-logic-apps-to-receive-email-about-status-changes-of-key-vault-secrets"></a>Настройка отправки сообщений об изменении состояния секретов в хранилище ключей с помощью Logic Apps

В этом руководстве вы узнаете, как отвечать на события Azure Key Vault, получаемые через [Сетку событий Azure](../event-grid/index.yml), с помощью [Azure Logic Apps](../logic-apps/index.yml). По завершении работы с этим руководством у вас будет приложение логики Azure, настроенное на отправку уведомлений электронной почты каждый раз, когда в Azure Key Vault создается секрет.

Общие сведения об интеграции Azure Key Vault и службы "Сетка событий Azure" см. в статье [Tutorial: Monitoring Key Vault with Azure Event Grid (preview)](event-grid-overview.md) (Учебник по мониторингу Key Vault с помощью службы "Сетка событий Azure" (предварительная версия)).

## <a name="prerequisites"></a>Предварительные требования

- Учетная запись электронной почты любого поставщика услуг электронной почты, поддерживаемого Azure Logic Apps (например, Office 365 Outlook). Такая учетная запись используется для отправки уведомлений о событиях. Полный список поддерживаемых соединителей для приложения логики см. в статье [Соединители](/connectors).
- Подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.
- Хранилище ключей в подписке Azure. Вы можете быстро создать хранилище ключей, выполнив действия, описанные в статье [Краткое руководство. Настройка и получение секрета из Azure Key Vault с помощью Azure CLI](quick-create-cli.md).

## <a name="create-a-logic-app-via-event-grid"></a>Создание приложения логики с помощью службы "Сетка событий"

Сначала создайте приложение логики с обработчиком сетки событий и подпишитесь на события SecretNewVersionCreated Azure Key Vault.

Чтобы создать подписку на Сетку событий Azure, сделайте следующее:

1. Откройте портал Azure, используя следующую ссылку: https://portal.azure.com/?Microsoft_Azure_KeyVault_ShowEvents=true&Microsoft_Azure_EventGrid_publisherPreview=true 
1. На портале Azure перейдите в хранилище ключей, выберите **События > Приступая к работе** и щелкните **Logic Apps**.

    
    ![Хранилище ключей — страница событий](./media/eventgrid-logicapps-kvsubs.png)

1. В **конструкторе Logic Apps** проверьте подключение и нажмите кнопку **Продолжить**. 
 
    ![Конструктор Logic Apps — подключение](./media/eventgrid-logicappdesigner1.png)

1. В окне **При возникновении события ресурса** сделайте следующее:
    - Оставьте для полей **Подписка** и **Имя ресурса** значения по умолчанию.
    - Выберите **Microsoft.KeyVault.vaults** в качестве **типа ресурса**.
    - Выберите **Microsoft.KeyVault.SecretNewVersionCreated** в поле **Event Type Item** (Элемент типа события — 1).

    ![Конструктор Logic Apps — обработчик событий](./media/eventgrid-logicappdesigner2.png)

1. Выберите **+ Новый шаг**. Откроется окно "Выберите действие".
1. Введите в строку поиска **электронная почта**. Найдите и выберите соединитель, соответствующий поставщику услуг электронной почты. В этом руководстве используется **Office 365 Outlook**. Шаги для других поставщиков услуг электронной почты схожи.
1. Выберите действие **Отправка электронной почты (V2)** .

   ![Конструктор Logic Apps — добавление сообщения](./media/eventgrid-logicappdesigner3.png)

1. Создайте шаблон сообщения:
    - **Кому.** Введите адрес электронной почты для получения электронных уведомлений. Для работы с этим руководством выберите учетную запись электронной почты, которую можно использовать для тестирования.
    - **Тема** и **Текст**. Введите текст сообщения электронной почты. В инструменте выбора щелкните свойства JSON для включения динамического содержимого на основе данных событий. Данные события можно получить с помощью `@{triggerBody()?['Data']}`.

    Ваш шаблон сообщения может выглядеть следующим образом:

    ![Конструктор Logic Apps — добавление сообщения](./media/eventgrid-logicappdesigner4.png)

8. Щелкните **Сохранить как**.
9. Введите **имя** для нового приложения логики и щелкните **Создать**.
    
    ![Конструктор Logic Apps — добавление сообщения](./media/eventgrid-logicappdesigner5.png)

## <a name="test-and-verify"></a>Тестирование и проверка

1.  Перейдите в хранилище ключей на портале Azure и выберите **События > Подписки на события**.  Проверка создания новой подписки
    
    ![Конструктор Logic Apps — добавление сообщения](./media/eventgrid-logicapps-kvnewsubs.png)

1.  Перейдите в хранилище ключей, выберите **Секреты** и щелкните **+ Создать или импортировать**. Создайте секрет в целях тестирования, назовите ключ и оставьте для остальных параметров значения по умолчанию.

    ![Key Vault — создание секрета](./media/eventgrid-logicapps-kv-create-secret.png)

1. В окне **Создание секрета** укажите любое имя и значение и щелкните **Создать**.

При создании секрета по настроенным адресам будет отправлено сообщение электронной почты.

## <a name="next-steps"></a>Дополнительная информация

- Рассматриваемые действия: [Мониторинг Key Vault с помощью службы "Сетка событий Azure" (предварительная версия)](event-grid-overview.md)
- Практическое руководство: [Получение уведомлений хранилища ключей и реагирование на них с помощью Сетки событий Azure (предварительная версия)](event-grid-tutorial.md)
- [Схема событий службы "Сетка событий Azure" для Azure Key Vault (предварительная версия)](../event-grid/event-schema-key-vault.md)
- Дополнительные сведения о службе "Сетка событий" Azure см. [здесь](../event-grid/index.yml).
- Дополнительные сведения о компоненте Logic Apps службы приложений Azure см. [здесь](../logic-apps/index.yml).
