---
title: Подключение к Центрам событий Azure
description: Создание автоматизированных задач и рабочих процессов, отслеживающих события и управляющих ими с помощью концентраторов событий Azure и Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewer: logicappspm
ms.topic: conceptual
ms.date: 04/23/2019
tags: connectors
ms.openlocfilehash: 198a5da63ed90937c53f7f12f3559f15100e8f19
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "88031427"
---
# <a name="monitor-receive-and-send-events-with-azure-event-hubs-and-azure-logic-apps"></a>Мониторинг, получение и отправка событий с помощью Центров событий Azure и Azure Logic Apps

В этой статье показано, как можно отслеживать и управлять событиями, отправленными в [Центры событий Azure](../event-hubs/event-hubs-about.md) из внутреннего приложения логики при помощи соединителя Центров событий Azure. Таким образом, можно создать приложения логики, которые автоматизируют задачи и рабочие процессы для проверки, отправки и получения событий из концентратора событий. Технические сведения для конкретных соединителей см. в [справочнике по соединителю концентраторов событий Azure](/connectors/eventhubs/) </a> .

## <a name="prerequisites"></a>Предварительные требования

* Учетная запись и подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/). 

* [Пространство имен концентраторов событий Azure и концентратор событий](../event-hubs/event-hubs-create.md)

* Приложение логики, из которого необходимо получить доступ к концентратору событий. Чтобы запустить приложение логики с помощью триггера концентраторов событий Azure, требуется [пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).
Если вы не знакомы с приложениями логики, ознакомьтесь со статьями [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md) и [Краткое руководство. Создание первого автоматизированного рабочего процесса с помощью Azure Logic Apps на портале Azure](../logic-apps/quickstart-create-first-logic-app-workflow.md).

<a name="permissions-connection-string"></a>

## <a name="check-permissions-and-get-connection-string"></a>Проверка разрешений и получение строки подключения

Чтобы обеспечить доступ приложения логики к концентратору событий, проверьте разрешения и получите строку подключения для пространства имен концентраторов событий.

1. Войдите на [портал Azure](https://portal.azure.com).

1. Перейдите к *пространству имен* Центров событий (но не к конкретному концентратору событий). 

1. В меню пространство имен в разделе **Параметры**выберите **политики общего доступа**. В разделе **Утверждения** убедитесь, что у вас есть разрешения на **управление** для этого пространства имен.

   ![Управление разрешениями для пространства имен концентраторов событий](./media/connectors-create-api-azure-event-hubs/event-hubs-namespace.png)

1. Если вы хотите в дальнейшем вручную ввести сведения о подключении, получите строку подключения для пространства имен Центров событий.

   1. В разделе **Политика** выберите **RootManageSharedAccessKey**.

   1. Найдите строку подключения первичного ключа. Нажмите кнопку "Копировать" и сохраните строку подключения для последующего использования.

      ![Скопируйте строку подключения к пространству имен Центров событий](media/connectors-create-api-azure-event-hubs/find-event-hub-namespace-connection-string.png)

      > [!TIP]
      > Чтобы проверить, относится ли строка подключения к пространству имен Центров событий или к определенному концентратору событий, убедитесь, что она не содержит параметр `EntityPath` . Если в строке подключения есть этот параметр, значит она относится к определенной "сущности" концентратора событий и ее нельзя использовать в приложении логики.

1. Теперь продолжайте дальше, используя варианты [Add an Event Hubs trigger](#add-trigger) (Добавить триггер Центров событий) или [Add an Event Hubs action](#add-action) (Добавить действие Центров событий).

<a name="add-trigger"></a>

## <a name="add-event-hubs-trigger"></a>Добавление триггера Центров событий

В Azure Logic Apps каждое приложение логики должно запускаться по [триггеру](../logic-apps/logic-apps-overview.md#logic-app-concepts), который активируется, когда происходит определенное событие или если выполняются заданные условия. При каждом срабатывании триггера обработчик Logic Apps создает экземпляр приложения логики, запускающий рабочий процесс.

В этом примере показано, как запустить рабочий процесс приложения логики, когда новые события отправляются в концентратор событий. 

> [!NOTE]
> Все триггеры концентратора событий являются триггерами с *длительным опросом* . Это означает, что триггер обрабатывает все события, а затем ожидает 30 секунд на секцию, чтобы больше событий отображалось в концентраторе событий. Таким образом, если для триггера настроено четыре секции, эта задержка может занять до двух минут, прежде чем триггер завершит опрос всех секций. Если в течение этой задержки не получены никакие события, запуск триггера пропускается. В противном случае триггер продолжит считывать события до момента, пока концентратор событий не останется пустым. Следующий опрос триггера происходит на основе интервала повторения, указанного в свойствах триггера.

1. На портале Azure или в Visual Studio создайте пустое приложение логики. Откроется конструктор Logic Apps. В этом примере используется портал Azure.

1. В поле поиска в качестве фильтра введите "Центры событий". В списке триггеры выберите этот триггер: **когда события доступны в концентраторе событий — концентраторы событий**

   ![Выбор триггера](./media/connectors-create-api-azure-event-hubs/find-event-hubs-trigger.png)

1. Если вам будет предложено ввести сведения о подключении, [создайте подключение к Центрам событий](#create-connection). 

1. В триггере укажите сведения о концентраторе событий, который требуется отслеживать. Для получения дополнительных свойств откройте список **Добавить новый параметр** . Выбор параметра приводит к добавлению этого свойства на карточку триггера.

   ![Свойства триггера](./media/connectors-create-api-azure-event-hubs/event-hubs-trigger.png)

   | Свойство | Обязательно | Описание |
   |----------|----------|-------------|
   | **Имя концентратора событий** | Да | Имя концентратора событий, который требуется отслеживать |
   | **Тип содержимого** | Нет | Тип содержимого события. Значение по умолчанию — `application/octet-stream`. |
   | **Имя группы потребителей** | Нет | [Имя группы потребителей концентратора событий](../event-hubs/event-hubs-features.md#consumer-groups) , используемое для чтения событий. Если оно не задано, используется группа потребителей по умолчанию. |
   | **Maximum events count (Счетчик максимального количества событий)** | Нет | Максимальное число событий. Триггер возвращает значение от 1 до количества событий, заданного в этом свойстве. |
   | **Интервал** | Да | Положительное целое число, описывающее частоту выполнения рабочего процесса в зависимости от частоты. |
   | **Частота** | Да | Единица времени для повторения |
   ||||

   **Дополнительные свойства**

   | Свойство | Обязательно | Описание |
   |----------|----------|-------------|
   | **Схема содержимого** | Нет | Схема содержимого JSON для событий, считываемых из концентратора событий. Например, если указать схему содержимого, приложение логики можно запустить только для тех событий, которые соответствуют схеме. |
   | **Minimum partition key (Минимальное количество ключей секций)** | Нет | Введите минимальное количество идентификаторов [секций](../event-hubs/event-hubs-features.md#partitions) для считывания. По умолчанию считываются все секции. |
   | **Maximum partition key (Максимальное количество ключей секций)** | Нет | Введите максимальное количество идентификаторов [секций](../event-hubs/event-hubs-features.md#partitions) для считывания. По умолчанию считываются все секции. |
   | **Часовой пояс** | Нет | Применяется только при указании времени начала, так как этот триггер не принимает смещение от UTC. Выберите часовой пояс, который необходимо применить. <p>Дополнительные сведения см. [в статье Создание и запуск повторяющихся задач и рабочих процессов с помощью Azure Logic Apps](../connectors/connectors-native-recurrence.md). |
   | **Время начала** | Нет | Укажите время начала в следующем формате: <p>ГГГГ-ММ-ДДTчч:мм:сс, если выбран часовой пояс<p>-или-<p>ГГГГ-ММ-ДДTчч:мм:ссZ, если часовой пояс не выбран.<p>Дополнительные сведения см. [в статье Создание и запуск повторяющихся задач и рабочих процессов с помощью Azure Logic Apps](../connectors/connectors-native-recurrence.md). |
   ||||

1. Завершив работу, нажмите кнопку **Сохранить** на панели инструментов конструктора.

1. Теперь продолжайте добавлять действия в приложение логики для задач, которые необходимо выполнить с результатами триггера. 

   Например, чтобы отфильтровать события по определенному значению, например по категории, можно добавить условие, чтобы действие **отправки события** отправляло только те события, которые соответствуют условию. 

<a name="add-action"></a>

## <a name="add-event-hubs-action"></a>Добавление действия Центров событий

В Azure Logic Apps [действие](../logic-apps/logic-apps-overview.md#logic-app-concepts) — это шаг в рамках рабочего процесса, выполняемый после срабатывания триггера или другого действия. В этом примере приложение логики запускается с помощью триггера Центров событий, который проверяет наличие новых событий в концентраторе событий.

1. На портале Azure или в Visual Studio откройте приложение логики в конструкторе Logic Apps. В этом примере используется портал Azure.

1. В разделе триггер или действие выберите **новый шаг**.

   Чтобы добавить действие между существующими шагами, наведите указатель мыши на соединяющую стрелку. 
   Выберите появившийся знак "плюс" ( **+** ), а затем щелкните **Добавить действие**.

1. В поле поиска в качестве фильтра введите "Центры событий".
В списке действия выберите это действие: **Отправить событие — концентраторы событий** .

   ![Выбор действия "Отправить событие"](./media/connectors-create-api-azure-event-hubs/find-event-hubs-action.png)

1. Если вам будет предложено ввести сведения о подключении, [создайте подключение к Центрам событий](#create-connection). 

1. В действии укажите сведения о событиях, которые необходимо отправить. Для получения дополнительных свойств откройте список **Добавить новый параметр** . При выборе параметра это свойство добавляется на карточку действия.

   ![Выбор имени концентратора событий и указание содержимого события](./media/connectors-create-api-azure-event-hubs/event-hubs-send-event-action.png)

   | Свойство | Обязательно | Описание |
   |----------|----------|-------------|
   | **Имя концентратора событий** | Да | Концентратор событий, в который нужно отправить событие. |
   | **Содержимое** | Нет | Содержимое для события, которое необходимо отправить |
   | **Свойства** | Нет | Свойства приложения и значения для отправки |
   | **Ключ секции** | Нет | Идентификатор [Секции](../event-hubs/event-hubs-features.md#partitions) для отправки события |
   ||||

   Например, вы можете отправить выходные данные из триггера концентраторов событий в другой концентратор событий:

   ![Пример события Send](./media/connectors-create-api-azure-event-hubs/event-hubs-send-event-action-example.png)

1. Завершив работу, нажмите кнопку **Сохранить** на панели инструментов конструктора.

<a name="create-connection"></a>

## <a name="connect-to-your-event-hub"></a>Подключение к концентратору событий

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)] 

1. Когда вам будет предложено ввести информацию о соединении, укажите следующие сведения.

   | Свойство | Обязательно | Значение | Описание |
   |----------|----------|-------|-------------|
   | **Имя соединения** | Да | <*имя соединения*> | Имя создаваемого подключения |
   | **Пространство имен концентраторов событий** | Да | <*Событие-концентраторы — пространство имен*> | Выберите пространство имен Центров событий, которые необходимо использовать. |
   |||||  

   Пример:

   ![Создание подключения концентратора событий](./media/connectors-create-api-azure-event-hubs/create-event-hubs-connection-1.png)

   Чтобы вручную ввести строку подключения, выберите **вручную ввести сведения о подключении**. 
   Сведения о том, как найти строку подключения, см. в разделе [Проверка разрешений для пространства имен концентраторов событий и определение строки подключения](#permissions-connection-string).

2. Выберите нужную политику Центров событий, если она еще не выбрана. Выберите **Создать**.

   ![Создание подключения концентратора событий, часть 2](./media/connectors-create-api-azure-event-hubs/create-event-hubs-connection-2.png)

3. После создания подключения перейдите к [Add an Event Hubs trigger](#add-trigger) (Добавить триггер Центров событий) или [Add an Event Hubs action](#add-action) (Добавить действие Центров событий).

## <a name="connector-reference"></a>Справочник по соединителям

См. дополнительные технические сведения о [триггерах, действиях и ограничениях, описываемых файлом Swagger соединителя](/connectors/eventhubs/).

> [!NOTE]
> Для приложений логики в [среде службы интеграции (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md)эта версия этого соединителя использует [ограничения сообщений интегрированной](../logic-apps/logic-apps-limits-and-config.md#message-size-limits) среды сценариев.

## <a name="next-steps"></a>Дальнейшие действия

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).
