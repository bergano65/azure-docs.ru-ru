---
title: Подключение к FTP-серверу
description: Автоматизируйте задачи и рабочие процессы, которые создают, отслеживают и управляют файлами на FTP-сервере с помощью Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewer: klam, logicappspm
ms.topic: conceptual
ms.date: 12/15/2019
tags: connectors
ms.openlocfilehash: 5b61b51e79c71736e18aaa63ab032c05c512c8d7
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80656335"
---
# <a name="create-monitor-and-manage-ftp-files-by-using-azure-logic-apps"></a>Создание и отслеживание FTP-файлов, а также управление ими с помощью Azure Logic Apps

С помощью Azure Logic Apps и соединителя FTP можно создать автоматизированные задачи и рабочие процессы, которые создают, отслеживают, отправляют и получают файлы, а также управляют ими в вашей учетной записи, на сервере FTP. Они также выполняют и другие действия, например:

* мониторинг добавления или изменения файлов;
* получение, создание, копирование, перечисление, обновление и удаление файлов;
* получение содержимого и метаданных файлов;
* извлечение архивов в папки.

Вы можете использовать триггеры, которые получают ответы из сервера FTP и делают выходные данные доступными для других действий. Вы можете использовать действия запуска в своих приложениях логики для управления файлами на сервере FTP. Кроме того, выходные данные от действий FTP могут использоваться другими действиями. Например, если вы регулярно извлекаете файлы с сервера FTP, вы можете отправлять сообщения об этих файлах и их содержимое с помощью соединителя Office 365 Outlook или соединителя Outlook.com. Если вы не знакомы с приложениями логики, ознакомьтесь со статьей [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md).

## <a name="limitations"></a>Ограничения

* Соединитель FTP поддерживает только явный FTP через TLS/SSL (FTPS) и не совместим с неявным FTPS.

* По умолчанию действия FTP могут считывать или записывать файлы размером *50 МБ или меньше*. Для работы с файлами, размер которых превышает 50 МБ, действия FTP поддерживают [фрагментацию сообщений](../logic-apps/logic-apps-handle-large-messages.md). Действие **получить содержимое файла** неявно использует фрагментацию.

* Триггеры FTP не поддерживают фрагментацию. При запросе содержимого файла триггеры выбирают только файлы размером 50 МБ или меньше. Чтобы получить файлы размером более 50 МБ, следуйте приведенному ниже шаблону:

  * Используйте триггер FTP, возвращающий свойства файла, например **при добавлении или изменении файла (только свойства)**.

  * Выполните триггер с действием FTP **Get File Content** , которое считывает полный файл и неявно использует фрагментацию.

* Если у вас есть локальный FTP-сервер, рассмотрите возможность создания [среды службы интеграции (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md) или использования [гибридных подключений службы приложений Azure](../app-service/app-service-hybrid-connections.md), которые позволяют получать доступ к локальным источникам данных без использования локального шлюза данных.

## <a name="how-ftp-triggers-work"></a>Как работают триггеры FTP

Триггеры FTP работают путем опроса файловой системы FTP и поиска файла, который был изменен с момента последнего опроса. При изменении файлов некоторые средства позволяют сохранить метку времени. В этом случае необходимо отключить эту функцию, чтобы триггер мог работать. Ниже приведены некоторые распространенные параметры:

| Клиент SFTP | Действие |
|-------------|--------|
| Winscp | Последовательно выберите **пункты Параметры** > **предпочтения** > **Перенос** > **изменить** > **сохранить метку** > **отключать** . |
| FileZilla | Переход к **передаче** > **сохранять метки времени для перенесенных файлов** > **Отключить** |
|||

Найдя новый файл, триггер проверяет, записан ли файл полностью, а не частично. Например, во время проверки файлового сервера триггером в файл могут вноситься изменения. Чтобы избежать возврата частично записанного файла, триггер отмечает метку времени для файла с последними изменениями и не возвращает его сразу. Он возвращает его только при повторном опросе сервера. Иногда такое поведение может вызвать задержку, которая удваивает интервал опроса триггера.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* Адрес сервера узла FTP и учетные данные учетной записи

  Для соединителя FTP требуется доступный через Интернет FTP-сервер, который настроен для работы в *пассивном режиме*. Ваши учетные данные позволяют приложению логики создавать подключение и предоставлять доступ к вашей учетной записи FTP.

* Основные сведения о [создании приложений логики](../logic-apps/quickstart-create-first-logic-app-workflow.md)

* Приложение логики, из которого необходимо получить доступ к учетной записи FTP. Чтобы начать работу с триггером FTP, [создайте пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md). Чтобы использовать действие FTP, запустите приложение логики с другим триггером, например триггером **Периодичность**.

## <a name="connect-to-ftp"></a>Подключение к FTP

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

1. Войдите в [портал Azure](https://portal.azure.com)и откройте приложение логики в конструкторе приложений логики.

1. Для пустых приложений логики в поле поиска введите `ftp` фильтр. В списке **триггеры** выберите нужный триггер.

   -или-

   Для существующих приложений логики на последнем шаге, где нужно добавить действие, выберите **новый шаг**, а затем щелкните **Добавить действие**. В поле поиска введите `ftp` в качестве фильтра. В списке **действия** выберите нужное действие.

   Чтобы добавить действие между шагами, переместите указатель на стрелку между шагами. Выберите отображаемый знак плюса (**+**), а затем щелкните **Добавить действие**.

1. Укажите сведения о подключении и щелкните **создать**.

1. Укажите сведения для выбранного триггера или действия и продолжайте создавать рабочий процесс приложения логики.

## <a name="examples"></a>Примеры

<a name="file-added-modified"></a>

### <a name="add-ftp-trigger"></a>Добавление триггера FTP

Триггер **при добавлении или изменении файла (только свойства)** запускает рабочий процесс приложения логики, когда триггер обнаруживает, что файл добавлен или изменен на FTP-сервере. Например, можно добавить условие, которое проверяет содержимое файла и принимает решение, следует ли получать это содержимое в зависимости от того, соответствует ли это содержимое заданному условию. Наконец, можно добавить действие, которое получает содержимое файла и поместить его в другую папку на SFTP-сервере.

Например, с помощью этого триггера можно отслеживать папку FTP для новых файлов, описывающих заказы клиентов. Затем можно использовать действие FTP, такое как **Получение метаданных файла** , чтобы получить свойства для нового файла, а затем использовать команду **получить содержимое файла** для получения содержимого из этого файла для дальнейшей обработки и сохранения этого порядка в базе данных Orders.

Ниже приведен пример использования триггера **при добавлении или изменении файла (только свойства)** .

1. Войдите на [портал Azure](https://portal.azure.com) и откройте свое приложение логики в конструкторе приложений логики, если оно еще не открыто.

1. Для пустых приложений логики в поле поиска введите `ftp` фильтр. В списке триггеры выберите этот триггер: **при добавлении или изменении архивирования (только свойства)** .

   ![Поиск и выбор триггера FTP](./media/connectors-create-api-ftp/select-ftp-trigger-logic-app.png)

1. Укажите необходимые сведения для подключения и нажмите кнопку **создать**.

   По умолчанию этот соединитель передает файлы в текстовом формате. Для передачи файлов в двоичном формате, например, когда и где используется кодирование, выберите **Binary Transport** (Двоичная транспортировка).

   ![Создание подключения к FTP-серверу](./media/connectors-create-api-ftp/create-ftp-connection-trigger.png)

1. В поле **Папка** выберите значок папки, чтобы появился список. Чтобы найти папку, которую необходимо отслеживать для новых или измененных файлов, выберите правую стрелку угла (**>**), перейдите к этой папке, а затем выберите папку.

   ![Найдите и выберите папку для отслеживания](./media/connectors-create-api-ftp/select-folder-ftp-trigger.png)

   Выбранная папка отображается в поле **Folder**.

   ![Выбранная папка отображается в свойстве "папка"](./media/connectors-create-api-ftp/selected-folder-ftp-trigger.png)

1. Сохраните приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

После того как логическое приложение получило триггер, добавьте действия, которые необходимо запустить, когда логическое приложение находит новый или отредактированный файл. В этом примере вы можете добавить действие FTP, которое получает новое или обновленное содержимое.

<a name="get-content"></a>

### <a name="add-ftp-action"></a>Добавление действия FTP

Действие **получить метаданные файла** Возвращает свойства файла, расположенного на FTP-сервере, и действие **получить содержимое** файла получает содержимое файла на основе сведений об этом файле на FTP-сервере. Например, можно добавить триггер из предыдущего примера и эти действия, чтобы получить содержимое файла после добавления или изменения файла.

1. Под триггером или любыми другими действиями выберите **новый шаг**.

1. В поле поиска введите `ftp` в качестве фильтра. В списке действия выберите это действие: **получить метаданные файла** .

   ![Выберите действие "получить метаданные файла"](./media/connectors-create-api-ftp/select-get-file-metadata-ftp-action.png)

1. Если у вас уже есть соединение с вашим FTP-сервером и учетной записью, перейдите к следующему шагу. В противном случае укажите необходимые сведения для этого подключения и нажмите кнопку **создать**.

   ![Создание подключения к FTP-серверу](./media/connectors-create-api-ftp/create-ftp-connection-action.png)

1. После того как появится действие **получить метаданные файла** , щелкните внутри поля **файла** , чтобы появился список динамического содержимого. Теперь можно выбрать свойства для выходных данных из предыдущих шагов. В списке динамическое содержимое в разделе **Получение метаданных файла**выберите свойство **List of Files ID** , которое ссылается на коллекцию, в которую был добавлен или обновлен файл.

   ![Найдите и выберите свойство "список идентификаторов файлов"](./media/connectors-create-api-ftp/select-list-of-files-id-output.png)

   В поле **файл** теперь появится свойство **список идентификаторов файлов** .

   ![Выбрано свойство "список идентификаторов файлов"](./media/connectors-create-api-ftp/selected-list-file-ids-ftp-action.png)

1. Теперь добавьте это действие FTP: **Получение содержимого файла**

   ![Найдите и выберите действие "получить содержимое файла".](./media/connectors-create-api-ftp/select-get-file-content-ftp-action.png)

1. После отображения действия **получить содержимое файла** щелкните внутри поля **файла** , чтобы появился список динамического содержимого. Теперь можно выбрать свойства для выходных данных из предыдущих шагов. В списке динамическое содержимое в разделе **Получение метаданных файла**выберите свойство **ID** , которое ссылается на добавленный или обновленный файл.

   ![Поиск и выбор свойства "ID"](./media/connectors-create-api-ftp/get-file-content-id-output.png)

   Свойство **ID** теперь отображается в поле **файл** .

   ![Выбрано свойство "ID"](./media/connectors-create-api-ftp/selected-get-file-content-id-ftp-action.png)

1. Сохраните приложение логики.

## <a name="test-your-logic-app"></a>Тестирование приложения логики

Чтобы убедиться, что рабочий процесс возвращает предполагаемое содержимое, добавьте другое действие, которое отправляет содержимое из отправленного или обновленного файла.

1. В разделе действие " **получить содержимое файла** " добавьте действие, которое может отправить содержимое файла. В этом примере добавляется действие **Отправить сообщение электронной почты** для Office 365 Outlook.

   ![Добавление действия для отправки электронной почты](./media/connectors-create-api-ftp/select-send-email-action.png)

1. После появления действия укажите сведения и укажите свойства, которые требуется протестировать. Например, включите свойство **содержимое файла** , которое отображается в списке динамическое содержимое **после выбора в разделе** **получить содержимое файла** .

   ![Предоставление сведений о действии электронной почты](./media/connectors-create-api-ftp/selected-send-email-action.png)

1. Сохраните приложение логики. Чтобы запустить и активировать приложение логики, на панели инструментов выберите **выполнить**, а затем добавьте файл в папку FTP, которую теперь отслеживает приложение логики.

## <a name="connector-reference"></a>Справочник по соединителям

Дополнительные технические сведения об этом соединителе, такие как триггеры, действия и ограничения, описанные в файле Swagger соединителя, см. на [странице справочника по соединителю](https://docs.microsoft.com/connectors/ftpconnector/).

> [!NOTE]
> Для приложений логики в [среде службы интеграции (ISE)](../logic-apps/connect-virtual-network-vnet-isolated-environment-overview.md)эта версия этого соединителя использует [ограничения сообщений интегрированной](../logic-apps/logic-apps-limits-and-config.md#message-size-limits) среды сценариев.

## <a name="next-steps"></a>Дальнейшие шаги

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).
