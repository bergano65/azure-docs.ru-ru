---
title: Вызов конечных точек службы с помощью HTTP или HTTPS
description: Отправка исходящих запросов HTTP или HTTPS в конечные точки службы из Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewer: jonfan, logicappspm
ms.topic: conceptual
ms.date: 09/14/2020
tags: connectors
ms.openlocfilehash: f005bdfa5643ea187fb2973cac065563c4cc2ee6
ms.sourcegitcommit: 32c521a2ef396d121e71ba682e098092ac673b30
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2020
ms.locfileid: "91292461"
---
# <a name="call-service-endpoints-over-http-or-https-from-azure-logic-apps"></a>Вызов конечных точек службы по HTTP или HTTPS из Azure Logic Apps

С помощью [Azure Logic Apps](../logic-apps/logic-apps-overview.md) и встроенного триггера HTTP или действия можно создавать автоматизированные задачи и рабочие процессы, которые могут отсылать исходящие запросы к конечным точкам в других службах и системах по протоколу HTTP или HTTPS. Для получения и реагирования на входящие вызовы HTTPS следует использовать встроенный [триггер запроса и действие ответа](../connectors/connectors-native-reqres.md).

Например, можно отслеживать конечную точку службы для веб-сайта, проверяя эту конечную точку по определенному расписанию. Когда указанное событие происходит в этой конечной точке, например веб-сайт переключается, событие запускает рабочий процесс приложения логики и выполняет действия в этом рабочем процессе.

* Чтобы проверить или *опросить* конечную точку по повторяющемуся расписанию, [добавьте триггер HTTP](#http-trigger) в качестве первого шага в рабочем процессе. Каждый раз, когда триггер проверяет конечную точку, триггер вызывает или отправляет *запрос* в конечную точку. Ответ от конечной точки определяет, выполняется ли рабочий процесс приложения логики. Триггер передает любое содержимое из ответа конечной точки в действия в приложении логики.

* Чтобы вызвать конечную точку из любого места в рабочем процессе, [добавьте действие HTTP](#http-action). Ответ от конечной точки определяет, как выполнить оставшиеся действия рабочего процесса.

В этой статье показано, как использовать триггер HTTP и действие HTTP, чтобы приложение логики отправляло исходящие вызовы другим службам и системам.

Сведения о шифровании, безопасности и авторизации исходящих вызовов из приложения логики, таких как [протокол TLS](https://en.wikipedia.org/wiki/Transport_Layer_Security), ранее известные как SSL (SSL), самозаверяющие сертификаты или [Azure Active Directory открытой проверки подлинности (Azure AD OAuth)](../active-directory/develop/index.yml), см. [в разделе безопасный доступ и доступ к данным для исходящих вызовов других служб и систем](../logic-apps/logic-apps-securing-a-logic-app.md#secure-outbound-requests).

## <a name="prerequisites"></a>Предварительные требования

* Учетная запись и подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* URL-адрес целевой конечной точки, которую необходимо вызвать

* Базовые знания о [создании приложений логики](../logic-apps/quickstart-create-first-logic-app-workflow.md). Если вы не знакомы с приложениями логики, ознакомьтесь с [Azure Logic Apps](../logic-apps/logic-apps-overview.md)?

* Приложение логики, из которого вы хотите вызвать целевую конечную точку. Чтобы начать с триггера HTTP, [создайте пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md). Чтобы использовать действие HTTP, запустите приложение логики с любым нужным триггером. В этом примере в качестве первого шага используется триггер HTTP.

<a name="http-trigger"></a>

## <a name="add-an-http-trigger"></a>Добавление триггера HTTP

Этот встроенный триггер выполняет HTTP-вызов по указанному URL-адресу для конечной точки и возвращает ответ.

1. Войдите на [портал Azure](https://portal.azure.com). Откройте свое пустое приложение логики в конструкторе приложений логики.

1. В поле поиска конструктора выберите **встроенный**. В поле поиска введите `http` в качестве фильтра. В списке **триггеры** Выберите триггер **http** .

   ![Выбор триггера HTTP](./media/connectors-native-http/select-http-trigger.png)

   В этом примере триггер переименовывается в "HTTP Trigger", чтобы у шага было более описательное имя. Кроме того, в примере далее добавляется действие HTTP, и оба имени должны быть уникальными.

1. Укажите значения [параметров триггера HTTP](../logic-apps/logic-apps-workflow-actions-triggers.md#http-trigger) , которые необходимо включить в вызов целевой конечной точки. Настройте периодичность, с которой триггер должен проверять целевую конечную точку.

   ![Ввод параметров триггера HTTP](./media/connectors-native-http/http-trigger-parameters.png)

   Если выбран тип проверки подлинности, отличный от **None**, параметры проверки подлинности будут отличаться в зависимости от выбранного. Дополнительные сведения о типах проверки подлинности, доступных для HTTP, см. в следующих разделах:

   * [Добавление проверки подлинности в исходящие вызовы](../logic-apps/logic-apps-securing-a-logic-app.md#add-authentication-outbound)
   * [Проверка подлинности доступа к ресурсам с помощью управляемых удостоверений](../logic-apps/create-managed-service-identity.md)

1. Чтобы добавить другие доступные параметры, откройте список **Добавить новый параметр** и выберите нужные параметры.

1. Продолжите создание рабочего процесса приложения логики с действиями, выполняемыми при срабатывании триггера.

1. Когда все будет готово, не забудьте сохранить приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

<a name="http-action"></a>

## <a name="add-an-http-action"></a>Добавление действия HTTP

Это встроенное действие выполняет HTTP-вызов по указанному URL-адресу для конечной точки и возвращает ответ.

1. Войдите на [портал Azure](https://portal.azure.com). Создание приложения логики в Конструкторе приложений логики.

   В этом примере в качестве первого шага используется триггер HTTP.

1. На шаге, куда нужно добавить действие HTTP, выберите **новый шаг**.

   Чтобы добавить действие между шагами, переместите указатель на стрелку между шагами. Нажмите появившийся знак "плюс" ( **+** ), а затем выберите **Добавить действие**.

1. В разделе **Выберите действие** выберите **Встроенный**. В поле поиска введите `http` в качестве фильтра. В списке **действия** выберите действие **http** .

   ![Выбор действия HTTP](./media/connectors-native-http/select-http-action.png)

   В этом примере действие переименовывается в "действие HTTP", чтобы у шага было более описательное имя.

1. Укажите значения [параметров HTTP-действия](../logic-apps/logic-apps-workflow-actions-triggers.md#http-action) , которые необходимо включить в вызов целевой конечной точки.

   ![Ввод параметров для действия HTTP](./media/connectors-native-http/http-action-parameters.png)

   Если выбран тип проверки подлинности, отличный от **None**, параметры проверки подлинности будут отличаться в зависимости от выбранного. Дополнительные сведения о типах проверки подлинности, доступных для HTTP, см. в следующих разделах:

   * [Добавление проверки подлинности в исходящие вызовы](../logic-apps/logic-apps-securing-a-logic-app.md#add-authentication-outbound)
   * [Проверка подлинности доступа к ресурсам с помощью управляемых удостоверений](../logic-apps/create-managed-service-identity.md)

1. Чтобы добавить другие доступные параметры, откройте список **Добавить новый параметр** и выберите нужные параметры.

1. Когда все будет готово, не забудьте сохранить приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

## <a name="trigger-and-action-outputs"></a>Выходные данные триггера и действия

Ниже приведены дополнительные сведения о выходных данных триггера или действия HTTP, которые возвращают эти сведения:

| Свойство | Тип | Описание |
|----------|------|-------------|
| `headers` | Объект JSON | Заголовки из запроса |
| `body` | Объект JSON | Объект с содержимым текста из запроса |
| `status code` | Целое число | Код состояния из запроса |
|||

| Код состояния | Описание |
|-------------|-------------|
| 200 | OK |
| 202 | Принято |
| 400 | Недопустимый запрос |
| 401 | Не авторизовано |
| 403 | Запрещено |
| 404 | Не найдено |
| 500 | Внутренняя ошибка сервера. Произошла неизвестная ошибка. |
|||

## <a name="content-with-multipartform-data-type"></a>Содержимое с типом данных multipart/form-data

Для обработки содержимого, которое имеет `multipart/form-data` тип в HTTP-запросах, можно добавить объект JSON, включающий `$content-type` атрибуты и, `$multipart` в текст HTTP-запроса, используя этот формат.

```json
"body": {
   "$content-type": "multipart/form-data",
   "$multipart": [
      {
         "body": "<output-from-trigger-or-previous-action>",
         "headers": {
            "Content-Disposition": "form-data; name=file; filename=<file-name>"
         }
      }
   ]
}
```

Например, предположим, что у вас есть приложение логики, которое отправляет запрос HTTP POST для файла Excel на веб-сайт с помощью API этого сайта, который поддерживает этот `multipart/form-data` тип. Вот как может выглядеть это действие:

![Составные данные форм](./media/connectors-native-http/http-action-multipart.png)

Ниже приведен тот же пример, в котором показано определение JSON действия HTTP в базовом определении рабочего процесса:

```json
"HTTP_action": {
   "inputs": {
      "body": {
         "$content-type": "multipart/form-data",
         "$multipart": [
            {
               "body": "@trigger()",
               "headers": {
                  "Content-Disposition": "form-data; name=file; filename=myExcelFile.xlsx"
               }
            }
         ]
      },
      "method": "POST",
      "uri": "https://finance.contoso.com"
   },
   "runAfter": {},
   "type": "Http"
}
```

## <a name="content-with-applicationx-www-form-urlencoded-type"></a>Содержимое с типом приложения/x-www-Form-UrlEncoded

Чтобы предоставить данные формы-UrlEncoded в тексте для HTTP-запроса, необходимо указать, что данные имеют `application/x-www-form-urlencoded` тип содержимого. В триггере или действии HTTP добавьте `content-type` заголовок. Задайте для заголовка значение `application/x-www-form-urlencoded` .

Например, предположим, что у вас есть приложение логики, которое отправляет запрос HTTP POST на веб-сайт, поддерживающий этот `application/x-www-form-urlencoded` тип. Вот как может выглядеть это действие:

![Снимок экрана, на котором показан HTTP-запрос с заголовком Content-Type, установленным в "Application/x-www-Form-UrlEncoded"](./media/connectors-native-http/http-action-urlencoded.png)

<a name="asynchronous-pattern"></a>

## <a name="asynchronous-request-response-behavior"></a>Асинхронное поведение запроса и ответа

По умолчанию все действия на основе HTTP в Azure Logic Apps соответствуют стандартному [шаблону асинхронной операции](/azure/architecture/patterns/async-request-reply). Этот шаблон указывает, что после того, как действие HTTP вызовет или отправляет запрос в конечную точку, службу, систему или API, получатель немедленно возвращает ответ ["202](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.2.3) Accepted" (принято). Этот код подтверждает, что получатель принял запрос, но еще не завершил обработку. Ответ может включать `location` заголовок, указывающий URL-адрес и идентификатор обновления, который вызывающий может использовать для опроса или проверки состояния асинхронного запроса до тех пор, пока получатель не прекратит обработку и не вернет сообщение об успешном завершении ["200 ОК"](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.2.1) или другой ответ, отличный от 202. Однако вызывающему объекту не нужно ждать завершения обработки запроса и продолжить выполнение следующего действия. Дополнительные сведения см. в разделе [асинхронная интеграция микрослужб применяет автономность микрослужбы](/azure/architecture/microservices/design/interservice-communication#synchronous-versus-asynchronous-messaging).

* В конструкторе приложений логики действие HTTP, но не триггер, имеет параметр **асинхронного шаблона** , который включен по умолчанию. Этот параметр указывает, что вызывающий объект не ждет завершения обработки и может перейти к следующему действию, но продолжит проверку состояния, пока обработка не будет остановлена. Если этот параметр отключен, вызывающий объект ожидает завершения обработки перед переходом к следующему действию.

  Чтобы найти этот параметр, выполните следующие действия.

  1. В строке заголовка действия HTTP нажмите кнопку с многоточием (**...**), открывающую параметры действия.

  1. Найдите параметр **асинхронного шаблона** .

     ![Параметр "асинхронная модель"](./media/connectors-native-http/asynchronous-pattern-setting.png)

* Определение базового нотация объектов JavaScript (JSON) действия HTTP неявно соответствует шаблону асинхронной операции.

<a name="disable-asynchronous-operations"></a>

## <a name="disable-asynchronous-operations"></a>Отключение асинхронных операций

Иногда может возникнуть необходимость в асинхронном поведении HTTP-действия в конкретных сценариях, например при необходимости:

* [Избегайте истечения времени ожидания HTTP для долго выполняющихся задач](#avoid-http-timeouts)
* [Отключить проверку заголовков расположения](#disable-location-header-check)

<a name="turn-off-asynchronous-pattern-setting"></a>

### <a name="turn-off-asynchronous-pattern-setting"></a>Отключить **асинхронный параметр шаблона**

1. В конструкторе приложений логики в строке заголовка действия HTTP нажмите кнопку с многоточием (**...**), открывающую параметры действия.

1. Найдите параметр **асинхронный шаблон** , установите параметр в значение **выкл** ., если он включен, и нажмите кнопку **Готово**.

   ![Отключить параметр "асинхронный шаблон"](./media/connectors-native-http/disable-asynchronous-pattern-setting.png)

<a name="add-disable-async-pattern-option"></a>

### <a name="disable-asynchronous-pattern-in-actions-json-definition"></a>Отключение асинхронного шаблона в определении JSON действия

В базовом определении JSON действия HTTP [добавьте `"DisableAsyncPattern"` параметр operation](../logic-apps/logic-apps-workflow-actions-triggers.md#operation-options) в определение действия, чтобы действие состоится после шаблона синхронной операции. Дополнительные сведения см. в разделе также [выполнение действий в шаблоне синхронной операции](../logic-apps/logic-apps-workflow-actions-triggers.md#disable-asynchronous-pattern).

<a name="avoid-http-timeouts"></a>

## <a name="avoid-http-timeouts-for-long-running-tasks"></a>Избегайте истечения времени ожидания HTTP для долго выполняющихся задач

Время ожидания HTTP-запросов [ограничено](../logic-apps/logic-apps-limits-and-config.md#http-limits). При наличии длительного действия HTTP, время ожидания которого истекло из-за этого ограничения, доступны следующие варианты:

* [Отключите шаблон асинхронной операции HTTP-действия](#disable-asynchronous-operations) , чтобы это действие не было постоянно опрашивать или не проверит состояние запроса. Вместо этого действие ожидает ответа получателя с состоянием и результатами после завершения обработки запроса.

* Замените действие HTTP на [действие веб-перехватчика HTTP](../connectors/connectors-native-webhook.md), которое ждет, пока получатель отправит ответ с состоянием и результатами после завершения обработки запроса.

<a name="disable-location-header-check"></a>

## <a name="disable-checking-location-headers"></a>Отключить проверку заголовков расположения

Некоторые конечные точки, службы, системы или API возвращают ответ "202 Accepted", у которого нет `location` заголовка. Чтобы не выполнять действие HTTP постоянно проверять состояние запроса `location` , если заголовок не существует, можно использовать следующие параметры.

* [Отключите шаблон асинхронной операции HTTP-действия](#disable-asynchronous-operations) , чтобы это действие не было постоянно опрашивать или не проверит состояние запроса. Вместо этого действие ожидает ответа получателя с состоянием и результатами после завершения обработки запроса.

* Замените действие HTTP на [действие веб-перехватчика HTTP](../connectors/connectors-native-webhook.md), которое ждет, пока получатель отправит ответ с состоянием и результатами после завершения обработки запроса.

## <a name="known-issues"></a>Известные проблемы

<a name="omitted-headers"></a>

### <a name="omitted-http-headers"></a>Пропущенные заголовки HTTP

Если триггер или действие HTTP включает эти заголовки, Logic Apps удаляет эти заголовки из созданного сообщения запроса без отображения предупреждения или ошибки:

* `Accept-*` заголовки, за исключением `Accept-version`
* `Allow`
* `Content-*` со следующими исключениями: `Content-Disposition`, `Content-Encoding` и `Content-Type`
* `Cookie`
* `Expires`
* `Host`
* `Last-Modified`
* `Origin`
* `Set-Cookie`
* `Transfer-Encoding`

Хотя Logic Apps не останавливает сохранение приложений логики, использующих триггер HTTP или действие с этими заголовками, Logic Apps пропускает эти заголовки.

## <a name="connector-reference"></a>Справочник по соединителям

Дополнительные сведения о параметрах триггера и действия см. в следующих разделах:

* [Параметры триггера HTTP](../logic-apps/logic-apps-workflow-actions-triggers.md#http-trigger)
* [Параметры действия HTTP](../logic-apps/logic-apps-workflow-actions-triggers.md#http-action)

## <a name="next-steps"></a>Дальнейшие действия

* [Безопасный доступ и доступ к данным для исходящих вызовов других служб и систем](../logic-apps/logic-apps-securing-a-logic-app.md#secure-outbound-requests)
* [Соединители для Logic Apps](../connectors/apis-list.md)
