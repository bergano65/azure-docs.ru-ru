---
title: Подключение к Common Data Service (Microsoft инверсия)
description: Создание записей Common Data Service (Microsoft инверсия) и управление ими с помощью Azure Logic Apps
services: logic-apps
ms.suite: integration
ms.reviewer: jdaly, logicappspm
ms.topic: conceptual
ms.date: 02/11/2021
tags: connectors
ms.openlocfilehash: bec3416195358121b85eb61679ab39647e664a9e
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100382363"
---
# <a name="create-and-manage-records-in-common-data-service-microsoft-dataverse-by-using-azure-logic-apps"></a>Создание записей и управление ими в Common Data Service (Microsoft инверсия) с помощью Azure Logic Apps

> [!NOTE]
> В ноябре 2020 Common Data Service был переименован в Microsoft инверсия.

С помощью [Azure Logic Apps](../logic-apps/logic-apps-overview.md) и [соединителя Common Data Service](/connectors/commondataservice/)можно создавать автоматизированные рабочие процессы, управляющие записями в [Common Data Service, теперь](/powerapps/maker/common-data-service/data-platform-intro) это база данных Microsoft для обратного подключения. Эти рабочие процессы могут создавать записи, обновлять записи и выполнять другие операции. Вы также можете получить сведения из базы данных обратного доступа и сделать выходные данные доступными для других действий в приложении логики. Например, при обновлении записи в базе данных инверсии можно отправить сообщение электронной почты с помощью соединителя Outlook для Office 365.

В этой статье показано, как создать приложение логики, которое создает запись задачи при создании новой записи интереса.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* [Среда Common Data Service](/power-platform/admin/environments-overview), представляющая собой пространство, в котором организация хранит, управляет и совместно использует бизнес-данные и базу данных Common Data Service. Для получения дополнительных сведений см. следующие ресурсы.<p>

  * [Дополнительные сведения: Начало работы с Common Data Service](/learn/modules/get-started-with-powerapps-common-data-service/)
  * [Платформа питания — Обзор сред](/power-platform/admin/environments-overview)

* Основные сведения о [создании приложений логики](../logic-apps/quickstart-create-first-logic-app-workflow.md) и приложении логики, из которых требуется получить доступ к записям в базе данных обратной записи. Чтобы запустить приложение логики с помощью триггера Common Data Service, требуется пустое приложение логики. Если вы не знакомы с Azure Logic Apps, ознакомьтесь с [кратким руководством: создание первого рабочего процесса с помощью Azure Logic Apps](../logic-apps/quickstart-create-first-logic-app-workflow.md).

## <a name="add-common-data-service-trigger"></a>Добавить триггер Common Data Service

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

В этом примере добавьте триггер Common Data Service, который срабатывает при создании новой записи.

1. На [портале Azure](https://portal.azure.com) откройте свое пустое приложение логики в конструкторе приложений логики, если оно еще не открыто.

1. В поле поиска введите `common data service`. В этом примере можно выбрать в списке триггеров вариант **При создании записи**

   ![Выберите триггер "при создании записи"](./media/connect-common-data-service/select-when-record-created-trigger.png)

1. При появлении запроса войдите в Common Data Service.

1. В триггере укажите сведения о среде, в которой вы хотите отслеживать новые записи "интересы", например:

   ![Сведения о триггере для наблюдаемой среды](./media/connect-common-data-service/when-record-created-trigger-details.png)

   | Свойство | Обязательно | Описание |
   |----------|----------|-------------|
   | **Среда** | Да | Наблюдаемая среда, например "Fabrikam Sales Production". Дополнительные сведения см. в разделе [Power Platform-](/power-platform/admin/environments-overview)Environments Overview. |
   | **Имя сущности** | Да | Сущность для отслеживания, например "интересы" |
   | **Область** | Да | Источник, создавший новую запись, например пользователь в подразделении или любой пользователь в Организации. В этом примере используется "бизнес-единица". |
   ||||

## <a name="add-common-data-service-action"></a>Добавить Common Data Service действие

Теперь добавьте действие Common Data Service, которое создает запись задачи для новой записи "интересы".

1. В триггере **при создании записи** выберите **новый шаг**.

1. В поле поиска введите `common data service`. В списке действий выберите действие **Создать новую запись**

   ![Выберите действие "создать новую запись"](./media/connect-common-data-service/select-create-new-record-action.png)

1. В действии укажите сведения о среде, в которой нужно создать новую запись задачи. Если он доступен, другие свойства также отображаются на основе сущности, выбранной для этого действия, например:

   ![Сведения о действии для среды, в которой создается запись](./media/connect-common-data-service/create-new-record-action-details.png)

   | Свойство | Обязательно | Описание |
   |----------|----------|-------------|
   | **Название организации** | Да | Среда, в которой вы хотите создать запись, которая не должна быть той же средой в триггере, но в этом примере — "Fabrikam Sales Production". |
   | **Имя сущности** | Да | Объект, на котором вы хотите создать запись, например "Задачи" |
   | **Тема** | Да, на основе сущности, выбранной в этом примере | Краткое описание цели для этой задачи |
   ||||

   1. В качестве значения свойства **subject** введите следующий текст с конечным пробелом:

      `Follow up with new lead:`

   1. Наведите указатель мыши внутри поля **Тема** , чтобы список динамического содержимого оставался видимым.
   
   1. В списке в разделе **при создании записи** выберите выходные данные триггера, которые необходимо включить в запись задачи, например:

      ![Выбор выходных данных триггера для использования в записи задачи](./media/connect-common-data-service/create-new-record-action-select-trigger-outputs.png)

      | Выходные данные триггера | Описание |
      |----------------|-------------|
      | **First Name** | Первое имя из записи интереса для использования в качестве основного контакта в записи задачи |
      | **Фамилия** | Фамилия из записи интереса для использования в качестве основного контакта в записи задачи |
      | **Описание** | Другие выходные данные, включаемые в запись задачи, например адрес электронной почты и номер рабочего телефона. |
      |||

   Когда все будет готово, действие может выглядеть, как в следующем примере:

   ![Действие "создать новую запись" завершено](./media/connect-common-data-service/finished-create-record-action-details.png)

1. Сохраните приложение логики. На панели инструментов конструктора щелкните **Сохранить**.

1. Чтобы вручную запустить приложение логики, на панели инструментов конструктора выберите **выполнить**. Чтобы протестировать приложение логики, создайте новую запись "интересы".

## <a name="trigger-only-on-updated-attributes"></a>Активировать только обновленные атрибуты

Для триггеров, выполняемых при обновлении записей, например при обновлении действия **записи** , можно использовать атрибуты фильтра, чтобы приложение логики выполнялось только при обновлении указанных атрибутов. Эта возможность позволяет предотвратить ненужные запуски приложений логики.

1. В триггере в списке **Добавить новый параметр** выберите **Фильтры атрибутов**.

   ![Снимок экрана, показывающий действие "при обновлении записи" и открытого списка "добавить новый параметр" с выбранным свойством "Фильтры атрибутов".](./media/connect-common-data-service/when-record-updated-trigger-add-attribute-filters.png)

1. Для каждого **элемента фильтрации атрибутов** выберите атрибут, который требуется отслеживать для обновлений, например:

   ![Добавить свойство "Фильтры атрибутов"](./media/connect-common-data-service/when-record-updated-trigger-select-attribute-filter.png)

## <a name="list-records-based-on-a-filter"></a>Вывод списка записей на основе фильтра

Для действий, которые возвращают записи, такие как **список записей** , можно использовать запрос ODATA, возвращающий записи на основе указанного фильтра. Например, в списке действий есть только записи об активных учетных записях.

1. В действии откройте список **Добавить новый параметр** и выберите свойство **Фильтр запроса** .

   ![Добавить свойство "фильтровать запрос"](./media/connect-common-data-service/list-records-action-filter-query.png)

1. В свойстве **запрос фильтра** , которое теперь отображается в действии, введите этот запрос фильтра ODATA: `statuscode eq 1`

   ![Введите запрос фильтра ODATA для фильтрации записей](./media/connect-common-data-service/list-records-action-filter-query-value.png)

Дополнительные сведения о `$filter` параметрах запросов системы см. в разделе [Common Data Service-Filter Results](/powerapps/developer/common-data-service/webapi/query-data-web-api#filter-results).

## <a name="list-records-based-on-an-order"></a>Вывод списка записей на основе заказа

Для действий, возвращающих записи, таких как действие " **список записей** ", можно использовать запрос ODATA, возвращающий записи в указанном порядке, который зависит от записей, возвращаемых действием. Например, можно отобразить в списке действий записи на основе имени учетной записи.

1. В действии откройте список **Добавить новый параметр** и выберите свойство **ORDER BY** .

   ![Добавить свойство "Order By"](./media/connect-common-data-service/list-records-action-order-by.png)

1. В свойстве **ORDER BY** , которое теперь отображается в действии, введите этот запрос фильтра ODATA: `name`

   ![Введите запрос фильтра ODATA для упорядочения записей](./media/connect-common-data-service/list-records-action-order-by-value.png)

Дополнительные сведения о `$orderby` параметрах запросов системы см. в разделе [Common Data Service-Order Results](/powerapps/developer/common-data-service/webapi/query-data-web-api#order-results).

## <a name="field-data-types"></a>Типы данных полей

Независимо от того, вводится ли значение вручную или выбирается из списка динамического содержимого для поля в триггере или действии, тип данных значения должен соответствовать требуемому типу данных поля.

В этой таблице описываются некоторые типы полей и типы данных, которые требуются для этих полей.

| Поле | Тип данных | Описание |
|-------|-----------|-------------|
| Текстовое поле | Одна строка текста | Требуется одна строка текста или динамическое содержимое, имеющее тип данных text, например следующие свойства: <p><p>- **Nописание** <br>- **Категори** |
| Целочисленное поле | Целое число | Требуется целочисленное или динамическое содержимое, имеющее тип данных Integer, например следующие свойства: <p><p>- **Процент завершения** <br>- **Длитель** |
| Поле даты | Дата и время | Для требуется либо дата в формате мм/дд/YYY, либо динамическое содержимое с типом данных Date, например, следующие свойства: <p><p>- **Создано** <br>- **Дата начала** <br>- **Фактическое начало** <br>- **Фактическое окончание** <br>- **Срок** |
| Поле, которое ссылается на другую запись сущности | Первичный ключ | Требуется идентификатор записи, например GUID, и тип поиска. Это означает, что значения из списка динамического содержимого не будут работать, например, следующие свойства: <p><p>- **Owner**: должен быть ДОПУСТИМЫм идентификатором пользователя или идентификатором записи команды. <br>- **Тип владельца**: должен быть типом уточняющего запроса, таким как `systemusers` или `teams` , соответственно. <p><p>- В **отношении**: должен быть ДОПУСТИМЫм идентификатором записи, например идентификатором учетной записи или идентификатором записи контакта. <br>- В **отношении типа**: должен быть типом поиска, таким как `accounts` или `contacts` , соответственно. <p><p>- **Customer**: должен быть ДОПУСТИМЫм идентификатором записи, например идентификатором учетной записи или идентификатором записи контакта. <br>- **Тип клиента**: должен быть типом поиска, таким как `accounts` или `contacts` , соответственно. |
||||

В этом примере показано, как действие **создать новую запись** создает новую запись Tasks, связанную с другими записями сущности, в частности запись пользователя и запись учетной записи. Действие указывает идентификаторы и типы поиска для этих записей сущности, используя значения, соответствующие ожидаемым типам данных для соответствующих свойств.

* В зависимости от свойства **owner** , которое указывает идентификатор пользователя, и свойства **типа владельца** , определяющего `systemusers` тип поиска, действие связывает новую запись Tasks с конкретным пользователем.

* В зависимости от **свойства,** определяющего идентификатор записи, и свойства **Type** , определяющего `accounts` тип поиска, действие связывает новую запись Tasks с определенной учетной записью.

![Создание записи "задачи", связанной с идентификаторами и типами поиска](./media/connect-common-data-service/create-new-record-task-properties.png)

## <a name="connector-reference"></a>Справочник по соединителям

Технические сведения на основе описания Swagger соединителя, например триггеров, действий, ограничений и других сведений, см. [на странице справочника по соединителю](/connectors/commondataservice/).

## <a name="troubleshooting-problems"></a>Устранение неполадок

### <a name="calls-from-multiple-environments"></a>Вызовы из нескольких сред

Оба соединителя, Common Data Service и Common Data Service (Текущая среда), хранят сведения о рабочих процессах приложения логики, которые требуют и получают уведомления об изменениях сущности с помощью `callbackregistrations` сущности в Microsoft DataStore. Если скопировать организацию инверсии, то все веб-перехватчики будут скопированы. При копировании Организации перед отключением рабочих процессов, сопоставленных с вашей организацией, все скопированные веб-перехватчики также указывают на те же приложения логики, которые затем получают уведомления от нескольких организаций.

Чтобы отключить нежелательные уведомления, удалите регистрацию обратного вызова из Организации, которая отправляет эти уведомления, выполнив следующие действия.

1. Выберите организацию инверсии, с которой необходимо удалить уведомления, и войдите в эту организацию.

1. В браузере Chrome найдите регистрацию обратного вызова, которую необходимо удалить, выполнив следующие действия.

   1. Просмотрите универсальный список для всех регистраций обратного вызова по следующему URI OData, чтобы можно было просматривать данные внутри `callbackregistrations` сущности:

      `https://{organization-name}.crm{instance-number}.dynamics.com/api/data/v9.0/callbackregistrations`:

      > [!NOTE]
      > Если значения не возвращаются, возможно, у вас нет разрешений на просмотр этого типа сущности или вы не вошли в соответствующую организацию.

   1. Фильтрация по логическому имени `entityname` и событию уведомления, которое соответствует рабочему процессу приложения логики (сообщение). Каждый тип события сопоставляется с целым числом сообщений следующим образом:

      | Тип события | Целое число сообщения |
      |------------|-----------------|
      | Создать | 1 |
      | Удалить | 2 |
      | Обновление | 3 |
      | CreateOrUpdate | 4 |
      | креатеорделете | 5 |
      | упдатеорделете | 6 |
      | креатеорупдатеорделете | 7 |
      |||

      В этом примере показано, как можно отфильтровать `Create` уведомления для сущности с именем `nov_validation` , используя следующий URI OData для примера организации:

      `https://fabrikam-preprod.crm1.dynamics.com/api/data/v9.0/callbackregistrations?$filter=entityname eq 'nov_validation' and message eq 1`

      ![Снимок экрана, показывающий окно браузера и URI OData в адресной строке.](./media/connect-common-data-service/find-callback-registrations.png)

      > [!TIP]
      > Если для одной и той же сущности или события существует несколько триггеров, можно отфильтровать список с помощью дополнительных фильтров, таких как `createdon` `_owninguser_value` атрибуты и. Имя пользователя владельца отображается в разделе `/api/data/v9.0/systemusers({id})` .

   1. После нахождения идентификатора для регистрации обратного вызова, который требуется удалить, выполните следующие действия.
   
      1. В браузере Chrome откройте Средства для разработчиков Chrome (клавиатура: F12).

      1. В верхней части окна перейдите на вкладку **Console (консоль** ).

      1. В командной строке введите следующую команду, которая отправляет запрос на удаление указанной регистрации обратного вызова:

         `fetch('http://{organization-name}.crm{instance-number}.dynamics.com/api/data/v9.0/callbackregistrations({ID-to-delete})', { method: 'DELETE'})`

         > [!IMPORTANT]
         > Убедитесь, что запрос выполняется на странице неоднородного клиентского интерфейса (UCI), например, на странице отклика OData или API. В противном случае логика в файле app.js может помешать этой операции.

   1. Чтобы убедиться, что регистрация обратного вызова больше не существует, проверьте список регистраций обратного вызова.

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте больше о других [соединителях для Azure Logic Apps](../connectors/apis-list.md).
