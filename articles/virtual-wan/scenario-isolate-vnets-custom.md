---
title: 'Сценарий: Пользовательская Изоляция для виртуальных сетей'
titleSuffix: Azure Virtual WAN
description: Сценарии для маршрутизации — запретить выбранным виртуальных сетей доступ к другим
services: virtual-wan
author: cherylmc
ms.service: virtual-wan
ms.topic: conceptual
ms.date: 09/22/2020
ms.author: cherylmc
ms.openlocfilehash: 12bc99d24472780f87a6b2a83befdbbf12944860
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91267726"
---
# <a name="scenario-custom-isolation-for-vnets"></a>Сценарий: Пользовательская Изоляция для виртуальных сетей

При работе с маршрутизацией виртуальных сетей виртуальной глобальной сети существует несколько доступных сценариев. В пользовательском сценарии изоляции для виртуальных сетей цель заключается в предотвращении доступа определенного набора виртуальных сетей к другому конкретному набору виртуальных сетей. Однако виртуальных сетей должны обращаться ко всем ветвям (VPN/ER/VPN-подключение пользователей). Дополнительные сведения о маршрутизации виртуальных концентраторов см. в статье [о маршрутизации виртуальных концентраторов](about-virtual-hub-routing.md).

## <a name="design"></a><a name="design"></a>Конструирование

Чтобы определить, сколько таблиц маршрутов потребуется, можно создать матрицу подключения. В этом сценарии он будет выглядеть следующим образом, где каждая ячейка показывает, может ли источник (строка) обмениваться данными с целевым объектом (столбцом):

| Как получить | на:| *Синий виртуальных сетей* | *Красный виртуальных сетей* | *Ветви*|
|---|---|---|---|---|
| **Синий виртуальных сетей** |   &#8594;|      X        |               |       X      |
| **Красный виртуальных сетей**  |   &#8594;|              |       X       |       X      |
| **Ветви**   |   &#8594;|     X        |       X       |       X      |

В каждой ячейке в предыдущей таблице описывается, является ли подключение к виртуальной глобальной сети (на стороне «с» потока, заголовки строк в таблице) заголовком конечного префикса («до» стороны потока, заголовки столбцов, выделенные курсивом в таблице) для конкретного потока трафика, где «X» означает, что подключение обеспечивает виртуальную глобальную сеть.

Количество различных шаблонов строк будет количеством таблиц маршрутов, которые понадобятся в этом сценарии. В этом случае три таблицы маршрута маршрута, которые будут вызывать **RT_BLUE** и **RT_RED** для виртуальных сетей, и **по умолчанию** для ветвей. Помните, что ветви всегда должны быть связаны с таблицей маршрутизации по умолчанию.

Ветви должны познакомиться с префиксами красного и синего виртуальных сетей, поэтому все виртуальных сетей потребуется распространить на значение по умолчанию (кроме **RT_BLUE** или **RT_RED**). Синим и красным виртуальных сетейам потребуется изучить префиксы ветвей, поэтому ветви будут распространяться на таблицы маршрутов **RT_BLUE** и **RT_RED** . В результате это окончательный проект:

* Синие виртуальные сети:
  * Связанная таблица маршрутов: **RT_BLUE**
  * Распространение на таблицы маршрутов: **RT_BLUE** и **по умолчанию**
* Красные виртуальные сети:
  * Связанная таблица маршрутов: **RT_RED**
  * Распространение на таблицы маршрутов: **RT_RED** и **по умолчанию**
* Ветк
  * Связанная таблица маршрутов: **по умолчанию**
  * Распространение на таблицы маршрутов: **RT_BLUE**, **RT_RED** и **по умолчанию**

> [!NOTE]
> Так как все ветви необходимо связать с таблицей маршрутов по умолчанию, а также распространить на один и тот же набор таблиц маршрутизации, все ветви будут иметь один и тот же профиль подключения. Иными словами, в ветви нельзя применить концепцию красного или синего для виртуальных сетей.

> [!NOTE]
> Если виртуальная Глобальная сеть развернута в нескольких регионах, необходимо создать **RT_BLUE** и **RT_RED** таблицы маршрутов в каждом концентраторе, а маршруты из каждого подключения к виртуальной сети должны быть распространены в таблицы маршрутов в каждом виртуальном концентраторе с помощью меток распространения.

Дополнительные сведения о маршрутизации виртуальных концентраторов см. в статье [о маршрутизации виртуальных концентраторов](about-virtual-hub-routing.md).

## <a name="workflow"></a><a name="architecture"></a>Рабочий процесс

На **рис. 1**есть синие и красные подключения к виртуальной сети.

* Синяя подключенная виртуальных сетей может соединяться друг с другом, а также достигать всех ветвей (VPN/ER/P2S).
* Красный виртуальных сетей может подключиться друг к другу, а также к подключениям всех ветвей (VPN/ER/P2S).

При настройке маршрутизации примите во внимание следующие шаги.

1. Создайте две пользовательские таблицы маршрутов в портал Azure, **RT_BLUE** и **RT_RED**.
2. Для таблицы маршрутов **RT_BLUE**для следующих параметров:
   * **Ассоциация**: выберите все синие виртуальных сетей.
   * **Распространение**: для ветвей выберите вариант для ветвей, что означает, что подключения Branch (VPN/ER/P2S) будут распространять маршруты в эту таблицу маршрутов.
3. Повторите те же действия для таблицы маршрутов **RT_RED** для Red виртуальных сетей и ветвей (VPN/ER/P2S).

Это приведет к изменению конфигурации маршрутизации, как показано на рисунке ниже.

**Рис. 1**

:::image type="content" source="./media/routing-scenarios/custom-isolation/custom.png" alt-text="рис. 1":::

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о виртуальной глобальной сети см. в статье, содержащей [Часто задаваемые вопросы](virtual-wan-faq.md) о ней.
* Дополнительные сведения о маршрутизации виртуальных концентраторов см. в статье [о маршрутизации виртуальных концентраторов](about-virtual-hub-routing.md).
