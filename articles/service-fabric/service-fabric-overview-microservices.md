---
title: Введение в микрослужбы в Azure
description: Общие сведения о том, почему создание облачных приложений с использованием микрослужб важно для разработки современных приложений и как платформа Azure Service Fabric позволяет достичь этой цели.
ms.topic: conceptual
ms.date: 01/07/2020
ms.custom: sfrev
ms.openlocfilehash: 4345c919e73e57667fb3b9c90c42224326bc3552
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91300774"
---
# <a name="why-use-a-microservices-approach-to-building-applications"></a>Зачем использовать микрослужбы для создания приложений

Для разработчиков программного обеспечения разложение приложения на части компонентов не представляет ничего нового. Как правило, используется многоуровневый подход с внутренним хранилищем, бизнес-логикой среднего уровня и интерфейсом пользовательского интерфейса. Изменения за последние несколько лет заключаются в том *, что разработчики* создают распределенные приложения для облака.

Ниже приведены некоторые изменяющиеся бизнес-потребности.

* Служба, которая построена и работает в масштабе для достижения клиентам в новых географических регионах.
* Более быстрая доставка функций и возможностей для реагирования на запросы клиентов в гибкой методике.
* Более эффективное использование ресурсов, позволяющее снизить затраты.

Эти бизнес-потребности определяют *способ* сборки приложений.

Дополнительные сведения о подходе Azure к микрослужбам см. [в разделе микрослужбы: революция в приложении на базе облака](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/).

## <a name="monolithic-vs-microservices-design-approach"></a>Подход к созданию монолитных и микрослужб

По прошествии времени приложения развиваются. Успешные приложения развиваются за счет использования. Неудачные приложения не развиваются и в конечном итоге являются устаревшими. Вот вопрос: сколько вы узнаете о ваших требованиях сегодня и что они будут в будущем? Например, предположим, что вы создаете приложение для создания отчетов для отдела в вашей компании. Вы уверены, что приложение применяется только в пределах организации и что отчеты не будут храниться долго. Ваш подход будет отличаться от вашего подхода, скажем, создания службы, которая доставляет содержимое видео десяткам миллионов клиентов.

В некоторых случаях получение чего-либо в качестве подтверждения концепции является решающим фактором. Вы уверены, что приложение может быть переработано позже. При чрезмерном проектировании не используется совсем немного времени. С другой стороны, когда компании создаются для облака, ожидание — это рост и использование. Рост и масштабирование являются непредсказуемыми. Мы хотим быстро создать прототип, а также понять, что мы будем использовать путь, который может справиться с успешным выполнением в будущем. Подход, который применяют небольшие новые компании, включает сборку, измерение, анализ данных и повторение всего цикла.

В эпоху клиент/сервер мы, как правило, сосредоточены на создании многоуровневых приложений с использованием конкретных технологий на каждом уровне. Для описания этих подходов появилось понятие « *монолитное* приложение». Интерфейсы находились как бы между уровнями, а в рамках самого уровня компоненты были более тесно связаны. Разработчики разработали и собрали классы, которые были скомпилированы в библиотеки и связаны вместе в несколько исполняемых файлов и библиотек DLL.

Существует ряд преимуществ для создания монолитных подходов. Монолитные приложения часто проще в проектировании, и вызовы между компонентами выполняются быстрее, поскольку эти вызовы часто передаются через межпроцессный обмен данными (IPC). Кроме того, каждый тестирует один продукт, который, как правило, более эффективно использует отдел кадров. Недостаток состоит в том, что существует тесная связь между многоуровневыми слоями, и вы не можете масштабировать отдельные компоненты. Если необходимо выполнить исправления или обновления, необходимо дождаться завершения тестирования другими пользователями. Это затрудняет гибкость.

Микрослужбы устраняют эти недостатки и более точно соответствуют предыдущим бизнес-требованиям. Но у них также есть и преимущества, и обязательства. Преимущество микрослужб заключается в том, что каждая из них обычно инкапсулирует более простую бизнес-функциональность, которую можно масштабировать, тестировать, развертывать и управлять независимо друг от друга. Одним из важных преимуществ использования микрослужб является то, что группы управляются более бизнес-сценариями, чем технологии. Небольшие команды разрабатывают микрослужбы на основе пользовательского сценария и используют любые технологии, которые они хотят использовать.

Иными словами, организации не нужно стандартизировать технологии для поддержки своих приложений для микрослужб. Отдельные команды, владеющие службами, могут делать то, что они считают целесообразным, исходя из собственных знаний или подходящих действий для решения задачи. На практике предпочтительнее использовать ряд рекомендуемых технологий, таких как определенное хранилище NoSQL или платформа веб-приложений.

Недостаток микрослужб заключается в том, что необходимо управлять более отдельными сущностями и работать с более сложными развертываниями и версиями. Сетевой трафик между микрослужбами увеличивается, как и соответствующие задержки сети. Большое количество бесед, детализированные службы могут вызвать кошмар производительности. Без средств, помогающих просматривать эти зависимости, трудно увидеть всю систему.

Стандарты делают работу с микрослужбами, указывая, как обмениваться данными и допускать только те вещи, которые необходимы из службы, а не жесткими контрактами. Важно заранее определить эти контракты в структуре, поскольку службы обновляются независимо друг от друга. При разработке приложений с использованием микрослужб выделяется еще одна характеристика — мелкомодульная сервисноориентированная архитектура (SOA).

***Проще всего подход к проектированию микрослужб — это отделенная Федерация служб с независимыми изменениями в каждом и согласованном стандарте взаимодействия.***

По мере создания большего числа облачных приложений пользователи обнаружили, что эта декомпозиция всего приложения на независимые, ориентированные на сценарии службы является лучшим долгосрочным подходом.

## <a name="comparison-between-application-development-approaches"></a>Сравнение подходов к разработке приложений

![Разработка приложений на платформе Service Fabric][Image1]

1) Монолитное приложение содержит функциональные возможности, зависящие от домена, и обычно разделяется на функциональные слои, такие как веб-приложения, бизнес-приложения и данные.

2) Масштабирование монолитного приложения выполняется путем его клонирования на нескольких серверах, виртуальных машинах или контейнерах.

3) В приложениях, состоящих из микрослужб, функциональные возможности распределены между отдельными службами меньшего размера.

4) Подход с использованием микрослужб дает возможность масштабировать приложения, развертывая каждую службу независимо от других и создавая экземпляры этих служб на разных серверах и виртуальных машинах и в разных контейнерах.

Разработка с использованием микрослужб не подходит для всех проектов, но она более тесно согласована с бизнес-целями, описанными выше. Начиная с монолитного подхода может иметь смысл, если известно, что вы сможете переработать код позже в проект микрослужб. Но чаще всего разработчики сначала создают монолитное приложение, а затем медленно и поэтапно разделяют его, начиная с функциональных областей, в которых следует увеличить масштабируемость и гибкость.

При использовании микрослужб вы объединяете приложение многих небольших служб. Эти службы выполняются в контейнерах, развернутых в кластере компьютеров. Небольшие команды разрабатывают службу, которая посвящена сценарию и независимо тестирует, версии, развертывать и масштабировать каждую службу, чтобы все приложение можно было развивать.

## <a name="what-is-a-microservice"></a>Что такое микрослужба?

Существует много определений микрослужб. Но большинство этих характеристик микрослужб широко приняты:

* Инкапсуляция сценария клиента или бизнес-сценария. Какую проблему вы решаете?
* Разработка небольшими командами разработчиков.
* Написанный на любом языке программирования с использованием любой платформы.
* Состоит из кода и, при необходимости, состояния, независимо от версии, развернутой и масштабируемой.
* Взаимодействие с другими микрослужбами с помощью четко определенных интерфейсов и протоколов.
* Имеют уникальные имена (URL-адреса), которые используются для разрешения их расположения.
* Обеспечение стабильности работы и доступности в случае сбоя.

Для суммирования:

***Приложения, состоящие из микрослужб, формируются из небольших ориентированных на клиента служб с независимым управлением версиями и масштабированием, которые взаимодействуют по стандартным протоколам с применением четко определенных интерфейсов.***

### <a name="written-in-any-programming-language-using-any-framework"></a>Написанный на любом языке программирования с использованием любой платформы

Как разработчикам, мы хотим бесплатно выбирать язык или платформу в зависимости от наших навыков и потребностей службы, которую мы создаем. Для некоторых служб вы можете повысить производительность с помощью C++ над любым другим. В других случаях простота управляемой разработки, получаемой из C# или Java, может быть более важной. В некоторых случаях может потребоваться использовать конкретную библиотеку партнеров, технологию хранения данных или метод для предоставления клиентам доступа к службе.

После выбора технологии необходимо учитывать операционные и эксплуатационные этапы управления и масштабирования службы.

### <a name="allows-code-and-state-to-be-independently-versioned-deployed-and-scaled"></a>Возможность независимого управления версиями, развертывания и масштабирования кода и состояния

Независимо от того, как вы пишете микрослужбы, код и, по желанию, состояние, должны самостоятельно развертывать, обновлять и масштабировать. Эту проблему трудно решить, поскольку она связана с выбранными технологиями. Для масштабирования понимание того, как следует секционировать (или сегментировать) код и состояние, является сложной задачей. Если в коде и состоянии используются различные технологии, которые сегодня являются общими, сценарии развертывания для микрослужбы должны иметь возможность масштабировать их. Это разделение также обеспечивает гибкость и гибкость, поэтому вы можете обновить некоторые микрослужбы, не требуя обновления всех этих микрослужб одновременно.

Давайте вернемся к нашему сравнению подходов монолитных и микрослужб в течение некоторого времени. На этой схеме показаны различия в подходах к хранению состояния:

#### <a name="state-storage-for-the-two-approaches"></a>Хранилище состояний для двух подходов

![Хранилище состояний платформы Service Fabric][Image2]

***Монолитный подход, слева, содержит одну базу данных и уровни конкретных технологий.***

***Подход на основе микрослужб справа имеет граф взаимосвязанных микрослужб, где состояние обычно ограничено микрослужбой и используются различные технологии.***

Монолитное приложение, как правило, использует отдельную базу данных. Преимущество использования одной базы данных заключается в том, что она находится в одном месте, что упрощает развертывание. У каждого компонента может быть одна таблица для хранения данных о состоянии. Сложность состоит в том, что командам разработчиков необходимо строго разграничивать состояния. Неизбежно, кто-то сможет добавить столбец в существующую таблицу Customer, выполнить соединение таблиц и создать зависимости на уровне хранилища. Однако в таком случае будет невозможно масштабировать отдельные компоненты.

При подходе с использованием микрослужб каждая служба управляет собственным состоянием и хранит данные о нем. Каждая служба отвечает за масштабирование кода и состояния для обеспечения соответствия собственным требованиям. Недостаток состоит в том, что при необходимости создания представлений или запросов данных приложения необходимо выполнить запрос к нескольким хранилищам состояний. Эта проблема обычно решается отдельной микрослужбой, которая создает представление в коллекции микрослужб. Если необходимо выполнить несколько запросов импровизированном к данным, следует рассмотреть возможность записи данных о каждой микрослужбе в службу хранения данных для автономной аналитики.

Поддерживаются версии микрослужб. Разные версии микрослужбы могут выполняться параллельно. В процессе обновления может произойти сбой новой версии микрослужбы, и необходимо выполнить откат до более ранней версии. Управление версиями также полезно для тестирования A/B, где разные пользователи испытывают разные версии службы. Например, вы часто обновляете микрослужбу для определенного набора клиентов, чтобы протестировать новые функции, прежде чем делать это более широко.

### <a name="interacts-with-other-microservices-over-well-defined-interfaces-and-protocols"></a>Взаимодействие с другими микрослужбами с применением четко определенных интерфейсов и протоколов

За последние 10 лет были опубликованы подробные сведения о шаблонах связи в архитектурах, ориентированных на службы. Сейчас, как правило, для взаимодействия между службами используется REST, протоколы HTTP и TCP, а также формат сериализации XML или JSON. С точки зрения интерфейса он состоит в подходе к веб-дизайну. Но ничто не должно останавливаться на использовании двоичных протоколов или собственных форматов данных. Просто имейте в виду, что у людей будет труднее использовать микрослужбы, если эти протоколы и форматы недоступны.

### <a name="has-a-unique-name-url-used-to-resolve-its-location"></a>Уникальное имя (URL-адрес), используемое для распознавания расположения

Возможность адресации микрослужбы должна существовать независимо от того, где она находится. Если вы думаете о компьютерах и на каком компьютере выполняется конкретная микрослужба, то они могут быстро оказаться ненужными.

Микрослужба должна иметь уникальное имя, позволяющее обнаружить ее расположение, подобно тому, как DNS разрешает URL-адрес для конкретного компьютера. Микрослужбам требуются имена с адресацией, которые не зависят от инфраструктуры, в которой они выполняются. Это означает наличие связи между развертыванием службы и ее обнаружением, то есть необходим реестр служб. При сбое компьютера служба реестра должна сообщить, куда была перемещена служба.

### <a name="remains-consistent-and-available-in-the-presence-of-failures"></a>Стабильность работы и доступность в случае сбоя

Непредвиденные сбои являются одной из самых сложных для разрешения проблем, особенно в распределенной системе. Большая часть кода, который мы написали для разработчиков, — обработка исключений. Во время тестирования мы также тратим максимальное время на обработку исключений. Процесс является более сложным, чем написание кода для обработки сбоев. Что происходит при сбое компьютера, на котором работает микрослужба? Необходимо обнаружить ошибку, которая является жесткой проблемой. Но вам также потребуется перезапустить микрослужбу.

Для обеспечения доступности микрослужба должна быть устойчива к сбоям и может быть перезапущена на другом компьютере. Помимо этих требований к устойчивости, данные не должны быть потеряны, и данные должны оставаться единообразными.

Устойчивости трудно достичь при возникновении сбоев во время обновления приложения. Микрослужбе, работающей с системой развертывания, не требуется восстановление. Необходимо определить, может ли он продолжить переход к более новой версии или откатить до предыдущей версии, чтобы поддерживать целостное состояние. Необходимо рассмотреть несколько вопросов, например, если доступно достаточное количество компьютеров, чтобы продолжить переход вперед и восстановить предыдущие версии микрослужбы. Для принятия этих решений необходимо, чтобы микрослужба выдавала сведения о работоспособности.

### <a name="reports-health-and-diagnostics"></a>Передача информации о работоспособности и диагностических данных

Это может показаться очевидным, и часто он не будет рассматриваться, но микрослужба должна сообщить о своей работоспособности и диагностике. В противном случае у вас будет немало информации о работоспособности с точки зрения операций. Сложность заключается не только в выявлении связи между диагностическими событиями для ряда независимых служб, но и в сопоставлении расхождений в показаниях часов компьютера для определения порядка событий. Как и при взаимодействии с микрослужбами с использованием согласованных протоколов и форматов данных, необходимо стандартизировать способ ведения журнала событий работоспособности и диагностических событий, которые в конечном счете оказываются в хранилище событий, к которому можно обращаться для просмотра данных и создания запросов. При подходе к микрослужбам разные команды должны согласовать один формат ведения журнала. В приложении должен использоваться согласованный подход к просмотру диагностических событий.

Работоспособность отличается от диагностики. Работоспособность связана с отчетами микрослужбы о своем текущем состоянии для принятия необходимых мер. Хороший пример — работа с механизмами обновления и развертывания для поддержания доступности. Несмотря на то, что в данный момент служба может быть неработоспособной из-за сбоя процесса или перезагрузки компьютера, служба может продолжать работать. Последнее, что вам нужно, — это сделать ситуацию хуже, запустив обновление. Наилучший подход заключается в том, чтобы сначала исследовать время для восстановления микрослужбы. События работоспособности от микрослужбы помогают принимать обоснованные решения и, по сути, создавать самовосстанавливающиеся службы.

## <a name="guidance-for-designing-microservices-on-azure"></a>Руководство по проектированию микрослужб в Azure

Руководство по [проектированию и созданию микрослужб в Azure](/azure/architecture/microservices/)см. в центре архитектуры Azure.

## <a name="service-fabric-as-a-microservices-platform"></a>Платформа микрослужб Service Fabric

Service Fabric Azure появилось, когда корпорация Майкрософт перешла от поставки продуктов в штучной упаковке, которые обычно монолиты для доставки служб. Возможности создания и эксплуатации больших служб, таких как база данных SQL Azure и Azure Cosmos DB, Service Fabric. Платформа развивалась со временем по мере того, как она была принята службами. Service Fabric работает не только в среде Azure, но и в автономных развертываниях Windows Server.

***Целью Service Fabric является решение проблем, связанных с созданием и запуском службы, а также эффективное использование ресурсов инфраструктуры, благодаря чему команды могут решать бизнес-задачи с помощью подхода к микрослужбам.***

Этот короткий видеоролик содержит общие сведения о Service Fabric и микрослужбах:
> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-Service-Fabric/player]

Service Fabric позволяет создавать приложения в рамках подхода с использованием микрослужб, предоставляя следующее:

* Платформа, которая предоставляет системные службы для развертывания, обновления, обнаружения и перезапуска служб, в которых произошел сбой, а также обнаружения служб, маршрутизации сообщений, управления состоянием и мониторинга работоспособности.
* Возможность развертывания приложений, работающих в контейнерах или в качестве процессов. Service Fabric — это контейнер и оркестратор процессов.
* Эффективные API-интерфейсы программирования, помогающие создавать приложения в виде микрослужб: [ASP.NET Core, Reliable Actors и Reliable Services](service-fabric-choose-framework.md). К примеру, вы можете получать информацию о работоспособности и данные диагностики, а также пользоваться преимуществами встроенных средств, обеспечивающих высокую доступность.

***Service Fabric не зависит от того, как вы создаете службу, и можете использовать любую технологию. Но он предоставляет встроенные API-интерфейсы программирования, упрощающие создание микрослужб.***

### <a name="migrating-existing-applications-to-service-fabric"></a>Перенос существующих приложений в Service Fabric

Service Fabric позволяет повторно использовать существующий код и модернизировать его с новыми микрослужбами. Модернизации приложений состоит из пяти этапов, и вы можете запускать и останавливаться на любом этапе. Это следующие этапы.

1) начать с традиционного монолитного приложения.  
2) Переход. Используйте контейнеры или гостевые исполняемые файлы для размещения существующего кода в Service Fabric.  
3) Модернизировать. Добавление новых микрослужб вместе с существующим контейнерным кодом.  
4) Внедрять инновации. Разбейте монолитное приложение на микрослужбы в зависимости от нужды.  
5) Преобразуйте приложения в микрослужбы. Преобразуйте существующие монолитные приложения или создайте новые приложения нуля.

![Переход на микрослужбы][Image3]

Помните, что вы можете *запускать и останавливаться на любом из этих этапов*. На следующий этап нет необходимости. 

Рассмотрим примеры для каждого из этих этапов.

**анализа**  
По двум причинам многие компании переносят существующие монолитные приложения в контейнеры:

* Снижение затрат из-за консолидации и удаления существующего оборудования или из-за использования приложений с высокой плотностью.
* Согласованный контракт развертывания между разработкой и операциями.

Снижение затрат — это просто. В корпорации Майкрософт многие существующие приложения являются контейнерными, что позволяет экономить миллионы долларов. Последовательное развертывание сложнее оценить, но так же важно. Это означает, что разработчики могут выбрать технологии, которые соответствуют им, но операции будут принимать только один метод развертывания приложений и управления ими. Она позволяет избежать проблем, связанных с сложностью поддержки различных технологий, не вынуждая разработчиков выбирать только определенные. По сути, каждое приложение является контейнерным для автономных образов развертывания.

На этом многие организации останавливаются. У них уже есть преимущества контейнеров, и Service Fabric предоставляет полный набор возможностей управления, включая развертывание, обновление, управление версиями, откаты и мониторинг работоспособности.

**Модернизация**  
Модернизации — это добавление новых служб наряду с существующим контейнерным кодом. Если вы собираетесь написать новый код, лучше проделать небольшие шаги по пути микрослужб. Это может означать добавление новой REST API конечной точки или новой бизнес-логики. Таким образом вы начнете процесс создания новых микрослужб и попрактиковаться в разработке и развертывании.

**Инновации**  
Подход с использованием микрослужб позволит учесть изменяющиеся требования бизнеса. На этом этапе необходимо решить, следует ли начать разделение монолитного приложения на службы или внедрять. Классический пример здесь заключается в том, что база данных, используемая в качестве очереди рабочего процесса, становится узким местом обработки. По мере увеличения количества запросов рабочих процессов работа должна распределяться соответственно масштабу. Пройдите эту конкретную часть приложения, которая не масштабируется или нуждается в обновлении чаще, и разделите ее как микрослужбу и внедрять.

**Преобразование приложений в микрослужбы**  
На этом этапе приложение полностью состоит из микрослужб (или разбивается на них). Чтобы приступать к этому моменту, вы сделали путешествие микрослужб. Вы можете начать здесь, но для этого не нужно использовать платформу микрослужб, чтобы помочь вам в значительных вложениях.

### <a name="are-microservices-right-for-my-application"></a>Подходят ли микрослужбы моему приложению?

Возможно. В корпорации Майкрософт по мере того, как несколько групп начали создавать облачные решения по соображениям бизнеса, многие из них осознали преимущества подхода, схожего с микрослужбами. Например, Bing использует микрослужбы в течение нескольких лет. Для других команд этот подход был новым. Они столкнулись со сложными проблемами, которые им не удалось решить. Именно поэтому Service Fabric получили выигрыш в качестве технологии для создания служб.

Цель Service Fabric заключается в том, чтобы уменьшить сложность создания приложений микрослужб, чтобы не нужно было проделать много дорогостоящих реконструирования. Принцип использования платформы: создание небольшого приложения, масштабирование по мере необходимости, удаление устаревших служб, добавление новых служб и развитие приложения по мере использования клиентами. Мы знаем: чтобы сделать микрослужбы более доступными для большинства разработчиков, следует решить еще множество проблем. Контейнеры и модель программирования субъектов — это примеры небольших шагов в этом направлении. Мы уверены, что для упрощения работы с микрослужбами появились новые нововведения.

## <a name="next-steps"></a>Дальнейшие шаги

* [Микрослужбы: революция в области приложений на основе облака](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)
* [Центр архитектуры Azure: создание микрослужб в Azure](/azure/architecture/microservices/)
* [Рекомендации по приложению и кластеру Azure Service Fabric](service-fabric-best-practices-overview.md)
* [Общие сведения о терминологии Service Fabric](service-fabric-technical-overview.md)

[Image1]: media/service-fabric-overview-microservices/monolithic-vs-micro.png
[Image2]: media/service-fabric-overview-microservices/statemonolithic-vs-micro.png
[Image3]: media/service-fabric-overview-microservices/microservices-migration.png
