---
title: Обзор мониторинга и диагностики Azure Service Fabric | Документы Майкрософт
description: Сведения о функциях мониторинга и диагностики для кластеров, приложений и служб Azure Service Fabric.
services: service-fabric
documentationcenter: .net
author: srrengar
manager: timlt
editor: ''
ms.assetid: ''
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: conceptual
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 11/21/2018
ms.author: srrengar
ms.openlocfilehash: 82c02c0212fd79d8847d374022b6ac8f862f042a
ms.sourcegitcommit: beb4fa5b36e1529408829603f3844e433bea46fe
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/22/2018
ms.locfileid: "52291119"
---
# <a name="monitoring-and-diagnostics-for-azure-service-fabric"></a>Мониторинг и диагностика для Azure Service Fabric

В статье представлен обзор мониторинга и диагностики в Azure. Мониторинг и диагностика критически важны для разработки, тестирования и развертывания рабочих нагрузок в любой облачной среде. Например, вы можете отслеживать использование приложений, действия, предпринимаемые платформой Service Fabric, использование ресурсов (с помощью счетчиков производительности) и общую работоспособность кластера. Эту информацию можно использовать для диагностики и устранения проблем, а также для предотвращения их возникновения в будущем. В следующих разделах мы кратко расскажем о каждой области мониторинга Service Fabric для производственных рабочих нагрузок. 

## <a name="application-monitoring"></a>Мониторинг приложений
В процессе мониторинга приложений фиксируются особенности использования возможностей и компонентов приложения. Он позволяет перехватить проблемы, влияющие на пользователей. Ответственность за мониторинг приложения лежит на пользователях, разрабатывающих приложение и его службы, так как он привязан к бизнес-логике приложения. Мониторинг приложений может оказаться полезным в следующих случаях.
* Какой трафик моего приложения? — Нужно ли масштабировать службы для удовлетворения потребностей пользователей или устранения потенциального узкого места в приложении?
* Выполняются и отслеживаются ли вызовы между службами?
* Какие действия предпринимают пользователи моего приложения? — При разработке новых функций и выявлении ошибок в приложении можно ориентироваться на данные телеметрии.
* Выдает ли мое приложение необработанные исключения? 
* Что происходит в службах, выполняющихся в моих контейнерах?

Самое замечательное в мониторинге приложений — это то, что разработчики могут использовать любые инструменты и платформы, так как он выполняется в контексте приложения! Подробную информацию о решении Azure для мониторинга приложений с помощью Azure Monitor — Application Insights можно найти в [этой статье](service-fabric-diagnostics-event-analysis-appinsights.md).
У нас также есть руководство по [настройке мониторинга для приложений .NET](service-fabric-tutorial-monitoring-aspnet.md). Это руководство содержит инструкции по установке нужных инструментов и просмотру данных диагностики и телеметрии приложения на портале Azure, а также пример написания собственной телеметрии в приложении. 


## <a name="platform-cluster-monitoring"></a>Мониторинг платформы (кластера)
Пользователь контролирует, какие данные телеметрии поступают из его приложения, так как он сам пишет код, но что насчет данных диагностики с платформы Service Fabric? Одна из целей создания Service Fabric — это обеспечение работы приложения в случае сбоев оборудования. Это достигается благодаря способности системных служб платформы обнаруживать проблемы с инфраструктурой и быстро выполнять отработку отказа рабочих нагрузок на другие узлы в кластере. Но в этом случае, что делать, если в самих системных службах есть проблемы? Или если при попытке развертывания или перемещения рабочей нагрузки нарушаются правила размещения служб? Диагностика Service Fabric обеспечит вас информацией об этих и других действиях, происходящих в вашем кластере. Примеры сценариев для мониторинга кластера:

* Соответствует ли поведение Service Fabric моим ожиданиям с точки зрения размещения приложений и балансировки нагрузки в кластере? 
* Все ли пользователи кластера работают согласно установленных правил и все ли работает как ожидалось? (например, Масштабирование, отработка отказа, развертывания
* Ведет ли Service Fabric учет узлов, из которых состоит кластер, и информирует ли меня о проблемах?

Предоставляемые данные диагностики имеют форму исчерпывающего набора событий. Эти [события Service Fabric](service-fabric-diagnostics-events.md) иллюстрируют действия, выполняемые платформой с узлами, приложениями, службами, разделами и другими объектами. В последнем сценарии, при выходе узла из строя платформа издает событие `NodeDown`, и вы немедленно получаете уведомление от выбранного вами инструмента мониторинга. Также во время отработки отказа часто издаются события `ApplicationUpgradeRollbackStarted` и `PartitionReconfigured`. **Эти события доступны как для кластеров Windows, так и для кластеров Linux.**

События отправляются по стандартным каналам как в Windows, так и в Linux и могут считываться любым средством мониторинга, которое их поддерживает. Решение Azure Monitor — Log Analytics. Вы можете узнать больше об [интеграции Log Analytics](service-fabric-diagnostics-event-analysis-oms.md), которая включает специальную панель мониторинга для кластера и примеры запросов, из которых можно создавать оповещения. Узнайте больше о [создании событий и журналов на уровне платформы](service-fabric-diagnostics-event-generation-infra.md).

### <a name="health-monitoring"></a>Мониторинг работоспособности
Платформа Service Fabric включает модель работоспособности, которая обеспечивает расширяемую отчетность о состоянии работоспособности сущностей в кластере. Каждый узел, приложение, служба, секция, реплика или экземпляр имеют постоянно обновляемое состояние работоспособности, которое может иметь значение "ОК", "Предупреждение" или "Ошибка". Думайте о событиях Service Fabric как о командах, выполняемых кластером с различными объектами, а о работоспособности как о характеристике каждого объекта. Событие также издается при каждом изменении работоспособности объекта. Таким образом, вы можете настроить запросы и оповещения для событий работоспособности в выбранном вами инструменте мониторинга, как и любое другое событие. 

Кроме того, мы разрешаем пользователям переопределять работоспособность объектов. Если после обновления ваше приложение не проходит проверочные тесты, вы можете написать об этом в Service Fabric Health, используя API работоспособности, и Service Fabric автоматически откатит обновление! Чтобы узнать больше о модели работоспособности, прочитайте [этот обзор](service-fabric-health-introduction.md).

![Панель мониторинга работоспособности SFX](media/service-fabric-diagnostics-overview/sfx-healthstatus.png)


### <a name="watchdogs"></a>Модули наблюдения
Как правило, модуль наблюдения является отдельной службой, которая может отслеживать работоспособность и нагрузку в службах, проверять связь с конечными точками и сообщать о работоспособности любого элемента в кластере. Он позволяет предотвратить ошибки, которые невозможно обнаружить в контексте отдельной службы. Модули наблюдения также удобны для размещения кода, выполняющего корректирующие действия без участия пользователя (например, очистку файлов журнала в хранилище через определенные интервалы времени). Пример реализации службы наблюдения см. [здесь](https://github.com/Azure-Samples/service-fabric-watchdog-service).

## <a name="infrastructure-performance-monitoring"></a>Мониторинг инфраструктуры (производительности)
Теперь, когда мы рассмотрели диагностику в приложении и платформу, рассмотрим мониторинг оборудования. Мониторинг базовой инфраструктуры является ключевым в понимании состояния кластера и использовании ресурсов. Измерение производительности системы зависит от многих факторов, которые могут быть субъективными в зависимости от рабочих нагрузок. Эти факторы обычно измеряется с помощью счетчиков производительности. Они могут получать информацию из различных источников, включая операционную систему, платформу .NET Framework или платформу Service Fabric. Сценарии, в которых они будут полезны:

* Эффективно ли я использую свое оборудование? Вы хотите использовать оборудование на 90% или на 10% ресурсов ЦП? Это полезно при масштабировании кластера или оптимизации процессов приложения.
* Можно ли прогнозировать проблемы с инфраструктурой? — Возникновению многих проблем предшествуют внезапные изменения (снижения) производительности, поэтому для прогнозирования и диагностики таких проблем можно использовать счетчики производительности, такие как сетевые операции ввода-вывода и использование ЦП.

Список счетчиков производительности, которые необходимо собрать на уровне инфраструктуры, можно найти в статье [Метрики производительности](service-fabric-diagnostics-event-generation-perf.md). 

Service Fabric предоставляет набор счетчиков производительности для моделей программирования Reliable Services и Reliable Actors. Если вы используете одну из этих моделей, эти счетчики производительности помогут гарантировать правильное развертывание и свертывание субъектов или достаточно быструю обработку запросов к надежным службам. Дополнительные сведения см. в разделе [Счетчики производительности](service-fabric-reliable-serviceremoting-diagnostics.md#performance-counters) статьи "Диагностика и мониторинг производительности в модели Reliable Service Remoting" и разделе [Счетчики производительности](service-fabric-reliable-actors-diagnostics.md#performance-counters) статьи "Диагностика и мониторинг производительности в Reliable Actors". 

Решение Azure Monitor для сбора этих данных, как и для мониторинга на уровне платформы, — Log Analytics. Для сбора данных со счетчиков производительности и их просмотра в Log Analytics используйте [агент Log Analytics](service-fabric-diagnostics-oms-agent.md).

## <a name="recommended-setup"></a>Рекомендуемые настройки
Теперь, когда мы рассмотрели каждую область мониторинга и примеры сценариев, перечислим инструменты мониторинга Azure с настройками, необходимыми для мониторинга всех указанных выше областей. 

* Мониторинг приложений с помощью [Application Insights](service-fabric-tutorial-monitoring-aspnet.md)
* Мониторинг кластеров с помощью [агента диагностики](service-fabric-diagnostics-event-aggregation-wad.md) и [Log Analytics](service-fabric-diagnostics-oms-setup.md)
* Мониторинг инфраструктуры с помощью [Log Analytics](service-fabric-diagnostics-oms-agent.md)

Для автоматизации развертывания всех необходимых ресурсов и агентов также можно использовать и изменять расположенный [здесь](service-fabric-diagnostics-oms-setup.md#deploy-log-analytics-with-azure-resource-manager) шаблон ARM. 

## <a name="other-logging-solutions"></a>Другие решения для ведения журнала

Несмотря на то, что оба рекомендуемых решения, [Azure Log Analytics](service-fabric-diagnostics-event-analysis-oms.md) и [Application Insights](service-fabric-diagnostics-event-analysis-appinsights.md), обладают встроенными средствами интеграции с Service Fabric, фиксация многих событий производится поставщиками решений для трассировки событий Windows, и при этом их функциональность можно расширять с помощью других решений для фиксации событий в журналах. Стоит также обратить внимание на [Elastic Stack](https://www.elastic.co/products) (особенно если кластер будет выполняться в автономной среде), [Dynatrace](https://www.dynatrace.com/) или любую другую платформу по вашему выбору. [Здесь](service-fabric-diagnostics-partners.md) есть список интегрированных партнерских решений.

Основные моменты, на которые следует обратить внимание при выборе платформы: удобство пользовательского интерфейса, возможности запроса данных, доступные визуализации и панели мониторинга, а также наличие дополнительных инструментов для улучшения мониторинга. 

## <a name="next-steps"></a>Дополнительная информация

* Сведения по инструментальному контролю приложений см. в статье [Ведение журналов на уровне приложений и служб](service-fabric-diagnostics-event-generation-app.md).
* Выполните процедуру настройки Application Insights для приложения, следуя указаниям в разделе [Руководство. Мониторинг и диагностика приложения ASP.NET Core в Service Fabric](service-fabric-tutorial-monitoring-aspnet.md).
* Дополнительные сведения о мониторинге платформы и событиях, предоставляемых Service Fabric, см. в статье [Мониторинг кластера и платформы](service-fabric-diagnostics-event-generation-infra.md).
* Настройте интеграцию Log Analytics с Service Fabric, следуя инструкциям в [этой статье](service-fabric-diagnostics-oms-setup.md).
* Узнайте, как настроить Log Analytics для мониторинга контейнеров: [Мониторинг и диагностика контейнеров Windows в Azure Service Fabric](service-fabric-tutorial-monitoring-wincontainers.md).
* Примеры проблем и решений диагностики с помощью Service Fabric см. в описании [диагностики типичных сценариев](service-fabric-diagnostics-common-scenarios.md).
* Ознакомьтесь с другими продуктами диагностики, которые интегрируются с Service Fabric, в списке [партнерских решений диагностики Service Fabric](service-fabric-diagnostics-partners.md).
* Ознакомьтесь с общими рекомендациями по мониторингу ресурсов Azure в статье [Мониторинг и диагностика](https://docs.microsoft.com/azure/architecture/best-practices/monitoring). 