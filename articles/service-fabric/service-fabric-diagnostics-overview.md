---
title: Обзор мониторинга и диагностики Azure Service Fabric
description: Сведения о функциях мониторинга и диагностики для кластеров, приложений и служб Azure Service Fabric.
author: srrengar
ms.topic: conceptual
ms.date: 1/17/2019
ms.author: srrengar
ms.openlocfilehash: 25a50a2841a03929804be45be8012f9b5d0457ff
ms.sourcegitcommit: d95cab0514dd0956c13b9d64d98fdae2bc3569a0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2020
ms.locfileid: "91357137"
---
# <a name="monitoring-and-diagnostics-for-azure-service-fabric"></a>Мониторинг и диагностика для Azure Service Fabric

В статье представлен обзор мониторинга и диагностики в Azure. Мониторинг и диагностика критически важны для разработки, тестирования и развертывания рабочих нагрузок в любой облачной среде. Например, вы можете отслеживать использование приложений, действия, предпринимаемые платформой Service Fabric, использование ресурсов (с помощью счетчиков производительности) и общую работоспособность кластера. Эту информацию можно использовать для диагностики и устранения проблем, а также для предотвращения их возникновения в будущем. В следующих разделах мы кратко расскажем о каждой области мониторинга Service Fabric для производственных рабочих нагрузок. 

[!INCLUDE [azure-monitor-log-analytics-rebrand](../../includes/azure-monitor-log-analytics-rebrand.md)]

## <a name="application-monitoring"></a>Мониторинг приложений
В процессе мониторинга приложений фиксируются особенности использования возможностей и компонентов приложения. Он позволяет перехватить проблемы, влияющие на пользователей. Ответственность за мониторинг приложения лежит на пользователях, разрабатывающих приложение и его службы, так как он привязан к бизнес-логике приложения. Мониторинг приложений может оказаться полезным в следующих случаях.
* Какой трафик моего приложения? — Нужно ли масштабировать службы для удовлетворения потребностей пользователей или устранения потенциального узкого места в приложении?
* Выполняются и отслеживаются ли вызовы между службами?
* Какие действия предпринимают пользователи моего приложения? — При разработке новых функций и выявлении ошибок в приложении можно ориентироваться на данные телеметрии.
* Выдает ли мое приложение необработанные исключения? 
* Что происходит в службах, выполняющихся в моих контейнерах?

Самое замечательное в мониторинге приложений — это то, что разработчики могут использовать любые инструменты и платформы, так как он выполняется в контексте приложения! Подробную информацию о решении Azure для мониторинга приложений с помощью Azure Monitor — Application Insights можно найти в [этой статье](service-fabric-diagnostics-event-analysis-appinsights.md).
У нас также есть руководство по [настройке мониторинга для приложений .NET](service-fabric-tutorial-monitoring-aspnet.md). Это руководство содержит инструкции по установке нужных инструментов и просмотру данных диагностики и телеметрии приложения на портале Azure, а также пример написания собственной телеметрии в приложении. 


## <a name="platform-cluster-monitoring"></a>Мониторинг платформы (кластера)
Пользователь контролирует, какие данные телеметрии поступают из его приложения, так как он сам пишет код, но что насчет данных диагностики с платформы Service Fabric? Одна из целей создания Service Fabric — это обеспечение работы приложения в случае сбоев оборудования. Это достигается благодаря способности системных служб платформы обнаруживать проблемы с инфраструктурой и быстро выполнять отработку отказа рабочих нагрузок на другие узлы в кластере. Но в этом случае, что делать, если в самих системных службах есть проблемы? Или если при попытке развертывания или перемещения рабочей нагрузки нарушаются правила размещения служб? Диагностика Service Fabric обеспечит вас информацией об этих и других действиях, происходящих в вашем кластере. Примеры сценариев для мониторинга кластера:

Service Fabric предоставляет широкий набор готовых событий. Доступ к [событиям Service Fabric](service-fabric-diagnostics-events.md) можно получить через EventStore или операционный канал (канал событий, предоставляемый платформой). 

* Канал событий Service Fabric. В Windows доступ к событиям Service Fabric можно получить от одного поставщика трассировки событий Windows с набором соответствующих фильтров `logLevelKeywordFilters`, использующихся для переключения между каналами "Рабочая среда" и "Данные и обмен сообщениями". Так отделяются исходящие события Service Fabric для фильтрации нужным образом. В Linux все события Service Fabric проходят через LTTng и помещаются в одну таблицу службы хранения, в которой они могут быть отфильтрованы нужным образом. Эти каналы содержат проверенные структурированные события, которые помогают лучше понять состояние вашего кластера. Диагностика включается по умолчанию в момент создания кластера, и при этом создается таблица службы хранилища Azure, в которую отправляются события, поступающие из всех каналов для последующего запроса. 

* EventStore — это функция, предлагаемая этой платформой. Она предоставляет события платформы Service Fabric, доступные в Service Fabric Explorer, а также через REST API. Вы можете просмотреть моментальный снимок происходящих действий в кластере для каждой сущности, например для узла, службы или приложения, а также отправить запрос с учетом времени возникновения события. Дополнительные сведения о Евентсторе см. в статье [Обзор евентсторе](service-fabric-diagnostics-eventstore.md).    

![На снимке экрана показана вкладка события на панели узлы с несколькими событиями, включая событие Нодедовн.](media/service-fabric-diagnostics-overview/eventstore.png)

Предоставляемые данные диагностики имеют форму исчерпывающего набора событий. Эти [Service Fabric события](service-fabric-diagnostics-events.md) иллюстрируют действия, выполняемые платформой в различных сущностях, таких как узлы, приложения, службы, секции и т. д. В последнем сценарии, если узел был остановлен, платформа выдавала `NodeDown` событие, и вы можете немедленно получить уведомления от выбранного средства мониторинга. Также во время отработки отказа часто издаются события `ApplicationUpgradeRollbackStarted` и `PartitionReconfigured`. **Эти события доступны как для кластеров Windows, так и для кластеров Linux.**

События отправляются по стандартным каналам как в Windows, так и в Linux и могут считываться любым средством мониторинга, которое их поддерживает. Azure Monitor решение Azure Monitor журналы. Вы можете узнать больше о нашей [интеграции журналов Azure Monitor](service-fabric-diagnostics-event-analysis-oms.md) , которая включает настраиваемую рабочую панель мониторинга для кластера и некоторые примеры запросов, из которых можно создавать оповещения. Узнайте больше о [создании событий и журналов на уровне платформы](service-fabric-diagnostics-event-generation-infra.md).

### <a name="health-monitoring"></a>Мониторинг работоспособности
Платформа Service Fabric включает модель работоспособности, которая обеспечивает расширяемую отчетность о состоянии работоспособности сущностей в кластере. Каждый узел, приложение, служба, секция, реплика или экземпляр имеют постоянно обновляемое состояние работоспособности, которое может иметь значение "ОК", "Предупреждение" или "Ошибка". Думайте о событиях Service Fabric как о командах, выполняемых кластером с различными объектами, а о работоспособности как о характеристике каждого объекта. Событие также издается при каждом изменении работоспособности объекта. Таким образом, вы можете настроить запросы и оповещения для событий работоспособности в выбранном вами инструменте мониторинга, как и любое другое событие. 

Кроме того, мы разрешаем пользователям переопределять работоспособность объектов. Если после обновления ваше приложение не проходит проверочные тесты, вы можете написать об этом в Service Fabric Health, используя API работоспособности, и Service Fabric автоматически откатит обновление! Чтобы узнать больше о модели работоспособности, прочитайте [этот обзор](service-fabric-health-introduction.md).

![Панель мониторинга работоспособности SFX](media/service-fabric-diagnostics-overview/sfx-healthstatus.png)


### <a name="watchdogs"></a>Модули наблюдения
Как правило, модуль наблюдения является отдельной службой, которая может отслеживать работоспособность и нагрузку в службах, проверять связь с конечными точками и сообщать о работоспособности любого элемента в кластере. Это помогает предотвратить ошибки, которые не будут обнаружены для представления одной службы. Модули наблюдения также удобны для размещения кода, выполняющего корректирующие действия без участия пользователя (например, очистку файлов журнала в хранилище через определенные интервалы времени). Пример реализации службы наблюдения см. [здесь](https://github.com/Azure-Samples/service-fabric-watchdog-service).

## <a name="infrastructure-performance-monitoring"></a>Мониторинг инфраструктуры (производительности)
Теперь, когда мы рассмотрели диагностику в приложении и платформу, рассмотрим мониторинг оборудования. Мониторинг базовой инфраструктуры является ключевым в понимании состояния кластера и использовании ресурсов. Измерение производительности системы зависит от многих факторов, которые могут быть субъективными в зависимости от рабочих нагрузок. Эти факторы обычно измеряется с помощью счетчиков производительности. Они могут получать информацию из различных источников, включая операционную систему, платформу .NET Framework или платформу Service Fabric. Сценарии, в которых они будут полезны:

* Эффективно ли я использую свое оборудование? Вы хотите использовать оборудование на 90% или на 10% ресурсов ЦП? Это полезно при масштабировании кластера или оптимизации процессов приложения.
* Можно ли прогнозировать проблемы с инфраструктурой? — Возникновению многих проблем предшествуют внезапные изменения (снижения) производительности, поэтому для прогнозирования и диагностики таких проблем можно использовать счетчики производительности, такие как сетевые операции ввода-вывода и использование ЦП.

Список счетчиков производительности, которые необходимо собрать на уровне инфраструктуры, можно найти в статье [Метрики производительности](service-fabric-diagnostics-event-generation-perf.md). 

Service Fabric также предоставляет набор счетчиков производительности для моделей программирования Reliable Services и субъектов. Если вы используете одну из этих моделей, эти счетчики производительности помогут гарантировать правильное развертывание и свертывание субъектов или достаточно быструю обработку запросов к надежным службам. Дополнительные сведения см. в разделе [Счетчики производительности](service-fabric-reliable-serviceremoting-diagnostics.md#performance-counters) статьи "Диагностика и мониторинг производительности в модели Reliable Service Remoting" и разделе [Счетчики производительности](service-fabric-reliable-actors-diagnostics.md#performance-counters) статьи "Диагностика и мониторинг производительности в Reliable Actors". 

Azure Monitorным решением для их получения являются Azure Monitor журналы, такие как мониторинг на уровне платформы. Необходимо использовать [агент log Analytics](service-fabric-diagnostics-oms-agent.md) для получения соответствующих счетчиков производительности и их просмотра в журналах Azure Monitor.

## <a name="recommended-setup"></a>Рекомендуемые настройки
Теперь, когда мы рассмотрели каждую область мониторинга и примеры сценариев, перечислим инструменты мониторинга Azure с настройками, необходимыми для мониторинга всех указанных выше областей. 

* Мониторинг приложений с помощью [Application Insights](service-fabric-tutorial-monitoring-aspnet.md)
* Мониторинг кластера с помощью [агентов диагностики](service-fabric-diagnostics-event-aggregation-wad.md) и [журналов Azure Monitor](service-fabric-diagnostics-oms-setup.md)
* Мониторинг инфраструктуры с помощью [журналов Azure Monitor](service-fabric-diagnostics-oms-agent.md)

Для автоматизации развертывания всех необходимых ресурсов и агентов также можно использовать и изменять расположенный [здесь](service-fabric-diagnostics-oms-setup.md#deploy-azure-monitor-logs-with-azure-resource-manager) шаблон ARM. 

## <a name="other-logging-solutions"></a>Другие решения для ведения журнала

Несмотря на то, что эти два решения рекомендуются, [Azure Monitor журналы](service-fabric-diagnostics-event-analysis-oms.md) и [Application Insights](service-fabric-diagnostics-event-analysis-appinsights.md) имеют встроенную интеграцию с Service Fabric, многие события записываются с помощью поставщиков ETW и расширяются с помощью других решений для ведения журналов. Стоит также обратить внимание на [Elastic Stack](https://www.elastic.co/products) (особенно если кластер будет выполняться в автономной среде), [Dynatrace](https://www.dynatrace.com/) или любую другую платформу по вашему выбору. [Здесь](service-fabric-diagnostics-partners.md) есть список интегрированных партнерских решений.

Основные моменты, на которые следует обратить внимание при выборе платформы: удобство пользовательского интерфейса, возможности запроса данных, доступные визуализации и панели мониторинга, а также наличие дополнительных инструментов для улучшения мониторинга. 

## <a name="next-steps"></a>Дальнейшие действия

* Сведения о начале работы с инструментированием приложений см. в разделе [Создание событий и журналов на уровне приложения](service-fabric-diagnostics-event-generation-app.md).
* Выполните процедуру настройки Application Insights для приложения, следуя указаниям в разделе [Руководство. Мониторинг и диагностика приложения ASP.NET Core в Service Fabric](service-fabric-tutorial-monitoring-aspnet.md).
* Дополнительные сведения о наблюдении за платформой и событиями, предоставляемыми Service Fabric, см. в статье [события уровня платформы и создание журнала](service-fabric-diagnostics-event-generation-infra.md).
* Настройка интеграции журналов Azure Monitor с Service Fabric в [настройке журналов Azure Monitor для кластера](service-fabric-diagnostics-oms-setup.md)
* Узнайте, как настроить журналы Azure Monitor для мониторинга контейнеров — [мониторинг и диагностика контейнеров Windows в Service Fabric Azure](service-fabric-tutorial-monitoring-wincontainers.md).
* Примеры проблем и решений диагностики с помощью Service Fabric см. в описании [диагностики типичных сценариев](service-fabric-diagnostics-common-scenarios.md).
* Ознакомьтесь с другими продуктами диагностики, которые интегрируются с Service Fabric, в списке [партнерских решений диагностики Service Fabric](service-fabric-diagnostics-partners.md).
* Ознакомьтесь с общими рекомендациями по мониторингу ресурсов Azure в статье [Мониторинг и диагностика](/azure/architecture/best-practices/monitoring). 
