---
title: Руководство по созданию инфраструктуры для кластера Service Fabric на виртуальных машинах Azure — Azure Service Fabric | Документация Майкрософт
description: В этом руководстве содержатся сведения о настройке инфраструктуры виртуальных машин Azure для запуска кластера Service Fabric.
services: service-fabric
documentationcenter: .net
author: jpconnock
manager: jpconnock
editor: ''
ms.assetid: ''
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: tutorial
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/22/2019
ms.author: jeconnoc
ms.custom: mvc
ms.openlocfilehash: b24b4d95827dbd398c0eba43dcbad9fbfeb51469
ms.sourcegitcommit: 4821b7b644d251593e211b150fcafa430c1accf0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/19/2019
ms.locfileid: "74166275"
---
# <a name="tutorial-create-azure-vm-infrastructure-to-host-a-service-fabric-cluster"></a>Руководство по созданию инфраструктуры виртуальных машин Azure для размещения кластера Service Fabric

Изолированные кластеры Service Fabric предоставляют возможность выбрать собственную среду и создать кластер в рамках подхода "любая ОС, любое облако", который применяется на платформе Service Fabric. Из этой серии руководств вы узнаете, как создать изолированный кластер, размещенный в виртуальной машине Azure, и установить в нем приложение.

Это руководство представляет первую часть цикла. В рамках этой статьи вы создадите ресурсы виртуальной машины Azure, необходимые для размещения автономного кластера Service Fabric. В следующих статьях вам нужно будет установить автономный пакет Service Fabric, а также пример приложения в кластере, и наконец, очистить кластер.

В первой части цикла вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Создание набора экземпляров виртуальных машин Azure
> * Изменение группы безопасности.
> * Вход на один из экземпляров.
> * Подготовка экземпляра для Service Fabric.

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством вам потребуется подписка Azure.  Если у вас еще нет учетной записи, создайте ее, перейдя в [портал Azure](https://portal.azure.com).

## <a name="create-azure-virtual-machine-instances"></a>Создание экземпляров виртуальных машин Azure

1. Войдите на портал Azure и щелкните **Виртуальные машины**  (не "Виртуальные машины (классические)").

   ![Виртуальная машина портала Azure][az-console]

2. Нажмите кнопку **Добавить**, чтобы открыть форму **Создать виртуальную машину**.

3. На вкладке **Основные сведения** необходимо выбрать нужную подписку и группу ресурсов (рекомендуется использовать новую группу ресурсов).

4. Измените тип **Изображение** на **Центр обработки данных Windows Server 2016**. 
 
5. Измените **Размер** экземпляра на **Standard DS2 v2**. Задайте **Имя пользователя** и **Пароль** администратора, отметив их.

6. Пока оставьте **Правила входящего порта** заблокированными; мы настроим их в следующем разделе.

7. На вкладке **Сеть** создайте новую **виртуальную сеть** и запомните ее название.

8. Затем установите для **группы безопасности сети сетевого адаптера** на **расширенный**. Создайте новую группу безопасности, отметив ее имя, а также создайте следующие правила для разрешения трафика TCP из любого источника:

   ![sf-inbound][sf-inbound]

   * Порт `3389`, для протокола удаленного рабочего стола и ICMP (базовые параметры подключения).
   * Порты `19000-19003`, для Service Fabric.
   * Порты `19080-19081`, для Service Fabric.
   * Порт `8080`, для запроса веб-браузера.

   > [!TIP]
   > Чтобы подключить между собой виртуальные машины в Service Fabric, виртуальные машины, содержащие вашу инфраструктуру, должны иметь одинаковые учетные данные.  Существует два распространенных способа получения согласованных учетных данных: присоедините все виртуальные машины к одному домену или установите один и тот же пароль администратора на каждой виртуальной машине. К счастью, Azure позволяет легко подключать все виртуальные машины в одной **виртуальной сети**, поэтому мы будем уверены, что все наши экземпляры будут в одной сети.

9. Добавление еще одного правила. Задайте в качестве источника **тег службы**, а в качестве тега службы источника — **VirtualNetwork**. Для Service Fabric необходимо, чтобы для связи внутри кластера были открыты следующие порты: 135,137-139,445,20001-20031,20606-20861.

   ![vnet-inbound][vnet-inbound]

10. Остальные параметры допустимы в состоянии по умолчанию. Просмотрите их, если хотите, и затем запустите виртуальную машину.

## <a name="creating-more-instances-for-your-service-fabric-cluster"></a>Создание дополнительных экземпляров для кластера Service Fabric

Запустите еще две **виртуальные машины**, убедившись, что они поддерживают те же параметры, что и в предыдущем разделе. Прежде всего сохраните одно и то же имя пользователя и пароль администратора. **Виртуальная сеть** и **группа безопасности сети сетевого адаптера** не должны создаваться повторно; выберите те, которые вы уже создали из раскрывающегося меню. Для развертывания каждого из экземпляров может потребоваться несколько минут.

## <a name="connect-to-your-instances"></a>Подключение к экземплярам

1. Выберите один из ваших экземпляров в разделе **Виртуальная машина**.

2. На вкладке **Обзор** запишите *частный* IP-адрес. Щелкните **Подключить**.

3. На вкладке **RDP** обратите внимание, что мы используем общедоступный IP-адрес и порт 3389, который мы специально открыли ранее. Скачайте RDP-файл.
 
4. Откройте RDP-файл и при появлении запроса введите имя пользователя и пароль, указанные в программе установки виртуальной машины.

5. После подключения к экземпляру вам нужно будет проверить, запущен ли удаленный реестр, включен ли SMB и открыты ли необходимые порты для SMB и удаленного реестра.

   Включить SMB можно с помощью команды PowerShell:

   ```powershell
   netsh advfirewall firewall set rule group="File and Printer Sharing" new enable=Yes
   ```

6. Чтобы открыть порты в брандмауэре, выполните команду PowerShell:

   ```powershell
   New-NetFirewallRule -DisplayName "Service Fabric Ports" -Direction Inbound -Action Allow -RemoteAddress LocalSubnet -Protocol TCP -LocalPort 135, 137-139, 445
   ```

7. Повторите этот процесс для других экземпляров, снова отметив частные IP-адреса.

## <a name="verify-your-settings"></a>Проверьте свои настройки

1. Чтобы проверить базовые параметры подключения, подключитесь к одной из виртуальных машин, используя протокол удаленного рабочего стола.

2. Откройте **командную строку** из этой виртуальной машины, затем используйте команду "ping" для подключения одной виртуальной машины к другой, заменив указанный ниже IP-адрес одним из частных IP-адресов, которые вы указали ранее (не IP-адресом виртуальной машины, к которой вы уже подключены).

   ```
   ping 172.31.20.163
   ```

   Если ваш результат выглядит следующим образом `Reply from 172.31.20.163: bytes=32 time<1ms TTL=128` и повторяется четыре раза, это означает, что ваше соединение между экземплярами работает.

3. Теперь с помощью следующей команды проверьте, работает ли SMB:

   ```
   net use * \\172.31.20.163\c$
   ```

   Она должна возвратить следующие выходные данные: `Drive Z: is now connected to \\172.31.20.163\c$.`.


   Теперь экземпляры правильно подготовлены для Service Fabric.

## <a name="next-steps"></a>Дополнительная информация

В первой части цикла вы узнали, как запустить три экземпляра виртуальных машин Azure и настроить их для установки Service Fabric:

> [!div class="checklist"]
> * Создание набора экземпляров виртуальных машин Azure
> * Изменение группы безопасности.
> * Вход на один из экземпляров.
> * Подготовка экземпляра для Service Fabric.

Перейдите ко второй части цикла, чтобы настроить Service Fabric на кластере.

> [!div class="nextstepaction"]
> [Руководство по установке и созданию кластера Service Fabric](service-fabric-tutorial-standalone-create-service-fabric-cluster.md)

<!-- IMAGES -->
[az-console]: ./media/service-fabric-tutorial-standalone-azure-create-infrastructure/az-console.png
[sf-inbound]: ./media/service-fabric-tutorial-standalone-azure-create-infrastructure/sf-inbound.png
[vnet-inbound]: ./media/service-fabric-tutorial-standalone-azure-create-infrastructure/vnet-inbound.png
