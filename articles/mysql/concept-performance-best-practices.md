---
title: Рекомендации по производительности — база данных Azure для MySQL
description: В этой статье описаны некоторые рекомендации по мониторингу и настройке производительности для базы данных Azure для MySQL.
author: Bashar-MSFT
ms.author: bahusse
ms.service: mysql
ms.topic: conceptual
ms.date: 1/28/2021
ms.openlocfilehash: 46c7952247babd528b230dfa0e70b0eb47878912
ms.sourcegitcommit: 54e1d4cdff28c2fd88eca949c2190da1b09dca91
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/31/2021
ms.locfileid: "99217760"
---
# <a name="best-practices-for-optimal-performance-of-your-azure-database-for-mysql---single-server"></a>Рекомендации по оптимальной производительности базы данных Azure для MySQL — одиночный сервер

Узнайте, как обеспечить наилучшую производительность при работе с базой данных Azure для MySQL — на одном сервере. По мере добавления новых возможностей на платформу мы продолжим уточнение наших рекомендаций в этом разделе.

## <a name="physical-proximity"></a>Физическое сходство

 Убедитесь, что приложение и база данных развернуты в одном регионе. Быстрая проверка перед запуском любого теста производительности заключается в определении задержки сети между клиентом и базой данных с помощью простого запроса SELECT 1. 

## <a name="accelerated-networking"></a>Ускорение работы в сети

Используйте ускоренную сеть для сервера приложений, если вы используете виртуальную машину Azure, Azure Kubernetes или службы приложений. Функция ускорения работы в сети позволяет использовать виртуализацию ввода-вывода с единым корнем (SR-IOV), повышая тем самым производительность сети виртуальной машины. Этот высокопроизводительный метод обеспечивает обход узла на пути к данным, что уменьшает задержку, дрожание и нагрузку ЦП. Он предназначен для ресурсоемких рабочих нагрузок сети на виртуальных машинах поддерживаемых типов.

## <a name="connection-efficiency"></a>Эффективность подключения

Установка нового соединения всегда является дорогостоящей и трудоемкой задачей. Когда приложение запрашивает подключение к базе данных, оно определяет приоритет выделения существующих бездействующих подключений к базе данных, а не создает новый.  Ниже приведены некоторые параметры для оптимальных методов подключения.

- **Проксискл**. Используйте [проксискл](https://proxysql.com/) , который предоставляет встроенные пулы подключений и [распределяет нагрузку](https://techcommunity.microsoft.com/t5/azure-database-for-mysql/load-balance-read-replicas-using-proxysql-in-azure-database-for/ba-p/880042) по нескольким репликам чтения, как это необходимо по запросу, с любыми изменениями в коде приложения.

- **Прокси-сервер данных Heimdall**. Кроме того, можно также использовать прокси-сервер данных Heimdall — специализированное прокси-решение, не зависящее от поставщика. Он поддерживает кэширование запросов и разделение чтения и записи с обнаружением задержки репликации. Вы также можете обратиться к статье [ускорение производительности MySQL с помощью прокси-сервера Heimdall](https://techcommunity.microsoft.com/t5/azure-database-for-mysql/accelerate-mysql-performance-with-the-heimdall-proxy/ba-p/1063349).  

- **Постоянное или Long-Livedное подключение**: Если приложение содержит короткие транзакции или запросы, обычно с временем выполнения < 5-10 мс, замените короткие подключения на постоянные подключения. Замена коротких соединений на постоянные подключения требует лишь незначительных изменений в коде, но он оказывает значительное влияние в плане повышения производительности во многих типичных сценариях приложений. Не забудьте установить время ожидания или закрыть соединение по завершении транзакции.

- **Реплика**. Если вы используете реплику, используйте [проксискл](https://proxysql.com/) для балансировки нагрузки между сервером-источником и доступным для чтения сервером вторичной реплики. Узнайте [, как настроить проксискл](https://techcommunity.microsoft.com/t5/azure-database-for-mysql/scaling-an-azure-database-for-mysql-workload-running-on/ba-p/1105847).

## <a name="data-import-configurations"></a>Конфигурации импорта данных

- Можно временно масштабировать экземпляр до более высокого размера SKU перед началом операции импорта данных, а затем масштабировать его после успешного завершения импорта.
- Вы можете импортировать данные с минимальным временем простоя с помощью [Azure Database Migration Service (DMS)](https://datamigration.microsoft.com/) для оперативной или автономной миграции. 

## <a name="azure-database-for-mysql-memory-recommendations"></a>Рекомендации по использованию памяти базой данных Azure для MySQL

Для обеспечения производительности базы данных Azure для MySQL рекомендуется выделить достаточно ОЗУ, чтобы рабочий набор находился почти полностью в памяти. 

- Проверьте, используется ли процент использования памяти для достижения [лимитов](./concepts-pricing-tiers.md) с помощью [метрик для сервера MySQL](./concepts-monitoring.md). 
- Настройте оповещения по таким числам, чтобы гарантировать, что по мере того, как серверы будут превышены, можно предпринять действия по приглашению для их исправления. В зависимости от определенных ограничений проверьте, масштабируется ли размер SKU базы данных — либо до более высокого размера вычислений, либо до лучшей ценовой категории, что приводит к значительному увеличению производительности. 
- Увеличение масштаба до тех пор, пока номера производительности больше не будут значительно удалены после операции масштабирования. Сведения о мониторинге метрик экземпляра базы данных см. в разделе [метрики базы данных MySQL](./concepts-monitoring.md#metrics).
 
## <a name="use-innodb-buffer-pool-warmup"></a>Использование прогрева буферного пула InnoDB

После перезапуска сервера базы данных Azure для MySQL страницы данных, находящиеся в хранилище, загружаются по мере запроса таблиц, что приводит к увеличению задержки и снижению производительности при первом выполнении запросов. Это может быть неприемлемым для рабочих нагрузок с учетом задержки. 

Использование буферного пула InnoDB позволяет сократить период прогрева, перезагружая страницы диска, которые были в буферном пуле до перезапуска, а не ожидая операций DML или SELECT для доступа к соответствующим строкам.

Вы можете уменьшить период прогрева после перезапуска сервера базы данных Azure для MySQL, который представляет собой преимущество производительности путем настройки [параметров сервера буферного пула InnoDB](https://dev.mysql.com/doc/refman/8.0/en/innodb-preload-buffer-pool.html). InnoDB сохраняет процент последних использованных страниц для каждого буферного пула при завершении работы сервера и восстанавливает эти страницы при запуске сервера.

Также важно отметить, что повышение производительности достигается за счет более длительного времени запуска сервера. Если этот параметр включен, ожидается увеличение времени запуска и перезапуска сервера в зависимости от количества операций ввода-вывода, подготовленных на сервере. 

Мы рекомендуем протестировать и отслеживать время перезапуска, чтобы обеспечить приемлемую производительность при запуске и перезапуске, так как сервер в это время недоступен. Не рекомендуется использовать этот параметр с менее 1000 подготовленных операций ввода-вывода в секунду (или иными словами, когда подготовленное хранилище меньше 335 ГБ).

Чтобы сохранить состояние буферного пула при завершении работы сервера, задайте для параметра сервера значение `innodb_buffer_pool_dump_at_shutdown` `ON` . Аналогичным образом задайте для параметра сервера значение, `innodb_buffer_pool_load_at_startup` `ON` чтобы восстановить состояние буферного пула при запуске сервера. Можно управлять влиянием на время запуска или перезапуска путем уменьшения и точной настройки значения параметра сервера `innodb_buffer_pool_dump_pct` . По умолчанию этот параметр имеет значение `25`.

> [!Note]
> Параметры прогрева буферного пула InnoDB поддерживаются только на серверах хранилища общего назначения с хранилищем объемом до 16 ТБ. Дополнительные сведения о [параметрах хранилища базы данных Azure для MySQL](https://docs.microsoft.com/azure/mysql/concepts-pricing-tiers#storage)см. здесь.

## <a name="next-steps"></a>Дальнейшие действия

- [Рекомендации по работе сервера с базой данных Azure для MySQL](concept-operation-excellence-best-practices.md) <br/>
- [Рекомендации по мониторингу базы данных Azure для MySQL](concept-monitoring-best-practices.md)<br/>
- [Приступая к работе с базой данных Azure для MySQL](quickstart-create-mysql-server-database-using-azure-portal.md)<br/>