---
title: Рекомендации по планированию сети Azure NetApp Files | Документация Майкрософт
description: Узнайте о рекомендациях, которые помогут спроектировать эффективную сетевую архитектуру на основе Azure NetApp Files.
services: azure-netapp-files
documentationcenter: ''
author: ram-kakani
manager: ''
editor: ''
ms.assetid: ''
ms.service: azure-netapp-files
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 09/08/2020
ms.author: ramakk
ms.openlocfilehash: 50669dcce044988f2e45acc2a17ae43c140d1ab5
ms.sourcegitcommit: 50802bffd56155f3b01bfb4ed009b70045131750
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91930311"
---
# <a name="guidelines-for-azure-netapp-files-network-planning"></a>Рекомендации по планированию сети Azure NetApp Files

Планирование архитектуры сети — это ключевой элемент в разработке любой инфраструктуры приложений. Эта статья поможет вам спроектировать для рабочих нагрузок эффективную сетевую архитектуру с поддержкой широких возможностей Azure NetApp Files.

Тома Azure NetApp Files размещаются в специализированной [делегированной подсети](../virtual-network/virtual-network-manage-subnet.md) в пределах виртуальной сети Azure. Это позволяет обращаться к томам непосредственно из виртуальной сети, из пиринговых виртуальных сетей в том же регионе или из локальной среды через шлюз виртуальной сети (ExpressRoute или VPN). Эта подсеть выделяется исключительно для Azure NetApp Files и не имеет подключений к другим службам Azure или Интернету.

## <a name="considerations"></a>Рекомендации  

При планировании сети для Azure NetApp Files следует учитывать некоторые аспекты.

### <a name="constraints"></a>Ограничения

В настоящее время для Azure NetApp Files не поддерживаются следующие возможности: 

* группы сетевой безопасности (NSG) для делегированной подсети;
* определяемые пользователем маршруты для делегированной подсети;
* политики Azure (например, пользовательские политики именования) для интерфейса Azure NetApp Files;
* подсистемы балансировки нагрузки для трафика Azure NetApp Files;
* Виртуальная глобальная сеть Azure (WAN) 
* шлюзы виртуальной сети с избыточностью зоны (SKU шлюзов с AZ); 
* шлюзы виртуальной сети в режиме "активный — активный". 
* Виртуальная сеть с двумя стеками (IPv4 и IPv6)

Кроме того, к Azure NetApp Files применяются следующие сетевые ограничения:

* Число IP-адресов, используемых в виртуальной сети с Azure NetApp Files (включая одноранговые соединения), не может превышать 1000. Мы работаем над тем, чтобы расширить это ограничение с учетом требований клиентов к масштабированию. 
* В каждой виртуальной сети Azure можно делегировать только одну подсеть для Azure NetApp Files.


### <a name="supported-network-topologies"></a>Поддерживаемые топологии сети

В следующей таблице описаны сетевые топологии, поддерживаемые в Azure NetApp Files.  Здесь также представлены решения для неподдерживаемых топологий. 

|    Топологии    |    Поддерживается    |     Обходной путь    |
|-------------------------------------------------------------------------------------------------------------------------------|--------------------|-----------------------------------------------------------------------------|
|    Подключение к тому в локальной виртуальной сети    |    Да    |         |
|    Подключение к тому в одноранговой виртуальной сети того же региона    |    Да    |         |
|    Подключение к тому в одноранговой виртуальной сети другого региона или глобального пиринга    |    нет    |    None    |
|    Подключение к тому через шлюз ExpressRoute    |    Да    |         |
|    Подключение из локальной среды к тому в периферийной виртуальной сети через шлюз ExpressRoute и пиринг виртуальных сетей с транзитом через шлюз    |    Да    |        |
|    Подключение из локальной среды к тому в периферийной виртуальной сети через шлюз VPN    |    Да    |         |
|    Подключение из локальной среды к тому в периферийной виртуальной сети через шлюз VPN и пиринг виртуальных сетей с транзитом через шлюз    |    Да    |         |


## <a name="virtual-network-for-azure-netapp-files-volumes"></a>Виртуальная сеть для томов Azure NetApp Files

В этом разделе объясняются основные понятия, которые помогут в планировании виртуальных сетей.

### <a name="azure-virtual-networks"></a>Виртуальные сети Azure

Перед подготовкой тома Azure NetApp Files вам нужно создать новую виртуальную сеть в Azure или использовать существующую в подписке. Эта виртуальная сеть определяет границу сети для тома.  Дополнительные сведения о создании виртуальных сетей см. в [документации по виртуальным сетям Azure](../virtual-network/virtual-networks-overview.md).

### <a name="subnets"></a>Подсети

Подсети сегментируют виртуальную сеть на отдельные адресные пространства, которые используют размещаемые в них ресурсы Azure.  Тома Azure NetApp Files размещаются в специализированной [делегированной подсети](../virtual-network/virtual-network-manage-subnet.md). 

Делегирование подсети явно разрешает службе Azure NetApp Files создавать в этой подсети необходимые для службы ресурсы.  При развертывании службы используется уникальный идентификатор. В этом случае создается сетевой интерфейс, поддерживающий подключение к Azure NetApp Files.

Если вы используете новую виртуальную сеть, можно создать подсеть и делегировать ее службе Azure NetApp Files, выполнив инструкции из статьи [Делегирование подсети службе Azure NetApp Files](azure-netapp-files-delegate-subnet.md). Можно также делегировать существующую пустую подсеть, которая еще не делегирована другим службам.

Если виртуальная сеть участвует в пиринге с другой виртуальной сетью, вы не сможете расширить адресное пространство этой виртуальной сети. Это означает, что делегированную подсеть нужно создавать в уже имеющемся адресном пространстве виртуальной сети. Если адресное пространство необходимо расширить, сначала удалите пиринг виртуальной сети.

### <a name="udrs-and-nsgs"></a>Определяемые пользователем маршруты и группы безопасности сети

Определяемые пользователем маршруты (UDR) и группы безопасности сети (NSG) в настоящее время не поддерживаются в делегированных подсетях для Azure NetApp Files. Но вы можете применять UDR и NSG к другим подсетям, в том числе к расположенным в той же виртуальной сети, что и делегированная подсеть Azure NetApp Files.

* UDR помогут организовать трафик из других подсетей в делегированную подсеть Azure NetApp Files. Следовательно, трафик будет соответствовать потокам из Azure NetApp Files в другие подсети с использованием системных маршрутов.  
* Группы NSG в этом случае будут разрешать или запрещать трафик для делегированной подсети Azure NetApp Files. 

## <a name="azure-native-environments"></a>Собственные среды Azure

На следующей схеме представлена собственная среда Azure.

![Собственная сетевая среда Azure](../media/azure-netapp-files/azure-netapp-files-network-azure-native-environment.png)

### <a name="local-vnet"></a>Локальная виртуальная сеть

Основной сценарий заключается в создании тома Azure NetApp Files или подключении к уже существующему тому из виртуальной машины в той же виртуальной сети. На приведенной выше схеме в виртуальной сети 2 создается том 1 в делегированной подсети, который затем можно подключить к виртуальной машине 1 в подсети по умолчанию.

### <a name="vnet-peering"></a>Пиринговая связь между виртуальными сетями

Если у вас есть другие виртуальные сети в том же регионе, которым нужен доступ к ресурсам друг друга, виртуальные сети можно объединить с помощью [пиринга виртуальных сетей](../virtual-network/virtual-network-peering-overview.md), создавая безопасное подключение через инфраструктуру Azure. 

Обратите внимание на виртуальные сети 2 и 3 на приведенной выше схеме. Если виртуальной машине 1 нужно подключиться к виртуальной машине 2 или тому 2, или виртуальной машине 2 нужно подключиться к виртуальной машине 1 или тому 1, включите пиринг виртуальных сетей между виртуальными сетями 2 и 3. 

Давайте рассмотрим еще один пример, в котором виртуальная сеть 1 соединена пирингом с виртуальной сетью 2, а виртуальная сеть 2 — с виртуальной сетью 3 в том же регионе. Ресурсы из виртуальной сети 1 могут подключаться к ресурсам в виртуальной сети 2, но не могут подключаться к ресурсам в виртуальной сети 3, пока не будет настроен дополнительный пиринг между виртуальными сетями 1 и 3. 

На приведенной выше схеме виртуальная машина 3 может подключиться к тому 1, но виртуальная машина 4 не может подключиться к тому 2.  Это связано с тем, что между периферийными виртуальными сетями пиринг отсутствует, а _транзитная маршрутизация через пиринг виртуальных сетей не поддерживается_.

## <a name="hybrid-environments"></a>Гибридные среды

На следующей схеме представлена гибридная среда. 

![Собственная сетевая среда](../media/azure-netapp-files/azure-netapp-files-network-hybrid-environment.png)

В гибридном сценарии приложениям из локальных центров обработки данных требуется доступ к ресурсам в Azure.  Это происходит, если вы хотите расширить центр обработки данных в Azure или использовать облачных служб Azure для аварийного восстановления. Сведения о подключении нескольких локальных ресурсов к ресурсам в Azure с помощью VPN-подключения типа "сеть — сеть" или ExpressRoute см. в [описании вариантов планирования VPN-шлюза](../vpn-gateway/vpn-gateway-about-vpngateways.md?toc=%252fazure%252fvirtual-network%252ftoc.json#planningtable).

В звездообразной гибридной топологии центральная виртуальная сеть, размещенная в Azure, выполняет роль центральной точки подключения к локальной сети. Периферийными называются виртуальные сети, для которых настроен пиринг с центральной сетью. Они могут использоваться для изоляции рабочих нагрузок.

В зависимости от конфигурации это позволяет подключать локальные ресурсы к ресурсам в центральной и периферийных виртуальных сетях.

В описанной выше топологии локальная сеть подключена к центральной виртуальной сети в Azure, а две периферийные виртуальные сети в том же регионе участвуют в пиринге с центральной виртуальной сетью.  В этом сценарии для томов Azure NetApp Files поддерживаются следующие механизмы подключения:

* локальные ресурсы виртуальных машин 1 и 2 могут подключаться к тому 1 в центральной виртуальной сети через VPN-подключение типа "сеть — сеть" или канал ExpressRoute; 
* локальные ресурсы виртуальных машин 1 и 2 могут подключаться к томам 2 и 3 через VPN-подключение типа "сеть — сеть" или региональный пиринг виртуальных сетей;
* виртуальная машина 3 в центральной виртуальной сети может подключаться к тому 2 в периферийной виртуальной сети 1 и тому 3 в периферийной виртуальной сети 2;
* виртуальная машина 4 в периферийной виртуальной сети 1 и виртуальная машина 5 в периферийной виртуальной сети 2 могут подключаться к тому 1 в центральной виртуальной сети;
* виртуальная машина 4 в периферийной виртуальной сети 1 не может подключаться к тому 3 в периферийной виртуальной сети 2; виртуальная машина 5 в периферийной виртуальной сети 2 также не может подключаться к тому 2 в периферийной виртуальной сети 1. Это связано с тем, что между периферийными виртуальными сетями пиринг отсутствует, а _транзитная маршрутизация через пиринг виртуальных сетей не поддерживается_.
* В описанной выше архитектуре предполагается, что, если в периферийной виртуальной сети также существует шлюз, подключение к тому Azure NetApp Files из локальной среды, подключенной через шлюз в центральной виртуальной сети, будет разорвано. Стандартное поведение определяет, что приоритет отдается шлюзу в периферийной виртуальной сети, так что только подключенные к этому шлюзу компьютеры получают доступ к тому Azure NetApp Files.

## <a name="next-steps"></a>Дальнейшие действия

[Делегирование подсети службе Azure NetApp Files](azure-netapp-files-delegate-subnet.md)