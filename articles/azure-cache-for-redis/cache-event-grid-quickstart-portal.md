---
title: Краткое руководство. Маршрутизация событий Кэша Azure для Redis в конечную веб-точку с помощью портала Azure
description: Сведения о том, как с помощью Сетки событий Azure подписаться на события Кэша Azure для Redis, передать события веб-перехватчику и обработать события в приложении
ms.date: 1/5/2021
ms.topic: quickstart
ms.service: cache
author: curib
ms.author: cauribeg
ms.openlocfilehash: 5bdd6b0e6f97f7e5a738ab17d68282cf402004b0
ms.sourcegitcommit: d1e56036f3ecb79bfbdb2d6a84e6932ee6a0830e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2021
ms.locfileid: "99056517"
---
# <a name="quickstart-route-azure-cache-for-redis-events-to-web-endpoint-with-the-azure-portal"></a>Краткое руководство. Маршрутизация событий Кэша Azure для Redis в конечную веб-точку с помощью портала Azure

"Сетка событий Azure" — это служба обработки событий для облака. При работе с этим кратким руководством вы с помощью портала Azure создадите экземпляр Кэша Azure для Redis и подписку на события этого экземпляра, затем сгенерируете событие и проверите полученные результаты. Как правило, события отправляются на конечную точку, которая обрабатывает данные событий и выполняет соответствующие действия. Для простоты в этом кратком руководстве описана отправка событий непосредственно в веб-приложение, которое будет собирать и отображать эти сообщения. 

[!INCLUDE [quickstarts-free-trial-note.md](../../includes/quickstarts-free-trial-note.md)]

По завершении вы увидите, что данные событий отправлены в веб-приложение.

:::image type="content" source="media/cache-event-grid-portal/event-grid-scaling.png" alt-text="Масштабирование средства просмотра Сетки событий Azure в формате JSON.":::

## <a name="create-an-azure-cache-for-redis-cache-instance"></a>Создание экземпляра Кэша Azure для Redis 

[!INCLUDE [redis-cache-create](../../includes/redis-cache-create.md)]

## <a name="create-a-message-endpoint"></a>Создание конечной точки сообщения

Перед созданием подписки на события экземпляра кэша необходимо создать конечную точку для сообщения о событии. Обычно конечная точка выполняет действия на основе данных событий. Чтобы упростить работу с этим руководством, вы развернете [готовое веб-приложение](https://github.com/Azure-Samples/azure-event-grid-viewer), в котором отображаются сообщения о событиях. Развернутое решение содержит план службы приложений, веб-приложение службы приложений и исходный код из GitHub.

1. Выберите элемент **Развертывание в Azure** в разделе README на сайте GitHub, чтобы развернуть решение в своей подписке. 

:::image type="content" source="media/cache-event-grid-portal/deploy-to-azure.png" alt-text="Кнопка &quot;Развертывание в Azure&quot;":::

2. На странице **Настраиваемое развертывание** выполните следующие действия: 
    1. В качестве **группы ресурсов** выберите ту же группу ресурсов, которую вы создали при создании экземпляра кэша. После завершения работы с руководством вам будет проще выполнить очистку, удалив группу ресурсов.  
    2. В поле **Имя сайта** введите имя веб-приложения.
    3. В поле **Имя плана размещения** введите имя плана службы приложений для размещения веб-приложения.
    4. Установите флажок **Я принимаю указанные выше условия**. 
    5. Щелкните **Приобрести**. 
    
    | Параметр      | Рекомендуемое значение  | Описание |
    | ------------ |  ------- | -------------------------------------------------- |
    | **Подписка** | Раскройте список и выберите нужную подписку. | Подписка, в которой нужно создать веб-приложение. | 
    | **Группа ресурсов** | Раскройте список и выберите группу ресурсов или нажмите **Создать** и введите имя для новой группы ресурсов. | Поместив все ресурсы приложения в одну группу ресурсов, вы сможете легко управлять ими и/или удалить их вместе. | 
    | **Имя сайта** | Введите имя для веб-приложения. | Это значение не может быть пустым. | 
    | **Имя плана размещения** | Введите имя для плана службы приложений, в котором будет размещаться веб-приложение. | Это значение не может быть пустым. | 

1. На портале перейдите к оповещениям (значок колокольчика) и выберите **Перейти к группе ресурсов**. 

    :::image type="content" source="media/cache-event-grid-portal/deployment-notification.png" alt-text="Уведомление о развертывании на портале Azure.":::

4. На странице **Группа ресурсов** в списке ресурсов выберите созданное вами веб-приложение. В этом списке также отображается план службы приложений и экземпляр кэша. 

5. На странице **Служба приложений** для веб-приложения выберите URL-адрес для перехода на веб-сайт. URL-адрес должен иметь следующий формат: `https://<your-site-name>.azurewebsites.net`.

6. Убедитесь, что сайт открывается, но не имеет опубликованных событий.

    :::image type="content" source="media/cache-event-grid-portal/blank-event-grid-viewer.png" alt-text="Пустой сайт средства просмотра Сетки событий.":::

[!INCLUDE [event-grid-register-provider-portal.md](../../includes/event-grid-register-provider-portal.md)]

## <a name="subscribe-to-the-azure-cache-for-redis-instance"></a>Подписка на экземпляр Кэша Azure для Redis

На этом этапе вы создадите подписку на раздел, чтобы указать Сетке событий, какие события нужно отслеживать и куда их следует отправлять.

1. На портале перейдите к созданному ранее экземпляру кэша. 
2. На странице **Кэш Azure для Redis** в меню слева выберите элемент **События**. 
3. Щелкните элемент **Веб-перехватчик**. Вы отправите события в приложение для просмотра с помощью веб-перехватчика для конечной точки. 

     :::image type="content" source="media/cache-event-grid-portal/event-grid-web-hook.png" alt-text="Страница событий на портале Azure.":::

4. На странице **Создать подписку на события** введите следующее: 

    | Параметр      | Рекомендуемое значение  | Описание |
    | ------------ |  ------- | -------------------------------------------------- |
    | **имя**; | Укажите имя подписки на событие. | Длина значения должна быть от 3 до 64 символов. Имя может содержать только буквы, цифры и дефисы. | 
    | **Типы событий** | Раскройте список и выберите один или несколько типов событий, которые вы намерены отправлять в это назначение. В нашем примере для этого краткого руководства масштабируется экземпляр кэша. | Доступны следующие действия: установка исправлений, масштабирование, импорт и экспорт. | 
    | **Тип конечной точки** | Щелкните элемент **Веб-перехватчик**. | Это обработчик событий, который будет получать события. | 
    | **Конечная точка** | Щелкните **Выбрать конечную точку**, введите URL-адрес веб-приложения и добавьте строку `api/updates` к URL-адресу домашней страницы (например, `https://cache.azurewebsites.net/api/updates`). Затем нажмите кнопку **Подтвердить выбор**. | Это URL-адрес ранее созданного вами веб-приложения. | 

5. Теперь на странице **Создать подписку на события** нажмите кнопку **Создать**, чтобы создать подписку на события. 

6. Теперь снова откройте веб-приложение и убедитесь, что оно успешно получило отправленное событие подтверждения подписки. Щелкните значок с изображением глаза, чтобы развернуть данные события. Сетка событий отправляет событие подтверждения, чтобы конечная точка могла подтвердить, что она готова получать данные события. Веб-приложение содержит код для проверки подписки.

    :::image type="content" source="media/cache-event-grid-portal/subscription-event.png" alt-text="Средство просмотра Сетки событий Azure.":::

## <a name="send-an-event-to-your-endpoint"></a>Отправка события в конечную точку

Теперь необходимо активировать событие, чтобы увидеть, как Сетка событий Azure распределяет сообщение к вашей конечной точке. Мы будем масштабировать экземпляр Кэша Azure для Redis.

1. На портале Azure перейдите к экземпляру Кэша Azure для Redis и выберите в меню слева пункт **Масштабировать**.

1. Выберите нужную ценовую категорию на странице **Масштабирование** и щелкните элемент **Выбрать**. 

    Вы можете выполнить масштабирование до другой ценовой категории со следующими ограничениями.
    
    * Перейти с более высокой ценовой категории на более низкую нельзя.
      * Ценовую категорию кэша **Премиум** нельзя изменить на категорию **Стандартный** или **Базовый**.
      * Ценовую категорию кэша **Стандартный** нельзя изменить на категорию **Базовый**.
    * Вы можете выполнить масштабирование кэша с уровня **Базовый** до уровня **Стандартный**, но вам не удастся одновременно с этим изменить размер кэша. Если требуется изменить размер, можно выполнить последующую операцию масштабирования до нужного размера.
    * Ценовую категорию кэша **Базовый** нельзя изменить сразу на уровень **Премиум**. Сначала перейдите с категории **Базовый** на категорию **Стандартный**, а затем — с категории **Стандартный** на категорию **Премиум**.
    * Вам не удастся выполнить масштабирование с большего размера до размера **C0 (250 МБ)** .
 
    Во время масштабирования кэша до новой ценовой категории в колонке **Кэш Azure для Redis** отображается состояние **Масштабирование**. После завершения масштабирования состояние меняется с **Масштабирование** на **Работает**.

1. Вы активировали событие, а служба "Сетка событий" отправила сообщение в конечную точку, настроенную вами при оформлении подписки. Сообщение имеет формат JSON и содержит массив с одним или несколькими событиями. В следующем примере сообщение JSON содержит массив с одним событием. Просмотрите веб-приложение. Вы увидите полученное событие **ScalingCompleted** (Масштабирование завершено). 

    :::image type="content" source="media/cache-event-grid-portal/event-grid-scaling.png" alt-text="Масштабирование средства просмотра Сетки событий Azure в формате JSON.":::

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы планируете продолжить работу с этим событием, не удаляйте ресурсы, созданные при работе с этим кратким руководством. Если нет, удалите ресурсы, созданные при работе с этим кратким руководством.

Выберите группу ресурсов и щелкните **Удалить группу ресурсов**.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы знаете, как создавать пользовательские раздели и подписки на события, ознакомьтесь с дополнительными сведениями о сетке событий, которые могут помочь вам:

- [Реагирование на события Кэша Azure для Redis](cache-event-grid.md)
- [An introduction to Azure Event Grid](../event-grid/overview.md) (Общие сведения о службе "Сетка событий Azure")

