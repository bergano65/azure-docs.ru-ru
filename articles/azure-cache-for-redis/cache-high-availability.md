---
title: Высокий уровень доступности кэша Azure для Redis
description: Дополнительные сведения о кэше Azure для функций и параметров высокой доступности Redis
author: yegu-ms
ms.service: cache
ms.topic: conceptual
ms.date: 10/28/2020
ms.author: yegu
ms.openlocfilehash: e44aed1415f85bf4ea597eac6720207301946b97
ms.sourcegitcommit: 3bdeb546890a740384a8ef383cf915e84bd7e91e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2020
ms.locfileid: "93076917"
---
# <a name="high-availability-for-azure-cache-for-redis"></a>Высокий уровень доступности кэша Azure для Redis

Кэш Azure для Redis имеет встроенную высокую доступность. Цель своей архитектуры высокого уровня доступности заключается в том, чтобы убедиться, что управляемый экземпляр Redis работает, даже если его базовые виртуальные машины (ВМ) оказывают влияние на запланированные или незапланированные простои. Он предоставляет гораздо более большие процентные ставки, чем достижимый объемом размещения Redis на одной виртуальной машине.

Кэш Azure для Redis реализует высокий уровень доступности с помощью нескольких виртуальных машин, называемых *узлами* , для кэша. Он настраивает эти узлы таким образом, чтобы репликация данных и отработка отказа выполнялась в соответствии с согласованными принципами. Он также координирует операции обслуживания, такие как исправление Redis программного обеспечения. На уровнях "Стандартный", "Премиум" и "Корпоративный" доступны различные варианты высокого уровня доступности.

| Параметр | Описание | Доступность | Standard | Premium | Enterprise |
| ------------------- | ------- | ------- | :------: | :---: | :---: |
| [Стандартная репликация](#standard-replication)| Реплицированная конфигурация с двумя узлами в одном центре обработки данных или зоне доступности (AZ) с автоматической отработкой отказа | 99,9 % |✔|✔|-|
| [Корпоративный кластер](#enterprise-cluster) | Экземпляры связанного кэша в двух регионах с автоматической отработкой отказа | 99,9 % |-|-|✔|
| [Избыточность в пределах зоны](#zone-redundancy) | Многоузловая Конфигурация репликации в AZs с автоматической отработкой отказа | 99,95% (стандартная репликация), 99,99% (корпоративный кластер) |-|✔|✔|
| [Георепликация](#geo-replication) | Экземпляры связанного кэша в двух регионах с управляемой пользователем отработкой отказа | 99,9% (для одного региона) |-|✔|-|

## <a name="standard-replication"></a>Стандартная репликация

Кэш Azure для Redis на уровне "Стандартный" или "Премиум" по умолчанию работает на паре серверов Redis. Два сервера размещаются на выделенных виртуальных машинах. Redis с открытым исходным кодом позволяет только одному серверу обслуживать запросы на запись данных. Этот сервер является *основным* узлом, а другой *репликой* . После того как сервер подготавливает узлы, кэш Azure для Redis назначает им роли первичной и реплики. Основной узел обычно отвечает за обслуживание записи и запросов на чтение от клиентов Redis. При операции записи он фиксирует новый ключ и обновляет его внутреннюю память и немедленно отправляет ответ клиенту. Она перенаправляет операцию в реплику асинхронно.

:::image type="content" source="media/cache-high-availability/replication.png" alt-text="Настройка репликации данных":::
   
>[!NOTE]
>Как правило, клиент Redis взаимодействует с основным узлом в кэше Redis для всех запросов на чтение и запись. Некоторые клиенты Redis могут быть настроены для чтения с узла реплики.
>
>

Если основной узел в кэше Redis недоступен, реплика будет достигать новой первичной роли автоматически. Этот процесс называется *отработкой отказа* . Реплика будет ожидать достаточно долгого времени, прежде чем переключаться в случае, если основной узел быстро восстанавливается. Когда происходит отработка отказа, кэш Azure для Redis подготавливает новую виртуальную машину и присоединяет ее к кэшу в качестве узла реплики. Реплика выполняет полную синхронизацию данных с первичным экземпляром, чтобы иметь другую копию данных кэша.

Основной узел может выходить из службы в рамках запланированного обслуживания, такого как Redis программное обеспечение или обновление операционной системы. Это также может привести к сбою в связи с незапланированными событиями, такими как сбои в базовом оборудовании, программном обеспечении или сети. [Отработка отказа и исправление для кэша Azure для Redis](cache-failover.md) содержит подробное описание типов отработки отказа Redis. В течение времени существования кэша Azure для Redis будет проходить много отработок отказа. Архитектура высокого уровня доступности разработана таким образом, чтобы эти изменения в кэше были как можно более прозрачными для клиентов.

>[!NOTE]
>В предварительной версии доступны следующие возможности.
>
>

Кроме того, кэш Azure для Redis позволяет создавать дополнительные узлы реплики на уровне Premium. Для [кэша с несколькими репликами](cache-how-to-multi-replicas.md) можно настроить до трех узлов реплики. Наличие большего количества реплик обычно повышает устойчивость из-за дополнительных узлов, резервная копия которых является первичной. Даже если у вас больше реплик, кэш Azure для экземпляра Redis по-прежнему может серьезно повлиять на сбой центра обработки данных или AZ. Доступность кэша можно увеличить, используя несколько реплик в сочетании с [избыточностью зоны](#zone-redundancy).

## <a name="enterprise-cluster"></a>Корпоративный кластер

>[!NOTE]
>Он доступен в виде предварительной версии.
>
>

Кэш на любом уровне предприятия работает в кластере Redis Enterprise. Для формирования кворума в любой момент времени требуется нечетное число узлов сервера. По умолчанию он состоит из трех узлов, каждый из которых размещен на выделенной виртуальной машине. В кэше предприятия есть два одноранговых узла *данных* и один *узел кворума* меньшего размера. В кэше Enterprise Flash есть три узла данных одинакового размера. Кластер предприятия делит данные Redis на разделы внутренним образом. У каждой секции есть *первичная* и хотя бы одна *реплика* . Каждый узел данных содержит одну или несколько секций. Кластер предприятия гарантирует, что первичная и реплика любого раздела никогда не будут находиться в одном узле данных. Секции выполняют асинхронную репликацию данных из первичных частей в соответствующие реплики.

Когда узел данных становится недоступным или выполняется разделение сети, происходит отработка отказа, аналогичная описанной в разделе [стандартная репликация](#standard-replication) . Корпоративный кластер использует модель на основе кворума, чтобы определить, какие из оставшихся узлов будут участвовать в новом кворуме. При необходимости она также способствует использованию секций реплики в этих узлах.

## <a name="zone-redundancy"></a>Избыточность в пределах зоны

>[!NOTE]
>Он доступен в виде предварительной версии.
>
>

Кэш Azure для Redis поддерживает избыточные конфигурации зон на уровнях Premium и Enterprise. [Кэш, избыточный](cache-how-to-zone-redundancy.md) в пределах зоны, может размещать узлы в разных [зоны доступности Azure](../availability-zones/az-overview.md) в одном регионе. Она исключает центр обработки данных или AZ Failure как единую точку отказа и увеличивает общую доступность кэша.

На следующей схеме показана конфигурация, избыточная в зоне.

:::image type="content" source="media/cache-high-availability/zone-redundancy.png" alt-text="Настройка репликации данных":::
   
Кэш Azure для Redis распространяет узлы в избыточном кэше с циклическим перебором по сравнению с выбранным AZs. Он также определяет, какой узел будет изначально выступать в качестве основного.

Кэш, избыточный в зоне, обеспечивает автоматический переход на другой ресурс. Если текущий основной узел недоступен, одна из реплик будет принимать участие. Приложение может столкнуться с более высоким временем ответа кэша, если новый основной узел находится в другом AZ. AZs разделяются географически. При переключении с одного AZ на другое изменяется физическое расстояние между размещением приложения и кэша. Это изменение влияет на задержки при обмене данными между приложением и кэшем. Ожидается, что задержка будет попадать в допустимый диапазон для большинства приложений. Рекомендуется протестировать приложение, чтобы убедиться, что оно может нормально работать с кэшем, избыточным в зоне.

## <a name="geo-replication"></a>Георепликация

Георепликация разработана главным образом для аварийного восстановления. Она дает возможность настроить кэш Azure для экземпляра Redis в другом регионе Azure, чтобы создать резервную копию основного кэша. [Настройка георепликации для кэша Azure для Redis](cache-how-to-geo-replication.md) дает подробное объяснение того, как работает Георепликация.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о настройке кэша Azure для Redis высокого уровня доступности см. здесь.

* [Кэш Azure для уровней службы Redis Premium](cache-overview.md#service-tiers)
* [Добавление реплик в кэш Azure для Redis](cache-how-to-multi-replicas.md)
* [Включение избыточности зоны для кэша Azure для Redis](cache-how-to-zone-redundancy.md)
* [Настройка георепликации для кэша Azure для Redis](cache-how-to-geo-replication.md)