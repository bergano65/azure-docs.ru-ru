---
title: Как настроить георепликацию для кэша Redis для Azure | Документация Майкрософт
description: Узнайте, как реплицировать экземпляры кэша Redis для Azure между географическими регионами.
services: cache
documentationcenter: ''
author: yegu-ms
manager: jhubbard
editor: ''
ms.assetid: 375643dc-dbac-4bab-8004-d9ae9570440d
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache
ms.devlang: na
ms.topic: article
ms.date: 03/06/2019
ms.author: yegu
ms.openlocfilehash: 4254175955c3560c7bd0fdd08c6b60c318238b76
ms.sourcegitcommit: 5839af386c5a2ad46aaaeb90a13065ef94e61e74
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2019
ms.locfileid: "57991578"
---
# <a name="how-to-configure-geo-replication-for-azure-cache-for-redis"></a>Как настроить георепликацию для кэша Redis для Azure

Георепликация предоставляет механизм связывания двух экземпляров кэша Redis для Azure категории "Премиум". Один кэш выбирается в качестве основного связанного кэша, а другой — как дополнительный связанный кэш. Дополнительный связанный кэш становится доступным только для чтения, и в него реплицируются данные, записанные в основной кэш. Эту функцию можно использовать для репликации кэша в разные регионы Azure. Эта статья содержит руководство по настройке георепликации для экземпляров кэша Redis для Azure категории "Премиум".

## <a name="geo-replication-prerequisites"></a>Предварительные требования георепликации

Чтобы настроить георепликацию между двумя кэшами, должны выполняться следующие предварительные требования:

- Оба кэша являются [уровня "премиум"](cache-premium-tier-intro.md) кэширует.
- Оба кэша находятся в той же подписке Azure.
- Дополнительный связанный кэш — это объем кэш-памяти или размер кэш-памяти, чем основной связанный кэш.
- Оба кэша создаются и в состоянии выполнения.

Некоторые функции не поддерживаются с помощью георепликации:

- Сохраняемость не поддерживается с помощью георепликации.
- Кластеризация поддерживается, если оба кэша включена кластеризация с одинаковым количеством сегментов.
- Поддерживаются кэши в той же виртуальной сети.
- Кэши в разных виртуальных сетях поддерживаются с помощью предупреждения. См. в разделе [можно ли использовать георепликацию кэши находятся в виртуальной сети?](#can-i-use-geo-replication-with-my-caches-in-a-vnet) Дополнительные сведения.

После настройки георепликации в отношении вашей пары связанных кэшей применяются следующие ограничения:

- Дополнительный связанный кэш доступен только для чтения, то есть из него можно считывать данные, но нельзя записать данные в него. 
- Любые данные, которые были в дополнительном связанном кэше до добавления связи, удаляются. Если географическая репликация является более поздней, тем не менее, удалить эти реплицированные данные остаются в дополнительном связанном кэше.
- Вы не можете [масштабирования](cache-how-to-scale.md) любым из кэшей, хотя связанные кэши.
- Вы не можете [изменить количество сегментов](cache-how-to-premium-clustering.md) Если кэша включена кластеризация.
- Ни на одном из кэше не удастся включить сохраняемость.
- Вы можете [Экспорт](cache-how-to-import-export-data.md#export) из любого кэша.
- Вы не можете [импорта](cache-how-to-import-export-data.md#import) в дополнительный связанный кэш.
- Невозможно удалить связанный кэш или группе ресурсов, которую они входят, пока пользователь не удалит кэши. Дополнительные сведения см. в разделе [Почему произошел сбой операции, когда я попытался удалить связанный кэш?](#why-did-the-operation-fail-when-i-tried-to-delete-my-linked-cache)
- Если кэши находятся в разных регионах, затраты на исходящий трафик сети применяются к данным, перемещать между регионами. Дополнительные сведения см. в разделе [Сколько стоит реплицировать мои данные между регионами Azure?](#how-much-does-it-cost-to-replicate-my-data-across-azure-regions)
- Автоматическая отработка отказа не выполняется между основной и дополнительный связанный кэш. Дополнительные сведения и сведения о том, как выполнить отработку отказа клиентское приложение, см. в разделе [как работает отработки отказа в дополнительный связанный кэш?](#how-does-failing-over-to-the-secondary-linked-cache-work)

## <a name="add-a-geo-replication-link"></a>Добавление связи георепликации

1. Для связывания двух кэшей для георепликации, первой щелкните **георепликации** из меню ресурсов кэша для основного связанного кэша. Затем щелкните **связь репликации кэша добавить** из **георепликации** колонке.

    ![Добавление связи](./media/cache-how-to-geo-replication/cache-geo-location-menu.png)

2. Щелкните имя предполагаемого дополнительного кэша из **совместимые кэши** списка. Если вторичный кэш не отображается в списке, убедитесь, что [предварительные требования георепликации](#geo-replication-prerequisites) выполняются для вторичного кэша. Чтобы отфильтровать кэши по региону, выберите область в карту, чтобы отобразить только кэши в **совместимые кэши** списка.

    ![Кэши, совместимые с георепликацией](./media/cache-how-to-geo-replication/cache-geo-location-select-link.png)
    
    Также можно начать процесс связывания или просмотра сведений о дополнительном кэше с помощью контекстного меню.

    ![Контекстное меню георепликации](./media/cache-how-to-geo-replication/cache-geo-location-select-link-context-menu.png)

3. Чтобы связывать два кэша друг с другом и начать процесс репликации, нажмите кнопку **Связь**.

    ![Связывание кэшей](./media/cache-how-to-geo-replication/cache-geo-location-confirm-link.png)

4. Ход выполнения процесса репликации можно просмотреть в колонке **Георепликация**.

    ![Состояние связывания](./media/cache-how-to-geo-replication/cache-geo-location-linking.png)

    Состояние связывания также можно просмотреть в колонке **Обзор** как для основного кэша, так и для дополнительного.

    ![Состояние кэша](./media/cache-how-to-geo-replication/cache-geo-location-link-status.png)

    По завершении процесса репликации **Состояние связи** изменится на **Успешно**.

    ![Состояние кэша](./media/cache-how-to-geo-replication/cache-geo-location-link-successful.png)

    В процессе связывания основной связанный кэш остается доступным для использования. Дополнительный связанный кэш недоступен, пока не завершится процесс связывания.

## <a name="remove-a-geo-replication-link"></a>Удаление связи георепликации

1. Чтобы удалить связь между двумя кэшами и приостановить георепликацию, щелкните **Unlink caches** (Удалить связь кэшей) в колонке **Георепликация**.
    
    ![Удаление связи кэшей](./media/cache-how-to-geo-replication/cache-geo-location-unlink.png)

    По завершения процесса удаления связи дополнительный кэш станет доступным как для чтения, так и для записи.

>[!NOTE]
>Когда удаляется связь георепликации, реплицированные данные из основного связанного кэша остаются в дополнительном кэше.
>
>

## <a name="geo-replication-faq"></a>Часто задаваемые вопросы по георепликации

- [Можно ли использовать георепликацию с кэшем уровня "Стандартный" или "Базовый"?](#can-i-use-geo-replication-with-a-standard-or-basic-tier-cache)
- [Можно ли использовать кэш во время связывания или удаления связи?](#is-my-cache-available-for-use-during-the-linking-or-unlinking-process)
- [Можно ли связать больше двух кэшей?](#can-i-link-more-than-two-caches-together)
- [Можно ли связать два кэша из разных подписок Azure?](#can-i-link-two-caches-from-different-azure-subscriptions)
- [Можно ли связать два кэша с разными размерами?](#can-i-link-two-caches-with-different-sizes)
- [Можно ли использовать георепликацию при включенной кластеризации?](#can-i-use-geo-replication-with-clustering-enabled)
- [Можно ли использовать георепликацию, если кэши находятся в виртуальной сети?](#can-i-use-geo-replication-with-my-caches-in-a-vnet)
- [Что такое расписание репликации для георепликации Redis?](#what-is-the-replication-schedule-for-redis-geo-replication)
- [Сколько времени занимает георепликация?](#how-long-does-geo-replication-replication-take)
- [Гарантируется ли точка восстановления репликации?](#is-the-replication-recovery-point-guaranteed)
- [Можно ли использовать PowerShell или Azure CLI для управления георепликацией?](#can-i-use-powershell-or-azure-cli-to-manage-geo-replication)
- [Сколько стоит реплицировать мои данные между регионами Azure?](#how-much-does-it-cost-to-replicate-my-data-across-azure-regions)
- [Почему произошел сбой операции, когда я попытался удалить связанный кэш?](#why-did-the-operation-fail-when-i-tried-to-delete-my-linked-cache)
- [Какой регион лучше использовать для дополнительного связанного кэша?](#what-region-should-i-use-for-my-secondary-linked-cache)
- [Как выполнить отработку отказа в дополнительный связанный кэш?](#how-does-failing-over-to-the-secondary-linked-cache-work)

### <a name="can-i-use-geo-replication-with-a-standard-or-basic-tier-cache"></a>Можно ли использовать георепликацию с кэшем уровня "Стандартный" или "Базовый"?

Нет. Георепликация доступна только для кэшей категории "Премиум".

### <a name="is-my-cache-available-for-use-during-the-linking-or-unlinking-process"></a>Можно ли использовать кэш во время связывания или удаления связи?

- При связывании, основной связанный кэш остается доступным, пока завершится процесс связывания.
- При связывании, дополнительный связанный кэш недоступен, пока не завершится процесс связывания.
- При отмене связи, оба кэша остаются доступными во время завершения процесса удаления связи.

### <a name="can-i-link-more-than-two-caches-together"></a>Можно ли связать больше двух кэшей?

Нет, можно связать только два кэша друг с другом.

### <a name="can-i-link-two-caches-from-different-azure-subscriptions"></a>Можно ли связать два кэша из разных подписок Azure?

Нет. Оба кэша должны относиться к одной подписке Azure.

### <a name="can-i-link-two-caches-with-different-sizes"></a>Можно ли связать два кэша с разными размерами?

Да, если размер дополнительного связанного кэша больше размера основного связанного кэша.

### <a name="can-i-use-geo-replication-with-clustering-enabled"></a>Можно ли использовать георепликацию при включенной кластеризации?

Да, если оба кэша имеют одинаковое число сегментов.

### <a name="can-i-use-geo-replication-with-my-caches-in-a-vnet"></a>Можно ли использовать георепликацию, если кэши находятся в виртуальной сети?

Да, георепликация кэшей в виртуальных сетях поддерживается предупреждения:

- Георепликация между кэшами в одной виртуальной сети поддерживается.
- Георепликация между кэшами в разных виртуальных сетях также поддерживается.
  - Если виртуальные сети находятся в одном регионе, их можно соединить с помощью [пиринг](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) или [подключения VPN-шлюза для сети](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways#V2V).
  - Если виртуальные сети находятся в разных регионах, географической репликации с помощью виртуальной сети пиринг не поддерживается из-за ограничения с основных внутренних подсистем балансировки нагрузки. Дополнительные сведения об ограничениях пиринга виртуальной сети см. в разделе [- Пиринг - требования и ограничения](https://docs.microsoft.com/azure/virtual-network/virtual-network-manage-peering#requirements-and-constraints). Рекомендуемое решение — использовать подключение VPN-шлюза для сети.

С помощью [этот шаблон Azure](https://azure.microsoft.com/resources/templates/201-redis-vnet-geo-replication/), вы можете быстро развернуть два географически реплицированных кэша в виртуальной сети, подключенные с помощью подключения VPN-шлюза для сети.

### <a name="what-is-the-replication-schedule-for-redis-geo-replication"></a>Что такое расписание репликации для георепликации Redis?

Репликация непрерывно и асинхронно и не происходит по заданному расписанию. Все операции записи на первичную реплику, мгновенно и асинхронно реплицируются во вторичной реплике.

### <a name="how-long-does-geo-replication-replication-take"></a>Сколько времени занимает георепликация?

Репликация является добавочной, асинхронной и непрерывной, и время, затраченное не сильно отличается от задержки в сети в разных регионах. При определенных обстоятельствах вторичного кэша может потребоваться выполнить полную синхронизацию данных с сервера-источника. В этом случае время репликации зависит от ряда факторов, таких как: нагрузку на основной кэш, доступную пропускную способность сети и задержки между регионами. Мы обнаружили, что время репликации для геореплицируемой парой полной 53 ГБ может находиться в диапазоне от 5 до 10 минут.

### <a name="is-the-replication-recovery-point-guaranteed"></a>Гарантируется ли точка восстановления репликации?

Для кэшей в режиме географически реплицированных сохраняемость отключена. Если геореплицируемой парой отсутствует, таких как отказоустойчивая, инициированных клиентом, дополнительный связанный кэш хранит его синхронизированные данные до этого момента времени. В таких ситуациях гарантирует отсутствие точек восстановления.

Чтобы получить точку восстановления [Экспорт](cache-how-to-import-export-data.md#export) из любого кэша. Вы можете позже [импорта](cache-how-to-import-export-data.md#import) в основной связанный кэш.

### <a name="can-i-use-powershell-or-azure-cli-to-manage-geo-replication"></a>Можно ли использовать PowerShell или Azure CLI для управления георепликацией?

Да, георепликацию можно управлять с помощью портала Azure, PowerShell или интерфейса командной строки Azure. Дополнительные сведения см. в разделе [документы PowerShell](https://docs.microsoft.com/powershell/module/az.rediscache/?view=azps-1.4.0#redis_cache) или [документации по Azure CLI](https://docs.microsoft.com/cli/azure/redis/server-link?view=azure-cli-latest).

### <a name="how-much-does-it-cost-to-replicate-my-data-across-azure-regions"></a>Сколько стоит реплицировать мои данные между регионами Azure?

При использовании георепликации данные из основного связанного кэша реплицируются в дополнительный связанный кэш. Плата не взимается за передачу данных, если два связанных кэша находятся в одном регионе. Если два связанных кэша находятся в разных регионах, плата за передачу данных — это затраты на исходящий трафик сети данных, перемещение в любом регионе. Дополнительные сведения см. на странице [Сведения о стоимости пропускной способности](https://azure.microsoft.com/pricing/details/bandwidth/).

### <a name="why-did-the-operation-fail-when-i-tried-to-delete-my-linked-cache"></a>Почему произошел сбой операции, когда я попытался удалить связанный кэш?

Георепликация кэшей и их групп ресурсов нельзя удалить, пока связанные пока не удалена связь георепликации. При попытке удалить группу ресурсов, в которую входит один из них или оба связанных кэша, остальные ресурсы в группе ресурсов удаляются, но группа ресурсов остается в состоянии `deleting`, а все связанные кэши в группе ресурсов остаются в состоянии `running`. Чтобы полностью удалить группу ресурсов и связанных кэшей, которые в ней, отменить связывание кэшей, как описано в разделе [удалить связь георепликации](#remove-a-geo-replication-link).

### <a name="what-region-should-i-use-for-my-secondary-linked-cache"></a>Какой регион лучше использовать для дополнительного связанного кэша?

В общем случае рекомендуется для размещения кэша в одном регионе Azure, что и приложение, обращающееся к нему. Для приложений с отдельными регионами основной и резервный рекомендуется вашей основной и дополнительный кэши существуют в тех же регионах. Дополнительные сведения о парах регионов см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](../best-practices-availability-paired-regions.md).

### <a name="how-does-failing-over-to-the-secondary-linked-cache-work"></a>Как выполнить отработку отказа в дополнительный связанный кэш?

Автоматическая отработка отказа между регионами Azure не поддерживается для географически реплицированных кэшей. В сценарии аварийного восстановления клиентам следует открыть весь стек приложений скоординировано в регионе, их резервного копирования. Позволяя отдельного приложения, определите компоненты переключении своих резервных копий, сами по себе может отрицательно повлиять на производительность. Одно из основных преимуществ Redis — это хранилище очень низкой задержкой. Если основного приложения клиента находится в разных регионах свой кэш, добавлены время приема-передачи бы значительное влияние на производительность. По этой причине мы избежать отработка отказа автоматически из-за временных проблем с доступностью.

Чтобы запустить отработку отказа, инициированных клиентом, сначала отменить связывание кэшей. Затем измените клиента Redis, чтобы использовать конечную точку подключения (ранее связанный) дополнительный кэш. Когда два кэша будут отключены, дополнительный кэш снова становится регулярных кэша чтения и записи и принимает запросы от клиентов Redis напрямую.

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с дополнительными сведениями о [кэше Redis для Azure категории "Премиум"](cache-premium-tier-intro.md).
