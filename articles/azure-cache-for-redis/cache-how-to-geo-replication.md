---
title: Как настроить георепликацию для кэша Azure для Redis | Документация Майкрософт
description: Узнайте, как реплицировать экземпляры кэша Redis для Azure между географическими регионами.
author: yegu-ms
ms.service: cache
ms.topic: conceptual
ms.date: 03/06/2019
ms.author: yegu
ms.openlocfilehash: ce50c665fa79c361f638fda4ec373d5215c407f8
ms.sourcegitcommit: 2d3740e2670ff193f3e031c1e22dcd9e072d3ad9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/16/2019
ms.locfileid: "74129429"
---
# <a name="how-to-set-up-geo-replication-for-azure-cache-for-redis"></a>Как настроить георепликацию для кэша Azure для Redis

Георепликация предоставляет механизм связывания двух экземпляров кэша Redis для Azure категории "Премиум". В качестве основного связанного кэша выбирается один кэш, а другой — вторичный связанный кэш. Дополнительный связанный кэш становится доступным только для чтения, и в него реплицируются данные, записанные в основной кэш. Эту функцию можно использовать для репликации кэша в разные регионы Azure. В этой статье представлено руководство по настройке георепликации для кэша Azure уровня "Премиум" для экземпляров Redis.

## <a name="geo-replication-prerequisites"></a>Предварительные требования георепликации

Чтобы настроить георепликацию между двумя кэшами, должны выполняться следующие предварительные условия.

- Оба кэша являются кэшем [уровня "Премиум](cache-premium-tier-intro.md) ".
- Оба кэша находятся в одной подписке Azure.
- Вторичный связанный кэш имеет один и тот же размер кэша или больший размер кэша, чем основной связанный кэш.
- Оба кэша создаются и находятся в состоянии выполнения.

Для георепликации не поддерживаются некоторые функции:

- Сохраняемость не поддерживается при георепликации.
- Кластеризация поддерживается, если в обоих кэшах включена кластеризация с одинаковым числом сегментов.
- Поддерживаются кэши в одной виртуальной сети.
- Кэши в разных виртуальных сетей поддерживаются с предупреждениями. Дополнительные сведения см. [в статье как использовать георепликацию с кэшами в виртуальной сети](#can-i-use-geo-replication-with-my-caches-in-a-vnet) .

После настройки георепликации к связанной паре кэша применяются следующие ограничения.

- Дополнительный связанный кэш доступен только для чтения, то есть из него можно считывать данные, но нельзя записать данные в него. 
- Любые данные, которые были в дополнительном связанном кэше до добавления связи, удаляются. Если Георепликация позже удаляется, реплицированные данные остаются во вторичном связанном кэше.
- Вы не можете [масштабировать](cache-how-to-scale.md) кэш, пока не будут связаны кэши.
- Нельзя [изменить число сегментов](cache-how-to-premium-clustering.md) , если в кэше включена кластеризация.
- Ни на одном из кэше не удастся включить сохраняемость.
- Можно выполнить [Экспорт](cache-how-to-import-export-data.md#export) из любого кэша.
- Вы не можете [импортировать](cache-how-to-import-export-data.md#import) во вторичный связанный кэш.
- Невозможно удалить связанный кэш или группу ресурсов, содержащую их, пока не будет удалена связь с кэшами. Дополнительные сведения см. в разделе [Почему произошел сбой операции, когда я попытался удалить связанный кэш?](#why-did-the-operation-fail-when-i-tried-to-delete-my-linked-cache)
- Если кэши находятся в разных регионах, затраты на исходящие сетевые данные применяются к данным, перемещаемым в разных регионах. Дополнительные сведения см. в разделе [Сколько стоит реплицировать мои данные между регионами Azure?](#how-much-does-it-cost-to-replicate-my-data-across-azure-regions)
- Автоматическая отработка отказа не происходит между основным и вторичным связанным кэшем. Дополнительные сведения и сведения об отработке отказа клиентского приложения см. в разделе [как работает переход на дополнительный связанный кэш?](#how-does-failing-over-to-the-secondary-linked-cache-work)

## <a name="add-a-geo-replication-link"></a>Добавление связи георепликации

1. Чтобы связать два кэша для георепликации, кулак щелкните **Георепликация** из меню ресурсов кэша, который вы собираетесь использовать в качестве основного связанного кэша. Затем щелкните **ссылку Добавить репликацию кэша** в колонке **Георепликация** .

    ![Добавление связи](./media/cache-how-to-geo-replication/cache-geo-location-menu.png)

2. В списке **совместимые кэши** щелкните имя предполагаемого вторичного кэша. Если дополнительный кэш не отображается в списке, убедитесь, что выполнены [необходимые условия георепликации](#geo-replication-prerequisites) для вторичного кэша. Чтобы отфильтровать кэши по региону, щелкните область на карте, чтобы отобразить только эти кэши в списке **совместимые кэши** .

    ![Кэши, совместимые с георепликацией](./media/cache-how-to-geo-replication/cache-geo-location-select-link.png)
    
    Можно также запустить процесс связывания или просмотреть сведения о дополнительном кэше с помощью контекстного меню.

    ![Контекстное меню георепликации](./media/cache-how-to-geo-replication/cache-geo-location-select-link-context-menu.png)

3. Чтобы связывать два кэша друг с другом и начать процесс репликации, нажмите кнопку **Связь**.

    ![Связывание кэшей](./media/cache-how-to-geo-replication/cache-geo-location-confirm-link.png)

4. Ход выполнения процесса репликации можно просмотреть в колонке **Георепликация**.

    ![Состояние связывания](./media/cache-how-to-geo-replication/cache-geo-location-linking.png)

    Состояние связывания также можно просмотреть в колонке **Обзор** как для основного кэша, так и для дополнительного.

    ![Состояние кэша](./media/cache-how-to-geo-replication/cache-geo-location-link-status.png)

    По завершении процесса репликации **Состояние связи** изменится на **Успешно**.

    ![Состояние кэша](./media/cache-how-to-geo-replication/cache-geo-location-link-successful.png)

    Основной связанный кэш остается доступным для использования во время процесса компоновки. Дополнительный связанный кэш недоступен до завершения процесса компоновки.

## <a name="remove-a-geo-replication-link"></a>Удаление связи георепликации

1. Чтобы удалить связь между двумя кэшами и отменить георепликацию, щелкните **удалить связи с кэшами** в колонке **Георепликация** .
    
    ![Удаление связи кэшей](./media/cache-how-to-geo-replication/cache-geo-location-unlink.png)

    По завершения процесса удаления связи дополнительный кэш станет доступным как для чтения, так и для записи.

>[!NOTE]
>При удалении связи георепликации реплицированные данные из основного связанного кэша остаются в дополнительном кэше.
>
>

## <a name="geo-replication-faq"></a>Часто задаваемые вопросы по георепликации

- [Можно ли использовать георепликацию с кэшем уровня "Стандартный" или "базовый"?](#can-i-use-geo-replication-with-a-standard-or-basic-tier-cache)
- [Можно ли использовать кэш во время связывания или удаления связи?](#is-my-cache-available-for-use-during-the-linking-or-unlinking-process)
- [Можно ли связать больше двух кэшей?](#can-i-link-more-than-two-caches-together)
- [Можно ли связать два кэша из разных подписок Azure?](#can-i-link-two-caches-from-different-azure-subscriptions)
- [Можно ли связать два кэша с разными размерами?](#can-i-link-two-caches-with-different-sizes)
- [Можно ли использовать георепликацию с включенной кластеризацией?](#can-i-use-geo-replication-with-clustering-enabled)
- [Можно ли использовать георепликацию с кэшами в виртуальной сети?](#can-i-use-geo-replication-with-my-caches-in-a-vnet)
- [Что такое расписание репликации для георепликации Redis?](#what-is-the-replication-schedule-for-redis-geo-replication)
- [Сколько времени занимает георепликация?](#how-long-does-geo-replication-replication-take)
- [Гарантируется ли точка восстановления репликации?](#is-the-replication-recovery-point-guaranteed)
- [Можно ли использовать PowerShell или Azure CLI для управления георепликацией?](#can-i-use-powershell-or-azure-cli-to-manage-geo-replication)
- [Сколько стоит реплицировать мои данные между регионами Azure?](#how-much-does-it-cost-to-replicate-my-data-across-azure-regions)
- [Почему произошел сбой операции, когда я попытался удалить связанный кэш?](#why-did-the-operation-fail-when-i-tried-to-delete-my-linked-cache)
- [Какой регион лучше использовать для дополнительного связанного кэша?](#what-region-should-i-use-for-my-secondary-linked-cache)
- [Как выполнить отработку отказа в дополнительный связанный кэш?](#how-does-failing-over-to-the-secondary-linked-cache-work)

### <a name="can-i-use-geo-replication-with-a-standard-or-basic-tier-cache"></a>Можно ли использовать георепликацию с кэшем уровня "Стандартный" или "базовый"?

Нет, Георепликация доступна только для кэшей уровня "Премиум".

### <a name="is-my-cache-available-for-use-during-the-linking-or-unlinking-process"></a>Можно ли использовать кэш во время связывания или удаления связи?

- При связывании основной связанный кэш остается доступным по завершении процесса связывания.
- При связывании дополнительный связанный кэш недоступен до завершения процесса компоновки.
- При разрыве связи оба кэша остаются доступными при завершении процесса разрыва связи.

### <a name="can-i-link-more-than-two-caches-together"></a>Можно ли связать больше двух кэшей?

Нет, можно связать только два кэша одновременно.

### <a name="can-i-link-two-caches-from-different-azure-subscriptions"></a>Можно ли связать два кэша из разных подписок Azure?

Нет. Оба кэша должны относиться к одной подписке Azure.

### <a name="can-i-link-two-caches-with-different-sizes"></a>Можно ли связать два кэша с разными размерами?

Да, если размер дополнительного связанного кэша больше размера основного связанного кэша.

### <a name="can-i-use-geo-replication-with-clustering-enabled"></a>Можно ли использовать георепликацию с включенной кластеризацией?

Да, если оба кэша имеют одинаковое число сегментов.

### <a name="can-i-use-geo-replication-with-my-caches-in-a-vnet"></a>Можно ли использовать георепликацию с кэшами в виртуальной сети?

Да, Георепликация кэшей в виртуальных сетей поддерживается с предупреждениями:

- Георепликация между кэшами в одной виртуальной сети поддерживается.
- Также поддерживается Георепликация между кэшами в разных виртуальных сетей.
  - Если виртуальных сетей находятся в одном регионе, их можно подключить с помощью [пиринга](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) [виртуальных сетей или подключения виртуальной сети VPN-шлюза](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways#V2V).
  - Если виртуальных сетей находятся в разных регионах, Георепликация с использованием пиринга виртуальных сетей не поддерживается из-за ограничения с базовыми подсистемами балансировки нагрузки. Дополнительные сведения об ограничениях пиринга виртуальных сетей см. в статье [виртуальные сети — пиринг — требования и ограничения](https://docs.microsoft.com/azure/virtual-network/virtual-network-manage-peering#requirements-and-constraints). Рекомендуемым решением является подключение между виртуальными сетями через VPN-шлюз.

С помощью [этого шаблона Azure](https://azure.microsoft.com/resources/templates/201-redis-vnet-geo-replication/)можно быстро развернуть два геореплицированных кэша в виртуальной сети, подключенной с помощью подключения "Виртуальная сеть VPN-шлюза".

### <a name="what-is-the-replication-schedule-for-redis-geo-replication"></a>Что такое расписание репликации для георепликации Redis?

Репликация непрерывная и асинхронная и не происходит по определенному расписанию. Все операции записи, выполненные в базе данных-источнике, мгновенно и асинхронно реплицируются на сервер-получатель.

### <a name="how-long-does-geo-replication-replication-take"></a>Сколько времени занимает георепликация?

Репликация является добавочной, асинхронной и непрерывной, и время съемки не сильно отличается от задержки между регионами. При определенных обстоятельствах может потребоваться дополнительный кэш для полной синхронизации данных из первичной реплики. Время репликации в этом случае зависит от числа факторов, таких как загрузка в основном кэше, доступная пропускная способность сети и задержка между регионами. Мы обнаружили время репликации для полной реплицированной пары размером 53 Гб, которая может находиться в диапазоне от 5 до 10 минут.

### <a name="is-the-replication-recovery-point-guaranteed"></a>Гарантируется ли точка восстановления репликации?

Для кэшей в геореплицированном режиме сохраняемость отключена. При отсоединении геореплицированной пары, например инициированной клиентом отработки отказа, дополнительный связанный кэш сохраняет синхронизированные данные до этого момента времени. В таких ситуациях не гарантируется ни одна точка восстановления.

Чтобы получить точку восстановления, [экспортируйте](cache-how-to-import-export-data.md#export) из любого кэша. Позднее можно [импортировать](cache-how-to-import-export-data.md#import) в основной связанный кэш.

### <a name="can-i-use-powershell-or-azure-cli-to-manage-geo-replication"></a>Можно ли использовать PowerShell или Azure CLI для управления георепликацией?

Да, георепликацию можно управлять с помощью портал Azure, PowerShell или Azure CLI. Дополнительные сведения см. в документации по [PowerShell](https://docs.microsoft.com/powershell/module/az.rediscache/?view=azps-1.4.0#redis_cache) или документация [Azure CLI](https://docs.microsoft.com/cli/azure/redis/server-link?view=azure-cli-latest).

### <a name="how-much-does-it-cost-to-replicate-my-data-across-azure-regions"></a>Сколько стоит реплицировать мои данные между регионами Azure?

При использовании георепликации данные из основного связанного кэша реплицируются во вторичный связанный кэш. Если два связанных кэша находятся в одном регионе, плата за пересылку данных не взимается. Если два связанных кэша находятся в разных регионах, плата за передачу данных — это стоимость сетевого выхода данных в любом регионе. Дополнительные сведения см. на странице [Сведения о стоимости пропускной способности](https://azure.microsoft.com/pricing/details/bandwidth/).

### <a name="why-did-the-operation-fail-when-i-tried-to-delete-my-linked-cache"></a>Почему произошел сбой операции, когда я попытался удалить связанный кэш?

Невозможно удалить геореплицированные кэши и их группы ресурсов, пока не будет удалена связь георепликации. При попытке удалить группу ресурсов, в которую входит один из них или оба связанных кэша, остальные ресурсы в группе ресурсов удаляются, но группа ресурсов остается в состоянии `deleting`, а все связанные кэши в группе ресурсов остаются в состоянии `running`. Чтобы полностью удалить группу ресурсов и связанные с ней кэши в ней, удалите связь с кэшами, как описано в разделе [Удаление связи георепликации](#remove-a-geo-replication-link).

### <a name="what-region-should-i-use-for-my-secondary-linked-cache"></a>Какой регион лучше использовать для дополнительного связанного кэша?

Как правило, кэш рекомендуется хранить в том же регионе Azure, что и приложение, которое обращается к нему. Для приложений с отдельными первичными и резервными регионами рекомендуется, чтобы основной и вторичный кэши существовали в тех же регионах. Дополнительные сведения о парах регионов см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](../best-practices-availability-paired-regions.md).

### <a name="how-does-failing-over-to-the-secondary-linked-cache-work"></a>Как выполнить отработку отказа в дополнительный связанный кэш?

Автоматическая отработка отказа в регионах Azure не поддерживается для геореплицированных кэшей. В сценарии аварийного восстановления клиенты должны полностью запланировать весь стек приложений в своем регионе резервного копирования. Предоставление отдельным компонентам приложений решения о том, когда следует переключаться на свои резервные копии, может негативно сказаться на производительности. Одно из ключевых преимуществ Redis заключается в том, что это хранилище очень низкой задержки. Если основное приложение клиента находится в регионе, отличном от региона своего кэша, добавленное время кругового пути будет заметно повлиять на производительность. По этой причине мы не будем автоматически выполнять отработку отказа из-за временных проблем с доступностью.

Чтобы запустить отработку отказа, инициированную клиентом, сначала нужно удалить связь кэшей. Затем измените клиент Redis, чтобы он использовал конечную точку подключения вторичного кэша (ранее связанный). При разрыве связи между двумя кэшами Вторичный кэш снова переходит в обычный кэш для чтения и записи и принимает запросы непосредственно от клиентов Redis.

## <a name="next-steps"></a>Дополнительная информация

Ознакомьтесь с дополнительными сведениями о [кэше Redis для Azure категории "Премиум"](cache-premium-tier-intro.md).
