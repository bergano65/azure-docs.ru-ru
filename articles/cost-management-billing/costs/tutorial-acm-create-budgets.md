---
title: Руководство. Создание бюджетов Azure и управление ими
description: Это руководство помогает планировать и учитывать расходы на потребляемые услуги Azure.
author: bandersmsft
ms.author: banders
ms.date: 07/15/2020
ms.topic: conceptual
ms.service: cost-management-billing
ms.reviewer: adwise
ms.custom: seodec18
ms.openlocfilehash: 3572cbb3f8c4a4f20c0141ac1fae5f0aa6fbd216
ms.sourcegitcommit: 3d79f737ff34708b48dd2ae45100e2516af9ed78
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "87044992"
---
# <a name="tutorial-create-and-manage-azure-budgets"></a>Руководство по Создание бюджетов Azure и управление ими

Бюджеты в службе "Управление затратами" помогают планировать и отслеживать отчетность на уровне организации. С бюджетами вы можете учитывать службы Azure, которые используете или на которые подписываетесь в течение определенного периода. Они помогают сообщать другим пользователям о своих расходах, чтобы эффективно управлять затратами и контролировать то, как они возрастают с течением времени. Когда созданные вами пороговые значения бюджета превышены, активируются только уведомления. Ни один из ваших ресурсов не затронут а потребление не остановлено. Анализируя затраты, можно использовать бюджеты для их сравнения и отслеживания.

Данные о затратах и использовании обычно доступны в течение 20 часов, а бюджеты оцениваются по этим затратам каждые 12–14 часов. При достижении порога бюджета уведомления по электронной почте обычно отправляются в течение часа после оценки.

В конце периода (ежемесячно, ежеквартально или ежегодно) бюджеты автоматически сбрасываются до той же суммы, когда вы выбираете следующую дату истечения срока. Так как сбрасывание происходит при той же сумме бюджета, вам нужно создать отдельные бюджеты в том случае если сумма бюджета в валюте отличается от последующих периодов.

Примеры в этом руководстве помогут вам при создании и редактировании бюджета для подписки по соглашению Enterprise (EA) для Azure.

Просмотрите видео [How to apply budgets to subscriptions using the Azure portal](https://www.youtube.com/watch?v=UrkHiUx19Po) ( Применение бюджетов к подпискам с помощью портала Azure), чтобы получить сведения о создании бюджетов в Azure для отслеживания расходов. Чтобы просмотреть другие видео, посетите канал YouTube, посвященный [службе "Управление затратами"](https://www.youtube.com/c/AzureCostManagement).

>[!VIDEO https://www.youtube.com/embed/UrkHiUx19Po]

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Создание бюджета на портале Azure
> * Создание и изменение бюджетов с помощью PowerShell
> * Создание бюджета с помощью шаблона Azure Resource Manager

## <a name="prerequisites"></a>Предварительные требования

Бюджеты поддерживаются для следующих областей и типов учетных записей Azure:

- Области управления доступом на основе ролей в Azure.
    - Группы управления
    - Подписка
- Области Соглашения Enterprise
    - учетная запись выставления счетов;
    - отдел;
    - учетная запись регистрации;
- Отдельные соглашения:
    - учетная запись выставления счетов;
- Области Клиентского соглашения Майкрософт
    - учетная запись выставления счетов;
    - Профиль выставления счетов
    - Раздел счета
    - Customer
- Области AWS
    - Внешняя учетная запись
    - Внешняя подписка


Чтобы просмотреть данные о бюджете, вам нужен как минимум доступ на чтение для учетной записи Azure.

Если вы используете новую подписку, вы не сможете сразу создать бюджет или использовать другие функции службы "Управление затратами". Полная активация всех функций Управления затратами может потребовать до 48 часов.

Для подписок Azure EA вам необходимо иметь доступ на чтение для просмотра данных о бюджете. А для создания и администрирования бюджетов требуется разрешение уровня участника.

На подписку для бюджетов по пользователям и группам поддерживаются следующие разрешения или области Azure. См. [основные сведения об областях и работе с ними](understand-work-scopes.md).

- Владелец может создавать, изменять или удалять бюджеты для подписки.
- Участник и участник службы "Управление затратами" может создавать, изменять или удалять свои собственные бюджеты. Можно изменить сумму бюджета для бюджетов, созданных другими пользователями.
- Читатель и читатель службы "Управление затратами" может просматривать бюджеты, к которым имеет доступ.

Дополнительные сведения о назначении разрешений на доступ к данным службы "Управление затратами" см. в [этой статье](../../cost-management/assign-access-acm-data.md).

## <a name="sign-in-to-azure"></a>Вход в Azure

- Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com).

## <a name="create-a-budget-in-the-azure-portal"></a>Создание бюджета на портале Azure

Бюджет подписки Azure можно создать на месячный, квартальный или годовой период.

Чтобы создать или просмотреть бюджет, откройте нужную область на портале Azure и выберите в меню **Бюджеты**. Например, перейдите к разделу **Подписки**, выберите подписку из списка и выберите в меню **Бюджеты**. Используйте пилюлю **Область**, чтобы переключиться в пункте "Бюджеты" на другую область, например в группу управления. См. [основные сведения об областях и работе с ними](understand-work-scopes.md).

После создания бюджетов вы увидите упрощенную схему текущих затрат.

Выберите **Добавить**.

![Пример, в котором показан список уже созданных бюджетов](./media/tutorial-acm-create-budgets/budgets01.png)

Убедитесь, что указанная в окне **Создание бюджета** область правильная. Выберите фильтры, которые нужно добавить. Фильтры позволяют создавать бюджеты по конкретным затратам, таким как группы ресурсов в подписке или службе, например виртуальные машины. Любой фильтр, который можно использовать в анализе затрат, также можно применить к бюджету.

Определив область и фильтры, введите имя бюджета. Затем выберите ежемесячный, ежеквартальный или ежегодный период сброса бюджета. Этот период сброса определяет окно времени, которое анализируется бюджетом. Стоимость, оцененная бюджетом, начинается с нуля в начале каждого нового периода. Создание квартального бюджета происходит таким же образом, как и создание ежемесячного бюджета. Разница заключается в том, что сумма ежеквартального бюджета равномерно распределяется по трем месяцам. Сумма ежегодного бюджета равномерно распределяется по 12 месяцам календарного года.

Если у вас есть подписка с оплатой по мере использования, подписка MSDN или подписка Visual Studio, ваш период выставления счетов может не совпадать с календарным месяцем. Для таких типов подписок и групп ресурсов можно создать бюджет, который соответствует периоду выставления счетов или календарным месяцам. Чтобы создать бюджет, выравниваемый по расчетному периоду, выберите период сброса: **Месяц выставления счетов**, **Квартал выставления счетов**или **Год выставления счетов**. Чтобы создать бюджет, выравниваемый по календарному месяцу, выберите период сброса: **Ежемесячный**, **Ежеквартальный**или **Ежегодный**.

Затем найдите дату окончания срока действия, когда бюджет станет недействительным, и остановите оценку затрат.

В результате будет отображаться диаграмма на основе полей, выбранных в бюджете до сих пор, помогающая выбрать пороговое значение, которое будет использоваться для бюджета. Предлагаемый бюджет основан на наивысшей прогнозируемой стоимости, которая может возникнуть в будущих периодах. Сумму бюджета можно изменить.

![Пример, демонстрирующий создание бюджета с использованием данных о месячных затратах ](./media/tutorial-acm-create-budgets/monthly-budget01.png)

После настройки суммы бюджета выберите **Далее**, чтобы настроить оповещения бюджета. Для бюджета требуется указать как минимум одно пороговое значение (% бюджета) и соответствующий адрес электронной почты. При необходимости можно добавить не более пяти пороговых значений и пяти адресов электронной почты в один бюджет. При достижении порога бюджета уведомления по электронной почте обычно отправляются в течение часа после оценки.

Если вы хотите получать сообщения по электронной почте, добавьте azure-noreply@microsoft.com в список утвержденных отправителей, чтобы сообщения не отправлялись в папку спама. Дополнительные сведения об уведомлениях см. в статье [Use cost alerts to monitor usage and spending](../../cost-management/cost-mgt-alerts-monitor-usage-spending.md) (Мониторинг использования и расходов с помощью уведомлений о затратах).

В приведенном ниже примере оповещение по электронной почте генерируется при достижении 90 % бюджета. При создании бюджета с помощью API бюджетов можно также назначать роли пользователям для получения оповещений. Назначение ролей пользователям не поддерживается на портале Azure. Дополнительные сведения об API бюджетов Azure см. в статье [Budgets](/rest/api/consumption/budgets) (Бюджеты).

Ограничения оповещений поддерживают диапазон 0,01–1000 % от указанного порога бюджета.

![Пример отображения условий оповещения](./media/tutorial-acm-create-budgets/monthly-budget-alert.png)

После создания бюджета, отображается анализ затрат. Просмотр бюджета по вашей тенденции расходов является одним из начальных шагов [анализа затраты и расходов](../../cost-management/quick-acm-cost-analysis.md).

![Пример бюджета и расходов в анализе затрат](./media/tutorial-acm-create-budgets/cost-analysis.png)

В приведенном выше примере вы создали бюджет для подписки. Можно также создать бюджет для группы ресурсов. Если вы хотите создать бюджет для группы ресурсов, перейдите к **Cost Management + Billing** (Управление затратами и выставление счетов) &gt; **Подписки** &gt; выберите подписку > **Группа ресурсов** > выберите группу ресурсов > **Бюджеты** > и затем **Добавить** бюджет.

### <a name="create-a-budget-for-combined-azure-and-aws-costs"></a>Создание бюджета для объединенных затрат на Azure и AWS

Вы можете объединить затраты на Azure и AWS. Для этого нужно назначить соединителю группу управления и ее консолидированные и связанные учетные записи. Назначьте подписки Azure той же группе управления. Затем создайте бюджет для объединенных затрат.

1. В разделе "Управление затратами" выберите **Бюджеты**.
1. Выберите **Добавить**.
1. Выберите **Изменить область**, а затем выберите группу управления.
1. Продолжите создание бюджета.

## <a name="costs-in-budget-evaluations"></a>Затраты на вычисления бюджета

Вычисление бюджетных затрат теперь включают зарезервированный экземпляр и данные о приобретении. Если плата взимается с вас, вы можете получать уведомления, так как плата включается в ваши вычисления. Мы рекомендуем войти на [портал Azure](https://portal.azure.com), чтобы убедиться, что пороги бюджета правильно настроены для учета новых затрат. Выставленные счета за использование Azure не изменяются. Теперь бюджеты оцениваются по более полному набору затрат. Если плата взимается не с вас, поведение бюджета остается неизменным.

Если вы хотите отфильтровать новые затраты, чтобы бюджеты рассчитывались только по основным затратам на потребление, добавьте в свой бюджет следующие фильтры:

- Тип издателя: Azure
- Тип платежей: Использование

Вычисления бюджетных затрат основываются на фактических затратах. Они не включают в себя амортизацию. Дополнительные сведения о параметрах фильтрации, доступных в бюджетах, см. в разделе [Основные сведения о параметрах группирования и фильтрации](group-filter.md).

## <a name="trigger-an-action-group"></a>Активация группы действий

При создании или изменении бюджета для области подписки или группы ресурсов ее можно настроить для вызова группы действий. При достижении порогового значения бюджета группа действий может выполнять различные действия. Группы действий в настоящее время поддерживаются только для областей подписок и групп ресурсов. Дополнительные сведения о группах действия см. в статье [Create and manage action groups in the Azure portal](../../azure-monitor/platform/action-groups.md) (Создание групп действий и управление ими на портале Azure). Дополнительные сведения об использовании автоматизации на основе бюджета с группами действий см. в статье [Manage costs with Azure budgets](../manage/cost-management-budget-scenario.md) (Управление затратами с помощью бюджетов Azure).

Чтобы создать или обновить группы действий, выберите **Управление группами действий** во время создания или изменения бюджета.

![Пример создания бюджета для отображения управления группами действий](./media/tutorial-acm-create-budgets/manage-action-groups01.png)

Затем выберите **Добавить группу действий** и создайте группу действий.

![Изображение поля "Добавление группы действий"](./media/tutorial-acm-create-budgets/manage-action-groups02.png)

После создания группы действий закройте поле, чтобы вернуться к вашему бюджету.

Настройте бюджет на использование группы действий при достижении конкретного порогового значения. Поддерживается до пяти различных пороговых значений.

![Пример, демонстрирующий выбор группы действий для условия оповещения](./media/tutorial-acm-create-budgets/manage-action-groups03.png)

В следующем примере показаны пороговые значения бюджета, равные 50 %, 75 % и 100 %. Каждый из них настроен для активации указанных действий в назначенной группе действий.

![Пример, в котором показаны условия предупреждений, настроенные с различными группами и типами действий](./media/tutorial-acm-create-budgets/manage-action-groups04.png)

Интеграция бюджета с группами действий работает только для групп действий, для которых отключена общая схема предупреждений. Дополнительные сведения об отключении схемы см. в разделе [How do I enable the common alert schema?](../../azure-monitor/platform/alerts-common-schema.md#how-do-i-enable-the-common-alert-schema) (Как включить общую схему оповещений?)

## <a name="create-and-edit-budgets-with-powershell"></a>Создание и изменение бюджетов с помощью PowerShell

Клиенты EA могут создавать и изменять бюджет программным способом с помощью модуля Azure PowerShell.  Чтобы скачать последнюю версию Azure PowerShell, выполните следующую команду.

```azurepowershell-interactive
install-module -name Az
```

Следующие примеры команд создают бюджет.

```azurepowershell-interactive
#Sign into Azure Powershell with your account

Connect-AzAccount

#Select a subscription to to monitor with a budget

select-AzSubscription -Subscription "Your Subscription"

#Create an action group email receiver and corresponding action group

$email1 = New-AzActionGroupReceiver -EmailAddress test@test.com -Name EmailReceiver1
$ActionGroupId = (Set-AzActionGroup -ResourceGroupName YourResourceGroup -Name TestAG -ShortName TestAG -Receiver $email1).Id

#Create a monthly budget that sends an email and triggers an Action Group to send a second email. Make sure the StartDate for your monthly budget is set to the first day of the current month. Note that Action Groups can also be used to trigger automation such as Azure Functions or Webhooks.

New-AzConsumptionBudget -Amount 100 -Name TestPSBudget -Category Cost -StartDate 2020-02-01 -TimeGrain Monthly -EndDate 2022-12-31 -ContactEmail test@test.com -NotificationKey Key1 -NotificationThreshold 0.8 -NotificationEnabled -ContactGroup $ActionGroupId
```
## <a name="create-a-budget-with-an-azure-resource-manager-template"></a>Создание бюджета с помощью шаблона Azure Resource Manager

Вы можете создать бюджет, используя шаблон Azure Resource Manager. Сведения об использовании шаблона см. в статье [Создание бюджета с помощью шаблона Azure Resource Manager](quick-create-budget-template.md).

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание бюджета на портале Azure
> * Создание и изменение бюджетов с помощью PowerShell
> * Создание бюджета с помощью шаблона Azure Resource Manager

Перейдите к следующему руководству, чтобы создать повторяющийся экспорт данных управления затратами.

> [!div class="nextstepaction"]
> [Создание и управление экспортированными данными](tutorial-export-acm-data.md)
