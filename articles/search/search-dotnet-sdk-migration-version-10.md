---
title: Обновление до пакета SDK .NET для поиска Azure версии 10 — Поиск Azure
description: Перенесите код в пакет SDK .NET для службы поиска Azure версии 10 из старых версий. Сведения о новых возможностях и необходимых изменениях кода.
author: arv100kri
manager: nitinme
services: search
ms.service: search
ms.devlang: dotnet
ms.topic: conceptual
ms.date: 08/12/2019
ms.author: arjagann
ms.custom: seodec2018
ms.openlocfilehash: e4633a1c0543331b0ea9820703ed685fb99f2130
ms.sourcegitcommit: 7a6d8e841a12052f1ddfe483d1c9b313f21ae9e6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/30/2019
ms.locfileid: "70182366"
---
# <a name="upgrade-to-the-azure-search-net-sdk-version-10"></a>Обновление до пакета SDK .NET для поиска Azure версии 10

Если вы используете [пакет SDK для .NET для службы поиска Azure](https://aka.ms/search-sdk)версии 9,0 или более поздней, эта статья поможет вам обновить приложение для использования версии 10.

Более общее пошаговое руководство по пакету SDK, включая примеры, см. в разделе [Использование службы поиска Azure в приложении .NET](search-howto-dotnet-sdk.md).

Версия 10 добавляет несколько функций и исправления ошибок, применяя их к тому же функциональному уровню, что и последний выпуск REST API `2019-05-06`версии. В случаях, когда изменение нарушает существующий код, мы рассмотрим [шаги, необходимые для решения проблемы](#UpgradeSteps).

> [!NOTE]
> Если вы используете версию 8,0-Preview или более раннюю версию, сначала необходимо выполнить обновление до версии 9, а затем выполнить обновление до версии 10. Инструкции см. в разделе [обновление до пакета SDK .NET для службы поиска Azure версии 9](search-dotnet-sdk-migration-version-9.md) .
>
> Экземпляр службы поиска Azure поддерживает несколько версий REST API, включая последнюю. Можно продолжать использовать версию, которая больше не является последней, но рекомендуется выполнить перенос кода, чтобы использовать последнюю версию. При использовании REST API необходимо указывать версию API в каждом запросе с помощью параметра api-version. При использовании пакета SDK для .NET версия пакета SDK, которую вы используете, определяет соответствующую версию REST API. Если вы используете устаревшую версию пакета SDK, можно продолжать выполнять этот код без изменений, даже если служба обновлена для поддержки более новой версии API.

<a name="WhatsNew"></a>

## <a name="whats-new-in-version-10"></a>Новые возможности версии 10
Версия 10 пакета SDK .NET для поиска Azure предназначена для последней общедоступной версии службы поиска Azure REST API (`2019-05-06`) с этими обновлениями:

* Появление двух новых навыков — [условного](cognitive-search-skill-conditional.md) навыка и [навыков перевода текста](cognitive-search-skill-text-translation.md).
* Для обеспечения консолидации из вложенных контекстов в качестве входных данных по [навыкам фигуры](cognitive-search-skill-shaper.md) были внесены реструктуризации. Дополнительные сведения см. в этом [примере определения JSON](https://docs.microsoft.com/azure/search/cognitive-search-skill-shaper#scenario-3-input-consolidation-from-nested-contexts).
* Добавление двух новых [функций сопоставления полей](search-indexer-field-mappings.md):
    - [urlEncode](https://docs.microsoft.com/azure/search/search-indexer-field-mappings#urlencode-function)
    - [урлдекоде](https://docs.microsoft.com/azure/search/search-indexer-field-mappings#urldecode-function)
* В некоторых случаях ошибки и предупреждения, отображаемые в [состоянии выполнения индексатора](https://docs.microsoft.com/rest/api/searchservice/get-indexer-status) , могут содержать дополнительные сведения, помогающие при отладке. `IndexerExecutionResult`был обновлен для отражения этого поведения.
* Отдельные уровни опыта, определенные в наборе [навыков](cognitive-search-defining-skillset.md) , при необходимости можно определить, `name` указав свойство.
* `ServiceLimits`показывает ограничения для [сложных типов](https://docs.microsoft.com/azure/search/search-howto-complex-data-types) и `IndexerExecutionInfo` показывает соответствующие ограничения и квоты индексатора.

<a name="UpgradeSteps"></a>

## <a name="steps-to-upgrade"></a>Действия по обновлению

1. Обновите ссылку NuGet для `Microsoft.Azure.Search` использования консоли диспетчера пакетов NuGet или щелкнув правой кнопкой мыши ссылку на проект и выбрав пункт "Управление пакетами NuGet...". в Visual Studio.

2. После того как NuGet загрузит новые пакеты и их зависимости, перестройте проект. 

3. В случае сбоя сборки необходимо исправить все ошибки сборки. Дополнительные сведения о том, как устранить каждую возможную ошибку сборки, см. в разделе [критические изменения в версии 10](#ListOfChanges) .

4. После устранения предупреждений и ошибок сборки при необходимости можно внести изменения в приложение, чтобы воспользоваться преимуществами новых функциональных возможностей. Новые возможности в пакете SDK подробно описаны в новых возможностях [версии 10](#WhatsNew).

<a name="ListOfChanges"></a>

## <a name="breaking-changes-in-version-10"></a>Критические изменения в версии 10

В версии 10 имеется несколько критических изменений, которые могут потребовать изменения кода в дополнение к перестроению приложения.

> [!NOTE]
> Список изменений ниже не является исчерпывающим. Некоторые изменения, скорее всего, не приведут к ошибкам сборки, но технически нарушаются, так как они нарушают двоичную совместимость со сборками, зависящими от предыдущих версий сборок пакета SDK .NET для службы поиска Azure. Важные изменения, которые попадают в эту категорию, также перечислены вместе с рекомендациями. Перестройте приложение при обновлении до версии 10, чтобы избежать проблем с совместимостью двоичных файлов.

### <a name="custom-web-api-skill-definition"></a>Определение навыка настраиваемого веб-API

Определение [настраиваемого навыка веб-API](cognitive-search-custom-skill-web-api.md) было неправильно указано в версии 9 и более старых. 

Модель для `WebApiSkill` указанного `HttpHeaders` свойства объекта, _содержащего_ словарь. Создание набора навыков с помощью `WebApiSkill` этого способа приведет к возникновению исключения, поскольку REST API считать, что запрос сформирован неправильно. Эта проблема устранена путем создания `HttpHeaders` `WebApiSkill` **свойства словаря верхнего уровня** в самой модели, которое считается допустимым запросом из REST API.

Например, если ранее была предпринята попытка создать экземпляр `WebApiSkill` класса следующим образом:

```csharp

var webApiSkill = new WebApiSkill(
            inputs, 
            outputs,
            uri: "https://contoso.example.org")
{
    HttpHeaders = new WebApiHttpHeaders()
    {
        Headers = new Dictionary<string, string>()
        {
            ["header"] = "value"
        }
    }
};

```

Измените его следующим образом, чтобы избежать ошибки проверки REST API:

```csharp

var webApiSkill = new WebApiSkill(
            inputs, 
            outputs,
            uri: "https://contoso.example.org")
{
    HttpHeaders = new Dictionary<string, string>()
    {
        ["header"] = "value"
    }
};

```

## <a name="shaper-skill-allows-nested-context-consolidation"></a>Уровень навыка "Фигура" допускает консолидацию вложенного контекста

Теперь у формы "навык" можно разрешить консолидацию входных данных из вложенных контекстов. Чтобы включить это изменение, мы изменили `InputFieldMappingEntry` его, чтобы можно было создать экземпляр, указав `Source` только `SourceContext` свойство или свойства и `Inputs` .

Вам, скорее всего, не потребуется вносить изменения в код. Однако обратите внимание, что допускается только одно из этих двух сочетаний. Это означает следующее:

- Допускается создание только `Source` техмест,гдеинициализирована`InputFieldMappingEntry` только инициализация.
- Допускается создание только, `SourceContext` `Inputs` если инициализированы только и. `InputFieldMappingEntry`
- Все остальные сочетания, включающие эти три свойства, недопустимы.

Если вы решили приступить к использованию этой новой возможности, перед развертыванием этого изменения убедитесь, что все клиенты обновлены для использования версии 10. В противном случае существует вероятность того, что обновление клиента (с использованием более старой версии пакета SDK) на уровень навыка может привести к ошибкам проверки.

> [!NOTE]
> Несмотря на то, `InputFieldMappingEntry` что базовая модель была изменена, чтобы обеспечить консолидацию из вложенных контекстов, она используется только в пределах определения навыка для фигуры. Использование этой возможности в других навыках во время компиляции приводит к ошибке проверки в среде выполнения.

## <a name="skills-can-be-identified-by-a-name"></a>Навыки можно идентифицировать по имени

Каждый навык в наборе навыков теперь имеет новое свойство `Name`, которое можно инициализировать в коде, чтобы помочь определить навык. Это необязательный параметр — если не задано (по умолчанию, если не было сделано явного изменения кода), ему присваивается имя по умолчанию с использованием индекса уровня опыта в наборе, который начинается с символа "#". Например, в следующем определении набора навыков (большинство инициализаций пропускаются для краткости):

```csharp
var skillset = new Skillset()
{
    Skills = new List<Skill>()
    {
        new SentimentSkill(),
        new WebApiSkill(),
        new ShaperSkill(),
        ...
    }
}
```

`SentimentSkill`присваивается `#1`имя, `WebApiSkill` назначается `#2` `ShaperSkill` ,`#3` назначается и т. д.

Если вы решили определить навыки по пользовательскому имени, сначала обновите все экземпляры клиентов до версии 10 пакета SDK. В противном случае существует вероятность, что клиент, использующий более старую версию `null` пакета SDK `Name` , может получить свойство навыка, что приведет к тому, что клиент вернется к схеме именования по умолчанию.

## <a name="details-about-errors-and-warnings"></a>Сведения об ошибках и предупреждениях

`ItemError`и `ItemWarning` модели, инкапсулирующие подробные сведения об ошибках и предупреждениях (соответственно), происходящие при выполнении индексатора, были изменены с целью включения в процесс отладки индексатора трех новых свойств. Эти свойства:

- `Name`. Имя источника, в котором возникла ошибка. Например, он может ссылаться на определенный навык в присоединенном наборе навыков.
- `Details`. Дополнительные подробные сведения об ошибке или предупреждении.
- `DocumentationLink`. Ссылка на руководство по устранению неполадок для конкретной ошибки или предупреждения.

> [!NOTE]
> Мы начали структурировать наши ошибки и предупреждения, чтобы включить эти полезные сведения, когда это возможно. Мы работаем над тем, чтобы для всех ошибок и предупреждений эти сведения присутствовали, но это выполняемая работа, и эти дополнительные сведения не всегда могут быть заполнены.

## <a name="next-steps"></a>Следующие шаги

- Изменения, внесенные в навык создания фигуры, имеют наибольшее влияние на новый или существующий код. В качестве следующего шага перейдите к следующему примеру, чтобы проиллюстрировать входную структуру: [Пример определения навыков JSON](cognitive-search-skill-shaper.md)
- Ознакомьтесь с [руководством по поиску и настройке](cognitive-search-concept-intro.md).
- Будем рады вашим отзывам о пакете SDK. При возникновении проблем вы можете попросить нас получить помощь по [Stack overflow](https://stackoverflow.com/questions/tagged/azure-search). При обнаружении ошибки можно зарегистрировать проблему в [репозитории GitHub пакета SDK .NET для Azure](https://github.com/Azure/azure-sdk-for-net/issues). Добавьте в заголовок вашей проблемы префикс "[Azure Search]".

