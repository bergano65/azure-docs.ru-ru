---
title: Создание индекса
titleSuffix: Azure Cognitive Search
description: Содержит основные понятия и средства индексирования в Когнитивный поиск Azure, включая определения схемы и физическую структуру данных.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/03/2021
ms.openlocfilehash: d9f4ba48a7dc6cdcf6d60e4e9da5f68fcc6b1f28
ms.sourcegitcommit: b85ce02785edc13d7fb8eba29ea8027e614c52a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "99509339"
---
# <a name="creating-search-indexes-in-azure-cognitive-search"></a>Создание индексов поиска в Azure Когнитивный поиск

Поисковый индекс хранит содержимое, доступное для поиска, которое используется для полнотекстовых и отфильтрованных запросов. Индекс определяется схемой и сохраняется в службе, при этом импорт данных производится на втором шаге. 

Индексы содержат *документы*. Документ представляет собой единый блок доступных для поиска данных в индексе. У розничного продавца может быть документ для каждого продукта, Организация новостей может иметь документ для каждой статьи и т. д. Сопоставление этих концепций с более привычными эквивалентами баз данных: *индекс поиска* эквивалентен *таблице*, а *документы* примерно эквивалентны *строкам* в таблице.

## <a name="whats-an-index-schema"></a>Что такое схема индексов?

Физическая структура индекса определяется схемой. Коллекция "Fields" обычно является самой крупной частью индекса, где каждое поле имеет имя, ему назначается [тип данных](/rest/api/searchservice/Supported-data-types)и с атрибутами разрешено поведение, определяющее его использование.

```json
{
  "name": "name_of_index, unique across the service",
  "fields": [
    {
      "name": "name_of_field",
      "type": "Edm.String | Collection(Edm.String) | Edm.Int32 | Edm.Int64 | Edm.Double | Edm.Boolean | Edm.DateTimeOffset | Edm.GeographyPoint",
      "searchable": true (default where applicable) | false (only Edm.String and Collection(Edm.String) fields can be searchable),
      "filterable": true (default) | false,
      "sortable": true (default where applicable) | false (Collection(Edm.String) fields cannot be sortable),
      "facetable": true (default where applicable) | false (Edm.GeographyPoint fields cannot be facetable),
      "key": true | false (default, only Edm.String fields can be keys),
      "retrievable": true (default) | false,
      "analyzer": "name_of_analyzer_for_search_and_indexing", (only if 'searchAnalyzer' and 'indexAnalyzer' are not set)
      "searchAnalyzer": "name_of_search_analyzer", (only if 'indexAnalyzer' is set and 'analyzer' is not set)
      "indexAnalyzer": "name_of_indexing_analyzer", (only if 'searchAnalyzer' is set and 'analyzer' is not set)
      "synonymMaps": [ "name_of_synonym_map" ] (optional, only one synonym map per field is currently supported)
    }
  ],
  "suggesters": [ ],
  "scoringProfiles": [ ],
  "analyzers":(optional)[ ... ],
  "charFilters":(optional)[ ... ],
  "tokenizers":(optional)[ ... ],
  "tokenFilters":(optional)[ ... ],
  "defaultScoringProfile": (optional) "...",
  "corsOptions": (optional) { },
  "encryptionKey":(optional){ }
  }
}
```

Другие элементы свернуты для краткости, но следующие ссылки могут предоставить подробные [сведения: средства](index-add-suggesters.md)подбора, [Профили оценки](index-add-scoring-profiles.md), [анализаторы](search-analyzers.md) , используемые для обработки строк в токенах в соответствии с лингвистическими правилами или другими характеристиками, поддерживаемыми анализатором, и настройками [удаленного создания сценариев (CORS) для разных источников](#corsoptions) .

## <a name="choose-a-client"></a>Выбор клиента

Существует несколько методологий для создания индекса поиска. Для раннего тестирования и проверки концепции рекомендуется использовать интерфейсы API портал Azure или служб.

Во время разработки спланируйте частые перестроение. Так как физические структуры создаются в службе, [Удаление и повторное создание индексов](search-howto-reindex.md) необходимы для большинства изменений в определении существующего поля. Можно рассмотреть возможность использования подмножества данных, чтобы ускорить перестроение.

### <a name="permissions"></a>Разрешения

Все операции, связанные с индексом поиска, включая GET, запрашивают его определение, для запроса требуется [Административный ключ API](search-security-api-keys.md) .

### <a name="limits"></a>Ограничения

Все [уровни служб ограничивают](search-limits-quotas-capacity.md#index-limits) количество объектов, которые можно создать. Если вы поэкспериментируем на уровне Free, в любой момент времени можно иметь только 3 индекса.

### <a name="use-azure-portal-to-create-a-search-index"></a>Использование портал Azure для создания индекса поиска

Портал предоставляет два варианта создания индекса поиска: [**Мастер импорта данных**](search-import-data-portal.md) и **Добавление индекса** , предоставляющего поля для указания схемы индекса. Пакеты мастера в дополнительных операциях также создаются с помощью индексатора, источника данных и загрузки данных. Если это больше, чем нужно, следует просто использовать **Add index** или другой подход.

На следующем снимке экрана показано, где можно найти **Добавить индекс** на портале. **Импорт данных** — это правая Следующая дверца.

  :::image type="content" source="media/search-what-is-an-index/add-index.png" alt-text="Команда &quot;добавить индекс&quot;" border="true":::

> [!Tip]
> При проектировании индекса на портале применяются требования и правила схемы для конкретных типов данных, например запрещается возможность полнотекстового поиска по числовым полям. После получения работоспособного индекса можно скопировать JSON с портала и добавить его в решение.

### <a name="use-a-rest-client"></a>Использование клиента RESTFUL

POST и Visual Studio Code (с расширением для Когнитивный поиск Azure) могут работать как клиент индекса поиска. С помощью любого из этих средств можно подключиться к службе поиска и отправить запросы на [Создание индекса (RESTful)](/rest/api/searchservice/create-index) . Существует множество руководств и примеров, демонстрирующих клиенты RESTFUL для создания объектов. 

Чтобы узнать о каждом клиенте, начните с любой из этих статей:

+ [Создание индекса поиска с помощью функции RESTFUL и POST](search-get-started-rest.md)
+ [Начало работы с Visual Studio Code и Когнитивным поиском Azure](search-get-started-vs-code.md)

Для получения справки по составления индексных запросов см. [операции с индексами (остальные)](/rest/api/searchservice/index-operations) .

### <a name="use-an-sdk"></a>Использование пакета SDK

Для Когнитивный поиск в пакетах SDK для Azure реализованы общедоступные функции. Таким образом, можно использовать любой из пакетов SDK для создания индекса поиска. Все они предоставляют **SearchIndexClient** с методами создания и обновления индексов.

| Пакет Azure SDK | Клиент | Примеры |
|-----------|--------|----------|
| .NET | [SearchIndexClient](/dotnet/api/azure.search.documents.indexes.searchindexclient) | [Azure-Search-DotNet-Samples/QuickStart/версии 11/](https://github.com/Azure-Samples/azure-search-dotnet-samples/tree/master/quickstart/v11) |
| Java | [SearchIndexClient](/java/api/com.azure.search.documents.indexes.searchindexclient) | [Креатеиндексексампле. Java](https://github.com/Azure/azure-sdk-for-java/blob/azure-search-documents_11.1.3/sdk/search/azure-search-documents/src/samples/java/com/azure/search/documents/indexes/CreateIndexExample.java) |
| JavaScript | [SearchIndexClient](/javascript/api/@azure/search-documents/searchindexclient) | [Индексы](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/search/search-documents/samples/javascript/src/indexes) |
| Python | [SearchIndexClient](/python/api/azure-search-documents/azure.search.documents.indexes.searchindexclient) | [sample_index_crud_operations. Корректировка](https://github.com/Azure/azure-sdk-for-python/blob/7cd31ac01fed9c790cec71de438af9c45cb45821/sdk/search/azure-search-documents/samples/sample_index_crud_operations.py) |

## <a name="defining-fields"></a>Определение полей

Одно поле типа EDM. String должно быть назначено в качестве ключа документа. Он используется для уникальной идентификации каждого документа поиска. Документ можно получить по ключу, чтобы заполнить страницу сведений.  

Если входящие данные являются иерархическими, назначьте тип данных [сложного типа](search-howto-complex-data-types.md) для представления вложенных структур. Встроенный набор данных в гостиницах иллюстрирует сложные типы с использованием адреса (содержит несколько вложенных полей), которые имеют связь "один к одному" с каждым Гостиницы, и сложную коллекцию комнат, в которой несколько комнат связаны с каждым гостиницы. 

Перед созданием индекса назначьте все анализаторы строковым полям. Сделайте то же самое для предложений, если хотите включить автозаполнение для конкретных полей.

<a name="index-attributes"></a>

### <a name="attributes"></a>Атрибуты

Атрибуты поля определяют, как используется поле, например, используется ли полнотекстовый поиск, фасетная навигация, операции сортировки и т д. 

Строковые поля часто помечаются как "доступные для поиска" и "могут быть извлечены". Поля, используемые для ограничения результатов поиска, включают "сортируемый", "фильтруемый" и "многогранный".

|attribute|Описание|  
|---------------|-----------------|  
|возможностью поиска |Полнотекстовый поиск, подлежащий лексическому анализу, такому как разбиения на слова во время индексации. Если, например, задать для поля, поддерживающего поиск, значение sunny day (солнечный день), оно будет разделено на элементы sunny и day. Дополнительные сведения см. в статье [Как работает полнотекстовый поиск в службе поиска Azure](search-lucene-query-architecture.md).|  
|Фильтруемые |Указывается в запросах $filter. Для фильтруемых полей типа `Edm.String` и `Collection(Edm.String)` не выполняется разбиение на слова, поэтому они могут попасть в результаты поиска только по точному совпадению. Например, если для такого поля задать значение sunny day, запрос `$filter=f eq 'sunny'` не вернет совпадений, а запрос — `$filter=f eq 'sunny day'` вернет. |  
|Сортируемый |По умолчанию система сортирует результаты по их оценке, однако можно настроить сортировку на основе полей в документах. Поля типа `Collection(Edm.String)` не могут быть отсортированы. |  
|аспектируемый |Обычно используется в представлении результатов поиска, включающих количество обращений по категориям (например, отелей в определенном городе). Этот параметр не предназначен для использования с полями типа `Edm.GeographyPoint`. Поля типа `Edm.String` , доступные для фильтрации, "сортируемый" или "Facet", могут иметь длину не более 32 КБ. Дополнительные сведения см. в статье [Create Index (Azure Search Service REST API)](/rest/api/searchservice/create-index) (Создание индекса в REST API службы Поиска Azure).|  
|раздел |Уникальный идентификатор для документов в индексе. Только одно поле должно быть выбрано ключевым и оно должно иметь тип `Edm.String`.|  
|извлекаемые |Определяет, включается ли поле в возвращаемые поиском результаты. Этот атрибут полезен, когда поле (например, *показатель прибыльности*) нужно использовать для фильтрации, сортировки или оценки, но оно не должно отображаться конечному пользователю. У полей с установленным свойством `true` for `key` .|  

Несмотря на то что вы в любой момент можете добавить новые поля, имеющиеся определения полей блокируются на время существования индекса. По этой причине разработчики обычно используют портал для создания простых индексов, тестирования идей или используют страницы портала для поиска параметра. Частая итерация по структуре индекса более эффективна, если следовать подходу на основе кода для легкой перестройки индекса.

> [!NOTE]
> API-интерфейсы, используемые для построения индекса, имеют различные поведения по умолчанию. Для [интерфейсов API остальной части](/rest/api/searchservice/Create-Index)по умолчанию включены большинство атрибутов (например, "доступные для поиска" и "извлечение" для строковых полей), и часто их нужно задавать только в том случае, если их нужно отключить. Для пакета SDK для .NET противоположным является true. В любом свойстве, которое не задано явно, по умолчанию следует отключить соответствующее поведение поиска, если только вы не включили его явным образом.

<a name="index-size"></a>

## <a name="attributes-and-index-size-storage-implications"></a>Атрибуты и размер индекса (проблемы с хранилищем)

Размер индекса определяется размером отправляемых документов, а также конфигурацией индекса, например включением предложений и определением атрибутов для отдельных полей. 

На следующем снимке экрана показаны шаблоны хранения индекса, полученные в результате различных сочетаний атрибутов. Индекс основан на **образце индекса** недвижимости, который можно легко создать с помощью мастера импорта данных. Хотя схемы индексов не показаны, атрибуты можно определить на основе имени индекса. Например, индекс *Realestate-* Indexed имеет выбранный атрибут "с возможностью поиска", и ничего другого, *Realestate-извлечение* индекса не имеет выбранного атрибута "извлечь" и ничего другого и т. д.

![Размер индекса на основе выбора атрибута](./media/search-what-is-an-index/realestate-index-size.png "Размер индекса на основе выбора атрибута")

Хотя эти варианты индекса являются искусственными, они подходят для общего сравнения влияния различных атрибутов на размер хранилища. Устанавливает ли параметр "получение" размера индекса? Нет. Добавляет ли поле к **предложению** для увеличения размера индекса? Да.

Индексы, поддерживающие фильтрацию и сортировку, пропорционально больше индексов, поддерживающих только полнотекстовый поиск. Это связано с тем, что операции фильтрации и сортировки просматривают точные совпадения, что требует наличия строк буквального текста. В отличие от этого, доступные для поиска поля, поддерживающие полнотекстовые запросы, используют Инвертированные индексы, заполненные маркерами, которые потребляют меньше места по сравнению с документами в целом. 

> [!Note]
> Архитектура хранилища считается подробной реализацией Azure Когнитивный поиск и может измениться без предварительного уведомления. Нет никакой гарантии, что ее текущее поведение будет сохранено в будущем.

<a name="corsoptions"></a>

## <a name="about-corsoptions"></a>О `corsOptions`

Схемы индексов включают раздел для настройки `corsOptions` . По умолчанию клиентский код JavaScript не может обращаться к API, так как браузер блокирует все запросы между разными источниками. Чтобы разрешить запросы между источниками к нужному индексу, включите CORS (Cross-Origin Resource Sharing — общий доступ к ресурсам независимо от источника), установив атрибут **corsOptions**. По соображениям безопасности технологию CORS поддерживают только интерфейсы API запросов. 

Для технологии CORS можно настроить перечисленные ниже параметры.

+ **allowedOrigins** (обязательно) — это список источников, которым будет предоставлен доступ к индексу. Это означает, что любой код JavaScript из такого источника сможет отправлять запросы к этому индексу (при условии, что указан правильный ключ API). Источники здесь обычно задаются в формате `protocol://<fully-qualified-domain-name>:<port>`, хотя `<port>` часто опускается. Дополнительные сведения см. в статье Википедии [о предоставлении ресурсов для нескольких источников](https://en.wikipedia.org/wiki/Cross-origin_resource_sharing).

  Если вы хотите разрешить доступ всем источникам, добавьте в массив **allowedOrigins** единственный элемент `*`. *Этот вариант не рекомендуется для служб поиска в рабочей среде*, но часто он удобен для разработки и отладки.

+ **maxAgeInSeconds** (необязательно): браузеры используют это значение для определения длительности (в секундах) для кэширования предпечатных ответов CORS. Это значение должно быть целой неотрицательной величиной. Чем оно больше, чем выше производительность, однако при этом применение изменений в политике CORS занимает больше времени. Если это значение не задано, длительность по умолчанию составляет 5 минут.

## <a name="next-steps"></a>Дальнейшие действия

Вы можете получить практический опыт создания индекса, используя практически любой пример или Пошаговое руководство для Когнитивный поиск. Чтобы приступить к работе, можно выбрать любое из кратких руководств в оглавлении.

Кроме того, вы захотите ознакомиться с методологиями загрузки индекса с данными. Определение индекса и заполнение выполняются вместе. Дополнительные сведения приведены в следующих статьях.

+ [Общие сведения об импорте данных](search-what-is-data-import.md)

+ [Добавление, обновление и удаление документов (остальное)](/rest/api/searchservice/addupdate-or-delete-documents) 