---
title: Администрирование службы на портале
titleSuffix: Azure Cognitive Search
description: Управление службой Когнитивный поиск Azure, размещенной облачной службой поиска на Microsoft Azure с помощью портал Azure.
manager: nitinme
author: HeidiSteen
ms.author: heidist
tags: azure-portal
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 06/24/2020
ms.openlocfilehash: 84ddc4b427f6dc168c044f34b41e81e3b0ff19e5
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "88935047"
---
# <a name="service-administration-for-azure-cognitive-search-in-the-azure-portal"></a>Администрирование служб для Azure Когнитивный поиск в портал Azure

> [!div class="op_single_selector"]
>
> * [PowerShell](search-manage-powershell.md)
> * [REST API](/rest/api/searchmanagement/)
> * [Пакет SDK для .NET](/dotnet/api/microsoft.azure.management.search)
> * [Портал](search-manage.md)
> * [Языке](https://pypi.python.org/pypi/azure-mgmt-search/0.1.0)> 

Azure Когнитивный поиск — это полностью управляемая облачная служба поиска, используемая для создания полнофункциональных возможностей поиска в пользовательских приложениях. В этой статье описываются задачи администрирования службы , которые можно выполнять на [портале Azure](https://portal.azure.com) в отношении службы поиска, которая уже была подготовлена. Администрирование службы имеет упрощенный дизайн, который ограничивается следующими задачами:

* Проверьте хранилище с помощью ссылки на среднюю страницу **использования** .
* Проверьте тома запросов и задержки, используя ссылку на **мониторинг** средней страницы и необходимость регулирования запросов.
* Управление доступом с помощью страницы " **ключи** " слева.
* Измените емкость, используя страницу **масштаб** слева.

Те же задачи, которые выполняются на портале, также могут быть обработаны программно с помощью [API-интерфейсов управления](/rest/api/searchmanagement/) и [AZ. выполните поиск модуля PowerShell](search-manage-powershell.md). Задачи администрирования полностью представлены на портале и программных интерфейсах. Нет конкретных административных задач, доступных только в одном модальии.

Azure Когнитивный поиск использует другие службы Azure для более глубокого мониторинга и управления. Само по себе, единственные данные, хранящиеся в службе поиска, — это содержимое (индексы, индексаторы, определения источников данных и другие объекты). Метрики, отправленные на страницы портала, извлекаются из внутренних журналов за 30-дневный цикл. Для хранения журналов и дополнительных событий, управляемых пользователем, потребуется [Azure Monitor](../azure-monitor/index.yml). 

## <a name="fixed-service-properties"></a>Свойства фиксированной службы

Некоторые аспекты службы поиска определяются при подготовке службы и не могут быть изменены позже.

* Имя службы (нельзя переименовать службу)
* Расположение службы (сейчас нельзя переместить нетронутую службу в другой регион)
* Максимальное количество реплик и секций (определяется уровнем, Basic или Standard)

Если вы приступили к базовой версии с максимальным числом секций, а теперь вам нужны дополнительные секции, вам потребуется [создать новую службу](search-create-service-portal.md) на более высоком уровне и повторно создать содержимое в новой службе. 

## <a name="administrator-rights"></a>Права администратора

Подготовку или выведение из эксплуатации самой службы могут выполнять администраторы подписки Azure или соадминистраторы.

В отношении доступа к конечной точке любой пользователь, имеющий доступ к URL-адресу службы и ключ API, имеет доступ к содержимому. Дополнительные сведения о ключах см. [в разделе Управление ключами API](search-security-api-keys.md).

* Доступ только для чтения к службе — права запросов, обычно предоставляемые клиентскому приложению путем предоставления ему URL-адреса и ключа API запроса.
* Доступ для чтения и записи предоставляет возможность добавлять, удалять и изменять объекты сервера, включая ключи API, индексы, индексаторы, источники данных и расписания. Доступ для чтения и записи предоставляется путем предоставления URL-адреса, ключа API администратора.

Права на представление подготовки службы предоставляются с помощью назначений ролей. [Управление доступом на основе ролей Azure (Azure RBAC)](../role-based-access-control/overview.md) — это система авторизации, основанная на [Azure Resource Manager](../azure-resource-manager/management/overview.md) для подготовки ресурсов Azure. 

В контексте Когнитивный поиск Azure [назначения ролей Azure](search-security-rbac.md) определяют, кто может выполнять задачи, независимо от того, используете ли они [портал](search-manage.md), [PowerShell](search-manage-powershell.md)или [интерфейсы API для управления](/rest/api/searchmanagement/search-howto-management-rest-api).

* Создание или удаление службы
* Масштабирование службы
* Удаление или повторное создание ключей API
* Включение ведения журнала диагностики (создание служб)
* Включение аналитики трафика (создание служб)

> [!TIP]
> Используя механизмы Azure, можно заблокировать подписку или ресурс, чтобы предотвратить случайное или несанкционированное удаление службы поиска пользователями с правами администратора. Дополнительные сведения см. [в разделе Блокировка ресурсов для предотвращения непредвиденного удаления](../azure-resource-manager/management/lock-resources.md).

## <a name="logging-and-system-information"></a>Ведение журнала и сведения о системе

На уровне Basic и выше Корпорация Майкрософт следит за всеми службами Когнитивный поиск Azure за 99,9% доступности на соглашения об уровне обслуживания (SLA). Если служба работает медленно, или пропускная способность опускается ниже пороговых значений, предусмотренных соглашением об уровне обслуживания, то группы поддержки изучают доступные файлы журналов и пытаются устранить проблему.

Azure Когнитивный поиск использует [Azure Monitor](../azure-monitor/index.yml) для накопления и хранения операций индексирования и запросов. Сама служба поиска хранит только ее содержимое (индексы, определения индексаторов, определения источников данных, определения навыков, карты синонимов). Кэширование и информация, регистрируемая в журнале, хранятся не в службе, часто в учетной записи хранения Azure. Дополнительные сведения о ведении журналов индексирования и рабочих нагрузок запросов см. в разделе [сбор и анализ данных журнала](search-monitor-logs.md).

С точки зрения общих сведений о службе, используя только средства, встроенные в Azure Когнитивный поиск, можно получить сведения следующими способами.

* Использование страницы **обзора** службы с помощью уведомлений, свойств и сообщений о состоянии.
* Использование [PowerShell](search-manage-powershell.md) или [REST API управления](/rest/api/searchmanagement/) для [получения свойств службы](/rest/api/searchmanagement/services). На программном уровне не предоставлены новые сведения или операции. Существуют интерфейсы, которые позволяют создавать сценарии.

## <a name="monitor-resource-usage"></a>Отслеживание использования ресурсов

На панели мониторинга отслеживание ресурсов ограничивается информацией, показанной на панели мониторинга службы, а также несколькими метриками, которые вы можете получить с помощью запроса к службе. В панели мониторинга службы, в разделе «Использование», вы можете быстро определить, являются ли уровни ресурсов раздела достаточными для вашего приложения. Вы можете подготавливать внешние ресурсы, такие как мониторинг Azure, если вы хотите записывать и сохранять зарегистрированные события. Дополнительные сведения см. в статье [мониторинг когнитивный Поиск Azure](search-monitor-usage.md).

С помощью REST API службы поиска можно программно получить количество документов и индексов: 

* [Получение статистических данных индекса](/rest/api/searchservice/Get-Index-Statistics)
* [Подсчет документов](/rest/api/searchservice/count-documents)

## <a name="disaster-recovery-and-service-outages"></a>Аварийное восстановление и простои службы

Хотя мы можем сохранить данные, Azure Когнитивный поиск не обеспечивает мгновенную отработку отказа службы в случае сбоя на уровне кластера или центра обработки данных. Если сбой кластера произойдет в центре обработки данных, то рабочая группа обнаружит проблему и сделает все возможное для восстановления службы. Во время восстановления службы может произойти простой, но вы можете запросить компенсацию кредитов за недоступность службы в соответствии с условиями [Соглашения об уровне обслуживания (SLA)](https://azure.microsoft.com/support/legal/sla/search/v1_0/). 

Если требуется непрерывное обслуживание в случае критических сбоев, не контролируемых корпорацией Майкрософт, можно [подготовить дополнительную службу](search-create-service-portal.md) в другом регионе и реализовать стратегию георепликации, чтобы обеспечить полную избыточность индексов для всех служб.

Пользователи, использующие [индексаторы](search-indexer-overview.md) для заполнения и обновления индексов, могут выполнять аварийное восстановление с помощью индексаторов в определенном географическом регионе, используя один источник данных. Две службы в разных регионах, в каждой из которых выполняется индексатор, могут индексировать один источник данных для обеспечения географической избыточности. При индексировании из источников данных, которые также являются географически избыточными, следует учитывать, что Azure Когнитивный поиск Индексаторы могут выполнять добавочное индексирование (слияние обновлений из новых, измененных или удаленных документов) от первичных реплик. В случае отработки отказа свяжите индексатор с новой первичной репликой. 

Если вы не используете индексаторы, вместо них будет использоваться код приложения, одновременно передающий объекты и данные в различные службы поиска. Дополнительные сведения см. [в статье производительность и оптимизация в Azure когнитивный Поиск](search-performance-optimization.md).

## <a name="backup-and-restore"></a>Резервное копирование и восстановление

Поскольку Когнитивный поиск Azure не является основным решением для хранения данных, мы не предоставляем формальный механизм для самостоятельного резервного копирования и восстановления. Тем не менее вы можете использовать пример кода для **резервного копирования индексов и восстановления** в этом [репозитории Azure когнитивный Поиск .NET](https://github.com/Azure-Samples/azure-search-dotnet-samples) , чтобы создать резервную копию определения индекса и моментального снимка в серии JSON-файлов, а затем при необходимости использовать эти файлы для восстановления индекса. Это средство также может перемещать индексы между уровнями служб.

В противном случае код приложения, используемый для создания и заполнения индекса, является вариантом восстановления «де-факто», если индекс удаляется по ошибке. Чтобы перестроить индекс, необходимо удалить его (если он существует), заново создать индекс в службе и перезагрузить, получив данные из основного хранилища данных.

## <a name="scale-up-or-down"></a>Масштабирование вверх или вниз

Каждая поисковая служба стартует минимум с одной реплики и одного раздела. Если вы подписались на [уровень, который поддерживает больше емкости](search-limits-quotas-capacity.md), щелкните элемент **масштаб** в левой области навигации, чтобы настроить использование ресурсов.

При добавлении емкости или мощности с помощью какого-либо ресурса служба начинает использовать его автоматически. Никаких дополнительных действий с вашей стороны не требуется, но будет небольшая задержка, прежде чем произойдет задействование нового ресурса. Подготовка дополнительных ресурсов может занять 15 и более минут.

### <a name="add-replicas"></a>Добавление реплик

Увеличение количества запросов в секунду (QPS) или достижение высокой производительности осуществляется посредством добавления реплик. Каждая реплика имеет одну копию индекса, так что добавление еще ​​одной реплики означает перенос еще одного индекса, доступного для обработки запросов службы. Для обеспечения высокой доступности требуется не менее 3 реплик (Дополнительные сведения см. в разделе [Настройка емкости](search-capacity-planning.md) ).

Служба поиска с большим количеством реплик может загружать баланс поисковых запросов по большему числу индексов. Учитывая уровень объема запросов, пропускная способность запросов будет выше, когда существует больше копий индекса, доступных для обслуживания запроса. При возникновении задержки запросов возможен позитивный эффект на производительность, как только дополнительные реплики окажутся в сети.

Несмотря на то, что дополнительные реплики повышают пропускную способность, она в точности не удваивается или утраивается при добавлении реплик к вашей службе. Все приложения поиска могут зависеть от внешних факторов, которые могут противоречить показателям производительности запросов. Сложные запросы и задержки в сети являются факторами, влияющими на изменение времени ответа на запрос.

### <a name="add-partitions"></a>Добавление разделов

Чаще всего добавляются реплики, но если хранилище ограничено, можно добавить секции, чтобы получить больше емкости. Уровень, на котором подготовлена служба, определяет, можно ли добавлять секции. Уровень "базовый" заблокирован в одной секции. Уровни Standard и выше поддерживают дополнительные секции.

Секции добавляются в делители 12 (в частности, 1, 2, 3, 4, 6 или 12). Это артефакт сегментирования. Индекс создается в 12 сегментах, которые все вместе могут храниться в одной секции или равномерно распределяться по 2, 3, 4, 6 или 12 секциям (один сегмент на секцию).

### <a name="remove-replicas"></a>Удаление реплик

После окончания периода большого количества запросов вы можете сократить число реплик с помощью ползунка, когда нагрузки поисковых запросов нормализуются (например, после окончания периода сезонных распродаж). Больше с вашей стороны ничего делать не нужно. Уменьшение количества реплик освобождает виртуальные машины в центре обработки данных. Теперь ваши запросы и операции приема данных будут работать на меньшем количестве виртуальных машин, чем раньше. Минимальное требование — одна реплика.

### <a name="remove-partitions"></a>Удаление разделов

В отличие от удаления реплик, не требующего дополнительных усилий с вашей стороны, удаление пространства хранения - более сложная задача, особенно если вы используете больше хранилищ, чем может быть удалено. Например, если ваше решение использует три секции, то уменьшение размера до одной или двух секций приведет к ошибке, так как новое дисковое пространство меньше, чем требуется для хранения вашего индекса. Поэтому, как вы могли предположить, в такой ситуации рекомендуется удалить индексы или документы в соответствующем индексе для освобождения пространства, или сохранить текущую конфигурацию.

Не существует метода, задающего конкретные сегменты индекса, хранящиеся в каждом разделе. Каждый раздел обеспечивает примерно 25 ГБ в хранилище, так что вам нужно будет сократить хранилище до размера, который может быть размещен на имеющемся количестве разделов. Если вы хотите вернуться к одному разделу, то нужно вместить в него все 12 сегментов.

Чтобы помочь при планировании работы, вы можете проверить хранилище (с использованием раздела [Получение статистики индексов](/rest/api/searchservice/Get-Index-Statistics)), чтобы посмотреть, какой объем на самом деле используется. 

## <a name="next-steps"></a>Дальнейшие действия

* Автоматизация с помощью [PowerShell](search-manage-powershell.md)

* Обзор методов [повышения производительности и оптимизации](search-performance-optimization.md)

* Проверка [функций безопасности](search-security-overview.md) для защиты содержимого и операций

* Включение [ведения журнала диагностики](search-monitor-logs.md) для мониторинга рабочих нагрузок запросов и индексирования