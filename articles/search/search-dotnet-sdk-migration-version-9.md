---
title: Обновление до пакета SDK .NET версии 9 для службы поиска Azure
titleSuffix: Azure Cognitive Search
description: Перенос кода в пакет SDK .NET для службы поиска Azure из более старых версий. Сведения о новых возможностях и необходимых изменениях кода.
manager: nitinme
author: brjohnstmsft
ms.author: brjohnst
ms.service: cognitive-search
ms.devlang: dotnet
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: fcc70267754f7e66f29dd1b855d3efb8b814e78b
ms.sourcegitcommit: b050c7e5133badd131e46cab144dd5860ae8a98e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2019
ms.locfileid: "72793016"
---
# <a name="upgrade-to-azure-search-net-sdk-version-9"></a>Обновление до пакета SDK .NET версии 9 для службы поиска Azure

Если вы используете версию 7,0 (Предварительная версия) или более раннюю версию [пакета SDK для .NET службы поиска Azure](https://aka.ms/search-sdk), эта статья поможет вам обновить приложение для использования версии 9.

> [!NOTE]
> Если вы хотите использовать версию 8,0-Preview для анализа функций, которые не доступны в общедоступной версии, можно также выполнить инструкции, приведенные в этой статье, чтобы выполнить обновление до версии 8,0-Preview с предыдущих версий.

Более общее пошаговое руководство по пакету SDK, включая примеры, см. в разделе [Использование службы поиска Azure в приложении .NET](search-howto-dotnet-sdk.md).

Версия 9 пакета SDK .NET для поиска Azure содержит много изменений, внесенных в более ранних версиях. Некоторые из них являются критическими изменениями, но они должны потребовать лишь относительно незначительных изменений в коде. В разделе [Действия по обновлению](#UpgradeSteps) вы найдете инструкции о том, как изменить код для использования новой версии пакета SDK.

> [!NOTE]
> Если вы используете версию 4,0-Preview или более раннюю версию, сначала необходимо выполнить обновление до версии 5, а затем выполнить обновление до версии 9. Инструкции см. [в разделе Обновление до пакета SDK .NET для поиска Azure](search-dotnet-sdk-migration-version-5.md) .
>
> Экземпляр службы поиска Azure поддерживает несколько версий REST API, включая последнюю. Можно продолжать использовать версию, которая больше не является последней, но рекомендуется выполнить перенос кода, чтобы использовать последнюю версию. При использовании REST API необходимо указывать версию API в каждом запросе с помощью параметра api-version. При использовании пакета SDK для .NET версия пакета SDK, которую вы используете, определяет соответствующую версию REST API. Если вы используете устаревшую версию пакета SDK, можно продолжать выполнять этот код без изменений, даже если служба обновлена для поддержки более новой версии API.

<a name="WhatsNew"></a>

## <a name="whats-new-in-version-9"></a>Новые возможности версии 9
Версия 9 пакета SDK .NET для поиска Azure предназначена для последней общедоступной версии REST API поиска Azure, в частности 2019-05-06. Это дает возможность использовать новые функции службы поиска Azure из приложений для .NET, включая следующие:

* [Обогащение искусственного интеллекта](cognitive-search-concept-intro.md) — это возможность извлечения текста из изображений, больших двоичных объектов и других неструктурированных источников данных. Это позволяет расширить возможности поиска в индексе поиска Azure.
* Поддержка [сложных типов](search-howto-complex-data-types.md) позволяет моделировать почти любую вложенную структуру JSON в индексе поиска Azure.
* [Функция автозаполнения](search-autocomplete-tutorial.md) предоставляет альтернативу API **-** интерфейсу для реализации поведения поиска по мере использования. Автозаполнение "завершает" слово или фразу, вводимую пользователем в данный момент.
* [Режим синтаксического анализа жсонлинес](search-howto-index-json-blobs.md), часть индексирования больших двоичных объектов Azure, создает один документ поиска для каждой сущности JSON, разделенной символом новой строки.

### <a name="new-preview-features-in-version-80-preview"></a>Новые функции предварительного просмотра в версии 8,0 — Предварительная версия
Версия 8,0-Предварительная версия пакета SDK .NET для поиска Azure предназначена для API версии 2017-11-11-Preview. Эта версия включает все функции версии 9, а также:

* [Управляемые клиентом ключи шифрования](search-security-manage-encryption-keys.md) для шифрования на стороне службы — это новая функция предварительной версии. В дополнение к встроенному шифрованию неактивных данных, управляемому корпорацией Майкрософт, можно применить дополнительный уровень шифрования, в котором вы являетесь единственным владельцем ключей.

<a name="UpgradeSteps"></a>

## <a name="steps-to-upgrade"></a>Действия по обновлению
Прежде всего обновите справочник NuGet для `Microsoft.Azure.Search` , воспользовавшись консолью диспетчера пакетов NuGet или щелкнув правой кнопкой мыши ссылки проекта и выбрав "Управление пакетами NuGet" в Visual Studio.

После того как NuGet загрузит новые пакеты и их зависимости, перестройте проект. Сборка может быть выполнена успешно — в зависимости от того, как структурирован ваш код. Если она выполнена, то теперь все готово.

В случае сбоя сборки необходимо исправить все ошибки сборки. Дополнительные сведения о том, как устранить каждую возможную ошибку сборки, см. в разделе [критические изменения в версии 9](#ListOfChanges) .

Могут появиться дополнительные предупреждения о сборке, связанные с устаревшими методами или свойствами. В предупреждениях будет указано, что следует использовать вместо устаревшей функции. Например, если приложение использует свойство `DataSourceType.DocumentDb`, вы получите предупреждение о том, что этот член является устаревшим. Вместо этого используйте CosmosDb.

После устранения предупреждений и ошибок сборки при необходимости можно внести изменения в приложение, чтобы воспользоваться преимуществами новых функциональных возможностей. Новые возможности в пакете SDK подробно описаны в [новой версии 9](#WhatsNew).

<a name="ListOfChanges"></a>

## <a name="breaking-changes-in-version-9"></a>Критические изменения в версии 9

В версии 9 существует несколько критических изменений, которые могут потребовать изменения кода в дополнение к перестроению приложения.

> [!NOTE]
> Список изменений ниже не является исчерпывающим. Некоторые изменения, скорее всего, не приведут к ошибкам сборки, но технически нарушаются, так как они нарушают двоичную совместимость со сборками, зависящими от предыдущих версий сборок пакета SDK .NET для службы поиска Azure. Такие изменения не перечислены ниже. Перестройте приложение при обновлении до версии 9, чтобы избежать проблем с совместимостью двоичных файлов.

### <a name="immutable-properties"></a>Неизменяемые свойства

Открытые свойства нескольких классов модели теперь являются неизменяемыми. Если необходимо создать пользовательские экземпляры этих классов для тестирования, можно использовать новые параметризованные конструкторы:

  - `AutocompleteItem`
  - `DocumentSearchResult`
  - `DocumentSuggestResult`
  - `FacetResult`
  - `SearchResult`
  - `SuggestResult`

### <a name="changes-to-field"></a>Изменения в поле

Класс `Field` был изменен теперь, что он также может представлять сложные поля.

Следующие свойства `bool` теперь допускают значение NULL:

  - `IsFilterable`
  - `IsFacetable`
  - `IsSearchable`
  - `IsSortable`
  - `IsRetrievable`
  - `IsKey`

Это обусловлено тем, что эти свойства теперь должны быть `null` в случае сложных полей. Если у вас есть код, считывающий эти свойства, необходимо подготовиться к обработке `null`. Обратите внимание, что все остальные свойства `Field` всегда были и продолжают допускать значения NULL, а некоторые из них также будут `null` в случае сложных полей, в частности:

  - `Analyzer`
  - `SearchAnalyzer`
  - `IndexAnalyzer`
  - `SynonymMaps`

Конструктор без параметров `Field` был сделан `internal`. Теперь в каждом `Field` требуется явное имя и тип данных во время создания.

### <a name="simplified-batch-and-results-types"></a>Упрощенные типы пакетов и результатов

В версии 7,0-Preview и более ранних версиях различные классы, инкапсулирующие группы документов, были структурированы в параллельных иерархиях классов:

  -  `DocumentSearchResult` и `DocumentSearchResult<T>` наследуются от `DocumentSearchResultBase`
  -  `DocumentSuggestResult` и `DocumentSuggestResult<T>` наследуются от `DocumentSuggestResultBase`
  -  `IndexAction` и `IndexAction<T>` наследуются от `IndexActionBase`
  -  `IndexBatch` и `IndexBatch<T>` наследуются от `IndexBatchBase`
  -  `SearchResult` и `SearchResult<T>` наследуются от `SearchResultBase`
  -  `SuggestResult` и `SuggestResult<T>` наследуются от `SuggestResultBase`

Производные типы без параметра универсального типа предназначены для использования в сценариях с динамическим вводом и предполагают использование типа `Document`.

Начиная с версии 8,0-Preview базовые классы и неуниверсальные производные классы были удалены. Для динамических типов сценариев можно использовать `IndexBatch<Document>`, `DocumentSearchResult<Document>`и т. д.
 
### <a name="removed-extensibleenum"></a>Удален Екстенсиблинум

Базовый класс `ExtensibleEnum` был удален. Все классы, производные от него, теперь являются структурами, такими как `AnalyzerName`, `DataType`и `DataSourceType` например. Их `Create`ные методы также были удалены. Можно просто удалить вызовы к `Create`, так как эти типы могут быть неявно преобразованы из строк. Если это приводит к ошибкам компилятора, можно явно вызвать оператор преобразования с помощью приведения для неоднозначности типов. Например, можно изменить код следующим образом:

```csharp
var index = new Index()
{
    Fields = new[]
    {
        new Field("id", DataType.String) { IsKey = true },
        new Field("message", AnalyzerName.Create("my_email_analyzer")) { IsSearchable = true }
    },
    ...
}
```

на такой:

```csharp
var index = new Index()
{
    Fields = new[]
    {
        new Field("id", DataType.String) { IsKey = true },
        new Field("message", (AnalyzerName)"my_email_analyzer") { IsSearchable = true }
    },
    ...
}
```

Свойства, которые удерживают необязательные значения этих типов, теперь явно типизированы как допускающие значение null, поэтому они по прежнему являются необязательными.

### <a name="removed-facetresults-and-hithighlights"></a>Удалены Фацетресултс и Хисигхлигхтс

Классы `FacetResults` и `HitHighlights` были удалены. Результаты аспекта теперь вводятся как `IDictionary<string, IList<FacetResult>>` и выделяются как `IDictionary<string, IList<string>>`. Чтобы быстро устранить ошибки сборки, появившиеся в результате этого изменения, добавьте `using` псевдонимы в начале каждого файла, использующего удаленные типы. Пример.

```csharp
using FacetResults = System.Collections.Generic.IDictionary<string, System.Collections.Generic.IList<Models.FacetResult>>;
using HitHighlights = System.Collections.Generic.IDictionary<string, System.Collections.Generic.IList<string>>;
```

### <a name="change-to-synonymmap"></a>Изменить на SynonymMap 

Конструктор `SynonymMap` больше не использует параметр `enum` для `SynonymMapFormat`. Это перечисление имело только одно значение, следовательно, оно было избыточным. Если вы видите ошибки сборки в результате этого, просто удалите ссылки на параметр `SynonymMapFormat`.

### <a name="miscellaneous-model-class-changes"></a>Изменения в различных классах моделей

Свойство `AutocompleteMode` `AutocompleteParameters` больше не допускает значения NULL. Если у вас есть код, который присваивает этому свойству `null`, можно просто удалить его, и свойство будет автоматически инициализировано со значением по умолчанию.

Порядок параметров в конструкторе `IndexAction` был изменен, теперь этот конструктор создан автоматически. Вместо использования конструктора рекомендуется использовать заводские методы `IndexAction.Upload`, `IndexAction.Merge`и т. д.

### <a name="removed-preview-features"></a>Удалены функции предварительной версии

Если вы выполняете обновление с версии 8,0-Preview до версии 9, имейте в виду, что шифрование с помощью ключей, управляемых клиентом, было удалено, так как эта функция все еще доступна в предварительной версии. В частности, были удалены свойства `EncryptionKey` `Index` и `SynonymMap`.

Если приложение имеет жесткую зависимость от этой функции, вы не сможете выполнить обновление до версии 9 пакета SDK .NET для поиска Azure. Вы можете продолжить использовать версию 8,0-Preview. Однако необходимо учитывать, что **использовать предварительные версии пакетов SDK в рабочих приложениях не рекомендуется**. Предварительные версии функций предназначены исключительно для оценки и могут изменяться.

> [!NOTE]
> Если вы создали зашифрованные индексы или сопоставления синонимов с помощью версии 8,0-Preview пакета SDK, вы по-прежнему сможете использовать их и изменять их определения с помощью версии 9 пакета SDK, не влияя на состояние шифрования. Версия 9 пакета SDK не будет отсылать свойство `encryptionKey` REST API, и в результате REST API не изменит состояние шифрования ресурса. 

### <a name="behavioral-change-in-data-retrieval"></a>Изменение поведения при извлечении данных

При использовании "динамически типизированных" `Search`, `Suggest`или API `Get`, которые возвращают экземпляры типа `Document`, имейте в виду, что теперь они десериализует пустые массивы JSON в `object[]` вместо `string[]`.

## <a name="conclusion"></a>Заключение
Если вам нужны дополнительные сведения об использовании пакета SDK .NET для службы поиска Azure, то ознакомьтесь с [практическим руководством по .NET](search-howto-dotnet-sdk.md).

Будем рады вашим отзывам о пакете SDK. При возникновении проблем вы можете попросить нас получить помощь по [Stack overflow](https://stackoverflow.com/questions/tagged/azure-search). При обнаружении ошибки можно зарегистрировать проблему в [репозитории GitHub пакета SDK .NET для Azure](https://github.com/Azure/azure-sdk-for-net/issues). Добавьте в заголовок вашей проблемы префикс "[Azure Search]".

Благодарим вас за использование поиска Azure!
