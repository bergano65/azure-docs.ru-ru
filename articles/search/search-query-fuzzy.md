---
title: Поиск нечетких соответствий
titleSuffix: Azure Cognitive Search
description: Реализуйте поисковый запрос для автоматического исправления неверно написанного термина или опечатки.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 04/08/2020
ms.openlocfilehash: faa98f1c52cfe2dd0e19f085f4d33dedb6f01851
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "88934894"
---
# <a name="fuzzy-search-to-correct-misspellings-and-typos"></a>Нечеткий поиск для исправления ошибок и опечаток

Azure Когнитивный поиск поддерживает нечеткий поиск, тип запроса, который компенсирует опечатки и ошибочные термины во входной строке. Для этого выполняется поиск терминов, имеющих похожую композицию. Расширение поиска для обнаружения близких совпадений влияет на автоматическое исправление опечатки, если расхождение является всего лишь несколькими неправильно размещенными символами. 

## <a name="what-is-fuzzy-search"></a>Что такое нечеткий поиск?

Это упражнение расширения, которое создает совпадение с терминами, имеющими подобную композицию. При указании нечеткого поиска подсистема создает граф (на основе [детерминированной конечной автоматизации](https://en.wikipedia.org/wiki/Deterministic_finite_automaton)) аналогичных составных терминов для всех целых терминов в запросе. Например, если запрос содержит три термина «Университет штата Вашингтон», то для каждого термина в запросе создается график (в этом случае `search=university~ of~ washington~` не выполняется удаление пустых слов в поиске нечетких результатов, поэтому ««» получает граф).

Граф состоит из до 50 расширений (или перестановок) каждого термина, записывая как правильные, так и неправильные варианты в процессе. Затем подсистема возвращает наиболее актуальные соответствия в ответе. 

Для термина, например "Университет", граф может иметь "унверсти, универсти, университет, Вселенной, инверсия". Все документы, соответствующие тем, которые отображаются в графе, включаются в результаты. В отличие от других запросов, которые анализируют текст для обработки различных форм одного и того же слова ("мыши" и "мышь"), сравнения в нечетких запросах берутся со значением лица без какого-либо лингвистического анализа текста. "Вселенной" и "Инверсия", которые семантически различаются, будут соответствовать друг другу, так как синтаксические расхождения невелики.

Совпадение будет выполнено, если несоответствия ограничены двумя или меньшими изменениями, где Правка — это вставленный, удаленный, замененный или трансставляемый символ. Алгоритм исправления строк, указывающий разностное значение, является метрикой [расстояния Дамерау-Левенштейна](https://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance) , которая описывается как "минимальное количество операций (вставок, удалений, подстановок или расположений двух смежных символов), необходимых для изменения одного слова на другое". 

В Когнитивный поиск Azure:

+ Нечеткий запрос применяется к целым терминам, но вы можете поддерживать фразы с помощью конструкций и. Например, "Унвиерсти ~ of ~" Вшингтон ~ "соответствует" университету Вашингтон ".

+ Расстояние по умолчанию для изменения равно 2. Значение `~0` обозначает отсутствие расширения (только точный термин считается совпадением), но можно указать `~1` для одной степени различия или одно изменение. 

+ Нечеткий запрос может расширить термин до 50 дополнительных перестановок. Это ограничение не настраивается, но можно эффективно уменьшить число расширений, уменьшив расстояние правки до 1.

+ Ответы состоят из документов, содержащих соответствующее соответствие (до 50).

В совокупности графы отправляются в соответствии с критериями соответствия токенам в индексе. Как можно себе представить, нечеткий поиск по своей природе является медленнее, чем другие формы запросов. Размер и сложность индекса могут определить, достаточно ли преимуществ для смещения задержки ответа.

> [!NOTE]
> Так как нечеткий поиск, как правило, работает слишком часто, может быть целесообразно исследовать такие альтернативы, как индексирование n-грамм, и ход выполнения коротких последовательностей символов (две и три последовательности символов для маркеров биграм и триграмм). В зависимости от языка и области запроса n-граммы могут дать более высокую производительность. Компромисс заключается в том, что n-граммное индексирование занимает много места в хранилище и формирует намного более крупные индексы.
>
> Другой вариант, который можно было бы рассмотреть, если нужно обрабатывать только наиболее вопиющихные варианты, будет состоять из [синонимов](search-synonyms.md). Например, можно сопоставить "Search" с "серач, Серч, сарч" или "извлечь" в "Загрузить".

## <a name="indexing-for-fuzzy-search"></a>Индексирование для поиска нечетких результатов

Анализаторы не используются во время обработки запроса для создания графа расширения, но это не означает, что анализаторы не должны учитываться в сценариях поиска нечетких. В конце концов, анализаторы используются во время индексирования для создания маркеров, по которым выполняется сопоставление, независимо от того, является ли запрос бесплатной формой, отфильтрованным поиском или нечетким поиском с помощью графа в качестве входных данных. 

Как правило, при назначении анализаторов для каждого поля решение о тонкой настройке цепочки анализа основывается на основном варианте использования (фильтр или полнотекстовый поиск), а не на специальных формах запросов, таких как нечеткий поиск. По этой причине не существует специальной рекомендации анализатора для поиска нечетких результатов. 

Тем не менее, если тестовые запросы не создают совпадения, можно попытаться поработать с анализатором индексирования, установив для него [языковой анализатор](index-add-language-analyzers.md), чтобы увидеть, как можно получить лучшие результаты. Некоторые языки, в частности те, у которых есть гласные изменения, могут воспользоваться преимуществами форм перегиба и нерегулярных словоформ, созданных процессорами естественного языка Майкрософт. В некоторых случаях использование анализатора правильного языка может повлиять на разметку термина способом, совместимым со значением, предоставленным пользователем.

## <a name="how-to-use-fuzzy-search"></a>Как использовать нечеткий поиск

Нечеткие запросы создаются с помощью полного синтаксиса запроса Lucene, который вызывает [средство синтаксического анализа запросов Lucene](https://lucene.apache.org/core/6_6_1/queryparser/org/apache/lucene/queryparser/classic/package-summary.html).

1. Установите полное средство синтаксического анализа Lucene для запроса ( `queryType=full` ).

1. При необходимости можно ограничить область запроса конкретными полями, используя этот параметр ( `searchFields=<field1,field2>` ). 

1. Добавьте оператор тильды ( `~` ) в конце целого Терма ( `search=<string>~` ).

   Включите необязательный параметр, число от 0 до 2 (по умолчанию), если требуется указать расстояние редактирования ( `~1` ). Например, "blue~" или "blue~1" вернет результаты с "blue", "blues" и "glue".

В Когнитивный поиск Azure, кроме термина и расстояния (максимум 2), для запроса не заданы дополнительные параметры.

> [!NOTE]
> Во время обработки запросов нечеткие запросы не проходят [лексического анализа](search-lucene-query-architecture.md#stage-2-lexical-analysis). Входные данные запроса добавляются непосредственно в дерево запросов и разворачиваются для создания графа терминов. Единственным преобразованием является нижний регистр.

## <a name="testing-fuzzy-search"></a>Тестирование поиска нечетких результатов

Для простого тестирования рекомендуется использовать [Обозреватель поиска](search-explorer.md) или [POST](search-get-started-postman.md) для прохода по выражению запроса. Оба средства являются интерактивными. Это означает, что вы можете быстро пройти по нескольким вариантам термина и оценить ответы, которые будут возвращаться.

Если результаты неоднозначны, [выделение](search-pagination-page-layout.md#hit-highlighting) совпадений может помочь определить соответствие в ответе. 

> [!Note]
> Использование выделения совпадений для обнаружения нечетких соответствий имеет ограничения и работает только для базового поиска нечетких совпадений. Если в индексе есть профили оценки или если вы разделит запрос дополнительным синтаксисом, выделение совпадений может завершиться ошибкой, чтобы найти соответствие. 

### <a name="example-1-fuzzy-search-with-the-exact-term"></a>Пример 1. нечеткий поиск с точным термином

Предположим, что в `"Description"` поле в документе поиска существует следующая строка: `"Test queries with special characters, plus strings for MSFT, SQL and Java."`

Начните с нечеткого поиска по слову "Special" и добавьте выделение при попадании в поле "Описание":

```console
search=special~&highlight=Description
```

В ответе, так как вы добавили выделение совпадений, форматирование применяется к "специальным" в качестве соответствующего термина.

```output
"@search.highlights": {
    "Description": [
        "Test queries with <em>special</em> characters, plus strings for MSFT, SQL and Java."
    ]
```

Повторите запрос, указав "Специальный", выполнив несколько букв ("PE"):

```console
search=scial~&highlight=Description
```

Пока нет изменений в ответе. При использовании значения по умолчанию, равном 2 градусам, удаление двух символов "PE" из "специального" по-прежнему обеспечивает успешное совпадение в этом термине.

```output
"@search.highlights": {
    "Description": [
        "Test queries with <em>special</em> characters, plus strings for MSFT, SQL and Java."
    ]
```

Еще один запрос, дальнейшее изменение условия поиска путем получения одного последнего символа для всего трех операций удаления (от "Special" до "масштабируемости"):

```console
search=scal~&highlight=Description
```

Обратите внимание, что возвращается тот же ответ, но теперь вместо "специального" нечеткое соответствие имеет значение "SQL".

```output
        "@search.score": 0.4232868,
        "@search.highlights": {
            "Description": [
                "Mix of special characters, plus strings for MSFT, <em>SQL</em>, 2019, Linux, Java."
            ]
```

В этом развернутом примере видно, что выделение попаданий может привести к неоднозначным результатам. Во всех случаях возвращается один и тот же документ. Если вы использовали идентификаторы документов для проверки совпадения, вы могли пропустить смену из "специального" на "SQL".

## <a name="see-also"></a>См. также раздел

+ [Как работает полнотекстовый поиск в Когнитивный поиск Azure (архитектура анализа запросов)](search-lucene-query-architecture.md)
+ [Обозреватель поиска](search-explorer.md)
+ [Выполнение запроса в .NET](./search-get-started-dotnet.md)
+ [Выполнение запроса в REST](./search-get-started-powershell.md)