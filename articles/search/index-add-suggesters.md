---
title: Создание средства подбора
titleSuffix: Azure Cognitive Search
description: Включите действия запроса опережающего типа в Azure Когнитивный поиск, создав средства подбора и запросы составления, которые вызывают Автозаполнение или автопредложенные термины запроса.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 11/19/2020
ms.custom: devx-track-csharp
ms.openlocfilehash: 81bcfdf5e63d49280fb798773559310cbd912a26
ms.sourcegitcommit: a43a59e44c14d349d597c3d2fd2bc779989c71d7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/25/2020
ms.locfileid: "96013587"
---
# <a name="create-a-suggester-to-enable-autocomplete-and-suggested-results-in-a-query"></a>Создание средства подбора для включения автозаполнения и предлагаемых результатов в запросе

В Azure Когнитивный поиск "Поиск по мере ввода" включен через конструкцию **предложения** , добавленную в [индекс поиска](search-what-is-an-index.md). Предложение поддерживает два опыта: *Автозаполнение*, которое завершает Частичный ввод для запроса в *целом и предлагает* выбрать конкретное соответствие. Автозаполнение создает запрос. Предложения создают соответствующий документ.

На следующем снимке экрана из [раздела Создание первого приложения на C#](tutorial-csharp-type-ahead-and-suggestions.md) показаны оба варианта. Автозаполнение предполагает потенциальный термин, завершая "TW" на "in". Предложения — это мини-результаты поиска, где поле, например имя Гостиницы, представляет совпадающий документ поиска отеля из индекса. Для предложений можно предоставить любое поле, содержащее описательные сведения.

![Визуальное сравнение автозаполнения и предлагаемых запросов](./media/index-add-suggesters/hotel-app-suggestions-autocomplete.png "Визуальное сравнение автозаполнения и предлагаемых запросов")

Эти функции можно использовать отдельно или вместе. Чтобы реализовать эти поведения в Azure Когнитивный поиск, существует компонент индекса и запроса. 

+ Добавьте предложение в определение поискового индекса. Оставшаяся часть этой статьи посвящена созданию средства подбора.

+ Вызовите запрос с поддержкой предложения в форме запроса предложения или запроса автозавершения, используя один из [интерфейсов API, перечисленных ниже](#how-to-use-a-suggester).

Поддержка поиска по мере ввода включена для каждого поля для строковых полей. Вы можете реализовать оба поведения typeahead в одном и том же решении поиска, если вы хотите использовать тот же интерфейс, что и на снимке экрана. Оба запроса нацелены на коллекцию *документов* определенного индекса, и ответы возвращаются после того, как пользователь предоставил по крайней мере три символьные входные строки.

## <a name="what-is-a-suggester"></a>Что такое предложение?

Средство подбора представляет собой внутреннюю структуру данных, которая поддерживает поведение поиска по мере использования, сохраняя префиксы для сопоставления с частичными запросами. Как и в случае с маркерами, префиксы хранятся в инвертированных индексах, по одному для каждого поля, указанного в коллекции полей предложения.

## <a name="how-to-create-a-suggester"></a>Создание средства подбора

Чтобы создать предложение, добавьте его в [Определение индекса](/rest/api/searchservice/create-index). Средство подбора имен получает имя и коллекцию полей, по которым включается интерфейс typeahead. и [задайте каждое свойство](#property-reference). Лучшим моментом для создания средства подбора является то, что вы также определяете поле, которое будет его использовать.

+ Использовать только строковые поля.

+ Если строковое поле является частью сложного типа (например, поля City в адресе), включите родительский элемент в поле: `"Address/City"` (остальные, C# и Python) или `["Address"]["City"]` (JavaScript).

+ Используйте стандартный анализатор Lucene по умолчанию ( `"analyzer": null` ) или [анализатор языка](index-add-language-analyzers.md) (например, `"analyzer": "en.Microsoft"` ) для поля.

Если вы попытаетесь создать средство подбора с помощью уже существующих полей, этот API будет запрещен. Префиксы создаются во время индексирования, если частичные термины в двух или более комбинациях символов размечены вместе с целыми терминами. Учитывая, что существующие поля уже были размечены, потребуется перестроить индекс, чтобы добавить их в средство подбора. Дополнительные сведения см. [в статье перестроение индекса когнитивный Поиск Azure](search-howto-reindex.md).

### <a name="choose-fields"></a>Выбор полей

Хотя средство подбора имеет несколько свойств, оно, в первую очередь, представляет собой набор строковых полей, для которых вы включаете функции поиска по мере использования. Для каждого индекса существует одно средство подбора, поэтому список предложений должен включать все поля, которые вносят содержимое в предложения и Автозаполнение.

Автоматическое заполнение преимуществ из большего пула полей для рисования из-за того, что дополнительное содержимое имеет больший потенциал завершения.

С другой стороны, предложения дают лучшие результаты, если выбрано поле "выборочно". Помните, что предложение является прокси-сервером для документа поиска, поэтому вам нужны поля, которые наилучшим образом представляют один результат. Имена, заголовки или другие уникальные поля, которые лучше различать по нескольким критериям. Если поля состоят из повторяющихся значений, то предложения состоят из идентичных результатов, и пользователь не сможет понять, какой из них щелкнуть.

Чтобы удовлетворить возможности поиска по мере использования, добавьте все поля, необходимые для автозаполнения, а затем используйте **$SELECT**, **$Top**, **$Filter** и **searchFields** , чтобы управлять результатами для предложений.

### <a name="choose-analyzers"></a>Выбор анализаторов

Выбор анализатора определяет, как будут размечены поля, а затем с префиксом. Например, для строки с дефисом, например "с учетом контекста", при использовании анализатора языка будут использоваться следующие сочетания токенов: "Context", "конфиденциально", "с учетом контекста". Если вы использовали стандартный анализатор Lucene, строка с дефисами не будет существовать. 

При оценке анализаторов рекомендуется использовать [API анализа текста](/rest/api/searchservice/test-analyzer) , чтобы понять, как обрабатываются условия. После построения индекса можно попытаться использовать различные анализаторы в строке для просмотра выходных данных маркера.

Поля, использующие [пользовательские анализаторы](index-add-custom-analyzers.md) или [стандартные анализаторы](index-add-custom-analyzers.md#predefined-analyzers-reference) (за исключением стандартного Lucene), явно запрещены для предотвращения неудачных результатов.

> [!NOTE]
> Если необходимо обойти ограничение анализатора, например, если требуется ключевое слово или анализатор ngram для определенных сценариев запросов, следует использовать два отдельных поля для одного и того же содержимого. Это позволит одному из полей иметь средство подбора, а другое можно настроить с помощью настраиваемой конфигурации анализатора.

## <a name="create-using-the-portal"></a>Создание с помощью портала

При использовании мастера **добавления индекса** или **импорта данных** для создания индекса можно включить предложение.

1. В определении индекса введите имя для средства подбора.

1. В каждом определении поля для новых полей установите флажок в столбце предложение. Флажок доступен только для строковых полей. 

Как уже отмечалось, выбранный анализатор влияет на разметку и префикс. При включении предложений рекомендуется учитывать все определение поля. 

## <a name="create-using-rest"></a>Создание с помощью функции "ОСТАВШАЯся"

В REST API добавьте средства подбора путем [создания индекса](/rest/api/searchservice/create-index) или [обновления индекса](/rest/api/searchservice/update-index). 

  ```json
  {
    "name": "hotels-sample-index",
    "fields": [
      . . .
          {
              "name": "HotelName",
              "type": "Edm.String",
              "facetable": false,
              "filterable": false,
              "key": false,
              "retrievable": true,
              "searchable": true,
              "sortable": false,
              "analyzer": "en.microsoft",
              "indexAnalyzer": null,
              "searchAnalyzer": null,
              "synonymMaps": [],
              "fields": []
          },
    ],
    "suggesters": [
      {
        "name": "sg",
        "searchMode": "analyzingInfixMatching",
        "sourceFields": ["HotelName"]
      }
    ],
    "scoringProfiles": [
      . . .
    ]
  }
  ```

## <a name="create-using-net"></a>Создание с помощью .NET

В C# Определите [объект сеарчсугжестер](/dotnet/api/azure.search.documents.indexes.models.searchsuggester). `Suggesters` является коллекцией объекта Сеарчиндекс, но может принимать только один элемент. Добавьте предложение в определение индекса.

```csharp
private static void CreateIndex(string indexName, SearchIndexClient indexClient)
{
    FieldBuilder fieldBuilder = new FieldBuilder();
    var searchFields = fieldBuilder.Build(typeof(Hotel));

    var definition = new SearchIndex(indexName, searchFields);

    var suggester = new SearchSuggester("sg", new[] { "HotelName", "Category", "Address/City", "Address/StateProvince" });
    definition.Suggesters.Add(suggester);

    indexClient.CreateOrUpdateIndex(definition);
}
```

## <a name="property-reference"></a>Справочные данные по свойствам

|Свойство      |Описание      |
|--------------|-----------------|
|`name`        | Задается в определении средства подбора, но также вызывается в запросе автозаполнения или предложений. |
|`sourceFields`| Указывается в определении предложения. Это список из одного или нескольких полей в индексе, которые являются источником содержимого для предложений. Поля должны иметь тип `Edm.String` и `Collection(Edm.String)` . Если в поле указан анализатор, он должен быть именованным лексическим анализатором из [этого списка](/dotnet/api/azure.search.documents.indexes.models.lexicalanalyzername) (а не настраиваемого анализатора).<p/> Рекомендуется указывать только те поля, которые приведут себя к ожидаемому и соответствующему ответу, будь то заполненная строка в строке поиска или раскрывающемся списке.<p/>Имя отеля является хорошим кандидатом, поскольку имеет точность. Поля с подробными сведениями, такие как описания и комментарии, слишком сжимаются. Аналогичным образом, повторяющиеся поля, такие как категории и теги, менее эффективны. В примерах мы все равно включаем «Category», чтобы показать, что можно включить несколько полей. |
|`searchMode`  | Параметр только для остальных компонентов, но также отображается на портале. Этот параметр недоступен в пакете SDK для .NET. Указывает стратегию, используемую для поиска потенциальных фраз. В настоящее время поддерживается только режим `analyzingInfixMatching` , который в настоящее время соответствует началу термина.|

<a name="how-to-use-a-suggester"></a>

## <a name="use-a-suggester"></a>Использовать предложение

В запросе используется предложение. После создания средства подбора вызовите один из следующих интерфейсов API для поиска по мере использования.

+ [Предложения REST API](/rest/api/searchservice/suggestions)
+ [Автозаполнение REST API](/rest/api/searchservice/autocomplete)
+ [Метод Сугжестасинк](/dotnet/api/azure.search.documents.searchclient.suggestasync)
+ [Метод Аутокомплетеасинк](/dotnet/api/azure.search.documents.searchclient.autocompleteasync)

В приложении поиска клиентский код должен использовать библиотеку, например [JQUERY UI Автозаполнение](https://jqueryui.com/autocomplete/) , для получения полного запроса и обеспечения соответствия. Дополнительные сведения об этой задаче см. [в разделе Добавление автозаполнения или предлагаемых результатов в клиентский код](search-autocomplete-tutorial.md).

Использование API показано в следующем вызове функции автозаполнения REST API. В этом примере есть две выводы. Во-первых, как и во всех запросах, операция выполняется для коллекции Documents индекса, а запрос включает параметр **поиска** , который в данном случае предоставляет частичный запрос. Во вторых, необходимо добавить **сугжестернаме** в запрос. Если в индексе не определен метод подбора, вызов функции автозаполнения или предложений завершится ошибкой.

```http
POST /indexes/myxboxgames/docs/autocomplete?search&api-version=2020-06-30
{
  "search": "minecraf",
  "suggesterName": "sg"
}
```

## <a name="sample-code"></a>Образец кода

+ [Создание первого приложения на C# (урок 3. Добавление поиска по мере использования)](tutorial-csharp-type-ahead-and-suggestions.md) демонстрирует предложенные запросы, автозаполнение и навигацию с несколькими аспектами. Этот пример кода выполняется в песочнице Azure Когнитивный поиск Service и использует предварительно загруженный индекс гостиниц с уже созданным предложением, поэтому достаточно нажать клавишу F5, чтобы запустить приложение. Подписка или вход не требуется.

## <a name="next-steps"></a>Следующие шаги

Для получения дополнительных сведений о том, как запросы формулировку, рекомендуется использовать следующую статью.

> [!div class="nextstepaction"]
> [Добавление автозаполнения и предложений в клиентский код](search-autocomplete-tutorial.md)