---
title: Создание набора навыков в конвейере когнитивного поиска в службе "Поиск Azure"
description: Определение этапов извлечения данных, обработки естественного языка или анализа изображений для обогащения и извлечения структурированной информации из данных для использования в службе "Поиск Azure".
manager: nitinme
author: luiscabrer
services: search
ms.service: search
ms.topic: conceptual
ms.date: 05/02/2019
ms.author: luisca
ms.openlocfilehash: f78b8c3b9619b7eea92b6a4f04ed4f6543916efe
ms.sourcegitcommit: e0e6663a2d6672a9d916d64d14d63633934d2952
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/21/2019
ms.locfileid: "71265517"
---
# <a name="how-to-create-a-skillset-in-an-enrichment-pipeline"></a>Создание набора навыков в конвейере обогащения

Когнитивный поиск извлекает и обогащает данные, позволяя находить их в службе "Поиск Azure". Шаги извлечения и обогащения называются *когнитивными навыками*. Они объединяются в *наборы навыков*, указываемые при индексировании. Набор навыков может использовать [встроенные навыки](cognitive-search-predefined-skills.md) или пользовательские навыки (см. [Пример: создание пользовательского навыка для «Автопоиск](cognitive-search-create-custom-skill-example.md) » для получения дополнительных сведений).

В этой статье описано, как создать конвейер обогащения для используемых навыков. Набор навыков связывается с [индексатором](search-indexer-overview.md) службы "Поиск" Azure. Процесс проектирования конвейера, который описывается в этой статье, включает создание самого набора навыков, 

> [!NOTE]
> а также определение индексатора (см. [следующий шаг](#next-step)). Определение индексатора предполагает создание ссылки на набор навыков, а также наличие сопоставлений полей, используемых для связывания входных и выходных данных в целевом индексе.

Важно помнить следующее:

+ С каждым индексатором может использоваться только один набор навыков.
+ В наборе навыков должен быть хотя бы один навык.
+ Вы можете создать несколько навыков одного типа (например, варианты навыка анализа изображений).

## <a name="begin-with-the-end-in-mind"></a>Начиная процесс, помните о его завершении

Вначале рекомендуется определить, какие данные необходимо извлечь из необработанных данных и как они будут использоваться в решении поиска. Созданная схема всего конвейера обогащения поможет определить необходимые действия.

Предположим, вы хотите обработать определенное число комментариев финансовых аналитиков. Для каждого файла требуется извлечь названия компаний и общую тональность комментариев. Также вам может понадобиться написать специальное средство обогащения, которое использует службу поиска сущностей Bing для определения дополнительных сведений о компании, например, чем именно она занимается. По сути вам нужно извлечь следующую информацию, проиндексированную для каждого документа:

| Текст записи | Компании | Тональность | Описания компаний |
|--------|-----|-----|-----|
|Пример записи| ["Майкрософт", "LinkedIn"] | 0.99 | ["Корпорация Майкрософт — американская мультинациональная технологическая компания..." , "LinkedIn — социальная сеть для поиска и установления деловых контактов..."]

На следующей схеме показан возможный конвейер обогащения:

![Гипотетический конвейер обогащения](media/cognitive-search-defining-skillset/sample-skillset.png "Гипотетический конвейер обогащения")


Получив четкое представление о том, что должен включать конвейер, вы можете определить набор навыков для выполнения всех действий. Функционально набор навыков определяется при отправке определения индексатора в службе "Поиск Azure". См. дополнительные сведения об [отправке индексатора](https://docs.microsoft.com/rest/api/searchservice/create-indexer).


На схеме этап *открытия документа* происходит автоматически. По сути поиск "Поиск Azure" умеет открывать файлы известных типов, создавая поле *content* с текстом, извлеченным из каждого документа. Белые прямоугольники соответствуют встроенным средствам обогащения, а заполненный точками прямоугольник "Поиск сущностей Bing" — настраиваемому средству обогащения, которое вы создаете. Как показано на схеме, набор навыков содержит три навыка.

## <a name="skillset-definition-in-rest"></a>Определение набора навыков в REST

Набор навыков определяется в виде массива навыков. Каждый навык определяет источник его входных данных и имя выдаваемых выходных данных. Используя [REST API для создания набора навыков](https://docs.microsoft.com/rest/api/searchservice/create-skillset), можно определить набор навыков, соответствующий предыдущей схеме: 

```http
PUT https://[servicename].search.windows.net/skillsets/[skillset name]?api-version=2019-05-06
api-key: [admin key]
Content-Type: application/json
```

```json
{
  "description": 
  "Extract sentiment from financial records, extract company names, and then find additional information about each company mentioned.",
  "skills":
  [
    {
      "@odata.type": "#Microsoft.Skills.Text.EntityRecognitionSkill",
      "context": "/document",
      "categories": [ "Organization" ],
      "defaultLanguageCode": "en",
      "inputs": [
        {
          "name": "text",
          "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "organizations",
          "targetName": "organizations"
        }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Text.SentimentSkill",
      "inputs": [
        {
          "name": "text",
          "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "score",
          "targetName": "mySentiment"
        }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Custom.WebApiSkill",
     "description": "Calls an Azure function, which in turn calls Bing Entity Search",
      "uri": "https://indexer-e2e-webskill.azurewebsites.net/api/InvokeTextAnalyticsV3?code=foo",
      "httpHeaders": {
          "Ocp-Apim-Subscription-Key": "foobar"
      },
      "context": "/document/organizations/*",
      "inputs": [
        {
          "name": "query",
          "source": "/document/organizations/*"
        }
      ],
      "outputs": [
        {
          "name": "description",
          "targetName": "companyDescription"
        }
      ]
    }
  ]
}
```

## <a name="create-a-skillset"></a>Создание набора навыков

Создавая набор навыков, можно предоставить описание, чтобы сделать такой набор самодокументируемым. Описание является необязательным, но с его помощью удобно отслеживать действия, которые выполняет набор навыков. Так как набор навыков — это документ JSON, который не допускает комментарии, необходимо использовать элемент `description`.

```json
{
  "description": 
  "This is our first skill set, it extracts sentiment from financial records, extract company names, and then finds additional information about each company mentioned.",
  ...
}
```

Следующий элемент в наборе навыков — массив навыков. Каждый навык можно представить в виде примитива обогащения. Каждый навык выполняет небольшую задачу в конвейере обогащения. Каждый из них принимает один или несколько элементов входных данных и возвращает выходные данные. В следующих нескольких разделах основное внимание уделяется указанию встроенных и пользовательских навыков, а также по объединению и выходным ссылкам. Входные данные могут поступать из исходных данных или из другого навыка. Выходные данные можно сопоставить с полем в индексе поиска или использовать в качестве входных для нижестоящего навыка.

## <a name="add-built-in-skills"></a>Добавление встроенных навыков

Рассмотрим первый навык, который является встроенным [навыком распознавания сущностей](cognitive-search-skill-entity-recognition.md):

```json
    {
      "@odata.type": "#Microsoft.Skills.Text.EntityRecognitionSkill",
      "context": "/document",
      "categories": [ "Organization" ],
      "defaultLanguageCode": "en",
      "inputs": [
        {
          "name": "text",
          "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "organizations",
          "targetName": "organizations"
        }
      ]
    }
```

* Каждый встроенный навык имеет свойства `odata.type`, `input` и `output`. Свойства, связанные с определенным навыком, предоставляют дополнительные сведения, применимые к этому навыку. При распознавании сущностей предварительно обученной моделью `categories` представляет одну из сущностей фиксированного набора типов сущностей.

* Каждый навык должен иметь ```"context"```. Контекст представляет уровень, на котором выполняются операции. В приведенном выше навыке контекст представляет собой весь документ, что означает, что навык распознавания сущностей вызывается один раз для каждого документа. Также на этом уровне создаются выходные данные. В частности, создаются ```"organizations"``` в качестве элемента ```"/document"```. В нижестоящих навыках можно ссылаться на только что созданную информацию как на ```"/document/organizations"```.  Если поле ```"context"``` явно не задано, контекстом по умолчанию является документ.

* Навык имеет один входной параметр text, исходный входной параметр для которого задан как ```"/document/content"```. Навык (распознавание сущностей) применяется к полю *содержимого* каждого документа, которое является стандартным полем, созданным индексатором больших двоичных объектов Azure. 

* Навык имеет один выходной параметр с именем ```"organizations"```. Выходные данные существуют только во время обработки. Для связывания этого выходного параметра со входным параметром нижестоящего навыка можно ссылаться на выходной параметр как на ```"/document/organizations"```.

* Для определенного документа значение ```"/document/organizations"``` представляет массив организаций, извлеченный из текста. Пример.

  ```json
  ["Microsoft", "LinkedIn"]
  ```

В некоторых ситуациях требуется ссылаться на каждый элемент массива отдельно. Например, предположим, что нужно передать каждый элемент ```"/document/organizations"``` отдельно в другой навык (например, в настраиваемое средство обогащения поиска сущностей Bing). Можно создать ссылку на каждый элемент массива, добавив звездочку в путь: ```"/document/organizations/*"``` 

Второй навык для извлечения тональности используется так же, как и первое средство обогащения. Он принимает ```"/document/content"``` в качестве входных данных и возвращает оценку тональности для каждого экземпляра содержимого. Так как поле ```"context"``` не задано явным образом, выходные данные (mySentiment) теперь являются дочерним элементом ```"/document"```.

```json
    {
      "@odata.type": "#Microsoft.Skills.Text.SentimentSkill",
      "inputs": [
        {
          "name": "text",
          "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "score",
          "targetName": "mySentiment"
        }
      ]
    },
```

## <a name="add-a-custom-skill"></a>Добавление настраиваемого навыка

Напомним структуру настраиваемого средства обогащения для поиска сущностей Bing:

```json
    {
      "@odata.type": "#Microsoft.Skills.Custom.WebApiSkill",
     "description": "This skill calls an Azure function, which in turn calls Bing Entity Search",
      "uri": "https://indexer-e2e-webskill.azurewebsites.net/api/InvokeTextAnalyticsV3?code=foo",
      "httpHeaders": {
          "Ocp-Apim-Subscription-Key": "foobar"
      },
      "context": "/document/organizations/*",
      "inputs": [
        {
          "name": "query",
          "source": "/document/organizations/*"
        }
      ],
      "outputs": [
        {
          "name": "description",
          "targetName": "companyDescription"
        }
      ]
    }
```

Это определение представляет собой [пользовательский навык](cognitive-search-custom-skill-web-api.md), который вызывает веб-API в процессе обогащения. Для каждой организации, определяемой функцией распознавания сущностей, этот навык вызывает веб-API для поиска описания этой Организации. Оркестрация времени вызова веб-API и включения в поток полученной информации обрабатывается внутренним модулем обогащения. При этом инициализация, необходимая для вызова этого настраиваемого API, должна быть задана в JSON (например, uri, httpHeaders и ожидаемые входные данные). Инструкции по созданию настраиваемого веб-API для конвейера обогащения см. в руководстве по [определению настраиваемого интерфейса](cognitive-search-custom-skill-interface.md).

Обратите внимание, что в поле context задается значение ```"/document/organizations/*"``` со звездочкой. Это означает, что этап обогащения вызывается *для каждой* организации из ```"/document/organizations"```. 

Выходные данные (в этом случае описание компании) создаются для каждой идентифицированной организации. При создании ссылки на описание в нижестоящем шаге (например, при извлечении ключевых фраз) следует использовать путь ```"/document/organizations/*/description"```. 

## <a name="add-structure"></a>Добавить структуру

Набор навыков создает структурированную информацию из неструктурированных данных. Рассмотрим следующий пример.

*"В четвертом квартале Корпорация Майкрософт зарегистрировала $1 100 000 000 в выручке от LinkedIn, компании социальных сетей, которую он приобрел в прошлый год. Приобретение позволяет корпорации Майкрософт объединять возможности LinkedIn с возможностями CRM и Office. Акционеры очень рады с ходом выполнения на данный момент».*

Вероятным результатом будет приблизительно такая созданная структура:

![Пример выходной структуры](media/cognitive-search-defining-skillset/enriched-doc.png "Пример выходной структуры")

До настоящего момента эта структура была доступна только для внутреннего использования, только для памяти и используется только в индексах поиска Azure. Добавление хранилища знаний дает возможность сохранять обогащения для использования вне области поиска.

## <a name="add-a-knowledge-store"></a>Добавление хранилища знаний

[Хранилище знаний](knowledge-store-concept-intro.md) — это предварительная версия функции поиска Azure для сохранения дополненного документа. Хранилище знаний, созданное с помощью учетной записи хранения Azure, представляет собой репозиторий, в котором находятся более обогащенные передовые работы с данными. 

Определение хранилища знаний добавляется в набор навыков. Пошаговое руководство по всему процессу см. [в статье Приступая к работе с хранилищем знаний](knowledge-store-howto.md).

```json
"knowledgeStore": {
  "storageConnectionString": "<an Azure storage connection string>",
  "projections" : [
    {
      "tables": [ ]
    },
    {
      "objects": [
        {
          "storageContainer": "containername",
          "source": "/document/EnrichedShape/",
          "key": "/document/Id"
        }
      ]
    }
  ]
}
```

Можно сохранить обогащенные документы в виде таблиц с сохраненными иерархическими связями или документами JSON в хранилище BLOB-объектов. Выходные данные любого из навыков в наборе навыков могут быть источником данных для проекции. Если вы хотите проецировать данные в определенную фигуру, обновленный навык работы с [формой](cognitive-search-skill-shaper.md) теперь может моделировать сложные типы для использования. 

<a name="next-step"></a>

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали о конвейере обогащения и наборах навыков, переходите к руководствам по [созданию ссылок на аннотации в наборе навыков](cognitive-search-concept-annotations-syntax.md) и [сопоставлению выходных данных с полями в индексе](cognitive-search-output-field-mapping.md). 
