---
title: Проверка подлинности ключа API
titleSuffix: Azure Cognitive Search
description: Ключ API управляет входящим доступом к конечной точке службы. Ключи администратора предоставляют доступ на запись. Ключи запроса создаются для доступа только для чтения.
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 02/03/2021
ms.openlocfilehash: 8b2e85744923fb2e7e474e049df1536aebc56f3c
ms.sourcegitcommit: 44188608edfdff861cc7e8f611694dec79b9ac7d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2021
ms.locfileid: "99536939"
---
# <a name="create-and-manage-api-keys-for-an-azure-cognitive-search-service"></a>Создание ключей API для службы Когнитивный поиск Azure и управление ими

Всем запросам к службе поиска требуется ключ API только для чтения, созданный специально для вашей службы. Ключ API является единственным механизмом проверки подлинности входящих запросов к конечной точке службы поиска и требуется при каждом запросе. 

+ В [решениях](search-get-started-rest.md)для RESTful `api-key` обычно указывается в заголовке запроса.

+ В [решениях .NET](search-howto-dotnet-sdk.md)ключ часто указывается как параметр конфигурации, а затем передается как [азурекэйкредентиал](/dotnet/api/azure.azurekeycredential) .

Вы можете просматривать ключи API и управлять ими в [портал Azure](https://portal.azure.com)или с помощью [PowerShell](/powershell/module/az.search), [Azure CLI](/cli/azure/search)или [REST API](/rest/api/searchmanagement/).

:::image type="content" source="media/search-manage/azure-search-view-keys.png" alt-text="Страница портала, раздел Получение параметров, ключи" border="false":::

## <a name="what-is-an-api-key"></a>Что такое ключ API?

Ключ API — это уникальная строка, состоящая из случайных чисел и букв, которые передаются при каждом запросе к службе поиска. Служба примет запрос, если сам запрос и ключ действительны. 

Для доступа к службе поиска используются два типа ключей: ключи администратора (для чтения и записи) и ключи запроса (только для чтения).

|Клавиши|Описание|Ограничения|  
|---------|-----------------|------------|  
|Административный|Предоставляет полный доступ ко всем операциям, включая возможность управлять службой, создавать и удалять индексы, индексаторы и источники данных.<br /><br /> При создании службы генерируются два ключа администратора, которые на портале называются *первичным* и *вторичным*. При необходимости их можно создать заново независимо друг от друга. При наличии двух ключей один ключ можно сменить, а второй использовать для непрерывного доступа к службе.<br /><br /> Ключи администратора указываются только в заголовках HTTP-запросов. Невозможно разместить ключ API администратора в URL-адресе.|Не более 2 на службу|  
|Запрос|Предоставляет только разрешение на чтение индексов и документов; обычно они добавляются в клиентские приложения, которые создают запросы на поиск.<br /><br /> Ключи запроса создаются по запросу.<br /><br /> Ключи запроса можно указать в заголовке HTTP-запроса для операции поиска, предложения или уточняющего запроса. Кроме того, ключ запроса можно передать как параметр в URL-адресе. В зависимости от того, как клиентское приложение формирует запрос, возможно, проще передать ключ в качестве параметра запроса:<br /><br /> `GET /indexes/hotels/docs?search=*&$orderby=lastRenovationDate desc&api-version=2020-06-30&api-key=[query key]`|50 на службу|  

 Визуально нет никакой разницы между ключом администратора и ключом запроса. Оба ключа представляют собой строки из 32 случайно сгенерированных буквенно-цифровых символов. Если вы потеряли, какой тип ключа указан в приложении, можно [проверить значения ключей на портале](https://portal.azure.com).  

> [!NOTE]  
> Это считается низкой практикой в области безопасности при передаче конфиденциальных данных, например, `api-key` в URI запроса. По этой причине Azure Когнитивный поиск принимает только ключ запроса `api-key` в строке запроса, и следует избегать этого, если содержимое индекса не должно быть общедоступным. Как правило, мы рекомендуем передавать `api-key` в заголовке запроса.  

## <a name="find-existing-keys"></a>Найти существующие ключи

Ключи доступа можно получить на портале или с помощью [PowerShell](/powershell/module/az.search), [Azure CLI](/cli/azure/search)или [REST API](/rest/api/searchmanagement/).

1. Войдите на [портал Azure](https://portal.azure.com).
1. Перечислите [службы поиска](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Search%2FsearchServices) для своей подписки.
1. Выберите службу и на странице Обзор щелкните **Параметры**  > **ключи** , чтобы просмотреть ключи администратора и запроса.

   :::image type="content" source="media/search-security-overview/settings-keys.png" alt-text="Страница портала, параметры просмотра, раздел &quot;ключи&quot;" border="false":::

## <a name="create-query-keys"></a>Создание ключей запроса

Ключи запроса используются для доступа только для чтения к документам в индексе для операций, предназначенных для коллекции документов. Запросы поиска, фильтрации и предложений — это все операции, которые принимают ключ запроса. Любая операция только чтения, возвращающая системные данные или определения объектов, например определение индекса или состояние индексатора, требует наличия ключа администратора.

Ограничения доступа и операций в клиентских приложениях необходимы для защиты ресурсов поиска в службе. Всегда используйте ключ запроса, а не ключ администратора для любого запроса, исходящего из клиентского приложения.

1. Войдите на [портал Azure](https://portal.azure.com).
2. Выведите список [служб поиска](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Search%2FsearchServices) для вашей подписки.
3. Выберите службу и на странице Обзор щелкните **Параметры**  > **ключи**.
4. Щелкните **Управление ключами запроса**.
5. Используйте ключ запроса, уже созданный для вашей службы, или создайте до 50 новых ключей запроса. Ключ запроса по умолчанию не именован, но для управляемости можно назвать дополнительные ключи запроса.

   :::image type="content" source="media/search-security-overview/create-query-key.png" alt-text="Создание или использование ключа запроса" border="false":::

> [!Note]
> Пример кода, демонстрирующий использование ключа запроса, можно найти в [дотнесовто](https://github.com/Azure-Samples/search-dotnet-getting-started/tree/master/DotNetHowTo).

<a name="regenerate-admin-keys"></a>

## <a name="regenerate-admin-keys"></a>Повторное создание ключей администратора

Для каждой службы создаются два ключа администратора, чтобы можно было поворачивать первичный ключ, используя вторичный ключ для обеспечения непрерывности бизнес-процессов.

1. На странице   > **ключи** параметров скопируйте вторичный ключ.
2. Для всех приложений обновите параметры ключа API, чтобы они использовали вторичный ключ.
3. Заново создайте первичный ключ.
4. Обновите все приложения, указав новый первичный ключ.

Если случайно создать оба ключа одновременно, все клиентские запросы, использующие эти ключи, завершатся ошибкой HTTP 403 запрещено. Однако содержимое не удаляется, и вы не блокируете его без возможности восстановления. 

Вы по-прежнему можете получить доступ к службе через портал или программным способом. Функции управления работают с ИДЕНТИФИКАТОРом подписки, а не ключом API службы и, таким же, доступны даже в том случае, если ключи API не используются. 

После создания новых ключей с помощью портала или слоя управления доступ восстанавливается в содержимое (индексы, индексаторы, источники данных, карты синонимов), когда у вас есть новые ключи и эти ключи задаются в запросах.

## <a name="secure-api-keys"></a>Безопасные ключи API

Используя [разрешения на основе ролей](search-security-rbac.md), вы можете удалять или считывать ключи, но не можете заменить ключ пользовательским паролем или использовать Active Directory в качестве основного метода проверки подлинности для доступа к операциям поиска. 

Безопасность ключей API обеспечивается за счет ограничения доступа на портале или в интерфейсах Resource Manager (PowerShell или интерфейс командной строки). Как уже отмечалось, администраторы подписки могут просматривать и повторно создавать все ключи API. В качестве меры предосторожности проверьте назначения ролей, чтобы понять, кто имеет доступ к ключам администратора.

+ На панели мониторинга службы щелкните **Управление доступом (IAM)**, а затем — вкладку **Назначения ролей**, чтобы просмотреть назначенные роли для службы.

Просмотр и повторное создание ключей доступны для следующих ролей: владелец, участник, [участник службы поиска](../role-based-access-control/built-in-roles.md#search-service-contributor).

## <a name="see-also"></a>См. также

+ [Безопасность в Azure Когнитивный поиск](search-security-overview.md)
+ [Управление доступом на основе ролей Azure в Azure Когнитивный поиск](search-security-rbac.md)
+ [Управление с помощью PowerShell](search-manage-powershell.md) 