---
title: Резервное копирование и восстановление сервера в службе "База данных Azure для MariaDB"
description: Как выполнить резервное копирование и восстановление сервера в службе "База данных Azure для MariaDB" с помощью Azure CLI.
author: ajlam
ms.author: andrela
ms.service: mariadb
ms.devlang: azurecli
ms.topic: conceptual
ms.date: 10/25/2019
ms.openlocfilehash: ae2e8049c58be312eed380fe2197985e61d28a26
ms.sourcegitcommit: c4700ac4ddbb0ecc2f10a6119a4631b13c6f946a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/27/2019
ms.locfileid: "72965225"
---
# <a name="how-to-back-up-and-restore-a-server-in-azure-database-for-mariadb-using-the-azure-cli"></a>Как создать резервную копию сервера в службе "База данных Azure для MariaDB" и восстановить его с помощью Azure CLI

Чтобы обеспечить возможность восстановления, для серверов службы "База данных Azure для MariaDB" периодически выполняется резервное копирование. С помощью этой функции можно восстановить сервер и все его базы данных до более ранней точки во времени на новом сервере.

## <a name="prerequisites"></a>Технические условия

Вот что вам нужно, чтобы выполнить инструкции, приведенные в этом руководстве:

- [сервер Базы данных Azure для MariaDB и база данных](quickstart-create-mariadb-server-database-using-azure-cli.md).

[!INCLUDE [cloud-shell-try-it.md](../../includes/cloud-shell-try-it.md)]

> [!IMPORTANT]
> Для работы с этим руководством вам понадобится Azure CLI 2.0 или более поздней версии. Чтобы проверить версию, в командной строке Azure CLI введите `az --version`. Чтобы выполнить установку или обновление, см. сведения в статье [Установка Azure CLI]( /cli/azure/install-azure-cli).

## <a name="set-backup-configuration"></a>Настройка конфигурации резервного копирования

При создании сервер можно настроить для локально избыточного или геоизбыточного резервного копирования.

> [!NOTE]
> После создания сервера тип избыточности (локальная или географическая) изменить нельзя.
>

При создании сервера с помощью команды `az mariadb server create` параметр `--geo-redundant-backup` определяет тип избыточности для резервного копирования. Если установлено значение `Enabled`, выполняется геоизбыточное резервное копирование. Если установлено значение `Disabled`, выполняется локальное избыточное резервное копирование.

Период хранения резервных копий устанавливается с помощью параметра `--backup-retention`.

Дополнительные сведения о настройке этих значений при создании см. в [кратком руководстве по использованию CLI для сервера Базы данных Azure для MariaDB](quickstart-create-mariadb-server-database-using-azure-cli.md).

Вот как можно изменить срок хранения резервной копии сервера.

```azurecli-interactive
az mariadb server update --name mydemoserver --resource-group myresourcegroup --backup-retention 10
```

В указанном выше примере период хранения резервных копий mydemoserver изменен на 10 дней.

Срок хранения резервных копий определяет, насколько раннюю точку во времени можно задать для восстановления, так как это зависит от доступных резервных копий. Восстановление до точки во времени описано в следующем разделе.

## <a name="server-point-in-time-restore"></a>Восстановление сервера до точки во времени

Вы можете восстановить сервер до предыдущей точки во времени. Восстановленные данные копируются на новый сервер, а имеющийся сервер остается неизменным. Например, если таблица была случайно удалена в полдень, ее можно восстановить до момента сразу перед полуднем. Затем вы можете извлечь отсутствующие таблицы и данные из восстановленной копии сервера.

Чтобы восстановить сервер, используйте команду Azure CLI [az mariadb server restore](/cli/azure/mariadb/server#az-mariadb-server-restore).

### <a name="run-the-restore-command"></a>Выполнение команды restore

Для восстановления сервера в командной строке Azure CLI введите следующую команду:

```azurecli-interactive
az mariadb server restore --resource-group myresourcegroup --name mydemoserver-restored --restore-point-in-time 2018-03-13T13:59:00Z --source-server mydemoserver
```

Для команды `az mariadb server restore` обязательны указанные ниже параметры.

| Параметр | Рекомендуемое значение | Описание  |
| --- | --- | --- |
| resource-group |  myresourcegroup |  Группа ресурсов, в которой находится исходный сервер.  |
| name | mydemoserver-restored | Имя нового сервера, созданного командой restore. |
| restore-point-in-time | 2018-03-13T13:59:00Z | Выберите точку во времени, до которой необходимо выполнить восстановление. Значения даты и времени должны находиться в пределах срока хранения резервной копии исходного сервера. Используйте формат даты и времени ISO8601. Можно использовать местный часовой пояс, например `2018-03-13T05:59:00-08:00`. Также можно использовать формат UTC Zulu, например `2018-03-13T13:59:00Z`. |
| source-server | mydemoserver | Имя или идентификатор исходного сервера, с которого необходимо выполнить восстановление. |

Когда при восстановлении сервера до более ранней точки во времени создается новый сервер. Исходный сервер и его базы данных, начиная с указанного момента во времени, копируются на новый сервер.

Значения расположения и ценовой категории для восстановленного сервера совпадают со значениями исходного сервера. 

После завершения восстановления найдите новый сервер, чтобы убедиться, что данные были восстановлены, как и ожидалось. Новый сервер имеет то же имя для входа администратора сервера и пароль, который был действителен для существующего сервера на момент запуска восстановления. Пароль можно изменить на странице **Обзор** для нового сервера.

На новом сервере, созданном во время восстановления, отсутствуют правила брандмауэра или конечные точки службы виртуальной сети, существовавшие на исходном сервере. Эти правила необходимо настроить отдельно для этого нового сервера.

## <a name="geo-restore"></a>Геовосстановление

Если вы настроили сервер для геоизбыточного резервного копирования, из резервной копии можно создать новый сервер. Его можно создать в любом регионе, где доступна служба "База данных Azure для MariaDB".  

Чтобы создать сервер с помощью геоизбыточного резервного копирования, выполните команду Azure CLI `az mariadb server georestore`.

> [!NOTE]
> Сразу после создания сервер может быть еще не готов к географическому восстановлению. Заполнение метаданных может занять несколько часов.
>

Для геовосстановления сервера в командной строке Azure CLI введите следующую команду.

```azurecli-interactive
az mariadb server georestore --resource-group myresourcegroup --name mydemoserver-georestored --source-server mydemoserver --location eastus --sku-name GP_Gen5_8
```

С помощью этой команды можно создать сервер *mydemoserver-georestored* в восточной части США, который будет принадлежать группе ресурсов *myresourcegroup*. Это сервер общего назначения 5-го поколения с 8 виртуальными ядрами. Он создан на основе геоизбыточных резервных копий *mydemoserver*, которые также расположены в группе ресурсов *myresourcegroup*.

Если необходимо создать сервер в другой группе ресурсов с имеющегося сервера, в параметре `--source-server` необходимо определить имя сервера следующим образом.

```azurecli-interactive
az mariadb server georestore --resource-group newresourcegroup --name mydemoserver-georestored --source-server "/subscriptions/$<subscription ID>/resourceGroups/$<resource group ID>/providers/Microsoft.DBforMariaDB/servers/mydemoserver" --location eastus --sku-name GP_Gen5_8

```

Для команды `az mariadb server georestore` обязательны указанные ниже параметры.

| Параметр | Рекомендуемое значение | Описание  |
| --- | --- | --- |
|resource-group| myresourcegroup | Имя группы ресурсов, к которой будет принадлежать новый сервер.|
|name | mydemoserver-georestored | Имя нового сервера. |
|source-server | mydemoserver | Имя имеющегося сервера, геоизбыточные резервные копии которого используются. |
|location | eastus | Расположение нового сервера. |
|sku-name| GP_Gen5_8 | Этот параметр определяет ценовую категорию, поколение вычислительных ресурсов и количество виртуальных ядер нового сервера. GP_Gen5_8 сопоставляется с сервером общего назначения 5-го поколения с 8 виртуальными ядрами.|

При создании сервера с помощью геовосстановления он наследует тот же размер хранилища и ценовую категорию, что и исходный сервер. Эти значения нельзя изменить во время создания. После создания сервера размер хранилища можно увеличить.

После завершения восстановления найдите новый сервер, чтобы убедиться, что данные были восстановлены, как и ожидалось. Новый сервер имеет то же имя для входа администратора сервера и пароль, который был действителен для существующего сервера на момент запуска восстановления. Пароль можно изменить на странице **Обзор** для нового сервера.

На новом сервере, созданном во время восстановления, отсутствуют правила брандмауэра или конечные точки службы виртуальной сети, существовавшие на исходном сервере. Эти правила необходимо настроить отдельно для этого нового сервера.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о [резервных копиях](concepts-backup.md) службы
- Дополнительные сведения о [репликах](concepts-read-replicas.md)
- Дополнительные сведения о возможностях обеспечения [непрерывности бизнес-процессов](concepts-business-continuity.md)
