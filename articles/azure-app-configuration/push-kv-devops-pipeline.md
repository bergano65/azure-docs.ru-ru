---
title: Отправка параметров в конфигурацию приложения с помощью Azure Pipelines
description: Сведения об использовании Azure Pipelines для принудительной отправки значений ключей в хранилище конфигураций приложений
services: azure-app-configuration
author: lisaguthrie
ms.service: azure-app-configuration
ms.topic: how-to
ms.date: 07/27/2020
ms.author: lcozzens
ms.openlocfilehash: b2b903f259fdd2564fbcaed5eb0a750edf9c06e2
ms.sourcegitcommit: a92fbc09b859941ed64128db6ff72b7a7bcec6ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/15/2020
ms.locfileid: "92075881"
---
# <a name="push-settings-to-app-configuration-with-azure-pipelines"></a>Отправка параметров в конфигурацию приложения с помощью Azure Pipelines

Задача [принудительной настройки приложения Azure](https://marketplace.visualstudio.com/items?itemName=AzureAppConfiguration.azure-app-configuration-task-push) отправляет значения ключа из файла конфигурации в хранилище конфигурации приложения. Эта задача включает функции полной окружности в конвейере, так как теперь можно извлекать параметры из хранилища конфигурации приложений, а также параметры отправки в хранилище конфигураций приложений.

## <a name="prerequisites"></a>Предварительные требования

- Подписка Azure — [создайте бесплатную учетную запись](https://azure.microsoft.com/free/).
- Ресурс конфигурации приложения. Создайте его бесплатно в [портал Azure](https://portal.azure.com).
- Проект Azure DevOps. [создайте его бесплатно](https://go.microsoft.com/fwlink/?LinkId=2014881)
- Задача принудительной настройки приложения Azure — Скачайте бесплатно из [Visual Studio Marketplace](https://marketplace.visualstudio.com/items?itemName=AzureAppConfiguration.azure-app-configuration-task-push#:~:text=Navigate%20to%20the%20Tasks%20tab,the%20Azure%20App%20Configuration%20instance.).

## <a name="create-a-service-connection"></a>Создание подключения к службе

Подключение к службе позволяет получить доступ к ресурсам в подписке Azure из проекта Azure DevOps.

1. В Azure DevOps перейдите к проекту, содержащему целевой конвейер, и откройте **Параметры проекта** внизу слева.
1. В разделе **конвейеры** выберите **подключения к службам** и щелкните **новое подключение к службе** в правом верхнем углу.
1. Выберите **Azure Resource Manager**.
1. Выберите **субъект-служба (автоматически)**.
1. Заполните подписку и ресурс. Задайте имя для подключения к службе.

Теперь, когда подключение к службе создано, найдите имя субъекта-службы, назначенного ей. На следующем шаге мы добавим новое назначение роли этому субъекту-службе.

1. Последовательно выберите **Параметры проекта**  >  **подключения к службе**.
1. Выберите подключение службы, созданное в предыдущем разделе.
1. Выберите **Управление субъектом-службой**.
1. Обратите внимание на указанное **Отображаемое имя** .

## <a name="add-role-assignment"></a>Добавление назначения роли

Назначьте правильные назначения ролей конфигурации приложения учетным данным, используемым в задаче, чтобы задача могла получить доступ к хранилищу конфигураций приложений.

1. Перейдите к целевому хранилищу конфигураций приложений. 
1. Слева выберите **Управление доступом (IAM)**.
1. В верхней части щелкните **+ Добавить** и выберите **добавить назначение ролей**.
1. В разделе **роль**выберите **владелец данных конфигурации приложения**. Эта роль позволяет задаче читать и записывать в хранилище конфигураций приложений. 
1. Выберите субъект-службу, связанный с подключением службы, созданным в предыдущем разделе.
  
## <a name="use-in-builds"></a>Использование в сборках

В этом разделе рассматривается использование задачи принудительной настройки приложений Azure в конвейере сборки Azure DevOps.

1. Перейдите на **страницу конвейер сборки, щелкнув конвейер**  >  **конвейеры**. Документацию по конвейерам сборки можно найти [здесь](/azure/devops/pipelines/create-first-pipeline?tabs=tfs-2018-2&view=azure-devops).
      - Если вы создаете новый конвейер сборки, выберите пункт **Показывать помощника** в правой части конвейера и найдите задачу **принудительной установки конфигурации приложения Azure** .
      - Если вы используете существующий конвейер сборки, перейдите на вкладку **задачи** при редактировании конвейера и выполните поиск принудительной задачи по **настройке приложения Azure** .
2. Настройте необходимые параметры для задачи, чтобы принудительно передать значения ключа из файла конфигурации в хранилище конфигурации приложения. Параметр **пути к файлу конфигурации** начинается в корне репозитория файлов.
3. Сохранение и постановка в очередь сборки. В журнале сборки отобразятся все ошибки, произошедшие во время выполнения задачи.

## <a name="use-in-releases"></a>Использовать в выпусках

В этом разделе рассматривается использование задачи принудительной настройки приложения Azure в конвейерах выпуска Azure DevOps.

1. Перейдите на страницу конвейера выпуска, выбрав пункт **конвейеры**  >  **выпуски**. Документацию по конвейерам выпуска можно найти [здесь](/azure/devops/pipelines/release?view=azure-devops).
1. Выберите существующий конвейер выпуска. Если у вас ее нет, выберите **+ создать** , чтобы создать новый.
1. Нажмите кнопку **изменить** в правом верхнем углу, чтобы изменить конвейер выпуска.
1. Выберите **этап** для добавления задачи. Дополнительные сведения о стадиях можно найти [здесь](/azure/devops/pipelines/release/environments?view=azure-devops).
1. Выберите **+** для этого задания, а затем добавьте **принудительную задачу настройки приложения Azure** на вкладке " **развертывание** ".
1. Настройте необходимые параметры в задаче, чтобы принудительно передать значения ключа из файла конфигурации в хранилище конфигурации приложения. Пояснения к параметрам доступны в разделе **параметров** ниже и в подсказках рядом с каждым параметром.
1. Сохранение и постановка в очередь выпуска. В журнале выпусков отобразятся все ошибки, обнаруженные во время выполнения задачи.

## <a name="parameters"></a>Параметры

В задаче принудительной настройки приложения используются следующие параметры:

- **Подписка Azure**. раскрывающийся список, содержащий доступные подключения к службам Azure. Чтобы обновить и обновить список доступных подключений к службам Azure, нажмите кнопку **обновить подписку Azure** справа от текстового поля.
- **Имя конфигурации приложения**: раскрывающийся список, который загружает доступные хранилища конфигураций в выбранной подписке. Чтобы обновить и обновить список доступных хранилищ конфигураций, нажмите кнопку **Обновить имя конфигурации приложения** справа от текстового поля.
- **Путь к файлу конфигурации**: путь к файлу конфигурации. Вы можете просмотреть артефакт сборки, чтобы выбрать файл конфигурации. ( `...` кнопка справа от текстового поля).
- **Разделитель**: разделитель, используемый для спрямления файлов. JSON и. yml.
- **Depth**: глубина, в которую будут сведены файлы JSON и yml.
- **Prefix**— строка, добавляемая к началу каждого ключа, отправленного в хранилище конфигурации приложения.
- **Label**: строка, добавляемая к каждому значению ключа в качестве метки в хранилище конфигурации приложения.
- **Тип содержимого**— строка, которая добавляется к каждому значению ключа в качестве типа содержимого в хранилище конфигурации приложения.
- **Теги**: объект JSON в формате `{"tag1":"val1", "tag2":"val2"}` , который определяет теги, добавляемые к каждому значению ключа, отправленному в хранилище конфигурации приложения.
- **Удалить все другие Key-Values в магазине с указанным префиксом и меткой**: значение по умолчанию **снято.**
  - **Checked**: удаляет все значения ключа в хранилище конфигурации приложения, которые соответствуют указанным префиксу и метке, перед тем как отправлять новые значения ключа из файла конфигурации.
  - Не **отмечено**: отправляет все значения ключа из файла конфигурации в хранилище конфигурации приложения и оставляет все остальное в хранилище конфигурации приложения без изменений.

После заполнения необходимых параметров запустите конвейер. Все значения ключа в указанном файле конфигурации будут переданы в конфигурацию приложения.

## <a name="troubleshooting"></a>Диагностика

При возникновении непредвиденной ошибки можно включить журналы отладки, задав для переменной конвейера `system.debug` значение `true` .

## <a name="faq"></a>ВОПРОСЫ И ОТВЕТЫ

**Как можно отправить несколько файлов конфигурации?**

Создайте несколько экземпляров задачи push-уведомлений конфигурации приложений Azure в том же конвейере, чтобы отправить несколько файлов конфигурации в хранилище конфигураций приложений.

**Почему при попытке принудительной отправки значений ключа в хранилище конфигураций возникает ошибка 409?**

Сообщение об ошибке конфликта 409 возникает, если задача пытается удалить или перезаписать ключ-значение, заблокированное в хранилище конфигураций приложений.