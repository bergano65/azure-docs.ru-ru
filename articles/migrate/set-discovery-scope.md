---
title: Настройка области для обнаружения виртуальных машин VMware с помощью службы "миграция Azure"
description: Описание настройки области обнаружения для оценки виртуальных машин VMware и миграции с помощью службы "миграция Azure".
ms.topic: how-to
ms.date: 06/09/2020
ms.openlocfilehash: e53eb0d01df2152aeced2901335f75879885fd22
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "84770396"
---
# <a name="set-discovery-scope-for-vmware-vms"></a>Задание области обнаружения для виртуальных машин VMware

В этой статье описывается, как ограничить область виртуальных машин VMware, обнаруженных при выполнении следующих действий.

- Обнаружение виртуальных машин с помощью [устройства "миграция Azure](migrate-appliance-architecture.md) " при использовании средства "миграция Azure": Серверная оценка.
- Обнаружение виртуальных машин с помощью [устройства](migrate-appliance-architecture.md) "миграция Azure", когда вы используете средство миграции для Azure Migration: Server, для переноса виртуальных машин VMware в Azure без агента.

При настройке устройства оно подключается к vCenter Server и запускает обнаружение. Перед подключением устройства к vCenter Server можно ограничить обнаружение vCenter Server центрами обработки данных, кластерами, папкой кластеров, узлами, папкой узлов или отдельными виртуальными машинами. Чтобы задать область, необходимо назначить разрешения учетной записи, которую устройство использует для доступа к vCenter Server.

## <a name="before-you-start"></a>Перед началом работы

Если вы не настроили учетную запись пользователя vCenter, используемую службой "миграция Azure" для обнаружения, сделайте это сейчас для [оценки](tutorial-prepare-vmware.md#set-up-permissions-for-assessment) или [безагентного переноса](tutorial-prepare-vmware.md#assign-permissions-to-an-account).


## <a name="assign-permissions-and-roles"></a>Назначение разрешений и ролей

Вы можете назначать разрешения для объектов инвентаризации VMware с помощью одного из двух методов:

- В учетной записи, используемой устройством, назначьте роль с необходимыми разрешениями для объектов, для которых необходимо задать область.
- Кроме того, можно назначить роль учетной записи на уровне центра обработки данных и распространить ее на дочерние объекты. Затем предоставьте учетной записи роль " **нет доступа** " для каждого объекта, который вы не хотите использовать в области. Этот подход не рекомендуется, так как он громоздкий и может предоставлять доступ к элементам управления доступом, так как каждому новому дочернему объекту автоматически предоставляется доступ, наследуемый от родительского объекта.

На уровне папок виртуальных машин vCenter нельзя обнаружить область обнаружения запасов. Если необходимо определить область обнаружения виртуальных машин в папке виртуальной машины, создайте пользователя и предоставьте доступ по отдельности для каждой требуемой виртуальной машины. Поддерживаются папки узлов и кластеров.


### <a name="assign-a-role-for-assessment"></a>Назначение роли для оценки

1. В учетной записи vCenter, используемой для обнаружения, примените роль **только для чтения** для всех родительских объектов, на которых размещаются виртуальные машины, которые требуется обнаружить и оценить (узел, кластер, папка hosts, папка Clusters, вплоть до центра обработки данных).
2. Распространить эти разрешения на дочерние объекты в иерархии.

    ![Назначение разрешений](./media/tutorial-assess-vmware/assign-perms.png)

### <a name="assign-a-role-for-agentless-migration"></a>Назначение роли для миграции без агента

1. В учетной записи vCenter устройства, которую вы используете для миграции, примените определяемую пользователем роль с [необходимыми разрешениями](migrate-support-matrix-vmware-migration.md#vmware-requirements-agentless)ко всем родительским объектам, на которых размещаются виртуальные машины, которые требуется обнаружить и перенести.
2. Можно присвоить роли имя, которое проще найти. Например, <em>Azure_Migrate</em>.

## <a name="work-around-vm-folder-restriction"></a>Обход ограничения папки виртуальной машины

В настоящее время средство оценки серверов не может обнаружить виртуальные машины, если доступ предоставляется на уровне папки виртуальной машины vCenter. Если вы хотите ограничить поиск и оценку по папкам виртуальных машин, используйте это решение.

1. Назначьте разрешения только на чтение для всех виртуальных машин, расположенных в папках виртуальных машин, для которых необходимо выполнить обнаружение и оценку.
2. Предоставьте доступ только для чтения всем родительским объектам, содержащим узлы виртуальных машин, кластер, папку hosts, папку Clusters, вплоть до центра обработки данных. Вам не нужно распространять разрешения на все дочерние объекты.
3. Чтобы использовать учетные данные для обнаружения, выберите центр обработки данных в качестве **области коллекции**.


Настройка управления доступом на основе ролей гарантирует, что соответствующая учетная запись пользователя vCenter имеет доступ только к виртуальным машинам, относящимся к конкретному клиенту.


## <a name="next-steps"></a>Дальнейшие шаги

[Настройте устройство](how-to-set-up-appliance-vmware.md)и [запустите непрерывное обнаружение](how-to-set-up-appliance-vmware.md#start-continuous-discovery-by-providing-vcenter-server-and-vm-credential).
