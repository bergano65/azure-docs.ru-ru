---
title: Устройство службы "Миграция Azure"
description: Содержит сводку по поддержке устройства "миграция Azure".
author: vikram1988
ms.author: vibansa
ms.manager: abhemraj
ms.topic: conceptual
ms.date: 05/04/2020
ms.openlocfilehash: f3357fcc070ca4ca2212cf0424e4baf8208a3ca1
ms.sourcegitcommit: ea551dad8d870ddcc0fee4423026f51bf4532e19
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/07/2020
ms.locfileid: "96754136"
---
# <a name="azure-migrate-appliance"></a>Устройство службы "Миграция Azure"

В этой статье перечислены необходимые условия и требования к поддержке устройства Миграции Azure. 

## <a name="deployment-scenarios"></a>Сценарии развертывания

Устройство Миграции Azure используется в приведенных ниже сценариях.

**Сценарий** | **Инструмент** | **Область использования** 
--- | --- | ---
**Оценка виртуальных машин VMware** | Миграция Azure: оценка серверов | Обнаружение виртуальных машин VMware<br/><br/> Обнаружение приложений и зависимостей компьютеров<br/><br/> Сбор метаданных компьютеров и метаданных производительности для оценки.
**Миграция виртуальных машин VMware без агента** | Миграция Azure: миграция серверов | Обнаружение виртуальных машин VMware <br/><br/> Репликация виртуальных машин VMware посредством миграции без агента.
**Оценка виртуальных машин Hyper-V** | Миграция Azure: оценка серверов | Обнаружение виртуальных машин Hyper-V<br/><br/> Сбор метаданных компьютеров и метаданных производительности для оценки.
**Оценка физических компьютеров** |  Миграция Azure: оценка серверов |  Обнаружение физических серверов (или виртуальных машин, выступающих в роли физических серверов).<br/><br/> Сбор метаданных компьютеров и метаданных производительности для оценки.

## <a name="deployment-methods"></a>Методы развертывания

Устройство можно развернуть с помощью нескольких методов.

- Устройство можно развернуть с помощью шаблона для виртуальных машин VMware и виртуальных машин Hyper-V (шаблон в формате OVA для VMware или в формате VHD для Hyper-V).
- Если вы не хотите использовать шаблон, можно развернуть устройство для VMware или Hyper-V с помощью сценария PowerShell.
- В Azure для государственных организаций устройство следует разворачивать с помощью сценария.
- Для физических серверов устройство всегда развертывается с помощью сценария.
- Ссылки для скачивания доступны в таблицах ниже.


## <a name="appliance---vmware"></a>Устройство для VMware 

В следующей таблице перечислены требования к устройству Миграции Azure для использования в VMware.

**Требование** | **VMware** 
--- | ---
**Разрешения** | Для локального или удаленного доступа к веб-приложению устройства необходимы права администратора домена или локального администратора на компьютере устройства.
**Компоненты устройства** | Устройство содержит следующие компоненты.<br/><br/> - **Приложение для управления**. Это веб-приложение для ввода данных пользователем во время развертывания устройства. Оно используется для оценки локальных компьютеров перед миграцией в Azure.<br/> - **Агент обнаружения**. Агент собирает данные конфигурации компьютеров. Он используется для оценки локальных компьютеров перед миграцией в Azure.<br/>- **Агент сборщика**: агент собирает данные о производительности. Он используется для оценки локальных компьютеров перед миграцией в Azure.<br/>- **Служба автоматического обновления**. Обновляет компоненты устройства (запускается каждые 24 часа).<br/>- **Агент DRA**. Управляет репликацией виртуальных машин и координирует взаимодействие между реплицированными компьютерами и Azure. Используется только при репликации виртуальных машин VMware в Azure с помощью миграции без агента.<br/>- **Шлюз**. Отправляет реплицированные данные в Azure. Используется только при репликации виртуальных машин VMware в Azure с помощью миграции без агента.
**Поддерживаемое развертывание** | Развертывание в качестве виртуальной машины VMware с помощью шаблона OVA.<br/><br/> Развертывание в качестве виртуальной машины VMware или физического компьютера с помощью сценария установки PowerShell.
**Поддержка проектов** |  Устройство может быть связано с одним проектом. <br/> С одним проектом можно связать любое количество устройств.<br/> 
**Ограничения обнаружения** | Устройство может обнаружить до 10 000 виртуальных машин VMware на сервере vCenter Server.<br/> Устройство может подключаться к одному серверу vCenter Server.
**Шаблон OVA** | Скачайте с портала или [отсюда](https://go.microsoft.com/fwlink/?linkid=2140333)<br/><br/> Размер скачивания составляет 11,9 ГБ.<br/><br/> Скачанный шаблон устройства поставляется с лицензией для ознакомительной версии Windows Server 2016, которая действительна в течение 180 дней. Если ознакомительный период завершается, рекомендуется скачать и развернуть новое устройство или активировать лицензию операционной системы на виртуальной машине устройства.
**Сценарий PowerShell** | Обратитесь к этой [статье](./deploy-appliance-script.md#set-up-the-appliance-for-vmware).<br/><br/> 
**Программное и аппаратное обеспечение** |  Устройство должно работать на компьютере с Windows Server 2016, оснащенном 32 ГБ ОЗУ, 8 виртуальными ЦП, около 80 ГБ дискового хранилища и внешним виртуальным коммутатором.<br/> Устройству требуется доступ к Интернету либо напрямую, либо через прокси-сервер.<br/><br/> Если вы запускаете устройство на виртуальной машине VMware, потребуется достаточно ресурсов на сервере vCenter Server, чтобы выделить виртуальную машину, соответствующую требованиям.<br/><br/> Если вы запускаете устройство на физическом компьютере, убедитесь, что он работает под управлением Windows Server 2016 и соответствует требованиям к оборудованию.
**Требования к VMware** | Если вы развертываете устройство как виртуальную машину VMware, его необходимо развернуть на узле ESXi под управлением версии 5.5 или более поздней версии.<br/><br/> Сервер vCenter Server с версией 5.5, 6.0, 6.5 или 6.7.
**Пакет VDDK (миграция без агента)** | Если вы развертываете устройство как виртуальную машину VMware и используете миграцию без агента, на виртуальной машине устройства должен быть установлен пакет VDDK для VMware vSphere.
**Значение хэша OVA** | [Проверьте](tutorial-discover-vmware.md#verify-security) значения хэша шаблона OVA.
**Значение хэша для сценария PowerShell** | [Проверьте](deploy-appliance-script.md#verify-file-security) значения хэша для сценария PowerShell.




## <a name="appliance---hyper-v"></a>Устройство для Hyper-V

**Требование** | **Hyper-V** 
--- | ---
**Разрешения** | Для локального или удаленного доступа к веб-приложению устройства необходимы права администратора домена или локального администратора на компьютере устройства.
**Компоненты устройства** | Устройство содержит следующие компоненты.<br/><br/>- **Приложение для управления**. Это веб-приложение для ввода данных пользователем во время развертывания устройства. Оно используется для оценки локальных компьютеров перед миграцией в Azure.<br/> - **Агент обнаружения**. Агент собирает данные конфигурации компьютеров. Он используется для оценки локальных компьютеров перед миграцией в Azure.<br/>- **Агент сборщика**: агент собирает данные о производительности. Он используется для оценки локальных компьютеров перед миграцией в Azure.<br/>- **Служба автоматического обновления**. Обновляет компоненты устройства (запускается каждые 24 часа).
**Поддерживаемое развертывание** | Развертывание в качестве виртуальной машины Hyper-V с помощью шаблона VHD.<br/><br/> Развертывание в качестве виртуальной машины Hyper-V или физического компьютера с помощью сценария установки PowerShell.
**Поддержка проектов** |  Устройство может быть связано с одним проектом. <br/> С одним проектом можно связать любое количество устройств.<br/> 
**Ограничения обнаружения** | Устройство может обнаружить до 5000 виртуальных машин Hyper-V.<br/> Устройство может подключаться к 300 узлам Hyper-V.
**Шаблон VHD** | Сжатая папка с VHD-файлом. Скачайте с портала или [отсюда](https://go.microsoft.com/fwlink/?linkid=2140422).<br/><br/> Размер скачивания составляет 8,91 ГБ.<br/><br/> Скачанный шаблон устройства поставляется с лицензией для ознакомительной версии Windows Server 2016, которая действительна в течение 180 дней. Если ознакомительный период завершается, рекомендуется скачать и развернуть новое устройство или активировать лицензию операционной системы на виртуальной машине устройства.
**Сценарий PowerShell** | Обратитесь к этой [статье](./deploy-appliance-script.md#set-up-the-appliance-for-hyper-v).<br/><br/> 
**Программное обеспечение/оборудование** _   |  Устройство должно работать на компьютере с Windows Server 2016, 16 ГБ ОЗУ, 8 виртуальных ЦП, около 80 ГБ дискового накопителя и внешним виртуальным коммутатором.<br/> Устройству требуется статический или динамический IP-адрес, а также доступ к Интернету напрямую или через прокси-сервер.<br/><br/> Если вы запускаете устройство в качестве виртуальной машины Hyper-V, вам потребуется достаточно ресурсов на узле Hyper-V, чтобы выделить требования к оборудованию.<br/><br/> Если вы запускаете устройство на физическом компьютере, убедитесь, что он работает под управлением Windows Server 2016 и соответствует требованиям к оборудованию. 
_ *Требования к Hyper-V** | Если вы развертываете устройство с помощью шаблона VHD, то Миграция Azure предоставляет виртуальную машину Hyper-V версии 5.0.<br/><br/> Узел Hyper-V должен работать под управлением Windows Server 2012 R2 или более поздней версии. 
**Значение хэша VHD** | [Проверка](tutorial-discover-hyper-v.md#verify-security) Хэш-значения шаблона виртуального жесткого диска.
**Значение хэша для сценария PowerShell** | [Проверьте](deploy-appliance-script.md#verify-file-security) значения хэша для сценария PowerShell.


## <a name="appliance---physical"></a>Устройство для физического компьютера

**Требование** | **Физический компьютер** 
--- | ---
**Разрешения** | Для локального или удаленного доступа к веб-приложению устройства необходимы права администратора домена или локального администратора на компьютере устройства.
**Компоненты устройства** | Устройство содержит следующие компоненты. <br/><br/> - **Приложение для управления**. Это веб-приложение для ввода данных пользователем во время развертывания устройства. Оно используется для оценки локальных компьютеров перед миграцией в Azure.<br/> - **Агент обнаружения**. Агент собирает данные конфигурации компьютеров. Он используется для оценки локальных компьютеров перед миграцией в Azure.<br/>- **Агент сборщика**: агент собирает данные о производительности. Он используется для оценки локальных компьютеров перед миграцией в Azure.<br/>- **Служба автоматического обновления**. Обновляет компоненты устройства (запускается каждые 24 часа).
**Поддерживаемое развертывание** | Развертывание в качестве выделенного физического компьютера или виртуальной машины с помощью сценария установки PowerShell. Этот сценарий можно скачать с портала.
**Поддержка проектов** |  Устройство может быть связано с одним проектом. <br/> С одним проектом можно связать любое количество устройств.<br/> 
**Ограничения обнаружения** | Устройство может обнаруживать до 1000 физических серверов.
**Сценарий PowerShell** | Скачайте сценарий (AzureMigrateInstaller.ps1) в ZIP-папку на портале или [отсюда](https://go.microsoft.com/fwlink/?linkid=2140334). [Подробнее](tutorial-discover-physical.md).<br/><br/> Размер загрузки составляет 85,8 МБ.
**Программное и аппаратное обеспечение** |  Устройство должно работать на компьютере с Windows Server 2016, 16 ГБ ОЗУ, 8 виртуальных ЦП, около 80 ГБ дискового накопителя.<br/> Устройству требуется статический или динамический IP-адрес, а также доступ к Интернету напрямую или через прокси-сервер.<br/><br/> Если вы запускаете устройство на физическом компьютере, убедитесь, что он работает под управлением Windows Server 2016 и соответствует требованиям к оборудованию.<br/>_(В настоящее время развертывание устройства поддерживается только в Windows Server 2016.)_
**Значение хэша** | [Проверьте](tutorial-discover-physical.md#verify-security) значения хэша для сценария PowerShell.

## <a name="url-access"></a>доступ по URL-адресу

Устройству Миграции Azure требуется подключение к Интернету.

- При развертывании устройства Миграция Azure выполняет проверку подключения к необходимым URL-адресам.
- Необходимо разрешить доступ ко всем URL-адресам в списке. Если вы выполняете только оценку, то можете пропустить URL-адреса, помеченные как обязательные только для миграции без агента VMware.
-  Если вы используете прокси-сервер на основе URL-адресов для подключения к Интернету, убедитесь, что он разрешает все записи CNAME, полученные при поиске URL-адресов.

### <a name="public-cloud-urls"></a>URL-адреса общедоступных облаков

**URL-адрес** | **Сведения**  
--- | --- |
*.portal.azure.com  | Перейдите на портал Azure.
*.windows.net <br/> *.msftauth.net <br/> *.msauth.net <br/> *.microsoft.com <br/> *.live.com <br/> *. office.com | Войдите в свою подписку Azure.
*.microsoftonline.com <br/> *.microsoftonline-p.com | Создание приложений Azure Active Directory (AD) для взаимодействия устройства с Миграцией Azure.
management.azure.com | Создание приложений Azure AD для взаимодействия устройства с службой "Миграция Azure".
*.services.visualstudio.com | Передача журналов приложений, используемых для внутреннего мониторинга.
*.vault.azure.net | Управление секретами в Azure Key Vault. Примечание. Убедитесь, что компьютеры, для которых выполняется репликация, имеют доступ к этому адресу.
aka.ms/* | Разрешение доступа к ссылкам aka. Используется для обновления устройства Миграции Azure.
download.microsoft.com/download | Разрешение скачивания из Центра загрузки Майкрософт.
*.servicebus.windows.net | Взаимодействие между устройством и службой "Миграция Azure".
*.discoverysrv.windowsazure.com <br/> *.migration.windowsazure.com | Подключение к URL-адресам службы "Миграция Azure".
*.hypervrecoverymanager.windowsazure.com | **Используется для миграции без агента VMware**.<br/><br/> Подключение к URL-адресам службы "Миграция Azure".
*.blob.core.windows.net |  **Используется для миграции без агента VMware**.<br/><br/>Передача данных в хранилище для миграции.

### <a name="government-cloud-urls"></a>URL-адреса облака Azure для государственных организаций

**URL-адрес** | **Сведения**  
--- | --- |
*.portal.azure.us  | Перейдите на портал Azure.
graph.windows.net | Войдите в свою подписку Azure.
login.microsoftonline.us  | Создание приложений Azure Active Directory (AD) для взаимодействия устройства с Миграцией Azure.
management.usgovcloudapi.net | Создание приложений Azure AD для взаимодействия устройства с службой "Миграция Azure".
*.services.visualstudio.com | Передача журналов приложений, используемых для внутреннего мониторинга.
*.vault.usgovcloudapi.net | Управление секретами в Azure Key Vault.
aka.ms/* | Разрешение доступа к ссылкам AKA. Используется для обновления устройства Миграции Azure.
download.microsoft.com/download | Разрешение скачивания из Центра загрузки Майкрософт.
*.servicebus.usgovcloudapi.net  | Взаимодействие между устройством и службой "Миграция Azure".
*.discoverysrv.windowsazure.us <br/> *.migration.windowsazure.us | Подключение к URL-адресам службы "Миграция Azure".
*.hypervrecoverymanager.windowsazure.us | **Используется для миграции без агента VMware**.<br/><br/> Подключение к URL-адресам службы "Миграция Azure".
*.blob.core.usgovcloudapi.net  |  **Используется для миграции без агента VMware**.<br/><br/>Передача данных в хранилище для миграции.
*.applicationinsights.us | Передача журналов приложений, используемых для внутреннего мониторинга.





## <a name="collected-data---vmware"></a>Собираемые данные VMware

Устройство собирает метаданные, данные производительности и данные анализа зависимостей (если используется [анализ зависимостей](concepts-dependency-visualization.md) без агента).

### <a name="metadata"></a>Метаданные

Метаданные, обнаруженные устройством Миграции Azure, позволяют выяснить, готовы ли компьютеры и приложения к миграции в Azure, а также определить соответствующий масштаб компьютеров и приложений, составить планы затрат и проанализировать зависимости приложений. Корпорация Майкрософт не использует эти данные для аудита соответствия требованиям лицензий.

Ниже приведен полный список метаданных виртуальных машин VMware, которые устройство собирает и отправляет в Azure.

**Данные** | **Счетчик**
--- | --- 
**Сведения о компьютере** | 
Идентификатор виртуальной машины | vm.Config.InstanceUuid 
имя виртуальной машины; | vm.Config.Name
Идентификатор vCenter Server | VMwareClient.Instance.Uuid
Описание виртуальной машины | vm.Summary.Config.Annotation
Имя продукта лицензии | vm.Client.ServiceContent.About.LicenseProductName
Тип операционной системы | vm.SummaryConfig.GuestFullName
Тип загрузки | vm.Config.Firmware
Число ядер | vm.Config.Hardware.NumCPU
Память (МБ) | vm.Config.Hardware.MemoryMB
Количество дисков | vm.Config.Hardware.Device.ToList().FindAll(x => is VirtualDisk).count
Список размеров диска | vm.Config.Hardware.Device.ToList().FindAll(x => is VirtualDisk)
Список сетевых адаптеров | vm.Config.Hardware.Device.ToList().FindAll(x => is VirtualEthernet).count
загрузка ЦП; | cpu.usage.average
Использование памяти |mem.usage.average
**Сведения о дисках** | 
Значение ключа диска | disk.Key
Номер Diskunit | disk.UnitNumber
Значение ключа контроллера диска | disk.ControllerKey.Value
Подготовленных гигабайт | virtualDisk.DeviceInfo.Summary
Имя диска | Значение, созданное на основе disk.UnitNumber, disk.Key и disk.ControllerKey.Value
Число операций чтения за секунду. | virtualDisk.numberReadAveraged.average
Число операций записи за секунду. | virtualDisk.numberWriteAveraged.average
Пропускная способность чтения (МБ/с) | virtualDisk.read.average
Пропускная способность записи (МБ/с) | virtualDisk.write.average
**Сведения о сетевых картах** | 
Имя сетевого адаптера | nic.Key
MAC-адрес. | ((VirtualEthernetCard)nic).MacAddress
IPv4-адреса | vm.Guest.Net
IPv6-адреса | vm.Guest.Net
Пропускная способность чтения (МБ/с) | net.received.average
Пропускная способность записи (МБ/с) | net.transmitted.average
**Сведения о пути инвентаризации** | 
Имя | container.GetType().Name
Тип дочернего объекта | container.ChildType
Справочные сведения | container.MoRef
Сведения о родительском объекте | Container.Parent
Сведения о папках для виртуальной машины | ((Folder)container).ChildEntity.Type
Сведения о центре обработки данных для виртуальной машины | ((Datacenter)container).VmFolder
Сведения о центре обработки данных для папки узла | ((Datacenter)container).HostFolder
Сведения о кластере для узла | ((ClusterComputeResource)container).Host
Сведения об узле для виртуальной машины | ((HostSystem)container).VM

### <a name="performance-data"></a>Данные о производительности


Ниже приведены данные производительности виртуальных машин VMware, которые устройство собирает и отправляет в Azure.

**Data** | **Счетчик** | **Влияние на оценку**
--- | --- | ---
загрузка ЦП; | cpu.usage.average | Рекомендуемые размер и стоимость виртуальной машины.
Использование памяти | mem.usage.average | Рекомендуемые размер и стоимость виртуальной машины.
Пропускная способность чтения с дисков (МБ/с) | virtualDisk.read.average | Вычисляет размер диска, затраты на хранение и размер виртуальной машины.
Пропускная способность записи на диски (МБ/с) | virtualDisk.write.average | Вычисляет размер диска, затраты на хранение и размер виртуальной машины.
Число операций чтения с диска в секунду | virtualDisk.numberReadAveraged.average | Вычисляет размер диска, затраты на хранение и размер виртуальной машины.
Число операций записи на диск в секунду | virtualDisk.numberWriteAveraged.average  | Вычисляет размер диска, затраты на хранение и размер виртуальной машины.
Пропускная способность чтения из сетевой карты (МБ/с) | net.received.average | Вычисление размера виртуальной машины.
Пропускная способность записи в сетевую карту (МБ/с) | net.transmitted.average  |Вычисление размера виртуальной машины.


### <a name="installed-apps-metadata"></a>Метаданные установленных приложений

При обнаружении приложений выполняется сбор установленных приложений и данных операционной системы.

#### <a name="windows-vm-apps-data"></a>Данные приложений виртуальной машины Windows

Ниже приведены данные об установленных приложениях, собираемых устройством с каждой виртуальной машины, для которой разрешено обнаружение приложений. Эти данные отправляются в Azure.

**Data** | **Расположение реестра** | **Ключ**
--- | --- | ---
Application Name  | HKLM: \ Софтваре\микрософт\виндовс\куррентверсион\унинсталл\* <br/> HKLM: \ Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*  | DisplayName
Версия  | HKLM: \ Софтваре\микрософт\виндовс\куррентверсион\унинсталл\*  <br/> HKLM: \ Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*  | дисплайверсион 
Поставщик  | HKLM: \ Софтваре\микрософт\виндовс\куррентверсион\унинсталл\*  <br/> HKLM: \ Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*  | Publisher

#### <a name="windows-vm-features-data"></a>Данные о функциях виртуальной машины Windows

Ниже приведены данные о функциях, собираемых устройством с каждой виртуальной машины, включенной для обнаружения приложений. Эти данные отправляются в Azure.

**Data**  | **Командлет PowerShell** | **Свойство**
--- | --- | ---
Имя  | Get-WindowsFeature  | Имя
Тип функции | Get-WindowsFeature  | Объект featuretype
Родительский  | Get-WindowsFeature  | Родительский

#### <a name="windows-vm-sql-server-metadata"></a>Метаданные SQL Server виртуальной машины Windows

Ниже приведены метаданные SQL Server, собираемые устройством с виртуальных машин, на которых выполняется Microsoft SQL Server для обнаружения приложений. Эти данные отправляются в Azure.

**Data**  | **Расположение реестра**  | **Ключ**
--- | --- | ---
Имя  | HKLM: \ SOFTWARE\Microsoft\Microsoft SQL сохраняет имена экземпляров  | инсталлединстанце
Выпуск  | HKLM: \ SOFTWARE\Microsoft\Microsoft SQL Server \\ \<InstanceName> \setup  | Выпуск 
Пакет обновления  | HKLM: \ SOFTWARE\Microsoft\Microsoft SQL Server \\ \<InstanceName> \setup  | SP
Версия  | HKLM: \ SOFTWARE\Microsoft\Microsoft SQL Server \\ \<InstanceName> \setup  | Версия 

#### <a name="windows-vm-operating-system-data"></a>Данные операционной системы виртуальной машины Windows

Ниже приведены данные операционной системы, которые устройство собирает для каждой виртуальной машины, включенной для обнаружения приложений. Эти данные отправляются в Azure.

Данные  | класс WMI  | Свойство класса WMI
--- | --- | ---
Имя  | Win32_operatingsystem  | Заголовок
Версия  | Win32_operatingsystem  | Версия
Architecture  | Win32_operatingsystem  | OSArchitecture

#### <a name="linux-vm-apps-data"></a>Данные приложений виртуальной машины Linux

Ниже приведены данные об установленных приложениях, собираемых устройством с каждой виртуальной машины, для которой разрешено обнаружение приложений. В зависимости от операционной системы виртуальной машины выполняются одна или несколько команд. Эти данные отправляются в Azure.

Данные  | Команда
--- | --- 
Имя | RPM, dpkg — запрос, привязка
Версия | RPM, dpkg — запрос, привязка
Поставщик | RPM, dpkg — запрос, привязка

#### <a name="linux-vm-operating-system-data"></a>Данные операционной системы виртуальной машины Linux

Ниже приведены данные операционной системы, которые устройство собирает для каждой виртуальной машины, включенной для обнаружения приложений. Эти данные отправляются в Azure.

**Data**  | **Command** 
--- | --- | ---
Имя <br/> version | Собраны из одного или нескольких следующих файлов:<br/> <br/>/etc/os-release  <br> /usr/lib/os-release  <br> /etc/enterprise-release  <br> /etc/redhat-release  <br> /etc/oracle-release  <br> /etc/SuSE-release  <br> /etc/lsb-release  <br> /etc/debian_version 
Architecture | uname


### <a name="app-dependencies-metadata"></a>Метаданные зависимостей приложений

При анализе зависимостей без агента выполняется сбор данных о подключениях и процессах.

#### <a name="windows-vm-app-dependencies-data"></a>Данные зависимостей приложения виртуальной машины Windows

Ниже приведены данные подключений, собираемые устройством с каждой виртуальной машины, для которой включен анализ зависимостей без агента. Эти данные отправляются в Azure.

**Data** | **Используемая команда** 
--- | --- 
Локальный порт | netstat
Локальный IP-адрес | netstat
Удаленный порт | netstat
Удаленный IP-адрес | netstat
Состояние TCP-подключения. | netstat
ИД процесса | netstat
Число активных подключений. | netstat


Ниже приведены данные процессов, собираемые устройством с каждой виртуальной машины, для которой включен анализ зависимостей без агента. Эти данные отправляются в Azure.

**Data** | **Класс WMI** | **Свойство класса WMI**
--- | --- | ---
Имя процесса | Win32_Process | ExecutablePath
Аргументы процесса | Win32_Process | Командная строка
имя приложения; | Win32_Process | Параметр VersionInfo.ProductName свойства ExecutablePath

#### <a name="linux-vm-app-dependencies-data"></a>Данные зависимостей приложений виртуальной машины Linux

Ниже приведены данные подключений и процессов, собираемые устройством с каждой виртуальной машины Linux, для которой включен анализ зависимостей без агента. Эти данные отправляются в Azure.

**Data** | **Используемая команда** 
--- | ---
Локальный порт | netstat 
Локальный IP-адрес | netstat 
Удаленный порт | netstat 
Удаленный IP-адрес | netstat 
Состояние TCP-подключения. | netstat 
Число активных подключений. | netstat
ИД процесса  | netstat 
Имя процесса | ps
Аргументы процесса | ps
имя приложения; | dpkg или rpm



## <a name="collected-data---hyper-v"></a>Собираемые данные Hyper-V

Устройство собирает метаданные, данные производительности и данные анализа зависимостей (если используется [анализ зависимостей](concepts-dependency-visualization.md) без агента).

### <a name="metadata"></a>Метаданные
Метаданные, обнаруженные устройством Миграции Azure, позволяют выяснить, готовы ли компьютеры и приложения к миграции в Azure, а также определить соответствующий масштаб компьютеров и приложений, составить планы затрат и проанализировать зависимости приложений. Корпорация Майкрософт не использует эти данные для аудита соответствия требованиям лицензий.

Ниже приведен полный список метаданных виртуальных машин Hyper-V, которые устройство собирает и отправляет в Azure.

**Данные** | **Класс WMI** | **Свойство класса WMI**
--- | --- | ---
**Сведения о компьютере** | 
Серийный номер BIOS Msvm_BIOSElement | BIOSSerialNumber
Тип виртуальной машины (1-го или 2-го поколения) | Msvm_VirtualSystemSettingData | VirtualSystemSubType
Отображаемое имя виртуальной машины | Msvm_VirtualSystemSettingData | ElementName
Версия виртуальной машины | Msvm_ProcessorSettingData | VirtualQuantity
Память (байт) | Msvm_MemorySettingData | VirtualQuantity
Максимальный объем памяти, доступный виртуальной машине | Msvm_MemorySettingData | Ограничение
Включение динамической памяти | Msvm_MemorySettingData | DynamicMemoryEnabled
Имя, версия и полное доменное имя операционной системы | Msvm_KvpExchangeComponent | Данные имени GuestIntrinsicExchangeItems
Состояния включения виртуальной машины | Msvm_ComputerSystem | EnabledState
**Сведения о дисках** | 
Идентификатор диска | Msvm_VirtualHardDiskSettingData | VirtualDiskId
Тип виртуального жесткого диска | Msvm_VirtualHardDiskSettingData | Тип
Размер виртуального жесткого диска | Msvm_VirtualHardDiskSettingData | MaxInternalSize
Родительский элемент виртуального жесткого диска | Msvm_VirtualHardDiskSettingData | ParentPath
**Сведения о сетевых картах** | 
IP-адреса (искусственные сетевые карты) | Msvm_GuestNetworkAdapterConfiguration | IPAddresses
Включение DHCP (искусственные сетевые карты) | Msvm_GuestNetworkAdapterConfiguration | DHCPEnabled
Идентификатор сетевой карты (искусственные сетевые карты) | Msvm_SyntheticEthernetPortSettingData | InstanceID
MAC-адрес сетевой карты (искусственные сетевые карты) | Msvm_SyntheticEthernetPortSettingData | Адрес
Идентификатор сетевой карты (традиционные сетевые карты) | Данные MsvmEmulatedEthernetPortSetting | InstanceID
Идентификатор MAC-адреса сетевой карты (традиционные сетевые карты) | Данные MsvmEmulatedEthernetPortSetting | Адрес

### <a name="performance-data"></a>Данные о производительности

Ниже приведены данные производительности виртуальных машин Hyper-V, которые устройство собирает и отправляет в Azure.

**Класс счетчиков производительности** | **Счетчик** | **Влияние на оценку**
--- | --- | ---
Виртуальный процессор гипервизора Hyper-V | % времени выполнения гостя | Рекомендуемые размер и стоимость виртуальной машины.
Динамическая память виртуальной машины Hyper-V | Текущая нагрузка (%)<br/> Физическая память, доступная для гостя (МБ) | Рекомендуемые размер и стоимость виртуальной машины.
Виртуальное устройство хранения Hyper-V | Чтение (байт в секунду) | Вычисляет размер диска, затраты на хранение и размер виртуальной машины.
Виртуальное устройство хранения Hyper-V | Запись (байт в секунду) | Вычисляет размер диска, затраты на хранение и размер виртуальной машины.
Виртуальный сетевой адаптер Hyper-V | Получение (байт в секунду) | Вычисление размера виртуальной машины.
Виртуальный сетевой адаптер Hyper-V | Отправка (байт в секунду) | Вычисление размера виртуальной машины.

- Загрузка ЦП — это сумма всех нагрузок на всех виртуальных процессорах, подключенных к виртуальной машине.
- Использование памяти вычисляется по формуле: ((текущая загрузка) * (физическая память, доступная гостю))/100.
- Значения использования диска и сети собираются из перечисленных счетчиков производительности Hyper-V.


## <a name="collected-data---physical"></a>Собираемые данные физических компьютеров

Устройство собирает метаданные, данные производительности и данные анализа зависимостей (если используется [анализ зависимостей](concepts-dependency-visualization.md) без агента).

### <a name="windows-metadata"></a>Метаданные Windows

Метаданные, обнаруженные устройством Миграции Azure, позволяют выяснить, готовы ли компьютеры и приложения к миграции в Azure, а также определить соответствующий масштаб компьютеров и приложений, составить планы затрат и проанализировать зависимости приложений. Корпорация Майкрософт не использует эти данные для аудита соответствия требованиям лицензий.

Ниже приведен полный список метаданных серверов Windows Server, которые устройство собирает и отправляет в Azure.

**Данные** | **Класс WMI** | **Свойство класса WMI**
--- | --- | ---
Полное доменное имя. | Win32_ComputerSystem | Domain, Name, PartOfDomain
Число процессорных ядер | Win32_Processor | NumberOfCores
Выделенная память | Win32_ComputerSystem | TotalPhysicalMemory
Серийный номер BIOS | Win32_ComputerSystemProduct | IdentifyingNumber
Глобальный уникальный идентификатор BIOS | Win32_ComputerSystemProduct | UUID
Тип загрузки | Win32_DiskPartition | Проверьте наличие раздела типа **GPT:System** для EFI или BIOS.
Имя ОС | Win32_OperatingSystem | Caption
Версия ОС |Win32_OperatingSystem | Версия
Архитектура ОС | Win32_OperatingSystem | OSArchitecture
Число дисков | Win32_DiskDrive | Model, Size, DeviceID, MediaType, Name.
Размер диска | Win32_DiskDrive | Размер
Список сетевых карт | Win32_NetworkAdapterConfiguration | Description, Index.
IP-адрес сетевой карты | Win32_NetworkAdapterConfiguration | IPAddress
MAC-адрес сетевой карты | Win32_NetworkAdapterConfiguration | MACAddress

### <a name="linux-metadata"></a>Метаданные Linux

Ниже приведен полный список метаданных серверов Linux, которые устройство собирает и отправляет в Azure.

**Данные** | **Linux** 
--- | --- 
Полное доменное имя. | cat /proc/sys/kernel/hostname, hostname -f
Число процессорных ядер |  /proc/cpuinfo \| awk '/^processor/{print $3}' \| wc -l
Выделенная память | cat /proc/meminfo \| grep MemTotal \| awk '{printf "%.0f", $2/1024}'
Серийный номер BIOS | lshw \| grep "serial:" \| head -n1 \| awk '{print $2}' <br/> /usr/sbin/dmidecode -t 1 \| grep 'Serial' \| awk '{ $1="" ; $2=""; print}'
Глобальный уникальный идентификатор BIOS | cat /sys/class/dmi/id/product_uuid
Тип загрузки | [ -d /sys/firmware/efi ] && echo EFI \|\| echo BIOS
Имя и версия ОС | Мы получаем доступ к этим файлам для определения версии и имени ОС:<br/><br/> /etc/os-release<br/> /usr/lib/os-release <br/> /etc/enterprise-release <br/> /etc/redhat-release<br/> /etc/oracle-release<br/>  /etc/SuSE-release<br/>  /etc/lsb-release  <br/> /etc/debian_version
Архитектура ОС | Uname -m
Число дисков | fdisk -l \| egrep 'Disk.*bytes' \| awk '{print $2}' \| cut -f1 -d ':'
Загрузочный диск | df /boot \| sed -n 2p \| awk '{print $1}'
Размер диска | fdisk -l \| egrep 'Disk.*bytes' \| egrep $disk: \| awk '{print $5}'
Список сетевых карт | ip -o -4 addr show \| awk '{print $2}'
IP-адрес сетевой карты | ip addr show $nic \| grep inet \| awk '{print $2}' \| cut -f1 -d "/" 
MAC-адрес сетевой карты | ip addr show $nic \| grep ether  \| awk '{print $2}'

### <a name="windows-performance-data"></a>Данные производительности Windows

Ниже приведены данные производительности серверов Windows Server, которые устройство собирает и отправляет в Azure.

**Data** | **Класс WMI** | **Свойство класса WMI**
--- | --- | ---
Загрузка ЦП. | Win32_PerfFormattedData_PerfOS_Processor | PercentIdleTime
Использование памяти | Win32_PerfFormattedData_PerfOS_Memory | AvailableMBytes
Число сетевых карт | Win32_PerfFormattedData_Tcpip_NetworkInterface | Получение числа сетевых устройств.
Полученные данные на сетевую карту | Win32_PerfFormattedData_Tcpip_NetworkInterface  | BytesReceivedPerSec
Переданные данные на сетевую карту | BWin32_PerfFormattedData_Tcpip_NetworkInterface | BytesSentPersec
Число дисков | BWin32_PerfFormattedData_PerfDisk_PhysicalDisk | Количество дисков.
Сведения о диске | Win32_PerfFormattedData_PerfDisk_PhysicalDisk | DiskWritesPerSec, DiskWriteBytesPerSec, DiskReadsPerSec, DiskReadBytesPerSec.

### <a name="linux-performance-data"></a>Данные производительности Linux

Ниже приведены данные производительности серверов Linux, которые устройство собирает и отправляет в Azure.

**Data** | **Linux** 
--- | --- 
Загрузка ЦП. | cat /proc/stat/| grep 'cpu' /proc/stat
Использование памяти | free \| grep Mem \| awk '{print $3/$2 * 100.0}'
Число сетевых карт | lshw -class network \| grep eth[0-60] \| wc -l
Полученные данные на сетевую карту | cat /sys/class/net/eth$nic/statistics/rx_bytes
Переданные данные на сетевую карту | cat /sys/class/net/eth$nic/statistics/tx_bytes
Число дисков | fdisk -l \| egrep 'Disk.*bytes' \| awk '{print $2}' \| cut -f1 -d ':'
Сведения о диске | cat /proc/diskstats


## <a name="appliance-upgrades"></a>Обновление устройства

Устройство обновляется при обновлении агентов Миграции Azure, работающих на устройстве. Это происходит автоматически, так как на устройстве по умолчанию включено автоматическое обновление. Вы можете изменить этот параметр по умолчанию, чтобы обновить службы устройства вручную.

### <a name="turn-off-auto-update"></a>Отключение автоматического обновления

1. На компьютере, на котором работает устройство, откройте редактор реестра.
2. Перейдите в раздел **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\AzureAppliance**.
3. Чтобы отключить автоматическое обновление, создайте раздел реестра **AutoUpdate** со значением типа DWORD, равным 0.

    ![Настройка раздела реестра](./media/migrate-appliance/registry-key.png)


### <a name="turn-on-auto-update"></a>Включение автоматического обновления

Включить автоматическое обновление можно одним из следующих способов.

- Можно удалить раздел реестра AutoUpdate из HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\AzureAppliance.
- Чтобы включить автоматическое обновление, щелкните **просмотреть службы устройства** из последних проверок обновлений на панели **Настройка необходимых компонентов** .

Чтобы удалить раздел реестра, выполните следующие действия.

1. На компьютере, на котором работает устройство, откройте редактор реестра.
2. Перейдите в раздел **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\AzureAppliance**.
3. Удалите раздел реестра **AutoUpdate**, который был создан ранее, чтобы отключить автоматическое обновление.

Чтобы включить автоматическое обновление в диспетчере конфигурации устройства после завершения обнаружения, выполните следующие действия.

1. В диспетчере конфигурации устройства перейдите к разделу **Настройка панели предварительных требований** .
2. В последней проверке обновлений щелкните **просмотреть службы устройств** и щелкните ссылку, чтобы включить автоматическое обновление.

    ![Включение автоматического обновления](./media/migrate-appliance/autoupdate-off.png)

### <a name="check-the-appliance-services-version"></a>Проверка версии служб устройства

Проверить версию служб устройства можно одним из следующих способов.

- В диспетчере конфигурации устройства перейдите к разделу **Настройка панели предварительных требований** .
- Это можно сделать на компьютере устройства, выбрав **Панель управления** > **Программы и компоненты**.

Чтобы проверить Диспетчер конфигурации устройства, выполните следующие действия.

1. В диспетчере конфигурации устройства перейдите к разделу **Настройка панели предварительных требований** .
2. В последней проверке обновлений щелкните **Просмотр служб устройства**.

    ![Проверка версии](./media/migrate-appliance/versions.png)

Проверка с помощью панели управления.

1. На устройстве щелкните **Пуск** > **Панель управления** > **Программы и компоненты**.
2. Проверьте версии служб устройства в списке.

    ![Проверка версии на панели управления](./media/migrate-appliance/programs-features.png)

### <a name="manually-update-an-older-version"></a>Обновление устаревшей версии вручную

Если вы используете устаревшую версию какого-либо из компонентов, необходимо удалить службу и вручную выполнить обновление до последней версии.

1. Чтобы проверить наличие последних версий службы устройства, [скачайте](https://aka.ms/latestapplianceservices) файл LatestComponents.json.
2.    После скачивания откройте файл LatestComponents.json в Блокноте.
3. Найдите в файле последнюю версию службы и ссылку для ее скачивания. Пример:

    "Name": "ASRMigrationWebApp", "DownloadLink": "https://download.microsoft.com/download/f/3/4/f34b2eb9-cc8d-4978-9ffb-17321ad9b7ed/MicrosoftAzureApplianceConfigurationManager.msi", "Version": "6.0.211.2", "Md5Hash": "e00a742acc35e78a64a6a81e75469b84"

4.    Скачайте последнюю версию устаревшей службы, используя ссылку в файле.
5. После скачивания выполните приведенную ниже команду в окне командной строки администратора, чтобы проверить целостность скачанного MSI-файла.

    ``` C:\>Get-FileHash -Path <file_location> -Algorithm [Hashing Algorithm] ```. Например:  C:\>CertUtil -HashFile C:\Users\public\downloads\MicrosoftAzureApplianceConfigurationManager.MSI MD5

5. Убедитесь, что выходные данные команды соответствуют записи значения хэша для службы в файле (например, значению хэша MD5 выше).
6. Теперь запустите MSI-файл, чтобы установить службу. Установка будет выполнена автоматически, и окно установщика закроется после завершения.
7. После завершения установки проверьте версию службы, выбрав **Панель управления** > **Программы и компоненты**. Служба должна быть обновлена до последней версии, указанной в JSON-файле.



## <a name="next-steps"></a>Дальнейшие действия

- [Узнайте](how-to-set-up-appliance-vmware.md), как настроить устройство для VMware.
- [Узнайте](how-to-set-up-appliance-hyper-v.md), как настроить устройство для Hyper-V.
- [Узнайте](how-to-set-up-appliance-physical.md), как настроить устройство для физических серверов.

