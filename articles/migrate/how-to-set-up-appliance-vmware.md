---
title: Настройка устройства "миграция Azure" для VMware
description: Узнайте, как настроить устройство "миграция Azure" для оценки и миграции виртуальных машин VMware.
ms.topic: article
ms.date: 04/16/2020
ms.openlocfilehash: 9a4e652180b236262ea57ae49d35410ebfbdc927
ms.sourcegitcommit: 3792cf7efc12e357f0e3b65638ea7673651db6e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91448653"
---
# <a name="set-up-an-appliance-for-vmware-vms"></a>Настройка устройства для виртуальных машин VMware

В этой статье описывается настройка устройства "миграция Azure" для оценки с помощью средства " [Миграция](migrate-services-overview.md#azure-migrate-server-assessment-tool) Azure", а также для миграции без агента с использованием средства [миграции Azure "миграция сервера](migrate-services-overview.md#azure-migrate-server-migration-tool) ".

[Устройство "миграция Azure](migrate-appliance.md) " — это упрощенное устройство, используемое службой "миграция Azure": Оценка серверов и миграция серверов для обнаружения локальных виртуальных машин VMware, отправки метаданных виртуальной машины и данных о производительности в Azure, а также для репликации виртуальных машин VMware во время миграции без агента.

Вы можете развернуть устройство с помощью нескольких методов:

- Настройка на виртуальной машине VMware с помощью скачанного шаблона OVA. Этот метод описан в этой статье.
- Настройка на виртуальной машине VMware или физическом компьютере с помощью скрипта установщика PowerShell. [Этот метод](deploy-appliance-script.md) следует использовать, если не удается настроить виртуальную машину с помощью шаблона OVA или если вы используете Azure для государственных организаций.

После создания модуля убедитесь, что он может подключиться к средству оценки серверов службы "Миграция Azure", выполните его первоначальную настройку и зарегистрируйте в проекте службы "Миграция Azure".


## <a name="appliance-deployment-ova"></a>Развертывание устройства (OVA)

Чтобы настроить устройство с помощью шаблона OVA, сделайте следующее:
- Укажите имя устройства и создайте ключ проекта "миграция Azure" на портале.
- Скачайте файл шаблона OVA и импортируйте его в vCenter Server.
- Создайте устройство и убедитесь, что оно может подключиться к средству оценки сервера в службе "Миграция Azure".
- Настройте устройство в первый раз и зарегистрируйте его в проекте службы "миграция Azure" с помощью ключа проекта "миграция Azure".

### <a name="generate-the-azure-migrate-project-key"></a>Создание ключа проекта службы "Миграция Azure"

1. Последовательно выберите разделы **Цели миграции** > **Серверы** > **Azure Migrate: оценка серверов** и щелкните **Обнаружить**.
2. В разделе **Обнаружение компьютеров** > **Ваши компьютеры виртуализированы?** щелкните **Да, с использованием VMware vSphere Hypervisor**.
3. В разделе **1:Generate Azure Migrate project key** (1. Создание ключа проекта службы "Миграция Azure") укажите имя виртуального модуля Миграции Azure, которое вы настроите для обнаружения виртуальных машин VMware. Оно должно состоять из букв и цифр (не более 14 символов).
1. Щелкните **Создать ключ**, чтобы начать создание необходимых ресурсов Azure. Не закрывайте страницу "Обнаружение компьютеров" во время создания ресурсов.
1. После успешного создания ресурсов Azure будет создан **ключ проекта службы "Миграция Azure"** .
1. Скопируйте этот ключ, так как он понадобится вам для завершения регистрации модуля во время его настройки.

### <a name="download-the-ova-template"></a>Скачивание шаблона OVA
В разделе **2: Download Azure Migrate appliance** (2. Скачивание виртуального модуля службы "Миграция Azure") выберите OVA-файл и щелкните **Загрузка**. 


   ![Выделенные фрагменты области "Обнаружение компьютеров"](./media/tutorial-assess-vmware/servers-discover.png)


   ![Выделенный фрагмент области создания ключа](./media/tutorial-assess-vmware/generate-key-vmware.png)

### <a name="verify-security"></a>Проверка безопасности

Прежде чем развертывать OVA-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш для OVA:
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример использования: ```C:\>C:\>CertUtil -HashFile C:\Users\Administrator\Desktop\MicrosoftAzureMigration.ova SHA256```
3. Для последней версии устройства созданный хэш должен соответствовать этим [параметрам](./tutorial-assess-vmware.md#verify-security).



## <a name="create-the-appliance-vm"></a>Создание виртуальной машины устройства

Импортируйте скачанный файл и создайте виртуальную машину.

1. В консоли клиента vSphere щелкните **файл**  >  **развернуть шаблон OVF**.
![Команда меню для развертывания шаблона OVF](./media/tutorial-assess-vmware/deploy-ovf.png)

2. В мастере развертывания шаблона OVF выберите **Source** (Источник) и укажите расположение OVA-файла.
3. В полях **Name** (Имя) и **Location** (Расположение) укажите понятное имя для виртуальной машины. Выберите объект инвентаризации, в котором будет размещена эта виртуальная машина.
5. В поле **Host/Cluster** (Узел или кластер) укажите узел или кластер, в котором будет работать виртуальная машина.
6. В поле **Storage** (Хранилище) укажите место хранения данных виртуальной машины.
7. В поле **Disk Format** (Формат диска) укажите тип и размер диска.
8. В поле **Сетевое сопоставление**укажите сеть, к которой будет подключаться виртуальная машина. Этой сети требуется подключение к Интернету для отправки метаданных в средство "Оценка серверов" службы "Миграция Azure".
9. Просмотрите и подтвердите параметры, а затем нажмите кнопку **Finish** (Готово).


## <a name="verify-appliance-access-to-azure"></a>Проверка доступа устройства к Azure

Убедитесь, что виртуальная машина устройства может подключиться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака и облака для [государственных организаций](migrate-appliance.md#government-cloud-urls).


### <a name="configure-the-appliance"></a>Настройка устройства

Настройте устройство в первый раз.

> [!NOTE]
> Если вы настраиваете модуль с помощью [сценария PowerShell](deploy-appliance-script.md), а не загруженного шаблона OVA, первые два этапа этой процедуры выполнять не нужно.

1. В консоли клиента vSphere щелкните правой кнопкой мыши виртуальную машину и выберите **Open Console** (Открыть консоль).
2. Укажите язык, часовой пояс и пароль для устройства.
3. Откройте браузер на любом компьютере, который может подключиться к виртуальной машине, и откройте URL-адрес веб-приложения устройства: **https://*имя устройства или IP-адрес*: 44368**.

   Кроме того, вы можете открыть приложение с рабочего стола устройства, щелкнув ярлык приложения.
1. Примите **условия лицензии** и прочитайте информацию от сторонних производителей.
1. В веб-приложении выберите **Настройка необходимых компонентов** и выполните приведенные ниже действия.
   - **Возможность подключения**: приложение проверит наличие доступа к Интернету у виртуальной машины. Если виртуальная машина использует прокси, выполните приведенные ниже действия.
     - Щелкните **Настройка прокси-сервера**, чтобы указать адрес прокси-сервера (в формате http://ProxyIPAddress или http://ProxyFQDN) ) и порт прослушивания.
     - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
     - Поддерживается только прокси-сервер HTTP.
     - Если вы добавили сведения о прокси-сервере или отключили его и (или) проверку подлинности, щелкните **Сохранить**, чтобы снова запустить проверку подключения.
   - **Синхронизация времени**: Время на устройстве должно быть синхронизировано со временем в Интернете, чтобы обнаружение виртуальных машин работало правильно.
   - **Установка обновлений**: Устройство обеспечивает установку последних обновлений. После завершения проверки вы можете щелкнуть пункт **View appliance services** (Просмотр служб модуля), чтобы просмотреть состояние и версии компонентов, используемых модулем.
   - **Установка VDDK**. Устройство проверяет, установлен ли пакет VMware vSphere Virtual Disk Development Kit (VDDK). Если он не установлен, скачайте VDDK 6.7 из VMware и извлеките скачанное содержимое ZIP-файла в указанное расположение в виртуальном модуле, как указано в **инструкциях по установке**.

     Средство миграции серверов службы "Миграция Azure" использует VDDK для репликации компьютеров во время миграции на Azure. 
1. При необходимости вы можете **повторить проверку предварительных требований** в любой момент во время настройки модуля, чтобы проверить, соответствует ли виртуальный модуль всем предварительным требованиям.

### <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Вставьте **ключ проекта службы "Миграция Azure"** , скопированный с портала. Если у вас нет ключа, последовательно выберите **Server Assessment > Discover > Manage existing appliances** (Оценка сервера > Обнаружение > Управление имеющимися модулями), выберите имя модуля, указанное вами во время создания ключа, и скопируйте соответствующий ключ.
1. Щелкните **Войти**. На новой вкладке браузера откроется окно входа в Azure. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.
1. В новой вкладке выполните вход, используя имя пользователя и пароль Azure.
   
   Вход с помощью PIN-кода не поддерживается.
3. После входа вернитесь к веб-приложению. 
4. Если учетная запись пользователя Azure, используемая для ведения журнала, имеет необходимые [разрешения](tutorial-prepare-vmware.md#prepare-azure) на ресурсы Azure, созданные во время создания ключа, будет инициирована регистрация модуля.
1. После регистрации модуля вы можете просмотреть сведения о регистрации, щелкнув **Просмотреть подробности**.


## <a name="start-continuous-discovery"></a>Запуск непрерывного обнаружения

Устройство должно подключиться к vCenter Server для обнаружения конфигурации и данных о производительности виртуальных машин.

1. В разделе **Шаг 1. Provide vCenter Server credentials** (Предоставление учетных данных vCenter Server) щелкните **Добавить учетные данные**, чтобы указать понятное имя для учетных данных, добавьте значения для пунктов **Имя пользователя** и **Пароль** для учетной записи vCenter Server, которую виртуальный модуль будет использовать для обнаружения виртуальных машин в экземпляре vCenter Server.
    - У вас должна быть учетная запись, настроенная с необходимыми разрешениями согласно инструкциям в [предыдущем руководстве](tutorial-prepare-vmware.md#set-up-permissions-for-assessment).
    - Чтобы включить в область обнаружения только определенные объекты VMware (центры обработки данных vCenter Server, кластеры, папку кластеров, узлы, папку узлов или отдельные виртуальные машины), ознакомьтесь с [этой статьей](set-discovery-scope.md), в которой приведены инструкции по применению ограничений для используемой службой "Миграция Azure" учетной записи.
1. На **шаге 2 Provide vCenter Server details** (Предоставление сведений о vCenter Server) щелкните **Add discovery source** (Добавить источник обнаружения), чтобы выбрать из раскрывающегося списка понятное имя учетных данных, и укажите **IP-адрес или полное доменное имя** экземпляра vCenter Server. Вы можете оставить для пункта **Порт** значение по умолчанию (443) или указать пользовательский порт, на котором vCenter Server ожидает передачу данных, и щелкнуть **Сохранить**.
1. При нажатии кнопки "Сохранить" виртуальный модуль попытается проверить подключение к vCenter Server с указанными учетными данными и отобразит **состояние проверки** в таблице для каждого IP-адреса или полного доменного имени vCenter Server.
1. Вы можете **повторно проверить** подключение к vCenter Server в любое время перед началом обнаружения.
1. На **шаге 3 Provide VM credentials to discover installed applications and to perform agentless dependency mapping** (Предоставление учетных данных виртуальной машины для обнаружения установленных приложений и выполнения сопоставления зависимостей без агента) щелкните **Добавить учетные данные** и укажите операционную систему, для которой предоставляются учетные данные, понятное имя учетных данных и значения для пунктов **Имя пользователя** и **Пароль**. Затем нажмите кнопку **Сохранить**.

    - При необходимости можете добавить учетные данные, если вы создали учетную запись, которая будет использоваться для [функции обнаружения приложений](how-to-discover-applications.md) или [функции анализа зависимостей без агента](how-to-create-group-machine-dependencies-agentless.md).
    - Если вы не хотите использовать эти функции, щелкните ползунок, чтобы пропустить этот шаг. Вы можете изменить свое намерение в любое время.
    - Проверьте учетные данные, необходимые для [обнаружения приложений](migrate-support-matrix-vmware.md#application-discovery-requirements) или для [анализа зависимостей без агента](migrate-support-matrix-vmware.md#dependency-analysis-requirements-agentless).

5. Щелкните **Начать обнаружение**, чтобы запустить обнаружение виртуальных машин. После успешного запуска обнаружения вы можете проверить состояние обнаружения для IP-адреса или полного доменного имени vCenter Server в таблице.

Обнаружение выполняется следующим образом:
- Чтобы метаданные обнаруженных виртуальных машин отобразились на портале, потребуется около 15 минут.
- Обнаружение установленных приложений, ролей и компонентов занимает некоторое время, которое зависит от числа обнаруженных виртуальных машин. Для отображения приложений на 500 виртуальных машинах на портале службы "Миграция Azure" потребуется примерно один час.

## <a name="next-steps"></a>Следующие шаги

Ознакомьтесь с учебниками по [оценке VMware](tutorial-assess-vmware.md) и [миграции без агента](tutorial-migrate-vmware.md).
