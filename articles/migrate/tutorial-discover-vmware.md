---
title: Обнаружение виртуальных машин VMware с помощью средства оценки серверов службы "Миграция Azure"
description: Узнайте, как обнаружить локальные виртуальные машины VMware с помощью средства оценки сервера службы "Миграция Azure".
ms.topic: tutorial
ms.date: 09/14/2020
ms.custom: mvc
ms.openlocfilehash: f39ad3cbc357575f735b963346c8a8b0cc95e7c8
ms.sourcegitcommit: 3792cf7efc12e357f0e3b65638ea7673651db6e1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91442228"
---
# <a name="tutorial-discover-vmware-vms-with-server-assessment"></a>Руководство по обнаружению виртуальных машин VMware с помощью средства оценки серверов

В процессе переноса в Azure вы обнаружите локальные данные инвентаризации и рабочие нагрузки. 

В этом руководстве показано, как обнаружить локальные виртуальные машины VMware с помощью средства оценки серверов Миграции Azure, используя упрощенное устройство Миграции Azure. Вы развертываете устройство в виде виртуальной машины VMware, чтобы на постоянной основе обнаруживать метаданные виртуальной машины и производительности, приложения, которые работают на виртуальных машинах, и зависимости виртуальной машины.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Настройка учетной записи Azure.
> * Подготовка среды VMware к обнаружению.
> * Создайте проект службы "Миграция Azure".
> * Настройка устройства службы "Миграция Azure".
> * Запуск непрерывного обнаружения.

> [!NOTE]
> В учебниках показан самый быстрый способ выполнения сценария и используются параметры по умолчанию, где это возможно.  

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.


## <a name="prerequisites"></a>Предварительные требования

Перед началом работы с этим учебником проверьте наличие необходимых компонентов.


**Требование** | **Сведения**
--- | ---
**vCenter Server или узел ESXi** | Вам потребуется сервер vCenter Server версии 5.5, 6.0, 6.5 или 6.7.<br/><br/> Виртуальные машины следует разместить на узле ESXi версии 5.5 или более поздней.<br/><br/> Разрешите входящие подключения через TCP-порт 443 на сервере vCenter Server, чтобы с помощью устройства собирать данные оценки.<br/><br/> По умолчанию устройство подключается к vCenter через порт 443. Если vCenter Server ожидает передачи данных через другой порт, вы сможете изменить порт при подключении устройства к серверу для запуска обнаружения.<br/><br/> Убедитесь, что на сервере EXSi, на котором размещены виртуальные машины, разрешен входящий доступ на TCP-порт 443 для обнаружения приложений.
**Устройство** | Чтобы выделить ВМ для устройства службы "Миграция Azure", серверу vCenter Server понадобятся такие ресурсы:<br/><br/> — Windows Server 2016<br/><br/> — 32 ГБ ОЗУ, восемь виртуальных ЦП и около 80 ГБ дисковой памяти.<br/><br/> — Внешний виртуальный коммутатор и доступ к Интернету для виртуальной машины (напрямую или через прокси-сервер).
**Виртуальные машины** | Для целей этого руководства запустите виртуальные машины под управлением Windows Server 2016, 2012 R2, 2012 или 2008 R2.<br/><br/> Виртуальные машины Linux должны работать под управлением Red Hat Enterprise Linux 7/6/5, Ubuntu Linux 14.04/16.04, Debian 7/8, Oracle Linux 6/7 или CentOS 5/6/7.<br/><br/> Для виртуальных машин нужно установить и запустить средства VMware (версии более поздней, чем 10.2.0).<br/><br/> На виртуальных машинах Windows установите Windows PowerShell версии 2.0 или более поздней.


## <a name="prepare-an-azure-user-account"></a>Подготовка учетной записи пользователя Azure

Чтобы создать проект службы "Миграция Azure" и зарегистрировать устройство Миграции Azure, вам понадобится учетная запись с:
- разрешениями участника или владельца в подписке Azure;
- разрешениями на регистрацию приложений Azure Active Directory.

Если вы создали бесплатную учетную запись Azure, вы являетесь владельцем подписки. Если вы не являетесь владельцем подписки, назначьте разрешения совместно с владельцем следующим образом:

1. На портале Azure выполните поиск по фразе "подписки" и в разделе **Службы** выберите **Подписки**.

    ![Поле для поиска подписки Azure](./media/tutorial-discover-vmware/search-subscription.png)

2. На странице **Подписки** выберите подписку, в которой нужно создать проект службы "Миграция Azure". 
3. На странице подписок последовательно выберите **Управление доступом (IAM)**  > **Проверить доступ**.
4. В разделе **Проверка доступа** найдите соответствующую учетную запись пользователя.
5. В разделе **Добавление назначения роли** щелкните **Добавить**.

    ![Поиск учетной записи пользователя для проверки доступа и назначения роли](./media/tutorial-discover-vmware/azure-account-access.png)

6. В разделе **Добавление назначения роли** выберите роль "Участник" или "Владелец", а затем — учетную запись (в нашем примере — azmigrateuser). Затем нажмите кнопку **Сохранить**.

    ![Открытие страницы "Добавить назначение ролей" для назначения роли учетной записи](./media/tutorial-discover-vmware/assign-role.png)

7. Найдите пользователей на портале и в разделе **Службы** выберите **Пользователи**.
8. В разделе **Параметры пользователя** проверьте, смогут ли пользователи Azure AD регистрировать приложения (по умолчанию задано значение **Да**).

    ![Проверка того, могут ли пользователи регистрировать приложения Active Directory в разделе "Параметры пользователя"](./media/tutorial-discover-vmware/register-apps.png)

9. Кроме того, администратор клиента и глобальный администратор могут назначить учетной записи роль **Разработчик приложений**, позволяющую регистрировать приложения Azure AD. [Подробнее](../active-directory/fundamentals/active-directory-users-assign-role-azure-portal.md).

## <a name="prepare-vmware"></a>Подготовка VMware

Создайте на сервере vCenter Server учетную запись, которую устройство сможет использовать для доступа к vCenter Server, и убедитесь, что нужные порты открыты. Вам также понадобится учетная запись, которую устройство сможет использовать для доступа к виртуальным машинам. 

### <a name="create-an-account-to-access-vcenter"></a>Создание учетной записи для доступа к vCenter

Настройте учетную запись в веб-клиенте vSphere следующим образом:

1. Используя учетную запись с правами администратора, перейдите в веб-клиент vSphere и выберите **Администрирование**.
2. В разделе **Доступ** выберите **SSO Users and Groups** (Единый вход для пользователей и групп).
3. В разделе **Пользователи** добавьте нового пользователя.
4. В разделе **Новый пользователь** введите сведения об учетной записи. Нажмите кнопку **ОК**.
5. В разделе **Глобальные разрешения** выберите учетную запись пользователя и назначьте для нее роль **Только для чтения**. Нажмите кнопку **ОК**.
6. В разделе **Роли** > выберите **Только для чтения**, а в разделе **Права доступа** — **Guest Operations** (Гостевые операции). Эти разрешения необходимы для обнаружения приложений, работающих на виртуальных машинах, и для анализа зависимостей виртуальной машины.
 
    ![Установка флажка, чтобы разрешить гостевые операции для роли "Только для чтения"](./media/tutorial-discover-vmware/guest-operations.png)


### <a name="create-an-account-to-access-vms"></a>Создание учетной записи для доступа к виртуальным машинам

Устройство получает доступ к виртуальным машинам для обнаружения приложений и анализа зависимостей виртуальной машины. Агенты на виртуальных машинах не устанавливаются с помощью устройства.

1. Создайте учетную запись локального администратора, которую устройство сможет использовать для обнаружения приложений и зависимостей на виртуальных машинах Windows.
2. Для компьютеров Linux создайте учетную запись пользователя с привилегиями Root или учетную запись пользователя с такими разрешениями для файлов /bin/netstat и /bin/ls: CAP_DAC_READ_SEARCH и CAP_SYS_PTRACE.

> [!NOTE]
> Служба "Миграция Azure" поддерживает один набор учетных данных для обнаружения приложений на всех серверах Windows и один — на компьютерах Linux.


## <a name="set-up-a-project"></a>Настройка проекта

Настройте новый проект службы "Миграция Azure".

1. На портал Azure выберите **Все службы** и найдите службу **Миграция Azure**.
2. В разделе **Службы** выберите **Миграция Azure**.
3. В разделе **Обзор** выберите **Создать проект**.
5. В разделе **Создать проект** выберите подписку Azure и группу ресурсов. Если у вас еще нет группы ресурсов, создайте ее.
6. В разделе **Сведения о проекте** укажите имя проекта и регион для создания проекта. Просмотрите список поддерживаемых регионов для [общедоступного](migrate-support-matrix.md#supported-geographies-public-cloud) облака и облака для [государственных организаций](migrate-support-matrix.md#supported-geographies-azure-government).

   ![Поля для имени и региона проекта](./media/tutorial-discover-vmware/new-project.png)

7. Нажмите кнопку **создания**.
8. Развертывание проекта службы "Миграция Azure" может занять несколько минут.

**Средство оценки серверов: службы "Миграция Azure"** добавляется по умолчанию в новый проект.

![Страница с изображением средства оценки серверов, добавленного по умолчанию](./media/tutorial-discover-vmware/added-tool.png)


## <a name="set-up-the-appliance"></a>Настройка устройства

Чтобы настроить устройство с помощью шаблона OVA, сделайте следующее:
- Укажите имя устройства и создайте ключ проекта службы "Миграция Azure" на портале.
- Скачайте файл шаблона OVA и импортируйте его в vCenter Server.
- Создайте устройство и убедитесь, что оно может подключиться к средству оценки сервера в службе "Миграция Azure".
- Настройте устройство в первый раз и зарегистрируйте его в проекте Миграции Azure с помощью ключа проекта службы "Миграция Azure".

> [!NOTE]
> Если по какой-либо причине вы не можете настроить устройство с помощью шаблона, настройте его с помощью сценария PowerShell. [Подробнее](deploy-appliance-script.md#set-up-the-appliance-for-vmware).


### <a name="deploy-with-ova"></a>Развертывание с помощью OVA

Чтобы настроить устройство с помощью шаблона OVA, сделайте следующее:
- Укажите имя устройства и создайте ключ проекта службы "Миграция Azure" на портале.
- Скачайте файл шаблона OVA и импортируйте его в vCenter Server.
- Создайте устройство и убедитесь, что оно может подключиться к средству оценки сервера в службе "Миграция Azure".
- Настройте устройство в первый раз и зарегистрируйте его в проекте Миграции Azure с помощью ключа проекта службы "Миграция Azure".

### <a name="generate-the-azure-migrate-project-key"></a>Создание ключа проекта службы "Миграция Azure"

1. Последовательно выберите разделы **Цели миграции** > **Серверы** > **Azure Migrate: оценка серверов** и щелкните **Обнаружить**.
2. В разделе **Обнаружение компьютеров** > **Ваши компьютеры виртуализированы?** щелкните **Да, с использованием VMware vSphere Hypervisor**.
3. В разделе **1:Generate Azure Migrate project key** (1. Создание ключа проекта службы "Миграция Azure") укажите имя виртуального модуля Миграции Azure, которое вы настроите для обнаружения виртуальных машин VMware. Оно должно состоять из букв и цифр (не более 14 символов).
1. Щелкните **Создать ключ**, чтобы начать создание необходимых ресурсов Azure. Не закрывайте страницу "Обнаружение компьютеров" во время создания ресурсов.
1. После успешного создания ресурсов Azure будет создан **ключ проекта службы "Миграция Azure"** .
1. Скопируйте этот ключ, так как он понадобится вам для завершения регистрации модуля во время его настройки.

### <a name="download-the-ova-template"></a>Скачивание шаблона OVA

В разделе **2: Download Azure Migrate appliance** (2. Скачивание виртуального модуля службы "Миграция Azure") выберите OVA-файл и щелкните **Загрузка**. 


### <a name="verify-security"></a>Проверка безопасности

Прежде чем развертывать OVA-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш OVA-файла.
  
   ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
   
   Пример использования: ```C:\>CertUtil -HashFile C:\Users\Administrator\Desktop\MicrosoftAzureMigration.ova SHA256```

3. Проверьте последние версии и хэш-значения устройств:

    - Для общедоступного облака Azure:
    
        **Алгоритм** | **Загрузить** | **SHA256**
        --- | --- | ---
        VMware (11,9 ГБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2140333) | bd5c19eec93a62d52cc507a6b7b408d07f33f92b7d39b8a1e3dfec4ec62830d7

    - Для Azure для государственных организаций:
    
        **Алгоритм** | **Загрузить** | **SHA256**
        --- | --- | ---
        VMware (85,8 МБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2140337) | 2daaa2a59302bf911e8ef195f8add7d7c8352de77a9af0b860e2a627979085ca




### <a name="create-the-appliance-vm"></a>Создание виртуальной машины устройства

Импортируйте скачанный файл и создайте виртуальную машину.

1. В консоли клиента vSphere щелкните **File** (Файл)  > **Deploy OVF Template** (Развернуть шаблон OVF).
2. В мастере развертывания шаблона OVF выберите **Source** (Источник) и укажите расположение OVA-файла.
3. В полях **Name** (Имя) и **Location** (Расположение) укажите понятное имя для виртуальной машины. Выберите объект инвентаризации, в котором будет размещена эта виртуальная машина.
5. В поле **Host/Cluster** (Узел или кластер) укажите узел или кластер, в котором будет работать виртуальная машина.
6. В поле **Storage** (Хранилище) укажите место хранения данных виртуальной машины.
7. В поле **Disk Format** (Формат диска) укажите тип и размер диска.
8. В поле **Network Mapping** (Сетевое сопоставление) укажите сеть, к которой будет подключена виртуальная машина. Этой сети требуется подключение к Интернету для отправки метаданных в средство "Оценка серверов" службы "Миграция Azure".
9. Просмотрите и подтвердите параметры, а затем нажмите кнопку **Finish** (Готово).


### <a name="verify-appliance-access-to-azure"></a>Проверка доступа устройства к Azure

Убедитесь, что виртуальная машина устройства может подключиться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака и облака для [государственных организаций](migrate-appliance.md#government-cloud-urls).


### <a name="configure-the-appliance"></a>Настройка устройства

Настройте устройство в первый раз.

> [!NOTE]
> Если вы настраиваете модуль с помощью [сценария PowerShell](deploy-appliance-script.md), а не загруженного шаблона OVA, первые два этапа этой процедуры выполнять не нужно.

1. В консоли клиента vSphere щелкните правой кнопкой мыши виртуальную машину и выберите **Open Console** (Открыть консоль).
2. Укажите язык, часовой пояс и пароль для устройства.
3. Откройте браузер на любом компьютере, который может подключиться к виртуальной машине, и откройте URL-адрес веб-приложения устройства: **https://*имя устройства или IP-адрес*: 44368**.

   Кроме того, вы можете открыть приложение с рабочего стола устройства, щелкнув ярлык приложения.
1. Примите **условия лицензии** и прочитайте информацию от сторонних производителей.
1. В веб-приложении выберите **Настройка необходимых компонентов** и выполните приведенные ниже действия.
   - **Возможность подключения**: приложение проверит наличие доступа к Интернету у виртуальной машины. Если виртуальная машина использует прокси, выполните приведенные ниже действия.
     - Щелкните **Настройка прокси-сервера**, чтобы указать адрес прокси-сервера (в формате http://ProxyIPAddress или http://ProxyFQDN) ) и порт прослушивания.
     - Укажите учетные данные, если для прокси-сервера требуется аутентификация.
     - Поддерживается только прокси-сервер HTTP.
     - Если вы добавили сведения о прокси-сервере или отключили его и (или) проверку подлинности, щелкните **Сохранить**, чтобы снова запустить проверку подключения.
   - **Синхронизация времени**: Время на устройстве должно быть синхронизировано со временем в Интернете, чтобы обнаружение виртуальных машин работало правильно.
   - **Установка обновлений**: Устройство обеспечивает установку последних обновлений. После завершения проверки вы можете щелкнуть пункт **View appliance services** (Просмотр служб модуля), чтобы просмотреть состояние и версии компонентов, используемых модулем.
   - **Установка VDDK**. Устройство проверяет, установлен ли пакет VMware vSphere Virtual Disk Development Kit (VDDK). Если он не установлен, скачайте VDDK 6.7 из VMware и извлеките скачанное содержимое ZIP-файла в указанное расположение в виртуальном модуле, как указано в **инструкциях по установке**.

     Средство миграции серверов службы "Миграция Azure" использует VDDK для репликации компьютеров во время миграции на Azure. 
1. При необходимости вы можете **повторить проверку предварительных требований** в любой момент во время настройки модуля, чтобы проверить, соответствует ли виртуальный модуль всем предварительным требованиям.

### <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Вставьте **ключ проекта службы "Миграция Azure"** , скопированный с портала. Если у вас нет ключа, последовательно выберите **Server Assessment > Discover > Manage existing appliances** (Оценка сервера > Обнаружение > Управление имеющимися модулями), выберите имя модуля, указанное вами во время создания ключа, и скопируйте соответствующий ключ.
1. Щелкните **Войти**. На новой вкладке браузера откроется окно входа в Azure. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.
1. В новой вкладке выполните вход, используя имя пользователя и пароль Azure.
   
   Вход с помощью PIN-кода не поддерживается.
3. После входа вернитесь к веб-приложению. 
4. Если учетная запись пользователя Azure, используемая для ведения журнала, имеет необходимые [разрешения](tutorial-prepare-vmware.md#prepare-azure) на ресурсы Azure, созданные во время создания ключа, будет инициирована регистрация модуля.
1. После регистрации модуля вы можете просмотреть сведения о регистрации, щелкнув **Просмотреть подробности**.



## <a name="start-continuous-discovery"></a>Запуск непрерывного обнаружения

Устройство должно подключиться к vCenter Server для обнаружения конфигурации и данных о производительности виртуальных машин.

1. В разделе **Шаг 1. Provide vCenter Server credentials** (Предоставление учетных данных vCenter Server) щелкните **Добавить учетные данные**, чтобы указать понятное имя для учетных данных, добавьте значения для пунктов **Имя пользователя** и **Пароль** для учетной записи vCenter Server, которую виртуальный модуль будет использовать для обнаружения виртуальных машин в экземпляре vCenter Server.
    - У вас должна быть учетная запись, настроенная с необходимыми разрешениями согласно инструкциям в [предыдущем руководстве](tutorial-prepare-vmware.md#set-up-permissions-for-assessment).
    - Чтобы включить в область обнаружения только определенные объекты VMware (центры обработки данных vCenter Server, кластеры, папку кластеров, узлы, папку узлов или отдельные виртуальные машины), ознакомьтесь с [этой статьей](set-discovery-scope.md), в которой приведены инструкции по применению ограничений для используемой службой "Миграция Azure" учетной записи.
1. На **шаге 2 Provide vCenter Server details** (Предоставление сведений о vCenter Server) щелкните **Add discovery source** (Добавить источник обнаружения), чтобы выбрать из раскрывающегося списка понятное имя учетных данных, и укажите **IP-адрес или полное доменное имя** экземпляра vCenter Server. Вы можете оставить для пункта **Порт** значение по умолчанию (443) или указать пользовательский порт, на котором vCenter Server ожидает передачу данных, и щелкнуть **Сохранить**.
1. При нажатии кнопки "Сохранить" виртуальный модуль попытается проверить подключение к vCenter Server с указанными учетными данными и отобразит **состояние проверки** в таблице для каждого IP-адреса или полного доменного имени vCenter Server.
1. Вы можете **повторно проверить** подключение к vCenter Server в любое время перед началом обнаружения.
1. На **шаге 3 Provide VM credentials to discover installed applications and to perform agentless dependency mapping** (Предоставление учетных данных виртуальной машины для обнаружения установленных приложений и выполнения сопоставления зависимостей без агента) щелкните **Добавить учетные данные** и укажите операционную систему, для которой предоставляются учетные данные, понятное имя учетных данных и значения для пунктов **Имя пользователя** и **Пароль**. Затем нажмите кнопку **Сохранить**.

    - При необходимости можете добавить учетные данные, если вы создали учетную запись, которая будет использоваться для [функции обнаружения приложений](how-to-discover-applications.md) или [функции анализа зависимостей без агента](how-to-create-group-machine-dependencies-agentless.md).
    - Если вы не хотите использовать эти функции, щелкните ползунок, чтобы пропустить этот шаг. Вы можете изменить свое намерение в любое время.
    - Проверьте учетные данные, необходимые для [обнаружения приложений](migrate-support-matrix-vmware.md#application-discovery-requirements) или для [анализа зависимостей без агента](migrate-support-matrix-vmware.md#dependency-analysis-requirements-agentless).

5. Щелкните **Начать обнаружение**, чтобы запустить обнаружение виртуальных машин. После успешного запуска обнаружения вы можете проверить состояние обнаружения для IP-адреса или полного доменного имени vCenter Server в таблице.

Обнаружение выполняется следующим образом:
- Чтобы метаданные обнаруженных виртуальных машин отобразились на портале, потребуется около 15 минут.
- Обнаружение установленных приложений, ролей и компонентов занимает некоторое время, которое зависит от числа обнаруженных виртуальных машин. Для отображения приложений на 500 виртуальных машинах на портале службы "Миграция Azure" потребуется примерно один час.


## <a name="next-steps"></a>Дальнейшие действия

- [Оцените готовность виртуальных машин VMware](tutorial-assess-vmware.md) к переносу на виртуальные машины Azure.
- [Просмотрите данные](migrate-appliance.md#collected-data---vmware), собранные устройством во время обнаружения.
