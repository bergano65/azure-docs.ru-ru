---
title: Как работает миграция Hyper-V в Azure?
description: Сведения о миграции Hyper-V с помощью службы "миграция Azure"
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 11/19/2019
ms.author: raynew
ms.openlocfilehash: 8bca88fc63a7fc04a22d2a68adbe59259b07f50e
ms.sourcegitcommit: dbde4aed5a3188d6b4244ff7220f2f75fce65ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/19/2019
ms.locfileid: "74185878"
---
# <a name="how-does-hyper-v-replication-work"></a>Как работает репликация Hyper-V?

В этой статье приводятся общие сведения об архитектуре и процессах, используемых при миграции виртуальных машин Hyper-V с помощью средства миграции сервера Azure Migration Server.

Служба [Миграция Azure](migrate-services-overview.md) объединяет в себе средства наблюдения за обнаружением, оценкой и миграцией локальных приложений и рабочих нагрузок, а также виртуальных машин частного или общедоступного облака в Azure. Эта служба предоставляет инструменты для оценки и миграции, а также предложения сторонних независимых поставщиков программного обеспечения (ISV).

## <a name="agentless-migration"></a>Миграция без агента

Средство миграции сервера Azure Migration Tool обеспечивает безагентную репликацию для локальных виртуальных машин Hyper-V с помощью рабочего процесса миграции, оптимизированного для Hyper-V. Агент программного обеспечения устанавливается только на узлах или узлах Hyper-V. На виртуальных машинах Hyper-V ничего устанавливать не нужно.

## <a name="server-migration-and-azure-site-recovery"></a>Миграция и Azure Site Recovery сервера

Миграция сервера в Azure — это средство для переноса локальных рабочих нагрузок и облачных виртуальных машин в Azure. Site Recovery — это средство аварийного восстановления. Средства совместно используют некоторые общие технологические компоненты, которые используются для репликации данных, но служат разным целям. 


## <a name="architectural-components"></a>Компоненты архитектуры

![Архитектура](./media/hyper-v-replication-architecture/architecture.png)



**Компонент** | **Развертывание** | 
--- | --- 
**Поставщик репликации** | Поставщик Microsoft Azure Site Recovery установлен на узлах Hyper-V и зарегистрирован в миграции сервера миграции Azure.<br/> Поставщик управляет репликацией для виртуальных машин Hyper-V.
**Агент служб восстановления** | Агент службы восстановления Microsoft Azure обрабатывает репликацию данных. Он работает с поставщиком для репликации данных с виртуальных машин Hyper-V в Azure.<br/> Реплицированные данные передаются в учетную запись хранения в подписке Azure. Средство миграции сервера обрабатывает реплицированные данные и применяет их к репликам дисков в подписке. Диски реплики используются для создания виртуальных машин Azure при миграции.

- Компоненты устанавливаются с помощью одного файла установки, скачанного из статьи Миграция миграции сервера Azure на портал.
- Поставщик и устройство используют исходящие подключения HTTPS порта 443 для взаимодействия с миграцией Azure Migration Server.
- Взаимодействие поставщика и агента обеспечивает безопасность и шифрование.


## <a name="replication-process"></a>Процесс репликации

1. При включении репликации для виртуальной машины Hyper-V начинается начальная репликация.
2. Создается моментальный снимок виртуальной машины Hyper-V.
3. Виртуальные жесткие диски на виртуальной машине реплицируются один за другим, пока все они не будут скопированы в Azure. Время начальной репликации зависит от размера виртуальной машины и пропускной способности сети.
4. Изменения диска, происходящие во время начальной репликации, отправляются с помощью реплики Hyper-V и хранятся в файлах журнала (HRL Files).
    - Файлы журнала находятся в той же папке, что и диски.
    - С каждым диском связан файл HRL, который отправляется в дополнительное хранилище.
    - При начальной репликации файлы моментальных снимков и журналов потребляют ресурсы диска.
4. После завершения начальной репликации моментальный снимок виртуальной машины удаляется, и начинается разностная репликация.
5. Добавочные изменения диска прописываются в HRL файлы. Журналы репликации периодически передаются Агенту служб восстановления в учетную запись хранения Azure.


## <a name="performance-and-scaling"></a>Производительность и масштабируемость

На производительность репликации для Hyper-V влияют факторы, включающие размер виртуальной машины, скорость изменения данных (обновление) виртуальных машин, доступное пространство на узле Hyper-V для хранения файлов журналов, пропускную способность передачи данных репликации и целевое хранилище в Azure.

- Если одновременно выполняется репликация нескольких компьютеров, используйте [планировщик развертывания Azure Site Recovery](../site-recovery/hyper-v-deployment-planner-overview.md) для Hyper-V, чтобы оптимизировать репликацию.
- Спланируйте репликацию Hyper-V и распределите репликацию по учетным записям хранения Azure в соответствии с емкостью.

### <a name="control-upload-throughput"></a>Управление пропускной способностью передачи

Можно ограничить объем пропускной способности, используемой для передачи данных в Azure на каждом узле Hyper-V. Будь осторожен. Если задать слишком низкое значение, это отрицательно повлияет на репликацию и отложить миграцию.


1. Войдите на узел или кластер узла Hyper-V.
2. Выполните команду **C:\Program Files\Microsoft Azure Recovery Services ажент\бин\вабадмин.МСК**, чтобы открыть оснастку Windows Azure Backup MMC.
3. В оснастке выберите **Change Properties** (Изменить свойства).
4. В окне **регулирования**выберите **включить регулирование использования полосы пропускания Интернета для операций резервного копирования**. Задайте ограничения для рабочего и нерабочего времени. Допустимы значения в диапазоне от 512 Кбит/с до 1,023 Мбит/с.
I

### <a name="influence-upload-efficiency"></a>Влияние на эффективность передачи

Если у вас есть запасная полоса пропускания для репликации и вы хотите увеличить нагрузку, можно увеличить число потоков, выделенных для задачи отправки, следующим образом:

1. Откройте реестр с помощью программы Regedit.
2. Перейдите к разделу Key HKEY_LOCAL_MACHINE \Софтваре\микрософт\виндовс Azure Баккуп\репликатион\уплоадсреадспервм
3. Увеличьте значение числа потоков, используемых для передачи данных для каждой реплицируемой виртуальной машины. Значение по умолчанию — 4, а максимальное значение — 32. 




## <a name="next-steps"></a>Дополнительная информация

Попробуйте выполнить [миграцию Hyper-V](tutorial-migrate-hyper-v.md) с помощью миграции сервера миграция Azure.
