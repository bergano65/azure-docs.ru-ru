---
title: Рекомендации по обеспечению безопасности рабочих нагрузок, перенесенных в Azure, и управлению ими | Документация Майкрософт
description: Выполнив миграцию в Azure, ознакомьтесь с рекомендациями по управлению перенесенными рабочими нагрузками и обеспечению их безопасности.
author: rayne-wiselman
manager: carmonm
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 12/08/2018
ms.author: raynew
ms.openlocfilehash: eaef1c904b5404339c476d86c5b8c2a1740e5a3e
ms.sourcegitcommit: a65b424bdfa019a42f36f1ce7eee9844e493f293
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2019
ms.locfileid: "55700083"
---
# <a name="best-practices-for-securing-and-managing-workloads-migrated-to-azure"></a>Рекомендации по обеспечению безопасности рабочих нагрузок, перенесенных в Azure, и управлению ими

Планируя и проектируя миграцию, помимо продумывания самой миграции, нужно учитывать модель безопасности и управления в Azure после миграции. В этой статье описано планирование и приведены рекомендации по защите развернутой службы Azure после миграции, а также по выполнению текущих задач для поддержания оптимального уровня работы развернутой службы. 

> [!IMPORTANT]
> Рекомендации и мнения, приведенные в этой статье, основаны на возможностях платформы Azure и служб, доступных на момент написания этого материала. Функции и возможности со временем меняются.

## <a name="secure-migrated-workloads"></a>Обеспечение безопасности перенесенных рабочих нагрузок

После миграции наиболее важной задачей является защита перенесенных рабочих нагрузок от внутренних и внешних угроз. Следующие рекомендации помогут в этом:

- [Работайте с Центром безопасности Azure.](#best-practice-follow-azure-security-center-recommendations) Узнайте, как использовать средства мониторинга и оценки, а также рекомендации, предоставляемые Центром безопасности Azure.
- [Шифруйте данные.](#best-practice-encrypt-data) Ознакомьтесь с рекомендациями по шифрованию данных в Azure.
- [Настройте антивредоносное ПО.](#best-practice-protect-vms-with-antimalware) Защитите виртуальные машины от вредоносных программ и атак злоумышленников.
- [Защитите веб-приложения Azure.](#best-practice-secure-web-apps) Поддерживайте безопасность конфиденциальной информации в перенесенных веб-приложениях.
- [Просмотрите подписки.](#best-practice-review-subscriptions-and-resource-permissions) Проверьте, у кого есть доступ к вашим подпискам Azure и ресурсам после миграции.
- [Работайте с журналами.](#best-practice-review-audit-and-security-logs) Регулярно просматривайте журналы аудита и безопасности Azure.
- [Просмотрите другие компоненты безопасности.](#best-practice-evaluate-other-security-features) Изучите и оцените расширенные функции безопасности, которые предоставляет Azure.

## <a name="best-practice-follow-azure-security-center-recommendations"></a>Рекомендация. Следуйте рекомендациям Центра безопасности Azure

Корпорация Майкрософт прилагает все усилия, чтобы у администраторов арендаторов Azure были необходимые сведения для включения функций безопасности, которые защищают рабочие нагрузки от атак.  Центр безопасности Azure обеспечивает унифицированное управление безопасностью. Из Центра безопасности можно применять политики безопасности для рабочих нагрузок, ограничить уязвимость перед угрозами, а также выявлять атаки и реагировать на них. Центр безопасности анализирует ресурсы и конфигурации всех арендаторов Azure и составляет рекомендации по обеспечению безопасности, включая следующее:

- **Централизованное управление политиками.** Обеспечьте соответствие стандартам компании или нормативным требованиям безопасности за счет централизованного управления политиками во всех гибридных облачных нагрузках.
- **Непрерывная оценка безопасности.** Мониторинг состояния безопасности компьютеров, сетей, систем хранения и служб обработки данных, а также приложений для обнаружения потенциальных проблем безопасности.
- **Практические рекомендации.** Устраняйте уязвимости в системе безопасности до того, как ими смогут воспользоваться злоумышленники, используя приоритетные практические рекомендации по безопасности.
- **Приоритетные оповещения и инциденты.** Сосредоточьтесь на важнейших угрозах, используя приоритетные средства оповещения и инциденты системы безопасности.

Помимо оценок и рекомендаций, Центр безопасности предоставляет ряд других функций безопасности, которые можно включить для определенных ресурсов.

- **JIT-доступ.** Уменьшите уязвимую зону с помощью управляемого JIT-доступа к портам управления на виртуальных машинах Azure.
    - Если открыть RDP-порт 3389 в Интернете на виртуальных машинах, они будут постоянно подвержены риску действий злоумышленников. IP-адреса Azure хорошо известны, и злоумышленники постоянно испытывают их атаками на открытые порты 3389. 
    - В режиме JIT-доступа используются группы безопасности сети (NSG) и правила для входящего трафика, ограничивающие временной интервал, в течение которого открыт конкретный порт.
    - При включенной функции JIT Центр безопасности проверяет наличие у пользователя выданных системой управления доступом на основе ролей (RBAC) разрешений доступа на запись для виртуальной машины. В дополнение укажите правила подключения пользователей к виртуальным машинам. При наличии необходимых разрешений запрос доступа утверждается. Центр безопасности настраивает группу безопасности сети, которая разрешает передачу входящего трафика на выбранные порты в течение указанного периода. По истечении этого периода группы безопасности сети возвращаются к предыдущим значениям.
- **Адаптивные элементы управления приложениями.** Поддерживайте защиту виртуальных машин от нежелательных и вредоносных программ, контролируя, какие приложения выполняются на виртуальных машинах. В этом поможет динамическое включение приложений в утвержденный список.
    - Адаптивные элементы управления приложениями позволяют включать приложения в утвержденный  список и предотвращать установку неконтролируемыми пользователями или администраторами неутвержденных или проверяемых приложений на виртуальных машинах.
    - Вы можете заблокировать попытки запуска вредоносных приложений или оповещать о таких попытках, избегать установки нежелательных или вредоносных приложений и обеспечить соответствие с политикой безопасности приложений своей организации.
- **Мониторинг целостности файлов.** Обеспечьте целостность файлов, запускаемых на виртуальных машинах.
    - Проблемы с виртуальными машинами могут возникнуть даже без установки программного обеспечения.  Причиной сбоя виртуальной машины или снижения ее производительности может стать и изменение системного файла.  Мониторинг целостности файлов позволяет проверить системные файлы и параметры реестра на наличие изменений. Если что-либо обновляется, вы получаете соответствующее уведомление.
    - Центр безопасности определяет файлы, для которых рекомендуется включить мониторинг.


**Дополнительные сведения:**

- [Дополнительные сведения](https://docs.microsoft.com/azure/security-center/security-center-intro) о Центре безопасности Azure.
- [Дополнительные сведения](https://docs.microsoft.com/azure/security-center/security-center-just-in-time) о преимуществах JIT-доступа к виртуальным машинам.
- [Дополнительные сведения](https://docs.microsoft.com/azure/security-center/security-center-adaptive-application) о применении адаптивных элементов управления приложениями.
- [Начало работы](https://docs.microsoft.com/azure/security-center/security-center-file-integrity-monitoring) с мониторингом целостности файлов.


## <a name="best-practice-encrypt-data"></a>Рекомендация. Шифрование данных 

Шифрование является важным элементом обеспечения безопасности Azure. Включение шифрования на всех уровнях помогает предотвратить доступ посторонних лиц к конфиденциальным данным, в том числе во время их передачи и хранения. 

### <a name="encryption-for-iaas"></a>Шифрование для IaaS

- **Виртуальные машины.** Для виртуальных машин можно использовать службу "Шифрование дисков Azure". Она позволяет зашифровать диски виртуальных машин IaaS под управлением Windows и Linux.
    - Служба "Шифрование дисков" обеспечивает шифрование томов для дисков операционной системы и данных с помощью BitLocker (для Windows) или DM-Crypt (для Linux).
    - Можно использовать ключ шифрования, созданный в Azure, или собственные ключи шифрования, размещаемые в защищенном хранилище Azure Key Vault. 
    - Служба "Шифрование дисков" обеспечивает безопасность данных виртуальных машин IaaS при хранении (на диске) и во время загрузки виртуальных машин. 
    - Центр безопасности Azure оповестит вас при наличии незашифрованных виртуальных машин.
- **Хранилище** Защитите данные, содержащиеся в хранилище Azure.
    - Данные в учетных записях хранения Azure можно зашифровать с помощью ключей AES, созданных корпорацией Майкрософт, которые имеют сертификат соответствия FIPS 140-2, или же с помощью собственных ключей.
    - Шифрование службы хранилища включено для всех новых и существующих учетных записей хранения. Эту функцию нельзя отключить.


### <a name="encryption-for-paas"></a>Шифрование для PaaS

В отличие от IaaS, где вы управляете собственными виртуальными машинами и инфраструктурой, в модели PaaS платформой и инфраструктурой управляет поставщик. Это позволяет вам сосредоточиться на основной логике и возможностях приложений. Учитывая большое количество типов служб PaaS, в целях безопасности каждая служба будет оцениваться по отдельности. Для примера давайте рассмотрим, как можно включить шифрование для Базы данных SQL Azure.

- **Always Encrypted.** Защищайте неактивные данные с помощью мастера Always Encrypted в среде SQL Server Management Studio.
    - Для шифрования данных в отдельных столбцах создается ключ Always Encrypted.
    - Ключи Always Encrypted можно хранить в зашифрованном виде в метаданных базы данных или в доверенных хранилищах ключей, например Azure Key Vault.
    - Чтобы использовать эту функцию, вероятно, потребуется внести изменения в приложения.
- **Прозрачное шифрование данных (TDE).** Защитите Базу данных SQL Azure с помощью шифрования и дешифрования в реальном времени базы данных, связанных с ней резервных копий и файлов журнала транзакций в неактивном состоянии.
    - TDE позволяет выполнять операции шифрования без изменений на уровне приложений.
    - При применении TDE можно использовать ключи шифрования, предоставляемые корпорацией Майкрософт, или предоставить собственные ключи, используя поддержку создания собственных ключей.


**Дополнительные сведения:**
- [Дополнительные сведения](https://docs.microsoft.com/azure/security/azure-security-disk-encryption-overview) о службе "Шифрование дисков Azure" для виртуальных машин IaaS.
- [Включение](https://docs.microsoft.com/azure/security/azure-security-disk-encryption-windows) шифрования для виртуальных машин IaaS под управлением Windows.
- [Дополнительные сведения](https://docs.microsoft.com/azure/storage/common/storage-service-encryption) о включении Шифрования службы хранилища Azure для неактивных данных.
- [Обзор](https://docs.microsoft.com/azure/sql-database/sql-database-always-encrypted-azure-key-vault) функции Always Encrypted.
- [Сведения](https://docs.microsoft.com/azure/sql-database/transparent-data-encryption-azure-sql?view=sql-server-2017) о TDE для Базы данных SQL Azure.
- [Сведения](https://docs.microsoft.com/azure/sql-database/transparent-data-encryption-byok-azure-sql) о TDE с созданием собственных ключей.

## <a name="best-practice-protect-vms-with-antimalware"></a>Рекомендация. Защитите виртуальные машины с помощью антивредоносного ПО

В частности, на старых перенесенных виртуальных машинах Azure может быть не установлено антивредоносное ПО соответствующего уровня.  Azure предоставляет бесплатное решение для конечных точек, которое помогает защитить виртуальные машины от вирусов, шпионских и других вредоносных программ.
- Антивредоносное ПО Майкрософт для Azure создает предупреждения о попытках установки известных вредоносных или нежелательных программ.
- Это решение с одним агентом, которое выполняется в фоновом режиме без вмешательства человека.
- В Центре безопасности Azure можно легко определить виртуальные машины, на которых не запущена защита конечных точек, и при необходимости установить антивредоносное ПО Майкрософт.

![Антивредоносное ПО для виртуальных машин](./media/migrate-best-practices-security-management/antimalware.png)
*Antimalware for VMs*

**Дополнительные сведения:**

- [Дополнительные сведения](https://docs.microsoft.com/azure/security/azure-security-antimalware) об антивредоносном ПО Майкрософт.

## <a name="best-practice-secure-web-apps"></a>Рекомендация. Защитите веб-приложения

После переноса веб-приложений возникает несколько проблем:

- В большинстве устаревших веб-приложений конфиденциальные сведения хранятся в файлах конфигурации.  Файлы, содержащие такие сведения, могут стать источником проблем с безопасностью при резервном копировании приложений, а также при операциях с кодом приложения в системе управления версиями.
- Кроме того, при переносе веб-приложений, размещенных на виртуальной машине, как правило, эта машина перемещается из локальной сети и среды, защищенной брандмауэром, в среду с выходом в Интернет. Необходимо убедиться в том, что настроено решение, которое работает аналогично локальным средствам защиты ресурсов.


Azure предоставляет несколько решений:

- **Azure Key Vault.** Сегодня разработчики веб-приложений разрабатывают средства для предотвращения утечки конфиденциальной информации из таких файлов. Один из способов защиты данных — извлечь их из файлов и поместить в хранилище Azure Key Vault.
    - С помощью этого хранилища можно централизовать хранение секретов приложений и контролировать их распространение. Решение устраняет необходимость хранить сведения о безопасности в файлах приложения.
    - Приложения получают безопасный доступ к данным в хранилище с использованием URI. Пользовательский код не требуется.
    - Azure Key Vault позволяет блокировать доступ с помощью средств безопасности Azure и беспрепятственно реализовывать смену ключей. У корпорации Майкрософт нет возможности просмотра и извлечения ваших данных.
- **Функция "Среда службы приложений".** Если для переносимого приложения нужна дополнительная защита, рекомендуем добавить функцию "Среда службы приложений" и брандмауэр веб-приложений для защиты ресурсов приложения.
    - Функция "Среда службы приложений Azure" обеспечивает полностью изолированную и выделенную среду для запуска приложений Службы приложений, таких как веб-приложения Windows и Linux, контейнеры Docker, мобильные приложения и функции.
    - Это полезно для приложений, обладающих очень большим масштабом, требующих изоляции и защищенного сетевого доступа или характеризующихся высоким уровнем использования памяти
- **Брандмауэр веб-приложений.** Функция Шлюза приложений, обеспечивающая централизованную защиту веб-приложений.
    - Она защищает веб-приложения, не требуя каких-либо изменений кода серверной части.
    - Обеспечивается одновременная защита нескольких веб-приложений за шлюзом приложений.
    - Брандмауэр веб-приложений можно отслеживать с помощью Azure Monitor. Также он интегрирован в Центр безопасности Azure.



![Защита веб-приложений](./media/migrate-best-practices-security-management/web-apps.png)
*Azure Key Vault*

**Дополнительные сведения:**

- [Обзор](https://docs.microsoft.com/azure/key-vault/key-vault-overview) хранилища Azure Key Vault.
- [Сведения](https://docs.microsoft.com/azure/application-gateway/waf-overview) о брандмауэре веб-приложений.
- [Общие сведения](https://docs.microsoft.com/azure/app-service/environment/intro) о функции "Среда службы приложений".
- [Сведения](https://docs.microsoft.com/azure/key-vault/tutorial-web-application-keyvault) о настройке веб-приложения для чтения секретов из Azure Key Vault.
- [Сведения](https://docs.microsoft.com/azure/application-gateway/waf-overview) о брандмауэре веб-приложений.

## <a name="best-practice-review-subscriptions-and-resource-permissions"></a>Рекомендация. Рассмотрите подписки и разрешения на ресурсы

Перенос рабочих нагрузок и их запуск в Azure затрагивает множество сотрудников с доступом к рабочим нагрузкам. Вашей группе безопасности следует регулярно проверять доступ к вашему арендатору и группам ресурсов Azure. Azure предоставляет ряд предложений для управления удостоверениями и контроля доступа, включая управление доступом на основе ролей (RBAC) для авторизации разрешений на доступа к ресурсам Azure.

- RBAC назначает разрешения на доступ субъектам безопасности. Субъекты безопасности представляют собой пользователей, группы (набор пользователей), субъекты-службы (удостоверение, используемое приложениями и службами) и управляемые удостоверения (удостоверение Azure Active Directory, автоматически управляемое Azure).
- RBAC может назначать роли субъектам безопасности, таким как владелец, участник и читатель, а также определения ролей (набор разрешений), определяющие операции, поддерживаемые соответствующими ролями.
- RBAC также может задавать области, устанавливающие границы для той или иной роли. Область можно задать в виде количества уровней, включая группу управления, подписку, группу ресурсов или ресурс.
- Убедитесь, что администраторы с доступом к Azure могут работать только с теми ресурсами, к которым вы разрешаете доступ.  Если предопределенные роли в Azure недостаточно детализированы, можно создать настраиваемые роли для разделения и ограничения разрешений на доступ.

![Управление доступом](./media/migrate-best-practices-security-management/subscription.png)
*Управление доступом — IAM*

**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/role-based-access-control/overview) о RBAC.
- [Сведения](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal) об управлении доступом с помощью RBAC и портала Azure.
- [Сведения](https://docs.microsoft.com/azure/role-based-access-control/custom-roles) о настраиваемых ролях.

## <a name="best-practice-review-audit-and-security-logs"></a>Рекомендация. Просматривайте журналы аудита и безопасности

Azure Active Directory (AD) предоставляет журналы действий, которые отображаются в Azure Monitor. В журналы записываются сведения об операциях, выполняемых в рамках аренды Azure, и пользователе, который их проводил, а также время выполнения таких операций. 

- В журналах аудита содержится история задач по арендатору. В журналах действий входа отображаются сведения о том, кто выполнял задачи. 
- Доступ к отчетам безопасности зависит от лицензии Azure AD. В ценовой категории "Бесплатный" и "Базовый" вы получаете список пользователей, выполнявших рискованные действия, и рискованных операциях входа в систему. В выпусках "Премиум 1" и "Премиум 2" предоставляются сведения о базовом событии.
- Журналы действий можно направить на ряд конечных точек для долгосрочного хранения и анализа данных.
- Регулярно просматривайте журналы или интегрируйте средства управления информационной безопасностью и событиями безопасности (SIEM) для автоматического анализа аномалий.  Если вы не используете выпуск "Премиум 1" или "Премиум 2", вам потребуется выполнять значительный объем анализа самостоятельно или с помощью системы SIEM.  Анализ включает в себя поиск рискованных действий входа и событий, а также других шаблонов атак пользователей.


![Пользователи и группы](./media/migrate-best-practices-security-management/azure-ad.png)
*Пользователи и группы Azure AD*

**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-activity-logs-azure-monitor) о журналах действий Azure AD в Azure Monitor.
- [Сведения о том, как](https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-audit-logs) проводить аудит отчетов о действиях на портале Azure AD.

## <a name="best-practice-evaluate-other-security-features"></a>Рекомендация. Рассмотрите другие компоненты безопасности

Azure предоставляет ряд других защитных средств с расширенными возможностями обеспечения безопасности. Некоторые из этих рекомендаций требуют дополнительных лицензий и услуг уровня "Премиум".

- **Реализуйте административные единицы Azure AD (AU).** Делегирование административных обязанностей персоналу службы поддержки может быть непростой задачей, если используются только базовые средства управления доступом в Azure.  Предоставить персоналу службы поддержки доступ к администрированию групп в Azure AD — не самый идеальный метод обеспечения безопасности организации.  Использование AU позволяет разделить ресурсы Azure на контейнеры подобно локальным организационным единицам (OU).  Для использования AU администратор AU должен иметь лицензию Azure AD уровня "Премиум". [Узнайте больше](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-administrative-units).
- **Используйте многофакторную проверку подлинности (MFA).** При наличии лицензии Azure AD уровня "Премиум" можно включить и принудительно применить MFA в учетных записях администраторов. Фишинг — наиболее распространенный способ компрометации таких учетных данных.  Как только злоумышленник получает данные учетной записи администратора, он сможет выполнять масштабные действия, такие как удаление всех групп ресурсов. MFA можно настроить несколькими способами, в том числе с помощью электронной почты, приложения для проверки подлинности и текстовых сообщений, отправляемых на телефон. Администратор может выбрать вариант, который будет меньше всего влиять на работу сотрудников. MFA интегрируется с аналитикой угроз и политиками условного доступа, случайным образом требуя ответить на запрос MFA. Ознакомьтесь с инструкциями по [обеспечению безопасности](https://docs.microsoft.com/azure/active-directory/authentication/multi-factor-authentication-security-best-practices) и [настройке](https://docs.microsoft.com/azure/active-directory/authentication/multi-factor-authentication-security-best-practices) MFA.
- **Реализуйте условный доступ.** В большинстве организаций малого и среднего размера администраторы Azure и служба поддержки, как правило, находятся в одном географическом регионе. В этом случае большинство операций входа будут осуществляться из одних и тех же областей. Если IP-адреса этих расположений достаточно статичны, логично, что вход администраторов не должен выполняться вне этих областей. Даже в случае, когда злоумышленник, находящийся в удаленном расположении, компрометирует учетные данные администратора, можно реализовать такие функции безопасности, как условный доступ в сочетании с MFA, чтобы запретить вход из удаленных местоположений или из местоположений, подмененных случайными IP-адресами. [Узнайте больше](https://docs.microsoft.com/azure/active-directory/conditional-access/overview) об условном доступе и [просмотрите советы и рекомендации](https://docs.microsoft.com/azure/active-directory/conditional-access/best-practices) по условному доступу в Azure AD.
- **Просмотрите разрешения корпоративных приложений.** В определенный момент администраторы могут перейти по ссылкам Майкрософт и третьих лиц, не имея сведений об их влиянии на организацию. По ссылкам могут открываться экраны согласия, назначающие разрешения приложениям Azure, а также разрешаться доступ на чтение данных в Azure AD или даже полный доступ для управления всей подпиской Azure. Следует регулярно проверять приложения, которым администраторы и пользователи разрешили доступ к ресурсам Azure. Следует убедиться, что у этих приложений есть только необходимые разрешения. Кроме того, ежеквартально или два раза в год можно рассылать пользователям по электронной почте ссылку на страницы приложений, чтобы они знали о приложениях, которым разрешили доступ к данным своей организации. [Узнайте больше](https://docs.microsoft.com/azure/active-directory/manage-apps/application-types) о типах приложений и о том, [как управлять](https://docs.microsoft.com/azure/active-directory/manage-apps/remove-user-or-group-access-portal) назначениями приложений в Azure AD.



## <a name="managed-migrated-workloads"></a>Управляемые перенесенные рабочие нагрузки

В этом разделе мы приводим ряд рекомендаций для управления Azure, включая следующие:

- [Управление ресурсами.](#best-practice-name-resource-groups). Советы и рекомендации по управлению ресурсами и группами ресурсов Azure, включая интеллектуальное именование, предотвращение случайного удаления, управление разрешениями на ресурсы и эффективное снабжение ресурсов тегами.
- [Использование схем.](#best-practice-implement-blueprints) Общие сведения об использовании схем для создания сред развертывания и управления ими.
- [Рассмотрение архитектур.](#best-practice-review-azure-reference-architectures) Рассмотрите примеры архитектур Azure, которые можно изучить для развертывания после миграции.
- [Настройка групп управления.](#best-practice-manage-resources-with-management-groups) При наличии нескольких подписок, можно объединить их в группы управления и применить параметры управления к группам.
- [Настройка политик доступа.](#best-practice-deploy-azure-policy) Примените политики соответствия требованиям к ресурсам Azure.
- [Реализация стратегии BCDR.](#best-practice-implement-a-bcdr-strategy) Сформируйте стратегию обеспечения непрерывности бизнеса и аварийного восстановления (BCDR) для поддержания безопасности данных, устойчивости среды и работы ресурсов при возникновении сбоев.
- [Управление виртуальными машинами.](#best-practice-use-managed-disks-and-availability-sets) Объедините виртуальные машины в группы доступности для обеспечения устойчивости и высокого уровня доступности. Управляемые диски упростят администрирование дисков и хранилища виртуальных машин.
- [Отслеживание использования ресурсов.](#best-practice-monitor-resource-usage-and-performance) Включите ведение журналов диагностики для ресурсов Azure, создайте оповещения и сборники схем для упреждающего устранения неполадок, а также используйте панель мониторинга Azure для унифицированного представления работоспособности и состояния развернутой службы.
- [Управление поддержкой и обновлениями.](#best-practice-manage-updates) Составьте четкое представление о своем плане поддержки Azure и способе его реализации, ознакомьтесь с рекомендациями по поддержанию виртуальных машин в обновленном состоянии и внедрите процессы для управления изменениями.


## <a name="best-practice-name-resource-groups"></a>Рекомендация. Присвойте имена группам ресурсов

Наличие понятных имен для групп ресурсов, позволяющих администраторам и участникам группы поддержки легко распознавать их и переходить между ними, значительно повышает производительность и эффективность.
- Мы рекомендуем следовать соглашениям об именовании Azure.
- Если вы синхронизируете локальные службы AD DS с Azure AD, используя AD Connect, рекомендуем обеспечить соответствие имен групп безопасности в локальной системе именам групп ресурсов в Azure.

![Именование](./media/migrate-best-practices-security-management/naming.png)
*Именование групп ресурсов*


**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions) о соглашениях об именовании

## <a name="best-practice-implement-delete-locks-for-resource-groups"></a>Рекомендация. Реализуйте блокировки удаления для групп ресурсов

Случайное удаление группы ресурсов крайне нежелательно. Рекомендуется внедрить блокировки удаления, чтобы такого не произошло.


![Блокировки удаления](./media/migrate-best-practices-security-management/locks.png)
*Delete locks*

**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-lock-resources) о блокировке ресурсов для предотвращения непредвиденных изменений.


## <a name="best-practice-understand-resource-access-permissions"></a>Рекомендация. Составьте четкое представление о разрешениях на доступ к ресурсам 

Владелец подписки имеет доступ ко всем группам ресурсов и ресурсам в вашей подписке.
- Такие значимые права следует назначать с осмотрительностью. Чтобы поддерживать безопасность и стабильность среды, важно понимать последствия назначения таких разрешений.
- Убедитесь, что ресурсы размещены в соответствующих группах:
    - Совместите ресурсы с аналогичным жизненным циклом друг с другом. Тогда вам не потребуется перемещать никакие ресурсы при необходимости удалить всю группу ресурсов.
    - Ресурсы, которые поддерживают ту или иную функцию или рабочую нагрузку, следует размещать вместе для упрощенного управления.

**Дополнительные сведения:**

- [Сведения](https://azure.microsoft.com/blog/organizing-subscriptions-and-resource-groups-within-the-enterprise/) об организации подписок и групп ресурсов.

## <a name="best-practice-tag-resources-effectively"></a>Рекомендация. Эффективно присваивайте ресурсам теги

Зачастую при использование только имени группы ресурсов, связанного с ресурсами, недостаточно метаданных для эффективной реализации таких механизмов, как внутреннее выставление счетов или управление в пределах подписки.
- Рекомендуем использовать теги Azure для добавления полезных метаданных, которые можно запрашивать и по которым можно составлять отчеты. 
- Теги позволяют логически организовать ресурсы с помощью заданных вами свойств.  Теги можно применять к группам ресурсов или непосредственно к ресурсам.
- Теги можно применить к группе ресурсов или отдельным ресурсам. Теги группы ресурсов не наследуются ресурсами в этой группе.
- Можно автоматизировать добавление тегов с помощью Powershell или службы автоматизации Azure, или же помечать тегами отдельные группы и ресурсы, — т. е. применить автоматизированный подход к установке тегов или метод самообслуживания.  Если есть запрос и установлена система управления изменениями, можно легко использовать указанные в запросе сведения для заполнения тегов ресурсов конкретной компании.


![Добавление тегов](./media/migrate-best-practices-security-management/tagging.png)
*Tagging*

**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-using-tags) о добавлении тегов и их ограничениях.
- [Просмотрите](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-using-tags#powershell) примеры PowerShell и CLI для настройки добавления тегов, а также для применения тегов из группы ресурсов к ее ресурсам.
- [Ознакомьтесь](http://www.azurefieldnotes.com/2016/07/18/azure-resource-tagging-best-practices/) с рекомендациями Azure по добавлению тегов.


## <a name="best-practice-implement-blueprints"></a>Рекомендация. Реализуйте схемы Blueprints

Так же, как чертеж позволяет инженеру или архитектору набросать конструктивные параметры для проекта, схемы Azure Blueprints позволяют облачным архитекторам и центральным ИТ-группам определять воспроизводимый набор ресурсов Azure, который реализует стандарты, шаблоны и требования организации и соблюдает их. С помощью Azure Blueprints группы разработчиков могут быстро формировать и создавать новые среды, соответствующие требованиям организации и содержащие ряд встроенных компонентов, таких как сети, для ускорения разработки и поставки.

- Схемы Blueprints позволяют координировать развертывание групп ресурсов, шаблонов Azure Resource Manager и назначений политик и ролей.
- Схемы Azure Blueprints хранятся в глобально распределенной базе данных Azure Cosmos DB. Объекты схемы реплицируются в нескольких регионах Azure. Репликация обеспечивает низкую задержку, высокий уровень доступности и согласованный доступ к схеме, независимо от того, в каком регионе развернуты ресурсы службы Blueprints.

**Дополнительные сведения:**

- [Прочитайте](https://docs.microsoft.com/azure/governance/blueprints/overview) о схемах Blueprints.
- [Просмотрите](https://azure.microsoft.com/blog/customizing-azure-blueprints-to-accelerate-ai-in-healthcare/) пример схемы Blueprints, используемый для ускорения работы с искусственным интеллектом в области здравоохранения.

## <a name="best-practice-review-azure-reference-architectures"></a>Рекомендация. Просмотрите эталонные образцы архитектуры Azure

Создание безопасных, масштабируемых и управляемых рабочих нагрузок в Azure может казаться слишком трудоемкой задачей.  Функции постоянно изменяются, и обеспечивать соответствие им для организации оптимальной среды довольно сложно. При разработке и миграции рабочих нагрузок может помочь эталонный пример.  Azure и партнеры Azure создали несколько эталонных примеров архитектуры для различных типов сред. Эти примеры предоставляют идеи, на которых можно учиться и строить собственные реализации. 

Эталонные архитектуры упорядочены по сценариям. Они содержат практические рекомендации и советы по управлению, доступности, масштабируемости, а также безопасности.
Функция "Среда службы приложений Azure" обеспечивает полностью изолированную и выделенную среду для запуска приложений службы приложений, таких как веб-приложения Windows и Linux, контейнеры Docker, мобильные приложения и функции. Служба приложений не только реализует возможности Azure для вашего приложения, включая функции обеспечения безопасности, балансировки нагрузки, автоматического масштабирования и автоматизированного управления. Кроме того, вы можете воспользоваться такими преимуществами DevOps, как непрерывное развертывание из Azure DevOps и GitHub, управление пакетами, а также возможность использования промежуточных сред, личного домена и SSL-сертификатов. Служба приложений полезна для приложений, которым требуется изоляция и защищенный доступ, а также для приложений, которые используют большие объемы памяти и других ресурсов, требующих масштабирования.
**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/architecture/reference-architectures/) об эталонных образцах архитектуры Azure.
- [Просмотр](https://docs.microsoft.com/azure/architecture/example-scenario/) примеров сценариев Azure.

## <a name="best-practice-manage-resources-with-management-groups"></a>Рекомендация. Управляйте ресурсами с помощью групп управления

Если в вашей организации несколько подписок, для них необходимо управлять доступом, политиками и соответствием требованиям. Группы управления Azure обеспечивают высокий уровень охвата подписок.

- Подписки упорядочиваются в контейнеры, которые называются группами управления. К ним применяются условия системы управления.
- Все подписки в группе управления автоматически наследуют условия этой группы управления.
- Группы управления обеспечивают корпоративное управление в больших масштабах независимо от типа подписки.
- Например, можно применить политику группы управления, ограничивающую список регионов, в которых могут создаваться виртуальные машины. Затем эта политика применяется ко всем группам управления, подпискам и ресурсам в этой группе управления.
- Вы можете создать гибкую структуру групп управления и подписок для упорядочения своих ресурсов в иерархию для унифицированного управления политикой и доступом.

На следующей схеме показано, как создать иерархию управления с использованием групп управления.

![Группы управления](./media/migrate-best-practices-security-management/management-groups.png)
*Management groups*

**Дополнительные сведения:**
- [Сведения](https://docs.microsoft.com/azure/governance/management-groups/index) об организации ресурсов в группы управления.

## <a name="best-practice-deploy-azure-policy"></a>Рекомендация. Разверните службу "Политика Azure"

"Политика Azure" — это служба в Azure, которая используется для создания, присваивания и управления политиками.

- Политики гарантируют соблюдение различных правил и действий с ресурсами, что обеспечивает соответствие этих ресурсов корпоративным стандартам и соглашениям об уровне обслуживания.
- Служба "Политика Azure" оценивает ресурсы, проверяя наличие тех, которые не соответствуют установленным политикам.
- Например, можно создать политику, которая разрешает только определенный размер SKU для виртуальных машин в вашей среде. Служба "Политика Azure" будет оценивать этот параметр при создании и обновлении ресурсов, а также при проверке существующих ресурсов. 
- Azure предоставляет несколько встроенных политик, которые можно назначить, а также возможность создать собственную политику.


![Политика Azure](./media/migrate-best-practices-security-management/policy.png)
*Azure Policy*

**Дополнительные сведения:**
- [Общие сведения](https://docs.microsoft.com/azure/governance/policy/overview) о службе "Политика Azure".
- [Сведения](https://docs.microsoft.com/azure/governance/policy/tutorials/create-and-manage) о создании политик и управлении ими для обеспечения соответствия требованиям.


## <a name="best-practice-implement-a-bcdr-strategy"></a>Рекомендация. Реализуйте стратегию BCDR

Планирование непрерывности бизнес-процессов и аварийного восстановления (BCDR), — это важный фактор планирования миграции в Azure. В юридическом плане условия контракта включают пункт о форс-мажорных обстоятельствах, которые исключают обязательства в случае действия непреодолимой силы, например урагана или землетрясения. Но у вас также есть обязательства по возможности обеспечить продолжение работы служб и их восстановление при необходимости в случае аварии. Возможность сделать это может оказаться критически важной для будущего вашей компании.

В широком смысле в стратегии BCDR нужно учитывать следующее:
- **Резервное копирование данных.** Определите, как обеспечить безопасность данных, чтобы их можно было легко восстановить в случае возникновения сбоев.
- **Аварийное восстановление.** Определите, как поддерживать устойчивость и доступность приложений при возникновении сбоев. 

### <a name="azure-resiliency-features"></a>Функции устойчивости в Azure
Платформа Azure предоставляет ряд функций, обеспечивающих устойчивость.

- **Связывание регионов.** Azure связывает регионы для обеспечения региональной защиты в пределах размещения данных. Azure обеспечивает физическую изоляцию между парами регионов, устанавливает приоритеты для восстановления одного региона в паре в случае масштабного сбоя, развертывает обновления систем отдельно в каждом регионе, а также позволяет реплицировать функции, такие как геоизбыточное хранилище Azure, между парами регионов.
- **Зоны доступности.** Зоны доступности предотвращают сбой всего центра обработки данных Azure путем установления физических отдельных зон с регионом Azure. В каждой зоне есть отдельный источник питания, сетевая инфраструктура и механизм охлаждения.
- **Группы доступности.** Группы доступности обеспечивают защиту от сбоев в пределах центра обработки данных. Виртуальные машины объединяются в группы доступности для обеспечения их высокой доступности. Внутри каждой группы доступности Azure реализует несколько доменов сбоя, в которых группируется базовое оборудование с общим источником питания и сетевым коммутатором, а также домены обновления, где группируется базовое оборудования, которое может проходить техническое обслуживание или перезагрузку в одно и то же время. Например, когда рабочая нагрузка распределяется между виртуальными машинами Azure, можно поместить два или несколько виртуальных машин для каждого уровня приложения в группу доступности. Скажем, виртуальные машины внешнего интерфейса можно поместить в одну группу, а виртуальные машины уровня данных — в другую. Так как одновременно в одной группе перезагружается только один домен обновления, а Azure гарантирует, что виртуальные машины в группе распределены между доменами сбоя, предотвращается одновременный отказ всех виртуальных машин в группе.

### <a name="set-up-bcdr"></a>Настройка BCDR

При миграции в Azure важно понимать, что, хотя платформа Azure предоставляет эти встроенные возможности отказоустойчивости, необходимо спроектировать развертывание Azure таким образом, чтобы воспользоваться преимуществами функций и служб Azure, обеспечивающих высокий уровень доступности, аварийное восстановление и резервное копирование.

- Решение BCDR зависит от целей вашей компании. На него влияет стратегия развертывания в Azure. Развертывание в режиме инфраструктуры как услуги (IaaS) и платформы как услуги (PaaS) представляет различные проблемы для BCDR.
- После внедрения решения BCDR необходимо регулярно тестировать, проверяя жизнеспособность стратегии.


## <a name="best-practice-back-up-your-data"></a>Рекомендация. Резервное копирование данных

В большинстве случаев локальная рабочая нагрузка выводится из эксплуатации после миграции и локальную стратегию резервного копирования данных необходимо расширять или заменять. Если весь центр обработки данных переносится в Azure, необходимо разработать и внедрить полное решение для резервного копирования с использованием технологий Azure или интегрированных решений сторонних поставщиков. 


### <a name="back-up-an-iaas-deployment"></a>Резервное копирование развернутой среды IaaS

Для рабочих нагрузок, выполняющихся на виртуальных машинах IaaS Azure, рассмотрите следующие решения резервного копирования:

- **Azure Backup.** Обеспечивает резервное копирование с согласованием приложений для виртуальных машин Windows и Linux в Azure.
- **Моментальные снимки хранилища.** Создание моментальных снимков хранилища BLOB-объектов.

#### <a name="azure-backup"></a>Служба архивации Azure

Azure Backup создает точки восстановления данных, которые хранятся в службе хранилища Azure. Azure Backup может выполнять резервное копирование дисков виртуальных машин Azure и файлов в службе файлов Azure (предварительная версия). Служба файлов Azure предоставляют файловые ресурсы в облаке, доступные по протоколу SMB.
   
С помощью Azure Backup можно создавать резервные копии виртуальных машин несколькими способами.

- **Прямое резервное копирование из параметров виртуальной машины.** Резервные копии виртуальных машин с помощью Azure Backup можно создавать непосредственно на основе параметров виртуальных машин на портале Azure. Для виртуальной машины можно выполнять резервное копирование каждый день и при необходимости восстанавливать ее диск. Azure Backup создает моментальные снимки данных с поддержкой приложений (VSS). При этом на виртуальную машину не устанавливается агент.
- **Прямое резервное копирование в хранилище Служб восстановления.** Для виртуальных машин IaaS можно выполнять резервное копирование путем развертывания хранилища Служб восстановления Azure Backup. Это обеспечивает единое расположение для отслеживания резервных копий и управления ими, а также предоставляет возможности детализированной настройки резервного копирования и восстановления. Резервное копирование выполняется до трех раз в день на уровне файлов или папок. При этом не учитываются приложения и не поддерживается ОС Linux. На каждой виртуальной машине, подлежащей резервному копированию, необходимо установить агент Служб восстановления Microsoft Azure (MARS).
- **Azure Backup Server. Защита виртуальной машины с помощью Azure Backup Server.** Azure Backup Server предоставляется бесплатно вместе со службой Azure Backup. Резервная копия виртуальной машины создается в локальном хранилище Azure Backup Server. Затем выполняется резервное копирование Azure Backup Server в хранилище Azure. При резервном копировании учитываются приложения и обеспечивается полная детализация в плане частоты создания и срока хранения резервных копий. Можно выполнять резервное копирование на уровне приложений. Например, создавать резервные копии SQL Server или SharePoint.

В целях безопасности Azure Backup шифрует данные при передаче с помощью AES 256 и отправляет их в Azure по протоколу HTTPS. Резервные копии данных во время хранения в Azure шифруются с помощью [Шифрования службы хранилища (SSE)](https://docs.microsoft.com/azure/storage/common/storage-service-encryption?toc=%2fazure%2fstorage%2fqueues%2ftoc.json) (как и данные, предназначенные для передачи и хранения).


![Azure Backup](./media/migrate-best-practices-security-management/iaas-backup.png)
*Azure Backup*

**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/backup/backup-introduction-to-azure-backup) о разных типах резервного копирования.
- [Планирование инфраструктуры резервного копирования](https://docs.microsoft.com/azure/backup/backup-azure-vms-introduction) для виртуальных машин Azure.

#### <a name="storage-snapshots"></a>Моментальные снимки хранилища

Виртуальные машины Azure содержатся в хранилище Azure в виде страничных BLOB-объектов. 

- В моментальные снимки записывается состояние большого двоичного объекта в определенный момент времени.
- В качестве альтернативного способа резервного копирования для дисков виртуальных машин Azure можно создать моментальный снимок BLOB-объектов из хранилища и скопировать их в другую учетную запись хранения. 
- Можно скопировать весь BLOB-объект или использовать добавочное копирование моментальных снимков, чтобы копировать только разностные изменения и уменьшить занимаемое место в системе хранения.
- В качестве дополнительной меры предосторожности можно включить обратимое удаление для учетных записей хранения BLOB-объектов. Когда эта функция включена, удаляемый BLOB-объект помечается для удаления, но не удаляется сразу. В течение периода отсрочки этот BLOB-объект можно восстановить.

**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-introduction) о хранилище BLOB-объектов Azure.
- [Сведения о том, как](https://docs.microsoft.com/azure/storage/blobs/storage-blob-snapshots) создать моментальный снимок BLOB-объекта.
- [Просмотр демонстрационного сценария](https://azure.microsoft.com/blog/microsoft-azure-block-blob-storage-backup) резервного копирования хранилища BLOB-объектов.
- [Сведения](https://docs.microsoft.com/azure/storage/blobs/storage-blob-soft-delete) об обратимом удалении.
- [Что делать в случае простоя службы хранилища Azure](../storage/common/storage-disaster-recovery-guidance.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)

#### <a name="third-party-backup"></a>Сторонние решения для резервного копирования

Кроме того, можно использовать сторонние решения для резервного копирования виртуальных машин Azure и контейнеров хранилища в локальное хранилище или на ресурсы других поставщиков облачных служб. [Узнайте больше](https://azuremarketplace.microsoft.com/marketplace/apps?search=backup&page=1) о решениях для резервного копирования в Azure Marketplace. 


### <a name="back-up-a-paas-deployment"></a>Резервное копирование развернутой среды PaaS


В отличие от IaaS, где вы управляете собственными виртуальными машинами и инфраструктурой, в модели PaaS платформой и инфраструктурой управляет поставщик. Это позволяет вам сосредоточиться на основной логике и возможностях приложений. Учитывая большое количество типов служб PaaS, в целях резервного копирования каждая служба будет оцениваться по отдельности. Рассмотрим две широко используемые службы Azure PaaS — "База данных SQL Azure" и "Функции Azure".

#### <a name="back-up-azure-sql-database"></a>Резервное копирование Базы данных SQL Azure

База данных SQL Azure представляет собой полностью управляемое ядро СУБД в режиме PaaS. Она предоставляет ряд возможностей для обеспечения непрерывности бизнес-процессов, включая автоматическое резервное копирование.

- База данных SQL автоматически создает еженедельные полные резервные копии, а также разностные резервные копии каждые 12 часов. Резервные копии журналов транзакций создаются каждые 5–10 минут для защиты от потери данных в базе данных.
- Резервные копии являются прозрачными, и за них не взимается дополнительная плата.
- Резервные копии хранятся в хранилище RA-GRS по соображениям геоизбыточности и реплицируются в связанный географический регион.
- Хранение резервных копий зависит от модели приобретения. Уровни служб на основе DTU обеспечивают хранение от семи дней для уровня "Базовый" до 35 дней для других уровней.
- Можно восстановить состояние базы данных на определенный момент времени в течение периода хранения. Также можно восстановить удаленную базу данных, выполнить восстановление в другом географическом регионе или восстановить данные из долгосрочной резервной копии, если в базе данных реализована долгосрочная политика хранения (LTR).


![Резервное копирование SQL Azure](./media/migrate-best-practices-security-management/sql-backup.png)
*Azure SQL backup*

**Дополнительные сведения:**
- [Автоматически создаваемые резервные копии](https://docs.microsoft.com/azure/sql-database/sql-database-automated-backups) для Базы данных SQL.
- [Восстановление базы данных](https://docs.microsoft.com/azure/sql-database/sql-database-recovery-using-backups) с помощью автоматического резервного копирования.

 
#### <a name="back-up-azure-functions"></a>Резервное копирование службы "Функции Azure"

Так как функции в службе "Функции Azure" так или иначе представляют собой код, для них следует выполнять резервное копирование с использованием тех же методов, которые позволяют защитить код, например в системе управления версиями в GitHub или службах Azure DevOps

**Дополнительные сведения:**

- [Защита данных](https://docs.microsoft.com/azure/devops/articles/team-services-security-whitepaper?view=vsts) для Azure DevOps.

## <a name="best-practice-set-up-disaster-recovery"></a>Рекомендация. Настройка аварийного восстановления 

В дополнение к защите данных, при планировании BCDR необходимо рассмотреть способ поддержания доступности приложений и рабочих нагрузок в случае аварии. 

### <a name="set-up-disaster-recovery-for-iaas-apps"></a>Настройка аварийного восстановления для приложений IaaS

Для рабочих нагрузок, выполняющихся на виртуальных машинах IaaS Azure и в хранилище Azure рассмотрите следующие решения:

- **Azure Site Recovery.** Координирует репликацию виртуальных машин Azure из основного в дополнительный регион. При возникновении сбоев выполняется отработка отказа из основного региона в дополнительный и пользователи сохраняют доступ к приложениям. После восстановления работоспособности выполняется переход обратно в основной регион.
- **Служба хранилища Azure.** Azure предоставляет встроенные возможности устойчивости и высокого уровня доступности для разных типов хранилищ.

#### <a name="azure-site-recovery"></a>Azure Site Recovery 

Azure Site Recovery — это основная служба Azure, обеспечивающая возможность восстановления работы виртуальных машин Azure и доступности приложений на виртуальных машинах при возникновении сбоев. Site Recovery реплицирует виртуальные машины из основного в дополнительный регион Azure. В случае аварии выполняется отработка отказа виртуальных машин из основного региона. Доступ к ним и дальше предоставляется в обычном режиме в дополнительном регионе. После возврата в нормальное состояние, можно восстановить работу виртуальных машин в основном регионе.


![Azure Site Recovery](./media/migrate-best-practices-security-management/site-recovery.png)
*Site Recovery*

**Дополнительные сведения:**
- [Обзор](https://docs.microsoft.com/azure/virtual-machines/virtual-machines-disaster-recovery-guidance) сценариев аварийного восстановления для виртуальных машин Azure.
- [Сведения о том, как](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-replicate-after-migration) настроить аварийное восстановление виртуальных машин Azure после миграции.

#### <a name="azure-storage"></a>Хранилище Azure

Хранилище Azure реплицируется для использования встроенных функций обеспечения устойчивости и высокого уровня доступности.

-   **Геоизбыточное хранилище (GRS).** Защищает от сбоя в масштабе региона с устойчивостью объектов на уровне как минимум 99,99999999999999 % (16 девяток) в течение определенного года.
    - Данные хранилища реплицируются в дополнительный регион, с которым связан основной.
    - Если основной регион отключится и корпорация Майкрософт инициирует отработку отказа в дополнительный регион, у вас будет доступ к данным для чтения.
- **Геоизбыточное хранилище с доступом для чтения (RA-GRS).** Защищает от сбоя в масштабе региона.
    - Данные хранилища реплицируются в дополнительный регион.
    - У вас будет гарантированный доступ для чтения реплицированных данных в дополнительном регионе. Это не зависит от того, инициирует ли корпорация Майкрософт отработку отказа, когда два или несколько ЦОД в одном регионе могут испытывать проблемы. Данные по-прежнему будут доступны в отдельном географическом регионе.
-   **Хранилище, избыточное между зонами (ZRS).**  Обеспечивает защиту от сбоя центра обработки данных.
    - ZRS позволяет синхронно реплицировать данные в трех кластерах хранилища одного региона. Кластеры физически отделены друг от друга, и каждый из них располагается в собственной зоне доступности.
    - В случае аварии хранилище по-прежнему будут доступно. ZRS должно быть минимальной необходимой целью для критически важных рабочих нагрузок.



**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/storage/common/storage-redundancy) о репликации хранилища Azure.


### <a name="set-up-disaster-recovery-for-paas-workloads"></a>Настройка аварийного восстановления для рабочих нагрузок PaaS

Давайте рассмотрим варианты аварийного восстановления для наших примеров рабочей нагрузки PaaS.

#### <a name="disaster-recovery-of-azure-sql-server"></a>Аварийное восстановление Azure SQL Server

Есть несколько вариантов, каждый из которых влияет на потерю данных, время восстановления и затраты.

Можно использовать группы отработки отказа и активную георепликацию для обеспечения устойчивости к региональным сбоям и неожиданным отказам.

- **Активная георепликация.** Развертывание активной георепликации позволяет ускорить аварийное восстановление в случае сбоя центра обработки данных или при отсутствии соединения с базой данных-источником.
    - Георепликация постоянно создает доступные для чтения реплики базы данных в базах данных-получателях количеством до четырех, расположенных в одном или разных регионах.
    - В случае сбоя выполняется переход на один из дополнительных регионов и возврат базы данных в оперативный режим.
- **Группы автоматической отработки отказа.** Группы автоматической отработки отказа расширяют активную георепликацию с использованием прозрачной отработки отказа нескольких баз данных.
    - Группа автоматической отработки отказа обеспечивает расширенную абстракцию активной георепликации за счет репликации баз данных на уровне группы и автоматической отработки отказа.
    - Следует создать группу отработки отказа, содержащую сервер-источник с размещением одной или нескольких баз данных-источников, сервер-получатель, на котором размещаются доступные только для чтения реплики баз данных-источников, прослушиватели, которые указывают на каждый из серверов, а также политику автоматической отработки отказа.
    - Указанные конечные точки прослушивателей устраняют необходимость в изменении строки подключения SQL после отработки отказа.
- **Геовосстановление.** 
    -   Геовосстановление позволяет восстановить базу данных в другом регионе. Автоматические резервные копии всех баз данных Azure будут реплицированы в дополнительный регион в фоновом режиме. При этом база данных всегда будет восстанавливаться из копии файлов резервных копий, хранящейся в дополнительном регионе.
-   **Избыточные между зонами базы данных** обеспечивают встроенную поддержку зон доступности Azure.
    - Избыточные между зонами базы данных повышают уровень доступности для Azure SQL Server в случае сбоя центра обработки данных.
    - Избыточность в пределах зоны позволяет разместить избыточные реплики баз данных в разных зонах доступности в одном регионе. 



![Георепликация](./media/migrate-best-practices-security-management/geo-replication.png)
*Geo-replication*

**Дополнительные сведения:**
- [Дополнительные сведения](https://docs.microsoft.com/azure/sql-database/sql-database-high-availability) о высоком уровне доступности для Azure SQL Server.
- [Основы](https://azure.microsoft.com/blog/azure-sql-databases-disaster-recovery-101/) работы с Базами данных SQL Azure для аварийного восстановления.
- [Обзор](https://docs.microsoft.com/azure/sql-database/sql-database-geo-replication-overview) активной георепликации и групп автоматической отработки отказа.
- [Сведения](https://docs.microsoft.com/azure/sql-database/sql-database-designing-cloud-solutions-for-disaster-recovery) о проектировании сети для аварийного восстановления.
- [Рекомендации](https://docs.microsoft.com/azure/sql-database/sql-database-geo-replication-overview) для групп отработки отказа.
- [Рекомендации](https://docs.microsoft.com/azure/sql-database/sql-database-geo-replication-security-config) по обеспечению безопасности после геовосстановления или отработки отказа.
- [Сведения](https://docs.microsoft.com/azure/sql-database/sql-database-high-availability#zone-redundant-configuration) об избыточности в пределах зоны.
- [Сведения о том, как](https://docs.microsoft.com/azure/sql-database/sql-database-disaster-recovery-drills) выполнить детализацию аварийного восстановления для базы данных SQL.

### <a name="disaster-recovery-for-azure-functions"></a>Аварийное восстановление для службы "Функции Azure"

Если в Azure произойдет сбой инфраструктуры вычисления, приложение-функция Azure может стать недоступным.

- Чтобы свести к минимуму вероятность такого простоя, следует использовать два приложения-функции, развернутые в разных регионах.
- Диспетчер трафика Azure настроен для обнаружения проблем в основном приложении-функции и автоматического перенаправления трафика в приложение-функцию во вторичном регионе.
- Диспетчер трафика с геоизбыточным хранилищем позволяет разместить одну и ту же функцию в нескольких регионах на случай регионального сбоя.


![Диспетчер трафика](./media/migrate-best-practices-security-management/traffic-manager.png)
*Traffic Manager*

**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications) об аварийном восстановлении для приложений Azure.
- [Сведения](https://docs.microsoft.com/azure/azure-functions/durable/durable-functions-disaster-recovery-geo-distribution) об аварийном восстановлении и географическом распределении для устойчивых функций Azure.


## <a name="best-practice-use-managed-disks-and-availability-sets"></a>Рекомендация. Используйте управляемые диски и группы доступности

Группы доступности используются в Azure для логического группирования виртуальных машин, а также для изоляции виртуальных машин одной группы от других ресурсов. Виртуальные машины в группе доступности распределяются между несколькими доменами сбоя с отдельными подсистемами, чтобы обеспечить защиту от локальных сбоев, а также распределяются по нескольким доменам обновления, чтобы одновременно перезагружать не все виртуальные машины в группе.

Управляемые диски Azure упрощают администрирование дисков виртуальных машин Azure IaaS. Функция управляет учетными записями хранения, связанными с этими дисками.

- Рекомендуем при возможности использовать управляемые диски. Вам достаточно указать тип хранилища, которое следует использовать, и нужный размер диска, а затем Azure автоматически создаст диск и возьмет на себя управление им в фоновом режиме.
- Существующие диски можно преобразовать в управляемые.
- Для обеспечения высокого уровня устойчивости и доступности следует создавать виртуальные машины в группах доступности. При возникновении запланированных и незапланированных простоев группы доступности обеспечивают доступность по крайней мере одной из виртуальных машин в группе.


![Управляемые диски](./media/migrate-best-practices-security-management/managed-disks.png)
*Managed disks*

**Дополнительные сведения:**
- [Обзор](https://docs.microsoft.com/azure/virtual-machines/windows/managed-disks-overview) управляемых дисков.
- [Сведения](https://docs.microsoft.com/azure/virtual-machines/windows/convert-unmanaged-to-managed-disks) о преобразовании дисков в управляемые.
- [Сведения о том, как](https://docs.microsoft.com/azure/virtual-machines/windows/manage-availability) управлять доступностью виртуальных машин Windows в Azure.


## <a name="best-practice-monitor-resource-usage-and-performance"></a>Рекомендация. Мониторинг потребления ресурсов и производительности 

Возможно, вы переместили рабочие нагрузки в Azure, чтобы получить огромные возможности масштабирования в этой системе. Но перемещение рабочей нагрузки не означает, что Azure автоматически реализует масштабирование без входных данных. Например:

- Если маркетинговая организация размещает новую рекламу на телевидении, которая привлекает на 300 % больше трафика, это может вызвать проблемы с доступностью сайта. Только что перенесенная рабочая нагрузка может достигнуть назначенных ограничений и аварийно завершиться.
- Другой пример — распределенная атака типа "отказ в обслуживании" (DDoS) на перенесенную рабочую нагрузку. В этом случае может потребоваться не масштабирование, а защита ваших ресурсов от атаки.

В этих двух случаях требуются разные решения, но в обоих необходимо составить представление о ситуации. В этом поможет мониторинг потребления и производительности.

- Azure Monitor позволяет просмотреть эти метрики, а затем предоставить ответ с использованием оповещений, автоматического масштабирования, концентраторов событий, приложений логики и других средств.
- Помимо мониторинга Azure, можно интегрировать сторонние приложения SIEM для мониторинга журналов на предмет событий аудита и производительности.


![Azure Monitor](./media/migrate-best-practices-security-management/monitor.png)
*Azure Monitor*

**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/azure-monitor/overview) об Azure Monitor.
- [Рекомендации](https://docs.microsoft.com/azure/architecture/best-practices/monitoring) по мониторингу и диагностике.
- [Сведения](https://docs.microsoft.com/azure/architecture/best-practices/auto-scaling) об автомасштабировании.
- [Сведения о том, как](https://docs.microsoft.com/azure/security-center/security-center-export-data-to-siem) маршрутизировать данные Azure в средство SIEM.

## <a name="best-practice-enable-diagnostic-logging"></a>Рекомендация. Включение ведения журналов диагностики

Ресурсы Azure создают значительное количество метрик в журналах и данных телеметрии.

- По умолчанию для большинства типов ресурсов не включено ведение журналов диагностики.
- Включив ведение журналов диагностики по ресурсам, можно запрашивать данные журналов и создавать оповещения, а также сборники схем на их основе.
- После включения ведения журналов диагностики каждый ресурс получит определенный набор категорий. Следует выбрать одну или несколько категорий ведения журналов и расположение для их данных. Журналы можно отправлять в учетную запись хранения, концентратор событий или службу Log Analytics. 


![Ведение журналов диагностики](./media/migrate-best-practices-security-management/diagnostics.png)
*Diagnostic logging*

**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs) о сборе и использовании данных журнала.
- [Сведения о поддерживаемых возможностях](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-diagnostic-logs-schema) для ведения журналов диагностики.


## <a name="best-practice-set-up-alerts-and-playbooks"></a>Рекомендация. Настройте оповещения и сборники схем

Включив ведение журналов диагностики для ресурсов Azure, можно приступать к созданию настраиваемых оповещений с помощью данных журналов.

- Оповещения позволяют заранее получать уведомления о состояниях, обнаруженных в ваших данных мониторинга. Это дает возможность решить проблемы до того, как пользователи системы обратят на них внимание. Можно создать оповещение о таких аспектах, как значения метрик, запросы поиска по журналам, события журнала действий, работоспособность платформы и доступность веб-сайта.
- При срабатывании оповещений можно запустить сборник схем Logic App Playbook. Сборник схем помогает автоматизировать и координировать ответ на определенное оповещение. Сборники схем основываются на приложениях Azure Logic Apps. Можно использовать шаблоны приложений Logic App для создания сборников схем или полностью создавать их с нуля.
- В качестве простого примера можно создать оповещение, которое будет срабатывать при сканировании портов той или иной группы безопасности сети.  Можно настроить сборник схем, который будет запускаться и блокировать IP-адрес источника сканирования.
- Другой пример — приложение с утечкой памяти.  Когда потребление памяти дойдет до определенной точки, сборник схем может перезапустить процесс.


![Оповещения](./media/migrate-best-practices-security-management/alerts.png)
*Alerts*

**Дополнительные сведения:**
- [Сведения](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-alerts) об оповещениях.
- [Сведения](https://docs.microsoft.com/azure/security-center/security-center-playbooks) о сборниках схем, которые реагируют на оповещения Центра безопасности.

## <a name="best-practice-use-the-azure-dashboard"></a>Рекомендация. Используйте панель мониторинга Azure

Портал Azure — это унифицированная веб-консоль, с помощью которой можно создавать, администрировать и отслеживать любые объекты, от простых веб-приложений до сложных облачных приложений. Он включает в себя настраиваемую панель мониторинга и специальные возможности.
- Можно создать несколько панелей мониторинга и предоставить к ним общий доступ другим пользователям, у которых есть доступ к вашим подпискам Azure.
- В этой общей модели группа сотрудников получает представление о среде Azure, что позволяет ей принимать упреждающие меры при управлении системами в облаке.


![Панель мониторинга Azure](./media/migrate-best-practices-security-management/dashboard.png)
*Azure dashboard*

**Дополнительные сведения:**

- [Сведения о том, как](https://docs.microsoft.com/azure/azure-portal/azure-portal-dashboards) создать панель мониторинга.
- [Сведения](https://docs.microsoft.com/azure/azure-portal/azure-portal-dashboards-structure) о структуре панели мониторинга.


## <a name="best-practice-understand-support-plans"></a>Рекомендация. Изучите планы поддержки

На определенном этапе вам потребуется работать совместно с персоналом службы поддержки вашей организации или корпорации Майкрософт. Крайне важно наличие набора политик и процедур для поддержки во время таких сценариев, как аварийное восстановление. Кроме того, ваши администраторы и сотрудники службы поддержки должны пройти обучение по реализации этих политик.

- В той маловероятной ситуации, если проблема со службой Azure повлияет на вашу рабочую нагрузку, администраторы должны знать, как отправить запрос в службу поддержки корпорации Майкрософт наиболее соответствующим и эффективным способом.
- Ознакомьтесь с различными планами поддержки, предлагаемыми для Azure. Их возможности варьируются от выделенного времени отклика для экземпляров для разработчиков до поддержки Premier со временем отклика менее 15 минут.


![Планы поддержки](./media/migrate-best-practices-security-management/support.png)
*Support plans*

**Дополнительные сведения:**
- [Обзор](https://azure.microsoft.com/support/options/) планов поддержки Azure.
- [Сведения](https://azure.microsoft.com/support/legal/sla/) о соглашениях об уровне обслуживания (SLA).

## <a name="best-practice-manage-updates"></a>Рекомендация. Управление обновлениями

Поддержание виртуальных машин Azure в обновленном состоянии путем установки последних обновлений операционной системы и программного обеспечения требует немалых усилий. Возможность получить сведения обо всех виртуальных машинах, чтобы выяснить, какие обновления им необходимы, и автоматически передать эти уведомления, чрезвычайно важна.

- С помощью решения "Управление обновлениями" в службе автоматизации Azure можно управлять обновлениями операционной системы для компьютеров под управлением Windows и Linux, развернутых в Azure, локальных средах или средах других поставщиков облачных услуг. 
- Решение позволяет быстро оценить состояние доступных обновлений на всех компьютерах агентов и управлять установкой обновлений.
- Управление обновлениями для виртуальных машин можно включить непосредственно из учетной записи службы автоматизации Azure. Также можно обновить конкретную виртуальную машину на странице виртуальной машины на портале Azure.
- Кроме того, виртуальные машины Azure можно зарегистрировать с помощью System Center Configuration Manager. Затем можно перенести рабочую нагрузку Configuration Manager в Azure и выполнять отчеты и обновления программного обеспечения в едином веб-интерфейсе.


![Обновления виртуальных машин](./media/migrate-best-practices-security-management/updates.png)
*Обновления*

**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/automation/automation-update-management) об управлении обновлениями в Azure.
- [Сведения о том, как](https://docs.microsoft.com/azure/automation/oms-solution-updatemgmt-sccmintegration) интегрировать Configuration Manager с решением "Управление обновлениями".
- [Ответы на вопросы](https://docs.microsoft.com/sccm/core/understand/configuration-manager-on-azure) о Configuration Manager в Azure.


## <a name="implement-a-change-management-process"></a>Реализация процесса управления изменениями

Как и в любой рабочей системе, изменение любого типа может повлиять на среду. Процесс управления изменениями, который требует отправки запросов для внесения изменений в рабочие системы, является важным дополнением к среде миграции.

- Можно создать рекомендуемые платформы для управления изменениями, чтобы повысить осведомленность администраторов и персонала службы поддержки.
- Служба автоматизации Azure помогает в управлении конфигурацией, а также позволяет отслеживать перенесенные рабочие процессы.
- При управлении изменениями можно использовать журналы аудита, чтобы связывать журналы изменений Azure с предположительно существующими (или отсутствующими) запросами на изменение. Таким образом, если вы увидите изменение, внесенное без соответствующего запроса, вы можете изучить сведения о процессе, чтобы узнать, что пошло не так.

В службе автоматизации Azure есть решение "Отслеживание изменений":

- Это решение отслеживает изменения в программном обеспечении и файлах под управлением Windows и Linux, разделах реестра Windows, службах Windows и управляющих программах Linux.
- Изменения на отслеживаемых серверах отправляются в службу Log Analytics в облаке для обработки.
- К полученным данным применяется логика и облачная служба записывает данные.
- На панели мониторинга "Отслеживание изменений" можно без труда увидеть, какие изменения были внесены в серверную инфраструктуру.


![Управление изменениями](./media/migrate-best-practices-security-management/change.png)
*Change management*

**Дополнительные сведения:**

- [Сведения](https://docs.microsoft.com/azure/automation/automation-change-tracking) о решении "Отслеживание изменений".
- [Сведения](https://docs.microsoft.com/azure/automation/automation-intro) о возможностях службы автоматизации Azure.




## <a name="next-steps"></a>Дополнительная информация 

Ознакомьтесь с другими рекомендациями:


- [Рекомендации](migrate-best-practices-networking.md) по работе с сетями после миграции.
- [Рекомендации](migrate-best-practices-costs.md) по управлению затратами после миграции.








