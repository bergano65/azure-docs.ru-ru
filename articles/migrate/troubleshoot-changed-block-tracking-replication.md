---
title: Устранение неполадок репликации в миграции виртуальных машин VMware без агента
description: Получение справки по сбоям циклов репликации
author: anvar-ms
ms.manager: bsiva
ms.author: anvar
ms.topic: troubleshooting
ms.date: 08/17/2020
ms.openlocfilehash: 04dcf8edbce7782e6d196271bfa85f2f8d1c5ba3
ms.sourcegitcommit: 4c89d9ea4b834d1963c4818a965eaaaa288194eb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2020
ms.locfileid: "96608339"
---
# <a name="troubleshooting-replication-issues-in-agentless-vmware-vm-migration"></a>Устранение проблем репликации в миграции виртуальных машин VMware без агента

В этой статье описываются некоторые распространенные проблемы и конкретные ошибки, которые могут возникнуть при репликации локальных виртуальных машин VMware с помощью метода миграции с миграцией Azure: сервер без агента.

При репликации виртуальной машины VMware с помощью метода репликации без агента данные из дисков виртуальной машины&#39;s реплицируются на управляемые диски реплики в подписке Azure. При запуске репликации для виртуальной машины происходит начальное зацикливание репликации, в котором реплицируются все копии дисков. После завершения начальной репликации циклы добавочной репликации планируются периодически, чтобы передавать изменения, произошедшие с момента предыдущего цикла репликации.

Иногда для виртуальной машины не удается найти циклы репликации. Эти сбои могут возникать из-за причин проблем в конфигурации локальной сети до проблем в серверной части облачной службы "миграция Azure". В этой статье мы будем делать следующее:

 - Покажите, как можно отслеживать состояние репликации и устранять ошибки.
 - Перечислите некоторые из часто встречающихся ошибок репликации и предложите дополнительные шаги для их исправления.

## <a name="monitor-replication-status-using-the-azure-portal"></a>Мониторинг состояния репликации с помощью портал Azure

Чтобы отслеживать состояние репликации для виртуальных машин, выполните следующие действия.

  1. Перейдите на страницу серверы в службе "миграция Azure" на портал Azure.
  ![Изображение 1](./media/troubleshoot-changed-block-tracking-replication/image0.png)
  1. Перейдите на страницу "Репликация компьютеров", щелкнув "Репликация серверов" на плитке миграция сервера.
  ![Изображение 2](./media/troubleshoot-changed-block-tracking-replication/image1.png)
  1. Вы увидите список реплицируемых серверов и дополнительные сведения, такие как состояние, работоспособность, время последней синхронизации и т. д. В столбце работоспособность указывается текущая работоспособность репликации виртуальной машины. Значение "критическое" или "предупреждение" в столбце работоспособности обычно указывает на сбой предыдущего цикла репликации для виртуальной машины. Чтобы получить дополнительные сведения, щелкните виртуальную машину правой кнопкой мыши и выберите "сведения об ошибке". На странице сведения об ошибке содержатся сведения об ошибке и дополнительные сведения об устранении неполадок. Вы также увидите ссылку "Недавние события", которую можно использовать для перехода на страницу событий для виртуальной машины.
  ![Изображение 3](./media/troubleshoot-changed-block-tracking-replication/image2.png)
  1. Щелкните "Недавние события", чтобы просмотреть предыдущие сбои циклов репликации для виртуальной машины. На странице события найдите Последнее событие типа "цикл репликации не удалось" или "цикл репликации для диска" для виртуальной машины.
  ![Изображение 4](./media/troubleshoot-changed-block-tracking-replication/image3.png)
  1. Щелкните событие, чтобы понять возможные причины ошибки и рекомендуемые действия по исправлению. Используйте сведения, предоставленные для устранения ошибки.
 ![Изображение 5](./media/troubleshoot-changed-block-tracking-replication/image4.png)

## <a name="common-replication-errors"></a>Распространенные ошибки репликации

В этом разделе описаны некоторые распространенные ошибки, а также способы их устранения.

## <a name="key-vault-operation-failed-error-when-trying-to-replicate-vms"></a>При попытке репликации виртуальных машин произошла ошибка Key Vaultной операции

**Ошибка:** "Сбой операции Key Vault. Операция: Настройка управляемой учетной записи хранения, Key Vault: Key-Vault-Name, учетная запись хранения: сбой имени учетной записи хранения с ошибкой: "

**Ошибка:** "Сбой операции Key Vault. Операция: Создание определения подписанного URL-доступа, Key Vault: Key-Vault — имя, учетная запись хранения: имя учетной записи хранения завершилось ошибкой: "

![Key Vault](./media/troubleshoot-changed-block-tracking-replication/key-vault.png)

Эта ошибка обычно возникает из-за того, что политика доступа пользователя для Key Vault не предоставляет текущему пользователю, вошедшему в систему, необходимые разрешения для настройки учетных записей хранения, которые должны быть Key Vault управляемыми. Чтобы проверить политику доступа пользователей в хранилище ключей, перейдите на страницу хранилища ключей на портале для хранилища ключей и выберите политики доступа. 

Когда портал создает хранилище ключей, он также добавляет политику доступа пользователей, предоставляя разрешения текущего пользователя, вошедшего в систему, чтобы настроить учетные записи хранения, Key Vault управлять ими. Это может завершиться ошибкой по двум причинам.

- Вошедший в систему пользователь является удаленным участником в клиенте Azure Customer (подписка CSP, а вошедший в систему пользователь является администратором партнера). В этом случае в этом случае можно удалить хранилище ключей, выйти из портала, а затем войти с помощью учетной записи пользователя из клиента клиентов (а не удаленного участника) и повторить операцию. Как правило, у партнера CSP есть учетная запись пользователя Azure Active Directory клиента, который они могут использовать. Если вы не можете создать новую учетную запись пользователя для себя в клиенте Azure Active Directory клиента, войдите на портал в качестве нового пользователя, а затем повторите операцию репликации. Используемая учетная запись должна иметь разрешения владельца или участника + права администратора доступа пользователей, предоставленные учетной записи в группе ресурсов (перенос группы ресурсов проекта).

- В другом случае это может произойти, когда один пользователь (Пользователь1) попытался установить репликацию изначально и обнаружил сбой, но хранилище ключей уже создано (и пользовательская политика доступа, назначенная этому пользователю). Теперь в дальнейшем другой пользователь (Пользователь2) пытается установить репликацию, но операция настройки управляемой учетной записи хранения или создания определения SAS завершается сбоем, так как нет политики доступа пользователей, соответствующей Пользователь2 в хранилище ключей.

**Решение**. чтобы обойти эту проблему, создайте политику доступа пользователей для Пользователь2 в keyvault, предоставляющей права на настройку управляемой учетной записи хранения и создание определений SAS. Пользователь2 может сделать это из Azure PowerShell с помощью следующих командлетов:

$userPrincipalId = $ (Get-AzureRmADUser-UserPrincipalName "user2_email_address"). Удостоверения

Set-AzureRmKeyVaultAccessPolicy-VaultName "keyvaultname"-ObjectId $userPrincipalId-Пермиссионстостораже Get, List, DELETE, Set, Update, реженератекэй, жетсас, листсас, делетесас, сетсас, Recover, Backup, Restore, очистить


## <a name="disposeartefactstimedout"></a>диспосеартефактстимедаут

**Идентификатор ошибки:** 181008

**Сообщение об ошибке:** Виртуальная машина: VMName. Ошибка: обнаружено событие времени ожидания "Диспосеартефактстимеаут" в состоянии & "[" Gateway. Service. StateMachine. Снапшотрепликатион. Снапшотрепликатионенгине + Ваитингфорартефактсдиспосалпрецикле "(" WaitingForArtefactsDisposalPreCycle ")]".

**Возможные причины:**

Компонент, пытающийся выполнить репликацию данных в Azure, не работает или не отвечает. Возможные причины:

- Служба шлюза, работающая на устройстве "миграция Azure", не работает.
- Служба шлюза испытывает проблемы с подключением к служебной шине, концентратору событий или учетной записи хранения устройства.

**Определение точной причины для Диспосеартефактстимедаут и соответствующего разрешения:**

1. Убедитесь, что устройство Миграции Azure включено и работает.
2. Проверьте, запущена ли на устройстве служба шлюза:
   1.  Войдите на устройство миграции Azure с помощью удаленного рабочего стола и выполните следующие действия.

   2.  Откройте оснастку MMC "службы Microsoft" (запустите > Services. msc) и проверьте, запущена ли служба шлюза Microsoft Azure. Если служба остановлена или не запущена, запустите ее. Кроме того, можно открыть командную строку или PowerShell и выполнить следующую команду: "net start асргви"

3. Проверьте наличие проблем с подключением между устройством "миграция Azure" и учетной записью хранилища устройства: 

    Выполните следующую команду после загрузки azcopy в устройстве "миграция Azure":
    
    _azcopy Bench HTTPS://[учетная запись]. BLOB. Core. Windows. NET/[контейнер]? ЖЕСТКИХ_
    
    **Шаги для запуска теста производительности:**
    
      1. [Скачать](../storage/common/storage-use-azcopy-v10.md) azcopy
        
      2. Найдите учетную запись хранения устройства в группе ресурсов. Имя учетной записи хранения напоминает мигратегвса \* \* \* \* \* \* \* \* \* \* . Это значение параметра [account] в приведенной выше команде.
        
      3. Выполните поиск учетной записи хранения в портал Azure. Убедитесь, что подписка, используемая для поиска, является той же подпиской (целевой подпиской), в которой создана учетная запись хранения. Перейдите в раздел "контейнеры" в разделе "Служба BLOB-объектов". Щелкните + Container (+ контейнер) и создайте контейнер. Оставить общедоступный уровень доступа выбранным значением по умолчанию.
        
      4. Перейдите к подписанному общему доступу в разделе "Параметры". Выберите контейнер в списке разрешенный тип ресурса. Щелкните Создать SAS и строку подключения. Скопируйте значение SAS.
        
      5. Выполните указанную выше команду в командной строке, заменив учетную запись, контейнер, SAS на значения, полученные в шагах 2, 3 и 4 соответственно.
        
      Кроме того, [Скачайте](https://go.microsoft.com/fwlink/?linkid=2138967) Обзор службы хранилища Azure на устройство и попытайтесь отправить 10 больших двоичных объектов размером от ~ 64 МБ в учетные записи хранения. Если проблем нет, передача должна быть выполнена успешно.
        
    **Решение:** Если этот тест завершается сбоем,&#39;проблемы с сетью. Обратитесь к группе локальных сетей, чтобы проверить проблемы с подключением. Как правило, возможны некоторые параметры брандмауэра, вызывающие сбои.
    
4.  Проверьте наличие проблем с подключением между устройством "миграция Azure" и служебной шиной:

    Этот тест проверяет, может ли устройство Azure Migrate взаимодействовать с серверной частью облачной службы "миграция Azure". Устройство взаимодействует с серверной частью службы через очереди сообщений служебной шины и концентратора событий. Чтобы проверить подключение устройства к служебной шине, [Скачайте](https://go.microsoft.com/fwlink/?linkid=2139104) обозреватель служебной шины, попытайтесь подключиться к служебной шине устройства и выполнить отправку сообщения или получения сообщения. Если проблем нет, это должно быть успешным.

    **Шаги для выполнения теста:**

    1. Скопируйте строку подключения из служебной шины, созданной в проекте миграции.
    2. Открытие обозревателя служебной шины
    3. Перейдите к файлу и подключитесь
    4. Вставьте строку подключения и нажмите кнопку Подключить.
    5. Откроется пространство имен служебной шины
    6. Выберите Snapshot Manager в разделе. Щелкните правой кнопкой мыши Snapshot Manager, выберите "получение сообщений" > выберите "Просмотр" и нажмите кнопку "ОК".
    7. Если подключение установлено успешно, в выходных данных консоли появится сообщение "[x] получено сообщений". Если подключение не прошло успешно, вы увидите сообщение о том, что подключение не выполнено.
    
    **Решение:** В случае сбоя этого теста возникает проблема с сетью. Обратитесь к группе локальных сетей, чтобы проверить проблемы с подключением. Как правило, возможны некоторые параметры брандмауэра, вызывающие сбои.

5. Проблемы с подключением между устройством "миграция Azure" и Azure Key Vault:

    Этот тест проверяет наличие проблем с подключением между устройством "миграция Azure" и Azure Key Vault. Key Vault используется для управления доступом к учетной записи хранения, используемой для репликации.
    
    **Действия для проверки подключения:**
    
    1. Извлеките Key Vault URI из списка ресурсов в группе ресурсов, соответствующей проекту службы "миграция Azure".
    
    1. Откройте PowerShell на устройстве "миграция Azure" и выполните следующую команду:
    
    _Test-NetConnection Key Vault URI-P 443_
    
    Эта команда попытается установить TCP-соединение и вернет выходные данные.
    
     - В выходных данных проверьте поле "_значение tcptestsucceeded_". Если значение равно "_true_", между устройством "миграция Azure" и Azure Key Vault не возникает проблем с подключением. Если значение равно false, возникает ошибка подключения.
    
    **Решение:** Если этот тест завершается сбоем, возникает проблема с подключением между устройством "миграция Azure" и Azure Key Vault. Обратитесь к группе локальных сетей, чтобы проверить проблемы с подключением. Как правило, возможны некоторые параметры брандмауэра, вызывающие сбои.
    
## <a name="diskuploadtimedout"></a>дискуплоадтимедаут

**Идентификатор ошибки:** 1011

**Сообщение об ошибке:** Отправка данных для диска Дискпас, DiskId виртуальной машины VMName; VMId не завершился в течение ожидаемого времени.

Эта ошибка обычно указывает на то, что устройство, выполняющее миграцию Azure, не может подключиться к облачным службам Azure или что репликация выполняется медленно, что приводит к истечению времени ожидания цикла репликации.

Возможные причины:

- Устройство "миграция Azure" не работает.
- Служба шлюза репликации на устройстве не запущена.
- В службе шлюза репликации возникли проблемы с подключением к одному из следующих компонентов службы Azure, которые используются для репликации: служебная шина/концентратор событий/учетная запись хранения кэша Azure/Azure Key Vault.
- Служба шлюза регулируется на уровне vCenter при попытке чтения с диска.

**Определение основной причины и устранение проблемы:**

1. Убедитесь, что устройство Миграции Azure включено и работает.
2. Проверьте, запущена ли на устройстве служба шлюза:
   1.  Войдите на устройство миграции Azure с помощью удаленного рабочего стола и выполните следующие действия.

   2.  Откройте оснастку MMC "службы Microsoft" (запустите > Services. msc) и проверьте, запущена ли служба шлюза Microsoft Azure. Если служба остановлена или не запущена, запустите ее. Кроме того, можно открыть командную строку или PowerShell и выполнить следующую команду: "net start асргви".


3. **Проверьте наличие проблем с подключением между устройством "миграция Azure" и учетной записью хранения кэша:** 

    Выполните следующую команду после загрузки azcopy в устройстве "миграция Azure":
    
    _azcopy Bench HTTPS://[учетная запись]. BLOB. Core. Windows. NET/[контейнер]? ЖЕСТКИХ_
    
    **Шаги для запуска теста производительности:**
    
      1. [Скачать](../storage/common/storage-use-azcopy-v10.md) azcopy
        
      2. Найдите учетную запись хранения устройства в группе ресурсов. Имя учетной записи хранения напоминает мигрателса \* \* \* \* \* \* \* \* \* \* . Это значение параметра [account] в приведенной выше команде.
        
      3. Выполните поиск учетной записи хранения в портал Azure. Убедитесь, что подписка, используемая для поиска, является той же подпиской (целевой подпиской), в которой создана учетная запись хранения. Перейдите в раздел "контейнеры" в разделе "Служба BLOB-объектов". Щелкните + Container (+ контейнер) и создайте контейнер. Оставить общедоступный уровень доступа выбранным значением по умолчанию.
        
      4. Перейдите к подписанному общему доступу в разделе "Параметры". Выберите контейнер в списке разрешенный тип ресурса. Щелкните Создать SAS и строку подключения. Скопируйте значение SAS.
        
      5. Выполните указанную выше команду в командной строке, заменив учетную запись, контейнер, SAS на значения, полученные в шагах 2, 3 и 4 соответственно.
        
      Кроме того, [Скачайте](https://go.microsoft.com/fwlink/?linkid=2138967) Обзор службы хранилища Azure на устройство и попытайтесь отправить 10 больших двоичных объектов размером от ~ 64 МБ в учетные записи хранения. Если проблем нет, передача должна быть выполнена успешно.
        
    **Решение:** Если этот тест завершается сбоем,&#39;проблемы с сетью. Обратитесь к группе локальных сетей, чтобы проверить проблемы с подключением. Как правило, возможны некоторые параметры брандмауэра, вызывающие сбои.
                
4.  **Проблемы с подключением между устройством "миграция Azure" и служебной шиной Azure:**

    Этот тест проверит, может ли устройство для миграции Azure обмениваться данными с серверной частью облачной службы "миграция Azure". Устройство взаимодействует с серверной частью службы через очереди сообщений служебной шины и концентратора событий. Чтобы проверить подключение устройства к служебной шине, [Скачайте](https://go.microsoft.com/fwlink/?linkid=2139104) обозреватель служебной шины, попытайтесь подключиться к служебной шине устройства и выполнить отправку сообщения или получения сообщения. Если проблем нет, это должно быть успешным.

    **Шаги для выполнения теста:**
    
    1. Скопируйте строку подключения из служебной шины, созданной в группе ресурсов, соответствующей проекту службы "миграция Azure".
    
    1. Открыть обозреватель служебной шины
    
    1. Выберите файл > подключить.
    
    1. Вставьте строку подключения, скопированную на шаге 1, и нажмите кнопку Подключить.
    
    1. Откроется пространство имен служебной шины.
    
    1. Выберите Snapshot Manager в разделе пространство имен. Щелкните правой кнопкой мыши Snapshot Manager, выберите "получение сообщений" > выберите "Просмотр" и нажмите кнопку "ОК".
    
    Если подключение установлено успешно, в выходных данных консоли появится сообщение "[x] получено сообщений". Если подключение не выполнено, вы увидите сообщение о том, что соединение не удалось.
    
    **Решение:** Если этот тест завершается сбоем, возникает проблема с подключением между устройством миграции Azure и служебной шиной. Обратитесь к группе локальных сетей, чтобы проверить эти проблемы с подключением. Как правило, возможны некоторые параметры брандмауэра, вызывающие сбои.
    
 5. **Проблемы с подключением между устройством "миграция Azure" и Azure Key Vault:**

    Этот тест проверяет наличие проблем с подключением между устройством "миграция Azure" и Azure Key Vault. Key Vault используется для управления доступом к учетной записи хранения, используемой для репликации.
    
    **Действия для проверки подключения:**
    
    1. Извлеките Key Vault URI из списка ресурсов в группе ресурсов, соответствующей проекту службы "миграция Azure".
    
    1. Откройте PowerShell на устройстве "миграция Azure" и выполните следующую команду:
    
    _Test-NetConnection Key Vault URI-P 443_
    
    Эта команда попытается установить TCP-соединение и вернет выходные данные.
    
    1. В выходных данных проверьте поле "_значение tcptestsucceeded_". Если значение равно "_true_", между устройством "миграция Azure" и Azure Key Vault не возникает проблем с подключением. Если значение равно false, возникает ошибка подключения.
    
    **Решение:** Если этот тест завершается сбоем, возникает проблема с подключением между устройством "миграция Azure" и Azure Key Vault. Обратитесь к группе локальных сетей, чтобы проверить проблемы с подключением. Как правило, возможны некоторые параметры брандмауэра, вызывающие сбои.
    
## <a name="encountered-an-error-while-trying-to-fetch-changed-blocks"></a>При попытке получить измененные блоки произошла ошибка

Сообщение об ошибке: "обнаружена ошибка при попытке получить блоки изменений"

Метод репликации без агента использует измененную технологию отслеживания блоков (CBT) VMware для репликации данных в Azure. CBT позволяет средству миграции сервера вести мониторинг и реплицировать только те блоки, которые были изменены с момента последнего цикла репликации. Эта ошибка возникает при сбросе отслеживания измененных блоков для реплицируемой виртуальной машины или повреждении файла отслеживания измененных блоков.

Эту ошибку можно устранить двумя способами:

- Если вы выбрали вариант "автоматическое восстановление репликации", выбрав "Да" при активации репликации виртуальной машины, средство попытается восстановить ее. Щелкните виртуальную машину правой кнопкой мыши и выберите команду "восстановить репликацию".
- Если вы не настроили автоматическое восстановление репликации или указанный выше шаг вам не подходит, то для этого нужно отключить репликацию для виртуальной машины, [сбросить измененное отслеживание блокировки](https://go.microsoft.com/fwlink/?linkid=2139203) на виртуальной машине, а затем повторно настроить репликацию.

Одна из известных проблем, которая может привести к CBT сбросу виртуальной машины на VMware vSphere 5,5, описана в статье [VMware KB 2048201: измененное отслеживание блокировки](https://go.microsoft.com/fwlink/?linkid=2138888) сбрасывается после операции VMotion хранилища в vSphere 5. x. Если вы используете VMware vSphere 5.5, убедитесь, что вы применили обновления, перечисленные в этой статье базы знаний.

Кроме того, вы можете сбросить отслеживание измененных блоков VMware на виртуальной машине с помощью VMware PowerCLI.

## <a name="an-internal-error-occurred"></a>Произошла внутренняя ошибка

Иногда может возникнуть ошибка, возникающая из-за проблем в среде или API VMware. Мы определили следующий набор ошибок в качестве ошибок, связанных с средой VMware. Эти ошибки имеют фиксированный формат.

_Сообщение об ошибке: произошла внутренняя ошибка. [Сообщение об ошибке]_

Например: сообщение об ошибке: произошла внутренняя ошибка. [Обнаружена недопустимая конфигурация моментального снимка].

В следующем разделе перечислены некоторые из часто встречающихся ошибок VMware, а также способы их устранения.

### <a name="error-message-an-internal-error-occurred-server-refused-connection"></a>Сообщение об ошибке: произошла внутренняя ошибка. [Отказано в подключении к серверу]

Проблема — это известная проблема VMware, которая возникает в ВДДК 6,7. Необходимо отключить службу шлюза, работающую на устройстве "миграция Azure", [скачать обновление из VMware KB](https://go.microsoft.com/fwlink/?linkid=2138889)и перезапустить службу шлюза.

Действия для завершения службы шлюза:

1. Нажмите Windows + R, откройте Services. msc. Щелкните "Служба шлюза Microsoft Azure" и закройте ее.
2. Кроме того, можно открыть командную строку или PowerShell и выполнить следующую команду: NET асргви. Убедитесь, что вы ждете, пока не получите сообщение о том, что служба больше не работает.

Инструкции по запуску службы шлюза:

1. Нажмите Windows + R, откройте Services. msc. Щелкните правой кнопкой мыши "Microsoft Azure служба шлюза" и запустите ее.
2. Кроме того, можно открыть командную строку или PowerShell и выполнить следующую команду: net start асргви.

### <a name="error-message-an-internal-error-occurred-an-invalid-snapshot-configuration-was-detected"></a>Сообщение об ошибке: произошла внутренняя ошибка. [Обнаружена недопустимая конфигурация моментального снимка. ']

Если у вас есть виртуальная машина с несколькими дисками, эта ошибка может возникать при удалении диска из виртуальной машины. Чтобы устранить эту проблему, ознакомьтесь с инструкциями в [этой статье VMware](https://go.microsoft.com/fwlink/?linkid=2138890).

### <a name="error-message-an-internal-error-occurred-generate-snapshot-hung"></a>Сообщение об ошибке: произошла внутренняя ошибка. [Создать замедление моментального снимка]

Эта проблема возникает, когда создание моментального снимка перестает отвечать на запросы. При возникновении этой проблемы можно увидеть, что задача создания моментального снимка останавливается на 95% или 99%. Чтобы преодолеть эту ошибку, обратитесь к этой статье о [VMware](https://go.microsoft.com/fwlink/?linkid=2138969) .

### <a name="error-message-an-internal-error-occurred-failed-to-consolidate-the-disks-on-vm-_reasons_"></a>Сообщение об ошибке: произошла внутренняя ошибка. [Не удалось консолидировать диски на виртуальной машине _[причины]_]

При консолидации дисков в конце цикла репликации операция завершается ошибкой. Следуйте инструкциям в [VMware KB](https://go.microsoft.com/fwlink/?linkid=2138970) , выбрав соответствующую _причину_ для устранения проблемы.

При выполнении операций, связанных с моментальным снимком VMware, возникают следующие ошибки: создание, удаление или консолидация дисков завершается сбоем. Следуйте указаниям в следующем разделе, чтобы исправить ошибки.

### <a name="error-message-an-internal-error-occurred-another-task-is-already-in-progress"></a>Сообщение об ошибке: произошла внутренняя ошибка. [Уже выполняется другая задача]

Эта проблема возникает при наличии конфликтующих задач виртуальной машины, выполняемых в фоновом режиме, или при истечении времени ожидания задачи в vCenter Server. Выполните разрешение, приведенное в следующих [статьях по VMware KB](https://go.microsoft.com/fwlink/?linkid=2138891).

### <a name="error-message-an-internal-error-occurred-operation-not-allowed-in-current-state"></a>Сообщение об ошибке: произошла внутренняя ошибка. [Операция запрещена в текущем состоянии]

Эта проблема возникает, когда vCenter Server агенты управления перестают работать. Чтобы устранить эту проблему, ознакомьтесь с разрешениями в следующей статье по [VMware KB](https://go.microsoft.com/fwlink/?linkid=2138971).

### <a name="error-message-an-internal-error-occurred-snapshot-disk-size-invalid"></a>Сообщение об ошибке: произошла внутренняя ошибка. [Размер диска моментального снимка недопустим]

Это известная проблема VMware, при которой размер диска, указанный моментальным снимком, становится нулевым. Следуйте разрешению, заданному в [VMware KB](https://go.microsoft.com/fwlink/?linkid=2138972).

### <a name="error-message-an-internal-error-occurred-memory-allocation-failed-out-of-memory"></a>Сообщение об ошибке: произошла внутренняя ошибка. [Выделение памяти завершилось ошибкой. Недостаточно памяти.]

Это происходит, когда буферу узла NFC не хватает памяти. Чтобы устранить эту проблему, необходимо переместить виртуальную машину (COMPUTE vMotion) на другой узел, который содержит свободные ресурсы.

## <a name="next-steps"></a>Next Steps

Продолжите репликацию виртуальной машины и выполните [тестовую миграцию](./tutorial-migrate-vmware.md#run-a-test-migration).
