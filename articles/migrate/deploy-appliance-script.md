---
title: Настройка устройства "миграция Azure" с помощью сценария
description: Узнайте, как настроить устройство для миграции Azure с помощью сценария.
ms.topic: article
ms.date: 04/16/2020
ms.openlocfilehash: 6b0637019e40308cf40dcdbb4dc78512a8aa91e8
ms.sourcegitcommit: 3792cf7efc12e357f0e3b65638ea7673651db6e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91438924"
---
# <a name="set-up-an-appliance-with-a-script"></a>Настройка устройства с помощью сценария

Выполните инструкции из этой статьи, чтобы создать [устройство миграции Azure](./migrate-appliance-architecture.md) для оценки и миграции виртуальных машин VMware и виртуальных машин Hyper-V. Запустите сценарий для создания устройства и убедитесь, что он может подключиться к Azure. 

Вы можете развернуть устройство для виртуальных машин VMware и Hyper-V с помощью сценария или с помощью шаблона, скачанного из портал Azure. Использование скрипта полезно, если не удается создать виртуальную машину с помощью скачанного шаблона.

- Чтобы использовать шаблон, следуйте инструкциям в руководствах по [VMware](tutorial-prepare-vmware.md) или [Hyper-V](tutorial-prepare-hyper-v.md).
- Чтобы настроить устройство для физических серверов, можно использовать только скрипт. Выполните инструкции из [этой статьи](how-to-set-up-appliance-physical.md).
- Чтобы настроить устройство в облаке Azure для государственных организаций, выполните инструкции из [этой статьи](deploy-appliance-script-government.md).

## <a name="prerequisites"></a>Предварительные требования

Этот сценарий настраивает устройство миграции Azure на существующем физическом компьютере или виртуальной машине.

- Компьютер, который будет работать как устройство, должен соответствовать следующим требованиям к оборудованию и ОС:

Сценарий | Требования
--- | ---
VMware | Windows Server 2016 с 32 ГБ памяти, восемь виртуальных ЦП, около 80 ГБ дискового накопителя
Hyper-V | Windows Server 2016 с 16 ГБ памяти, восемь виртуальных ЦП, около 80 ГБ дискового накопителя
- Компьютеру также нужен внешний виртуальный коммутатор. Для этого требуется статический или динамический IP-адрес, а также доступ к Интернету.
- Перед развертыванием устройства ознакомьтесь с подробными сведениями о требованиях к устройству для [виртуальных машин VMware](migrate-appliance.md#appliance---vmware), [виртуальных машин Hyper-V](migrate-appliance.md#appliance---hyper-v).
- Не запускайте сценарий на существующем устройстве миграции Azure.

## <a name="set-up-the-appliance-for-vmware"></a>Настройка устройства для VMware

Чтобы настроить устройство для VMware, скачайте сжатый ZIP-файл с именем AzureMigrateInstaller-Server-Public.zip с портала или [отсюда](https://go.microsoft.com/fwlink/?linkid=2140334), и извлеките содержимое. Запустите сценарий PowerShell, чтобы запустить веб-приложение устройства. Настройте устройство и настройте его в первый раз. Затем вы регистрируете устройство в проекте службы "миграция Azure".


### <a name="verify-file-security"></a>Проверка безопасности файлов

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Например, ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller-VMware-Public.zip SHA256```.
3. Проверьте последнюю версию и скрипт устройства для общедоступного облака Azure:

    **Алгоритм** | **Загрузить** | **SHA256**
    --- | --- | ---
    VMware (85,8 МБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2116601) | 85b74d93dfcee43412386141808d82147916330e6669df94c7969fe1b3d0fe72



### <a name="run-the-script"></a>Выполнение скрипта

Вот что делает сценарий:

- Устанавливает агенты и веб-приложение.
- Устанавливает роли Windows, включая службу активации Windows, IIS и интегрированную среду сценариев PowerShell.
- Скачивает и устанавливает перезаписываемый модуль IIS. [Подробнее.](https://www.microsoft.com/download/details.aspx?id=7435)
- Обновляет раздел реестра (HKLM) с постоянными параметрами для службы "миграция Azure".
- Создает файлы журналов и конфигурации следующим образом:
    - **Файлы конфигурации**:%програмдата%\микрософт азуре\конфиг
    - **Файлы журналов**:%програмдата%\микрософт азуре\логс

Выполните следующее, чтобы запустить этот сценарий.

1. Извлеките сжатый ZIP-файл в папку на компьютере, на котором будет размещено устройство. Убедитесь, что скрипт не выполняется на виртуальной машине в существующем устройстве Миграции Azure.
2. Запустите PowerShell на компьютере с привилегиями администратора (с повышенными правами).
3. Измените каталог PowerShell на папку, содержащую содержимое, извлеченное из скачанного ZIP-файла.
4. Выполните **AzureMigrateInstaller.ps1**скрипта следующим образом:

    ``` PS C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-Public> .\AzureMigrateInstaller.ps1 -scenario VMware ```
   
5. После успешного выполнения скрипта запускается веб-приложение устройства, которое позволяет настроить устройство. При возникновении проблем просмотрите журналы скриптов в файла c:\ProgramData\Microsoft Азуре\логс\ AzureMigrateScenarioInstaller_<em>timestamp</em>. log.

### <a name="verify-access"></a>Проверка доступа

Убедитесь, что устройство может подключаться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака.

## <a name="set-up-the-appliance-for-hyper-v"></a>Настройка устройства для Hyper-V

Чтобы настроить устройство для Hyper-V, скачайте сжатый ZIP-файл с именем AzureMigrateInstaller-Server-Public.zip с портала или [отсюда](https://go.microsoft.com/fwlink/?linkid=2105112), и извлеките содержимое. Запустите сценарий PowerShell, чтобы запустить веб-приложение устройства. Настройте устройство и настройте его в первый раз. Затем вы регистрируете устройство в проекте службы "миграция Azure".


### <a name="verify-file-security"></a>Проверка безопасности файлов

Прежде чем развертывать сжатый ZIP-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Например, ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-HyperV.zip SHA256```.

3. Проверьте последнюю версию и скрипт устройства для общедоступного облака Azure:

    **Сценарий** | **Загрузить** | **SHA256**
    --- | --- | ---
    Hyper-V (85,8 МБ) | [Последняя версия](https://go.microsoft.com/fwlink/?linkid=2116657) |  9bbef62e2e22481eda4b77c7fdf05db98c3767c20f0a873114fb0dcfa6ed682a

### <a name="run-the-script"></a>Выполнение скрипта

Вот что делает сценарий:

- Устанавливает агенты и веб-приложение.
- Устанавливает роли Windows, включая службу активации Windows, IIS и интегрированную среду сценариев PowerShell.
- Скачивает и устанавливает перезаписываемый модуль IIS. [Подробнее.](https://www.microsoft.com/download/details.aspx?id=7435)
- Обновляет раздел реестра (HKLM) с постоянными параметрами для службы "миграция Azure".
- Создает файлы журналов и конфигурации следующим образом:
    - **Файлы конфигурации**:%програмдата%\микрософт азуре\конфиг
    - **Файлы журналов**:%програмдата%\микрософт азуре\логс

Выполните следующее, чтобы запустить этот сценарий.

1. Извлеките сжатый ZIP-файл в папку на компьютере, на котором будет размещено устройство. Убедитесь, что скрипт не выполняется на виртуальной машине в существующем устройстве Миграции Azure.
2. Запустите PowerShell на компьютере с привилегиями администратора (с повышенными правами).
3. Измените каталог PowerShell на папку, содержащую содержимое, извлеченное из скачанного ZIP-файла.
4. Выполните **AzureMigrateInstaller.ps1**скрипта следующим образом: 

    ``` PS C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-Public> .\AzureMigrateInstaller.ps1 -scenario Hyperv ```
   
5. После успешного выполнения скрипта запускается веб-приложение устройства, которое позволяет настроить устройство. При возникновении проблем просмотрите журналы скриптов в файла c:\ProgramData\Microsoft Азуре\логс\ AzureMigrateScenarioInstaller_<em>timestamp</em>. log.

### <a name="verify-access"></a>Проверка доступа

Убедитесь, что устройство может подключаться к URL-адресам Azure для [общедоступного](migrate-appliance.md#public-cloud-urls) облака.

## <a name="next-steps"></a>Следующие шаги

После развертывания устройства необходимо настроить его в первый раз и зарегистрировать в проекте службы "миграция Azure".

- Настройте устройство для [VMware](how-to-set-up-appliance-vmware.md#configure-the-appliance).
- Настройте устройство для [Hyper-V](how-to-set-up-appliance-hyper-v.md#configure-the-appliance).
