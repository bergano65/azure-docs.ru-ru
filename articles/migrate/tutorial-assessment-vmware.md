---
title: Обнаружение и оценка локальных виртуальных машин VMware для миграции в Azure с помощью службы "Миграция Azure" | Документация Майкрософт
description: В этой статье описывается, как обнаруживать и оценивать локальные виртуальные машины VMware для миграции в Azure с помощью службы "Миграция Azure".
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: tutorial
ms.date: 01/11/2019
ms.author: raynew
ms.custom: mvc
ms.openlocfilehash: 186d532f159db7d51ba4f93a250c00c7627280e0
ms.sourcegitcommit: a512360b601ce3d6f0e842a146d37890381893fc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/11/2019
ms.locfileid: "54229530"
---
# <a name="discover-and-assess-on-premises-vmware-vms-for-migration-to-azure"></a>Обнаружение и оценка локальных виртуальных машин VMware для миграции в Azure

Службы [Миграция Azure](migrate-overview.md) выполняют оценку локальных рабочих нагрузок для миграции в Azure.

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создайте учетную запись, которую служба "Миграция Azure" будет использовать для обнаружения локальных виртуальных машин.
> * Создайте проект службы "Миграция Azure".
> * Настройте локальную виртуальную машину сборщика для обнаружения локальных виртуальных машин VMware для оценки.
> * Сгруппируйте виртуальные машины и создайте оценку.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/pricing/free-trial/), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

- **VMware**. Управление виртуальными машинами, которые планируется перенести, должно осуществляться с помощью vCenter Server версии 5.5, 6.0 или 6.5. Кроме того, необходим один узел ESXi версии 5.0 или более поздней для развертывания виртуальной машины сборщика.
- **Учетная запись vCenter Server**. Для доступа к серверу vCenter Server требуется учетная запись, предназначенная только для чтения. Служба "Миграция Azure" использует эту учетную запись для обнаружения локальных виртуальных машин.
- **Разрешения**. На сервере vCenter Server вам потребуются разрешения для создания виртуальной машины путем импорта OVA-файла.

## <a name="create-an-account-for-vm-discovery"></a>Создание учетной записи для обнаружения виртуальной машины

Службе "Миграция Azure" необходим доступ к серверам VMware для автоматического обнаружения виртуальных машин для оценки. Создайте учетную запись VMware со следующими свойствами. Вы укажете эту учетную запись во время установки службы "Миграция Azure".

- Тип пользователя: Пользователь только для чтения (минимум).
- Разрешения. Объект центра обработки данных –> Распространение на дочерний объект, роль Read-only
- Сведения. Пользователь назначается на уровне центра обработки данных и поэтому имеет доступ ко всем объектам в центре обработки данных.
- Если нужно ограничить доступ, назначьте дочерним объектам (узлы vSphere, хранилища данных, виртуальные машины и сети) роль "Без доступа" с параметром "Распространить на дочерний объект".


## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портале Azure](https://portal.azure.com).

## <a name="create-a-project"></a>Создание проекта

1. На портале Azure щелкните **Создать ресурс**.
2. Выполните поиск по фразе **Миграция Azure** и в результатах поиска выберите службу **Миграция Azure**. Затем щелкните **Создать**.
3. Укажите имя проекта и подписку Azure для него.
4. Создайте новую группу ресурсов.
5. Укажите регион для создания проекта и нажмите кнопку **Создать**. Проект службы "Миграция Azure" можно создать только в следующих географических регионах. При этом по-прежнему можно планировать перенос в любое целевое расположение Azure. Метаданные, собранные с локальных виртуальных машин, хранятся только в регионе, который задан для проекта.

**География** | **Место хранения**
--- | ---
Azure Government | Правительство штата Вирджиния
Азия | Юго-Восточная Азия
Европа | Северная или Западная Европа
США | Восточная или центрально-западная часть США

![Служба "Миграция Azure"](./media/tutorial-assessment-vmware/project-1.png)


## <a name="download-the-collector-appliance"></a>Скачивание модуля сборщика

Служба "Миграция Azure" создает локальную виртуальную машину, известную как модуль сборщика. Эта виртуальная машина обнаруживает локальные виртуальные машины VMware и отправляет метаданные о них в службу "Миграция Azure". Чтобы настроить модуль сборщика, скачайте OVA-файл и импортируйте его на локальный сервер vCenter Server для создания виртуальной машины.

1. В проекте службы "Миграция Azure" щелкните **Начало работы** > **Обнаружение и оценка** > **Обнаружение компьютеров**.
2. В окне **Обнаружение компьютеров** щелкните **Скачать**, чтобы скачать устройство.

    Устройство для службы "Миграция Azure" взаимодействует с vCenter Server и постоянно профилирует локальную среду, чтобы собрать данные об использовании в реальном времени по каждой виртуальной машине. Оно собирает данные счетчиков пиковых значений по каждой метрике (использование ЦП, памяти и т. д.). Эта модель не зависит от параметров статистики vCenter Server для сбора данных о производительности. Функцию непрерывного профилирования можно отключить в самом модуле.

    > [!NOTE]
    > Устройство однократного обнаружения не рекомендуют использовать, поскольку этот метод полагался на параметры статистик vCenter Server для доступности точки данных производительности и собранных средних счетчиков производительности, которые привели к превышению размера виртуальных машин для миграции в Azure.

    **Мгновенное вознаграждение.** После завершения обнаружения (занимает несколько часов в зависимости от количества виртуальных машин) с помощью устройства непрерывного обнаружения можно сразу же создать оценки. Сбор данных производительности начинается с момента запуска обнаружения, если вы ищете мгновенное вознаграждение, следует выбрать условие определения размера в оценке как *локальное*. Для оценки на основе производительности рекомендуется после запуска обнаружения подождать по крайней мере один день, чтобы получить рекомендации по выбору надежного размера.

    Устройство только непрерывно собирает данные о производительности. Оно не обнаруживает изменения конфигурации в локальной среде (например, добавление, удаление виртуальной машины, добавление диска и т. д.). Если в локальной среде была изменена конфигурация и вам нужно отразить эти изменения на портале, сделайте следующее:

    - Добавление элементов (виртуальных машин, дисков, ядер и т. д.). Чтобы отразить эти изменения на портале Azure, вы можете остановить обнаружение с модуля, а затем запустить его снова. Это позволит обновить изменения в проекте "Миграция Azure".

    - Удаление виртуальных машин. Из-за особенностей конструкции модуля удаление виртуальных машин не отражается даже при остановке и повторном запуске обнаружения. Это связано с тем, что данные из последующих обнаружений добавляются к более старым обнаружениям, а не переопределяются. В этом случае вы можете просто игнорировать виртуальную машину на портале, удалив ее из своей группы и пересчитав оценку.


3. В окне **Копирование учетных данных проекта** скопируйте идентификатор и ключ проекта. Они потребуются при настройке сборщика.

    ![Скачивание OVA-файла](./media/tutorial-assessment-vmware/download-ova.png)

### <a name="verify-the-collector-appliance"></a>Проверка модуля сборщика

Прежде чем развертывать OVA-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш OVA-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример использования: ```C:\>CertUtil -HashFile C:\AzureMigrate\AzureMigrate.ova SHA256```
3. Созданный хэш должен соответствовать этим параметрам.

#### <a name="continuous-discovery"></a>Непрерывное обнаружение

  Для OVA-файла версии 1.0.10.9

  **Алгоритм** | **Значение хэша**
  --- | ---
  MD5 | 169f6449cc1955f1514059a4c30d138b
  SHA1 | f8d0a1d40c46bbbf78cd0caa594d979f1b587c8f
  SHA256 | d68fe7d94be3127eb35dd80fc5ebc60434c8571dcd0e114b87587f24d6b4ee4d

  Для OVA-файла версии 1.0.10.4

  **Алгоритм** | **Значение хэша**
  --- | ---
  MD5 | 2ca5b1b93ee0675ca794dd3fd216e13d
  SHA1 | 8c46a52b18d36e91daeae62f412f5cb2a8198ee5
  SHA256 | 3b3dec0f995b3dd3c6ba218d436be003a687710abab9fcd17d4bdc90a11276be


#### <a name="one-time-discovery-deprecated-now"></a>Однократное обнаружение (не рекомендуемое сейчас)

Использовать эту модель не рекомендуется, поддержка будет предоставляться существующим устройствам.

  Для OVA-файла версии 1.0.9.15

  **Алгоритм** | **Значение хэша**
  --- | ---
  MD5 | e9ef16b0c837638c506b5fc0ef75ebfa
  SHA1 | 37b4b1e92b3c6ac2782ff5258450df6686c89864
  SHA256 | 8a86fc17f69b69968eb20a5c4c288c194cdcffb4ee6568d85ae5ba96835559ba

  Для OVA-файла версии 1.0.9.14

  **Алгоритм** | **Значение хэша**
  --- | ---
  MD5 | 6d8446c0eeba3de3ecc9bc3713f9c8bd
  SHA1 | e9f5bdfdd1a746c11910ed917511b5d91b9f939f
  SHA256 | 7f7636d0959379502dfbda19b8e3f47f3a4744ee9453fc9ce548e6682a66f13c

  Для OVA-файла версии 1.0.9.12

  **Алгоритм** | **Значение хэша**
  --- | ---
  MD5 | d0363e5d1b377a8eb08843cf034ac28a
  SHA1 | df4a0ada64bfa59c37acf521d15dcabe7f3f716b
  SHA256 | f677b6c255e3d4d529315a31b5947edfe46f45e4eb4dbc8019d68d1d1b337c2e

## <a name="create-the-collector-vm"></a>Создание виртуальной машины сборщика

Импортируйте скачанный файл на сервер vCenter Server.

1. В консоли клиента vSphere щелкните **File** (Файл)  >  **Deploy OVF Template** (Развернуть шаблон OVF).

    ![Развертывание шаблона OVF](./media/tutorial-assessment-vmware/vcenter-wizard.png)

2. В мастере развертывания шаблона OVF выберите **Source** (Источник) и укажите расположение OVA-файла.
3. В полях**Name** (Имя) и **Location** (Расположение) укажите понятное имя виртуальной машины сборщика и объект инвентаризации, в котором будет размещена эта виртуальная машина.
5. В поле **Host/Cluster** (Узел или кластер) укажите узел или кластер, в котором будет выполняться виртуальная машина сборщика.
7. В поле "Storage" (Хранилище) укажите место хранения данных виртуальной машины сборщика.
8. В поле **Disk Format** (Формат диска) укажите тип и размер диска.
9. В поле **Network Mapping** (Сетевое сопоставление) укажите сеть, к которой будет подключена виртуальная машина сборщика. Этой сети требуется подключение к Интернету для отправки метаданных в Azure.
10. Просмотрите и подтвердите параметры, а затем нажмите кнопку **Finish** (Готово).

## <a name="run-the-collector-to-discover-vms"></a>Запуск сборщика для обнаружения виртуальных машин

1. В консоли клиента vSphere щелкните правой кнопкой мыши виртуальную машину и выберите **Open Console** (Открыть консоль).
2. Укажите язык, часовой пояс и параметры пароля для модуля.
3. На рабочем столе щелкните ярлык **Run collector** (Запустить сборщик).
4. Щелкните **Проверка обновлений** на верхней панели пользовательского интерфейса сборщика и убедитесь, что запущен сборщик последней версии. В противном случае вы можете загрузить последнюю версию пакета обновления по ссылке и обновить сборщик.
5. В сборщике службы "Миграция Azure" откройте раздел **Set Up Prerequisites** (Настройка предварительных требований).
    - Выберите облако Azure, на которое вы планируете перейти (глобальное облако Azure или Azure для государственных организаций).
    - Примите условия лицензии и прочитайте информацию от сторонних производителей.
    - Сборщик проверит наличие доступа к Интернету у виртуальной машины.
    - Если виртуальная машина подключена к Интернету через прокси-сервер, щелкните **Proxy settings** (Параметры прокси-сервера) и укажите адрес и порт прослушивания прокси-сервера. Укажите учетные данные, если для прокси-сервера требуется аутентификация. [Дополнительные сведения](https://docs.microsoft.com/azure/migrate/concepts-collector#collector-prerequisites) о требованиях к интернет-подключению и [список URL-адресов](https://docs.microsoft.com/azure/migrate/concepts-collector#connect-to-urls), к которым обращается сборщик.

      > [!NOTE]
      > Адрес прокси-сервера нужно ввести в формате http://ProxyIPAddress или http://ProxyFQDN. Поддерживается только прокси-сервер HTTP. При наличии перехватывающего прокси-сервера подключение к Интернету может завершиться ошибкой, если вы не импортировали сертификат прокси-сервера. См. дополнительные сведения о том, как это можно исправить, [импортировав сертификат прокси-сервера как доверенный сертификат на виртуальную машину сборщика](https://docs.microsoft.com/azure/migrate/concepts-collector#internet-connectivity-with-intercepting-proxy).

    - Сборщик проверит, запущена ли служба сборщика. Эта служба устанавливается по умолчанию на виртуальной машине сборщика.
    - Скачайте и установите VMware PowerCLI.

6. В разделе **Specify vCenter Server details** (Укажите сведения о vCenter Server) выполните следующие действия:
    - Укажите полное доменное имя или IP-адрес сервера vCenter Server.
    - В полях **Имя пользователя** и **Пароль** укажите данные учетной записи только для чтения, которую сборщик будет использовать для обнаружения виртуальных машин на сервере vCenter Server.
    - В поле **Область сбора данных** выберите область обнаружения виртуальных машин. Сборщик может обнаруживать только виртуальные машины в указанной области. Областью может быть определенная папка, центр обработки данных или кластер. Область не должна содержать более 1500 виртуальных машин. [Подробнее](how-to-scale-assessment.md) об обнаружении более крупной среды.

7. В разделе **Specify migration project** (Укажите проект миграции) укажите идентификатор и ключ проекта службы "Миграция Azure", скопированные на портале. Если вы не скопировали их, откройте портал Azure на виртуальной машине сборщика. На странице **Обзор** проекта щелкните **Обнаружение компьютеров** и скопируйте соответствующие значения.  
8. Проверьте статус обнаружения в разделе **Просмотр хода выполнения сбора**. [Дополнительные сведения](https://docs.microsoft.com/azure/migrate/concepts-collector#what-data-is-collected) о том, какие данные собирает сборщик службы "Миграция Azure".

> [!NOTE]
> Сборщик поддерживает только "Английский (США)" в качестве языка операционной системы и языка интерфейса сборщика.
> При изменении параметров на компьютере, который вы хотите оценить, еще раз активируйте обнаружение, прежде чем приступить к оценке. Для этого в сборщике используйте параметр **Снова запустить сбор**. После завершения сбора выберите на портале параметр **Пересчитать**, чтобы получить обновленные оценки результаты.


### <a name="verify-vms-in-the-portal"></a>Проверка виртуальных машин на портале

Устройство сборщика будет постоянно профилировать локальную среду и отправлять данные о производительности с интервалом в один час. Сведения о виртуальных машинах будут доступны на портале через час после запуска обнаружения.

1. В проекте службы "Миграция Azure" последовательно выберите **Управление** > **Компьютеры**.
2. Проверьте, появились ли на портале виртуальные машины, которые нужно было обнаружить.


## <a name="create-and-view-an-assessment"></a>Создание и просмотр оценки

После обнаружения виртуальных машин на портале их можно сгруппировать и создать оценки. Можно быстро создавать, как и локальные оценки после обнаружения виртуальных машин на портале. Советуем подождать по крайней мере один день, прежде чем создавать оценки производительности для получения надежных рекомендаций.

1. На странице **Обзор** проекта щелкните **+Создать оценку**.
2. Щелкните **Просмотреть все**, чтобы просмотреть свойства оценки.
3. Создайте группу и укажите ее имя.
4. Выберите компьютеры, которые необходимо добавить в группу.
5. Щелкните **Создать оценку**, чтобы создать группу и оценку.
6. После создания оценки просмотрите ее, выбрав **Обзор** > **Панель мониторинга**.
7. Щелкните **Экспорт оценки**, чтобы скачать оценку в виде файла Excel.

> [!NOTE]
> Перед созданием оценки настоятельно рекомендуется подождать по крайней мере один день после начала обнаружения. Если необходимо обновить существующую оценку с помощью последних данных о производительности, можно использовать команду для оценки **Пересчитать**, чтобы ее обновить.

### <a name="assessment-details"></a>Сведения об оценке

Оценка включает в себя информацию о том, совместимы ли локальные виртуальные машины с Azure, правильный размер виртуальной машины для запуска в Azure, а также предполагаемые ежемесячные затраты в Azure.

![Отчет об оценке](./media/tutorial-assessment-vmware/assessment-report.png)

#### <a name="azure-readiness"></a>Готовность к работе в Azure

В представлении готовности к работе в Azure в отчете об оценке отображается состояние готовности каждой виртуальной машины. В зависимости от свойств каждую виртуальную машину можно пометить как:
- готова к работе в Azure;
- условно готова к работе в Azure;
- не готова к работе в Azure;
- готовность неизвестна.

Для виртуальных машин, которые готовы к миграции, служба "Миграция Azure" рекомендует размер виртуальной машины в Azure. Размер, рекомендуемый службой "Миграция Azure", зависит от условий определения размера, указанных в свойствах оценки. Если указано условие определения размера на основе производительности, рекомендации для размера делаются на основе журнала производительности виртуальных машин (ЦП и памяти) и дисков (операций ввода-вывода в секунду и пропускной способности). Если критерий размера — "как в локальной среде", Миграция Azure не учитывает данные о производительности для ВМ и дисков. Рекомендации для размера виртуальной машины в Azure даются на основе локального размера виртуальной машины, а для размера диска — в зависимости от типа хранилища, которое указано в свойствах оценки (по умолчанию — диски класса Premium). Дополнительные сведения об определении размеров в службе "Миграция Azure" см. [здесь](concepts-assessment-calculation.md).

Служба "Миграция Azure" также определяет причину проблем готовности к работе виртуальных машин, которые не готовы или условно готовы к работе в Azure, и предоставляет рекомендации по их устранению.

Виртуальные машины, для которых службе "Миграция Azure" не удается определить состояние готовности к работе (из-за отсутствия данных), помечаются как "готовность неизвестна".

Помимо определения готовности к работе в Azure и нужного размера в службе "Миграция Azure" также предлагаются средства, которые можно использовать для миграции виртуальной машины. Это требует более глубокого обнаружения в локальной среде. Сведения о том, как выполнить более глубокое обнаружение путем установки агентов на локальных компьютерах см. в статье [Миграция компьютеров после оценки](how-to-get-migration-tool.md). Если агенты не установлены на локальных компьютерах, можно выполнить миграцию по методике Lift-аnd-Shift с помощью [Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/site-recovery-overview). Если агенты установлены на локальном компьютере, служба "Миграция Azure" просматривает процессы, выполняемые внутри него, и определяет, является ли он компьютером базы данных. Если это компьютер базы данных, вы можете использовать для миграции [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview), а в качестве средства миграции — Azure Site Recovery.

  ![Оценка готовности](./media/tutorial-assessment-vmware/assessment-suitability.png)  

#### <a name="monthly-cost-estimate"></a>Примерная стоимость в месяц

В этом представлении отображается общая стоимость вычислений и хранения для запуска виртуальных машин в Azure, а также сведениями для каждой машины. Оценка стоимости вычисляется с учетом рекомендованного службой "Миграция Azure" размера компьютера, его дисков и свойств оценки.

> [!NOTE]
> Оценка стоимости, предоставляемая службой "Миграция Azure", приводится для запуска локальных виртуальных машин как виртуальных машин Azure IaaS (инфраструктура как услуга). При использовании службы "Миграция Azure" не учитывается стоимость платформы как услуги (PaaS) или программного обеспечения как услуги (SaaS).

Примерная ежемесячная стоимость вычислений и хранилища суммируется для всех виртуальных машин в группе.

![Оценка стоимости виртуальной машины](./media/tutorial-assessment-vmware/assessment-vm-cost.png)

#### <a name="confidence-rating"></a>Оценка достоверности

Каждая оценка на основе производительности в службе "Миграция Azure" связана с оценкой достоверности, которая колеблется в диапазоне от 1 до 5 звездочек (1 звезда — низкая достоверность, а 5 — высокая). Оценка достоверности назначается на основе доступности точек данных, необходимых для вычисления оценки. Оценка достоверности помогает определить надежность рекомендаций по выбору размера, предоставленных службой "Миграция Azure". Оценка достоверности неприменима к локальным оценкам "как есть".

Для определения размера на основе производительности службе "Миграция Azure" требуются данные об использовании ЦП и памяти виртуальной машины. Кроме того, для каждого диска, присоединенного к виртуальной машине, необходимы сведения о количестве операций ввода-вывода в секунду и пропускной способности диска. Аналогичным образом для каждого сетевого адаптера, подключенного к виртуальной машине, службе "Миграция Azure" необходимы сведения о сетевом трафике. Если какой-либо из приведенных выше показателей использования недоступен в vCenter Server, рекомендации по выбору размера, предоставленные службой "Миграция Azure", могут быть ненадежными. В зависимости от процента доступных точек данных оценка достоверности может быть такой:

   **Уровень доступности точек данных** | **Оценка достоверности**
   --- | ---
   0–20 % | 1 звезда
   21–40 % | 2 звезды
   41–60 % | 3 звезды
   61–80 % | 4 звезды
   81–100 % | 5 звезд

В процессе оценки могут быть доступны не все точки данных по одной из следующих причин.

- Среда не была профилирована на период времени, для которого создается оценка. Например, если создавать оценки с продолжительностью производительности набора в 1 день, нужно подождать как минимум день после запуска обнаружения сбора всех точек данных.

- В течение периода, для которого рассчитывается оценка, несколько виртуальных машин были отключены. Если какие-либо виртуальные машины были отключены в течение некоторого времени, мы не сможем собрать данные о производительности за этот период.

- За период, для которого рассчитывается оценка, было создано несколько виртуальных машин. Например, вы создаете оценку для журнала производительности за последний месяц, при этом несколько виртуальных машин были созданы всего неделю назад. В таких случаях журнал производительности новых виртуальных машин не будет доступен за весь период.

> [!NOTE]
> Если оценка достоверности меньше чем 5 звезд, подождите по крайней мере один день, чтобы устройство могло профилировать среду, а затем *пересчитайте* оценку. Если не сделать этого, определение размера на основе производительности может оказаться ненадежным. Рекомендуется переключиться на режим *определения размера как для локальной ВМ*, изменив свойства оценки.

## <a name="next-steps"></a>Дополнительная информация

- [Дополнительные сведения](how-to-modify-assessment.md) о настройке оценки на основе требований.
- Узнайте, как создать группы с высоким уровнем надежности, используя [сопоставление зависимостей компьютеров](how-to-create-group-machine-dependencies.md).
- [Узнайте больше](concepts-assessment-calculation.md) о вычислении оценок.
- [Узнайте](how-to-scale-assessment.md), как выполнять обнаружение и оценку в большой среде VMware.
- [Дополнительные сведения](resources-faq.md) по вопросам и ответам о Миграции Azure
