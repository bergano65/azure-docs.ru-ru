---
title: Настройка коллекции общих образов в Azure DevTest Labs | Документация Майкрософт
description: Узнайте, как настроить общую коллекцию образов в Azure DevTest Labs
services: devtest-lab
documentationcenter: na
author: spelluru
manager: ''
editor: ''
ms.assetid: ''
ms.service: devtest-lab
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/05/2019
ms.author: spelluru
ms.openlocfilehash: 6e0c1419e5656f184d27dce8d185a86bea71d173
ms.sourcegitcommit: 88ae4396fec7ea56011f896a7c7c79af867c90a1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/06/2019
ms.locfileid: "70389953"
---
# <a name="configure-a-shared-image-gallery-in-azure-devtest-labs"></a>Настройка коллекции общих образов в Azure DevTest Labs
DevTest Labs теперь поддерживает функцию [коллекции общих образов](../virtual-machines/windows/shared-image-galleries.md) . Благодаря этой функции пользователи лаборатории могут при создании ее ресурсов использовать образы из общего расположения. Кроме того, функция позволяет создавать структуру и организацию на основе управляемых пользовательских образов виртуальных машин. Коллекция общих образов поддерживает следующие возможности.

- Управляемая глобальная репликация образов.
- Управление версиями и группировка образов для упрощения контроля.
- Высокий уровень доступности образов благодаря использованию учетных записей хранилища, избыточного между зонами (ZRS), с поддержкой зон доступности. ZRS обеспечивает высокий уровень устойчивости против сбоев зон.
- Использование образов из разных подписок и даже разных клиентов с управлением доступом на основе ролей (RBAC).

Дополнительные сведения см. в [документации по общей коллекции образов](../virtual-machines/windows/shared-image-galleries.md). 
 
Если у вас есть большое количество управляемых образов, которые нужно сохранить и сделать доступными для всей компании, можно использовать коллекцию общих образов в качестве репозитория, что позволит легко обновлять и передавать образы. Владелец лаборатории можете подключить к ней существующую общедоступную коллекцию образов. После этого пользователи лаборатории смогут создавать машины на основе наиболее актуальных образов. Ключевое преимущество этой функции в том, что в DevTest Labs теперь можно совместно использовать образы в разных лабораториях, подписках и регионах. 

> [!NOTE]
> Дополнительные сведения о затратах, связанных со службой коллекции общих образов, см. в разделе [выставление счетов для общей коллекции образов](../virtual-machines/windows/shared-image-galleries.md#billing).

## <a name="considerations"></a>Рекомендации
- В лабораторию можно одновременно подключить только одну коллекцию общих образов. Если вы хотите подключить другую галерею, необходимо отключить существующую и присоединить другую. 
- В настоящее время DevTest Labs не поддерживает передачу изображений в коллекцию через лабораторию. 
- При создании виртуальной машины с помощью общего образа коллекции образов DevTest Labs всегда использует последнюю опубликованную версию этого образа. Однако если образ имеет несколько версий, пользователь может выбрать создание компьютера из более ранней версии, перейдя на вкладку Дополнительные параметры во время создания виртуальной машины.  
- Несмотря на то что DevTest Labs автоматически делает наилучшую попытку обеспечить репликацию образов с помощью общей коллекции образов в регион, в котором существует Лаборатория, это не всегда возможно. Чтобы избежать проблем с созданием виртуальных машин на основе этих образов, убедитесь, что образы уже реплицированы в регион лаборатории.

## <a name="use-azure-portal"></a>Использование портала Azure
1. Войдите на [портале Azure](https://portal.azure.com).
1. В меню навигации слева выберите **все службы** .
1. Выберите **DevTest Labs** из списка.
1. В списке лабораторий выберите свою **лабораторию**.
1. Выберите **Конфигурация и политики** в разделе **Параметры** в меню слева.
1. В меню слева выберите **коллекции общих образов** в разделе **базовые виртуальные машины** .

    ![Меню галереи общих образов](./media/configure-shared-image-gallery/shared-image-galleries-menu.png)
1. Подключите имеющуюся коллекцию общих образов к своей лаборатории, нажав кнопку **присоединить** и выбрав коллекцию в раскрывающемся списке.

    ![Подключить](./media/configure-shared-image-gallery/attach-options.png)
1. Перейдите в присоединенную коллекцию и настройте коллекцию, чтобы **включить или отключить** общие образы для создания виртуальной машины. Выберите коллекцию образов из списка, чтобы настроить ее. 

    По умолчанию параметр **Разрешить использование всех образов в качестве баз данных виртуальных машин** имеет значение **Да**. Это означает, что все образы, доступные в коллекции подключенных общих образов, будут доступны пользователю лаборатории при создании виртуальной машины лаборатории. Если доступ к определенным изображениям необходимо ограничить, измените параметр **Разрешить использование всех образов в качестве баз виртуальных машин** **без**изменений и выберите образы, которые нужно разрешить при создании виртуальных машин, а затем нажмите кнопку **сохранить** .

    ![Включить или отключить](./media/configure-shared-image-gallery/enable-disable.png)
1. Пользователи лаборатории могут создать виртуальную машину с помощью включенных образов. для этого щелкните **+ Добавить** и найдите образ на странице **Выбор базовой** страницы.

    ![Пользователи лаборатории](./media/configure-shared-image-gallery/lab-users.png)
## <a name="use-azure-resource-manager-template"></a>Использование шаблона Azure Resource Manager

### <a name="attach-a-shared-image-gallery-to-your-lab"></a>Подключение коллекции общих образов к лаборатории
Если вы используете шаблон Azure Resource Manager для подключения коллекции общих образов к лаборатории, необходимо добавить ее в раздел ресурсов шаблона диспетчер ресурсов, как показано в следующем примере:

```json
"resources": [
{
    "apiVersion": "2018-10-15-preview",
    "type": "Microsoft.DevTestLab/labs",
    "name": "mylab",
    "location": "eastus",
    "resources": [
    {
        "apiVersion":"2018-10-15-preview",
        "name":"myGallery",
        "type":"sharedGalleries",
        "properties": {
            "galleryId":"/subscriptions/11111111-1111-1111-1111-111111111111/resourceGroups/mySharedGalleryRg/providers/Microsoft.Compute/galleries/mySharedGallery",
            "allowAllImages": "Enabled"
        }
    }
    ]
}
```

Полный пример шаблона диспетчер ресурсов см. в разделе примеры шаблонов диспетчер ресурсов в нашем общедоступном репозитории GitHub: [Настройка общей коллекции образов при создании лаборатории](https://github.com/Azure/azure-devtestlab/tree/master/samples/DevTestLabs/QuickStartTemplates/101-dtl-create-lab-shared-gallery-configured).

## <a name="use-api"></a>Использовать API

### <a name="shared-image-galleries---create-or-update"></a>Коллекции общих образов — создание или обновление

```rest
PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.DevTestLab/labs/{labName}/sharedgalleries/{name}?api-version= 2018-10-15-preview
Body: 
{
    "properties":{
        "galleryId": "[Shared Image Gallery resource Id]",
        "allowAllImages": "Enabled"
    }
}

```

### <a name="shared-image-galleries-images---list"></a>Образы из общей галереи образов — список 

```rest
GET  https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.DevTestLab/labs/{labName}/sharedgalleries/{name}/sharedimages?api-version= 2018-10-15-preview
```




## <a name="next-steps"></a>Следующие шаги
См. следующие статьи о создании виртуальной машины с помощью образа из коллекции подключенных общих образов. [Создание виртуальной машины с помощью общего образа из коллекции](add-vm-use-shared-image.md)
