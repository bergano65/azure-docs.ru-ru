---
title: Настройка лаборатории безупречного взлома с помощью служб лабораторий Azure | Документация Майкрософт
description: Узнайте, как настроить лабораторию с помощью служб лабораторий Azure, чтобы научиться безупречному взлому.
ms.topic: article
ms.date: 06/26/2020
ms.openlocfilehash: 97cdf13f39cc73ee7f35fb402229469195f1456c
ms.sourcegitcommit: 86acfdc2020e44d121d498f0b1013c4c3903d3f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/17/2020
ms.locfileid: "97616428"
---
# <a name="set-up-a-lab-to-teach-ethical-hacking-class"></a>Настройка лаборатории для обучения классу взлома

В этой статье показано, как настроить класс, нацеленный на судебную сторону безупречного взлома. Тестирование на проникновение, метод, используемый хакерским сообществом, используется, когда кто-то пытается получить доступ к системе или сети, чтобы продемонстрировать ее уязвимости, которыми потенциально может воспользоваться злоумышленник.

В классе этичного взлома учащиеся могут изучать современные методы защиты от уязвимостей. Каждый учащийся получает виртуальную машину Windows Server с двумя вложенными виртуальными машинами: одну виртуальную машину с образом [Metasploitable3](https://github.com/rapid7/metasploitable3) и одну виртуальную машину с образом [Kali Linux](https://www.kali.org/). Виртуальная машина Metasploitable используется для изучения проникновений, а виртуальная машина Kali предоставляет доступ к средствам, необходимым для выполнения задач анализа.

Эта статья содержит два основных раздела. В первом разделе описывается создание лаборатории для занятий. Во втором разделе описывается создание шаблона компьютера с включенной вложенной виртуализацией и необходимыми инструментами и изображениями. В этом случае образ Метасплоитабле и образ Linux Kali на компьютере с Hyper-V, на котором размещаются образы.

## <a name="lab-configuration"></a>Настройка лаборатории

Для настройки этой лаборатории вам прежде всего потребуется подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/), прежде чем начинать работу. После получения подписки Azure можно либо создать новую учетную запись лаборатории в службах лаборатории Azure, либо использовать существующую учетную запись. Ознакомьтесь со следующим руководством по созданию учетной записи лаборатории: [учебник по настройке учетной записи лаборатории](tutorial-setup-lab-account.md).

Следуйте указаниям [этого учебника](tutorial-setup-classroom-lab.md) , чтобы создать лабораторию, а затем примените следующие параметры.

| размер виртуальной машины; | Изображение |
| -------------------- | ----- |
| Средний (вложенная виртуализация) | Windows Server 2019 Datacenter |

## <a name="template-machine"></a>Компьютер шаблона

После создания шаблона компьютера запустите его и подключитесь к нему, чтобы выполнить следующие три основные задачи.

1. Настройте компьютер для вложенной виртуализации. Он включает все соответствующие функции Windows, такие как Hyper-V, и настраивает сетевые подключения для образов Hyper-V, которые могут взаимодействовать друг с другом и через Интернет.
2. Настройка образа [Kali](https://www.kali.org/) Linux. KALI — это дистрибутив Linux, который включает средства для тестирования уязвимости и аудита безопасности.
3. Настройте образ Метасплоитабле. В этом примере будет использоваться образ [Metasploitable3](https://github.com/rapid7/metasploitable3) . Этот образ создается с целью обеспечения уязвимости системы безопасности.

В оставшейся части этой статьи будут рассмотрены действия, выполняемые вручную для выполнения указанных выше задач.  Кроме того, можно запустить сценарии [служб лаборатории Hyper-V](https://github.com/Azure/azure-devtestlab/tree/master/samples/ClassroomLabs/Scripts/HyperV) и [сценарии взлома служб лаборатории](https://github.com/Azure/azure-devtestlab/tree/master/samples/ClassroomLabs/Scripts/EthicalHacking).

### <a name="prepare-template-machine-for-nested-virtualization"></a>Подготовка компьютера шаблона для вложенной виртуализации

Следуйте инструкциям, чтобы [включить вложенную виртуализацию](how-to-enable-nested-virtualization-template-vm.md) для подготовки виртуальной машины шаблона для вложенной виртуализации.

### <a name="set-up-a-nested-virtual-machine-with-kali-linux-image"></a>Настройка вложенной виртуальной машины с помощью образа Kali Linux

KALI — это дистрибутив Linux, который включает средства для тестирования уязвимости и аудита безопасности.

1. Загрузка образа из [нежелательных образов виртуальных машин Linux с защитой Kali](https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-image-download/).  Запомните имя пользователя и пароль по умолчанию, указанные на странице загрузки.
    1. Скачайте образ **Kali Linux vmware 64-bit (7z)** для VMware.
    1. Извлеките файл. 7z.  Если у вас еще нет 7-архивов, скачайте его с [https://www.7-zip.org/download.html](https://www.7-zip.org/download.html) . Запомните расположение извлеченной папки, так как оно понадобится позже.
1. Преобразуйте извлеченный VMDK-файл в VHDX-файл, чтобы можно было использовать его вместе с Hyper-V. Для преобразования образов VMware в образы Hyper-V доступно несколько средств.  Мы будем использовать [преобразователь STARWIND V2V](https://www.starwindsoftware.com/starwind-v2v-converter).  Для загрузки см. [страницу загрузки преобразователя STARWIND V2V](https://www.starwindsoftware.com/starwind-v2v-converter#download).
    1. Запустите **преобразователь STARWIND V2V**.
    1. На странице **Выбор расположения преобразуемого изображения** выберите **локальный файл**.  Выберите **Далее**.
    1. На странице **исходное изображение** перейдите к и выберите VMDK-файл Kali Linux, извлеченный на предыдущем шаге для параметра **имя файла** .  Файл будет иметь формат Kali-Linux-{версия} — VMware-AMD64. vmdk.  Выберите **Далее**.
    1. На странице **Выбор расположения конечного образа** выберите **локальный файл**.  Выберите **Далее**.
    1. На странице **Выбор формата конечного изображения** выберите **VHD/VHDX**.  Выберите **Далее**.
    1. На странице **Выбор параметра для формата изображения VHD/VHDX** выберите образ с возможностью **расширения VHDX**.  Выберите **Далее**.
    1. На странице **Выбор имени файла назначения** оставьте имя файла по умолчанию.  Нажмите **Преобразовать**.
    1. На странице **Преобразование** дождитесь преобразования изображения.  Это может занять несколько секунд.  По завершении преобразования нажмите кнопку **Готово** .
1. Создайте новую виртуальную машину Hyper-V.
    1. Откройте **Диспетчер Hyper-V**.
    1. Выберите **действие**  ->  **Новая**  ->  **Виртуальная машина**.
    1. На странице **перед началом** работы **мастера создания виртуальной машины** нажмите кнопку **Далее**.
    1. На странице **Указание имени и расположения** введите **Kali-Linux** в поле **имя** и нажмите кнопку **Далее**.
    1. На странице **Указание поколения** примите значения по умолчанию и нажмите кнопку **Далее**.
    1. На странице **назначение памяти** введите **2048 МБ** для **загрузочной памяти** и нажмите кнопку **Далее**.
    1. На странице **Настройка сети** оставьте подключение **неподключенным**. Вы настроите сетевой адаптер позже.
    1. На странице **Подключение виртуального жесткого диска** выберите **использовать существующий виртуальный жесткий диск**. Перейдите в расположение файла **Kali-Linux-{version}-VMware-AMD64. vmdk** , созданного на предыдущем шаге, и нажмите кнопку **Далее**.
    1. На странице **Завершение работы мастера создания виртуальной машины** нажмите кнопку **Готово**.
    1. После создания виртуальной машины выберите ее в диспетчере Hyper-V. Не включайте компьютер еще.  
    1. Выберите   ->  **Параметры** действия.
    1. В диалоговом окне **параметры для Kali-Linux** для выберите пункт **Добавить оборудование**.
    1. Выберите **устаревший сетевой адаптер** и нажмите кнопку **Добавить**.
    1. На странице **устаревший сетевой адаптер** выберите **Лабсервицессвитч** для параметра **виртуальный коммутатор** и нажмите кнопку **ОК**. Лабсервицессвитч был создан при подготовке компьютера шаблона для Hyper-V в разделе **Подготовка шаблона для вложенной виртуализации** .
    1. Теперь образ Kali-Linux готов к использованию. В **диспетчере Hyper-V** выберите **действие**  ->  **Запуск**, а затем выберите **действие**  ->  **Подключиться** , чтобы подключиться к виртуальной машине.  Имя пользователя по умолчанию — **Kali** , а пароль — **Kali**.

## <a name="set-up-a-nested-vm-with-metasploitable-image"></a>Настройка вложенной виртуальной машины с помощью образа Метасплоитабле  

Образ Rapid7 Метасплоитабле — это образ, специально настроенный с уязвимостями безопасности. Этот образ используется для тестирования и поиска проблем. В следующих инструкциях показано, как использовать предварительно созданный образ Метасплоитабле. Однако если требуется более новая версия образа Метасплоитабле, см [https://github.com/rapid7/metasploitable3](https://github.com/rapid7/metasploitable3) . раздел.

1. Скачайте образ Метасплоитабле.
    1. Перейдите по адресу [https://information.rapid7.com/download-metasploitable-2017.html](https://information.rapid7.com/download-metasploitable-2017.html). Заполните форму, чтобы скачать изображение, и нажмите кнопку **Submit (отправить** ).
    2. Нажмите кнопку **download Метасплоитабле Now (скачать сейчас** ).
    3. После скачивания ZIP-файла Извлеките ZIP-файл и запомните расположение файла Метасплоитабле. vmdk.
1. Преобразуйте извлеченный VMDK-файл в VHDX-файл, чтобы можно было использовать его вместе с Hyper-V. Для преобразования образов VMware в образы Hyper-V доступно несколько средств.  Мы снова будем использовать [преобразователь STARWIND V2V](https://www.starwindsoftware.com/starwind-v2v-converter) .  Для загрузки см. [страницу загрузки преобразователя STARWIND V2V](https://www.starwindsoftware.com/starwind-v2v-converter#download).
    1. Запустите **преобразователь STARWIND V2V**.
    1. На странице **Выбор расположения преобразуемого изображения** выберите **локальный файл**.  Выберите **Далее**.
    1. На странице **исходное изображение** перейдите к и выберите файл метасплоитабле. VMDK, извлеченный на предыдущем шаге, для параметра **имя файла** .  Выберите **Далее**.
    1. На странице **Выбор расположения конечного образа** выберите **локальный файл**.  Выберите **Далее**.
    1. На странице **Выбор формата конечного изображения** выберите **VHD/VHDX**.  Выберите **Далее**.
    1. На странице **Выбор параметра для формата изображения VHD/VHDX** выберите образ с возможностью **расширения VHDX**.  Выберите **Далее**.
    1. На странице **Выбор имени файла назначения** оставьте имя файла по умолчанию.  Нажмите **Преобразовать**.
    1. На странице **Преобразование** дождитесь преобразования изображения.  Это может занять несколько секунд.  По завершении преобразования нажмите кнопку **Готово** .
1. Создайте новую виртуальную машину Hyper-V.
    1. Откройте **Диспетчер Hyper-V**.
    1. Выберите **действие**  ->  **Новая**  ->  **Виртуальная машина**.
    1. На странице **перед началом** работы **мастера создания виртуальной машины** нажмите кнопку **Далее**.
    1. На странице **Указание имени и расположения** введите **метасплоитабле** в поле **имя** и нажмите кнопку **Далее**.

        ![Мастер создания образа виртуальной машины](./media/class-type-ethical-hacking/new-vm-wizard-1.png)
    1. На странице **Указание поколения** примите значения по умолчанию и нажмите кнопку **Далее**.
    1. На странице **назначение памяти** введите **512 МБ** для **загрузочной памяти** и нажмите кнопку **Далее**.

        ![Страница "Выделение памяти"](./media/class-type-ethical-hacking/assign-memory-page.png)
    1. На странице **Настройка сети** оставьте подключение **неподключенным**. Вы настроите сетевой адаптер позже.
    1. На странице **Подключение виртуального жесткого диска** выберите **использовать существующий виртуальный жесткий диск**. Перейдите в расположение файла **метасплоитабле. VHDX** , созданного на предыдущем шаге, и нажмите кнопку **Далее**.

        ![Страница "Подключение диска виртуальной сети"](./media/class-type-ethical-hacking/connect-virtual-network-disk.png)
    1. На странице **Завершение работы мастера создания виртуальной машины** нажмите кнопку **Готово**.
    1. После создания виртуальной машины выберите ее в диспетчере Hyper-V. Не включайте компьютер еще.  
    1. Выберите   ->  **Параметры** действия.
    1. В диалоговом окне **параметры для метасплоитабле** выберите **Добавить оборудование**.
    1. Выберите **устаревший сетевой адаптер** и нажмите кнопку **Добавить**.

        ![Страница "сетевой адаптер"](./media/class-type-ethical-hacking/network-adapter-page.png)
    1. На странице **устаревший сетевой адаптер** выберите **Лабсервицессвитч** для параметра **виртуальный коммутатор** и нажмите кнопку **ОК**. Лабсервицессвитч был создан при подготовке компьютера шаблона для Hyper-V в разделе **Подготовка шаблона для вложенной виртуализации** .

        ![Страница "устаревший сетевой адаптер"](./media/class-type-ethical-hacking/legacy-network-adapter-page.png)
    1. Теперь образ Метасплоитабле готов к использованию. В **диспетчере Hyper-V** выберите **действие**  ->  **Запуск**, а затем выберите **действие**  ->  **Подключиться** , чтобы подключиться к виртуальной машине.  Имя пользователя по умолчанию — **мсфадмин** , а пароль — **мсфадмин**.

Теперь шаблон обновлен и содержит изображения, необходимые для класса тестирования уязвимости этического взлома, образ с инструментами для тестирования уязвимости и другой образ с уязвимостями безопасности для обнаружения. Теперь образ шаблона можно опубликовать в классе. Нажмите кнопку **Опубликовать** на странице шаблона, чтобы опубликовать этот шаблон в лаборатории.

## <a name="cost"></a>Стоимость  

Если вы хотите оценить стоимость этой лаборатории, можно использовать следующий пример:

Для класса из 25 учащихся с 20 часами запланированного времени обучения и 10 часами квоты для домашних заданий или назначений цена за лабораторию будет такой:

25 учащихся \* (20 + 10) ч \* 55. модулей лаборатории \* 0,01 USD в час = 412,50 долл. США

>[!IMPORTANT]
>Оценка стоимости предназначена только для примера. Текущие сведения о ценах см. на странице [цен на службы лаборатории Azure](https://azure.microsoft.com/pricing/details/lab-services/).

## <a name="conclusion"></a>Заключение

В этой статье вы узнаете, как создать лабораторию для класса с классом безупречного взлома. Она включает в себя действия по настройке вложенной виртуализации для создания двух виртуальных машин на виртуальной машине узла для тестирования попали.

## <a name="next-steps"></a>Дальнейшие действия

Следующие шаги являются общими для настройки любой лаборатории.

- [Добавление пользователей](tutorial-setup-classroom-lab.md#add-users-to-the-lab)
- [Настройка квоты](how-to-configure-student-usage.md#set-quotas-for-users)
- [Настройка расписания](tutorial-setup-classroom-lab.md#set-a-schedule-for-the-lab)
- [Отправка по электронной почте ссылок для регистрации учащимся](how-to-configure-student-usage.md#send-invitations-to-users)
