---
title: Подключение к одноранговой сети в Службах лабораторий Azure | Документация Майкрософт
description: Сведения о подключении лабораторной сети к другой одноранговой сети. Например, подключите локальную сеть организации или университета к виртуальной сети лаборатории в Azure.
ms.topic: article
ms.date: 06/26/2020
ms.openlocfilehash: 20e47113d5c2439c9c8ea355288442b5f41d90ca
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85445837"
---
# <a name="connect-your-labs-network-with-a-peer-virtual-network-in-azure-lab-services"></a>Подключение сети лаборатории к одноранговой виртуальной сети в Службах лабораторий Azure

Эта статья содержит сведения о пиринге лабораторной сети с другой сетью.

## <a name="overview"></a>Обзор

Пиринг виртуальных сетей позволяет эффективно соединить виртуальные сети Azure. После создания пиринговой связи две виртуальные сети выглядят как одна сеть при подключении. Трафик между виртуальными машинами в виртуальных сетях с пиринговой связью направляется через магистральную инфраструктуру Майкрософт точно так же, как трафик между виртуальными машинами в одной виртуальной сети направляется только через частные IP-адреса. Дополнительные сведения см. в статье [Пиринг между виртуальными сетями](../virtual-network/virtual-network-peering-overview.md).

Возможно, в некоторых сценариях к одноранговой виртуальной сети потребуется подключить сеть лаборатории, например:

- Виртуальные машины в лаборатории имеют программное обеспечение, которое подключается к локальным серверам лицензирования для получения лицензии.
- Виртуальным машинам в лаборатории требуется доступ к наборам данных (или любым другим файлам) в сетевых папках университета.

Некоторые локальные сети подключены к виртуальной сети Azure через [ExpressRoute](../expressroute/expressroute-introduction.md) или [шлюз виртуальной сети](../vpn-gateway/vpn-gateway-about-vpngateways.md). Эти службы должны быть настроены за пределами Служб лабораторий Azure. Дополнительные сведения о подключении локальной сети к Azure с помощью ExpressRoute см. в [этой статье](../expressroute/expressroute-introduction.md). Для локального подключения с помощью шлюза виртуальной сети шлюз, указанная виртуальная сеть и учетная запись лаборатории должны находиться в одном регионе.

> [!NOTE]
> При создании виртуальной сети Azure, для которой будет настроена пиринговая связь с учетной записью лаборатории, важно понимать, как регион виртуальной сети влияет на расположение создания лабораторий для аудитории.  Дополнительные сведения см. в разделе руководства администратора [Регионы и расположения](https://docs.microsoft.com/azure/lab-services/classroom-labs/administrator-guide#regionslocations).

## <a name="configure-at-the-time-of-lab-account-creation"></a>Настройка при создании учетной записи лаборатории

Во время [создания учетной записи лаборатории](tutorial-setup-lab-account.md) можно выбрать существующую виртуальную сеть, которая отображается в раскрывающемся списке **Одноранговая виртуальная сеть** на вкладке **Дополнительно**.  В списке отображаются только виртуальные сети, которые находятся в том же регионе, что и учетная запись лаборатории. Выбранная виртуальная сеть подключена (связана пирингом) к лабораториям, созданным в учетной записи лаборатории.  Все виртуальные машины в лабораториях, созданные после внесения этого изменения, будут иметь доступ к ресурсам в этой одноранговой виртуальной сети.

![Выбор виртуальной сети для установки пиринга](./media/how-to-connect-peer-virtual-network/select-vnet-to-peer.png)

### <a name="address-range"></a>Диапазон адресов

Вы можете также указать **диапазон адресов** для виртуальных машин в лабораториях.  Свойство **диапазон адресов** применяется только в том случае, если для лаборатории включена **одноранговая виртуальная сеть**. Если указан диапазон адресов, все виртуальные машины в лабораториях под учетной записью лаборатории будут созданы в этом диапазоне адресов. Этот диапазон адресов должен быть указан в нотации CIDR (например, 10.20.0.0/20) и не перекрываться с существующими диапазонами адресов.  При предоставлении диапазона адресов следует подумать о количестве *лабораторий*, которые будут созданы, и предоставить диапазон адресов с учетом изменений. В службах лабораторий предполагается использование не более 512 виртуальных машин на лабораторию.  Например, диапазон IP-адресов /23 может создавать только одну лабораторию.  Диапазон /21 позволяет создать четыре лаборатории.

Если **диапазон адресов** не указан, службы лабораторий будут использовать диапазон адресов по умолчанию, предоставленный Azure при создании виртуальной сети, в которой будет установлена пиринговая связь с вашей виртуальной сетью.  Этот диапазон часто имеет значение 10.x.0.0/16.  Это может привести к перекрытию диапазона IP-адресов, поэтому необходимо либо указать диапазон адресов в параметрах лаборатории, либо проверить диапазон адресов вашей виртуальной сети, к которой выполняется пиринговое подключение.

> [!NOTE]
> Создание лаборатории может завершиться ошибкой, если учетная запись лаборатории имеет пиринговую связь с виртуальной сетью, но слишком узкий диапазон IP-адресов. Если в учетной записи лаборатории слишком много лабораторий, то в диапазоне адресов может быть недостаточно свободного места (в каждой лаборатории используется 512 адресов). 
> 
> Если создание лаборатории завершится ошибкой, обратитесь к владельцу или администратору учетной записи лаборатории и запросите увеличение диапазона адресов. Администратор может увеличить диапазон адресов с помощью действий, описанных в разделе [Указание диапазона адресов для виртуальных машин в учетной записи лаборатории](#specify-an-address-range-for-vms-in-the-lab-account). 

## <a name="configure-after-the-lab-account-is-created"></a>Настройка после создания учетной записи лаборатории

Если вы не настроили одноранговую сеть во время создания учетной записи лаборатории, это же свойство можно включить на странице **учетной записи лаборатории** на вкладке **Конфигурация лабораторий**. Изменение этого параметра будет влиять только на лаборатории, созданные после внесения изменения. Как видно на рисунке в учетной записи лаборатории вы можете включить или отключить **одноранговую виртуальную сеть** для лабораторий.

![Включение или отключение пиринга виртуальной сети после создания лаборатории](./media/how-to-connect-peer-virtual-network/select-vnet-to-peer-existing-lab.png)

При выборе виртуальной сети в поле **Одноранговая виртуальная сеть** параметр **Разрешить создателю лаборатории выбрать ее расположение** будет отключен. Это связано с тем, что лаборатории в учетной записи лаборатории должны находиться в том же регионе, что и учетная запись лаборатории, чтобы подключиться к ресурсам в одноранговой виртуальной сети.

> [!IMPORTANT]
> Этот параметр одноранговой виртуальной сети будет влиять только на лаборатории, созданные после внесения изменения, а не на существующие.


## <a name="specify-an-address-range-for-vms-in-the-lab-account"></a>Указание диапазона адресов для виртуальных машин в учетной записи лаборатории
Следующая процедура содержит шаги для указания диапазона адресов для виртуальных машин в лаборатории. Если вы обновляете указанный ранее диапазон, обновленный диапазон адресов применяется только к виртуальным машинам, созданным после внесения изменений. 

Ниже приведены некоторые ограничения, которые следует учитывать при указании диапазона адресов. 

- Префикс должен быть не больше 23. 
- Если виртуальная сеть имеет пиринговую связь с учетной записью лаборатории, указанный диапазон адресов не может перекрывать диапазон адресов одноранговой виртуальной сети.

1. На странице **Учетная запись лаборатории** в меню слева выберите **Labs settings** (Параметры лаборатории).
2. В поле **Диапазон адресов** укажите диапазон адресов виртуальных машин, которые будут созданы в лаборатории. Диапазон адресов должен быть указан в формате нотации бесклассовой междоменной маршрутизации (CIDR) (пример: 10.20.0.0/23). В этом диапазоне адресов будут создаваться виртуальные машины в лаборатории.
3. На панели инструментов щелкните **Сохранить**. 

    ![Настройка диапазона адресов](./media/how-to-manage-lab-accounts/labs-configuration-page-address-range.png)

## <a name="next-steps"></a>Дальнейшие действия

См. следующие статьи:

- [Разрешение создателю лаборатории выбирать ее расположение](allow-lab-creator-pick-lab-location.md)
- [Подключение коллекции общих образов к лаборатории](how-to-attach-detach-shared-image-gallery.md)
- [Добавление пользователя в качестве владельца лаборатории](how-to-add-user-lab-owner.md)
- [Просмотр параметров брандмауэра для лаборатории](how-to-configure-firewall-settings.md)
- [Настройка других параметров лаборатории](how-to-configure-lab-accounts.md)
