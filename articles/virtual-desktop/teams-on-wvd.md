---
title: Microsoft Teams на виртуальных рабочих столах Windows — Azure
description: Как использовать Microsoft Teams на виртуальных рабочих столах Windows.
author: Heidilohr
ms.topic: how-to
ms.date: 07/28/2020
ms.author: helohr
manager: lizross
ms.openlocfilehash: 049b962740abc98a6ac7d029c1419d40aa722165
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "88922571"
---
# <a name="use-microsoft-teams-on-windows-virtual-desktop"></a>Использование Microsoft Teams в Windows виртуальный рабочий стол

>[!IMPORTANT]
>Оптимизация мультимедиа для команд поддерживается для сред Microsoft 365 государственных организаций (GCC). Оптимизация мультимедиа для групп не поддерживается для GCC-High или DoD.

>[!NOTE]
>Оптимизация мультимедиа для Microsoft Teams доступна только для настольного клиента Windows на компьютерах с Windows 10. Для оптимизации мультимедиа требуется Windows Desktop Client версии 1.2.1026.0 или более поздней.

Microsoft Teams на виртуальных рабочих столах Windows поддерживает чат и совместную работу. Благодаря оптимизации мультимедиа он также поддерживает функции вызова и совещания. Дополнительные сведения об использовании Microsoft Teams в средах инфраструктуры виртуальных рабочих столов (VDI) см. в статье [группы для виртуализированной инфраструктуры настольных компьютеров](/microsoftteams/teams-for-vdi/).

Благодаря оптимизации мультимедиа для Microsoft Teams Настольный клиент Windows обрабатывает аудио и видео локально для командных вызовов и собраний. Вы по-прежнему можете использовать Microsoft Teams на виртуальных рабочих столах Windows совместно с другими клиентами без оптимизированных вызовов и собраний. Функции общения и совместной работы групп поддерживаются на всех платформах. Чтобы перенаправить локальные устройства в удаленном сеансе, извлеките [Параметры настройки протокол удаленного рабочего стола для пула узлов](#customize-remote-desktop-protocol-properties-for-a-host-pool).

## <a name="prerequisites"></a>Предварительные требования

Прежде чем вы сможете использовать Microsoft Teams на виртуальном рабочем столе Windows, вам потребуется выполнить следующие действия:

- [Подготовьте свою сеть](/microsoftteams/prepare-network/) для Microsoft Teams.
- Установка [настольного клиента Windows](connect-windows-7-10.md) на устройстве Windows 10 или Windows 10 IOT Корпоративная, которая соответствует [требованиям к оборудованию Microsoft Teams для команд на компьютере с Windows](/microsoftteams/hardware-requirements-for-the-teams-app#hardware-requirements-for-teams-on-a-windows-pc/).
- Подключитесь к виртуальной машине Windows 10 с несколькими сеансами или Windows 10 Корпоративная (ВМ).
- [Скачайте](https://www.microsoft.com/microsoft-365/microsoft-teams/download-app) и установите классическое приложение Teams на узле с помощью установки на компьютере. Для оптимизации мультимедиа для команд Microsoft Teams требуется классическое приложение Teams версии 1.3.00.4461 или более поздней.

## <a name="install-the-teams-desktop-app"></a>Установка классического приложения для рабочих групп

В этом разделе показано, как установить классическое приложение Teams в многосеансовый образ виртуальной машины с Windows 10 или Windows 10 Корпоративная. Дополнительные сведения см. в [статье Установка или обновление классического приложения Teams в VDI](/microsoftteams/teams-for-vdi#install-or-update-the-teams-desktop-app-on-vdi).

### <a name="prepare-your-image-for-teams"></a>Подготовка образа для команд

Чтобы включить оптимизацию мультимедиа для команд, установите следующий раздел реестра на узле:

1. В меню Пуск запустите **программу Regedit** от имени администратора. Перейдите к **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Teams**.
2. Создайте следующее значение для ключа команд:

| Имя             | Тип   | Данные и значение  |
|------------------|--------|-------------|
| исввденвиронмент | DWORD  | 1           |

### <a name="install-the-teams-websocket-service"></a>Установка службы WebSocket команд

Установите последнюю версию [службы WebSocket](https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RE4AQBt) в ОБРАЗЕ виртуальной машины. При возникновении ошибки установки установите [последнюю версию Microsoft Visual C++ распространяемый пакет](https://support.microsoft.com/help/2977003/the-latest-supported-visual-c-downloads) и повторите попытку.

#### <a name="latest-websocket-service-versions"></a>Последние версии службы WebSocket

В следующей таблице перечислены последние версии службы WebSocket:

|Версия        |Дата выпуска  |
|---------------|--------------|
|1.0.2006.11001 |07/28/2020    |
|0.11.0         |05/29/2020    |

#### <a name="updates-for-version-10200611001"></a>Обновления для версии 1.0.2006.11001

- Исправлена проблема, из-за которой при минимизации приложения рабочей группы во время вызова или собрания было вызвано удаление входящего видео.
- Добавлена поддержка выбора одного монитора для совместного использования в сеансах с несколькими мониторами.

### <a name="install-microsoft-teams"></a>Установка Microsoft Teams

Вы можете развернуть классическое приложение Teams с помощью установки для отдельных компьютеров или отдельных пользователей. Чтобы установить Microsoft Teams в среде виртуальных рабочих столов Windows, выполните следующие действия.

1. Скачайте [пакет MSI для команд](/microsoftteams/teams-for-vdi#deploy-the-teams-desktop-app-to-the-vm) , соответствующий вашей среде. Рекомендуется использовать 64-разрядный установщик в 64-разрядной операционной системе.

      > [!IMPORTANT]
      > Последнее обновление рабочих столов Team Client Version 1.3.00.21759 устранило ошибку, в которой команды показали часовой пояс в формате UTC в чате, в каналах и в календаре. В новой версии клиента будет показан часовой пояс удаленного сеанса.

2. Чтобы установить MSI на виртуальную машину узла, выполните одну из следующих команд:

    - Установка для каждого пользователя

        ```powershell
        msiexec /i <path_to_msi> /l*v <install_logfile_name>
        ```

        Этот процесс является установкой по умолчанию, который устанавливает команды в папку пользователя **% AppData%** . Команды не будут правильно работать с установкой на уровне пользователя при непостоянной установке.

    - Установка на компьютер

        ```powershell
        msiexec /i <path_to_msi> /l*v <install_logfile_name> ALLUSER=1
        ```

        При этом команды устанавливаются в папку Program Files (x86) в 64-разрядной операционной системе и в папку Program Files в 32-разрядной операционной системе. На этом этапе Настройка эталонного образа завершена. Для непостоянных настроек требуется установка групп на компьютере.

        Существует два флага, которые можно задать при установке команд, **аллусер = 1** и **ALLUSERS = 1**. Важно понимать разницу между этими параметрами. Параметр **аллусер = 1** используется только в средах VDI для указания установки на компьютере. Параметр **ALLUSERS = 1** можно использовать в средах, отличных от VDI и VDI. При задании этого параметра команды Machine-Wide установщика отображаются в окне программы и компоненты панели управления, а также приложения & функции в параметрах Windows. Все пользователи с учетными данными администратора на компьютере могут удалять команды.

        > [!NOTE]
        > Пользователи и администраторы не могут отключить автоматический запуск для команд во время входа в систему.

3. Чтобы удалить MSI с виртуальной машины узла, выполните следующую команду:

      ```powershell
      msiexec /passive /x <msi_name> /l*v <uninstall_logfile_name>
      ```

      Команда удаляет команды из папки Program Files (x86) или Program Files в зависимости от среды операционной системы.

      > [!NOTE]
      > При установке команд с параметром MSI АЛЛУСЕР = 1 автоматические обновления будут отключены. Рекомендуется обновлять группы по крайней мере раз в месяц. Дополнительные сведения о развертывании классических приложений для рабочих групп см. в статье [Развертывание рабочего стола рабочих групп на виртуальной машине](/microsoftteams/teams-for-vdi#deploy-the-teams-desktop-app-to-the-vm/).

### <a name="verify-media-optimizations-loaded"></a>Проверка загрузки оптимизации носителя

После установки службы WebSocket и классического приложения для рабочих групп выполните следующие действия, чтобы убедиться, что оптимизация носителя команды загружена:

1. Выберите образ профиля пользователя, а затем щелкните **About (о программе**).
2. Выберите **версию**.

      Если оптимизация мультимедиа загружена, в баннере будет показано, что вы **ВВД мультимедиа**. Если в баннере отображается сообщение **ВВД Media not Connected**, закройте приложение Teams и повторите попытку.

3. Выберите свой образ профиля пользователя, а затем щелкните **Параметры**.

      Если оптимизация мультимедиа загружена, то звуковые устройства и камеры, доступные локально, будут перечислены в меню устройство. Если в меню отображается **Удаленный звук**, закройте приложение Teams и повторите попытку. Если устройства по-прежнему не отображаются в меню, проверьте параметры конфиденциальности на локальном компьютере. Убедитесь, что в разделе **Параметры**  >  **Конфиденциальность**  >  **приложения разрешения** параметр **Разрешить приложениям доступ к микрофону** включен. **On** Отключитесь от удаленного сеанса, затем снова подключитесь и проверьте аудио и видео устройства. Для объединения вызовов и собраний с видео необходимо также предоставить приложениям доступ к камере.

## <a name="known-issues-and-limitations"></a>Известные проблемы и ограничения

Использование команд в виртуализированной среде отличается от использования команд в невиртуализованной среде. Дополнительные сведения об ограничениях команд в виртуализованных средах см. в статье [группы для виртуализованной инфраструктуры настольных систем](/microsoftteams/teams-for-vdi#known-issues-and-limitations).

### <a name="client-deployment-installation-and-setup"></a>Развертывание, установка и Настройка клиента

- При установке на компьютер группы в VDI не обновляются автоматически так же, как клиенты групп, не относящиеся к VDI. Чтобы обновить клиент, необходимо обновить образ виртуальной машины, установив новый MSI-файл.
- Оптимизация мультимедиа для команд поддерживается только для настольного клиента Windows на компьютерах под управлением Windows 10.
- Использование явных прокси-серверов HTTP, определенных в конечной точке, не поддерживается.

### <a name="calls-and-meetings"></a>Звонки и собрания

- Настольный клиент Teams в средах виртуальных рабочих столов Windows не поддерживает интерактивные события. Сейчас мы рекомендуем присоединиться к интерактивным событиям из [веб-клиента команд](https://teams.microsoft.com) в удаленном сеансе.
- Звонки и собрания сейчас не поддерживают совместное использование приложений. Сеансы рабочего стола поддерживают общий доступ к рабочему столу.
- Предоставление управления и управление в настоящее время не поддерживаются.
- Команды на виртуальных рабочих столах Windows поддерживают только один входящий вход видео за раз. Это означает, что каждый раз, когда кто-то пытается поделиться своим экраном, экран будет отображаться вместо экрана руководителя собрания.
- Из-за ограничений WebRTC, разрешение входящего и исходящего видеопотока ограничено 720p.
- Приложение Teams не поддерживает кнопки HID и элементы управления "индикатор" с другими устройствами.

Сведения об известных проблемах, которые не связаны с виртуализованными средами, см. [в разделе группы поддержки в вашей организации](/microsoftteams/known-issues) .

## <a name="uservoice-site"></a>Сайт UserVoice

Предоставьте отзыв о командах Microsoft Teams в Windows для виртуальных рабочих столов на [сайте UserVoice](https://microsoftteams.uservoice.com/).

## <a name="collect-teams-logs"></a>Получение журналов команд

При возникновении проблем с классическим классом в среде виртуальных рабочих столов Windows собирайте журналы клиента в папке **% AppData% \Microsoft\Teams\logs.txt** на виртуальной машине узла.

Если возникли проблемы с вызовами и собраниями, собирайте журналы командного веб-клиента с помощью сочетания клавиш **CTRL**  +  **ALT**  +  **SHIFT**  +  **1**. Журналы будут записаны в **Журнал диагностики%усерпрофиле%\довнлоадс\мстеамс DATE_TIME.txt** на виртуальной машине узла.

## <a name="contact-microsoft-teams-support"></a>Обращение в службу поддержки Microsoft Teams

Чтобы обратиться в службу поддержки Microsoft Teams, перейдите в [центр администрирования Microsoft 365](/microsoft-365/admin/contact-support-for-business-products).

## <a name="customize-remote-desktop-protocol-properties-for-a-host-pool"></a>Настройка свойств протокол удаленного рабочего стола пула узлов

Настройка свойств протокол удаленного рабочего стола пула узлов (RDP), таких как использование нескольких мониторов или Включение перенаправления микрофона и звука, позволяет обеспечить оптимальную работу пользователей в зависимости от их потребностей.

Включение перенаправления устройств не требуется при использовании команд с оптимизацией мультимедиа. Если вы используете команды без оптимизации мультимедиа, задайте следующие свойства RDP, чтобы включить перенаправление микрофона и камеры:

- `audiocapturemode:i:1` включает запись звука с локального устройства и перенаправляет звуковые приложения в удаленном сеансе.
- `audiomode:i:0` воспроизводит звук на локальном компьютере.
- `camerastoredirect:s:*` перенаправляет все камеры.

Дополнительные сведения см. в статье [Настройка свойств протокол удаленного рабочего стола для пула узлов](customize-rdp-properties.md).
