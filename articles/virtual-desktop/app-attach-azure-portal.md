---
title: Предварительный просмотр портала для подключения приложения MSIX Windows Virtual Desktop
description: Как настроить присоединение приложения MSIX для виртуальных рабочих столов Windows с помощью портал Azure.
author: Heidilohr
ms.topic: how-to
ms.date: 12/14/2020
ms.author: helohr
manager: lizross
ms.openlocfilehash: d8ed429003a9da7ae93fb93f4218cd66767dcd7b
ms.sourcegitcommit: 77ab078e255034bd1a8db499eec6fe9b093a8e4f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/16/2020
ms.locfileid: "97562282"
---
# <a name="set-up-msix-app-attach-with-the-azure-portal"></a>Настройка присоединения приложения MSIX с портал Azure

> [!IMPORTANT]
> Присоединение приложения MSIX в настоящее время находится в общедоступной предварительной версии.
> без соглашений об уровне обслуживания. Мы не рекомендуем использовать ее для выполнения производственных рабочих нагрузок. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

В этой статье описано, как настроить присоединение приложения MSIX (Предварительная версия) в среде виртуальных рабочих столов Windows.

## <a name="requirements"></a>Требования

>[!IMPORTANT]
>Прежде чем приступить к работе, обязательно заполните и отправьте [эту форму](https://aka.ms/enablemsixappattach) , чтобы включить присоединение приложения MSIX в вашей подписке. Если у вас нет утвержденного запроса, присоединение приложения MSIX не будет работать. Утверждение запросов может занять до 24 часов в рабочие дни. После принятия и завершения запроса вы получите сообщение электронной почты.

Вот что необходимо для настройки присоединения приложения MSIX:

- Работающее развертывание виртуального рабочего стола Windows. Сведения о развертывании виртуальных рабочих столов Windows (классическая модель) см. в статье [Создание клиента в виртуальном рабочем столе Windows](./virtual-desktop-fall-2019/tenant-setup-azure-active-directory.md). Чтобы узнать, как развернуть виртуальный рабочий стол Windows с Azure Resource Managerной интеграцией, см. раздел [Создание пула узлов с портал Azure](./create-host-pools-azure-marketplace.md).
- Пул узлов виртуальных рабочих столов Windows, который имеет хотя бы один активный узел сеансов.
- Этот пул узлов должен находиться в среде проверки. 
- Средство упаковки MSIX.
- MSIX приложение, развернутое в образе MSIX, передаваемый в общую папку.
- Файловый ресурс в развертывании виртуальных рабочих столов Windows, где будет храниться пакет MSIX.
- Общая папка, в которую вы перегрузили образ MSIX, также должна быть доступна для всех виртуальных машин в пуле узлов. Для доступа к образу пользователям потребуются разрешения только на чтение.

## <a name="turn-off-automatic-updates-for-msix-app-attach-applications"></a>Отключение автоматического обновления для приложений, подключаемых к приложению MSIX

Прежде чем приступить к работе, необходимо отключить автоматическое обновление для приложений, присоединив приложения MSIX. Чтобы отключить автоматическое обновление, необходимо выполнить в командной строке с повышенными привилегиями следующие команды.

```cmd
rem Disable Store auto update:

reg add HKLM\Software\Policies\Microsoft\WindowsStore /v AutoDownload /t REG_DWORD /d 0 /f
Schtasks /Change /Tn "\Microsoft\Windows\WindowsUpdate\Automatic app update" /Disable
Schtasks /Change /Tn "\Microsoft\Windows\WindowsUpdate\Scheduled Start" /Disable

rem Disable Content Delivery auto download apps that they want to promote to users:

reg add HKCU\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager /v PreInstalledAppsEnabled /t REG_DWORD /d 0 /f

reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager\Debug /v ContentDeliveryAllowedOverride /t REG_DWORD /d 0x2 /f

rem Disable Windows Update:

sc config wuauserv start=disabled
```

После отключения автоматического обновления необходимо включить Hyper-V, так как вы будете использовать `Mount-VHD` команду для размещения и отключения виртуального жесткого диска для отмены размещения.

```powershell
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All
```

>[!NOTE]
>Чтобы это вступило в силу, перезапустите виртуальную машину.

## <a name="configure-the-msix-app-attach-management-interface"></a>Настройка интерфейса управления присоединением приложения MSIX

Затем необходимо скачать и настроить интерфейс управления присоединением приложения MSIX для портал Azure.

Чтобы настроить интерфейс управления, выполните следующие действия.

1. [Откройте портал предварительной версии](https://preview.portal.azure.com/?feature.msixapplications=true#home).
2. Если появится сообщение с вопросом о том, что расширение заслуживает доверия, выберите **Разрешить**.

      > [!div class="mx-imgBorder"]
      > ![Снимок экрана окна недоверенных расширений. "Разрешить" выделяется красным цветом.](media/untrusted-extensions.png)


## <a name="add-an-msix-image-to-the-host-pool"></a>Добавление образа MSIX в пул узлов

Затем необходимо добавить образ MSIX в пул узлов.

Чтобы добавить образ MSIX, сделайте следующее:

1. Перейдите на портал Azure.

2. В строке поиска введите **виртуальный рабочий стол Windows** , а затем выберите имя службы.

      > [!div class="mx-imgBorder"]
      > ![Снимок экрана пользователя, который выбирает "виртуальный рабочий стол Windows" из раскрывающегося меню панели поиска в портал Azure. "Виртуальный рабочий стол Windows" выделен красным цветом.](media/find-and-select.png)

3. Выберите пул узлов, в котором планируется разместить приложения MSIX.

4. Выберите **пакеты MSIX** , чтобы открыть сетку данных со всеми **пакетами MSIX** , которые в настоящее время добавлены в пул узлов.

5. Выберите **+ Добавить** , чтобы открыть вкладку **Добавление пакета MSIX** .

6. На вкладке **Добавление пакета MSIX** введите следующие значения.

      - В поле **путь к образу MSIX** введите допустимый UNC-путь, указывающий на образ MSIX в общей папке. (Например, `\\storageaccount.file.core.windows.net\msixshare\appfolder\MSIXimage.vhd` .) Когда все будет готово, нажмите кнопку **Добавить** , чтобы запросить контейнер MSIX, чтобы проверить, является ли путь допустимым.

      - В поле **пакет MSIX** выберите соответствующее имя пакета MSIX из раскрывающегося меню. Это меню будет заполнено только в том случае, если в **пути к образу MSIX** введен допустимый путь к образу.

      - Для **приложений пакета** убедитесь, что список содержит все MSIX приложения, которые должны быть доступны пользователям в пакете MSIX.

      - При необходимости введите **Отображаемое имя** , если вы хотите, чтобы пакет был более понятен пользователю при развертывании пользователей.

      - Убедитесь, что **версия** имеет правильный номер версии.

      - Выберите **тип регистрации** , который вы хотите использовать. Какой из них вы используете, зависит от ваших потребностей:

    - **Регистрация по запросу** откладывает полную регистрацию приложения MSIX, пока пользователь не запустит приложение. Это тип регистрации, который мы рекомендуем использовать.

    - **Блокировка входа** регистрируется только во время входа пользователя. Этот тип не рекомендуется использовать, так как он может привести к длительному входу пользователей в систему.

7.  В качестве **состояния** Выберите предпочтительное состояние.
    -  **Активное** состояние позволяет пользователям взаимодействовать с пакетом.
    -  **Неактивное** состояние приводит к тому, что виртуальный рабочий стол Windows игнорирует пакет и не доставляет его пользователям.

8. Закончив, нажмите кнопку **Добавить**.

## <a name="publish-msix-apps-to-an-app-group"></a>Публикация приложений MSIX в группе приложений

Затем необходимо опубликовать приложения в пакете. Это необходимо сделать для групп приложений для настольных и удаленных приложений.

Если у вас уже есть образ MSIX, перейдите к [публикации приложений MSIX в группе приложений](#publish-msix-apps-to-an-app-group). Если вы хотите протестировать устаревшие приложения, преобразуйте устаревшее приложение в пакет MSIX, следуя инструкциям в разделе [Создание пакета MSIX из классической программы установки на виртуальной машине](/windows/msix/packaging-tool/create-app-package-msi-vm/).

Чтобы опубликовать приложения, выполните следующие действия.

1. В окне Поставщик ресурсов виртуальных рабочих столов Windows перейдите на вкладку **группы приложений** .

2. Выберите группу приложений, в которую необходимо опубликовать приложения.

   >[!NOTE]
   >Приложения MSIX можно доставлять с помощью приложения MSIX, подключенного к удаленным приложениям и группам приложений

3. Когда Вы находитесь в группе приложений, перейдите на вкладку **приложения** . В сетке **приложения** отобразятся все существующие приложения в группе приложений.

4. Выберите **+ Добавить** , чтобы открыть вкладку **Добавление приложения** .

      > [!div class="mx-imgBorder"]
      > ![Снимок экрана пользователя, нажав кнопку + Добавить, чтобы открыть вкладку Добавление приложения](media/select-add.png)

5. В поле **Источник приложения** выберите источник приложения.
    - Если вы используете группу классических приложений, выберите **пакет MSIX**.
      
      > [!div class="mx-imgBorder"]
      > ![Снимок экрана клиента, который выбирает пакет MSIX из раскрывающегося меню Источник приложения. Пакет MSIX выделяется красным цветом.](media/select-source.png)
    
    - Если вы используете удаленную группу приложений, выберите один из следующих вариантов.
        
        - Меню «Пуск»
        - Путь к приложению
        - Пакет MSIX

    - В поле **имя приложения** введите описательное имя приложения.

    Кроме того, можно настроить следующие дополнительные компоненты.
   
    - В поле **Отображаемое имя** введите новое имя для пакета, который будут видеть пользователи.

    - В поле **Описание** введите краткое описание пакета приложения.

    - Если вы используете удаленную группу приложений, можно также настроить следующие параметры:

        - **Путь к значку**
        - **Индекс значка**
        - **Показывать в веб-канале**

6. Когда все будет готово, нажмите кнопку **Сохранить**.

>[!NOTE]
>Когда пользователь назначен группе удаленных приложений и группе приложений рабочей группы из того же пула узлов, в веб-канале будет отображаться группа классических приложений.

## <a name="assign-a-user-to-an-app-group"></a>Назначение пользователя в группу приложений

После назначения приложений MSIX группе приложений необходимо предоставить пользователям доступ к ним. Вы можете назначить доступ, добавив пользователей или группы пользователей в группу приложений с опубликованными приложениями MSIX. Следуйте инструкциям в разделе [Управление группами приложений с помощью портал Azure](manage-app-groups.md) , чтобы назначить пользователей группе приложений.

## <a name="change-msix-package-state"></a>Изменить состояние пакета MSIX

Далее необходимо изменить состояние пакета MSIX на **активное** или **неактивное**, в зависимости от того, что нужно сделать с пакетом. Активные пакеты — это пакеты, с которыми пользователи могут взаимодействовать после публикации. Неактивные пакеты игнорируются виртуальным рабочим столом Windows, поэтому пользователи не могут взаимодействовать с приложениями внутри.

### <a name="change-state-with-the-applications-list"></a>Изменение состояния с помощью списка приложений

Чтобы изменить состояние пакета в списке приложений, выполните следующие действия.

1. Перейдите в пул узлов и выберите **пакеты MSIX**. Вы увидите список всех существующих пакетов MSIX в пуле узлов.

2. Выберите пакеты MSIX, чьи состояния необходимо изменить, а затем выберите **изменить состояние**.

### <a name="change-state-with-update-package"></a>Изменение состояния с помощью пакета обновления

Чтобы изменить состояние пакета с помощью пакета обновления, выполните следующие действия.

1. Перейдите в пул узлов и выберите **пакеты MSIX**. Вы увидите список всех существующих пакетов MSIX в пуле узлов.

2. Выберите имя пакета, состояние которого необходимо изменить, из списка пакетов MSIX. Откроется вкладка **пакет обновления** .

3. Переключите параметр **состояния** на **Неактивный** или **Активный**, а затем выберите **Сохранить.**

## <a name="change-msix-package-registration-type"></a>Изменить тип регистрации пакета MSIX

Чтобы изменить тип регистрации пакета, выполните следующие действия.

1. Выберите **пакеты MSIX**. Вы увидите список всех существующих пакетов MSIX в пуле узлов.

2. Выберите **имя пакета в** **сетке пакеты MSIX** . Откроется колонка, в которой будет обновлен пакет.

3. При необходимости переключите **тип регистрации** с помощью кнопки " **по запросу" или "вход в систему блокировки** " и нажмите кнопку " **Сохранить".**

## <a name="remove-an-msix-package"></a>Удаление пакета MSIX

Чтобы удалить пакет MSIX из пула узлов, выполните следующие действия.

1. Выберите **пакеты MSIX**.  Вы увидите список всех существующих пакетов MSIX в пуле узлов.

2. Нажмите кнопку с многоточием справа от имени пакета, который необходимо удалить, а затем выберите **Удалить**.

## <a name="remove-msix-apps"></a>Удаление MSIX приложений

Чтобы удалить отдельные приложения MSIX из пакета, выполните следующие действия.

1. Перейдите в пул узлов и выберите **группы приложений**.

2. Выберите группу приложений, из которой требуется удалить приложения MSIX.

3. Откройте вкладку **приложения** .

4. Выберите приложение, которое необходимо удалить, а затем нажмите кнопку **Удалить**.

## <a name="next-steps"></a>Дальнейшие шаги

Запросите наши вопросы сообщества об этой функции в [Windows Virtual Desktop течкоммунити](https://techcommunity.microsoft.com/t5/Windows-Virtual-Desktop/bd-p/WindowsVirtualDesktop).

Вы также можете оставить отзыв о виртуальном рабочем столе Windows в [центре обратной связи по виртуальным рабочим столам Windows](https://support.microsoft.com/help/4021566/windows-10-send-feedback-to-microsoft-with-feedback-hub-app).

Ниже приведены некоторые другие статьи, которые могут оказаться полезными.

- [Глоссарий по присоединению приложений MSIX](app-attach-glossary.md)
- [Часто задаваемые вопросы о присоединении приложения MSIX](app-attach-faq.md)
