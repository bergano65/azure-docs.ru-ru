---
title: Создание пула узла с помощью PowerShell (Предварительная версия) — Azure
description: Как создать кластер узла в виртуальный рабочий стол Windows с помощью командлетов PowerShell.
services: virtual-desktop
author: Heidilohr
ms.service: virtual-desktop
ms.topic: how-to
ms.date: 03/21/2019
ms.author: helohr
ms.openlocfilehash: 4b65d7614db94a9cc3fdca3f4b784c2c84ebaef8
ms.sourcegitcommit: 90dcc3d427af1264d6ac2b9bde6cdad364ceefcc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/21/2019
ms.locfileid: "58318544"
---
# <a name="create-a-host-pool-with-powershell-preview"></a>Создание пула узла с помощью PowerShell (Предварительная версия)

Пулы узлов представляют собой коллекцию один или несколько идентичных виртуальных машин в среде виртуального рабочего стола Windows клиента (Предварительная версия). Каждый пул узлов может содержать группы приложений, пользователи могут взаимодействовать, как если бы на рабочем столе физического.

## <a name="use-your-powershell-client-to-create-a-host-pool"></a>Используйте клиент PowerShell для создания пула узла

Во-первых, [Загрузите и импортируйте модуль PowerShell для виртуальных рабочих столов Windows](https://docs.microsoft.com/powershell/windows-virtual-desktop/overview) для использования в сеансе PowerShell, если у вас еще нет.

Выполните следующий командлет для входа в среде виртуального рабочего стола Windows

```powershell
Add-RdsAccount -DeploymentUrl https://rdbroker.wvd.microsoft.com
```

После этого запустите следующий командлет, чтобы задать контекст для вашей группы клиента. При отсутствии имени группы клиента вашего клиента, скорее всего, в группе «по умолчанию клиента», поэтому вы можете пропустить этот командлет.

```powershell
Set-RdsContext -TenantGroupName <tenantgroupname>
```

Затем выполните этот командлет, чтобы создать новый пул узлов в вашем клиенте виртуального рабочего стола Windows:

```powershell
New-RdsHostPool -TenantName <tenantname> -Name <hostpoolname>
```

Выполните следующий командлет для создания маркера регистрации для авторизации узла сеансов для присоединения к пулу узла и сохраните его в новый файл на локальном компьютере. Можно указать, как долго маркер регистрации является допустимым, используя параметр - ExpirationHours.

```powershell
New-RdsRegistrationInfo -TenantName <tenantname> -HostPoolName <hostpoolname> -ExpirationHours <number of hours> | Select-Object -ExpandProperty Token > <PathToRegFile>
```

После этого запустите этот командлет, чтобы добавить пользователей Azure Active Directory в группу по умолчанию классического приложения для пула узла.

```powershell
Add-RdsAppGroupUser -TenantName <tenantname> -HostPoolName <hostpoolname> -AppGroupName "Desktop Application Group" -UserPrincipalName <userupn>
```

**RdsAppGroupUser добавить** командлет не поддерживает добавление групп безопасности и добавит только сам одного пользователя одновременно в группу приложений. Если вы хотите добавить нескольких пользователей в группу приложений, повторно запустите командлет с именами участника-пользователя.

Выполните следующий командлет, чтобы экспортировать маркер регистрации в переменной, которая будет использоваться позже при работе [регистрация виртуальных машин в пул узлов виртуального рабочего стола Windows](#register-the-virtual-machines-to-the-windows-virtual-desktop-host-pool).

```powershell
$token = (Export-RdsRegistrationInfo -TenantName <tenantname> -HostPoolName <hostpoolname>).Token
```

## <a name="create-virtual-machines-for-the-host-pool"></a>Создание виртуальных машин для узлов кластера

Теперь можно создать виртуальную машину Azure, можно объединить в пул узлов виртуального рабочего стола Windows.

Виртуальную машину можно создать несколькими способами:

- [Создание виртуальной машины из образа коллекции Azure](https://docs.microsoft.com/azure/virtual-machines/windows/quick-create-portal#create-virtual-machine)
- [Создание виртуальной машины из управляемого образа](https://docs.microsoft.com/azure/virtual-machines/windows/create-vm-generalized-managed)
- [Создание виртуальной машины из неуправляемого образа](https://github.com/Azure/azure-quickstart-templates/tree/master/101-vm-from-user-image)

## <a name="prepare-the-virtual-machines-for-windows-virtual-desktop-agent-installations"></a>Подготовка виртуальных машин для установки агентов виртуальный рабочий стол Windows

Вам потребуется выполнить следующие действия для подготовки виртуальных машин, прежде чем можно установить агенты виртуального рабочего стола Windows и зарегистрировать виртуальные машины в пул узлов виртуального рабочего стола Windows.

- Необходимо выполнить присоединение к домену компьютера. Это позволяет входящим пользователям виртуального рабочего стола Windows для сопоставления из своей учетной записи Azure Active Directory для своей учетной записи Active Directory и успешно разрешен доступ к виртуальной машине.
- Необходимо установить роль узла сеансов удаленных рабочих столов (RDSH) (Предварительная версия), если виртуальная машина работает под управлением ОС Windows Server. Роль RDSH позволяет агентам виртуальный рабочий стол Windows правильной установки.

Для успешного присоединения к домену выполните указанные ниже действия на каждой виртуальной машине.

1. [Подключение к виртуальной машине](https://docs.microsoft.com/azure/virtual-machines/windows/quick-create-portal#connect-to-virtual-machine) с учетными данными, указанным при создании виртуальной машины.
2. На виртуальной машине, запустите **панели управления** и выберите **системы**.
3. Выберите **имя компьютера**выберите **изменить параметры**, а затем выберите **изменений...**
4. Выберите **домена** и затем введите имя домена Active Directory в виртуальной сети.
5. Проверка подлинности с учетной записью домена, имеющей права на присоединение к домену компьютеры.

## <a name="register-the-virtual-machines-to-the-windows-virtual-desktop-host-pool"></a>Регистрация виртуальных машин в пул узлов виртуального рабочего стола Windows

Регистрация виртуальных машин в кластер узлов виртуального рабочего стола Windows является простым — установите агенты виртуального рабочего стола Windows.

Чтобы зарегистрировать agents виртуального рабочего стола Windows, выполните следующие действия на каждой виртуальной машине.

1. [Подключение к виртуальной машине](https://docs.microsoft.com/azure/virtual-machines/windows/quick-create-portal#connect-to-virtual-machine) с учетными данными, указанным при создании виртуальной машины.
2. Скачайте и установите агент виртуального рабочего стола Windows.
   - Скачайте [агента виртуального рабочего стола Windows](https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RWrmXv).
   - Щелкните правой кнопкой мыши Скачанный установщик, выберите **свойства**выберите **Unblock**, а затем выберите **ОК**. Это позволит системе доверять установщик.
   - Запустите установщик. Когда программа установки запрашивает маркер регистрации, введите значение, полученное из **RdsRegistrationInfo экспорта** командлета.
3. Скачайте и установите агент загрузчик виртуального рабочего стола Windows.
   - Скачайте [загрузчика агента виртуального рабочего стола Windows](https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RWrxrH).
   - Щелкните правой кнопкой мыши Скачанный установщик, выберите **свойства**выберите **Unblock**, а затем выберите **ОК**. Это позволит системе доверять установщик.
   - Запустите установщик.
4. Установить или активировать side-by-side стека виртуального рабочего стола Windows. Шаги будут отличаться в зависимости от версии операционной системы на виртуальной машине используются.
   - Если Операционной системы виртуальной машины Windows Server 2016:
     - Скачайте [стека side-by-side виртуальный рабочий стол Windows](https://go.microsoft.com/fwlink/?linkid=2084270).
     - Щелкните правой кнопкой мыши Скачанный установщик, выберите **свойства**выберите **Unblock**, а затем выберите **ОК**. Это позволит системе доверять установщик.
     - Запустите установщик.
   - Если Операционной системы виртуальной машины Windows 10 1809 или более поздней версии или Windows Server 2019 или более поздней версии:
     - Скачайте [сценарий](https://go.microsoft.com/fwlink/?linkid=2084268) для активации side-by-side стека.
     - Щелкните загруженный скрипт правой кнопкой мыши **свойства**выберите **Unblock**, а затем выберите **ОК**. Это позволит системе доверять скрипт.
     - Из **запустить** меню поиска для интегрированной среды Сценариев Windows PowerShell, щелкните его правой кнопкой мыши, а затем выберите **Запуск от имени администратора**.
     - Выберите **файл**, затем **открыть...** , а затем найдите скрипт PowerShell из загруженные файлы и откройте его.
     - Выберите зеленую кнопку воспроизведения для запуска скрипта.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы внесли пула узла, пришло время для заполнения RemoteApps (Предварительная версия). Дополнительные сведения о том, как управлять приложениями в виртуальный рабочий стол Windows, см. в разделе Управление руководства групп приложений.

> [!div class="nextstepaction"]
> [Руководство по приложениям группы управления](./manage-app-groups.md)
