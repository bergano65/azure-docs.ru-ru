---
title: Создание и использование файлов ресурсов
description: Сведения о том, как создавать файлы ресурсов пакетной службы из различных источников входных данных. В этой статье описаны некоторые распространенные методы создания файлов ресурсов и размещения их на виртуальной машине.
ms.date: 03/18/2020
ms.topic: how-to
ms.openlocfilehash: 22c0220d08660402bef3fd4aaf0add6adc12a295
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "89230948"
---
# <a name="creating-and-using-resource-files"></a>Создание и использование файлов ресурсов

Для обработки в рамках задач пакетной службы Azure часто требуется определенная форма данных. Файлы ресурсов позволяют предоставить эти данные для виртуальной машины пакетной службы с помощью задачи. Файлы ресурсов поддерживают все типы задач: задачи, задачи запуска, задачи подготовки заданий, задачи прекращения заданий и т. д. В этой статье описаны некоторые распространенные методы создания файлов ресурсов и размещения их на виртуальной машине.  

Файлы ресурсов помещают данные в виртуальную машину в пакетной службе, но тип данных и способ их использования не являются жестко заданными. Однако существуют некоторые распространенные варианты использования.

1. Подготовка общих файлов на каждой виртуальной машине с помощью файлов ресурсов в задаче запуска.
1. Подготовка входных данных для обработки задачами.

Общими файлами могут быть, например, файлы в задаче запуска, используемые для установки приложений, выполняемых задачами. Входные данные могут представлять собой необработанные изображения или видеоданные, а также любую информацию, которую будет обрабатывать пакетная служба.

## <a name="types-of-resource-files"></a>Типы файлов ресурсов

Для создания файлов ресурсов можно использовать несколько различных вариантов. Процесс создания файлов ресурсов зависит от места хранения исходных данных.

Варианты для создания файла ресурсов

- [URL-адрес контейнера хранилища](#storage-container-url): создает файл ресурсов из любого контейнера хранилища в Azure.
- [Имя контейнера хранилища](#storage-container-name): создает файл ресурсов из имени контейнера в учетной записи хранения Azure, связанной с пакетной службой.
- [Конечная веб-точка](#web-endpoint): создает файл ресурсов из любого допустимого URL-адреса HTTP.

### <a name="storage-container-url"></a>URL-адрес контейнера хранилища

Использование URL-адреса контейнера хранилища означает, что с подходящими разрешениями вы можете получить доступ к файлам в любом контейнере хранилища в Azure. 

В этом примере C# файлы уже были переданы в контейнер хранилища Azure в качестве хранилища BLOB-объектов. Чтобы получить доступ к данным, необходимым для создания файла ресурсов, сначала нужно получить доступ к контейнеру хранилища.

Создайте URI подписанного URL-адреса (SAS) с подходящими разрешениями для доступа к контейнеру хранилища. Задайте срок действия и разрешения для SAS. В этом случае время начала не указано, поэтому SAS начинает действовать немедленно, а срок его действия истекает через два часа после создания.

```csharp
SharedAccessBlobPolicy sasConstraints = new SharedAccessBlobPolicy
{
    SharedAccessExpiryTime = DateTime.UtcNow.AddHours(2),
    Permissions = SharedAccessBlobPermissions.Read | SharedAccessBlobPermissions.List
};
```

> [!NOTE]
> Для доступа к контейнеру необходимо иметь разрешения `Read` и `List`, в то время как для доступа к BLOB-объектам требуется только разрешение `Read`.

После настройки разрешений создайте маркер SAS и отформатируйте подписанный URL-адрес для доступа к контейнеру хранилища. Используя отформатированный подписанный URL-адрес для контейнера хранилища, создайте файл ресурсов с [`FromStorageContainerUrl`](/dotnet/api/microsoft.azure.batch.resourcefile.fromstoragecontainerurl).

```csharp
CloudBlobContainer container = blobClient.GetContainerReference(containerName);

string sasToken = container.GetSharedAccessSignature(sasConstraints);
string containerSasUrl = String.Format("{0}{1}", container.Uri, sasToken);

ResourceFile inputFile = ResourceFile.FromStorageContainerUrl(containerSasUrl);
```

В качестве альтернативы созданию подписанного URL-адреса можно включить анонимный открытый доступ на чтение к контейнеру и его большим двоичным объектам в хранилище BLOB-объектов Azure. Таким образом можно предоставить доступ только для чтения к этим ресурсам, не передавая ключ учетной записи и не требуя подписанного URL-адреса. Открытый доступ на чтение обычно используется для сценариев, когда определенные большие двоичные объекты нужно сделать всегда доступными для анонимного доступа на чтение. Если этот сценарий подходит для вашего решения, см. статью [Анонимный доступ к большим двоичным объектам](../storage/blobs/storage-manage-access-to-resources.md) с подробными сведениями об управлении доступом к данным BLOB-объектов.

### <a name="storage-container-name"></a>Имя контейнера хранилища

Вместо настройки и создания подписанного URL-адреса для доступа к данным BLOB-объектов можно использовать имя контейнера хранилища Azure. Используемый контейнер хранилища должен находиться в учетной записи хранения Azure, связанной с учетной записью пакетной службы. Такая учетная запись хранения называется учетной записью автоматического хранения. Используя контейнер автоматического хранения, можно обойти настройку и создание подписанного URL-адреса для доступа к контейнеру хранилища.

В этом примере предполагается, что данные, используемые для создания файла ресурсов, уже находятся в учетной записи хранения Azure, связанной с учетной записью пакетной службы. Если у вас нет учетной записи автоматического хранения, см. раздел [Создание учетной записи пакетной службы](batch-account-create-portal.md) с дополнительными сведениями о создании и связывании учетной записи.

При использовании связанной учетной записи хранения вам не нужно создавать и настраивать подписанный URL-адрес для контейнера хранилища. Вместо этого укажите имя контейнера хранилища в связанной учетной записи хранения.

```csharp
ResourceFile inputFile = ResourceFile.FromAutoStorageContainer(containerName);
```

### <a name="web-endpoint"></a>Конечная веб-точка

Данные, которые не передаются в службу хранилища Azure, по-прежнему можно использовать для создания файлов ресурсов. Можно указать любой допустимый URL-адрес HTTP, содержащий входные данные. URL-адрес предоставляется API пакетной службы, а затем данные используются для создания файла ресурсов.

В следующем примере C# входные данные размещаются на фиктивной конечной точке GitHub. API извлекает файл из допустимой конечной веб-точки и создает файл ресурсов, который будет использоваться задачей. Для этого сценария учетные данные не требуются.

```csharp
ResourceFile inputFile = ResourceFile.FromUrl("https://github.com/foo/file.txt", filePath);
```

## <a name="tips-and-suggestions"></a>Советы и рекомендации

Каждая задача пакетной службы Azure использует файлы по-разному, поэтому пакетная служба располагает возможностями для управления файлами в задачах. Приведенные ниже сценарии не являются исчерпывающими, но они охватывают несколько типичных ситуаций и предоставляют рекомендации.

### <a name="many-resource-files"></a>Множество файлов ресурсов

Пакетное задание может содержать несколько задач, использующих одни и те же общие файлы. Если общие файлы задач совместно используются несколькими задачами, вместо использования файлов ресурсов лучшим вариантом может оказаться использование пакета приложения для хранения файлов. Пакеты приложений обеспечивают оптимизацию скорости скачивания. Кроме того, данные в пакетах приложений кэшируются между задачами, поэтому, если файлы задач меняются нечасто, пакеты приложений могут стать хорошим выбором для вашего решения. При использовании пакетов приложений вам не нужно вручную управлять несколькими файлами ресурсов или создавать подписанные URL-адреса для доступа к файлам в службе хранилища Azure. Пакетная служба работает со службой хранилища Azure в фоновом режиме, обеспечивая хранение пакетов приложений и их развертывание на вычислительных узлах.

Если каждая задача имеет много файлов, уникальных для этой задачи, лучше всего использовать файлы ресурсов, так как часто требуется обновление или замена задач, использующих уникальные файлы, что не так просто делать с содержимым пакетов приложений. Файлы ресурсов обеспечивают дополнительную гибкость при обновлении, добавлении или изменении отдельных файлов.

### <a name="number-of-resource-files-per-task"></a>Количество файлов ресурсов на задачу

Если в задаче указано несколько сотен файлов ресурсов, пакетная служба может отклонить ее как слишком большую. Лучше всего делать задачи небольшими, минимизировав количество файлов ресурсов в них.

Если не удается сократить количество необходимых задаче файлов, можно оптимизировать задачу, создав отдельный файл ресурсов, который ссылается на контейнер хранилища с файлами ресурсов. Для этого вставьте файлы ресурсов в контейнер службы хранилища Azure и используйте различные [методы](/dotnet/api/microsoft.azure.batch.resourcefile#methods) контейнера для файлов ресурсов. Используйте параметры префикса BLOB-объектов, чтобы указать коллекции файлов, которые будут скачаны для задач.

## <a name="next-steps"></a>Дальнейшие действия

- См. сведения об использовании [пакетов приложений](batch-application-packages.md) в качестве альтернативы файлам ресурсов.
- Дополнительные сведения об использовании контейнеров для файлов ресурсов см. в разделе [Рабочие нагрузки контейнеров](batch-docker-container-workloads.md).
- Чтобы узнать, как собрать и сохранить выходные данные задач, см. раздел [Сохранение выходных данных заданий и задач](batch-task-output.md).
- См. дополнительные сведения об [API-интерфейсах и средствах пакетной службы](batch-apis-tools.md) для сборки решений пакетной службы.
