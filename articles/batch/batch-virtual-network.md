---
title: Подготовка пула в виртуальной сети. Пакетная служба Azure | Документация Майкрософт
description: Как создать в виртуальной сети Azure пул пакетной службы, чтобы вычислительные узлы безопасно взаимодействовали с другими виртуальными машинами в сети, например с файловым сервером.
services: batch
author: laurenhughes
manager: gwallace
ms.service: batch
ms.topic: article
ms.date: 04/10/2019
ms.author: lahugh
ms.custom: seodec18
ms.openlocfilehash: 78f29bacaadac5f01e4a8dd26bf03b2bda84f2bf
ms.sourcegitcommit: f4d8f4e48c49bd3bc15ee7e5a77bee3164a5ae1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73577580"
---
# <a name="create-an-azure-batch-pool-in-a-virtual-network"></a>Создание пула пакетной службы Azure в виртуальной сети

Если вы создадите пул пакетной службы Azure, его можно будет подготовить в подсети любой [виртуальной сети Azure](../virtual-network/virtual-networks-overview.md). В этой статье описывается настройка пула пакетной службы в виртуальной сети. 

## <a name="why-use-a-vnet"></a>Для чего нужна виртуальная сеть?

Пул пакетной службы Azure содержит настройки для взаимодействия между вычислительными узлами, например для выполнения задач с несколькими экземплярами. Для этих настроек не требуется отдельная виртуальная сеть. Но узлы по умолчанию не могут взаимодействовать с виртуальными машинами, которые не входят в пул пакетной службы, например с сервером лицензий или файловым сервером. Чтобы вычислительные узлы пула могли безопасно взаимодействовать с другими виртуальными машинами или с локальной сетью, вы можете подготовить пул в подсети виртуальной сети Azure. 

## <a name="prerequisites"></a>Предварительные требования

* **Проверка подлинности**. Для использования виртуальной сети Azure API клиента пакетной службы должен использовать проверку подлинности Azure Active Directory (AD). Поддержка Azure AD пакетной службой Azure описана в статье [Аутентификация решений пакетной службы с помощью Active Directory](batch-aad-auth.md). 

* **Виртуальная сеть Azure**. Требования к виртуальной сети и конфигурация приведены в следующем разделе. Чтобы заранее подготовить виртуальную сеть с одной или несколькими подсетями, вы можете использовать портал Azure, Azure PowerShell, интерфейс командной строки Azure (CLI) или другие методы.  
  * Чтобы создать виртуальную сеть на основе Azure Resource Manager, изучите раздел [Create a virtual network](../virtual-network/manage-virtual-network.md#create-a-virtual-network) (Создание виртуальной сети). Виртуальную сеть на основе Resource Manager рекомендуется использовать для новых развертываний. Она поддерживается только в пулах на основе конфигурации виртуальных машин.
  * Чтобы создать классическую виртуальную сеть, см. статью [Создание (классической) виртуальной сети с несколькими подсетями](../virtual-network/create-virtual-network-classic.md). Классическая виртуальная сеть поддерживается только в пулах на основе конфигурации облачных служб.

## <a name="vnet-requirements"></a>Требования к виртуальной сети

[!INCLUDE [batch-virtual-network-ports](../../includes/batch-virtual-network-ports.md)]

## <a name="create-a-pool-with-a-vnet-in-the-portal"></a>Создание пула с виртуальной сетью на портале

Когда вы создадите виртуальную сеть и назначите ей подсеть, вы сможете создать пул пакетной службы с этой виртуальной сетью. Выполните следующие действия для создания пула с помощью портала Azure: 

1. Войдите в свою учетную запись пакетной службы на портале Azure. Эта учетная запись должна принадлежать к той же подписке и региону, что и группа ресурсов, содержащая целевую виртуальную сеть. 
2. В окне **Параметры** слева выберите пункт меню **Пулы**.
3. В окне **Пулы** выберите команду **Добавить**.
4. В окне **Добавить пул** из раскрывающегося списка **Тип образа** выберите нужный вариант. 
5. Выберите правильного **издателя, предложение, SKU** для пользовательского образа.
6. Укажите оставшиеся необходимые параметры, в том числе **Размер узла**, **Target dedicated nodes** (Целевые выделенные узлы) и **Узлы с низким приоритетом**, а также любые необходимые дополнительные параметры.
7. В разделе **Виртуальная сеть** выберите виртуальную сеть и подсеть, которые вы хотите использовать.
  
   ![Добавление пула с виртуальной сетью](./media/batch-virtual-network/add-vnet-pool.png)

## <a name="user-defined-routes-for-forced-tunneling"></a>Пользовательские маршруты для принудительного туннелирования

Возможно, в вашей организации требуется принудительно перенаправлять трафик, направленный из подсети в Интернет, обратно в локальное расположение для проверки и ведения журнала. В таком случае вы, скорее всего, используете принудительное туннелирование для подсетей виртуальной сети. 

Чтобы вычислительные узлы пула пакетной службы Azure нормально работали в виртуальной сети, для которой используется принудительное туннелирование, добавьте для этой подсети следующие [пользовательские маршруты](../virtual-network/virtual-networks-udr-overview.md).

* Пакетная служба должна взаимодействовать с вычислительными узлами пула для планирования задач. Чтобы обеспечить такое взаимодействие, добавьте пользовательские маршруты для всех IP-адресов, которые использует пакетная служба, в том регионе, где существует ваша учетная запись пакетной службы. Чтобы узнать, как получить список IP-адресов пакетной службы, см. раздел [теги служб в локальной среде](../virtual-network/service-tags-overview.md) .

* Убедитесь, что исходящий трафик к хранилищу Azure (в частности, на URL-адреса вида `<account>.table.core.windows.net`, `<account>.queue.core.windows.net` и `<account>.blob.core.windows.net`) не блокируется локальными сетевыми устройствами.

При добавлении определяемого пользователем маршрута укажите маршрут для каждого связанного префикса IP-адреса пакетной службы, а также задайте для параметра**Тип следующего прыжка** значение **Интернет**. Как в этом примере:

![определяемый пользователем маршрут;](./media/batch-virtual-network/user-defined-route.png)

## <a name="next-steps"></a>Дальнейшие действия

- Исчерпывающий обзор пакетной службы см. в статье [Разработка решений для крупномасштабных параллельных вычислений с использованием пакетной службы](batch-api-basics.md).
- Дополнительные сведения о создании определяемого пользователем маршрута см. в разделе [Создание определяемого пользователем маршрута с помощью портала Azure](../virtual-network/tutorial-create-route-table-portal.md).
