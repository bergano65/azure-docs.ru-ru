---
title: Проверка на наличие ошибок заданий и задач
description: Сведения об ошибках для проверки и устранении неполадок заданий и задач.
author: mscurrell
ms.topic: how-to
ms.date: 11/23/2020
ms.author: markscu
ms.openlocfilehash: d8cf3b5e28d4455e00e0bdcbae2063771d3e8acd
ms.sourcegitcommit: 1bf144dc5d7c496c4abeb95fc2f473cfa0bbed43
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/24/2020
ms.locfileid: "95736805"
---
# <a name="job-and-task-error-checking"></a>Проверка ошибок для заданий и задач

Существует множество ошибок, которые могут возникнуть при добавлении заданий и задач. Процесс обнаружения ошибок для этих операций довольно прост, так как все ошибки сразу возвращаются через API, интерфейс командной строки или пользовательский интерфейс. Однако существуют также сбои, которые могут произойти позже, когда задания и задачи планируются и выполняются.

В этой статье рассматриваются ошибки, которые могут возникать после отправки заданий и задач, а также способы их проверки и решения.

## <a name="jobs"></a>Задания

Задание — это группирование одной или нескольких задач, при этом задачи фактически указывают командные строки для выполнения.

При добавлении задания следует обратить внимание на следующие параметры, которые могут повлиять на возможные сбои в работе.

- [Ограничения заданий](/rest/api/batchservice/job/add#jobconstraints)
  - При необходимости свойство `maxWallClockTime` может быть включено, чтобы установить максимальное время, в течение которого задание может быть активным или работающим. При превышении предела задание будет завершено, при этом изменив свойство `terminateReason` в [executionInfo](/rest/api/batchservice/job/get#cloudjob).
- [Задача подготовки задания](/rest/api/batchservice/job/add#jobpreparationtask)
  - При включении параметра задача подготовки задания будет выполняться при первом запуске задачи на узле. Задача подготовки задания может завершиться с ошибкой, что приведет к невыполнению задачи, а задание не будет завершено.
- [Задача отключения задания](/rest/api/batchservice/job/add#jobreleasetask)
  - Задачу отключения задания можно указать только в том случае, когда настроена задача подготовки задания. Когда задание завершится, задача отключения задания выполнится на каждом узле пула, где выполнялась задача подготовки задания. Задача отключения может завершиться с ошибкой, но само задание по-прежнему перейдет в состояние `completed`.

### <a name="job-properties"></a>Свойства задания

Следующие свойства заданий следует проверять на наличие ошибок.

- [executionInfo](/rest/api/batchservice/job/get#jobexecutioninformation):
  - Свойство `terminateReason` может иметь значения, указывающие, что указанное в ограничениях для задания `maxWallClockTime` было превышено и поэтому задание было завершено. Его также можно задать, чтобы указать, что задача завершилась ошибкой, если свойство `onTaskFailure` было настроено соответствующим образом.
  - Свойство [schedulingError](/rest/api/batchservice/job/get#jobschedulingerror) устанавливается при возникновении ошибки планирования.

### <a name="job-preparation-tasks"></a>Задачи подготовки задания

Если задача подготовки задания была установлена для задания, то экземпляр этой задачи будет выполнен при первом запуске задачи для данного задания на узле. Настроенная задача подготовки задания по сути является шаблоном задачи, при этом выполняется несколько экземпляров задач подготовки, вплоть до количества узлов в пуле.

Следующие экземпляры задач подготовки задания следует проверять на ошибки.

- Когда запускается задача подготовки задания, задача, которая активировала задачу подготовки задания, переходит в [состояние](/rest/api/batchservice/task/get#taskstate) `preparing`; если задача подготовки задания завершается с ошибкой, то задача, вызывающая срабатывание, вернется к состоянию `active` и не будет выполняться.
- Все экземпляры задачи подготовки задания, которые были запущены, можно получить из задания через API [Список статуса задач подготовки и отключения](/rest/api/batchservice/job/listpreparationandreleasetaskstatus). Как и в случае с любой другой задачей, [сведения о выполнении](/rest/api/batchservice/job/listpreparationandreleasetaskstatus#jobpreparationandreleasetaskexecutioninformation) имеют несколько свойств, такие как `failureInfo`, `exitCode` и `result`.
- Если задача подготовки задания завершается с ошибкой, то запустившая задание задача не будет выполняться, а само задание остановится и не будет выполнена. Пул может оставаться неиспользованным при отсутствии заданий с задачами, которые можно запланировать.

### <a name="job-release-tasks"></a>Задачи отключения задания

Если для задания задана задача выпуска, то при завершении задания на каждом узле пула, где выполнялась задача подготовки задания, выполняется экземпляр задачи выпуска задания. Следующие экземпляры задач остановки задания следует проверять на ошибки:

- Все экземпляры задачи остановки задания, которые были запущены, можно получить из задания через API [Список статуса задач подготовки и отключения](/rest/api/batchservice/job/listpreparationandreleasetaskstatus). Как и в случае с любой другой задачей, [сведения о выполнении](/rest/api/batchservice/job/listpreparationandreleasetaskstatus#jobpreparationandreleasetaskexecutioninformation) имеют несколько свойств, такие как `failureInfo`, `exitCode` и `result`.
- Если одна или несколько задач остановки задания завершаются с ошибкой, задание будет по-прежнему завершено и перейдет в состояние `completed`.

## <a name="tasks"></a>Задания

Задачи могут завершаться ошибкой по нескольким причинам:

- Командная строка задачи завершается неудачно, возвращаясь с ненулевым кодом выхода.
- `resourceFiles`Для задачи указано, но произошла ошибка, из-за которой не были загружены один или несколько файлов.
- `outputFiles`Для задачи задано значение, но произошла ошибка, которая означала, что один или несколько файлов не были отправлены.
- Был превышен предел времени для задачи, установленный свойством `maxWallClockTime` в [ограничениях задачи](/rest/api/batchservice/task/add#taskconstraints).

Во всех представленных случаях следует проверить на ошибки (и ознакомиться с информацией об ошибках) следующие свойства.

- Свойство [executionInfo](/rest/api/batchservice/task/get#taskexecutioninformation) содержит несколько свойств, предоставляющих сведения об ошибке. Свойство [result](/rest/api/batchservice/task/get#taskexecutionresult) указывает на наличие факта сбоя, а `exitCode` и `failureInfo` предоставляют более подробную информацию о данном сбое.
- Задача всегда будет переходить в [состояние](/rest/api/batchservice/task/get#taskstate) `completed` независимо от того, была ли она завершена успешно или нет.

Влияние сбоев задач на задание и любые зависимости задач обязательно должно быть рассмотрено. Свойство [exitConditions](/rest/api/batchservice/task/add#exitconditions) может быть установлено для задачи, чтобы настроить действия для зависимостей и для задания.

- Для зависимостей свойство [DependencyAction](/rest/api/batchservice/task/add#dependencyaction) определяет, блокируются или выполняются задачи, зависящие от невыполненной задачи.
- Для задания свойство [JobAction](/rest/api/batchservice/task/add#jobaction) определяет, будет ли неудачная задача приводить к отключению, завершению задания или сохранению заданием прежнего статуса.

### <a name="task-command-line-failures"></a>Сбои командной строки задачи

При выполнении командной строки задачи выходные данные записываются в `stderr.txt` и `stdout.txt`. Кроме того, приложение может выполнять запись в относящиеся к нему файлы журналов.

Если узел пула, на котором выполняется задача, все еще существует, то файлы журнала с него можно получить и просмотреть. Например, портал Azure выводит списки файлов журналов для узла или пула, а также может их просматривать. Несколько интерфейсов API также позволяют выводить и получать списки файлов задач, например [Get From Task](/rest/api/batchservice/file/getfromtask).

Так как пулы и узлы пулов часто являются временными, при этом узлы постоянно добавляются и удаляются, рекомендуется сохранять файлы журнала. [Выходные файлы задач](./batch-task-output-files.md) — удобный способ сохранения файлов журнала в службе хранилища Microsoft Azure.

Командные строки, выполняемые задачами на расчетных узлах, не выполняются в оболочке, поэтому они не могут использовать преимущества таких функций оболочки, как расширение переменных среды. Чтобы воспользоваться преимуществами таких функций, необходимо [вызвать оболочку в командной строке](batch-compute-node-environment-variables.md#command-line-expansion-of-environment-variables).

### <a name="output-file-failures"></a>Сбои выходного файла

В каждом сеансе передачи файла пакетная служба записывает в вычислительный узел два файла журнала: `fileuploadout.txt` и `fileuploaderr.txt`. Для получения дополнительных сведений о конкретной ошибке можно проанализировать файлы журнала. В тех случаях, когда передача файлов никогда не выполнялась, например в случае невозможности выполнения самой задачи, эти файлы журналов вообще не будут записаны.  

## <a name="next-steps"></a>Дальнейшие действия

- Убедитесь, что ваше приложение будет включать в себя полноценную проверку ошибок. Это, несомненно, важно для немедленного обнаружения и диагностики проблем.
- Дополнительные сведения о [заданиях и задачах](jobs-and-tasks.md).