---
title: Подключение кластера Avere vFXT в Azure
description: Сведения о подключении клиентов к Avere vFXT для Azure.
author: ekpgh
ms.service: avere-vfxt
ms.topic: conceptual
ms.date: 10/31/2018
ms.author: rohogue
ms.openlocfilehash: c461b379629927e8f367fad9bfc70b87413f47b7
ms.sourcegitcommit: 1c2659ab26619658799442a6e7604f3c66307a89
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/10/2019
ms.locfileid: "72255387"
---
# <a name="mount-the-avere-vfxt-cluster"></a>Подключение кластера Avere vFXT  

Чтобы подключить клиентские компьютеры к кластеру vFXT, выполните приведенные ниже шаги.

1. Решите, как распределить нагрузку трафика клиентов между узлами кластера. Подробные сведения см. разделе [Распределение нагрузки клиента](#balance-client-load). 
1. Определите IP-адрес и путь соединения для подключения.
1. Выполните [команду подключения](#mount-command-arguments) с соответствующими аргументами.

## <a name="balance-client-load"></a>Распределение нагрузки клиента

Чтобы помочь распределить клиентские запросы между всеми узлами в кластере, подключите клиенты к полному диапазону IP-адресов, ориентированных на клиенты. Существует несколько простых способов автоматизации этой задачи.

> [!TIP] 
> Для больших или сложных систем могут подходить другие методы балансировки нагрузки. Чтобы получить помощь, [откройте запрос в службу поддержки](avere-vfxt-open-ticket.md#open-a-support-ticket-for-your-avere-vfxt).
> 
> Если для автоматической балансировки нагрузки на стороне сервера вы предпочитаете использовать DNS-сервер, вам необходимо настроить собственный DNS-сервер и управлять им в Azure. В таком случае вы можете настроить циклический DNS для кластера vFXT, выполнив инструкции, приведенные в статье [Настройка DNS для кластера Avere](avere-vfxt-configure-dns.md).

### <a name="sample-balanced-client-mounting-script"></a>Пример сценария сбалансированного подключения клиентов

В этом примере кода IP-адреса клиентов используются в качестве элемента рандомизации для распределения клиентов на все доступные IP-адреса кластера vFXT.

```bash
function mount_round_robin() {
    # to ensure the nodes are spread out somewhat evenly the default 
    # mount point is based on this node's IP octet4 % vFXT node count.
    declare -a AVEREVFXT_NODES="($(echo ${NFS_IP_CSV} | sed "s/,/ /g"))"
    OCTET4=$((`hostname -i | sed -e 's/^.*\.\([0-9]*\)/\1/'`))
    DEFAULT_MOUNT_INDEX=$((${OCTET4} % ${#AVEREVFXT_NODES[@]}))
    ROUND_ROBIN_IP=${AVEREVFXT_NODES[${DEFAULT_MOUNT_INDEX}]}

    DEFAULT_MOUNT_POINT="${BASE_DIR}/default"

    # no need to write again if it is already there
    if ! grep --quiet "${DEFAULT_MOUNT_POINT}" /etc/fstab; then
        echo "${ROUND_ROBIN_IP}:${NFS_PATH}    ${DEFAULT_MOUNT_POINT}    nfs hard,nointr,proto=tcp,mountproto=tcp,retry=30 0 0" >> /etc/fstab
        mkdir -p "${DEFAULT_MOUNT_POINT}"
        chown nfsnobody:nfsnobody "${DEFAULT_MOUNT_POINT}"
    fi
    if ! grep -qs "${DEFAULT_MOUNT_POINT} " /proc/mounts; then
        retrycmd_if_failure 12 20 mount "${DEFAULT_MOUNT_POINT}" || exit 1
    fi   
} 
```

Приведенная выше функция является частью примера с пакетной службой, доступного на сайте [GitHub](https://github.com/Azure/Avere#tutorials).

## <a name="create-the-mount-command"></a>Создание команды подключения 

> [!NOTE]
> Если вы не создали контейнер больших двоичных объектов вместе с кластером Avere vFXT, прежде чем пытаться подключить клиенты, выполните инструкции, описанные в статье о [настройке хранилища](avere-vfxt-add-storage.md).

Со стороны клиента команда ``mount`` сопоставляет виртуальный сервер (vserver) в кластере vFXT с путем в локальной файловой системе. Формат — ``mount <vFXT path> <local path> {options}``.

Команда подключения состоит из трех элементов: 

* путь vFXT (комбинация IP-адреса и пути соединения по пространству имен, описанная ниже);
* локальный путь (путь в клиенте); 
* параметры команды подключения (перечислены в разделе [Аргументы команды подключения](#mount-command-arguments)).

### <a name="junction-and-ip"></a>Соединение и IP

Путь к vserver представляет собой комбинацию его *IP-адреса* и пути к *соединению по пространству имен*. Соединение по пространству имен является виртуальным путем, определенным при добавлении системы хранения.

Если ваш кластер был создан с хранилищем BLOB-объектов, путь к пространству имен — `/msazure`.

Пример: ``mount 10.0.0.12:/msazure /mnt/vfxt``

Если вы добавили хранилище после создания кластера, путь к соединению по пространству имен соответствует значению, установленному в разделе **Namespace path** (Путь к пространству имен) при создании соединения. Например, если вы использовали ``/avere/files`` в качестве пути к пространству имен, ваши клиенты подключат путь *IP-адрес*:/avere/files к своей локальной точке подключения.

![Диалоговое окно добавления нового соединения с /avere/files в поле пути к пространству имен](media/avere-vfxt-create-junction-example.png)


IP-адрес представляет собой один из определенных для vserver IP-адресов, ориентированных на клиенты. Диапазон IP-адресов, взаимодействующих с клиентами, можно найти в двух расположениях на панели управления Avere:

* Таблица **VServers** (вкладка панели мониторинга): 

  ![Вкладка Dashboard (Панель мониторинга) на панели управления Avere со вкладкой VServer, выбранной в таблице данных под графиком, и обведенным разделом IP-адресов](media/avere-vfxt-ip-addresses-dashboard.png)

* Страница параметров **Client Facing Network** (Сеть, ориентированная на клиента): 

  ![Settings (Параметры) > VServer> страница конфигурации Client Facing Network (Сеть, ориентированная на клиента) с обведенным разделом Address Range (Диапазон адресов) в таблице для конкретного vserver](media/avere-vfxt-ip-addresses-settings.png)

В дополнение к путям, при подключении каждого клиента добавьте описанные ниже [аргументы команды подключения](#mount-command-arguments).

### <a name="mount-command-arguments"></a>Аргументы команды подключения

Чтобы обеспечить простое подключение клиента, передайте эти параметры и аргументы в команде подключения: 

``mount -o hard,nointr,proto=tcp,mountproto=tcp,retry=30 ${VSERVER_IP_ADDRESS}:/${NAMESPACE_PATH} ${LOCAL_FILESYSTEM_MOUNT_POINT}``


| Обязательные параметры | |
--- | --- 
``hard`` | Нежесткие подключения к кластеру vFXT связаны со сбоями в работе приложений и возможной потерей данных. 
``proto=netid`` | Этот параметр поддерживает соответствующую обработку сетевых ошибок NFS.
``mountproto=netid`` | Этот параметр поддерживает соответствующую обработку сетевых ошибок для операций подключения.
``retry=n`` | Задайте значение ``retry=30``, чтобы избежать временных ошибок при подключении. (При подключении переднего плана рекомендуется использовать другое значение.)

| Предпочтительные параметры  | |
--- | --- 
``nointr``            | Параметр nointr предпочтителен для клиентов с устаревшими ядрами (до апреля 2008 г.), которые его поддерживают. Обратите внимание, что значением по умолчанию выступает параметр intr.


## <a name="next-steps"></a>Следующие шаги

После подключения клиентов вы можете использовать их для заполнения серверного хранилища данных (основное файловое хранилище). Сведения о дополнительных задачах настройки см. в следующих статьях.

* [Moving data to the vFXT cluster - Parallel data ingest](avere-vfxt-data-ingest.md) (Перемещение данных в кластер vFXT. Прием параллельных данных). В этой статье представлены сведения об использовании нескольких клиентов и потоков для эффективной загрузки данных.
* [Cluster tuning](avere-vfxt-tuning.md) (Настройка кластера). В этой статье представлены сведения о настройке параметров кластера в соответствии с рабочей нагрузкой.
* [Manage the Avere vFXT cluster](avere-vfxt-manage-cluster.md) (Управление кластером Avere vFXT). В этой статье представлены сведения о запуске или остановке кластера, а также об управлении узлами.
