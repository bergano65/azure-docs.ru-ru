---
title: Перепроецирование на позднем этапе
description: Сведения о перепроецировании с поздним этапом и его использовании.
author: sebastianpick
ms.author: sepick
ms.date: 02/04/2020
ms.topic: article
ms.openlocfilehash: f0951415bba22a226dadb7f2a115cede451399bc
ms.sourcegitcommit: 957c916118f87ea3d67a60e1d72a30f48bad0db6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2020
ms.locfileid: "92205648"
---
# <a name="late-stage-reprojection"></a>Перепроецирование на позднем этапе

Перенастройка с *поздним этапом* (ЛСР) — это аппаратная функция, которая помогает стабилизировать голограммы при перемещении пользователя.

Статические модели должны визуально поддерживать свое положение при перемещении вокруг них. Если они выглядят нестабильными, это поведение может быть указано в ЛСР проблемах. Обратите внимание, что дополнительные динамические преобразования, такие как анимации или представления развертывания, могут маскировать это поведение.

Вы можете выбрать один из двух различных режимов ЛСР, а именно: **плоская ЛСР** или **Depth ЛСР**. Один из активных определяется тем, отправляет ли клиентское приложение буфер глубины.

Оба режима ЛСР улучшают стабильность, хотя они имеют свои уникальные ограничения. Начните с попыток глубины ЛСР, так как это может дать лучшие результаты в большинстве случаев.

## <a name="choose-lsr-mode-in-unity"></a>Выбор режима ЛСР в Unity

В редакторе Unity перейдите к *:::no-loc text="File > Build Settings":::* . Выберите *:::no-loc text="Player Settings":::* в левом нижнем углу и убедитесь, что флажок установлен *:::no-loc text="Player > XR Settings > Virtual Reality SDKs > Windows Mixed Reality":::* **:::no-loc text="Enable Depth Buffer Sharing":::** :

![Флаг включения общего доступа к буферу глубины](./media/unity-depth-buffer-sharing-enabled.png)

Если это так, приложение будет использовать глубину ЛСР, в противном случае будет использоваться плоская ЛСР.

## <a name="depth-lsr"></a>ЛСР глубины

Чтобы ЛСР Depth, клиентское приложение должно предоставить допустимый буфер глубины, который содержит всю соответствующую геометрию, которую необходимо рассмотреть во время ЛСР.

Глубина ЛСР пытается стабилизировать видеокадр на основе содержимого заданного буфера глубины. Как следствие, содержимое, которое не было визуализировано, например прозрачные объекты, не может быть скорректировано ЛСР и может показывать нестабильность и репроектные артефакты. 

Чтобы устранить нестабильность РЕПРОЕКЦИИ для прозрачных объектов, можно принудительно задать глубину записи в буфер. См. флаг материала *транспаренцивритесдепс* для [цветов](color-materials.md) и [PBR](pbr-materials.md) Materials. Обратите внимание, что при включении этого флага может снизиться качество взаимодействия прозрачного и непрозрачного объектов.

## <a name="planar-lsr"></a>Плоская ЛСР

Плоская ЛСР не содержит сведений о глубине в пикселях, как это делает ЛСР глубины. Вместо этого выполняется перепроецирование всего содержимого на плоскости, которую необходимо предоставить каждому кадру.

Плоская ЛСР. репроецирование этих объектов лучше, близко к представленной плоскости. Чем дальше объект, тем более нестабильнее он будет выглядеть. Хотя ЛСР глубины лучше при перепроецировании объектов с различной глубиной, плоская ЛСР может улучшить качество содержимого с помощью плоскости.

### <a name="configure-planar-lsr-in-unity"></a>Настройка плоского ЛСР в Unity

Параметры плоскости являются производными от так называемой *фокусной точкой*, которую необходимо предоставить для каждого кадра `UnityEngine.XR.WSA.HolographicSettings.SetFocusPointForFrame` . Дополнительные сведения см. в разделе [API точки фокусировки Unity](/windows/mixed-reality/focus-point-in-unity) . Если не задать точку фокусировки, будет выбрана резервная стратегия. Однако автоматическое резервное восстановление часто приводит к неоптимальным результатам.

Вы можете вычислить фокусную точку самостоятельно, хотя это может иметь смысл основываться на том, который вычисляется узлом удаленной отрисовки. Вызовите метод `RemoteManagerUnity.CurrentSession.GraphicsBinding.GetRemoteFocusPoint` , чтобы получить. Вам будет предложено указать кадр координат, в котором будет выражаться фокусная точка. В большинстве случаев вы просто хотите предоставить результат `UnityEngine.XR.WSA.WorldManager.GetNativeISpatialCoordinateSystemPtr` отсюда.

Как правило, клиент и узел отображают содержимое, которое не знает другая сторона, например элементы пользовательского интерфейса на клиенте. Таким образом, может иметь смысл объединить удаленную точку фокусировки с локально вычисленным.

Точки фокусировки, вычисленные в двух последовательных кадрах, могут сильно отличаться. Простое использование их "как есть" может привести к появлению голограмм. Чтобы предотвратить такое поведение, рекомендуется выполнить интерполяцию между предыдущей и текущей точками фокусировки.

## <a name="next-steps"></a>Дальнейшие действия

* [Запросы данных производительности на стороне сервера](performance-queries.md)