---
title: Настройка материалов PBR в 3ds Max
description: Сведения о настройке физически корректной отрисовки материалов в 3ds Max и экспорте результатов в формат FBX.
author: FlorianBorn71
ms.author: flborn
ms.date: 06/16/2020
ms.topic: tutorial
ms.openlocfilehash: 12407d6344c69c747230e9db6fa4d53b4520dc82
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91331817"
---
# <a name="tutorial-set-up-physically-based-rendering-materials-in-3ds-max"></a>Руководство по настройке физически корректной отрисовки материалов в 3ds Max

## <a name="overview"></a>Обзор
Из этого руководства вы узнаете, как выполнять следующие задачи:

>[!div class="checklist"]
>
> * назначение материалов с улучшенным освещением объектов в сцене;
> * обработка экземпляров объектов и материалов;
> * экспорт сцены в формат FBX и настройка важных параметров.

> [!Note]
> Процедура, описанная в этом учебнике, работает в 3ds Max 2019 и 3ds Max 2020.
> Из-за изменения способа для экспорта карт рельефа в 3ds Max 2021 при использовании этой версии обычные карты не будут отображаться в результатах поиска службы преобразования.

Создание [материалов с физически корректной отрисовкой (PBR)](../../overview/features/pbr-materials.md) в 3ds Max является относительно простой задачей. Настройка PBR здесь во многом похожа на аналогичный механизм в других приложениях для создания содержимого, таких как Maya. В этом руководстве приведены инструкции по настройке базового шейдера PBR и экспорту в FBX-файл для проектов Удаленной отрисовки Azure.

Пример сцены в этом учебнике содержит несколько объектов Box, являющихся многоугольниками, которым назначены различные материалы,например дерево, металл, окрашенный металл, пластмасса или резина. Каждый материал содержит все или большую часть следующих текстур:

* **Albedo** (Альбедо) — карта цветов материала, которая называется также **Diffuse** (Диффузный цвет) или **BaseColor** (Базовый цвет).
* **Metalness** (Металлические свойства) — определяет, является ли материал металлом и какие части из него состоят. 
* **Roughness** — определяет, насколько шероховата или гладка поверхность.
Влияет на резкость или размытие отражений и светлых фрагментов на ней.
* **Normal** (Обычная) — добавляет сведения о поверхности без дополнительных многоугольников. Например, вмятины или выступы на металлической поверхности, зернистость дерева.
* **Ambient Occlusion** (Фоновое затенение) — используется для добавления мягкого затенения и теней в модель. Это карта оттенков серого, которая обозначает, какие области модели получают полное освещение (белый) или полное затенение (черный).

## <a name="prepare-the-scene"></a>Подготовка сцены
В 3ds Max процесс настройки материала PBR выглядит следующим образом.

Для начала мы создадим ряд объектов Box, каждый из которых представляет отдельный тип материала.

>[!TIP]
>Перед началом создания ресурсов стоит отметить, что для измерений в Удаленной отрисовке Azure используются метры.  
>
>Поэтому рекомендуем установить в качестве единиц измерения сцены метры. Кроме того, при экспорте сцены в параметрах экспорта в формат FBX также рекомендуется установить в качестве **единиц измерения** метры.

На приведенном ниже снимке экрана показано, как в 3ds Max задать в качестве единиц измерения метры. 

1. В главном меню последовательно выберите **Customize** > **Units Setup** > **System Units Setup** (Настройка > Настройка единиц измерения > Настройка системных единиц измерения). В раскрывающемся списке **System Units Scale** (Настройка системных единиц измерения) выберите **Meters** (Метры): ![Снимок экрана: установка системных единиц измерения.](media/3dsmax/system-units.jpg)

1. Теперь можно приступить к созданию моделей. В этом примере сцены мы создадим несколько объектов Box, каждый из которых представляет отдельный тип материала. Например металл, резина и пластмасса. 

   >[!TIP]
   >При создании ресурсов рекомендуется присваивать им подходящие имена. Это упрощает их поиск в дальнейшем, если сцена содержит много объектов.

1. Переименуйте объекты, как показано на снимке экрана ниже: 

   ![Снимок экрана: переименование объектов.](media/3dsmax/rename-objects.jpg)

## <a name="assign-materials"></a>Назначение материалов

Теперь имея в сцене несколько объектов (в данном случае кубов) можно приступить к настройке PBR.

1. На главной панели инструментов щелкните значок **редактора материалов**, как показано на следующем снимке экрана. Редактор можно также открыть, нажав клавишу **M** на клавиатуре. Редактор материалов имеет два режима, которые можно выбрать в списке **Modes** (Режимы). Режим **Compact Material Editor** (Компактный редактор материалов) или **Slate Material Editor** (Планшетный редактор материалов). Так как эта сцена относительно проста, мы будем использовать компактный режим.

1. В редакторе материалов вы увидите несколько сфер. Эти сферы и есть материалы. Каждому объекту (Box) в сцене мы назначим один из этих материалов. Чтобы назначить материалы, сначала выберите один из объектов в главном окне просмотра. Затем выберите первую сферу в редакторе материалов. После назначения объекту выбранный материал будет выделен, как показано на приведенном ниже рисунке.

1. Выберите **Assign Material to Selection** (Назначить материал выбранному объекту), как показано ниже. Теперь материал назначен выделенному объекту.

   ![Снимок экрана: назначение материалов.](media/3dsmax/assign-material.jpg)

    В зависимости от потребностей в редакторе материалов может быть доступен широкий спектр различных типов материалов. Как правило, по умолчанию в качестве типа материала задан **Standard** (Стандартный). Этот материал является базовым и не подходит для настройки PBR. Поэтому нам нужно изменить тип на материал PBR. Для проектов Удаленной отрисовки Azure в 3ds Max предпочтительнее использовать физический материал.

1. В редакторе материалов перейдите на вкладку **Standard** (Стандартный). В **обозревателе материалов и карт** выберите **Physical Material** (Физический материал). В результате назначенный **стандартный** материал преобразовывается в физический материал PBR.

   ![Снимок экрана: изменение материала.](media/3dsmax/physical-material.jpg)

    Теперь в редакторе материалов отобразятся свойства физического материала, как показано на приведенном ниже снимке экрана. Теперь можно приступить к назначению текстур ресурсу.

   ![Снимок экрана: список текстур.](media/3dsmax/textures-list.jpg)

Как видите, на выбор предлагается широкий спектр карт и текстур, которые можно добавить к материалу. В этом учебнике мы используем только пять слотов текстур в материале.

>[!TIP]
>Рекомендуется присвоить материалам подходящие имена, как показано на снимке экрана выше.

Способ создания текстур может отличаться в зависимости от предпочтений или использования. Например, можете использовать мозаичную текстуру, которую можно применить к любому ресурсу. Или можете настроить отдельные наборы текстур для определенных частей проекта или ресурса. Вы можете использовать универсальные мозаичные текстуры из Интернета. Также их можно создать самостоятельно в таких приложениях, как Photoshop, Quixel Suite и Substance Suite.

Прежде чем приступать к назначению текстур, необходимо рассмотреть координаты текстуры (UVW) ресурсов. Хотя использовать развернутую модель при применении к ней текстур не требуется, но рекомендуется (текстуры не будут отображаться должным образом без надлежащей развертки UV), для наших целей это особенно важно, так как мы планируем использовать для своей модели карту Ambient Occlusion (Фоновое затенение). В отличие от шейдера Stingray в Maya, у физического материала в 3ds Max нет выделенного слота текстуры для фонового затенения. Поэтому мы будем применять карту фонового затенения к другому слоту. Чтобы ее можно было использовать отдельно от других текстур (например, мозаичных), мы назначим ей собственный канал UVW-карты. 

Начнем с назначения модификатора развертки UVW модели, как показано на приведенном ниже снимке экрана. 

- В редакторе свойств выделенных объектов выберите список модификаторов. Затем в появившемся раскрывающемся списке прокрутите вниз и выберите **Unwrap UVW** (Развертка UVW). В результате к ресурсу применяется модификатор развертки UVW.
![Снимок экрана: выбор развертки UVW.](media/3dsmax/unwrap-modifier.jpg)

  Для канала карты задано значение 1. Обычно основная развертка выполняется в первом канале карты. В этом случае объект развернут без перекрывающихся координат текстуры (UV).
![Снимок экрана: развернутые координаты текстуры (UVW).](media/3dsmax/unwrapped-uvw.jpg)

Следующим шагом является создание второго канала UV-карты.

1. Закройте редактор UV, если он открыт. В разделе **канала** в меню **Edit UV's** (Изменение UV) смените номер канала на **2**. Предполагается, что для карты фонового затенения будет использоваться канал карты 2. 

1. В диалоговом окне **Channel Change Warning** (Предупреждение об изменении канала) вы можете либо **переместить** имеющиеся в канале 1 UV-карты в новый канал 2, либо **отказаться** от имеющихся UV, в результате чего будет автоматически создана развертка UV. Выбирайте **Abandon** (Отказаться), только если планируете создать для карты фонового затенения развертку UV, отличную от той, которая существует в канале 1. (Например, если вы хотите использовать в канале 1 мозаичные текстуры.) В этом учебнике мы переместим UV из первого канала в канал 2, так как нам не нужно изменять новый канал UV.

   >[!NOTE]
   >Даже в случае копирования (перемещения) развертки UV из канала карты 1 в канал карты 2 вы можете внести необходимые изменения в новый канал UV без каких-либо последствий для исходного канала.

   ![Снимок экрана: предупреждение об изменении канала.](media/3dsmax/channel-change.jpg)

Теперь после создания канала карты мы можем вернуться к физическому материалу в редакторе материалов и начать добавлять в него текстуры. Сначала мы добавим карту фонового затенения, однако для ее правильной работы потребуется выполнить еще один шаг. После того как карта фонового затенения будет подключена к материалу, необходимо указать, что для нее будет использоваться канал карты 2.

Как упоминалось ранее, в физическом материале 3ds Max нет выделенного слота для карты фонового затенения. Вместо этого мы применим карту фонового затенения к слоту **Diffuse Roughness** (Диффузная шероховатость).

1. В списке **Generic Maps** (Универсальные карты) физического материала выберите слот **No Map** (Без карты) рядом с **Diffuse Roughness** (Диффузная шероховатость) и загрузите карту фонового затенения.

1. В свойствах текстур фонового затенения по умолчанию для канала карты задано значение **1**. Измените это значение на **2**. На этом действия, необходимые для добавления карты фонового затенения, завершены.

   >[!IMPORTANT]
   >Это важный шаг, особенно в том случае, если UV-карты в канале 2 отличаются от карт в канале 1, так как фоновое затенение не будет сопоставляться правильно, если выбран неверный канал.

   ![Снимок экрана: назначение карты фонового затенения.](media/3dsmax/assign-ao-map.jpg)

Теперь мы назначим карту нормалей материалу PBR. Это действие несколько отличается от процесса в Maya. Карта нормалей не применяется непосредственно к слоту карты рельефности. (У физического материала 3ds Max нет слота карты нормалей.) Вместо этого вы добавляете карту нормалей к модификатору, который подключается к слоту нормалей.

1. В разделе **Special Maps** (Специальные карты) в свойствах физического материала (в редакторе материалов) выберите слот **No Map** (Без карты) рядом с **Bump Map** (Карта рельефности). 

1. В **обозревателе материалов и карт** выберите **Normal Bump** (Рельефность для нормалей). В результате этого действия в материал добавляется модификатор **Normal Bump** (Рельефность для нормалей).

1. В модификаторе **Normal Bump** (Рельефность для нормалей) выберите **No Map** (Без карты) рядом с **Normal** (Нормаль). Найдите, а затем загрузите карту нормалей.

1. Проверьте, что для метода задано значение **Tangent** (Тангенс). (Это значение используется по умолчанию.) При необходимости переключите **Flip Green (Y)** (Обратить зеленый (Y)).

   ![Снимок экрана: выбор рельефности для нормалей.](media/3dsmax/normal-bump.jpg)
   ![Снимок экрана: загрузка карты нормалей.](media/3dsmax/load-normal-map.jpg)

После правильного назначения карты нормалей мы можем назначить оставшиеся текстуры для завершения настройки физического материала. Процесс прост. Нет специальных параметров, которые следует учитывать. На следующем снимке экрана показан полный набор текстур, назначенных материалу: 

![Снимок экрана: полный набор текстур, назначенных материалу.](media/3dsmax/all-textures.jpg)

Создав и настроив материалы PBR, создайте экземпляры объектов в сцене. Создайте в сцене экземпляров однотипные объекты, например гайки, винты, болты и шайбы. Любые одинаковые объекты, могут обеспечить существенную экономию с точки зрения размера файла. Экземпляры главного объекта могут иметь собственные масштабы, плоскости вращения и преобразования, поэтому их можно размещать в соответствии с требованиями сцены. В 3ds Max создавать экземпляры достаточно просто.

1. В главном окне просмотра выберите один или несколько объектов, которые необходимо экспортировать.

1. Удерживая нажатой клавишу **SHIFT**, перетащите ресурсы вверх с помощью средства преобразования (перемещения). 

1. В диалоговом окне **Clone Options** (Параметры клона) установите для параметра **Object** (Объект) значение **Instance** (Экземпляр) и нажмите кнопку **OK**:

   ![Снимок экрана: диалоговое окно параметров клона.](media/3dsmax/instance-object.jpg)

Это действие создает экземпляр объекта, который можно перемещать, поворачивать или масштабировать независимо от родительского объекта и других экземпляров этого родительского объекта.

>[!IMPORTANT]
>Любые изменения, внесенные в экземпляр в режиме подобъекта, передаются во все экземпляры этого объекта. Поэтому при работе с экземплярами объектов, например вершинами и многоугольниками, необходимо сначала решить, нужно ли, чтобы изменения влияли на все эти экземпляры. Помните, что любой экземпляр объекта можно в любое время превратить в уникальный объект. 

>[!TIP]
>Рекомендуем создавать экземпляры в сцене по мере использования. Заменить копии объектов экземплярами на более поздних этапах сложно. 

Еще один важный вопрос, который следует рассмотреть, прежде чем переходить к процессу экспорта, — это способы упаковки сцен или ресурсов для совместного использования. В идеале, если ресурс передается клиентам или членам команды, у получателей должна быть возможность открыть и просмотреть ресурс без особых проблем. Поэтому важно, чтобы пути к текстурам ресурсов были заданы относительно файла сцены. Если пути к текстурам ресурса указывают на локальный диск или заданы в виде абсолютных путей или расположений, они не будут загружаться в сцену при открытии на другом компьютере, даже если MAX-файл находится в той же папке, что и текстуры. Использование относительных путей к текстурам в 3ds Max решает эту проблему и довольно просто.

1. На главной панели инструментов последовательно выберите **File** > **Reference** > **Asset Tracking Toggle** (Файл > Ссылка > Переключение отслеживания ресурсов). 

1. В окне отслеживания ресурсов будут отображаться все или большинство текстур, которые были применены к материалам PBR, перечисленным в столбце **Maps/Shaders** (Карты и шейдеры).

1. Рядом с ними в столбце **Full Path** (Полный путь) указан путь к расположению текстур. Скорее всего, он расположен на локальном компьютере.

1. Наконец, вы увидите столбец с именем **Status** (Состояние). В этом столбце указывается, была ли заданная текстура найдена и применена к сцене. Он может содержать одно из этих значений: **OK**, **Found** (Найдена) или **File Missing** (Отсутствует файл). Первые два указывают, что файл найден и загружен. Последний, как следует из названия, означает, что средству отслеживания не удалось найти файл.
 
   ![Снимок экрана: окно отслеживания ресурсов.](media/3dsmax/texture-paths.jpg)

Как можно заметить, при первом открытии в окне отслеживания ресурсов перечислены не все текстуры. Не беспокойтесь. После одного или двух циклов процесса обнаружения программа обычно находит все текстуры сцены. Процесс обнаружения пути выглядит следующим образом. 

1. В окне средства отслеживания ресурсов нажмите и удерживайте клавишу **SHIFT** и выберите верхнюю текстуру в списке **Maps/Shaders** (Карты и шейдеры). Не отпуская клавишу **SHIFT**, выберите последнюю текстуру в списке. В результате будут выбраны все текстуры в списке. Выбранные текстуры будут выделены синим цветом. (Просмотрите предыдущий снимок экрана.)

1. Щелкните правой кнопкой мыши выделенные элементы, а затем выберите **Set Path** (Задать путь).

1. В диалоговом окне **Specify Asset Path** (Настройка пути к ресурсу) выберите локальный путь к текстурам и замените его на `.\`.  Щелкните **ОК**. 

    Окно отслеживания ресурсов обновится, как показано на приведенном ниже снимке экрана. Это обновление может занять некоторое время в зависимости от количества текстур в сцене и от размера сцены.
![Снимок экрана: обновление окна отслеживания ресурсов.](media/3dsmax/resolve-textures.jpg)

Обратите внимание, что столбец **Full Path** (Полный путь) теперь пуст. Это означает, что сцена больше не ищет нужные текстуры в определенном (абсолютном) расположении. Она всегда будет находить их при условии, что MAX-файл или связанный FBX-файл находятся в той же папке, что и текстуры. 

>[!NOTE]
>Возможно эту процедуру нужно повторить несколько раз, чтобы найти и разрешить все текстуры и пути. Не беспокойтесь. Просто повторяйте процесс, пока не будут учтены все соответствующие ресурсы. В некоторых случаях какие-то файлы не будут найдены. Тогда просто выберите все ресурсы в списке, а затем щелкните **Remove Missing Paths** (Удалить отсутствующие пути). (Просмотрите предыдущий рисунок.)

## <a name="fbx-export"></a>Экспорт в формат FBX

Теперь, когда мы задали относительный путь к текстурам, можно перейти к экспорту в формат FBX. Опять же, процесс прост и его можно выполнить несколькими способами. 

>[!TIP]
>Если всю сцену экспортировать не требуется, рекомендуется экспортировать только те ресурсы, которые необходимы. В ресурсоемких сценах экспорт может занять много времени.
>
>При использовании таких модификаторов, как Turbosmooth (Турбосглаживание) или Open SubDiv (Открытое подразделение), рекомендуется свернуть их перед экспортом, так как они могут вызвать проблемы во время его выполнения. Прежде чем это делать, обязательно сохраните сцену. 

1. В сцене выберите ресурсы, которые необходимо экспортировать. На главной панели инструментов последовательно выберите **File** > **Export** > **Export Selected** (Файл > Экспорт > Экспортировать выбранное).

1. В диалоговом окне **Select File to Export** (Выбор файла для экспорта) введите или выберите имя выходного файла. В списке **Save as Type** (Тип файла) выберите **Autodesk (*.fbx)** . В результате откроется окно экспорта в формат FBX.

  >[!IMPORTANT] 
  >Если вы создали экземпляры в сцене, важно выбрать в параметрах экспорта FBX параметр **Preserve Instances** (Сохранить экземпляры). 

  ![Снимок экрана: экспорт в формат FBX.](media/3dsmax/fbx-export.jpg)

  Помните, что существует несколько способов экспорта файла. Если FBX-файл экспортируется для совместного использования объектов вместе с файлами их текстур в папке или каталоге, то должны правильно работать параметры, показанные на приведенном ниже снимке экрана. 

   Если вы предпочитаете не делиться большими папками и каталогами текстур вместе с FBX, вы можете внедрить текстуры в FBX. При внедрении текстур весь ресурс в целом, включая текстуры, добавляется в один FBX. При объединении всех экспортируемых данных в один ресурс размер результирующего FBX-файла будет значительно больше.

   >[!IMPORTANT]
   >Если размер результирующего FBX-файла превышает 2,4 ГБ, в параметрах экспорта в формат FBX должна быть указана как минимум версия 2016 или более поздняя. (Просмотрите предыдущий снимок экрана.) Более поздние версии поддерживают 64-разрядную систему, поэтому в них допускается использовать файлы большего размера.

1. Для экспорта сцены вместе с текстурами в окне экспорта в формат *FBX выберите параметр **Embed Media** (Внедрить медиаданные). 

1. Выберите остальные параметры и нажмите кнопку **OK**.

    ![Снимок экрана: параметры экспорта в формат FBX.](media/3dsmax/fbx-settings.jpg)


   При экспорте в формат FBX с использованием физического материала после нажатия кнопки **OK** в окне экспорта в формат FBX, скорее всего, появится всплывающее окно с предупреждением: 

   ![Снимок экрана: предупреждение о сбое при экспорте материала.](media/3dsmax/export-warnings.jpg)

   Это предупреждение информирует о том, что экспортированные материалы могут быть несовместимы с другими пакетами программного обеспечения. Так как физический материал совместим с Удаленной отрисовкой Azure, нет повода для беспокойства. 

1. Нажмите кнопку **OK**, чтобы завершить процесс и закрыть окно.

## <a name="conclusion"></a>Заключение

Как правило, этот тип материалов выглядит более реалистично, так как он основан на реальной физике света. Он создает дополнительный иммерсивный эффект, как будто сцена существует в реальном мире.

## <a name="next-steps"></a>Дальнейшие действия

Теперь вы знаете, как настраивать материалы с расширенными возможностями освещения для объектов в сцене. Кроме того, вы научились экспортировать объекты в формат FBX, поддерживаемый Удаленной отрисовкой Azure. На следующем этапе вы преобразуете файл FBX и визуализируете его в Удаленной отрисовке Azure.

>[!div class="nextstepaction"]
>[Краткое руководство. Преобразование модели для отрисовки](../../quickstarts\convert-model.md)
