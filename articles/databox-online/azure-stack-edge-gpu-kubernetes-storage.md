---
title: Общие сведения об управлении хранилищем Kubernetes на устройстве с Azure Stack ребра Pro | Документация Майкрософт
description: Описывает, как осуществляется управление хранилищем Kubernetes на устройстве с Azure Stack пограничным Pro.
services: databox
author: alkohli
ms.service: databox
ms.subservice: edge
ms.topic: conceptual
ms.date: 11/04/2020
ms.author: alkohli
ms.openlocfilehash: 34165071238ca3edf78ab9cca43639c23ce5ed2a
ms.sourcegitcommit: 6a350f39e2f04500ecb7235f5d88682eb4910ae8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/01/2020
ms.locfileid: "96448705"
---
# <a name="kubernetes-storage-management-on-your-azure-stack-edge-pro-gpu-device"></a>Управление хранилищем Kubernetes на устройстве GPU для Azure Stack ребра

На устройстве Azure Stack пограничной Pro создается кластер Kubernetes при настройке роли вычислений. После создания кластера Kubernetes контейнерные приложения можно развернуть в кластере Kubernetes в модулях Pod. Существует несколько различных способов предоставления хранилища для модулей Pod в кластере Kubernetes. 

В этой статье описаны методы для подготовки хранилища в кластере Kubernetes в целом, а именно в контексте устройства Azure Stack пограничной Pro. 

## <a name="storage-requirements-for-kubernetes-pods"></a>Требования к хранилищу для модулей Kubernetes

Модули Kubernetes Pod без отслеживания состояния, но приложения, которые они запускают, обычно имеют состояние. Так как модули Pod могут быть кратковременными и перезапущены, отработка отказа или перемещение между узлами Kubernetes, для хранилища, связанного с этим модулем, должны выполняться следующие требования. 

Хранилище должно:

- В реальном времени за пределами Pod.
- Не зависит от жизненного цикла Pod.
- Быть доступен со всех узлов Kubernetes.

Чтобы понять, как хранилище управляется для Kubernetes, необходимо понять два ресурса API: 

- **Персистентволуме (ПС)**— это часть хранилища в кластере Kubernetes. Хранилище Kubernetes может быть инициализировано статически `PersistentVolume` . Его также можно динамически подготовить как  `StorageClass` .

- **Персистентволумеклаим (PVC)**— запрос хранилища пользователем. PVC используют ресурсы PV. PVC могут запрашивать определенные режимы доступа и размера. 

    Так как пользователям требуются различные `PersistentVolumes` свойства для различных проблем, поэтому администраторы кластера должны иметь возможность предоставлять разнообразные из них `PersistentVolumes` , чем просто размер и режимы доступа. Для этих нужд требуется `StorageClass` ресурс.

Подготовка хранилища может быть статической или динамической. Каждый из типов подготовки рассматривается в следующих разделах.

## <a name="static-provisioning"></a>Статическая подготовка

Администраторы кластера Kubernetes могут статически подготавливать хранилище. Для этого они могут использовать серверную часть хранилища на основе файловой системы SMB/NFS или использовать диски iSCSI, подключенные локально по сети в локальной среде, или даже использовать файлы Azure или диски Azure в облаке. Этот тип хранилища не подготавливается по умолчанию, и администраторы кластера должны планировать эту подготовку и управлять ею. 
 
Ниже приведена схема, на которой показано использование статически подготовленного хранилища в Kubernetes. 

![Статическая подготовка через Персистентволумес](./media/azure-stack-edge-gpu-kubernetes-storage/static-provisioning-persistent-volumes-1.png)

Выполняются следующие действия. 

1. **Подготовка хранилища**. Администратор кластера подготавливает хранилище. В этом примере администратор кластера создает один или несколько общих ресурсов SMB, которые автоматически создают постоянные объекты тома в кластере Kubernetes, соответствующем этим общим ресурсам. 

1. **Хранилище утверждений**. вы отправляете развертывание PVC, которое запрашивает хранилище. Это утверждение для хранилища — Персистентволумеклаим (PVC). Если размер и режим доступа для параметра ПС соответствуют виртуальной цепи, то PVC привязывается к ПС. PVC и ПС сопоставляются один к одному.

1. **Подключение PVC к контейнеру**. После привязки PVC к ПС можно ПОДКЛЮЧИТЬ эту виртуальную цепь к пути в контейнере. Когда логика приложения в контейнере считывает/выполняет запись в этот путь, данные записываются в хранилище SMB.
 

## <a name="dynamic-provisioning"></a>Динамическая подготовка

Ниже приведена схема, на которой показано использование статически подготовленного хранилища в Kubernetes. 

![Динамическая подготовка через Сторажеклассес](./media/azure-stack-edge-gpu-kubernetes-storage/dynamic-provisioning-storage-classes-1.png)

Выполняются следующие действия. 

1. **Определение класса хранения**. Администратор кластера определяет класс хранения в зависимости от операционной среды для кластера Kubernetes. Администратор кластера также развертывает средство подготовки, которое еще является другим модулем или приложением, развернутым в кластере Kubernetes. Подготовка предоставляет все сведения для динамической подготовки общих ресурсов.  

1. **Хранилище утверждений**. вы отправляете приложение, которое будет запрашивать хранилище. После создания PVC с помощью этой ссылки на класс хранения вызывается подготовка. 

1. **Динамическое создание хранилища**. он динамически создает общую папку, связанную с хранилищем локального диска. После создания общей папки также создается объект PV, который автоматически соответствует этому общему ресурсу.

1. **Подключение PVC к контейнеру**. После привязки PVC к ПС можно подключить PVC к контейнеру так же, как статическая подготовка и чтение или запись в общую папку.


## <a name="storage-provisioning-on-azure-stack-edge-pro"></a>Подготовка хранилища на Azure Stack пограничных Pro

На устройстве Azure Stack пограничной Pro создаются статически подготовленные `PersistentVolumes` с помощью возможностей хранилища устройства. При подготовке общей папки и включении параметра **общий доступ с помощью вычислений с границей** , это действие автоматически создает ресурс ПС в кластере Kubernetes.

![Создание локальной общей папки в портал Azure для статической подготовки](./media/azure-stack-edge-gpu-kubernetes-storage/static-provisioning-azure-portal-2.png)

Чтобы использовать распределение по уровням в облаке, можно создать пограничные облачные ресурсы с включенным параметром использовать общий доступ с помощью COMPUTE. ПС снова создается для этой общей папки автоматически. Все данные приложений, которые вы пишете в общую сетевую папку, распределены по уровням в облаке. 

![Создание облачного ресурса в портал Azure для статической подготовки](./media/azure-stack-edge-gpu-kubernetes-storage/static-provisioning-azure-portal-1.png)

Вы можете создать общие папки SMB и NFS для статической инициализации постоянного хранилища версий на устройстве с Azure Stack пограничным Pro. После подготовки ПС вы отправите PVC, чтобы затребовать это хранилище. Ниже приведен пример развертывания PVC `yaml` , который заявляет хранилище и использует подготовленные вами общие ресурсы.


```yml
kind: PersistentVolumeClaim 
apiVersion: v1 
metadata: 
  name: pvc-smb-flexvol 
spec: 
  accessModes: 
  - ReadWriteMany 
  resources: 
    requests: 
      storage: 10Gi 
  volumeName: <nfs-or-smb-share-name-here> 
  storageClassName: ""
```

Дополнительные сведения см. [в статье Развертывание приложения с отслеживанием состояния с помощью статической подготовки на Azure Stack пограничных Pro через kubectl](azure-stack-edge-gpu-deploy-stateful-application-static-provision-kubernetes.md).

Чтобы получить доступ к тому же статически подготовленному хранилищу, соответствующие варианты подключения томов для привязок хранилища для Интернета вещей приведены ниже. `/home/input`— Это путь, по которому том доступен в контейнере.

```
{
"HostConfig": {
"Mounts": [
{
"Target": "/home/input",
"Source": "<nfs-or-smb-share-name-here>",
"Type": "volume"
},
{
"Target": "/home/output",
"Source": "<nfs-or-smb-share-name-here>",
"Type": "volume"
}]
}
}
```

Azure Stack пограничной Pro также имеет встроенный `StorageClass` метод `ase-node-local` , который использует хранилище диска данных, подключенное к узлу Kubernetes. `StorageClass`Поддерживает динамическую подготовку. Вы можете создать `StorageClass` ссылку в приложениях Pod, а ПС — автоматически. Дополнительные сведения см. в разделе [панель мониторинга Kubernetes](azure-stack-edge-gpu-monitor-kubernetes-dashboard.md) для запроса `ase-node-local StorageClass` .

![Встроенный класс хранения на панели мониторинга Kubernetes](./media/azure-stack-edge-gpu-kubernetes-storage/dynamic-provisioning-builtin-storage-class-1.png)

Дополнительные сведения см. [в статье Развертывание приложения с отслеживанием состояния с помощью динамической подготовки на Azure Stack пограничных Pro через куебктл](azure-stack-edge-gpu-deploy-stateful-application-dynamic-provision-kubernetes.md).

## <a name="choose-storage-type"></a>Выбор типа хранилища

Вам может потребоваться выбрать тип хранилища в зависимости от рабочей нагрузки, которую вы развертываете. 

- Если требуется `ReadWriteMany` режим доступа, в `PersistentVolumes` котором тома подключены для чтения и записи при развертывании множества узлов, используйте статическую подготовку для общих папок SMB/NFS.

- Если развертываемые приложения имеют требование соответствия требованиям POSIX, например, такие приложения, как MongoDB, PostgreSQL, MySQL или Prometheus, используют встроенную Сторажекласс. Режимы доступа — `ReadWriteOnce` или том подключен как доступный для чтения и записи на одном узле. 


Дополнительные сведения о режимах доступа см. в разделе [режим доступа к томам Kubernetes](https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes).


## <a name="next-steps"></a>Дальнейшие действия

Чтобы понять, как можно статически подготавливать `PersistentVolume` , см.:

- [Развертывание приложения с отслеживанием состояния с помощью статической подготовки на Azure Stack пограничной Pro через kubectl](azure-stack-edge-gpu-deploy-stateful-application-static-provision-kubernetes.md).

Чтобы узнать, как можно динамически подготавливать `StorageClass` , см.:

- [Развертывание приложения с отслеживанием состояния с помощью динамической подготовки на Azure Stack пограничных Pro через куебктл](azure-stack-edge-gpu-deploy-stateful-application-dynamic-provision-kubernetes.md).
