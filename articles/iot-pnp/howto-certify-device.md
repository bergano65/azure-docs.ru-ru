---
title: Как сертифицировать устройства IoT Plug and Play | Документация Майкрософт
description: Как построитель устройств, Узнайте, как выполнять тесты и отправлять устройства для сертификации.
author: konichi3
ms.author: koichih
ms.date: 08/21/2020
ms.topic: how-to
ms.custom: mvc, devx-track-azurecli
ms.service: iot-pnp
services: iot-pnp
ms.openlocfilehash: 7aa84336a3d71349c127ad15a90af98ffe2133fe
ms.sourcegitcommit: f311f112c9ca711d88a096bed43040fcdad24433
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2020
ms.locfileid: "94980241"
---
# <a name="how-to-certify-iot-plug-and-play-devices"></a>Сертификация устройств Plug and Play IoT

Программа сертификации устройств IoT Plug and Play содержит средства для проверки того, соответствует ли устройство требованиям сертификации IoT Plug and Play. Средства также помогают организациям обеспечить доступность своих устройств IoT Plug and Play. Эти сертифицированные устройства адаптированы для решений IoT и помогают сократить время на рынке.

В этой статье показано, как выполнить следующие действия:

- Установите расширение средства командной строки Azure IoT для Azure CLI
- Запуск тестов IoT Plug and Play для проверки приложения устройства на этапе разработки  
- Проверка приложения устройства с помощью портала сертифицированного устройства Azure

## <a name="prepare-your-device"></a>Подготовка устройства

Код приложения, который выполняется в Plug and Play IoT, должен:

- Подключитесь к центру Интернета вещей Azure с помощью [службы подготовки устройств (DPS)](../iot-dps/about-iot-dps.md).
- Следуйте [соглашениям об игре в IOT](concepts-convention.md) , чтобы реализовать телеметрию, свойства и команды.

Приложение — это программное обеспечение, устанавливаемое отдельно от операционной системы или объединенное с операционной системой в образе встроенного по, который посылается на устройство.

Процесс сертификации проверяет, является ли устройство IoT Plug and Play совместимым, подтверждая, что реализация устройства соответствует телеметрии, свойствам и командам, определенным в модели устройства [дтдл (Digital двойников Definition Language)](https://github.com/Azure/opendigitaltwins-dtdl) , и что модель доступна в [репозитории общедоступной модели Azure IOT](concepts-model-repository.md).

Чтобы удовлетворить требования к сертификации, устройство должно:

- Подключается к центру Интернета вещей Azure с помощью [DPS](../iot-dps/about-iot-dps.md).
- Реализация телеметрии, свойств или команд, следующих за соглашением Plug and Play IoT.
- Опишите взаимодействие устройств с моделью [дтдл v2](https://aka.ms/dtdl) .
- Опубликуйте модель и все необходимые интерфейсы в [репозитории общедоступной модели Azure IOT](https://devicemodels.azureiotsolutions.com/) .
- Отправьте идентификатор модели во время [регистрации DPS](concepts-developer-guide-device-csharp.md#dps-payload) в полезных данных подготовки DPS.
- Объявите идентификатор модели во время [подключения MQTT](concepts-developer-guide-device-csharp.md#model-id-announcement).
- Все модели устройств должны быть совместимы с [Azure IOT Central](https://aka.ms/pnp-iotc-getstarted).

> [!NOTE]
> В настоящее время IoT Central Azure не поддерживает полную поддержку типов данных **Array** и **геопространственных** дтдл.

## <a name="test-with-the-azure-iot-extension-cli"></a>Тестирование с помощью расширения Azure IoT для Azure CLI

[Расширение интерфейса командной строки Azure IOT](/cli/azure/ext/azure-iot/iot/product?preserve-view=true&view=azure-cli-latest) позволяет проверить соответствие реализации устройства модели перед отправкой устройства для сертификации через портал сертифицированного устройства Azure.

Ниже описано, как подготовить и запустить тесты сертификации с помощью интерфейса командной строки.

### <a name="install-the-azure-iot-extension-for-the-azure-cli"></a>Установка расширения Azure IoT для Azure CLI

Чтобы настроить [Azure CLI](/cli/azure/?preserve-view=true&view=azure-cli-latest) в вашей среде, ознакомьтесь с инструкциями по установке.

Чтобы установить расширение Интернета вещей Azure, выполните следующую команду:

```azurecli
az extension add --name azure-iot
```

Дополнительные сведения см. в статье [Azure CLI для Azure IOT](/cli/azure/azure-cli-reference-for-iot?preserve-view=true&view=azure-cli-latest).

### <a name="create-a-new-product-test"></a>Создание нового теста продукта

Следующая команда создает тест с помощью DPS с методом аттестации симметричного ключа:

- Создает новый продукт для тестирования и создает конфигурацию теста. В выходных данных отображаются сведения о DPS, которые устройство должно использовать для подготовки: первичный ключ, идентификатор устройства и область идентификатора.
- Указывает папку с файлами ДТДЛ, описывающими модель.

```azurecli
az iot product test create --badge-type Pnp --at SymmetricKey --device-type FinishedProduct --models {local folder name}
```

> [!NOTE]
> При использовании интерфейса командной строки необходимо [войти](/cli/azure/authenticate-azure-cli?preserve-view=true&view=azure-cli-latest) в подписку.

Выходные данные JSON из команды содержат `primaryKey` , и, `registrationId` `scopeID` используемые при подключении устройства.

Ожидаемые выходные данные:

```json
"deviceType": "FinishedProduct",
"id": "d45d53d9-656d-4be7-9bbf-140bc87e98dc",
"provisioningConfiguration": {
  "symmetricKeyEnrollmentInformation": {
    "primaryKey":"Ci/Ghpqp0n4m8FD5PTicr6dEikIfM3AtVWzAhObU7yc=",
    "registrationId": "d45d53d9-656d-4be7-9bbf-140bc87e98dc",
    "scopeId": "0ne000FFA42"
  }
}
```

### <a name="connect-your-device"></a>Подключение устройства

Используйте выходные данные DPS, приведенные в предыдущей команде, чтобы подключить устройство к экземпляру центра Интернета вещей.

### <a name="manage-and-configure-the-product-tests"></a>Управление тестами продукта и их настройка

Когда устройство подключено и готово к взаимодействию с центром Интернета вещей, создайте файл конфигурации теста продукта. Чтобы создать файл, выполните следующие действия.

- Используйте тест `id` из выходных данных предыдущей команды.
- Используйте `--wait` параметр, чтобы получить тестовый случай.

```azurecli
az iot product test task create --type GenerateTestCases --test-id d45d53d9-656d-4be7-9bbf-140bc87e98dc --wait
```

Ожидаемые выходные данные:

```json
{
  "deviceTestId": "d45d53d9-656d-4be7-9bbf-140bc87e98dc",
  "error": null,
  "id": "526da38e-91fc-4e20-a761-4f04b392c42b",
  "resultLink": "/deviceTests/d45d53d9-656d-4be7-9bbf-140bc87e98dc/TestCases",
  "status": "Completed",
  "type": "GenerateTestCases"
}
```

`az iot product test case update`Для изменения файла конфигурации теста можно использовать команду.

### <a name="run-the-tests"></a>Запуск тестов

После создания конфигурации теста следующим шагом будет выполнение тестов. Для выполнения тестов используйте те же параметры, что и в `devicetestId` предыдущих командах в качестве параметра. Проверьте результаты теста, чтобы убедиться, что все тесты имеют состояние `Passed` .

```azurecli
az iot product test task create --type QueueTestRun --test-id d45d53d9-656d-4be7-9bbf-140bc87e98dc --wait
```

Пример выходных данных тестового запуска

```json
      "validationTasks": [
        {
          "componentName": "Default component",
          "endTime": "2020-08-25T05:18:49.5224772+00:00",
          "interfaceId": "dtmi:com:example:TemperatureController;1",
          "logs": [
            {
              "message": "Waiting for telemetry from the device",
              "time": "2020-08-25T05:18:37.3862586+00:00"
            },
            {
              "message": "Validating PnP properties",
              "time": "2020-08-25T05:18:37.3875168+00:00"
            },
            {
              "message": "Validating PnP commands",
              "time": "2020-08-25T05:18:37.3894343+00:00"
            },
            {
              "message": "{\"propertyName\":\"serialNumber\",\"expectedSchemaType\":null,\"actualSchemaType\":null,\"message\":\"Property is successfully validated\",\"passed\":true,\"time\":\"2020-08-25T05:18:37.4205985+00:00\"}",
              "time": "2020-08-25T05:18:37.4205985+00:00"
            },
            {
              "message": "PnP interface properties validation passed",
              "time": "2020-08-25T05:18:37.4206964+00:00"
            },
```

## <a name="test-using-the-azure-certified-device-portal"></a>Тестирование с помощью портала Microsoft Azure Certified for IoT

Ниже описано, как использовать [сертифицированный портал устройств Azure](https://aka.ms/acdp) для подключения, регистрации сведений о продукте, отправки руководства по началу работы и выполнения тестов сертификации.

### <a name="onboarding"></a>Переход

Чтобы использовать [портал сертификации](https://aka.ms/acdp), необходимо использовать Azure Active Directory из рабочего или учебного клиента.

Чтобы опубликовать модели в хранилище общедоступных моделей Azure IoT, ваша учетная запись должна быть членом [Microsoft Partner Network](https://partner.microsoft.com). Система проверяет, что идентификатор Microsoft Partner Network существует и учетная запись полностью проверены перед публикацией в каталоге устройств.

### <a name="company-profile"></a>Профиль организации

Вы можете управлять профилем компании в левом меню навигации. Профиль компании включает в себя URL-адрес Организации, адрес электронной почты и логотип компании. Перед выполнением каких-либо операций сертификации на этой странице должно быть принято соглашение о программе.

Сведения о профиле компании используются в описании устройства, представленном в каталоге устройств.

### <a name="create-new-project"></a>Создание нового проекта

Чтобы сертифицировать устройство, необходимо сначала создать новый проект.

Перейдите на [портал сертификации](https://aka.ms/acdp). На странице **проекты** выберите *+ создать новый проект*. Затем введите имя проекта, имя устройства и выберите класс устройства.

Сведения о продукте, которые вы предоставляете во время процесса сертификации, делятся на четыре категории:

- Сведения об устройстве. Собирает сведения об устройстве, такие как имя, описание, сертификация и операционная система.
- Руководство по **началу работы** . Перед публикацией устройства необходимо отправить его в виде PDF-документа, утвержденного системным администратором.
- Маркетинговые сведения. Предоставьте маркетинговую информацию, готовую для клиентов, для вашего устройства. Маркетинговая информация включает в себя описание, фотографию и распространители.
- Дополнительные отраслевые сертификаты. Этот необязательный раздел позволяет указать дополнительные сведения о других сертификатах, полученных устройством.

### <a name="connect-and-test"></a>Подключение и тестирование

Шаг подключения и тестирования проверяет соответствие устройства требованиям сертификации IoT Plug and Play.

Необходимо выполнить три шага.

1. Подключение и обнаружение интерфейсов. Устройство должно подключаться к службе сертификации Azure IoT через службу DPS. Выберите метод проверки подлинности (сертификат X. 509, симметричные ключи или доверенный платформенный модуль), чтобы использовать и обновить приложение устройства с помощью сведений DPS.
1. Проверьте интерфейсы. Просмотрите интерфейс и убедитесь, что у каждого из них есть входные данные, имеющие смысл для тестирования.
1. тестирование. Система проверяет каждую модель устройства, чтобы убедиться, что данные телеметрии, свойства и команды, описанные в модели, соответствуют соглашениям об Plug and Play IoT. По завершении теста щелкните ссылку **Просмотреть журналы** , чтобы просмотреть данные телеметрии с устройства, а также необработанных данных, отправленных в свойства двойника устройства центра Интернета вещей.

### <a name="submit-and-publish"></a>Отправка и публикация

Последняя требуемая стадия — отправить проект для проверки. Этот шаг уведомляет участника команды сертифицированного устройства Azure, чтобы просмотреть полноту проекта, включая сведения об устройстве и маркетинге, а также руководство по началу работы. Участник команды может связаться с вами по адресу электронной почты компании, который ранее был предоставлен с вопросами или запросами на изменение перед утверждением.

Если устройство требует дальнейшую проверку вручную в рамках сертификации, в настоящее время вы получите уведомление.

Когда устройство сертифицировано, вы можете опубликовать сведения о продукте в каталоге сертифицированных устройств Azure с помощью функции **опубликовать в каталоге** на странице сводки по продукту.

## <a name="next-steps"></a>Следующие шаги

После завершения отправки устройства вы можете обратиться к группе сертификации устройств по адресу, [iotcert@microsoft.com](mailto:iotcert@microsoft.com) чтобы перейти к дальнейшим действиям, в том числе Microsoft Partner Network проверки членства и ознакомиться с руководствами по началу работы. После соблюдения всех требований можно выбрать включение устройства в список [сертифицировано для каталога устройств Azure IOT](https://aka.ms/devicecatalog).
