---
title: Реализация обнаружения модели предварительной версии IoT Plug and Play | Документация Майкрософт
description: Как разработчик решения вы узнаете, как реализовать обнаружение модели Интернета вещей Plug and Play в решении.
author: ChrisGMsft
ms.author: chrisgre
ms.date: 07/17/2019
ms.topic: conceptual
ms.custom: mvc
ms.service: iot-pnp
services: iot-pnp
manager: philmea
ms.openlocfilehash: e4ab1d45e27762ef05ab7ec74c98ab0b0b934cbf
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2019
ms.locfileid: "69880557"
---
# <a name="implement-iot-plug-and-play-preview-model-discovery-in-an-iot-solution"></a>Реализация обнаружения модели предварительной версии IoT Plug and Play в решении IoT

В этой статье описывается, как разработчик решения может реализовать обнаружение моделей Интернета вещей Plug and Play Preview в решении IoT.  Обнаружение моделей Интернета вещей Plug and Play — это способ, с помощью которого Plug and Play устройствами IoT определяет поддерживаемые модели и интерфейсы, а также то, как решение IoT извлекает эти модели и интерфейсы.

Существует две основные категории решения IoT: готовые решения, работающие с известным набором устройств IoT Plug and Play, и решения на основе моделей, которые работают с любыми устройствами IoT Plug and Play.

В этой статье концепции описывается реализация обнаружения моделей в обоих типах решений.

## <a name="model-discovery"></a>Обнаружение модели

Когда устройство IoT Plug and Play впервые подключается к центру Интернета вещей, оно отправляет сообщение телеметрии информации о модели. Это сообщение содержит идентификаторы интерфейсов, которые реализует устройство. Чтобы ваше решение работало с устройством, оно должно разрешить эти идентификаторы и получить определения для каждого интерфейса.

Ниже приведены действия, которые принимает устройство IoT Plug and Play при использовании службы подготовки устройств (DPS) для подключения к концентратору.

1. Когда устройство включено, оно подключается к глобальной конечной точке DP и выполняет проверку подлинности с помощью одного из разрешенных методов.
1. Затем служба DPS проверяет подлинность устройства и выполняет поиск правила, которое сообщает ему, какой центр Интернета вещей назначает устройство. Затем служба DPS регистрирует устройство в этом концентраторе.
1. Служба DPS возвращает устройству строку подключения центра Интернета вещей.
1. Затем устройство отправляет сообщение телеметрии обнаружения в центр Интернета вещей. Сообщение телеметрии обнаружения содержит идентификаторы интерфейсов, которые реализует устройство.
1. Теперь устройство IoT Plug and Play готово к работе с решением, использующим центр Интернета вещей.

Если устройство подключается напрямую к центру Интернета вещей, оно подключается с помощью строки подключения, внедренной в код устройства. Затем устройство отправляет сообщение телеметрии обнаружения в центр Интернета вещей.

Дополнительные сведения о информационном сообщении о телеметрической информации о модели см. в интерфейсе [моделинформатион](concepts-common-interfaces.md) .

### <a name="purpose-built-iot-solutions"></a>Решения, созданные с целью создания решений IoT

Решение IoT, разработанное специально, работает с известным набором моделей возможностей устройств и интерфейсов Интернета вещей Plug and Play.

У вас будет модель возможностей и интерфейсы для устройств, которые будут заранее подключаться к решению. Чтобы подготовить решение, выполните следующие действия.

1. Храните JSON-файлы интерфейса в Azure в расположении, где решение может их читать.
1. Напишите логику в решении Интернета вещей на основе ожидаемых моделей возможностей и интерфейса Интернета вещей Plug and Play.
1. Подпишитесь на уведомления из центра Интернета вещей, используемого решением.

При получении уведомления о новом подключении устройства выполните следующие действия.

1. Прочитайте сообщение телеметрии обнаружения, чтобы получить идентификаторы модели возможностей и интерфейсов, реализованных устройством.
1. Сравните идентификатор модели возможностей с идентификаторами моделей возможностей, сохраненными заранее.
1. Теперь вы можете узнать, к какому типу подключено устройство. Используйте ранее написанную логику, чтобы пользователи могли правильно взаимодействовать с устройством.

### <a name="model-driven-solutions"></a>Решения на основе моделей

Решение IoT, управляемое моделью, может работать с любым устройством Plug and Play IoT. Создание решения IoT, управляемого моделью, является более сложным, но преимущество заключается в том, что ваше решение работает с любыми устройствами, добавленными в будущем.

Чтобы создать решение IoT, управляемое моделью, необходимо создать логику на основе примитивов интерфейса Интернета вещей Plug and Play: телеметрии, свойств и команд. Логика решения IoT представляет устройство путем объединения нескольких функций телеметрии, свойств и команд.

Решение также должно подписываться на уведомления из центра Интернета вещей, которые он использует.

Когда решение получает уведомление о новом подключении устройства, выполните следующие действия.

1. Прочитайте сообщение телеметрии обнаружения, чтобы получить идентификаторы модели возможностей и интерфейсов, реализованных устройством.
1. Для каждого идентификатора Прочитайте полный файл JSON, чтобы найти возможности устройства.
1. Проверьте, есть ли каждый интерфейс в любом кэше, созданном для хранения файлов JSON, полученных ранее в решении.
1. Затем проверьте, есть ли в репозитории глобальных моделей интерфейс с таким ИДЕНТИФИКАТОРом. Дополнительные сведения см. в разделе [глобальный репозиторий моделей](howto-manage-models.md).
1. Если интерфейс отсутствует в глобальном репозитории моделей, попробуйте найти его в любых частных хранилищах модели, известных Вашему решению. Для доступа к частному репозиторию модели требуется строка подключения. Дополнительные сведения см. в разделе [частный репозиторий моделей](howto-manage-models.md).
1. Если не удается найти все интерфейсы в глобальном репозитории модели или в частном репозитории модели, можно проверить, может ли устройство предоставить определение интерфейса. Устройство может реализовать стандартный интерфейс [моделдефинитион](concepts-common-interfaces.md) для публикации сведений о том, как получить файлы интерфейса с помощью команды.
1. Если найдены файлы JSON для каждого интерфейса, реализованного устройством, можно перечислить возможности устройства. Используйте ранее написанную логику, чтобы позволить пользователям взаимодействовать с устройством.
1. В любой момент можно вызвать API Digital двойников, чтобы получить идентификатор модели возможностей и идентификаторы интерфейса для устройства.

## <a name="next-steps"></a>Следующие шаги

Теперь, когда вы узнали об обнаружении модели для решения IoT, Узнайте больше о [платформе Azure IOT](overview-iot-plug-and-play.md) , чтобы использовать другие возможности решения.
