---
title: Использование Visual Studio и Visual Studio Code для создания предварительных версий устройств IoT Plug and Play | Документация Майкрософт
description: Используйте Visual Studio и Visual Studio Code для ускорения создания моделей устройств IoT Plug and Play и реализации кода устройства.
author: liydu
ms.author: liydu
ms.date: 10/29/2019
ms.topic: conceptual
ms.service: iot-pnp
services: iot-pnp
ms.custom: mvc
ms.openlocfilehash: 6ce5a93cdd44af7f199d59d459daa46b4adb0719
ms.sourcegitcommit: 827248fa609243839aac3ff01ff40200c8c46966
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/07/2019
ms.locfileid: "73748037"
---
# <a name="use-visual-studio-and-visual-studio-code-to-build-iot-plug-and-play-devices"></a>Использование Visual Studio и Visual Studio Code для создания устройств Plug and Play IoT

Средства Azure IoT для Visual Studio Code предоставляют интегрированную среду для создания моделей возможностей устройств (DCM) и интерфейсов, публикации в хранилищах моделей и создания каркаса кода на языке C для реализации приложения устройства.

В этой статье описаны следующие процессы.

- Создание кода устройства и проекта приложения.
- Используйте созданный код в проекте устройства.
- Выполните итерацию путем повторного создания каркаса кода.

Дополнительные сведения об использовании VS Code для разработки устройств IoT см. в разделе [https://github.com/microsoft/vscode-iot-workbench](https://github.com/microsoft/vscode-iot-workbench).

## <a name="prerequisites"></a>Предварительные требования

Установите [Visual Studio Code](https://code.visualstudio.com/).

Чтобы установить пакет расширений в VS Code, выполните следующие действия.

1. В VS Code выберите вкладку **расширения** .
1. Поиск и установка **средств Azure IOT** из Marketplace.

## <a name="generate-device-code-and-project"></a>Создание кода устройства и проекта

В VS Code используйте **сочетание клавиш CTRL + SHIFT + P** , чтобы открыть палитру команд, введите **IOT Plug and Play**и выберите **создать заглушку кода устройства** , чтобы настроить скелет кода и тип проекта. В следующем списке подробно описывается каждый шаг:

- **Файл DCM, используемый для создания кода**. Чтобы создать каркас кода устройства, откройте папку, содержащую файлы DCM и интерфейсов, которые он реализует. Если генератору кода не удается найти интерфейс, необходимый для DCM, он скачивает его из репозитория модели по мере необходимости.

- **Язык кода устройства**. В настоящее время генератор кода поддерживает только ANSI C.

- **Имя проекта**. Имя проекта используется в качестве имени папки для созданного кода и других файлов проекта. Папка по умолчанию размещается рядом с файлом DCM. Чтобы не копировать созданную папку кода вручную при обновлении DCM и повторном создании кода устройства, сохраните файл DCM в той же папке, где находится папка проекта.

- **Способ подключения к Azure IOT**. Созданные файлы также содержат код, позволяющий настроить устройство для подключения к центру Интернета вещей Azure. Вы можете подключиться непосредственно к центру [Интернета вещей Azure](https://docs.microsoft.com/azure/iot-hub) или использовать [службу подготовки устройств](https://docs.microsoft.com/azure/iot-dps).

    - С **помощью строки подключения устройства центра Интернета вещей**. Укажите строку подключения устройства для подключения к центру Интернета вещей напрямую.
    - **Через симметричный ключ DPS**: укажите **область идентификатора**, **симметричный ключ** и **идентификатор устройства** для приложения устройства, необходимого для подключения к центру Интернета вещей или IOT Central с помощью DPS.

- **Тип проекта**. Генератор кода также создает проект CMak или Arduino. В настоящее время поддерживаются следующие типы проектов:

    - **Проект CMAK в Windows**: для проекта устройства, который использует [CMAK](https://cmake.org/) как систему сборки в Windows. Этот параметр создает `CMakeLists.txt` с конфигурациями пакета SDK для устройств в той же папке, что и код на языке C.
    - **Проект CMAK в Linux**: для проекта устройства, использующего пакет [адменистрирования диспетчера подключений (CMAK](https://cmake.org/) ) в качестве системы сборки в Linux. Этот параметр создает `CMakeLists.txt` с конфигурациями пакета SDK для устройств в той же папке, что и код на языке C.
    - **Проект MXChip IOT DevKit**: для проекта устройства, который выполняется на устройстве [MXChip IOT DevKit](https://aka.ms/iot-devkit) . Этот параметр создает проект Arduino, который можно [использовать в VS Code](https://docs.microsoft.com/azure/iot-hub/iot-hub-arduino-iot-devkit-az3166-get-started) или в интегрированной среде разработки Arduino для сборки и запуска на устройстве IOT DevKit.

- **Тип пакета SDK для устройства**. Если вы выберете CMak как тип проекта, то на этом этапе можно настроить, как созданный код будет включать пакет SDK для устройств с Azure IoT C в `CMakeLists.txt`:

    - С **помощью исходного кода**. созданный код полагается на [Исходный код пакета SDK для устройств](https://github.com/Azure/azure-iot-sdk-c) , который можно включить в сборку и собрать вместе с ним. Это рекомендуется, если вы настроили исходный код пакета SDK для устройства.
    - **Через Vcpkg**: созданный код использует [пакет SDK для устройств Vcpkg](https://github.com/microsoft/vcpkg/tree/master/ports/azure-iot-sdk-c) для включения в и сборки вместе с ним. Это рекомендуемый способ для устройств под управлением Windows, Linux или macOS.

    > [!NOTE]
    > выполняется macOS поддержка пакета SDK для устройств с Azure IoT C Vcpkg.

Генератор кода пытается использовать DCM и файлы интерфейса, расположенные в локальной папке. Если файлы интерфейса отсутствуют в локальной папке, генератор кода ищет их в общедоступном репозитории модели или в репозитории модели компании. [Общие файлы интерфейса](./concepts-common-interfaces.md) хранятся в репозитории общедоступной модели.

После завершения создания кода расширение открывает новое VS Code окно с кодом. При открытии созданного файла, например **Main. c**, может оказаться, что IntelliSense сообщает, что не удается открыть исходные файлы SDK c. Чтобы включить правильную технологию IntelliSense и навигацию по коду, выполните следующие действия, чтобы включить источник SDK C:

1. В VS Code используйте **сочетание клавиш CTRL + SHIFT + P** , чтобы открыть палитру команд, введите и выберите **C/C++: Edit Configurations (JSON)** , чтобы открыть файл **c_cpp_properties. JSON** .

1. Добавьте путь к пакету SDK для устройства в раздел `includePath`:

    ```json
    "includePath": [
        "${workspaceFolder}/**",
        "{path_of_device_c_sdk}/**"
    ]
    ```

1. Сохраните файл.

## <a name="use-the-generated-code"></a>Использование созданного кода

Приведенные ниже инструкции описывают использование созданного кода в собственном проекте устройства на различных платформах машинного программирования. В инструкциях предполагается, что вы используете строку подключения устройства центра Интернета вещей с созданным кодом:

### <a name="linux"></a>Linux

Чтобы создать код устройства вместе с пакетом SDK для устройства C Vcpkg с помощью CMak в среде Linux, например Ubuntu или Debian, сделайте следующее:

1. Откройте приложение терминала.

1. Установите компоненты **GCC**, **Git**, `cmake`и все зависимости с помощью команды `apt-get`.

    ```bash
    sudo apt-get update
    sudo apt-get install -y git cmake build-essential curl libcurl4-openssl-dev libssl-dev uuid-dev
    ```

    Убедитесь, что версия `cmake` выше **2.8.12** , а версия **GCC** выше **4.4.7**.

    ```bash
    cmake --version
    gcc --version
    ```

1. Установка Vcpkg:

    ```bash
    git clone https://github.com/Microsoft/vcpkg.git
    cd vcpkg

    ./bootstrap-vcpkg.sh
    ```

    Затем, чтобы подключить всю [интеграцию](https://github.com/microsoft/vcpkg/blob/master/docs/users/integration.md)пользователей, выполните:

    ```bash
    ./vcpkg integrate install
    ```

1. Установите пакет SDK для устройств с Azure IoT C Vcpkg:

    ```bash
    ./vcpkg install azure-iot-sdk-c[public-preview,use_prov_client]
    ```

1. Создайте `cmake` подкаталог в папке, содержащей созданную заглушку кода, и перейдите к этой папке:

    ```bash
    mkdir cmake
    cd cmake
    ```

1. Выполните следующие команды, чтобы создать пакет SDK для устройства и созданную заглушку кода с помощью CMak.

    ```bash
    cmake .. -Duse_prov_client=ON -Dhsm_type_symm_key:BOOL=ON -DCMAKE_TOOLCHAIN_FILE="{directory of your Vcpkg repo}/scripts/buildsystems/vcpkg.cmake"

    cmake --build .
    ```

1. После завершения сборки запустите приложение, указав строку подключения устройства центра Интернета вещей в качестве параметра.

    ```bash
    ./{generated_code_project_name} "[IoT Hub device connection string]"
    ```

### <a name="windows"></a>Windows

Чтобы создать код устройства вместе с пакетом SDK для устройства C в Windows с помощью CMak и Visual Studio C/C++ Compiler в командной строке, ознакомьтесь с [кратким руководством по Plug and Play IOT](./quickstart-create-pnp-device.md). Ниже показано, как создать код устройства вместе с пакетом SDK для Vcpkgа устройства в Visual Studio как проект CMak.

1. Выполните действия, описанные в [кратком руководстве](https://docs.microsoft.com/azure/iot-pnp/quickstart-create-pnp-device#prepare-the-development-environment) , чтобы установить пакет SDK для устройств Azure IOT для C через Vcpkg.

1. Установите [Visual Studio 2019 (Community, Professional или Enterprise)](https://visualstudio.microsoft.com/downloads/) — убедитесь, что включен компонент **диспетчера пакетов NuGet** и **Разработка классических приложений с C++**  рабочей нагрузкой.

1. Откройте Visual Studio, выберите **файл > открыть > CMAK.** чтобы открыть `CMakeLists.txt` в папке, содержится созданный код.

1. На панели инструментов **Общие** найдите раскрывающийся список **конфигураций** . Выберите **Управление конфигурацией** , чтобы добавить параметр CMAK для проекта.

    ![Управление конфигурацией](media/howto-develop-with-vs-vscode/vs-manage-config.png)

1. В **параметрах CMAK**добавьте новую конфигурацию и выберите **x86-Debug** в качестве целевого.

1. В **аргументах команды CMAK**добавьте следующую строку:

    ```txt
    -Duse_prov_client=ON -Dhsm_type_symm_key:BOOL=ON
    ```

1. Сохраните файл.

1. Переключитесь на **x86-Debug** в раскрывающемся списке **конфигураций** . Для создания кэша CMak требуется несколько секунд. Просмотрите окно вывода, чтобы просмотреть ход выполнения.

    ![Выходные данные CMak](media/howto-develop-with-vs-vscode/vs-cmake-output.png)

1. В **Обозреватель решений**щелкните правой кнопкой мыши `CMakeLists.txt` в корневой папке и в контекстном меню выберите пункт **построить** , чтобы создать заглушку кода с помощью пакета SDK для устройства.

1. После завершения сборки в командной строке запустите приложение, указав строку подключения устройства центра Интернета вещей в качестве параметра.

    ```cmd
    .\out\build\x86-Debug\{generated_code_project_name}.exe "[IoT Hub device connection string]"
    ```

> [!TIP]
> Дополнительные сведения об использовании CMak в Visual Studio см. в разделе [Build CMAK Project](https://docs.microsoft.com/cpp/build/cmake-projects-in-visual-studio?view=vs-2019#building-cmake-projects) .

### <a name="macos"></a>macOS

Ниже показано, как создать код устройства вместе с исходным кодом пакета SDK для устройства C в macOS с помощью CMak.

1. Откройте приложение терминала.

1. Используйте [Homebrew](https://homebrew.sh) для установки всех зависимостей:

    ```bash
    brew update
    brew install git cmake pkgconfig openssl ossp-uuid
    ```

1. Убедитесь, что используется версия [CMAK](https://cmake.org/) не ниже **2.8.12**версии.

    ```bash
    cmake --version
    ```

1. [Прилистывание исправлений](https://github.com/Azure/azure-iot-sdk-c/blob/master/doc/devbox_setup.md#upgrade-curl-on-mac-os) к последней доступной версии.

1. В папке, содержащей созданный код, выполните Клонирование репозитория [SDK для Azure IOT C](https://github.com/Azure/azure-iot-sdk-c) :

    ```bash
    git clone https://github.com/Azure/azure-iot-sdk-c --recursive -b public-preview
    ```

    Выполнение этой операции может занять несколько минут.

1. Создайте папку с именем `cmake` в папке, содержащей созданный код, и перейдите к этой папке.

    ```bash
    mkdir cmake
    cd cmake
    ```

1. Выполните следующие команды, чтобы создать пакет SDK для устройства и созданную заглушку кода с помощью CMak.

    ```bash
    cmake -Duse_prov_client=ON -Dhsm_type_symm_key:BOOL=ON -DOPENSSL_ROOT_DIR:PATH=/usr/local/opt/openssl ..
    cmake --build .
    ```

1. После завершения сборки запустите приложение, указав строку подключения устройства центра Интернета вещей в качестве параметра.

    ```bash
    cd {generated_code_folder_name}/cmake/
    ./{generated_code_project_name} "[IoT Hub device connection string]"
    ```

## <a name="iterate-by-regenerating-the-skeleton-code"></a>Перебор путем повторного создания каркаса кода

Генератор кода может повторно создать код при обновлении файлов DCM или интерфейса. Предположим, что вы уже создали код устройства из файла DCM, чтобы повторно создать код:

1. В открытой папке с файлами DCM нажмите сочетание клавиш **CTRL+SHIFT+P**, чтобы открыть палитру команд, введите **IoT Plug and Play** и выберите **Generate Device Code Stub** (Создать заглушку кода устройства).

1. Выберите обновленный файл DCM.

1. Выберите **повторно создать код для {Project Name}** .

1. В генераторе кода используется предыдущий параметр, который вы настроили и повторно создаете код. Однако он не перезаписывает файлы, которые могут содержать пользовательский код, например `main.c` и `{project_name}_impl.c`.

> [!NOTE]
> Если вы обновляете идентификатор URN в файле интерфейса, он рассматривается как новый интерфейс. При повторном создании кода генератор кода создает код для интерфейса, но не перезаписывает исходный файл в файле `{project_name}_impl.c`.

## <a name="problems-and-feedback"></a>Проблемы и отзывы

Средства Azure IoT — это проект с открытым кодом на GitHub. При возникновении проблем и запросов функций можно [создать вопрос на GitHub](https://github.com/microsoft/vscode-azure-iot-tools/issues/new).

## <a name="next-steps"></a>Дальнейшие действия

В этом пошаговом руководстве вы узнали, как использовать Visual Studio и Visual Studio Code для создания каркаса кода на языке C для реализации приложения устройства. Предлагаемый следующий шаг — Узнайте, как [установить и использовать средство Azure IOT Explorer](./howto-install-iot-explorer.md) .
