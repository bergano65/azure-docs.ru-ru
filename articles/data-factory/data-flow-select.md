---
title: Выбор преобразования в потоке данных сопоставления
description: Преобразование "Выбор потока данных сопоставления фабрики данных Azure"
author: kromerm
ms.author: makromer
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 06/02/2020
ms.openlocfilehash: 70e0a95a85920562af8bf9d3fffa6633709dccc5
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "84322096"
---
# <a name="select-transformation-in-mapping-data-flow"></a>Выбор преобразования в потоке данных сопоставления

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Используйте преобразование выбор для переименования, удаления или переупорядочивания столбцов. Это преобразование не изменяет данные строки, но выбирает столбцы, которые передаются по нисходящей. 

В преобразовании SELECT пользователи могут указать фиксированные сопоставления, использовать закономерности для сопоставления на основе правил или включить автоматическое сопоставление. Фиксированные и основанные на правилах сопоставления могут использоваться в одном и том же преобразовании SELECT. Если столбец не соответствует одному из определенных сопоставлений, он будет удален.

## <a name="fixed-mapping"></a>Фиксированное сопоставление

Если в проекции определено менее 50 столбцов, по умолчанию все определенные столбцы будут иметь фиксированное сопоставление. Фиксированное сопоставление принимает определенный, входящий столбец и сопоставляет его точное имя.

![Фиксированное сопоставление](media/data-flow/fixedmapping.png "Фиксированное сопоставление")

> [!NOTE]
> Невозможно сопоставить или переименовать смещенный столбец с фиксированным сопоставлением

### <a name="mapping-hierarchical-columns"></a>Сопоставление иерархических столбцов

Фиксированные сопоставления можно использовать для сопоставления подстолбца иерархического столбца с столбцом верхнего уровня. Если у вас есть определенная иерархия, для выбора подстолбца используйте раскрывающийся список столбцов. Преобразование «выбор» создаст новый столбец со значением и типом данных подстолбца.

![иерархическое сопоставление](media/data-flow/select-hierarchy.png "иерархическое сопоставление")

## <a name="rule-based-mapping"></a>Rule-based mapping (Выбор преобразования: сопоставление на основе правил)


> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4xiXz]

Если вы хотите сопоставить несколько столбцов одновременно или передавали передаваемые столбцы, используйте сопоставление на основе правил, чтобы определить сопоставления с помощью шаблонов столбцов. Соответствие, основанное `name` на `type` `stream` столбцах,, и `position` . Можно использовать любое сочетание фиксированных и основанных на правилах сопоставлений. По умолчанию все проекции с более чем 50 столбцами по умолчанию будут сопоставлены на основе правил, которые соответствуют каждому столбцу и выводят выводимое имя. 

Чтобы добавить сопоставление на основе правил, нажмите кнопку **Добавить сопоставление** и выберите **сопоставление на основе правил**.

![сопоставление на основе правил](media/data-flow/rule2.png "Rule-based mapping (Выбор преобразования: сопоставление на основе правил)")

Каждое сопоставление на основе правил требует двух входных данных: условия, по которым производится сопоставление, и имя каждого сопоставленного столбца. Оба значения выводятся с помощью [построителя выражений](concepts-data-flow-expression-builder.md). В поле левое выражение введите логическое условие соответствия. В поле справа укажите, с каким столбцом будет сопоставляться сопоставленный столбец.

![сопоставление на основе правил](media/data-flow/rule-based-mapping.png "Rule-based mapping (Выбор преобразования: сопоставление на основе правил)")

Используйте `$$` синтаксис для ссылки на входное имя сопоставленного столбца. Используя приведенное выше изображение в качестве примера, предположим, что пользователь хочет сопоставить все строковые столбцы, имена которых короче шести символов. Если один входящий столбец был именован `test` , выражение `$$ + '_short'` будет переименовывать столбец `test_short` . Если это единственное сопоставление, все столбцы, которые не соответствуют условию, будут удалены из выведенных данных.

Закономерности совпадают с смещенными и определенными столбцами. Чтобы узнать, какие определенные столбцы сопоставляются правилу, щелкните значок очков рядом с правилом. Проверьте выходные данные с помощью предварительной версии данных.

### <a name="regex-mapping"></a>Сопоставление регулярного выражения

Если щелкнуть значок шеврона вниз, можно указать условие сопоставления регулярного выражения. Условие сопоставления регулярного выражения сопоставляет все имена столбцов, соответствующие указанному условию Regex. Это можно использовать в сочетании со стандартными сопоставлениями на основе правил.

![сопоставление на основе правил](media/data-flow/regex-matching.png "Rule-based mapping (Выбор преобразования: сопоставление на основе правил)")

Приведенный выше пример соответствует шаблону регулярного выражения `(r)` или любому имени столбца, в котором содержится нижний регистр r. Как и в стандартном сопоставлении на основе правил, все сопоставленные столбцы изменяются с помощью условия справа с использованием `$$` синтаксиса.

Если в имени столбца имеется несколько совпадений регулярного выражения, вы можете ссылаться на конкретные совпадения, используя `$n` Where "n", к которому относится совпадение. Например, "$2" ссылается на второе совпадение в имени столбца.

### <a name="rule-based-hierarchies"></a>Иерархии на основе правил

Если определенная проекция имеет иерархию, можно использовать сопоставление на основе правил для сопоставления подстолбцов иерархии. Укажите условие сопоставления и сложный столбец, для которого нужно выполнить сопоставление. Каждый сопоставленный подстолбец будет выведен с помощью правила "Name AS", указанного справа.

![сопоставление на основе правил](media/data-flow/rule-based-hierarchy.png "Rule-based mapping (Выбор преобразования: сопоставление на основе правил)")

Приведенный выше пример соответствует всем подстолбцам сложного столбца `a` . `a` содержит два подстолбца `b` и `c` . Выходная схема будет содержать два столбца `b` , а `c` в качестве условия "Name AS" — `$$` .

### <a name="parameterization"></a>Определение параметров

Имена столбцов можно параметризовать с помощью сопоставления на основе правил. Используйте ключевое слово ```name``` для сопоставления имен входящих столбцов с параметром. Например, если имеется параметр потока данных ```mycolumn``` , можно создать правило, которое будет соответствовать любому имени столбца, равному ```mycolumn``` . Можно переименовать сопоставленный столбец в жестко заданную строку, такую как "бизнес-ключ", и ссылаться на нее явным образом. В этом примере условие сопоставления имеет значение, ```name == $mycolumn``` а условием имени является "бизнес-ключ". 

## <a name="auto-mapping"></a>Автоматическое сопоставление

При добавлении преобразования «выбор» можно включить **Автоматическое сопоставление** , переключив ползунок «автоматическое сопоставление». При использовании автоматического сопоставления преобразование «выбор» сопоставляет все входящие столбцы, исключая дубликаты, с тем же именем, что и у входных данных. Это будет включать смещенные столбцы, что означает, что выходные данные могут содержать столбцы, не определенные в схеме. Дополнительные сведения о смещенных столбцах см. в разделе [смещение схемы](concepts-data-flow-schema-drift.md).

![Автоматическое сопоставление](media/data-flow/automap.png "Автоматическое сопоставление")

Если автоматическое сопоставление включено, то преобразование «выбор» будет соблюдать параметры «Пропустить дубликаты» и предоставить новый псевдоним для существующих столбцов. Присвоение псевдонимов полезно при выполнении нескольких операций соединения или уточняющих запросов в одном и том же потоке и в сценариях самосоединения. 

## <a name="duplicate-columns"></a>Дублирование столбцов

По умолчанию преобразование «выбор» удаляет дублирующиеся столбцы как в входной, так и в выходной проекции. Дубликаты входных столбцов часто берутся из преобразований «соединение» и «Уточняющий запрос», где имена столбцов дублируются на каждой стороне объединения. При сопоставлении двух различных входных столбцов с одним именем могут возникать дублирующиеся выходные столбцы. Выберите, следует ли удалить или передать на дублирующиеся столбцы, установив флажок.

![Пропустить дубликаты](media/data-flow/select-skip-dup.png "Пропустить дубликаты")

## <a name="ordering-of-columns"></a>Упорядочение столбцов

Порядок сопоставлений определяет порядок выходных столбцов. Если входной столбец сопоставлен несколько раз, будет учитываться только первое сопоставление. Для любого повторяющегося удаления столбца будет сохранено первое совпадение.

## <a name="data-flow-script"></a>Скрипт потока данных

### <a name="syntax"></a>Синтаксис

```
<incomingStream>
    select(mapColumn(
        each(<hierarchicalColumn>, match(<matchCondition>), <nameCondition> = $$), ## hierarchical rule-based matching
        <fixedColumn>, ## fixed mapping, no rename
        <renamedFixedColumn> = <fixedColumn>, ## fixed mapping, rename
        each(match(<matchCondition>), <nameCondition> = $$), ## rule-based mapping
        each(patternMatch(<regexMatching>), <nameCondition> = $$) ## regex mapping
    ),
    skipDuplicateMapInputs: { true | false },
    skipDuplicateMapOutputs: { true | false }) ~> <selectTransformationName>
```

### <a name="example"></a>Пример

Ниже приведен пример сопоставления SELECT и его сценария потока данных:

![Пример сценария SELECT](media/data-flow/select-script-example.png "Пример сценария SELECT")

```
DerivedColumn1 select(mapColumn(
        each(a, match(true())),
        movie,
        title1 = title,
        each(match(name == 'Rating')),
        each(patternMatch(`(y)`),
            $1 + 'regex' = $$)
    ),
    skipDuplicateMapInputs: true,
    skipDuplicateMapOutputs: true) ~> Select1
```

## <a name="next-steps"></a>Дальнейшие действия
* После использования инструкции SELECT для переименования, изменения порядка и псевдонима столбцов используйте [Преобразование «приемник](data-flow-sink.md) » для размещения данных в хранилище данных.
