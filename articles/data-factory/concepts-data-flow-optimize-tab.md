---
title: Вкладка оптимизации для сопоставления потоков данных Фабрики данных Azure
description: Оптимизация сопоставления для потоков данных Фабрики данных Azure и параметры секционирования на вкладке оптимизации
author: kromerm
ms.author: makromer
ms.reviewer: douglasl
ms.service: data-factory
ms.topic: conceptual
ms.date: 01/31/2019
ms.openlocfilehash: 31aca6f4ccfe9991a1dcf2808815a4543e2c6fe6
ms.sourcegitcommit: d2329d88f5ecabbe3e6da8a820faba9b26cb8a02
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/16/2019
ms.locfileid: "56326465"
---
# <a name="mapping-data-flow-transformation-optimize-tab"></a>Вкладка оптимизации сопоставления для потоков данных

[!INCLUDE [notes](../../includes/data-factory-data-flow-preview.md)]

Каждое преобразование потока данных имеет вкладку "Оптимизация". Эта вкладка содержит необязательные параметры, позволяющие настроить схемы секционирования для потоков данных.

<img src="media/data-flow/opt001.png" width="800">

По умолчанию используется вариант "Use current partitioning" (Использовать текущее секционирование). Текущее секционирование означает, что Фабрика данных Azure будет использовать собственную схему секционирования потоков данных, которые выполняются в Spark в Azure Databricks. Обычно мы рекомендуем использовать именно этот подход.

Но для некоторых экземпляров вам может потребоваться другой вариант секционирования. Например, если требуется направить вывод преобразования в один файл в озере, выберите на вкладке оптимизации вариант "Одна секция", чтобы настроить секционирование для преобразования приемника.

Другим примером, в которой вам может потребоваться изменить схему секционирования для преобразования данных, можно считать оптимизацию производительности. Настройка методов секционирования данных обеспечивает дополнительный уровень контроля над распределением данных между вычислительными узлами и оптимизацией размещения данных. Все это может иметь как положительное, так и отрицательное влияние на производительность потока данных в целом.

Если вы решите изменить секционирование для любого преобразования, перейдите на вкладку оптимизации и установите переключатель "Set Partitioning" (Настроить секционирование). Вам будут предложены несколько параметров для настройки секционирования. Оптимальный выбор секционирования будет разным в зависимости от объемов данных, потенциальных ключей, значений null и кратности. Мы рекомендуем начать со стандартного варианта секционирования, а затем протестировать другие варианты. Для проверки можно использовать отладочный запуск в конвейере, а затем в представлении мониторинга проверить время, затраченное на каждую группу преобразований, и используемые секции.

<img src="media/data-flow/opt002.png" width="600">

### <a name="round-robin"></a>Циклический перебор,

Циклический перебор — это простой вариант секционирования, который автоматически равномерно распределяет данные по секциям. Циклический перебор можно использовать, если у вас нет хороших вариантов для реализации надежной и интеллектуальной стратегии секционирования. Вы можете задать количество физических секций.

### <a name="hash"></a>Хэш

Фабрика данных Azure создает хэш столбцов, чтобы получить равномерное распределение секций, и при этом строки со сходными значениями попадут в одну секцию. Если вы выберете вариант с хэшем, проверьте равномерность распределения по секциям. Вы можете задать количество физических секций.

### <a name="dynamic-range"></a>Динамический диапазон

Динамический диапазон означает использование динамических диапазонов Spark по указанным вами столбцам или выражениям. Вы можете задать количество физических секций. 

### <a name="fixed-range"></a>Фиксированный диапазон

Вам нужно создать выражение, которое генерирует фиксированный диапазон значений в пределах столбцов секционированных данных. Чтобы применить этот вариант, необходимо хорошо понимать состав используемых данных, иначе невозможно избежать неравномерного распределения. Значение, введенное в качестве выражения, используется в составе функции секционирования. Вы можете задать количество физических секций.

### <a name="key"></a>Ключ

Если вы хорошо понимаете кратность ваших данных, хорошим вариантом может служить секционирование по ключу. При секционировании по ключу создаются секции для каждого уникального значения в столбце. Вы не можете задать число секций, так как оно будет зависеть от количества уникальных значений в данных.
