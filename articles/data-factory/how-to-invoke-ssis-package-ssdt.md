---
title: Выполнение пакетов служб SSIS из SSDT
description: Узнайте, как выполнять пакеты служб SSIS в Azure из SSDT.
services: data-factory
documentationcenter: ''
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.author: sawinark
author: swinarko
ms.reviewer: douglasl
manager: mflasko
ms.custom: seo-lt-2019
ms.date: 09/06/2020
ms.openlocfilehash: fb5b5cb0ac4a9ace7b5de5e92308da58fd2b1fec
ms.sourcegitcommit: 59ea8436d7f23bee75e04a84ee6ec24702fb2e61
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/07/2020
ms.locfileid: "89504950"
---
# <a name="execute-ssis-packages-in-azure-from-ssdt"></a>Выполнение пакетов служб SSIS в Azure из SSDT

[!INCLUDE[appliesto-adf-xxx-md](includes/appliesto-adf-xxx-md.md)]

В этой статье описывается функция проектов SQL Server Integration Services (SSIS) с поддержкой Azure в SQL Server Data Tools (SSDT). Он позволяет оценивать совместимость пакетов служб SSIS в облаке и запускать их на Azure-SSIS Integration Runtime (IR) в фабрике данных Azure (ADF). Эту функцию можно использовать для тестирования существующих пакетов, прежде чем претянуть & Shift/перенести их в Azure или разработать новые пакеты для работы в Azure.

С помощью этой функции можно присоединить вновь созданный или существующий Azure-SSIS IR к проектам служб SSIS, а затем выполнить на нем пакеты.  Мы поддерживаем запуск пакетов для развертывания в каталоге служб SSIS (SSISDB), размещенном на сервере базы данных SQL Azure или управляемом экземпляре в модели развертывания проекта. Мы также поддерживаем запуск пакетов для развертывания в файловую систему, файлы Azure и SQL Server базу данных (MSDB), размещенные управляемым экземпляром SQL Azure в модели развертывания пакетов. 

## <a name="prerequisites"></a>Предварительные требования

Чтобы использовать эту функцию, скачайте и установите последнюю версию SSDT с расширением проектов SSIS для Visual Studio (VS) [отсюда.](https://marketplace.visualstudio.com/items?itemName=SSIS.SqlServerIntegrationServicesProjects) Кроме того, можно загрузить и установить последнюю версию SSDT как автономный установщик [отсюда.](https://docs.microsoft.com/sql/ssdt/download-sql-server-data-tools-ssdt?view=sql-server-2017#ssdt-for-vs-2017-standalone-installer)

## <a name="azure-enable-ssis-projects"></a>Включение проектов служб SSIS в Azure

### <a name="creating-new-azure-enabled-ssis-projects"></a>Создание новых проектов служб SSIS с поддержкой Azure

В SSDT можно создать новые проекты служб SSIS с поддержкой Azure с помощью шаблона **Integration Services проекта (Azure с возможностью использования)** .

   ![Новый проект служб SSIS с поддержкой Azure](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-new-project.png)

После создания проекта с поддержкой Azure вам будет предложено подключиться к службам SSIS в фабрике данных Azure.

   ![Запрос Azure-SSIS IR подключения](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-integration-runtime-connect-prompt.png)

Если вы хотите немедленно подключиться к Azure-SSIS IR, см. Дополнительные сведения в разделе [Подключение к Azure-SSIS IR](#connectssisir) . Вы также можете подключиться позже, щелкнув правой кнопкой мыши узел проекта в обозреватель решений окне SSDT, чтобы открыть меню. Затем выберите пункт **Подключение к службам SSIS в фабрике данных Azure** в подменю **службы SSIS в фабрике данных Azure** .

### <a name="azure-enabling-existing-ssis-projects"></a><a name="azureenableproject"></a> Активация существующих проектов служб SSIS в Azure

Для существующих проектов служб SSIS их можно включить в Azure, выполнив следующие действия.

1. Щелкните правой кнопкой мыши узел проекта в окне обозреватель решений SSDT, чтобы открыть меню. Затем выберите элемент **проекта с поддержкой Azure** в подменю **службы SSIS в фабрике данных Azure** , чтобы запустить **Мастер проектов с поддержкой Azure**.

   ![Azure — Включение существующего проекта служб SSIS](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-for-existing-project.png)

2. На странице **Выбор конфигурации Visual Studio** выберите СУЩЕСТВУЮЩУЮ конфигурацию VS, чтобы применить параметры выполнения пакета в Azure. Вы также можете создать новый, если вы еще не сделали этого, см. раздел [Создание новой конфигурации VS](https://docs.microsoft.com/visualstudio/ide/how-to-create-and-edit-configurations?view=vs-2019). Мы рекомендуем использовать по крайней мере две разные конфигурации VS для выполнения пакетов в локальных и облачных средах, чтобы вы могли включить проект в Azure в соответствии с конфигурацией облака. Таким образом, если вы выделили проект или пакеты, вы можете назначить разные значения для проекта или параметров пакета во время выполнения на основе разных сред выполнения (на локальном компьютере или в Azure). Например, см. раздел [Переключение сред выполнения пакетов](#switchenvironment).

   ![Выберите конфигурацию Visual Studio](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-select-visual-studio-configurations.png)

3. Для включения в Azure существующих проектов служб SSIS необходимо задать версию целевого сервера, которая будет последней версией, поддерживаемой Azure-SSIS IR. Azure-SSIS IR в настоящее время основывается на **SQL Server 2017**. Убедитесь, что пакеты не содержат дополнительные компоненты, которые не поддерживаются на SQL Server 2017. Также убедитесь, что все совместимые дополнительные компоненты также установлены на Azure-SSIS IR с помощью пользовательских настроек, см. раздел [настройка Azure-SSIS IR](https://docs.microsoft.com/azure/data-factory/how-to-configure-azure-ssis-ir-custom-setup). Нажмите кнопку **Далее** , чтобы продолжить.

   ![Переключение версии целевого сервера](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-switch-target-server-version-step.png)

4. Чтобы завершить подключение проекта к Azure-SSIS IR, см. раздел [Подключение к Azure-SSIS IR](#connectssisir) .

## <a name="connect-azure-enabled-projects-to-ssis-in-azure-data-factory"></a><a name="connectssisir"></a> Подключение проектов с поддержкой Azure к службам SSIS в фабрике данных Azure

Подключив проекты с поддержкой Azure к службам SSIS в ADF, вы можете передать пакеты в службу файлов Azure и запускать их на Azure-SSIS IR. Это можно сделать, выполнив следующие действия.

1. На странице **Общие сведения о службах SSIS в ADF** ознакомьтесь с введением и нажмите кнопку **Далее** , чтобы продолжить.

   ![Общие сведения о службах SSIS в ADF](media/how-to-invoke-ssis-package-ssdt/ssis-in-adf-connection-wizard.png)

2. На странице **Выбор служб SSIS IR в ADF** выберите существующий ADF-файл и Azure-SSIS IR для запуска пакетов. Вы также можете создать новые, если у вас их нет.
   - Чтобы выбрать существующий Azure-SSIS IR, сначала выберите соответствующую подписку Azure и ADF.
   - Если вы выберете существующий ADF-файл, который не содержит Azure-SSIS IR, нажмите кнопку **создать среду SSIS IR** , чтобы создать новую на портале ADF. После создания можно вернуться на эту страницу, чтобы выбрать новое Azure-SSIS IR.
   - Если вы выбрали существующую подписку Azure без ADF, нажмите кнопку **CREATE SSIS IR (создание** среды выполнения интеграции), чтобы запустить **Мастер создания Integration Runtime**. В мастере можно ввести назначенное расположение и префикс, чтобы автоматически создать новую группу ресурсов Azure, фабрику данных и службу SSIS IR от вашего имени с именем в следующем **формате: йоурпрефикс-RG/DF/IR-йоуркреатионтиме**. После создания можно вернуться на эту страницу, чтобы выбрать новый ADF-файл и Azure-SSIS IR.

   ![Выбор служб SSIS IR в ADF](media/how-to-invoke-ssis-package-ssdt/ssis-in-adf-connection-wizard2.png)

3. На странице **Выбор хранилища Azure** выберите существующую учетную запись хранения Azure для отправки пакетов в службу файлов Azure. Можно также создать новый, если у вас нет.
   - Чтобы выбрать существующую учетную запись хранения Azure, сначала выберите соответствующую подписку Azure.
   - Если вы выбрали ту же подписку Azure, что и Azure-SSIS IR без учетной записи хранения Azure, нажмите кнопку **создать хранилище Azure** . Мы автоматически создадим новую учетную запись от вашего имени в том же расположении, что и Azure-SSIS IR, с именем, объединив префикс имени Azure-SSIS IR и даты его создания. После создания можно вернуться на эту страницу, чтобы выбрать новую учетную запись хранения Azure.
   - Если вы выбрали другую подписку Azure без учетной записи хранения Azure, нажмите кнопку **создать хранилище Azure** , чтобы создать новую на портал Azure. После создания можно вернуться на эту страницу, чтобы выбрать новую учетную запись хранения Azure.

   ![Выбор службы хранилища Azure](media/how-to-invoke-ssis-package-ssdt/ssis-in-adf-connection-wizard3.png)

4. Нажмите кнопку **Подключиться** , чтобы завершить подключение проекта к Azure-SSIS IR. Выбранные Azure-SSIS IR и учетная запись хранения Azure будут отображаться в узле **связанные ресурсы Azure** в Обозреватель решений окне SSDT. Мы также регулярно обновляем и отображаем состояние Azure-SSIS IR там. Вы можете управлять Azure-SSIS IR, щелкнув его узел правой кнопкой мыши, чтобы открыть меню, а затем выбрав элемент **старт\стоп\манаже** , который переходит на портал ADF.

## <a name="assess-ssis-projectpackages-for-executions-in-azure"></a>Оценка прожект\паккажес служб SSIS для выполнения в Azure

### <a name="assessing-single-or-multiple-packages"></a>Оценка одного или нескольких пакетов

Перед выполнением пакетов в Azure вы можете оценить их, чтобы они могли получить любые потенциальные проблемы с совместимостью в облаке. К ним относятся блокирование миграции и дополнительные сведения, о которых следует знать. 
-  Вы можете оценивать отдельные пакеты по одному или всем пакетам одновременно с проектом.

   ![Оценка пакета](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-assess-package.png)

   ![Оценка проекта](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-assess-project.png)

-  В окне " **Оценка отчета** " SSDT можно найти все возможные проблемы с совместимостью в облаке, в каждой из которых есть собственное подробное описание и рекомендации. Отчет об оценке также можно экспортировать в CSV-файл, который можно использовать совместно с другими пользователями, которые должны устранить эти проблемы. 

   ![Отчет об оценке](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-assess-project-result.png)

### <a name="suppressing-assessment-rules"></a>Подавление правил оценки

Убедившись в том, что некоторые потенциальные проблемы совместимости с облаком не применимы или были правильно устранены в пакетах, вы можете подавить соответствующие правила оценки. Это снизит шум в последующих отчетах об оценке.
-  Выберите ссылку " **настроить подавление правил оценки** " в окне " **Оценка отчета** " в SSDT, чтобы открыть окно " **Параметры подавления правила** оценки", где можно выбрать правила оценки для подавления.

   ![Параметры подавления правил оценки](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-assessment-rule-suppression-settings.png)

-  Также можно щелкнуть правой кнопкой мыши узел проекта в окне обозреватель решений SSDT, чтобы открыть меню. Выберите элемент **Параметры Azure** в подменю **службы SSIS в фабрике данных Azure** , чтобы открыть окно, содержащее страницы свойств проекта. Выберите свойство **Неподавленные идентификаторы правил оценки** в разделе **Параметры, поддерживающие Azure** . Наконец, нажмите кнопку с многоточием (**...**), чтобы открыть окно " **Параметры подавления правил оценки** ", где можно выбрать правила оценки для подавления.

   ![Параметры, поддерживающие Azure](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-azure-enabled-setting.png)

   ![Параметры подавления правил оценки с помощью параметров, поддерживающих Azure](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-assessment-rule-suppression-settings-via-azure-enabled-settings.png)

## <a name="execute-ssis-packages-in-azure"></a>Выполнение пакетов служб SSIS в Azure

### <a name="configuring-azure-enabled-settings"></a><a name="azureenabledsettings"></a> Настройка параметров с поддержкой Azure

Перед выполнением пакетов в Azure можно настроить для них параметры, поддерживающие Azure. Например, можно включить проверку подлинности Windows на Azure-SSIS IR для доступа к локальным или облачным хранилищам данных, выполнив следующие действия.

1. Щелкните правой кнопкой мыши узел проекта в окне обозреватель решений SSDT, чтобы открыть меню. Затем в подменю **службы SSIS в фабрике данных Azure** выберите элемент **Параметры, поддерживающий Azure** , чтобы открыть окно, содержащее страницы свойств проекта.

   ![Параметры, поддерживающие Azure](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-azure-enabled-setting.png)

2. Выберите свойство **включить проверку подлинности Windows** в разделе **Параметры, поддерживающем Azure** , а затем в раскрывающемся меню выберите **значение true** . Затем выберите свойство **учетные данные проверки подлинности Windows** , а затем нажмите кнопку с многоточием (**...**), чтобы открыть окно **учетные данные для проверки подлинности Windows** .

   ![Включение проверки подлинности Windows](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-windows-authentication-open.png)

3. Введите учетные данные для проверки подлинности Windows. Например, для доступа к службе файлов Azure можно ввести `Azure` , `YourStorageAccountName` , и `YourStorageAccountKey` для **домена**, **имени пользователя**и **пароля**соответственно.

   ![Учетные данные проверки подлинности Windows](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-windows-authentication-credential.png)

### <a name="starting-package-executions"></a>Запуск выполнения пакетов

После подключения проектов с поддержкой Azure к службам SSIS в ADF, оценки их совместимости с облаком и устранения потенциальных проблем можно выполнять и тестировать пакеты на Azure-SSIS IR.
-  Нажмите кнопку **запустить** на панели инструментов SSDT, чтобы раскрывающийся список меню. Затем выберите пункт **выполнить в элементе Azure** .

   ![Выполнение в Azure](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-execute-package.png)

-  Также можно щелкнуть правой кнопкой мыши узел пакета в окне обозреватель решений SSDT, чтобы открыть меню. Затем выберите команду **выполнить пакет в элементе Azure** .

   ![Выполнение пакета в Azure](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-execute-package2.png)

> [!NOTE]
> Для выполнения пакетов в Azure требуется запущенная Azure-SSIS IR, поэтому если Azure-SSIS IR остановлена, откроется диалоговое окно для запуска. За исключением любых пользовательских настроек, этот процесс должен выполняться в течение 5 минут, но для Azure-SSIS IR присоединения к виртуальной сети может потребоваться около 20-30 минут. После выполнения пакетов в Azure можно прерывать Azure-SSIS IR для управления затратами на выполнение, щелкнув правой кнопкой мыши узел в окне обозреватель решений SSDT, чтобы открыть меню и выбрать элемент **старт\стоп\манаже** , чтобы сделать это на портале ADF.

### <a name="using-execute-package-task"></a>Использование задачи «Выполнение пакета»

Если пакеты содержат задачи «Выполнение пакета», которые ссылаются на дочерние пакеты, хранящиеся в локальных файловых системах, выполните следующие дополнительные действия.

1. Отправьте дочерние пакеты в службу файлов Azure в той же учетной записи хранения Azure, которая подключена к проектам, и получите новый UNC-путь, например `\\YourStorageAccountName.file.core.windows.net\ssdtexecution\YourChildPackage1.dtsx`

2. Замените путь к этим дочерним пакетам в диспетчере подключения файлов для задач "выполнение пакета" с новым путем в формате UNC.
   - Если локальный компьютер, на котором работает SSDT, не может получить доступ к новому UNC-пути, его можно ввести на панели Свойства диспетчера подключения файлов.
   - Кроме того, можно использовать переменную для пути к файлу, чтобы назначить правильное значение во время выполнения.

Если пакеты содержат задачи «Выполнение пакета», которые ссылаются на дочерние пакеты в том же проекте, никаких дополнительных действий не требуется.

### <a name="switching-package-protection-level"></a>Переключение уровня защиты пакета

Исполнение пакетов служб SSIS в Azure не **EncryptSensitiveWithUserKey**поддерживает / уровни защиты EncryptSensitiveWithUserKey**EncryptAllWithUserKey** . Следовательно, если пакеты настроены для использования, мы временно преобразуем их в с помощью уровней защиты **EncryptSensitiveWithPassword** / **EncryptAllWithPassword** , соответственно. Кроме того, мы будем создавать пароли шифрования случайным образом при передаче пакетов в службу файлов Azure для выполнения на Azure-SSIS IR.

> [!NOTE]
> Если пакеты содержат задачи "выполнение пакета", которые ссылаются на дочерние пакеты, настроенные для использования уровней защиты **EncryptSensitiveWithUserKey** / **EncryptAllWithUserKey** , необходимо вручную перенастроить эти дочерние пакеты так, чтобы они использовали **EncryptSensitiveWithPassword** / **EncryptAllWithPassword** защиты, соответственно, перед выполнением пакетов.

Если в пакетах уже настроено использование **EncryptSensitiveWithPassword** / уровней защиты EncryptSensitiveWithPassword**EncryptAllWithPassword** , мы будем оставаться без изменений. При передаче пакетов в службу файлов Azure для выполнения на Azure-SSIS IR мы будем случайным образом создавать пароли шифрования.

### <a name="switching-package-execution-environments"></a><a name="switchenvironment"></a> Переключение сред выполнения пакетов

При параметризации проекта или пакетов в модели развертывания проекта можно создать несколько конфигураций VS для переключения сред выполнения пакетов. Таким образом, для параметров проекта или пакета можно назначить значения, зависящие от среды, во время выполнения. Мы рекомендуем использовать по крайней мере две разные конфигурации VS для выполнения пакетов в локальных и облачных средах, чтобы можно было включить в Azure проекты в соответствии с конфигурацией облака. Ниже приведен пошаговый пример переключения сред выполнения пакетов между локальным компьютером и Azure.

1. Предположим, что пакет содержит задачу «Файловая система», которая задает атрибуты файла. При запуске на локальном компьютере задаются атрибуты файла, хранящегося в локальной файловой системе. При запуске на Azure-SSIS IR необходимо задать атрибуты файла, хранящегося в службе файлов Azure. Сначала создайте параметр пакета типа String и назовите его **FilePath** , чтобы сохранить значение пути к целевому файлу.

   ![Создать параметр пакета](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-example-define-parameters.png)

2. Затем на странице **Общие** окна **Редактор задачи «Файловая система** » параметризуются свойство **SourceVariable** в разделе **соединение с источником** с параметром **FilePath** Package. 

   ![Параметризация соединения с источником](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-example-update-task-with-parameters.png)

3. По умолчанию у вас есть конфигурация VS для выполнения пакетов в локальной среде с именем **Разработка**. Создание новой конфигурации VS для выполнения пакетов в облачной среде с именем **Azure**. Если вы еще не сделали этого, см. раздел [Создание новой конфигурации VS](https://docs.microsoft.com/visualstudio/ide/how-to-create-and-edit-configurations?view=vs-2019).

4. При просмотре параметров пакета нажмите кнопку **Добавить параметры в конфигурации** , чтобы открыть окно **Управление значениями параметров** для пакета. Затем назначьте разные значения пути к целевому файлу для параметра **FilePath** в конфигурациях **разработки** и **Azure** .

   ![Назначение значений параметров](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-example-override-parameter.png)

5. Azure. Включение проекта в соответствии с конфигурацией облака. Если вы еще не сделали этого, см. статью [Включение существующих проектов служб SSIS в Azure](#azureenableproject). Затем настройте параметры, поддерживающие Azure, чтобы включить проверку подлинности Windows для доступа к службе "файлы Azure" для Azure-SSIS IR. Дополнительные сведения см. в разделе [Настройка параметров с поддержкой Azure](#azureenabledsettings), если это еще не сделано.

6. Выполните пакет в Azure. Среду выполнения пакета можно переключить обратно на локальный компьютер, выбрав конфигурацию **разработки** .

   ![Переключение конфигурации Visual Studio](media/how-to-invoke-ssis-package-ssdt/ssdt-azure-enabled-example-switch-configurations.png)

### <a name="using-package-configuration-file"></a>Использование файла конфигурации пакета

Если вы используете файлы конфигурации пакета в модели развертывания пакетов, то для свойств пакета можно назначить значения, зависящие от среды, во время выполнения. Мы автоматически загружаем эти файлы с пакетами в файлы Azure для выполнения на Azure-SSIS IR.

### <a name="checking-package-execution-logs"></a>Проверка журналов выполнения пакетов

После запуска пакета мы будем форматировать и отображать свои журналы в окне **хода выполнения** SSDT. Для долго выполняющегося пакета мы периодически обновляем свои журналы по минутам. Вы можете немедленно отменить выполнение пакета, нажав кнопку **остановить** на панели инструментов SSDT. Кроме того, можно временно найти необработанные данные журналов по следующему UNC-пути: `\\<YourStorageAccountName>.file.core.windows.net\ssdtexecution\<YourProjectName-FirstConnectTime>\<YourPackageName-tmp-ExecutionTime>\logs` , но мы удалим его через один день.

## <a name="current-limitations"></a>Текущие ограничения

-  SSDT с поддержкой Azure поддерживает только регионы коммерческой или глобальной облачной службы, и сейчас не поддерживает государственные и местные облачные регионы.

## <a name="next-steps"></a>Дальнейшие действия

Когда вы удовлетворены выполнением пакетов в Azure из SSDT, вы можете развернуть и запустить их как выполнение действий пакета служб SSIS в конвейерах ADF. см. раздел [выполнение пакетов служб SSIS как выполнение действий пакета SSIS в конвейерах ADF](https://docs.microsoft.com/azure/data-factory/how-to-invoke-ssis-package-ssis-activity).
