---
title: Создание триггеров на основе событий в Фабрике данных Azure
description: Узнайте, как создать в Фабрике данных Azure триггер, который запускает конвейер в ответ на событие.
services: data-factory
documentationcenter: ''
ms.service: data-factory
ms.workload: data-services
author: djpmsft
ms.author: daperlov
manager: jroth
ms.reviewer: maghan
ms.topic: conceptual
ms.date: 10/18/2018
ms.openlocfilehash: 56d80571253d95d28c839ed81b6e1ce6dda9dc46
ms.sourcegitcommit: fdec8e8bdbddcce5b7a0c4ffc6842154220c8b90
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2020
ms.locfileid: "83652401"
---
# <a name="create-a-trigger-that-runs-a-pipeline-in-response-to-an-event"></a>Создание триггера, запускающего конвейер в ответ на событие
[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

В этой статье описаны триггеры на основе событий, создаваемые в конвейерах Фабрики данных.

Управляемая событиями архитектура (EDA) — это общий шаблон интеграции данных, включающий в себя производство, обнаружение, потребление и реагирование на события. В сценариях интеграции данных часто требуется, чтобы клиенты Фабрики данных инициировали конвейеры на основе таких событий, как получение или удаление файла в учетной записи хранения Azure. Фабрика данных теперь интегрируется с [Сеткой событий Azure](https://azure.microsoft.com/services/event-grid/), что позволяет активировать конвейеры на основе событий.

Уделите 10 минут своего времени, чтобы просмотреть следующее видео с кратким обзором и демонстрацией этой функции:

> [!VIDEO https://channel9.msdn.com/Shows/Azure-Friday/Event-based-data-integration-with-Azure-Data-Factory/player]


> [!NOTE]
> Интеграция, описанная в этой статье, зависит от службы [Сетка событий Azure](https://azure.microsoft.com/services/event-grid/). Убедитесь, что ваша подписка зарегистрирована у поставщика ресурсов "Сетка событий". См. дополнительные сведения о [поставщиках и типах ресурсов](../azure-resource-manager/management/resource-providers-and-types.md#azure-portal).

## <a name="data-factory-ui"></a>Пользовательский интерфейс Фабрики данных

В этом разделе показано, как создать триггер события в пользовательском интерфейсе Фабрики данных Azure.

1. Перейдите к панели **Работа над холстом**

1. В нижнем левом углу нажмите кнопку **Триггеры**

1. Нажмите кнопку **Создать**, чтобы открыть боковое диалоговое окно создания триггера

1. Для типа триггера выберите **Событие**

    ![Создание триггера события](media/how-to-create-event-trigger/event-based-trigger-image1.png)

1. Выберите свою учетную запись хранения в раскрывающемся списке подписки Azure или укажите ее вручную с помощью идентификатора ресурса учетной записи хранения. Выберите контейнер, в котором должны выполняться события. Выбирать контейнер необязательно, но следует учитывать, что выбор всех контейнеров может привести к большому числу событий.

   > [!NOTE]
   > В настоящее время триггер событий поддерживает только учетные записи хранения общего назначения версии 2 и учетные записи хранения Azure Data Lake Storage 2-го поколения. В связи с ограничением Сетки событий Azure Фабрика данных Azure поддерживает не более 500 триггеров событий для каждой учетной записи хранения.

1. С помощью свойств **Blob path begins with** (Путь большого двоичного объекта начинается с) и **Blob path ends with** (Путь большого двоичного объекта заканчивается на) можно задать названия контейнеров, папок и больших двоичных объектов, для которых необходимо получать события. Для триггера события требуется определить хотя бы одно из этих свойств. Вы можете использовать различные шаблоны для свойств **Blob path begins with** (Путь большого двоичного объекта начинается с) и **Blob path ends with** (Путь большого двоичного объекта заканчивается на), как показано в примерах далее в этой статье.

    * **Путь большого двоичного объекта начинается с.** Путь к большому двоичному объекту должен начинаться с пути к папке. Допустимые значения включают `2018/` и `2018/april/shoes.csv`. Это поле нельзя выбрать, если контейнер не выбран.
    * **Путь большого двоичного объекта оканчивается на.** Путь к большому двоичному объекту должен заканчиваться именем файла или расширением. Допустимые значения включают `shoes.csv` и `.csv`. Имя контейнера и папки являются необязательными, но если они указаны, они должны быть разделены сегментом `/blobs/`. Например, контейнер с именем "orders" может иметь значение `/orders/blobs/2018/april/shoes.csv`. Чтобы указать папку в любом контейнере, опустите начальный символ "/". Например, `april/shoes.csv` запустит событие для любого файла с именем `shoes.csv` в папке с именем "april" в любом контейнере. 

1. Укажите, будет ли триггер отвечать на событие **создания BLOB-объекта**, **удаления BLOB-объекта** или на оба эти события. В указанном месте хранения каждое событие запустит конвейеры Фабрики данных, связанные с этим триггером.

    ![Настройка триггера события](media/how-to-create-event-trigger/event-based-trigger-image2.png)

1. Выберите, будет ли триггер игнорировать большие двоичные объекты с нулевым числом байтов.

1. После настройки триггера щелкните **Далее: просмотр данных**. На этом экране отображаются имеющиеся большие двоичные объекты, соответствующие конфигурации триггера событий. Убедитесь, что у вас есть нужные фильтры. Настройка слишком широких фильтров может привести к выбору большого количества созданных и удаленных файлов, что может значительно повлиять на стоимость. После проверки условий фильтра нажмите кнопку **Готово**.

    ![Предварительный просмотр данных триггеров событий](media/how-to-create-event-trigger/event-based-trigger-image3.png)

1. Чтобы подключить конвейер к этому триггеру, перейдите на холст конвейера, щелкните **Добавить триггер** и выберите команду **Создать или изменить**. Когда появится боковая панель навигации, щелкните **Выберите триггер...** и выберите созданный триггер. Щелкните **Далее: просмотр данных**, чтобы подтвердить правильность конфигурации, а затем — **Далее**, чтобы проверить правильность этих данных.

1. Если у конвейера есть параметры, их можно указать в параметрах запуска триггера на боковой панели навигации. При срабатывании триггера событий в свойства `@trigger().outputs.body.folderPath` и `@trigger().outputs.body.fileName` записывается путь к папке и имя файла большого двоичного объекта. Чтобы использовать значения этих свойств в конвейере, необходимо сопоставить эти свойства с параметрами конвейера. После сопоставления свойств с параметрами можно получить доступ к значениям, записанным с помощью триггера, через выражение `@pipeline().parameters.parameterName` в конвейере. По завершении нажмите кнопку **Готово**.

    ![Сопоставление свойств с параметрами конвейера](media/how-to-create-event-trigger/event-based-trigger-image4.png)

В предыдущем примере триггер настроен на срабатывание, если в папке sample-testing в контейнере sample-data путь большого двоичного объекта оканчивается на ".csv". С помощью свойств **folderPath** и **fileName** записывается расположение нового большого двоичного объекта. Например, когда к пути sample-data/event-testing добавляется строка MoviesDB.csv, `@trigger().outputs.body.folderPath` получает значение `sample-data/event-testing`, а `@trigger().outputs.body.fileName` — значение `moviesDB.csv`. Здесь эти значения сопоставляются с параметрами конвейера `sourceFolder` и `sourceFile`, которые можно использовать в конвейере как `@pipeline().parameters.sourceFolder` и `@pipeline().parameters.sourceFile` соответственно.

## <a name="json-schema"></a>Схема JSON

В таблице ниже приводится обзор элементов схемы, относящихся к триггерам на основе событий:

| **Элемент JSON** | **Описание** | **Тип** | **Допустимые значения** | **Обязательно** |
| ---------------- | --------------- | -------- | ------------------ | ------------ |
| **область** | Идентификатор ресурса Azure Resource Manager учетной записи хранения. | Строка | Идентификатор Azure Resource Manager | Да |
| **events** | Тип событий, вызывающих срабатывание триггера. | Array    | Microsoft.Storage.BlobCreated, Microsoft.Storage.BlobDeleted | Да, любое сочетание этих значений. |
| **blobPathBeginsWith** | Путь большого двоичного объекта должен начинаться с шаблона, указанного для срабатывания триггера. Например, `/records/blobs/december/` активирует только триггер для больших двоичных объектов в папке `december` контейнера `records`. | Строка   | | Вы должны предоставить значение хотя бы для одного из этих свойств: `blobPathBeginsWith` или `blobPathEndsWith`. |
| **blobPathEndsWith** | Путь большого двоичного объекта должен оканчиваться шаблоном, указанным для срабатывания триггера. Например, `december/boxes.csv` активирует только триггер для больших двоичных объектов с именем `boxes` в папке `december`. | Строка   | | Вы должны предоставить значение хотя бы для одного из этих свойств: `blobPathBeginsWith` или `blobPathEndsWith`. |
| **ignoreEmptyBlobs** | Указывает, будут ли большие двоичные объекты с нулевыми байтами инициировать запуск конвейера. Значение по умолчанию для этого параметра — True. | Логическое | true или false | нет |

## <a name="examples-of-event-based-triggers"></a>Примеры триггеров на основе событий

В этом разделе приведены примеры параметров триггера на основе событий.

> [!IMPORTANT]
> Каждый раз, когда вы указываете контейнер и папку, контейнер и файл или контейнер, папку и файл, добавляйте сегмент пути `/blobs/`, как показано в следующих примерах. Для **blobPathBeginsWith** пользовательский интерфейс Фабрики данных в коде JSON триггера автоматически добавит `/blobs/` между папкой и именем контейнера.

| Свойство | Пример | Описание |
|---|---|---|
| **Путь большого двоичного объекта начинается с** | `/containername/` | Получает события для любого большого двоичного объекта в контейнере. |
| **Путь большого двоичного объекта начинается с** | `/containername/blobs/foldername/` | Получает события для любого большого двоичного объекта в контейнере `containername` и папке `foldername`. |
| **Путь большого двоичного объекта начинается с** | `/containername/blobs/foldername/subfoldername/` | Можно также указать ссылку на вложенную папку. |
| **Путь большого двоичного объекта начинается с** | `/containername/blobs/foldername/file.txt` | Получает события для большого двоичного объекта с именем `file.txt` в папке `foldername` в контейнере `containername`. |
| **Большой двоичный объект оканчивается на** | `file.txt` | Получает события для большого двоичного объекта с именем `file.txt` в любом пути. |
| **Большой двоичный объект оканчивается на** | `/containername/blobs/file.txt` | Получает события для большого двоичного объекта с именем `file.txt` в контейнере `containername`. |
| **Большой двоичный объект оканчивается на** | `foldername/file.txt` | Получает события для большого двоичного объекта с именем `file.txt` в папке `foldername` в любом контейнере. |

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения см. в руководстве по [выполнению конвейера и использованию триггеров](concepts-pipeline-execution-triggers.md#trigger-execution).
