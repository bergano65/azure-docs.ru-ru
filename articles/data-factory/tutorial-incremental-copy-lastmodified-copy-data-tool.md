---
title: Средство Data Tool для добавочного копирования новых и обновленных файлов
description: Создайте фабрику данных Azure, а затем используйте средство Копирование данных для добавочной загрузки новых файлов на основе LastModifiedDate.
services: data-factory
author: dearandyxu
ms.author: yexu
ms.reviewer: ''
manager: ''
ms.service: data-factory
ms.workload: data-services
ms.devlang: na
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 6/10/2020
ms.openlocfilehash: 402214da75bffd278e12db94f089d64acd62221e
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "84730155"
---
# <a name="incrementally-copy-new-and-changed-files-based-on-lastmodifieddate-by-using-the-copy-data-tool"></a>Добавочное копирование новых и измененных файлов на основе LastModifiedDate с помощью средства Копирование данных

[!INCLUDE[appliesto-adf-xxx-md](includes/appliesto-adf-xxx-md.md)]

В этом руководстве вы будете использовать портал Azure для создания фабрики данных. Затем вы сможете использовать средство Копирование данных для создания конвейера, который постепенно копирует только новые и измененные файлы, из хранилища BLOB-объектов Azure в хранилище BLOB-объектов Azure. Он использует `LastModifiedDate` , чтобы определить, какие файлы следует копировать.

После выполнения этих действий фабрика данных Azure проверит все файлы в исходном хранилище, примените фильтр файлов по `LastModifiedDate` и скопирует в целевое хранилище только те файлы, которые являются новыми или были обновлены с момента последнего обновления. Обратите внимание, что если фабрика данных сканирует большое количество файлов, то все равно следует рассчитывать на длительные длительности. Сканирование файлов занимает много времени, даже если объем копируемых данных уменьшается.

> [!NOTE]
> Если вы еще не работали с фабрикой данных, ознакомьтесь со статьей [Введение в фабрику данных Azure](introduction.md).

При работе с этим руководством вы выполните следующие задачи:

> [!div class="checklist"]
> * Создали фабрику данных.
> * Создание конвейера с помощью средства копирования данных.
> * Мониторинг конвейера и выполнения действий.

## <a name="prerequisites"></a>Предварительные требования

* **Подписка Azure**: Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/), прежде чем начинать работу.
* **Учетная запись хранения Azure**. Используйте хранилище BLOB-объектов для хранилища данных источника и приемника. Если у вас нет учетной записи хранения Azure, следуйте инструкциям в разделе [Создание учетной записи хранения](../storage/common/storage-account-create.md).

## <a name="create-two-containers-in-blob-storage"></a>Создание двух контейнеров в хранилище BLOB-объектов

Подготовьте хранилище BLOB-объектов для учебника, выполнив следующие действия.

1. Создайте контейнер с именем **Source**. Для выполнения этой задачи, например [Обозреватель службы хранилища Azure](https://storageexplorer.com/), можно использовать различные средства.

2. Создайте контейнер с именем **Destination**.

## <a name="create-a-data-factory"></a>Создание фабрики данных

1. В области слева выберите **Создать ресурс**. Выбор **Analytics**  >  **фабрики данных**аналитики:

   ![Выбор фабрики данных](./media/doc-common-process/new-azure-data-factory-menu.png)

2. На странице **Новая фабрика данных** в поле **Имя** введите **ADFTutorialDataFactory**.

   Имя фабрики данных должно быть глобально уникальным. Может появиться следующее сообщение об ошибке:

   ![Сообщение об ошибке "имя недоступно"](./media/doc-common-process/name-not-available-error.png)

   Если вы увидите следующую ошибку касательно значения имени, введите другое имя фабрики данных. Например,**_ваше_имя_** **ADFTutorialDataFactory**. Правила именования артефактов службы "Фабрика данных" см. в [этой](naming-rules.md) статье.
3. В разделе **Подписка**выберите подписку Azure, в которой вы создадите новую фабрику данных.
4. В разделе **Группа ресурсов**выполните одно из следующих действий.

    * Выберите **использовать существующий** , а затем выберите имеющуюся группу ресурсов в списке.

    * Выберите **создать** и введите имя группы ресурсов.
         
    Сведения о группах ресурсов см. в статье [Общие сведения об Azure Resource Manager](../azure-resource-manager/management/overview.md).

5. В качестве **версии** выберите **V2**.
6. В качестве **расположения** выберите расположение фабрики данных. В списке отображаются только поддерживаемые расположения. Хранилища данных (например, служба хранилища Azure и база данных SQL Azure) и расчеты (например, Azure HDInsight), используемые фабрикой данных, могут находиться в других расположениях и регионах.
8. Выберите **Создать**.
9. После создания фабрики данных появится домашняя страница фабрика данных.
10. Чтобы открыть пользовательский интерфейс фабрики данных Azure на отдельной вкладке, выберите плитку " **автор & монитор** ":

    ![Домашняя страница фабрики данных](./media/doc-common-process/data-factory-home-page.png)

## <a name="use-the-copy-data-tool-to-create-a-pipeline"></a>Создание конвейера с помощью средства копирования данных

1. На странице Приступая к **работе** выберите плитку **копирование данных** , чтобы открыть средство копирование данных.

   ![Плитка Копирование данных](./media/doc-common-process/get-started-page.png)

2. На странице **Свойства** выполните следующие действия.

    а. В разделе **имя задачи**введите **делтакопифромблобпипелине**.

    b. В разделе " **ритмичность задач" или "Расписание задач**" выберите **регулярное выполнение по расписанию**.

    c. В разделе **тип триггера**выберите **окно "переворачивающегося"**.

    d. В разделе **повторение**введите **15 минут**.

    д) Выберите **Далее**.

    Фабрика данных создает конвейер с указанным именем задачи.

    ![Страница «копирование свойств данных»](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/copy-data-tool-properties-page.png)

3. На странице **исходное хранилище данных** выполните следующие действия.

    а. Выберите **создать новое соединение** , чтобы добавить подключение.

    b. Выберите **хранилище BLOB-объектов Azure** из коллекции и нажмите кнопку **продолжить**.

    ![Выберите хранилище блогов Azure](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/source-data-store-page-select-blob.png)

    c. На странице **Новая связанная служба (хранилище BLOB-объектов Azure)** выберите учетную запись хранения из списка **имя учетной записи хранения** . Проверьте подключение и нажмите кнопку **создать**.

    d. Выберите новую связанную службу, а затем нажмите кнопку **Далее**.

   ![Выберите новую связанную службу.](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/source-data-store-page-select-linkedservice.png)

4. На странице **Choose the input file or folder** (Выбор входного файла или папки) выполните следующие действия:

    а. Найдите и выберите **исходную** папку, а затем щелкните **выбрать**.

    ![Выбор файла или папки входных данных](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/choose-input-file-folder.png)

    b. В разделе **поведение при загрузке файлов**выберите **добавочная загрузка: LastModifiedDate**.

    c. Выберите **двоичное копирование** , а затем нажмите кнопку **Далее**.

     ![Выберите страницу входного файла или папки](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/check-binary-copy.png)

5. На странице **целевое хранилище данных** выберите созданную службу **AzureBlobStorage** . Это та же учетная запись хранения, что и исходное хранилище данных. Нажмите кнопку **Далее**.

6. На странице **Choose the output file or folder** (Выбор целевого файла или папки) выполните следующие действия:

    а. Найдите и выберите папку **назначения** , а затем щелкните **выбрать**.

    ![Выбор выходного файла или страницы папки](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/choose-output-file-folder.png)

    b. Выберите **Далее**.

7. На странице **Параметры** выберите **Далее**.

8. На странице **Сводка** проверьте параметры и нажмите кнопку **Далее**.

    ![Страница "Сводка"](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/summary-page.png)

9. На **странице развертывания** выберите **Мониторинг**, чтобы отслеживать созданный конвейер (задачу).

    ![Страница развертывания](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/deployment-page.png)

10. Обратите внимание, что слева автоматически выбирается вкладка **Мониторинг**. Приложение переключается на вкладку " **монитор** ". Вы увидите состояние конвейера. Щелкните **Обновить**, чтобы обновить список. Выберите ссылку в поле **имя конвейера** , чтобы просмотреть сведения о выполнении действия или повторно запустить конвейер.

    ![Обновление списка и Просмотр сведений о выполнении действия](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/monitor-pipeline-runs-1.png)

11. В конвейере имеется только одно действие (действие копирования), поэтому отображается только одна запись. Чтобы получить дополнительные сведения об операции копирования, выберите ссылку **сведения** (значок очков) в столбце **имя действия** . Дополнительные сведения о свойствах см. в разделе [Общие сведения о действиях копирования](copy-activity-overview.md).

    ![Действие копирования в конвейере](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/monitor-pipeline-runs2.png)

    Так как в вашей учетной записи хранилища BLOB-объектов нет файлов в исходном контейнере, вы не увидите файлы, скопированные в целевой контейнер в учетной записи:

    ![Нет файлов в исходном контейнере или контейнере назначения](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/monitor-pipeline-runs3.png)

12. Создайте пустой текстовый файл и назовите его **file1.txt**. Отправьте этот текстовый файл в исходный контейнер в вашей учетной записи хранения. Для выполнения этих задач, таких как [Обозреватель службы хранилища Azure](https://storageexplorer.com/), можно использовать различные средства.

    ![Создать file1.txt и передать его в исходный контейнер](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/monitor-pipeline-runs3-1.png)

13. Чтобы вернуться к представлению **запусков конвейера** , выберите **все запуски конвейера**и дождитесь автоматического запуска одного и того же конвейера.  

14. По завершении второго выполнения конвейера выполните те же действия, которые упоминались ранее, чтобы ознакомиться с подробными сведениями о выполнении действия.  

    Вы увидите, что один файл (file1.txt) скопирован из исходного контейнера в целевой контейнер учетной записи хранилища BLOB-объектов:

    ![file1.txt скопирован из исходного контейнера в целевой контейнер](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/monitor-pipeline-runs6.png)

15. Создайте еще один пустой текстовый файл и назовите его **file2.txt**. Отправьте этот текстовый файл в исходный контейнер в учетной записи хранилища BLOB-объектов.

16. Повторите шаги 13 и 14 для второго текстового файла. Вы увидите, что только новый файл (file2.txt) был скопирован из исходного контейнера в целевой контейнер учетной записи хранения во время выполнения этого конвейера.  

    Кроме того, можно проверить, скопированы ли файлы только из одного файла, используя [Обозреватель службы хранилища Azure](https://storageexplorer.com/) для проверки файлов:

    ![Проверять файлы с помощью Обозреватель службы хранилища Azure](./media/tutorial-incremental-copy-lastmodified-copy-data-tool/monitor-pipeline-runs8.png)


## <a name="next-steps"></a>Дальнейшие шаги
Чтобы узнать, как преобразовать данные с помощью кластера Apache Spark в Azure, перейдите к следующему руководству:

> [!div class="nextstepaction"]
>[Преобразование данных в облаке с помощью кластера Apache Spark](tutorial-transform-data-spark-portal.md)
