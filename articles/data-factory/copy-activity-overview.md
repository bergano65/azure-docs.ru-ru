---
title: Действие копирования в фабрике данных Azure
description: Сведения о действии копирования в фабрике данных Azure. Его можно использовать для копирования данных из поддерживаемого исходного хранилища данных в поддерживаемое хранилище данных, используемое в качестве приемника.
services: data-factory
documentationcenter: ''
author: linda33wj
manager: shwang
ms.reviewer: douglasl
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.date: 03/25/2020
ms.author: jingwang
ms.openlocfilehash: 74210864332319dabb16eda865da9dc9793e3dbd
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "84187669"
---
# <a name="copy-activity-in-azure-data-factory"></a>Действие копирования в фабрике данных Azure

> [!div class="op_single_selector" title1="Выберите версию фабрики данных, которую вы используете:"]
> * [Версия 1](v1/data-factory-data-movement-activities.md)
> * [Текущая версия](copy-activity-overview.md)

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

В фабрике данных Azure действие копирования можно использовать для копирования данных между хранилищами данных, расположенными локально и в облаке. После копирования данных можно использовать другие действия для дальнейшего преобразования и анализа. Вы также можете использовать действие копирования для публикации результатов преобразования и анализа для бизнес-аналитики (BI) и использования приложений.

![Роль действия копирования](media/copy-activity-overview/copy-activity.png)

Действие копирования выполняется в [среде выполнения интеграции](concepts-integration-runtime.md). Для различных сценариев копирования данных можно использовать разные типы среды выполнения интеграции.

* При копировании данных между двумя хранилищами данных, доступ к которым осуществляется через Интернет, с любого IP-адреса, для действия копирования можно использовать среду выполнения интеграции Azure. Эта среда выполнения интеграции является безопасной, надежной, масштабируемой и [глобально доступной](concepts-integration-runtime.md#integration-runtime-location).
* При копировании данных в хранилища данных и из них, расположенных локально или в сети с контролем доступа (например, с виртуальной сетью Azure), необходимо настроить локальную среду выполнения интеграции.

Среду выполнения интеграции необходимо связать с каждым хранилищем данных источника и приемника. Сведения о том, как действие копирования определяет, какую среду выполнения интеграции использовать, см. [в разделе Определение используемого IR](concepts-integration-runtime.md#determining-which-ir-to-use).

Чтобы скопировать данные из источника в приемник, служба, выполняющая действие копирования, выполняет следующие действия.

1. Считывает данные из источника данных.
2. Выполняет сериализацию и десериализацию, сжатие и распаковку, сопоставление столбцов и т. д. Она выполняет эти операции на основе конфигурации входного набора данных, выходного набора данных и действия копирования.
3. Записывает данные в приемник или целевое хранилище данных.

![Общие сведения о действии копирования](media/copy-activity-overview/copy-activity-overview.png)

## <a name="supported-data-stores-and-formats"></a>Поддерживаемые хранилища данных и форматы

[!INCLUDE [data-factory-v2-supported-data-stores](../../includes/data-factory-v2-supported-data-stores.md)]

### <a name="supported-file-formats"></a>Поддерживаемые типы файлов

[!INCLUDE [data-factory-v2-file-formats](../../includes/data-factory-v2-file-formats.md)] 

Действие копирования можно использовать для копирования файлов "как есть" между двумя хранилищами данных на основе файлов. в этом случае данные копируются эффективно без сериализации или десериализации. Кроме того, можно выполнять синтаксический анализ или создание файлов определенного формата, например, можно выполнить следующие действия.

* Копирование данных из базы данных SQL Server и запись в Azure Data Lake Storage 2-го поколения в формате Parquet.
* Копирование файлов в текстовом формате (CSV) из локальной файловой системы и запись в хранилище BLOB-объектов Azure в формате Avro.
* Скопируйте ZIP-файлы из локальной файловой системы, распакуйте их в оперативном режиме и запишите извлеченные файлы в Azure Data Lake Storage 2-го поколения.
* Копирование данных в формате сжатого текста gzip (CSV) из хранилища BLOB-объектов Azure и их запись в базу данных SQL Azure.
* Многие другие действия, требующие сериализации, десериализации или сжатия и распаковки.

## <a name="supported-regions"></a>Поддерживаемые регионы

Служба, которая включает действие копирования, доступна глобально в регионах и географических областях, перечисленных в [расположениях среды выполнения интеграции Azure](concepts-integration-runtime.md#integration-runtime-location). Глобально доступная топология обеспечивает эффективное перемещение данных, обычно позволяя избежать "прыжков" по разным регионам. Ознакомьтесь с [продуктами по регионам](https://azure.microsoft.com/regions/#services) , чтобы проверить доступность фабрики данных и перемещения данных в определенном регионе.

## <a name="configuration"></a>Параметр Configuration

[!INCLUDE [data-factory-v2-connector-get-started](../../includes/data-factory-v2-connector-get-started.md)]

Как правило, для использования действия копирования в фабрике данных Azure необходимо выполнить следующие действия:

1. **Создайте связанные службы для исходного хранилища данных и приемника хранилища данных.** Список поддерживаемых соединителей можно найти в разделе [Поддерживаемые хранилища данных и форматы](#supported-data-stores-and-formats) этой статьи. Сведения о конфигурации и поддерживаемые свойства см. в разделе "Свойства связанной службы" статьи соединителя. 
2. **Создание наборов данных для источника и приемника.** Сведения о конфигурации и поддерживаемых свойствах см. в разделах "Свойства набора данных" статьи о соединителях источника и приемника.
3. **Создайте конвейер с действием копирования.** В следующем разделе приведен пример.

### <a name="syntax"></a>Синтаксис

Следующий шаблон действия копирования содержит полный список поддерживаемых свойств. Выберите свойства для своего сценария.

```json
"activities":[
    {
        "name": "CopyActivityTemplate",
        "type": "Copy",
        "inputs": [
            {
                "referenceName": "<source dataset name>",
                "type": "DatasetReference"
            }
        ],
        "outputs": [
            {
                "referenceName": "<sink dataset name>",
                "type": "DatasetReference"
            }
        ],
        "typeProperties": {
            "source": {
                "type": "<source type>",
                <properties>
            },
            "sink": {
                "type": "<sink type>"
                <properties>
            },
            "translator":
            {
                "type": "TabularTranslator",
                "columnMappings": "<column mapping>"
            },
            "dataIntegrationUnits": <number>,
            "parallelCopies": <number>,
            "enableStaging": true/false,
            "stagingSettings": {
                <properties>
            },
            "enableSkipIncompatibleRow": true/false,
            "redirectIncompatibleRowSettings": {
                <properties>
            }
        }
    }
]
```

#### <a name="syntax-details"></a>Сведения о синтаксисе

| Свойство | Описание: | Обязательно? |
|:--- |:--- |:--- |
| тип | Для действия копирования задайте значение`Copy` | Да |
| Ввод данных | Укажите созданный набор данных, указывающий на исходные данные. Действие копирования поддерживает только один вход. | Да |
| outputs | Укажите созданный набор данных, указывающий на данные приемника. Действие копирования поддерживает только один выход. | Да |
| typeProperties | Укажите свойства для настройки действия копирования. | Да |
| source | Укажите тип источника копирования и соответствующие свойства для получения данных.<br/>Дополнительные сведения см. в разделе "свойства действия копирования" статьи о соединителе, приведенном в статье [Поддерживаемые хранилища данных и форматы](#supported-data-stores-and-formats). | Да |
| sink | Укажите тип приемника копирования и соответствующие свойства для записи данных.<br/>Дополнительные сведения см. в разделе "свойства действия копирования" статьи о соединителе, приведенном в статье [Поддерживаемые хранилища данных и форматы](#supported-data-stores-and-formats). | Да |
| translator | Укажите явные сопоставления столбцов от источника к приемнику. Это свойство применяется, если поведение копирования по умолчанию не соответствует вашим потребностям.<br/>Дополнительные сведения см. [в разделе сопоставление схем в действии копирования](copy-activity-schema-and-type-mapping.md). | Нет |
| dataIntegrationUnits | Укажите меру, представляющую объем энергии, которую [Среда выполнения интеграции Azure](concepts-integration-runtime.md) использует для копирования данных. Эти единицы ранее назывались облачными единицами перемещения данных (эта мера). <br/>Дополнительные сведения см. в разделе [единицы интеграции данных](copy-activity-performance-features.md#data-integration-units). | Нет |
| parallelCopies | Укажите параллелизм, который будет использоваться действием копирования при считывании данных из источника и записи данных в приемник.<br/>Дополнительные сведения см. в разделе [Параллельное копирование](copy-activity-performance-features.md#parallel-copy). | Нет |
| охранная зона | Укажите, следует ли сохранять метаданные и списки ACL во время копирования данных. <br/>Дополнительные сведения см. в разделе [Сохранение метаданных](copy-activity-preserve-metadata.md). |Нет |
| enableStaging<br/>stagingSettings | Укажите, следует ли разместить промежуточные данные в хранилище BLOB-объектов вместо прямого копирования данных из источника в приемник.<br/>Сведения о полезных сценариях и сведениях о конфигурации см. в разделе [промежуточное копирование](copy-activity-performance-features.md#staged-copy). | Нет |
| enableSkipIncompatibleRow<br/>redirectIncompatibleRowSettings| Выберите способ управления несовместимыми строками при копировании данных из источника в приемник.<br/>Дополнительные сведения см. в разделе [отказоустойчивость](copy-activity-fault-tolerance.md). | нет |

## <a name="monitoring"></a>Наблюдение

Вы можете отслеживать выполнение действия копирования в фабрике данных Azure визуально и программно. Дополнительные сведения см. в разделе [мониторинг действия копирования](copy-activity-monitoring.md).

## <a name="incremental-copy"></a>Добавочное копирование

Фабрика данных позволяет постепенно копировать разностные данные из исходного хранилища данных в хранилище приемников. Дополнительные сведения см. в разделе [учебник. добавочное копирование данных](tutorial-incremental-copy-overview.md).

## <a name="performance-and-tuning"></a>Производительность и настройка

В процессе [мониторинга действия копирования](copy-activity-monitoring.md) отображается статистика производительности копирования для каждого выполненного действия. В разделе " [производительность и масштабируемость действия копирования](copy-activity-performance.md) " описываются ключевые факторы, влияющие на производительность перемещения данных с помощью действия копирования в фабрике данных Azure. В нем также перечислены значения производительности, наблюдаемые во время тестирования, и объясняется, как оптимизировать производительность действия копирования.

## <a name="resume-from-last-failed-run"></a>Возобновление после последнего неудачного запуска

Действие копирования поддерживает возобновление работы после последнего сбоя при копировании большого размера файлов "как есть" с двоичным форматом между файловыми хранилищами и сохранение иерархии папок или файлов из источника в приемник, например, для переноса данных из Amazon S3 в Azure Data Lake Storage 2-го поколения. Он применяется к следующим соединителям на основе файлов: [Amazon S3](connector-amazon-simple-storage-service.md), [BLOB-объект Azure](connector-azure-blob-storage.md), [Azure Data Lake Storage 1-го поколения](connector-azure-data-lake-store.md), [Azure Data Lake Storage 2-го поколения](connector-azure-data-lake-storage.md), [хранилище файлов Azure](connector-azure-file-storage.md), [Файловая система](connector-file-system.md), [FTP](connector-ftp.md), [Google Cloud Storage](connector-google-cloud-storage.md), [HDFS](connector-hdfs.md)и [SFTP](connector-sftp.md).

Вы можете использовать действие копирования возобновить с помощью следующих двух способов:

- **Повторная попытка уровня действия:** Вы можете задать число повторных попыток для действия копирования. Во время выполнения конвейера, если при выполнении этого действия копирования происходит сбой, следующая Автоматическая повторная попытка начнется с точки сбоя последней пробной версии.
- **Повторное выполнение из невыполненной операции:** После завершения выполнения конвейера можно также запустить повторное выполнение из действия Failed в представлении мониторинга пользовательского интерфейса ADF или программно. Если действие, завершившееся сбоем, является действием копирования, конвейер не будет повторно выполняться из этого действия, но также возобновится с точки сбоя предыдущего запуска.

    ![Копирование резюме](media/copy-activity-overview/resume-copy.png)

Обратите внимание на несколько моментов.

- Возобновление происходит на уровне файла. Если при копировании файла происходит сбой действия копирования, то при следующем запуске этот файл будет скопирован повторно.
- Чтобы возобновить работу должным образом, не изменяйте параметры действия копирования между повторными попытками.
- При копировании данных из Amazon S3, BLOB-объектов Azure, Azure Data Lake Storage 2-го поколения и облачного хранилища Google действие копирования можно возобновить с произвольного числа скопированных файлов. Хотя остальные соединители на основе файлов являются источниками, в настоящее время действие копирования поддерживает возобновление из ограниченного числа файлов, обычно в диапазоне десятков тысяч и зависит от длины путей к файлам. файлы, превышающие это число, будут повторно скопированы во время повтора.

Для других сценариев, чем копирование двоичных файлов, действие копирования запускается повторно с начала.

## <a name="preserve-metadata-along-with-data"></a>Сохранение метаданных и данных

При копировании данных из источника в приемник в таких сценариях, как Data Lake Migration, можно также сохранить метаданные и списки ACL вместе с данными с помощью действия копирования. Дополнительные сведения см. в разделе [Сохранение метаданных](copy-activity-preserve-metadata.md) .

## <a name="schema-and-data-type-mapping"></a>Сопоставление типов данных и схемы

Сведения о том, как действие копирования сопоставляет исходные данные с приемником, см. в разделе [схема и сопоставление типов данных](copy-activity-schema-and-type-mapping.md) .

## <a name="add-additional-columns-during-copy"></a>Добавить дополнительные столбцы во время копирования

Помимо копирования данных из исходного хранилища данных в приемник, можно также настроить для добавления дополнительных столбцов данных для копирования в приемник. Пример:

- При копировании из файлового источника Храните относительный путь к файлу в качестве дополнительного столбца для трассировки файла, из которого поступают данные.
- Добавьте столбец с выражением ADF, чтобы присоединить системные переменные ADF, такие как имя конвейера или идентификатор конвейера, или сохранить другое динамическое значение из выходных данных вышестоящего действия.
- Добавьте столбец со статическим значением в соответствии с требованиями к последовательному потреблению.

На вкладке Источник действия копирования можно найти следующую конфигурацию. 

![Добавление дополнительных столбцов в действие копирования](./media/copy-activity-overview/copy-activity-add-additional-columns.png)

>[!TIP]
>Эта функция работает с последней моделью набора данных. Если этот параметр не отображается в пользовательском интерфейсе, попробуйте создать новый набор данных.

Чтобы настроить его программно, добавьте `additionalColumns` свойство в источник действия копирования.

| Свойство. | Описание | Обязательное значение |
| --- | --- | --- |
| аддитионалколумнс | Добавьте дополнительные столбцы данных для копирования в приемник.<br><br>Каждый объект в `additionalColumns` массиве представляет дополнительный столбец. `name`Определяет имя столбца, а `value` указывает значение данных этого столбца.<br><br>Допустимые значения данных:<br>- **`$$FILEPATH`**— зарезервированная переменная указывает на сохранение относительного пути к папке, указанной в наборе данных, в файле исходного кода. Применяется к источнику, основанному на файлах.<br>- **Выражение**<br>- **Статическое значение** | Нет |

**Пример**.

```json
"activities":[
    {
        "name": "CopyWithAdditionalColumns",
        "type": "Copy",
        "inputs": [...],
        "outputs": [...],
        "typeProperties": {
            "source": {
                "type": "<source type>",
                "additionalColumns": [
                    {
                        "name": "filePath",
                        "value": "$$FILEPATH"
                    },
                    {
                        "name": "pipelineName",
                        "value": {
                            "value": "@pipeline().Pipeline",
                            "type": "Expression"
                        }
                    },
                    {
                        "name": "staticValue",
                        "value": "sampleValue"
                    }
                ],
                ...
            },
            "sink": {
                "type": "<sink type>"
            }
        }
    }
]
```

## <a name="fault-tolerance"></a>Отказоустойчивость

По умолчанию действие копирования прекращает копирование данных и возвращает ошибку, если строки исходных данных несовместимы со строками данных приемника. Чтобы выполнить копирование, можно настроить действие копирования, чтобы пропустить и записать несовместимые строки и скопировать только совместимые данные. Дополнительные сведения см. в разделе [отказоустойчивость действий копирования](copy-activity-fault-tolerance.md) .

## <a name="next-steps"></a>Дальнейшие шаги
Ознакомьтесь со следующими руководствами и примерами:

- [Копирование данных из одного расположения в другое в одной учетной записи хранилища BLOB-объектов Azure](quickstart-create-data-factory-dot-net.md)
- [Копирование данных из хранилища BLOB-объектов Azure в базу данных SQL Azure](tutorial-copy-data-dot-net.md)
- [Копирование данных из базы данных SQL Server в Azure](tutorial-hybrid-copy-powershell.md)
