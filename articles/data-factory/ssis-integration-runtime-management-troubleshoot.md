---
title: Устранение неполадок управления Integration Runtime SSIS
description: В этой статье содержатся рекомендации по устранению неполадок управления службами SSIS Integration Runtime (службы SSIS IR).
services: data-factory
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
author: chinadragon0515
ms.author: dashe
ms.reviewer: sawinark
manager: mflasko
ms.custom: seo-lt-2019
ms.date: 07/08/2019
ms.openlocfilehash: 52b1d93935e6428563c72361655893ffddf8a507
ms.sourcegitcommit: b5ff5abd7a82eaf3a1df883c4247e11cdfe38c19
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/09/2019
ms.locfileid: "74941867"
---
# <a name="troubleshoot-ssis-integration-runtime-management-in-azure-data-factory"></a>Устранение неполадок управления Integration Runtime SSIS в фабрике данных Azure

В этой статье содержатся рекомендации по устранению неполадок управления в Azure-SQL Server Integration Services (SSIS) Integration Runtime (IR), также известные как службы SSIS IR.

## <a name="overview"></a>Краткое описание

Если во время подготовки или отмены подготовки служб SSIS IR возникли какие-либо проблемы, вы увидите сообщение об ошибке на портале фабрики данных Microsoft Azure или ошибку, возвращенную командлетом PowerShell. Ошибка всегда отображается в формате кода ошибки с подробным сообщением об ошибке.

Если код ошибки — InternalServerError, служба имеет временные проблемы, и ее следует повторить позже. Если повторная попытка не помогает, обратитесь в службу поддержки фабрики данных Azure.

В противном случае три основные внешние зависимости могут вызвать ошибки: сервер базы данных SQL Azure или управляемый экземпляр, Пользовательский скрипт установки и конфигурацию виртуальной сети.

## <a name="azure-sql-database-server-or-managed-instance-issues"></a>Проблемы с сервером базы данных SQL Azure или управляемым экземпляром

Сервер базы данных SQL Azure или управляемый экземпляр требуется, если выполняется подготовка служб SSIS IR с базой данных каталога служб SSIS. Служба SSIS IR должна иметь доступ к серверу базы данных SQL Azure или к управляемому экземпляру. Кроме того, учетная запись сервера базы данных SQL Azure или управляемого экземпляра должна иметь разрешение на создание базы данных каталога служб SSIS (SSISDB). Если возникает ошибка, на портале фабрики данных будет отображатся код ошибки с подробным сообщением об исключении SQL. Используйте сведения из следующего списка для устранения неполадок с кодами ошибок.

### <a name="azuresqlconnectionfailure"></a>AzureSqlConnectionFailure

Эта проблема может возникать при подготовке нового SSIS IR или во время работы IR. Если эта ошибка возникла во время подготовки IR, вы можете получить подробное сообщение SqlException в сообщении об ошибке, указывающее на одну из следующих проблем:

* Проблема подключения в сети. Проверьте, доступно ли имя узла SQL Server или управляемого экземпляра. Также убедитесь, что брандмауэр или группа безопасности сети (NSG) не блокируют доступ к серверу служб SSIS IR.
* Ошибка входа при проверке подлинности SQL. Не удается войти в базу данных SQL Server с указанной учетной записью. Убедитесь, что указана правильная учетная запись пользователя.
* Ошибка входа в систему во время аутентификации Microsoft Azure Active Directory (Azure AD) (управляемое удостоверение). Добавьте управляемое удостоверение фабрики в группу AAD и убедитесь, что управляемое удостоверение имеет разрешения на доступ к серверу базы данных каталога.
* Истечение времени ожидания подключения. Эта ошибка всегда вызвана конфигурацией, связанной с безопасностью. Примите во внимание следующие рекомендации.
  1. Создайте новую виртуальную машину.
  1. Присоедините виртуальную машину к тому же виртуальная сеть Microsoft Azure IR, если IR находится в виртуальной сети.
  1. Установите SSMS и проверьте состояние сервера базы данных SQL Azure или управляемого экземпляра.

Для устранения других проблем, устраните проблему, отображаемую в подробном сообщении об ошибке исключения SQL. Если у вас по-прежнему возникают проблемы, обратитесь в службу поддержки сервера базы данных SQL Azure или управляемого экземпляра.

Если сообщение об ошибке отображается в процессе выполнения IR, то, скорее всего, изменение группы безопасности сети или брандмауэра препятствует доступу к серверу базы данных SQL Azure или управляемому экземпляру. Разблокируйте рабочий узел SSIS IR, чтобы он мог обращаться к серверу базы данных SQL Azure или к управляемому экземпляру.

### <a name="catalogcapacitylimiterror"></a>CatalogCapacityLimitError

Вот как может выглядеть этот тип сообщения об ошибке: "база данных SSISDB достигла квоты на размер". Разбейте или удаляйте данные, удалите индексы или обратитесь к документации, чтобы получить возможные решения ". 

Возможные решения:
* Увеличьте размер квоты SSISDB.
* изменение конфигурации SSISDB для уменьшения размера на:;
   * Уменьшение срока хранения и количества версий проекта.
   * Уменьшение срока хранения журнала.
   * Изменение уровня журнала по умолчанию.

### <a name="catalogdbbelongstoanotherir"></a>CatalogDbBelongsToAnotherIR

Эта ошибка означает, что сервер базы данных SQL Azure или управляемый экземпляр уже имеет SSISDB и используется другим IR. Необходимо либо указать другой сервер базы данных SQL Azure или управляемый экземпляр, либо удалить существующий SSISDB и перезапустить новый IR.

### <a name="catalogdbcreationfailure"></a>CatalogDbCreationFailure

Ошибка может быть вызвана одной из следующих причин:

* Учетная запись пользователя, настроенная для службы SSIS IR, не имеет разрешения на создание базы данных. Вы можете предоставить пользователю разрешение на создание базы данных.
* Время ожидания возникает во время создания базы данных, например время ожидания выполнения или время ожидания операции базы данных. Повторите операцию позже. Если повторное выполнение не работает, обратитесь к серверу базы данных SQL Azure или в службу поддержки Управляемого экземпляра.

Для устранения других проблем проверьте сообщение об ошибке исключения SQL и устраните проблему, упомянутую в сведениях об ошибке. Если у вас по-прежнему возникают проблемы, обратитесь в службу поддержки сервера базы данных SQL Azure или управляемого экземпляра.

### <a name="invalidcatalogdb"></a>InvalidCatalogDb

Этот вид сообщения об ошибке выглядит следующим образом: "Недопустимое имя объекта" Catalog. catalog_properties ". В этой ситуации у вас уже есть база данных SSISDB, но она не была создана службой SSIS IR, либо база данных находится в недопустимом состоянии, вызванном ошибками во время последней подготовки служб SSIS IR. Вы можете удалить существующую базу данных с именем SSISDB или настроить новый сервер базы данных SQL Azure или управляемый экземпляр для IR.

## <a name="custom-setup-issues"></a>Проблемы с настраиваемой установкой

Пользовательская настройка предоставляет интерфейс для добавления собственных шагов настройки во время подготовки или перенастройки SSIS IR. Дополнительные сведения см. в статье [Пользовательская настройка Azure-SSIS Integration Runtime](https://docs.microsoft.com/azure/data-factory/how-to-configure-azure-ssis-ir-custom-setup).

Убедитесь, что контейнер содержит только необходимые пользовательские файлы настройки; все файлы в контейнере будут загружены на рабочий узел службы SSIS IR. Мы рекомендуем протестировать пользовательский сценарий настройки на локальном компьютере чтобы исправить любые проблемы с выполнением сценария, прежде чем запускать сценарий в SSIS IR.

Контейнер сценария пользовательской настройки будет проверяться во время работы IR, потому что SSIS IR регулярно обновляется. Это обновление требует доступа к контейнеру для загрузки сценария пользовательской установки и его повторной установки. Процесс также проверяет, доступен ли контейнер и существует ли файл main.cmd.

Для любой ошибки, связанной с пользовательской настройкой, вы увидите код ошибки Кустомсетупскриптфаилуре с вспомогательным кодом, например Кустомсетупскриптблобконтаинеринакцессибле или Кустомсетупскриптнотфаунд.

### <a name="customsetupscriptblobcontainerinaccessible"></a>CustomSetupScriptBlobContainerInaccessible

Эта ошибка означает, что служба SSIS IR не может получить доступ к контейнеру BLOB-объектов Azure для пользовательской настройки. Убедитесь, что универсальный код доступа (URI) SAS контейнера доступен и срок его действия не истек.

Остановите IR, если она работает, перенастройте ее с помощью нового пользовательского универсального кода доступа (URI) SAS контейнера пользовательской настройки, а затем перезапустите IR.

### <a name="customsetupscriptnotfound"></a>CustomSetupScriptNotFound

Эта ошибка означает, что SSIS IR не может найти сценарий пользовательской настройки (main.cmd) в контейнере BLOB-объектов. Убедитесь, что main.cmd существует в контейнере, который является точкой входа для установки пользовательской настройки.

### <a name="customsetupscriptexecutionfailure"></a>CustomSetupScriptExecutionFailure

Эта ошибка означает, что не удалось выполнить сценарий пользовательской настройки (main.cmd). Сначала попробуйте выполнить сценарий на локальном компьютере или проверьте журналы выполнения пользовательской настройки в контейнере BLOB-объектов.

### <a name="customsetupscripttimeout"></a>CustomSetupScriptTimeout

Эта ошибка указывает на время ожидания выполнения сценария пользовательской настройки. Убедитесь, что скрипт можно выполнить без вмешательства пользователя, что не требуется интерактивный ввод, а также что контейнер больших двоичных объектов содержит только необходимые пользовательские файлы установки. Рекомендуем сначала протестировать сценарий на локальном компьютере. Кроме того, следует проверить журналы выполнения пользовательских настроек в контейнере BLOB-объектов. Максимальный период для пользовательской настройки составляет 45 минут, прежде чем истечет время ожидания. Он включает в себя время загрузки всех файлов из контейнера и установки их на SSIS IR. Если требуется более длительный период, создайте запрос в службу поддержки.

### <a name="customsetupscriptloguploadfailure"></a>CustomSetupScriptLogUploadFailure

Эта ошибка означает, что попытка передачи журналов выполнения пользовательской настройки в контейнер BLOB-объектов завершилась сбоем. Эта проблема возникает либо из-за того, что у SSIS IR нет прав на запись в контейнер BLOB-объектов, либо из-за проблем с хранилищем или сетью. Если пользовательская настройка прошла успешно, эта ошибка не повлияет ни на одну функцию SSIS, но журналы будут отсутствовать. Если пользовательская настройка завершается с другой ошибкой, а журнал не передается, сначала появится сообщение об этой ошибке, чтобы журнал можно было отправить для анализа. Кроме того, после устранения этой проблемы появятся сообщения о любых более конкретных проблемах. Если эта проблема не устранена после повторной попытки, обратитесь в техническую поддержку Фабрики данных Azure.

## <a name="virtual-network-configuration"></a>Конфигурация виртуальной сети

При присоединении SSIS IR к виртуальной сети Azure SSIS IR использует виртуальную сеть, входящую в подписку пользователя. Дополнительные сведения см. в статье [Присоединение среды выполнения интеграции Azure SSIS к виртуальной сети](https://docs.microsoft.com/azure/data-factory/join-azure-ssis-integration-runtime-virtual-network).

При возникновении проблемы, связанной с виртуальной сетью, отобразится одна из следующих ошибок.

### <a name="invalidvnetconfiguration"></a>InvalidVnetConfiguration

Эта ошибка может возникать по разным причинам. Сведения об устранении проблем см. в разделах [Запрещено](#forbidden), [InvalidPropertyValue](#invalidpropertyvalue) и [MisconfiguredDnsServerOrNsgSettings](#misconfigureddnsserverornsgsettings).

### <a name="forbidden"></a>Запрещено

Этот вид ошибки может выглядеть следующим образом: "SubnetId не включена для текущей учетной записи. Поставщик ресурсов Microsoft. Batch не зарегистрирован в той же подписке виртуальной сети ".

Эти сведения означают, что пакетная служба Azure не может получить доступ к виртуальной сети. Зарегистрируйте поставщика ресурсов Microsoft.Batch по той же подписке, что и виртуальная сеть.

### <a name="invalidpropertyvalue"></a>InvalidPropertyValue

Этот вид ошибки может выглядеть следующим образом: 

- Либо указанная виртуальная сеть не существует, либо Пакетная служба не имеет доступа к ней.
- "Указанная подсеть XXX не существует".

Эти ошибки означают, что виртуальная сеть не существует, пакетная служба Azure не может получить к ней доступ, или же указанная подсеть не существует. Убедитесь, что виртуальная сеть и подсеть существуют, и что пакетная служба Azure имеет к ним доступ.

### <a name="misconfigureddnsserverornsgsettings"></a>MisconfiguredDnsServerOrNsgSettings

Этот тип сообщения об ошибке может выглядеть следующим образом: "не удалось выполнить инициализацию Integration Runtime в виртуальной сети. Если параметры DNS-сервера или NSG настроены, убедитесь, что DNS-сервер доступен и NSG настроен правильно. "

В этой ситуации у вас, вероятно, есть настроенная конфигурация DNS-сервера или параметров NSG, которая предотвращает разрешение или доступ к имени сервера Azure, необходимого для службы SSIS IR. Дополнительные сведения см. в разделе [Конфигурация виртуальной сети SSIS IR](https://docs.microsoft.com/azure/data-factory/join-azure-ssis-integration-runtime-virtual-network). Если у вас по-прежнему возникают проблемы, обратитесь в службу поддержки Фабрики данных Azure.

### <a name="vnetresourcegrouplockedduringupgrade"></a>VNetResourceGroupLockedDuringUpgrade

Службы SSIS IR будут автоматически обновляться на регулярной основе. Во время обновления создается новый пул пакетной службы Azure, а старый удаляется. Кроме того, ресурсы, связанные с виртуальной сетью, для старого пула удаляются, а новые ресурсы, связанные с виртуальной сетью, создаются в подписке. Эта ошибка означает, что удаление ресурсов, связанных с виртуальной сетью, для старого пула завершилось сбоем из-за блокировки удаления на уровне подписки или группы ресурсов. Поскольку клиент контролирует и устанавливает блокировку удаления, в этой ситуации он должен удалить блокировку удаления.

### <a name="vnetresourcegrouplockedduringstart"></a>VNetResourceGroupLockedDuringStart

При сбое подготовки служб SSIS IR все созданные ресурсы удаляются. Однако при наличии блокировки удаления ресурса на уровне подписки или группы ресурсов, ресурсы виртуальной сети не удаляются должным образом. Чтобы устранить эту ошибку, удалите блокировку удаления и перезапустите IR.

### <a name="vnetresourcegrouplockedduringstop"></a>VNetResourceGroupLockedDuringStop

При остановке служб SSIS IR все ресурсы, связанные с виртуальной сетью, удаляются. Но удаление может завершиться ошибкой, если на уровне подписки или группы ресурсов имеется блокировка удаления ресурса. Здесь клиент также управляет и устанавливает блокировку удаления. Поэтому он должен удалить блокировку удаления, а затем еще раз остановить службу SSIS IR.

### <a name="nodeunavailable"></a>NodeUnavailable

Эта ошибка возникает, когда при выполнении IR, и значит, что IR стала неработоспособной. Эта ошибка всегда вызвана изменением DNS-сервера или конфигурации NSG, которое блокирует подключение служб SSIS IR к необходимой службе. Поскольку настройка DNS-сервера и NSG контролируется клиентом, клиент должен устранить блокирующие проблемы на их стороне. Дополнительные сведения см. в разделе [Конфигурация виртуальной сети SSIS IR](https://docs.microsoft.com/azure/data-factory/join-azure-ssis-integration-runtime-virtual-network). Если у вас по-прежнему возникают проблемы, обратитесь в службу поддержки Фабрики данных Azure.

## <a name="static-public-ip-addresses-configuration"></a>Конфигурация статических общедоступных IP-адресов

При присоединении Azure-SSIS IR к виртуальной сети Azure вы также можете использовать собственные статические общедоступные IP-адреса для IR, чтобы обеспечить доступ к источникам данных, которые ограничивают доступ к конкретным IP-адресам. Дополнительные сведения см. в статье [Присоединение среды выполнения интеграции Azure SSIS к виртуальной сети](https://docs.microsoft.com/azure/data-factory/join-azure-ssis-integration-runtime-virtual-network).

Помимо описанных выше проблем, связанных с виртуальной сетью, вы также можете удовлетворить проблемы, связанные со статическими общедоступными IP-адресами. Ознакомьтесь со следующими ошибками для получения справки.

### <a name="InvalidPublicIPSpecified"></a>инвалидпублиЦипспеЦифиед

Эта ошибка может возникать по различным причинам при запуске Azure-SSIS IR.

| Сообщение об ошибке | Решение|
|:--- |:--- |
| Указанный статический общедоступный IP-адрес уже используется, укажите для Azure-SSIS Integration Runtime два неиспользуемых. | Следует выбрать два неиспользуемых статических общедоступных IP-адреса или удалить текущие ссылки на указанный общедоступный IP-адрес, а затем перезапустить Azure-SSIS IR. |
| Указанный статический общедоступный IP-адрес не имеет DNS-имени, укажите два из них с DNS-именем для Azure-SSIS Integration Runtime. | Вы можете настроить DNS-имя общедоступного IP-адреса в портал Azure, как показано на рисунке ниже. Ниже приведены конкретные действия. (1) откройте портал Azure и перейдите на страницу ресурсов этого общедоступного IP-адреса. (2) выберите раздел **Конфигурация** и настройте DNS-имя, а затем нажмите кнопку **сохранить** . (3) Перезапустите Azure-SSIS IR. |
| Указанные виртуальные сети и статические общедоступные IP-адреса для Azure-SSIS Integration Runtime должны находиться в одном расположении. | В соответствии с требованиями сети Azure статический общедоступный IP-адрес и виртуальная сеть должны находиться в одном расположении и подписке. Укажите два допустимых статических общедоступных IP-адреса и перезапустите Azure-SSIS IR. |
| Предоставленный статический общедоступный IP-адрес является базовым. Укажите для Azure-SSIS Integration Runtime два стандартных уровня. | Дополнительные сведения см. в разделе [номера SKU общедоступного IP-адреса](https://docs.microsoft.com/azure/virtual-network/virtual-network-ip-addresses-overview-arm#sku) . |

![Azure SSIS IR](media/ssis-integration-runtime-management-troubleshoot/setup-publicipdns-name.png)

### <a name="publicipresourcegrouplockedduringstart"></a>публиЦипресаурцеграуплоккеддурингстарт

В случае сбоя подготовки Azure-SSIS IR удаляются все созданные ресурсы. Однако при наличии блокировки удаления ресурса в подписке или группе ресурсов (которая содержит статический общедоступный IP-адрес) сетевые ресурсы не удаляются должным образом. Чтобы устранить эту ошибку, удалите блокировку удаления и перезапустите IR.

### <a name="publicipresourcegrouplockedduringstop"></a>публиЦипресаурцеграуплоккеддурингстоп

При отмене Azure-SSIS IR все сетевые ресурсы, созданные в группе ресурсов, содержащей общедоступный IP-адрес, будут удалены. Но удаление может завершиться ошибкой, если в подписке или группе ресурсов (которая содержит статический общедоступный IP-адрес) имеется блокировка удаления ресурса. Удалите блокировку удаления и перезапустите IR.

### <a name="publicipresourcegrouplockedduringupgrade"></a>публиЦипресаурцеграуплоккеддурингупграде

Azure-SSIS IR автоматически обновляется на регулярной основе. Новые узлы IR создаются во время обновления, и старые узлы будут удалены. Кроме того, будут удалены созданные сетевые ресурсы (например, подсистема балансировки нагрузки и группа безопасности сети) для старых узлов, а новые сетевые ресурсы будут созданы в подписке. Эта ошибка означает, что удаление сетевых ресурсов для старых узлов завершилось сбоем из-за блокировки удаления в подписке или группе ресурсов (которая содержит статический общедоступный IP-адрес). Удалите блокировку удаления, чтобы можно было очистить старые узлы и освободить статические общедоступные IP-адреса для старых узлов. В противном случае не удается освободить статический общедоступный IP-адрес, и мы не можем дальше обновлять IR.

### <a name="publicipnotusableduringupgrade"></a>публиЦипнотусабледурингупграде

Если вы хотите использовать собственные статические общедоступные IP-адреса, необходимо предоставить два общедоступных IP-адреса. Один из них будет использоваться для немедленного создания ИНФРАКРАСных узлов, и он будет использоваться при обновлении IR. Эта ошибка может возникать, когда другой общедоступный IP-адрес непригоден для использования во время обновления. Возможные причины см. в [инвалидпублиЦипспеЦифиед](#InvalidPublicIPSpecified) .