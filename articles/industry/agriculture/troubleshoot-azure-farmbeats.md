---
title: Устранение неполадок в Azure FarmBeats
description: В этой статье описывается, как устранять неполадки в Azure FarmBeats.
author: uhabiba04
ms.topic: article
ms.date: 11/04/2019
ms.author: v-umha
ms.openlocfilehash: dd0ed78c56e4d656a2ecee6395d831ed093e85b5
ms.sourcegitcommit: a43a59e44c14d349d597c3d2fd2bc779989c71d7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/25/2020
ms.locfileid: "96001615"
---
# <a name="troubleshoot-azure-farmbeats"></a>Устранение неполадок в Azure FarmBeats

В этой статье приводятся решения по устранению распространенных проблем Azure FarmBeats. Для получения дополнительной помощи обратитесь к нашему [&форуму поддержки](/answers/topics/azure-farmbeats.html) или отправьте нам письмо по адресу farmbeatssupport@microsoft.com .

> [!NOTE]
  > Если вы установили FarmBeats в течение апреля и задания завершаются сбоем с пустым сообщением об ошибке, возможно, вашей установке не выделена квота пакетной службы для назначения приоритета поддержки для критически важных организаций по охране здоровья и безопасности. Дополнительные сведения см. в [этом разделе](https://azure.microsoft.com/blog/update-2-on-microsoft-cloud-services-continuity/) . Для успешного выполнения заданий потребуется отправить запрос на выделение виртуальных машин для учетной записи пакетной службы.

## <a name="install-issues"></a>Проблемы с установкой

  > [!NOTE]
  > При перезапуске установки из-за ошибки обязательно удалите **группу ресурсов** или все ресурсы из группы ресурсов, прежде чем повторно запускать установку.

### <a name="invalid-sentinel-credentials"></a>Недопустимые учетные данные Sentinel

В процессе установки были предоставлены неправильные учетные данные Sentinel. Перезапустите установку, указав правильные учетные данные.

### <a name="the-regional-account-quota-of-batch-accounts-for-the-specified-subscription-has-been-reached"></a>Достигнута квота региональной учетной записи пакетной службы для указанной подписки

Увеличьте квоту или удалите неиспользуемые учетные записи пакетной службы и перезапустите установку.

### <a name="invalid-resource-group-location"></a>Недопустимое расположение группы ресурсов

Убедитесь, что **группа ресурсов** находится в том же расположении, что и **регион**, указанный во время установки.

### <a name="other-install-issues"></a>Другие проблемы с установкой

Обратитесь к нам, предоставив указанные ниже сведения.

- Идентификатор подписки
- Имя группы ресурсов
- Чтобы вложить файл журнала со сведениями о сбое развертывания, выполните указанные ниже действия.

    1. На портале Azure перейдите к **группе ресурсов**.

    2. В разделе **Параметры** слева выберите **Развертывания**.

    3. Для каждого развертывания, значение состояние которого отображается как **Сбой**, просмотрите информацию и скачайте сведения о развертывании. Вложите этот файл в письмо и отправьте.

## <a name="sensor-telemetry"></a>Телеметрия от датчика

### <a name="cant-view-telemetry-data"></a>Не удается просмотреть данные телеметрии

**Признак**. Развернуты устройства или датчики, и вы связали FarmBeats со своим партнером по устройствам, однако вы не получаете данные телеметрии от FarmBeats или не можете просмотреть их.

**Корректирующее действие**

1. Перейдите к группе ресурсов Фармбеатс.
2. Выберите пространство имен **концентратора событий** ("датчик-партнер-EH-пространство имен-XXXX"), щелкните "концентраторы событий", а затем проверьте количество входящих сообщений в концентраторе событий, назначенном участнику.
3. Выполните одно из приведенных ниже действий.

   - Если *входящих сообщений нет*, обратитесь к партнеру по устройствам.  
   - Если *входящие сообщения есть*, обратитесь к нам, предоставив журналы Datahub и Accelerator, а также захваченные данные телеметрии.

Сведения о том, как скачать журналы, представлены в разделе [Сбор журналов вручную](#collect-logs-manually).  

### <a name="cant-view-telemetry-data-after-ingesting-historicalstreaming-data-from-your-sensors"></a>Не удается просмотреть данные телеметрии после приема исторических и потоковых данных от датчиков

**Признак**. Устройства или датчики развернуты, вы создали устройства/датчики FarmBeats и приняли данные телеметрии в концентраторе событий, однако вам не удается получить или просмотреть данные телеметрии FarmBeats.

**Корректирующее действие**

1. Убедитесь, что вы правильно зарегистрировали партнера. Для этого перейдите в Datahub Swagger, выберите Partner API (API партнера), затем нажмите Get (Получить) и проверьте, зарегистрирован ли партнер. Если партнер не зарегистрирован, выполните [эти](get-sensor-data-from-sensor-partner.md#enable-device-integration-with-farmbeats) действия, чтобы добавить партнера.

2. Убедитесь, что вы использовали правильный формат сообщения телеметрии:

```json
{
"deviceid": "<id of the Device created>",
"timestamp": "<timestamp in ISO 8601 format>",
"version" : "1",
"sensors": [
    {
      "id": "<id of the sensor created>",
      "sensordata": [
        {
          "timestamp": "< timestamp in ISO 8601 format >",
          "<sensor measure name (as defined in the Sensor Model)>":<value>
        },
        {
          "timestamp": "<timestamp in ISO 8601 format>",
          "<sensor measure name (as defined in the Sensor Model)>": <value>
        }
      ]
    }
 ]
}
```

### <a name="dont-have-the-azure-event-hubs-connection-string"></a>Нет строки подключения Центров событий Azure

**Корректирующее действие**

1. В Datahub Swagger выберите Partner API (API партнера).
2. Выберите **Get** (Получить) > **Try it out** (Попробовать) > **Execute** (Выполнить).

> [!NOTE]
> Идентификатор партнера, предоставляющего данные датчика.

3. Вернитесь к API-партнеру и выберите **Get/ \<ID>**.
4. Укажите идентификатор партнера из шага 3, а затем выберите **Execute** (Выполнить).

   Ответ API должен содержать строку подключения Центров событий Azure.

### <a name="device-appears-offline"></a>Устройство отображается как "не в сети"

**Проблема.** Устройства установлены, и вы связали FarmBeats со своим партнером по устройствам. Устройства включены и отправляют данные телеметрии, однако они отображаются как "не в сети".

**Корректирующее действие**. Для этого устройства не настроен период создания отчетов. Чтобы задать период создания отчетов, обратитесь к изготовителю устройства. 

### <a name="error-deleting-a-device"></a>Ошибка при удалении устройства

При удалении устройства может возникнуть одна из следующих распространенных ошибок.  

**Сообщение**. "На устройство имеются ссылки в датчиках. С устройством связан один или несколько датчиков. Удалите датчики, а затем удалите устройство".  

**Значение**. Устройство связано с несколькими датчиками, развернутыми в ферме.

**Корректирующее действие**  

1. Удалите датчики, связанные с устройством с помощью Accelerator.  
2. Чтобы связать датчики с другим устройством, попросите партнера по устройствам сделать то же самое.  
3. Удалите устройство с помощью вызова `DELETE API` и задайте для параметра Force значение *true*.  

**Сообщение**. "Устройство ссылается на устройства как ParentDeviceId. С этим устройством связано одно или несколько устройств в качестве дочерних устройств. Удалите их, а затем это устройство".  

**Значение**. С устройством связаны другие устройства.  

**Корректирующее действие**

1. Удалите устройства, связанные с этим устройством.  
2. Удалите определенное устройство.  

    > [!NOTE]
    > Если с устройством связаны датчики, удалить его не удастся. Дополнительные сведения об удалении связанных датчиков см. в разделе **Удаление датчика** статьи [Получение данных датчиков от партнеров по датчикам](get-sensor-data-from-sensor-partner.md).
    > У партнеров нет разрешения на удаление устройства или датчика. Удалять устройства могут только администраторы.

## <a name="issues-with-jobs"></a>Проблемы с заданиями

### <a name="farmbeats-internal-error"></a>Внутренняя ошибка FarmBeats

**Сообщение**. "Внутренняя ошибка FarmBeats. Подробнее см. в руководстве по устранению неполадок".

**Корректирующее действие**. Эта проблема может возникать из-за временного сбоя в конвейере данных. Создайте задание снова. Если ошибка по-прежнему возникает, свяжитесь с нами, предоставив сообщение об ошибке или журналы.

## <a name="accelerator-troubleshooting"></a>Устранение неполадок Accelerator

### <a name="access-control"></a>Управление доступом

**Проблема**. При добавлении назначения роли появляется сообщение об ошибке.

**Сообщение**. "Нет соответствующих пользователей".

**Корректирующее действие**. Проверьте адрес электронной почты, для которого вы пытаетесь добавить назначение ролей. Он должен точно совпадать с адресом электронной почты, зарегистрированным для этого пользователя в Active Directory. Если ошибка по-прежнему возникает, свяжитесь с нами, предоставив сообщение об ошибке или журналы.

### <a name="unable-to-log-in-to-accelerator"></a>Не удается войти в Accelerator

**Сообщение**. "Ошибка: У вас нет разрешения на вызов службы. Обратитесь к администратору для авторизации".

**Корректирующее действие**. Обратитесь к администратору с просьбой авторизовать для вас доступ к развертыванию FarmBeats. Это можно сделать, выполнив запрос POST из API RoleAssignment или с помощью области управления доступом на панели **Параметры** в Accelerator.  

Если вам уже предоставлен доступ и вы столкнулись с этой ошибкой, повторите попытку, обновив страницу. Если ошибка по-прежнему возникает, свяжитесь с нами, предоставив сообщение об ошибке или журналы.

![Снимок экрана, на котором показана ошибка авторизации.](./media/troubleshoot-azure-farmbeats/accelerator-troubleshooting-1.png)

### <a name="accelerator-issues"></a>Проблемы Accelerator  

**Проблема**. Получено сообщение об ошибке Accelerator неопределенной причины.

**Сообщение**. "Ошибка: Произошла неизвестная ошибка".

**Корректирующее действие**. Эта ошибка возникает, если страница неактивна слишком длительное время. Обновите страницу. Если ошибка по-прежнему возникает, свяжитесь с нами, предоставив сообщение об ошибке или журналы.

**Проблема**. FarmBeats Accelerator не отображает последнюю версию даже после обновления FarmBeatsDeployment.

**Корректирующее действие**. Эта ошибка возникает из-за сохранения служебного сценария в браузере. Выполните следующие действия.

1. Закройте все вкладки браузера, в которых открыт Accelerator, и закройте окно браузера.
2. Запустите новый экземпляр браузера и перезагрузите универсальный код ресурса (URI) Accelerator. Это действие позволит загрузить новую версию Accelerator.

## <a name="sentinel-imagery-related-issues"></a>Sentinel: проблемы, связанные с изображениями

### <a name="wrong-username-or-password"></a>Неправильное имя пользователя или пароль

**Сообщение об ошибке задания**. "Для доступа к этому ресурсу требуется полная проверка подлинности".

**Корректирующее действие**. Выполните одно из следующих действий.

- Обновите FarmBeats, указав правильное имя пользователя и пароль с помощью приведенных ниже действий, и повторите задание.

  **Обновление имени пользователя Sentinel**

    1. Войдите на [портал Azure](https://portal.azure.com).
    2. В поле **Поиск** найдите группу ресурсов FarmBeats Datahub.
    3. Выберите хранилище учетных записей хранения ***** > **Контейнеры** > **batch-prep-files** > **to_vm** > **config.ini**
    4. Выберите **Изменить**
    5. Обновление имени пользователя в разделе sentinel_account

  **Обновление пароля Sentinel**

    1. Войдите на [портал Azure](https://portal.azure.com).
    2. В поле **Поиск** найдите группу ресурсов FarmBeats Datahub.
    3. Выберите keyvault-*****
    4. В разделе "Параметры" выберите "Политики доступа"
    5. Нажмите **Добавить политику доступа**
    6. Воспользуйтесь параметром **Управление секретами** для настройки из шаблона и добавления себя к субъекту
    7. Выберите **Добавить**, а затем **Сохранить** на странице **Политики доступа**
    8. В разделе **Параметры** выберите **Секреты**
    9. Выберите **Sentinel-Password**
    10. Создайте новую версию значения и включите ее.

- Перезапустите задание, которое завершилось сбоем, или выполните задание вспомогательных индексов для диапазона дат от 5 до 7 дней, а затем проверьте, успешно ли выполнено это задание.

### <a name="sentinel-hub-wrongurlor-site-not-accessible"></a>Концентратор Sentinel: неправильный URL-адрес или сайт недоступен

**Сообщение об ошибке задания**. "Проблема! Что-то пошло не так. Запрашиваемая страница (временно) недоступна".

**Корректирующее действие**.

1. Откройте [Sentinel](https://scihub.copernicus.eu/dhus/) в браузере, чтобы узнать, доступен ли веб-сайт.
2. Если веб-сайт недоступен, проверьте, не блокирует брандмауэр, сеть компании или другое программное обеспечение доступ к веб-сайту, а затем выполните необходимые действия, чтобы разрешить URL-адрес Sentinel. 
3. Перезапустите задание, которое завершилось сбоем, или выполните задание вспомогательных индексов для диапазона дат от 5 до 7 дней, а затем проверьте, успешно ли выполнено это задание.  

### <a name="sentinel-server-down-for-maintenance"></a>Сервер Sentinel: выключен для проведения технического обслуживания

**Сообщение об ошибке задания**. "Работа Copernicus Open Access Hub будет возобновлена в ближайшее время! В данный момент выполняются работы по техническому обслуживанию. Приносим извинения за неудобства. Работа сервера будет возобновлена в ближайшее время!" 

**Корректирующее действие**.

Эта проблема может возникать, если на сервере Sentinel выполняются работы по техническому обслуживанию.

1. Если выполнение какого-либо задания или конвейера завершится сбоем ввиду технического обслуживания, повторно отправьте задание через некоторое время. 

   Сведения о плановых или незапланированных работах по техническому обслуживанию Sentinel см. на странице [Новости Copernicus Open Access Hub](https://scihub.copernicus.eu/news/).  

2. Перезапустите задание, которое завершилось сбоем, или выполните задание вспомогательных индексов для диапазона дат от 5 до 7 дней, а затем проверьте, успешно ли выполнено это задание.

### <a name="sentinel-maximum-number-of-connections-reached"></a>Sentinel: достигнуто максимальное количество подключений

**Сообщение об ошибке задания**: "максимальное число одновременных потоков, достигнутых пользователем" \<username> ".

**Значение**. Если задание завершается сбоем из-за достижения максимального количества подключений, это означает, что одна и та же учетная запись Sentinel используется в нескольких заданиях.

**Корректирующее действие**. Попробуйте выполнить одно из следующих действий.

* Дождитесь завершения других заданий, прежде чем повторно запустить задание, завершившееся сбоем.
* Создайте новую учетную запись Sentinel, а затем обновите имя пользователя и пароль Sentinel в FarmBeats.

### <a name="sentinel-server-refused-connection"></a>Сервер Sentinel: отказано в подключении

**Сообщение об ошибке задания**. "Сервер отклонил подключение по адресу: http://172.30.175.69:8983/solr/dhus".

**Корректирующее действие**. Эта проблема может возникать, если на сервере Sentinel выполняются работы по техническому обслуживанию.

1. Если выполнение какого-либо задания или конвейера завершится сбоем ввиду технического обслуживания, повторно отправьте задание через некоторое время.

   Сведения о плановых или незапланированных работах по техническому обслуживанию Sentinel см. на странице [Новости Copernicus Open Access Hub](https://scihub.copernicus.eu/news/).  

2. Перезапустите задание, которое завершилось сбоем, или выполните задание вспомогательных индексов для диапазона дат от 5 до 7 дней, а затем проверьте, успешно ли выполнено это задание.

### <a name="soil-moisture-map-has-white-areas"></a>На карте влажности почвы имеются белые области

**Проблема**. **Карта влажности почвы** была создана, однако она по большей части состоит из белых областей.

**Корректирующее действие**. Эта проблема может возникать, если вспомогательные индексы, формируемые для времени, для которого была запрошена карта, имеют значения NDVI меньше 0,3. Дополнительные сведения см. в [техническом руководстве от Sentinel](https://earth.esa.int/web/sentinel/technical-guides/sentinel-2-msi/level-2a/algorithm).

1. Повторно запустите задание для другого диапазона дат и проверьте, не превышает ли значение NDVI во вспомогательных индексах число 0,3.

## <a name="collect-logs-manually"></a>Сбор журналов вручную

[Установите и разверните Обозреватель службы хранилища Azure]( https://docs.microsoft.com/azure/vs-azure-tools-storage-manage-with-storage-explorer?tabs=windows).

### <a name="collect-azure-data-factory-job-logs-or-app-service-logs-in-datahub"></a>Сбор журналов заданий Фабрики данных Azure или журналов Службы приложений Azure в Datahub

1. Войдите на [портал Azure](https://portal.azure.com).
2. В поле **Поиск** найдите группу ресурсов FarmBeats Datahub.
3. На панели мониторинга **Группа ресурсов** найдите учетную запись хранения *datahublogs\** . Например, *datahublogsmvxmq*.  
4. В столбце **Имя** выберите учетную запись хранения, чтобы просмотреть панель мониторинга **Учетная запись хранения**.
5. На **панели датахубблогс \* *_ Выберите _* Open in Explorer (открыть в проводнике),** чтобы просмотреть **открытое приложение обозреватель службы хранилища Azure** .
6. В области слева выберите **Контейнеры больших двоичных объектов**, а затем выберите **job-logs** для журналов Фабрики данных Azure или **appinsights-logs** для журналов Службы приложений Azure.
7. Выберите **Скачать** и скачайте журналы в локальную папку на компьютере.

    ![Снимок экрана, на котором показаны Скачанные файлы журнала.](./media/troubleshoot-azure-farmbeats/collecting-logs-manually-1.png)

### <a name="collect-azure-data-factory-job-logs-or-app-service-logs-for-accelerator"></a>Сбор журналов заданий Фабрики данных Azure или журналов Службы приложений Azure для Accelerator

1. Войдите на [портал Azure](https://portal.azure.com).
2. В поле **Поиск** найдите группу ресурсов FarmBeats Accelerator.
3. На панели мониторинга **Группа ресурсов** найдите учетную запись хранения *storage\** . Например, *storagedop4k\** .
4. В столбце **Имя** выберите учетную запись хранения, чтобы просмотреть панель мониторинга **Учетная запись хранения**.
5. В **области Storage \* *_ (хранилище) выберите _* открыть в проводнике** , чтобы открыть приложение обозреватель службы хранилища Azure.
6. В области слева выберите **Контейнеры больших двоичных объектов**, а затем выберите **job-logs** для журналов Фабрики данных Azure или **appinsights-logs** для журналов Службы приложений Azure.
7. Выберите **Скачать** и скачайте журналы в локальную папку на компьютере.

## <a name="high-cpu-usage"></a>Высокая загрузка ЦП

**Ошибка**. Получено оповещение по электронной почте, в котором сообщается о **высокой загрузке ЦП**.

**Корректирующее действие**.

1. Перейдите в группу ресурсов FarmBeats Datahub.
2. Выберите **Службу приложений Azure**.  
3. Перейдите на [страницу расценок на Службу приложений,](https://azure.microsoft.com/pricing/details/app-service/windows/), а затем выберите соответствующую ценовую категорию.

## <a name="weather-data-job-failures"></a>Сбои заданий с данными о погоде

**Ошибка**: вы запускаете задания для получения данных о погоде, но задание завершается ошибкой

### <a name="collect-logs-to-troubleshoot-weather-data-job-failures"></a>Получение журналов для устранения ошибок заданий в погодных данных

1. Перейдите к группе ресурсов Фармбеатс в портал Azure.
2. Щелкните службу фабрики данных, которая является частью группы ресурсов. У службы будет тег "SKU: Датахуб"

> [!NOTE]
> Чтобы просмотреть теги служб в группе ресурсов, щелкните "изменить столбцы" и добавьте "Теги" в представление группы ресурсов.

:::image type="content" source="./media/troubleshoot-Azure-farmbeats/weather-log-1.png" alt-text="Снимок экрана, на котором выделен тег SKU: Датахуб.":::

3. На странице "Обзор" фабрики данных щелкните " **создать и отслеживать**". В браузере откроется новая вкладка. Щелкните **монитор**

:::image type="content" source="./media/troubleshoot-Azure-farmbeats/weather-log-2.png" alt-text="Снимок экрана, посвященный пункту меню &quot;монитор&quot;.":::

4. Вы увидите список запусков конвейеров, которые являются частью выполнения задания weather. Щелкните задание, для которого требуется получить журналы.
 
:::image type="content" source="./media/troubleshoot-Azure-farmbeats/weather-log-3.png" alt-text="Снимок экрана, посвященный пункту меню выполнения конвейера и выбранному заданию.":::

5. На странице Обзор конвейера вы увидите список запусков действий. Запишите идентификаторы запуска действий, для которых необходимо вести журнал.
 
:::image type="content" source="./media/troubleshoot-Azure-farmbeats/weather-log-4.png" alt-text="Снимок экрана, на котором показан список запусков действий.":::

6. Вернитесь в группу ресурсов Фармбеатс в портал Azure и щелкните учетную запись хранения с именем **датахублогс-XXXX** .
 
:::image type="content" source="./media/troubleshoot-Azure-farmbeats/weather-log-5.png" alt-text="Снимок экрана, на котором показана учетная запись хранения с именем датахублогс-XXXX.":::

7. Щелкните **контейнеры**  ->  **adfjobs**. В поле поиска введите идентификатор запуска задания, записанный на шаге 5 выше.
 
:::image type="content" source="./media/troubleshoot-Azure-farmbeats/weather-log-6.png" alt-text="Проект FarmBeats":::

8. Результат поиска будет содержать папку с журналами, относящимися к заданию. Скачайте журналы и отправьте их farmbeatssupport@microsoft.com для получения помощи в отладке проблемы.