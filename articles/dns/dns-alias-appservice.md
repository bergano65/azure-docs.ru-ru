---
title: Размещение веб-приложений Azure с балансировкой нагрузки на вершине зоны
description: Размещение веб-приложений с балансировкой нагрузки на вершине зоны с использованием записи псевдонима Azure DNS
services: dns
author: vhorne
ms.service: dns
ms.topic: article
ms.date: 11/3/2018
ms.author: victorh
ms.openlocfilehash: 2b14753237e118540da6306fa9f06816f3e58b71
ms.sourcegitcommit: 1fc949dab883453ac960e02d882e613806fabe6f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/03/2018
ms.locfileid: "50980376"
---
# <a name="host-load-balanced-azure-web-apps-at-the-zone-apex"></a>Размещение веб-приложений Azure с балансировкой нагрузки на вершине зоны

Протокол DNS запрещает назначение записей, отличных от A или AAAA, в апексе зоны. Пример вершины зоны — contoso.com. Это ограничение создает проблемы владельцам приложений, которые размещают приложения с балансировкой нагрузки за диспетчером трафика. Ссылаться на профиль диспетчера трафика из записи апекса зоны невозможно. В результате владельцам приложений необходимо использовать обходной путь. Перенаправление на прикладном уровне должно осуществляться из апекса зоны в другой домен. Например, перенаправление из contoso.com в www.contoso.com. Это упорядочение дает точку сбоя для функции переадресации.

С помощью записей псевдонимов эта проблема устранена. Теперь владельцы приложений могут направить свои записи в апексе зоны на профиль диспетчера трафика, который имеет внешние конечные точки. Владельцы приложений могут указывать на тот же профиль диспетчера трафика, который используется для любого другого домена в их зоне DNS.

Например, contoso.com и www.contoso.com могут оба указывать на один и тот же профиль диспетчера трафика. Это происходит до тех пор, пока профиль диспетчера трафика будет содержать только настроенные внешние конечные точки.

В этой статье вы узнаете, как создавать записи псевдонима для вершины домена и настраивать конечные точки профиля диспетчера трафика для веб-приложений.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

Необходимо иметь доступное имя домена, который можно будет разместить в Azure DNS и использовать для тестирования. У вас должен быть полный контроль над этим доменом, включая возможность определять записи сервера имен (NS) для домена.

Инструкции по размещению домена в Azure DNS см. в [руководстве по размещению домена в Azure DNS](dns-delegate-domain-azure-dns.md).

В качестве примера в этом руководстве используется домен contoso.com — замените его на собственное доменное имя.

## <a name="create-a-resource-group"></a>Создание группы ресурсов

Создайте группу ресурсов, в которой будут содержаться все ресурсы, используемые в статье.

## <a name="create-app-service-plans"></a>Создание планов службы приложений

Создайте два плана службы веб-приложений в группе ресурсов, используя следующую таблицу со сведениями о конфигурации. Дополнительные сведения о создании плана службы приложений см. в статье [Управлением планом службы приложений в Azure](../app-service/app-service-plan-manage.md).


|ИМЯ  |Операционная система  |Расположение  |Ценовая категория  |
|---------|---------|---------|---------|
|ASP-01     |Windows|Восточная часть США|D1-Shared (среда разработки и тестирования)|
|ASP-02     |Windows|Центральный регион США|D1-Shared (среда разработки и тестирования)|

## <a name="create-app-services"></a>Создание служб приложений

Создайте два веб-приложения, по одному в каждом плане службы приложений.

1. В верхнем левом углу окна портала Azure выберите **Создать ресурс**.
2. Введите **веб-приложение** в строке поиска и нажмите клавишу ВВОД.
3. Нажмите кнопку **Веб-приложение**.
4. Нажмите кнопку **Создать**.
5. Примите значения по умолчанию и воспользуйтесь следующей таблицей, чтобы настроить два веб-приложения:

   |ИМЯ<br>(должно быть уникальным в пределах .azurewebsites.net)|Группа ресурсов |Расположение или план службы приложений
   |---------|---------|---------|
   |App-01|Использовать имеющееся<br>Выберите группу ресурсов|ASP-01 (восточная часть США)|
   |App-02|Использовать имеющееся<br>Выберите группу ресурсов|ASP-02 (центральная часть США)|

### <a name="gather-some-details"></a>Сбор некоторых сведений

Теперь необходимо отметить IP-адреса и имя узла для приложений.

1. Откройте группу ресурсов и щелкните первое приложение (в этом примере —**App-01**).
2. В левой колонке щелкните **Свойства**.
3. Запишите адрес из раздела **URL-адрес**, а затем в разделе **Исходящие IP-адреса** просмотрите первый IP-адрес в списке. Эта информация будет использована позже при настройке конечных точек диспетчера трафика.
4. Повторите действия для **App-02**.

## <a name="create-a-traffic-manager-profile"></a>Создание профиля диспетчера трафика

Создайте профиль диспетчера трафика в группе ресурсов. Используйте значения по умолчанию и введите уникальное имя в пространстве имен trafficmanager.net.

Сведения о создании профиля диспетчера трафика см. в статье [Краткое руководство. Создание профиля диспетчера трафика для обеспечения высокодоступного веб-приложения](../traffic-manager/quickstart-create-traffic-manager-profile.md).

### <a name="create-endpoints"></a>Создание конечных точек

Теперь можно создать конечные точки для двух веб-приложений.

1. Откройте группу ресурсов и выберите профиль диспетчер трафика.
2. В левой колонке щелкните **Конечные точки**.
3. Щелкните **Добавить**.
4. Чтобы выполнить настройку конечной точки, воспользуйтесь сведениями из следующей таблицы:

   |type  |ИМЯ  |Цель  |Расположение  |Параметры пользовательского заголовка|
   |---------|---------|---------|---------|---------|
   |Внешняя конечная точка     |End-01|IP-адрес, записанный для App-01|Восточная часть США|host:\<URL-адрес, записанный для App-01\><br>Пример: **host:app-01.azurewebsites.net**|
   |Внешняя конечная точка     |End-02|IP-адрес, записанный для App-02|Центральный регион США|host:\<URL-адрес, записанный для App-02\><br>Пример: **host:app-02.azurewebsites.net**

## <a name="create-dns-zone"></a>Создание зоны DNS

Вы можете использовать для тестирования имеющуюся зону DNS или создать новую. Чтобы создать и делегировать зону DNS в Azure, ознакомьтесь со статьей [Руководство. Размещение домена в Azure DNS](dns-delegate-domain-azure-dns.md).

### <a name="add-the-alias-record-set"></a>Добавление набора записей псевдонимов

Когда зона DNS будет готова, на вершину зоны можно добавить запись псевдонима.

1. Откройте группу ресурсов и выберите зону DNS.
2. Щелкните **Набор записей**.
3. Добавьте набор записей, используя сведения из следующей таблицы:

   |ИМЯ  |type  |Псевдоним набора записей  |Тип псевдонима  |Ресурс Azure|
   |---------|---------|---------|---------|-----|
   |@     |A|Yes|Ресурс Azure|Диспетчер трафика. Профиль|

## <a name="add-custom-hostnames"></a>Добавление пользовательских имен узлов

Добавление пользовательского имени узла в оба веб-приложения.

1. Откройте группу ресурсов и выберите первое веб-приложение.
2. В левой колонке щелкните **Пользовательские домены**.
3. Щелкните **Добавить имя узла**.
4. В разделе "Имя узла" введите имя домена. Например, contoso.com.

   Ваш домен должен пройти проверку, после чего рядом с полями **доступности имени узла** и **владельца домена** должны появиться зеленые галочки.
5. Щелкните **Добавить имя узла**.
6. Чтобы просмотреть новые имена узла в разделе **Назначенные сайту имена узлов**, обновите страницу браузера. При обновлении страницы изменения не всегда мгновенно отображаются.
7. Повторите эту процедуру для второго веб-приложения.

## <a name="test-your-web-apps"></a>Тестирование веб-приложений

Теперь вы можете выполнить тестирование, чтобы гарантировать доступ к веб-приложению и балансировку нагрузки.

1. Откройте веб-браузер и перейдите на свой домен. Например, contoso.com. Должна открыться страница веб-приложения по умолчанию.
2. Остановите работу первого веб-приложения.
3. Закройте веб-браузер и подождите несколько минут.
4. Запустите веб-браузер и перейдите на свой домен. Страница веб-приложения по умолчанию должна по прежнему отображаться.
5. Остановите работу второго веб-приложения.
6. Закройте веб-браузер и подождите несколько минут.
7. Запустите веб-браузер и перейдите на свой домен. Вы увидите ошибку 403, указывающую на то, что веб-приложение остановлено.
8. Запустите второе веб-приложение.
9. Закройте веб-браузер и подождите несколько минут.
10. Запустите веб-браузер и перейдите на свой домен. Вы еще раз увидите страницу веб-приложения по умолчанию.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о записях псевдонима см. в следующих статьях:

- [Руководство по настройке записи псевдонима для ссылки на общедоступный IP-адрес Azure](tutorial-alias-pip.md)
- [Руководство. Настройка записи псевдонима для поддержки вершинных доменных имен с помощью диспетчера трафика](tutorial-alias-tm.md)
- [DNS: часто задаваемые вопросы](https://docs.microsoft.com/azure/dns/dns-faq#alias-records)
