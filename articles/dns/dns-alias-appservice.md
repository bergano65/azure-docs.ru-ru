---
title: Размещение веб-приложений Azure с балансировкой нагрузки на вершине зоны
description: Размещение веб-приложений с балансировкой нагрузки на вершине зоны с использованием записи псевдонима Azure DNS
services: dns
author: asudbring
ms.service: dns
ms.topic: article
ms.date: 08/10/2019
ms.author: allensu
ms.openlocfilehash: a673a74f8f6f919e7ebb7fc3b065ee0742ab3a10
ms.sourcegitcommit: d6b68b907e5158b451239e4c09bb55eccb5fef89
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2019
ms.locfileid: "74212363"
---
# <a name="host-load-balanced-azure-web-apps-at-the-zone-apex"></a>Размещение веб-приложений Azure с балансировкой нагрузки на вершине зоны

Протокол DNS запрещает назначение записей, отличных от A или AAAA, в апексе зоны. Пример вершины зоны — contoso.com. Это ограничение создает проблемы владельцам приложений, которые размещают приложения с балансировкой нагрузки за диспетчером трафика. Ссылаться на профиль диспетчера трафика из записи апекса зоны невозможно. В результате владельцам приложений необходимо использовать обходной путь. Перенаправление на прикладном уровне должно осуществляться из апекса зоны в другой домен. Например, перенаправление с contoso.com на www\.contoso.com. Это упорядочение дает точку сбоя для функции переадресации.

С помощью записей псевдонимов эта проблема устранена. Теперь владельцы приложений могут направить свои записи в апексе зоны на профиль диспетчера трафика, который имеет внешние конечные точки. Владельцы приложений могут указывать на тот же профиль диспетчера трафика, который используется для любого другого домена в их зоне DNS.

Например, contoso.com и www\.contoso.com могут указывать на один и тот же профиль диспетчера трафика. Это происходит до тех пор, пока профиль диспетчера трафика будет содержать только настроенные внешние конечные точки.

В этой статье вы узнаете, как создавать записи псевдонима для вершины домена и настраивать конечные точки профиля диспетчера трафика для веб-приложений.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>предварительным требованиям

Необходимо иметь доступное имя домена, который можно будет разместить в Azure DNS и использовать для тестирования. У вас должен быть полный контроль над этим доменом, включая возможность определять записи сервера имен (NS) для домена.

Инструкции по размещению домена в Azure DNS см. в [Руководстве по размещению домена в Azure DNS](dns-delegate-domain-azure-dns.md).

В качестве примера в этом руководстве используется домен contoso.com — замените его на собственное доменное имя.

## <a name="create-a-resource-group"></a>Создание группы ресурсов

Создайте группу ресурсов, в которой будут содержаться все ресурсы, используемые в статье.

## <a name="create-app-service-plans"></a>Создание планов службы приложений

Создайте два плана службы веб-приложений в группе ресурсов, используя следующую таблицу со сведениями о конфигурации. Дополнительные сведения о создании плана службы приложений см. в статье [Управлением планом службы приложений в Azure](../app-service/app-service-plan-manage.md).


|имя  |Операционная система  |Место проведения  |Уровень ценообразования  |
|---------|---------|---------|---------|
|ASP-01     |Windows|Восточная часть США|D1-Shared (среда разработки и тестирования)|
|ASP-02     |Windows|Central US|D1-Shared (среда разработки и тестирования)|

## <a name="create-app-services"></a>Создание служб приложений

Создайте два веб-приложения, по одному в каждом плане службы приложений.

1. В левом верхнем углу страницы портал Azure выберите **создать ресурс**.
2. Введите **веб-приложение** в строке поиска и нажмите клавишу ВВОД.
3. Выберите **веб-приложение**.
4. Нажмите кнопку **Создать**.
5. Примите значения по умолчанию и воспользуйтесь следующей таблицей, чтобы настроить два веб-приложения:

   |имя<br>(должно быть уникальным в пределах .azurewebsites.net)|resource group |Стек среды выполнения|Регион|Расположение или план службы приложений
   |---------|---------|-|-|-------|
   |App-01|Использовать имеющееся<br>Выберите группу ресурсов|.NET Core 2.2|Восточная часть США|ASP-01 (D1)|
   |App-02|Использовать имеющееся<br>Выберите группу ресурсов|.NET Core 2.2|Central US|ASP-02 (D1)|

### <a name="gather-some-details"></a>Сбор некоторых сведений

Теперь необходимо отметить IP-адрес и имя узла для веб-приложений.

1. Откройте группу ресурсов и выберите свое первое веб-приложение (в этом примере **— «app-01** »).
2. В левом столбце выберите **Свойства**.
3. Запишите адрес из раздела **URL-адрес**, а затем в разделе **Исходящие IP-адреса** просмотрите первый IP-адрес в списке. Эти сведения будут использоваться позже при настройке конечных точек диспетчера трафика.
4. Повторите действия для **App-02**.

## <a name="create-a-traffic-manager-profile"></a>Создание профиля диспетчера трафика

Создайте профиль диспетчера трафика в группе ресурсов. Используйте значения по умолчанию и введите уникальное имя в пространстве имен trafficmanager.net.

Сведения о создании профиля диспетчера трафика см. в статье [Краткое руководство. Создание профиля диспетчера трафика для обеспечения высокодоступного веб-приложения](../traffic-manager/quickstart-create-traffic-manager-profile.md).

### <a name="create-endpoints"></a>Создание конечных точек

Теперь можно создать конечные точки для двух веб-приложений.

1. Откройте группу ресурсов и выберите профиль диспетчера трафика.
2. В левом столбце выберите **конечные точки**.
3. Выберите **Добавить**.
4. Чтобы выполнить настройку конечной точки, воспользуйтесь сведениями из следующей таблицы:

   |введите  |имя  |Цель  |Место проведения  |Параметры пользовательского заголовка|
   |---------|---------|---------|---------|---------|
   |Внешняя конечная точка     |End-01|IP-адрес, записанный для App-01|Восточная часть США|host:\<URL-адрес, записанный для App-01\><br>Пример: **host:app-01.azurewebsites.net**|
   |Внешняя конечная точка     |End-02|IP-адрес, записанный для App-02|Central US|host:\<URL-адрес, записанный для App-02\><br>Пример: **host:app-02.azurewebsites.net**

## <a name="create-dns-zone"></a>Создание зоны DNS

Вы можете использовать для тестирования имеющуюся зону DNS или создать новую. Чтобы создать и делегировать зону DNS в Azure, ознакомьтесь со статьей [Руководство. Размещение домена в Azure DNS](dns-delegate-domain-azure-dns.md).

## <a name="add-a-txt-record-for-custom-domain-validation"></a>Добавление записи типа TXT для проверки пользовательского домена

При добавлении пользовательского имени узла в веб-приложения для проверки домена будет искать определенную запись TXT.

1. Откройте группу ресурсов и выберите зону DNS.
2. Выберите **Набор записей**.
3. Добавьте набор записей, используя следующую таблицу. В качестве значения используйте фактический ранее записанный URL веб-приложения:

   |имя  |введите  |Значение|
   |---------|---------|-|
   |@     |TXT|App-01.azurewebsites.net|


## <a name="add-a-custom-domain"></a>Добавление личного домена

Добавьте личный домен для обоих веб-приложений.

1. Откройте группу ресурсов и выберите свое первое веб-приложение.
2. В левом столбце выберите **Личные домены**.
3. В разделе **Личные домены**выберите **Добавить личный домен**.
4. В поле **личный домен**введите имя пользовательского домена. Например, contoso.com.
5. Выберите **Проверка**.

   Домен должен пройти проверку и отображать зеленые флажки рядом с областью **доступности узла** и **владельцем домена**.
5. Нажмите кнопку **Добавить личный домен**.
6. Чтобы просмотреть новые имена узла в разделе **Назначенные сайту имена узлов**, обновите страницу браузера. Обновление на странице не всегда показывает изменения сразу же.
7. Повторите эту процедуру для второго веб-приложения.

## <a name="add-the-alias-record-set"></a>Добавление набора записей псевдонимов

Теперь добавьте запись псевдонима для зоны вершине.

1. Откройте группу ресурсов и выберите зону DNS.
2. Выберите **Набор записей**.
3. Добавьте набор записей, используя сведения из следующей таблицы:

   |имя  |введите  |Псевдоним набора записей  |Тип псевдонима  |Ресурс Azure|
   |---------|---------|---------|---------|-----|
   |@     |Файл ,|Yes|Ресурс Azure|Диспетчер трафика. Профиль|


## <a name="test-your-web-apps"></a>Тестирование веб-приложений

Теперь можно протестировать, чтобы обеспечить доступ к веб-приложению и обеспечить его балансировку нагрузки.

1. Откройте веб-браузер и перейдите на свой домен. Например, contoso.com. Должна открыться страница веб-приложения по умолчанию.
2. Остановите работу первого веб-приложения.
3. Закройте веб-браузер и подождите несколько минут.
4. Запустите веб-браузер и перейдите на свой домен. Страница веб-приложения по умолчанию должна по прежнему отображаться.
5. Остановите работу второго веб-приложения.
6. Закройте веб-браузер и подождите несколько минут.
7. Запустите веб-браузер и перейдите на свой домен. Вы увидите ошибку 403, указывающую на то, что веб-приложение остановлено.
8. Запустите второе веб-приложение.
9. Закройте веб-браузер и подождите несколько минут.
10. Запустите веб-браузер и перейдите на свой домен. Вы еще раз увидите страницу веб-приложения по умолчанию.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о записях псевдонима см. в следующих статьях:

- [Руководство по настройке записи псевдонима для ссылки на общедоступный IP-адрес Azure](tutorial-alias-pip.md)
- [Руководство. Настройка записи псевдонима для поддержки вершинных доменных имен с помощью диспетчера трафика](tutorial-alias-tm.md)
- [DNS: часто задаваемые вопросы](https://docs.microsoft.com/azure/dns/dns-faq#alias-records)

Сведения о переносе активного DNS-имени см. в статье [Перенос активного DNS-имени в службу приложений Azure](../app-service/manage-custom-dns-migrate-domain.md).
