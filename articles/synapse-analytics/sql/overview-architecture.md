---
title: Архитектура Synapse SQL
description: Узнайте, как Azure синапсе SQL сочетает возможности обработки распределенных запросов с хранилищем Azure для достижения высокой производительности и масштабируемости.
services: synapse-analytics
author: mlee3gsd
manager: rothja
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: ''
ms.date: 04/15/2020
ms.author: martinle
ms.reviewer: igorstan
ms.openlocfilehash: da6c9f6df0e9e74de297cf6c8f655b62e3446bad
ms.sourcegitcommit: 6a350f39e2f04500ecb7235f5d88682eb4910ae8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/01/2020
ms.locfileid: "96462717"
---
# <a name="azure-synapse-sql-architecture"></a>Архитектура Azure Synapse Analytics 

В этой статье описываются компоненты архитектуры Synapse SQL.

## <a name="synapse-sql-architecture-components"></a>Компоненты архитектуры Synapse SQL

Synapse SQL использует архитектуру с горизонтальным увеличением масштаба для распределения вычислительной обработки данных на нескольких узлах. Вычислительные ресурсы отделены от ресурсов хранилища, что дает возможность масштабировать вычислительные ресурсы независимо от данных в системе. 

Для выделенного пула SQL единица масштабирования является абстракцией вычислений, которая называется [единицей использования хранилища данных](resource-consumption-models.md). 

Для бессерверного пула SQL, который не является сервером, масштабирование выполняется автоматически в соответствии с требованиями к ресурсам запроса. По мере того, как топология изменяется с течением времени из-за добавления, удаления узлов или отработки отказа, она адаптируется к этим изменениям и гарантирует, что запросу будет выделено достаточно ресурсов для успешного выполнения. Например, на рисунке ниже показан несерверный пул SQL, использующий 4 вычислительных узла для выполнения запроса.

![Архитектура Synapse SQL](./media//overview-architecture/sql-architecture.png)

В Synapse SQL используется архитектура на основе узлов. Приложения подключаются к управляющему узлу и выполняют команды T-SQL. Этот узел представляет собой единую точку входа для Synapse SQL. 

Узел управления SQL Azure синапсе использует механизм распределенных запросов для оптимизации запросов для параллельной обработки, а затем передает операции вычислительным узлам для параллельной работы. 

Управляющий узел "серверный пул SQL" использует подсистему обработки распределенных запросов (ДКП) для оптимизации и управления распределенным выполнением запросов пользователей, разбивая его на запросы меньшего размера, которые будут выполняться на вычислительных узлах. Каждый меньший запрос называется задачей и представляет единицу распределенного выполнения. Он считывает файлы из хранилища, объединяет результаты из других задач и группирует или упорядочивает данные, полученные из других задач. 

Вычислительные узлы хранят все данные пользователей в службе хранилища Azure и выполняют параллельные запросы. Служба перемещения данных (DMS) представляет собой внутреннюю службу на уровне системы, которая перемещает данные между узлами, что необходимо для выполнения параллельных запросов и возвращения точных результатов. 

Благодаря тому, что хранилище и вычислительные узлы не связаны, использование Synapse SQL может дать преимущества независимого объема вычислительной мощности от потребностей хранилища. Для масштабирования пула SQL без сервера выполняется автоматически, в то время как для выделенного пула SQL один может:

* Увеличение или уменьшение мощности вычислений в выделенном пуле SQL без перемещения данных.
* приостановка вычислений без изменения данных (вы платите только за хранилище);
* возобновление вычислений во время рабочих часов.

## <a name="azure-storage"></a>Хранилище Azure

В Synapse SQL используется служба хранилища Azure для безопасного хранения данных пользователя. Так как ваши данные хранятся в службе хранилища Azure и управляются ею, предусмотрена отдельная плата за использование хранилища. 

Бессерверный пул SQL позволяет запрашивать файлы в Data Lake в режиме только для чтения, а пул SQL позволяет получать данные. Когда данные принимаются в выделенный пул SQL, данные сегментированы на **распределения** , чтобы оптимизировать производительность системы. При определении таблицы вы можете выбрать шаблон сегментирования, который будет использоваться для распределения данных. Поддерживаются следующие шаблоны сегментирования:

* Хэш
* Циклический перебор
* Репликация

## <a name="control-node"></a>Управляющий узел

Управляющий узел в этой архитектуре отвечает за все решения. Это внешний интерфейс, который взаимодействует со всеми приложениями и подключениями. 

В синапсе SQL механизм распределенных запросов выполняется на управляющем узле для оптимизации и координации параллельных запросов. При отправке запроса T-SQL в выделенный пул SQL управляющий узел преобразует его в запросы, выполняемые для каждого распределения параллельно.

В бессерверном пуле SQL обработчик ДКП работает на узле управления, чтобы оптимизировать и координировать распределенное выполнение запросов пользователей, разделив его на запросы меньшего размера, которые будут выполняться на вычислительных узлах. Она также назначает наборы файлов, которые будут обрабатываться каждым узлом.

## <a name="compute-nodes"></a>Вычислительные узлы

Вычислительные узлы обеспечивают вычислительную мощность. 

В выделенном пуле SQL распределения сопоставляются с вычислительными узлами для обработки. Когда вы оплачиваете использование дополнительных вычислительных ресурсов, пул повторно сопоставляет распределения с доступными вычислительными узлами. Число расчетных узлов в диапазоне от 1 до 60 и определяется уровнем обслуживания для выделенного пула SQL. У каждого вычислительного узла есть идентификатор узла, который видно в представлениях системы. Идентификатор вычислительного узла можно увидеть в столбце node_id в системных представлениях, имена которых начинаются с sys.pdw_nodes. Список этих системных представлений см. в разделе [СИНАПСЕ SQL System views](/sql/relational-databases/system-catalog-views/sql-data-warehouse-and-parallel-data-warehouse-catalog-views?view=azure-sqldw-latest).

В бессерверном пуле SQL каждому расчетному узлу назначается задача и набор файлов для выполнения задачи. Задача — это единица распределенного выполнения запроса, которая фактически является частью отправленного пользователем запроса. Используется автомасштабирование, чтобы для выполнения запроса пользователя предоставлялось достаточное количество вычислительных узлов.

## <a name="data-movement-service"></a>Служба перемещения данных

Служба перемещения данных (DMS) — это технология передачи данных в выделенном пуле SQL, которая координирует перемещение данных между вычисленными узлами. Некоторым запросам требуется перемещение данных, чтобы параллельные запросы вернули точные результаты. При необходимости перемещения данных DMS гарантирует, что нужные данные окажутся в нужном расположении.

> [!VIDEO https://www.youtube.com/embed/PlyQ8yOb8kc]

## <a name="distributions"></a>Дистрибутивы

Распределение — это базовая единица хранения и обработки для параллельных запросов, выполняемых на распределенных данных в выделенном пуле SQL. Если выделенный пул SQL выполняет запрос, работа делится на 60 небольших запросов, выполняемых параллельно. 

Каждый из этих 60 небольших запросов выполняется в одном из распределений данных. Каждый вычислительный узел управляет одним или несколькими из 60 распределений. Выделенный пул SQL с максимальным количеством вычислений имеет по одному распределению на каждый узел вычислений. Выделенный пул SQL с минимальными ресурсами вычислений имеет все распределения на одном из вычислений. 

## <a name="hash-distributed-tables"></a>Таблицы с хэш-распределением
С помощью распределенной хэш-таблицы можно обеспечить наибольшую производительность запроса для операций объединения и агрегирования для больших таблиц. 

Для сегментирования данных в распределенную хэш-таблицу выделенный пул SQL использует хэш-функцию для детерминированного назначения каждой строки одному распределению. В определении таблицы один из столбцов определяется как столбец распределения. Хэш-функция использует значения в столбце распределения для присвоения каждой строки распределению.

На следующей схеме показано, как полная (нераспределенная) таблица хранится в качестве хэш-распределенной. 

![Распределенная таблица](media//overview-architecture/hash-distributed-table.png "Распределенная таблица") 

* Каждая строка относится к одному распределению. 
* Детерминированный хэш-алгоритм присваивает каждую строку одному распределению. 
* Количество строк таблицы в распределении зависит от размеров таблиц (как показано на схеме).

Существуют влияющие на производительность факторы, которые учитываются при выборе столбца распределения. Например, определенность, неравномерное смещение данных и типы запросов, выполняемых в системе.

## <a name="round-robin-distributed-tables"></a>Таблицы с распределением методом циклического перебора

Таблица с распределением методом циклического перебора — это самая простая таблица для создания и обеспечения высокой производительности, если ее использовать как промежуточную таблицу для нагрузок.

В таблице с распределением методом циклического перебора данные распределяются равномерно, но без какой-либо последующей оптимизации. Распределение сначала выбирается случайным образом, а затем буферы строк назначаются распределениям последовательно. Вы можете быстро загрузить данные в таблицу с распределением методом циклического перебора, но производительность запроса будет лучше, если использовать распределенные хэш-таблицы. Для объединения таблиц с распределением методом циклического перебора требуется перегруппировка данных, что требует дополнительного времени.

## <a name="replicated-tables"></a>Реплицированные таблицы
Реплицированная таблица обеспечивает наилучшую производительность запросов для небольших таблиц.

Полная копия реплицированной таблицы хранится на каждом вычислительном узле. В результате репликация таблицы устраняет необходимость передавать данные между вычислительными узлами перед операциями соединения или агрегирования. Реплицированные таблицы лучше всего использовать для небольших таблиц. При записи данных требуются дополнительное хранилище и дополнительные расходы, что делает использование больших таблиц нецелесообразным. 

На следующей схеме представлена реплицированная таблица, которая кэшируется при первом распределении на каждом вычислительном узле. 

![Реплицированная таблица](media/overview-architecture/replicated-table.png "Реплицированная таблица") 

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы уже знакомы с синапсе SQL, Узнайте, как быстро [создать выделенный пул SQL](../quickstart-create-sql-pool-portal.md) и [загрузить образец данных](../sql-data-warehouse/sql-data-warehouse-load-from-azure-blob-storage-with-polybase.md) (./SQL-Data-Warehouse-Load-Sample-databases.md). Или начните [использовать бессерверный пул SQL Server](../quickstart-sql-on-demand.md). Если вы раньше не работали с Azure, используйте [глоссарий Azure Глоссарий](../../azure-glossary-cloud-terminology.md) , чтобы узнать значение новых терминов. 
