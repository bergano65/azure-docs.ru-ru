---
title: использование хранимых процедур;
description: Советы по разработке решений путем реализации хранимых процедур для выделенных пулов SQL в Azure синапсе Analytics.
services: synapse-analytics
author: MSTehrani
manager: craigg
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: sql-dw
ms.date: 04/02/2019
ms.author: emtehran
ms.reviewer: igorstan
ms.custom: azure-synapse
ms.openlocfilehash: cc6a58b4ef78aca60d2a26870980e032c0b11a52
ms.sourcegitcommit: 6a350f39e2f04500ecb7235f5d88682eb4910ae8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/01/2020
ms.locfileid: "96463222"
---
# <a name="using-stored-procedures-for-dedicated-sql-pools-in-azure-synapse-analytics"></a>Использование хранимых процедур для выделенных пулов SQL в Azure синапсе Analytics

В этой статье приводятся советы по разработке выделенных решений пула SQL путем реализации хранимых процедур.

## <a name="what-to-expect"></a>Чего следует ожидать

Выделенный пул SQL поддерживает многие функции T-SQL, используемые в SQL Server. Что более важно, в нем есть специальные функции горизонтального масштабирования, с помощью которых можно максимально увеличить производительность решения.

Кроме того, чтобы помочь вам поддерживать масштабирование и производительность выделенного пула SQL, существуют дополнительные функции и возможности, имеющие различия в поведении.

## <a name="introducing-stored-procedures"></a>Введение в хранимые процедуры

Хранимые процедуры — это отличный способ инкапсуляции кода SQL, который хранится ближе к выделенным данным пула SQL. Хранимые процедуры также помогают разработчикам разделения свои решения путем инкапсуляции кода в управляемые единицы, что упрощает многократное использование кода. Каждая хранимая процедура может также принимать параметры, что делает их еще более гибкими.

Выделенный пул SQL предоставляет упрощенную и упрощенную реализацию хранимых процедур. Самым большим различием по сравнению с SQL Server является то, что хранимая процедура не является предварительно скомпилированным кодом.

Как правило, для хранилищ данных время компиляции невелико по сравнению с временем, которое требуется для выполнения запросов к большим объемам данных. Более важно обеспечить правильную оптимизацию кода хранимой процедуры для больших запросов.

> [!TIP]
> Цель — сэкономить часы, минуты и секунды, но не миллисекунды. Поэтому рекомендуется рассматривать хранимые процедуры как контейнеры для логики SQL.

Если выделенный пул SQL выполняет хранимую процедуру, инструкции SQL анализируются, транслируются и оптимизируются во время выполнения. Во время этого процесса каждая инструкция преобразуется в распределенные запросы. Код SQL, который выполняется с данными, отличается от отправляемого запроса.

## <a name="nesting-stored-procedures"></a>Вложенные хранимые процедуры

Когда хранимые процедуры вызывают другие хранимые процедуры или выполняют динамический код SQL, то внутреннюю хранимую процедуру или код вызова называют вложенными.

Выделенный пул SQL поддерживает не более восьми уровней вложенности. В отличие от этого уровень вложенности в SQL Server равен 32.

Вызов хранимой процедуры верхнего уровня считается 1 уровнем вложенности.

```sql
EXEC prc_nesting
```

Если хранимая процедура также выполняет еще один вызов EXEC, уровень вложенности увеличится до 2.

```sql
CREATE PROCEDURE prc_nesting
AS
EXEC prc_nesting_2  -- This call is nest level 2
GO
EXEC prc_nesting
```

Если вторая процедура затем выполняет какой-либо динамический SQL-запрос, уровень вложенности увеличится до 3.

```sql
CREATE PROCEDURE prc_nesting_2
AS
EXEC sp_executesql 'SELECT 'another nest level'  -- This call is nest level 2
GO
EXEC prc_nesting
```

Выделенный пул SQL в настоящее время не поддерживает [@ @NESTLEVEL ](/sql/t-sql/functions/nestlevel-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest). Таким образом, необходимо контролировать уровень вложенности. Маловероятно, что превышено ограничение в восьми уровней вложенности. Но в этом случае необходимо переработать код в соответствии с уровнями вложенности в пределах этого ограничения.

## <a name="insertexecute"></a>INSERT..EXECUTE

Выделенный пул SQL не позволяет использовать результирующий набор хранимой процедуры с инструкцией INSERT. Однако существует альтернативный подход, который можно использовать. Например, см. статью о [временных таблицах](sql-data-warehouse-tables-temporary.md).

## <a name="limitations"></a>Ограничения

Существуют некоторые аспекты хранимых процедур Transact-SQL, которые не реализованы в выделенном пуле SQL, что выглядит следующим образом:

* временные хранимые процедуры;
* нумерованные хранимые процедуры;
* расширенные хранимые процедуры;
* хранимые процедуры CLR;
* возможность шифрования;
* возможность репликации;
* параметры с табличным значением;
* параметры только для чтения;
* параметры по умолчанию;
* контекст выполнения;
* Оператор return

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные советы по разработке приведены в [обзоре разработки](sql-data-warehouse-overview-develop.md).
