---
title: Запись видео на основе событий — Azure
description: Запись видео на основе событий — это процесс записи видео, инициируемый определенным событием. Это событие может поступать из-за обработки самого видеосигнала (например, при обнаружении движения) или из независимого источника (например, при открытии двери).  В этой статье описаны несколько вариантов использования, связанных с записью видео на основе событий.
ms.topic: conceptual
ms.date: 05/27/2020
ms.openlocfilehash: 6a5f4873b2cfef8d9a6594916d82cd30a3bc1cc2
ms.sourcegitcommit: cc13f3fc9b8d309986409276b48ffb77953f4458
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2020
ms.locfileid: "97401618"
---
# <a name="event-based-video-recording"></a>Запись видео на основе событий  
 
## <a name="suggested-pre-reading"></a>Рекомендуемые материалы для предварительного ознакомления  

* [Непрерывная запись видео](continuous-video-recording-concept.md)
* [Воспроизведение записанного содержимого](video-playback-concept.md)
* [Понятие графа мультимедиа](media-graph-concept.md)

## <a name="overview"></a>Обзор 

Запись видео на основе событий — это процесс записи видео, инициируемый определенным событием. Рассматриваемое событие может поступать из-за обработки самого видеосигнала (например, при обнаружении движения) или из независимого источника (например, при открытии двери). 

Видео (активируемое событием) можно записать с камеры ККТВ в ресурс служб мультимедиа с помощью графа мультимедиа, состоящего из [исходного узла RTSP](media-graph-concept.md#rtsp-source) , узла [приемника ресурса](media-graph-concept.md#asset-sink) и других узлов, как описано в следующих вариантах использования. Вы можете настроить узел [приемника ресурса](media-graph-concept.md#asset-sink) для создания новых ресурсов каждый раз, когда происходит событие, чтобы видеозапись, соответствующая каждому событию, была в отдельном ресурсе. Вы также можете выбрать использование одного ресурса для хранения видео для всех событий. 

В качестве альтернативы узлу приемника ресурса можно использовать узел [приемника файлов](media-graph-concept.md#file-sink) для записи коротких фрагментов видео (связанных с интересующим событием) в указанное расположение в локальной файловой системе на пограничном устройстве. 

В этой статье описаны несколько вариантов использования, связанных с записью видео на основе событий.

### <a name="video-recording-based-on-motion-detection"></a>Запись видео на основе обнаружения движения  

В этом случае видеоклипы можно записывать только в том случае, если в видеоролике обнаружено движение и получать оповещения при создании такого видеоролика. Это может быть связано с коммерческими сценариями безопасности, связанными с защитой критической инфраструктуры. Создавая предупреждения и записывая видео при обнаружении непредвиденного движения, можно повысить эффективность оператора человека, так как действие требуется только при создании оповещения.

На схеме ниже показано графическое представление графа мультимедиа, устраняющего этот вариант использования. Представление JSON топологии графа такого графа мультимедиа можно найти [здесь](https://github.com/Azure/live-video-analytics/blob/master/MediaGraph/topologies/evr-motion-assets/topology.json).

> [!div class="mx-imgBorder"]
> :::image type="content" source="./media/event-based-video-recording/motion-detection.svg" alt-text="Запись видео на основе обнаружения движения":::

На схеме узел источника RTSP захватывает канал видео в реальном времени с камеры и передает его на узел [процессора для обнаружения движения](media-graph-concept.md#motion-detection-processor) . При обнаружении движения в реальном видео узел процессора обнаружения движения создает событие, которое переходит на узел [процессора сигнального шлюза](media-graph-concept.md#signal-gate-processor) , а также на узел приемника сообщений центра Интернета вещей. Последний узел отправляет события в центр IoT Edge, откуда они могут направляться в другие назначения для активации предупреждений. 

Событие из узла детектора движения запустит узел обработчика сигнального шлюза, которое позволит каналу динамического видео из исходного узла RTSP проходить через узел приемника ресурса. При отсутствии следующих событий обнаружения движения шлюз закрывается по истечении заданного промежутка времени. Определяет продолжительность записанного видео.

### <a name="video-recording-based-on-events-from-other-sources"></a>Запись видео на основе событий из других источников  

В этом варианте использования сигналы из другого датчика Интернета вещей можно использовать для активации записи видео. На схеме ниже показано графическое представление графа мультимедиа, устраняющего этот вариант использования. Представление JSON топологии графа такого графа мультимедиа можно найти [здесь](https://github.com/Azure/live-video-analytics/blob/master/MediaGraph/topologies/evr-hubMessage-files/topology.json).

> [!div class="mx-imgBorder"]
> :::image type="content" source="./media/event-based-video-recording/other-sources.svg" alt-text="Запись видео на основе событий из других источников":::

На схеме внешний датчик отправляет события в центр IoT Edge. Затем события перенаправляются в узел обработчика сигнальных шлюзов через узел [источника сообщений центра Интернета вещей](media-graph-concept.md#iot-hub-message-source) . Поведение узла обработчика сигнального шлюза аналогично предыдущему варианту использования. оно откроется и позволит потоку передачи видео в реальном времени через узел источника RTSP на узел приемника файла (или узел приемника ресурса), когда он активируется внешним событием. 

Если вы используете узел приемника файлов, видео будет записано в локальную файловую систему на пограничном устройстве. Кроме того, если вы используете узел приемника ресурса, видео будет записано в ресурс.

### <a name="video-recording-based-on-an-external-inferencing-module"></a>Запись видео на основе внешнего модуля 

В этом варианте использования можно записывать видеоклипы на основе сигнала из внешней системы логики. Примером такого варианта использования может быть запись видеоклипа только при обнаружении грузовика в видеоканале трафика на восходящего устройства. На схеме ниже показано графическое представление графа мультимедиа, устраняющего этот вариант использования. Представление JSON топологии графа такого графа мультимедиа можно найти [здесь](https://github.com/Azure/live-video-analytics/blob/master/MediaGraph/topologies/evr-hubMessage-assets/topology.json).

> [!div class="mx-imgBorder"]
> :::image type="content" source="./media/event-based-video-recording/external-inferencing-module.svg" alt-text="Запись видео на основе внешнего модуля":::

На схеме узел источника RTSP захватывает канал видео в реальном времени с камеры и доставляет его в две ветви: один имеет узел [обработчика сигнального шлюза](media-graph-concept.md#signal-gate-processor) , а другой использует узел [расширения HTTP](media-graph-concept.md) для отправки данных в модуль внешней логики. Узел расширения HTTP позволяет графу мультимедиа передавать кадры изображения (в форматах JPEG, BMP или PNG) во внешнюю службу вывода. Этот способ передачи сигналов обычно поддерживает только низкие частоты кадров (<5fps). Можно использовать узел обработчика расширений HTTP, чтобы снизить частоту кадров видео, передаваемых во внешний модуль.

Результаты внешней службы вывода извлекаются узлом расширения HTTP и передаются в центр IoT Edge через узел приемника сообщений центра Интернета вещей, где они могут быть обработаны модулем External Logic. Если служба вывода может обнаруживать транспортные средства, например, модуль логики может искать определенное транспортное средство, например шину или грузовик. Когда модуль логики обнаруживает интересующий объект, он может активировать узел процессора сигнального шлюза, отправив событие через центр IoT Edge в узел источника сообщения центра Интернета вещей на графе. Выходные данные шлюза сигнала отображаются для перехода на узел приемника файла или на узел приемника ресурса. В первом случае видео будет записано в локальную файловую систему на пограничном устройстве. В последнем случае видео будет записано в ресурс.

Усовершенствованием этого примера является использование процессора детектора движения перед узлом обработчика расширений HTTP. Это снизит нагрузку на службу вывода, например ночь, когда в случае отсутствия транспортных средств на этом невозможности наблюдаются длительные периоды времени. 

## <a name="next-steps"></a>Дальнейшие действия

[Учебник. запись видео на основе событий](event-based-video-recording-tutorial.md)
