---
title: Использование прямых методов в Live Video Analytics на IoT Edge в Azure
description: Интерактивная аналитика видео на IoT Edge предоставляет несколько прямых методов. Прямые методы основаны на соглашениях, описанных в этом разделе.
ms.topic: conceptual
ms.date: 04/27/2020
ms.openlocfilehash: 8b5c16dc72beed4ec757e48461a2fc194c113f8d
ms.sourcegitcommit: ad677fdb81f1a2a83ce72fa4f8a3a871f712599f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/17/2020
ms.locfileid: "97656246"
---
# <a name="direct-methods"></a>Прямые методы

Интерактивная аналитика видео на IoT Edge предоставляет несколько прямых методов, которые можно вызывать из центра Интернета вещей. Прямые методы представляют собой взаимодействие типа "запрос — ответ" с устройством, подобное вызову HTTP тем, что об успешном завершении или сбое становится известно немедленно (после указанного пользователем времени ожидания). Этот подход полезен для сценариев, в которых предпринимаемые немедленно действия различаются в зависимости от того, удалось ли устройству ответить. Дополнительные сведения см. в разделе [изучение и вызов прямых методов из центра Интернета вещей](../../iot-hub/iot-hub-devguide-direct-methods.md).

В этом разделе описываются эти методы и соглашения.

## <a name="conventions"></a>Соглашения

Прямые методы основываются на следующих соглашениях:

1. Прямые методы имеют версию, указанную в основном. ДОПОЛНИТЕЛЬНЫЙ формат (как показано в следующем примере):

    ```
    {
        "methodName": "GraphTopologySet",
        "payload": {
            // API version matches matches module MAJOR.MINOR version
            "@apiVersion": "1.0"
            //payload here…
        }
    }
    ```

2. Данная версия функции Live Video Analytics в модуле IoT Edge будет поддерживать все прямые методы вплоть до текущей версии. Например, модуль версии 1,3 будет поддерживать прямые методы с версиями 1,3, 1,2, 1,1 и 1,0.
3. Все прямые методы являются синхронными.
4. Результаты ошибки см. в схеме ошибок OData.
5. Имена должны соответствовать следующим ограничениям:
    
    * Только буквенно-цифровые символы и тире, если оно не начинается и заканчивается тире
    * Без пробелов
    * Не более 32 символов

### <a name="example"></a>Пример

```
{
  "status": 400,
  "payload": {
    "error": {
      "code": "BadRequest",
      "message": "Graph instance is not found."
    }
  }
}
```    

### <a name="top-level-error-codes"></a>Коды ошибок верхнего уровня     

|Состояние |Код   |Сообщение|
|---|---|---|
|400|   BadRequest| Недопустимый запрос.|
|400|   инвалидресаурце|    Недопустимый ресурс|
|400|   инвалидверсион| Недопустимая версия API|
|402|   коннективитирекуиред    |Для правильной работы модуля граничных функций требуется подключение к облаку.|
|404|   NotFound    |Ресурс не найден|
|409|   Conflict|   Конфликт операций|
|500|   InternalServerError|    Внутренняя ошибка сервера|
|503|   ServerBusy| Сервер занят|

### <a name="detailed-error-codes"></a>Подробные коды ошибок

Подробные сведения об ошибке проверок, такие как проверки модуля графа, добавляются в виде сведений об ошибке:

```
{
  "status": 400,
  "payload": {
    "error": {
      "code": "InvalidResource",
      "message": "The resource format is invalid.",
      "details": [
        {
          "code": "RtspEndpointUrlInvalidScheme",
          "target": "$.Properties.Sources[0]",
          "message": "Uri scheme 'http' is not valid for an RTSP source endpoint. Valid values are: rtsp"
        },
        {
          "code": "PropertyValueInvalidPattern",
          "target": "$.Properties.Sinks[0].AssetNamePattern",
          "message": "The value must match the regular expression '^[^<>%&:\\\\\\/?*+.']{1,260}$'"
        }
      ]
    }
  }
}
}
```

|Состояние|    Подробный код   |Описание|
|---|---|---|
|400|   графвалидатионеррор|   Общие ошибки графа, такие как циклы или секционирование, и т. д.|
|400|   модулевалидатионеррор|  Ошибки проверки, специфичные для модуля.|
|409|   графтопологинусе| На топологию графа по-прежнему ссылается один или несколько экземпляров графа.|
|409|   оператионноталловединстате| Запрошенная операция не может быть выполнена в текущем состоянии.|
|409|   ресаурцевалидатионеррор|    Ресурс, на который указывает ссылка (пример: актив), находится в недопустимом состоянии.|

## <a name="details"></a>Сведения  

### <a name="graphtopologyget"></a>графтопологижет

Этот прямой метод получает одну топологию графа.

#### <a name="request"></a>Запрос

```
{
    "methodName": "GraphTopologyGet",
    "payload": {
        "@apiVersion": "1.0",
        "name": "CaptureAndRecord"
    }
}
```

#### <a name="response"></a>Ответ

```
{
    "status": 200,
    "payload": {
        "name": "CaptureAndRecord",
        "properties": {
            // Complete graph topology
        }
    }
}
```

#### <a name="status-codes"></a>Коды состояния

| Условие | Код состояния | Подробный код ошибки |
|--|--|--|
| Найденная сущность | 200 | Недоступно |
| Общие ошибки пользователя | Ошибки диапазона 400 |  |
| Сущность не найдена | 404 |  |
| Общие ошибки сервера | Ошибки диапазона 500 |  |

### <a name="graphtopologyset"></a>графтопологисет

Создает отдельную топологию, если отсутствует существующая с заданным именем или обновлениями, а существующая — с тем же именем.

Ключевые аспекты:

* Топологию можно свободно обновлять, так как на нее не ссылаются графы.
* Топологию можно свободно обновлять, если все ссылающиеся графы деактивированы при условии, что:

    * Новые добавленные параметры имеют значения по умолчанию
    * На удаленные параметры не ссылаются никакие графы
* Обновления топологии не разрешены, если имеются активные графы

#### <a name="request"></a>Запрос

```
{
    "methodName": "GraphTopologySet",
    "payload": {
        "@apiVersion": "1.0",
        "name": "CaptureAndRecord",
        "properties": {
            // Desired graph topology properties
        }
    }
}
```

#### <a name="response"></a>Ответ

```
{
    "status": 201,
    "payload": {
        "name": " CaptureAndRecord ",
        "properties": {
            // Complete graph topology
        }
    }
}
```

#### <a name="status-codes"></a>Коды состояния

|Условие  |Код состояния    |Подробный код ошибки|
|---|---|---|
Существующая сущность обновлена |200|   Недоступно|
Создана новая сущность  |201|   Недоступно|
Общие ошибки пользователя |Ошибки диапазона 400  ||
Ошибки проверки графа |400    |графвалидатионеррор|
Ошибки проверки модуля|   400 |модулевалидатионеррор|
Общие ошибки сервера   |Ошибки диапазона 500  ||

### <a name="graphtopologydelete"></a>графтопологиделете

Удаляет топологию с одним графом.

#### <a name="request"></a>Запрос

```
{
    "methodName": "GraphTopologyDelete",
    "payload": {
        "@apiVersion": "1.0",
        "name": "CaptureAndRecord"
    }
}
```

#### <a name="response"></a>Ответ

```
{
    "status": 200,
    "payload": null
}
```

#### <a name="status-codes"></a>Коды состояния

| Условие | Код состояния | Подробный код ошибки |
|--|--|--|
| Сущность удалена | 200 | Недоступно |
| Сущность не найдена | 204 | Недоступно |
| Общие ошибки пользователя | Ошибки диапазона 400 |  |
| На топологию графа ссылается один или несколько экземпляров графа | 409 | графтопологинусе |
| Общие ошибки сервера | Ошибки диапазона 500 |  |

### <a name="graphtopologylist"></a>графтопологилист

Извлекает список всех топологий графов, соответствующих условиям фильтра.

#### <a name="request"></a>Запрос

```
{
    "methodName": "GraphTopologyList",
    "payload": {
        // Required
        "@apiVersion": "1.0",
        
        // Optional
        "@continuationToken": "xxxxx",    
        "@query": "$orderby=name asc"
    }
}
```

#### <a name="response"></a>Ответ

```
{
    "status": 200,
    "payload": {
        "@continuationToken": "xxxx",
        "value": [
            {
                "name": "Capture & Record",
                // ...
            },
            {
                "name": "Capture, Analyze & Record",
                // ...
            }
        ]
    }
}
```

#### <a name="filter-support"></a>Поддержка фильтров

|Операция |Поля (ы)    |Операторы|
|---|---|---|
|$orderby|name  |ASC|


#### <a name="status-codes"></a>Коды состояния

| Условие | Код состояния | Подробный код ошибки |
|--|--|--|
| Успешно | 200 | Недоступно |
| Общие ошибки пользователя | Ошибки диапазона 400 |  |
| Общие ошибки сервера | Ошибки диапазона 500 |  |

### <a name="graphinstanceget"></a>графинстанцежет

Извлекает один экземпляр Graph:

#### <a name="request"></a>Запрос

```
{
    "methodName": "GraphInstanceGet",
    "payload": {
        "@apiVersion": "1.0",
        "name": "Camera001"
    }
}
```

#### <a name="response"></a>Ответ

```
{
    "status": 200,
    "payload": {
        "name": "Camera001",
        "properties": {
            // Complete graph instance
        }
    }
}
```

#### <a name="status-codes"></a>Коды состояния

| Условие | Код состояния | Подробный код ошибки |
|--|--|--|
| Найденная сущность | 200 | Недоступно |
| Общие ошибки пользователя | Ошибки диапазона 400 |  |
| Сущность не найдена | 404 |  |
| Общие ошибки сервера | Ошибки диапазона 500 |  |

### <a name="graphinstanceset"></a>графинстанцесет

Создает один экземпляр Graph, если отсутствует существующий объект с указанным именем или обновления, и существующий объект с таким именем уже существует.

Ключевые аспекты:

* Экземпляр Graph можно свободно обновлять в состоянии "отключено".

    * Граф повторно проверяется при каждом обновлении.
* Обновления экземпляра графа частично ограничены, пока граф не находится в состоянии "неактивно".
* Обновления экземпляров графа не разрешены на активных графиках.

#### <a name="request"></a>Запрос

```
{
"methodName": "GraphInstanceSet",
    "payload": {
        "@apiVersion": "1.0",
        "name": "Camera001",
        "properties": {
            // Desired graph instance properties
        }
    }
}
```

#### <a name="response"></a>Ответ

````
{
    "status": 201,
    "payload": {
        "name": " Camera001",
        "properties": {
            // Complete graph instance
        }   
    }
}
````

#### <a name="status-codes"></a>Коды состояния

| Условие | Код состояния | Подробный код ошибки |
|--|--|--|
| Существующая сущность обновлена | 200 | Недоступно |
| Создана новая сущность | 201 | Недоступно |
| Общие ошибки пользователя | Ошибки диапазона 400 |  |
| Ошибки проверки графа | 400 | графвалидатионеррор |
| Ошибки проверки модуля | 400 | модулевалидатионеррор |
| Ошибки проверки ресурсов | 409 | ресаурцевалидатионеррор |
| Общие ошибки сервера | Ошибки диапазона 500 |  |  |

### <a name="graphinstancedelete"></a>графинстанцеделете

Удаляет один экземпляр графа.

Ключевые аспекты:

* Удалить можно только деактивированные графы.

#### <a name="request"></a>Запрос

```
{
    "methodName": "GraphInstanceDelete",
    "payload": {
        "@apiVersion": "1.0",
        "name": "Camera001"
    }
}
```

#### <a name="response"></a>Ответ

```
{
    "status": 200,
    "payload": null
}
```

#### <a name="status-codes"></a>Коды состояния

| Условие | Код состояния | Подробный код ошибки |
|--|--|--|
| Граф успешно удален | 200 | Недоступно |
| Граф не найден | 204 | Недоступно |
| Общие ошибки пользователя | Ошибки диапазона 400 |  |
| Граф не находится в состоянии "остановлено" | 409 | оператионноталловединстате |
| Общие ошибки сервера | Ошибки диапазона 500 |  |

### <a name="graphinstancelist"></a>графинстанцелист

Это похоже на Графтопологилист. Он позволяет использовать для перечисления экземпляров графа.
Извлекает список всех экземпляров графов, соответствующих условиям фильтра.

#### <a name="request"></a>Запрос

```
{
    "methodName": "GraphInstanceList",
    "payload": {
        // Required
        "@apiVersion": "1.0",
        
        // Optional
        "@continuationToken": "xxxxx",    
        "@query": "$orderby=name asc"
    }
}
```

#### <a name="response"></a>Ответ

```
{
    "status": 200,
    "payload": {
        "@continuationToken": "xxxx",
        "value": [
            {
                "name": "Capture & Record",
                // ...
            },
            {
                "name": "Capture, Analyze & Record",
                // ...
            }
        ]
    }
}
```

#### <a name="filter-support"></a>Поддержка фильтров

|Операция  |   Поля (ы)|   Операторы|
|---|---|---|
|$orderby|  name|   ASC|

#### <a name="status-codes"></a>Коды состояния

| Условие | Код состояния | Подробный код ошибки |
|--|--|--|
| Успешно | 200 | Недоступно |
| Общие ошибки пользователя | Ошибки диапазона 400 |  |
| Общие ошибки сервера | Ошибки диапазона 500 |  |

### <a name="graphinstanceactivate"></a>графинстанцеактивате

Активирует один экземпляр Graph. 

Ключевые аспекты

* Метод возвращается только при активации Graph 
* При активации Graph принимает состояние "Активация".

    * Операция List/Get на графе вернет граф в правильном состоянии.
* Идемпотентности

    * Запуск графика в состоянии "Активация" ведет себя так же, как если бы граф был деактивирован (т. е. блоки вызовов до активации Graph).
    * Немедленное активирование графа в состоянии "активный" успешно завершается.

#### <a name="request"></a>Запрос

```
{
    "methodName": "GraphInstanceActivate",
    "payload": {
        "@apiVersion": "1.0",
        "name": "Camera001"
    }
}
```

#### <a name="response"></a>Ответ

```
{
    "status": 200,
    "payload": null
}
```

#### <a name="status-codes"></a>Коды состояния

| Условие | Код состояния | Подробный код ошибки |
|--|--|--|
| Граф успешно активирован | 200 | Недоступно |
| Создана новая сущность | 201 | Недоступно |
| Общие ошибки пользователя | Ошибки диапазона 400 |  |
| Ошибки проверки модуля | 400 | модулевалидатионеррор |
| Ошибки проверки ресурсов | 409 | ресаурцевалидатионеррор |
| Граф находится в состоянии деактивации | 409 | оператионноталловединстате |
| Общие ошибки сервера | Ошибки диапазона 500 |  |

### <a name="graphinstancedeactivate"></a>графинстанцедеактивате

Деактивирует один экземпляр Graph. Деактивация графа корректно деактивирует обработку мультимедиа и гарантирует, что все события и носители, сохраняемые на границе, фиксируются в облаке, когда это применимо.

Ключевые аспекты:

* Метод возвращается только при деактивации графа
* При деактивации Graph принимает состояние "Деактивация".

    * Операция List/Get на графе вернет граф в правильном состоянии.
    * Выполнение останавливается только после отправки всех носителей в облако.
* Идемпотентности

    * Деактивация графа в состоянии "Деактивация" ведет себя так же, как если бы граф был деактивирован (т. е. блоки вызовов до деактивации Graph).
    * Немедленное отключение графа в состоянии "неактивно" успешно завершается.

#### <a name="request"></a>Запрос

```
{
    "methodName": "GraphInstanceDeactivate",
    // A high response timeout is recommended here since there might be data movement    // being executed as part of this operation
    "responseTimeoutInSeconds": 300,
    "payload": {
        "@apiVersion": "1.0",
        "name": "Camera001"
    }
}
```

#### <a name="response"></a>Ответ

```
{
    "status": 200,
    "payload": null
}
```

| Условие | Код состояния | Подробный код ошибки |
|--|--|--|
| Граф успешно активирован | 200 | Недоступно |
| Создана новая сущность | 201 | Недоступно |
| Общие ошибки пользователя | Ошибки диапазона 400 |  |
| Граф находится в состоянии активации | 409 | оператионноталловединстате |
| Общие ошибки сервера | Ошибки диапазона 500 |  |

## <a name="next-steps"></a>Дальнейшие действия

[Схема конфигурации двойника модуля](module-twin-configuration-schema.md)
