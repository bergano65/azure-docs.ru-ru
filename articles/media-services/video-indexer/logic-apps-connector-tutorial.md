---
title: Руководство по использованию соединителей Индексатора видео с приложением Logic Apps и Power Automate.
description: В этом руководстве показано, как получить новые возможности взаимодействия и монетизации, которые предоставляют соединители Индексатора видео в сочетании с приложением Logic Apps и Power Automate.
author: anzaman
manager: johndeu
ms.author: alzam
ms.service: media-services
ms.subservice: video-indexer
ms.topic: tutorial
ms.date: 05/01/2020
ms.openlocfilehash: 5f29e616c0643914ca28921eee481105a5feb0c5
ms.sourcegitcommit: 3d79f737ff34708b48dd2ae45100e2516af9ed78
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "87047107"
---
# <a name="tutorial-use-video-indexer-with-logic-app-and-power-automate"></a>Руководство по использованию Индексатора видео с приложением Logic Apps и Power Automate

[REST API Индексатора видео версии 2](https://api-portal.videoindexer.ai/docs/services/Operations/operations/Delete-Video?) в Службах мультимедиа Azure поддерживает передачу данных между серверами и от сервера к клиенту. Это позволяет пользователям Индексаторов видео интегрировать данные видео и аудио в логику приложений, что обеспечивает новые возможности взаимодействия и монетизации.

Чтобы еще больше упростить такую интеграцию, мы поддерживаем соединители для  [Logic Apps](https://azure.microsoft.com/services/logic-apps/)  и  [Power Automate](https://preview.flow.microsoft.com/connectors/shared_videoindexer-v2/video-indexer-v2/),  совместимые с нашим API. С помощью этих соединителей можно настроить пользовательские рабочие процессы для эффективного индексирования и извлечения полезных сведений из большого количества файлов видео и аудио без написания кода. Более того, применение соединителей для интеграции повышает точность оценки работоспособности рабочего процесса и упрощает его отладку.  

Чтобы быстро приступить к работе с соединителями Индексатора видео, выполните пошаговые инструкции по настройке примера решения, в котором используются приложение Logic Apps и Power Automate. 

В этом руководстве описано следующее:

> [!div class="checklist"]
> * автоматическая отправка и индексирование видео;
> * настройка потока для отправки файла;
> * настройка потока для извлечения JSON.

[!INCLUDE [quickstarts-free-trial-note](../../../includes/quickstarts-free-trial-note.md)]

## <a name="prerequisites"></a>Предварительные требования

Чтобы начать работу, вам потребуется учетная запись Индексатора видео, а также доступ к API через ключ API. 

Кроме того, понадобится учетная запись хранения Azure. Сохраните ключ доступа к учетной записи хранения. Создайте два контейнера: один для хранения видео и другой для хранения полезных сведений, которые создаст Индексатор видео.  

После этого нужно открыть два отдельных потока для Logic Apps или Power Automate (в зависимости от того, что вы предпочитаете использовать).  

## <a name="upload-and-index-your-video-automatically"></a>Автоматическая отправка и индексирование видео 

Этот сценарий состоит из двух разных потоков, которые работают вместе. Первый поток активируется при добавлении или изменении большого двоичного объекта в учетной записи хранения Azure. В Индексатор видео передается новый файл и URL-адрес обратного вызова, на который поступит уведомление по завершении индексирования. Второй поток активируется запросом на URL-адрес обратного вызова и сохраняет извлеченные полезные данные обратно в JSON-файл, размещенный в службе хранилища Azure. Такой подход с двумя потоками позволяет эффективно выполнять асинхронные процессы передачи и индексирования больших файлов. 

### <a name="set-up-the-file-upload-flow"></a>Настройка потока для отправки файла 

Первый поток активируется при любом добавлении большого двоичного объекта в контейнер службы хранилища Azure. После активации создается подписанный URL-адрес, который можно использовать для отправки и индексирования видео в Индексаторе видео. Сначала создайте указанный ниже поток. 

![Поток отправки файлов](./media/logic-apps-connector-tutorial/file-upload-flow.png)

Чтобы настроить первый поток, нужно предоставить ключ API Индексатора видео и учетные данные службы хранилища Azure. 

![хранилище BLOB-объектов Azure.](./media/logic-apps-connector-tutorial/azure-blob-storage.png)

![Имя подключения и ключ API](./media/logic-apps-connector-tutorial/connection-name-api-key.png)

Когда вы сможете подключиться к учетным записям службы хранилища Azure и Индексатора видео, перейдите к триггеру "При добавлении или изменении BLOB-объекта" и выберите контейнер, в который будете помещать видеофайлы. 

![Контейнер](./media/logic-apps-connector-tutorial/container.png)

Затем перейдите к действию создания URI SAS на основе пути и выберите вариант List of Files Path (Список путей к файлам) в разделе параметров динамического содержимого.  

![Создать URI SAS на основе пути](./media/logic-apps-connector-tutorial/sas-uri-by-path.jpg)

Укажите [расположение и идентификатор учетной записи](./video-indexer-use-apis.md#account-id) , чтобы получить маркер учетной записи Индексатора видео.

![Получение маркера доступа к учетной записи](./media/logic-apps-connector-tutorial/account-access-token.png)

В разделе Upload video and index (Отправить видео и индекс) введите обязательные параметры и URL-адрес видео. Щелкните "Добавить новый параметр" и выберите элемент "URL-адрес обратного вызова". 

![Отправка и индексирование](./media/logic-apps-connector-tutorial/upload-and-index.png)

URL-адрес обратного вызова пока не указывайте. Вы его добавите, когда будет готов второй поток, при создании которого создается сам URL-адрес обратного вызова. 

Для остальных параметров можно использовать значения по умолчанию или задать другие в соответствии с вашими потребностями. 

Щелкните "Сохранить" и переходите к настройке второго потока, который извлекает полезные сведения после завершения отправки и индексирования. 

## <a name="set-up-the-json-extraction-flow"></a>Настройка потока для извлечения JSON 

Завершение передачи и индексирования, запущенных из первого потока, приводит к созданию HTTP-запроса на правильный URL-адрес обратного вызова, который активирует второй поток. Этот поток получит полезные сведения, созданные Индексатором видео. В нашем примере он сохраняет выходные данные задания индексирования в службе хранилище Azure.  Но вы сами решаете, что нужно сделать с выходными данными.  

Создайте второй поток отдельно от первого. 

![Поток для извлечения JSON](./media/logic-apps-connector-tutorial/json-extraction-flow.png)

Чтобы настроить новый поток, нужно снова предоставить ключ API Индексатора видео и учетные данные службы хранилища Azure. Вам потребуется обновить те же параметры, что и для первого потока. 

Для триггера предлагается поле "URL-адрес HTTP POST". Этот URL-адрес не будет создан, пока вы не сохраните новый поток. Но для полной системы он является обязательным. Мы вернемся к нему немного позже. 

Укажите [расположение и идентификатор учетной записи](./video-indexer-use-apis.md#account-id) , чтобы получить маркер учетной записи Индексатора видео.  

Перейдите к действию получения индекса видео и укажите необходимые параметры. В качестве идентификатора видео введите следующее выражение: triggerOutputs()['queries']['id']. 

![Сведения о действии Индексатора видео](./media/logic-apps-connector-tutorial/video-indexer-action-info.jpg)

Это выражение сообщает соединителю, что нужно получить идентификатор видео из выходных данных триггера. В нашем примере выходными данными триггера является результат операции отправки видео и индекса из первого триггера. 

Перейдите к действию создания большого двоичного объекта и выберите путь к папке, в которой будут сохранены полезные сведения. Укажите имя большого двоичного объекта, который вы создаете. В качестве содержимого большого двоичного объекта вставьте следующее выражение: body(‘Get_Video_Index’). 

![Действие создания большого двоичного объекта](./media/logic-apps-connector-tutorial/create-blob-action.jpg)

Это выражение принимает выходные данные действия получения индекса видео из этого потока. 

Щелкните "Сохранить поток". 

При сохранении потока в триггере создается URL-адрес HTTP POST. Скопируйте этот URL-адрес из триггера. 

![Сохранение триггера URL-адреса](./media/logic-apps-connector-tutorial/save-url-trigger.png)

Теперь вернитесь к первому потоку и вставьте URL-адрес в параметре "URL-адрес обратного вызова" для действия отправки видео и индекса. 

Сохраните оба потока. На этом процесс будет завершен. 

Протестируйте вновь созданное приложение Logic Apps или Power Automate, добавив видео в контейнер BLOB-объектов Azure. Через несколько минут проверьте наличие полезных сведений в папке назначения. 

## <a name="clean-up-resources"></a>Очистка ресурсов

После работы с этим руководством вы можете сохранить созданное решение на основе Logic Apps или Power Automate, используя его по мере необходимости. Но если вы не хотите продолжать работу и оплачивать использование решения, отключите оба потока (действие Turn Off в Power Automate или Disable в Logic Apps). 

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы увидели лишь один пример использования соединителей Индексатора видео. Вы можете применить соединители Индексатора видео для любого вызова API, поддерживаемого Индексатором видео. Например, для отправки и получения аналитических сведений, преобразования результатов, получения встраиваемых мини-приложений и даже настройки моделей. Кроме того, эти действия можно активировать по разным источникам, например по обновлениям репозиториев файлов или по отправлению сообщений электронной почты. Затем можно настроить обновление инфраструктуры или создание любого количества действий в приложении на основе полученных результатов.  

> [!div class="nextstepaction"]
> [Использование API Индексатора видео](video-indexer-use-apis.md)
