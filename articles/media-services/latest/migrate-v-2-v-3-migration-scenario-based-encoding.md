---
title: Кодирование руководства по миграции
description: Эта статья содержит рекомендации по кодированию на основе сценариев, которые помогут вам выполнить миграцию из служб мультимедиа Azure версии 2 в v3.
services: media-services
author: IngridAtMicrosoft
manager: femila
ms.service: media-services
ms.topic: conceptual
ms.workload: media
ms.date: 1/14/2020
ms.author: inhenkel
ms.openlocfilehash: ab819239572fd99fdf5ff3bf23f81eb3cdff3b9a
ms.sourcegitcommit: 2f9f306fa5224595fa5f8ec6af498a0df4de08a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2021
ms.locfileid: "98940094"
---
# <a name="encoding-scenario-based-migration-guidance"></a>Кодирование рекомендаций по миграции на основе сценариев

![логотип с руководством по миграции](./media/migration-guide/azure-media-services-logo-migration-guide.svg)

<hr color="#5ea0ef" size="10">

![шаги миграции 2](./media/migration-guide/steps-4.svg)

Эта статья содержит рекомендации по кодированию на основе сценариев, которые помогут вам выполнить миграцию из служб мультимедиа Azure версии 2 в v3.

## <a name="prerequisites"></a>Предварительные требования

Прежде чем приступить к изменению рабочего процесса кодирования, рекомендуется понимать различия в способах управления хранилищем.  В AMS v3 API службы хранилища Azure используется для управления учетными записями хранения, связанными с учетной записью служб мультимедиа.

> [!NOTE]
> Задания и задачи, созданные в версии 2, не отображаются в v3, так как они не связаны с преобразованием. Рекомендуется переключиться на преобразования и задания версии 3.

## <a name="encoding-workflow-comparison"></a>Сравнение операций кодирования рабочих процессов

Потратьте несколько минут на просмотр показанных ниже блок-схем для визуального сравнения рабочих процессов кодирования для версий v2 и v3.

### <a name="v2-encoding-workflow"></a>Рабочий процесс кодирования версии 2

Щелкните изображение ниже, чтобы просмотреть более новую версию.

[![Кодирование рабочего процесса для v2 ](./media/migration-guide/V2-pretty.svg)](./media/migration-guide/V2-pretty.svg#lightbox)

1. Настройка
    1. Создайте ресурс или используйте и существующий ресурс. При использовании нового ресурса Отправьте содержимое в этот ресурс. При использовании существующего ресурса необходимо кодировать файлы, которые уже существуют в ресурсе.
    2. Получить значения следующих элементов:
        - Идентификатор или объект обработчика мультимедиа
        - Строка кодировщика (имя) кодировщика, который вы хотите использовать.
        - Идентификатор актива нового ресурса или идентификатор актива существующего актива
    3. Для мониторинга создайте подписку на уведомления на уровне задания или задачи или обработчик событий SDK.
2. Создайте задание, содержащее задачу или задачи. Каждая задача должна включать указанные выше элементы и:
    - Директива, для которой необходимо создать выходной ресурс.  Выходной ресурс создается системой.
    - Необязательное имя выходного ресурса
3. Отправка задания.
4. Наблюдение за заданием.

### <a name="v3-encoding-workflow"></a>Рабочий процесс кодирования v3

[![Кодирование рабочего процесса для v3 ](./media/migration-guide/V3-pretty.svg)](./media/migration-guide/V3-pretty.svg#lightbox)

1. Настройка
    1. Создайте ресурс или используйте и существующий ресурс. При использовании нового ресурса Отправьте содержимое в этот ресурс. При использовании существующего ресурса необходимо кодировать файлы, которые уже существуют в ресурсе. Не следует *отправлять больше содержимого в этот ресурс.*
    1. Создание выходного ресурса  Выходной ресурс — это место, где будут храниться закодированные файлы и метаданные входных и выходных данных.
    1. Получить значения для преобразования:
        - Стандартная Предустановка кодировщика
        - Группа ресурсов AMS
        - Имя учетной записи AMS
    1. Создайте преобразование или используйте существующее преобразование.  Преобразования можно использовать повторно. Нет необходимости создавать новое преобразование каждый раз, когда нужно отправить задание.
1. Создание задания
    1. Для задания получите значения для следующих элементов:
        - Имя преобразования
        - Base-URI для URL-адреса SAS для ресурса, исходный путь HTTPs общей папки или локальный путь к файлам. В `JobInputAsset` качестве входных данных можно также использовать имя ресурса.
        - Имена файлов
        - Выходной ресурс-контейнер (ы)
        - группа ресурсов;
        - Имя учетной записи AMS  
1. Используйте [сетку событий](monitor-events-portal-how-to.md) для мониторинга задания.
1. Отправка задания.

## <a name="custom-presets-from-v2-to-v3-encoding"></a>Пользовательские предустановки из версии v2 в кодировке v3

Если код v2 назывался стандартным кодировщиком с пользовательской загрузкой, сначала необходимо создать новое преобразование с помощью настраиваемой предустановки кодировщика Standard, прежде чем отправлять задание.

Пользовательские предустановки теперь являются JSON и больше не основаны на XML. Повторно создайте предустановку в формате JSON после пользовательской предустановки схемы, как определено в документации по [преобразованию Open API (Swagger)](https://github.com/Azure/azure-rest-api-specs/blob/master/specification/mediaservices/resource-manager/Microsoft.Media/stable/2020-05-01/examples/transforms-create.json) .


<!-- removed because this is covered in the tutorials
Common custom [encoding](https://github.com/Azure/azure-rest-api-specs/blob/master/specification/mediaservices/resource-manager/Microsoft.Media/stable/2020-05-01/Encoding.json) scenarios:
        1. Create a custom Single Bitrate MP4 encode
        1. Create a custom [Adaptive Bitrate Encoding Ladder](autogen-bitrate-ladder.md)
        1. Creating Sprite Thumbnails
        1. Creating Thumbnails (see below for your preferred method)
        1. [Sub Clipping](subclip-video-rest-howto.md)
        1. Cropping
-->

## <a name="input-and-output-metadata-files-from-an-encoding-job"></a>Входные и выходные файлы метаданных из задания кодирования

В версии 2 входные и выходные XML-файлы метаданных создаются в результате задания кодирования. В версии 3 формат метаданных изменился с XML на JSON. Дополнительные сведения о метаданных см. в разделе [входные метаданные](input-metadata-schema.md) и [выходные метаданные](output-metadata-schema.md).

## <a name="premium-encoder-to-v3-standard-encoder-or-partner-based-solutions"></a>Кодировщик Premium для стандартных кодировщиков или решений на основе партнеров

API v2 больше не поддерживает кодировщик Premium. Если ранее вы использовали кодировщик Premium на основе рабочих процессов для кодирования HEVC, необходимо перейти на новый [стандартный кодировщик](media-encoder-standard-formats.md) v3 с поддержкой кодирования HEVC.

Если вам нужны функции расширенного рабочего процесса кодировщика Premium, вы можете приступить к использованию решения Azure для партнеров в сфере кодирования, используя для себя [связь](https://imaginecommunications.com), [телепоток](https://www.telestream.net)или [битмовин](https://bitmovin.com).

## <a name="jobs-with-inputs-that-are-on-https-hosted-urls"></a>Задания с входными данными на URL-адресах, размещенных по протоколу HTTPS

Теперь можно отправлять задания в версии 3 из файлов, хранящихся в службе хранилища Azure, локально или на внешних веб-серверах, используя [поддержку входных данных заданий HTTP (S)](job-input-from-http-how-to.md).

Если ранее вы использовали рабочие процессы для копирования файлов из файлов больших двоичных объектов Azure в пустые активы перед отправкой заданий, вы можете упростить рабочий процесс, передав URL-адрес SAS для файла в хранилище больших двоичных объектов Azure непосредственно в задание.

## <a name="indexer-v1-audio-transcription-to-the-new-audioanalyzer-basic-mode"></a>Запись звука индексатора v1 в новый Аудиоанализер "базовый режим"

Для клиентов, использующих процессор индексатора v1 в API v2, необходимо создать преобразование, которое вызывает новый `AudioAnalyzer` [режим в базовом режиме](how-to-create-basic-audio-transform.md) перед отправкой задания.

## <a name="encoding-transforms-and-jobs-concepts-tutorials-and-how-to-guides"></a>Концепция кодирования, преобразования и задания, руководства и инструкции

### <a name="concepts"></a>Основные понятия

- [Кодирование видео и аудио с помощью служб мультимедиа](encoding-concept.md)
- [Стандартные форматы и кодеки кодировщика](media-encoder-standard-formats.md)
- [Кодирование с помощью автоматически созданной лестнице скорости](autogen-bitrate-ladder.md)
- [Используйте предустановку кодирования с поддержкой содержимого, чтобы найти оптимальное значение скорости для заданного разрешения.](content-aware-encoding.md)
- [Зарезервированные единицы мультимедиа](concept-media-reserved-units.md)
- [Входные метаданные](input-metadata-schema.md)
- [Выходные метаданные](output-metadata-schema.md)
- [Динамическая упаковка в службах мультимедиа V3: Аудиокодеки](dynamic-packaging-overview.md#audio-codecs-supported-by-dynamic-packaging)

### <a name="tutorials"></a>Учебники

- [Руководство по кодированию удаленного файла на основе URL-адреса и потоковой передачи видео с помощью .NET](stream-files-dotnet-quickstart.md)
- [Руководство по Отправка, кодировка и потоковая передача видео с помощью Служб мультимедиа версии 3](stream-files-tutorial-with-api.md)

### <a name="how-to-guides"></a>Практические руководства

- [Создание входных данных задания из URL-адреса HTTPS](job-input-from-http-how-to.md)
- [Создание входных данных задания из локального файла](job-input-from-local-file-how-to.md)
- [Создание базового преобразования звука](how-to-create-basic-audio-transform.md)
- С помощью .NET
  - [Кодирование с помощью пользовательского преобразования — .NET](customize-encoder-presets-how-to.md)
  - [Создание наложения с помощью Media Encoder Standard](how-to-create-overlay.md)
  - [Создание эскизов с помощью кодировщика Standard в .NET](media-services-generate-thumbnails-dotnet.md)
- С помощью Azure CLI
  - [Как кодировать с помощью пользовательского преобразования Azure CLI](custom-preset-cli-howto.md)
- С помощью REST
  - [Как кодировать с пользовательским преобразованием — остальное](custom-preset-rest-howto.md)
  - [Создание эскизов с помощью кодировщика Standard](media-services-generate-thumbnails-rest.md)
- [Подрезать видео при кодировании с помощью служб мультимедиа — .NET](subclip-video-dotnet-howto.md)
- [Подрезать видео при кодировании со службами мультимедиа — остальное](subclip-video-rest-howto.md)

## <a name="samples"></a>Примеры

Кроме того, можно [сравнить код v2 и v3 в примерах кода](migrate-v-2-v-3-migration-samples.md).

## <a name="next-steps"></a>Дальнейшие действия

[!INCLUDE [migration guide next steps](./includes/migration-guide-next-steps.md)]
