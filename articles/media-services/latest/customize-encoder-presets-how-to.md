---
title: Кодирование пользовательского преобразования .NET
description: В этом разделе показано, как использовать службы мультимедиа Azure v3 для кодирования пользовательского преобразования с помощью .NET.
services: media-services
documentationcenter: ''
author: IngridAtMicrosoft
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: how-to
ms.date: 08/31/2020
ms.author: inhenkel
ms.custom: seodec18
ms.openlocfilehash: c8c9f1deb1b776a818269909b3feb19f00a2c356
ms.sourcegitcommit: 4e70fd4028ff44a676f698229cb6a3d555439014
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2021
ms.locfileid: "98954282"
---
# <a name="how-to-encode-with-a-custom-transform---net"></a>Кодирование с помощью пользовательского преобразования — .NET

[!INCLUDE [media services api v3 logo](./includes/v3-hr.md)]

При кодировании со службами мультимедиа Azure вы можете быстро приступить к работе с помощью одной из рекомендуемых встроенных предустановок на основе отраслевых рекомендаций, как показано в руководстве по работе с [файлами потоковой передачи](stream-files-tutorial-with-api.md) . Вы также можете создать пользовательскую предустановку, предназначенную для конкретных сценариев или требований к устройствам.

## <a name="considerations"></a>Рекомендации

При создании пользовательских предустановок применяются следующие соображения.

* Все значения высоты и ширины в содержимом AVC должны быть кратными 4.
* В службах мультимедиа Azure v3 все скорости кодирования находятся в битах в секунду. Это отличается от предустановок с помощью API v2, которые использовались в килобитах в секунду в качестве единицы измерения. Например, если скорость в v2 была указана как 128 (килобит в секунду), то в v3 будет установлено значение 128000 (бит/сек).

## <a name="prerequisites"></a>Предварительные требования 

[Создание учетной записи Служб мультимедиа](./create-account-howto.md)

## <a name="download-the-sample"></a>Скачивание примера

Клонируйте репозиторий GitHub, содержащий пример .NET Core, на компьютер с помощью следующей команды:  

 ```bash
 git clone https://github.com/Azure-Samples/media-services-v3-dotnet-core-tutorials.git
 ```
 
Пример настраиваемой предустановки находится в папке [EncodeCustomTransform](https://github.com/Azure-Samples/media-services-v3-dotnet-core-tutorials/blob/master/NETCore/EncodeCustomTransform/).

## <a name="create-a-transform-with-a-custom-preset"></a>Создание преобразования с помощью настраиваемой предустановки 

При создании [преобразования](/rest/api/media/transforms) необходимо указать, что требуется создать в качестве выходных данных. Обязательный параметр — это объект [TransformOutput](/rest/api/media/transforms/createorupdate#transformoutput), как показано в приведенном ниже примере кода. Каждый объект **TransformOutput** содержит **предустановку** (Preset). Эта **Предустановка** описывает пошаговые инструкции по обработке видео и (или) аудио-обработки, которые используются для создания нужных **трансформаутпут**. Следующая предустановка **TransformOutput** создает настраиваемый кодек и параметры слоя вывода.

При создании [преобразования](/rest/api/media/transforms) сначала проверьте, существует ли оно, с помощью метода **Get**, как показано в следующем коде. В службах мультимедиа v3 методы **Get** для сущностей возвращают **значение NULL** , если сущность не существует (в имени не учитывается регистр).

### <a name="example"></a>Пример

В следующем примере определяется набор выходов, которые нужно создать при использовании этого преобразования. Сначала мы добавим слой AacAudio для кодирования звука и два слоя H264Video для кодирования видео. В видеослоях мы присваиваем метки, чтобы их можно было использовать в именах выходных файлов. Далее мы хотим, чтобы выходные данные также включали эскизы. В приведенном ниже примере мы указываем изображения в формате PNG, созданные на 50% от разрешения входного видео и три метки времени — {25%, 50%, 75%} длиной входного видео. Наконец, мы указываем формат выходных файлов — один для видео + аудио, а другой — для эскизов. Так как у нас есть несколько H264Layers, необходимо использовать макросы, которые создают уникальные имена для каждого слоя. Можно использовать `{Label}` `{Bitrate}` макрос или, а в примере — первый.

[!code-csharp[Main](../../../media-services-v3-dotnet-core-tutorials/NETCore/EncodeCustomTransform/MediaV3ConsoleApp/Program.cs#EnsureTransformExists)]

## <a name="next-steps"></a>Дальнейшие действия

[Файлы потоковой передачи](stream-files-tutorial-with-api.md) 
