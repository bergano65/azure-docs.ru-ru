---
title: Миграция из версии 2 в версию 3 Служб мультимедиа Azure | Документация Майкрософт
description: В этой статье описаны изменения, которые впервые появились в версии 3 Служб мультимедиа Azure, и приведены различия между двумя версиями. Она также содержит руководство по миграции из версии 2 в версию 3 Служб мультимедиа.
services: media-services
documentationcenter: na
author: Juliako
manager: femila
editor: ''
tags: ''
keywords: azure media services, stream, broadcast, live, offline
ms.service: media-services
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: multiple
ms.workload: media
ms.date: 05/01/2019
ms.author: juliako
ms.openlocfilehash: 003cc54a07455118969a2dd497e9b963c03f68f2
ms.sourcegitcommit: b45ee7acf4f26ef2c09300ff2dba2eaa90e09bc7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73099492"
---
# <a name="migration-guidance-for-moving-from-media-services-v2-to-v3"></a>Руководство по миграции из версии 2 в версию 3 Служб мультимедиа

В этой статье описаны изменения, которые впервые появились в Службе мультимедиа Azure версии 3, приведены различия между двумя версиями и предоставлено руководство по миграции.

Если у вас есть видеослужба, разработанная на основе [устаревших API Служб мультимедиа версии 2](../previous/media-services-overview.md), ознакомьтесь со следующими рекомендациями и советами перед переносом в API версии 3. В версии 3 API существует множество преимуществ и новых функций, которые улучшают возможности разработки и Служб мультимедиа. Однако, как указано в разделе с [известными проблемами](#known-issues) этой статьи, из-за изменений между версиями API существуют определенные ограничения. Эта страница будет сохранена, так как команда Служб мультимедиа продолжает улучшать API версии 3 и устранять "пробелы" между версиями. 

> [!NOTE]
> В настоящее время вы не можете использовать портал Azure для управления ресурсами версии 3. Используйте [REST API](https://aka.ms/ams-v3-rest-ref), [CLI](https://aka.ms/ams-v3-cli-ref) или один из поддерживаемых [пакетов SDK](media-services-apis-overview.md#sdks).

## <a name="benefits-of-media-services-v3"></a>Преимущества Служб мультимедиа версии 3
  
### <a name="api-is-more-approachable"></a>Более доступный API

*  Версия 3 создана на основе унифицированной области API, что позволяет использовать функции управления и операции, встроенные в Azure Resource Manager. Шаблоны Azure Resource Manager можно использовать для создания и развертывания преобразований, конечных точек потоковой передачи, событий потоковой трансляции и т. д.
* [Спецификация OpenAPI (прежнее название — Swagger)](https://aka.ms/ams-v3-rest-sdk) .
    Представляет схему для всех компонентов службы, включая кодирование на основе файла.
* Пакеты SDK для [.NET](https://aka.ms/ams-v3-dotnet-ref), .NET Core, [Node.js](https://aka.ms/ams-v3-nodejs-ref), [Python](https://aka.ms/ams-v3-python-ref), [Java](https://aka.ms/ams-v3-java-ref), [Go](https://aka.ms/ams-v3-go-ref) и Ruby.
* Интеграция [Azure CLI](https://aka.ms/ams-v3-cli-ref) для простых скриптов поддержки.

### <a name="new-features"></a>Новые функции

* Для обработки задания на основе файла можно использовать URL-адрес HTTP в качестве входных данных.<br/>Вам не обязательно ни хранить содержимое в Azure, ни создавать ресурсы.
* Для обработки задания на основе файла введено понятие [преобразования](transforms-jobs-concept.md). Преобразование можно использовать для создания повторно используемых конфигураций, создания шаблонов Azure Resource Manager и изолирования параметров обработки между несколькими пользователями или клиентами.
* Ресурс может иметь несколько [указателей потоковой передачи](streaming-locators-concept.md) с различными параметрами [динамической упаковки](dynamic-packaging-overview.md) и динамического шифрования.
* [Защита содержимого](content-key-policy-concept.md) поддерживает несколько ключевых возможностей.
* Вы можете вести потоковую трансляцию событий в реальном времени длительностью до 24 часов, используя Службы мультимедиа для перекодирования исходного потока с одной скоростью в поток вывода с несколькими скоростями.
* Новая поддержка потоковой трансляции в реальном времени с низкой задержкой в событиях потоковой трансляции. Дополнительные сведения см. в разделе с описанием [задержки](live-event-latency.md).
* Предварительная версия событий потоковой трансляции поддерживает [динамическую упаковку](dynamic-packaging-overview.md) и динамическое шифрование. Это включает защиту содержимого в предварительной версии, а также упаковки DASH и HLS.
* Выходные данные потоковой трансляции проще в использовании, чем старая сущность Program в версии 2 API-интерфейсов. 
* Улучшенная поддержка RTMP (повышенная стабильность и поддержка исходного кодировщика).
* Безопасный прием RTMPS.<br/>При создании события потоковой трансляции вы получаете 4 URL-адреса приема. 4 URL-адреса приема практически идентичны, они имеют тот же токен потоковой передачи (AppId) с отличной частью номера порта. Два из URL-адресов являются первичными и резервными для RTMPS.   
* Вы контролируете доступ к своим сущностям с помощью управления доступом на основе ролей. 

## <a name="changes-from-v2"></a>Отличия от версии 2

* Для ресурсов, созданных с помощью v3, службы мультимедиа поддерживают только [Шифрование хранилища на стороне сервера хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-service-encryption).
    * Вы можете использовать API версии 3 с ресурсами, созданными с помощью API версии 2, в которых есть [шифрование хранилища](../previous/media-services-rest-storage-encryption.md) (AES 256), предоставляемое Службами мультимедиа.
    * Вы не можете создать ресурсы с устаревшим [шифрованием хранилища](../previous/media-services-rest-storage-encryption.md) AES 256 с помощью API версии 3.
* Свойства [ресурса](assets-concept.md)в v3 отличаются от версии 2. см. [сведения о сопоставлении свойств](assets-concept.md#map-v3-asset-properties-to-v2).
* Пакеты SDK версии 3 теперь лишаются хранилища SDK, что обеспечивает больший контроль над используемой версией хранилища SDK и позволяет избежать проблем с управлением версиями. 
* В API версии 3 вся скорость кодировки указана в битах за секунду. Это отличается от предустановок Media Encoder Standard версии 2. Например, скорость в версии 2 указывается как 128 (кбит/с), а в версии 3 она имела бы значение 128 000 (бит/с). 
* Сущности AssetFiles, AccessPolicies и IngestManifests не существуют в версии 3.
* Свойство IAsset.ParentAssets в версии 3 отсутствует.
* ContentKeys — это больше не сущность, а свойство указателя потоковой передачи.
* Служба "Сетка событий" заменяет NotificationEndpoints.
* Следующие сущности были переименованы:
    * Выходные данные задания заменяют задачу и теперь являются частью задания.
    * Указатель потоковой передачи заменяет Locator.
    * Событие потоковой трансляции заменяет Channel.<br/>Выставление счетов за события потоковой трансляции основано на метриках динамического канала. Для получения дополнительных сведений ознакомьтесь с [выставлением счетов](live-event-states-billing.md) и [ценами](https://azure.microsoft.com/pricing/details/media-services/).
    * Выходные данные потоковой трансляции заменяют Program.
* Выходные данные прямой трансляции запускаются при создании и останавливаются при удалении. Программы работали иначе в API версии 2, они должны были запускаться после создания.
* Чтобы получить сведения о задании, необходимо знать имя преобразования, под которым было создано задание. 
* В версии 2 [входные](../previous/media-services-input-metadata-schema.md) и [выходные](../previous/media-services-output-metadata-schema.md) XML-файлы метаданных создаются в результате задания кодирования. В версии 3 формат метаданных изменился с XML на JSON. 

> [!NOTE]
> Ознакомьтесь с соглашениями об именовании, которые применяются к [ресурсам служб мультимедиа v3](media-services-apis-overview.md#naming-conventions). Также проверьте [имена больших двоичных объектов](assets-concept.md#naming-blobs).

## <a name="feature-gaps-with-respect-to-v2-apis"></a>Недочеты функций по отношению к API версии 2

API версии 3 содержит следующие недочеты функций относительно API версии 2. Устранение недочетов не завершено.

* [Кодировщик (цен. категория "Премиум")](../previous/media-services-premium-workflow-encoder-formats.md) и [устаревшие обработчики аналитики мультимедиа](../previous/media-services-analytics-overview.md) (Предварительная версия индексатора Служб мультимедиа Azure версии 2, скрытие лиц и т. д.) недоступны в версии 3.<br/>Пользователи, желающие выполнить миграцию из предварительной версии индексатора мультимедийных данных версии 1 или 2, могут немедленно использовать предустановку AudioAnalyzer в API версии 3.  Эта новая предустановка содержит больше возможностей, чем старые индексаторы мультимедийных данных версии 1 или 2. 
* Многие [Расширенные функции Media Encoder Standard в API v2](../previous/media-services-advanced-encoding-with-mes.md) в настоящее время недоступны в версии 3, например:
  
    * Совмещение ресурсов
    * Наложения
    * Обрезка
    * Спрайты эскизов
    * Вставка автоматической звуковой дорожки, если входные данные не имеют звука
    * Вставка видеодорожки, если у ввода нет видео
* Сейчас события потоковой трансляции с перекодированием не поддерживают вставку баннера в поток и вставку рекламного маркера через вызов API. 

> [!NOTE]
> Добавьте эту статью в закладки и проверяйте ее на наличие обновлений.
 
## <a name="code-differences"></a>Отличия в коде

Следующая таблица показывает разницу в коде между версией 2 и 3 в распространенных сценариях.

|Сценарий|API версии 2|API версии 3|
|---|---|---|
|Создайте ресурс и отправьте файл. |[Пример .NET версии 2](https://github.com/Azure-Samples/media-services-dotnet-dynamic-encryption-with-aes/blob/master/DynamicEncryptionWithAES/DynamicEncryptionWithAES/Program.cs#L113)|[Пример .NET версии 3](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/UploadEncodeAndStreamFiles/Program.cs#L169)|
|Отправка задания|[Пример .NET версии 2](https://github.com/Azure-Samples/media-services-dotnet-dynamic-encryption-with-aes/blob/master/DynamicEncryptionWithAES/DynamicEncryptionWithAES/Program.cs#L146)|[Пример .NET версии 3](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/UploadEncodeAndStreamFiles/Program.cs#L298)<br/><br/>Показано, как сначала создать преобразование, а затем отправить задание.|
|Опубликуйте ресурс с шифрованием AES. |1. Создание Контенткэйаусоризатионполициоптион<br/>2. Создание ContentKeyAuthorizationPolicy<br/>3. Создание AssetDeliveryPolicy<br/>4. Создание ресурса и отправка содержимого или отправка задания и использование выходного ресурса<br/>5. Связывание AssetDeliveryPolicy с ресурсом<br/>6. Создание ContentKey<br/>7. Подключение ContentKey к активу<br/>8. Создание AccessPolicy<br/>9. Создание локатора<br/><br/>[Пример .NET версии 2](https://github.com/Azure-Samples/media-services-dotnet-dynamic-encryption-with-aes/blob/master/DynamicEncryptionWithAES/DynamicEncryptionWithAES/Program.cs#L64)|1. Создание политики ключа содержимого<br/>2. Создание ресурса<br/>3. Отправка содержимого или использование ресурса в качестве Жобаутпут<br/>4. Создание указателя потоковой передачи<br/><br/>[Пример .NET версии 3](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/EncryptWithAES/Program.cs#L105)|
|Получение сведений о заданиях и управление заданиями |[Управление заданиями с помощью версии 2](../previous/media-services-dotnet-manage-entities.md#get-a-job-reference) |[Управление заданиями с помощью v3](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/UploadEncodeAndStreamFiles/Program.cs#L546)|

## <a name="known-issues"></a>Известные проблемы

* В настоящее время вы не можете использовать портал Azure для управления ресурсами версии 3. Используйте [REST API](https://aka.ms/ams-v3-rest-sdk), CLI или один из поддерживаемых пакетов SDK.
* Подготовьте зарезервированные единицы мультимедиа (MRU) в вашей учетной записи, чтобы управлять параллелизмом и производительностью заданий, особенно тех, что касаются видео- или аудиоанализа. Дополнительные сведения см. в статье [Обзор масштабирования обработки мультимедиа](../previous/media-services-scale-media-processing-overview.md). Управлять единицами MRU можно с помощью [CLI 2.0 для Служб мультимедиа версии 3](media-reserved-units-cli-how-to.md), [портала Azure](../previous/media-services-portal-scale-media-processing.md) или [API-интерфейсов версии 2](../previous/media-services-dotnet-encoding-units.md). Подготавливать единицы MRU нужно с учетом того, какая версия API Служб мультимедиа используется: версия 2 или 3.
* С помощью API версии 2 нельзя управлять сущностями Cлужбы мультимедиа, созданными с помощью API версии 3.  
* Сущностями, которые были созданы с помощью интерфейсов API версии 2, не рекомендуется управлять с помощью API версии 3. Ниже приведены примеры различий, которые делают несовместимыми сущности в двух версиях:   
    * Задания и задачи, созданные в версии 2, не отображаются в версии 3, так как они не связаны с преобразованием. Рекомендуется переключиться на преобразования и задания версии 3. Относительно короткий период времени, необходимый для наблюдения за потоком версии 2 во время переключения.
    * Каналами и программами, созданными с помощью версии 2 (которые сопоставляются с событиями потоковой трансляции и их выходными данными в версии 3), невозможно управлять с помощью версии 3. Рекомендуется переключиться на события потоковой трансляции и их выходные данные в версии 3 в удобном канале остановки.<br/>В настоящее время постоянно работающие каналы нельзя переносить.  

> [!NOTE]
> Эта страница будет сохранена, так как команда Служб мультимедиа продолжает улучшать API версии 3 и устранять "пробелы" между версиями.

## <a name="ask-questions-give-feedback-get-updates"></a>Получение справки, отправка отзывов, получение обновлений

Прочитайте статью [сообщества Служб мультимедиа Azure](media-services-community.md), чтобы узнать, как задавать вопросы, оставлять отзывы и получать новости о Службах мультимедиа.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать, как легко начать кодирование и потоковую передачу видеофайлов, ознакомьтесь со сведениями о [файлах потоковой передачи](stream-files-dotnet-quickstart.md). 

