---
title: Миграция из версии 2 в версию 3 Служб мультимедиа Azure | Документация Майкрософт
description: В этой статье описаны изменения, которые впервые появились в версии 3 Служб мультимедиа Azure, и приведены различия между двумя версиями.
services: media-services
documentationcenter: na
author: Juliako
manager: femila
editor: ''
tags: ''
keywords: azure media services, stream, broadcast, live, offline
ms.service: media-services
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: multiple
ms.workload: media
ms.date: 11/07/2018
ms.author: juliako
ms.openlocfilehash: 8c3ff4af3b556614d0b2179dceed6cabd9cbabff
ms.sourcegitcommit: b62f138cc477d2bd7e658488aff8e9a5dd24d577
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/13/2018
ms.locfileid: "51616016"
---
# <a name="migration-guidance-for-moving-from-media-services-v2-to-v3"></a>Руководство по миграции из версии 2 в версию 3 Служб мультимедиа

В этой статье описаны изменения, которые впервые появились в Службе мультимедиа Azure версии 3, приведены различия между двумя версиями и предоставлено руководство по миграции.

Если у вас есть видеослужба, разработанная на основе [устаревших API Служб мультимедиа версии 2](../previous/media-services-overview.md), ознакомьтесь со следующими рекомендациями и советами перед переносом в API версии 3. В версии 3 API существует множество преимуществ и новых функций, которые улучшают возможности разработки и Служб мультимедиа. Однако, как указано в разделе с [известными проблемами](#known-issues) этой статьи, из-за изменений между версиями API существуют определенные ограничения. Эта страница будет сохранена, так как команда Служб мультимедиа продолжает улучшать API версии 3 и устранять "пробелы" между версиями. 

## <a name="benefits-of-media-services-v3"></a>Преимущества Служб мультимедиа версии 3

### <a name="api-is-more-approachable"></a>Более доступный API

*  Версия 3 создана на основе унифицированной области API, что позволяет использовать функции управления и операции, встроенные в Azure Resource Manager. Шаблоны Azure Resource Manager можно использовать для создания и развертывания преобразований, конечных точек потоковой передачи, событий прямой трансляции и т. д.
* Документ [спецификации Open API (также называемый Swagger)](https://aka.ms/ams-v3-rest-sdk).
    Представляет схему для всех компонентов службы, включая кодирование на основе файла.
* Пакеты SDK для [.NET](https://aka.ms/ams-v3-dotnet-ref), .NET Core, [Node.js](https://aka.ms/ams-v3-nodejs-ref), [Python](https://aka.ms/ams-v3-python-ref), [Java](https://aka.ms/ams-v3-java-ref), [Go](https://aka.ms/ams-v3-go-ref) и Ruby.
* Интеграция [Azure CLI](https://aka.ms/ams-v3-cli-ref) для простых скриптов поддержки.

### <a name="new-features"></a>новые функции;

* Для обработки задания на основе файла можно использовать URL-адрес HTTP в качестве входных данных.
    Вам не обязательно ни хранить содержимое в Azure, ни создавать ресурсы.
* Для обработки задания на основе файла введено понятие [преобразования](transforms-jobs-concept.md). Преобразование можно использовать для создания повторно используемых конфигураций, создания шаблонов Azure Resource Manager и изолирования параметров обработки между несколькими пользователями или клиентами.
* Ресурс может иметь [несколько StreamingLocators](streaming-locators-concept.md) с различными параметрами динамической упаковки и динамического шифрования.
* [Защита содержимого](content-key-policy-concept.md) поддерживает несколько ключевых возможностей.
* Вы можете вести потоковые трансляции событий в реальном времени длительностью до 24 часов, используя Службы мультимедиа для перекодирования исходного потока с одной скоростью в поток вывода с несколькими скоростями.
* Новая минимальная задержка потоковой передачи в реальном времени в LiveEvents.
* Предварительная версия LiveEvent поддерживает динамическую упаковку и динамическое шифрование. Это включает защиту содержимого в предварительной версии, а также упаковки DASH и HLS.
* LiveOuput проще в использовании, чем старая сущность Program в версии 2 API. 
* Вы контролируете доступ к своим сущностям с помощью управления доступом на основе ролей. 

## <a name="changes-from-v2"></a>Отличия от версии 2

* Если ресурсы созданы с помощью версии 3, Службы мультимедиа поддерживают шифрование хранилища только на стороне сервера [службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-service-encryption).
    * Вы можете использовать API версии 3 с ресурсами, созданными с помощью API версии 2, в которых есть [шифрование хранилища](../previous/media-services-rest-storage-encryption.md) (AES 256), предоставляемое Службами мультимедиа.
    * Вы не можете создать ресурсы с устаревшим [шифрованием хранилища](../previous/media-services-rest-storage-encryption.md) AES 256 с помощью API версии 3.
* Пакеты SDK версии 3 теперь лишаются хранилища SDK, что обеспечивает больший контроль над используемой версией хранилища SDK и позволяет избежать проблем с управлением версиями. 
* В API версии 3 вся скорость кодировки указана в битах за секунду. Это отличается от предустановок Media Encoder Standard версии 2. Например, скорость в версии 2 указывается как 128 (кбит/с), а в версии 3 она имела бы значение 128 000 (бит/с). 
* Сущности AssetFiles, AccessPolicies и IngestManifests не существуют в версии 3.
* Свойство IAsset.ParentAssets в версии 3 отсутствует.
* ContentKeys больше не сущность, а свойство StreamingLocator.
* Служба "Сетка событий" заменяет NotificationEndpoints.
* Следующие сущности были переименованы:
    * JobOutput заменяет задачу и теперь является частью задания.
    * StreamingLocator заменяет Locator.
    * LiveEvent заменяет Channel.
        
        Выставление счетов LiveEvent основано на метриках динамического канала. Дополнительные сведения см. в разделе [Выставление счетов](live-streaming-overview.md#billing) и на странице [Цены на Службы мультимедиа](https://azure.microsoft.com/pricing/details/media-services/).
    * LiveOutput заменяет Program.
* LiveOutputs не обязательно должны запускаться явным образом, они запускаются при создании и останавливаются при удалении. Программы работали иначе в API версии 2, они должны были запускаться после создания.

## <a name="feature-gaps-with-respect-to-v2-apis"></a>Недочеты функций по отношению к API версии 2

API версии 3 содержит следующие недочеты функций относительно API версии 2. Устранение недочетов не завершено.

* [Кодировщик (цен. категория "Премиум")](../previous/media-services-premium-workflow-encoder-formats.md) и [устаревшие обработчики аналитики мультимедиа](../previous/media-services-analytics-overview.md) (Предварительная версия индексатора Служб мультимедиа Azure версии 2, скрытие лиц и т. д.) недоступны в версии 3.

    Пользователи, желающие выполнить миграцию из предварительной версии индексатора мультимедийных данных версии 1 или 2, могут немедленно использовать предустановку AudioAnalyzer в API версии 3.  Эта новая предустановка содержит больше возможностей, чем старые индексаторы мультимедийных данных версии 1 или 2. 

* Многие расширенные возможности Media Encoder (цен. категория "Стандартный") в API версии 2 недоступны в настоящее время в версии 3, например:
    * Обрезка (в сценариях реального времени и по требованию)
    * Совмещение ресурсов
    * Наложения
    * Обрезка
    * Спрайты эскизов
* События прямой трансляции с перекодированием в настоящее время не поддерживают вставку баннера в поток, пользовательские предустановки или вставку рекламного маркера через вызов API. 

> [!NOTE]
> Добавьте эту статью в закладки и проверяйте ее на наличие обновлений.

## <a name="code-differences"></a>Отличия в коде

Следующая таблица показывает разницу в коде между версией 2 и 3 в распространенных сценариях.

|Сценарий|API версии 2|API версии 3|
|---|---|---|
|Создайте ресурс и отправьте файл. |[Пример .NET версии 2](https://github.com/Azure-Samples/media-services-dotnet-dynamic-encryption-with-aes/blob/master/DynamicEncryptionWithAES/DynamicEncryptionWithAES/Program.cs#L113)|[Пример .NET версии 3](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/UploadEncodeAndStreamFiles/Program.cs#L169)|
|Отправка задания|[Пример .NET версии 2](https://github.com/Azure-Samples/media-services-dotnet-dynamic-encryption-with-aes/blob/master/DynamicEncryptionWithAES/DynamicEncryptionWithAES/Program.cs#L146)|[Пример .NET версии 3](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/UploadEncodeAndStreamFiles/Program.cs#L298)<br/><br/>Показано, как сначала создать преобразование, а затем отправить задание.|
|Опубликуйте ресурс с шифрованием AES. |1. Создайте ContentKeyAuthorizationPolicyOption.<br/>2. Создайте ContentKeyAuthorizationPolicy.<br/>3. Создайте AssetDeliveryPolicy.<br/>4. Создайте ресурс и передайте содержимое или отправьте задание и используйте выходной ресурс.<br/>5. Свяжите AssetDeliveryPolicy с ресурсом.<br/>6. Создайте ContentKey.<br/>7. Присоедините ContentKey к Asset.<br/>8. Создайте AccessPolicy.<br/>9. Создайте Locator.<br/><br/>[Пример .NET версии 2](https://github.com/Azure-Samples/media-services-dotnet-dynamic-encryption-with-aes/blob/master/DynamicEncryptionWithAES/DynamicEncryptionWithAES/Program.cs#L64)|1. Создайте политику ключа содержимого.<br/>2. Создайте ресурс.<br/>3. Передайте содержимое или используйте ресурс как JobOutput.<br/>4. Создайте StreamingLocator.<br/><br/>[Пример .NET версии 3](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/EncryptWithAES/Program.cs#L105)|

## <a name="known-issues"></a>Известные проблемы

* В настоящее время вы не можете использовать портал Azure для управления ресурсами версии 3. Используйте [REST API](https://aka.ms/ams-v3-rest-sdk), CLI или один из поддерживаемых пакетов SDK.
* В настоящее время зарезервированными единицами мультимедиа можно управлять только с помощью API Служб мультимедиа версии 2. Дополнительные сведения см. в статье [Обзор масштабирования обработки мультимедиа](../previous/media-services-scale-media-processing-overview.md).
* С помощью API версии 2 нельзя управлять сущностями Cлужбы мультимедиа, созданными с помощью API версии 3.  
* Сущностями, которые были созданы с помощью интерфейсов API версии 2, не рекомендуется управлять с помощью API версии 3. Ниже приведены примеры различий, которые делают несовместимыми сущности в двух версиях:   
    * Задания и задачи, созданные в версии 2, не отображаются в версии 3, так как они не связаны с преобразованием. Рекомендуется переключиться на преобразования и задания версии 3. Относительно короткий период времени, необходимый для наблюдения за потоком версии 2 во время переключения.
    * Каналами и программами, созданными с помощью версии 2 (которые сопоставляются с LiveEvents и LiveOutputs в версии 3), не удается управлять с помощью версии 3. Рекомендуется переключиться на LiveEvents и LiveOutputs в версии 3 в удобном канале остановки.
    
        В настоящее время постоянно работающие каналы нельзя переносить.  
> [!NOTE]
> Добавьте эту статью в закладки и проверяйте ее на наличие обновлений.

## <a name="next-steps"></a>Дополнительная информация

Чтобы узнать, как легко начать кодирование и потоковую передачу видеофайлов, ознакомьтесь со сведениями о [файлах потоковой передачи](stream-files-dotnet-quickstart.md). 

