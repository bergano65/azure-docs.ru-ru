---
title: Преобразования и задания в Службах мультимедиа Azure | Документация Майкрософт
description: При использовании Служб мультимедиа необходимо создать преобразование, чтобы описать правила или спецификации для обработки видео. В данной статье приводится обзор преобразования и способы его использования.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: article
ms.date: 10/22/2018
ms.author: juliako
ms.openlocfilehash: e13afe26d06f5b5b2dcf7eddf00f9ee481312b2c
ms.sourcegitcommit: f6050791e910c22bd3c749c6d0f09b1ba8fccf0c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2018
ms.locfileid: "50024264"
---
# <a name="transforms-and-jobs"></a>Преобразования и задания
 
В Службах мультимедиа Azure версии 3 представлен новый ресурс шаблона рабочего процесса для набора инструкций, который можно использовать для кодирования или анализа видео. Этот шаблон называется [Преобразования](https://docs.microsoft.com/rest/api/media/transforms). **Преобразования** можно использовать для настройки общих задач кодирования или анализа видеоматериалов. Каждое **преобразование** описывает набор инструкций (или рабочий процесс задач) для обработки видео- и аудиофайлов. 

Объект **задание** содержит фактический запрос к Службам мультимедиа, который применяет **преобразование** к указанному видео- и (или) аудиосодержимому. **Задание** указывает такую информацию, как расположение входного и выходного видео. Вы можете указать расположение видео с помощью URL-адресов HTTPS, URL-адресов SAS или [ресурсов Служб мультимедиа](https://docs.microsoft.com/rest/api/media/assets).  

## <a name="typical-workflow"></a>Стандартный рабочий процесс

1. Создайте преобразование. 
2. Отправьте задания в преобразование. 
3. Выведите список преобразований. 
4. Удалите преобразование, если не планируете использовать его в будущем. 

Предположим, что требуется извлечь первый кадр всех видео в качестве эскиза. Ниже приведены действия по выполнению этого процесса. 

1. Определите правило для обработки (набор инструкций). Например, используйте первый кадр видео в качестве эскиза. 
2. Для каждого видео следует сообщить службе: 
    1. расположение видео;  
    2. место для записи выходных данных (например, эскиза). 

Шаблон **Преобразования** позволяет создать набор инструкций один раз (шаг 1) и отправить задания с использованием этой инструкции (шаг 2).

## <a name="transforms"></a>Преобразования

Можно создать преобразования в учетной записи Служб мультимедиа с помощью API версии 3 напрямую или с помощью любого из опубликованных пакетов SDK. Так как API Служб мультимедиа версии 3 управляется с помощью Azure Resource Manager, вы можете использовать шаблоны Resource Manager для создания и развертывания преобразований в учетной записи Служб мультимедиа. Управление доступом на основе ролей можно использовать для блокировки доступа к преобразованиям.

### <a name="transform-definition"></a>Определение преобразования

В следующей таблице представлены свойства преобразования и их определения.

|ИМЯ|ОПИСАНИЕ|
|---|---|
|Идентификатор|Полный идентификатор ресурса.|
|name|Имя ресурса.|
|properties.created |Дата и время создания преобразования в формате YYYY-MM-DDThh:mm:ssZ (UTC).|
|properties.description |Подробное описание преобразования (необязательно).|
|properties.lastModified |Дата и время последнего обновления преобразования в формате YYYY-MM-DDThh:mm:ssZ (UTC).|
|properties.outputs |Массив из одного или нескольких наборов выходных данных, созданных преобразованием.|
|Тип|Тип ресурса.|

Полное определение см. в статье [Transforms](https://docs.microsoft.com/rest/api/media/transforms) (Преобразования).

Как описано выше, преобразование позволяет создать набор инструкций или правило для обработки видео. Одно преобразование может применять несколько правил. Например, преобразование может указать, что каждое видео кодируется в MP4-файл с заданной скоростью и что эскиз будет создан из первого кадра видео. Необходимо добавить одну запись TransformOutput для каждого правила, которое требуется включить в преобразование.

> [!NOTE]
> Хотя определение преобразования поддерживает операцию обновления, перед внесением изменений следует убедиться, что все выполняемые задания завершены. Как правило, необходимо обновить существующее преобразование, чтобы изменить описание или приоритеты базовых выходных данных TransformOutputs. Если вы хотите переписать набор инструкций, создайте новое преобразование.

## <a name="jobs"></a>Задания

После создания преобразования можно отправлять задания с помощью API Служб мультимедиа или любого из опубликованных пакетов SDK. Ход выполнения и состояние заданий можно получить, отслеживая события с помощью Сетки событий. Дополнительные сведения см. в статье [Создание и мониторинг событий Служб мультимедиа Azure с помощью Сетки событий и Azure CLI](job-state-events-cli-how-to.md ).

### <a name="jobs-definition"></a>Определение задания

В следующей таблице представлены свойства заданий и их определения.

|ИМЯ|ОПИСАНИЕ|
|---|---|
|id|Полный идентификатор ресурса.|
|name   |Имя ресурса.|
|properties.correlationData |Клиент предоставил данные корреляции (неизменяемые), возвращаемые как часть уведомлений об изменении состояния Job и JobOutput. Дополнительные сведения см. в статье [Схемы службы "Сетка событий Azure" для событий Служб мультимедиа](media-services-event-schemas.md).<br/><br/>Свойство также может использоваться для использования Служб мультимедиа несколькими клиентами. Вы можете поместить идентификаторы клиентов в задания. |
|properties.created |Дата и время создания задания в формате "ГГГГ-ММ-ДДTчч:мм:ссZ (в формате UTC)".|
|properties.description |Необязательное предоставляемое клиентом описание задания.|
|properties.input|Входные данные для задания.|
|properties.lastModified    |Дата и время последнего обновления задания в формате "ГГГГ-ММ-ДДTчч:мм:ссZ (в формате UTC)".|
|properties.outputs|Выходные данные задания.|
|properties.priority    |Приоритет обработки задания. Задания с более высоким приоритетом обрабатываются раньше, чем задания с низким приоритетом. Если значение не задано, по умолчанию используется значение normal.|
|properties.state   |Текущее состояние задания.|
|Тип   |Тип ресурса.|

Полное определение см. в статье [Jobs](https://docs.microsoft.com/rest/api/media/jobs) (Задания).

> [!NOTE]
> Хотя определение заданий поддерживает операцию обновления, после отправки задания можно изменить только такие свойства, как описание и приоритет. Кроме того, изменение приоритета вступает в силу только в том случае, если задание все еще находится в очереди. Если задание приступило к обработке или завершено, изменение приоритета не оказывает влияния.

### <a name="pagination"></a>Разбиение на страницы

В Службах мультимедиа версии 3 поддерживается разбиение заданий на страницы.

> [!TIP]
> Для перечисления коллекции всегда нужно использовать следующую ссылку, которая не зависит от конкретного размера страницы.

Если ответ на запрос содержит большое количество элементов, служба возвращает свойство \@odata.nextLink, чтобы получить следующую страницу результатов. Это можно использовать для просмотра всего результирующего набора. Вы не можете настроить размер страницы. 

Если задания создаются или удаляются во время разбивки коллекции на страницы, изменения отражаются в возвращаемых результатах (если эти изменения находятся в той части коллекции, которая не была загружена). 

В следующем примере C# показано перечисление всех заданий в учетной записи.

```csharp            
List<string> jobsToDelete = new List<string>();
var pageOfJobs = client.Jobs.List(config.ResourceGroup, config.AccountName, "Encode");

bool exit;
do
{
    foreach (Job j in pageOfJobs)
    {
        jobsToDelete.Add(j.Name);
    }

    if (pageOfJobs.NextPageLink != null)
    {
        pageOfJobs = client.Jobs.ListNext(pageOfJobs.NextPageLink);
        exit = false;
    }
    else
    {
        exit = true;
    }
}
while (!exit);

```

Примеры REST для перечисления заданий см. в [этой статье](https://docs.microsoft.com/rest/api/media/jobs/list).


## <a name="next-steps"></a>Дополнительная информация

[Краткое руководство по потоковой передаче видеофайлов — .NET](stream-files-dotnet-quickstart.md)
