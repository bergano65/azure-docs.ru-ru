---
title: Разработка с использованием API версии 3
titleSuffix: Azure Media Services
description: Узнайте больше о правилах для работы с сущностями и API при разработке с использованием Служб мультимедиа версии 3.
services: media-services
documentationcenter: ''
author: IngridAtMicrosoft
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: conceptual
ms.date: 08/31/2020
ms.author: inhenkel
ms.custom: seodec18
ms.openlocfilehash: 4d1c68ba1e0b7db8afefa64abefc671d51e78bd4
ms.sourcegitcommit: f796e1b7b46eb9a9b5c104348a673ad41422ea97
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/30/2020
ms.locfileid: "91569510"
---
# <a name="develop-with-media-services-v3-apis"></a>Разработка с помощью API Служб мультимедиа версии 3

[!INCLUDE [media services api v3 logo](./includes/v3-hr.md)]

Как разработчик вы можете использовать [REST API](/rest/api/media/) Служб мультимедиа или клиентские библиотеки, которые позволяют взаимодействовать с REST API для простого создания, контроля и обслуживания настраиваемых рабочих процессов. API [Служб мультимедиа версии 3](https://aka.ms/ams-v3-rest-sdk) основан на спецификации OpenAPI (ранее известной как Swagger).

Эта статья содержит сведения о правилах для работы с сущностями и API при разработке с использованием Служб мультимедиа версии 3.

## <a name="accessing-the-azure-media-services-api"></a>Доступ к API Служб мультимедиа Azure

Чтобы получить разрешение для доступа к ресурсам служб мультимедиа и API служб мультимедиа, вы должны пройти аутентификацию. Службы мультимедиа поддерживают аутентификацию [на основе Azure Active Directory (Azure AD)](../../active-directory/fundamentals/active-directory-whatis.md). Два распространенных способа аутентификации:
 
* **Аутентификация на основе субъекта-службы** используется для аутентификации службы (веб-приложений, приложений-функций, приложений логики, интерфейсов API и микрослужб). Этот метод аутентификации обычно используют приложения, которые выполняют службы управляющей программы, службы среднего уровня или запланированные задания. Например, для веб-приложений всегда должен существовать промежуточный уровень, который подключается к Службам мультимедиа через субъект-службу.
* **Аутентификация пользователя** используется для аутентификации пользователя, который использует приложение для взаимодействия с ресурсами Служб мультимедиа. Интерактивное приложение должно сначала запросить у пользователя учетные данные. Примером может послужить приложение консоли управления, которое используется авторизованными пользователями для мониторинга заданий кодирования или потоковой трансляции.

API Служб мультимедиа требует, чтобы у пользователя или приложения, выполняющего запросы к REST API, был доступ к ресурсу учетной записи Служб мультимедиа и роль **участника** или **владельца**. К API можно обращаться и с ролью **читателя**, но в этом случае будут доступны только операции **Get** (получение) и **List** (список). Дополнительные сведения см. в статье [Управление доступом на основе ролей (RBAC) для учетных записей Служб мультимедиа](rbac-overview.md).

Вместо создания субъекта-службы вы можете применить управляемые удостоверения ресурсов Azure для доступа к API Служб мультимедиа через Azure Resource Manager. Дополнительные сведения об управляемых удостоверениях в ресурсах Azure см. в статье [Что такое управляемые удостоверения для ресурсов Azure?](../../active-directory/managed-identities-azure-resources/overview.md).

### <a name="azure-ad-service-principal"></a>Субъект-служба Azure AD

Приложение Azure AD и субъект-служба должны находиться в одном клиенте. После создания приложения назначьте ему роль **участника** или **владельца** для учетной записи Служб мультимедиа.

Если вы не уверены, что имеете достаточные полномочия для создания приложения Azure AD, изучите [описанные здесь требования](../../active-directory/develop/howto-create-service-principal-portal.md#permissions-required-for-registering-an-app).

На следующем рисунке цифры обозначают поток запросов в хронологическом порядке.

![Аутентификация приложения среднего уровня в AAD через веб-API](./media/use-aad-auth-to-access-ams-api/media-services-principal-service-aad-app1.png)

1. Приложение среднего уровня запрашивает маркер доступа Azure AD, который содержит следующие параметры:  

   * Конечная точка клиента Azure AD.
   * Универсальный код ресурса (URI) для ресурса служб мультимедиа.
   * Универсальный код ресурса (URI) для ресурса REST служб мультимедиа.
   * Значения для приложения Azure AD: идентификатор и секрет клиента.

   Чтобы получить все необходимые значения, воспользуйтесь инструкцией из [этой статьи](./access-api-howto.md).

2. Маркер доступа Azure AD передается на средний уровень.
4. Средний уровень отправляет запрос к REST API служб мультимедиа Azure с помощью маркера Azure AD.
5. Средний уровень получает данные из служб мультимедиа.

### <a name="samples"></a>Примеры

Следующие примеры демонстрируют подключение с использованием субъекта-службы Azure Active Directory.

* [Подключение с помощью REST](media-rest-apis-with-postman.md)  
* [Подключение с помощью Java](configure-connect-java-howto.md)
* [Подключение с помощью .NET](configure-connect-dotnet-howto.md)
* [Подключение с помощью Node.js](configure-connect-nodejs-howto.md)
* [Подключение с помощью Python](configure-connect-python-howto.md)

## <a name="naming-conventions"></a>Соглашения об именовании.

К именам ресурсов Служб мультимедиа версии 3 (например, "Ресурсы", "Задания", "Преобразования") применяются ограничения именования Azure Resource Manager. В соответствии с Azure Resource Manager имена ресурсов всегда уникальны. Таким образом, вы можете использовать любые уникальные строки идентификаторов (например, GUID) для имен ваших ресурсов.

Имена ресурсов Служб мультимедиа не могут содержать следующие символы: "<', '>", "%", "&", ":", "&#92;", "?", "/", "*", "+", ".", символ единичной кавычки или любые управляющие символы. Все остальные символы разрешены. Максимальная длина имени ресурса составляет 260 символов.

Дополнительные сведения об именовании в Azure Resource Manager см. в разделе о [требованиях к именованию](https://github.com/Azure/azure-resource-manager-rpc/blob/master/v1.0/resource-api-reference.md#arguments-for-crud-on-resource) и в статье [Соглашения об именовании](/azure/cloud-adoption-framework/ready/azure-best-practices/naming-and-tagging).

### <a name="names-of-filesblobs-within-an-asset"></a>Имена файлов и больших двоичных объектов в ресурсе

Имена файлов и больших двоичных объектов в ресурсе должны соответствовать как [требованиям к именованию больших двоичных объектов](/rest/api/storageservices/naming-and-referencing-containers--blobs--and-metadata), так и [требованиям к именованию для NTFS](/windows/win32/fileio/naming-a-file). Это связано с тем, что такие файлы могут копироваться для обработки из хранилища BLOB-объектов на локальный диск NTFS.

## <a name="long-running-operations"></a>Длительные операции

Операции, для которых в [файлах Swagger](https://github.com/Azure/azure-rest-api-specs/blob/master/specification/mediaservices/resource-manager/Microsoft.Media/stable/2018-07-01/streamingservice.json) для Служб мультимедиа Azure указан атрибут `x-ms-long-running-operation`, считаются длительными. 

Сведения об отслеживании асинхронных операций в Azure см. в [этой статье](../../azure-resource-manager/management/async-operations.md).

Службы мультимедиа используют следующие длительные операции:

* [Создание трансляции](/rest/api/media/liveevents/create)
* [Обновление трансляции](/rest/api/media/liveevents/update)
* [Удаление трансляции](/rest/api/media/liveevents/delete)
* [Запуск трансляции](/rest/api/media/liveevents/start)
* [Остановка трансляции](/rest/api/media/liveevents/stop)

  Используйте параметр `removeOutputsOnStop`, чтобы удалить все связанные записи трансляции при ее остановке.  
* [Перезапуск трансляции](/rest/api/media/liveevents/reset)
* [Создание записи трансляции](/rest/api/media/liveevents/create)
* [Удаление записи трансляции](/rest/api/media/liveevents/delete)
* [Создание конечной точки потоковой передачи](/rest/api/media/streamingendpoints/create)
* [Обновление конечной точки потоковой передачи](/rest/api/media/streamingendpoints/update)
* [Удаление конечной точки потоковой передачи](/rest/api/media/streamingendpoints/delete)
* [Запуск конечной точки потоковой передачи](/rest/api/media/streamingendpoints/start)
* [Остановка конечной точки потоковой передачи](/rest/api/media/streamingendpoints/stop)
* [Масштабирование конечной точки потоковой передачи](/rest/api/media/streamingendpoints/scale)

После успешной передачи длительной операции вы получите ответ "202 Принято" и должны будете выполнить опрос на завершение операции с помощью возвращенного идентификатора операции.

В статье [Track asynchronous Azure operations](../../azure-resource-manager/management/async-operations.md) (Отслеживание асинхронных операций Azure) приведены подробные сведения о том, как отслеживать состояние асинхронных операций Azure с помощью значений, возвращаемых в ответе.

Для каждого события трансляции или любой из связанной с ним записи трансляции поддерживается только одна длительная операция. Запущенная длительная операция должна завершиться, прежде чем удастся запустить следующую длительную операцию для того же события трансляции или любой из связанной с ним записи трансляции. Для трансляций с несколькими записями необходимо дождаться завершения длительной операции в одной из записей трансляции, прежде чем начинать длительную операцию в другой записи. 

## <a name="sdks"></a>Пакеты SDK

> [!NOTE]
> Пакеты SDK для Служб мультимедиа Azure версии 3 не гарантируют потокобезопасность. При разработке приложений с несколькими потоками нужно добавить собственную логику синхронизации потоков, чтобы защитить клиент, или использовать новый объект AzureMediaServicesClient для каждого потока. Также помните, что предоставляемые кодом клиенту дополнительные объекты (например, экземпляр HttpClient в .NET) могут создавать проблемы при обработке нескольких потоков.

|SDK|Справочник|
|---|---|
|[Пакет SDK для .NET](https://aka.ms/ams-v3-dotnet-sdk)|[Справочник по .NET](https://aka.ms/ams-v3-dotnet-ref)|
|[пакет SDK для Java](https://aka.ms/ams-v3-java-sdk)|[Справочник по Java](https://aka.ms/ams-v3-java-ref)|
|[Пакет SDK для Python](https://aka.ms/ams-v3-python-sdk)|[Справочник по Python](https://aka.ms/ams-v3-python-ref)|
|[Пакет SDK для Node.js](https://aka.ms/ams-v3-nodejs-sdk) |[Справочник по Node.js](/javascript/api/overview/azure/mediaservices/management)| 
|[Пакет SDK для GO](https://aka.ms/ams-v3-go-sdk) |[Справочник по Go](https://aka.ms/ams-v3-go-ref)|
|[Пакет SDK для Ruby](https://aka.ms/ams-v3-ruby-sdk)||

### <a name="see-also"></a>См. также раздел

- [Пакет SDK .NET EventGrid, который включает события Служб мультимедиа](https://www.nuget.org/packages/Microsoft.Azure.EventGrid/)
- [Определения событий Служб мультимедиа](https://github.com/Azure/azure-rest-api-specs/blob/master/specification/eventgrid/data-plane/Microsoft.Media/stable/2018-01-01/MediaServices.json)

## <a name="azure-media-services-explorer"></a>Обозреватель Служб мультимедиа Azure

[Обозреватель Служб мультимедиа Azure](https://github.com/Azure/Azure-Media-Services-Explorer) (AMSE) — это инструмент, доступный для клиентов Windows, которые хотят узнать о Службах мультимедиа. AMSE — это приложение Winforms или C#, которое отправляет, скачивает, кодирует, транслирует видео по запросу и в режиме реального времени с помощью Служб мультимедиа. Инструмент AMSE предназначен для клиентов, которые хотят протестировать Службы мультимедиа без написания кода. Код AMSE предоставляется как ресурс для клиентов, которым необходима разработка с помощью Служб мультимедиа.

AMSE — это проект с открытым кодом, поддержка которого предоставляется сообществом (о проблемах можно сообщать по ссылке https://github.com/Azure/Azure-Media-Services-Explorer/issues). В рамках этого проекта действуют [правила поведения в отношении продуктов с открытым исходным кодом Майкрософт](https://opensource.microsoft.com/codeofconduct/). Дополнительные сведения см. в статье [Вопросы и ответы, связанные с правилами поведения](https://opensource.microsoft.com/codeofconduct/faq/). Чтобы задать вопрос или получить комментарии, обратитесь по адресу opencode@microsoft.com.

## <a name="filtering-ordering-paging-of-media-services-entities"></a>Фильтрация, упорядочивание и разбиение по страницам сущностей Служб мультимедиа

Ознакомьтесь со статьей [Фильтрация, упорядочение и разбиение на страницы сущностей Служб мультимедиа](entities-overview.md).

## <a name="ask-questions-give-feedback-get-updates"></a>Получение справки, отправка отзывов, получение обновлений

Прочитайте статью [сообщества Служб мультимедиа Azure](media-services-community.md), чтобы узнать, как задавать вопросы, оставлять отзывы и получать новости о Службах мультимедиа.

## <a name="see-also"></a>См. также раздел

Чтобы получить все необходимые значения, воспользуйтесь инструкцией из [этой статьи](./access-api-howto.md).

## <a name="next-steps"></a>Дальнейшие действия

* [Подключение к Службам мультимедиа с помощью Java](configure-connect-java-howto.md)
* [Подключение к Службам мультимедиа с помощью .NET](configure-connect-dotnet-howto.md)
* [Подключение к Службам мультимедиа с помощью Node.js](configure-connect-nodejs-howto.md)
* [Подключение к Службам мультимедиа с помощью Python](configure-connect-python-howto.md)
