---
title: Перемещение виртуальных машин Azure в другой регион с помощью Azure Site Recovery
description: Перенос виртуальных машин Azure из одного региона Azure в другой с помощью службы Azure Site Recovery.
services: site-recovery
author: Sharmistha-Rai
ms.service: site-recovery
ms.topic: tutorial
ms.date: 01/28/2019
ms.author: sharrai
ms.custom: MVC
ms.openlocfilehash: 076adbfd4cecf7dae9ffc490e911fcb7ffce48e6
ms.sourcegitcommit: 0ce1ccdb34ad60321a647c691b0cff3b9d7a39c8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2020
ms.locfileid: "93394838"
---
# <a name="move-vms-to-another-azure-region"></a>Перемещение виртуальных машин в другой регион Azure

Существуют причины, по которым может потребоваться перенос имеющихся виртуальных машин Azure IaaS из одного региона в другой. Например, вы захотите повысить надежность и доступность существующих виртуальных машин, оптимизировать управление ими или соблюсти дополнительные требования к системе управления. Дополнительные сведения см. в статье с [общими сведениями о переносе виртуальных машин Azure](azure-to-azure-move-overview.md). 

Перенесите виртуальные машины Azure в дополнительный регион с помощью службы [Azure Site Recovery](site-recovery-overview.md).

В этом руководстве описано следующее:

> [!div class="checklist"]
> 
> * проверять предварительные требования для переноса;
> * подготавливать исходные виртуальные машины и целевой регион;
> * копировать данные и включать репликацию;
> * проверять конфигурацию и выполнять перемещение;
> * удалять ресурсы в исходном регионе.


> [!IMPORTANT]
> Для перемещения виртуальных машин Azure в другой регион мы рекомендуем использовать [Azure Resource Mover](../resource-mover/tutorial-move-region-virtual-machines.md). Resource Mover поддерживается в общедоступной предварительной версии и обеспечивает следующее.
> - Один центр для перемещения ресурсов между регионами.
> - Сокращение времени и упрощение при перемещении. Все, что вам нужно, находится в одном расположении.
> - Простой и согласованный процесс перемещения различных типов ресурсов Azure.
> - Простой способ обнаружения зависимостей между ресурсами, которые необходимо переместить. Это помогает перемещать связанные ресурсы вместе, чтобы после перемещения в целевом регионе все правильно работало.
> - Автоматическая очистка ресурсов в исходном регионе, если их нужно удалить после перемещения.
> - Тестирование. Вы можете попробовать выполнить перемещение, а затем отменить его, если не хотите выполнять полный переход.



> [!NOTE]
> В этом руководстве показано, как выполнить перенос виртуальных машин Azure из одного региона в другой без дополнительных изменений. Если вы намерены повысить уровень доступности, переместив виртуальные машины из группы доступности в прикрепленные к зонам виртуальные машины в другом регионе, воспользуйтесь [этим учебником](move-azure-vms-avset-azone.md).

## <a name="prerequisites"></a>предварительные требования

- Убедитесь, что виртуальные машины действительно расположены в том регионе Azure, из которого вы намерены их перенести.
- Проверьте, поддерживается ли выбранная [комбинация исходного и целевого региона](./azure-to-azure-support-matrix.md#region-support), и примите взвешенное решение о целевом регионе.
- Вам должны быть понятны [архитектура и компоненты сценария](azure-to-azure-architecture.md).
- Просмотрите [ограничения и требования для поддержки](azure-to-azure-support-matrix.md).
- Проверьте разрешения для учетной записи. Если вы создали бесплатную учетную запись Azure, вы являетесь администратором этой подписки. Если вы не администратор подписки, свяжитесь с администратором, чтобы получить необходимые разрешения. Чтобы включить репликацию для виртуальной машины и позднее скопировать данные с помощью Azure Site Recovery, необходимо следующее.

    - Разрешения на создание виртуальной машины в ресурсах Azure. Встроенная роль "Участник виртуальных машин" обладает такими разрешениями, а именно:
    - разрешение на создание виртуальной машины в выбранной группе ресурсов;
    - разрешение на создание виртуальной машины в выбранной виртуальной сети;
    - разрешение на запись в выбранной учетной записи хранения.
    
    - Разрешения на управление операциями Azure Site Recovery. Роль "Участник Site Recovery" имеет все разрешения, необходимые для управления операциями Site Recovery в хранилище служб восстановления.

- Убедитесь, что на виртуальных машинах Azure, которые вы решили перенести, установлены все действующие корневые сертификаты. Если корневые сертификаты отсутствуют на виртуальной машине, ограничения безопасности заблокируют копирование данных в целевой регион.

- При использовании виртуальных машин Windows установите на виртуальной машине все последние обновления Windows, чтобы гарантировать присутствие всех доверенных корневых сертификатов. При работе в отключенной среде следуйте стандартным процедурам обновления Windows и сертификатам в вашей организации.
    
- На виртуальных машинах Linux выполните инструкции, предоставленные распространителем Linux, чтобы установить все свежие доверенные корневые сертификаты и список отзыва сертификатов.
- Убедитесь, что для управления подключением к сети для виртуальных машин, которые вы хотите перенести, не используется прокси-сервер аутентификации.

- Если виртуальная машина, которую вы пытаетесь переместить, не имеет доступа к Интернету и (или) использует прокси-сервер брандмауэра для управления исходящим доступом, проверьте [соответствующие требования](azure-to-azure-tutorial-enable-replication.md#set-up-vm-connectivity).

- Определите структуру сети в исходном регионе и все ресурсы, которые вы сейчас используете. Сюда могут входить, среди прочего, подсистемы балансировки нагрузки, группы безопасности сети и общедоступные IP-адреса.

- Убедитесь, что используемая подписка Azure позволяет создавать виртуальные машины в целевом регионе, который настроен для аварийного восстановления. Свяжитесь со службой поддержки, чтобы включить необходимые квоты.

- Убедитесь, что подписка располагает достаточными ресурсами для поддержки виртуальных машин тех же размеров, которые установлены для исходных виртуальных машин. Если для копирования данных в целевой объект вы используете Site Recovery, эта служба выберет для целевой виртуальной машины такой же размер или наиболее близкий к нему.

- Убедитесь, что вы создали в целевом регионе аналог каждого компонента, который вы обнаружили ранее в структуре сети исходного региона. Это важно для того, чтобы после перехода в целевой регион виртуальные машины сохранили все функции и возможности виртуальных машин в исходном регионе.

     > [!NOTE] 
     > При включении репликации для исходной виртуальной машины служба Azure Site Recovery автоматически обнаруживает и создает виртуальную сеть. Можно также предварительно создать сеть и назначить ее на виртуальную машину в рамках процесса включения репликации. Любые другие ресурсы необходимо создать в целевом регионе вручную, как будет описано далее.

    Сведения о создании наиболее часто используемых сетевых ресурсов на основе конфигурации исходной виртуальной машины см. в следующих документах.
    - [Группы безопасности сети](../virtual-network/manage-network-security-group.md)
    - [Подсистемы балансировки нагрузки](../load-balancer/index.yml)
    -  [Общедоступный IP-адрес](../virtual-network/virtual-network-public-ip-address.md)
    - Сведения о других сетевых компонентах см. в [документации по сетям](../index.yml?pivot=products&panel=network).



## <a name="prepare"></a>Подготовка.
Ниже показано, как подготовить виртуальную машину к перемещению с использованием Azure Site Recovery в качестве решения. 

### <a name="create-the-vault-in-any-region-except-the-source-region"></a>Создайте хранилище в любом регионе, за исключением исходного.

1. Войдите на [портал Azure](https://portal.azure.com)
1. В поле поиска введите "Службы восстановления" и щелкните "Хранилища Служб восстановления".
1. В меню "Хранилища Служб восстановления" щелкните "+Добавить".
1. В поле **Имя** укажите понятное имя **ContosoVMVault**. Если у вас есть несколько подписок, выберите нужную.
1. Создайте группу ресурсов **ContosoRG**.
1. Укажите регион Azure. Сведения о поддерживаемых регионах см. в разделе "Географическая доступность" на странице [цен на службу Azure Site Recovery](https://azure.microsoft.com/pricing/details/site-recovery/).
1. В области **хранилища Служб восстановления** выберите **ContosoVMVault** > **Реплицированные элементы** >  **+Реплицировать**.
1. В раскрывающемся списке выберите **Виртуальные машины Azure**.
1. В поле **Исходное расположение** выберите исходный регион Azure, в котором сейчас запущены виртуальные машины.
1. Выберите модель развертывания Resource Manager. Затем выберите настройку **Исходная подписка** и **Исходная группа ресурсов**.
1. Нажмите кнопку **ОК** , чтобы сохранить настройки.

### <a name="enable-replication-for-azure-vms-and-start-copying-the-data"></a>Включение репликации для виртуальных машин Azure и начало копирования данных

Site Recovery получает список виртуальных машин, связанных с подпиской и группой ресурсов.

1. На следующем шаге выберите виртуальную машину, которую вы намерены переместить, и щелкните **OK**.
1. В разделе **Параметры** выберите **Аварийное восстановление**.
1. В разделе **Настройка аварийного восстановления** > **Целевой регион** выберите целевой регион, в который будет выполняться репликация.
1. Для работы с этим руководством примите остальные значения по умолчанию.
1. Выберите **Включить репликацию**. Это действие запускает задание для включения репликации виртуальной машины.



## <a name="move"></a>Переместить

На приведенных ниже шагах показано, как выполнить перемещение в целевой регион.

1. Перейдите в хранилище. Щелкните **Параметры** > **Реплицированные элементы** , а затем выберите действие **Отработка отказа**.
2. В области **Отработка отказа** выберите **Последнее**.
3. Выберите **Завершение работы виртуальной машины перед началом отработки отказа**. Site Recovery попытается выключить исходную виртуальную машину перед запуском отработки отказа. Отработка отказа продолжится, даже если их не удастся отключить. На странице **Задания** можно следить за ходом выполнения отработки отказа.
4. Когда задание будет завершено, проверьте, отображается ли виртуальная машина в целевом регионе Azure, как и ожидалось.


## <a name="discard"></a>Игнорировать 

Если вы проверили перемещенную виртуальную машину и необходимо изменить точку отработки отказа или вернуться к предыдущей точке, в разделе **Реплицированные элементы** щелкните правой кнопкой мыши виртуальную машину и выберите **Изменить точку восстановления**. На этом шаге можно указать другую точку восстановления и выполнить отработку отказа в нее. 


## <a name="commit"></a>Commit 

Когда вы проверите перемещенную виртуальную машину и будете готовы к фиксации изменений, в разделе **Реплицированные элементы** щелкните правой кнопкой мыши виртуальную машину, выберите **Зафиксировать**. Это действие завершает перенос в целевой регион. Дождитесь, пока завершится задание фиксации.

## <a name="clean-up"></a>Очистка

Ниже приведены инструкции по удалению сведений об исходном регионе, а также связанных ресурсов, которые использовались для перемещения.

Для всех ресурсов, которые использовались для перемещения:

- Перейдите к виртуальной машине. Щелкните **Отключить репликацию**. Это действие остановит процесс копирования данных для выбранной виртуальной машины.

   > [!IMPORTANT]
   > Это очень важный шаг, который избавляет от лишних расходов на репликацию Azure Site Recovery.

Если вы не планируете повторно использовать какие-либо исходные ресурсы, выполните следующие дополнительные действия:

1. Удалите все соответствующие сетевые ресурсы в исходном регионе, который вы определили при работе с разделом [Предварительные требования](#prerequisites).
1. Удалите соответствующую учетную запись хранения в исходном регионе.

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы перенесли виртуальную машину Azure в другой регион Azure. Теперь можно настроить аварийное восстановление для перенесенной виртуальной машины.

> [!div class="nextstepaction"]
> [Настройка аварийного восстановления после миграции](azure-to-azure-quickstart.md)
