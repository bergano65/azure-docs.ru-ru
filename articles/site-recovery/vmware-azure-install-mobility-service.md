---
title: Подготовка исходных компьютеров, чтобы установить службу Mobility с помощью принудительной установки для аварийного восстановления виртуальных машин VMware и физических серверов в Azure | Документация Майкрософт
description: Узнайте, как подготовить сервер для установки агента мобильности посредством принудительной установки для аварийного восстановления виртуальных машин VMware и физических серверов в Azure с помощью службы Azure Site Recovery.
author: Rajeswari-Mamilla
ms.service: site-recovery
ms.topic: conceptual
ms.date: 03/25/2019
ms.author: ramamill
ms.openlocfilehash: 628be573d03d42ec62a358071074facfe228852d
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60318194"
---
# <a name="prepare-source-machine-for-push-installation-of-mobility-agent"></a>Подготовка исходного компьютера для принудительной установки агента мобильности

При настройке аварийного восстановления для виртуальных машин VMware и физических серверов используйте [Azure Site Recovery](site-recovery-overview.md). Требуется установить [службу мобильности Site Recovery](vmware-physical-mobility-service-overview.md) на каждую локальную виртуальную машину VMware и физический сервер.  Служба Mobility Service фиксирует операции записи данных на компьютере и перенаправляет их на сервер обработки Site Recovery.

## <a name="install-on-windows-machine"></a>Установка на компьютер поддерживающий Windows

Сделайте следующее, чтобы защитить каждый компьютер с Windows:

1. Убедитесь, что между компьютером и серверным процессом установлено сетевое подключение. Если отдельный серверный процесс еще не установлен, значит по умолчанию он выполняется на сервере конфигурации.
1. Создайте учетную запись, с помощью которой сервер обработки сможет получить доступ к компьютеру. Этой учетной записи следует назначить права локального администратора или администратора домена. Используйте эту учетную запись только для принудительной установки и обновлений агента.
2. Если учетная запись домена не используется, на локальном компьютере нужно отключить управление удаленным доступом пользователей.
    - В разделе реестра HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System добавьте параметр DWORD: **LocalAccountTokenFilterPolicy**. Присвойте ему значение **1**.
    -  Для этого выполните в командной строке следующую команду:  
   `REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d
3. В брандмауэре Windows на компьютере, который нужно защитить, выберите **Разрешить запуск программы или компонента через брандмауэр Windows**. Активируйте **общий доступ к файлам и принтерам** и **инструментарий управления Windows (WMI)**. Для компьютеров, принадлежащих домену, можно настроить политику брандмауэра с помощью объекта групповой политики.

   ![Параметры брандмауэра](./media/vmware-azure-install-mobility-service/mobility1.png)

4. Добавьте учетную запись, созданную в CSPSConfigtool. Чтобы сделать это, войдите на сервер конфигурации.
5. Запустите файл **cspsconfigtool.exe**. Доступ к нему можно получить, щелкнув ярлык на рабочем столе, или перейдя в папку %ProgramData%\home\svsystems\bin.
6. На вкладке **Управление учетными записями** щелкните **Добавить учетную запись**.
7. Добавьте созданную учетную запись.
8. Введите учетные данные, используемые при включении репликации для компьютера.

## <a name="install-on-linux-machine"></a>Установка на компьютер с Linux

Сделайте следующее, чтобы защитить каждый компьютер с Linux:

1. Убедитесь, что между компьютером Linux и сервером обработки установлено сетевое подключение.
2. Создайте учетную запись, с помощью которой сервер обработки сможет получить доступ к компьютеру. Учетная запись должна принадлежать **привилегированному пользователю** на исходном сервере Linux. Используйте эту учетную запись только для принудительной установки и обновлений.
3. Убедитесь, что файл /etc/hosts на исходном сервере Linux содержит записи, которые связывают имя локального узла с IP-адресами всех сетевых адаптеров.
4. Установите на реплицируемом компьютере последние версии пакетов openssh, openssh-server и openssl.
5. Убедитесь, что протокол Secure Shell (SSH) включен и работает через порт 22.
4. Включите подсистему SFTP и проверку пароля в файле sshd_config. Для этого войдите как **привилегированный пользователь**.
5. В файле **/etc/ssh/sshd_config** найдите строку, которая начинается с **PasswordAuthentication**.
6. Раскомментируйте строку и измените значение на **yes**.
7. Найдите строку, которая начинается с **Subsystem**, и раскомментируйте ее.

      ![Linux](./media/vmware-azure-install-mobility-service/mobility2.png)

8. Перезапустите службу **SSHD**.
9. Добавьте учетную запись, созданную в CSPSConfigtool. Чтобы сделать это, войдите на сервер конфигурации.
10. Запустите файл **cspsconfigtool.exe**. Доступ к нему можно получить, щелкнув ярлык на рабочем столе, или перейдя в папку %ProgramData%\home\svsystems\bin.
11. На вкладке **Управление учетными записями** щелкните **Добавить учетную запись**.
12. Добавьте созданную учетную запись.
13. Введите учетные данные, используемые при включении репликации для компьютера.

## <a name="anti-virus-on-replicated-machines"></a>Антивирусное ПО на реплицированных компьютерах

Если на компьютерах, которые нужно реплицировать, запущено антивирусное ПО, обязательно исключите установочную папку службы Mobility в список исключений из антивирусной проверки (*C:\ProgramData\ASR\agent*). Это обеспечит правильную работу репликации.

## <a name="next-steps"></a>Дальнейшие действия

После установки службы Mobility Service на портале Azure выберите **+ Репликация**, чтобы приступить к защите виртуальных машин. Дополнительные сведения о включении репликации для [виртуальных машин VMware (vmware-azure-enable-replication.md) и [физических серверов](physical-azure-disaster-recovery.md#enable-replication).


