---
title: Устранение ошибок и проблем с репликацией из Azure в Azure с помощью Azure Site Recovery | Документация Майкрософт
description: Устранение неполадок и ошибок при репликации виртуальных машин Azure для аварийного восстановления
services: site-recovery
author: asgang
manager: rochakm
ms.service: site-recovery
ms.devlang: na
ms.topic: troubleshooting
ms.date: 10/30/2018
ms.author: asgang
ms.openlocfilehash: 22ea3d955fe2910dc99ab4015165008da899d48e
ms.sourcegitcommit: a08d1236f737915817815da299984461cc2ab07e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2018
ms.locfileid: "52312856"
---
# <a name="troubleshoot-azure-to-azure-vm-ongoing-replication-issues"></a>Устранение неполадок текущей репликации виртуальных машин из Azure в Azure

В этой статье описаны распространенные проблемы в Azure Site Recovery, которые возникают при репликации и восстановлении виртуальных машин Azure из одного региона в другой, и способы их устранения. Дополнительные сведения о поддерживаемых конфигурациях см. в статье [Azure Site Recovery support matrix for replicating from Azure to Azure](site-recovery-support-matrix-azure-to-azure.md) (Матрица поддержки Azure Site Recovery для репликации виртуальных машин из Azure в Azure).


## <a name="recovery-points-not-getting-generated"></a>Точки восстановления не создаются

СООБЩЕНИЕ ОБ ОШИБКЕ: "Для виртуальной машины нет соответствующей точки восстановления приложения за последние 60 минут".</br>
ИДЕНТИФИКАТОР ОШИБКИ: 153007 </br>

Azure Site Recovery постоянно реплицирует данные из исходного региона в регион аварийного восстановления и создает отказоустойчивые точки каждые 5 минут. Если Site Recovery не сможет создать точки восстановления в течение 60 минут, он оповещает пользователя. Ниже приведены причины, которые могли вызвать эту ошибку:

**Причина 1.[Высокая скорость изменения данных на исходной виртуальной машине](#high-data-change-rate-on-the-source-virtal-machine)**    
**Причина 2.[ Проблемы с подключением к сети](#Network-connectivity-issue)**

## <a name="causes-and-solutions"></a>Причины и решения

### <a name="high-data-change-rate-on-the-source-virtal-machine"></a>Высокая скорость изменения данных на исходной виртуальной машине
Azure Site Recovery запускает событие, если скорость изменения данных на исходной виртуальной машине превышает поддерживаемые ограничения. Чтобы проверить, связана ли проблема с высокой скоростью обработки данных, выберите "Реплицированные элементы > Виртуальная машина" и щелкните "События. Последние 72 часа".
Отобразиться событие "Скорость изменения данных за пределами поддерживаемых ограничений", как показано на следующем снимке экрана.

![data_change_rate_high](./media/site-recovery-azure-to-azure-troubleshoot/data_change_event.png)

Если щелкнуть событие, вы должны увидеть точные сведения о диске, как показано на следующем снимке экрана.

![data_change_rate_event](./media/site-recovery-azure-to-azure-troubleshoot/data_change_event2.png)


#### <a name="azure-site-recovery-limits"></a>Ограничения Azure Site Recovery
В таблице ниже приведены ограничения Azure Site Recovery. Эти ограничения получены на основе наших проверок, но они не охватывают все возможные сочетания операций ввода-вывода в приложении. Фактические результаты зависят от сочетания операций ввода-вывода приложения. Кроме того, следует отметить, что существуют два ограничения, которые необходимо учитывать при обработке всех данных диска и данных виртуальных машин.
Например, если взглянуть на диск P20 "Премиум" в приведенной ниже таблице, Site Recovery может выполнять обработку со скоростью 5 МБ/с для каждого диска с максимум 5 такими дисками для каждой виртуальной машины из-за общего ограничения скорости обработки в 25 МБ/с для каждой виртуальной машины.

**Целевое хранилище репликации** | **Средний размер ввода-вывода исходного диска** |**Средняя скорость обработки данных исходного диска** | **Общий размер обработанных данных на исходном диске за день**
---|---|---|---
Хранилище уровня "Стандартный" | 8 КБ | 2 МБ/с | 168 ГБ на диск
Диск P10 или P15 класса Premium | 8 КБ  | 2 МБ/с | 168 ГБ на диск
Диск P10 или P15 класса Premium | 16 КБ | 4 МБ/с |  336 ГБ на диск
Диск P10 или P15 класса Premium | 32 КБ или выше | 8 МБ/с | 672 ГБ на диск
Диск P20, P30, P40 или P50 класса Premium | 8 КБ    | 5 МБ/с | 421 ГБ на диск
Диск P20, P30, P40 или P50 класса Premium | 16 КБ или выше |10 МБ/с | 842 ГБ на диск

### <a name="solution"></a>Решение
Необходимо понимать, что в Azure Site Recovery существуют ограничения на изменения данных, зависящие от типа диска данных. Чтобы узнать, является ли эта проблема повторяющейся или кратковременной, нужно найти шаблон частоты изменения данных затронутой виртуальной машины.
Чтобы найти скорость изменения данных для затронутой виртуальной машины: Выберите исходную виртуальную машину, метрики в разделе "Мониторинг" и добавьте метрики, как показано ниже.

![high_data_change_rate](./media/site-recovery-azure-to-azure-troubleshoot/churn.png)

1. Выберите "Добавить метрику", а затем добавьте "Скорость записи на диск ОС (байт/с)" и "Скорость записи на диск данных (байт/с)".
2. Отслеживайте пики, как показано на снимке экрана.
3. Кроме того, будет показано общее количество операций записи на диске ОС и на всех дисках данных. Теперь эти показатели не могут отображать информацию для каждого уровня диска, однако являются хорошим индикатором общего шаблона обработки данных.

Если это эпизодический случай, как в описанных выше случаях, и частота изменения данных только на некоторое время превышает 10 Мбит/с (для уровня "Премиум") и 2 Мбит/с (для уровня "Стандартный"), репликация завершится вовремя. Однако, если скорость обработки превышает поддерживаемое ограничение постоянно, тогда следует рассмотреть один из следующих возможных вариантов:

**Вариант 1.** Исключите диск, вызывающий высокую частоту изменения данных. </br>
В настоящее время диск можно исключить с помощью [Site Recovery и Powershell](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-powershell#replicate-azure-virtual-machine).

**Вариант 2.** Измените уровень диска хранилища аварийного восстановления. </br>
Это единственный возможный вариант, если скорость обработки данных диска менее 10 МБ/с. Допустим, виртуальная машина с диском P10 обрабатывает данные быстрее, чем 8 МБ/с, но медленнее, чем 10 МБ/с. Если клиент может использовать диск P30 для целевого хранилища во время защиты, проблему можно решить.

### <a name="Network-connectivity-issue"></a>Проблемы с подключением к сети

#### <a name="network-latency-to-cache-storage-account-"></a>Задержка сети при подключении к учетной записи хранения кэша
 Site Recovery отправляет реплицированные данные в учетную запись хранения кэша. Проблема может возникнуть, если передача данных из виртуальной машины в учетную запись хранения кэша происходит на скорости, меньшей чем 4 МБ в 3 секунды. Чтобы узнать, существуют ли проблемы с задержкой, с помощью [azcopy](https://docs.microsoft.com/azure/storage/common/storage-use-azcopy) передайте данные из виртуальной машины в учетную запись хранения кэша.<br>
Если задержка большая, проверьте, используются ли сетевые виртуальные модули для управления исходящим сетевым трафиком виртуальных машин. Если весь трафик репликации проходит через сетевой виртуальный модуль, к модулю может применяться регулирование. Мы рекомендуем создать конечную точку службы сети в виртуальной сети для хранилища, чтобы трафик репликации не передавался на виртуальный сетевой модуль. См. раздел о [настройке сетевого виртуального модуля](https://docs.microsoft.com/en-us/azure/site-recovery/azure-to-azure-about-networking#network-virtual-appliance-configuration).

#### <a name="network-connectivity"></a>Сетевое подключение
Чтобы реплика Site Recovery заработала, от виртуальной машины требуется исходящее подключение для конкретного URL-адреса или IP-диапазонов. Если виртуальная машина находится за брандмауэром или использует правила группы безопасности сети (NSG) для управления исходящими подключениями, могут возникнуть следующие проблемы.</br>
Сведения о том, как убедиться, что все URL-адреса подключены, см. в разделе [Исходящие подключения для диапазонов IP-адресов](https://docs.microsoft.com/en-us/azure/site-recovery/azure-to-azure-about-networking#outbound-connectivity-for-ip-address-ranges). 