---
title: Миграция локальных компьютеров с помощью Azure Site Recovery
description: В этой статье описан процесс миграции локальных компьютеров в Azure с помощью Azure Site Recovery.
author: rayne-wiselman
manager: carmonm
ms.service: site-recovery
ms.topic: tutorial
ms.date: 11/12/2019
ms.author: raynew
ms.custom: MVC
ms.openlocfilehash: 24015810a295ef88b7d3e63bfc464ddddef6b55f
ms.sourcegitcommit: 44c2a964fb8521f9961928f6f7457ae3ed362694
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2019
ms.locfileid: "73939624"
---
# <a name="migrate-on-premises-machines-to-azure"></a>Миграция локальных компьютеров в Azure


В этой статье описан процесс миграции локальных компьютеров в Azure с помощью [Azure Site Recovery](site-recovery-overview.md). Как правило, Site Recovery используется для управления аварийным восстановлением локальных компьютеров и виртуальных машин Azure. Тем не менее эта служба может также использоваться для миграции. При миграции используются те же шаги, что и при аварийном восстановлении за одним исключением. При миграции отработка отказа компьютеров с локального сайта выполняется в конце. В отличие от аварийного восстановления вы не можете восстановить размещение в локальную среду в сценарии миграции.


В этом руководстве показано, как перенести локальные виртуальные машины и физические серверы в Azure. Вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Настройка исходной и целевой среды для миграции
> * Настройка политики репликации
> * Включение репликации
> * Запуск тестовой миграции, позволяющей убедиться в правильной работе всех компонентов.
> * Выполнение однократной отработки отказа в Azure.


> [!TIP]
> Теперь вы можете перенести локальные серверы в Azure с помощью службы "Миграция Azure". [Подробнее](../migrate/migrate-services-overview.md)

## <a name="before-you-start"></a>Перед началом работы

Обратите внимание, что устройства, экспортированные с помощью паравиртуализованных драйверов, не поддерживаются.


## <a name="prepare-azure-and-on-premises"></a>Подготовка Azure и локальной среды

1. Подготовьте Azure, как описано в [этой статье](tutorial-prepare-azure.md). Хотя в этой статье описаны этапы подготовки к аварийному восстановлению, они также допустимы для миграции.
2. Подготовьте локальные серверы [VMware](vmware-azure-tutorial-prepare-on-premises.md) или [Hyper-V](hyper-v-prepare-on-premises-tutorial.md). Если вы переносите физические компьютеры, вам не нужно ничего подготавливать. Просто проверьте [матрицу поддержки](vmware-physical-azure-support-matrix.md).


## <a name="select-a-protection-goal"></a>Выбор целевого объекта защиты

Выберите целевые объекты и место для репликации.
1. Щелкните **Хранилища служб восстановления** > хранилище.
2. В меню ресурсов щелкните **Site Recovery** > **Подготовка инфраструктуры** > **Цель защиты**.
3. На вкладке **Цель защиты** выберите объекты для миграции.
    - **VMware**. Выберите **To Azure** (В Azure) > **Да, с VMware vSphere Hypervisor**.
    - **Физический компьютер**. Выберите **To Azure** (В Azure) > **Not virtualized/Other** (Не виртуализированы/Другое).
    - **Hyper-V**. Выберите **To Azure** (В Azure) > **Да, с Hyper-V**. Если управление виртуальными машинами Hyper-V осуществляется с помощью VMM, выберите **Да**.


## <a name="set-up-the-source-environment"></a>Настройка исходной среды

**Сценарий** | **Дополнительные сведения**
--- | --- 
VMware | Настройте [исходную среду](vmware-azure-set-up-source.md) и [сервер конфигурации](vmware-azure-deploy-configuration-server.md).
Физический компьютер | [Настройте](physical-azure-set-up-source.md) исходную среду и сервер конфигурации.
Hyper-V | Настройте [исходную среду](hyper-v-azure-tutorial.md#set-up-the-source-environment)<br/><br/> Настройте [исходную среду](hyper-v-vmm-azure-tutorial.md#set-up-the-source-environment) для Hyper-V, развернутой с System Center VMM.

## <a name="set-up-the-target-environment"></a>Настройка целевой среды

Выберите и проверьте целевые ресурсы.

1. Щелкните **Подготовка инфраструктуры** > **Цель** и выберите требуемую подписку Azure.
2. Укажите модель развертывания с помощью Resource Manager.
3. Site Recovery проверяет ресурсы Azure.
    - При переносе виртуальных машин VMware или физических серверов Site Recovery проверяет, есть ли у вас сеть Azure, в которой будут расположены виртуальные машины Azure, когда они будут созданы после отработки отказа.
    - При переносе виртуальных машин Hyper-V Site Recovery проверяет наличие совместимой учетной записи хранения и сети Azure.
4. Если вы переносите виртуальные машины Hyper-V, которые находятся под управлением System Center VMM, настройте [сетевое сопоставление](hyper-v-vmm-azure-tutorial.md#configure-network-mapping).

## <a name="set-up-a-replication-policy"></a>Настройка политики репликации

**Сценарий** | **Дополнительные сведения**
--- | --- 
VMware | Настройте [политику репликации](vmware-azure-set-up-replication.md) для виртуальных машин VMware.
Физический компьютер | Настройте [политику репликации](physical-azure-disaster-recovery.md#create-a-replication-policy) для физических компьютеров.
Hyper-V | Настройте [политику репликации](hyper-v-azure-tutorial.md#set-up-a-replication-policy)<br/><br/> Настройте [политику репликации](hyper-v-vmm-azure-tutorial.md#set-up-a-replication-policy) для Hyper-V, развернутой с помощью System Center VMM.

## <a name="enable-replication"></a>Включение репликации

**Сценарий** | **Дополнительные сведения**
--- | --- 
VMware | [Включите репликацию](vmware-azure-enable-replication.md) виртуальных машин VMware.
Физический компьютер | [Включите репликацию](physical-azure-disaster-recovery.md#enable-replication) для физических компьютеров.
Hyper-V | [Включение репликации](hyper-v-azure-tutorial.md#enable-replication)<br/><br/> [Включите репликацию](hyper-v-vmm-azure-tutorial.md#enable-replication) для Hyper-V, развернутой с помощью System Center VMM.


## <a name="run-a-test-migration"></a>Выполнение тестовой миграции

Запустите [тестовую отработку отказа](tutorial-dr-drill-azure.md) в Azure, чтобы убедиться в надлежащей работе всех компонентов.


## <a name="migrate-to-azure"></a>Миграция в Azure

Запустите отработку отказа для компьютеров, которые необходимо перенести.

1. В разделе **Параметры** > **Реплицированные элементы** выберите компьютер и щелкните **Отработка отказа**.
2. В разделе **Отработка отказа** выберите **точку восстановления**, в которую будет выполнена отработка отказа. Выберите последнюю точку восстановления.
3. Параметр ключа шифрования не учитывается в этом сценарии.
4. Выберите **Завершение работы виртуальной машины перед началом отработки отказа**. Служба Site Recovery попытается завершить работу виртуальных машин, прежде чем активировать отработку отказа. Отработка отказа продолжится, даже если их не удастся отключить. На странице **Задания** можно следить за ходом выполнения отработки отказа.
5. Убедитесь, что виртуальная машина Azure отображается в Azure должным образом.
6. В разделе **Реплицированные элементы** щелкните виртуальную машину правой кнопкой мыши и выберите **Завершение миграции**. Таким образом вы сделаете следующее:

   - завершите миграцию, прекратите репликацию для локальной виртуальной машины и остановите выставление счетов Site Recovery для виртуальной машины.
   - Удалите данные репликации. Перенесенные виртуальные машины при этом не будут удалены.

     ![Завершение миграции](./media/migrate-tutorial-on-premises-azure/complete-migration.png)


> [!WARNING]
> **Не отменяйте отработку отказа в процессе выполнения.** Перед началом отработки отказа репликация виртуальной машины останавливается. Если отменить выполняющуюся отработку отказа, она остановится, но виртуальная машина не будет реплицирована повторно.

В некоторых сценариях требуется дополнительная обработка отработки отказа, которая длится около 8–10 минут. Тестовая отработка отказа для физических серверов, компьютеров Linux VMware, виртуальных машин VMware без включенной службы DHCP и виртуальных машин VMware без загрузочных драйверов storvsc, vmbus, storflt, intelide, atapi может занимать больше времени.

## <a name="after-migration"></a>После переноса

После миграции компьютеров в Azure нужно выполнить ряд действий.

Некоторые действия можно автоматизировать в ходе миграции с помощью встроенных сценариев автоматизации в [планах восстановления](site-recovery-runbook-automation.md).   


### <a name="post-migration-steps-in-azure"></a>Действия после миграции в Azure

- Выполните любые действия по настройке после миграции приложения, такие как обновление строк подключения к базе данных и конфигурация веб-сервера. 
- Выполните приемочное тестирование конечного приложения и миграции на перенесенном приложении, работающем в Azure.
- [Агент виртуальной машины Azure](https://docs.microsoft.com/azure/virtual-machines/extensions/agent-windows) управляет взаимодействием виртуальной машины с контроллером Azure Fabric. Это обязательно для некоторых служб Azure, таких как Azure Backup, Site Recovery и служба безопасности Azure.
    - При переносе компьютеров и физических серверов VMware установщик Mobility Service устанавливает доступный агент виртуальной машины Azure на компьютерах Windows. Мы рекомендуем установить агент на виртуальных машинах Linux после отработки отказа.
    - Если вы переносите виртуальные машины Azure в дополнительный регион, агент виртуальной машины Azure нужно подготовить к работе на виртуальной машине перед миграцией.
    - Если вы переносите виртуальные машины Hyper-V в Azure, установите агент виртуальной машины Azure на виртуальной машине Azure после миграции.
- Вручную удалите поставщик или агент Site Recovery с виртуальной машины. Если вы переносите виртуальные машины VMware или физические серверы, удалите службу Mobility Service на виртуальной машине.
- Для повышения устойчивости:
    - Обеспечьте безопасность данных путем резервного копирования виртуальных машин Azure с помощью службы Azure Backup. [Узнайте больше]( https://docs.microsoft.com/azure/backup/quick-backup-vm-portal).
    - Обеспечьте непрерывную работу и постоянную доступность рабочих нагрузок за счет репликации виртуальных машин Azure в дополнительный регион с помощью Site Recovery. [Узнайте больше](azure-to-azure-quickstart.md).
- Для повышения уровня безопасности:
    - Заблокируйте и ограничьте доступ входящего трафика с помощью [JIT-администрирования]( https://docs.microsoft.com/azure/security-center/security-center-just-in-time) центра безопасности Azure.
    - Ограничьте сетевой трафик конечными точками с помощью [групп безопасности сети](https://docs.microsoft.com/azure/virtual-network/security-overview).
    - Разверните [шифрование дисков Azure](https://docs.microsoft.com/azure/security/azure-security-disk-encryption-overview), чтобы обеспечить безопасность дисков и защитить данные от кражи и несанкционированного доступа.
    - Ознакомьтесь с дополнительными сведениями о [защите ресурсов IaaS]( https://azure.microsoft.com/services/virtual-machines/secure-well-managed-iaas/ ) и посетите [центр безопасности Azure](https://azure.microsoft.com/services/security-center/ ).
- Для мониторинга и управления:
    - Рассмотрите возможность развертывания [службы "Управление затратами Azure"](https://docs.microsoft.com/azure/cost-management/overview) для мониторинга использования ресурсов и затрат.

### <a name="post-migration-steps-on-premises"></a>Действия после миграции в локальной среде

- Переместите трафик приложения в приложение, работающее на экземпляре перенесенной виртуальной машины Azure.
- Удалите локальные виртуальные машины из списка локальных виртуальных машин.
- Удалите локальные виртуальные машины из локальных заданий резервного копирования.
- Обновите внутренние документы и отразите в них новое расположение и IP-адреса виртуальных машин Azure.




## <a name="next-steps"></a>Дополнительная информация

В рамках работы с этим руководством вы перенесли локальные виртуальные машины в виртуальные машины Azure. Now

> [!div class="nextstepaction"]
> [Настройте аварийное восстановление](azure-to-azure-replicate-after-migration.md) виртуальных машин Azure в дополнительный регион Azure.

  
