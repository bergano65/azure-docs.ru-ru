---
title: Миграция локальных компьютеров в Azure с помощью Azure Site Recovery | Документация Майкрософт
description: В этой статье описан процесс миграции локальных компьютеров в Azure с помощью Azure Site Recovery.
author: rayne-wiselman
ms.service: site-recovery
ms.topic: tutorial
ms.date: 10/28/2018
ms.author: raynew
ms.custom: MVC
ms.openlocfilehash: 176f8bb6fbb7a1a6bb81525cd3833d57bf9a5086
ms.sourcegitcommit: 6b7c8b44361e87d18dba8af2da306666c41b9396
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2018
ms.locfileid: "51568807"
---
# <a name="migrate-on-premises-machines-to-azure"></a>Миграция локальных компьютеров в Azure

Службу [Azure Site Recovery](site-recovery-overview.md) можно использовать не только для того, чтобы администрировать и координировать аварийное восстановление локальных компьютеров и виртуальных машин Azure для обеспечения непрерывности бизнес-процессов и аварийного восстановления (BCDR), но и для управления миграцией локальных компьютеров в Azure.


В этом руководстве показано, как перенести локальные виртуальные машины и физические серверы в Azure. Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Выбор цели репликации
> * Настройка исходной и целевой среды.
> * Настройка политики репликации
> * Включение репликации
> * Запуск тестовой миграции, позволяющей убедиться в правильной работе всех компонентов.
> * Выполнение однократной отработки отказа в Azure.

Это третье руководство в серии. В этом руководстве предполагается, что вы уже выполнили задачи в предыдущих руководствах:

1. [Подготовка Azure](tutorial-prepare-azure.md).
2. Подготовьте локальные серверы [VMware](vmware-azure-tutorial-prepare-on-premises.md) или [Hyper-V](hyper-v-prepare-on-premises-tutorial.md).

Перед началом работы полезно изучить архитектуру [VMware](vmware-azure-architecture.md) или [Hyper-V](hyper-v-azure-architecture.md) для аварийного восстановления.


## <a name="prerequisites"></a>Предварительные требования

Устройства, экспортированные с помощью паравиртуализированных драйверов, не поддерживаются.


## <a name="create-a-recovery-services-vault"></a>Создание хранилища служб восстановления

1. Войдите на [портал Azure](https://portal.azure.com) > **Службы восстановления**.
2. Последовательно выберите **Создать ресурс** > **Мониторинг и управление** > **Backup and Site Recovery**.
3. В поле **Имя** укажите понятное имя **ContosoVMVault**. Если у вас есть несколько подписок, выберите нужную.
4. Создайте группу ресурсов **ContosoRG**.
5. Укажите регион Azure. Сведения о поддерживаемых регионах см. в разделе "Географическая доступность" на странице [цен на службу Azure Site Recovery](https://azure.microsoft.com/pricing/details/site-recovery/).
6. Для быстрого доступа к хранилищу из панели мониторинга щелкните **Закрепить на панели мониторинга**, а затем — **Создать**.

   ![Новое хранилище](./media/migrate-tutorial-on-premises-azure/onprem-to-azure-vault.png)

Новое хранилище появится в колонке **Панель мониторинга** в разделе **Все ресурсы** и на основной странице **Хранилища служб восстановления**.



## <a name="select-a-replication-goal"></a>Выбор цели репликации

Выберите целевые объекты и место для репликации.
1. Щелкните **Хранилища служб восстановления** > хранилище.
2. В меню ресурсов щелкните **Site Recovery** > **Подготовка инфраструктуры** > **Цель защиты**.
3. На вкладке **Цель защиты** выберите объекты для миграции.
    - **VMware.** Выберите **To Azure** (В Azure) > **Yes, with VMWare vSphere Hypervisor** (Да, с использованием гипервизора VMware vSphere).
    - **Физический компьютер.** Выберите **To Azure** (В Azure) > **Not virtualized/Other** (Не виртуализированы/Другое).
    - **Hyper-V**. Выберите **To Azure** (В Azure) > **Yes, with Hyper-V** (Да, с помощью Hyper-V). Если управление виртуальными машинами Hyper-V осуществляется с помощью VMM, выберите **Да**.


## <a name="set-up-the-source-environment"></a>Настройка исходной среды

- [Настройте](vmware-azure-tutorial.md#set-up-the-source-environment) исходную среду для виртуальных машин VMware.
- [Настройте](physical-azure-disaster-recovery.md#set-up-the-source-environment) исходную среду для физических серверов.
- [Настройте](hyper-v-azure-tutorial.md#set-up-the-source-environment) исходную среду для виртуальных машин Hyper-V.

## <a name="set-up-the-target-environment"></a>Настройка целевой среды

Выберите и проверьте целевые ресурсы.

1. Щелкните **Подготовка инфраструктуры** > **Цель** и выберите требуемую подписку Azure.
2. Укажите модель развертывания с помощью Resource Manager.
3. Site Recovery проверяет наличие одной или нескольких совместимых учетных записей хранения и сетей Azure.

## <a name="set-up-a-replication-policy"></a>Настройка политики репликации

- [Настройте политику репликации](vmware-azure-tutorial.md#create-a-replication-policy) для виртуальных машин VMware.
- [Настройте политику репликации](physical-azure-disaster-recovery.md#create-a-replication-policy) для физических серверов.
- [Настройте политику репликации](hyper-v-azure-tutorial.md#set-up-a-replication-policy) для виртуальных машин Hyper-V.


## <a name="enable-replication"></a>Включение репликации

- [Включите репликацию](vmware-azure-tutorial.md#enable-replication) виртуальных машин VMware.
- [Включите репликацию](physical-azure-disaster-recovery.md#enable-replication) для физических серверов.
- Включите репликацию для виртуальных машин Hyper-V [с](hyper-v-vmm-azure-tutorial.md#enable-replication) или [без VMM](hyper-v-azure-tutorial.md#enable-replication).


## <a name="run-a-test-migration"></a>Выполнение тестовой миграции

Запустите [тестовую отработку отказа](tutorial-dr-drill-azure.md) в Azure, чтобы убедиться в надлежащей работе всех компонентов.


## <a name="migrate-to-azure"></a>Миграция в Azure

Запустите отработку отказа для компьютеров, которые необходимо перенести.

1. В разделе **Параметры** > **Реплицированные элементы** выберите компьютер и щелкните **Отработка отказа**.
2. В разделе **Отработка отказа** выберите **точку восстановления**, в которую будет выполнена отработка отказа. Выберите последнюю точку восстановления.
3. Параметр ключа шифрования не учитывается в этом сценарии.
4. Выберите **Завершение работы виртуальной машины перед началом отработки отказа**. Служба Site Recovery попытается завершить работу виртуальных машин, прежде чем активировать отработку отказа. Отработка отказа продолжится, даже если их не удастся отключить. На странице **Задания** можно следить за ходом выполнения отработки отказа.
5. Убедитесь, что виртуальная машина Azure отображается в Azure должным образом.
6. В разделе **Реплицированные элементы** щелкните виртуальную машину правой кнопкой мыши и выберите **Завершение миграции**. Таким образом вы сделаете следующее:

    - Завершите миграцию, прекратите репликацию для виртуальной машины AWS и остановите выставление счетов Site Recovery для виртуальной машины.
    - Удалите данные репликации. Перенесенные виртуальные машины при этом не будут удалены.

    ![Завершение миграции](./media/migrate-tutorial-on-premises-azure/complete-migration.png)


> [!WARNING]
> **Не отменяйте выполняющуюся отработку отказа**. Перед запуском отработки отказа останавливается репликация виртуальной машины. Если отменить выполняющуюся отработку отказа, она остановится, но виртуальная машина не будет реплицирована повторно.

В некоторых сценариях требуется дополнительная обработка отработки отказа, которая длится около 8–10 минут. Тестовая отработка отказа для физических серверов, компьютеров Linux VMware, виртуальных машин VMware без включенной службы DHCP и виртуальных машин VMware без загрузочных драйверов storvsc, vmbus, storflt, intelide, atapi может занимать больше времени.

## <a name="after-migration"></a>После переноса

После миграции компьютеров в Azure нужно выполнить ряд действий.

Некоторые действия можно автоматизировать в ходе миграции с помощью встроенных сценариев автоматизации в [планах восстановления]( https://docs.microsoft.com/azure/site-recovery/site-recovery-runbook-automation).   


### <a name="post-migration-steps-in-azure"></a>Действия после миграции в Azure

- Выполните любые действия по настройке после миграции приложения, такие как обновление строк подключения к базе данных и конфигурация веб-сервера. 
- Выполните приемочное тестирование конечного приложения и миграции на перенесенном приложении, работающем в Azure.
- [Агент виртуальной машины Azure](https://docs.microsoft.com/azure/virtual-machines/extensions/agent-windows) управляет взаимодействием виртуальной машины с контроллером Azure Fabric. Это обязательно для некоторых служб Azure, таких как Azure Backup, Site Recovery и служба безопасности Azure.
    - При переносе компьютеров и физических серверов VMware установщик Mobility Service устанавливает доступный агент виртуальной машины Azure на компьютерах Windows. Мы рекомендуем установить агент на виртуальных машинах Linux после отработки отказа. a
    - Если вы переносите виртуальные машины Azure в дополнительный регион, агент виртуальной машины Azure нужно подготовить к работе на виртуальной машине перед миграцией.
    - Если вы переносите виртуальные машины Hyper-V в Azure, установите агент виртуальной машины Azure на виртуальной машине Azure после миграции.
- Вручную удалите поставщик или агент Site Recovery с виртуальной машины. Если выполняется миграция виртуальных машин или физических серверов VMware, [удалите Mobility Service][vmware-azure-install-mobility-service.md#uninstall-mobility-service-on-a-windows-server-computer] с виртуальной машины Azure.
- Для повышения устойчивости:
    - Обеспечьте безопасность данных путем резервного копирования виртуальных машин Azure с помощью службы Azure Backup. [Узнайте больше]( https://docs.microsoft.com/azure/backup/quick-backup-vm-portal).
    - Обеспечьте непрерывную работу и постоянную доступность рабочих нагрузок за счет репликации виртуальных машин Azure в дополнительный регион с помощью Site Recovery. [Узнайте больше](azure-to-azure-quickstart.md).
- Для повышения уровня безопасности:
    - Заблокируйте и ограничьте доступ входящего трафика с помощью [JIT-администрирования]( https://docs.microsoft.com/azure/security-center/security-center-just-in-time) центра безопасности Azure.
    - Ограничьте сетевой трафик конечными точками с помощью [групп безопасности сети](https://docs.microsoft.com/azure/virtual-network/security-overview).
    - Разверните [шифрование дисков Azure](https://docs.microsoft.com/azure/security/azure-security-disk-encryption-overview), чтобы обеспечить безопасность дисков и защитить данные от кражи и несанкционированного доступа.
    - Ознакомьтесь с дополнительными сведениями о [защите ресурсов IaaS]( https://azure.microsoft.com/services/virtual-machines/secure-well-managed-iaas/ ) и посетите [центр безопасности Azure](https://azure.microsoft.com/services/security-center/ ).
- Для мониторинга и управления:
    - Рассмотрите возможность развертывания [службы "Управление затратами Azure"](https://docs.microsoft.com/azure/cost-management/overview) для мониторинга использования ресурсов и затрат.

### <a name="post-migration-steps-on-premises"></a>Действия после миграции в локальной среде

- Переместите трафик приложения в приложение, работающее на экземпляре перенесенной виртуальной машины Azure.
- Удалите локальные виртуальные машины из списка локальных виртуальных машин.
- Удалите локальные виртуальные машины из локальных заданий резервного копирования.
- Обновите внутренние документы и отразите в них новое расположение и IP-адреса виртуальных машин Azure.


## <a name="next-steps"></a>Дополнительная информация

В рамках работы с этим руководством вы перенесли локальные виртуальные машины в виртуальные машины Azure. Теперь вы можете [настроить аварийное восстановление](azure-to-azure-replicate-after-migration.md) в дополнительный регион Azure для виртуальных машин Azure.

  
