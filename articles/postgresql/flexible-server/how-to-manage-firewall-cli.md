---
title: Управление правилами брандмауэра. Azure CLI — гибкий сервер в базе данных Azure для PostgreSQL
description: Создание правил брандмауэра для базы данных Azure для PostgreSQL-гибкого сервера и управление ими с помощью командной строки Azure CLI.
author: ambhatna
ms.author: ambhatna
ms.service: postgresql
ms.devlang: azurecli
ms.topic: how-to
ms.date: 09/22/2020
ms.custom: devx-track-azurecli
ms.openlocfilehash: d1019c31b10801a12c960dd5dadd8836fd9b7cd2
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "90939278"
---
# <a name="create-and-manage-azure-database-for-postgresql---flexible-server-firewall-rules-using-the-azure-cli"></a>Создание и Администрирование базы данных Azure для PostgreSQL — гибких правил брандмауэра сервера с помощью Azure CLI

> [!IMPORTANT]
> Гибкий сервер Базы данных Azure для PostgreSQL предоставляется в режиме предварительной версии

База данных Azure для PostgreSQL — гибкий сервер поддерживает два типа взаимоисключающих методов сетевого подключения для подключения к гибкому серверу. Эти два варианта указаны ниже:

* Открытый доступ (разрешенные IP-адреса)
* Закрытый доступ (интеграция виртуальной сети)

В этой статье мы рассмотрим создание сервера PostgreSQL с **общедоступным IP-адресом** с помощью Azure CLI и предоставит общие сведения о Azure CLI командах, которые можно использовать для создания, обновления, удаления, перечисления и отображения правил брандмауэра после создания сервера. При наличии *общего доступа (разрешенных IP-адресов)* подключения к серверу PostgreSQL ограничиваются только РАЗРЕШЕННЫМИ IP-адресами. IP-адреса клиентов должны быть разрешены в правилах брандмауэра. Дополнительные сведения см. в разделе [общий доступ (разрешенные IP-адреса)](./concepts-networking.md#public-access-allowed-ip-addresses). Правила брандмауэра могут быть определены во время создания сервера (рекомендуется), но их также можно добавить позже.

## <a name="launch-azure-cloud-shell"></a>Запуск Azure Cloud Shell

[Azure Cloud Shell](../../cloud-shell/overview.md) — это бесплатная интерактивная оболочка, с помощью которой можно выполнять действия, описанные в этой статье. Она включает предварительно установленные общие инструменты Azure и настроена для использования с вашей учетной записью.

Чтобы открыть Cloud Shell, просто выберите **Попробовать** в правом верхнем углу блока кода. Кроме того, Cloud Shell можно открыть в отдельной вкладке браузера. Для этого перейдите на страницу [https://shell.azure.com/bash](https://shell.azure.com/bash). Нажмите кнопку **Копировать**, чтобы скопировать блоки кода. Вставьте код в Cloud Shell и нажмите клавишу **ВВОД**, чтобы выполнить его.

Если вы решили установить и использовать CLI локально, для выполнения инструкций, приведенных в этом кратком руководстве, вам потребуется Azure CLI 2.0 или более поздней версии. Чтобы узнать версию, выполните команду `az --version`. Если вам необходимо выполнить установку или обновление, см. статью [Установка Azure CLI 2.0](https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest).

## <a name="prerequisites"></a>Предварительные требования

Вам потребуется войти в учетную запись с помощью команды [az login](https://docs.microsoft.com/cli/azure/reference-index?view=azure-cli-latest#az-login). Обратите внимание на свойство **ID** , которое ОТНОСИТСЯ к **идентификатору подписки** для учетной записи Azure.

```azurecli-interactive
az login
```

Выберите конкретную подписку вашей учетной записи, выполнив команду [az account set](https://docs.microsoft.com/cli/azure/account?view=azure-cli-latest#az-account-set). Запишите значение **идентификатора** из выходных данных **имени входа AZ** , чтобы использовать его в качестве значения аргумента **Subscription** в команде. Если вы используете несколько подписок, выберите соответствующую, в которой за ресурс будет взиматься плата. Чтобы отобразить все ваши подписки, выполните команду [az account list](https://docs.microsoft.com/cli/azure/account?view=azure-cli-latest#az-account-list).

```azurecli
az account set --subscription <subscription id>
```

## <a name="create-firewall-rule-during-flexible-server-create-using-azure-cli"></a>Создание правила брандмауэра во время гибкого создания сервера с помощью Azure CLI

С помощью команды можно `az postgres flexible-server --public access` создать гибкий сервер с общедоступным *IP-адресом* и настроить правила брандмауэра во время создания гибкого сервера. Для предоставления разрешенных IP-адресов, которые смогут подключаться к серверу, можно использовать параметр **--Public-Access** . Можно указать один или диапазон IP-адресов, которые будут включаться в список разрешенных адресов. Диапазон IP-адресов должен быть разделен дефисом и не содержать пробелов. Существует несколько вариантов создания гибкого сервера с помощью интерфейса командной строки, как показано в примере ниже.

См. справочную документацию по Azure CLI <!--FIXME --> где описаны все настраиваемые параметры для интерфейса командной строки. Например, в приведенных ниже командах можно дополнительно указать группу ресурсов.

- Создание гибкого сервера с общедоступным доступом и Добавление IP-адреса клиента для доступа к серверу
    ```azurecli-interactive
    az postgres flexible-server create --public-access <my_client_ip>
    ```
- Создайте гибкий сервер с общедоступным доступом и добавьте диапазон IP-адресов, чтобы получить доступ к этому серверу.

    ```azurecli-interactive
    az postgres flexible-server create --public-access <start_ip_address-end_ip_address>
    ```
- Создайте гибкий сервер с общедоступным доступом и разрешите приложениям из IP-адресов Azure подключаться к гибкому серверу.
    ```azurecli-interactive
    az postgres flexible-server create --public-access 0.0.0.0
    ```
    > [!IMPORTANT]
    > Этот параметр позволяет настроить брандмауэр для разрешения общего доступа из служб и ресурсов Azure в Azure к этому серверу, включая подключения из подписок других клиентов. При выборе этого параметра убедитесь, что используемое имя для входа и разрешения пользователя предоставляют доступ только авторизованным пользователям.
    >
- - Создание гибкого сервера с общедоступным доступом и разрешение доступа ко всем IP-адресам
    ```azurecli-interactive
    az postgres flexible-server create --public-access all
    ```
    >[!Note]
    > Приведенная выше команда создаст правило брандмауэра с начальным IP-адресом = 0.0.0.0, конечным IP-адресом — 255.255.255.255, а IP-адреса не будут блокироваться. Любой узел в Интернете может получить доступ к этому серверу. Настоятельно рекомендуется использовать это правило только временно и только на тестовых серверах, которые не содержат конфиденциальные данные.
- Создание гибкого сервера с общедоступным доступом и без IP-адреса
    ```azurecli-interactive
    az postgres flexible-server create --public-access none
    ```
    >[!Note]
    > не рекомендуется создавать сервер без правил брандмауэра. Если не добавить никаких правил брандмауэра, клиент не сможет подключиться к серверу.
## <a name="create-and-manage-firewall-rule-after-server-create"></a>Создание правила брандмауэра и управление им после создания сервера
Команда **AZ postgres гибок-Server Firewall-Rule** используется в Azure CLI для создания, удаления, перечисления, отображения и обновления правил брандмауэра.

Команды:
- **Создание**: создание гибкого правила брандмауэра сервера.
- **List**: список гибких правил брандмауэра сервера.
- **Обновление**: обновление гибкого правила брандмауэра сервера.
- **Показывать**: отображение сведений о гибком правиле брандмауэра сервера.
- **Удаление**: удаление гибкого правила брандмауэра сервера.

См. справочную документацию по Azure CLI <!--FIXME --> где описаны все настраиваемые параметры для интерфейса командной строки. Например, в приведенных ниже командах можно дополнительно указать группу ресурсов.

### <a name="create-a-firewall-rule"></a>Создание правила брандмауэра
Используйте `az postgres flexible-server firewall-rule create` команду, чтобы создать новое правило брандмауэра на сервере.
Чтобы разрешить доступ к диапазону IP-адресов, укажите IP-адрес в качестве начального IP-адреса и конечного IP-адреса, как показано в этом примере.
```azurecli-interactive
az postgres flexible-server firewall-rule create --name mydemoserver --start-ip-address 13.83.152.0 --end-ip-address 13.83.152.15
```

Чтобы разрешить доступ для одного IP-адреса, просто укажите один IP-адрес, как в этом примере.
```azurecli-interactive
az postgres flexible-server firewall-rule create --name mydemoserver --start-ip-address 1.1.1.1
```

Чтобы разрешить приложениям из IP-адресов Azure подключаться к гибкому серверу, укажите IP-адрес 0.0.0.0 в качестве начального IP-адреса, как показано в этом примере.
```azurecli-interactive
az postgres flexible-server firewall-rule create --name mydemoserver --start-ip-address 0.0.0.0
```

> [!IMPORTANT]
> Этот параметр позволяет настроить брандмауэр для разрешения общего доступа из служб и ресурсов Azure в Azure к этому серверу, включая подключения из подписок других клиентов. При выборе этого параметра убедитесь, что используемое имя для входа и разрешения пользователя предоставляют доступ только авторизованным пользователям.
> 
При успешном выполнении выходные данные каждой команды create будут содержать сведения о созданном правиле брандмауэра в формате JSON (по умолчанию). Если возникнет сбой, выходные данные будут содержать вместо этого текст сообщения об ошибке.

### <a name="list-firewall-rules"></a>Вывод списка правил брандмауэра 
Используйте `az postgres flexible-server firewall-rule list` команду для вывода списка существующих правил брандмауэра сервера на сервере. Обратите внимание, что атрибут имени сервера указан в параметре **--Name** . 
```azurecli-interactive
az postgres flexible-server firewall-rule list --name mydemoserver
```
Выходные данные будут содержать правила, если они имеются, в формате JSON (по умолчанию). Для вывода результатов в более удобочитаемом табличном формате можно использовать параметр--OUTPUT Table * *.
```azurecli-interactive
az postgres flexible-server firewall-rule list --name mydemoserver --output table
```

### <a name="update-a-firewall-rule"></a>Обновление правила брандмауэра
Используйте `az postgres flexible-server firewall-rule update` команду, чтобы обновить существующее правило брандмауэра на сервере. Укажите имя существующего правила брандмауэра в качестве входных данных, а также атрибуты начальный IP-адрес и конечный IP-адрес для обновления.
```azurecli-interactive
az postgres flexible-server firewall-rule update --name mydemoserver --rule-name FirewallRule1 --start-ip-address 13.83.152.0 --end-ip-address 13.83.152.1
```
При успешном выполнении команды ее выходные данные будут содержать сведения об обновленном правиле брандмауэра в формате JSON (по умолчанию). Если возникнет сбой, выходные данные будут содержать вместо этого текст сообщения об ошибке.

> [!NOTE]
> Если правило брандмауэра не существует, оно будет создано командой update.
### <a name="show-firewall-rule-details"></a>Отображение сведений о правиле брандмауэра
Используйте `az postgres flexible-server firewall-rule show` команду, чтобы отобразить сведения о существующем правиле брандмауэра с сервера. Укажите имя существующего правила брандмауэра в качестве входных данных.
```azurecli-interactive
az postgres flexible-server firewall-rule show --name mydemoserver --rule-name FirewallRule1
```
При успешном выполнении команды ее выходные данные будут содержать сведения об указанном правиле брандмауэра в формате JSON (по умолчанию). Если возникнет сбой, выходные данные будут содержать вместо этого текст сообщения об ошибке.

### <a name="delete-a-firewall-rule"></a>Удаление правила брандмауэра
Используйте `az postgres flexible-server firewall-rule delete` команду, чтобы удалить существующее правило брандмауэра с сервера. Укажите имя существующего правила брандмауэра.
```azurecli-interactive
az postgres flexible-server firewall-rule delete --name mydemoserver --rule-name FirewallRule1
```
При успешном выполнении выходные данные отсутствуют. В случае сбоя отображается текст сообщения об ошибке.

## <a name="next-steps"></a>Дальнейшие шаги
- Дополнительные сведения о работе [в сети в базе данных Azure для PostgreSQL-гибкого сервера](./concepts-networking.md)
- Дополнительные сведения о [базе данных Azure для PostgreSQL. правила брандмауэра для гибких серверов](./concepts-networking.md#public-access-allowed-ip-addresses)
- [Создание и Администрирование базы данных Azure для PostgreSQL — гибких правил брандмауэра сервера с помощью портал Azure](./how-to-manage-firewall-portal.md).
