---
title: Управление репликами чтения для базы данных Azure для PostgreSQL-Single Server из портал Azure
description: Узнайте, как управлять репликами чтения базы данных Azure для PostgreSQL-Single Server из портал Azure.
author: rachel-msft
ms.author: raagyema
ms.service: postgresql
ms.topic: conceptual
ms.date: 08/21/2019
ms.openlocfilehash: d0f29e2c01d6295935ac56cb19c37e1ad6bbd21b
ms.sourcegitcommit: beb34addde46583b6d30c2872478872552af30a1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/22/2019
ms.locfileid: "69907383"
---
# <a name="create-and-manage-read-replicas-in-azure-database-for-postgresql---single-server-from-the-azure-portal"></a>Создание реплик чтения и управление ими в базе данных Azure для PostgreSQL — один сервер из портал Azure

В этой статье описано, как создавать реплики чтения и управлять ими в службе "База данных Azure для PostgreSQL" с помощью портала Azure. Дополнительные сведения о репликах чтения см. в [этой статье](concepts-read-replicas.md).

> [!IMPORTANT]
> Реплику чтения можно создать в том же регионе, что и главный сервер, или в любом другом регионе Azure по своему усмотрению. Репликация между регионами в настоящее время доступна в общедоступной предварительной версии.


## <a name="prerequisites"></a>Предварительные требования
[Сервер службы "База данных Azure для PostgreSQL"](quickstart-create-server-database-portal.md) в качестве главного.

## <a name="prepare-the-master-server"></a>Подготовка главного сервера
Приведенные ниже действия позволяют подготовить главный сервер в ценовой категории "Общего назначения" или "Оптимизированная для операций в памяти". Главный сервер подготавливается к репликации с помощью параметра Azure. replication_support. При изменении параметра репликации требуется перезагрузка сервера, чтобы изменения вступили в силу. В портал Azure эти два действия инкапсулированы одной кнопкой, **обеспечивают поддержку репликации**.

1. На портале Azure выберите имеющийся сервер службы "База данных Azure для PostgreSQL", который будет главным.

2. На боковой панели сервера в разделе **Параметры**выберите **репликация**.

3. Выберите **включить поддержку репликации**. 

   ![Включить поддержку репликации](./media/howto-read-replicas-portal/enable-replication-support.png)

4. Подтвердите, что вы хотите включить поддержку репликации. Эта операция приведет к перезапуску главного сервера. 

   ![Подтверждение включения поддержки репликации](./media/howto-read-replicas-portal/confirm-enable-replication.png)
   
5. После завершения операции вы получите два портал Azure уведомлений. Для обновления параметра сервера существует одно уведомление. Еще одно уведомление о перезапуске сервера следует сразу же.

   ![Уведомления об успешном выполнении — включить](./media/howto-read-replicas-portal/success-notifications-enable.png)

6. Обновите страницу портал Azure, чтобы обновить панель инструментов репликации. Теперь можно создавать реплики чтения для этого сервера.

   ![Обновленная панель инструментов](./media/howto-read-replicas-portal/updated-toolbar.png)
   
Включение поддержки репликации является одноразовой операцией на главном сервере. Для удобства предоставляется кнопка **Отключить поддержку репликации** . Не рекомендуется отключать поддержку репликации, если только вы не уверены, что реплика не будет создана на этом главном сервере. Невозможно отключить поддержку репликации, пока на главном сервере имеются реплики.


## <a name="create-a-read-replica"></a>Создание реплики чтения
Чтобы создать реплику чтения, выполните следующие действия:

1. Выберите имеющийся сервер службы "База данных Azure для PostgreSQL", который будет использоваться в качестве главного. 

2. На боковой панели сервера в разделе **Параметры**выберите **репликация**.

3. Выберите **Добавить реплику**.

   ![Добавление реплики](./media/howto-read-replicas-portal/add-replica.png)

4. Введите имя реплики чтения. 

    ![Присвоение имени реплике](./media/howto-read-replicas-portal/name-replica.png)

5. Выберите расположение для реплики. Расположение по умолчанию совпадает с местоположением главного сервера.

    ![Выберите расположение](./media/howto-read-replicas-portal/location-replica.png)

   > [!NOTE]
   > Дополнительные сведения о том, в каких регионах можно создать реплику, см. в [статье чтение основных](concepts-read-replicas.md)сведений о репликах. 

6. Нажмите кнопку **ОК**, чтобы подтвердить создание реплики.

Реплика создается с использованием тех же параметров вычислений и хранилища, что и у главного сервера. После создания реплики вы можете независимо от главного сервера изменять следующие ее параметры: поколение вычислительных ресурсов, число виртуальных ядер, объем хранилища и период хранения резервных копий. Изменить также можно ценовую категорию (за исключением уровня "Базовый").

> [!IMPORTANT]
> Перед обновлением параметра главного сервера до нового значения измените значение параметра реплики на равное или большее. Это действие помогает реплике справиться с изменениями, внесенными в главную базу.

Созданную реплику чтения можно просмотреть в окне **Репликация**:

![Просмотр новой реплики в окне "Репликация"](./media/howto-read-replicas-portal/list-replica.png)
 

## <a name="stop-replication"></a>Остановить репликацию
Вы можете остановить репликацию между главным сервером и репликой чтения.

> [!IMPORTANT]
> Остановленную репликацию отменить невозможно. Реплика чтения становится отдельным сервером, который поддерживает операции чтения и записи. Это сервер нельзя снова преобразовать в реплику.

Чтобы остановить репликацию между главным сервером и репликой чтения на портале Azure, выполните следующие действия:

1. На портале Azure выберите главный сервер Базы данных Azure для PostgreSQL.

2. В меню сервера в разделе **Параметры** выберите **Репликация**.

3. Выберите сервер-реплику, на котором нужно остановить репликацию.

   ![Выбор реплики](./media/howto-read-replicas-portal/select-replica.png)
 
4. Щелкните **Остановить репликацию**.

   ![Команда "Остановить репликацию"](./media/howto-read-replicas-portal/select-stop-replication.png)
 
5. Нажмите кнопку **ОК**, чтобы подтвердить остановку репликации.

   ![Подтверждение остановки репликации](./media/howto-read-replicas-portal/confirm-stop-replication.png)
 

## <a name="delete-a-master-server"></a>Удаление главного сервера
Чтобы удалить главный сервер, выполните те же действия, что и для отдельного сервера службы "База данных Azure для PostgreSQL". 

> [!IMPORTANT]
> При удалении главного сервера репликация всех реплик чтения останавливается. Реплики чтения становятся автономными серверами, которые начинают поддерживать операции чтения и записи.

Чтобы удалить сервер на портале Azure, сделайте следующе:

1. На портале Azure выберите главный сервер Базы данных Azure для PostgreSQL.

2. Откройте страницу **Обзор** сервера. Нажмите кнопку **Удалить**.

   ![Удаление главного сервера на странице "Обзор"](./media/howto-read-replicas-portal/delete-server.png)
 
3. Введите имя главного сервера, который нужно удалить. Нажмите кнопку **Удалить**, чтобы подтвердить удаление главного сервера.

   ![Подтверждение удаления главного сервера](./media/howto-read-replicas-portal/confirm-delete.png)
 

## <a name="delete-a-replica"></a>Удаление реплики
Чтобы удалить реплику чтения, выполните те же действия, что и для удаления главного сервера

- На портале Azure откройте страницу **Обзор** реплики чтения. Нажмите кнопку **Удалить**.

   ![Удаление реплики на странице "Обзор"](./media/howto-read-replicas-portal/delete-replica.png)
 
Кроме того, реплику можно удалить из окна **Репликация**, выполнив следующие действия:

1. На портале Azure выберите главный сервер Базы данных Azure для PostgreSQL.

2. В меню сервера в разделе **Параметры** выберите **Репликация**.

3. Выберите реплику чтения, которую нужно удалить.

   ![Выбор реплики, которую нужно удалить.](./media/howto-read-replicas-portal/select-replica.png)
 
4. Щелкните **Удалить реплику**.

   ![Выбор команды удаления реплики](./media/howto-read-replicas-portal/select-delete-replica.png)
 
5. Введите имя реплики, которую нужно удалить. Нажмите кнопку **Удалить**, чтобы подтвердить удаление реплики.

   ![Подтверждение удаления реплики](./media/howto-read-replicas-portal/confirm-delete-replica.png)
 

## <a name="monitor-a-replica"></a>Мониторинг реплики
Выполнять мониторинг реплик чтения можно на основе двух метрик.

### <a name="max-lag-across-replicas-metric"></a>Метрика Max Lag Across Replicas (Максимальная задержка между репликами)
Метрика **Max Lag Across Replicas** (Максимальная задержка между репликами) показывает задержку между главным сервером и репликой с наибольшей задержкой в байтах. 

1.  На портале Azure выберите главный сервер службы "База данных Azure для PostgreSQL".

2.  Выберите **Метрики**. В окне **Метрики** выберите **Max Lag Across Replicas** (Максимальная задержка между репликами).

    ![Отслеживание максимальной задержки между репликами](./media/howto-read-replicas-portal/select-max-lag.png)
 
3.  Для параметра **агрегирования** установите значение **Макс.**


### <a name="replica-lag-metric"></a>Метрика Replica Lag (Задержка реплики)
Метрика **Replica Lag** (Задержка реплики) показывает время с момента последнего воспроизведения транзакций по реплике. Если на главном сервере не выполняются транзакции, метрика будет отображать соответствующее время задержки.

1. На портале Azure выберите реплику чтения службы "База данных Azure для PostgreSQL".

2. Выберите **Метрики**. В окне **Метрики** выберите **Replica Lag** (Задержка реплики).

   ![Отслеживание задержки реплики](./media/howto-read-replicas-portal/select-replica-lag.png)
 
3. Для параметра **агрегирования** установите значение **Макс.** 
 
## <a name="next-steps"></a>Следующие шаги
* См. дополнительные сведения о [репликах чтения в Базе данных Azure для PostgreSQL](concepts-read-replicas.md).
* Узнайте, как [создавать реплики чтения и управлять ими в Azure CLI](howto-read-replicas-cli.md).