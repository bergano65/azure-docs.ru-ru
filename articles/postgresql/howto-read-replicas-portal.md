---
title: Управление репликами чтения в службе "База данных Azure для PostgreSQL" с помощью портала Azure
description: Узнайте, как управлять репликами чтения в службе "База данных Azure для PostgreSQL" с помощью портала Azure.
author: rachel-msft
ms.author: raagyema
ms.service: postgresql
ms.topic: conceptual
ms.date: 02/19/2019
ms.openlocfilehash: 24a37775298d6c6b40ec49f34158fcb77f26a379
ms.sourcegitcommit: 5839af386c5a2ad46aaaeb90a13065ef94e61e74
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/18/2019
ms.locfileid: "58113220"
---
# <a name="create-and-manage-read-replicas-from-the-azure-portal"></a>Создание реплик чтения и управление ими с помощью портала Azure

В этой статье описано, как создавать реплики чтения и управлять ими в службе "База данных Azure для PostgreSQL" с помощью портала Azure. Дополнительные сведения о репликах чтения см. в [этой статье](concepts-read-replicas.md).

> [!IMPORTANT]
> Компонент "Реплика чтения" доступен в рамках общедоступной предварительной версии.

## <a name="prerequisites"></a>Технические условия
[Сервер службы "База данных Azure для PostgreSQL"](quickstart-create-server-database-portal.md) в качестве главного.

## <a name="prepare-the-master-server"></a>Подготовка главного сервера
Приведенные ниже действия позволяют подготовить главный сервер в ценовой категории "Общего назначения" или "Оптимизированная для операций в памяти".

На главном сервере задайте для параметра `azure.replication_support` значение **REPLICA**. После изменения значения этого параметра сервер необходимо перезапустить, чтобы изменения вступили в силу.

1. На портале Azure выберите имеющийся сервер службы "База данных Azure для PostgreSQL", который будет главным.

2. В меню слева выберите **Параметры сервера**.

3. Найдите параметр `azure.replication_support`.

   ![Поиск параметра azure.replication_support](./media/howto-read-replicas-portal/azure-replication-parameter.png)

4. Задайте для параметра `azure.replication_support` значение **REPLICA**. Выберите **Сохранить**, чтобы сохранить изменения.

   ![Задание для параметра значение REPLICA и сохранение изменений](./media/howto-read-replicas-portal/save-parameter-replica.png)

5. После сохранения изменений вы получите уведомление:

   ![Уведомление о сохранении](./media/howto-read-replicas-portal/parameter-save-notification.png)

6. Перезапустите сервер, чтобы применить изменения. Дополнительные сведения о перезапуске сервера службы "База данных Azure для PostgreSQL" см. в [этой статье](howto-restart-server-portal.md).


## <a name="create-a-read-replica"></a>Создание реплики чтения
Чтобы создать реплику чтения, выполните следующие действия:

1. Выберите имеющийся сервер службы "База данных Azure для PostgreSQL", который будет использоваться в качестве главного. 

2. В меню сервера в разделе **Параметры** выберите **Репликация**.

   Если вы не задали для параметра `azure.replication_support` значение **REPLICA** на главном сервере общего назначения или с оптимизацией для операций в памяти и не перезапустили сервер, появится соответствующее сообщение. Это нужно сделать, прежде чем перейти к созданию реплики.

3. Выберите **Добавить реплику**.

   ![Добавление реплики](./media/howto-read-replicas-portal/add-replica.png)

4. Введите имя реплики чтения. Нажмите кнопку **ОК**, чтобы подтвердить создание реплики.

   ![Присвоение имени реплике](./media/howto-read-replicas-portal/name-replica.png) 

Реплика создается с той же конфигурацией сервера, что и у главного сервера. После создания реплики вы можете независимо от главного сервера изменять следующие ее параметры: поколение вычислительных ресурсов, число виртуальных ядер, объем хранилища и период хранения резервных копий. Изменить также можно ценовую категорию (за исключением уровня "Базовый").

> [!IMPORTANT]
> Прежде чем изменить параметры конфигурации на главном сервере, установите на каждой реплике такие же или более высокие значения. Это позволит реплике справляться с нагрузкой, соответствующей новым параметрам главного сервера.

Созданную реплику чтения можно просмотреть в окне **Репликация**:

![Просмотр новой реплики в окне "Репликация"](./media/howto-read-replicas-portal/list-replica.png)
 

## <a name="stop-replication"></a>Остановка репликации
Вы можете остановить репликацию между главным сервером и репликой чтения.

> [!IMPORTANT]
> Остановленную репликацию отменить невозможно. Реплика чтения становится отдельным сервером, который поддерживает операции чтения и записи. Это сервер нельзя снова преобразовать в реплику.

Чтобы остановить репликацию между главным сервером и репликой чтения на портале Azure, выполните следующие действия:

1. На портале Azure выберите главный сервер Базы данных Azure для PostgreSQL.

2. В меню сервера в разделе **Параметры** выберите **Репликация**.

3. Выберите сервер-реплику, на котором нужно остановить репликацию.

   ![Выбор реплики](./media/howto-read-replicas-portal/select-replica.png)
 
4. Щелкните **Остановить репликацию**.

   ![Команда "Остановить репликацию"](./media/howto-read-replicas-portal/select-stop-replication.png)
 
5. Нажмите кнопку **ОК**, чтобы подтвердить остановку репликации.

   ![Подтверждение остановки репликации](./media/howto-read-replicas-portal/confirm-stop-replication.png)
 

## <a name="delete-a-master-server"></a>Удаление главного сервера
Чтобы удалить главный сервер, выполните те же действия, что и для отдельного сервера службы "База данных Azure для PostgreSQL". 

> [!IMPORTANT]
> При удалении главного сервера репликация всех реплик чтения останавливается. Реплики чтения становятся автономными серверами, которые начинают поддерживать операции чтения и записи.

Чтобы удалить сервер на портале Azure, сделайте следующе:

1. На портале Azure выберите главный сервер Базы данных Azure для PostgreSQL.

2. Откройте страницу **Обзор** сервера. Нажмите кнопку **Удалить**.

   ![Удаление главного сервера на странице "Обзор"](./media/howto-read-replicas-portal/delete-server.png)
 
3. Введите имя главного сервера, который нужно удалить. Нажмите кнопку **Удалить**, чтобы подтвердить удаление главного сервера.

   ![Подтверждение удаления главного сервера](./media/howto-read-replicas-portal/confirm-delete.png)
 

## <a name="delete-a-replica"></a>Удаление реплики
Чтобы удалить реплику чтения, выполните те же действия, что и для удаления главного сервера

- На портале Azure откройте страницу **Обзор** реплики чтения. Нажмите кнопку **Удалить**.

   ![Удаление реплики на странице "Обзор"](./media/howto-read-replicas-portal/delete-replica.png)
 
Кроме того, реплику можно удалить из окна **Репликация**, выполнив следующие действия:

1. На портале Azure выберите главный сервер Базы данных Azure для PostgreSQL.

2. В меню сервера в разделе **Параметры** выберите **Репликация**.

3. Выберите реплику чтения, которую нужно удалить.

   ![Выбор реплики, которую нужно удалить.](./media/howto-read-replicas-portal/select-replica.png)
 
4. Щелкните **Удалить реплику**.

   ![Выбор команды удаления реплики](./media/howto-read-replicas-portal/select-delete-replica.png)
 
5. Введите имя реплики, которую нужно удалить. Нажмите кнопку **Удалить**, чтобы подтвердить удаление реплики.

   ![Подтверждение удаления реплики](./media/howto-read-replicas-portal/confirm-delete-replica.png)
 

## <a name="monitor-a-replica"></a>Мониторинг реплики
Выполнять мониторинг реплик чтения можно на основе двух метрик.

### <a name="max-lag-across-replicas-metric"></a>Метрика Max Lag Across Replicas (Максимальная задержка между репликами)
Метрика **Max Lag Across Replicas** (Максимальная задержка между репликами) показывает задержку между главным сервером и репликой с наибольшей задержкой в байтах. 

1.  На портале Azure выберите главный сервер службы "База данных Azure для PostgreSQL".

2.  Выберите **Метрики**. В окне **Метрики** выберите **Max Lag Across Replicas** (Максимальная задержка между репликами).

    ![Отслеживание максимальной задержки между репликами](./media/howto-read-replicas-portal/select-max-lag.png)
 
3.  Для параметра **агрегирования** установите значение **Макс.**


### <a name="replica-lag-metric"></a>Метрика Replica Lag (Задержка реплики)
Метрика **Replica Lag** (Задержка реплики) показывает время с момента последнего воспроизведения транзакций по реплике. Если на главном сервере не выполняются транзакции, метрика будет отображать соответствующее время задержки.

1. На портале Azure выберите реплику чтения службы "База данных Azure для PostgreSQL".

2. Выберите **Метрики**. В окне **Метрики** выберите **Replica Lag** (Задержка реплики).

   ![Отслеживание задержки реплики](./media/howto-read-replicas-portal/select-replica-lag.png)
 
3. Для параметра **агрегирования** установите значение **Макс.** 
 
## <a name="next-steps"></a>Дальнейшие действия
См. дополнительные сведения о [репликах чтения в Базе данных Azure для PostgreSQL](concepts-read-replicas.md).