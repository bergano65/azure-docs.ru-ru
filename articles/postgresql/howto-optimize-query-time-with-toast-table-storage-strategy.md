---
title: 'Оптимизация времени запроса с помощью стратегии хранения ВСПЛЫВАЮЩИХ таблицы в базе данных Azure для PostgreSQL: один сервер'
description: 'В этой статье описывается, как оптимизировать время запроса со стратегией хранения ВСПЛЫВАЮЩИХ таблицы в базе данных Azure для PostgreSQL: один сервер.'
author: dianaputnam
ms.author: dianas
ms.service: postgresql
ms.topic: conceptual
ms.date: 5/6/2019
ms.openlocfilehash: ac1dc43a2b89bc1cc748947ec08e6ada87edbfcb
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65066973"
---
# <a name="optimize-query-time-with-the-toast-table-storage-strategy"></a>Оптимизация времени выполнения запросов с помощью стратегии хранения таблицы TOAST 
В этой статье описывается, как оптимизировать время выполнения запросов, применяя стратегию хранения таблицы TOAST.

## <a name="toast-table-storage-strategies"></a>Стратегии хранения таблицы TOAST
Для хранения столбцов на диске применяются четыре различные стратегии, которые могут использовать методику TOAST. Они представляют различные сочетания сжатия и внешнего хранения. Стратегию можно задать на уровне типа данных и на уровне столбцов.
- **Обычная** стратегия предотвращает сжатие или внешнее хранение. Она отключает использование однобайтовых заголовков для типов varlena. Обычная стратегия возможна только для столбцов с типами данных, которые не поддерживают TOAST.
- **Расширенная** стратегия допускает как сжатие, так и внешнее хранение. Она используется по умолчанию для большинства типов данных, которые поддерживают TOAST. Сначала выполняется попытка сжатия. Если строка является по-прежнему слишком большой, предпринимается попытка использовать внешнее хранение.
- **Внешняя** стратегия допускает внешнее хранение, но не сжатие. При применении внешней стратегии подстрочные операции в больших текстовых и байтовых столбцах выполняются быстрее. Но дисковое пространство будет увеличено, так как эти операции оптимизированы для получения только необходимых частей внешнего значения, когда оно не сжимается.
- **Главная** стратегия допускает сжатие, но не внешнее хранение. Внешнее хранение по-прежнему выполняется для таких столбцов, но только в качестве последнего средства. Это происходит, когда нет другого способа сделать строку достаточно маленькой, чтобы поместить ее на странице.

## <a name="use-toast-table-storage-strategies"></a>Использование стратегий хранения таблицы TOAST
Если ваши запросы получают доступ к типам данных, которые поддерживают TOAST, рассмотрите возможность использования основной стратегии вместо расширенной (по умолчанию), чтобы уменьшить время выполнения запросов. Основная стратегия не исключает внешнее хранение. Если ваши запросы не получают доступ к типам данных, которые поддерживают TOAST, может быть полезно оставить расширенную стратегию. Большая часть строк главной таблицы поместится в общий буферный кэш, что способствует повышению производительности.

При наличии рабочей нагрузки, использующей схему с широкими таблицами и большим количеством символов, рассмотрите возможность применения таблиц TOAST PostgreSQL. Например, таблица клиентов содержит больше чем 350 столбцов с несколькими столбцами, в которых есть 255 знаков. После перехода на основную стратегию таблицы TOAST время выполнения запроса сократилось с 4203 до 467 секунд, что на 89 процентов больше.

## <a name="next-steps"></a>Дальнейшие действия
Проверьте рабочую нагрузку с учетом представленных ранее характеристик. 

Ознакомьтесь со следующей документацией PostgreSQL: 
- [раздел 68, "Физическое хранилище базы данных"](https://www.postgresql.org/docs/current/storage-toast.html). 