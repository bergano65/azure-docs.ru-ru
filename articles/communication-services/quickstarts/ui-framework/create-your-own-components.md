---
title: Создание собственного компонента платформы пользовательского интерфейса
titleSuffix: An Azure Communication Services quickstart
description: В этом кратком руководстве показано, как создать пользовательский компонент, совместимый с инфраструктурой пользовательского интерфейса
author: ddematheu2
ms.author: dademath
ms.date: 11/16/2020
ms.topic: quickstart
ms.service: azure-communication-services
ms.openlocfilehash: 88de5ca56738e13446be30fb14df6bcdac360827
ms.sourcegitcommit: 44188608edfdff861cc7e8f611694dec79b9ac7d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2021
ms.locfileid: "99539719"
---
# <a name="quickstart-create-your-own-ui-framework-component"></a>Краткое руководство. Создание собственного компонента инфраструктуры пользовательского интерфейса

[!INCLUDE [Private Preview Notice](../../includes/private-preview-include.md)]

Начните работу со Службами коммуникации Azure, используя инфраструктуру пользовательского интерфейса для быстрой интеграции возможностей коммуникаций в свои приложения.

В этом кратком руководстве показано, как создавать собственные компоненты, используя предварительно определенный интерфейс состояния, предлагаемый инфраструктурой пользовательского интерфейса. Этот подход — идеальный вариант для разработчиков, которым требуется дополнительная настройка и которые хотят использовать собственные ресурсы для разработки. 

## <a name="prerequisites"></a>Предварительные требования

- Учетная запись Azure с активной подпиской. [Создайте учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) бесплатно.
- [Node.js](https://nodejs.org/) версий Active LTS и Maintenance LTS (рекомендуется Node 12).
- Активный ресурс Служб коммуникации. [Создайте ресурс Служб коммуникации.](./../create-communication-resource.md)
- Маркер доступа пользователя для создания экземпляра клиента вызова. Узнайте, как [создать маркер доступа пользователя и обеспечить управление им](./../access-tokens.md).

Для инфраструктуры пользовательского интерфейса нужно настроить среду React. Дальше объясняется, как это сделать. Если у вас уже есть приложение React, вы можете пропустить этот раздел.

### <a name="set-up-react-app"></a>Настройка приложения React

Для работы с этим кратким руководством мы будем использовать шаблон create-react-app. Дополнительные сведения см. в разделе: [Начало работы с React](https://reactjs.org/docs/create-a-new-react-app.html)

```console

npx create-react-app my-app

cd my-app

```

В результате у вас должно быть полноценное приложение в папке `my-app`. Для работы с этим кратким руководством мы изменим файлы в папке `src`.

### <a name="install-the-package"></a>Установка пакета

Используйте команду `npm install`, чтобы установить клиентскую библиотеку Служб коммуникации для реализации вызовов на JavaScript. Переместите предоставленный архив tarball (закрытая предварительная версия) в каталог my-app.

```console

//For Private Preview install tarball

npm install --save ./{path for tarball}

```

Параметр `--save` указывает библиотеку как зависимость в файле пакета **package.json**.

### <a name="run-create-react-app"></a>Выполнение Create React App

Проверим установку Create React App, выполнив следующую команду:

```console

npm run start   

```

## <a name="object-model"></a>Объектная модель

Следующие классы и интерфейсы реализуют некоторые основные функции клиентской библиотеки пользовательского интерфейса Служб коммуникации Azure:

| Имя                                  | Описание                                                  |
| ------------------------------------- | ------------------------------------------------------------ |
| Поставщик| Поставщик пользовательского интерфейса Fluent, позволяющий разработчикам изменять базовые компоненты пользовательского интерфейса Fluent.|
| CallingProvider| Вызывающий поставщик для создания экземпляра вызова. Требуется для добавления базовых компонентов.|
| ChatProvider | Поставщик чата для создания экземпляра потока чата. Требуется для добавления базовых компонентов.|
| connectFuncsToContext | Метод подключения компонентов инфраструктуры пользовательского интерфейса к базовым поставщикам с помощью модулей сопоставления. |
| MapToChatMessageProps | Модуль сопоставления уровня данных сообщения чата, предоставляющий компоненты с помощью свойств сообщений чата. |


## <a name="initialize-chat-providers-using-azure-communication-services-credentials"></a>Инициализация поставщиков чатов с помощью учетных данных Служб коммуникации Azure

В этом кратком руководстве показано, как использовать чат в качестве примера. Дополнительные сведения о вызове см. в статьях [Краткое руководство. Начало работы с базовыми компонентами инфраструктуры пользовательского интерфейса](./get-started-with-components.md) и [Краткое руководство. Начало работы с составными компонентами инфраструктуры пользовательского интерфейса](./get-started-with-composites.md).

Перейдите к папке `src` в `my-app` и найдите файл `app.js`. Здесь мы удалим приведенный ниже код для инициализации нашего поставщика чата. Этот поставщик отвечает за поддержание контекста возможностей вызовов и чата. Для инициализации компонентов требуется маркер доступа, полученный от Служб коммуникации Azure. Дополнительные сведения о получении маркеров доступа см. в статье [Краткое руководство. Создание маркеров доступа и управление ими](./../access-tokens.md).

Компоненты инфраструктуры пользовательского интерфейса следуют той же общей архитектуре для остальной части службы. Компоненты не создают маркеры доступа, а также идентификаторы групп или потоков. Эти элементы предоставляются службами, которые выполняют все необходимые действия для создания таких идентификаторов и их передачи в клиентское приложение. Дополнительные сведения см. в статье [Архитектура клиента и сервера](./../../concepts/client-and-server-architecture.md).

`App.js`
```javascript

import {CallingProvider, ChatProvider} from "@azure/acs-ui-sdk"

function App(props) {

  return (
    <ChatProvider
    token={/*Insert the Azure Communication Services access token*/}
    userId={/*Insert the Azure Communication Services user id*/}
    displayName={/*Insert Display Name to be used for the user*/}
    threadId={/*Insert id for group chat thread to be joined*/}
    endpointUrl={/*Insert the environment URL for the Azure Resource used*/}
    refreshTokenCallback={/*Optional, Insert refresh token call back function*/}
    >
        //  Add Chat Components Here
    </ChatProvider>
  );
}

export default App;

```

После инициализации этот поставщик позволяет вам создать собственный макет с помощью компонентов инфраструктуры пользовательского интерфейса и любой дополнительной логики макета. Поставщик отвечает за инициализацию всей базовой логики и надлежащее подключение разных компонентов. Дальше мы создадим пользовательский компонент с помощью модулей сопоставления инфраструктуры пользовательского интерфейса для подключения к нашему поставщику чата.


## <a name="create-a-custom-component-using-mappers"></a>Создание пользовательского компонента с помощью модулей сопоставления

Начнем с создания нового файла с именем `SimpleChatThread.js`, где будет создан компонент. Прежде всего мы импортируем компоненты инфраструктуры пользовательского интерфейса, которые нам понадобятся. С помощью готовых решений HTML и React мы создадим полностью настраиваемый компонент для простого потока чата. Используя метод `connectFuncsToContext`, мы применим модуль сопоставления `MapToChatMessageProps` для сопоставления свойств с пользовательскими компонентами `SimpleChatThread`. Эти свойства предоставляют нам доступ к отправляемым и получаемым сообщениям чата для их включения в наш простой поток.

`SimpleChatThread.js`
```javascript

import {connectFuncsToContext, MapToChatMessageProps} from "@azure/acs-ui-sdk"

function SimpleChatThread(props) {

    return (
        <div>
            {props.chatMessages?.map((message) => (
                <div key={message.id ?? message.clientMessageId}> {`${message.senderDisplayName}: ${message.content}`}</div>
            ))}
        </div>
    );
}

export default connectFuncsToContext(SimpleChatThread, MapToChatMessageProps);

```

## <a name="add-your-custom-component-to-your-application"></a>Добавление пользовательского компонента в приложение

Теперь, когда пользовательский компонент готов, мы импортируем его и добавим в наш макет.

```javascript

import {CallingProvider, ChatProvider} from "@azure/acs-ui-sdk"
import SimpleChatThread from "./SimpleChatThread"

function App(props) {

  return (
        <ChatProvider ... >
            <SimpleChatThread />
        </ChatProvider>
  );
}

export default App;

```

## <a name="run-quickstart"></a>Выполнение кода

Чтобы выполнить приведенный выше код, используйте следующую команду:

```console

npm run start   

```

Чтобы полностью проверить возможности, вам потребуется второй клиент с возможностями чата для отправки сообщений, которые будут получены нашим простым потоком чата. Возможные варианты см. в статьях [Начало работы с примером функции группового вызова](./../../samples/calling-hero-sample.md) и [Начало работы с главным примером функции чата](./../../samples/chat-hero-sample.md).

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы хотите очистить и удалить подписку на Службы коммуникации, вы можете удалить ресурс или группу ресурсов. При этом удаляются все ресурсы, связанные с ней. См. сведения об [очистке ресурсов](../create-communication-resource.md#clean-up-resources).

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Попробовать составные компоненты инфраструктуры пользовательского интерфейса](./get-started-with-composites.md)

Дополнительные сведения см. в следующих ресурсах:
- [Общие сведения об инфраструктуре пользовательского интерфейса](../../concepts/ui-framework/ui-sdk-overview.md)
- [Возможности инфраструктуры пользовательского интерфейса](./../../concepts/ui-framework/ui-sdk-features.md)
- [Краткое руководство. Начало работы с базовыми компонентами инфраструктуры пользовательского интерфейса](./get-started-with-components.md)
