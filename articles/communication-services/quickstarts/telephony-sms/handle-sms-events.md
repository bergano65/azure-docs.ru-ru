---
title: Краткое руководство. Обработка событий SMS
titleSuffix: An Azure Communication Services quickstart
description: Сведения о том, как обрабатывать события SMS с помощью Служб коммуникации Azure.
author: mikben
manager: jken
services: azure-communication-services
ms.author: mikben
ms.date: 09/30/2020
ms.topic: overview
ms.service: azure-communication-services
ms.openlocfilehash: e8decbe22f869573bf7a2221099d2bc30c00fc8a
ms.sourcegitcommit: 230d5656b525a2c6a6717525b68a10135c568d67
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/19/2020
ms.locfileid: "94888850"
---
# <a name="quickstart-handle-sms-events"></a>Краткое руководство. Обработка событий SMS

[!INCLUDE [Public Preview Notice](../../includes/public-preview-include.md)]

Начало работы со Службами коммуникации Azure с помощью службы "Сетка событий Azure" для обработки событий SMS Служб коммуникации. 

## <a name="about-azure-event-grid"></a>Сетка событий Azure

[Сетка событий Azure](../../../event-grid/overview.md) — это облачная служба обработки событий. Из этой статьи вы узнаете, как подписываться на события [службы коммуникации](../../concepts/event-handling.md) и запускать событие для просмотра результата. Как правило, события отправляются на конечную точку, которая обрабатывает данные событий и выполняет соответствующие действия. В рамках этой статьи события отправляются в веб-приложение, которое собирает и отображает сообщения.

## <a name="prerequisites"></a>Предварительные требования
- Учетная запись Azure с активной подпиской. [Создайте учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) бесплатно. 
- Ресурс Службы коммуникации Azure. Дополнительные сведения можно найти в кратком руководстве по [созданию ресурсов Службы коммуникации Azure](../create-communication-resource.md).
- Номер телефона с поддержкой SMS-сообщений. [Получите номер телефона.](./get-phone-number.md)

## <a name="setting-up"></a>Настройка

### <a name="enable-event-grid-resource-provider"></a>Включение поставщика ресурсов службы "Сетка событий"

Если вы еще не использовали службу "Сетка событий" в подписке Azure, вам, возможно, потребуется зарегистрировать поставщик ресурсов этой службы, выполнив шаги ниже.

На портале Azure выполните следующие действия.

1. В меню слева выберите **Подписки**.
2. Выберите подписку, которую используете для службы "Сетка событий".
3. В разделе **Параметры** выберите **Поставщики ресурсов**.
4. Найдите **Microsoft.EventGrid**.
5. Если поставщик ресурсов не зарегистрирован, выберите **Зарегистрировать**. 

Регистрация может занять некоторое время. Щелкните **Обновить**, чтобы обновить состояние. Когда для **состояния** отобразится значение **Зарегистрировано**, можно будет продолжить.

### <a name="event-grid-viewer-deployment"></a>Развертывание средства просмотра Сетки событий

В рамках этого краткого руководства для просмотра событий практически в реальном времени мы будем использовать [пример средства просмотра Сетки событий Azure](/samples/azure-samples/azure-event-grid-viewer/azure-event-grid-viewer/). Это позволит пользователю работать с веб-каналом в режиме реального времени. Кроме того, для проверки также должны быть доступны полезные данные каждого события.  

## <a name="subscribe-to-the-sms-events-using-web-hooks"></a>Подписка на события SMS с помощью веб-перехватчиков

На портале перейдите к созданному вами ресурсу Служб коммуникации Azure. В ресурсе Службы коммуникации на странице **Communication Services** (Службы коммуникации) в меню слева щелкните пункт **События**.

:::image type="content" source="./media/handle-sms-events/select-events.png" alt-text="Снимок экрана: нажатие кнопки подписки на события на странице событий ресурса.":::

Нажмите кнопку **Add Event Subscription** (Добавить подписку на события), чтобы войти в мастер создания.

На странице **Создать подписку на события** введите **имя** подписки.

Подпишитесь на соответствующие события, чтобы определить в Сетке событий Azure, какие события SMS необходимо отслеживать и куда их отправлять. В раскрывающемся меню выберите события, на которые вы хотите подписаться. Для SMS можно выбрать варианты `SMS Received` и `SMS Delivery Report Received`. 

Если вам предложено ввести **имя системного раздела**, можно предоставить уникальную строку. Значение в этом поле не влияет на вашу работу и используется для внутренней телеметрии.

Просмотрите полный список [событий, поддерживаемых Службами коммуникации Azure](../../concepts/event-handling.md).

:::image type="content" source="./media/handle-sms-events/select-events-create-eventsub.png" alt-text="Снимок экрана: выбранные типы событий &quot;SMS получено&quot; и &quot;Получен отчет о доставке SMS&quot;.":::

Выберите значение **Веб-перехватчик** для параметра **Тип конечной точки**. 

:::image type="content" source="./media/handle-sms-events/select-events-create-linkwebhook.png" alt-text="Снимок экрана: поле &quot;Тип конечной точки&quot;, для которого задан веб-перехватчик.":::

В разделе **Конечная точка** щелкните **Выбрать конечную точку** и введите URL-адрес веб-приложения.

В этом случае мы будем использовать URL-адрес из [примера средства просмотра Сетки событий Azure](/samples/azure-samples/azure-event-grid-viewer/azure-event-grid-viewer/), который мы настроили ранее в кратком руководстве. URL-адрес примера будет иметь следующий формат: `https://{{site-name}}.azurewebsites.net/api/updates`

Нажмите кнопку **Подтвердить выбор**.

:::image type="content" source="./media/handle-sms-events/select-events-create-selectwebhook-epadd.png" alt-text="Снимок экрана: подтверждение конечной точки веб-перехватчика.":::

## <a name="viewing-sms-events"></a>Просмотр событий SMS

### <a name="triggering-sms-events"></a>Активация событий SMS

Для просмотра триггеров событий в первую очередь необходимо создать события.

- События `SMS Received` создаются, когда на номер телефона Служб коммуникации приходит текстовое сообщение. Чтобы активировать событие, отправьте сообщение с телефона на номер телефона, подключенный к ресурсу Служб коммуникации.
- События `SMS Delivery Report Received` создаются при отправке SMS пользователю с номера телефона Служб коммуникации. Для активации события необходимо включить `Delivery Report` в параметрах [отправляемого SMS](../telephony-sms/send.md). Попробуйте отправить сообщение на свой телефон с помощью `Delivery Report`. Выполнение этого действия предполагает небольшую дополнительную плату в несколько центов США в учетной записи Azure.

Просмотрите полный список [событий, поддерживаемых Службами коммуникации Azure](../../concepts/event-handling.md).

### <a name="receiving-sms-events"></a>Получение событий SMS

После выполнения любого из приведенных выше действий вы увидите, что события `SMS Received` и `SMS Delivery Report Received` отправляются в конечную точку. Эти события будут отображаться в [примере средства просмотра Сетки событий Azure](/samples/azure-samples/azure-event-grid-viewer/azure-event-grid-viewer/), который мы настроили в начале. Чтобы просмотреть все полезные данные, можно нажать значок глаза рядом с событием. События будут выглядеть так:

:::image type="content" source="./media/handle-sms-events/sms-received.png" alt-text="Снимок экрана: схема Сетки событий для события &quot;SMS получено&quot;.":::

:::image type="content" source="./media/handle-sms-events/sms-delivery-report-received.png" alt-text="Снимок экрана: схема Сетки событий для события &quot;Получен отчет о доставке SMS&quot;.":::

Дополнительные сведения см. в статье [Обработка событий в Службах коммуникации Azure](../../concepts/event-handling.md).

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы хотите очистить и удалить подписку на Службы коммуникации, вы можете удалить ресурс или группу ресурсов. При этом удаляются все ресурсы, связанные с ней. См. сведения об [очистке ресурсов](../create-communication-resource.md#clean-up-resources).

## <a name="next-steps"></a>Дальнейшие действия

Из этого краткого руководства вы узнали, как использовать события SMS. Сообщения SMS можно получить, создав подписку на Сетку событий.

> [!div class="nextstepaction"] 
> [Краткое руководство по отправке SMS-сообщений](../telephony-sms/send.md)

Полезные ссылки

 - [Обработка событий в Службах коммуникации Azure](../../concepts/event-handling.md)
 - [Что такое служба "Сетка событий Azure"?](../../../event-grid/overview.md)