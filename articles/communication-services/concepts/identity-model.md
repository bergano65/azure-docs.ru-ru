---
title: Модель удостоверений
titleSuffix: An Azure Communication Services concept
description: Сведения о удостоверениях и маркерах доступа
author: tomaschladek
manager: nmurav
services: azure-communication-services
ms.author: tchladek
ms.date: 10/26/2020
ms.topic: conceptual
ms.service: azure-communication-services
ms.openlocfilehash: dd2ffacb176ed3733acba8699d4e870b15dd3c42
ms.sourcegitcommit: 230d5656b525a2c6a6717525b68a10135c568d67
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/19/2020
ms.locfileid: "94888714"
---
# <a name="identity-model"></a>Модель удостоверений

Службы связи Azure — это независимая от идентификации служба. Такая схема обеспечивает несколько преимуществ:

- Повторное использование существующих удостоверений из системы управления удостоверениями
- Обеспечивает гибкость сценариев интеграции
- Сохранение личных удостоверений в службах связи Azure

Вместо дублирования информации в системе вы будете поддерживать отношение сопоставления, которое требуется вашему бизнес-случаю. Например, можно сопоставлять удостоверения 1:1, 1: N, N:1, Н:М. Внешние идентификаторы, такие как номера телефонов, пользователи, устройства, приложения и идентификаторы GUID, нельзя использовать для идентификации в службах связи Azure. Маркеры доступа, созданные для удостоверения служб связи Azure, используются для доступа к примитивам, таким как чат или вызов.

## <a name="identity"></a>Идентификация

Удостоверения можно создавать с помощью библиотеки администрирования служб обмена данными Azure. Удостоверение служит идентификатором в диалогах. Он используется для создания маркеров доступа. Одно и то же удостоверение может участвовать в нескольких одновременных сеансах на нескольких устройствах. Удостоверение может одновременно иметь несколько активных маркеров доступа. 

Удаление удостоверения, ресурса или подписки сделает недействительными все маркеры доступа. Это действие также удаляет все данные, сохраненные для удостоверения. Удаленное удостоверение не может создавать новые маркеры доступа или получать доступ к ранее сохраненным данным (например, сообщениям в чате). 

Вы не платите за количество удостоверений. Вместо этого за использование примитивов выставляются счета. Количество удостоверений не обязательно ограничивает способ, которым удостоверения приложения сопоставляются с удостоверениями служб связи Azure. 

С свободаю сопоставления, вы несете ответственность за конфиденциальность. Если пользователь хочет удалить из системы, необходимо удалить все удостоверения, связанные с этим пользователем.

Службы связи Azure не предоставляют специальные удостоверения для анонимных пользователей. Он не сохраняет сопоставление между пользователями и удостоверениями и не может определить, является ли удостоверение анонимным. Концепцию идентификации можно спроектировать в соответствии с вашими потребностями. Мы рекомендуем создать новое удостоверение для каждого анонимного пользователя в каждом приложении. 

Любой, кто имеет действительный маркер доступа, может получить доступ к текущему содержимому идентификатора. Например, пользователи могут получить доступ к сообщениям в чате, которые они отправили. Доступ ограничен только областями, которые являются частью маркера доступа. Дополнительные сведения см. в разделе [маркеры доступа](#access-tokens) этой статьи.

### <a name="identity-mapping"></a>Сопоставление удостоверений

Службы связи Azure не реплицируют функциональность системы управления удостоверениями Azure. Он не предоставляет клиентам возможность использовать удостоверения, зависящие от клиента. Например, клиенты не могут использовать номер телефона или адрес электронной почты. Вместо этого службы связи Azure предоставляют уникальные идентификаторы. Эти уникальные идентификаторы можно назначить удостоверениям приложения. Службы связи Azure не хранят никаких сведений, которые могут раскрывать реальную идентификацию пользователей.

Чтобы избежать дублирования информации в системе, спланируйте, как сопоставлять пользователей из домена удостоверений с удостоверениями служб связи Azure. Вы можете следовать любому типу шаблона. Например, можно использовать 1:1, 1: N, N:1 или М:Н. Решите, сопоставляется ли один пользователь с одним удостоверением или с несколькими удостоверениями. 

При создании нового удостоверения сохраните его сопоставление с пользователем или пользователями приложения. Так как для удостоверений требуются маркеры доступа для использования примитивов, удостоверение должно быть известно пользователю или пользователям приложения.

Если для хранения сведений о пользователях используется реляционная база данных, можно настроить проект на основе сценария сопоставления. В сценариях, сопоставленных 1:1 или N:1, может потребоваться добавить в `CommunicationServicesId` таблицу столбец для хранения удостоверения служб связи Azure. В сценариях, использующих связь 1: N или Н:М, вы можете создать отдельную таблицу в реляционной базе данных.

## <a name="access-tokens"></a>Маркеры доступа

Маркер доступа — это JSON Web Token (JWT), который можно использовать для получения доступа к примитивам службы связи Azure. Выданный маркер доступа имеет защиту целостности. Это значит, что его утверждения нельзя изменить после его выдачи. Поэтому изменение свойств, таких как удостоверение, срок действия или области, приведет к недействительности маркера доступа. Если примитивы используются с недействительными маркерами, доступ к примитивам будет запрещен. 

К свойствам маркера доступа относятся:
* Идентифицирует.
* Expiration
* Области.

Маркер доступа всегда действителен в течение 24 часов. После истечения срока действия маркер доступа становится недействительным и не может использоваться для доступа к любому примитиву. 

Удостоверению нужен способ запроса нового маркера доступа из службы на стороне сервера. Параметр *Scope* определяет непустой набор примитивов, которые можно использовать. Службы связи Azure поддерживают следующие области для маркеров доступа.

|Имя|Описание|
|---|---|
|Чат|  Предоставляет возможность участвовать в чате|
|VoIP|  Предоставляет возможность вызова удостоверений и телефонных номеров|


Чтобы отозвать маркер доступа до истечения срока его действия, используйте библиотеку администрирования служб обмена данными Azure. Отзыв маркера не производится немедленно. Распространение занимает до 15 минут. Удаление удостоверения, ресурса или подписки отменяет все маркеры доступа. 

Если вы хотите удалить возможность доступа пользователя к определенной функциональности, отмените все маркеры доступа. Затем выдайте новый маркер доступа с более ограниченным набором областей.

В службах связи Azure смена ключей доступа отменяет все активные маркеры доступа, созданные с помощью предыдущего ключа доступа. Все удостоверения теряют доступ к службам связи Azure и должны выдавать новые маркеры доступа. 

Рекомендуется выдавать маркеры доступа в службе на стороне сервера, а не в приложении клиента. Причина заключается в том, что для выпуска требуется ключ доступа или управляемое удостоверение. По соображениям безопасности совместное использование ключей доступа с приложением клиента не рекомендуется. 

Клиентское приложение должно использовать доверенную конечную точку службы, которая может проверять подлинность клиентов. Конечная точка должна выдавать маркеры доступа от их имени. Дополнительные сведения см. в разделе [архитектура клиента и сервера](./client-and-server-architecture.md).

При кэшировании маркеров доступа в резервное хранилище рекомендуется использовать шифрование. Маркер доступа — это конфиденциальные данные. Ее можно использовать для вредоносных действий, если она не защищена. Кто-то с маркером доступа может запустить пакет SDK и получить доступ к API. Доступный API ограничен только в зависимости от области действия маркера доступа. Рекомендуется выдавать маркеры доступа, которые имеют только необходимые области.

## <a name="next-steps"></a>Дальнейшие действия

* Общие сведения об управлении маркерами доступа см. в статье [Создание маркеров доступа и управление ими](../quickstarts/access-tokens.md).
* Общие сведения о проверке подлинности см. [в статье аутентификация в службах связи Azure](./authentication.md).
* Общие сведения о местонахождение данных и конфиденциальности см. в разделе [доступность регионов и местонахождение данных](./privacy.md).