---
title: Развертывание модуля безопасности IoT Edge
description: Сведения о том, как развернуть защитник для агента безопасности IoT на IoT Edge.
services: defender-for-iot
ms.service: defender-for-iot
documentationcenter: na
author: mlottner
manager: rkarlin
editor: ''
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 1/30/2020
ms.author: mlottner
ms.openlocfilehash: 9ac283721526488f587fcabc68348dafac1835db
ms.sourcegitcommit: c4c554db636f829d7abe70e2c433d27281b35183
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98033359"
---
# <a name="deploy-a-security-module-on-your-iot-edge-device"></a>Развертывание модуля безопасности на устройстве IoT Edge

Модуль **"защитник для Интернета вещей"** предоставляет комплексное решение для обеспечения безопасности устройств IOT Edge.
Модуль безопасности собирает, объединяет и анализирует необработанные данные безопасности из операционной системы и системы контейнеров в виде рекомендаций и оповещений о безопасности.
Дополнительные сведения см. в разделе [модуль безопасности для IOT Edge](security-edge-architecture.md).

В этой статье вы узнаете, как развернуть модуль безопасности на устройстве IoT Edge.

## <a name="deploy-security-module"></a>Развертывание модуля безопасности

Выполните следующие действия, чтобы развернуть модуль безопасности "защитник для Интернета вещей" для IoT Edge.

### <a name="prerequisites"></a>Предварительные условия

1. В центре Интернета вещей убедитесь, что устройство [зарегистрировано как устройство IOT Edge](../iot-edge/how-to-manual-provision-symmetric-key.md#register-a-new-device).

1. Для модуля "защитник для IoT Edge" требуется, чтобы на устройстве IoT Edge была установлена [платформа для аудита](https://linux.die.net/man/8/auditd) .

    - Установите платформу, выполнив на устройстве IoT Edge следующую команду:

    `sudo apt-get install auditd audispd-plugins`

    - Проверьте, активен ли аудит, выполнив следующую команду:

    `sudo systemctl status auditd`<br>
    - Ожидаемый ответ: `active (running)`

### <a name="deployment-using-azure-portal"></a>Развертывание с помощью портал Azure

1. В портал Azure откройте **Marketplace**.

1. Выберите **"Интернет вещей"**, а затем найдите **Центр безопасности Azure для Интернета вещей** и выберите его.

   :::image type="content" source="media/howto/edge-onboarding-8.png" alt-text="Выбор защитника для Интернета вещей":::

1. Выберите **создать** , чтобы настроить развертывание.

1. Выберите **подписку** Azure центра Интернета вещей, а затем выберите **центр Интернета вещей**.<br>Выберите **развернуть на устройстве** для использования с одним устройством или выберите **развернуть в масштабе** для выбора нескольких устройств и нажмите кнопку **создать**. Дополнительные сведения о развертывании в масштабе см. [в разделе Развертывание](../iot-edge/how-to-deploy-at-scale.md).

    >[!Note]
    >Если выбран параметр **развернуть в масштабе**, добавьте имя и сведения об устройстве, прежде чем перейти к вкладке **Add modules (Добавление модулей** ) в следующих инструкциях.

Выполните каждый шаг, чтобы завершить развертывание IoT Edge для защитника для Интернета вещей.

#### <a name="step-1-modules"></a>Шаг 1. модули

1. Выберите модуль **азуресекуритицентерфориот** .
1. На вкладке **Параметры модуля** измените **имя** на **азуреиотсекурити**.
1. На вкладке **переменные среды** при необходимости добавьте переменную (например, можно добавить *уровень отладки* и задать для него одно из следующих значений: "Неустранимая", "Error", "warning" или "Information").
1. На вкладке **Параметры создания контейнера** добавьте следующую конфигурацию:

    ``` json
    {
        "NetworkingConfig": {
            "EndpointsConfig": {
                "host": {}
            }
        },
        "HostConfig": {
            "Privileged": true,
            "NetworkMode": "host",
            "PidMode": "host",
            "Binds": [
                "/:/host"
            ]
        }
    }
    ```

1. На вкладке **module двойника Settings (параметры модуля** ) добавьте следующую конфигурацию:

   Свойство двойника модуля:
   
   ``` json
     "ms_iotn:urn_azureiot_Security_SecurityAgentConfiguration"
   ```

   Содержимое свойства двойника модуля: 

   ```json
     {

     }
   ```
    
   Дополнительные сведения о настройке агента см. в разделе [Настройка агентов безопасности](./how-to-agent-configuration.md).

1. Нажмите кнопку **Обновить**.

#### <a name="step-2-runtime-settings"></a>Шаг 2. параметры среды выполнения

1. Выберите **Параметры среды выполнения**.
2. В разделе **концентратор ребра** измените **образ** на **MCR.Microsoft.com/azureiotedge-Hub:1.0.8.3**.

    >[!Note]
    > В настоящее время поддерживается версия 1.0.8.3 или более старая.

3. Убедитесь, что для **параметра создать** задана следующая конфигурация:

    ``` json
    {
       "HostConfig":{
          "PortBindings":{
             "8883/tcp":[
                {
                   "HostPort":"8883"
                }
             ],
             "443/tcp":[
                {
                   "HostPort":"443"
                }
             ],
             "5671/tcp":[
                {
                   "HostPort":"5671"
                }
             ]
          }
       }
    }
    ```

4. Нажмите кнопку **Сохранить**.

5. Выберите **Далее**.

#### <a name="step-3-specify-routes"></a>Шаг 3. Указание маршрутов

1. На вкладке **указать маршруты** убедитесь, что у вас есть маршрут (явный или неявный), который будет пересылать сообщения из модуля **азуреиотсекурити** , чтобы **$upstream** в соответствии со следующими примерами. Нажмите кнопку **Далее**, только если маршрут установлен.

   Примеры маршрутов:

    ```Default implicit route
    "route": "FROM /messages/* INTO $upstream"
    ```

    ```Explicit route
    "ASCForIoTRoute": "FROM /messages/modules/azureiotsecurity/* INTO $upstream"
    ```

1. Выберите **Далее**.

#### <a name="step-4-review-deployment"></a>Шаг 4. Проверка развертывания

- На вкладке **Проверка развертывания** просмотрите сведения о развертывании и нажмите кнопку **создать** , чтобы завершить развертывание.

## <a name="diagnostic-steps"></a>Этапы диагностики

При возникновении проблемы журналы контейнеров — это лучший способ узнать состояние устройства модуля безопасности IoT Edge. Для сбора сведений используйте команды и инструменты, приведенные в этом разделе.

### <a name="verify-the-required-containers-are-installed-and-functioning-as-expected"></a>Убедитесь, что необходимые контейнеры установлены и работают должным образом.

1. На устройстве IoT Edge выполните следующую команду:

    `sudo docker ps`

1. Убедитесь, что выполняются следующие контейнеры:

   | Название | IMAGE |
   | --- | --- |
   | азуреиотсекурити | mcr.microsoft.com/ascforiot/azureiotsecurity:1.0.2 |
   | edgeHub; | mcr.microsoft.com/azureiotedge-hub:1.0.8.3 |
   | edgeAgent; | mcr.microsoft.com/azureiotedge-agent:1.0.1 |

   Если минимальный необходимый контейнер отсутствует, проверьте, соответствует ли манифест развертывания IoT Edge рекомендуемым параметрам. Дополнительные сведения см. в разделе [Развертывание модуля IOT Edge](#deployment-using-azure-portal).

### <a name="inspect-the-module-logs-for-errors"></a>Проверка журналов модулей на наличие ошибок

1. На устройстве IoT Edge выполните следующую команду:

   `sudo docker logs azureiotsecurity`

1. Для получения более подробных журналов добавьте следующую переменную среды в развертывание модуля **азуреиотсекурити** : `logLevel=Debug` .

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать больше о параметрах конфигурации, перейдите к руководству по настройке модуля.
> [!div class="nextstepaction"]
> [Руководство по настройке модуля](./how-to-agent-configuration.md)