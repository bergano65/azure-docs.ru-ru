---
title: Управление устройствами автоматического нужного масштаба с помощью центра Интернета вещей Azure | Документация Майкрософт
description: Использование функции управления автоматическое устройствами центра Интернета вещей Azure для назначения конфигурации на нескольких устройствах Интернета вещей
author: ChrisGMsft
manager: bruz
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 04/13/2018
ms.author: chrisgre
ms.openlocfilehash: 598bf82e375f472b2f723c3462ba7ba7b4d25fbe
ms.sourcegitcommit: c174d408a5522b58160e17a87d2b6ef4482a6694
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59012955"
---
# <a name="automatic-iot-device-management-at-scale-using-the-azure-portal"></a>Автоматическое управление устройствами Интернета вещей в нужном масштабе с помощью портала Azure

[!INCLUDE [iot-edge-how-to-deploy-monitor-selector](../../includes/iot-hub-auto-device-config-selector.md)]

Управление автоматической устройствами в центре Интернета вещей Azure автоматизирует многие из повторяющихся и сложных задач по управлению большого большое устройство. С управлением устройствами автоматическое целевой набор устройств, на основе их свойств, определить требуемую конфигурацию и затем позволить обновить устройства, когда они поступают в область действия центра Интернета вещей. Это обновление выполняется с помощью _автоматической конфигурации_, позволяющее сведением завершения и соответствия требованиям, дескриптор слияние конфликтов и развертывание конфигураций в поэтапный подход.

[!INCLUDE [iot-hub-basic](../../includes/iot-hub-basic-whole.md)]

Автоматическое управление работает путем обновления набора двойников устройств с требуемыми свойствами и reporting Сводка, основанный на двойнике устройства сообщаемые свойства.  Он представляет новый класс и документе JSON, который называется *конфигурации* , состоит из трех частей:

* **Целевое условие** определяет область обновляемых двойников устройств. Целевое условие задается как запрос в тегах двойников устройств или как сообщаемые свойства.

* **Целевое содержимое** определяет требуемые свойства, которые необходимо добавить или обновить в целевых двойниках устройств. Содержимое включает в себя путь к разделу требуемых свойств, которые необходимо изменить.

* **Метрики** определяют общее количество различных состояний конфигурации, таких как **Успешно**, **Выполняется** и **Ошибка**. Пользовательские метрики указываются как запросы в сообщаемых свойствах двойников устройств.  Системные метрики являются метриками по умолчанию, которые измеряют состояние обновления двойника, такие как номер двойников устройств, которые являются целевыми и число двойников, которые были успешно обновлены. 

## <a name="implement-device-twins-to-configure-devices"></a>Реализация двойников устройств для настройки устройств

Для автоматических конфигураций устройств требуется использовать двойники устройств, чтобы синхронизировать состояние между облаком и устройствами.  Руководство по использованию двойников устройств см. в статье [Общие сведения о двойниках устройств и их использование в Центре Интернета вещей](iot-hub-devguide-device-twins.md).

## <a name="identify-devices-using-tags"></a>Определение устройств с помощью тегов

Перед созданием конфигурации, необходимо указать устройства, которые необходимо провести эксперимент. Центр Интернета вещей Azure определяет устройства с помощью тегов в двойнике устройства. Каждое устройство может иметь несколько тегов. Их можно определить любым способом, который лучше всего подходит для вашего решения. Например если вы управляете устройствами, в разных расположениях, добавьте следующие теги двойника устройства:

```json
"tags": {
    "location": {
        "state": "Washington",
        "city": "Tacoma"
    }
},
```

## <a name="create-a-configuration"></a>Создание конфигурации

1. Найдите нужный Центр Интернета вещей на [портале Azure](https://portal.azure.com). 

2. Выберите **Конфигурация устройства Интернета вещей**.

3. Щелкните **Добавить конфигурацию**.

Процедура создания конфигурации состоит из пяти шагов. В следующих разделах описан каждый из этих шагов. 

### <a name="name-and-label"></a>Имя и метка

1. Присвойте вашей конфигурации уникальное имя, содержащее до 128 букв в нижнем регистре. Не используйте пробелы и следующие недопустимые символы: `& ^ [ ] { } \ | " < > /`.

2. Добавьте метки для отслеживания конфигураций. Метки представляют собой пары **имени** и **значения**, которые описывают конфигурацию. Например, `HostPlatform, Linux` или `Version, 3.0.1`.

3. Чтобы перейти к следующему шагу, нажмите кнопку **Далее**. 

### <a name="specify-settings"></a>Указание параметров

В этом разделе определяется целевое содержимое, которое необходимо настроить в целевых двойниках устройств. Для каждого набора параметров есть два вида входных данных. Первый — это путь к двойнику устройства, который представляет собой путь к разделу JSON, где будут заданы два требуемых свойства.  Второй — это содержимое JSON, которое должно быть вставлено в этот раздел. Например, заполните поля Device Twin Path (Путь к двойнику устройства) и Content (Содержимое) следующим образом:

![Указание пути к двойнику устройства и содержимого](./media/iot-hub-auto-device-config/create-configuration-full-browser.png)

Вы также можете установить индивидуальные параметры, указав весь путь и значение содержимого без скобок. Например, задайте параметру "Путь к двойнику устройства" значение `properties.desired.chiller-water.temperature`, а параметру "Содержимое" — `66`.

Если две или несколько конфигураций указывают на один и тот же путь, то будет использоваться содержимое из конфигурации с наивысшим приоритетом (приоритет определяется на шаге 4).

Если вы хотите удалить свойство, укажите для него значение `null`.

Дополнительные параметры можно добавить, щелкнув на **Add Device Twin Setting** (Добавить параметр двойника устройства).

### <a name="specify-metrics-optional"></a>Указание метрик (необязательно)

Метрики обеспечивают общее количество различных состояний, которые устройство может сообщать после применения конфигурации содержимого. Например, вы можете создать метрику для ожидающих изменений параметров, метрики для ошибок и метрики для успешных изменений параметров.

1. Введите имя для параметра **Имя метрики**.

2. Введите запрос для параметра **Metric Criteria** (Критерии метрики).  Запрос основан на сообщаемых свойствах двойников устройств.  Метрика представляет количество строк, возвращаемых запросом.

Например: 

```sql
SELECT deviceId FROM devices 
  WHERE properties.reported.chillerWaterSettings.status='pending'
```

Предложение с указанием того, что конфигурация была применена, см. в примере. 

```sql
/* Include the double brackets. */
SELECT deviceId FROM devices 
  WHERE configurations.[[yourconfigname]].status='Applied'
```

### <a name="target-devices"></a>Целевые устройства

С помощью свойств тегов ваших двойников устройств можно назначить конкретные устройства, к которым будет применяться эта конфигурация.  Вы также можете указать на устройства с помощью сообщаемых свойств двойников устройств.

Так как несколько конфигураций могут предназначаться для одного устройства, каждой конфигурации необходимо присвоить номер приоритета. Если возникает конфликт, побеждает конфигурация с наивысшим приоритетом. 

1. Введите положительное целое число для **приоритета** конфигурации. Наивысшее числовое значение считается наивысшим приоритетом. Когда обе конфигурации имеют одинаковый номер приоритета, побеждает та, которая была создана недавно. 

2. Введите **условие назначения**, чтобы определить, для каких устройств будет предназначена эта конфигурация. Условие основано на тегах двойника устройства или его сообщаемых свойствах и должно соответствовать формату выражения. Например, `tags.environment='test'` или `properties.reported.chillerProperties.model='4000x'`. Вы можете выбрать `*` для всех устройств.

3. Нажмите кнопку **Далее**, чтобы перейти к последнему шагу.

### <a name="review-configuration"></a>Просмотр конфигурации

Просмотрите сведения о конфигурации, а затем выберите **Отправить**.

## <a name="monitor-a-configuration"></a>Мониторинг конфигурации

Чтобы просмотреть сведения о конфигурации и узнать, какое устройство ее использует, сделайте следующее:

1. Найдите нужный Центр Интернета вещей на [портале Azure](https://portal.azure.com). 

2. Выберите **Конфигурация устройства Интернета вещей**.

3. Проверьте список конфигураций. Для каждой конфигурации можно просмотреть следующие сведения:

   * **Идентификатор**. Имя конфигурации.

   * **Целевое условие**. Тег, используемый для определения целевых устройств.

   * **Приоритет**. Номер приоритета, назначенный для конфигурации.

   * **Время создания**. Метка времени, когда была создана конфигурация. Метка времени используется, чтобы разорвать связи, если две конфигурации имеют одинаковый приоритет. 

   * **Системные метрики**. Метрики, которые вычисляются Центром Интернета вещей и не могут быть настроены разработчиками. Целевое условие указывает количество двойников устройств, которые соответствуют целевому состоянию. Применяет заданное количество двойников устройств, которые были изменены конфигурацией, а также могут содержать частичные изменения в случае, если они были сделаны отдельной конфигурацией с более высоким приоритетом. 

   * **Пользовательские метрики**. Метрики, заданные разработчиком в качестве запросов к сообщаемым свойствам двойников устройств.  Для каждой конфигурации можно определить до пяти пользовательских метрик. 
   
4. Выберите конфигурацию, которую следует отслеживать.  

5. Проверьте сведения о конфигурации. С помощью вкладок можно просмотреть конкретные сведения об устройствах, к которым применена конфигурация.

   * **Целевое условие**. Устройства, которые соответствуют целевому условию. 

   * **Метрики**. Список системных и пользовательских метрик.  Вы можете просмотреть список устройств для каждой метрики, выбрав метрику в раскрывающемся списке, а затем щелкнув **View Devices** (Просмотреть устройства).

   * **Device Twin Settings** (Параметры двойников устройств). Параметры двойников устройств, настроенные с помощью конфигурации. 

   * **Configuration Labels** (Метки конфигурации). Пары "ключ — значение", используемые для описания конфигурации.  Метки не влияют на функциональность. 

## <a name="modify-a-configuration"></a>Изменение конфигурации

При изменении конфигурации изменения немедленно реплицируются во все целевые устройства. 

Если обновить целевое условие, произойдут следующие обновления:

* Если двойник устройства не соответствует предыдущему условию назначения, однако соответствует новому и эта конфигурация имеет самый высокий приоритет для двойника устройства, то она будет применена к двойнику устройства. 

* Если двойник устройства больше не соответствует целевому условию, параметры из конфигурации будут удалены, а двойник устройства будет изменен с помощью следующей конфигурации с наивысшим приоритетом. 

* Если двойник устройства, работающий в настоящее время в этой конфигурации, больше не удовлетворяет целевому условию и не соответствует целевому условию любых других конфигураций, параметры из конфигурации будут удалены и никакие другие изменения не будут сделаны в двойнике. 

Чтобы изменить конфигурацию, сделайте следующее: 

1. Найдите нужный Центр Интернета вещей на [портале Azure](https://portal.azure.com). 

2. Выберите **Конфигурация устройства Интернета вещей**. 

3. Выберите конфигурацию, которую следует изменить. 

4. Внесите изменения в следующие поля: 

   * Условие назначения 
   * Метки 
   * Приоритет 
   * Метрики

4. Щелкните **Сохранить**.

5. Следуйте указаниям раздела [Мониторинг конфигурации](#monitor-a-configuration) для отслеживания выполнения изменений. 

## <a name="delete-a-configuration"></a>Удаление конфигурации

Когда вы удаляете конфигурацию, все двойники устройств принимают следующую конфигурацию с самым высоким приоритетом. Если двойники устройств не соответствуют целевому условию любой другой конфигурации, то другие параметры не применяются. 

1. Найдите нужный Центр Интернета вещей на [портале Azure](https://portal.azure.com). 

2. Выберите **Конфигурация устройства Интернета вещей**. 

3. Установите флажок, чтобы выбрать конфигурацию, которую необходимо удалить. 

4. Нажмите кнопку **Удалить**.

5. Появится запрос на подтверждение.

## <a name="next-steps"></a>Дальнейшие действия

В этой статье вы узнали, как настроить и отслеживать устройства Интернета вещей в нужном масштабе. Дополнительные сведения об управлении Центром Интернета вещей в Azure см. по следующим ссылкам:

* [Управление удостоверениями устройств Центра Интернета вещей в пакетном режиме](iot-hub-bulk-identity-mgmt.md)
* [Общие сведения о метриках Центра Интернета вещей](iot-hub-metrics.md)
* [Мониторинг операций](iot-hub-operations-monitoring.md)

Для дальнейшего изучения возможностей Центра Интернета вещей см. следующие статьи:

* [Руководство разработчика для Центра Интернета вещей](iot-hub-devguide.md)
* [Краткое руководство. Развертывание первого модуля IoT Edge на устройстве под управлением 64-разрядной ОС Linux](../iot-edge/tutorial-simulate-device-linux.md)

Узнайте, как использовать службу подготовки устройств для Центра Интернета вещей, чтобы включить автоматическую подготовку JIT, из следующей статьи: 

* [Служба подготовки устройств для Центра Интернета вещей Azure](/azure/iot-dps)
