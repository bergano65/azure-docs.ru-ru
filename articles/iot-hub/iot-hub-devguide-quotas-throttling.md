---
title: Общие сведения о квотах и регулировании в Центре Интернета вещей | Документация Майкрософт
description: Руководство разработчика. Описание квот, применимых к Центру Интернета вещей, и ожидаемого поведения регулирования.
author: robinsh
ms.author: robinsh
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 08/08/2019
ms.openlocfilehash: 0e60607d50722a4496dc8f4ad7d609cdf9fd5792
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2019
ms.locfileid: "69877169"
---
# <a name="reference---iot-hub-quotas-and-throttling"></a>Руководство. Квоты и регулирование в Центре Интернета вещей

В этой статье объясняются квоты центра Интернета вещей и приводятся сведения, помогающие понять, как работает регулирование.

## <a name="quotas-and-throttling"></a>Квоты и регулирование

Каждая подписка Azure может использовать не более 50 Центров Интернета вещей и не более 1 центра уровня "Бесплатный".

Каждый центр Интернета вещей подготавливается с определенным количеством единиц для каждого конкретного уровня. Уровень и число единиц определяют максимальную дневную квоту сообщений, которые вы можете отправить. Размер сообщения, используемый для расчета дневной квоты, составляет 0,5 КБ для центра уровня "Бесплатный" и 4 КБ для других уровней. Дополнительные сведения см. на странице с [ценами на Центр Интернета вещей Azure](https://azure.microsoft.com/pricing/details/iot-hub/).

Уровень также определяет пределы регулирования, устанавливаемые Центром Интернета вещей для выполнения всех операций.

### <a name="iot-plug-and-play"></a>IoT Plug and Play

Во время общедоступной предварительной версии устройства IoT Plug and Play будут отсылать отдельные сообщения на интерфейс, что может увеличить количество сообщений, подсчитанных в отношении квоты сообщений.

## <a name="operation-throttles"></a>Регулирование операций

Регулирование операций — это ограничения частоты, которые применяются в диапазоне минут и предназначены для предотвращения нарушения. Они также накладываются на [формирование трафика](#traffic-shaping).

В следующей таблице показаны варианты принудительного регулирования. Значения обозначают тот или иной концентратор.

| Регулирование | Бесплатный, B1 и S1 | В2 и S2 | B3 и S3 | 
| -------- | ------- | ------- | ------- |
| [Операции](#identity-registry-operations-throttle) с реестром удостоверений (создание, получение, перечисление, обновление, удаление) | 1,67 операций в секунду на единицу (100 операций в минуту на единицу) | 1,67 операций в секунду на единицу (100 операций в минуту на единицу) | 83,33 операций в секунду на единицу (5000 в минуту на единицу) |
| [Новые подключения устройств](#device-connections-throttle) (это ограничение применяется к частоте _новых подключений_, а не к общему количеству подключений). | Более 100 в секунду или 12 в секунду на единицу <br/> Например, две единицы S1 — это 2\*12 = 24 новых подключений в секунду, но для ваших единиц имеется не менее 100 новых подключений в секунду. Для девяти единиц S1 мы получим 108 новых подключений в секунду (9\*12) для всех единиц. | 120 новых подключений/с/ед. | 6 000 новых подключений в секунду на единицу |
| Передачи с устройства в облако | Более 100 операций отправки в секунду или 12 операций отправки в секунду на единицу <br/> Например, два модуля S1 — 2\*12 = 24/с, но у вас есть по крайней мере 100 операций отправки в секунду для всех единиц. С девятью единицами S1 у вас есть 108 операций отправки в секунду\*(9 12) по всем единицам. | 120 операций отправки в секунду на единицу | 6 000 операций отправки в секунду на единицу |
| Передачи из облака на устройство <sup>1</sup> | 1,67 операций отправки в секунду на единицу (100 сообщений/мин на единицу) | 1,67 операций отправки в секунду на единицу (100 операций отправки в минуту на единицу) | 83,33 операций отправки в секунду на единицу (5 000 операций отправки в минуту на единицу) |
| Прием из облака на устройство <sup>1</sup> <br/> (только если устройство использует HTTPS)| 16,67 операций получения в секунду на единицу (1 000 операций получения/мин на единицу) | 16,67 операций получения в секунду на единицу (1 000 операций получения/мин на единицу) | 833,33 операций получения в секунду на единицу (50 000 операций получения/мин на единицу) |
| Отправка файла | 1,67 уведомлений о передаче файлов в секунду на единицу (100 уведомлений в минуту на единицу) | 1,67 уведомлений о передаче файлов в секунду на единицу (100 уведомлений в минуту на единицу) | 83,33 уведомлений о передаче файлов в секунду на единицу (5000 в минуту на единицу) |
| Прямые методы<sup>1</sup> | 160 КБ/сек/единицу<sup>2</sup> | 480 КБ/сек/единицу<sup>2</sup> | 24 МБ/сек/единицу<sup>2</sup> | 
| Запросы | 20 в минуту на единицу | 20 в минуту на единицу | 1000 в минуту на единицу |
| Операции чтения двойников устройств и модулей<sup>1</sup> | 100/с | Более 100 в секунду или 10 в секунду на единицу | 500 в секунду на единицу |
| Обновление двойников устройств и двойников модулей<sup>1</sup> | 50 в секунду | Более 50 в секунду или 5 в секунду на единицу | 250 в секунду на единицу |
| Операции с заданиями<sup>1</sup> <br/> (создание, обновление, перечисление и удаление) | 1,67 операций в секунду на единицу (100 операций в минуту на единицу) | 1,67 операций в секунду на единицу (100 операций в минуту на единицу) | 83,33 операций в секунду на единицу (5000 в минуту на единицу) |
| Операции с заданиями на устройстве<sup>1</sup> <br/> (обновление двойника, вызов прямого метода) | 10 в секунду | Более 10 в секунду или 1 в секунду на единицу | 50 в секунду на единицу |
| Конфигурации и развертывания Edge<sup>1</sup> <br/> (создание, обновление, перечисление и удаление) | 0,33/с/ед. (мин/20/ед.) | 0,33/с/ед. (мин/20/ед.) | 0,33/с/ед. (мин/20/ед.) |
| Скорость инициации потока устройства<sup>1</sup> | 5 новых потоков в секунду | 5 новых потоков в секунду | 5 новых потоков в секунду |
| Максимальное число параллельно подключенных потоков устройств<sup>1</sup> | 50 | 50 | 50 |
| Максимальный объем передачи данных в потоке устройства<sup>1</sup> (совокупная частота в день) | 300 МБ | 300 МБ | 300 МБ |

<sup>1</sup>Эта функция недоступна на базовом уровне Центра Интернета вещей. Дополнительные сведения см. в статье [Масштабирование решения для Центра Интернета вещей](iot-hub-scaling.md). <br/><sup>2</sup> Размер счетчика регулирования составляет 4 КБ.

### <a name="throttling-details"></a>Сведения о регулировании

* Размер счетчика определяет, на что увеличивается ограничение регулирования. Если полезная нагрузка прямого вызова находится в диапазоне от 0 до 4 КБ, то она считается 4 КБ. До достижения ограничения в 160 КБ/с на единицу можно до 40 вызовов в секунду на единицу.

   Аналогично, если полезные данные находятся в диапазоне от 4 КБ до 8 КБ, каждая учетная запись вызова будет иметь размер 8 КБ, а до достижения максимального ограничения можно состоять до 20 вызовов в секунду на единицу.

   Наконец, если размер полезной нагрузки составляет от 156KB до 160 КБ, вы сможете сделать только один вызов в секунду на единицу в концентраторе до достижения ограничения в 160 КБ/с на единицу.

*  Для *заданий операций с устройствами (обновление двойника, вызов прямого метода)* для уровня S2, 50 в секунду на единицу применяется только при вызове методов с помощью заданий. При непосредственном вызове прямых методов предельное значение ограничения в 24 Мб/с на единицу (для S2) применяется.

*  **Квота** — это совокупное количество сообщений, которые можно отправить в центре *за день*. Вы можете найти предельную квоту концентратора в столбце **Общее число сообщений/день** на [странице цен на центр Интернета вещей](https://azure.microsoft.com/pricing/details/iot-hub/).

*  Скорость отправки сообщений из облака на устройство и с устройства в облако определяется максимальной *скоростью* , с которой можно отправить сообщения — количество сообщений, не отличных от 4 КБ. Каждое сообщение может иметь размер до 256 КБ, что является [максимальным размером сообщения](iot-hub-devguide-quotas-throttling.md#other-limits).

*  Рекомендуется регулировать вызовы, чтобы не превысить пределы регулирования. Если достигнуто предельное значение, центр Интернета вещей выдает сообщение с кодом ошибки 429, и клиент должен выполнить отправку и повторить попытку. Эти ограничения задаются для каждого концентратора (или в некоторых случаях на концентратор или единицу). Дополнительные сведения см. в статье об [управлении подключением и надежных шаблонах обмена сообщениями и повторных попыток](iot-hub-reliability-features-in-sdks.md#retry-patterns).

### <a name="traffic-shaping"></a>Формирование трафика

Чтобы обеспечить соответствие пакетному трафику, центр Интернета вещей принимает запросы, превышающие регулирование, в течение ограниченного времени. Первые несколько этих запросов обрабатываются немедленно. Однако если количество запросов по-новому нарушает регулирование, центр Интернета вещей начинает размещать запросы в очереди и обрабатывает их по скорости ограничения. Этот результат называется *формированием трафика*. Кроме того, размер этой очереди ограничен. Если нарушение регулирования будет продолжено, в конце концов очередь заполнится, а центр Интернета вещей начнет `429 ThrottlingException`отклонять запросы с помощью.

Например, вы используете виртуальное устройство для отправки 200 сообщений, отправляемых с устройства в облако, в центр Интернета вещей S1 (с ограничением в 100/с D2C). В течение первой минуты или два сообщения обрабатываются немедленно. Тем не менее, так как устройство будет продолжать отправку большего количества сообщений, чем ограничение регулирования, центр Интернета вещей начинает обрабатывать только 100 сообщений в секунду и помещает остальные в очередь. Вы начинаете увеличивать задержку. Со временем вы начинаете получать `429 ThrottlingException` по мере заполнения очереди, а "количество ошибок регулирования" в метриках [центра Интернета вещей](iot-hub-metrics.md) начинает увеличиваться.

### <a name="identity-registry-operations-throttle"></a>Регулирование операций реестра удостоверений

Операции с реестром удостоверений устройств предназначены для использования во время выполнения в сценариях управления устройствами и подготовки. Чтение или обновление большого количества удостоверений устройств поддерживается с помощью [заданий импорта и экспорта](iot-hub-devguide-identity-registry.md#import-and-export-device-identities).

### <a name="device-connections-throttle"></a>Регулирование подключений устройств

Регулирование *подключений устройств* определяет скорость, с которой можно установить новые подключения устройства к Центру Интернета вещей. Регулирование *подключений устройства* не влияет на максимальное число одновременно подключенных устройств. Регулирование скорости *подключений устройства* зависит от числа единиц, подготовленных для Центра Интернета вещей.

Например, если вы приобретаете одну единицу S1, то получаете регулирование 100 соединений в секунду. Таким образом, для подключения устройств 100 000 требуется не менее 1 000 секунд (приблизительно 16 минут). Однако вы можете иметь столько одновременно подключенных устройств, сколько устройств зарегистрировано в вашем реестре удостоверений.

## <a name="other-limits"></a>Другие ограничения

Центр Интернета вещей применяет другие операционные ограничения:

| Операция | Ограничение |
| --------- | ----- |
| Устройства | Максимальное число устройств, которые можно подключить к одному центру Интернета вещей, — 1 000 000. Единственный способ увеличить это ограничение — обратиться в [Служба поддержки Майкрософт](https://azure.microsoft.com/support/options/).|
| Передача файлов | 10 параллельных отправок файлов на устройство. |
| Задания<sup>1</sup> | Максимальное число одновременных заданий равно 1 (для Free и S1), 5 (для S2) и 10 (для S3). Однако максимальное количество одновременных [заданий импорта и экспорта устройств](iot-hub-bulk-identity-mgmt.md) равно 1 для всех уровней. <br/>Журнал заданий сохраняется до 30 дней. |
| Дополнительные конечные точки | Платные центры SKU могут иметь 10 дополнительных конечных точек. Бесплатные центры SKU могут иметь одну дополнительную конечную точку. |
| Запросы маршрутизации сообщений | В платных центрах SKU может быть 100 запросов маршрутизации. Свободные концентраторы номеров SKU могут содержать пять запросов маршрутизации. |
| Обогащение сообщений | Платные центры SKU могут иметь до 10 дополнений сообщений. Свободные центры SKU могут иметь до 2 дополнений сообщений.|
| Передача сообщений с устройства в облако | Максимальный размер сообщения — 256 КБ |
| Передача сообщений из облака на устройство<sup>1</sup> | Максимальный размер сообщения — 64 КБ. Максимальное количество сообщений, ожидающих доставки, составляет 50 на устройство. |
| Прямой метод<sup>1</sup> | Максимальный размер полезных данных прямого метода — 128 КБ. |
| Автоматическая конфигурация устройств<sup>1</sup> | 100 конфигураций на платный центр SKU. 20 конфигураций на бесплатный центр SKU. |
| IoT Edge автоматические развертывания<sup>1</sup> | 20 модулей на развертывание. 100 развертываний на платный центр SKU. 10 развертываний на каждый центр свободных номеров SKU. |
| Двойники<sup>1</sup> | Максимальный размер на раздел двойников (теги, требуемые и сообщаемые свойства) — 8 КБ |

<sup>1</sup>Эта функция недоступна на базовом уровне Центра Интернета вещей. Дополнительные сведения см. в статье [Масштабирование решения для Центра Интернета вещей](iot-hub-scaling.md).

## <a name="increasing-the-quota-or-throttle-limit"></a>Увеличение квоты или ограничения регулирования

В любой момент времени можно увеличить квоты или ограничения регулирования, [увеличив число подготовленных единиц в центре Интернета вещей](iot-hub-upgrade.md).

## <a name="latency"></a>Задержка

Центр Интернета вещей стремится обеспечить малую задержку при выполнении всех операций. Однако из-за условий сети и других непредсказуемых факторов она не может гарантировать определенную задержку. При разработке решения учитывайте следующее:

* Не делайте никаких предположений о максимально низкой задержке любой операции Центра Интернета вещей.
* Подготовьте Центр Интернета вещей в ближайшем к вашим устройствам регионе Azure.
* Рассмотрите возможность использования Azure IoT Edge для выполнения чувствительных к задержке операций на устройстве или в шлюзе рядом с устройством.

Несколько единиц Центра Интернета вещей влияют на регулирование, как описано выше, но не обеспечивают дополнительные преимущества или гарантии относительно задержки.

Обратитесь в [службу поддержки Майкрософт](https://azure.microsoft.com/support/options/) в случае непредвиденного увеличения задержки операций.

## <a name="next-steps"></a>Следующие шаги

В записи блога, посвященной [регулированию в Центре Интернета вещей](https://azure.microsoft.com/blog/iot-hub-throttling-and-you/), приводится подробное описание стратегии регулирования в Центре Интернета вещей.

Другие справочные статьи в руководстве разработчика для Центра Интернета вещей:

* [Конечные точки Центра Интернета вещей](iot-hub-devguide-endpoints.md)
