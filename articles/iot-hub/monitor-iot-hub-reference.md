---
title: Справочник по мониторингу данных в центре Интернета вещей Azure
description: Важный справочный материал, необходимый для мониторинга центра Интернета вещей Azure
author: robinsh
ms.author: robinsh
ms.topic: reference
ms.service: iot-hub
ms.date: 10/22/2020
ms.openlocfilehash: 609c44991e7deca183321758fabdef80b71210c5
ms.sourcegitcommit: 6a350f39e2f04500ecb7235f5d88682eb4910ae8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/01/2020
ms.locfileid: "96460857"
---
# <a name="monitoring-azure-iot-hub-data-reference"></a>Справочник по мониторингу данных в центре Интернета вещей Azure

Подробные сведения о сборе и анализе данных мониторинга для центра Интернета вещей Azure см. в статье [мониторинг центра Интернета вещей Azure](monitor-iot-hub.md) .

## <a name="metrics"></a>Метрики

В этом разделе перечислены все автоматически собранные метрики платформы для центра Интернета вещей Azure. Пространство имен поставщика ресурсов для метрик центра Интернета вещей — **Microsoft. Devices** , а пространство имен Type — **IoTHubs**.

В следующих подразделах вы разбиваете метрики платформы центра Интернета вещей по общей категории и перечислите их по отображаемому имени, отображаемому в портал Azure с помощью. Также предоставляются сведения, относящиеся к метрикам, которые отображаются в каждом подразделе.

Вы также можете найти одну таблицу, в которой перечислены все метрики платформы центра Интернета вещей по имени метрики в разделе [Microsoft. Devices/IotHubs](../azure-monitor/platform/metrics-supported.md#microsoftdevicesiothubs) в документации по Azure Monitor. Имейте в виду, что эта таблица не предоставляет некоторые сведения, такие как [Поддерживаемые агрегаты](#supported-aggregations) для некоторых метрик, доступные в этой статье.

Дополнительные сведения о метриках, поддерживаемых другими службами Azure, см. в разделе [Поддерживаемые метрики с помощью Azure Monitor](../azure-monitor/platform/metrics-supported.md).

**Темы в этом разделе**

- [Поддерживаемые агрегаты](#supported-aggregations)
- [Метрики команды "облако — устройство"](#cloud-to-device-command-metrics)
- [Метрики прямых методов для облака на устройство](#cloud-to-device-direct-methods-metrics)
- [Метрики операций облака на устройство двойника](#cloud-to-device-twin-operations-metrics)
- [Метрики конфигурации](#configurations-metrics)
- [Метрики ежедневной квоты](#daily-quota-metrics)
- [Метрики устройств](#device-metrics)
- [Метрики телеметрии устройств](#device-telemetry-metrics)
- [Метрики операций с устройства в облако двойника](#device-to-cloud-twin-operations-metrics)
- [Метрики сетки событий](#event-grid-metrics)
- [Метрики заданий](#jobs-metrics)
- [Метрики маршрутизации](#routing-metrics)
- [Метрики запросов двойника](#twin-query-metrics)

### <a name="supported-aggregations"></a>Поддерживаемые агрегаты

Столбец **типа агрегирования** в каждой таблице соответствует статистической обработке по умолчанию, используемой при выборе метрики для диаграммы или оповещения.

   ![Снимок экрана, показывающий агрегирование метрик](./media/monitor-iot-hub-reference/aggregation-type.png)

Для большинства метрик все типы статистической обработки являются допустимыми; Однако для метрик количества, для которых значение **Count** равно значению столбца **единицы** , допустимы только некоторые агрегаты. Метрики количества могут быть одного из двух типов:

* Для метрик числа **с одиночной точкой** центр Интернета вещей регистрирует одну точку данных — по сути, один раз в каждую операцию, когда выполняется измеряемая операция. Затем Azure Monitor суммирует эти точки данных на основе указанной гранулярности. Примерами **одноточечных** метрик являются *Отправленные сообщения телеметрии* и *C2D доставки сообщений*. Для этих метрик всего относится только тип статистической обработки (SUM). Портал позволяет выбрать минимальное, максимальное и среднее значение; Однако эти значения всегда будут иметь значение 1.

* Для метрик количества **снимков** центр Интернета вещей регистрирует общее число при выполнении измеряемой операции. Сейчас центр Интернета вещей порождает три метрики **моментальных снимков** : *Общее количество используемых сообщений*, общее число *устройств (Предварительная версия)* и *подключенных устройств (Предварительная версия)*. Так как эти метрики представляют «суммарное» количество при каждом выдаче, их суммирование по указанной гранулярности не имеет смысла. Azure Monitor ограничивает выбор среднего, минимального и максимального значений для типа агрегирования для этих метрик.

### <a name="cloud-to-device-command-metrics"></a>Метрики команды "облако — устройство"

|Отображаемое имя метрики|Метрика|Единицы|Тип статистической обработки|Описание|Измерения|
|---|---|---|---|---|---|
|Сообщения из облака на устройство (C2D) с истекшим сроком действия (предварительная версия)|C2DMessagesExpired|Count|Итог|Число сообщений, отправленных из облака на устройство с истекшим сроком действия|Нет|
|Доставленные сообщения из облака на устройство (C2D)|c2d.commands.egress.complete.success|Count|Итог|Число попыток доставки сообщений, отправленных из облака на устройство, успешно завершено устройством|Нет|
|Отброшенные сообщения из облака на устройство (C2D)|c2d.commands.egress.abandon.success|Count|Итог|Число сообщений, отправленных из облака на устройство, которые отброшены устройством|Нет|
|Отклоненные сообщения из облака на устройство (C2D)|c2d.commands.egress.reject.success|Count|Итог|Число сообщений, отправленных из облака на устройство, отклоненных устройством|Нет|

Для метрик с **количеством** **единиц** , допустимым только статистическая обработка (SUM). Минимальное, максимальное и среднее число агрегатов всегда возвращают значение 1. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

### <a name="cloud-to-device-direct-methods-metrics"></a>Метрики прямых методов для облака на устройство

|Отображаемое имя метрики|Метрика|Единицы|Тип статистической обработки|Описание|Измерения|
|---|---|---|---|---|---|
|Неудачные вызовы прямых методов.|c2d.methods.failure|Count|Итог|Число всех неудачных вызовов прямых методов.|Нет|
|Размер запроса вызовов прямых методов.|c2d.methods.requestSize|Байты|Среднее|Число всех успешных запросов прямых методов.|Нет|
|Размер ответа вызовов прямых методов.|c2d.methods.responseSize|Байты|Среднее|Число всех успешных ответов прямых методов.|Нет|
|Успешные вызовы прямых методов.|c2d.methods.success|Count|Итог|Число всех успешных вызовов прямых методов.|Нет|

Для метрик с допустимым агрегатом только **для количества** **единиц** (SUM). Минимальное, максимальное и среднее число агрегатов всегда возвращают значение 1. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

### <a name="cloud-to-device-twin-operations-metrics"></a>Метрики операций облака на устройство двойника

|Отображаемое имя метрики|Метрика|Единицы|Тип статистической обработки|Описание|Измерения|
|---|---|---|---|---|---|
|Неудачные операции чтения с двойников, инициированные из серверной части.|c2d.twin.read.failure|Count|Итог|Число всех неудачных операций чтения с двойников, инициированных из серверной части.|Нет|
|Неудачные обновления двойников, инициированные из серверной части.|c2d.twin.update.failure|Count|Итог|Число всех неудачных обновлений двойников, инициированных из серверной части.|Нет|
|Размер ответа операций чтения с двойников, инициированных из серверной части.|c2d.twin.read.size|Байты|Среднее|Число всех успешных операций чтения с двойников, инициированных из серверной части.|Нет|
|Размер обновлений двойников, инициированных из серверной части.|c2d.twin.update.size|Байты|Среднее|Общий размер всех успешных обновлений двойника, инициированных в серверной части.|Нет|
|Успешные операции чтения с двойников, инициированные из серверной части.|c2d.twin.read.success|Count|Итог|Число всех успешных операций чтения с двойников, инициированных из серверной части.|Нет|
|Успешные обновления двойников, инициированные из серверной части.|c2d.twin.update.success|Count|Итог|Число всех успешных обновлений двойников, инициированных из серверной части.|Нет|

Для метрик с **количеством** **единиц** , допустимым только статистическая обработка (SUM). Минимальное, максимальное и среднее число агрегатов всегда возвращают значение 1. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

### <a name="configurations-metrics"></a>Метрики конфигурации

|Отображаемое имя метрики|Метрика|Единицы|Тип статистической обработки|Описание|Измерения|
|---|---|---|---|---|---|
|Configuration Metrics (Метрики конфигурации)|конфигурации|Count|Итог|Общее число операций CRUD, выполненных для конфигурации устройства и развертывания IoT Edge, на наборе целевых устройств. Сюда также входит количество операций, изменяющих двойникаов устройств или двойника модуля из-за этих конфигураций.|Нет|

Для метрик с **количеством** **единиц** , допустимым только статистическая обработка (SUM). Минимальное, максимальное и среднее число агрегатов всегда возвращают значение 1. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

### <a name="daily-quota-metrics"></a>Метрики ежедневной квоты

|Отображаемое имя метрики|Метрика|Единицы|Тип статистической обработки|Описание|Измерения|
|---|---|---|---|---|---|
|Общий объем использования данных устройствами|deviceDataUsage|Байты|Итог|Байты, переданные на любые устройства, подключенные к Центру Интернета вещей, и с них|Нет|
|Total device data usage (preview) (Общий объем использования данных устройствами (предварительная версия))|deviceDataUsageV2|Байты|Итог|Байты, переданные на любые устройства, подключенные к Центру Интернета вещей, и с них|Нет|
|Общее количество используемых сообщений|dailyMessageQuotaUsed|Count|Среднее|Количество сообщений, использованных сегодня. Это совокупное значение, которое сбрасывается до нуля в 00:00 UTC каждый день.|Нет|

Для *общего числа используемых сообщений* поддерживаются только минимальные, максимальные и средние агрегаты. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

### <a name="device-metrics"></a>Параметры устройства:

|Отображаемое имя метрики|Метрика|Единицы|Тип статистической обработки|Описание|Измерения|
|---|---|---|---|---|---|
|Total devices (deprecated) (Всего устройств (не рекомендуется))|devices.totalDevices|Count|Итог|Число устройств, зарегистрированных в Центре Интернета вещей.|Нет|
|Connected devices (deprecated) (Подключенные устройства (не рекомендуется)) |devices.connectedDevices.allProtocol|Count|Итог|Число устройств, подключенных к Центру Интернета вещей.|Нет|
|Total devices (preview) (Всего устройств (предварительная версия))|totalDeviceCount|Count|Среднее|Число устройств, зарегистрированных в Центре Интернета вещей.|Нет|
|Connected devices (preview) (Подключенных устройств (предварительная версия))|connectedDeviceCount|Count|Среднее|Число устройств, подключенных к Центру Интернета вещей.|Нет|

Для *всех устройств (не рекомендуется)* и *подключенных устройств (не рекомендуется)* допустима только общая (SUM) Статистическая функция. Минимальное, максимальное и среднее число агрегатов всегда возвращают значение 1. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

Для *всех устройств (Предварительная версия)* и *подключенных устройств (Предварительная версия)* допустимы только минимальные, максимальные и средние статистические выражения. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

*Подключенные устройства (Предварительная версия)* и *Общее количество устройств (Предварительная версия)* не могут быть экспортированы с помощью параметров диагностики.

### <a name="device-telemetry-metrics"></a>Метрики телеметрии устройств

|Отображаемое имя метрики|Метрика|Единицы|Тип статистической обработки|Описание|Измерения|
|---|---|---|---|---|---|
|Количество ошибок регулирования|d2c.telemetry.ingress.sendThrottle|Count|Итог|Количество ошибок регулирования из-за регулирования пропускной способности устройства|Нет|
|Число предпринятых попыток отправки сообщений телеметрии.|d2c.telemetry.ingress.allProtocol|Count|Итог|Число предпринятых попыток отправки в Центр Интернета вещей сообщений телеметрии из устройства в облако.|Нет|
|Число отправленных сообщений телеметрии.|d2c.telemetry.ingress.success|Count|Итог|Число успешно отправленных в Центр Интернета вещей сообщений телеметрии из устройства в облако.|Нет|

Для метрик с **количеством** **единиц** , допустимым только статистическая обработка (SUM). Минимальное, максимальное и среднее число агрегатов всегда возвращают значение 1. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

### <a name="device-to-cloud-twin-operations-metrics"></a>Метрики операций с устройства в облако двойника

|Отображаемое имя метрики|Метрика|Единицы|Тип статистической обработки|Описание|Измерения|
|---|---|---|---|---|---|
|Неудачные операции чтения с двойников, инициированные устройством.|d2c.twin.read.failure|Count|Итог|Число всех неудачных операций чтения с двойников, инициированных устройством.|Нет|
|Неудачные обновления двойников, инициированные устройством.|d2c.twin.update.failure|Count|Итог|Число всех неудачных обновлений двойников, инициированных устройством.|Нет|
|Размер ответа операций чтения с двойников, инициированных устройством.|d2c.twin.read.size|Байты|Среднее|Число всех успешных операций чтения, инициированных устройством, двойника.|Нет|
|Размер обновлений двойников, инициированных устройством.|d2c.twin.update.size|Байты|Среднее|Общий размер всех успешных обновлений двойника, инициированных устройством.|Нет|
|Успешные операции чтения с двойников, инициированные устройством.|d2c.twin.read.success|Count|Итог|Число всех успешных операций чтения с двойников, инициированных устройством.|Нет|
|Успешные обновления двойников, инициированные устройством.|d2c.twin.update.success|Count|Итог|Число всех успешных обновлений двойников, инициированных устройством.|Нет|

Для метрик с **количеством** **единиц** , допустимым только статистическая обработка (SUM). Минимальное, максимальное и среднее число агрегатов всегда возвращают значение 1. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

### <a name="event-grid-metrics"></a>Метрики сетки событий

|Отображаемое имя метрики|Метрика|Единицы|Тип статистической обработки|Описание|Измерения|
|---|---|---|---|---|---|
|Сетка событий: доставок (Предварительная версия)|EventGridDeliveries|Count|Итог|Число событий центра Интернета вещей, опубликованных в сетке событий. Используйте измерение результат для количества успешных и неудачных запросов. Измерение EventType показывает тип события ( https://aka.ms/ioteventgrid) .|Результат:<br/>EventType<br>Дополнительные *сведения см. в разделе [измерения метрики](#metric-dimensions)*.|
|Задержка сетки событий (предварительная версия)|EventGridLatency|Миллисекунды|Среднее|Средняя задержка (в миллисекундах) от момента создания события центра Интернета вещей до публикации события в сетке событий. Это число является средним значением между всеми типами событий. Используйте измерение EventType для просмотра задержки определенного типа события.|EventType<br>Дополнительные *сведения см. в разделе [измерения метрики](#metric-dimensions)*.|

Для метрик с **количеством** **единиц** , допустимым только статистическая обработка (SUM). Минимальное, максимальное и среднее число агрегатов всегда возвращают значение 1. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

### <a name="jobs-metrics"></a>Метрики заданий

|Отображаемое имя метрики|Метрика|Единицы|Тип статистической обработки|Описание|Измерения|
|---|---|---|---|---|---|
|Завершенные задания|jobs.completed|Count|Итог|Количество всех выполненных заданий.|Нет|
|Неудачные вызовы получения списка заданий.|jobs.listJobs.failure|Count|Итог|Количество всех неудачных вызовов для получения списка заданий.|Нет|
|Неудачные операции создания заданий вызова методов.|jobs.createDirectMethodJob.failure|Count|Итог|Количество всех неудачных операций создания заданий вызова прямых методов.|Нет|
|Неудачные операции создания заданий обновления двойников.|jobs.createTwinUpdateJob.failure|Count|Итог|Количество всех неудачных операций создания заданий обновления двойников.|Нет|
|Неудачные отмены заданий.|jobs.cancelJob.failure|Count|Итог|Количество всех неудачных вызовов для отмены заданий.|Нет|
|Неудачные запросы заданий.|jobs.queryJobs.failure|Count|Итог|Количество всех неудачных вызовов для запроса заданий.|Нет|
|Неудачные задания.|jobs.failed|Count|Итог|Количество всех неудачных заданий.|Нет|
|Успешные вызовы получения списка заданий.|jobs.listJobs.success|Count|Итог|Количество всех успешных вызовов для получения списка заданий.|Нет|
|Успешные операции создания заданий вызова методов.|jobs.createDirectMethodJob.success|Count|Итог|Количество всех успешных операций создания заданий вызова прямых методов.|Нет|
|Успешные операции создания заданий обновления двойников.|jobs. Креатетвинупдатежоб.<br>Успешное завершение|Count|Итог|Количество всех успешных созданий заданий обновления двойников.|Нет|
|Успешные отмены заданий.|jobs.cancelJob.success|Count|Итог|Количество всех успешных вызовов для отмены заданий.|Нет|
|Успешные запросы заданий.|jobs.queryJobs.success|Count|Итог|Количество всех успешных вызовов для запроса заданий.|Нет|

Для метрик с **количеством** **единиц** , допустимым только статистическая обработка (SUM). Минимальное, максимальное и среднее число агрегатов всегда возвращают значение 1. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

### <a name="routing-metrics"></a>Метрики маршрутизации

|Отображаемое имя метрики|Метрика|Единицы|Тип статистической обработки|Описание|Измерения|
|---|---|---|---|---|---|
| Попытки доставки в маршрутизацию (Предварительная версия) |раутингделивериес | Count | Итог |Это метрика доставки маршрутизации. Используйте измерения, чтобы указать состояние доставки для определенной конечной точки или для конкретного источника маршрутизации.| Результат:<br>Раутингсаурце,<br>EndpointType<br>Фаилуререасонкатегори,<br>EndpointName<br>Дополнительные *сведения см. в разделе [измерения метрики](#metric-dimensions)*. |
| Размер данных доставки для маршрутизации в байтах (Предварительная версия)|раутингдатасизеинбитесделиверед| Байты | Итог |Общее число байтов, направляемых центром Интернета вещей в пользовательскую конечную точку и встроенную конечную точку. Используйте измерения, чтобы указать размер данных, направляемых в определенную конечную точку или для конкретного источника маршрутизации.| Раутингсаурце,<br>EndpointType<br>EndpointName<br>Дополнительные *сведения см. в разделе [измерения метрики](#metric-dimensions)*.|
| Задержка маршрутизации (Предварительная версия) |раутингделиверилатенци| Миллисекунды | Среднее |Это метрика задержки доставки маршрутизации. Используйте измерения, чтобы указать задержку для определенной конечной точки или для конкретного источника маршрутизации.| Раутингсаурце,<br>EndpointType<br>EndpointName<br>Дополнительные *сведения см. в разделе [измерения метрики](#metric-dimensions)*.|
|Routing: blobs delivered to storage (Маршрутизация: доставлено BLOB-объектов в хранилище)|d2c.Endpoints.egress.Storage.BLOBs|Count|Итог|Количество раз, когда подсистема маршрутизации Центра Интернета вещей доставила BLOB-объекты на конечные точки хранилища.|Нет|
|Routing: data delivered to storage (Маршрутизация: доставлено данных в хранилище)|d2c.endpoints.egress.storage.bytes|Байты|Итог|Объем данных (в байтах), доставленных подсистемой маршрутизации Центра Интернета вещей на конечные точки хранилища.|Нет|
|Routing: message latency for Event Hub (Маршрутизация: задержка сообщений для концентратора событий)|d2c.endpoints.latency.eventHubs|Миллисекунды|Среднее|Средняя задержка (в миллисекундах) между поступлением сообщения в центр Интернета вещей и входом сообщений в пользовательские конечные точки типа "концентратор событий". Это не относится к сообщениям, которые перенаправляются во встроенную конечную точку (события).|Нет|
|Routing: message latency for Service Bus Queue (Маршрутизация: задержка сообщений для очереди служебной шины)|d2c.endpoints.latency.serviceBusQueues|Миллисекунды|Среднее|Средняя задержка (в миллисекундах) между поступлением сообщения в центр Интернета вещей и входом сообщений в конечную точку очереди служебной шины.|Нет|
|Routing: message latency for Service Bus Topic (Маршрутизация: задержка сообщений для раздела служебной шины)|d2c.endpoints.latency.serviceBusTopics|Миллисекунды|Среднее|Средняя задержка (в миллисекундах) между поступлением сообщения в центр Интернета вещей и входом сообщений в конечную точку раздела служебной шины.|Нет|
|Routing: message latency for messages/events (Маршрутизация: задержка сообщений для messages/events)|d2c.endpoints.latency.builtIn.events|Миллисекунды|Среднее|Средняя задержка (в миллисекундах) между поступлением сообщения в центр Интернета вещей и поступлением сообщения во встроенную конечную точку (сообщения или события) и резервный маршрут.|Нет|
|Routing: message latency for storage (Маршрутизация: задержка сообщений для хранилища)|d2c.Endpoints.latency.Storage|Миллисекунды|Среднее|Средняя задержка (в миллисекундах) между поступлением сообщения в центр Интернета вещей и входом сообщений в конечную точку хранилища.|Нет|
|Routing: messages delivered to Event Hub (Маршрутизация: доставлено сообщений в концентратор событий)|d2c.endpoints.egress.eventHubs|Count|Итог|Количество успешно доставленных сообщений в пользовательские конечные точки концентратора событий при маршрутизации в центре Интернета вещей. Это не относится к сообщениям, которые перенаправляются во встроенную конечную точку (события).|Нет|
|Routing: messages delivered to Service Bus Queue (Маршрутизация: доставлено сообщений в очередь служебной шины)|d2c.endpoints.egress.serviceBusQueues|Count|Итог|Количество раз, когда подсистема маршрутизации Центра Интернета вещей успешно доставила сообщения на конечные точки очереди служебной шины.|Нет|
|Routing: messages delivered to Service Bus Topic (Маршрутизация: доставлено сообщений в раздел служебной шины)|d2c.endpoints.egress.serviceBusTopics|Count|Итог|Количество раз, когда подсистема маршрутизации Центра Интернета вещей успешно доставила сообщения на конечные точки раздела служебной шины.|Нет|
|Routing: messages delivered to fallback (Маршрутизация: доставлено сообщений на резервный маршрут)|d2c.telemetry.egress.fallback|Count|Итог|Количество раз, когда подсистема маршрутизации Центра Интернета вещей доставляла сообщения на конечную точку, связанную с резервным маршрутом.|Нет|
|Routing: messages delivered to messages/events (Маршрутизация: доставлено сообщений на конечную точку messages/events)|d2c.endpoints.egress.builtIn.events|Count|Итог|Количество успешно доставленных сообщений в встроенную конечную точку (сообщения или события) и резервный маршрут в службе маршрутизации центра Интернета вещей.|Нет|
|Routing: messages delivered to storage (Маршрутизация: доставлено сообщений в хранилище)|d2c.Endpoints.egress.Storage|Count|Итог|Количество раз, когда подсистема маршрутизации Центра Интернета вещей успешно доставила сообщения на конечные точки хранилища.|Нет|
|Routing: telemetry messages delivered (Маршрутизация: доставлено сообщений телеметрии)|d2c.telemetry.egress.success|Count|Итог|Количество раз, когда сообщения были успешно доставлены на все конечные точки с помощью маршрутизации Центра Интернета вещей. Если сообщение направляется на несколько конечных точек, это значение увеличивается на единицу для каждой успешной доставки. Если сообщение доставлено несколько раз на одну конечную точку, это значение увеличивается на единицу для каждой успешной доставки.|Нет|
|Routing: telemetry messages dropped (Маршрутизация: отброшено сообщений телеметрии) |d2c.telemetry.egress.dropped|Count|Итог|Количество раз, когда сообщения удалялись подсистемой маршрутизации Центра Интернета вещей из-за неработоспособности конечных точек. В этом значении не учитываются сообщения, доставленные через резервный маршрут, так как отброшенные сообщения туда не доставляются.|Нет|
|Routing: telemetry messages incompatible (Маршрутизация: несовместимых сообщений телеметрии)|d2c.telemetry.egress.invalid|Count|Итог|Количество раз, когда подсистеме маршрутизации Центра Интернета вещей не удалось доставить сообщения из-за несовместимости с конечной точкой. Сообщение несовместимо с конечной точкой, когда центр Интернета вещей пытается доставить сообщение в конечную точку и завершается с ошибкой, не являющейся временной. Недопустимые сообщения не повторяются повторно. В это значение не входят повторные попытки.|Нет|
|Routing: telemetry messages orphaned (Маршрутизация: потеряно сообщений телеметрии) |d2c.telemetry.egress.orphaned|Count|Итог|Количество случаев, когда маршрутизация сообщений была потеряна при маршрутизации центра Интернета вещей, так как они не совпали с каким-либо запросом маршрутизации, при отключенном резервном маршруте.|Нет|

Для метрик с **количеством** **единиц** , допустимым только статистическая обработка (SUM). Минимальное, максимальное и среднее число агрегатов всегда возвращают значение 1. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

### <a name="twin-query-metrics"></a>Метрики запросов двойника

|Отображаемое имя метрики|Метрика|Единицы|Тип статистической обработки|Описание|Измерения|
|---|---|---|---|---|---|
|Неудачные запросы двойников.|twinQueries.failure|Count|Итог|Количество всех неудачных запросов двойников.|Нет|
|Успешные запросы двойников.|twinQueries.success|Count|Итог|Число всех успешных запросов двойников.|Нет|
|Размер результатов запросов двойников.|twinQueries.resultSize|Байты|Среднее|Суммарный размер результатов всех успешных запросов двойника.|Нет|

Для метрик с **количеством** **единиц** , допустимым только статистическая обработка (SUM). Минимальное, максимальное и среднее число агрегатов всегда возвращают значение 1. Дополнительные сведения см. в разделе [Поддерживаемые агрегаты](#supported-aggregations).

## <a name="metric-dimensions"></a>Измерения метрик

Центр Интернета вещей Azure имеет следующие измерения, связанные с некоторыми метриками маршрутизации и сетки событий.

|Название измерения | Описание|
|---|---|
||
|**EndpointName**| Имя конечной точки.|
|**EndpointType**|Один из следующих элементов: **eventHubs**, **сервицебускуеуес**, **cosmosDB**, **сервицебустопикс**. **Builtin** или **блобстораже**.|
|**EventType**| Один из следующих типов событий сетки событий: **Microsoft. Devices. девицекреатед**. **Microsoft. Devices. девицеделетед**, **Microsoft. Devices. девицеконнектед**, **Microsoft. Devices. девицедисконнектед** или **Microsoft. Devices. девицетелеметри**. Дополнительные сведения см. в разделе [типы событий](iot-hub-event-grid.md#event-types).|
|**фаилуререасонкатегори**| Один из следующих элементов: **Недопустимый**, **Удаленный**, **потерянный** или **null**.|
|**Результат**| **Успех** или **Неудача**.|
|**раутингсаурце**| Сообщения устройства<br>События изменения двойника<br>События жизненного цикла устройства|

Дополнительные сведения об измерениях метрик см. в разделе [многомерные метрики](../azure-monitor/platform/data-platform-metrics.md#multi-dimensional-metrics).

## <a name="resource-logs"></a>Журналы ресурсов

В этом разделе перечислены все типы категорий и схемы журнала ресурсов, собранные для центра Интернета вещей Azure. Поставщик ресурсов и тип для всех журналов центра Интернета вещей — [Microsoft. Devices/IotHubs](../azure-monitor/platform/resource-logs-categories.md#microsoftdevicesiothubs).

**Темы в этом разделе**

- [Соединения](#connections)
- [Телеметрия устройства](#device-telemetry)
- [Отправка команд из облака на устройство](#cloud-to-device-commands)
- [Операции с удостоверениями устройства](#device-identity-operations)
- [Операции отправки файлов](#file-upload-operations)
- [Маршруты](#routes)
- [Операции переноса с двойника устройства в облако](#device-to-cloud-twin-operations)
- [Операции переноса из облака на двойник устройства](#cloud-to-device-twin-operations)
- [Запросы двойника](#twin-queries)
- [Операции заданий](#jobs-operations)
- [Прямые методы](#direct-methods)
- [Распределенная трассировка (предварительная версия)](#distributed-tracing-preview)
  - [Журналы D2C (с устройства в облако) в Центре Интернета вещей](#iot-hub-d2c-device-to-cloud-logs)
  - [Журналы входящего трафика Центра Интернета вещей](#iot-hub-ingress-logs)
  - [Журналы исходящего трафика Центра Интернета вещей](#iot-hub-egress-logs)
- [Конфигурации](#configurations)
- [Потоки устройств (Предварительная версия)](#device-streams-preview)

### <a name="connections"></a>Соединения

Категория соединений отслеживает устройство, которое соединяет и отключает события из центра IoT, а также ошибки. Эта категория полезна для отслеживания несанкционированных попыток подключения и получения оповещений при потере подключения к устройствам.

> [!NOTE]
> Чтобы убедиться в состоянии надежного подключения устройств, проверьте [пульс устройства](iot-hub-devguide-identity-registry.md#device-heartbeat).

```json
{
   "records":
   [
        {
            "time": " UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "deviceConnect",
            "category": "Connections",
            "level": "Information",
            "properties": "{\"deviceId\":\"<deviceId>\",\"sdkVersion\":\"<sdkVersion>\",\"protocol\":\"<protocol>\",\"authType\":\"{\\\"scope\\\":\\\"device\\\",\\\"type\\\":\\\"sas\\\",\\\"issuer\\\":\\\"iothub\\\",\\\"acceptingIpFilterRule\\\":null}\",\"maskedIpAddress\":\"<maskedIpAddress>\"}",
            "location": "Resource location"
        }
    ]
}
```

### <a name="device-telemetry"></a>Телеметрия устройства

Категория телеметрии устройств отслеживает ошибки, которые возникают в центре IoT и связаны с конвейером телеметрии. В эту категорию входят ошибки, возникающие при отправке событий телеметрии (например: регулирование) и при получении событий телеметрии (например: неавторизованный модуль чтения). Эта категория не может перехватывать ошибки, которые вызваны кодом, выполняемым на самом устройстве.

```json
{
    "records":
    [
        {
            "time": "UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "ingress",
            "category": "DeviceTelemetry",
            "level": "Error",
            "resultType": "Event status",
            "resultDescription": "MessageDescription",
            "properties": "{\"deviceId\":\"<deviceId>\",\"batching\":\"0\",\"messageSizeInBytes\":\"<messageSizeInBytes>\",\"EventProcessedUtcTime\":\"<UTC timestamp>\",\"EventEnqueuedUtcTime\":\"<UTC timestamp>\",\"partitionId\":\"1\"}", 
            "location": "Resource location"
        }
    ]
}
```

### <a name="cloud-to-device-commands"></a>Отправка команд из облака на устройство

Категория отправки команд из облака на устройство отслеживает ошибки, которые возникают в Центре Интернета вещей и связаны с конвейером сообщений из облака на устройство. В эту категорию входят ошибки, возникающие в следующих ситуациях:

* отправка сообщений из облака на устройство (например, ошибка неавторизированного отправителя);
* получение сообщений из облака на устройство (например, ошибки превышения количества доставляемых сообщений);
* получение ответов на сообщение из облака на устройство (например, ошибки истечения срока действия для отзыва).

Эта категория не перехватывает ошибки, если сообщение из облака на устройстве было успешно доставлено, но неправильно обработано на устройстве.

```json
{
    "records":
    [
        {
            "time": " UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "messageExpired",
            "category": "C2DCommands",
            "level": "Error",
            "resultType": "Event status",
            "resultDescription": "MessageDescription",
            "properties": "{\"deviceId\":\"<deviceId>\",\"messageId\":\"<messageId>\",\"messageSizeInBytes\":\"<messageSize>\",\"protocol\":\"Amqp\",\"deliveryAcknowledgement\":\"<None, NegativeOnly, PositiveOnly, Full>\",\"deliveryCount\":\"0\",\"expiryTime\":\"<timestamp>\",\"timeInSystem\":\"<timeInSystem>\",\"ttl\":<ttl>, \"EventProcessedUtcTime\":\"<UTC timestamp>\",\"EventEnqueuedUtcTime\":\"<UTC timestamp>\", \"maskedIpAddress\": \"<maskedIpAddress>\", \"statusCode\": \"4XX\"}",
            "location": "Resource location"
        }
    ]
}
```

### <a name="device-identity-operations"></a>Операции с удостоверениями устройства

Категория операций с удостоверениями устройств отслеживает ошибки, возникающие, когда вы пытаетесь создать, обновить или удалить запись реестра удостоверений центра IoT. Отслеживание этой категории целесообразно для сценариев подготовки.

```json
{
    "records":
    [
        {
            "time": "UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "get",
            "category": "DeviceIdentityOperations",
            "level": "Error",
            "resultType": "Event status",
            "resultDescription": "MessageDescription",
            "properties": "{\"maskedIpAddress\":\"<maskedIpAddress>\",\"deviceId\":\"<deviceId>\", \"statusCode\":\"4XX\"}",
            "location": "Resource location"
        }
    ]
}
```

### <a name="file-upload-operations"></a>Операции отправки файлов

Категория передачи файлов позволяет отслеживать ошибки, которые возникают в центре IoT и связаны с функцией передачи файлов. В эту категорию входят:

* ошибки, связанные с универсальным кодом ресурса (URI) SAS (например, если срок его действия истекает до того, как устройство уведомит центр о завершении передачи);

* сбои передач, о которых сообщает устройство;

* ошибки, связанные с отсутствием файла в хранилище при создании уведомления для Центра Интернета вещей.

Обратите внимание, что эта категория не может перехватывать ошибки, которые возникают, когда устройство непосредственно передает файл в хранилище.

```json
{
    "records":
    [
        {
            "time": "UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "ingress",
            "category": "FileUploadOperations",
            "level": "Error",
            "resultType": "Event status",
            "resultDescription": "MessageDescription",
            "durationMs": "1",
            "properties": "{\"deviceId\":\"<deviceId>\",\"protocol\":\"<protocol>\",\"authType\":\"{\\\"scope\\\":\\\"device\\\",\\\"type\\\":\\\"sas\\\",\\\"issuer\\\":\\\"iothub\\\",\\\"acceptingIpFilterRule\\\":null}\",\"blobUri\":\"http//bloburi.com\"}",
            "location": "Resource location"
        }
    ]
}
```

### <a name="routes"></a>Маршруты

Категория [Маршрутизация сообщений](./iot-hub-devguide-messages-d2c.md) отслеживает ошибки, происходящие во время оценки маршрута сообщения и работоспособности конечной точки, как показано в центре Интернета вещей. В эту категорию входят такие события, как:

* правило возвращает значение "не определено";
* Центр Интернета вещей помечает конечную точку как неработоспособную;
* любые ошибки, полученные от конечной точки.

Эта категория не содержит конкретных ошибок, связанных с самими сообщениями (например, ошибки регулирования устройств), которые попадают в категорию "телеметрия устройств".

```json
{
    "records":
    [
        {
            "time":"2019-12-12T03:25:14Z",
            "resourceId":"/SUBSCRIPTIONS/91R34780-3DEC-123A-BE2A-213B5500DFF0/RESOURCEGROUPS/ANON-TEST/PROVIDERS/MICROSOFT.DEVICES/IOTHUBS/ANONHUB1",
            "operationName":"endpointUnhealthy",
            "category":"Routes",
            "level":"Error",
            "resultType":"403004",
            "resultDescription":"DeviceMaximumQueueDepthExceeded",
            "properties":"{\"deviceId\":null,\"endpointName\":\"anon-sb-1\",\"messageId\":null,\"details\":\"DeviceMaximumQueueDepthExceeded\",\"routeName\":null,\"statusCode\":\"403\"}",
            "location":"westus"
        }
    ]
}
```

Ниже приведены дополнительные сведения о журналах ресурсов маршрутизации.

* [Список кодов ошибок в журнале ресурсов маршрутизации](troubleshoot-message-routing.md#diagnostics-error-codes)
* [Список журналов ресурсов маршрутизации Оператионнамес](troubleshoot-message-routing.md#diagnostics-operation-names)

### <a name="device-to-cloud-twin-operations"></a>Операции переноса с двойника устройства в облако

Категория операций переноса с двойника устройства в облако отслеживает события, инициируемые устройством на двойниках устройства. Эти операции могут включать получение двойника, обновление сообщаемых свойств и подписку на необходимые свойства.

```json
{
    "records":
    [
        {
            "time": "UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "update",
            "category": "D2CTwinOperations",
            "level": "Information",
            "durationMs": "1",
            "properties": "{\"deviceId\":\"<deviceId>\",\"protocol\":\"<protocol>\",\"authenticationType\":\"{\\\"scope\\\":\\\"device\\\",\\\"type\\\":\\\"sas\\\",\\\"issuer\\\":\\\"iothub\\\",\\\"acceptingIpFilterRule\\\":null}\"}",
            "location": "Resource location"
        }
    ]
}
```

### <a name="cloud-to-device-twin-operations"></a>Операции переноса из облака на двойник устройства

Категория операций переноса из облака на двойник устройства отслеживает события, инициируемые службой, на двойнике устройства. Эти операции могут включать получение двойника, обновление или замещение тегов и необходимых свойств.

```json
{
    "records":
    [
        {
            "time": "UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "read",
            "category": "C2DTwinOperations",
            "level": "Information",
            "durationMs": "1",
            "properties": "{\"deviceId\":\"<deviceId>\",\"sdkVersion\":\"<sdkVersion>\",\"messageSize\":\"<messageSize>\"}",
            "location": "Resource location"
        }
    ]
}
```

### <a name="twin-queries"></a>запросы к двойникам;

Категория запросов к двойникам сообщает о запросах к двойникам устройств, инициируемых в облаке.

```json
{
    "records":
    [
        {
            "time": "UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "query",
            "category": "TwinQueries",
            "level": "Information",
            "durationMs": "1",
            "properties": "{\"query\":\"<twin query>\",\"sdkVersion\":\"<sdkVersion>\",\"messageSize\":\"<messageSize>\",\"pageSize\":\"<pageSize>\", \"continuation\":\"<true, false>\", \"resultSize\":\"<resultSize>\"}",
            "location": "Resource location"
        }
    ]
}
```

### <a name="jobs-operations"></a>Операции заданий

Категория операций заданий сообщает о запросах задания по обновлению двойников устройства или вызову прямого метода на нескольких устройствах. Эти запросы инициируются в облаке.

```json
{
    "records":
    [
        {
            "time": "UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "jobCompleted",
            "category": "JobsOperations",
            "level": "Information",
            "durationMs": "1",
            "properties": "{\"jobId\":\"<jobId>\", \"sdkVersion\": \"<sdkVersion>\",\"messageSize\": <messageSize>,\"filter\":\"DeviceId IN ['1414ded9-b445-414d-89b9-e48e8c6285d5']\",\"startTimeUtc\":\"Wednesday, September 13, 2017\",\"duration\":\"0\"}",
            "location": "Resource location"
        }
    ]
}
```

### <a name="direct-methods"></a>Прямые методы

Категория прямых методов отслеживает взаимодействия типа "запрос — ответ", отправленные на отдельные устройства. Эти запросы инициируются в облаке.

```json
{
    "records":
    [
        {
            "time": "UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "send",
            "category": "DirectMethods",
            "level": "Information",
            "durationMs": "1",
            "properties": "{\"deviceId\":<messageSize>, \"RequestSize\": 1, \"ResponseSize\": 1, \"sdkVersion\": \"2017-07-11\"}",
            "location": "Resource location"
        }
    ]
}
```

### <a name="distributed-tracing-preview"></a>Распределенная трассировка (предварительная версия)

Категория распределенной трассировки позволяет отследить идентификаторы корреляции для сообщений, содержащих заголовок контекста трассировки. Чтобы полностью включить эти журналы, код на стороне клиента должен быть обновлен путем [анализа и диагностики приложений IOT в полной мере с помощью распределенной трассировки центра Интернета вещей (Предварительная версия)](iot-hub-distributed-tracing.md).

Обратите внимание, что `correlationId` соответствует предложению [контекста трассировки W3C](https://github.com/w3c/trace-context) , где оно содержит, `trace-id` а также `span-id` .

#### <a name="iot-hub-d2c-device-to-cloud-logs"></a>Журналы D2C (с устройства в облако) в Центре Интернета вещей

В Центре Интернета вещей в этот журнал записывается информация при получении сообщения, содержащего допустимые свойства трассировки.

```json
{
    "records":
    [
        {
            "time": "UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "DiagnosticIoTHubD2C",
            "category": "DistributedTracing",
            "correlationId": "00-8cd869a412459a25f5b4f31311223344-0144d2590aacd909-01",
            "level": "Information",
            "resultType": "Success",
            "resultDescription":"Receive message success",
            "durationMs": "",
            "properties": "{\"messageSize\": 1, \"deviceId\":\"<deviceId>\", \"callerLocalTimeUtc\": : \"2017-02-22T03:27:28.633Z\", \"calleeLocalTimeUtc\": \"2017-02-22T03:27:28.687Z\"}",
            "location": "Resource location"
        }
    ]
}
```

В этом случае `durationMs` не подсчитывается, так как часы Центра Интернета вещей могут быть не синхронизированы с часами устройства, из-за чего расчет длительности может давать ошибочные результаты. Рекомендуется создавать логику с использованием метки времени в разделе `properties`, чтобы записывать пики задержки соединения устройства с облаком.

| Свойство | Тип | Описание |
|--------------------|-----------------------------------------------|------------------------------------------------------------------------------------------------|
| **messageSize** | Целое число | Размер сообщения, поступающего с устройства в облако, в байтах |
| **deviceId** | Строка 7-битовых букв и цифр ASCII | Удостоверение устройства |
| **callerLocalTimeUtc** | Метка времени в формате UTC | Время создания сообщения, измеренное локальными часами устройства |
| **calleeLocalTimeUtc** | Метка времени в формате UTC | Время поступления сообщения в шлюз Центра Интернета вещей, измеренное часами на стороне службы Центра Интернета вещей |

#### <a name="iot-hub-ingress-logs"></a>Журналы входящего трафика Центра Интернета вещей

В Центре Интернета вещей в этом журнале фиксируется информация, когда сообщение, содержащее допустимые свойства трассировки записывается во внутренний или встроенный концентратор событий.

```json
{
    "records":
    [
        {
            "time": "UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "DiagnosticIoTHubIngress",
            "category": "DistributedTracing",
            "correlationId": "00-8cd869a412459a25f5b4f31311223344-349810a9bbd28730-01",
            "level": "Information",
            "resultType": "Success",
            "resultDescription":"Ingress message success",
            "durationMs": "10",
            "properties": "{\"isRoutingEnabled\": \"true\", \"parentSpanId\":\"0144d2590aacd909\"}",
            "location": "Resource location"
        }
    ]
}
```

В `properties` разделе этот журнал содержит дополнительные сведения о входящих сообщениях.

| Свойство | Тип | Описание |
|--------------------|-----------------------------------------------|------------------------------------------------------------------------------------------------|
| **isRoutingEnabled** | Строка | Значение true или false показывает, включена ли маршрутизация сообщений в Центре Интернета вещей |
| **parentSpanId** | Строка | [Span-id](https://w3c.github.io/trace-context/#parent-id) родительского сообщения, которое в этом случае является трассировкой сообщения, передаваемого из устройства в облако (D2C) |

#### <a name="iot-hub-egress-logs"></a>Журналы исходящего трафика Центра Интернета вещей

В Центре Интернета вещей в этом журнале фиксируется информация, когда включена [маршрутизация](iot-hub-devguide-messages-d2c.md) и сообщение записывается для [конечной точки](iot-hub-devguide-endpoints.md). Если маршрутизация не включена, в Центре Интернета вещей не фиксируется информация в этом журнале.

```json
{
    "records":
    [
        {
            "time": "UTC timestamp",
            "resourceId": "Resource Id",
            "operationName": "DiagnosticIoTHubEgress",
            "category": "DistributedTracing",
            "correlationId": "00-8cd869a412459a25f5b4f31311223344-98ac3578922acd26-01",
            "level": "Information",
            "resultType": "Success",
            "resultDescription":"Egress message success",
            "durationMs": "10",
            "properties": "{\"endpointType\": \"EventHub\", \"endpointName\": \"myEventHub\", \"parentSpanId\":\"349810a9bbd28730\"}",
            "location": "Resource location"
        }
    ]
}
```

В `properties` разделе этот журнал содержит дополнительные сведения о входящих сообщениях.

| Свойство | Тип | Описание |
|--------------------|-----------------------------------------------|------------------------------------------------------------------------------------------------|
| **endpointName** | Строка | Имя конечной точки маршрутизации |
| **endpointType** | Строка | Тип конечной точки маршрутизации |
| **parentSpanId** | Строка | [Span-id](https://w3c.github.io/trace-context/#parent-id) родительского сообщения, которое в этом случае является трассировкой сообщения входящего трафика Центра Интернета вещей |

### <a name="configurations"></a>Конфигурации

Журналы конфигурации центра Интернета вещей записывают события и ошибки для набора функций автоматического управления устройствами.

```json
{
    "records":
    [
         {
             "time": "2019-09-24T17:21:52Z",
             "resourceId": "Resource Id",
             "operationName": "ReadManyConfigurations",
             "category": "Configurations",
             "resultType": "",
             "resultDescription": "",
             "level": "Information",
             "durationMs": "17",
             "properties": "{\"configurationId\":\"\",\"sdkVersion\":\"2018-06-30\",\"messageSize\":\"0\",\"statusCode\":null}",
             "location": "southcentralus"
         }
    ]
}
```

### <a name="device-streams-preview"></a>Потоки устройств (Предварительная версия)

Категория "потоки устройств" отслеживает взаимодействия "запрос-ответ", отправляемые на отдельные устройства.

```json
{
    "records":
    [
         {
             "time": "2019-09-19T11:12:04Z",
             "resourceId": "Resource Id",
             "operationName": "invoke",
             "category": "DeviceStreams",
             "resultType": "",
             "resultDescription": "",    
             "level": "Information",
             "durationMs": "74",
             "properties": "{\"deviceId\":\"myDevice\",\"moduleId\":\"myModule\",\"sdkVersion\":\"2019-05-01-preview\",\"requestSize\":\"3\",\"responseSize\":\"5\",\"statusCode\":null,\"requestName\":\"myRequest\",\"direction\":\"c2d\"}",
             "location": "Central US"
         }
    ]
}
```

## <a name="azure-monitor-logs-tables"></a>Таблицы журналов Azure Monitor
<!-- REQUIRED. Please keep heading in this order -->

В этом разделе приведутся ссылки на все Azure Monitor журналы Kusto таблицы, относящиеся к центру Интернета вещей Azure и доступные для запроса Log Analytics. Список этих таблиц и ссылки на дополнительные сведения о типе ресурсов центра Интернета вещей см. в разделе Справочник по журналам Azure Monitor в [центре Интернета вещей](/azure/azure-monitor/reference/tables/tables-resourcetype#iot-hub) .

Ссылки на все Azure Monitor журналы и Log Analytics таблицы см. в [справочнике по таблицам журнала Azure Monitor](/azure/azure-monitor/reference/tables/tables-resourcetype).

## <a name="see-also"></a>См. также:

* Описание мониторинга центра Интернета вещей Azure см. в статье [мониторинг центра Интернета вещей](monitor-iot-hub.md) Azure.
* Подробные сведения о мониторинге ресурсов Azure см. в статье [Мониторинг ресурсов Azure с помощью Azure Monitor](../azure-monitor/insights/monitor-azure-resource.md).