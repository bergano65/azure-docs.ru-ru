---
title: Поддержка протокола TLS в Центре Интернета вещей Azure
description: Сведения об использовании защищенных TLS-подключений для устройств и служб, взаимодействующих с центром Интернета вещей
services: iot-hub
author: jlian
ms.service: iot-fundamentals
ms.topic: conceptual
ms.date: 11/25/2020
ms.author: jlian
ms.openlocfilehash: ddb89f60c9fe380012c299afaafb6046bf6849c9
ms.sourcegitcommit: c4246c2b986c6f53b20b94d4e75ccc49ec768a9a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2020
ms.locfileid: "96602756"
---
# <a name="transport-layer-security-tls-support-in-iot-hub"></a>Поддержка протокола TLS в центре Интернета вещей

Центр Интернета вещей использует протокол TLS для защиты подключений от устройств и служб Интернета вещей. Сейчас поддерживаются три версии протокола TLS: 1.0, 1.1 и 1.2.

Протоколы TLS 1.0 и 1.1 считаются устаревшими, и в будущем их использование будет прекращено. Дополнительные сведения см. в статье [Устаревшие протоколы TLS 1.0 и 1.1 для центра Интернета вещей](iot-hub-tls-deprecating-1-0-and-1-1.md). Чтобы избежать будущих проблем, используйте TLS 1,2 в качестве единственной версии TLS при подключении к центру Интернета вещей.

## <a name="iot-hubs-server-tls-certificate"></a>Сертификат TLS сервера центра Интернета вещей

Во время подтверждения TLS центр Интернета вещей предоставляет сертификаты сервера с ключом RSA для подключения клиентов. Его корневым центром сертификации является корневой ЦС Baltimore CyberTrust. Недавно были внесены изменения в издатели новыми промежуточными центрами сертификации (ИКАС). Дополнительные сведения см. в [статье обновление сертификата TLS центра Интернета вещей](https://azure.microsoft.com/updates/iot-hub-tls-certificate-update/) .

### <a name="elliptic-curve-cryptography-ecc-server-tls-certificate-preview"></a>Сертификат TLS сервера шифрования на основе эллиптических кривых (ECC) (Предварительная версия)

Сертификат TLS сервера ECC центра Интернета вещей доступен для общедоступной предварительной версии. При такой же безопасности, как и для сертификатов RSA, проверка сертификата ECC (с комплектами шифров, поддерживающими только код коррекции ошибок), использует до 40% меньшего количества вычислений, памяти и пропускной способности. Эта экономия важна для устройств IoT из-за небольших профилей и памяти, а также для поддержки вариантов использования в ограниченной пропускной способности сети. 

Предварительный просмотр сертификата сервера ECC центра Интернета вещей:

1. [Создание нового центра Интернета вещей с режимом предварительного просмотра в](iot-hub-preview-mode.md).
1. [Настройте клиент](#tls-configuration-for-sdk-and-iot-edge) так, чтобы он включал *только* наборы шифров ECDSA и не *исключая* RSA. Ниже приведены комплекты шифров для общедоступной предварительной версии сертификата ECC:
    - `TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256`
    - `TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384`
    - `TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256`
    - `TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384`
1. Подключите клиент к центру Интернета вещей предварительной версии.

## <a name="tls-12-enforcement-available-in-select-regions"></a>Принудительное применение TLS 1,2 доступно в выбранных регионах

Для повышения безопасности настройте центры Интернета вещей, разрешающие *только* подключения клиентов, использующие TLS версии 1,2, и принудительное использование комплектов [шифров](#cipher-suites). Эта функция поддерживается только в следующих регионах:

* Восточная часть США
* Центрально-южная часть США
* западная часть США 2
* US Gov (Аризона)
* US Gov (Вирджиния)

Для этой цели подготовьте новый Центр Интернета вещей в любом из поддерживаемых регионов и задайте для свойства `minTlsVersion` значение `1.2` в спецификации ресурса Центра Интернета вещей в шаблоне Azure Resource Manager:

```json
{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Devices/IotHubs",
            "apiVersion": "2020-01-01",
            "name": "<provide-a-valid-resource-name>",
            "location": "<any-of-supported-regions-below>",
            "properties": {
                "minTlsVersion": "1.2"
            },
            "sku": {
                "name": "<your-hubs-SKU-name>",
                "tier": "<your-hubs-SKU-tier>",
                "capacity": 1
            }
        }
    ]
}
```

Созданный с такой конфигурацией ресурс Центра Интернета вещей будет отклонять попытки подключения от устройств и служб с использованием TLS версий 1.0 и 1.1. Аналогичным образом, подтверждение TLS отклоняется, если в `ClientHello` сообщении не перечислены [рекомендованные шифры](#cipher-suites).

> [!NOTE]
> Свойство `minTlsVersion` доступно только для чтения. После создания ресурса Центра Интернета вещей изменить это свойство нельзя. Поэтому важно заранее убедиться, что *все* ваши устройства и службы Интернета вещей совместимы с TLS 1.2 и [рекомендуемыми шифрами](#cipher-suites).
> 
> После отработки отказа свойство `minTlsVersion` Центра Интернета вещей останется в силе в регионе, географически связанном с исходным.

## <a name="cipher-suites"></a>Комплекты шифров

Центры Интернета вещей, настроенные на прием только TLS 1,2, также будут применять следующие Рекомендуемые комплекты шифров:

* `TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256`
* `TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384`
* `TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256`
* `TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384`

Для центров Интернета вещей, для которых не настроено принудительное применение TLS 1,2, TLS 1,2 по-прежнему работает со следующими комплектами шифров:

* `TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256`
* `TLS_DHE_RSA_WITH_AES_256_GCM_SHA384`
* `TLS_DHE_RSA_WITH_AES_128_GCM_SHA256`
* `TLS_RSA_WITH_AES_256_GCM_SHA384`
* `TLS_RSA_WITH_AES_128_GCM_SHA256`
* `TLS_RSA_WITH_AES_256_CBC_SHA256`
* `TLS_RSA_WITH_AES_128_CBC_SHA256`
* `TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA`
* `TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA`
* `TLS_RSA_WITH_AES_256_CBC_SHA`
* `TLS_RSA_WITH_AES_128_CBC_SHA`
* `TLS_RSA_WITH_3DES_EDE_CBC_SHA`

Клиент может предложить список более высоких комплектов шифров для использования во время `ClientHello` . Однако некоторые из них могут не поддерживаться центром Интернета вещей (например, `ECDHE-ECDSA-AES256-GCM-SHA384` ). В этом случае центр Интернета вещей попытается выполнить предпочтение клиента, но в конечном итоге согласовывать комплект шифров с `ServerHello` .

## <a name="tls-configuration-for-sdk-and-iot-edge"></a>Конфигурация TLS для пакета SDK и IoT Edge

Используйте приведенные ниже ссылки, чтобы настроить TLS 1.2 и разрешенные шифры в пакетах SDK для клиента Центра Интернета вещей.

| Язык | Версии, поддерживающие TLS 1.2 | Документация |
|----------|------------------------------------|---------------|
| C        | Тег 2019-12-11 или более новый            | [Ссылка](https://aka.ms/Tls_C_SDK_IoT) |
| Python   | Версия 2.0.0 или более новая             | [Ссылка](https://aka.ms/Tls_Python_SDK_IoT) |
| C#       | Версия 1.21.4 или более новая            | [Ссылка](https://aka.ms/Tls_CSharp_SDK_IoT) |
| Java     | Версия 1.19.0 или более новая            | [Ссылка](https://aka.ms/Tls_Java_SDK_IoT) |
| Node.js   | Версия 1.12.2 или более новая            | [Ссылка](https://aka.ms/Tls_Node_SDK_IoT) |

Устройства IoT Edge можно настроить для использования TLS 1.2 при обмене данными с Центром Интернета вещей. Дополнительные сведения см. [на странице документации IoT Edge](https://github.com/Azure/iotedge/blob/master/edge-modules/edgehub-proxy/README.md).

## <a name="device-authentication"></a>Проверка подлинности устройства

После успешного подтверждения TLS центр Интернета вещей может проверить подлинность устройства с помощью симметричного ключа или сертификата X. 509. Для проверки подлинности на основе сертификата это может быть любой сертификат X. 509, включая ECC. Центр Интернета вещей проверяет сертификат по отпечатку или предоставленному центру сертификации. Дополнительные сведения см. в разделе [Поддерживаемые сертификаты X. 509](iot-hub-devguide-security.md#supported-x509-certificates).

## <a name="tls-maximum-fragment-length-negotiation-preview"></a>Согласование максимальной длины фрагмента TLS (Предварительная версия)

Центр Интернета вещей также поддерживает согласование максимальной длины фрагмента TLS, которое иногда называют согласованием размера кадра TLS. Эта функция предоставляется в общедоступной предварительной версии. 

Используйте эту функцию, чтобы указать максимальную длину фрагмента в виде обычного текста, значение которого меньше значения по умолчанию 2 ^ 14 байт. После согласования центр Интернета вещей и клиент начинают Фрагментирование сообщений, чтобы убедиться, что все фрагменты меньше согласованной длины. Такое поведение полезно для вычислений или устройств с ограниченным объемом памяти. Дополнительные сведения см. в [официальной спецификации расширения TLS](https://tools.ietf.org/html/rfc6066#section-4).

Официальная поддержка пакета SDK для этой общедоступной предварительной версии пока недоступна. Начало работы

1. [Создание нового центра Интернета вещей с режимом предварительного просмотра в](iot-hub-preview-mode.md).
1. Настройте клиент для установки `SSL_CTX_set_tlsext_max_fragment_length` одного из следующих значений: 2 ^ 9, 2 ^ 10, 2 ^ 11 и 2 ^ 12.
1. Подключите клиент к центру Интернета вещей предварительной версии.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о безопасности центра Интернета вещей и управлении доступом см. в статье [Управление доступом к центру Интернета вещей](iot-hub-devguide-security.md).
- Дополнительные сведения об использовании сертификата X509 для проверки подлинности устройства см. в статье [Проверка подлинности устройства с помощью сертификатов ЦС X. 509](iot-hub-x509ca-overview.md) .