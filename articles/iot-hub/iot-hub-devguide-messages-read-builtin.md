---
title: Общие сведения о встроенной конечной точке Центра Интернета вещей Azure | Документация Майкрософт
description: В этом руководстве разработчика описано, как читать сообщения, отправляемые с устройства в облако, с помощью встроенной конечной точки, совместимой с концентратором событий.
author: wesmc7777
manager: philmea
ms.author: wesmc
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 06/01/2020
ms.custom: amqp
ms.openlocfilehash: a7ab796ddd35ebe9b9c43509d8e3c2f4c41625c8
ms.sourcegitcommit: 124f7f699b6a43314e63af0101cd788db995d1cb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/08/2020
ms.locfileid: "86084003"
---
# <a name="read-device-to-cloud-messages-from-the-built-in-endpoint"></a>Чтение сообщений, пересылаемых с устройства в облако, из встроенной конечной точки

По умолчанию сообщения направляются во встроенную конечную точку, доступную для службы ( **/messages/events**), которая совместима с [Центрами событий](https://azure.microsoft.com/documentation/services/event-hubs/). Сейчас эта конечная точка предоставляется только по протоколу [AMQP](https://www.amqp.org/) на порте 5671. Центр Интернета вещей позволяет управлять встроенной конечной точкой обмена сообщениями **messages/events**, совместимой с концентраторами событий, с помощью приведенных ниже свойств.

| Свойство            | Описание |
| ------------------- | ----------- |
| **Количество секций** | Это свойство задается во время создания, чтобы определить количество [разделов](../event-hubs/event-hubs-features.md#partitions) для приема событий, отправляемых с устройства в облако. |
| **Время хранения**  | Это свойство задает время в днях, в течение которого сообщения хранятся в Центре Интернета вещей. Значение по умолчанию — один день, но это значение можно увеличить до семи дней. |

Центр Интернета вещей позволяет хранить данные во встроенных Центрах событий не более 7 дней. Время хранения можно задать во время создания вашего Центра Интернета вещей. Время хранения данных в Центре Интернета вещей зависит от уровня вашего Центра Интернета вещей и типа единицы. Что касается размера, встроенные Центры событий могут сохранять сообщения максимального размера по крайней мере до 24 часов из квоты. Например, для 1 единицы ценой S1 Центр Интернета вещей предоставляет достаточно памяти для хранения не менее 400К сообщений размером 4К каждое. Если ваши устройства отправляют сообщения меньшего размера, они могут храниться дольше (до 7 дней), в зависимости от того, сколько места занято. Мы гарантируем сохранение данных как минимум в течение указанного времени хранения. По окончании времени хранения срок сообщений истекает, и они не будут доступны. 

Центр Интернета вещей также предоставляет возможность управлять группами потребителей во встроенной конечной точке, которая получает сообщения, отправляемые с устройства в облако. У вас может быть до 20 групп потребителей на каждый Центр Интернета вещей.

Если вы используете [маршрутизацию сообщений](iot-hub-devguide-messages-d2c.md) и [резервный маршрут](iot-hub-devguide-messages-d2c.md#fallback-route) включен, то все сообщения, которые не соответствуют запросу в любом маршруте, поступают во встроенную конечную точку. Если отключить этот резервный маршрут, то сообщения, которые не соответствуют никакому запросу, будут удаляться.

Период хранения можно изменить на [портале Azure](https://portal.azure.com) или программно (с помощью [интерфейсов REST API поставщика ресурсов Центра Интернета вещей](/rest/api/iothub/iothubresource)).

Центр Интернета вещей предоставляет встроенную конечную точку **messages/events**, с помощью которой внутренние службы считывают сообщения, отправляемые в Центр с устройства в облако. Эта конечная точка совместима с концентраторами событий, поэтому можно использовать любой из механизмов для чтения сообщений, который поддерживает служба "Центры событий".

## <a name="read-from-the-built-in-endpoint"></a>Считывание данных из встроенной конечной точки

Некоторые интеграции продуктов и пакеты SDK Центров событий осведомлены о Центре Интернета вещей и позволяют использовать строку подключения к службе Центра Интернета вещей для подключения к встроенной конечной точке.

При использовании пакетов SDK Центров событий или интеграций продуктов, которые не осведомлены о Центре Интернета вещей, вам потребуется конечная точка, совместимая с Центрами событий, и имя, совместимое с Центрами событий. Вы можете получить эти значения на портале следующим образом.

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к своему Центру Интернета вещей.

2. Щелкните **Встроенные конечные точки**.

3. В разделе **События** содержатся следующие значения: **Partitions** (Разделы), **Event Hub-compatible name** (Имя, совместимое с Центрами событий), **Event Hub-compatible endpoint** (Конечная точка, совместимая с Центрами событий), **Retention time** (Время хранения) и **Consumer groups** (Группы потребителей).

    ![Параметры отправки сообщений с устройства в облако](./media/iot-hub-devguide-messages-read-builtin/eventhubcompatible.png)

На портале в поле конечной точки, совместимой с Центрами событий, содержится полная строка подключения к Центрам событий, которая выглядит следующим образом: **Endpoint=sb://abcd1234namespace.servicebus.windows.net/;SharedAccessKeyName=iothubowner;SharedAccessKey=keykeykeykeykeykey=;EntityPath=iothub-ehub-abcd-1234-123456**. Используемому вами пакету SDK могут требоваться другие значения, которые перечислены ниже.

| Имя | Значение |
| ---- | ----- |
| Конечная точка | sb://abcd1234namespace.servicebus.windows.net/ |
| Имя узла | abcd1234namespace.servicebus.windows.net |
| Пространство имен | abcd1234namespace |

Затем можно выбрать любую политику общего доступа из раскрывающегося списка, как показано на снимке экрана выше. Он отображает только те политики, у которых есть разрешения **ServiceConnect** для подключения к указанному концентратору событий.

Ниже перечислены некоторые пакеты SDK, которые можно использовать для подключения к предоставленной Центром Интернета вещей встроенной конечной точке, совместимой с Центрами событий.

| Язык | SDK | Пример |
| -------- | --- | ------ |
| .NET | https://www.nuget.org/packages/Azure.Messaging.EventHubs | [Краткое руководство](quickstart-send-telemetry-dotnet.md) |
| Java | https://mvnrepository.com/artifact/com.azure/azure-messaging-eventhubs | [Краткое руководство](quickstart-send-telemetry-java.md) |
| Node.js | https://www.npmjs.com/package/@azure/event-hubs | [Краткое руководство](quickstart-send-telemetry-node.md) |
| Python | https://pypi.org/project/azure-eventhub/ | [Краткое руководство](quickstart-send-telemetry-python.md) |

Ниже перечислены некоторые интеграции продуктов, которые можно использовать с предоставленной Центром Интернета вещей встроенной конечной точкой, совместимой с Центрами событий.

* [Функции Azure](https://docs.microsoft.com/azure/azure-functions/). См. раздел [Обработка данных из Центра Интернета вещей с помощью Функций Azure](https://azure.microsoft.com/resources/samples/functions-js-iot-hub-processing/).
* [Azure Stream Analytics](https://docs.microsoft.com/azure/stream-analytics/). См. раздел [Потоковые данные в качестве входных данных Stream Analytics](../stream-analytics/stream-analytics-define-inputs.md#stream-data-from-iot-hub).
* [Аналитика временных рядов](https://docs.microsoft.com/azure/time-series-insights/). См. [Добавление источника событий центра Интернета вещей в вашу среду "Аналитика временных рядов"](../time-series-insights/time-series-insights-how-to-add-an-event-source-iothub.md).
* [Воронка Apache Storm](../hdinsight/storm/apache-storm-develop-csharp-event-hub-topology.md). Вы можете просмотреть [источник воронки](https://github.com/apache/storm/tree/master/external/storm-eventhubs) на портале GitHub.
* [интеграция Apache Spark.](../hdinsight/spark/apache-spark-eventhub-streaming.md)
* [Azure Databricks](https://docs.microsoft.com/azure/azure-databricks/).

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о конечных точках Центра Интернета вещей см. в статье [Руководство. Конечные точки Центра Интернета вещей](iot-hub-devguide-endpoints.md).

* В [кратких руководствах](quickstart-send-telemetry-node.md) рассказывается, как отправлять сообщения с имитированных устройств в облако и читать их из встроенной конечной точки. 

Дополнительные сведения см. в руководстве [Настройка маршрутизации сообщений с Центром Интернета вещей](tutorial-routing.md).

* Сведения о перенаправлении сообщений, отправляемых с устройства в облако, на пользовательские конечные точки см. в статье [Использование правил маршрутизации и пользовательских конечных точек для сообщений, отправляемых с устройства в облако](iot-hub-devguide-messages-read-custom.md).
