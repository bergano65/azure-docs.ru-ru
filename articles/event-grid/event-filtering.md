---
title: Фильтрация событий для службы "Сетка событий Azure"
description: В статье описывается, как фильтровать события при создании подписки на службу "Сетка событий Azure".
services: event-grid
author: spelluru
ms.service: event-grid
ms.topic: conceptual
ms.date: 01/21/2019
ms.author: spelluru
ms.openlocfilehash: 87599b05a3569bf6f28880352185a131f48a7f52
ms.sourcegitcommit: cf88cf2cbe94293b0542714a98833be001471c08
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54470639"
---
# <a name="understand-event-filtering-for-event-grid-subscriptions"></a>Общие сведения о фильтрации событий для подписок на службу "Сетка событий Azure"

В статье описываются различные способы фильтрации событий, отправляемых в конечную точку. При создании подписки на события предлагается три варианта фильтрации:

* Типы событий
* по тому, что находится в начале или конце темы;
* с помощью расширенных полей и операторов.

## <a name="event-type-filtering"></a>Фильтрация по типу события

По умолчанию все [типы событий](event-schema.md) для источника события отправляются в конечную точку. Можно сделать так, чтобы в конечную точку отправлялись только определенные типы событий. Например, можно получать уведомления об обновлениях ресурсов, но не получать уведомления о других операциях, таких как удаление. В этом случае фильтрация выполняется по типу события `Microsoft.Resources.ResourceWriteSuccess`. Предоставьте массив с типами событий или укажите `All`, чтобы получать все типы событий для источника событий.

При фильтрации по типу события используется такой синтаксис JSON:

```json
"filter": {
  "includedEventTypes": [
    "Microsoft.Resources.ResourceWriteFailure",
    "Microsoft.Resources.ResourceWriteSuccess"
  ]
}
```

## <a name="subject-filtering"></a>Фильтрация по теме

Для простой фильтрации по теме укажите начальное или конечное значение для этой темы. Например, можно указать, что тема заканчивается на `.txt`, чтобы получать только события, связанные с загрузкой текстового файла в учетную запись хранения. Или можно выполнять фильтрацию по теме, начинающейся с `/blobServices/default/containers/testcontainer`, чтобы получать все события для этого контейнера, но не для других контейнеров в этой учетной записи хранения.

При публикации событий в пользовательских разделах создавайте темы для событий, чтобы подписчикам было проще определить, представляет ли событие для них интерес. Подписчики могут использовать свойство темы для фильтрации и маршрутизации событий. Можно добавить путь к расположению, в котором произошло событие, чтобы подписчики могли выполнять фильтрацию по сегментам этого пути. Путь позволяет подписчикам сузить или расширить область фильтрации. Например, если указать в теме трехсегментный путь, такой как `/A/B/C`, подписчики смогут выполнить фильтрацию по первому сегменту `/A`, чтобы получить широкий набор событий. Эти подписчики получат события с такими темами, как `/A/B/C` или `/A/D/E`. Другие подписчики могут выполнить фильтрацию по `/A/B`, чтобы получить более узкий набор событий.

При фильтрации по типу события используется такой синтаксис JSON:

```json
"filter": {
  "subjectBeginsWith": "/blobServices/default/containers/mycontainer/log",
  "subjectEndsWith": ".jpg"
}

```

## <a name="advanced-filtering"></a>Расширенная фильтрация

Вариант расширенной фильтрации позволяет выполнять фильтрацию по значениям в полях данных и указывать оператор сравнения. При расширенной фильтрации можно указать следующее:

* operatorType — тип сравнения;
* ключ — поле в данных события, которое используется для фильтрации (это может быть число, логическое значение или строка);
* value или values — значения для сравнения с ключом.

При фильтрации по типу события используется такой синтаксис JSON.

```json
"filter": {
  "advancedFilters": [
    {
      "operatorType": "NumberGreaterThanOrEquals",
      "key": "Data.Key1",
      "value": 5
    },
    {
      "operatorType": "StringContains",
      "key": "Subject",
      "values": ["container1", "container2"]
    }
  ]
}
```

### <a name="operator"></a>Оператор

Доступны такие операторы для чисел:

* NumberGreaterThan;
* NumberGreaterThanOrEquals;
* NumberLessThan;
* NumberGreaterThanOrEquals;
* NumberIn;
* NumberNotIn.

Доступный оператор логических значений: BoolEquals

Доступные операторы для строк:

* StringContains;
* StringBeginsWith;
* StringEndsWith;
* StringIn;
* StringNotIn.

При сравнении строк учитывается регистр.

### <a name="key"></a>Ключ

Для событий в схеме "Сетка событий" используются следующие значения для ключа:

* Идентификатор
* Раздел
* Субъект
* EventType
* DataVersion;
* дата события (например Data.key1).

Для событий в схеме "События в облаке" используются следующие значения для ключа:

* EventId
* Источник
* EventType
* EventTypeVersion;
* дата события (например Data.key1).

Для пользовательских схем ввода используются поля данных событий (например, Data.key1).

### <a name="values"></a>Значения

Значения могут быть такими:

* number
* строка
* Логическое
* array

### <a name="limitations"></a>Ограничения

Расширенная фильтрация имеет такие ограничения:

* пять расширенных фильтров на каждую подписку сетки событий;
* 512 знаков для значения строки;
* пять значений для операторов **in** и **not in**;
* Ключ может иметь только один уровень вложения (например, data.key1).
* Схемы настраиваемых событий можно отфильтровать только по полям верхнего уровня.

Один ключ можно использовать в нескольких фильтрах.

## <a name="next-steps"></a>Дополнительная информация

* См. дополнительные сведения о фильтрации событий для Сетки событий с помощью [PowerShell и Azure CLI](how-to-filter-events.md).
* Сведения о том, как быстро приступить к использованию службы "Сетка событий", см. в разделе [Создание и перенаправление пользовательского события со службой "Сетка событий Azure"](custom-event-quickstart.md).
