---
title: Безопасность и проверка подлинности — служба "Сетка событий Azure" IoT Edge | Документация Майкрософт
description: Безопасность и проверка подлинности в сетке событий на IoT Edge.
author: VidyaKukke
manager: rajarv
ms.author: vkukke
ms.reviewer: spelluru
ms.date: 10/06/2019
ms.topic: article
ms.service: event-grid
services: event-grid
ms.openlocfilehash: 77b4b265b2e993ccdbc9e07fd2dab5a37ed22a6b
ms.sourcegitcommit: 92d42c04e0585a353668067910b1a6afaf07c709
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/28/2019
ms.locfileid: "72992162"
---
# <a name="security-and-authentication"></a>Безопасность и проверка подлинности

Безопасность и проверка подлинности — это сложная концепция, которая сначала требует знакомства с основами сетки событий. Начните [здесь](concepts.md) , если вы не знакомы с сеткой событий на IOT Edge. Модуль "Сетка событий" создает существующую инфраструктуру безопасности на IoT Edge. Дополнительные сведения и настройка см. в [этой документации](../../iot-edge/security.md) .

В следующих разделах подробно описано, как обеспечить безопасность и проверку подлинности этих параметров.

* Конфигурация TLS
* Проверка подлинности входящего клиента
* Проверка подлинности исходящего сервера
* Исходящая проверка подлинности клиента

>[!IMPORTANT]
>Модуль "Сетка событий". безопасность и проверка подлинности — это существующая инфраструктура, доступная на IoT Edge. Предполагается, что IoT Edge подсистема безопасна.

>[!IMPORTANT]
>**По умолчанию**Конфигурация сетки событий защищена. В следующих подразделах описаны все параметры и возможные значения, которые можно использовать для переопределения аспектов проверки подлинности. Изучите последствия, прежде чем вносить изменения. Чтобы изменения вступили в силу, необходимо повторно развернуть модуль сетки событий.

## <a name="tls-configuration-aka-server-authentication"></a>Конфигурация TLS (a. k. Проверка подлинности сервера)

В модуле сетки событий размещаются конечные точки HTTP и HTTPS. Каждому модулю IoT Edge назначается сертификат сервера управляющей программой IoT Edge. Мы используем сертификат сервера для защиты конечной точки. По истечении срока действия модуль автоматически обновляется новым сертификатом из управляющей программы IoT Edge безопасности.

По умолчанию разрешены только соединения по протоколу HTTPS. Это поведение можно переопределить с помощью **входящей: serverAuth: тлсполици** Configuration. В следующей таблице записаны возможные значения этого свойства.

| Возможные значения | Описание |
| ---------------- | ------------ |
| Жесткое ограничение | По умолчанию. Включает только протокол HTTPS
| Включено | Включает HTTP и HTTPS
| Отключено | Включает только HTTP

## <a name="inbound-client-authentication"></a>Проверка подлинности входящего клиента

Клиенты являются сущностями, выполняющими операции управления и (или) выполнения. Клиенты могут быть другими IoT Edge модулями, не являющимися приложениями IoT.

Модуль "Сетка событий" поддерживает два типа проверки подлинности клиента:-

* Подпись общего доступа (SAS) на основе ключей
* на основе сертификата

По умолчанию модуль сетки событий настроен на прием только проверки подлинности на основе сертификатов. При запуске модуль "Сетка событий" получает "Трустбундле" из управляющей программы IoT Edge безопасности и использует его для проверки любого сертификата клиента. Сертификаты клиентов, которые не разрешаются в эту цепь, будут отклонены с `UnAuthorized`.

### <a name="certificate-based-client-authentication"></a>Проверка подлинности клиента на основе сертификата

Проверка подлинности на основе сертификата включена по умолчанию. Можно отключить проверку подлинности на основе сертификатов с помощью свойства **Inbound: клиентаус: клиентцерт: Enabled**. В следующей таблице записаны возможные значения.

| Возможные значения | Описание |
| ----------------  | ------------ |
| true | По умолчанию. Требует, чтобы все запросы в модуль "Сетка событий" представим сертификат клиента. Кроме того, необходимо настроить **входящий: клиентаус: клиентцерт: Source**.
| false | Не требовать, чтобы клиент выприсутствовал сертификат.

В следующей таблице записаны возможные значения для параметра **Inbound: клиентаус: клиентцерт: Source** .

| Возможные значения | Описание |
| ---------------- | ------------ |
| IoT Edge | По умолчанию. Использует Трустбундле IoT Edge для проверки всех сертификатов клиента.

Если клиент по умолчанию представляет собой самозаверяющий, модуль сетки событий отклонит такие запросы. Можно разрешить использовать самозаверяющие сертификаты клиентов через свойство **Inbound: клиентаус: клиентцерт: алловункновнка** . В следующей таблице записаны возможные значения.

| Возможные значения | Описание |
| ----------------  | ------------|
| true | По умолчанию. Позволяет успешно предоставлять самозаверяющие сертификаты.
| false | Запросы будут завершаться неудачей, если представлены самозаверяющие сертификаты.

>[!IMPORTANT]
>В рабочих сценариях может потребоваться задать для параметра **Inbound: клиентаус: клиентцерт: алловункновнка** **значение false**.

### <a name="sas-key-based-client-authentication"></a>Проверка подлинности клиента на основе ключа SAS

Помимо проверки подлинности на основе сертификата, модуль сетки событий также может выполнять проверку подлинности на основе ключей SAS. Ключ SAS подобен секрету, настроенному в модуле сетки событий, который должен использоваться для проверки всех входящих вызовов. Клиентам необходимо указать секрет в заголовке HTTP "AEG-SAS-Key". Запрос будет отклонен с `UnAuthorized`, если он не совпадает.

Конфигурация для управления проверкой подлинности на основе ключей SAS является **входящей: клиентаус: саскэйс: Enabled**.

| Возможные значения | Описание  |
| ----------------  | ------------ |
| true | Разрешает проверку подлинности на основе ключей SAS. Требуется **входящий: клиентаус: саскэйс: key1** или **Inbound: клиентаус: саскэйс: key2**
| false | По умолчанию. Проверка подлинности на основе ключа SAS отключена.

 **Inbound: клиентаус: саскэйс: key1** и **Inbound: клиентаус: саскэйс: key2** — это ключи, которые настраиваются модулем сетки событий для проверки на наличие входящих запросов. Необходимо настроить по крайней мере один из ключей. Клиент, выполняющий запрос, должен будет представлять ключ как часть заголовка запроса "**AEG-SAS-Key**". Если настроены оба ключа, клиент может предоставить либо один из ключей.

> [!NOTE]
>Можно настроить оба метода проверки подлинности. В таком случае проверяется первый ключ SAS, и только в случае сбоя выполняется проверка подлинности на основе сертификата. Для выполнения запроса необходимо выполнить только один из методов проверки подлинности.

## <a name="outbound-client-authentication"></a>Исходящая проверка подлинности клиента

Клиент в исходящем контексте ссылается на модуль сетки событий. Выполняемая операция — это доставка событий подписчикам. Модули подписки рассматриваются как сервер.

Каждому модулю IoT Edge назначается сертификат удостоверения управляющей программой IoT Edge. Мы используем сертификат удостоверения для исходящих вызовов. По истечении срока действия модуль автоматически обновляется новым сертификатом из управляющей программы IoT Edge безопасности.

Конфигурация для контроля исходящей проверки подлинности клиента — **Исходящая: клиентаус: клиентцерт: Enabled**.

| Возможные значения | Описание |
| ----------------  | ------------ |
| true | По умолчанию. Требует, чтобы все исходящие запросы из модуля сетки событий присутствовали сертификат. Необходимо настроить **Outbound: клиентаус: клиентцерт: Source**.
| false | Модуль сетки событий не требуется для представления его сертификата.

Конфигурация, управляющая источником сертификата, является **исходящей: клиентаус: клиентцерт: Source**.

| Возможные значения | Описание |
| ---------------- | ------------ |
| IoT Edge | По умолчанию. Использует сертификат удостоверения модуля, настроенный IoT Edge управляющей программой безопасности.

### <a name="outbound-server-authentication"></a>Проверка подлинности исходящего сервера

Один из типов назначения для подписчика сетки событий — "веб-перехватчик". По умолчанию для таких подписчиков принимаются только конечные точки HTTPS.

Конфигурация для управления исходящими политиками назначения веб-перехватчика **: веб-перехватчик: хттпсонли**.

| Возможные значения | Описание |
| ----------------  | ------------ |
| true | По умолчанию. Разрешает только подписчики с конечной точкой HTTPS.
| false | Разрешает подписчикам с конечной точкой HTTP или HTTPS.

По умолчанию модуль "Сетка событий" будет проверять сертификат сервера подписчика. Вы можете пропустить проверку, переопределив **Исходящие: веб-перехватчик: скипсерверцертвалидатион**. Возможные значения:-

| Возможные значения | Описание |
| ----------------  | ------------ |
| true | Не проверять сертификат сервера подписчика.
| false | По умолчанию. Проверка сертификата сервера подписчика.

Если сертификат подписчика является самозаверяющим, модуль сетки событий по умолчанию будет отклонять такие подписчики. Чтобы разрешить самозаверяющий сертификат, можно переопределить **Исходящие: веб-перехватчик: алловункновнка**. В следующей таблице записаны возможные значения.

| Возможные значения | Описание |
| ----------------  | ------------ |
| true | По умолчанию. Позволяет успешно предоставлять самозаверяющие сертификаты.
| false | Запросы будут завершаться неудачей, если представлены самозаверяющие сертификаты.

>[!IMPORTANT]
>В рабочих сценариях необходимо установить **Исходящие: веб-перехватчик: алловункновнка** в **значение false**.

> [!NOTE]
>Среда IoT Edge создает самозаверяющие сертификаты. Рекомендуется создавать сертификаты, выданные полномочными ЦС для рабочих нагрузок, и устанавливать свойство **алловункновнка** для входящих и исходящих данных в **значение false**.

## <a name="summary"></a>Резюме

**По умолчанию**модуль сетки событий является безопасным. Рекомендуется сохранить эти значения по умолчанию для рабочих развертываний.

Ниже приведены основные принципы использования GUID при настройке:-

* Разрешить только запросы HTTPS в модуль.
* Разрешить только проверку подлинности клиента на основе сертификата. Разрешить только те сертификаты, которые выдаются известными центрами сертификации. Запретить самозаверяющие сертификаты.
* Запретить проверку подлинности клиента на основе Саскэй.
* Всегда представлять сертификат удостоверения модуля сетки событий для исходящих вызовов.
* Разрешить только подписчикам HTTPS для типов назначения веб-перехватчика.
* Всегда проверять сертификат сервера подписчика для типов назначения веб-перехватчика. Разрешить только сертификаты, выданные известными центрами сертификации. Запретить самозаверяющие сертификаты.

По умолчанию модуль сетки событий развертывается со следующей конфигурацией:-

 ```json
 {
  "Env": [
    "inbound:serverAuth:tlsPolicy=strict",
    "inbound:serverAuth:serverCert:source=IoTEdge",
    "inbound:clientAuth:sasKeys:enabled=false",
    "inbound:clientAuth:clientCert:enabled=true",
    "inbound:clientAuth:clientCert:source=IoTEdge",
    "inbound:clientAuth:clientCert:allowUnknownCA=true",
    "outbound:clientAuth:clientCert:enabled=true",
    "outbound:clientAuth:clientCert:source=IoTEdge",
    "outbound:webhook:httpsOnly=true",
    "outbound:webhook:skipServerCertValidation=false",
    "outbound:webhook:allowUnknownCA=true"
  ],
  "HostConfig": {
    "PortBindings": {
      "4438/tcp": [
        {
          "HostPort": "4438"
        }
      ]
    }
  }
}
```
