---
title: Рекомендации по использованию API Детектора аномалий
titleSuffix: Azure Cognitive Services
description: Ознакомьтесь с рекомендациями по обнаружению аномалий с помощью API детектора аномалий.
services: cognitive-services
author: mrbullwinkle
manager: nitinme
ms.service: cognitive-services
ms.subservice: anomaly-detector
ms.topic: conceptual
ms.date: 03/26/2019
ms.author: mbullwin
ms.openlocfilehash: 6bf00d8b5327ddd539190b6e990c7edb35c876f7
ms.sourcegitcommit: 2c586a0fbec6968205f3dc2af20e89e01f1b74b5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/14/2020
ms.locfileid: "92018395"
---
# <a name="best-practices-for-using-the-anomaly-detector-api"></a>Рекомендации по использованию API детектора аномалий

API детектора аномалий — это служба обнаружения аномалий без отслеживания состояния. Точность и производительность ее результатов могут быть затронуты следующим образом.

* Как подготавливаются данные временных рядов.
* Используемые параметры API детектора аномалий.
* Количество точек данных в запросе API. 

Используйте эту статью, чтобы узнать о рекомендациях по использованию API для получения лучших результатов для ваших данных. 

## <a name="when-to-use-batch-entire-or-latest-last-point-anomaly-detection"></a>Когда следует использовать пакетное (полное) или Последнее (Последнее) обнаружение аномалий точки

Конечная точка обнаружения аномалий в API обнаружения вирусов позволяет обнаруживать аномалии через все данные временных рядов. В этом режиме обнаружения создается и применяется одна статистическая модель для каждой точки в наборе данных. Если временные ряды имеют следующие характеристики, рекомендуется использовать функцию обнаружения пакетов для предварительного просмотра данных в одном вызове API.

* Сезонные временные ряды с редкими аномалиями.
* Временной ряд с плоскими тенденциями с редкими пиковыми нагрузками или DIP. 

Мы не рекомендуем использовать обнаружение аномалий пакетной службы для мониторинга данных в режиме реального времени или использовать его в данных временных рядов, которые не имеют описанных выше характеристик. 

* Функция обнаружения пакетов создает и применяет только одну модель, обнаружение для каждой точки выполняется в контексте целого ряда. Если данные временных рядов изменяются без сезонности, то некоторые точки изменения (DIP и пики в данных) могут быть пропущены моделью. Аналогичным образом, некоторые точки изменения, которые менее важны, чем более поздние в наборе данных, могут не считаться достаточно важными для включения в модель.

* Обнаружение пакетов выполняется медленнее, чем обнаружение состояния аномалий последней точки при наблюдении за данными в режиме реального времени, из-за количества анализируемых точек.

Для мониторинга данных в режиме реального времени рекомендуется определить состояние аномалий только для последней точки данных. Постоянно применяя функцию обнаружения последних точек, мониторинг потоковой передачи данных может выполняться более эффективно и точно.

В приведенном ниже примере описывается влияние этих режимов обнаружения на производительность. На первом рисунке показан результат непрерывного обнаружения последней точки состояния аномалии на 28 ранее показанных точках данных. Красные точки — аномалии.

![Изображение, показывающее обнаружение аномалий с помощью последней точки](../media/last.png)

Ниже приведен тот же набор данных с помощью обнаружения аномалий пакетной службы. Модель, созданная для операции, пропустила несколько аномалий, отмеченных прямоугольниками.

![Изображение, показывающее обнаружение аномалий с помощью метода пакетной службы](../media/entire.png)

## <a name="data-preparation"></a>Подготовка данных

API детектора аномалий принимает данные временных рядов, отформатированные в объект запроса JSON. Временные ряды могут быть любыми числовыми данными, записанными с течением времени в последовательном порядке. Вы можете отправить окна данных временных рядов в конечную точку API детектора аномалий, чтобы повысить производительность API. Минимальное количество точек данных, которые вы можете отправить, равно 12, а максимальное — 8640 очков. [Гранулярность](https://docs.microsoft.com/dotnet/api/microsoft.azure.cognitiveservices.anomalydetector.models.granularity?view=azure-dotnet-preview) определяется как скорость выборки данных. 

Точки данных, отправляемые в API детектора аномалий, должны иметь допустимую отметку времени в формате UTC и числовое значение. 

```json
{
    "granularity": "daily",
    "series": [
      {
        "timestamp": "2018-03-01T00:00:00Z",
        "value": 32858923
      },
      {
        "timestamp": "2018-03-02T00:00:00Z",
        "value": 29615278
      },
    ]
}
```

Если данные выдаются в виде выборки в нестандартном интервале времени, его можно указать, добавив `customInterval` атрибут в запрос. Например, если ряды выбраны каждые 5 минут, в запрос JSON можно добавить следующее:

```json
{
    "granularity" : "minutely", 
    "customInterval" : 5
}
```

### <a name="missing-data-points"></a>Отсутствующие точки данных

Отсутствующие точки данных широко распространены в равномерно распределенных наборах данных временных рядов, особенно с точностью детализации (небольшой интервал выборки). Например, данные выборке каждые несколько минут). Отсутствие меньше 10% от ожидаемого количества точек в данных не должно негативно повлиять на результаты обнаружения. Рассмотрите возможность заполнения пропусков в данных на основе их характеристик, таких как замена точек данных на более ранний период, линейная интерполяция или скользящее среднее.

### <a name="aggregate-distributed-data"></a>Агрегирование распределенных данных

API детектора аномалий лучше подходит для равномерно распределенных временных рядов. Если данные распределяются случайным образом, их следует объединить в единицу времени, например в минуту, ежечасно или ежедневно.

## <a name="anomaly-detection-on-data-with-seasonal-patterns"></a>Обнаружение аномалий в данных с сезонными шаблонами

Если известно, что данные временных рядов имеют сезонный шаблон (один из которых выполняется с регулярными интервалами), можно повысить точность и время ответа API. 

Указание `period` при создании запроса JSON может снизить задержку обнаружения аномалий до 50%. `period`— Это целое число, которое указывает, сколько точек данных занимает временной ряд для повторения шаблона. Например, временной ряд с одной точкой данных в день будет иметь значение `period` `7` , а временной ряд с одной точкой в час (с одинаковым еженедельным шаблоном) будет иметь значение `period`  `7*24` . Если вы не уверены в шаблонах данных, этот параметр указывать не нужно.

Для получения лучших результатов предоставьте 4 `period` точки данных, а также дополнительную. Например, ежечасные данные с еженедельным шаблоном, как описано выше, должны предоставлять 673 точек данных в тексте запроса ( `7 * 24 * 4 + 1` ).

### <a name="sampling-data-for-real-time-monitoring"></a>Выборка данных для мониторинга в режиме реального времени

Если данные потоковой передачи выдаются через короткий интервал (например, секунды или минуты), отправка рекомендуемого количества точек данных может превысить максимально допустимое количество (8640 точек данных) API детектора аномалий. Если в данных отображается устойчивый шаблон сезонной работы, рассмотрите возможность отправки образца данных временных рядов через более длительный интервал времени, например часы. Таким образом, выборка данных также может заметно увеличить время ответа API. 

## <a name="next-steps"></a>Дальнейшие действия

* [Общие сведения об API Детектора аномалий](../overview.md)
* [Краткое руководство. Обнаружение аномалий в данных временных рядов с помощью Детектор аномалий API REST](../quickstarts/detect-data-anomalies-csharp.md)
