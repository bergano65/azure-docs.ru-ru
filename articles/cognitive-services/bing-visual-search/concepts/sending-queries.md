---
title: Отправка поисковых запросов в API визуального поиска Bing
titlesuffix: Azure Cognitive Services
description: Ознакомьтесь с параметрами REST API, используемыми в API визуального поиска Bing.
services: cognitive-services
author: aahill
manager: cgronlun
ms.service: cognitive-services
ms.subservice: bing-visual-search
ms.topic: article
ms.date: 12/18/2018
ms.author: aahi
ms.openlocfilehash: 07f471debad87a2fa2f6583db624e9ee204d02bc
ms.sourcegitcommit: 359b0b75470ca110d27d641433c197398ec1db38
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/07/2019
ms.locfileid: "55821173"
---
# <a name="sending-search-queries-to-the-bing-visual-search-api"></a>Отправка поисковых запросов в API визуального поиска Bing

В этой статье описаны параметры и атрибуты запросов, отправляемых в API визуального поиска Bing, а также объект ответа.

Аналитические сведения об изображении можно получить тремя способами. 

- Использование токена аналитики, полученного из изображения в результате предыдущего вызова одной из конечных точек [API Bing для поиска изображений](https://docs.microsoft.com/rest/api/cognitiveservices/bing-images-api-v7-reference).
- Отправка URL-адреса изображения.
- Отправка изображения (в двоичном файле).


## <a name="bing-visual-search-requests"></a>Запросы к API визуального поиска Bing

При отправке в API для визуального поиска токена изображения или URL-адреса в текст запроса POST необходимо включить объект JSON, показанный ниже. 

```json
{
    "imageInfo" : {
        "url" : "",
        "imageInsightsToken" : "",
        "cropArea" : {
            "top" : 0.1,
            "left" : 0.5,
            "right" : 0.9,
            "bottom" : 0.9
        }
    },
    "knowledgeRequest" : {
      "filters" : {
        "site" : ""
      }
    }
}
```

Объект `imageInfo` должен содержать поле `url` или `imageInsightsToken`, но не оба. Укажите для поля `url` URL-адрес изображения, доступного в Интернете. Максимальный поддерживаемый размер изображения составляет 1 МБ.

Для поля `imageInsightsToken` необходимо указать токен аналитики. Чтобы получить этот токен, вызовите API Bing для поиска изображений. В ответе будет содержаться список объектов `Image`. Каждый объект `Image` содержит поле `imageInsightsToken` с токеном.

Поле `cropArea` является необязательным. Область обрезки указывает верхнюю линию, левый угол, нижнюю линию и правый угол интересующей области. Укажите значения в диапазоне от 0,0 до 1,0. Они представляют собой процент от общей ширины или высоты. Например, приведенный выше пример помечает правую половину изображения как интересующую область. Если вы хотите ограничить запрос аналитики интересующей областью, укажите область обрезки.

Объект `filters` содержит фильтр сайта (см. поле `site`), который можно использовать, чтобы ограничить результаты с подобными изображениями и аналогичными товарами определенным доменом. Например, если это фото устройства Surface Book, можно указать для поля `site` "www.microsoft.com". 

Если вы хотите получить аналитические сведения о локальной копии изображения, отправьте изображение в виде двоичных данных.

Дополнительные сведения об указании этих параметров в тексте запроса POST см. в разделе [Типы формы содержимого](#content-form-types).


### <a name="search-endpoint"></a>Конечная точка для поиска

Конечная точка API для визуального поиска: https:\/\/api.cognitive.microsoft.com/bing/v7.0/images/visualsearch.

Следует отправлять только HTTP-запросы POST. 


### <a name="query-parameters"></a>Параметры запроса

Ниже приведены параметры запроса, которые должны быть указаны в запросе. Как минимум необходимо указать параметр запроса `mkt`.

| ИМЯ                              | Значение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | type   | Обязательно |
|-----------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------|----------|
| <a name="cc" />cc                 | Двухзначный код страны, откуда получены результаты.<br /><br /> Если задать этот параметр, также необходимо указать заголовок [Accept-Language](#acceptlanguage). Bing использует первый поддерживаемый язык в списке и объединяет его с указанным кодом страны, чтобы определить рынок для возвращения результатов. Если в список не включен поддерживаемый язык, Bing находит ближайший язык и рынок, поддерживаемые для запроса. Bing также может использовать для получения результатов вычисленный рынок или рынок по умолчанию.<br /><br /> Этот параметр запроса и параметр запроса `Accept-Language` следует использовать только в том случае, если вы указываете несколько языков. В противном случае нужно использовать параметры запроса `mkt` и `setLang`.<br /><br /> Этот параметр и параметр запроса [mkt](#mkt) являются взаимоисключающими. Не указывайте оба. | Строка | Нет        |
| <a name="mkt" />mkt               | Рынок, по которому возвращаются результаты. <br /><br /> **Примечание**. Рекомендуется всегда указывать рынок, если он известен. Таким образом Bing может направить запрос и вернуть соответствующий и оптимальный ответ.<br /><br /> Этот параметр и параметр запроса [cc](#cc) являются взаимоисключающими. Не указывайте оба.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Строка | Yes      |
| <a name="safesearch" />safeSearch | Фильтр, используемый для фильтрации содержимого для взрослых. Ниже приведены возможные значения фильтра, в которых не учитывается регистр.<br /><ul><li>Off &mdash; возвращаются веб-страницы с текстом или изображениями для взрослых.<br /><br/></li><li>Moderate &mdash; возвращаются веб-страницы с текстом для взрослых, но не изображениями.<br /><br/></li><li>Strict &mdash; веб-страницы с текстом или изображениями для взрослых не возвращаются.</li></ul><br /> По умолчанию используется значение Moderate.<br /><br /> **Примечание**. Если запрос поступает с рынка, для которого политика для взрослых Bing требует параметра `safeSearch` со значением Strict, Bing игнорирует значение `safeSearch` и использует значение Strict.<br/><br/>**Примечание**. Если вы используете оператор запроса `site:`, в зависимости от запроса есть вероятность, что ответ включает содержимое для взрослых независимо от значения параметра запроса `safeSearch`. Используйте `site:`, только если вам известно о содержимом на сайте и ваш сценарий поддерживает возможность использования содержимого для взрослых.                                    | Строка | Нет        |
| <a name="setlang" />setLang       | Язык, используемый для строк пользовательского интерфейса. Укажите язык, используя двухбуквенный код ISO 639-1. Например, код для английского языка — EN. Он также является кодом по умолчанию.<br /><br /> Хотя это необязательно, всегда следует указывать язык. Обычно для `setLang` задается язык, указанный в параметре `mkt`, если только пользователь не хочет, чтобы строки пользовательского интерфейса отображались на другом языке.<br /><br /> Этот параметр и заголовок [Accept-Language](#acceptlanguage) являются взаимоисключающими. Не указывайте оба.<br /><br /> Строка пользовательского интерфейса — это строка, которая используется как метка в пользовательском интерфейсе. Есть несколько строк пользовательского интерфейса в объектах ответа JSON. Кроме того, все ссылки на свойства Bing.com в объектах ответа применяют указанный язык.                                                                                                            | Строка | Нет        |

## <a name="headers"></a>Заголовки

Ниже приведены заголовки, которые должны быть указаны в запросе. Content-Type и Ocp-Apim-Subscription-Key являются единственными обязательными заголовками, но следует также указать заголовки User-Agent, X-MSEdge-ClientID, X-MSEdge-ClientIP и X-Search-Location.


| Заголовок                                                | ОПИСАНИЕ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <a name="acceptlanguage" />Accept-Language            | Дополнительный заголовок запроса.<br /><br /> Список разделенных запятыми языков, используемых для строк пользовательского интерфейса. В этом списке языки указаны в порядке убывания по приоритету. Дополнительные сведения, включая ожидаемый формат, см. в [этой статье](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html).<br /><br /> Этот заголовок и параметр запроса [setLang](#setlang) являются взаимоисключающими &mdash;, не указывайте оба.<br /><br /> Если задать этот заголовок, также необходимо указать параметр запроса [cc](#cc). Чтобы определить рынок для возврата результатов, Bing использует первый поддерживаемый язык, который он находит в списке, и объединяет его со значением параметра `cc`. Если в список не включен поддерживаемый язык, Bing находит ближайший язык и рынок, который поддерживает запрос, или использует вычисление или рынок по умолчанию для результатов. Чтобы определить рынок, используемый Bing, см. заголовок BingAPIs-Market.<br /><br /> Используйте этот заголовок и параметр запроса `cc`, только если указывается несколько языков. В противном случае используйте параметры запроса [mkt](#mkt) и [setLang](#setlang).<br /><br /> Строка пользовательского интерфейса — это строка, которая используется как метка в пользовательском интерфейсе. Есть несколько строк пользовательского интерфейса в объектах ответа JSON. Все ссылки на свойства Bing.com в объектах ответа применяют указанный язык.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| <a name="contenttype" />Content-Type                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <a name="market" />BingAPIs-Market                    | Заголовок ответа.<br /><br /> Рынок, используемый для запроса. Формат значения — \<код_языка\>-\<код_страны\>. Например, en-US.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <a name="traceid" />BingAPIs-TraceId                  | Заголовок ответа.<br /><br /> Идентификатор записи журнала, содержащей сведения о запросе. В случае ошибки запишите этот код. Если вы не можете определить и устранить проблему, укажите этот идентификатор вместе с другой информацией в запросе к группе поддержки.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| <a name="subscriptionkey" />Ocp-Apim-Subscription-Key | Обязательный заголовок запроса.<br /><br /> Ключ подписки, полученный при регистрации на использование этой службы в [Cognitive Services](https://www.microsoft.com/cognitive-services/).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| <a name="pragma" />Pragma                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <a name="useragent" />User-Agent                      | Дополнительный заголовок запроса.<br /><br /> Агент пользователя, отправивший запрос. Bing использует агент пользователя, чтобы обеспечить оптимизированное взаимодействие для мобильных пользователей. Приведенный ниже заголовок является необязательным, но его также рекомендуется указать.<br /><br /> Заголовок User-Agent должен содержать ту же строку, которую отправляет любой широко используемый браузер. Дополнительные сведения об агентах пользователя см. в [этой статье](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html).<br /><br /> Ниже приведены примеры использования строк user-agent.<br /><ul><li>Windows Phone &mdash; Mozilla/5.0 (совместим; MSIE 10.0; Windows Phone 8.0; Trident/6.0; IEMobile/10.0; ARM; Touch; NOKIA; Lumia 822)<br /><br /></li><li>Android &mdash; Mozilla/5.0 (Linux; U; Android 2.3.5; en-us; Sch-I500 сборки/GINGERBREAD) AppleWebKit/533.1 (KHTML; как Gecko) версии/4.0 Mobile Safari/533.1<br /><br /></li><li>iPhone &mdash; Mozilla/5.0 (iPhone; ЦП 6_1 iPhone ОС, как Mac OS X) AppleWebKit/536.26 (KHTML; как Gecko) iPhone4 Mobile/10B142; 1 BingWeb/3.03.1428.20120423<br /><br /></li><li>Компьютер &mdash; Mozilla/5.0 (Windows NT 6.3; WOW64; Trident/7.0; Touch; rv:11.0), как Gecko<br /><br /></li><li>iPad &mdash; Mozilla/5.0 (iPad; ОС ЦП 7_0, как Mac OS X) AppleWebKit/537.51.1 (KHTML, как Gecko) версия/7.0 Mobile/11A465 Safari/9537.53</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| <a name="clientid" />X-MSEdge-ClientID                | Дополнительный заголовок запроса и ответа.<br /><br /> Bing использует этот заголовок для обеспечения согласованного поведения при выполнении разных вызовов Bing API. Bing часто проверяет новые функции и улучшения и использует идентификатор клиента в качестве ключа для назначения тестируемых возможностей. Если вы не используете один и тот же идентификатор клиента для нескольких запросов, Bing может назначить одному пользователю несколько конфликтующих функций. Назначение таких проверяемых возможностей может привести к несогласованному взаимодействию с пользователем. Например, если для второго запроса будет назначена другая проверяемая возможность, результат будет неожиданным для пользователя. Кроме того, Bing может использовать идентификатор клиента, чтобы адаптировать результаты веб-поиска к истории поиска этого идентификатора, обеспечивая более широкие возможности взаимодействия с пользователем.<br /><br /> Bing также использует этот заголовок, чтобы повысить рейтинг результатов путем анализа активности, создаваемой идентификатором клиента. Повышение релевантности помогает улучшить качество результатов, предоставляемых API Bing, что, в свою очередь, обеспечивает более быстрые переходы по ссылкам для потребителей API.<br /><br /> **ВАЖНО!** Считайте этот заголовок обязательным, хоть это и не так. Сохранение идентификатора клиента по нескольким запросам для одной и той же комбинации пользователя и устройства позволяет 1) потребителю API получать согласованный пользовательский интерфейс и 2) больше переходов по ссылкам благодаря лучшему качеству результатов от Bing API.<br /><br /> Ниже приведены базовые правила использования, применяемые к этому заголовку.<br /><ul><li>Каждый пользователь, использующий приложение на устройстве, должен иметь уникальный идентификатор клиента Bing.<br /><br/>Если этот заголовок не включается в запрос, Bing создает идентификатор и возвращает его в заголовке ответа X-MSEdge-ClientID. Этот заголовок не следует включать в запрос, только когда пользователь в первый раз использует приложение на этом устройстве.<br /><br/></li><li>**ВНИМАНИЕ!** Нужно убедиться, что этот идентификатор клиента не связан с какой-либо аутентифицируемой информацией учетной записи пользователя.</li><li>Используйте идентификатор клиента при каждом запросе к API Bing от приложения для определенного пользователя на определенном устройстве.<br /><br/></li><li>Сохраните идентификатор клиента. Чтобы сохранить идентификатор в приложении браузера, нужен постоянный файл cookie HTTP, что гарантирует использование идентификатора во всех сеансах. Не используйте файл cookie сеанса. В других приложениях, таких как мобильные приложения, для хранения идентификатора можно использовать постоянное хранилище устройства.<br /><br/>В следующий раз, когда пользователь будет использовать приложение на этом устройстве, извлеките сохраненный идентификатор клиента.</li></ul><br /> **Примечание**. Ответы Bing могут как включать, так и не включать этот заголовок. Если ответ включает этот заголовок, сохраните идентификатор клиента и используйте его для всех последующих запросов Bing для пользователя на этом устройстве.<br /><br /> **Примечание**. Если в запрос включен заголовок X-MSEdge-ClientID, этот запрос не должен содержать файлы cookie. |
| <a name="clientip" />X-MSEdge-ClientIP                | Дополнительный заголовок запроса.<br /><br /> IPv4-адрес или IPv6-адрес клиентского устройства. IP-адрес используется для обнаружения расположения пользователя. Bing использует сведения о расположении для выбора безопасного поведения поиска.<br /><br /> **Примечание**. Приведенный ниже заголовок является необязательным, однако всегда рекомендуется указывать его и заголовок X-Search-Location.<br /><br /> Не маскируйте адрес (например, изменив последний октет на 0). Это приводит к тому, что расположение не находится где-либо рядом с фактическим расположением устройства, что может привести к тому, что Bing будет предоставлять ошибочные результаты.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <a name="location" />X-Search-Location                | Дополнительный заголовок запроса.<br /><br /> Список пар "ключ — значение", разделенных точкой с запятой, которые описывают географическое расположение клиента. Bing использует сведения о расположении для определения поведения при безопасном поиске и возвращения релевантного локального содержимого. Укажите пару "ключ-значение" в формате \<ключ\>:\<значение\>. Ниже приведены ключи, которые можно использовать для определения расположения пользователя.<br /><br /><ul><li>lat (обязательный). Широта расположения клиента в градусах. Широта должна быть не меньше −90,0 и не больше +90,0. Отрицательные значения указывают южные широты, а положительные значения — северные.<br /><br /></li><li>long (обязательный). Долгота расположения клиента в градусах. Долгота должна быть не меньше –180.0 и не больше +180.0. Отрицательные значения указывают на западную долготу, а положительные значения — на восточную.<br /><br /></li><li>re (обязательный). Радиус в метрах, который определяет горизонтальную точность координат. Передайте значение, возвращенное службой расположения устройства. Типичные значения могут быть 22 м для GPS или Wi-Fi, 380 м для триангуляции по вышке сотовой связи и 18 000 м для обратного просмотра IP-адресов.<br /><br /></li><li>ts (необязательный). Метка времени в формате UTC UNIX, когда клиент находился в этом расположении. (Метка времени UNIX — количество секунд, прошедших с 1 января 1970 года.)<br /><br /></li><li>head &mdash; необязательный ключ. Относительное направление движения клиента. Укажите направление движения в градусах от 0 до 360, отсчитывая по часовой стрелке относительно севера. Укажите этот ключ, только если ключ `sp` имеет ненулевое значение.<br /><br /></li><li>sp (необязательный). Горизонтальная скорость в метрах в секунду, с которой клиентское устройство перемещается.<br /><br /></li><li>alt (необязательный). Высота размещения клиентского устройства в метрах.<br /><br /></li><li>are (необязательный). Радиус в метрах, который определяет вертикальную точность координат. Укажите этот ключ, только если указан ключ `alt`.<br /><br /></li></ul> **Примечание**. Хотя многие из этих ключей не являются обязательными, чем больше информации вы предоставите, тем точнее будут результаты поиска.<br /><br /> **Примечание**. Хотя это необязательно, рекомендуется всегда указывать географическое расположение пользователя. Это особенно важно, если IP-адрес клиента не точно отражает физическое расположение пользователя (например, если клиент использует VPN). Для получения оптимальных результатов следует включать этот заголовок и заголовок X-MSEdge-ClientIP. Как минимум, следует включать этот заголовок.                                                                                                                                                              |

> [!NOTE] 
> Помните, что условия использования требуют соблюдения всех применимых законов, в том числе в отношении использования этих заголовков. Например, в некоторых юрисдикциях, например европейской, есть требования на получение согласия пользователя перед размещением определенных устройств отслеживания на пользовательских устройствах.


<a name="content-form-types" />

### <a name="content-form-types"></a>Типы форм содержимого

Каждый запрос должен включать заголовок Content-Type. Заголовок должен быть указан как: multipart/form-data; boundary=\<boundary string\>, где \<boundary string\> является уникальной непрозрачной строкой, определяющей границы данных формы. Например, boundary=boundary_1234-abcd.


Если вы отправляете в API визуального поиска токен изображения или URL-адрес, в текст запроса POST необходимо добавить данные формы, показанные ниже. Данные формы должны включать в себя заголовок Content-Disposition, а его параметру `name` необходимо присвоить значение knowledgeRequest. Дополнительные сведения об объекте `imageInfo` см. в разделе "Запрос".


```
--boundary_1234-abcd
Content-Disposition: form-data; name="knowledgeRequest"

{
    "imageInfo" : {
        "url" : "https://contoso.com/2018/05/fashion/red.jpg"
    }
}

--boundary_1234-abcd--
```

При отправке локального изображения отображаются данные формы, которые необходимо включить в текст запроса POST. Эти данные формы должны содержать заголовок Content-Disposition. Его параметру `name` нужно присвоить значение image, а для параметра `filename` можно задать любую строку. Для заголовка Content-Type можно задать любой широко используемый тип MIME изображения. Содержимым формы является двоичный файл изображения. Максимально допустимый размер отправляемого изображения — 1 МБ. Наибольшее из значений ширины или высоты не должно превышать 1500 пикселей.


```
--boundary_1234-abcd
Content-Disposition: form-data; name="image"; filename="myimagefile.jpg"
Content-Type: image/jpeg

ÿØÿà JFIF ÖÆ68g-¤CWŸþ29ÌÄøÖ‘º«™æ±èuZiÀ)"óÓß°Î= ØJ9á+*G¦...

--boundary_1234-abcd--
```

Ниже показано, как указать интересующую область отправляемого изображения.

```
--boundary_1234-abcd
Content-Disposition: form-data; name="knowledgeRequest"

{
    "imageInfo" : {
        "cropArea" : {
            "top" : 0.2,
            "left" : 0.3,
            "bottom" : 0.7,
            "right" : 0.6
        }
    }
}

--boundary_1234-abcd
Content-Disposition: form-data; name="image"; filename="image"
Content-Type: image/jpeg


ÿØÿà JFIF ÖÆ68g-¤CWŸþ29ÌÄøÖ‘º«™æ±èuZiÀ)"óÓß°Î= ØJ9á+*G¦...

--boundary_1234-abcd--
```



### <a name="example-request"></a>Пример запроса

Ниже показан полный запрос на получение аналитических сведений об изображении, который передает токен изображения и интересующую область. Получите токен аналитики из предыдущего вызова /images/search.


```  
POST https://api.cognitive.microsoft.com/bing/v7.0/images/visualsearch?mkt=en-us HTTP/1.1  
Content-Type: multipart/form-data; boundary=boundary_1234-abcd
Ocp-Apim-Subscription-Key: 123456789ABCDE  
X-MSEdge-ClientIP: 999.999.999.999  
X-Search-Location: lat:47.60357;long:-122.3295;re:100  
X-MSEdge-ClientID: <blobFromPriorResponseGoesHere>  
Host: api.cognitive.microsoft.com 

--boundary_1234-abcd
Content-Disposition: form-data; name="knowledgeRequest"

{
    "imageInfo" : {
        "imageInsightsToken" : "mid_D6426898706EC7..."
        "cropArea" : {
            "top" : 0.1,
            "left" : 0.2,
            "bottom" : 0.7,
            "right" : 0.5
        }
    }
}

--boundary_1234-abcd--
```


## <a name="bing-visual-search-responses"></a>Ответы API визуального поиска Bing

Если для изображения доступны аналитические сведения, ответ содержит один или несколько полей `tags` с такими сведениями. Поле `image` содержит токен аналитики для входного изображения,

```json
{
  "_type" : "ImageKnowledge",
  "tags" : [
    {...},
    {...},
    {...},
    {...},
    {...}
  ],
  "image" : {
    "imageInsightsToken" : "bcid_AF8C9CA409421B..."
  }
}
```

а поле `tags` — отображаемое имя и список действий (аналитики). Один из тегов содержит поле `displayName`, для которого задана пустая строка. Этот тег содержит аналитические сведения по умолчанию, такие как веб-страницы, где содержится изображение, визуально подобные изображения и источники для покупок товаров, найденных в изображении. Так как все изображение представляет интерес, тег аналитики по умолчанию не содержит ограничивающие прямоугольники для интересующих областей.


```json
{
  "_type" : "ImageKnowledge",
  "tags" : [
    {
      "displayName" : "",
      "actions" : [
        {...},
        {...},
        {...},
        {...}
      ]
    },
    {...},
    {...},
    {...},
    {...}
  ],
  "image" : {
    "imageInsightsToken" : "bcid_AF8C9CA409421B..."
  }
}
```

Список аналитических сведений по умолчанию см. в статье [Тег аналитических сведений по умолчанию](../default-insights-tag.md).



Остальные теги содержат другие сведения, которые могут представлять интерес для пользователя. Например, если изображение содержит текст, один тег может включать атрибут TextResults, содержащий распознанный текст. Если Bing распознает сущность (пользователя, место или предмет) на изображении, один из тегов может определять сущность. API для визуального поиска также возвращает широкий набор терминов (тегов), производных от входного изображения. С их помощью пользователи могут исследовать основные понятия, представленные на изображении. Например, если это фото знаменитого спортсмена, одним из тегов может быть слово "Спорт", содержащее ссылки на связанные изображения.

Каждый тег содержит отображаемое имя, которое можно использовать для категоризации аналитических сведений, ограничивающий прямоугольник, определяющий интересующую область, к которой применяются эти сведения, сами аналитические сведения и эскиз изображения. Например, если это фото человека в спортивной футболке, один из тегов может включать ограничивающий прямоугольник с этой футболкой и аналитические сведения VisualSearch и ProductVisualSearch. Другой тег может включать аналитические сведения ImageResults, содержащие URL-адрес для запроса API /images/search, получающего изображения, которые тематически связаны, или URL-адрес поиска Bing.com, который перенаправляет пользователя к результатам поиска изображения на Bing.com.

Все теги, отличные от тега аналитических сведений по умолчанию, включают ограничивающие прямоугольники, которые определяют интересующие области на изображении. Например, если изображение содержит несколько распознаваемых пользователей, теги могут включать ограничивающие прямоугольники для каждого пользователя, а если изображение содержит распознаваемые элементы одежды — для каждого элемента. Ограничивающие прямоугольники можно использовать для создания поверх изображения гиперобъектов, щелкнув которые можно получить сведения о содержимом в этой области изображения. Не следует включать гиперобъекты изображения для ограничивающих прямоугольников, которые определяют все изображение.

### <a name="text-recognition"></a>Распознавание текста

Если изображение содержит текст, распознаваемый службой, один из тегов будет содержать аналитические сведения TextResults (действие). Параметр `displayName` аналитических сведений содержит распознанный текст. 

```json
    {
        "image" : {
            "thumbnailUrl" : "https:\/\/tse3.mm.bing.net\/th?q=%23%23Text..."
        },
        "displayName" : "##TextRecognition",
        "boundingBox" : {
            "queryRectangle" : {
                "topLeft" : {"x" : 0, "y" : 0},
                "topRight" : {"x" : 1, "y" : 0},
                "bottomRight" : {"x" : 1, "y" : 1},
                "bottomLeft" : {"x" : 0, "y" : 1}
            },
            "displayRectangle" : {
                "topLeft" : {"x" : 0, "y" : 0},
                "topRight" : {"x" : 1, "y" : 0},
                "bottomRight" : {"x" : 1, "y" : 1},
                "bottomLeft" : {"x" : 0, "y" : 1}
            }
        },
        "actions" : [{
            "displayName" : "WALK BIKE ACROSS BRIDGE",
            "actionType" : "TextResults"
        }],
        "sources" : ["OCR"]
    }
```

Так как поле `displayName` тега содержит ##TextRecognition, не используйте его в качестве категории заголовка в пользовательском интерфейсе. Это же касается любого отображаемого имени, которое начинается с ##. Вместо этого используйте отображаемое имя действия.


Функция распознавания текста также может распознать контактную информацию на визитных карточках, например номера телефонов и адреса электронной почты. Ограничивающий прямоугольник определяет расположение контактных данных на карточке. 

```json
    {
      "image" : {
        "thumbnailUrl" : "https:\/\/tse3.mm.bing.net\/th?q=%23%23TextRecognition..."
      },
      "displayName" : "##TextRecognition",
      "boundingBox" : {
        "queryRectangle" : {
          "topLeft" : {"x" : 0.635, "y" : 0},
          "topRight" : {"x" : 0.77, "y" : 0},
          "bottomRight" : {"x" : 0.77, "y" : 0.4873333},
          "bottomLeft" : {"x" : 0.635, "y" : 0.4873333}
        },
        "displayRectangle" : {
          "topLeft" : {"x" : 0.635, "y" : 0},
          "topRight" : {"x" : 0.77, "y" : 0},
          "bottomRight" : {"x" : 0.77, "y" : 0.4873333},
          "bottomLeft" : {"x" : 0.635, "y" : 0.4873333}
        }
      },
      "actions" : [
        {
          "url" : "tel:888%20555%201212",
          "actionType" : "Uri"
        }
      ],
      "sources" : ["OCR"]
    },
    {
      "image" : {
        "thumbnailUrl" : "https:\/\/tse3.mm.bing.net\/th?q=%23%23TextRecognition..."
      },
      "displayName" : "##TextRecognition",
      "boundingBox" : {
        "queryRectangle" : {
          "topLeft" : {"x" : 0.63, "y" : 0},
          "topRight" : {"x" : 0.866, "y" : 0},
          "bottomRight" : {"x" : 0.866, "y" : 0.5553334},
          "bottomLeft" : {"x" : 0.63, "y" : 0.5553334}
        },
        "displayRectangle" : {
          "topLeft" : {"x" : 0.63, "y" : 0},
          "topRight" : {"x" : 0.866, "y" : 0},
          "bottomRight" : {"x" : 0.866, "y" : 0.5553334},
          "bottomLeft" : {"x" : 0.63, "y" : 0.5553334}
        }
      },
      "actions" : [
        {
          "url" : "mailto:someone@outlook.com",
          "actionType" : "Uri"
        }
      ],
      "sources" : ["OCR"]
    },
    {
      "image" : {
        "thumbnailUrl" : "https:\/\/tse3.mm.bing.net\/th?q=%23%23TextRecognition..."
      },
      "displayName" : "##TextRecognition",
      "boundingBox" : {
        "queryRectangle" : {
          "topLeft" : {"x" : 0, "y" : 0},
          "topRight" : {"x" : 1, "y" : 0},
          "bottomRight" : {"x" : 1, "y" : 1},
          "bottomLeft" : {"x" : 0, "y" : 1}
        },
        "displayRectangle" : {
          "topLeft" : {"x" : 0, "y" : 0},
          "topRight" : {"x" : 1, "y" : 0},
          "bottomRight" : {"x" : 1, "y" : 1},
          "bottomLeft" : {"x" : 0, "y" : 1}
        }
      },
      "actions" : [
        {
          "displayName" : "CHARLENE WHITNEY Graphic Designer 888 555 1212 someone@outlook.com www.contoso.com",
          "actionType" : "TextResults"
        }
      ],
      "sources" : ["OCR"]
    }
```

Если изображение содержит распознанную сущность, например человека, место или предмет, один из тегов может включать аналитические сведения о сущности. 

```json
    {
      "image" : {
        "thumbnailUrl" : "https:\/\/tse4.mm.bing.net\/th?q=Statue+of+Liberty..."
      },
      "displayName" : "Statue of Liberty",
      "boundingBox" : {
        "queryRectangle" : {
          "topLeft" : {"x" : 0.40625, "y" : 0.1757813},
          "topRight" : {"x" : 0.6171875, "y" : 0.1757813},
          "bottomRight" : {"x" : 0.6171875, "y" : 0.3867188},
          "bottomLeft" : {"x" : 0.40625, "y" : 0.3867188}
        },
        "displayRectangle" : {
          "topLeft" : {"x" : 0.40625, "y" : 0.1757813},
          "topRight" : {"x" : 0.6171875, "y" : 0.1757813},
          "bottomRight" : {"x" : 0.6171875, "y" : 0.3867188},
          "bottomLeft" : {"x" : 0.40625, "y" : 0.3867188}
        }
      },
      "actions" : [
        {
          "_type" : "ImageEntityAction",
          "webSearchUrl" : "https:\/\/www.bing.com\/search?q=Statue+of+Liberty",
          "displayName" : "Statue of Liberty",
          "actionType" : "Entity",
        }
      ]
    }
```

## <a name="see-also"></a>См. также

* [Знакомство с API визуального поиска Bing](../overview.md)
* [Руководство Создание одностраничного веб-приложения. Визуальный поиск Bing](../tutorial-bing-visual-search-single-page-app.md)
