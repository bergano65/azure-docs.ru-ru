---
title: Справочник по переводчикам версии 3.0
titleSuffix: Azure Cognitive Services
description: Справочная документация по Translator V 3.0. Версия 3 транслятора предоставляет современный веб-API на основе JSON.
services: cognitive-services
author: swmachan
manager: nitinme
ms.service: cognitive-services
ms.subservice: translator-text
ms.topic: reference
ms.date: 8/11/2020
ms.author: swmachan
ms.openlocfilehash: 6b211dd8ca735ea9ee4a5209aa6030398cca472e
ms.sourcegitcommit: b8702065338fc1ed81bfed082650b5b58234a702
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2020
ms.locfileid: "88121023"
---
# <a name="translator-v30"></a>Переводчик версии 3.0

## <a name="whats-new"></a>Новые возможности

Версия 3 транслятора предоставляет современный веб-API на основе JSON. Это улучшает удобство и производительность благодаря объединению существующих функций с меньшим количеством операций и предоставляет новые возможности.

 * Транслитерация для преобразования текста на одном языке из одного сценария в другой.
 * Преобразование на несколько языков в одном запросе.
 * Определение языка, перевод и транслитерация в одном запросе.
 * Словарь для поиска альтернативных переводов термина, чтобы найти обратные переводы и примеры, демонстрирующие термины, используемые в контексте.
 * Более информативные результаты определения языка.

## <a name="base-urls"></a>Базовые URL-адреса

Microsoft Translator обслуживается несколькими центрами обработки данных. В настоящее время они находятся в 10 [географических регионах Azure](https://azure.microsoft.com/global-infrastructure/regions):

* **Americas:** Восточная часть США, Юго-Центральный регион США, Западная Центральная часть US и Западная часть США 2 
* **Азиатско-Тихоокеанский регион:** Южная Корея, Восточная Япония, Юго-Восточная Азия и Восточная Австралия
* **Европа:** Северная Европа и Западная Европа

Запросы к Microsoft Translator в большинстве случаев обрабатываются центром обработки данных, который ближе всего к месту порожденного запроса. В случае сбоя центра обработки данных запрос может маршрутизироваться за пределами службы "География Azure".

Чтобы принудительно обработать запрос в определенной географической службе Azure, измените глобальную конечную точку в запросе API на нужную региональную конечную точку:

|Описание|География Azure|Базовый URL-адрес|
|:--|:--|:--|
|Azure|Глобальный (не региональный)|   api.cognitive.microsofttranslator.com|
|Azure|США|   api-nam.cognitive.microsofttranslator.com|
|Azure|Европа|  api-eur.cognitive.microsofttranslator.com|
|Azure|Азиатско-Тихоокеанский регион|    api-apc.cognitive.microsofttranslator.com|

## <a name="authentication"></a>Проверка подлинности

Подпишитесь на переводчик или [Cognitive Services несколько служб](https://azure.microsoft.com/pricing/details/cognitive-services/) в Azure Cognitive Services и используйте ключ подписки (доступный в портал Azure) для проверки подлинности. 

Существуют три заголовка, которые можно использовать для проверки подлинности подписки. В этой таблице описывается, как использовать каждый из них.

|Заголовки|Описание|
|:----|:----|
|Ocp-Apim-Subscription-Key|*Используйте подписку Cognitive Services, если вы передаете секретный ключ*.<br/>Значение — секретный ключ Azure для подписки на переводчик.|
|Авторизация|*Используйте подписку Cognitive Services, если вы передаете токен аутентификации.*<br/>Значением является токен носителя: `Bearer <token>`.|
|Ocp-Apim-Subscription-Region|*Использование с Cognitive Services несколькими службами и региональными ресурсами переводчика.*<br/>Значение — это регион ресурса многослужбы или регионального переводчика. Это значение является необязательным при использовании ресурса глобального переводчика.|

###  <a name="secret-key"></a>Секретный ключ
Первый вариант — выполнить проверку подлинности с помощью заголовка `Ocp-Apim-Subscription-Key`. Добавьте `Ocp-Apim-Subscription-Key: <YOUR_SECRET_KEY>` заголовок к запросу.

#### <a name="authenticating-with-a-global-resource"></a>Проверка подлинности с помощью глобального ресурса

При использовании [ресурса глобального переводчика](https://ms.portal.azure.com/#create/Microsoft.CognitiveServicesTextTranslation)необходимо включить один заголовок для вызова транслятора.

|Заголовки|Описание|
|:-----|:----|
|Ocp-Apim-Subscription-Key| Значение — секретный ключ Azure для подписки на переводчик.|

Ниже приведен пример запроса для вызова транслятора с помощью ресурса глобального переводчика.

```curl
// Pass secret key using headers
curl -X POST "https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=es" \
     -H "Ocp-Apim-Subscription-Key:<your-key>" \
     -H "Content-Type: application/json" \
     -d "[{'Text':'Hello, what is your name?'}]"
```

#### <a name="authenticating-with-a-regional-resource"></a>Проверка подлинности с помощью регионального ресурса

При использовании [регионального ресурса переводчика](https://ms.portal.azure.com/#create/Microsoft.CognitiveServicesTextTranslation).
Существует 2 заголовка, которые необходимо вызвать для переводчика.

|Заголовки|Описание|
|:-----|:----|
|Ocp-Apim-Subscription-Key| Значение — секретный ключ Azure для подписки на переводчик.|
|Ocp-Apim-Subscription-Region| Значение — это регион ресурса переводчика. |

Ниже приведен пример запроса для вызова транслятора с помощью регионального ресурса переводчика.

```curl
// Pass secret key and region using headers
curl -X POST "https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=es" \
     -H "Ocp-Apim-Subscription-Key:<your-key>" \
     -H "Ocp-Apim-Subscription-Region:<your-region>" \
     -H "Content-Type: application/json" \
     -d "[{'Text':'Hello, what is your name?'}]"
```

#### <a name="authenticating-with-a-multi-service-resource"></a>Проверка подлинности с помощью ресурса с несколькими службами

При использовании многосервисного ресурса со службой. В этом случае вы сможете использовать единый секретный ключ для проверки подлинности запросов нескольких служб. 

При использовании секретного ключа с несколькими службами необходимо включить в запрос два заголовка проверки подлинности. Существует 2 заголовка, которые необходимо вызвать для переводчика.

|Заголовки|Описание|
|:-----|:----|
|Ocp-Apim-Subscription-Key| Значение — секретный ключ Azure для ресурса с несколькими службами.|
|Ocp-Apim-Subscription-Region| Значение — это регион ресурса с несколькими службами. |

Для подписки на API текстовых интерфейсов с несколькими службами требуется регион региона. Выбранный регион является единственным регионом, который можно использовать для перевода текста при использовании ключа подписки с несколькими службами, и должен быть тем же регионом, который вы выбрали при регистрации в подписке с несколькими службами с помощью портал Azure.

Доступные регионы: `australiaeast` , `brazilsouth` , `canadacentral` , `centralindia` , `centralus` , `centraluseuap` , `eastasia` , `eastus` , `eastus2` , `francecentral` , `japaneast` , `japanwest` , `koreacentral` , `northcentralus` , `northeurope` , `southcentralus` , `southeastasia` , `uksouth` , `westcentralus` , `westeurope` , `westus` `westus2` `southafricanorth` , и.

Если секретный ключ передается в строке запроса с параметром `Subscription-Key`, необходимо указать регион с параметром запроса `Subscription-Region`.

### <a name="authenticating-with-an-access-token"></a>Проверка подлинности с помощью маркера доступа
Альтернативным вариантом является изменение секретного ключа для маркера доступа. Этот маркер входит в состав каждого запроса как заголовок `Authorization`. Чтобы получить токен авторизации, сделайте запрос `POST` по следующему URL-адресу.

| Тип ресурса     | Служба проверки подлинности URL-адреса                                |
|-----------------|-----------------------------------------------------------|
| Глобальный          | `https://api.cognitive.microsoft.com/sts/v1.0/issueToken` |
| Региональный или Multi-Service | `https://<your-region>.api.cognitive.microsoft.com/sts/v1.0/issueToken` |

Вот пример запросов для получения токена с секретным ключом.

```curl
// Pass secret key using header
curl --header 'Ocp-Apim-Subscription-Key: <your-key>' --data "" 'https://api.cognitive.microsoft.com/sts/v1.0/issueToken'

// Pass secret key using query string parameter
curl --data "" 'https://api.cognitive.microsoft.com/sts/v1.0/issueToken?Subscription-Key=<your-key>'
```

Успешный запрос возвращает закодированный токен доступа в виде обычного текста в тексте ответа. Допустимый токен передается в службу переводчика как маркер носителя авторизации.

```http
Authorization: Bearer <Base64-access_token>
```

Токен аутентификации допустимый в течение 10 минут. Токен следует использовать повторно при выполнении нескольких вызовов транслятора. Однако если программа выполняет запросы к транслятору в течение продолжительного периода времени, программа должна запрашивать новый маркер доступа через регулярные интервалы (например, каждые 8 минут).

## <a name="virtual-network-support"></a>Поддержка виртуальной сети

Теперь служба переводчика доступна с возможностями виртуальной сети (VNET) во всех регионах общедоступного облака Azure. Сведения о включении виртуальной сети см. в статье [Настройка виртуальных сетей Azure Cognitive Services](https://docs.microsoft.com/azure/cognitive-services/cognitive-services-virtual-networks?tabs=portal). 

После включения этой возможности необходимо использовать пользовательскую конечную точку для вызова транслятора. Нельзя использовать глобальную конечную точку транслятора ("api.cognitive.microsofttranslator.com"), и вы не можете пройти проверку подлинности с помощью маркера доступа.

Пользовательскую конечную точку можно найти после создания [ресурса переводчика](https://ms.portal.azure.com/#create/Microsoft.CognitiveServicesTextTranslation) и разрешения доступа из выбранных сетей и частных конечных точек.

|Заголовки|Описание|
|:-----|:----|
|Ocp-Apim-Subscription-Key| Значение — секретный ключ Azure для подписки на переводчик.|
|Ocp-Apim-Subscription-Region| Значение — это регион ресурса переводчика. Это значение является необязательным, если ресурс`global`|

Ниже приведен пример запроса для вызова транслятора с помощью пользовательской конечной точки.

```curl
// Pass secret key and region using headers
curl -X POST "https://<your-custom-domain>.cognitiveservices.azure.com/translator/text/v3.0/translate?api-version=3.0&to=es" \
     -H "Ocp-Apim-Subscription-Key:<your-key>" \
     -H "Ocp-Apim-Subscription-Region:<your-region>" \
     -H "Content-Type: application/json" \
     -d "[{'Text':'Hello, what is your name?'}]"
```

## <a name="errors"></a>ошибки

Стандартный ответ об ошибке — это объект JSON с парой имя и значение, названный `error`. Значение также является объектом JSON со следующими свойствами.

  * `code`. Код ошибки, определенный сервером.
  * `message`. Строка, дающая представление об ошибке в понятном для человека формате.

Например, клиент с бесплатной пробной подпиской получит следующую ошибку после исчерпания бесплатной квоты.

```json
{
  "error": {
    "code":403001,
    "message":"The operation is not allowed because the subscription has exceeded its free quota."
    }
}
```
Код ошибки представляет собой число из 6 знаков, первые 3 из которых являются кодом состояния HTTP, а оставшиеся 3 цифры определяют категорию ошибки. Коды распространенных ошибок:

| Код | Описание |
|:----|:-----|
| 400000| Недопустимые входные данные в запросе.|
| 400001| Недопустимый параметр "scope" (область).|
| 400002| Недопустимый параметр "category" (категория).|
| 400003| Спецификатор языка отсутствует или является недопустимым.|
| 400004| Спецификатор целевого сценария ("To script") отсутствует или является недопустимым.|
| 400005| Входной текст отсутствует или является недопустимым.|
| 400006| Недопустимая комбинация языка и сценария.|
| 400018| Спецификатор исходного сценария ("From script") отсутствует или является недопустимым.|
| 400019| Один из указанных языков не поддерживается.|
| 400020| Один из элементов в массиве входного текста недопустим.|
| 400021| Параметр версии API отсутствует или недопустим.|
| 400023| Один из заданной пары языков является недопустимым.|
| 400035| Исходный язык (поле "From") является недопустимым.|
| 400036| Целевой язык (поле "To") отсутствует или является недопустимым.|
| 400042| Один из указанных параметров (поле "Options") является недопустимым.|
| 400043| Идентификатор трассировки клиента (поле ClientTraceId или заголовок X-ClientTranceId) отсутствует или является недопустимым.|
| 400050| Входной текст является слишком длинным. Просмотр [ограничений запросов](../request-limits.md).|
| 400064| Параметр "translation" (перевод) отсутствует или недопустим.|
| 400070| Количество целевых сценариев (параметр "ToScript") не соответствует количеству целевых языков (параметр "To").|
| 400071| Значение не является допустимым для TextType.|
| 400072| В массиве входного текста слишком много элементов.|
| 400073| Недопустимый параметр сценария.|
| 400074| Текст запроса не соответствует формату JSON.|
| 400075| Сочетание категории и пары языков не является допустимым.|
| 400077| Превышен максимальный размер запроса. Просмотр [ограничений запросов](../request-limits.md).|
| 400079| Система, запрошенная для перевода между данными исходным и целевым языками, не существует.|
| 400080| Транслитерация не поддерживается для языка или скрипта.|
| 401000| Запрос не авторизован, так как учетные данные отсутствуют или являются недопустимыми.|
| 401015| "Указаны учетные данные для API распознавания речи. Этот запрос требует учетные данные для API текста. Используйте подписку для переводчика ".|
| 403000| Операция запрещена.|
| 403001| Операция запрещена, так как для подписки превышена бесплатная квота.|
| 405000| Метод запроса не поддерживается для запрошенного ресурса.|
| 408001| Запрошенная система перевода подготавливается. Повторите попытку через несколько минут.|
| 408002| Время ожидания запроса истекло в ожидании входящего потока. Клиент не создал запрос в течение времени, в течение которого сервер был готов к ожиданию. Клиент может повторить запрос без внесения изменений в любое другое время.|
| 415000| Заголовок Content-Type отсутствует или является недопустимым.|
| 429000, 429001, 429002| Сервер отклонил запрос, так как клиент превысил лимиты запросов.|
| 500000| Произошла непредвиденная ошибка. Если ошибка сохраняется, передайте отчет о ней, включив следующие данные: дата и время ошибки, идентификатор запроса из заголовка ответа X-RequestId и идентификатор клиента из заголовка запроса X-ClientTraceId.|
| 503000| Служба временно недоступна. Повторите попытку. Если ошибка сохраняется, передайте отчет о ней, включив следующие данные: дата и время ошибки, идентификатор запроса из заголовка ответа X-RequestId и идентификатор клиента из заголовка запроса X-ClientTraceId.|

## <a name="metrics"></a>Метрики 
Метрики позволяют просматривать сведения об использовании и доступности транслятора в портал Azure в разделе метрики, как показано на снимке экрана ниже. Дополнительные сведения см. в статье [метрики данных и платформы](https://docs.microsoft.com/azure/azure-monitor/platform/data-platform-metrics).

![Метрики переводчиков](../media/translatormetrics.png)

В этой таблице перечислены доступные метрики с описанием того, как они используются для отслеживания вызовов API перевода.

| Метрики | Описание |
|:----|:-----|
| TotalCalls| Общее число вызовов API.|
| TotalTokenCalls| Общее число вызовов API через службу маркеров с использованием токена проверки подлинности.|
| SuccessfulCalls| Число успешных вызовов.|
| TotalErrors| Количество вызовов с ошибочным ответом.|
| BlockedCalls| Число вызовов, превысивших ограничение скорости или квоты.|
| ServerErrors| Количество вызовов с внутренней ошибкой сервера (5XX).|
| ClientErrors| Количество вызовов с ошибкой на стороне клиента (4XX).|
| Задержка| Длительность выполнения запроса в миллисекундах.|
| CharactersTranslated| Общее количество символов во входящем текстовом запросе.|
