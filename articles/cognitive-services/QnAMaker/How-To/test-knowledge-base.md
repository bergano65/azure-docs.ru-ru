---
title: Тестирование базы знаний — QnA Maker
description: Тестирование базы знаний QnA Maker является важной частью итерационного процесса для повышения точности возвращаемых ответов. Вы можете протестировать базу знаний через расширенный интерфейс чата, который также позволяет вносить правки.
ms.service: cognitive-services
ms.subservice: qna-maker
ms.topic: conceptual
ms.date: 11/09/2020
ms.openlocfilehash: 273548ec095ce04772438a2d732b914d80d976cc
ms.sourcegitcommit: 9eda79ea41c60d58a4ceab63d424d6866b38b82d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/30/2020
ms.locfileid: "96353159"
---
# <a name="test-your-knowledge-base-in-qna-maker"></a>Тестирование базы знаний в QnA Maker

Тестирование базы знаний QnA Maker является важной частью итерационного процесса для повышения точности возвращаемых ответов. Вы можете протестировать базу знаний через расширенный интерфейс чата, который также позволяет вносить правки.

## <a name="interactively-test-in-qna-maker-portal"></a>Интерактивный тест на портале QnA Maker

# <a name="qna-maker-ga-stable-release"></a>[Общедоступная версия QnA Maker (стабильный выпуск)](#tab/v1)

1. Получите доступ к базе знаний, выбрав ее имя на странице **Мои базы знаний**.
1. Чтобы открыть выдвигающуюся панель тестирования, щелкните **Тестировать** на верхней панели приложения.
1. Введите запрос в текстовом поле и нажмите клавишу ВВОД.
1. Ответ наилучшего соответствия из базы знаний возвращается как отклик.

### <a name="clear-test-panel"></a>Очистка панели тестирования

Чтобы очистить все введенные тестовые запросы и их результаты из консоли тестирования, выберите **Начать сначала** в левом верхнем углу панели тестирования.

### <a name="close-test-panel"></a>Закрытие панели тестирования

Чтобы закрыть панель тестирования, еще раз нажмите кнопку **Тестировать**. При открытой панели тестирования нельзя изменить содержимое базы знаний.

### <a name="inspect-score"></a>Проверка оценки

Проверка сведений в результате тестирования выполняется на панели проверки.

1.  На открытой выдвигающейся панели тестирования нажмите кнопку **Проверка** для получения более подробной информации об этом ответе.

    ![Проверка ответов](../media/qnamaker-how-to-test-knowledge-bases/inspect.png)

2.  Появится панель проверки. На панели находится намерение с высокой оценкой, а также любые идентифицированные сущности. На панели отображается результат выбранного высказывания.

### <a name="correct-the-top-scoring-answer"></a>Исправьте ответы с высокой оценкой

Если ответы с высокой оценкой неверны, выберите правильный ответ из списка и нажмите **Сохранить и Обучать**.

![Исправьте ответы с высокой оценкой](../media/qnamaker-how-to-test-knowledge-bases/choose-answer.png)

### <a name="add-alternate-questions"></a>Добавление альтернативных вопросов

Можно добавить альтернативные формы вопроса для данного ответа. Введите альтернативные ответы в текстовом поле и нажмите клавишу ВВОД, чтобы добавить их. Для сохранения обновлений выберите **Сохранить и Обучать**.

![Добавление альтернативных вопросов](../media/qnamaker-how-to-test-knowledge-bases/add-alternate-question.png)

### <a name="add-a-new-answer"></a>Добавление нового ответа

Можно добавить новый ответ, если любой из существующих ответов, которые были сопоставлены, неверный или не существует ответа в базе знаний (в КБ нет хорошего совпадения).

В нижней части списка ответов используйте текстовое поле, чтобы ввести новый ответ, и нажмите клавишу ВВОД, чтобы добавить его.

Для сохранения этого ответа выберите **Сохранить и Обучать**. Новая пара вопросов и ответов теперь будет добавлена в базу знаний.

> [!NOTE]
> Все изменения в базе знаний сохраняются только при нажатии кнопки **Сохранить и Обучать**.

# <a name="qna-maker-managed-preview-release"></a>[Управляемая служба QnA Maker (предварительный выпуск)](#tab/v2)

1. Получите доступ к базе знаний, выбрав ее имя на странице **Мои базы знаний**.
1. Чтобы открыть выдвигающуюся панель тестирования, щелкните **Тестировать** на верхней панели приложения. 
1. В верхней части экрана появится флажок **короткий ответ**, который выбран по умолчанию. Этот параметр используется для включения обнаружения диапазона ответов на основе нормативных требований на панели тестирования. 
1. Введите запрос в текстовом поле и нажмите клавишу ВВОД. 
1. Для каждого запроса, если имеется точный ответ или короткий ответ, представленный в ответе, а также наиболее подходящий ответ, который присутствует в базе знаний, вы также получите короткий ответ на запрос.
    ![Область тестирования с поддержкой управления](../media/qnamaker-how-to-test-knowledge-bases/test-pane-with-managed-detail.png)
1. Если отменить выбор **краткого ответа**, то в качестве ответа будет возвращен только наиболее подходящий ответ из базы знаний.

### <a name="clear-test-panel"></a>Очистка панели тестирования

Чтобы очистить все введенные тестовые запросы и их результаты из консоли тестирования, выберите **Начать сначала** в левом верхнем углу панели тестирования.

### <a name="close-test-panel"></a>Закрытие панели тестирования

Чтобы закрыть панель тестирования, еще раз нажмите кнопку **Тестировать**. При открытой панели тестирования нельзя изменить содержимое базы знаний.

### <a name="inspect-score"></a>Проверка оценки

Проверка сведений в результате тестирования выполняется на панели проверки.

1.  На открытой выдвигающейся панели тестирования нажмите кнопку **Проверка** для получения более подробной информации об этом ответе.

    ![Просмотр предварительной версии ответов](../media/qnamaker-how-to-test-knowledge-bases/inspect-with-managed.png)

2.  Появится панель проверки. На панели находится намерение с высокой оценкой, а также любые идентифицированные сущности. На панели отображается результат выбранного высказывания.
3. На панели отображается оценка достоверности ответа, а также обнаруженная оценка диапазона ответов.

### <a name="correct-the-top-scoring-answer"></a>Исправьте ответы с высокой оценкой

Если ответы с высокой оценкой неверны, выберите правильный ответ из списка и нажмите **Сохранить и Обучать**.

![Исправление предварительной версии ответа на вопрос с наибольшим результатом оценки](../media/qnamaker-how-to-test-knowledge-bases/choose-answer-managed.png)

### <a name="add-alternate-questions"></a>Добавление альтернативных вопросов

Можно добавить альтернативные формы вопроса для данного ответа. Введите альтернативные ответы в текстовом поле и нажмите клавишу ВВОД, чтобы добавить их. Для сохранения обновлений выберите **Сохранить и Обучать**.

![Добавление альтернативных вопросов (Предварительная версия)](../media/qnamaker-how-to-test-knowledge-bases/add-alternate-question-with-managed.png)

### <a name="add-a-new-answer"></a>Добавление нового ответа

Можно добавить новый ответ, если любой из существующих ответов, которые были сопоставлены, неверный или не существует ответа в базе знаний (в КБ нет хорошего совпадения).

В нижней части списка ответов используйте текстовое поле, чтобы ввести новый ответ, и нажмите клавишу ВВОД, чтобы добавить его.

Для сохранения этого ответа выберите **Сохранить и Обучать**. Новая пара вопросов и ответов теперь будет добавлена в базу знаний.

---

### <a name="test-the-published-knowledge-base"></a>Тестирование опубликованной базы знаний

Опубликованную версию базы знаний можно проверить на панели тестирования. После публикации базы знаний выберите поле **опубликованная база знаний** и отправьте запрос, чтобы получить результаты из ОПУБЛИКОВАННОЙ базы знаний.

![Проверка на соответствие опубликованной базе знаний](../media/qnamaker-how-to-test-knowledge-bases/test-against-published-knowledge-base.png)

## <a name="batch-test-with-tool"></a>Пакетный тест с помощью инструмента

Используйте средство пакетного тестирования, если вы хотите:

* определение верхнего ответа и оценки набора вопросов
* Проверка ожидаемого ответа на набор вопросов

### <a name="prerequisites"></a>Предварительные требования

* Подписка Azure — [создайте бесплатную учетную запись](https://azure.microsoft.com/free/cognitive-services/).
* [Создайте новую службу QnA Maker](../Quickstarts/create-publish-knowledge-base.md) или используйте существующую, в которой применяется английский язык.
* Скачайте [файл `.docx` с многоэтапным запросом](https://github.com/Azure-Samples/cognitive-services-sample-data-files/blob/master/qna-maker/data-source-formats/multi-turn.docx).
* Скачайте [средство пакетного тестирования](https://aka.ms/qnamakerbatchtestingtool) и извлеките исполняемый файл из файла `.zip`.

### <a name="sign-into-qna-maker-portal"></a>Вход на портал QnA Maker

[Войдите](https://www.qnamaker.ai/) на портал QnA Maker.

### <a name="create-a-new-knowledge-base-from-the-multi-turn-sampledocx-file"></a>Создание новой базы знаний из файла sample.docx с многоэтапным запросом

1. Щелкните **Create a knowledge base** (Создать базу знаний) на панели инструментов.
1. Пропустите **шаг 1**, так как ресурс QnA Maker у вас уже есть. Перейдите к **шагу 2**, чтобы выбрать сведения об существующем ресурсе:
    * идентификатор Azure Active Directory;
    * имя подписки Azure;
    * имя службы Azure QnA;
    * язык (английский).
1. В качестве имени для базы знаний введите значение `Multi-turn batch test quickstart`.

1. На **шаге 4** настройте параметры, используя значения из приведенной ниже таблицы.

    |Параметр|Значение|
    |--|--|
    |**Enable multi-turn extraction from URLs, .pdf or .docx files** (Включить многоэтапное извлечение из URL-адресов, файлов .pdf или .docx)|Флажок установлен|
    |**Текст ответа по умолчанию**| `Batch test - default answer not found.`|
    |**+ Добавить файл**|Выберите скачанный файл `.docx`, который указан в списке необходимых компонентов.|
    |**Chit-chat** (Беседа)|Выберите значение **Professional** (Профессиональная)|

1. На **шаге 5** щелкните **Create your KB** (Создать базу знаний).

    Когда процесс создания завершится, портал отобразит доступную для редактирования базу знаний.

### <a name="save-train-and-publish-knowledge-base"></a>Сохранение, обучение и публикация базы знаний

1. Щелкните **Save and Train** (Сохранить и обучить) на панели инструментов, чтобы сохранить базу знаний.
1. Щелкните **Publish** (Опубликовать) на панели инструментов, а затем снова щелкните **Publish** (Опубликовать), чтобы опубликовать базу знаний. Публикация делает базу знаний доступной для запросов по URL-адресу общедоступной конечной точки. Когда публикация завершится, сохраните сведения об URL-адресе узла и ключе конечной точки, которые отображаются на странице **Publish** (Публикация).

    |Требуемые данные| Пример|
    |--|--|
    |Узел публикации|`https://YOUR-RESOURCE-NAME.azurewebsites.net`|
    |Ключ публикации|`XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX` (строка длиной 32 символа, которая отображается после `Endpoint`)|
    |Идентификатор приложения API.|`xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` (строка длиной 36 символов, которая отображается в составе `POST`) |

### <a name="create-batch-test-file-with-question-ids"></a>Создание файла пакетного теста с идентификаторами вопросов

Чтобы использовать средство пакетного тестирования, создайте в текстовом редакторе файл с именем `batch-test-data-1.tsv`. Этот файл должен быть в формате UTF-8 и содержать следующие столбцы, разделенные знаками табуляции.

|Поля входного файла с разделением знаками табуляции|Примечания|Пример|
|--|--|--|
|Идентификатор базы знаний|Идентификатор базы знаний, представленный на странице публикации. Вы можете тестировать сразу несколько баз знаний в одной службе, используя один файл с несколькими идентификаторами базы знаний.|`xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` (строка длиной 36 символов, которая отображается в составе `POST`) |
|Вопрос|Текст вопроса, который будет вводить пользователь. Не более 1000 символов|`How do I sign out?`|
|Теги метаданных|необязательный|`topic:power` использует `key:value` Формат|
|Наилучший вариант|необязательный|`25`|
|Идентификатор ожидаемого ответа|необязательный|`13`|

Для этой базы знаний добавьте в файл три строки только двух обязательных столбцов. Первый столбец содержит идентификатор базы знаний, а второй — следующий список вопросов:

|Столбец 2: вопросы|
|--|
|`Use Windows Hello to sign in`|
|`Charge your Surface Pro 4`|
|`Get to know Windows 10`|

Эти вопросы точно дублируют фразы из базы знаний и должны возвращать оценки достоверности 100.

Затем добавьте несколько вопросов, аналогичных указанным на этих вопросах, но не точно так же, как в трех других строках, используя один и тот же идентификатор базы знаний:

|Столбец 2: вопросы|
|--|
|`What is Windows Hello?`|
|`How do I charge the laptop?`|
|`What features are in Windows 10?`|

> [!CAUTION]
> Следите за тем, чтобы каждый столбец отделялся только знаком табуляции. Все начальные или конечные пробелы будут считаться частью данных столбца, что приведет к созданию исключений из-за несовпадения типа или размера.

Файл пакетного теста, открытый в программе Excel, должен выглядеть как на следующем рисунке. Идентификатор базы знаний здесь заменен для безопасности строкой `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`. Для вашего пакетного теста здесь должен быть реальный идентификатор базы знаний.

> [!div class="mx-imgBorder"]
> ![Первая версия входного файла .tsv для пакетного теста](../media/batch-test/batch-test-1-input.png)

### <a name="test-the-batch-file"></a>Выполните тестирование с пакетным файлом

Запустите программу пакетного тестирования, выполнив следующую команду CLI в командной строке.

Замените значения `YOUR-RESOURCE-NAME` и `ENDPOINT-KEY` реальными значениями имени службы и ключа конечной точки. Их вы можете найти на странице **Settings** (Параметры) портала QnA Maker.

```console
batchtesting.exe batch-test-data-1.tsv https://YOUR-RESOURCE-NAME.azurewebsites.net ENDPOINT-KEY out.tsv
```
Выполняемый тест создаст файл `out.tsv`:

> [!div class="mx-imgBorder"]
> ![Первая версия выходного файла .tsv пакетного теста](../media/batch-test/batch-test-1-output.png)

Идентификатор базы знаний здесь заменен для безопасности строкой `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`. В результатах вашего пакетного теста этот столбец содержит реальный идентификатор базы знаний.

Тестовый вывод оценки достоверности, в четвертом столбце, показывает три первых вопроса, которые возвращали оценку 100, как ожидалось, так как каждый вопрос точно совпадает с тем, который отображается в базе знаний. Последние три вопроса с новым словом вопроса не возвращают 100 в качестве оценки достоверности. Чтобы увеличить эту оценку в результатах теста и в реальных запросах пользователей, следует добавить в базу знаний дополнительные вопросы.

### <a name="testing-with-the-optional-fields"></a>Тестирование с необязательными полями

Разобравшись с форматом и процессом тестирования, вы сможете создать файл для выполнения в базе знаний из произвольного источника данных, например из журналов чатов.

Благодаря автоматизации источника данных и процесса тестовый файл можно выполнять много раз с разными параметрами, чтобы найти наиболее подходящие значения.

Например, если у вас есть журнал чата и вы хотите определить, как соотносятся строки текста из этого журнала и поля метаданных, создайте файл теста и укажите поля метаданных для каждой строки. Запустите тест и проверьте, какие строки соответствуют метаданным. Как правило, совпадения будут положительными, но обязательно проверьте и ложноположительные результаты. Ложноположительным результатом называется строка, которая обозначена как соответствующая метаданным, но содержит текст, который не должен им соответствовать.

### <a name="using-optional-fields-in-the-input-batch-test-file"></a>Использование необязательных полей во входном файле пакетного теста

Следующая схема поможет вам понять, как найти значения полей для необязательных данных.

|Номер столбца|Необязательный столбец|Расположение данных|
|--|--|--|
|3|метаданные|Экспортировать существующую базу знаний для существующих `key:value` пар.|
|4|top|Мы рекомендуем использовать значение по умолчанию `25`.|
|5|Идентификатор набора вопросов и ответов|Экспортируйте существующую базу знаний, чтобы получить значения идентификаторов. Также обратите внимание на идентификаторы, которые возвращаются в выходном файле.|

### <a name="add-metadata-to-the-knowledge-base"></a>Добавление метаданных в базу знаний

1. На портале QnA на странице **Edit** (Правка) добавьте метаданные `topic:power` к следующим вопросам.

    |Вопросы|
    |--|
    |Charge your Surface Pro 4|
    |Check the battery level|

    Две пары "вопрос — ответ" с указанными метаданными.

    > [!TIP]
    > Чтобы получить метаданные и идентификаторы QnA для каждого набора, экспортируйте базу знаний. Перейдите на страницу **Settings** (Параметры), а затем щелкните **Export** (Экспортировать), чтобы получить файл `.xls`. Найдите этот скачанный файл и откройте его в Excel для просмотра метаданных и идентификатора.

1. Выберите действие **Save and train** (Сохранить и обучить), а затем откройте страницу **Publish** (Публикация) и нажмите кнопку **Publish** (Опубликовать). После этих действий изменения станут доступными для пакетного теста. Скачайте базу знаний на странице **Settings** (Параметры).

    В скачанном файле метаданные имеют правильный формат и правильные идентификаторы набора вопросов и ответов. Эти поля применяются в следующем разделе

    > [!div class="mx-imgBorder"]
    > ![Экспортированная база знаний с метаданными](../media/batch-test/exported-knowledge-base-with-metadata.png)

### <a name="create-a-second-batch-test"></a>Создание второго пакетного теста

Существуют два основных сценария пакетного тестирования:
* **Обработка файлов журнала чата** позволяет найти наилучший ответ на вопрос, который ранее не встречался. Чаще всего это нужно при обработке файла журнала с запросами, например с вопросами пользователей боту в чате. Создайте файл пакетного теста, содержащий только обязательные столбцы. Этот тест возвращает самый подходящий ответ для каждого вопроса. Но самый подходящий ответ не всегда будет правильным. После завершения этого теста перейдите к проверочному тесту.
* **Проверочный тест** проверяет ожидаемые ответы. Этот тест предполагает проверку всех вопросов и соответствующих ожидаемых ответов в пакетном тесте. Обычно для этого нужно выполнить некоторую работу вручную.

В следующей процедуре предполагается, что мы обрабатываем журналы разговора

1. Создайте новый файл пакетного теста и включите в него необязательные данные `batch-test-data-2.tsv`. Добавьте шесть строк из исходного входного файла пакетного теста, а затем добавьте ИДЕНТИФИКАТОРы метаданных, верхней и QnA пар для каждой строки.

    Чтобы имитировать автоматическую проверку нового текста из журналов разговора на соответствие с базой знаний, для метаданных в каждом столбце задайте одно и то же значение `topic:power`.

    > [!div class="mx-imgBorder"]
    > ![Вторая версия входного файла .tsv для пакетного теста](../media/batch-test/batch-test-2-input.png)

1. Запустите тест еще раз, изменив имена входного и выходного файлов, чтобы указать, что это второй тест.

    > [!div class="mx-imgBorder"]
    > ![Вторая версия выходного файла .tsv для пакетного теста](../media/batch-test/batch-test-2-output.png)

### <a name="test-results-and-an-automated-test-system"></a>Результаты тестирования и автоматизированная система тестирования

Этот выходной файл теста можно анализировать в автоматизированном конвейере непрерывного тестирования.

Выходные данные в нашем примере следует понимать следующим образом: каждая строка фильтруется по метаданным, которые не соответствуют метаданным в базе знаний, поэтому для каждой несовпадающей строки возвращается ответ по умолчанию, информирующий о том, что в базе знаний не найдено хорошего совпадения. Из совпадающих строк возвращается идентификатор и оценка QnA.

Все строки здесь отмечены как неправильные, так как все они не соответствует ожидаемому идентификатору ответа.

Теперь вы знаете, что можно взять журнал чата и применить текст каждой строки из него в качестве запроса. Если у вас не было никаких сведений о данных, эти результаты предоставят много полезной информации, на основе которой вы сможете двигаться далее:

* метаданные
* идентификатор QnA
* score

Была ли полезной фильтрация по метаданным для тестирования? И да, и нет. Тестовая система должна создавать тестовые файлы для каждой пары метаданных, а также тест без пар метаданных.

### <a name="clean-up-resources"></a>Очистка ресурсов

Если вы не собираетесь продолжать тестирование базы знаний, удалите средство пакетного тестирования и тестовые файлы.

Если вы не собираетесь использовать эту базу знаний, удалите все связанные с ней ресурсы, выполнив следующие действия.

1. На портале QnA Maker щелкните **My Knowledge bases** (Мои базы знаний) в меню сверху.
1. В списке баз знаний щелкните значок **Delete** (Удалить) в строке той базы знаний, которую вы создали для этого краткого руководства.

[Справочная документация по этому средству](../reference-tsv-format-batch-testing.md) включает:

* пример командной строки средства
* Формат входных и файловых файлов TSV

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Публикация базы знаний](../quickstarts/create-publish-knowledge-base.md)