---
title: Обновление команды из клиентского приложения
titleSuffix: Azure Cognitive Services
description: Узнайте, как обновить команду в клиентском приложении.
services: cognitive-services
author: encorona-ms
manager: yetian
ms.service: cognitive-services
ms.subservice: speech-service
ms.topic: conceptual
ms.date: 10/20/2020
ms.author: encorona
ms.openlocfilehash: 765bcbd0521f93bacb0799595e6fbef565d0f313
ms.sourcegitcommit: cd9754373576d6767c06baccfd500ae88ea733e4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2020
ms.locfileid: "94963629"
---
# <a name="update-a-command-from-a-client-app"></a>Обновление команды из клиентского приложения

В этой статье вы узнаете, как обновить текущую команду из клиентского приложения.

## <a name="prerequisites"></a>Предварительные требования
> [!div class = "checklist"]
> * Предварительно [созданное приложение Пользовательских голосовых команд](quickstart-custom-commands-application.md).

## <a name="update-the-state-of-a-command"></a>Обновление состояния команды

Если клиентское приложение требует обновления состояния текущей команды без речевого ввода, можно отправить событие для обновления команды.

Чтобы проиллюстрировать этот сценарий, отправьте следующее действие события, чтобы обновить состояние текущей команды ( `TurnOnOff` ): 

```json
{
  "type": "event",
  "name": "RemoteUpdate",
  "value": {
    "updatedCommand": {
      "name": "TurnOnOff",
      "updatedParameters": {
        "OnOff": "on"
      },
      "cancel": false
    },
    "updatedGlobalParameters": {},
    "processTurn": true
  }
}
```

Давайте рассмотрим ключевые атрибуты этого действия:

| attribute | Объяснение |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------- |
| **type** | Действие имеет тип `"event"` , а имя события должно быть `"RemoteUpdate"` . |
| **value** | Атрибут `"value"` содержит атрибуты, необходимые для обновления текущей команды. |
| **упдатедкомманд** | Атрибут `"updatedCommand"` содержит имя команды. В этом атрибуте `"updatedParameters"` является картой с именами параметров и их обновленными значениями. |
| **cancel** | Если нужно отменить выполняемую команду, присвойте атрибуту значение `"cancel"` `true` . |
| **упдатедглобалпараметерс** | Атрибут `"updatedGlobalParameters"` является картой `"updatedParameters"` , как, но он используется для глобальных параметров. |
| **процесстурн** | Если требуется обработка после отправки действия, присвойте атрибуту значение `"processTurn"` `true` . |

Этот сценарий можно проверить на портале пользовательских команд:

1. Откройте созданное ранее приложение пользовательских команд. 
1. Выберите **обучение** , а затем — **тест**.
1. Отправить `turn` .
1. Откройте боковую панель и выберите **редактор действий**.
1. Введите и отправьте `RemoteCommand` событие, указанное в предыдущем разделе.
    > [!div class="mx-imgBorder"]
    > ![Снимок экрана, на котором показано событие для удаленной команды.](media/custom-commands/send-remote-command-activity.png)

Обратите внимание, что для параметра `"OnOff"` задано значение `"on"` через действие от клиента, а не речь или текст.

## <a name="update-the-catalog-of-the-parameter-for-a-command"></a>Обновление каталога параметра для команды

При настройке списка допустимых параметров для параметра значения для параметра определяются глобально для приложения. 

В нашем примере `SubjectDevice` параметр будет иметь фиксированный список поддерживаемых значений независимо от диалога.

Если вы хотите добавить новые записи в каталог параметра для каждого диалога, можно отправить следующее действие:

```json
{
  "type": "event",
  "name": "RemoteUpdate",
  "value": {
    "catalogUpdate": {
      "commandParameterCatalogs": {
        "TurnOnOff": [
          {
            "name": "SubjectDevice",
            "values": {
              "stereo": [
                "cd player"
              ]
            }
          }
        ]
      }
    },
    "processTurn": false
  }
}
```
С этим действием вы добавили запись для `"stereo"` в каталог параметра `"SubjectDevice"` в команде `"TurnOnOff"` .

> [!div class="mx-imgBorder"]
> :::image type="content" source="./media/custom-commands/update-catalog-with-remote-activity.png" alt-text="Снимок экрана, на котором показано обновление каталога.":::

Обратите внимание на несколько моментов.
- Это действие необходимо отправить только один раз (в идеале сразу же после запуска подключения).
- После отправки этого действия необходимо дождаться `ParameterCatalogsUpdated` отправки события обратно клиенту.

## <a name="add-more-context-from-the-client-application"></a>Добавление контекста из клиентского приложения

Можно задать дополнительный контекст из клиентского приложения для каждого диалога, который позже можно будет использовать в приложении пользовательских команд. 

Например, подумайте о сценарии, в котором вы хотите отправить идентификатор и имя устройства, подключенного к приложению пользовательских команд.

Чтобы протестировать этот сценарий, создадим новую команду в текущем приложении:
1. Создайте новую команду с именем `GetDeviceInfo` .
1. Добавьте пример предложения `get device info` .
1. В правиле завершения добавьте действие **Отправка речевого ответа** **, содержащее** атрибуты `clientContext` .
   ![Снимок экрана, на котором показан ответ на отправку речи с контекстом.](media/custom-commands/send-speech-response-context.png)
1. Сохраняйте, обучить и протестируйте приложение.
1. В окне тестирование отправьте действие для обновления контекста клиента.

    ```json
    {
       "type": "event",
       "name": "RemoteUpdate",
       "value": {
         "clientContext": {
           "deviceId": "12345",
           "deviceName": "My device"
         },
         "processTurn": false
       }
    }
    ```
1. Отправьте текст `get device info` .
   ![Снимок экрана, на котором показано действие для отправки контекста клиента.](media/custom-commands/send-client-context-activity.png)

Обратите внимание на несколько моментов.
- Это действие необходимо отправить только один раз (в идеале сразу же после запуска подключения).
- Для можно использовать сложные объекты `clientContext` .
- Можно использовать `clientContext` в речевых ответах для отправки действий и вызова конечных веб-точек.

## <a name="next-steps"></a>Следующие шаги

> [!div class="nextstepaction"]
> [Обновление команды из конечной точки в Интернете](./how-to-custom-commands-update-command-from-web-endpoint.md)
