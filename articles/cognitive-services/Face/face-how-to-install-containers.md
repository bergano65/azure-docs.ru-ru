---
title: Как устанавливать и запускать контейнеры
titlesuffix: Face - Cognitive Services - Azure
description: В этом пошаговом руководстве показано, как скачивать, устанавливать и выполнять контейнеры для API распознавания лиц.
services: cognitive-services
author: diberry
manager: cgronlun
ms.service: cognitive-services
ms.component: text-analytics
ms.topic: article
ms.date: 11/14/2018
ms.author: diberry
ms.openlocfilehash: 1d13e2ccbbc1d5c1bc80dffc260a3759fe378d7d
ms.sourcegitcommit: c8088371d1786d016f785c437a7b4f9c64e57af0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/30/2018
ms.locfileid: "52634546"
---
# <a name="install-and-run-containers"></a>Установка и запуск контейнеров

Контейнеризация — это подход к распространению программного обеспечения, в котором приложение или служба входит в состав образа контейнера. Конфигурация и зависимости приложения или службы включены в образ контейнера. Образ контейнера может быть развернут на узле контейнера с незначительной модификацией или без нее. Контейнеры изолированы друг от друга и от базовой операционной системы. При этом они расходуют меньше ресурсов, чем виртуальная машина. Контейнеры для краткосрочных задач можно создавать из образов контейнеров и удалять их, когда они станут ненужными.

API распознавания лиц предоставляет стандартный контейнер Linux для Docker с именем Face, который обнаруживает человеческие лица на изображениях и определяет методом машинного прогнозирования их характеристики, например черты лица (нос, глаза и т. д.), пол, возраст и многое другое. Кроме обнаружения лиц, API может сравнивать два лица на одном или на разных изображениях, используя оценку достоверности, а также искать по базе данных похожие или идентичные лица. Схожие лица можно упорядочивать в группы по близким визуальным характеристикам.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="preparation"></a>Подготовка

Прежде чем использовать контейнер распознавания лиц, необходимо выполнить следующие условия:

**Модуль Docker.** Модуль Docker нужно установить в локальной среде. Docker предоставляет пакеты для настройки среды с Docker для [macOS](https://docs.docker.com/docker-for-mac/), [Linux](https://docs.docker.com/engine/installation/#supported-platforms) и [Windows](https://docs.docker.com/docker-for-windows/). В Windows Docker должен быть настроен для поддержки контейнеров Linux. Контейнеры Docker также можно развертывать непосредственно в [Службе Azure Kubernetes](/azure/aks/), [Экземплярах контейнеров Azure](/azure/container-instances/) или в кластере [Kubernetes](https://kubernetes.io/), развернутом в [Azure Stack](/azure/azure-stack/). Дополнительные сведения о развертывании Kubernetes в Azure Stack см. в [этой статье](/azure/azure-stack/user/azure-stack-solution-template-kubernetes-deploy).

Docker нужно настроить таким образом, чтобы контейнеры могли подключать и отправлять данные о выставлении счетов в Azure.

**Опыт работы с Реестром контейнеров Майкрософт и Docker.** Требуется базовое представление о Реестре контейнеров Майкрософт и понятиях Docker, таких как реестры, репозитории, контейнеры и образы контейнеров, а также знание основных команд `docker`.  

Ознакомьтесь с [общими сведениями о Docker и контейнерах](https://docs.docker.com/engine/docker-overview/).

### <a name="server-requirements-and-recommendations"></a>Требования к серверу и рекомендации

Контейнеру распознавания лиц требуется как минимум 1 ядро ЦП частотой не менее 2,6 гигагерц (ГГц) и 4 гигабайт (ГБ) выделенной памяти, но рекомендуется как минимум 2 ядра ЦП и 6 ГБ выделенной памяти.

## <a name="request-access-to-the-private-container-registry"></a>Запрос доступа к частному реестру контейнеров

Прежде всего необходимо заполнить и отправить [форму запроса к контейнерам Cognitive Services Vision](https://aka.ms/VisionContainersPreview), чтобы запросить доступ к контейнеру распознавания лиц. В форме нужно указать сведения о себе, компании и пользовательском сценарии, для которого будет использоваться контейнер. Когда вы отправите форму, команда Azure Cognitive Services просмотрит ее, чтобы проверить, соблюдаются ли критерии доступа к частному реестру контейнеров.

> [!IMPORTANT]
> В форме необходимо указать электронный адрес, связанный с учетной записью Майкрософт или учетной записью Azure Active Directory (Azure AD).

Если ваш запрос будет утвержден, вы получите по электронной почте инструкции по получению учетных данных и доступа к частному реестру контейнеров.

## <a name="create-a-face-resource-on-azure"></a>Создание ресурса распознавания лиц в Azure

Чтобы использовать контейнер распознавания лиц, необходимо создать ресурс распознавания лиц в Azure. После создания ресурса вы можете использовать ключ подписки и URL-адрес конечной точки из ресурса, чтобы создать экземпляр контейнера. Дополнительные сведения о создании экземпляра контейнера см. в разделе [Создание экземпляра контейнера на основе скачанного образа контейнера](#instantiate-a-container-from-a-downloaded-container-image).

Выполните указанные ниже действия, чтобы создать ресурс распознавания лиц и получить сведения из него.

1. Создайте ресурс распознавания лиц на портале Azure.  
   Если вы хотите использовать контейнер распознавания лиц, необходимо сначала создать ресурс распознавания лиц на портале Azure. Дополнительные сведения см. в статье [Краткое руководство. Создание учетной записи Cognitive Services на портале Azure](../cognitive-services-apis-create-account.md).

1. Получите URL-адрес конечной точки и ключ подписки для ресурса Azure.  
   После создания ресурса Azure необходимо использовать URL-адрес конечной точки и ключ подписки из этого ресурса, чтобы создать экземпляр контейнера распознавания лиц. Вы можете скопировать URL-адрес конечной точки и ключ подписки на соответствующих страницах "Быстрое начало" и "Ключи" для ресурса "Распознавание лиц" на портале Azure.

## <a name="log-in-to-the-private-container-registry"></a>Вход в частный реестр контейнеров

Выполнить проверку подлинности с частным реестром контейнеров для контейнеров Cognitive Services можно несколькими способами, но мы рекомендуем использовать командную строку [Docker CLI](https://docs.docker.com/engine/reference/commandline/cli/).

Используйте команду [docker login](https://docs.docker.com/engine/reference/commandline/login/), как показано в приведенном ниже примере, чтобы войти в `containerpreview.azurecr.io` — частный реестр контейнеров Cognitive Services. Замените *\<username\>* на имя пользователя, а *\<password\>* — на пароль, предоставленные в учетных данных, полученных от команды Azure Cognitive Services.

```docker
docker login containerpreview.azurecr.io -u <username> -p <password>
```

Если вы сохранили свои учетные данные в текстовом файле, содержимое этого текстового файла можно сцепить с помощью команды `cat` в команду `docker login`, как показано в приведенном ниже примере. Замените *\<passwordFile\>* на путь и имя текстового файла, который содержит пароль, а *\<username\>* — на имя пользователя, предоставленное в учетных данных.

```docker
cat <passwordFile> | docker login containerpreview.azurecr.io -u <username> --password-stdin
```

## <a name="download-container-images-from-the-private-container-registry"></a>Скачивание образов контейнера из частного реестра контейнеров

Образ контейнера для создания контейнера распознавания лиц можно получить из частного реестра контейнеров Docker под названием `containerpreview.azurecr.io`, размещенного в Реестре контейнеров Azure. Образ контейнера распознавания лиц необходимо скачать из репозитория, чтобы запустить контейнер в локальной среде.

Используйте команду [docker pull](https://docs.docker.com/engine/reference/commandline/pull/), чтобы скачать образ контейнера из репозитория. Например, следующая команда скачивает из репозитория образ контейнера распознавания лиц последней версии:

```Docker
docker pull containerpreview.azurecr.io/microsoft/cognitive-services-face:latest
```

Полное описание доступных тегов для контейнера распознавания лиц см. в статье о [распознавании текста](https://go.microsoft.com/fwlink/?linkid=2018655) в Docker Hub.

> [!TIP]
> Используйте команду [docker images](https://docs.docker.com/engine/reference/commandline/images/), чтобы получить список скачанных образов контейнеров. Например, следующая команда возвращает таблицу со списком идентификаторов, репозиториев и тегов для каждого скачанного образа контейнера:
>
>  ```Docker
>  docker images --format "table {{.ID}}\t{{.Repository}}\t{{.Tag}}"
>  ```
>

## <a name="instantiate-a-container-from-a-downloaded-container-image"></a>Создание экземпляра контейнера на основе скачанного образа контейнера

Используйте команду [docker run](https://docs.docker.com/engine/reference/commandline/run/), чтобы создать экземпляр контейнера на основе скачанного образа контейнера. Например, эта команда выполняет следующие действия:

* создает экземпляр контейнера на основе образа контейнера распознавания лиц;
* выделяет два ядра ЦП и 6 гигабайт (ГБ) памяти;
* предоставляет TCP-порт 5000 и выделяет псевдотелетайп для контейнера;
* автоматически удаляет контейнер после завершения его работы.

```Docker
docker run --rm -it -p 5000:5000 --memory 6g --cpus 2 containerpreview.azurecr.io/microsoft/cognitive-services-face Eula=accept Billing=https://westus.api.cognitive.microsoft.com/face/v1.0 ApiKey=0123456789
```

> [!IMPORTANT]
> Для создания экземпляра контейнера необходимо указать параметры `Eula`, `Billing` и `ApiKey`. В противном случае контейнер не запустится.  Дополнительные сведения см. в [разделе о выставлении счетов](#billing).

После создания экземпляра вы можете вызывать операции из контейнера с помощью URI узла контейнера. Например, следующий URI узла представляет контейнер распознавания лиц, созданный в предыдущем примере:

```http
http://localhost:5000/
```

> [!TIP]
> Вы можете открыть [спецификацию OpenAPI](https://swagger.io/docs/specification/about/) (прежнее название — спецификация Swagger), где описаны операции, поддерживаемые экземпляром контейнера, по относительному URI `/swagger` для этого контейнера. Например, следующий URI представляет доступ к спецификации OpenAPI для контейнера распознавания лиц, созданного в предыдущем примере:
>
>  ```http
>  http://localhost:5000/swagger
>  ```

Вы можете [вызвать операции REST API](https://docs.microsoft.com/azure/cognitive-services/face/face-api-how-to-topics/howtodetectfacesinimage), доступные в контейнере, либо использовать клиентскую библиотеку [пакета SDK Распознавания лиц для Azure Cognitive Services](https://www.nuget.org/packages/Microsoft.Azure.CognitiveServices.Vision.Face/) для вызова этих операций.  
> [!IMPORTANT]
> Для использования клиентской библиотеки в контейнере вам нужен пакет SDK Распознавания лиц для Azure Cognitive Services версии 2.0 или более поздней.

Единственное различие между вызовом заданной операции из контейнера и вызовом той же операции из соответствующей службы в Azure — это использование URI узла контейнера, а не узла URI региона Azure. Например, если вы хотите использовать экземпляр Распознавания лиц, выполняемый в регионе Azure "Западная часть США", необходимо вызывать следующую операцию REST API:

```http
POST https://westus.api.cognitive.microsoft.com/face/v1.0/detect
```

Если вы хотите использовать контейнер распознавания лиц, выполняемый на локальном контейнере с конфигурацией по умолчанию, необходимо вызвать следующую операцию REST API:

```http
POST http://localhost:5000/face/v1.0/detect
```

### <a name="billing"></a>Выставление счетов

Контейнер распознавания лиц отправляет в Azure данные для выставления счетов, используя соответствующий ресурс распознавания лиц в учетной записи Azure. Следующие параметры командной строки используются контейнерами распознавания лиц в целях выставления счетов:

| Параметр | ОПИСАНИЕ |
|--------|-------------|
| `ApiKey` | Ключ API ресурса распознавания лиц, используемый для отслеживания информации о выставлении счетов.<br/>Этому параметру следует присвоить значение ключа API для подготовленного ресурса распознавания лиц в Azure, который можно получить в `Billing`. |
| `Billing` | Конечная точка ресурса распознавания лиц, используемого для отслеживания сведений о выставлении счетов.<br/>Этому параметру следует присвоить адрес конечной точки URI подготовленного ресурса распознавания лиц в Azure.|
| `Eula` | Указывает, что вы приняли условия лицензии для контейнера.<br/>Для этого параметра следует задать значение `accept`. |

> [!IMPORTANT]
> Для всех трех параметров необходимо задать допустимые значения. В противном случае контейнер не запустится.

Дополнительные сведения об этих параметрах см. в статье [Настройка контейнеров](face-resource-container-config.md).

## <a name="summary"></a>Сводка

В этой статье мы рассмотрели основные понятия и рабочий процесс для скачивания, установки и выполнения контейнеров распознавания лиц. В разделе "Сводка" сделайте следующее.

* API распознавания лиц предоставляет стандартный контейнер Linux для Docker с именем Face, который обнаруживает лица по базе данных с изображениями людей.
* Образы контейнеров скачиваются из частного реестра контейнеров в Azure.
* Образы контейнеров выполняются в Docker.
* Зная URI узла контейнера, вы можете применить пакет SDK или REST API для вызова операций из контейнера распознавания лиц.
* При создании экземпляра контейнера нужно указать данные для выставления счетов.
* ** Контейнеры Cognitive Services не лицензируются для запуска без подключения к Azure для отслеживания использования. Клиенты должны разрешить контейнерам непрерывную передачу данных для выставления счетов в службу контроля потребления. Контейнеры Cognitive Services не отправляют в корпорацию Майкрософт данные клиента (например, анализируемые изображения или тексты).  

## <a name="next-steps"></a>Дополнительная информация

* Ознакомьтесь со статьей о [конфигурации контейнеров](face-resource-container-config.md).
* Изучите описание [API распознавания лиц](Overview.md), чтобы получить дополнительные сведения об обнаружении и идентификации лиц.  
* Дополнительные сведения о методах, поддерживаемых контейнером, см. в статье [об API распознавания лиц](//westus.dev.cognitive.microsoft.com/docs/services/563879b61984550e40cbbe8d/operations/563879b61984550f30395236).
* Чтобы решить проблемы, связанные с функциональностью API распознавания лиц, ознакомьтесь с [часто задаваемыми вопросами](FAQ.md).
