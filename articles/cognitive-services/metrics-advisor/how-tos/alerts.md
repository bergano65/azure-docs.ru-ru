---
title: Настройка оповещений помощника по метрикам
titleSuffix: Azure Cognitive Services
description: Настройка оповещений Advisor с помощью перехватчиков для электронной почты, Интернета и Azure DevOps.
services: cognitive-services
author: mrbullwinkle
manager: nitinme
ms.service: cognitive-services
ms.subservice: metrics-advisor
ms.topic: conceptual
ms.date: 09/14/2020
ms.author: mbullwin
ms.openlocfilehash: 30d8fdf99da7a4854db0985bed6256ecd6f7a366
ms.sourcegitcommit: 7cc10b9c3c12c97a2903d01293e42e442f8ac751
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2020
ms.locfileid: "93420926"
---
# <a name="how-to-configure-alerts-and-get-notifications-using-a-hook"></a>Инструкции: Настройка оповещений и получение уведомлений с помощью обработчика

После обнаружения аномалии помощником по метрикам на основе параметров оповещений будет активировано уведомление о предупреждении с помощью обработчика. Параметр предупреждения можно использовать с несколькими конфигурациями обнаружения. для настройки правила генерации оповещений доступны различные параметры.

## <a name="create-a-hook"></a>Создание обработчика

Советник по метрикам поддерживает три различных типа обработчиков: обработчик электронной почты, веб-перехватчик и Azure DevOps. Вы можете выбрать ту, которая подходит для конкретного сценария.       

### <a name="email-hook"></a>Обработчик сообщений электронной почты

> [!Note]
> Администраторы ресурсов помощника по метрикам должны настроить параметры электронной почты и ввести данные, связанные с SMTP, в помощник по метрикам, прежде чем можно будет отправлять оповещения об аномалиях. Администратору группы ресурсов или администратору подписки необходимо назначить по крайней мере одну роль *администратора Advisor Cognitive Services метрик* на вкладке Управление доступом ресурса Advisor. Дополнительные [сведения о настройке параметров электронной почты](../faq.md#how-to-set-up-email-settings-and-enable-alerting-by-email).

Чтобы создать обработчик электронной почты, доступны следующие параметры. 

Обработчик электронной почты — это канал для отправки оповещений об аномалиях на адреса электронной почты, указанные в разделе **Email to** . Будут отправлены два типа оповещений: *веб-канал данных недоступен* , и *отчеты об инцидентах* , содержащие одну или несколько аномалий. 

|Параметр |Описание  |
|---------|---------|
| name | Имя обработчика электронной почты |
| Отправить по электронной почте| Адреса электронной почты, на которые будет отправляться оповещение|
| Внешняя ссылка | Необязательное поле, которое позволяет настроить перенаправление, например для устранения неполадок. |
| Название предупреждения настраиваемой аномалии | Шаблон заголовка поддерживает `${severity}` , `${alertSettingName}` , `${datafeedName}` , `${metricName}` , `${detectConfigName}` , `${timestamp}` , `${topDimension}` , `${incidentCount}` , `${anomalyCount}`

После нажатия кнопки **ОК** будет создан обработчик электронной почты. Его можно использовать в любых параметрах оповещений для получения оповещений об аномалиях. 

### <a name="web-hook"></a>Веб-перехватчик

> [!Note]
> * Используйте метод запроса **POST** .
> * Текст запроса будет должен выглядеть следующим образом:  
    `{"timestamp":"2019-09-11T00:00:00Z","alertSettingGuid":"49635104-1234-4c1c-b94a-744fc920a9eb"}`
> * При создании или изменении веб-перехватчика API будет вызываться как тест с пустым текстом запроса. API должен возвращать код HTTP 200.

Веб-перехватчик — это точка входа для всей информации, доступной в службе Advisor, и вызывает предоставляемый пользователем API при активации оповещения. Все оповещения можно отправлять через веб-перехватчик.

Чтобы создать веб-перехватчик, необходимо добавить следующие сведения:

|Параметр |Описание  |
|---------|---------|
|Конечная точка     | Адрес API, вызываемый при активации оповещения.        |
|Имя пользователя и пароль | Для проверки подлинности на адресе API. Если проверка подлинности не требуется, оставьте этот черный.         |
|Header     | Пользовательские заголовки в вызове API.        |

:::image type="content" source="../media/alerts/create-web-hook.png" alt-text="окно создания веб-перехватчика.":::

При отправке уведомления через веб-перехватчик можно использовать следующие интерфейсы API для получения сведений о предупреждении. Задайте *метку времени* и *АЛЕРТСЕТТИНГГУИД* в службе API, которая передается в, а затем используйте следующие запросы: 
- `query_alert_result_anomalies`
- `query_alert_result_incidents`

### <a name="azure-devops"></a>Azure DevOps

Помощник по метрикам также поддерживает автоматическое создание рабочего элемента в Azure DevOps для наблюдения за проблемами и ошибками при обнаружении аномалий. Все оповещения можно отправлять с помощью перехватчиков Azure DevOps.

Чтобы создать перехватчик Azure DevOps, необходимо добавить следующие сведения.

|Параметр |Описание  |
|---------|---------|
| name | Имя для обработчика |
| План | Организация, к которой принадлежит ваш DevOps |
| Project | Конкретный проект в DevOps. |
| Маркер доступа |  Токен для проверки подлинности в DevOps. | 

> [!Note]
> Необходимо предоставить разрешения на запись, если помощник по метрикам должен создавать рабочие элементы на основе оповещений об аномалиях. После создания обработчиков их можно использовать в любых параметрах оповещений. Управление обработчиками на странице **Параметры перехватчика** .

## <a name="add-or-edit-alert-settings"></a>Добавление или изменение параметров оповещений

Перейдите на страницу сведений метрики, чтобы найти раздел **Параметры оповещений** , в нижнем левом углу страницы сведений метрики. В нем перечислены все параметры оповещений, относящиеся к выбранной конфигурации обнаружения. При создании новой конфигурации обнаружения нет параметров оповещений, и оповещения не будут отправляться.  
Для изменения параметров оповещений можно использовать значки **Добавить** , **изменить** и **Удалить** .

:::image type="content" source="../media/alerts/alert-setting.png" alt-text="Пункт меню параметров оповещений.":::

Нажмите кнопку **Добавить** или **изменить** , чтобы открыть окно для добавления или изменения параметров оповещений.

:::image type="content" source="../media/alerts/edit-alert.png" alt-text="Добавление или изменение параметров оповещений":::

**Имя параметра предупреждения** : имя этого параметра оповещения. Он будет отображаться в заголовке оповещения по электронной почте.

**Перехватчики** : список обработчиков для отправки предупреждений.

Раздел, отмеченный на снимке экрана выше, — это параметры для одного обнаружения конфигурации. Для разных конфигураций обнаружения можно задать различные параметры оповещений. Выберите целевую конфигурацию, используя третий раскрывающийся список в этом окне. 

### <a name="filter-settings"></a>Настройки фильтра 

Ниже приведены параметры фильтра для одной конфигурации обнаружения.

**Оповещение для** имеет 4 варианта фильтрации аномалий:

* **Аномалии во всех рядах** : все аномалии будут включаться в оповещение.         
* **Аномалии в группе рядов** : Фильтрация рядов по значениям измерений. Задание определенных значений для некоторых измерений. Аномалии будут включаться в предупреждение только тогда, когда ряд соответствует указанному значению.       
* **Аномалии в избранном ряде** : в оповещение будут включаться только ряды, помеченные как избранные.        |
* **Аномалии в N-м всех рядах** : Этот фильтр предназначен только для ряда, значение которого находится в верхнем n. Мы рассмотрим несколько меток времени и проверяем, находится ли значение ряда в этой метке Top N. Если число "по верхнему n" превышает указанное число, аномалия будет включена в предупреждение.        |

**Параметры фильтрации аномалий** — это дополнительный фильтр со следующими параметрами:

- **серьезность** . аномалия будет включена только в том случае, если серьезность аномалии находится в указанном диапазоне.
- **Отложить** : остановить оповещения для аномалий в следующих N пунктах (период) при срабатывании предупреждения.
    - **отложить тип** : Если задано значение **ряды** , активируемая аномалия будет отложить только свои ряды. Для **метрики** одна активируемая аномалия будет отложить все ряды в этой метрике.
    - **номер откладывание** : количество точек (период), которые нужно отложить.
    - **Сброс для неуспешных** : Если этот флажок установлен, активированная аномалия отменяет только следующие n последовательных аномалий. Если одна из следующих точек данных не является аномалией, откладывание будет сбрасываться с этого момента; Если не выбрано, одна из активированных аномалий отменяет следующие n точек (период), даже если последующие точки данных не являются аномалиями.
- **значение** (необязательно): Фильтрация по значению. Будут включаться только те значения, которые соответствуют условию, аномалию. При использовании соответствующего значения другой метрики имена измерений двух метрик должны быть одинаковыми.

В оповещении будут отправляться аномалии, которые не отфильтрованы.

### <a name="add-cross-metric-settings"></a>Добавить параметры перекрестной метрики

Щелкните **+ Добавить параметры перекрестной метрики** на странице Параметры оповещений, чтобы добавить другой раздел.

Селектор **оператора** является логической связью каждого раздела, чтобы определить, отправляет ли они предупреждение.


|Оператор  |Описание  |
|---------|---------|
|AND     | Отправлять оповещение следует только в том случае, если ряд соответствует каждому разделу оповещения, а все точки данных являются аномалиями. Если метрики имеют различные имена измерений, предупреждение никогда не будет срабатывать.         |
|ИЛИ     | Отправляйте оповещение, если хотя бы один раздел содержит аномалии.         |

:::image type="content" source="../media/alerts/alert-setting-operator.png" alt-text="Оператор для нескольких разделов параметров предупреждений":::

## <a name="next-steps"></a>Дальнейшие шаги

- [Настройка обнаружения аномалий с помощью обратной связи](anomaly-feedback.md)
- [Диагностика инцидента](diagnose-incident.md).
- [Настройка метрик и детальная настройка конфигурации обнаружения](configure-metrics.md)