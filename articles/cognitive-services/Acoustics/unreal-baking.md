---
title: Руководство по моделированию Project Acoustics в Unreal
titlesuffix: Azure Cognitive Services
description: В этом документе описывается процесс акустической обработки с помощью расширения редактора Unreal.
services: cognitive-services
author: kegodin
manager: nitinme
ms.service: cognitive-services
ms.subservice: acoustics
ms.topic: tutorial
ms.date: 03/20/2019
ms.author: michem
ms.openlocfilehash: 48a1c4350b438761aa2e2d8c7e57a872c86ca292
ms.sourcegitcommit: 6e32f493eb32f93f71d425497752e84763070fad
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/10/2019
ms.locfileid: "59470378"
---
# <a name="project-acoustics-unreal-bake-tutorial"></a>Руководство по моделированию Project Acoustics в Unreal
В этом документе описывается процесс акустической обработки с помощью расширения редактора Unreal.

Наложение выполняется в пять шагов:

1. создание или разметка навигационной сетки для игрока;
2. разметка акустической геометрии;
3. присвоение этой геометрии свойств акустических материалов;
4. размещение зондов предварительной проверки;
5. наложение.

## <a name="open-the-project-acoustics-editor-mode"></a>Открытие режима редактирования Project Acoustics

Импортируйте в свой проект пакет подключаемого модуля Project Acoustics. Инструкции см. в руководстве по [интеграции Unreal](unreal-integration.md). Настроив интеграцию подключаемого модуля, откройте пользовательский интерфейс Acoustics, щелкнув значок создания режима Acoustics.

![Снимок экрана с редактором Unreal — параметр создания режима Acoustics](media/acoustics-mode.png)

## <a name="tag-actors-for-acoustics"></a>Разметка звуковых субъектов

При открытии режима Acoustics первой отображается вкладка объектов. Эта вкладка позволяет отметить субъекты на своем уровне, добавляя им теги **AcousticsGeometry** или **AcousticsNavigation**.

Выберите один или несколько объектов в режиме World Outliner или используйте раздел **массового выделения**, чтобы выбрать все объекты определенной категории. Выбрав нужные объекты, перейдите в раздел **добавления тегов**, чтобы применить к выбранным объектам нужный тег.

Если какой-либо объект не имеет тегов **AcousticsGeometry** и **AcousticsNavigation**, он будет проигнорирован в ходе моделирования. Поддерживаются только статические сетки, навигационные сетки и ландшафты. Если задать тег для какого-либо другого объекта, он будет проигнорирован.

### <a name="for-reference-the-objects-tab-parts"></a>Справочная информация. Элементы вкладки Objects ("Объекты")

![Снимок экрана вкладки Acoustics Objects (Объекты Acoustics) в Unreal](media/unreal-objects-tab-details.png)

1. Кнопки выбора вкладок (среди которых выбрана вкладка **Objects** (Объекты)). Эти кнопки позволяют переключаться между разными этапами акустического моделирования (сверху вниз).
2. Краткое описание действий, выполняемых с помощью этой страницы.
3. Доступные селекторы для субъектов на уровне.
4. Действие **Select** (Выбрать) выбирает все объекты уровня, которые имеют хотя бы один из указанных типов субъекта.
5. Действие **Deselect all** (Отменить выбор) очищает текущее выделение. Такой же эффект имеет нажатие клавиши ESC.
6. Используйте эти переключатели, чтобы установить или отменить теги геометрии или навигации для выбранных субъектов.
7. Действие **Tag** (Добавить тег) добавляет выбранный тег для всех указанных субъектов.
8. Действие **Untag** (Снять тег) удаляет выбранный тег для всех указанных субъектов.
9. Действие **Select Tagged** (Выбрать отмеченные) очищает текущее выделение и выбирает все субъекты, для которых установлен этот тег.
10. Здесь отображаются данные о том, сколько субъектов сейчас отмечены тегами каждого типа.

### <a name="tag-acoustics-occlusion-and-reflection-geometry"></a>Разметка геометрии отражения и акустической окклюзии

Откройте вкладку Objects (Объекты) в окне Acoustics. Присвойте тег Acoustics Geometry (Геометрия акустики) всем объектам, которые должны перекрывать, отражать или поглощать звук. Геометрия акустики может включать такие объекты, как, например, пол, стена, крыша, окна и стекла, ковры и крупная мебель. Для этих объектов вы можете использовать произвольный уровень сложности. Так как сцена перед моделированием вокселизируется, моделировать сетки с высокой степенью детализации, например, деревья с множеством мелких листьев, не более затратно, чем упрощенные объекты.

Следите за тем, чтобы не отметить очевидно лишние объекты, например невидимые сетки конфликтов.

В результатах наложения фиксируется форма объекта, существовавшая на момент вычисления зонда (выполняется на вкладке Probes (Зонды), как описано ниже). Если потребуется переместить любой из помеченных в сцене объектов, необходимо повторить расчет зонда и наложение сцены.

### <a name="create-or-tag-a-navigation-mesh"></a>Создание или разметка навигационной сетки

Навигационная сетка используется для размещения точек зондов для моделирования. Для этого этапа можно использовать [Nav Mesh Bounds Volume](https://api.unrealengine.com/INT/Engine/AI/BehaviorTrees/QuickStart/2/index.html) (Объем границ навигационной сетки) в Unreal или создать собственную навигационную сетку. Хотя бы один объект должен быть отмечен как **навигация акустики**. Если вы используете навигационную сетку Unreal, убедитесь, что она построена.

### <a name="acoustics-volumes"></a>Акустические объемы ###

Доступны дополнительные возможности настройки областей навигации с помощью **акустических объемов**. **Акустические объемы** — это субъекты, которые можно добавить к сцене и которые позволяют выбирать области для включения и игнорирования из навигационной сетки. Субъект предоставляет свойство, которое можно переключать между значениями Include и Exclude. Если объем имеет тип Include, учитываются только области навигационной сетки внутри него. Если объем имеет тип Exclude, такие области игнорируются. Объемы типа Include всегда применяются после объемов типа Exclude. Обязательно отметьте тегами **акустические объемы** как **Acoustics Navigation** ("Акустическая навигация") на вкладке Objects ("Объекты"). Такие субъекты ***не*** помечаются тегами автоматически.

![Снимок экрана свойств акустического объема в Unreal](media/unreal-acoustics-volume-properties.png)

Объемы типа Exclude преимущественно используются, чтобы более точно контролировать пространство, в котором не следует размещать зонды для более экономного использования ресурсов.

![Снимок экрана акустического объема типа Exclude в Unreal](media/unreal-acoustics-volume-exclude.png)

Объемы типа Include полезно использовать при создании сегментов сцены вручную, например если вам нужно разбить сцену на несколько акустических зон. Предположим, у вас есть крупная сцена площадью в несколько квадратных километров, и вы хотите наложить акустику для двух областей. Вы можете нарисовать в сцене два больших объема типа Include и сгенерировать для них по очереди файлы ACE. Затем в игре вы можете использовать объемы с триггерами в сочетании с вызовами шаблонов для загрузки соответствующего файла ACE при приближении игрока к каждому фрагменту карты.

**Акустические объемы** ограничивают только навигацию, а ***не*** геометрию. Каждый зонд внутри **акустического объема** типа Include все равно будет подтягивать всю необходимую геометрию за пределами объема при моделировании волн. Поэтому при переходе игрока от одного участка к другому прерывания в окклюзии или акустике не должны возникать.

## <a name="select-acoustic-materials"></a>Выбор акустических материалов

Завершив разметку объектов, щелкните кнопку **Materials** (Материалы), чтобы перейти на вкладку Materials (Материалы). На этой вкладке вы укажете свойства для каждого материала на уровне. Эта вкладка будет пустой, если еще не размечены никакие субъекты.

Акустические материалы контролируют объем звуковой энергии, отраженной от каждой поверхности. По умолчанию используется акустический материал с характеристиками поглощения, близкими к бетону. Project Acoustics предлагает материалы, основываясь на названии материала сцены.

Время реверберации данного материала в помещении обратно пропорционально его коэффициенту поглощения, причем большинство материалов имеют коэффициент поглощения в диапазоне от 0,01 до 0,20. Материалы с коэффициентами поглощения выше этого диапазона имеют очень высокий уровень поглощения. Например, если комната звучит слишком гулко, выберите для стен, пола или потолка акустический материал с более высоким коэффициентом поглощения. Назначенный акустический материал применяется ко всем субъектам, использующим этот материал сцены.

![Диаграмма, демонстрирующая отрицательную корреляцию времени реверберации с коэффициентом поглощения](media/reverb-time-graph.png)

### <a name="for-reference-parts-of-the-materials-tab"></a>Справочная информация. Элементы вкладки Materials (Материалы)

![Снимок экрана вкладки Acoustics Objects (Объекты Acoustics) в Unreal](media/unreal-materials-tab-details.png)

1. Кнопка перехода на вкладку **Materials** (Материалы) позволяет открыть эту страницу.
2. Краткое описание действий, выполняемых с помощью этой страницы.
3. Список материалов, используемый на уровне, полученный из свойств субъекты с тегом **AcousticsGeometry**. Щелчок по любому из этих материалов выбирает все объекты в сцене, для которых используется этот материал.
4. Отображает акустический материал, которому назначен материал сцены. Щелкните раскрывающийся список, чтобы изменить назначение материала сцены для разных акустических материалов.
5. Отображает коэффициент акустического поглощения для материала, выбранного в предыдущем столбце. Значение "0" означает, что материал ничего не поглощает (полное отражение), а значение "1" — полное поглощение (без отражения). Изменение этого значения присвоит параметру Acoustics Material (Акустический материал) (шаг 4) значение **Custom** (Пользовательский) на шаге 4.

При внесении изменений в материалы для сцены вам будет необходимо переключить вкладки в подключаемом модуле Project Acoustics, чтобы эти изменения отобразились на вкладке **Materials** ("Материалы").

## <a name="calculate-and-review-listener-probe-locations"></a>Вычисление и проверка расположений зонда прослушивателя

После назначения материалов переходите на вкладку **Probes** (Зонды).

### <a name="for-reference-parts-of-the-probes-tab"></a>Справочная информация. Элементы вкладки Probes (Зонды)

![Снимок экрана вкладки Acoustics Probes (Зонды Acoustics) в Unreal](media/unreal-probes-tab-details.png)

1. Кнопка перехода на вкладку **Probes** (Зонды) позволяет открыть эту страницу.
2. Краткое описание действий, выполняемых с помощью этой страницы.
3. Здесь можно выбрать низкое (Coarse) или высокое (Fine) разрешение для грубого или точного моделирования соответственно. Грубое выполняется быстрее, но допускает некоторые неточности. Подробнее это описано в следующем разделе о [разрешении в акустическом моделировании](bake-resolution.md).
4. В этом поле выберите расположение для файлов акустических данных. Нажмите кнопку с символом многоточия (...), чтобы воспользоваться средством выбора папки. Дополнительные сведения о файлах данных см. в разделе [Файлы данных](#Data-Files) ниже.
5. Указанный здесь префикс будет использоваться для именования всех файлов данных этой сцены. По умолчанию используется префикс [Имя уровня]_AcousticsData.
6. Нажмите кнопку **Calculate...** (Вычислить...), чтобы пересчитать сцену в объемных пикселях и вычислить размещение точек зондов. Этот процесс выполняется на локальном компьютере и является обязательным этапом перед наложением. После вычисления зондов описанные выше элементы управления отключаются, а надпись на кнопке изменяется на **Clear** (Очистить). Нажмите кнопку **Clear** (Очистить), чтобы удалить все результаты вычислений и включить элементы управления, если вам нужно повторить расчеты с новыми параметрами.

Для размещения проб следует использовать автоматизированный процесс, доступный на вкладке **Probes** (Пробы).


### <a name="what-the-calculate-button-calculates"></a>Что делает кнопка Calculate... (Вычислить...)

Кнопка **Calculate...** (Вычислить...) принимает все предоставленные данные (геометрия, навигация, материалы и разрешение вычислений) и выполняет следующие шаги.

1. Извлекает сведения о геометрии из сеток сцены и вычисляет объемное пространство. Объемное пространство представляет собой трехмерную координатную сетку, составленную из кубических объемных пикселей, которая вмещает всю созданную сцену. Размер объемных пикселей определяется частотой моделирования, которая зависит от значения параметра **Simulation Resolution** (Разрешение моделирования). Каждый объемный пиксель считается "воздушным пространством" или содержит часть геометрии сцены. Если объемный пиксель содержит геометрию, ему присваивается цифрой коэффициент, соответствующий материалу этого элемента геометрии.
2. На основе данных навигации вычисляет акустически интересные места, в которых может оказаться игрок. Выбирается по возможности минимальный набор таких мест, состоящий из отдельных небольших зон: дверные проемы и коридоры, комнаты, открытые пространства. Для небольших сцен обычно применяется не более 100 расположений, а для больших это количество может доходить до 1000.
3. Для каждого найденного места расположения слушателя вычисляется ряд акустических параметров, например "открытость" пространства, размер окружающей комнаты и т. д.
4. Результаты вычислений сохраняются в файлах в указанном расположении (см. раздел [Файлы данных](#Data-Files) ниже).

В зависимости от размера сцены и скорости компьютера эти вычисления могут занять несколько минут.

Когда вычисления завершаться, вы можете проверить данные об объемных пикселях и точках расположения зондов, чтобы гарантировать хорошие результаты наложения. Крупные проблемы, такие как плохая сетка навигации, лишние или отсутствующие геометрические объекты, обычно хорошо заметны в режиме предварительного просмотра и легко исправляются.


## <a name="debug-display"></a>Представление для отладки

Когда завершится вычисление пробы, в представлении структуры World Outliner появится новый субъект с именем **AcousticsDebugRenderer**. Установив флажки **Render Probes** (Вычислять пробы) и **Render Voxels** (Вычислять объемные пиксели), вы включите отображение отладочной информации в окне просмотра редактора.

![Снимок экрана с субъектом отрисовщика отладочной акустической информации в редакторе Unreal](media/acoustics-debug-renderer.png)

Если вы не видите объемные пиксели или пробы, наложенные на уровень, убедитесь, что для этого окна просмотра включена отрисовка в реальном времени.

![Снимок экрана с параметром отрисовки в реальном времени в Unreal](media/unreal-real-time-rendering.png)

### <a name="voxels"></a>Объемные пиксели

Объемные пиксели отображаются в окне сцены в виде зеленых кубиков вокруг учитываемых объектов геометрии. Объемные пиксели с "воздушным пространством" не отображаются. Вокруг всей сцены вы видите большой зеленый параллелепипед, который ограничивает участвующее в моделировании объемное пространство.
Перемещайте сцену на экране и убедитесь, что существуют объемные пиксели для геометрических объектов, влияющих на акустику. Проверьте также, не появились ли лишние объемные пиксели для объектов, не влияющих на акустику, например для сеток конфликтов. Объемные пиксели отображаются только в том случае, если расстояние от камеры сцены до объекта не превышает 5 метров.

Сравнивая объемные пиксели, созданные в разрешениях грубого и точного моделирования, вы увидите, что в низком разрешении создаются пиксели вдвое большего размера.

![Снимок экрана предварительного просмотра объемных пикселей Acoustics в редакторе Unreal](media/unreal-voxel-preview.png)

### <a name="probe-points"></a>Точки размещения зондов

Точки размещения зондов обозначают то же самое, что и возможные места расположения игрока (слушателя). При моделировании вычисляется акустика для всех комбинаций источников звука и точек проб. Во время выполнения расположение прослушивателя интерполируется по ближайшим точкам пробы.

Очень важно убедиться, что точки проб существуют везде, где игрок может оказаться в этой сцене. Точки пробы помещаются подсистемой Project Acoustics в сетку навигации, и их нельзя перемещать или изменять. Поэтому здесь важно проверить точки проб и убедиться, что сетка навигации охватывает все допустимые расположения игрока.

![Снимок экрана предварительного просмотра акустических зондов в Unreal](media/unreal-probes-preview.png)

Дополнительные сведения о разрешениях для грубого и точного моделирования см. в разделе о [разрешении в акустическом моделировании](bake-resolution.md).

## <a name="bake-your-level-using-azure-batch"></a>Моделирование уровня с помощью пакетной службы Azure

Вы можете смоделировать свою сцену с помощью вычислительного кластера в облаке, используя пакетную службу Azure. Подключаемый модуль Unreal для Project Acoustics подключается напрямую к пакетной службе Azure для создания экземпляра, управления и демонтажа кластера пакетной службы Azure для каждого моделирования. На вкладке Bake (Моделирование) введите учетные данные Azure, выберите тип и размер компьютера кластера и щелкните Bake (Моделировать).

### <a name="for-reference-parts-of-the-bake-tab"></a>Справочная информация. Элементы Bake (Наложение)

![Снимок экрана вкладки Bake (Моделирование) в Unreal](media/unreal-bake-tab-details.png)

1. Кнопка перехода на вкладку Bake (Наложение) позволяет открыть эту страницу.
2. Краткое описание того, что можно сделать на этой странице.
3. Поля для ввода учетных данных Azure после создания учетной записи Azure. Дополнительные сведения см. в [этой статье](create-azure-account.md).
4. Позволяет запустить портал Azure, чтобы управлять подписками, отслеживать потребление, просматривать информацию о выставлении счетов и т. д. 
5. Тип вычислительного узла в Пакетной службе Azure, используемого для вычислений. Можно использовать только те типы узлов, которые поддерживаются в расположении центра обработки данных Azure. Если у вас нет данных о поддержке, сохраните здесь значение **Standard_F8s_v2**.
6. Количество узлов, используемых для вычислений. Введенное здесь число влияет на время создания наложения, но ограничивается количеством выделенных ядер в Пакетной службе Azure. Распределение по умолчанию допускает только два узла по 8 ядер или один узел с 16 ядрами. Эти характеристики можно увеличить. Дополнительные сведения об ограничениях для выделения ядер см. в статье [о создании учетной записи Пакетной службы Azure](create-azure-account.md).
7. Установите этот флажок, чтобы настроить пул вычислений для использования [узлов с низким приоритетом](https://docs.microsoft.com/azure/batch/batch-low-pri-vms). Затраты на узлы с низким приоритетом намного меньше, однако эти узлы не всегда доступны и могут быть замещены в любое время.
8. Прогноз времени, которое будет затрачено на выполнение этого задания в облаке. Сюда не входит время запуска узлов. Это значение примерно соответствует длительности периода с начала выполнения задания до получения результатов. Не забывайте, что это всего лишь приблизительное значение.
9. Общая длительность вычислений для выполнения этого моделирования. Это общая длительность работы вычислительных узлов, которые будут запущены в Azure. Дополнительные сведения об использовании этого значения приводятся в разделе [Оценка затрат на наложение](#Estimating-bake-cost) ниже.
10. Нажмите кнопку Bake (Наложение), чтобы передать результаты наложения в облако. Пока задание выполняется, надпись на этой кнопке сменяется на **Cancel Job** (Отменить задание). Если на этой вкладке отображаются ошибки или рабочий процесс на вкладке **Probes** (Пробы) не завершен, эта кнопка будет отключена.
11. Количество зондов в обрабатываемой сцене, которое было вычислено на вкладке **Probes** (Зонды). Количество зондов определяет количество процессов моделирования, которые нужно выполнить в облаке. Число узлов не может превышать число зондов.
12. Это сообщение обозначает текущее состояние задания или описывает ошибки, если они отображаются на этой вкладке.

Полные сведения об активных заданиях, вычислительных пулах и хранилищах вы всегда можете получить на [портале Azure](https://portal.azure.com).

Пока выполняется задание, кнопка **Bake** (Наложение) сменяется кнопкой **Cancel Job** (Отменить задание). Используйте эту кнопку, чтобы отменить выполняющееся задание. Отмену задания невозможно отменить, и вы не получите никаких результатов, но вам будет выставлен счет за уже использованное (до момента отмены) время вычислений в Azure.

Начав процесс создания наложения, можно закрыть Unreal. Вычисление наложения в облаке может занять несколько часов в зависимости от характеристик проекта, типа и количества узлов. Состояние задания наложения обновляется, когда вы при перезагружаете проект и открываете окно Acoustics. Если задание уже завершено, сразу же скачивается выходной файл.

Учетные данные Azure безопасно сохраняются на локальном компьютере и прикрепляются к проекту Unreal. Они используются исключительно для создания безопасного подключения к Azure.

### <a name="Estimating-bake-cost"></a> Оценка затрат на имитацию звука в Azure

Чтобы оценить стоимость вычисления наложения, умножьте значение из поля **Estimated Compute Cost** (Предполагаемые затраты на вычисления), которое обозначает длительность вычислений, на стоимость одного часа вычислений в местной валюте для выбранного **типа узла виртуальной машины**. Этот результат не учитывает время работы узлов, необходимое для их включения и настройки. Например, если вы выбрали тип узла **Standard_F8s_v2** со стоимостью 0,40 долл. США в час, а расчетное время вычислений составляет 3 часа 57 минут, общую приблизительную стоимость этого задания можно оценить так: 0,40 долл. США × 4 часа = ~ 1,60 долл. США. Фактическая стоимость, скорее всего, будет немного выше за счет времени на подготовку узлов к работе. Стоимость одного часа работы узла вы можете получить на странице [цен на пакетную службу Azure](https://azure.microsoft.com/pricing/details/virtual-machines/linux) (выберите категорию "Оптимизированные для вычислений" или "Для высокопроизводительных вычислений").

### <a name="reviewing-the-bake-results"></a>Просмотр результатов наложения

Когда завершится вычисление наложения, убедитесь, что все объемные пиксели и точки расположения зондов размещаются в правильных местах, запустив для этого подключаемый модуль среды выполнения.

## <a name="Data-Files"></a>Файлы данных

Этот подключаемый модуль на разных этапах работы создает четыре файла данных. Только один из них потребуется во время выполнения, и он помещается в папку проекта Content/Acoustics, которая автоматически добавляется в путь упаковки проекта. Остальные три находятся внутри папки Acoustics Data и не добавляются в пакет.

* **[Проект]/Config/ProjectAcoustics.cfg**: В этом файле хранятся данные, которые вы ввели в пользовательском интерфейсе Acoustics Mode. Вы не можете изменять расположение и имя этого файла. В этом файле есть еще несколько значений, которые влияют на создание наложения, но они предназначены только для опытных пользователей и их не следует изменять.
* **[Проект]/Content/Acoustics/[Имя_уровня]\_AcousticsData.ace**: Этот файл создается в процессе моделирования наложения и содержит данные для поиска, которые применяются во время выполнения для вычисления акустических характеристик сцены. Расположение и имя этого файла можно изменить через поля данных на вкладке **Probes** (Зонды).
* **[Проект]/Plugins/ProjectAcoustics/AcousticsData/[Имя_уровня]\_AcousticsData.vox**: Этот файл хранит вокселизированную геометрию Acoustics и свойства материалов. Эти данные вычисляются по кнопке **Calculate** (Вычислить) на вкладке **Probes** (Зонды). Расположение и имя этого файла можно изменить через поля данных на вкладке **Probes** (Зонды).
* **[Проект]/Plugins/ProjectAcoustics/AcousticsData/[Имя_уровня]\_AcousticsData\_config.xml**: В этом файле хранятся параметры, вычисленные с помощью кнопки **Calculate** (Расчет) на вкладке **Probes** (Пробы). Расположение и имя этого файла можно изменить через поля данных на вкладке **Probes** (Зонды).

Соблюдайте осторожность, чтобы не удалить файл *.ace, скачанный из Azure. Этот файл невозможно восстановить без повторного вычисления всего наложения.

## <a name="next-steps"></a>Дополнительная информация
* Изучите [элементы управления разработки для Unreal](unreal-workflow.md).
* Изучите [основные понятия, связанные с проектированием Project Acoustics](design-process.md).

