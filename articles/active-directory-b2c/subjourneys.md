---
title: Подпути в Azure Active Directory B2C | Документация Майкрософт
description: Укажите элемент вложений настраиваемой политики в Azure Active Directory B2C.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: reference
ms.date: 12/11/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 8f037d4283b4b05081ef47e7223495f6e19d460e
ms.sourcegitcommit: ea17e3a6219f0f01330cf7610e54f033a394b459
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2020
ms.locfileid: "97386873"
---
# <a name="sub-journeys"></a>Промежуточные пути

Вложенные пути можно использовать для упорядочения и упрощения последовательности действий оркестрации в процессе взаимодействия пользователя. В [путях взаимодействия пользователя](userjourneys.md) указываются явные пути, через которые политика позволяет приложению, основанному на утверждениях, предоставлять пользователю требуемые утверждения. Пользователь проходит через эти пути, чтобы извлечь утверждения, которые необходимо предоставить проверяющей стороне. Другими словами, пути взаимодействия пользователя определяют бизнес-логику, в соответствии с которой пользователь выполняет действия, когда инфраструктура процедур идентификации Azure Active Directory B2C обрабатывает запрос. Путь взаимодействия пользователя представляется в виде последовательности оркестрации, которая должна быть соблюдена для успешного выполнения транзакции. Элемент [ClaimsExchange](userjourneys.md#claimsexchanges) на шаге оркестрации связан с одним [техническим профилем](technicalprofiles.md) , который выполняется.

Вложенное путешествие — это группа действий оркестрации, которые могут быть вызваны в любой точке пути взаимодействия пользователя. Подпути можно использовать для создания повторно используемых последовательностей шагов или реализации ветвления для лучшего представления бизнес-логики.

[!INCLUDE [b2c-public-preview-feature](../../includes/active-directory-b2c-public-preview.md)]

## <a name="user-journey-branching"></a>Ветвь пути взаимодействия пользователя

Ветви ведут себя так же, как [пути взаимодействия пользователя](userjourneys.md), так как они представляются в виде последовательности оркестрации, которая должна следовать за успешной транзакцией. Пути взаимодействия пользователя могут быть вызваны самостоятельно и требовать выполнения шага Сендклаимс. Ветви являются компонентами пути взаимодействия пользователя и не могут вызываться независимо друг от друга и всегда вызываются из пути взаимодействия пользователя.

Ключевой компонент ветвления заключается в том, чтобы обеспечить лучшую обработку бизнес-логики в пути взаимодействия пользователя. Общие шаги оркестрации группируются в отдельные части, которые вызываются отдельно. С помощью вспомогательного пути можно упростить процесс объединения нескольких этапов оркестрации (с одинаковыми предположениями). Подпапка вызывается только из пути взаимодействия пользователя, поэтому она не должна вызывать еще одно промежуточное путешествие.

Существует два типа подкаталогов:

- **Call** — возвращает управление вызывающему объекту. Выполняется вложенное путешествие, а затем Управление возвращается к этапу оркестрации, выполняемому в данный момент в процессе взаимодействия пользователя.
- **Transfer** — передает управление во вспомогательное путешествие (необратимое ветвление). Ветвь должна иметь Сендклаимс шаг, чтобы вернуть утверждения в приложение проверяющей стороны.

## <a name="example-scenarios"></a>Примеры сценариев

### <a name="call-sub-journey"></a>Вызов вспомогательного пути

Подпутешествие вызова полезно в следующих сценариях:

- Срок давности: для ограничения возраста существует множество общих компонентов между путями пользователя. Ветвление позволяет компилировать общие элементы в разделяемые компоненты.  
- Согласие родителей. ветвление обеспечивает удобство в проектировании разрешения родителей, позволяя нам получать доступ к заявкам от взаимодействия пользователя к незначительному выполнению, а также возможность ветвления в пути пользователя с правами родителей после того, как поиск пользователя требует согласия. 
- Зарегистрируйтесь для входа: рассмотрим ситуацию, когда пользователь уже существует в каталоге, но мог забыть, что он на самом деле создал учетную запись. Это может быть желательно в том случае, если вместо того, чтобы сообщить пользователю, что введенные учетные данные уже существуют, и заставить пользователя перезапустить путешествие, которое политика может выполнить переключение из потока регистрации в поток входа для этого пользователя.  

### <a name="transfer-sub-journey"></a>Перемещение с подпутешествием

Подпапка перемещения полезна в следующих сценариях:

- Отображение блочной страницы.
- A/B. Тестирование путем маршрутизации запроса во вспомогательное путешествие для выполнения и выдача маркера.

## <a name="adding-a-subjourneys-element"></a>Добавление элемента "подпути"

Ниже приведен пример `SubJourney` элемента типа `Call` , который возвращает управление обратно в пути взаимодействия пользователя.

```xml
<SubJourneys>
  <SubJourney Id="ConditionalAccess_Evaluation" Type="Call">
    <OrchestrationSteps>
      <OrchestrationStep Order="1" Type="ClaimsExchange">
       <ClaimsExchanges>
        <ClaimsExchange Id="ConditionalAccessEvaluation" TechnicalProfileReferenceId="ConditionalAccessEvaluation" />
       </ClaimsExchanges>
      </OrchestrationStep>
      <OrchestrationStep Order="2" Type="ClaimsExchange">
        <Preconditions>
          <Precondition Type="ClaimsExist" ExecuteActionsIf="false">
            <Value>conditionalAccessClaimCollection</Value>
            <Action>SkipThisOrchestrationStep</Action>
          </Precondition>
        </Preconditions>
        <ClaimsExchanges>
          <ClaimsExchange Id="GenerateCAClaimFlags" TechnicalProfileReferenceId="GenerateCAClaimFlags" />
        </ClaimsExchanges>
      </OrchestrationStep>
    </OrchestrationSteps>
  </SubJourney>
</SubJourneys>
```

Ниже приведен пример `SubJourney` элемента типа `Transfer` , возвращающего маркер обратно в приложение проверяющей стороны.

```xml
<SubJourneys>
  <SubJourney Id="B" Type="Transfer">
    <OrchestrationSteps>
      ...
      <OrchestrationStep Order="5" Type="SendClaims">
    </OrchestrationSteps>
  </SubJourney>
</SubJourneys>
```

### <a name="invoke-a-sub-journey-step"></a>Вызов шага промежуточного пути

Новый этап оркестрации типа `InvokeSubJourney` используется для выполнения промежуточного пути. Ниже приведен пример, в котором показаны все элементы выполнения этого шага оркестрации.

```xml
<OrchestrationStep Order="5" Type="InvokeSubJourney">
  <JourneyList>
    <Candidate SubJourneyReferenceId="ConditionalAccess_Evaluation" />
  </JourneyList>
</OrchestrationStep>
```

> [!NOTE]
> Вспомогательное путешествие не должно вызывать другое подпутешествие.

## <a name="components"></a>Components

Чтобы определить подпути, поддерживаемые политикой, **добавьте элемент "** подпапки" в элемент верхнего уровня файла политики.

Элемент " **подпути** " содержит следующий элемент:

| Элемент | Вхождения | Описание |
| ------- | ----------- | ----------- |
| Подпутешествие | 1:n | Вспомогательное путешествие, определяющее все конструкции, необходимые для полного потока пользователя. |

Элемент " **подпути** " содержит следующие атрибуты:

| Атрибут | Обязательно | Описание |
| --------- | -------- | ----------- |
| Id | Да | Идентификатор вспомогательного пути, который может быть использован в пути взаимодействия пользователя для ссылки на подсвойства в политике. Элемент **субжаурнэйреференцеид** элемента [Candidate](userjourneys.md#journeylist) указывает на этот атрибут. |
| Тип | Да | Возможные значения: `Call` или `Transfer` . Дополнительные сведения см. в разделе [ветвь пути взаимодействия пользователя](#user-journey-branching) .|

Элемент **подпути** содержит следующий элемент:

| Элемент | Вхождения | Описание |
| ------- | ----------- | ----------- |
| OrchestrationSteps | 1:n | Последовательность оркестрации, которая должна соблюдаться для успешного выполнения транзакции. Каждый путь взаимодействия пользователя состоит из упорядоченного списка шагов оркестрации, которые должны выполняться в соответствующей последовательности. Если какой-либо шаг завершится ошибкой, выполнение транзакции завершается сбоем. |

## <a name="orchestrationsteps"></a>OrchestrationSteps

Полный список элементов действий оркестрации см. в разделе [усержаурнэйс](userjourneys.md).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о [усержаурнэйс](userjourneys.md)