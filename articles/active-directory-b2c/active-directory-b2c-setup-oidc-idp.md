---
title: Настройка регистрации и входа с помощью OpenID Connect через Azure Active Directory B2C | Документация Майкрософт
description: Настройка регистрации и входа с помощью OpenID Connect через Azure Active Directory B2C.
services: active-directory-b2c
author: davidmu1
manager: daveba
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 11/30/2018
ms.author: davidmu
ms.component: B2C
ms.openlocfilehash: 9f6b65a4253b9cc7c04f397dde7ecab9a64d5ae0
ms.sourcegitcommit: 8115c7fa126ce9bf3e16415f275680f4486192c1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2019
ms.locfileid: "54845985"
---
# <a name="set-up-sign-up-and-sign-in-with-openid-connect-using-azure-active-directory-b2c"></a>Настройка регистрации и входа с помощью OpenID Connect через Azure Active Directory B2C

>[!NOTE]
> Эта функция предоставляется в общедоступной предварительной версии. Ее не следует использовать в рабочих средах.


[OpenID Connect](https://openid.net/specs/openid-connect-core-1_0.html) — это протокол проверки подлинности на основе OAuth 2.0, который может использоваться для безопасного входа пользователей. Большинство поставщиков удостоверений, использующих этот протокол, например [Azure AD](active-directory-b2c-setup-oidc-azure-active-directory.md), поддерживаются в Azure AD B2C. В этой статье объясняется, как можно добавить пользовательских поставщиков удостоверений OpenID Connect в потоки пользователя.


## <a name="add-the-identity-provider"></a>Добавление поставщика удостоверений

1. Войдите на [портал Azure](https://portal.azure.com/) с правами глобального администратора клиента Azure AD B2C.
2. Убедитесь, что используете каталог, содержащий клиент Azure AD B2C, щелкнув **Фильтр каталога и подписки** в верхнем меню и выбрав каталог, содержащий ваш клиент.
3. Выберите **Все службы** в левом верхнем углу окна портала Azure, найдите службу **Azure AD B2C** и выберите ее.
4. Щелкните **Поставщики удостоверений** и нажмите кнопку **Добавить**.
5. В поле **Тип поставщика удостоверений** выберите **OpenID Connect (предварительная версия)**.

## <a name="configure-the-identity-provider"></a>Настройка поставщика удостоверений

Каждый поставщик удостоверений OpenID Connect описывает документ метаданных, который содержит большую часть сведений, необходимых для выполнения входа. Сюда входят такие сведения, как используемые URL-адреса и расположение открытых ключей подписывания службы. Документ метаданных OpenID Connect всегда находится в конечной точке, которая заканчивается на `.well-known\openid-configuration`. Для поставщика удостоверений OpenID Connect, которого требуется добавить, введите его URL-адрес метаданных.

Чтобы разрешить пользователям выполнять вход, разработчики должны зарегистрировать приложение в своей службе, так как это требуется для поставщика удостоверений. Это приложение получит **идентификатор клиента** и **секрет клиента**. Скопируйте эти значения от поставщика удостоверений и введите их в соответствующие поля.

> [!NOTE]
> Секрет клиента не обязателен. Тем не менее, секрет клиента необходимо ввести, если требуется применить [поток кода авторизации](https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth), в которой секрет используется для обмена кода на маркер.

Области определяют сведения и разрешения, которые требуется собрать от пользовательского поставщика удостоверений. Запросы OpenID Connect должны содержать значение области `openid`, чтобы получить маркер идентификатора от поставщика удостоверений. Без маркера идентификатора пользователи не смогут войти в Azure AD B2C с помощью пользовательского поставщика удостоверений. Можно присоединить другие области (разделяемые пробелом). Сведения о том, какие другие области могут быть доступны, см. в документации пользовательского поставщика удостоверений.

Тип ответа описывает, какие сведения будут отправляться обратно в исходный вызов `authorization_endpoint` пользовательского поставщика удостоверений. Можно использовать следующие типы ответов:

- `code`: в соответствии с [последовательностью с использованием кода авторизации](https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth), код будет возвращаться обратно в Azure AD B2C. Azure AD B2C затем перейдет к вызову `token_endpoint` для обмена кода для маркера.
- `token`: маркер доступа возвращается обратно в Azure AD B2C от пользовательского поставщика удостоверений.
- `id_token`: маркер идентификатора возвращается обратно в Azure AD B2C от пользовательского поставщика удостоверений.

Режим ответа позволяет определить метод, который следует использовать для отправки данных обратно от пользовательского поставщика удостоверений в Azure AD B2C. Можно использовать следующие режимы ответов:

- `form_post`: этот режим ответа рекомендуется использовать для максимальной безопасности. Ответ передается через HTTP-метод `POST` с кодом или маркером, закодированным в тексте с использованием формата `application/x-www-form-urlencoded`.
- `query`: код или маркер возвращается в виде параметра запроса.

Используя указание домена, можно перейти непосредственно на страницу входа указанного поставщика удостоверений. Таким образом, пользователю не придется выбирать поставщика удостоверений из списка доступных. Чтобы разрешить такое поведение, введите значение для указания домена. Чтобы перейти к пользовательскому поставщику удостоверений, добавьте параметр `domain_hint=<domain hint value>` в конец запроса при вызове Azure AD B2C для входа.

После того как пользовательский поставщик удостоверений отправит маркер идентификатора обратно в службу Azure AD B2C, эта служба должна иметь возможность сопоставить утверждения из полученного маркера с утверждениями, которые Azure AD B2C распознает и использует. Ознакомьтесь со сведениями о каждом приведенном ниже сопоставлении в документации пользовательского поставщика удостоверений, чтобы понимать утверждения, которые возвращаются обратно в маркерах поставщика удостоверений.

- `User ID`: введите утверждение, которое предоставляет уникальный идентификатор для пользователя, выполнившего вход.
- `Display Name`: введите утверждение, которое предоставляет отображаемое имя или полное имя пользователя.
- `Given Name`: введите утверждение, которое предоставляет имя пользователя.
- `Surname`: введите утверждение, которое предоставляет фамилию пользователя.
- `Email`: введите утверждение, которое предоставляет адрес электронной почты пользователя.

