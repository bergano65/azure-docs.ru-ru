---
title: Настройка поставщика удостоверений локальной учетной записи
titleSuffix: Azure AD B2C
description: Определите типы удостоверений, которые вы можете использовать (адрес электронной почты, имя пользователя, номер телефона) для проверки подлинности локальной учетной записи при настройке пользовательских потоков в клиенте Azure Active Directory B2C.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 10/29/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 0ce9b60ead9aff792bf2e4e98841469d58620ccd
ms.sourcegitcommit: ea551dad8d870ddcc0fee4423026f51bf4532e19
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/07/2020
ms.locfileid: "96754684"
---
# <a name="set-up-phone-sign-up-and-sign-in-for-user-flows-preview"></a>Настройка регистрации и входа с телефона для потоков пользователей (Предварительная версия)

> [!NOTE]
> Функции регистрации и входа в систему и восстановления по электронной почте для пользовательских потоков доступны в общедоступной предварительной версии.

В дополнение к электронной почте и имени пользователя можно включить номер телефона в качестве варианта регистрации на уровне клиента, добавив телефон для регистрации и входа в поставщик удостоверений локальной учетной записи. После включения регистрации и входа с помощью телефона для локальных учетных записей можно добавить телефон в потоки пользователя.

Настройка регистрации и входа в систему в потоке пользователя включает следующие шаги.

- [Настройте клиентский](#configure-phone-sign-up-and-sign-in-tenant-wide) поставщик удостоверений для регистрации и входа в локальную учетную запись, чтобы принять номер телефона в качестве удостоверения пользователя. 

- [Добавьте функцию регистрации телефона в поток пользователя](#add-phone-sign-up-to-a-user-flow) , чтобы пользователи могли регистрироваться в приложении по номеру телефона.

- [Включите запрос на восстановление по электронной почте (Предварительная версия)](#enable-the-recovery-email-prompt-preview) , чтобы разрешить пользователям указывать адрес электронной почты, который может использоваться для восстановления учетной записи, когда у них нет телефона.

Многофакторная идентификация (MFA) отключена по умолчанию при настройке пользовательского потока с помощью регистрации телефона. MFA можно включить в потоках пользователей с помощью телефонной регистрации, но поскольку номер телефона используется в качестве основного идентификатора, единственным вариантом, доступным для второго фактора проверки подлинности, является одноразовый секретный код.

## <a name="configure-phone-sign-up-and-sign-in-tenant-wide"></a>Настройте клиент для регистрации и входа на уровне клиента

Регистрация электронной почты включена по умолчанию в параметрах поставщика удостоверений локальной учетной записи. Вы можете изменить типы удостоверений, которые будут поддерживаться в клиенте, выбрав или отменив выбор электронной почты, регистрации, имени пользователя или номера телефона.

1. Войдите на [портал Microsoft Azure](https://portal.azure.com).

2. Убедитесь, что вы используете каталог, содержащий клиент Azure AD B2C, выбрав фильтр " **каталог и подписка** " в верхнем меню и выбрав Каталог, содержащий ваш клиент Azure AD.

3. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Azure AD B2C**.

4. В разделе **Управление** выберите **поставщики удостоверений**.

5. В списке Поставщик удостоверений выберите **Локальная учетная запись**.

   ![Поставщики удостоверений — выбор локальной учетной записи](media/phone-authentication-user-flows/identity-provider-local-account.png)

1. На странице **Настройка локальной IDP** убедитесь, что выбран параметр **Телефон** в качестве одного из допустимых типов удостоверений, которые потребители могут использовать для создания локальных учетных записей в клиенте Azure AD B2C.

   ![Выберите допустимые типы удостоверений](media/phone-authentication-user-flows/configure-local-idp.png)

1. Нажмите кнопку **Сохранить**.

## <a name="add-phone-sign-up-to-a-user-flow"></a>Добавление телефонного входа в поток пользователя

После добавления функции регистрации телефона в качестве удостоверения для локальных учетных записей ее можно добавить в потоки пользователей, если они являются последними **рекомендованными** версиями пользовательского потока. Ниже приведен пример, демонстрирующий Добавление регистрации телефона в новые потоки пользователей. Но вы также можете добавить подписывание телефона в существующие потоки пользователей с рекомендованной версией (выберите **маршруты пользователей**  >  *имя потока пользователей*  >  **поставщики удостоверений**  >  **Локальная учетная запись регистрация**). 

Ниже приведен пример, демонстрирующий Добавление регистрации телефона в новый поток пользователя.

1. Войдите на [портал Azure](https://portal.azure.com).
2. Выберите значок **Каталог и подписка** в верхней панели инструментов портала, а затем выберите каталог, содержащий клиент Azure AD B2C.

    ![Арендатор B2C, область "Каталог и подписка", портал Azure](./media/phone-authentication-user-flows/directory-subscription-pane.png)

3. На портале Azure найдите и выберите **Azure AD B2C**.
4. В разделе **Политики** выберите **Потоки пользователей** и щелкните **Создать поток пользователя**.

    ![Страница "Потоки пользователей" на портале с выделенной кнопкой "Создать поток пользователя"](./media/phone-authentication-user-flows/signup-signin-user-flow.png)

5. На странице **Создание потока пользователя** выберите поток пользователя **Регистрация и вход**.

    ![Выберите страницу потока пользователей с выделенным потоком регистрации и входа.](./media/phone-authentication-user-flows/select-user-flow-type.png)

6. В разделе **Выбор версии**, выберите элемент **Рекомендуемая** и нажмите кнопку **Создать**. (См. сведения о [версиях потоков пользователей](user-flow-versions.md).)

    ![Кнопка "создать поток пользователя"](./media/phone-authentication-user-flows/select-version.png)

7. Введите **имя** потока пользователя. Например, *signupsignin1*.
8. В разделе **поставщики удостоверений** в разделе **локальные учетные записи** выберите **Телефон регистрация**.

   ![Выбран вариант регистрации на телефоне с пользовательским потоком](media/phone-authentication-user-flows/user-flow-phone-signup.png)

9. В разделе **поставщики удостоверений социальных сетей** выберите другие поставщики удостоверений, которые вы хотите разрешить для этого потока пользователей.

   > [!NOTE]
   > Многофакторная идентификация (MFA) отключена по умолчанию. Вы можете включить MFA для потока входа пользователя в телефон, но так как в качестве основного идентификатора используется номер телефона, одноразовый секретный код электронной почты является единственным вариантом, доступным для второго фактора проверки подлинности.

1. В разделе **атрибуты пользователей и утверждения маркеров** выберите утверждения и атрибуты, которые необходимо получить и отправить пользователю при регистрации. Например, щелкните **Показать еще**, а затем выберите атрибуты и утверждения **Страна или регион**, **Отображаемое имя** и **Почтовый индекс**. Щелкните **ОК**.

1. Выберите **создать** , чтобы добавить поток пользователя. Префикс *B2C_1* добавляется к имени автоматически.

## <a name="enable-the-recovery-email-prompt-preview"></a>Включение запроса на восстановление по электронной почте (Предварительная версия)

При включении регистрации и входа с помощью телефона в потоке пользователя рекомендуется включить функцию восстановления электронной почты. С помощью этой функции пользователь может предоставить адрес электронной почты, который можно использовать для восстановления учетной записи, если у них нет телефона. Этот адрес электронной почты используется только для восстановления учетной записи. Его нельзя использовать для входа в систему.

- Когда запрос **на** восстановление по электронной почте включен, пользователь впервые подписывается на проверку по электронной почте. Пользователь, который не предоставил электронное сообщение для восстановления, прежде чем получит запрос на проверку сообщения электронной почты при следующем входе в систему.

- Если электронная почта для восстановления **отключена**, регистрация пользователя или вход в систему не отображается в сообщении электронной почты о восстановлении.
 
Вы можете включить запрос по электронной почте для восстановления в свойствах потока пользователя.

> [!NOTE]
> Прежде чем начать, убедитесь, что вы [добавили в пользовательский поток регистрацию для телефона](#add-phone-sign-up-to-a-user-flow) , как описано выше.

### <a name="to-enable-the-recovery-email-prompt"></a>Включение запроса на восстановление по электронной почте

1. Войдите на [портал Azure](https://portal.azure.com).
2. Выберите значок **Каталог и подписка** в верхней панели инструментов портала, а затем выберите каталог, содержащий клиент Azure AD B2C.
3. На портале Azure найдите и выберите **Azure AD B2C**.
4. В Azure AD B2C в разделе **политики** выберите **потоки пользователей**.
5. Выберите поток пользователя из списка.
6. В разделе **Параметры** выберите **Свойства**.
7. Рядом с **параметром Включить запрос электронной почты для восстановления по номеру телефона регистрация и вход (Предварительная версия)** выберите:

   - **Для отображения запроса на восстановление** по электронной почте во время регистрации и входа.
   - **Выкл** ., чтобы скрыть запрос на восстановление по электронной почте.

    ![Свойства потоков пользователя с включенной поддержкой электронной почты для восстановления](./media/phone-authentication-user-flows/recovery-email-settings.png)

8. Нажмите кнопку **Сохранить**.

### <a name="to-test-the-recovery-email-prompt"></a>Проверка запроса на восстановление по электронной почте

После включения регистрации и входа в систему, а также запроса по электронной почте для восстановления в потоке пользователя можно использовать **поток запуска пользователя** для тестирования взаимодействия с пользователем.

1. Выберите **политики**  >  **пользовательские потоки**, а затем выберите созданный поток пользователя. На странице Общие сведения о потоке пользователя выберите пункт **запустить поток пользователя**.

2. Для **приложения** выберите веб-приложение, зарегистрированное на шаге 1. В поле **URL-адрес ответа** должно содержаться значение `https://jwt.ms`.

3. Выберите пункт **запустить поток пользователя** и проверьте следующее поведение.

   - Пользователь, который подписывается в первый раз, получит запрос на предоставление сообщения электронной почты для восстановления. 
   - Пользователь, который уже выполнил вход, но не предоставил электронное сообщение для восстановления, получит запрос на предоставление учетной записи после входа.

4. Введите адрес электронной почты, а затем выберите **Отправить проверочный код**. Убедитесь, что код отправлен в указанную папку "Входящие" электронной почты. Извлеките код и введите его в поле **код проверки** . Затем выберите **проверить код**.

## <a name="next-steps"></a>Следующие шаги

- [Добавление внешних поставщиков удостоверений](tutorial-add-identity-providers.md)
- [Создание потока пользователей](tutorial-create-user-flows.md)