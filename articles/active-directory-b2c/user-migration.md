---
title: Подходы к миграции пользователей
titleSuffix: Azure AD B2C
description: Миграция учетных записей пользователей из другого поставщика удостоверений в Azure AD B2C с помощью методов неполного импорта или беспрепятственной миграции.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 02/14/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: b3ee069985fd39288a562d3caafc50b12290c060
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80332332"
---
# <a name="migrate-users-to-azure-ad-b2c"></a>Миграция пользователей в Azure AD B2C

Миграция с другого поставщика удостоверений на Azure Active Directory B2C (Azure AD B2C) также может потребовать миграции существующих учетных записей пользователей. Здесь обсуждаются два метода миграции: *групповой импорт* и *Простая миграция*. При использовании любого из этих подходов необходимо написать приложение или сценарий, который использует [Microsoft Graph API](manage-user-accounts-graph-api.md) для создания учетных записей пользователей в Azure AD B2C.

## <a name="bulk-import"></a>Групповое импорт

В потоке с массовым импортом приложение миграции выполняет следующие действия для каждой учетной записи пользователя:

1. Чтение учетной записи пользователя из старого поставщика удостоверений, включая текущие учетные данные (имя пользователя и пароль).
1. Создайте соответствующую учетную запись в каталоге Azure AD B2C с текущими учетными данными.

Используйте поток с массовым импортом в любой из этих двух ситуаций:

- У вас есть доступ к учетным данным пользователя в виде открытого текста (имя пользователя и пароль).
- Учетные данные шифруются, но их можно расшифровать.

Сведения о создании учетных записей пользователей программным путем см. [в разделе Управление учетными записями пользователей Azure AD B2C с помощью Microsoft Graph](manage-user-accounts-graph-api.md).

## <a name="seamless-migration"></a>Простая миграция

Используйте простой поток миграции, если недоступность паролей в старом поставщике удостоверений невозможна. Например, если:

- Пароль хранится в одностороннего зашифрованном формате, например в хэш-функции.
- Пароль хранится в устаревшем поставщике удостоверений в недоступном виде. Например, когда поставщик удостоверений проверяет учетные данные путем вызова веб-службы.

Для беспрепятственного переноса по-прежнему требуется выполнить полную миграцию учетных записей пользователей, а затем использовать [настраиваемую политику](custom-policy-get-started.md) для запроса [REST API](custom-policy-rest-api-intro.md) (который вы создаете), чтобы задать пароль каждого пользователя при первом входе в систему.

Таким образом, простой поток миграции имеет два этапа: *массовый импорт* и *Настройка учетных данных*.

### <a name="phase-1-bulk-import"></a>Этап 1. массовый импорт

1. Приложение для миграции считывает учетные записи пользователей из старого поставщика удостоверений.
1. Приложение для миграции создает соответствующие учетные записи пользователей в каталоге Azure AD B2C, но *не устанавливает пароли*.

### <a name="phase-2-set-credentials"></a>Этап 2. Настройка учетных данных

После выполнения полной миграции учетных записей пользовательская политика и REST API при входе пользователя выполняет следующие действия.

1. Считывает учетную запись пользователя Azure AD B2C, соответствующую заданному адресу электронной почты.
1. Проверьте, помечена ли учетная запись для миграции, путем оценки атрибута логического расширения.
    - Если атрибут расширения возвращает `True`, вызовите REST API, чтобы проверить пароль для устаревшего поставщика удостоверений.
      - Если REST API определит неверный пароль, верните пользователю понятную ошибку.
      - Если REST API определяет пароль правильно, запишите пароль в учетную запись Azure AD B2C и измените атрибут логического расширения на `False`.
    - Если атрибут логического расширения возвращает `False`, продолжайте процесс входа как обычная.

Пример пользовательской политики и REST API см. в примере [простой миграции пользователей](https://aka.ms/b2c-account-seamless-migration) на сайте GitHub.

![Блок-схема простого подхода к миграции пользователей](./media/user-migration/diagram-01-seamless-migration.png)<br />*Схема: простой поток миграции*

## <a name="best-practices"></a>Рекомендации

### <a name="security"></a>Безопасность

Простой подход к миграции использует собственный пользовательский REST API для проверки учетных данных пользователя в отношении устаревшего поставщика удостоверений.

**Необходимо защитить REST API от атак методом подбора.** Злоумышленник может отправить несколько паролей в конечном итоге угадать учетные данные пользователя. Чтобы избежать таких атак, прекращает обслуживать запросы к REST API, когда число попыток входа проходит определенное пороговое значение. Кроме того, обеспечьте безопасность обмена данными между Azure AD B2C и REST API. Чтобы узнать, как защитить интерфейсы API RESTFUL для рабочей среды, см. раздел [Защита API RESTful](secure-rest-api.md).

### <a name="user-attributes"></a>Атрибуты пользователя

Не все сведения в устаревшем поставщике удостоверений должны быть перенесены в каталог Azure AD B2C. Укажите соответствующий набор атрибутов пользователя для хранения в Azure AD B2C перед миграцией.

- **Сохранить в** Azure AD B2C
  - Имя пользователя, пароль, адреса электронной почты, Номера телефонов, номера или идентификаторы членства.
  - Маркеры согласия для политики конфиденциальности и лицензионных соглашений для конечных пользователей.
- **Не** храните в Azure AD B2C
  - Конфиденциальные данные, такие как номера кредитных карт, номера социального страхования (SSN), медицинские записи или другие данные, регулируемые правительством или отраслевыми стандартами соответствия стандартам.
  - Параметры маркетинга или связи, поведение пользователей и аналитика.

### <a name="directory-clean-up"></a>Очистка каталога

Прежде чем начать процесс миграции, воспользуйтесь возможностью очистки каталога.

- Укажите набор пользовательских атрибутов, которые будут храниться в Azure AD B2C, и перенесите только необходимые данные. При необходимости можно создать [настраиваемые атрибуты](custom-policy-custom-attributes.md) для хранения дополнительных данных о пользователе.
- Если выполняется миграция из среды с несколькими источниками проверки подлинности (например, каждое приложение имеет свой собственный каталог пользователя), выполните миграцию на единую учетную запись в Azure AD B2C.
- Если несколько приложений имеют разные имена пользователей, их можно хранить в Azure AD B2C учетной записи пользователя с помощью коллекции удостоверений. В отношении пароля предоставьте пользователю возможность выбрать один из них и установить его в каталоге. Например, при простой миграции только выбранный пароль должен храниться в учетной записи Azure AD B2C.
- Удалите неиспользуемые учетные записи пользователей перед миграцией или не перенесите устаревшие учетные записи.

### <a name="password-policy"></a>Политика паролей

Если переносимые учетные записи имеют более слабую стойкость пароля, чем [усиленный пароль](../active-directory/authentication/concept-sspr-policy.md) , принудительно установленный Azure AD B2C, можно отключить требование надежного пароля. Дополнительные сведения см. в разделе [свойство политики паролей](manage-user-accounts-graph-api.md#password-policy-property).

## <a name="next-steps"></a>Дальнейшие действия

В репозитории [Azure-AD-B2C/User-migrations](https://github.com/azure-ad-b2c/user-migration) на сайте GitHub содержится простой пример пользовательской политики миграции и REST API пример кода:

[Простая настраиваемая политика миграции пользователей & REST API пример кода](https://aka.ms/b2c-account-seamless-migration)
