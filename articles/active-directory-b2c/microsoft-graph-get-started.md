---
title: Управление ресурсами с помощью Microsoft Graph
titleSuffix: Azure AD B2C
description: Подготовьтесь к управлению ресурсами Azure AD B2C с помощью Microsoft Graph, зарегистрировав приложение, которому предоставлены необходимые разрешения API Graph.
services: B2C
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 02/14/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 61e32f50e02e45487830c5ea7ff476a0571960f6
ms.sourcegitcommit: cd9754373576d6767c06baccfd500ae88ea733e4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2020
ms.locfileid: "94954007"
---
# <a name="manage-azure-ad-b2c-with-microsoft-graph"></a>Управление Azure AD B2C с помощью Microsoft Graph

[Microsoft Graph][ms-graph] позволяет управлять многими ресурсами в клиенте Azure AD B2C, включая учетные записи пользователей клиентов и пользовательские политики. Создавая скрипты или приложения, вызывающие [API Microsoft Graph][ms-graph-api], можно автоматизировать задачи управления клиентами, такие как:

* Перенос существующего хранилища пользователя в клиент Azure AD B2C
* Развертывание настраиваемых политик с помощью конвейера Azure в Azure DevOps и управление ключами настраиваемой политики
* Разместите регистрацию пользователей на собственной странице и создайте учетные записи пользователей в каталоге Azure AD B2C в фоновом режиме.
* Автоматизация регистрации приложений
* Получение журналов аудита

Следующие разделы помогут подготовиться к использованию API Microsoft Graph для автоматизации управления ресурсами в каталоге Azure AD B2C.

## <a name="microsoft-graph-api-interaction-modes"></a>Режимы взаимодействия API Microsoft Graph

Существует два режима взаимодействия, которые можно использовать при работе с API Microsoft Graph для управления ресурсами в клиенте Azure AD B2C.

* **Интерактивный** . подходящие для выполнения задач, выполняемых единожды, для выполнения задач управления используется учетная запись администратора в клиенте B2C. В этом режиме администратору необходимо выполнить вход с использованием учетных данных, прежде чем вызывать API Microsoft Graph.

* **Автоматически** — для запланированных или непрерывно выполняемых задач этот метод использует учетную запись службы, для которой настроены разрешения, необходимые для выполнения задач управления. Учетную запись службы можно создать в Azure AD B2C путем регистрации приложения, которое приложения и сценарии используют для проверки подлинности с помощью *идентификатора приложения (клиента)* и предоставления **учетных данных клиента OAuth 2,0** . В этом случае приложение действует так же, как и вызов API Microsoft Graph, а не пользователя администратора, как в ранее описанном интерактивном методе.

Чтобы включить сценарий **автоматического** взаимодействия, создайте регистрацию приложения, как показано в следующих разделах.

Несмотря на то, что поток предоставления учетных данных клиента OAuth 2,0 не поддерживается напрямую службой проверки подлинности Azure AD B2C, можно настроить поток учетных данных клиента с помощью Azure AD и конечной точки/Token платформы идентификации Майкрософт для приложения в клиенте Azure AD B2C. Клиент Azure AD B2C разделяет некоторую функциональность с корпоративными клиентами Azure AD.

## <a name="register-management-application"></a>Регистрация приложения управления

Прежде чем сценарии и приложения смогут взаимодействовать с [API Microsoft Graph][ms-graph-api] для управления ресурсами Azure AD B2C, необходимо создать регистрацию приложения в клиенте Azure AD B2C, который предоставляет необходимые разрешения API.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Выберите значок **Каталог и подписка** в верхней панели инструментов портала, а затем выберите каталог, содержащий клиент Azure AD B2C.
1. На портале Azure найдите и выберите **Azure AD B2C**.
1. Щелкните **Регистрация приложений** и выберите **Новая регистрация**.
1. Введите **имя** приложения. Например, *managementapp1*.
1. Выберите **учетные записи только в этом каталоге Организации**.
1. В разделе **разрешения** снимите флажок *предоставить согласие администратора на OpenID Connect и offline_access разрешения* .
1. Выберите **Зарегистрировать**.
1. Запишите **идентификатор приложения (клиента)** , который отображается на странице Обзор приложения. Это значение используется на более позднем этапе.

### <a name="grant-api-access"></a>Предоставление доступа через API

Затем предоставьте зарегистрированным приложениям разрешения на обработку ресурсов клиента с помощью вызовов API Microsoft Graph.

[!INCLUDE [active-directory-b2c-permissions-directory](../../includes/active-directory-b2c-permissions-directory.md)]

### <a name="create-client-secret"></a>Создать секрет клиента

[!INCLUDE [active-directory-b2c-client-secret](../../includes/active-directory-b2c-client-secret.md)]

Теперь у вас есть приложение, имеющее разрешение на *Создание*, *Чтение*, *Обновление* и *Удаление* пользователей в клиенте Azure AD B2C. Перейдите к следующему разделу, чтобы добавить разрешения на *Обновление пароля* .

## <a name="enable-user-delete-and-password-update"></a>Включить удаление пользователя и обновление пароля

Разрешение *чтение и запись данных каталога* **не включает в** себя возможность удалять пользователей или обновлять пароли учетных записей пользователей.

Если приложению или сценарию необходимо удалить пользователей или обновить пароли, назначьте приложению роль *администратора пользователей* .

1. Войдите в [портал Azure](https://portal.azure.com) и используйте фильтр **Directory + Subscription** , чтобы переключиться на клиент Azure AD B2C.
1. Найдите и выберите **Azure AD B2C**.
1. В разделе **Управление** выберите **роли и администраторы**.
1. Выберите роль **администратора пользователей** .
1. Выберите **добавить назначения**.
1. В текстовом поле **Выбор** введите имя зарегистрированного ранее приложения, например *managementapp1*. Выберите приложение, которое появится в результатах поиска.
1. Выберите **Добавить**. Для полного распространения разрешений может потребоваться несколько минут.

## <a name="next-steps"></a>Следующие шаги
Теперь, когда вы зарегистрировали приложение управления и предоставили ему необходимые разрешения, ваши приложения и службы (например, Azure Pipelines) могут использовать свои учетные данные и разрешения для взаимодействия с Microsoft Graph API. 

* [Получение токена доступа из Azure AD](/graph/auth-v2-service#4-get-an-access-token)
* [Используйте маркер доступа для вызова Microsoft Graph](/graph/auth-v2-service#4-get-an-access-token)
* [Операции B2C, поддерживаемые Microsoft Graph](microsoft-graph-operations.md)
* [Управление Azure AD B2C учетными записями пользователей с помощью Microsoft Graph](manage-user-accounts-graph-api.md)
* [Получение журналов аудита с помощью API отчетов Azure AD](view-audit-logs.md#get-audit-logs-with-the-azure-ad-reporting-api)

<!-- LINKS -->
[ms-graph]: /graph/
[ms-graph-api]: https://docs.microsoft.com/graph/api/overview