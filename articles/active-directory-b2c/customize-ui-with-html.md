---
title: Настройка пользовательского интерфейса
titleSuffix: Azure AD B2C
description: Узнайте, как настроить пользовательский интерфейс для приложений, использующих Azure Active Directory B2C.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 12/10/2020
ms.custom: project-no-code
ms.author: mimart
ms.subservice: B2C
zone_pivot_groups: b2c-policy-type
ms.openlocfilehash: 869cf5a47831844b04e0461a95fb7d16aa4d1569
ms.sourcegitcommit: 6172a6ae13d7062a0a5e00ff411fd363b5c38597
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97111491"
---
# <a name="customize-the-user-interface-in-azure-active-directory-b2c"></a>Настройка пользовательского интерфейса в Azure Active Directory B2C

[!INCLUDE [active-directory-b2c-choose-user-flow-or-custom-policy](../../includes/active-directory-b2c-choose-user-flow-or-custom-policy.md)]

Фирменная символика и настройка пользовательского интерфейса, который Azure Active Directory B2C (Azure AD B2C) для клиентов, помогает обеспечить удобство работы пользователей в приложении. Эти возможности включают регистрацию, вход, изменение профиля и сброс пароля. В этой статье описываются методы настройки пользовательского интерфейса. 

> [!TIP]
> Если вы хотите изменить только эмблему баннера, фоновое изображение и цвет фона страниц потока пользователя, можно попробовать функцию [фирменной символики компании](company-branding.md) .


## <a name="custom-html-and-css-overview"></a>Общие сведения о пользовательском HTML и CSS


Azure AD B2C выполняет код в браузере клиента, используя [общий доступ к ресурсам между источниками (CORS)](https://www.w3.org/TR/cors/). Во время выполнения содержимое загружается по URL-адресу, указанному в пользовательском потоке или настраиваемой политике. Каждая страница в интерфейсе пользователя загружает свое содержимое из URL-адреса, указанного для этой страницы. После загрузки содержимого из URL-адреса оно объединяется с фрагментом HTML, вставленным Azure AD B2C, а затем страница отображается для клиента.

![Поле содержимого настраиваемой страницы](./media/customize-ui-with-html/html-content-merging.png)

### <a name="custom-html-page-content"></a>Содержимое настраиваемой страницы HTML

Создайте HTML-страницу с собственной фирменной символикой для обслуживания содержимого настраиваемой страницы. Эта страница может быть статической `*.html` страницей или динамической страницей, такой как .NET, Node.js или PHP.

Содержимое настраиваемой страницы может содержать любые элементы HTML, включая CSS и JavaScript, но не может включать небезопасные элементы, такие как iframes. Единственный обязательный элемент — это элемент div со `id` значением `api` , таким как `<div id="api"></div>` в HTML-странице.

```html
<!DOCTYPE html>
<html>
<head>
    <title>My Product Brand Name</title>
</head>
<body>
    <div id="api"></div>
</body>
</html>
```

#### <a name="customize-the-default-azure-ad-b2c-pages"></a>Настройка страниц Azure AD B2C по умолчанию

Вместо создания пользовательского содержимого страницы с нуля можно настроить содержимое страницы по умолчанию для Azure AD B2c.

В следующей таблице приведено содержимое страницы по умолчанию, предоставляемое Azure AD B2C. Скачайте файлы и используйте их в качестве отправной точки для создания собственных настраиваемых страниц.

| Страница по умолчанию | Описание | Идентификатор для определения содержимого<br/>(только для настраиваемой политики) |
|:-----------------------|:--------|-------------|
| [exception.html](https://login.microsoftonline.com/static/tenant/default/exception.cshtml) | **Страница ошибки**. Эта страница отображается при обнаружении исключения или ошибки. | *api.error* |
| [selfasserted.html](https://login.microsoftonline.com/static/tenant/default/selfAsserted.cshtml) |  **Страница с автоматическим подтверждением**. Используйте этот файл как пользовательское содержимое страницы для регистрации учетной записи социальных сетей, страницу регистрации локальной учетной записи, страницу входа в локальную учетную запись, сброс пароля и многое другое. Форма может содержать разные элементы управления для ввода текста, например: текстовое поле, поле ввода пароля, переключатель, раскрывающийся список с единственным выбором или флажки множественного выбора. | *API. локалаккаунтсигнин*, *API. локалаккаунтсигнуп*, *API. локалаккаунтпассвордресет*, *API. selfasserted* |
| [multifactor-1.0.0.html](https://login.microsoftonline.com/static/tenant/default/multifactor-1.0.0.cshtml) | **Страница Многофакторной идентификации.** Эта страница позволяет пользователю подтвердить свой номер телефона (с помощью SMS-сообщения или голосового вызова) во время регистрации или входа. | *api.phonefactor* |
| [updateprofile.html](https://login.microsoftonline.com/static/tenant/default/updateProfile.cshtml) | **Страница обновления профиля.** Эта страница содержит форму для обновления профиля пользователя. Эта страница аналогична странице регистрации локальных учетных записей, за исключением полей для ввода пароля. | *api.selfasserted.profileupdate* |
| [unified.html](https://login.microsoftonline.com/static/tenant/default/unified.cshtml) | **Единая страница регистрации или входа.** Эта страница обрабатывает регистрацию и вход пользователей. Пользователи могут использовать поставщики удостоверений организаций, социальных сетей, включая Facebook и Google+, или локальные учетные записи. | *api.signuporsignin* |

## <a name="hosting-the-page-content"></a>Размещение содержимого страницы

При использовании собственных файлов HTML и CSS для настройки пользовательского интерфейса разместите содержимое пользовательского интерфейса на любой общедоступной конечной точке HTTPS, которая поддерживает CORS. Например, [хранилище больших двоичных объектов Azure](../storage/blobs/storage-blobs-introduction.md), [службы приложений Azure](../app-service/index.yml), веб-серверы, CDN, AWS S3 или системы общего доступа к файлам.

## <a name="guidelines-for-using-custom-page-content"></a>Рекомендации по использованию пользовательского содержимого страницы

- Используйте абсолютный URL-адрес при включении внешних ресурсов, таких как файлы мультимедиа, CSS и JavaScript, в HTML-файл.
- С помощью [макета страницы](page-layout.md) 1.2.0 и более поздних версий можно добавить `data-preload="true"` атрибут в теги HTML для управления порядком загрузки CSS и JavaScript. В `data-preload=true` Эта страница создается перед отображением пользователю. Этот атрибут помогает предотвратить мерцание страницы путем предварительной загрузки CSS-файла без отображения пользователем невидимого HTML. В следующем фрагменте кода HTML показано использование `data-preload` тега.
  ```HTML
  <link href="https://path-to-your-file/sample.css" rel="stylesheet" type="text/css" data-preload="true"/>
  ```
- Рекомендуется начинать с содержимого страницы по умолчанию и строить его поверх.
- Вы можете [включить JavaScript](javascript-and-page-layout.md) в пользовательское содержимое.
- Поддерживаемые версии браузеров:
  - Internet Explorer 11, 10 и Microsoft ребро
  - ограниченная поддержка Internet Explorer 9 и Internet Explorer 8;
  - Google Chrome 42.0 и выше
  - Mozilla Firefox 38.0 и выше
  - Safari для iOS и macOS, версия 12 и более поздние версии
- Из-за ограничений безопасности Azure AD B2C не поддерживает `frame` `iframe` `form` элементы HTML, или.

## <a name="localize-content"></a>Локализация содержимого

Локализовать содержимое HTML можно, включив [настройку языка](language-customization.md) в клиенте Azure AD B2C. Включение этой функции позволяет Azure AD B2C перенаправить параметр OpenID Connect Connect `ui_locales` в конечную точку. Сервер содержимого может использовать этот параметр для предоставления HTML-страниц на конкретном языке.

Можно извлекать содержимое из разных расположений в зависимости от используемого языкового стандарта. В конечной точке с поддержкой CORS можно настроить структуру папок для размещения содержимого для определенных языков. При использовании шаблона подстановки `{Culture:RFC5646}` запрос будет правильным.

Например, URI настраиваемой страницы может выглядеть следующим образом:

```http
https://contoso.blob.core.windows.net/{Culture:RFC5646}/myHTML/unified.html
```

Страницу можно загрузить на французском языке, извлекать содержимое из:

```http
https://contoso.blob.core.windows.net/fr/myHTML/unified.html
```

## <a name="custom-page-content-walkthrough"></a>Пошаговое руководство по содержимому настраиваемой страницы

Ниже приведен обзор этого процесса.

1. Подготовьте расположение для размещения пользовательского содержимого страницы (общедоступная конечная точка HTTPS с поддержкой CORS).
1. Скачайте и настройте файл содержимого страницы по умолчанию, например `unified.html` .
1. Опубликуйте содержимое настраиваемой страницы в общедоступной конечной точке HTTPS.
1. настройка общего доступа к ресурсам независимо от источника (CORS) для своего веб-приложения;
1. Наведите политику на универсальный код ресурса (URI) содержимого настраиваемой политики.

## <a name="prerequisites"></a>Предварительные требования

[!INCLUDE [active-directory-b2c-customization-prerequisites](../../includes/active-directory-b2c-customization-prerequisites.md)]


### <a name="1-create-your-html-content"></a>1. Создание HTML-содержимого

Создание пользовательского содержимого страницы с фирменным названием продукта в заголовке.

1. Скопируйте следующий фрагмент кода HTML. Это правильно сформированное HTML5 с пустым элементом, который называется *\<div id="api"\>\</div\>* , расположенным внутри *\<body\>* тегов. Этот элемент определяет расположение, в которое будет вставлено содержимое Azure AD B2C.

   ```html
   <!DOCTYPE html>
   <html>
   <head>
       <title>My Product Brand Name</title>
   </head>
   <body>
       <div id="api"></div>
   </body>
   </html>
   ```

1. Вставьте скопированный фрагмент в текстовый редактор
1. Измените стиль элементов пользовательского интерфейса, которые Azure AD B2C вставляет в страницу, с помощью каскадных таблиц стилей. В примере ниже показан простой CSS-файл, который также включает в себя параметры для регистрации внедренных элементов HTML.

    ```css
    h1 {
      color: blue;
      text-align: center;
    }
    .intro h2 {
      text-align: center;
    }
    .entry {
      width: 400px ;
      margin-left: auto ;
      margin-right: auto ;
    }
    .divider h2 {
      text-align: center;
    }
    .create {
      width: 400px ;
      margin-left: auto ;
      margin-right: auto ;
    }
    ```

1.  Сохраните файл как *customize-ui.html*.

> [!NOTE]
> Элементы формы HTML будут удалены из-за ограничений безопасности при использовании login.microsoftonline.com. Если вы хотите использовать элементы HTML-форм в пользовательском HTML-содержимом, [используйте b2clogin.com](b2clogin.md).

### <a name="2-create-an-azure-blob-storage-account"></a>2. Создание учетной записи хранилища BLOB-объектов Azure

В этой статье мы используем хранилище BLOB-объектов Azure для размещения содержимого. Можно выбрать для этого веб-сервер, но тогда нужно [включить для веб-сервера поддержку CORS](https://enable-cors.org/server.html).

Чтобы разместить содержимое HTML в хранилище BLOB-объектов, выполните следующие действия.

1. Войдите на [портал Azure](https://portal.azure.com).
1. В меню **Концентратор** выберите **Создать** > **Хранилище** > **Учетная запись хранения**.
1. Выберите **подписку** для своей учетной записи хранения.
1. Создайте **группу ресурсов** или выберите существующую.
1. Введите уникальное **имя** учетной записи хранения.
1. Выберите **географическое расположение** для учетной записи хранения.
1. Для параметра **Модель развертывания** можно оставить значение **Диспетчер ресурсов**.
1. Для параметра **Производительность** можно оставить значение **Стандартная**.
1. Измените **тип учетной записи** на **хранилище BLOB-объектов**.
1. Для параметра **Репликация** можно оставить значение **RA-GRS**.
1. Для параметра **Уровень доступа** можно оставить значение **Горячий**.
1. Выберите **проверить и создать** , чтобы создать учетную запись хранения.
    После завершения развертывания страница **учетная запись хранения** откроется автоматически.

#### <a name="21-create-a-container"></a>2,1. Создание контейнера

Чтобы создать общедоступный контейнер в хранилище BLOB-объектов, выполните следующие действия.

1. В разделе **Служба BLOB-объектов** в меню слева выберите **большие двоичные объекты**.
1. Выберите **+ контейнер**.
1. В качестве **имени** введите *root*. В качестве имени можно выбрать имя, например *contoso*, но для простоты мы используем *корень* в этом примере.
1. Для общедоступного **уровня доступа** выберите **BLOB-объект**, а затем нажмите **кнопку ОК**.
1. Выберите **корень** , чтобы открыть новый контейнер.

#### <a name="22-upload-your-custom-page-content-files"></a>2,2. Отправка файлов пользовательского содержимого страницы

1. Щелкните **Отправить**.
1. Щелкните значок папки рядом с полем **выберите файл**.
1. Перейдите к и выберите **customize-ui.html**, созданный ранее в разделе Настройка пользовательского интерфейса страницы.
1. Если вы хотите отправить во вложенную папку, разверните узел **Дополнительно** и введите имя папки в списке **отправить в папку**.
1. Щелкните **Отправить**.
1. Выберите отправленный BLOB-объект **customize-ui.html** .
1. Справа от текстового поля **URL-адрес** выберите значок **Копировать в буфер обмена** , чтобы скопировать URL-адрес в буфер обмена.
1. В веб-браузере перейдите по URL-адресу, который вы скопировали, чтобы убедиться, что переданный BLOB-объект доступен. Если она недоступна, например, если возникла `ResourceNotFound` ошибка, убедитесь, что для параметра Тип доступа к контейнеру выбрано значение **BLOB**.

### <a name="3-configure-cors"></a>3. Настройка CORS

Настройте хранилище BLOB-объектов для совместного использования ресурсов в разных источниках, выполнив следующие действия.

1. В меню выберите **CORS**.
1. В поле **Допустимые источники** введите `https://your-tenant-name.b2clogin.com`. Замените `your-tenant-name` именем вашего клиента Azure AD B2C. Например, `https://fabrikam.b2clogin.com`. При вводе имени клиента используйте все строчные буквы.
1. В поле **Допустимые методы** выберите `GET` и `OPTIONS`.
1. В поле **Допустимые заголовки** введите звездочку (*).
1. В поле **Доступные заголовки** введите звездочку (*).
1. В поле **Максимальный возраст** введите 200.
1. Щелкните **Сохранить**.

#### <a name="31-test-cors"></a>3,1. Тестирование CORS

Убедитесь, что вы готовы, выполнив следующие действия.

1. Повторите шаг configure CORS. Для **разрешенных источников** введите `https://www.test-cors.org`
1. Перейдите по адресу [www.Test-CORS.org](https://www.test-cors.org/) 
1. В поле **удаленный URL-адрес** вставьте URL-адрес HTML-файла. Например `https://your-account.blob.core.windows.net/root/azure-ad-b2c/unified.html`.
1. Выберите **Отправить запрос**.
    Результат должен быть `XHR status: 200` . 
    Если произошла ошибка, проверьте правильность параметров CORS. Кроме того, вам может потребоваться очистить кэш браузера или открыть закрытый сеанс, нажав CTRL+SHIFT+P.


::: zone pivot="b2c-user-flow"

### <a name="4-update-the-user-flow"></a>4. обновление потока пользователя

1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Azure AD B2C**.
1. Выберите **Потоки пользователей** и щелкните поток пользователя *B2C_1_signupsignin1*.
1. Выберите **Макеты страниц**, а затем в разделе **Единая страница регистрации или входа** щелкните **Да** для параметра **Использовать пользовательское содержимое страницы**.
1. В поле **Код URI пользовательской страницы** введите универсальный код ресурса (URI) для файла *custom-ui.html*, записанного ранее.
1. В верхней части страницы щелкните **Сохранить**.

### <a name="5-test-the-user-flow"></a>5. Тестирование потока пользователя

1. На странице клиента Azure AD B2C выберите **Потоки пользователей**, а затем выберите поток пользователя *B2C_1_signupsignin1*.
1. В верхней части страницы щелкните **Выполнить поток пользователя**.
1. Нажмите кнопку **Выполнить поток пользователя**.

Вы должны увидеть страницу с элементами, выровненными по центру в соответствии CSS-файлом, который вы создали, как показано в примере ниже.

![Веб-браузер со странице регистрации или входа с настраиваемыми элементами пользовательского интерфейса](./media/customize-ui-with-html/run-now.png)

::: zone-end

::: zone pivot="b2c-custom-policy"

### <a name="4-modify-the-extensions-file"></a>4. изменение файла расширений

Чтобы настроить настройку пользовательского интерфейса, скопируйте **контентдефинитион** и его дочерние элементы из базового файла в файл Extensions.

1. Откройте базовый файл политики. Например, <em>`SocialAndLocalAccounts/`**`TrustFrameworkBase.xml`**</em>. Этот базовый файл является одним из файлов политики, включенных в начальный пакет пользовательской политики, который необходимо получить в предварительных требованиях, чтобы приступить [к работе с пользовательскими политиками](./custom-policy-get-started.md).
1. Найдите и скопируйте содержимое элемента **ContentDefinitions**.
1. Откройте файл расширения, Например, *TrustFrameworkExtensions.xml*. Найдите элемент **BuildingBlocks**. Если такой элемент не существует, добавьте его.
1. Вставьте все содержимое элемента **ContentDefinitions** , скопированного как дочерний элемент **BuildingBlocks** .
1. Найдите элемент **ContentDefinition**, содержащий `Id="api.signuporsignin"` в скопированном файле XML.
1. Измените значение **LoadUri** на URL-адрес файла HTML, который был передан в хранилище. Например, `https://your-storage-account.blob.core.windows.net/your-container/customize-ui.html`.

    Ваша пользовательская политика должна выглядеть, как в следующем фрагменте кода:

    ```xml
    <BuildingBlocks>
      <ContentDefinitions>
        <ContentDefinition Id="api.signuporsignin">
          <LoadUri>https://your-storage-account.blob.core.windows.net/your-container/customize-ui.html</LoadUri>
          <RecoveryUri>~/common/default_page_error.html</RecoveryUri>
          <DataUri>urn:com:microsoft:aad:b2c:elements:unifiedssp:1.0.0</DataUri>
          <Metadata>
            <Item Key="DisplayName">Signin and Signup</Item>
          </Metadata>
        </ContentDefinition>
      </ContentDefinitions>
    </BuildingBlocks>
    ```

1. Сохраните файл расширений.

### <a name="5-upload-and-test-your-updated-custom-policy"></a>5. Отправьте и протестируйте обновленную настраиваемую политику

#### <a name="51-upload-the-custom-policy"></a>5,1. Отправка настраиваемой политики

1. Убедитесь, что используете каталог с клиентом Azure AD B2C, выбрав фильтр **Каталог и подписка** в меню вверху и каталог с вашим клиентом.
1. Найдите и выберите **Azure AD B2C**.
1. В разделе **Политики** выберите **Identity Experience Framework**.
1. Выберите **Отправить пользовательскую политику**.
1. Выполните отправку ранее измененного файла расширений.

#### <a name="52-test-the-custom-policy-by-using-run-now"></a>5,2. Протестируйте настраиваемую политику с помощью команды " **Запустить сейчас** "

1. Выберите переданную политику и щелкните **Запустить сейчас**.
1. Вы сможете зарегистрироваться, используя адрес электронной почты.

## <a name="configure-dynamic-custom-page-content-uri"></a>Настройка динамического URI содержимого настраиваемой страницы

С помощью Azure AD B2C пользовательских политик можно отправить параметр в URL-пути или в строку запроса. Передавая параметр в конечную точку HTML, вы можете динамически изменять содержимое страницы. Например, можно изменить фоновое изображение страницы регистрации или входа в Azure AD B2C на основе параметра, передаваемого из веб-приложения или мобильного приложения. Параметр может быть любым [арбитром утверждений](claim-resolver-overview.md), таким как идентификатор приложения, идентификатор языка или пользовательский параметр строки запроса, например `campaignId` .

### <a name="sending-query-string-parameters"></a>Отправка параметров строки запроса

Чтобы отправить параметры строки запроса, в [политике проверяющей стороны](relyingparty.md)добавьте `ContentDefinitionParameters` элемент, как показано ниже.

```xml
<RelyingParty>
    <DefaultUserJourney ReferenceId="SignUpOrSignIn" />
    <UserJourneyBehaviors>
    <ContentDefinitionParameters>
        <Parameter Name="campaignId">{OAUTH-KV:campaignId}</Parameter>
        <Parameter Name="lang">{Culture:LanguageName}</Parameter>
        <Parameter Name="appId">{OIDC:ClientId}</Parameter>
    </ContentDefinitionParameters>
    </UserJourneyBehaviors>
    ...
</RelyingParty>
```

В определении содержимого измените значение `LoadUri` на `https://<app_name>.azurewebsites.net/home/unified` . Ваша пользовательская политика `ContentDefinition` должна выглядеть, как в следующем фрагменте кода:

```xml
<ContentDefinition Id="api.signuporsignin">
  <LoadUri>https://<app_name>.azurewebsites.net/home/unified</LoadUri>
  ...
</ContentDefinition>
```

Когда Azure AD B2C загружает страницу, она вызывает конечную точку веб-сервера:

```http
https://<app_name>.azurewebsites.net/home/unified?campaignId=123&lang=fr&appId=f893d6d3-3b6d-480d-a330-1707bf80ebea
```

### <a name="dynamic-page-content-uri"></a>URI содержимого динамической страницы

Содержимое можно извлечь из разных мест в зависимости от используемых параметров. В конечной точке с поддержкой CORS Настройте структуру папок для размещения содержимого. Например, можно организовать содержимое в следующей структуре. Корневая *Папка или папка для каждого языка/HTML-файлов*. Например, URI настраиваемой страницы может выглядеть следующим образом:

```xml
<ContentDefinition Id="api.signuporsignin">
  <LoadUri>https://contoso.blob.core.windows.net/{Culture:LanguageName}/myHTML/unified.html</LoadUri>
  ...
</ContentDefinition>
```

Azure AD B2C отправляет двухбуквенный код ISO для языка, `fr` французский:

```http
https://contoso.blob.core.windows.net/fr/myHTML/unified.html
```

::: zone-end

## <a name="sample-templates"></a>Примеры шаблонов

Здесь можно найти примеры шаблонов для настройки пользовательского интерфейса:

```bash
git clone https://github.com/Azure-Samples/Azure-AD-B2C-page-templates
```

Этот проект содержит следующие шаблоны:
- [Синий морской](https://github.com/Azure-Samples/Azure-AD-B2C-page-templates/tree/master/ocean_blue)
- [Серый планшет](https://github.com/Azure-Samples/Azure-AD-B2C-page-templates/tree/master/slate_gray)

Чтобы использовать пример, выполните следующие действия.

1. Клонировать репозиторий на локальном компьютере. Выберите папку шаблона `/ocean_blue` или `/slate_gray` .
1. Отправьте все файлы в папке шаблона и `/assets` папке в хранилище BLOB-объектов, как описано в предыдущих разделах.
1. Затем откройте каждый `\*.html` файл в корневой папке `/ocean_blue` или `/slate_gray` , замените все экземпляры относительных URL-адресов файлами CSS, изображениями и шрифтами, отправленными на шаге 2. Пример:
    ```html
    <link href="./css/assets.css" rel="stylesheet" type="text/css" />
    ```

    Кому
    ```html
    <link href="https://your-storage-account.blob.core.windows.net/your-container/css/assets.css" rel="stylesheet" type="text/css" />
    ```
1. Сохраните `\*.html` файлы и отправьте их в хранилище BLOB-объектов.
1. Теперь измените политику, указав HTML-файл, как упоминалось ранее.
1. Если вы видите отсутствующие шрифты, изображения или CSS, проверьте ссылки в политике расширения и \* HTML-файлах.


## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как включить [код JavaScript на стороне клиента](javascript-and-page-layout.md).



