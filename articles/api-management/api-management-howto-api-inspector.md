---
title: Учебник. Отладка API-интерфейсов в службе Управления API Azure с помощью трассировки запросов
description: Следуйте инструкциям из этого учебника, чтобы включить трассировку и проверить этапы обработки запросов в службе Управления API Azure.
services: api-management
documentationcenter: ''
author: vladvino
editor: ''
ms.service: api-management
ms.topic: tutorial
ms.date: 10/30/2020
ms.author: apimpm
ms.openlocfilehash: 531e346569b85ababc382f997fd7764a92b3d05f
ms.sourcegitcommit: 6ab718e1be2767db2605eeebe974ee9e2c07022b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2020
ms.locfileid: "94542320"
---
# <a name="tutorial-debug-your-apis-using-request-tracing"></a>Руководство по Отладка API-интерфейсов с помощью трассировки запросов

В этом учебнике описано, как проверить (выполнить трассировку) обработку запросов в службе Управления API, чтобы упростить отладку API-интерфейсов и устранить связанные с ним неполадки. 

В этом руководстве описано следующее.

> [!div class="checklist"]
> * Трассировка примера вызова.
> * Просмотр этапа обработки запроса.

:::image type="content" source="media/api-management-howto-api-inspector/api-inspector-001.png" alt-text="Инспектор API":::

## <a name="prerequisites"></a>Предварительные требования

+ Ознакомьтесь с [терминологией службы управления API в Azure](api-management-terminology.md).
+ Выполните инструкции из краткого руководства [Создание экземпляра службы управления API Azure](get-started-create-service-instance.md).
+ Выполните инструкции из следующего учебника: [Импорт и публикация первого API](import-and-publish.md).

## <a name="verify-allow-tracing-setting"></a>Проверка параметра "Разрешить трассировку" 

Необходимо включить параметр **Разрешить трассировки** для подписки, используемой для API. Если вы используете встроенную подписку со всеми видами доступа, параметр включен по умолчанию. Чтобы выполнить проверку на портале, перейдите к экземпляру службы Управления API и выберите **Подписки**.

   :::image type="content" source="media/api-management-howto-api-inspector/allow-tracing.png" alt-text="Разрешение трассировки для подписки":::

## <a name="trace-a-call"></a>Трассировка вызова

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к своему экземпляру службы Управления API.
1. Выберите **Интерфейсы API**.
1. В списке API выберите **Demo Conference API**.
1. Откройте вкладку **Тест**.
1. Щелкните операцию **GetSpeakers**.
1. Убедитесь, что заголовок HTTP-запроса содержит **OCP-Apim-Trace: True** и допустимое значение для **Ocp-Apim-Subscription-Key**. Если это не так, выберите **+Добавить заголовок**, чтобы добавить заголовок.
1. Нажмите кнопку **Отправить**, чтобы выполнить вызов API.

  :::image type="content" source="media/api-management-howto-api-inspector/06-debug-your-apis-01-trace-call.png" alt-text="Настройка трассировки API":::

> [!TIP]
> Если **OCP-Apim-Subscription-Key** не заполняется автоматически в HTTP-запросе, его можно получить на портале. Выберите **Подписки** и откройте контекстное меню ( **...** ) своей подписки. Выберите **Показать/скрыть ключи**. При необходимости вы также можете повторно создать ключи. Затем добавьте ключ в заголовок.

## <a name="review-trace-information"></a>Просмотр сведений о трассировке

1. После завершения вызова перейдите на вкладку **Трассировка** в разделе **HTTP-ответ**.
1. Щелкните любую из следующих ссылок, чтобы перейти к подробным сведениям о трассировке. **Входящие**, **Внутренние**, **Исходящие**.

     :::image type="content" source="media/api-management-howto-api-inspector/response-trace.png" alt-text="Просмотр трассировки ответа":::

    * В разделе **Входящие** отображаются исходный запрос, полученный службой Управления API от вызывающего объекта, и примененные к запросу политики. Например, они отобразятся здесь, если вы добавили политики при работе со статьей [Учебник. Преобразование и защита API](transform-api.md).

    * В разделе **Внутренние** отображаются запросы, отправленные службой Управления API в серверную часть API, и полученный ответ.

    * В разделе **Исходящие** отображаются все политики, примененные к ответу перед отправкой обратно вызывающему объекту.

    > [!TIP]
    > Для каждого шага также показано время, прошедшее с момента получения запроса службой управления API.

1. На вкладке **Сообщение** заголовка **ocp-apim-trace-location** показано расположение данных трассировки, хранимых в хранилище BLOB-объектов Azure. При необходимости перейдите к этому расположению, чтобы получить данные трассировки.

     :::image type="content" source="media/api-management-howto-api-inspector/response-message.png" alt-text="Расположение данных трассировки в службе хранилища Azure":::
## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Трассировка примера вызова.
> * Просмотр этапа обработки запроса.

Перейдите к следующему руководству:

> [!div class="nextstepaction"]
> [Использование редакций](api-management-get-started-revise-api.md)
