---
title: Руководство. Определение нового типа устройства шлюза в Azure IoT Central | Документация Майкрософт
description: В этом руководстве показано, как разработчики могут определить новый тип устройства шлюза Интернета вещей в своем приложении Azure IoT Central.
author: rangv
ms.author: rangv
ms.date: 10/22/2019
ms.topic: tutorial
ms.service: iot-central
services: iot-central
ms.custom: mvc
manager: peterpr
ms.openlocfilehash: 58e481e34d9f798b73b72b114b071cf035c3319f
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "90967913"
---
# <a name="tutorial---define-a-new-iot-gateway-device-type-in-your-azure-iot-central-application"></a>Руководство. Определение нового типа устройства шлюза Интернета вещей в приложении Azure IoT Central

*Эта статья предназначена для создателей решений и разработчиков устройств.*

В этом руководстве показано, как с помощью шаблона устройства шлюза создатели решений могут определить устройство шлюза в приложении IoT Central. Затем настройте несколько подчиненных устройств, подключающихся к приложению IoT Central через устройство шлюза. 

В этом учебнике вы создадите шаблон устройства шлюза**Интеллектуальное здание**. Устройство шлюза **Интеллектуальное здание** связано с другими подчиненными устройствами.

![Схема связи между устройством шлюза и подчиненными устройствами](./media/tutorial-define-gateway-device-type/gatewaypattern.png)

Кроме того, чтобы использовать подчиненные устройства для взаимодействия с приложением IoT Central, устройство шлюза также может:

* отправлять собственные данные телеметрии, например, о температуре;
* отвечать на обновления свойств, которые может записать оператор. Например, оператор может изменить интервал отправки данных телеметрии;
* отвечать на команды, например перезагрузку устройства.

> [!div class="checklist"]
> Создание шаблонов подчиненных устройств Создание шаблона для устройства шлюза Публикация шаблона устройства Создание имитации устройств

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим учебником вам потребуется [создать приложение Azure IoT Central](./quick-deploy-iot-central.md).

## <a name="create-downstream-device-templates"></a>Создание шаблонов подчиненных устройств

В этом учебнике используются шаблоны устройств для устройства **Датчик S1** и устройства **Датчик присутствия RS40** для имитации подчиненных устройств.

Вот как можно создать шаблон устройства для **Датчик S1**:

1. На панели слева выберите элемент **Шаблоны устройств**. Затем щелкните **+** , чтобы начать добавление шаблона.

1. Прокрутите страницу вниз до плитки устройства **Датчик S1**. Выберите плитку и щелкните **Далее: Настройка**.

1. На странице **Просмотр** щелкните **Создать**, чтобы добавить шаблон устройства в приложение. 

Вот как можно создать шаблон устройства для **датчика присутствия RS40**:

1. На панели слева выберите элемент **Шаблоны устройств**. Затем щелкните **+** , чтобы начать добавление шаблона.

1. Прокрутите вниз, чтобы увидеть плитку устройства **Датчик присутствия RS40**. Выберите плитку и щелкните **Далее: Настройка**.

1. На странице **Просмотр** щелкните **Создать**, чтобы добавить шаблон устройства в приложение. 

Теперь у вас есть шаблоны для двух типов подчиненных устройств:

![Шаблоны устройств для подчиненных устройств](./media/tutorial-define-gateway-device-type/downstream-device-types.png)


## <a name="create-a-gateway-device-template"></a>Создание шаблона для устройства шлюза

В рамках этого учебника вы также создадите шаблон устройства шлюза с нуля. Этот шаблон будет использоваться позже для имитации устройства шлюза в приложении.

Чтобы добавить новый шаблон устройства шлюза в приложение, сделайте следующее.

1. На панели слева выберите элемент **Шаблоны устройств**. Затем щелкните **+** , чтобы начать добавление шаблона.

1. На странице **Выбрать тип шаблона** щелкните **Устройство IoT**, а затем **Далее: Настройка**.

1. На странице **Customize device** (Настройка устройства) установите флажок **Gateway device** (Устройство шлюза).

1. На странице **Отзыв** выберите **Создать**. 

1. В качестве имени шаблона введите **Устройство шлюза "Интеллектуальное здание"** .

1. На странице **Создание модели возможностей** щелкните плитку **Выборочная**.

1. Чтобы добавить интерфейс, щелкните **+** .  Выберите стандартный интерфейс **Сведения об устройстве**.

### <a name="add-relationships"></a>Добавление связей

Далее вы добавите связи в шаблоны для шаблонов нижестоящих устройств:

1. В шаблоне **Устройство шлюза "Интеллектуальное здание"** щелкните **Связи**.

1. Нажмите кнопку **+ Add relationship** (+ Добавить связь). Введите **Датчик среды** в качестве отображаемого имени, а в качестве целевого объекта выберите **Датчик S1**.

1. Снова нажмите кнопку **+ Add relationship** (+ Добавить связь). Введите **Датчик присутствия** в качестве отображаемого имени, а в качестве целевого объекта выберите **Датчик присутствия RS40**.

1. Щелкните **Сохранить**.

![Связи в шаблоне устройства шлюза "Интеллектуальное здание"](./media/tutorial-define-gateway-device-type/relationships.png)

### <a name="add-cloud-properties"></a>Добавление свойств облака

Шаблон устройства шлюза может содержать свойства облака. Свойства облака существуют только в приложении IoT Central и никогда не отправляются на устройство и не принимаются с него.

Чтобы добавить свойства облака в шаблон **Устройство шлюза "Интеллектуальное здание"** , сделайте следующее.

1. В шаблоне **Устройство шлюза "Интеллектуальное здание"** выберите **Свойства облака**.

1.  Воспользуйтесь сведениями из следующей таблицы, чтобы добавить в шаблон устройства шлюза два свойства облака.

    | Отображаемое имя      | Семантический тип | схема |
    | ----------------- | ------------- | ------ |
    | Дата последнего обслуживания | None          | Дата   |
    | Имя клиента     | None          | Строка |

2. Щелкните **Сохранить**.

### <a name="create-views"></a>Создание представлений

Вы (как разработчик) можете настроить в приложении отображение для оператора сведений о подключенном датчике среды. Ваши настройки позволят оператору управлять устройствами датчиков среды, подключенными к приложению. Вы можете создать два типа представлений, которые позволят оператору взаимодействовать с устройствами.

* Формы для просмотра и редактирования свойств устройства и облака.
* Панели мониторинга для визуализации устройств.

Чтобы создать представления по умолчанию для шаблона **Устройство шлюза "Интеллектуальное здание"** , выполните следующие действия.

1. В шаблоне **Устройство шлюза "Интеллектуальное здание"** щелкните **Представления**.

1. Щелкните плитку **Создать представления по умолчанию** и выберите все параметры.

1. Щелкните **Generate default dashboard view(s)** (Создать представления панели мониторинга по умолчанию).

## <a name="publish-the-device-template"></a>Публикация шаблона устройства

Прежде чем создать имитированное устройство шлюза или подключить реальное устройство шлюза, необходимо опубликовать шаблон устройства.

Чтобы опубликовать шаблон устройства шлюза, выполните следующие действия.

1. Выберите шаблон **Устройство шлюза "Интеллектуальное здание"** на странице **Шаблоны устройств**.

2. Нажмите кнопку **Опубликовать**.

3. В диалоговом окне **Publish a Device Template** (Публикация шаблона устройства) щелкните **Опубликовать**.

После публикации шаблона устройства он отображается на странице **Устройства** и в представлении для оператора. В опубликованном шаблоне устройства уже нельзя изменить модель возможностей устройства без создания новой версии. Но вы можете вносить изменения в свойства облака, настройки и представления в шаблоне опубликованного устройства. Эти обновления не приводят к созданию версии. После внесения изменений щелкните **Опубликовать**, чтобы передать эти изменения оператору.

## <a name="create-the-simulated-devices"></a>Создание имитации устройств

В этом учебнике используются имитированные подчиненные устройства и имитированное устройство шлюза.

Чтобы создать имитацию устройства шлюза, выполните следующие действия.

1. На странице **Устройства** выберите **Устройство шлюза "Интеллектуальное здание"** в списке шаблонов устройств.

1. Щелкните **+** , чтобы начать добавление нового устройства.

1. Оставьте созданные **идентификатор устройства** и **имя устройства**. Убедитесь, что переключатель **Имитация** установлен в положение **Вкл.** . Нажмите кнопку **создания**.

Чтобы создать имитированные подчиненные устройства, сделайте следующее:

1. На странице **Устройства** выберите в списке шаблонов устройств пункт **Датчик присутствия RS40**.

1. Щелкните **+** , чтобы начать добавление нового устройства.

1. Оставьте созданные **идентификатор устройства** и **имя устройства**. Убедитесь, что переключатель **Имитация** установлен в положение **Вкл.** . Нажмите кнопку **создания**.

1. На странице **Устройства** выберите в списке шаблонов устройств пункт **Датчик S1**.

1. Щелкните **+** , чтобы начать добавление нового устройства.

1. Оставьте созданные **идентификатор устройства** и **имя устройства**. Убедитесь, что переключатель **Имитация** установлен в положение **Вкл.** . Нажмите кнопку **создания**.

![Имитированные устройства в приложении](./media/tutorial-define-gateway-device-type/simulated-devices.png)

### <a name="add-downstream-device-relationships-to-a-gateway-device"></a>Добавление связей подчиненных устройств к устройству шлюза

Теперь, когда в приложении есть имитированные устройства, можно создать связи между подчиненными устройствами и устройством шлюза:

1. На странице **Устройства** выберите **Датчик S1** в списке шаблонов устройств, а затем выберите имитацию устройства **датчика S1**.

1. Щелкните **Connect to gateway** (Подключиться к шлюзу).

1. В диалоговом окне **Connect to a gateway** (Подключение к шлюзу) выберите шаблон **Устройство шлюза "Интеллектуальное здание"** , а затем выберите созданный ранее имитированный экземпляр.

1. Выберите **Присоединиться**.

1. На странице **Устройства** выберите **Датчик присутствия RS40** в списке шаблонов устройств, а затем выберите имитацию устройства **Датчика присутствия RS40**.

1. Щелкните **Connect to gateway** (Подключиться к шлюзу).

1. В диалоговом окне **Connect to a gateway** (Подключение к шлюзу) выберите шаблон **Устройство шлюза "Интеллектуальное здание"** , а затем выберите созданный ранее имитированный экземпляр.

1. Выберите **Присоединиться**.

Теперь оба имитированных подчиненных устройства подключены к имитируемому устройству шлюза. Если вы перейдете к представлению **Downstream Devices** (Подчиненные устройства) для вашего устройства шлюза, вы увидите соответствующие подчиненные устройства:

![Представление подчиненных устройств](./media/tutorial-define-gateway-device-type/downstream-device-view.png)

Выберите шаблон устройства шлюза, экземпляр устройства шлюза и щелкните **Присоединиться**.

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

* создание шлюза Интернета вещей в качестве шаблона устройства;
* создание свойств облака;
* создание настроек;
* определение визуализации для данных телеметрии устройства;
* добавление связей;
* публикация шаблона устройства.

> [!NOTE]
> Для устройств шлюзов, смоделированных в IoT Central, сейчас не поддерживается создание кода на базе VS Code.

Как разработчик устройств вы можете узнать о следующем:

> [!div class="nextstepaction"]
> [Добавление устройства Azure IoT Edge в приложение Azure IoT Central](tutorial-add-edge-as-leaf-device.md)
