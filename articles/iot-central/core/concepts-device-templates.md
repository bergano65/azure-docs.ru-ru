---
title: Что такое шаблоны устройств в Azure IoT Central | Документация Майкрософт
description: Шаблоны устройств IoT Central Azure позволяют указать поведение устройств, подключенных к приложению. В шаблоне устройства указываются данные телеметрии, свойства и команды, которые должны быть реализованы устройством. Шаблон устройства также определяет пользовательский интерфейс для устройства в IoT Central таких как формы и панели мониторинга, используемые оператором.
author: dominicbetts
ms.author: dobett
ms.date: 11/05/2020
ms.topic: conceptual
ms.service: iot-central
services: iot-central
ms.custom: device-developer
ms.openlocfilehash: e82a377d62184c8ae1d2e8f076b228e36005887a
ms.sourcegitcommit: 9889a3983b88222c30275fd0cfe60807976fd65b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2020
ms.locfileid: "94992681"
---
# <a name="what-are-device-templates"></a>Что представляют собой шаблоны устройств?

_Эта статья относится к разработчикам устройств и сборщикам решений._

Шаблон устройства в Azure IoT Central — это схема, которая определяет характеристики и поведение типа устройства, которое подключается к приложению. Например, шаблон устройства определяет данные телеметрии, которые отправляет устройство, чтобы IoT Central могли создавать визуализации, использующие правильные единицы и типы данных.

Построитель решений добавляет шаблоны устройств в приложение IoT Central. Разработчик устройства записывает код устройства, который реализует поведение, определенное в шаблоне устройства.

Шаблон устройства включает в себя следующие разделы:

- _Модель устройства_. Эта часть шаблона устройства определяет, как устройство взаимодействует с вашим приложением. Разработчик устройства реализует поведение, определенное в модели.
    - _Компонент по умолчанию_. У каждой модели устройства есть компонент по умолчанию. Интерфейс компонента по умолчанию описывает возможности, характерные для модели устройства.
    - _Компоненты_. Модель устройства может включать компоненты в дополнение к компоненту по умолчанию для описания возможностей устройства. Каждый компонент имеет интерфейс, описывающий возможности компонента. Интерфейсы компонентов можно повторно использовать в других моделях устройств. Например, несколько моделей телефонных устройств могут использовать один и тот же интерфейс камеры.
    - _Наследуемые интерфейсы_. Модель устройства содержит один или несколько интерфейсов, расширяющих возможности компонента по умолчанию.
- _Свойства облака_. Эта часть шаблона устройства позволяет разработчику решения указать метаданные устройства для хранения. Свойства облака никогда не синхронизируются с устройствами и существуют только в приложении. Свойства облака не влияют на код, который разработчик устройства записывает для реализации модели устройства.
- _Настройки_. Эта часть шаблона устройства позволяет разработчику решения переопределить некоторые определения в модели устройства. Настройки полезны, если разработчик решения хочет уточнить, как приложение обрабатывает значение, например изменение отображаемого имени свойства или цвета, используемого для отображения значения телеметрии. Настройки не влияют на код, который разработчик устройства записывает для реализации модели устройства.
- _Представления_. Эта часть шаблона устройства позволяет разработчику решений определять визуализации для просмотра данных с устройства и форм для управления устройством и его контроля. В представлениях используется модель устройства, свойства облака и настройки. Представления не влияют на код, который разработчик устройства записывает для реализации модели устройства.

## <a name="device-models"></a>Модель устройства

Модель устройства определяет, как устройство взаимодействует с приложением IoT Central. Разработчик устройства должен убедиться, что устройство реализует поведение, определенное в модели устройства, чтобы IoT Central может отслеживать устройство и управлять им. Модель устройства состоит из одного или нескольких _интерфейсов_, и каждый интерфейс может определять коллекцию типов _телеметрии_ , _свойств устройств_ и _команд_. Разработчик решения может импортировать файл JSON, который определяет модель устройства в шаблоне устройства, или использовать веб-интерфейс в IoT Central для создания или изменения модели устройства. Для изменения модели устройства, созданной с помощью веб-интерфейса, требуется [Управление версиями шаблона устройства](./howto-version-device-template.md).

Разработчик решения также может экспортировать JSON-файл, содержащий модель устройства. Разработчик устройства может использовать этот документ JSON, чтобы понять, как устройство должно взаимодействовать с IoT Central приложением.

JSON-файл, определяющий модель устройства, использует [язык определения цифровых двойника (дтдл) версии 2](https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/dtdlv2.md). IoT Central требуется, чтобы JSON файл содержал модель устройства с интерфейсами, определенными встроенными, а не отдельными файлами.

Типичное устройство Интернета вещей состоит из:

- Пользовательские части — это вещи, которые делают устройство уникальным.
- Стандартные части — это вещи, общие для всех устройств.

Эти части называются _интерфейсами_ в модели устройства. Интерфейсы определяют сведения о каждой части, реализуемой устройством. Интерфейсы можно многократно использовать в моделях устройств. В ДТДЛ компонент ссылается на интерфейс, определенный в отдельном ДТДЛ-файле.

В следующем примере показана схема модели устройства для устройства контроллера температуры. Компонент по умолчанию включает определения для `workingSet` , `serialNumber` и `reboot` . Модель устройства также включает в себя `thermostat` интерфейсы и `deviceInformation` :

```json
{
  "@context": "dtmi:dtdl:context;2",
  "@id": "dtmi:com:example:TemperatureController;1",
  "@type": "Interface",
  "displayName": "Temperature Controller",
  "description": "Device with two thermostats and remote reboot.",
  "contents": [
    {
      "@type": [
        "Telemetry", "DataSize"
      ],
      "name": "workingSet",
      "displayName": "Working Set",
      "description": "Current working set of the device memory in KiB.",
      "schema": "double",
      "unit" : "kibibyte"
    },
    {
      "@type": "Property",
      "name": "serialNumber",
      "displayName": "Serial Number",
      "description": "Serial number of the device.",
      "schema": "string"
    },
    {
      "@type": "Command",
      "name": "reboot",
      "displayName": "Reboot",
      "description": "Reboots the device after waiting the number of seconds specified.",
      "request": {
        "name": "delay",
        "displayName": "Delay",
        "description": "Number of seconds to wait before rebooting the device.",
        "schema": "integer"
      }
    },
    {
      "@type" : "Component",
      "schema": "dtmi:com:example:Thermostat;1",
      "name": "thermostat",
      "displayName": "Thermostat",
      "description": "Thermostat One."
    },
    {
      "@type": "Component",
      "schema": "dtmi:azure:DeviceManagement:DeviceInformation;1",
      "name": "deviceInformation",
      "displayName": "Device Information interface",
      "description": "Optional interface with basic device hardware information."
    }
  ]
}
```

У интерфейса есть несколько обязательных полей:

- `@id`: уникальный идентификатор в виде простого универсального имени ресурса.
- `@type`: объявляет, что этот объект является интерфейсом.
- `@context`: указывает версию ДТДЛ, используемую для интерфейса.
- `contents`: перечисляет свойства, данные телеметрии и команды, составляющие устройство. Возможности могут быть определены в нескольких интерфейсах.

Есть некоторые необязательные поля, которые можно использовать для добавления дополнительных сведений в модель возможностей, например отображаемое имя и описание.

Каждая запись в списке интерфейсов в разделе Implements имеет:

- `name`: Программное имя интерфейса.
- `schema`: интерфейс, реализуемый моделью возможностей.

## <a name="interfaces"></a>Интерфейсы

ДТДЛ позволяет описать возможности устройства. Связанные возможности группируются в интерфейсы. Интерфейсы описывают свойства, телеметрию и команды, которые компонент реализует:

- `Properties`. Свойства — это поля данных, которые представляют состояние устройства. Используйте свойства, чтобы представить устойчивое состояние устройства, например состояние кулант насоса. Свойства могут также представлять базовые свойства устройства, такие как версия встроенного по устройства. Свойства можно объявлять как доступные только для чтения или доступные для записи. Только устройства могут обновлять значение свойства, доступного только для чтения. Оператор может установить значение свойства, доступного для записи, для отправки на устройство.
- `Telemetry`. Поля телеметрии представляют измерения датчиков. Когда устройство принимает измерения датчика, оно должно отправить событие телеметрии, содержащее данные датчика.
- `Commands`. Команды представляют методы, которые пользователи устройства могут выполнять на устройстве. Например, команда reset или команда для переключения вентилятора.

В следующем примере показано определение интерфейса термостата:

```json
{
  "@context": "dtmi:dtdl:context;2",
  "@id": "dtmi:com:example:Thermostat;1",
  "@type": "Interface",
  "displayName": "Thermostat",
  "description": "Reports current temperature and provides desired temperature control.",
  "contents": [
    {
      "@type": [
        "Telemetry",
        "Temperature"
      ],
      "name": "temperature",
      "displayName" : "Temperature",
      "description" : "Temperature in degrees Celsius.",
      "schema": "double",
      "unit": "degreeCelsius"
    },
    {
      "@type": [
        "Property",
        "Temperature"
      ],
      "name": "targetTemperature",
      "schema": "double",
      "displayName": "Target Temperature",
      "description": "Allows to remotely specify the desired target temperature.",
      "unit" : "degreeCelsius",
      "writable": true
    },
    {
      "@type": [
        "Property",
        "Temperature"
      ],
      "name": "maxTempSinceLastReboot",
      "schema": "double",
      "unit" : "degreeCelsius",
      "displayName": "Max temperature since last reboot.",
      "description": "Returns the max temperature since last device reboot."
    },
    {
      "@type": "Command",
      "name": "getMaxMinReport",
      "displayName": "Get Max-Min report.",
      "description": "This command returns the max, min and average temperature from the specified time to the current time.",
      "request": {
        "name": "since",
        "displayName": "Since",
        "description": "Period to return the max-min report.",
        "schema": "dateTime"
      },
      "response": {
        "name" : "tempReport",
        "displayName": "Temperature Report",
        "schema": {
          "@type": "Object",
          "fields": [
            {
              "name": "maxTemp",
              "displayName": "Max temperature",
              "schema": "double"
            },
            {
              "name": "minTemp",
              "displayName": "Min temperature",
              "schema": "double"
            },
            {
              "name" : "avgTemp",
              "displayName": "Average Temperature",
              "schema": "double"
            },
            {
              "name" : "startTime",
              "displayName": "Start Time",
              "schema": "dateTime"
            },
            {
              "name" : "endTime",
              "displayName": "End Time",
              "schema": "dateTime"
            }
          ]
        }
      }
    }
  ]
}
```

В этом примере показаны два свойства (один доступ только для чтения и один для записи), тип телеметрии и команда. Минимальное описание поля имеет:

- `@type` для указания типа возможности: `Telemetry` , `Property` или `Command` .  В некоторых случаях тип включает семантический тип, позволяющий IoT Central сделать некоторые предположения о том, как справиться со значением.
- `name` для значения телеметрии.
- `schema` для указания типа данных телеметрии или свойства. Это значение может быть примитивным типом, например Double, Integer, Boolean или String. Также поддерживаются сложные типы объектов, массивы и карты.

Необязательные поля, такие как отображаемое имя и описание, позволяют добавлять дополнительные сведения в интерфейс и возможности.

## <a name="properties"></a>Элемент Property

По умолчанию свойства доступны только для чтения. Свойства только для чтения означают, что устройство сообщает значение свойства в приложении IoT Central. Приложение IoT Central не может установить значение свойства, доступного только для чтения.

Можно также пометить свойство как записываемое в интерфейсе. Устройство может получить обновление свойства, доступного для записи, из приложения IoT Central, а также отчеты об обновлениях значений свойств для приложения.

Устройства не нужно подключать для задания значений свойств. Обновленные значения передаются при следующем подключении устройства к приложению. Это поведение применимо как к свойствам только для чтения, так и к записываемым.

Не используйте свойства для отправки данных телеметрии с устройства. Например, свойство ReadOnly, например, `temperatureSetting=80` должно означать, что для температуры устройства установлено значение 80, а устройство пытается получить или остаться в этой температуре.

Для свойств, доступных для записи, приложение устройства возвращает код состояния требуемого состояния, версию и описание, чтобы указать, получил ли он значение свойства и применял его.

## <a name="telemetry"></a>Телеметрия

IoT Central позволяет просматривать данные телеметрии на панелях мониторинга и диаграммах, а также использовать правила для активации действий при достижении пороговых значений. IoT Central использует сведения в модели устройства, такие как типы данных, единицы и отображаемые имена, чтобы определить способ отображения значений телеметрии.

Функцию экспорта данных IoT Central можно использовать для потоковой передачи телеметрии в другие назначения, такие как хранилище или концентраторы событий.

## <a name="commands"></a>Команды

По умолчанию команда должна выполняться в течение 30 секунд, а при получении команды устройство должно быть подключено. Если устройство отвечает вовремя или устройство не подключено, команда завершается ошибкой.

Команды могут иметь параметры запроса и возвращать ответ.

### <a name="offline-commands"></a>Автономные команды

Вы можете выбрать команды очереди, если устройство находится в автономном режиме, включив параметр **очередь в автономном** режиме для команды в шаблоне устройства.

Автономные команды — это односторонние уведомления для устройства из вашего решения. Автономные команды могут иметь параметры запроса, но не возвращать ответ.

> [!NOTE]
> Этот параметр доступен только в веб-ИНТЕРФЕЙСе IoT Central. Этот параметр не включается при экспорте модели или интерфейса из шаблона устройства.

## <a name="cloud-properties"></a>Свойства облака

Свойства облака являются частью шаблона устройства, но не являются частью модели устройства. Свойства облака позволяют разработчику решения указать метаданные устройства для хранения в IoT Central приложении. Свойства облака не влияют на код, который разработчик устройства записывает для реализации модели устройства.

Разработчик решения может добавить свойства облака в панели мониторинга и представления вместе со свойствами устройства, чтобы позволить оператору управлять устройствами, подключенными к приложению. Разработчик решения также может использовать облачные свойства как часть определения правила, чтобы сделать пороговое значение доступным для изменения оператором.

## <a name="customizations"></a>Настройки

Настройки являются частью шаблона устройства, но не являются частью модели устройства. Настройки позволяют разработчику решения усовершенствовать или переопределить некоторые определения в модели устройства. Например, разработчик решения может изменить отображаемое имя для типа телеметрии или свойства. Разработчик решения также может использовать настройки для добавления проверки, например минимальной или максимальной длины для свойства устройства строки.

Настройки могут повлиять на код, записываемый разработчиком устройства для реализации модели устройства. Например, настройка может установить минимальную и максимальную длину строк или минимальное и максимальное числовые значения для телеметрии.

## <a name="views"></a>Представления

Разработчик решения создает представления, которые позволяют операторам отслеживать подключенные устройства и управлять ими. Представления являются частью шаблона устройства, поэтому представление связано с конкретным типом устройства. Представление может включать:

- Диаграммы для построения данных телеметрии.
- Плитки для просмотра свойств устройства, доступного только для чтения.
- Плитки, позволяющие оператору изменять свойства устройства, доступного для записи.
- Плитки, позволяющие оператору изменять свойства облака.
- Плитки, чтобы позволить оператору вызывать команды, включая команды, для которых требуются полезные данные.
- Плитки для вывода меток, изображений или Markdown текста.

Данные телеметрии, свойства и команды, которые можно добавить в представление, определяются моделью устройства, свойствами облака и настройками в шаблоне устройства.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда разработчик устройства познакомились с шаблонами устройств, мы предлагаем следующие шаги для чтения [полезных данных телеметрии, свойств и команд](./concepts-telemetry-properties-commands.md) для получения дополнительных сведений об обмене данными с IOT Central.

Как разработчик решения, предлагаемый следующий шаг — прочитать [Определение нового типа устройства IOT в приложении Azure IOT Central](./howto-set-up-template.md) , чтобы узнать больше о том, как создать шаблон устройства.
