---
title: Создание панели мониторинга для анализа данных о здоровье в Azure IoT Central | Документация Майкрософт
description: Сведения о создании панели мониторинга для анализа данных о здоровье с помощью шаблонов приложений Azure IoT Central.
author: philmea
ms.author: philmea
ms.date: 10/23/2019
ms.topic: tutorial
ms.service: iot-central
services: iot-central
manager: eliotgra
ms.openlocfilehash: b0f3a486edb0c650a4a14e5e60b4459f758a64d4
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73499941"
---
# <a name="tutorial-build-a-power-bi-provider-dashboard"></a>Руководство по Создание панели мониторинга для поставщика Power BI

[!INCLUDE [iot-central-pnp-original](../../../includes/iot-central-pnp-original-note.md)]

При создании решения для непрерывного мониторинга состояния пациентов может потребоваться создать для сотрудников больницы панель мониторинга с визуализацией данных о пациентах. В этом руководстве представлена пошаговая процедура, которая позволяет создать панель мониторинга Power BI для данных, передаваемых в реальном времени из шаблона приложения IoT Central для непрерывного мониторинга состояния пациентов.

>[!div class="mx-imgBorder"]
>![Изображение панели мониторинга](media/dashboard-gif-3.gif)

Базовая архитектура соответствует такой схеме:

>[!div class="mx-imgBorder"] 
>![Панель мониторинга для поставщика](media/dashboard-architecture.png)

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * экспорт данных из Azure IoT Central в Центры событий Azure;
> * настройка набора данных для потоковой передачи в Power BI;
> * подключение приложения логики к Центрам событий Azure;
> * потоковая передача данных в Power BI из приложения логики;
> * создание панели мониторинга для получения данных о жизненно важных показателях пациента в реальном времени.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [зарегистрируйтесь для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* Шаблон приложения Azure IoT Central для непрерывного мониторинга состояния пациентов. Если у вас его еще нет, вы можно выполнить [процедуру развертывания шаблона приложения](overview-iot-central-healthcare.md).

* [Пространство имен Центров событий и Центр событий](https://docs.microsoft.com/azure/event-hubs/event-hubs-create) в Azure.

* Приложение логики, из которого нужен доступ к Центру событий. Чтобы запускать приложение логики с помощью триггера Центров событий Azure, требуется [пустое приложение логики](https://docs.microsoft.com/azure/logic-apps/quickstart-create-first-logic-app-workflow).

* Учетная запись службы Power BI. Если у вас ее еще нет, можно [создать бесплатную пробную учетную запись для службы Power BI](https://app.powerbi.com/). Если вы еще не работали с Power BI, вам может пригодиться руководство [Начало работы с Power BI](https://docs.microsoft.com/power-bi/service-get-started).

## <a name="set-up-a-continuous-data-export-to-azure-event-hubs"></a>Настройка непрерывного экспорта данных в Центры событий Azure
Для начала необходимо настроить непрерывный экспорт данных из шаблона приложения Azure IoT Central в Центр событий Azure, размещенный в вашей подписке. Для этого можно выполнить действия, описанные в руководстве по [экспорту в Центры событий](https://docs.microsoft.com/azure/iot-central/core/howto-export-data-pnp) для Azure IoT Central. Экспортировать придется только те данные телеметрии, которые нужны для работы с этим руководством.

## <a name="create-a-power-bi-streaming-dataset"></a>Создание набора данных для потоковой передачи в Power BI

1. Выполните вход в учетную запись Power BI.

2. В любой рабочей области создайте набор данных для потоковой передачи, нажав кнопку **+ Создать** в правом верхнем углу панели инструментов. Вам потребуется создать отдельный набор данных для каждого пациента, показатели которого вы хотите отслеживать на панели мониторинга.

    >[!div class="mx-imgBorder"] 
    >![Создание набора данных для потоковой передачи](media/create-streaming-dataset.png)

3. Выберите **API** в качестве источника для набора данных.

4. Введите **имя** для набора данных (например, имя пациента) и заполните сведения о нужном потоке данных. Представленный ниже пример основан на значениях, которые поступают от имитированных устройств в шаблоне приложения для непрерывного мониторинга состояния пациентов. В этом примере есть два пациента:

    * Teddy Silvers, для которого предоставляются данные из Smart Knee Brace;
    * Yesenia Sanford, для которой предоставляются данные из Smart Vitals Patch.

    >[!div class="mx-imgBorder"] 
    >![Ввод значений для набора данных](media/enter-dataset-values.png)

Дополнительные сведения о наборах данных для потоковой передачи в Power BI см. в документе [о потоковой передаче в реальном времени в Power BI](https://docs.microsoft.com/power-bi/service-real-time-streaming).

## <a name="connect-your-logic-app-to-azure-event-hubs"></a>Подключение приложения логики к Центрам событий Azure
Чтобы подключить приложение логики к Центрам событий Azure, выполните инструкции из документа [об отправке событий с помощью Центров событий Azure и Azure Logic Apps](https://docs.microsoft.com/azure/connectors/connectors-create-api-azure-event-hubs#add-event-hubs-action). Ниже перечислены некоторые рекомендуемые параметры.

|Параметр|Значение|
|---|---|
|Тип содержимого|приложение/json|
|Интервал|3|
|Frequency|Секунда|

После завершения этого шага запрос в конструкторе приложений логики должен выглядеть следующим образом:

>[!div class="mx-imgBorder"] 
>![Подключение Logic Apps к Центрам событий](media/eh-logic-app.png)

## <a name="stream-data-to-power-bi-from-your-logic-app"></a>Потоковая передача данных в Power BI из приложения логики
Следующим шагом будет анализ данных, поступающих из Центра событий, для последующей потоковой передачи в созданные ранее наборы данных Power BI.

1. Чтобы это выполнить, вам нужно разобраться в формате полезных данных JSON, которые передаются с устройства в Центр событий. Для этого изучите [этот пример схемы](https://docs.microsoft.com/azure/iot-central/core/howto-export-data-pnp#telemetry) и измените его в соответствии со своем схемой или изучите сообщения с помощью [обозревателя служебной шины](https://github.com/paolosalvatori/ServiceBusExplorer). Если вы используете приложения для непрерывного мониторинга состояния пациентов, сообщения будут выглядеть следующим образом:

**Данные телеметрии Smart Vitals Patch**

```json
{
  "HeartRate": 80,
  "RespiratoryRate": 12,
  "HeartRateVariability": 64,
  "BodyTemperature": 99.08839032397609,
  "BloodPressure": {
    "Systolic": 23,
    "Diastolic": 34
  },
  "Activity": "walking"
}
```

**Данные телеметрии Smart Knee Brace**

```json
{
  "Acceleration": {
    "x": 72.73510947763711,
    "y": 72.73510947763711,
    "z": 72.73510947763711
  },
  "RangeOfMotion": 123,
  "KneeBend": 3
}
```

**Свойства**

```json
{
  "iothub-connection-device-id": "1qsi9p8t5l2",
  "iothub-connection-auth-method": "{\"scope\":\"device\",\"type\":\"sas\",  \"issuer\":\"iothub\",\"acceptingIpFilterRule\":null}",
  "iothub-connection-auth-generation-id": "637063718586331040",
  "iothub-enqueuedtime": 1571681440990,
  "iothub-message-source": "Telemetry",
  "iothub-interface-name": "Patient_health_data_3bk",
  "x-opt-sequence-number": 7,
  "x-opt-offset": "3672",
  "x-opt-enqueued-time": 1571681441317
}
```

2. Теперь, когда вы проверили полезные данные JSON, вернитесь в конструктор приложений логики и щелкните **+ Новый шаг**. Найдите действие **Инициализировать переменную** и добавьте его в качестве следующего шага со следующими параметрами:

    |Параметр|Значение|
    |---|---|
    |ИМЯ|Имя_интерфейса|
    |type|Строка,|

    Щелкните **Сохранить**. 

3. Добавьте еще одну переменную с именем **Body** и типом **Строка**. Теперь в приложении логики добавлены следующие действия:

    >[!div class="mx-imgBorder"]
    >![Инициализация переменных](media/initialize-string-variables.png)
    
4. Выберите **+ Новый шаг** и добавьте действие **Анализ JSON**. Присвойте этому шагу имя **Анализ свойств**. В области "Содержимое" выберите **Свойства**, которые поступают из Центра событий. Щелкните **Использовать пример полезной нагрузки, чтобы создать схему** в нижней части страницы и вставьте пример полезных данных из расположенного выше раздела "Свойства".

5. Затем выберите действие **Задать переменную** и обновите переменную **Имя_интерфейса**, указав значение **iothub-interface-name** из проанализированных свойств JSON.

6. Добавьте элемент управления **Разделить** в качестве следующего действия и выберите разделение по переменной **Имя_интерфейса**. Этот элемент будет использоваться для фильтрации нужного набора данных.

7. В приложении Azure IoT Central найдите переменную "Имя_интерфейса" для данных о здоровье от поставщиков Smart Vitals Patch и Smart Knee Brace в представлении **Шаблоны устройств**. Создайте два разных варианта в элементе управления **Переключение**, по одному для каждой переменной "Имя_интерфейса", и переименуйте элемент управления соответствующим образом. Можно задать вариант по умолчанию, который будет использовать элемент управления **Завершение**, и выбрать отображаемое состояние.

    >[!div class="mx-imgBorder"] 
    >![Элемент управления "Разделение"](media/split-by-interface.png)

8. Для варианта **Smart Vitals Patch** добавьте действие **Анализ JSON**. В области **Содержимое** выберите содержимое, которое поступает из Центра событий. Скопируйте и вставьте предложенный выше образец полезных данных для Smart Vitals Patch, чтобы создать схему.

9. Добавьте действие **Задать переменную**, чтобы обновить переменную **Body** значением **Body** из проанализированного на шаге 7 объекта JSON.

10. Добавьте элемент управления **Условие** в качестве следующего действия и задайте для него условие **Body**, **contains**, **HeartRate**. Это действие позволит убедиться, что от Smart Vitals Patch поступает правильный набор данных, прежде чем использовать его для заполнения набора данных Power BI. Теперь шаги 7–9 будут выглядеть так:

    >[!div class="mx-imgBorder"] 
    >![Добавление условия для Smart Vitals](media/smart-vitals-pbi.png)

11. В варианте **True** для этого условия добавьте действие, которое вызывает функцию Power BI **Добавление строк в набор данных**. Для этого потребуется выполнить вход в Power BI. В варианте **False** можно снова использовать элемент управления **Завершение**.

12. Выберите нужные значения для параметров **Рабочая область**, **Набор данных** и **Таблица**. Сопоставьте параметры, которые вы указали при создании набора данных для потоковой передачи в Power BI, со значениями из проанализированного объекта JSON, который поступает из Центра событий. Готовые действия должны выглядеть следующим образом.

    >[!div class="mx-imgBorder"] 
    >![Добавление строк в Power BI](media/add-rows-yesenia.png)

13. Для варианта переключения **Smart Knee Brace** добавьте действие **Анализ JSON**, чтобы проанализировать содержимое, как и на шаге 7. После этого укажите действие **Добавить строки в набор данных**, чтобы обновить набор данных Teddy Silvers в Power BI.

    >[!div class="mx-imgBorder"] 
    >![Добавление условия для Smart Vitals](media/knee-brace-pbi.png)

14. Щелкните **Сохранить** и запустите приложение логики.

## <a name="build-a-real-time-dashboard-for-patient-vitals"></a>Создание панели мониторинга для получения данных о жизненно важных параметрах пациента в режиме реального времени
Теперь вернитесь в Power BI и выберите команду **+ Создать **, чтобы создать новую** Панель мониторинга**. Присвойте панели мониторинга имя и щелкните **Создать**.

На панели навигации вверху щелкните символ многоточия и выберите действие **+ Добавить плитку**.

>[!div class="mx-imgBorder"] 
>![Добавление плитки на панели мониторинга](media/add-tile.png)

Выберите тип плитки, которую вы хотите добавить, и настройте приложение в соответствии с вашими задачами.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы не собираетесь использовать это приложение в дальнейшем, удалите все его ресурсы, выполнив следующие действия.

1. На портале Azure удалите созданные ресурсы Центра событий и Logic Apps.

2. Перейдите на вкладку администрирования для приложения IoT Central и щелкните **Удалить**.

## <a name="next-steps"></a>Дополнительная информация

* Изучите справочное руководство [Архитектура приложения для непрерывного мониторинга состояния пациентов](concept-continuous-patient-monitoring-architecture.md).
