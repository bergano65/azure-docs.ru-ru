---
title: Учебник. Создание правил и управление ими в приложении Azure IoT Central
description: В этом руководстве показано, как правила Azure IoT Central позволяют вам отслеживать устройства практически в реальном времени и автоматически вызывать действия (например, отправлять сообщение электронной почты) при срабатывании правила.
author: dominicbetts
ms.author: dobett
ms.date: 12/09/2019
ms.topic: tutorial
ms.service: iot-central
services: iot-central
manager: philmea
ms.openlocfilehash: 793bb46e14725b14c766569e8b0fc2aa0246858e
ms.sourcegitcommit: 5ab4f7a81d04a58f235071240718dfae3f1b370b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2019
ms.locfileid: "74979059"
---
# <a name="tutorial-create-a-rule-and-set-up-notifications-in-your-azure-iot-central-application-preview-features"></a>Руководство по Создание правила и настройка уведомлений в приложении Azure IoT Central (функции предварительной версии)

*Эта статья предназначена для операторов, разработчиков и администраторов.*

[!INCLUDE [iot-central-pnp-original](../../../includes/iot-central-pnp-original-note.md)]

Вы можете использовать Azure IoT Central для удаленного мониторинга подключенных устройств. Правила Azure IoT Central позволяют вам отслеживать устройства практически в реальном времени и автоматически вызывать действия, например отправлять сообщение электронной почты. Всего в несколько щелчков вы можете определить условие для отслеживания телеметрии с устройств и настроить соответствующее действие. В этой статье объясняется, как создать правила для отслеживания телеметрии, отправляемой устройством.

Устройства могут использовать телеметрию для отправки числовых данных с устройства. Правило срабатывает, когда данные телеметрии выбранного устройства превышают указанное пороговое значение.

В этом учебнике вы создадите правило, которое отправляет сообщение электронной почты, когда температура на датчике окружающей среды превышает 80 &deg;F.

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание правила
> * Добавление действия электронной почты

## <a name="prerequisites"></a>Предварительные требования

Перед началом работы вам необходимо завершить два предыдущих кратких руководства по [созданию приложения Azure IoT Central](./quick-deploy-iot-central.md) и [добавлению имитированного устройства в приложение IoT Central](./quick-create-pnp-device.md), чтобы создать шаблон устройства **Датчик окружающей среды** и работать с ним.

## <a name="create-a-rule"></a>Создание правила

Чтобы создать правило телеметрии, шаблон устройства должен иметь по крайней мере одно определенное измерение телеметрии. В этом учебнике используется устройство датчика окружающей среды, которое отправляет данные телеметрии температуры и влажности. Вы добавили этот шаблон устройства и создали имитацию устройства в кратком руководстве по [добавлению имитированного устройства в приложение IoT Central](./quick-create-pnp-device.md). Правило отслеживает передаваемые устройством данные температуры и отправляет сообщение электронной почты, когда температура превышает 80 градусов.

1. В левой области щелкните **Правила**.

1. Если вы еще не создали правило, появится следующий экран:

    ![Правила отсутствуют](media/tutorial-create-telemetry-rules/rules-landing-page1.png)

1. Выберите **+** , чтобы добавить новое правило.

1. Введите имя _Монитор температуры_, чтобы указать правило, и нажмите клавишу ВВОД.

1. Выберите шаблон устройства **датчика окружающей среды**. По умолчанию правило автоматически применяется ко всем устройствам, связанным с шаблоном устройства. Чтобы выполнить фильтрацию для подмножества устройств, выберите **+ Фильтр** и используйте свойства устройств для их определения. Чтобы отключить правило, в заголовке правила переведите переключатель в положение **Включено/Отключено**:

    ![Фильтры и включение](media/tutorial-create-telemetry-rules/device-filters.png)

### <a name="configure-the-rule-conditions"></a>Настройка условий правила

Условия определяют критерии, которые отслеживает правило. В этом учебнике настройте правило, которое будет срабатывать, когда температура превысит 80&deg; F.

1. Выберите **Температура** в раскрывающемся списке **Телеметрия**.

1. Затем выберите **Больше** в качестве **оператора** и введите _80_ в качестве **значения**.

    ![Условие](media/tutorial-create-telemetry-rules/condition-filled-out1.png)

1. При необходимости можно задать **агрегацию по времени**. При выборе агрегации по времени необходимо также выбрать тип агрегата, например "среднее значение" или "сумма", в раскрывающемся списке.

    * Без агрегирования правило запускается для каждой точки данных телеметрии, которая соответствует условию. Например, если правило настроено на активацию, когда температура превышает 80, то правило будет активироваться почти мгновенно, когда устройство сообщит о температуре больше 80.
    * При использовании агрегирования правило срабатывает, если агрегированное значение точек данных телеметрии во временном окне соответствует условию. Например, если правило настроено для активации, когда температура превышает 80, для параметра агрегации по времени задано значение 10 минут, а для типа агрегата — "среднее значение", то правило срабатывает, когда устройство сообщает о средней температуре > 80, вычисленной за 10-минутный интервал.

     ![Условие агрегирования](media/tutorial-create-telemetry-rules/aggregate-condition-filled-out1.png)

Вы можете добавить несколько условий к правилу, выбрав **+ Условие**. Если задано несколько условий, для срабатывания правила необходимо, чтобы были соблюдены все условия. Каждое условие присоединяется с помощью неявного предложения `AND`. Если вы используете агрегацию по времени с несколькими условиями, все значения телеметрии должны быть агрегированы.

### <a name="configure-actions"></a>Настройка действий

После определения условия необходимо настроить действия, выполняемые при срабатывании правила. Действия вызываются в том случае, если соблюдаются все условия, указанные в правиле. В настоящее время единственным доступным действием является отправка сообщения.

1. Щелкните **+ Электронная почта** в разделе **Действия**.

1. Введите _Предупреждение о температуре_ в качестве отображаемого имени действия, ваш адрес электронной почты в поле **Кому** и текст _Проверьте устройство!_ как примечание, которое отображается в тексте сообщения.

    > [!NOTE]
    > Письма отправляются только пользователям, которые были добавлены в приложение и входили в систему минимум один раз. Узнайте больше об [управлении пользователями](howto-administer.md) в Azure IoT Central.

   ![Настройка действия](media/tutorial-create-telemetry-rules/configure-action1.png)

1. Чтобы сохранить действие, нажмите кнопку **Готово**. К правилу можно добавить несколько действий.

1. Чтобы сохранить правило, нажмите кнопку **Сохранить**. Правило станет активным в течение нескольких минут и начнет выполнять мониторинг данных телеметрии, отправляемых в приложение. Если указанное в правиле условие соблюдается, правило активирует настроенное действие отправки электронной почты.

Через некоторое время в случае срабатывания правила вы получите сообщение электронной почты:

![Пример сообщения электронной почты:](media/tutorial-create-telemetry-rules/email.png)

## <a name="delete-a-rule"></a>Удаление правила

Если вам больше не нужно правило, удалите его. Для этого откройте правило и щелкните **Удалить**.

## <a name="enable-or-disable-a-rule"></a>Включение и отключение правила

Выберите правило, которое требуется включить или отключить. Установите переключатель **Включить** или **Отключить** в правиле, чтобы включить или отключить правило для всех устройств, охватываемых этим правилом.

## <a name="enable-or-disable-a-rule-for-a-device"></a>Включение или отключение правила для устройства

Выберите правило, которое требуется включить или отключить. Добавьте фильтр в раздел **Области**, чтобы включить или исключить определенное устройство в шаблоне устройства.

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

* Создание правила на основе телеметрии
* Добавление действия

Теперь, когда вы определили правило на основе порогового значения, рекомендуется выполнить такой следующий шаг:

> [!div class="nextstepaction"]
> [настройка непрерывного экспорта данных](./howto-export-data.md).
