---
title: Часто задаваемые вопросы о службе "Центры событий Azure" | Документация Майкрософт
description: В этой статье содержится список часто задаваемых вопросов о службе "Центры событий Azure" и ответы на эти вопросы.
services: event-hubs
documentationcenter: na
author: ShubhaVijayasarathy
manager: timlt
ms.service: event-hubs
ms.topic: article
ms.custom: seodec18
ms.date: 12/06/2018
ms.author: shvija
ms.openlocfilehash: ce9c6a83d664bc9ad1798792f7762556c9a0d541
ms.sourcegitcommit: 44a85a2ed288f484cc3cdf71d9b51bc0be64cc33
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64690275"
---
# <a name="event-hubs-frequently-asked-questions"></a>Часто задаваемые вопросы о Центрах событий

## <a name="general"></a>Общие сведения

### <a name="what-is-an-event-hubs-namespace"></a>Что такое пространство имен Центров событий?
Пространство имен — это контейнер, ограничивающий область действия для Центра событий и (или) разделов Kafka. Оно предоставляет уникальное [полное доменное имя (FQDN)](https://en.wikipedia.org/wiki/Fully_qualified_domain_name). Пространство имен выполняет роль контейнера приложений, в котором могут размещаться несколько Центров событий и (или) разделов Kafka. 

### <a name="what-is-the-difference-between-event-hubs-basic-and-standard-tiers"></a>Какова разница между Центрами событий ценовых категорий "Базовый" и "Стандартный"?

Центры событий ценовой категории "Стандартный" предоставляют функции, недоступные для категории "Базовый". Ценовая категория "Стандартный" включает в себя следующие функции:

* более длительное хранение событий;
* дополнительные подключения через брокер с оплатой избыточных событий в случае превышения установленного количества;
* возможность использования нескольких [групп объектов-получателей](event-hubs-features.md#consumer-groups);
* [возможность использования функции записи](event-hubs-capture-overview.md).
* [Интеграция с Kafka](event-hubs-for-kafka-ecosystem-overview.md)

Дополнительные сведения о ценовых категориях, включая Центры событий ценовой категории "Выделенный", см. на странице [цен на Центры событий](https://azure.microsoft.com/pricing/details/event-hubs/).

### <a name="where-is-azure-event-hubs-available"></a>Где доступны Центры событий Azure?

Центры событий Azure доступны во всех поддерживаемых регионах Azure. Список см. на странице [регионов Azure](https://azure.microsoft.com/regions/).  

### <a name="can-i-use-a-single-amqp-connection-to-send-and-receive-from-multiple-event-hubs"></a>Можно ли использовать одно AMQP-подключение для отправки и получения из нескольких концентраторов событий?

Да, при условии, что все концентраторы событий находятся в одном пространстве имен.

### <a name="what-is-the-maximum-retention-period-for-events"></a>Каков максимальный срок хранения событий?

Центры событий (цен. категория "Стандартный") в настоящее время поддерживают максимальный срок хранения в семь дней. Концентраторы событий не предназначены для постоянного хранения данных. Срок хранения более 24 часов предназначен для сценариев, в которых удобно воспроизводить поток событий в тех же системах. Например, для обучения или проверки новой модели машинного обучения на основе существующих данных. Если требуется хранить сообщения дольше семи дней, включите функцию [Сбор](event-hubs-capture-overview.md) в Центрах событий, чтобы извлекать из концентратора событий данные в учетную запись хранения или учетную запись службы Azure Data Lake по своему выбору. Включение записи повлечет за собой затраты в соответствии с приобретенной единицей пропускной способности.

### <a name="how-do-i-monitor-my-event-hubs"></a>Как применить мониторинг для концентраторов событий?
Концентраторы событий создают метрики, которые предоставляют в [Azure Monitor](../azure-monitor/overview.md) полные данные о состоянии ресурсов. Они позволяют оценить общую работоспособность службы Центров событий не только на уровне пространства имен, но также и на уровне сущностей. Узнайте, какие возможности мониторинга поддерживаются для [Центров событий Azure](event-hubs-metrics-azure-monitor.md).

### <a name="what-ports-do-i-need-to-open-on-the-firewall"></a>Какие порты необходимо открыть на брандмауэре? 
Для отправки и получения сообщений со служебной шиной Azure можно использовать следующие протоколы:

- Протокол AMQP
- HTTP
- Apache Kafka

См. в следующей таблице исходящие порты, которые необходимо открыть, чтобы использовать эти протоколы для взаимодействия с концентраторами событий Azure. 

| Protocol | порты; | Сведения | 
| -------- | ----- | ------- | 
| AMQP | 5671 и 5672 | См. в разделе [руководство по использованию протокола AMQP](../service-bus-messaging/service-bus-amqp-protocol-guide.md) | 
| HTTP, HTTPS | 80, 443 |  |
| Kafka | 9092 | См. в разделе [использование концентраторов событий из приложений Kafka](event-hubs-for-kafka-ecosystem-overview.md)

### <a name="what-ip-addresses-do-i-need-to-whitelist"></a>Какие IP-адреса необходимо добавить в список разрешений?
Чтобы найти правой IP-адреса в список разрешений для подключений, выполните следующие действия.

1. Выполните следующую команду из командной строки: 

    ```
    nslookup <YourNamespaceName>.servicebus.windows.net
    ```
2. Запишите IP-адрес, возвращаемый в `Non-authoritative answer`. Этот IP-адрес является статическим. Единственный момент времени, при этом изменяются является его восстановить пространство имен на другом кластере.

Если вы используете избыточности зон для пространства имен, вам потребуется выполнить несколько дополнительных действий. 

1. Во-первых можно запустить команду nslookup в пространстве имен.

    ```
    nslookup <yournamespace>.servicebus.windows.net
    ```
2. Запишите имя в **не заслуживающего доверия ответов** раздела, в котором находится в одном из следующих форматов: 

    ```
    <name>-s1.servicebus.windows.net
    <name>-s2.servicebus.windows.net
    <name>-s3.servicebus.windows.net
    ```
3. Запустить команду nslookup для каждого из них с помощью суффиксов s1, s2 и s3, чтобы получить IP-адреса всех трех экземпляров, работающих в трех зонах доступности 

## <a name="apache-kafka-integration"></a>Интеграция с Apache Kafka

### <a name="how-do-i-integrate-my-existing-kafka-application-with-event-hubs"></a>Как интегрировать существующее приложение Kafka с Центрами событий?
Центры событий предоставляют конечную точку Kafka, которую могут использовать существующие приложения на основе Kafka. Чтобы настроить Kafka в режиме PaaS (платформа как услуга), достаточно лишь изменить конфигурацию. Так вы сможете обойтись без создания собственного кластера Kafka. Центры событий поддерживают Apache Kafka 1.0 и более новые версии клиента, а также работают с существующими приложениями, средствами и платформами Kafka. Дополнительные сведения см. в [репозитории Центров событий для Kafka](https://github.com/Azure/azure-event-hubs-for-kafka).

### <a name="what-configuration-changes-need-to-be-done-for-my-existing-application-to-talk-to-event-hubs"></a>Какие изменения нужно внести в конфигурацию, чтобы существующее приложение могло взаимодействовать с Центрами событий?
Чтобы подключиться к концентратору событий с поддержкой Kafka, следует обновить конфигурации клиента Kafka. Для этого создайте пространство имен Центров событий и получите [строку подключения](event-hubs-get-connection-string.md). Измените bootstrap.servers, чтобы он содержат полное доменное имя Центров событий и порт 9093. Обновите файл sasl.jaas.config, чтобы направлять клиентов Kafka к конечной точке Центров событий с поддержкой Kafka (с помощью полученной строки подключения) и использовать правильную аутентификацию, как показано ниже:

bootstrap.servers={ПОЛНОЕ.ДОМЕННОЕ.ИМЯ.ЦЕНТРОВ.СОБЫТИЙ}:9093 request.timeout.ms=60000 security.protocol=SASL_SSL sasl.mechanism=PLAIN sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username="$ConnectionString" password="{СТРОКА.ПОДКЛЮЧЕНИЯ.ДЛЯ.ЦЕНТРОВ.СОБЫТИЙ}";

Пример:

bootstrap.servers=dummynamespace.servicebus.windows.net:9093 request.timeout.ms=60000 security.protocol=SASL_SSL sasl.mechanism=PLAIN sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username="$ConnectionString" password="Endpoint=sb://dummynamespace.servicebus.windows.net/;SharedAccessKeyName=DummyAccessKeyName;SharedAccessKey=5dOntTRytoC24opYThisAsit3is2B+OGY1US/fuL3ly=";

Примечание. Если ваша платформа не поддерживает конфигурацию sasl.jaas.config, найдите подходящую конфигурацию, которая позволяет задать имя пользователя и пароль SASL. В качестве имени пользователя задайте $ConnectionString, а в качестве пароля — строки подключения для Центров событий.

### <a name="what-is-the-messageevent-size-for-kafka-enabled-event-hubs"></a>Каков размер сообщения (события) для Центров событий с поддержкой Kafka?
Для Центров событий с поддержкой Kafka допускается максимальный размер сообщения 1 МБ.

## <a name="throughput-units"></a>Единицы пропускной способности

### <a name="what-are-event-hubs-throughput-units"></a>Что такое единицы пропускной способности Центров событий?
Пропускная способность Центров событий определяет объем данных (в мегабайтах) или число событий (в тысячах) размером 1 КБ, которые могут проходить через Центр событий. Пропускная способность измеряется в единицах пропускной способности. Единицы пропускной способности следует приобретать заранее до начала работы со службой Центров событий. Единицы пропускной способности для Центров событий вы можете указать явным образом с помощью портала Azure или шаблонов Resource Manager для Центров событий. 


### <a name="do-throughput-units-apply-to-all-event-hubs-in-a-namespace"></a>Применяются ли единицы пропускной способности одновременно для всех Центров событий в пространстве имен?
Да, единицы пропускной способности применяются для всех Центров событий в пространстве имен. Это означает, что единицы пропускной способности приобретаются на уровне пространства имен и совместно используются всеми Центрами событий в этом пространстве имен. Каждая единица пропускной способности предоставляет следующие возможности для пространства имен:

- до 1 МБ в секунду входящих событий (событий, отправленных в концентратор событий), но не более 1000 входящих событий, операций управления или контролирующих вызовов API в секунду;
- До 2 МБ в секунду исходящих событий (событий, полученных от концентратора событий), но не более 4096 исходящих событий.
- до 84 ГБ хранилища событий (достаточно для срока хранения 24 часа, используемого по умолчанию).

### <a name="how-are-throughput-units-billed"></a>Как выставляются счета за единицы пропускной способности?
Единицы пропускной способности тарифицируются на почасовой основе. Счет выставляется, исходя из максимального числа единиц, выбранных в течение каждого часа. 

### <a name="how-can-i-optimize-the-usage-on-my-throughput-units"></a>Как правильно оптимизировать использование единиц пропускной способности?
Вы можете начать с одной единицы пропускной способности и настроить [автоматическое расширение](event-hubs-auto-inflate.md). Функция автоматического расширения позволяет увеличивать количество единиц пропускной способности по мере роста трафика и (или) объема полезных данных. Можно также задать верхний предел количества для единиц пропускной способности.

### <a name="how-does-auto-inflate-feature-of-event-hubs-work"></a>Как работает функция автоматического расширения для Центров событий?
Автоматическое расширение позволяет увеличить масштаб для единиц пропускной способности. Это позволяет вам для начала работы приобрести небольшое количество единиц пропускной способности. Автоматическое расширение будет увеличивать масштаб по мере роста объема входящих данных. Так вы сэкономите средства, сохраняя полный контроль над количеством используемых единиц пропускной способности. Эта функция выполняет **только увеличение масштаба**, а обратное снижение масштаба вы контролируете самостоятельно, изменяя количество используемых единиц пропускной способности. 

Мы предлагаем начать с небольшого значения единиц пропускной способности (например, 2). Если вы ожидаете роста трафика до 15 единиц пропускной способности, включите для пространства имен функцию автоматического расширения и установите максимальное ограничение в 15 единиц пропускной способности. Теперь количество единиц пропускной способности будет увеличиваться автоматически по мере роста трафика.

### <a name="is-there-a-cost-associated-when-i-turn-on-the-auto-inflate-feature"></a>Взимается ли плата за использование функции автоматического расширения?
Эта функция предоставляется **без дополнительных затрат**. 

### <a name="how-are-throughput-limits-enforced"></a>Как применяются ограничения пропускной способности?
Если общая входящая пропускная способность или общий коэффициент входящих событий во всех концентраторах событий в пространстве имен превышает суммарные ограничения по единицам, отправители регулируются и получают ошибки, указывающие на превышение квоты входящих сообщений.

Если общая исходящая пропускная способность или общий коэффициент исходящих событий во всех концентраторах событий в пространстве имен превышает суммарные ограничения по единицам, получатели будут регулироваться и получать ошибки, указывающие на превышение квоты исходящих сообщений. Квоты на входящие и исходящие сообщения применяются независимо, поэтому отправитель не может стать причиной замедления получения событий, а получатель — причиной прекращения отправки событий в концентратор событий.

### <a name="is-there-a-limit-on-the-number-of-throughput-units-tus-that-can-be-reservedselected"></a>Существует ли ограничение на количество зарезервированных (выбранных) единиц пропускной способности?
В мультитенантных предложениях количество единиц пропускной способности можно увеличивать до 40 (на портале вы можете настроить 20 единиц пропускной способности, а затем увеличить это число до 40 для того же пространства имен, создав запрос в службу поддержки). При объемах более 40 единиц пропускной способности Центры событий предлагают специальную модель учета ресурсов и емкости, именуемую **Центры событий ценовой категории "Выделенный"**. Центры событий ценовой категории "Выделенный" приобретаются кратно единицам мощности.

## <a name="dedicated-clusters"></a>Кластеры категории "Выделенный"

### <a name="what-are-event-hubs-dedicated-clusters"></a>Что такое Центры событий ценовой категории "Выделенный"?
Ценовая категория "Выделенный" для Центров событий позволяет создавать развертывания с одним клиентом для самых требовательных пользователей. Это предложение создает кластер с привязкой к объему ресурсов, который не ограничен единицами пропускной способности. Это означает, что вы можете использовать такой кластер для приема и потоковой передачи данных в любых объемах, которые сможет поддерживать ЦП и память кластера. Дополнительные сведения см. в статье [Обзор Центров событий ценовой категории "Выделенный"](event-hubs-dedicated-overview.md).

### <a name="how-much-does-a-single-capacity-unit-let-me-achieve"></a>Что мне предоставит одна единица емкости?
Возможности кластера ценовой категории "Выделенный" по приему и передаче данных зависят от нескольких факторов, в том числе от характеристик источников и потребителей данных, скорости передачи и обработки и т. д. 

Следующая таблица демонстрирует результаты тестов производительности, которые мы проводили.

| Формат полезных данных | Приемники | Пропускная способность для входящих данных| Количество поступающих сообщений | Пропускная способность для исходящих данных | Количество исходящих сообщений | Общее количество единиц пропускной способности | Количество единиц пропускной способности на одну единицу емкости |
| ------------- | --------- | ---------------- | ------------------ | ----------------- | ------------------- | --------- | ---------- |
| Пакеты 100×1 KB | 2 | 400 МБ в секунду | 400 тыс сообщений в секунду | 800 МБ в секунду | 800 тыс сообщений в секунду | 400 единиц пропускной способности | 100 единиц пропускной способности | 
| Пакеты 10×10 KB | 2 | 666 МБ в секунду | 66,6 тыс сообщений в секунду | 1,33 ГБ в секунду | 133 тыс сообщений в секунду | 666 единиц пропускной способности | 166 единиц пропускной способности |
| Пакеты 6×32 KB | 1 | 1,05 ГБ в секунду | 34 тыс сообщений в секунду | 1,05 ГБ в секунду | 34 тыс сообщений в секунду | 1000 единиц пропускной способности | 250 единиц пропускной способности |

При тестировании использовались следующие критерии.

- Использовался выделенный кластер Центров событий с четырьмя единицами мощности. 
- Для Центра событий, который использовался для приема сообщений, было выделено 200 разделов. 
- Принимаемые данные распределялись между двумя приложениями-получателями, каждый из которых работал со всеми разделами.

Эти результаты дают хорошее представление о том, какие характеристики можно ожидать от выделенного кластера Центров событий. Кроме того, для выделенного кластера включена функция "Сбор" в Центрах событий, поддерживающая сценарии микропакетов и долгосрочного хранения.

### <a name="how-do-i-create-an-event-hubs-dedicated-cluster"></a>Как создать кластер Центров событий ценовой категории "Выделенный"?
Чтобы создать кластер Центров событий ценовой категории "Выделенный", отправьте [запрос в службу поддержки на увеличение квоты](https://portal.azure.com/#create/Microsoft.Support) или свяжитесь с [группой разработчиков Центров событий](mailto:askeventhubs@microsoft.com). Развертывание кластера и передача пользователю, то есть вам, обычно занимает около двух недель. Такая процедура выполняется временно, пока на портале Azure или в шаблонах Azure Resource Manager не будет реализовано полноценное решение для самообслуживания, после чего развертывание кластера будет занимать около двух часов.

## <a name="best-practices"></a>Рекомендации

### <a name="how-many-partitions-do-i-need"></a>Сколько секций мне нужно?

Количество секций в концентраторе событий невозможно изменить после завершения установки. С учетом этого перед началом работы важно принять правильное решение, сколько секций вам требуется. 

В Центрах событий предусмотрен один модуль чтения секции на каждую группу потребителей. В большинстве вариантов использования значение по умолчанию (четыре секции) является достаточным. Если вы планируете масштабировать обработку событий, то рассмотрите добавление дополнительных секций. В секции нет определенного ограничения пропускной способности, однако суммарная пропускная способность в пространстве имен ограничивается количеством единиц пропускной способности. Увеличивая количество единиц пропускной способности в пространстве имен, вы можете увеличить количество секций, чтобы в параллельных модулях чтения также достигалась максимальная пропускная способность.

Тем не менее, если применяется модель, в которой приложение сопоставлено с конкретной секцией, то увеличение количества секций может не иметь никакого эффекта. Дополнительные сведения см. в статье [Доступность и согласованность в Центрах событий](event-hubs-availability-and-consistency.md).

## <a name="pricing"></a>Цены

### <a name="where-can-i-find-more-pricing-information"></a>Где я могу найти дополнительные сведения о ценах?

Полные сведения о ценах на Центры событий см. в разделе со [сведениями о ценах на Центры событий](https://azure.microsoft.com/pricing/details/event-hubs/).

### <a name="is-there-a-charge-for-retaining-event-hubs-events-for-more-than-24-hours"></a>Взимается ли плата за хранение событий Центров событий более 24 часов?

Центры событий ценовой категории "Стандартный" разрешают хранение сообщений более 24 часов, но не более 7 дней. Если общий объем всех хранимых событий превышает лимит хранения для выбранного количества единиц пропускной способности (84 ГБ для каждой единицы), то за избыточный объем взимается плата согласно опубликованным ценам на хранилище BLOB-объектов Azure. Лимит хранения для каждой единицы пропускной способности покрывает все расходы для срока хранения в 24 часа (по умолчанию), даже если единица пропускной способности использована максимально.

### <a name="how-is-the-event-hubs-storage-size-calculated-and-charged"></a>Как рассчитывается и оплачивается размер хранилища Центров событий?

Общий размер всех хранимых событий, включая внутреннюю дополнительную память для заголовков событий или дисковые накопительные структуры во всех концентраторах событий, измеряется в течение дня. В конце дня вычисляется максимальный размер хранилища. Ежедневный лимит хранения рассчитывается на основе минимального количества единиц пропускной способности, которое было выбрано в течение дня (каждая единица имеет ограничение в 84 ГБ). Если общий размер превышает рассчитанный ежедневный лимит хранения, избыточный объем оплачивается согласно ценам на хранилище BLOB-объектов Azure (по цене **локально избыточного хранилища** ).

### <a name="how-are-event-hubs-ingress-events-calculated"></a>Как рассчитываются входящие события Центров событий?

Каждое событие, отправленное в концентратор событий, считается оплачиваемым сообщением. *Входящее событие* определяется как единица данных, размер которой меньше или равен 64 КБ. Любое событие, размер которого меньше или равен 64 КБ, считается одним оплачиваемым событием. Если размер события превышает 64 КБ, то количество оплачиваемых сообщений вычисляется исходя из размера, кратного 64 КБ. Например, событие размером 8 КБ, отправленное концентратору событий, оплачивается как одно событие, а сообщение размером 96 КБ, отправленное концентратору событий, оплачивается как два события.

События, полученные от концентратора событий, а также операции по управлению и контролирующие вызовы, такие как контрольные точки, не считаются оплачиваемыми входящими событиями, но начисляются до ограничения по единицам пропускной способности.

### <a name="do-brokered-connection-charges-apply-to-event-hubs"></a>Применяется ли плата за подключение через посредника для Центров событий?

Плата за подключение взимается только при использовании протокола AMQP. При отправке событий с помощью HTTP плата за подключение не взимается вне зависимости от количества отправляющих систем или устройств. Если планируется использовать AMQP (например, для достижения более эффективной потоковой передачи событий или включения двусторонней связи в сценариях управления Интернетом вещей), то ознакомьтесь со [сведениями о ценах на Центры событий](https://azure.microsoft.com/pricing/details/event-hubs/), чтобы узнать, сколько подключений доступно на каждом уровне служб.

### <a name="how-is-event-hubs-capture-billed"></a>Как выставляются счета за использование функции "Сбор" в Центрах событий?

Функция записи активируется, когда ее включают в любом концентраторе событий пространства имен. Счет за использование функции "Сбор" в Центрах событий выставляется на почасовой основе для каждой приобретенной единицы пропускной способности. Так как количество единиц пропускной способности может увеличиваться или уменьшаться, стоимость каждого часа использования функции записи в службе "Центры событий" рассчитывается отдельно. Дополнительные сведения о выставлении счетов за использование функции "Сбор" в Центрах событий см. на [этой странице](https://azure.microsoft.com/pricing/details/event-hubs/).

### <a name="do-i-get-billed-for-the-storage-account-i-select-for-event-hubs-capture"></a>Нужно ли мне оплачивать учетную запись хранения, которая выбрана для использования функции "Сбор" в Центрах событий?

Функция записи использует учетную запись хранения, указанную при его включении в концентраторе событий. Так как эта учетная запись хранения принадлежит вам, все платежи за изменения этой конфигурации оплачиваются через вашу подписку Azure.

## <a name="quotas"></a>Квоты

### <a name="are-there-any-quotas-associated-with-event-hubs"></a>Существуют ли квоты, связанные с Центрами событий?

Список всех квот для Центров событий см. в статье [Квоты для Центров событий](event-hubs-quotas.md).

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="why-am-i-not-able-to-create-a-namespace-after-deleting-it-from-another-subscription"></a>Почему я не могу создать пространство имен после удаления его из другой подписки? 
При удалении пространства имен из подписки подождите 4 часа, прежде чем создать его заново с тем же именем в другой подписке. Иначе можно получить сообщение об ошибке `Namespace already exists`. 

### <a name="what-are-some-of-the-exceptions-generated-by-event-hubs-and-their-suggested-actions"></a>Какие исключения создаются Центрами событий? Какие действия можно предпринять?

Список возможных исключений Центров событий приведен в статье [Исключения обмена сообщениями Центров событий](event-hubs-messaging-exceptions.md).

### <a name="diagnostic-logs"></a>Журналы диагностики

Центры событий поддерживают два типа [журналов диагностики](event-hubs-diagnostic-logs.md) — журналы ошибок функции "Сбор" и операционные журналы. Оба типа представлены в формате JSON и могут быть включены на портале Azure.

### <a name="support-and-sla"></a>Поддержка и соглашение об уровне обслуживания

Техническая поддержка по вопросам использования Центров событий доступна через [форумы сообщества](https://social.msdn.microsoft.com/forums/azure/home?forum=servbus). Поддержка по выставлению счетов и управлению подпиской предоставляется бесплатно.

Дополнительные сведения о соглашении об уровне обслуживания см. на странице [Соглашения об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о Центрах событий см. в следующих источниках:

* [Общие сведения о Центрах событий](event-hubs-what-is-event-hubs.md)
* [Создание концентратора событий](event-hubs-create.md)
* [Автоматическое расширение Центров событий](event-hubs-auto-inflate.md)
