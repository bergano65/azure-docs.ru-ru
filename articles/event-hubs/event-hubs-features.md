---
title: Обзор функций Центров событий Azure | Документация Майкрософт
description: В этой статье приводится терминология и сведения о функциях Центров событий Azure.
ms.topic: article
ms.date: 06/23/2020
ms.openlocfilehash: 8860a8aa83a17b12236dd47d79479a82846fa8a8
ms.sourcegitcommit: a055089dd6195fde2555b27a84ae052b668a18c7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/26/2021
ms.locfileid: "98791952"
---
# <a name="features-and-terminology-in-azure-event-hubs"></a>Функции и терминология в Центрах событий Azure

Центры событий Azure — это масштабируемая служба обработки событий, которая принимает и обрабатывает большие объемы событий и данных с низкой задержкой и высокой надежностью. Подробный обзор этой службы см. в статье [Что такое Центры событий?](./event-hubs-about.md).

Эта статья продолжает тему [Центров событий](./event-hubs-about.md) и содержит техническую информацию и сведения о реализации компонентов и функций этой службы.

> [!TIP]
> [Поддержка протокола для **Apache Kafka** клиентов](event-hubs-for-kafka-ecosystem-overview.md)  (версии >= 1,0) предоставляет сетевые конечные точки, которые позволяют приложениям, созданным для использования Apache Kafka с любым клиентом, использовать концентраторы событий. Большинство существующих приложений Kafka можно просто перенастроить, чтобы они указывали на пространство имен концентратора событий вместо сервера начальной загрузки кластера Kafka. 
>
>С точки зрения затрат, эксплуатационных усилий и надежности концентраторы событий Azure — отличная альтернатива развертыванию и эксплуатации собственных кластеров Kafka и Zookeeper, а также предложений Kafka как услуга, не встроенных в Azure. 
>
> Помимо того, что вы получаете те же основные функциональные возможности, что и компонент Apache Kafka Broker, вы получаете доступ к функциям концентратора событий Azure, таким как автоматическая пакетирование и архивация через [захват концентраторов событий](event-hubs-capture-overview.md), автоматическое масштабирование и балансировка, аварийное восстановление, независимая от затрат зона доступности, гибкая и безопасная интеграция сетей, а также поддержка нескольких протоколов, в том числе


## <a name="namespace"></a>Пространство имен
Пространство имен концентраторов событий предоставляет подключенные к DNS конечные точки сети, а также различные функции управления доступом и сетевой интеграции, такие как [Фильтрация IP-адресов](event-hubs-ip-filtering.md), [Конечная точка службы виртуальной сети](event-hubs-service-endpoints.md)и [закрытая ссылка](private-link-service.md) , а также контейнер управления для одного из нескольких экземпляров концентратора событий (или разделов в Kafka терминах).

## <a name="event-publishers"></a>Издатели событий

Любая сущность, которая отправляет данные в концентратор событий, является *издателем событий* (используется в качестве синонима для *производителя событий*). Издатели событий могут публиковать события с помощью HTTPS или AMQP 1,0 или протокола Kafka. Издатели событий используют Azure Active Directoryную авторизацию с маркерами JWT, выданными OAuth2, или маркером SAS, зависящим от концентратора событий, чтобы получить доступ на публикацию.

### <a name="publishing-an-event"></a>Публикация события

Вы можете опубликовать событие через AMQP 1,0, протокол Kafka или HTTPS. Служба концентраторов событий предоставляет клиентские библиотеки для публикации событий в концентраторе событий [REST API](/rest/api/eventhub/) и [.NET](event-hubs-dotnet-standard-getstarted-send.md), [Java](event-hubs-java-get-started-send.md), [Python](event-hubs-python-get-started-send.md), [JavaScript](event-hubs-node-get-started-send.md)и [Go](event-hubs-go-get-started-send.md) . Для других сред выполнения и платформ можно использовать любой клиент AMQP 1.0, например [Apache Qpid](https://qpid.apache.org/). 

Решение об использовании AMQP или HTTPS обусловлено сценарием использования. AMQP требует установки постоянного двунаправленного сокета в дополнение к безопасности на уровне транспорта (TLS) или протоколу SSL/TLS. При инициализации сеанса AMQP имеет более высокие затраты на сеть, однако для каждого запроса протокол HTTPS требует дополнительной нагрузки TLS. AMQP обладает значительно более высокой производительностью для часто встречающихся издателей и может значительно снизить задержку при использовании с асинхронным кодом публикации.

События можно публиковать по отдельности или пакетно. Одна публикация имеет ограничение в 1 МБ, независимо от того, является ли оно отдельным событием или пакетом. Публикация событий, превышающих это пороговое значение, будет отклонена. 

Пропускная способность концентраторов событий масштабируется с помощью разделов и распределения пропускной способности (см. ниже). Не рекомендуется, чтобы издатели оставались неосведомленными о конкретной модели секционирования, выбранной для концентратора событий, и указали *ключ секции* , который используется для согласованного назначения связанных событий одной секции.

![Ключи секции](./media/event-hubs-features/partition_keys.png)

Концентраторы событий гарантируют, что все события, совместно использующие значение ключа секции, хранятся вместе и доставляются в порядке поступления. Если ключи секций используются с применением политик издателя, удостоверение издателя и значение ключа секции должны совпадать. В противном случае возникает ошибка.

### <a name="event-retention"></a>Хранение событий

Опубликованные события удаляются из концентратора событий на основе настраиваемой политики хранения, основанной на времени. Значение по умолчанию и кратчайший возможный срок хранения — 1 день (24 часа). Для концентраторов событий уровня "Стандартный" максимальный срок хранения составляет 7 дней. Для Центры событий (цен. категория "Выделенный") максимальный срок хранения составляет 90 дней.

> [!NOTE]
> Концентраторы событий — это обработчик потока событий в режиме реального времени, который не предназначен для использования вместо базы данных и (или) в качестве постоянного хранилища для бесконечно удерживаемых потоков событий. 
> 
> Чем глубже журнал потока событий, тем больше понадобятся дополнительные индексы для поиска определенного фрагмента журнала данного потока. Проверка полезных данных события и индексирования не попадает в область применения функций концентраторов событий (или Apache Kafka). Базы данных и специализированные хранилища и модули аналитики, такие как [Azure Data Lake Store](../data-lake-store/data-lake-store-overview.md), [Azure Data Lake Analytics](../data-lake-analytics/data-lake-analytics-overview.md) и [Azure синапсе](../synapse-analytics/overview-what-is.md) , поэтому гораздо лучше подходят для хранения исторических событий.
>
> [Запись концентраторов событий](event-hubs-capture-overview.md) интегрируется непосредственно с хранилищем BLOB-объектов Azure, Azure Data Lake Storage и, благодаря этой интеграции, также позволяет перемещать [события непосредственно в Azure синапсе](store-captured-data-data-warehouse.md).
>
> Если вы хотите использовать шаблон [источников событий](/azure/architecture/patterns/event-sourcing) для приложения, следует согласовать стратегию моментальных снимков с ограничениями хранения для концентраторов событий. Не следует восстанавливать материализованные представления с необработанных событий, начиная с начала. Вы наверняка бы приступили к такому подходу, когда приложение будет работать в рабочей среде в течение определенного времени и будет хорошо использоваться, и ваш построитель проекции должен быть обработан через годы событий изменения, одновременно пытаясь перейти к последним и текущим изменениям. 


### <a name="publisher-policy"></a>Политика издателя

Центры событий обеспечивают точный контроль над издателями событий через *политики издателя*. Политики издателя — это функции среды выполнения, которые упрощают обработку большого количества независимых издателей событий. Благодаря политикам издателя каждый издатель использует свой собственный уникальный идентификатор при публикации событий в концентраторе событий с помощью следующего механизма:

```http
//<my namespace>.servicebus.windows.net/<event hub name>/publishers/<my publisher name>
```

Не требуется создавать имена издателей заранее, но они должны соответствовать маркеру SAS, который используется при публикации события, для обеспечения идентификации независимого издателя. При использовании политик издателей значению **PartitionKey** присваивается имя издателя. Для правильной работы эти значения должны совпадать.

## <a name="capture"></a>Сбор данных

[Функция "Сбор" в Центрах событий](event-hubs-capture-overview.md) позволяет автоматически собирать данные потоковой передачи в Центры событий и сохранять их в выбранной учетной записи хранения BLOB-объектов или учетной записи службы Azure Data Lake. Эту функцию можно включить на портале Azure и указать минимальный размер записываемых данных и интервал времени для записи. С помощью функции "Сбор" в Центрах событий можно указать собственную учетную запись хранилища BLOB-объектов Azure и контейнер или учетную запись службы Azure Data Lake, используемую для хранения собранных данных. Зафиксированные данные записываются в формате Apache Avro.

## <a name="partitions"></a>Секции
[!INCLUDE [event-hubs-partitions](../../includes/event-hubs-partitions.md)]


## <a name="sas-tokens"></a>Маркеры SAS

Концентраторы событий используют *подписанные* URL-адрес, которые доступны на уровне пространства имен и концентратора событий. Маркер SAS создается на основе ключа SAS и хэша SHA URL-адреса, закодированного в определенном формате. С помощью имени ключа (политики) и маркера Центры событий могут повторно создать хэш, чтобы аутентифицировать отправителя. Как правило, маркеры SAS для издателей событий создаются только с привилегиями **отправки** в определенном концентраторе событий. Этот механизм URL-адреса маркера SAS является основой для идентификации издателя, представленной в политике издателя. Дополнительные сведения о работе с SAS см. в статье [Проверка подлинности подписи при общем доступе с помощью служебной шины](../service-bus-messaging/service-bus-sas.md).

## <a name="event-consumers"></a>Получатели событий

Любая сущность, считывающая данные о событиях из концентратора событий, является *потребителем события*. Все потребители Центров событий подключаются через сеанс AMQP 1.0, в рамках которого события доставляются, как только становятся доступными. Клиенту не требуется проводить опрос доступности данных.

### <a name="consumer-groups"></a>Группы потребителей

Механизм публикации или подписки центров событий включается с помощью *групп потребителей*. Группа потребителей — это представление всего концентратора событий (состояние, позиция или смещение). Группы потребителей обеспечивают каждому из нескольких потребляющих приложений отдельное представление потока событий, а также возможность считывания потока независимо друг от друга в своем темпе и с собственными смещениями.

В архитектуре обработки потока каждое потребляющее приложение соответствует группе потребителей. Если вы хотите записать данные событий в долговременное хранилище, то приложение, записывающее данные в хранилище, является группой потребителей. Сложную обработку событий затем может выполнить еще одна (отдельная) группа потребителей. К секции можно обращаться только через группу потребителей. В концентраторе событий всегда есть группа потребителей по умолчанию, и можно создать до 20 групп потребителей для концентратора событий стандартного уровня.

В секции для каждой группы потребителей может существовать не более пяти одновременных считывателей. Однако **рекомендуется, чтобы в секции для каждой группы потребителей поддерживался только один активный получатель**. Внутри одного раздела каждый читатель получает все сообщения. Если в одном разделе находится несколько читателей, процесс обработки сообщений будет дублироваться. Это нужно обработать в своем коде, что не может быть тривиальной задачей. Тем не менее для некоторых сценариев такой поход допустим.

Некоторые клиенты, предлагаемые пакетами SDK для Azure, являются интеллектуальными агентами потребителей, которые автоматически управляют сведениями о том, что каждая секция имеет один модуль чтения и что все секции для концентратора событий считываются из. Это позволяет коду сосредоточиться на обработке событий, считываемых из концентратора событий, чтобы можно было пропускать многие сведения о секциях. Дополнительные сведения см. [в разделе Подключение к разделу](#connect-to-a-partition).

В следующих примерах показано соглашение универсального кода ресурса группы потребителей.

```http
//<my namespace>.servicebus.windows.net/<event hub name>/<Consumer Group #1>
//<my namespace>.servicebus.windows.net/<event hub name>/<Consumer Group #2>
```

На следующем рисунке показана архитектура обработки потока Центров событий.

![Архитектура концентраторов событий](./media/event-hubs-about/event_hubs_architecture.svg)

### <a name="stream-offsets"></a>Смещение потока

*Смещение* — это положение события внутри секции. Смещение можно представить как клиентский курсор. Смещение представляет собой байт-нумерацию события. Благодаря этому потребитель события (модуль чтения) может указать точку в потоке событий, с которой требуется начать чтение событий. Можно указать смещение как отметку времени или как значение смещения. Потребители ответственны за хранение своих собственных значений смещения вне службы "Центры событий". В секции каждое событие включает смещение.

![Смещение секции](./media/event-hubs-features/partition_offset.png)

### <a name="checkpointing"></a>Назначение контрольных точек

*Создание контрольных точек* — это процесс, с помощью которого модули чтения помечают или фиксируют свое положение в последовательности событий секции. Создание контрольных точек является ответственностью потребителя и выполняется для каждой секции в пределах группы потребителей. Это означает, что для каждой группы потребителей модуль чтения каждой секции должен хранить свое текущее положение в потоке событий и может сообщать службе, когда он считает поток данных завершенным.

Если модуль чтения отключается от секции, при повторном подключении он приступает к чтению данных с контрольной точки, которая ранее была отправлена последним модулем чтения этой секции в этой группе потребителей. При подключении модуль чтения передает это смещение в концентратор событий, чтобы указать место, с которого следует начинать чтение. Таким образом, можно использовать контрольные точки как для маркировки событий как "завершенных" подчиненными приложениями, так и для обеспечения устойчивости в случае отработки отказа между модулями чтения, работающими на разных компьютерах. Вы можете вернуться к предыдущим данным, указав более низкое значение смещения по отношению к этому процессу создания контрольных точек. В рамках такого подхода при создании контрольных точек вы обеспечиваете отказоустойчивость и воспроизведение потока событий.

> [!NOTE]
> Если вы используете хранилище BLOB-объектов Azure в качестве хранилища контрольных точек в среде, которая поддерживает другую версию пакета SDK для большого двоичного объекта хранилища, чем обычно доступно в Azure, необходимо использовать код, чтобы изменить версию API службы хранилища до определенной версии, поддерживаемой этой средой. Например, если вы используете [концентраторы событий в Azure Stack Hub версии 2002](/azure-stack/user/event-hubs-overview), самая высокая доступная версия для службы хранилища — версия 2017-11-09. В этом случае необходимо использовать код для настройки API службы хранилища до версии 2017-11-09. Пример назначения конкретной версии API хранилища см. в следующих примерах на сайте GitHub: 
> - [.NET](https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/eventhub/Azure.Messaging.EventHubs.Processor/samples/). 
> - [Java](https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/eventhubs/azure-messaging-eventhubs-checkpointstore-blob/src/samples/java/com/azure/messaging/eventhubs/checkpointstore/blob/)
> - [JavaScript](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/eventhub/eventhubs-checkpointstore-blob/samples/javascript) или  [TypeScript](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/eventhub/eventhubs-checkpointstore-blob/samples/typescript)
> - [Python](https://github.com/Azure/azure-sdk-for-python/blob/master/sdk/eventhub/azure-eventhub-checkpointstoreblob-aio/samples/)

### <a name="common-consumer-tasks"></a>Стандартные задачи потребителя

Все потребители Центров событий подключаются через двунаправленный канал связи с поддержкой состояния и сеанса AMQP 1.0. Каждая секция связана с сеансом связи AMQP 1.0, что упрощает транспортировку событий, разделенных по секциям.

#### <a name="connect-to-a-partition"></a>Подключение к секции

При соединении с секциями обычно используется механизм аренды для координации соединений чтения с конкретными секциями. Таким образом, каждый раздел в группе потребителей может иметь только один активный модуль чтения. Создание контрольных точек, предоставление аренды и управление читателями упрощены с помощью клиентов в пакетах SDK концентраторов событий, которые действуют как интеллектуальные агенты потребителей. А именно:

- [Евентпроцессорклиент](/dotnet/api/azure.messaging.eventhubs.eventprocessorclient) для .NET
- [Евентпроцессорклиент](/java/api/com.azure.messaging.eventhubs.eventprocessorclient) для Java
- [Евенсубконсумерклиент](/python/api/azure-eventhub/azure.eventhub.aio.eventhubconsumerclient) для Python
- [Евенсубконсумерклиент](/javascript/api/@azure/event-hubs/eventhubconsumerclient) для JavaScript/TypeScript

#### <a name="read-events"></a>Чтение событий

После открытия сеанса и связи AMQP 1.0 для определенной секции служба Центров событий доставляет события в клиент AMQP 1.0. Этот механизм доставки обеспечивает более высокую пропускную способность и меньшую задержку, чем механизмы извлечения по запросу, такие как HTTP GET. Когда события отправляются клиенту, каждый экземпляр данных событий содержит важные метаданные, такие как смещение и порядковый номер, которые используются для упрощения создания контрольных точек в последовательности событий.

Данные событий
* Offset
* Порядковый номер
* Текст
* Свойства пользователя
* Свойства системы

Пользователь управляет смещением самостоятельно.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о Центрах событий см. по следующим ссылкам:

- Приступая к работе с Центрами событий
    - [.NET](event-hubs-dotnet-standard-getstarted-send.md)
    - [Java](event-hubs-java-get-started-send.md)
    - [Python](event-hubs-python-get-started-send.md)
    - [JavaScript](event-hubs-java-get-started-send.md)
* [Руководство по программированию Центров событий](event-hubs-programming-guide.md)
* [Доступность и согласованность в Центрах событий](event-hubs-availability-and-consistency.md)
* [Часто задаваемые вопросы о Центрах событий](event-hubs-faq.md)
* [Примеры Центров событий](event-hubs-samples.md)