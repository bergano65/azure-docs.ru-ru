---
title: Рекомендуемые конфигурации для клиентов Apache Kafka. концентраторы событий Azure
description: В этой статье приведены рекомендуемые конфигурации Apache Kafka для клиентов, взаимодействующих с концентраторами событий Azure для Apache Kafka.
ms.topic: reference
ms.date: 07/20/2020
ms.openlocfilehash: f9a03d1d3433461a575b32cd69893408a8b0ef97
ms.sourcegitcommit: 3d79f737ff34708b48dd2ae45100e2516af9ed78
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "87097672"
---
# <a name="recommended-configurations-for-apache-kafka-clients"></a>Рекомендуемые конфигурации для клиентов Apache Kafka
Ниже приведены рекомендуемые конфигурации для использования концентраторов событий Azure из клиентских приложений Apache Kafka. 

## <a name="java-client-configuration-properties"></a>Свойства конфигурации клиента Java

### <a name="producer-and-consumer-configurations"></a>Конфигурации производителя и потребителя

Свойство | Рекомендуемые значения | Разрешенный диапазон | Примечания
---|---:|-----:|---
`metadata.max.age.ms` | 180000 (приблизительно) | < 240000 | Можно уменьшить, чтобы быстрее получать изменения метаданных.
`connections.max.idle.ms`   | 180000 | < 240000 | Azure закрывает входящее бездействующее TCP-> 240 000 мс, что может привести к отправке неактивных соединений (показанных в виде пакетов с истекшим сроком действия из-за времени ожидания отправки).

### <a name="producer-configurations-only"></a>Только конфигурации Producer
Конфигурации производителя можно найти [здесь](https://kafka.apache.org/documentation/#producerconfigs).

Свойство | Рекомендуемые значения | Разрешенный диапазон | Примечания
---|---:|---:|---
`max.request.size` | 1000000 | < 1046528 | Служба будет закрывать соединения при отправке запросов, превышающих 1 046 528 байт.  *Это значение **должно** быть изменено и приведет к проблемам в сценариях создания с высокой пропускной способностью.*
`retries` | > 0 | | Может потребоваться увеличить значение delivery.timeout.ms, см. документацию.
`request.timeout.ms` | 30000.. 60 000 | > 20000| По умолчанию EH будет иметь значение не менее 20 000 мс.  *При принятии запросов с более низкими значениями времени ожидания поведение клиента не гарантируется.*
`metadata.max.idle.ms` | 180000 | > 5000 | Определяет, как долго производитель будет кэшировать метаданные для раздела, который бездействует. Если время, прошедшее с момента последнего создания раздела, превышает длительность бездействия метаданных, метаданные этого раздела заменяются, а следующий доступ к нему вызывает принудительный запрос на выборку метаданных.
`linger.ms` | > 0 | | Для сценариев с высокой пропускной способностью значение «ожидание» должно быть равно максимальному значению приемлемой, чтобы воспользоваться преимуществами пакетной обработки.
`delivery.timeout.ms` | | | Задается в соответствии с формулой ( `request.timeout.ms`  +  `linger.ms` ) * `retries` .
`enable.idempotence` | false | | Идемпотентности в настоящее время не поддерживается.
`compression.type` | `none` | | Сжатие сейчас не поддерживается..

### <a name="consumer-configurations-only"></a>Только пользовательские конфигурации
Пользовательские конфигурации можно найти [здесь](https://kafka.apache.org/documentation/#consumerconfigs).

Свойство | Рекомендуемые значения | Разрешенный диапазон | Примечания
---|---:|-----:|---
`heartbeat.interval.ms` | 3000 | | 3000 является значением по умолчанию и не должно изменяться.
`session.timeout.ms` | 30 000 |6000.. 300000| Начните с 30000, чтобы увеличить частоту повторного распределения из-за пропущенных пакетов пульса.


## <a name="librdkafka-configuration-properties"></a>Свойства конфигурации либрдкафка
Основной `librdkafka` файл конфигурации ([ссылка](https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md)) содержит расширенные описания для свойств, приведенных ниже.

### <a name="producer-and-consumer-configurations"></a>Конфигурации производителя и потребителя

Свойство | Рекомендуемые значения | Разрешенный диапазон | Примечания
---|---:|-----:|---
`socket.keepalive.enable` | true | | Требуется, если ожидается, что соединение будет бездействующим.  Azure закроет входящее бездействующее > TCP, 240 000 мс.
`metadata.max.age.ms` | ~ 180000| < 240000 | Можно уменьшить, чтобы быстрее получать изменения метаданных.

### <a name="producer-configurations-only"></a>Только конфигурации Producer

Свойство | Рекомендуемые значения | Разрешенный диапазон | Примечания
---|---:|-----:|---
`retries` | > 0 | | По умолчанию используется значение 2. Рекомендуется иметь это значение. 
`request.timeout.ms` | 30000.. 60 000 | > 20000| По умолчанию EH будет иметь значение не менее 20 000 мс.  `librdkafka`значение по умолчанию — 5000, что может быть проблематичным. *При принятии запросов с более низкими значениями времени ожидания поведение клиента не гарантируется.*
`partitioner` | `consistent_random` | См. документацию по либрдкафка | `consistent_random`используется по умолчанию и лучше.  Ключи Empty и NULL обрабатываются в большинстве случаев в идеале.
`enable.idempotence` | false | | Идемпотентности в настоящее время не поддерживается.
`compression.codec` | `none` || Сжатие сейчас не поддерживается.

### <a name="consumer-configurations-only"></a>Только пользовательские конфигурации

Свойство | Рекомендуемые значения | Разрешенный диапазон | Примечания
---|---:|-----:|---
`heartbeat.interval.ms` | 3000 || 3000 является значением по умолчанию и не должно изменяться.
`session.timeout.ms` | 30 000 |6000.. 300000| Начните с 30000, чтобы увеличить частоту повторного распределения из-за пропущенных пакетов пульса.


## <a name="further-notes"></a>Дополнительные примечания

Ознакомьтесь со следующей таблицей общих сценариев ошибок, связанных с конфигурацией.

Симптомы | Проблема | Решение
----|---|-----
Ошибки смещения фиксации из-за повторного распределения | Потребитель ожидает слишком долго между вызовами опроса (), и служба запускает потребителя из группы. | Доступно несколько параметров. <ul><li>увеличить время ожидания сеанса</li><li>уменьшить размер пакета сообщений для ускорения обработки</li><li>улучшение параллелизма обработки во избежание блокирования объекта-получателя. опроса ()</li></ul> Наиболее вероятно, что применение некоторой комбинации трех из них является наиболее разумным.
Сетевые исключения при высокой пропускной способности | Вы используете Java Client + по умолчанию max. Request. size?  Ваши запросы могут быть слишком большими. | См. раздел конфигурации Java выше.

## <a name="next-steps"></a>Дальнейшие действия
Сведения об ограничениях во всех службах Azure см. в статье [Подписка Azure, границы, квоты и ограничения службы](..//azure-resource-manager/management/azure-subscription-service-limits.md). 
