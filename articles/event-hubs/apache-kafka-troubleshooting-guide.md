---
title: Устранение неполадок концентраторов событий Azure для Apache Kafka
description: В этой статье показано, как устранять неполадки, связанные с концентраторами событий Azure для Apache Kafka
ms.topic: article
ms.date: 06/23/2020
ms.openlocfilehash: e32e02947b9f004755381d562fd3f3c897b70674
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "90061433"
---
# <a name="apache-kafka-troubleshooting-guide-for-event-hubs"></a>Руководство по устранению неполадок Apache Kafka для концентраторов событий
В этой статье содержатся советы по устранению проблем, с которыми можно столкнуться при использовании концентраторов событий для Apache Kafka. 

## <a name="server-busy-exception"></a>Исключение "сервер занят"
Вы можете получить исключение "занято сервером" из-за регулирования Kafka. При использовании клиентов AMQP концентраторы событий немедленно возвращают исключение " **занято сервером** " при регулировании службы. Это эквивалентно сообщению "повторить попытку позже". В Kafka сообщения откладываются до их завершения. Длина задержки возвращается в миллисекундах, как `throttle_time_ms` в ответе на получение или выборку. В большинстве случаев эти отложенные запросы не регистрируются в качестве исключений "сервер занят" на панелях мониторинга концентраторов событий. Вместо этого `throttle_time_ms` значение ответа следует использовать в качестве индикатора того, что пропускная способность превысила подготовленную квоту.

В случае чрезмерного трафика служба имеет следующее поведение:

- Если задержка запроса на создание превышает время ожидания запроса, концентраторы событий возвращают код ошибки **нарушения политики** .
- Если задержка запроса на получение превышает время ожидания запроса, концентраторы событий регистрируют запрос в состоянии регулирования и отвечают на пустой набор записей и без кода ошибки.

[Выделенные кластеры](event-hubs-dedicated-overview.md) не имеют механизмов регулирования. Вы можете использовать все ресурсы кластера.

## <a name="no-records-received"></a>Нет полученных записей
Вы можете видеть, что потребители не получают никаких записей и постоянно перераспределения. В этом случае потребители не получают никаких записей и постоянно перераспределяет их. При возникновении исключения или ошибки в журналах Kafka будет показано, что потребители не пытаются повторно присоединиться к группе и назначить секции. Существует несколько возможных причин.

- Убедитесь, что по `request.timeout.ms` крайней мере рекомендованное значение 60000, а `session.timeout.ms` не меньше рекомендуемого значения 30000. Если эти параметры слишком низкие, это может привести к превышению времени ожидания потребителя, что приведет к перераспределению (что может привести к большему времени ожидания, что приводит к более ребалансировке и т. д.) 
- Если конфигурация соответствует рекомендуемым значениям и вы по-прежнему видите постоянное перераспределение, вы можете открыть ошибку (обязательно включите всю конфигурацию в вопрос, чтобы мы могли помочь в отладке)!

## <a name="compressionmessage-format-version-issue"></a>Ошибка версии сжатия/формата сообщения
Kafka поддерживает сжатие, а концентраторы событий для Kafka в настоящее время не поддерживаются. Ошибки, которые упоминают версию формата сообщений (например,), `The message format version on the broker does not support the request.` вызываются, когда клиент пытается отправить сжатые сообщения Kafka брокерам.

Если требуется сжатие данных, необходимо сжать данные перед их отправкой брокерам и распаковке после получения. это допустимое решение. Тело сообщения — это просто массив байтов для службы, поэтому сжатие и распаковка на стороне клиента не будут вызывать никаких проблем.

## <a name="unknownserverexception"></a>ункновнсерверексцептион
Вы можете получить Ункновнсерверексцептион из клиентских библиотек Kafka, как показано в следующем примере: 

```
org.apache.kafka.common.errors.UnknownServerException: The server experienced an unexpected error when processing the request
```

Откройте билет со службой поддержки Майкрософт.  При отладке проблемы удобно использовать ведение журнала на уровне отладки и метки времени исключений в формате UTC. 

## <a name="other-issues"></a>Другие проблемы
Если при использовании Kafka в концентраторах событий возникают проблемы, см. следующие элементы.

- **Брандмауэр блокирует трафик** . Убедитесь, что порт **9093** не заблокирован брандмауэром.
- **Топикаусоризатионексцептион** — наиболее распространенные причины этого исключения:
    - Опечатка в строке подключения в файле конфигурации или
    - Попытка использовать концентраторы событий для Kafka в пространстве имен базового уровня. Концентраторы событий для функции Kafka [поддерживаются только для пространств имен уровня "Стандартный" и "выделенный](https://azure.microsoft.com/pricing/details/event-hubs/)".
- **Несоответствие версий Kafka** . концентраторы событий для экосистем Kafka поддерживают Kafka версии 1,0 и более поздних версий. Некоторые приложения, использующие Kafka версии 0,10 и более поздних версий, могут периодически работать из-за обратной совместимости протокола Kafka, но мы настоятельно рекомендуем использовать старые версии API. Kafka версии 0,9 и более ранних версий не поддерживают требуемые протоколы SASL и не могут подключаться к концентраторам событий.
- **Странные кодировки в заголовках AMQP при использовании с Kafka** — при отправке событий в концентратор событий через AMQP все заголовки полезных данных AMQP СЕРИАЛИЗУЮТСЯ в AMQP Encoding. Потребители Kafka не десериализует заголовки из AMQP. Для считывания значений заголовка вручную расшифровать заголовки AMQP. Кроме того, можно избежать использования заголовков AMQP, если известно, что вы будете использовать протокол Kafka. Дополнительные сведения см. в [этой статье об ошибке на GitHub](https://github.com/Azure/azure-event-hubs-for-kafka/issues/56).
- **SASL проверка подлинности** . обеспечение взаимодействия вашей платформы с протоколом проверки подлинности SASL, необходимым для концентраторов событий, может оказаться более сложной задачей, чем соответствие глазу. Узнайте, можете ли вы устранить неполадки конфигурации с помощью ресурсов вашей платформы на основе проверки подлинности SASL. 

## <a name="limits"></a>Ограничения
Apache Kafka и концентраторы событий Kafka. В большинстве случаев интерфейс Kafka для концентраторов событий Azure имеет те же значения по умолчанию, свойства, коды ошибок и общее поведение, которое Apache Kafka делает. Экземпляры, которые эти два явно отличаются (или в которых концентраторы событий накладывают ограничение на Kafka), перечислены ниже:

- Максимальная длина `group.id` свойства — 256 символов.
- Максимальный размер `offset.metadata.max.bytes` — 1024 байт.
- Фиксации смещения регулируется до 4 вызовов в секунду на секцию с максимальным внутренним размером журнала, равным 1 МБ


## <a name="next-steps"></a>Дальнейшие шаги
Дополнительные сведения о Центрах событий и Центрах событий для Kafka см. в следующих статьях:  

- [Apache Kafkaное руководством для разработчиков концентраторов событий](apache-kafka-developer-guide.md)
- [Apache Kafka руководством по миграции для концентраторов событий](apache-kafka-migration-guide.md)
- [Часто задаваемые вопросы — концентраторы событий для Apache Kafka](apache-kafka-frequently-asked-questions.md)
- [Рекомендуемые конфигурации](apache-kafka-configurations.md)
