---
title: Создание целевой страницы для бесплатного или пробного предложения SaaS в коммерческом магазине
description: Узнайте, как создать целевую страницу для бесплатного или пробного предложения SaaS.
author: mingshen-ms
ms.author: mingshen
ms.reviewer: dannyevers
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: how-to
ms.date: 09/04/2020
ms.openlocfilehash: dfa5d77077b8827bed1cbd8c7a46a5dbf361f139
ms.sourcegitcommit: 857859267e0820d0c555f5438dc415fc861d9a6b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2020
ms.locfileid: "93125722"
---
# <a name="build-the-landing-page-for-your-free-or-trial-saas-offer-in-the-commercial-marketplace"></a>Создание целевой страницы для бесплатного или пробного предложения SaaS в коммерческом магазине

В этой статье описывается процесс создания целевой страницы для бесплатного или пробного приложения SaaS, которое будет продаваться в коммерческом магазине Майкрософт.

## <a name="overview"></a>Обзор

Целевую страницу можно представить как "зал ожидания" для предложения SaaS (программное обеспечение как услуга). После того как клиент решит получить ваше приложение, коммерческий магазин направляет его на целевую страницу, чтобы активировать и настроить свою подписку на приложение SaaS. При создании предложения "программное обеспечение как услуга" (SaaS) в центре партнеров можно выбрать, следует ли [продавать в корпорации Майкрософт](plan-saas-offer.md#listing-options). Если вы хотите предоставить только предложение в коммерческом магазине Майкрософт, а не продавать в корпорации Майкрософт, можно указать, как потенциальные клиенты могут взаимодействовать с предложением. При включении параметра **получить сейчас (Free)** или **Free пробной версии** можно указать URL-адрес целевой страницы, по которому пользователь может получить доступ к бесплатной подписке или пробной версии.

Цель целевой страницы — получить пользователя, чтобы он мог активировать бесплатную пробную версию или бесплатную подписку. Используя Azure Active Directory (Azure AD) и Microsoft Graph, вы сможете включить единый вход для пользователя и получить важные сведения о пользователе, который можно использовать для активации бесплатной пробной версии или бесплатной подписки, включая их имя, адрес электронной почты и организацию.

Поскольку сведения, необходимые для активации подписки, ограничены и предоставляются Azure AD и Microsoft Graph, не нужно запрашивать сведения, требующие более простого согласия. Если вам нужны сведения о пользователе, требующие дополнительного согласия для вашего приложения, необходимо запросить эту информацию после завершения активации подписки. Это позволяет активировать беспроблемную подписку для пользователя и снизить риск отказа.

Целевая страница обычно содержит следующие сведения и параметры перечисления.

- Представьте имя и сведения о бесплатной пробной версии или бесплатной подписке. Например, укажите ограничения на использование или длительность пробной версии.
- Предоставление сведений об учетной записи пользователя, включая имя, фамилию, организацию и адрес электронной почты.
- Запрашивать у пользователя подтверждение или замену сведений о другой учетной записи.
- Руководство пользователя о дальнейших действиях после активации. Например, получите приветственное сообщение электронной почты, Управляйте подпиской, получите поддержку или ознакомьтесь с документацией.

В следующих разделах этой статьи описывается процесс создания целевой страницы.

1. [Создайте регистрацию приложения Azure AD](#create-an-azure-ad-app-registration) для целевой страницы.
2. [Используйте пример кода в качестве отправной точки](#use-a-code-sample-as-a-starting-point) для приложения.
3. [Чтение сведений из утверждений, закодированных в маркере идентификации](#read-information-from-claims-encoded-in-the-id-token), полученном из Azure AD после входа, который был отправлен с запросом.
4. При необходимости [Используйте API Microsoft Graph](#use-the-microsoft-graph-api) для сбора дополнительных сведений.

## <a name="create-an-azure-ad-app-registration"></a>Создание регистрации приложения Azure AD

Коммерческий рынок полностью интегрирован с Azure AD. Пользователи попадают в Marketplace, прошедшие проверку подлинности с помощью [учетной записи Azure AD или учетная запись Майкрософт (MSA)](../active-directory/fundamentals/active-directory-whatis.md#terminology). После приобретения бесплатной или бесплатной пробной подписки с помощью предложения "только список" пользователь переходит из коммерческого рынка в URL-адрес целевой страницы для активации и управления подпиской на приложение SaaS. Вы должны предоставить пользователю возможность входа в приложение с помощью единого входа Azure AD. (URL-адрес целевой страницы указан на странице [технической настройки](plan-saas-offer.md#technical-information) предложения.

Первый шаг к использованию удостоверения заключается в том, чтобы убедиться, что Целевая страница зарегистрирована как приложение Azure AD. Регистрация приложения позволяет использовать Azure AD для проверки подлинности пользователей и запроса доступа к ресурсам пользователей. Оно может рассматриваться как определение приложения, которое позволяет службе определять, как выдавать маркеры приложению в зависимости от параметров приложения.

### <a name="register-a-new-application-using-the-azure-portal"></a>Регистрация нового приложения с помощью портала Azure

Чтобы приступить к работе, следуйте инструкциям по [регистрации нового приложения](../active-directory/develop/quickstart-register-app.md). Чтобы позволить пользователям из других компаний посетить приложение, необходимо выбрать **учетные записи в любом каталоге организации (в любом каталоге Azure AD — клиенте) и личных учетных записях Майкрософт (например, Skype или Xbox)** , которые могут использовать приложение.

Если вы собираетесь запросить API Microsoft Graph, [Настройте новое приложение для доступа к веб-API](../active-directory/develop/quickstart-configure-app-access-web-apis.md). При выборе разрешений API для этого приложения значение по умолчанию " **пользователь. чтение** " достаточно для сбора основных сведений о пользователе, чтобы обеспечить гладкий и автоматический процесс адаптации. Не запрашивать разрешения API с меткой **"требуется согласие администратора"** , так как это позволит всем пользователям, не являющимся администраторами, посетить целевую страницу.

Если вам требуются повышенные разрешения в рамках процесса адаптации или подготовки, рассмотрите возможность использования функции [добавочного согласия](../active-directory/azuread-dev/azure-ad-endpoint-comparison.md) Azure AD, чтобы все пользователи, отправленные из Marketplace, могли изначально взаимодействовать с целевой страницей.

## <a name="use-a-code-sample-as-a-starting-point"></a>Использование примера кода в качестве отправной точки

Корпорация Майкрософт предоставила несколько примеров приложений, которые реализуют простой веб-сайт с включенным именем входа Azure AD. После регистрации приложения в Azure AD в колонке **Краткое руководство** предлагается список распространенных типов приложений и стеков разработки (рис. 1). Выберите тот, который соответствует вашей среде, и следуйте инструкциям по скачиванию и настройке.

**_Рис. 1. колонка краткого руководства в портал Azure_* _

:::image type="content" source="./media/azure-ad-saas/azure-ad-quickstart-blade.png" alt-text="В этой статье показана колонка быстрый запуск в портал Azure.":::

После загрузки кода и настройки среды разработки измените параметры конфигурации в приложении, чтобы они отражали идентификатор приложения, идентификатор клиента и секрет клиента, записанные в предыдущей процедуре. Обратите внимание, что точные шаги будут отличаться в зависимости от используемого примера.

## <a name="read-information-from-claims-encoded-in-the-id-token"></a>Чтение сведений из утверждений, закодированных в маркере идентификации

В рамках потока [подключения OpenID Connect](../active-directory/develop/v2-protocols-oidc.md) Azure AD добавляет [маркер идентификации](../active-directory/develop/id-tokens.md) в запрос, когда пользователь отправляется на целевую страницу. Этот маркер содержит несколько частей основных сведений, которые могут быть полезны в процессе активации, включая сведения, приведенные в этой таблице.

| Значение | Описание |
| ------------ | ------------- |
| aud | Предполагаемая аудитория для этого маркера. В этом случае оно должно соответствовать ИДЕНТИФИКАТОРу приложения и быть проверено. |
| preferred_username | Первичное имя пользователя для посещения. Это может быть адрес электронной почты, номер телефона или другой идентификатор. |
| электронная почта | Адрес электронной почты пользователя. Обратите внимание, что это поле может быть пустым. |
| name | Удобное для восприятия значение, идентифицирующее тему маркера. В этом случае это будет имя пользователя. |
| oid | Идентификатор в системе идентификации Майкрософт, однозначно определяющий пользователя в разных приложениях. Microsoft Graph вернет это значение в качестве свойства идентификатора для данной учетной записи пользователя. |
| tid | Идентификатор, представляющий клиент Azure AD, из которого он находится. В случае с идентификатором MSA это всегда будет `9188040d-6c67-4c5b-b112-36a304b66dad` . Дополнительные сведения см. в примечании в следующем разделе: использование Microsoft Graph API. |
| sub | Идентификатор, который уникальным образом идентифицирует пользователя в этом конкретном приложении. |
|||

## <a name="use-the-microsoft-graph-api"></a>Использование API Microsoft Graph

Маркер идентификации содержит основные сведения для идентификации пользователя, но процесс активации может потребовать дополнительных сведений, например компании пользователя, для завершения процесса адаптации. Используйте [API Microsoft Graph](/graph/use-the-api) , чтобы запросить эти сведения, чтобы не принуждать пользователя к повторному вводу этих сведений. Стандартные разрешения _ *пользователя. Read* * включают в себя следующие сведения по умолчанию:

| Значение | Описание |
| ------------ | ------------- |
| displayName | Имя, отображаемое в адресной книге для пользователя. |
| givenName | Имя пользователя. |
| jobTitle | Должность пользователя. |
| mail | SMTP-адрес пользователя. |
| mobilePhone | Основной номер сотового телефона для пользователя. |
| preferredLanguage | Код ISO 639-1 для предпочтительного языка пользователя. |
| surname | Фамилия пользователя. |
|||

Дополнительные свойства, например имя компании пользователя или расположение пользователя (страна), можно выбрать для включения в запрос. Дополнительные сведения см. [в разделе Свойства типа ресурса "пользователь"](/graph/api/resources/user?view=graph-rest-1.0#properties).

Большинство приложений, зарегистрированных в Azure AD, предоставляют делегированные разрешения на чтение сведений о пользователе из клиента Azure AD своей компании. Любой запрос на Microsoft Graph для этой информации должен сопровождаться маркером доступа в качестве проверки подлинности. Конкретные действия по созданию маркера доступа будут зависеть от используемого стека технологий, но пример кода будет содержать пример. Дополнительные сведения см. [в разделе Получение доступа от имени пользователя](/graph/auth-v2-user).

> [!NOTE]
> Учетные записи клиента MSA (с ИДЕНТИФИКАТОРом клиента `9188040d-6c67-4c5b-b112-36a304b66dad` ) не будут возвращать больше информации, чем уже были собраны с маркером идентификатора. Поэтому этот вызов можно пропустить в API Graph для этих учетных записей.

## <a name="next-steps"></a>Дальнейшие действия
- [Создание предложения SaaS в коммерческом магазине](create-new-saas-offer.md)