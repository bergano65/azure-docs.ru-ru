---
title: Управление потенциальными клиентами в Dynamics 365 Customer Engagement — коммерческая платформа Майкрософт
description: Узнайте, как настроить Dynamics 365 Customer Engagement для управления потенциальными клиентами из Microsoft AppSource и Azure Marketplace.
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
author: keferna
ms.author: keferna
ms.date: 03/30/2020
ms.openlocfilehash: 31dba5489db3778d738fc2856cf6aacfd6987711
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "90030758"
---
# <a name="configure-lead-management-for-dynamics-365-customer-engagement"></a>Настройка управления потенциальными клиентами в Dynamics 365 Customer Engagement

В этой статье описывается, как настроить Dynamics 365 Customer Engagement (прежнее название — Dynamics CRM Online). Дополнительные сведения об обработке потенциальных клиентов, полученных благодаря предложению на коммерческой платформе, см. в статье [Настройка аутентификации на основе сервера с помощью Customer Engagement и SharePoint Online](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/admin/on-prem-server-based-sharepoint-online).

>[!NOTE]
>Эти инструкции относятся только к облачной среде Dynamics 365 Customer Engagement, размещенной на серверах корпорации Майкрософт. Прямое подключение к локальной среде Dynamics в настоящее время не поддерживается. Существуют и другие способы получения потенциальных клиентов, такие как настройка [конечной точки HTTPS](./commercial-marketplace-lead-management-instructions-https.md) или [таблицы Azure](./commercial-marketplace-lead-management-instructions-azure-table.md).

## <a name="prerequisites"></a>Предварительные требования

Для выполнения шагов, описанных в этой статье, требуются следующие разрешения пользователя:

* права администратора в экземпляре Dynamics 365 Customer Engagement для установки решения;
* права администратора клиента на создание учетной записи службы для службы потенциальных клиентов, используемой для передачи потенциальных клиентов из предложений на коммерческой платформе;
* Доступ к порталу администрирования.
* доступ к порталу Azure.

## <a name="install-the-solution"></a>Установка решения

1. Скачайте [решение Microsoft Marketplace Lead Writer](https://mpsapiprodwus.blob.core.windows.net/documentation/MicrosoftMarketplacesLeadIntegrationSolution_1_0_0_0_target_CRM_6.1_managed.zip) и сохраните его на локальном компьютере.

1. Откройте Dynamics 365 Customer Engagement, перейдя по URL-адресу экземпляра Dynamics, например `https://tenant.crm.dynamics.com`.

1. Щелкните значок шестеренки на верхней панели и выберите пункт **Дополнительные параметры**.
 
    ![Пункт меню "Дополнительные параметры" в Dynamics 365](./media/commercial-marketplace-lead-management-instructions-dynamics/dynamics-advanced-settings.png)

1. На странице **Параметры** на верхней панели откройте меню **Параметры** и выберите пункт **Решения**.

    >[!NOTE]
    >Если вы не видите параметры, показанные на снимке экрана ниже, значит, у вас нет нужных разрешений. Обратитесь к администратору экземпляра Dynamics 365 Customer Engagement.

    ![Пункт "Решения" в Dynamics 365](./media/commercial-marketplace-lead-management-instructions-dynamics/dynamics-solutions.png)

1. На странице **Решения** выберите команду **Импорт** и перейдите к месту, где вы сохранили решение **Microsoft Marketplace Lead Writer**, скачанное на шаге 1.

    ![Кнопка «Импорт»](./media/commercial-marketplace-lead-management-instructions-dynamics/dynamics-crm-import.png)

1. Выполните импорт решения согласно указаниям в мастере импорта решений.

## <a name="configure-user-permissions"></a>Настройка разрешений пользователя

Чтобы записывать данные о потенциальных клиентах в экземпляр Dynamics 365 Customer Engagement, вам необходимо предоставить корпорации Майкрософт учетную запись службы и настроить для нее разрешения.

Чтобы создать учетную запись службы и назначить ей разрешения, выполните описанные ниже действия. Можно использовать Azure Active Directory или Office 365.

>[!NOTE]
>Перейдите к соответствующим инструкциям в зависимости от выбранного варианта проверки подлинности. См. [Azure Active Directory](#azure-active-directory) или [Office 365](#office-365).

### <a name="azure-active-directory"></a>Azure Active Directory

Мы рекомендуем этот вариант, так как при его использовании вам не нужно обновлять имя пользователя и пароль, чтобы продолжать получать данные о потенциальных клиентах. Чтобы использовать Azure Active Directory, нужно предоставить идентификатор приложения, ключ приложения и идентификатор каталога, полученные из приложения Active Directory.

Чтобы настроить Azure Active Directory для Dynamics 365 Customer Engagement, выполните указанные ниже действия.

1. Войдите на [портал Azure](https://portal.azure.com/). В области слева выберите **Azure Active Directory**.

1. Выберите **Свойства** и скопируйте значение **идентификатора каталога** на странице **Свойства каталога**. Сохраните это значение, так как его необходимо будет указать на портале публикации для получения сведений о потенциальных клиентах для вашего коммерческого предложения.

    ![Пункт меню "Свойства каталога" в Azure Active Directory](./media/commercial-marketplace-lead-management-instructions-dynamics/aad-properties.png)

1. В левой области в Azure Active Directory выберите **Регистрация приложений**, а затем на открывшейся странице выберите элемент **Новая регистрация**.
1. Введите понятное имя для приложения.
1. В разделе **Поддерживаемые типы учетных записей** выберите **Учетные записи в любом каталоге организации**.
1. В поле **URI перенаправления (необязательно)** выберите **Интернет** и введите универсальный код ресурса (URI), например `https://contosoapp1/auth`. 
1. Выберите **Зарегистрировать**.

    ![Страница регистрации приложения](./media/commercial-marketplace-lead-management-instructions-dynamics/register-an-application.png)

1. После регистрации приложения перейдите на страницу общих сведений о нем. Скопируйте значение **Идентификатор приложения (клиент)** на этой странице. Сохраните это значение, так как его необходимо будет указать на портале публикации и в Dynamics 365 для получения сведений о потенциальных клиентах для вашего коммерческого предложения.

    ![Поле "Идентификатор приложения (клиент)"](./media/commercial-marketplace-lead-management-instructions-dynamics/application-id.png)

1. На странице **Сертификаты и секреты** в левой области приложения нажмите кнопку **Новый секрет клиента**. Введите понятное описание секрета клиента и в разделе **Срок действия** выберите вариант **Никогда**. Выберите **Добавить**, чтобы создать секрет клиента.

    ![Пункт меню "Сертификаты и секреты"](./media/commercial-marketplace-lead-management-instructions-dynamics/aad-certificates-secrets.png)

1. После успешного создания секрета клиента скопируйте значение **Секрет клиента**. После закрытия этой страницы вы не сможете получить это значение. Сохраните это значение, так как его необходимо будет указать на портале публикации для получения сведений о потенциальных клиентах для вашего коммерческого предложения. 
1. В левой области приложения выберите пункт **Разрешения API**, а затем выберите **Добавить разрешение**.
1. Выберите **Интерфейсы API Microsoft**, а затем выберите интерфейс API **Dynamics CRM**.
1. В разделе **Какие разрешения требуются вашему приложению?** выберите пункт **Делегированные разрешения**. 
1. В разделе **Разрешение** установите флажок **user_impersonation** для **доступа к Common Data Service в качестве пользователей организации**. Нажмите кнопку **Добавить разрешения**.

    ![Кнопка "Добавить разрешения"](./media/commercial-marketplace-lead-management-instructions-dynamics/api-permissions.png)

1. После выполнения шагов 1–14 на портале Azure перейдите к экземпляру Dynamics 365 Customer Engagement по URL-адресу, например `https://tenant.crm.dynamics.com`.
1. Щелкните значок шестеренки на верхней панели и выберите пункт **Дополнительные параметры**.
1. На странице **Параметры** на верхней панели откройте меню **Параметры** и выберите пункт **Безопасность**.
1. На странице **Безопасность** выберите элемент **Пользователи**. На странице **Пользователи** в раскрывающемся списке **Включенные пользователи** выберите пункт **Пользователи приложения**.
1. Нажмите **Создать**, чтобы создать пользователя. 

    ![Создание пользователя](./media/commercial-marketplace-lead-management-instructions-dynamics/application-users.png)

1. В области **Новый пользователь** выберите пункт **ПОЛЬЗОВАТЕЛЬ: ПОЛЬЗОВАТЕЛЬ ПРИЛОЖЕНИЯ**. Укажите имя пользователя, полное имя и электронный адрес пользователя, который должен использоваться с этим подключением. Кроме того, вставьте **идентификатор приложения**, созданный на портале Azure на шаге 8. Выберите **Сохранить и закрыть**, чтобы завершить добавление пользователя.

    ![Область "Новый пользователь"](./media/commercial-marketplace-lead-management-instructions-dynamics/new-user-info.png)

1. Перейдите в раздел "Параметры безопасности" этой статьи и завершите настройку подключения для этого пользователя.

### <a name="office-365"></a>Office 365

Если вы не хотите использовать Azure Active Directory, нового пользователя можно зарегистрировать в центре администрирования Microsoft 365. Вам нужно будет обновлять свое имя пользователя и пароль каждые 90 дней, чтобы продолжать получать сведения о потенциальных клиентах.

Чтобы настроить Office 365 для Dynamics 365 Customer Engagement, выполните указанные ниже действия.

1. Выполните вход в [центр администрирования Microsoft 365](https://admin.microsoft.com).

1. Нажмите **Добавить пользователя**.

    ![Команда добавления пользователя в Центре администрирования Microsoft 365](./media/commercial-marketplace-lead-management-instructions-dynamics/ms-365-add-user.png)

1. Создайте пользователя для службы модуля записи интересов. Настройте следующие параметры:

    * Введите имя пользователя.
    * Введите пароль и снимите флажок **Потребовать смену пароля при первом входе пользователя**.
    * Укажите для пользователя роль **Пользователь (без прав администратора)** .
    * Выберите **план Dynamics 365 Customer Engagement** в качестве лицензии продукта, как показано на снимке экрана ниже. За выбранную лицензию будет начисляться плата. 

Сохраните эти значения, так как вам необходимо будет указать значения **Имя пользователя** и **Пароль** на портале публикации для получения сведений о потенциальных клиентах для вашего коммерческого предложения.

![Область "Новый пользователь" в Центре администрирования Microsoft 365.](./media/commercial-marketplace-lead-management-instructions-dynamics/ms-365-new-user.png)

## <a name="security-settings"></a>Параметры безопасности

На последнем шаге нужно разрешить созданному пользователю записывать сведения о потенциальных клиентах.

1. Откройте Dynamics 365 Customer Engagement, перейдя по URL-адресу экземпляра Dynamics, например `https://tenant.crm.dynamics.com`.
1. Щелкните значок шестеренки на верхней панели и выберите пункт **Дополнительные параметры**.
1. На странице **Параметры** на верхней панели откройте меню **Параметры** и выберите пункт **Безопасность**.
1. На странице **Безопасность** выберите **Пользователи**, а затем выберите пользователя, созданного в разделе "Настройка разрешений пользователей" этого документа. Затем выберите вкладку **Управление ролями**. 

    ![Вкладка "Управление ролями"](./media/commercial-marketplace-lead-management-instructions-dynamics/security-manage-roles.png)

1. Найдите роль с именем **Microsoft Marketplace Lead Writer** и выберите ее, чтобы назначить ее пользователю.

    ![Область "Управление ролями пользователей"](./media/commercial-marketplace-lead-management-instructions-dynamics/security-manage-user-roles.png)

    >[!NOTE]
    >Эту роль создало импортированное решение, и ей предоставлены разрешения только на запись данных о потенциальных клиентах и на отслеживание версии решения для обеспечения совместимости.

1. Вернитесь на страницу **Безопасность** и выберите элемент **Роли безопасности**. Найдите роль **Microsoft Marketplace Lead Writer** и выберите ее.

    ![Область "Роли безопасности"](./media/commercial-marketplace-lead-management-instructions-dynamics/security-roles.png)

1. На странице роли безопасности выберите вкладку **Базовые записи**. Выполните поиск элемента **Параметры интерфейса сущности пользователя**. Включите разрешения на создание, чтение и запись для пользователя (четверть желтого круга) для этой сущности, щелкнув один раз каждый из соответствующих кружков.

    ![Вкладка "Базовые записи" для Microsoft Marketplace Lead Writer](./media/commercial-marketplace-lead-management-instructions-dynamics/marketplace-lead-writer.png)

1. На вкладке **Настройка** найдите элемент **Системное задание**. Включите разрешения на чтение, запись и добавление для организации (сплошные зеленые кружки) для этой сущности, щелкнув четыре раза каждый из соответствующих кружков.

    ![Вкладка "Настройка" для Microsoft Marketplace Lead Writer](./media/commercial-marketplace-lead-management-instructions-dynamics/marketplace-lead-writer-customization.png)

1. Выберите команду **Сохранить и закрыть**.

## <a name="configure-your-offer-to-send-leads-to-dynamics-365-customer-engagement"></a>Настройка предложения для передачи потенциальных клиентов в Dynamics 365 Customer Engagement 

Чтобы настроить сведения об управлении потенциальными клиентами для своего предложения на портале публикации, выполните указанные ниже действия.

1. Перейдите на страницу **Настройка предложения** для своего предложения.
1. В разделе **Потенциальные клиенты** выберите **Подключить**.

    :::image type="content" source="./media/commercial-marketplace-lead-management-instructions-dynamics/customer-leads.png" alt-text="Потенциальные клиенты":::

1. Во всплывающем окне со сведениями о подключении в качестве назначения потенциального клиента выберите **Dynamics 365 Customer Engagement**.

    ![Поле назначения потенциального клиента](./media/commercial-marketplace-lead-management-instructions-dynamics/connection-details-lead-destination.png)

1. Введите **URL-адрес** экземпляра Dynamics 365, например `https://contoso.crm4.dynamics.com`.

1. Выберите метод **проверки подлинности**: Azure Active Directory или Office 365. 
1. Если вы выбрали **Azure Active Directory**, введите **идентификатор приложения (клиента)** (например, `23456052-aaaa-bbbb-8662-1234df56788f`), **идентификатор каталога** (например, `12345678-8af1-4asf-1234-12234d01db47`) и **секрет клиента** (например, `1234ABCDEDFRZ/G/FdY0aUABCEDcqhbLn/ST122345nBc=`).

    ![Выбор проверки подлинности с помощью Azure Active Directory](./media/commercial-marketplace-lead-management-instructions-dynamics/connection-details-application-id.png)

1. Если вы выбрали **Office 365**, введите **имя пользователя** (например, `contoso@contoso.onmicrosoft.com`) и **пароль** (например, `P@ssw0rd`).

    ![Поле имени пользователя Office 365](./media/commercial-marketplace-lead-management-instructions-dynamics/connection-details-authentication.png)

1. В разделе **Контактный адрес электронной почты** введите адреса электронной почты сотрудников организации, которые должны получать уведомления по электронной почте при обнаружении нового интереса. Можно ввести несколько адресов электронной почты через точку с запятой.
1. Щелкните **ОК**.

Чтобы убедиться в том, что вы успешно подключились к месту назначения потенциальных клиентов, нажмите кнопку **Проверить**. При успешном подключении вы получите тестового потенциального клиента в месте назначения потенциальных клиентов.

![Поле "Контактный адрес электронной почты"](./media/commercial-marketplace-lead-management-instructions-dynamics/dynamics-connection-details.png)

>[!NOTE]
>Прежде чем вы сможете получать сведения о потенциальных клиентах для своего предложения необходимо завершить настройку его остальной части и опубликовать его.
