---
title: Регистрация приложения SaaS в Azure Marketplace
description: Узнайте, как использовать портал Azure для регистрации приложения SaaS и получения маркера безопасности Azure Active Directory.
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
ms.date: 06/10/2020
author: mingshen-ms
ms.author: mingshen
ms.openlocfilehash: dddcdd52709c634f0dcf67cb982804f5556e88b9
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "88548341"
---
# <a name="register-a-saas-application"></a>Регистрация приложения SaaS

В этой статье объясняется, как зарегистрировать приложение SaaS с помощью [портал Azure](https://portal.azure.com/) Майкрософт и как получить маркер доступа издателя (Azure Active Directory маркер доступа). Издатель будет использовать этот токен для проверки подлинности приложения SaaS путем вызова API-интерфейсов выполнения SaaS.  Интерфейсы API выполнения используют учетные данные клиента OAuth 2,0, чтобы предоставить поток на конечных точках Azure Active Directory (v 1.0) для создания запроса маркера доступа между службами.

Azure Marketplace не накладывает никаких ограничений на метод проверки подлинности, используемый службой SaaS для конечных пользователей. Приведенный ниже поток необходим только для проверки подлинности службы SaaS в Azure Marketplace.

Дополнительные сведения об Azure AD (Active Directory) см. в статье [что такое проверка подлинности](../../active-directory/develop/authentication-scenarios.md)?

## <a name="register-an-azure-ad-secured-app"></a>Регистрация приложения, защищенного с помощью Azure AD

Все приложения, которые будут использовать возможности Azure AD, сначала следует зарегистрировать в клиенте Azure AD. Процесс регистрации предполагает предоставление Azure AD сведений о приложении. Чтобы зарегистрировать новое приложения с помощью портала Azure, сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com/).
2. Если ваша учетная запись предоставляет вам доступ к более чем одной службе, щелкните свою учетную запись в правом верхнем углу и задайте для сеанса портала нужный клиент Azure AD.
3. В области навигации слева щелкните службу **Azure Active Directory**, а затем выберите **Регистрация приложений** и щелкните **Регистрация нового приложения**.

    ![Регистрации приложений AD для SaaS](./media/saas-offer-app-registration-v1.png)

4. На странице создания введите сведения о регистрации приложения.
    -   **Имя**. Введите понятное имя для приложения.
    -   **Тип приложения**:  
        
        Выберите **веб-приложение или API** для [клиентских приложений](../../active-directory/develop/active-directory-dev-glossary.md#client-application)) и [приложения ресурсов или API](../../active-directory/develop/active-directory-dev-glossary.md#resource-server), которые установлены на защищенном сервере. Этот параметр используется для конфиденциальных [веб-клиентов](../../active-directory/develop/active-directory-dev-glossary.md#web-client)OAuth и клиентов, открытых [на основе агента пользователя](../../active-directory/develop/active-directory-dev-glossary.md#user-agent-based-client).
        То же приложение может также предоставлять клиент и ресурс или API.

        Конкретные примеры веб-приложений см. в руководстве по [началу работы](../../active-directory/develop/quickstart-create-new-tenant.md) с краткими руководствами, которые доступны в разделе Приступая к работе в [руководстве для разработчиков Azure AD](../../active-directory/develop/index.yml).

5. По завершении нажмите кнопку **зарегистрировать**.  Azure AD присваивает новому приложению уникальный *идентификатор приложения* . Рекомендуется зарегистрировать одно приложение, обращающееся только к API, и как один клиент.

6. Чтобы создать секрет клиента, перейдите на **страницу сертификаты & секреты** и щелкните **+ новый секрет клиента**.  Не забудьте скопировать значение секрета, чтобы использовать его в коде.

**Идентификатор приложения Azure AD** связан с идентификатором издателя, поэтому убедитесь, что в ваших предложениях используется один и тот же *идентификатор приложения* .

>[!Note]
>Если у издателя есть две разные учетные записи в центре партнеров, следует использовать два разных идентификатора приложения Azure AD.  Каждая учетная запись партнера в центре партнеров должна использовать уникальный идентификатор приложения Azure AD для всех предложений SaaS, опубликованных с помощью этой учетной записи.

## <a name="how-to-get-the-publishers-authorization-token"></a>Как получить маркер авторизации издателя

После регистрации приложения можно программно запросить маркер авторизации издателя (маркер доступа Azure AD с помощью конечной точки Azure AD v1). Издатель должен использовать этот токен при вызове различных API-интерфейсов выполнения SaaS. Этот токен действителен только один час. 

Дополнительные сведения об этих маркерах см. в статье [Маркеры доступа в Azure Active Directory](../../active-directory/develop/access-tokens.md).  Обратите внимание, что в потоке ниже используется маркер конечной точки версии 1.

### <a name="get-the-token-with-an-http-post"></a>Получение маркера с помощью HTTP-запроса POST

#### <a name="http-method"></a>Метод HTTP

Опубликовать<br>

##### <a name="request-url"></a>*Request URL* (URL-адрес запроса) 

`https://login.microsoftonline.com/*{tenantId}*/oauth2/token`

##### <a name="uri-parameter"></a>*Параметр универсального кода ресурса*

|  Имя параметра    |  Обязательно         |  Описание |
|  ---------------   |  ---------------  | ------------ |
|  `tenantId`        |  True      |  Идентификатор клиента зарегистрированного приложения AAD. |

##### <a name="request-header"></a>*Заголовок запроса*

|  Имя заголовка       |  Обязательно         |  Описание |
|  ---------------   |  ---------------  | ------------ |
|  `content-type`    |  True      |  Связанный с этим запросом тип содержимого. Значение по умолчанию — `application/x-www-form-urlencoded`. |

##### <a name="request-body"></a>*Текст запроса*

|  Имя свойства     |  Обязательно         |  Описание |
|  ---------------   |  ---------------  | ------------ |
|  `grant_type`      |  True      |  Тип предоставления разрешения. Используйте команду `"client_credentials"`. |
|  `client_id`       |  True      |  Идентификатор клиента или приложения, связанный с приложением Azure AD. |
|  `client_secret`   |  True      |  Секрет, связанный с приложением Azure AD. |
|  `resource`        |  True      |  Целевой ресурс, для которого запрашивается токен. Используйте `20e940b3-4c77-4b0b-9a53-9e16a1b010a7` , так как в этом случае в качестве API SaaS в Marketplace всегда используется целевой ресурс. |

##### <a name="response"></a>*Ответ*

|  Имя     |  Тип         |  Описание |
|  ------   |  ---------------  | ------------ |
|  200 ОК   |  TokenResponse    |  Запрос успешно выполнен. |

##### <a name="tokenresponse"></a>*TokenResponse*

Пример ответа:

```json
{
      "token_type": "Bearer",
      "expires_in": "3600",
      "ext_expires_in": "0",
      "expires_on": "15251…",
      "not_before": "15251…",
      "resource": "20e940b3-4c77-4b0b-9a53-9e16a1b010a7",
      "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6ImlCakwxUmNxemhpeTRmcHhJeGRacW9oTTJZayIsImtpZCI6ImlCakwxUmNxemhpeTRmcHhJeGRacW9oTTJZayJ9…"
  }
```

`"access_token"`Значение поля в ответе — это то `<access_token>` , что вы будете передавать как параметр авторизации при вызове всех API-интерфейсов контроля использования SaaS и Marketplace.

## <a name="next-steps"></a>Дальнейшие шаги

Приложение, защищенное с помощью Azure AD, теперь может использовать [API выполнения SaaS версии 2](./pc-saas-fulfillment-api-v2.md).
