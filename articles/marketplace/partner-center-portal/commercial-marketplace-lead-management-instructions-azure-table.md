---
title: Управление потенциальными клиентами с помощью хранилища таблиц Azure — Microsoft Marketplace для коммерческих клиентов
description: Узнайте, как использовать хранилище таблиц Azure для управления потенциальными клиентами для Microsoft AppSource и Azure Marketplace
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
author: keferna
ms.author: keferna
ms.date: 08/25/2020
ms.openlocfilehash: 2dca0ae02f2d079e98b51e1222114db1f2104b96
ms.sourcegitcommit: 3fc3457b5a6d5773323237f6a06ccfb6955bfb2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/11/2020
ms.locfileid: "90030803"
---
# <a name="use-azure-table-storage-to-manage-commercial-marketplace-leads"></a>Использование хранилища таблиц Azure для управления потенциальными клиентами на Marketplace для коммерческих клиентов

Если система управления отношениями с клиентами (CRM) не поддерживает получение сведений о потенциальных клиентах Microsoft AppSource и Azure Marketplace из Центра партнеров, для обработки этих потенциальных клиентов можно использовать хранилище таблиц Azure. Затем можно экспортировать данные и импортировать их в систему CRM. В этой статье объясняется, как создать учетную запись хранения Azure и таблицу в этой учетной записи. Кроме того, вы можете создать новый поток с помощью Power Automate для отправки уведомлений о потенциальных клиентах для своего предложения по электронной почте.

## <a name="configure-an-azure-storage-account"></a>Настройка учетной записи хранения Azure

1. Если у вас нет учетной записи Azure, вы можете [создать бесплатную пробную учетную запись](https://azure.microsoft.com/pricing/free-trial/).
1. Войдите на [портал Azure](https://portal.azure.com), после того как учетная запись Azure станет активна.
1. На портале Microsoft Azure создайте учетную запись хранения, выполнив указанные ниже действия.

    1. В меню слева выберите **+ Создать ресурс**. Справа появится панель **Новый**.
    1. На панели **Новый** выберите **Хранилище**. Справа отображается список **Рекомендуемое**.
    1. Выберите **Учетная запись хранения**, чтобы приступить к созданию учетной записи. Следуйте [инструкциям](../../storage/common/storage-quickstart-create-account.md?tabs=azure-portal) по созданию учетной записи хранения.

        :::image type="content" source="media/commercial-marketplace-lead-management-instructions-azure-table/azure-storage-create.png" alt-text="Действия по созданию учетной записи хранения Azure.":::

        Дополнительные сведения об учетных записях хранения см. в [кратком руководстве](../../storage/index.yml). Дополнительные сведения о ценах на службу хранилища см. на странице [Обзор цен на хранилище Azure](https://azure.microsoft.com/pricing/details/storage/).

1. Дождитесь подготовки вашей учетной записи хранения. Этот процесс займет несколько минут.

## <a name="create-a-table-in-your-storage-account"></a>Создание таблицы в учетной записи хранения

1. На **домашней** странице портал Azure выберите **Просмотреть все ресурсы** , чтобы получить доступ к вашей учетной записи хранения. Можно также выбрать **Все ресурсы** в строке меню слева на портале Microsoft Azure.

    :::image type="content" source="media/commercial-marketplace-lead-management-instructions-azure-table/azure-storage-access.png" alt-text="Доступ к учетной записи хранения Azure.":::

1. На панели учетной записи хранения выберите **Ключи доступа** и скопируйте значение в поле **Строка подключения** для ключа. Сохраните это значение, так как это значение **строки подключения учетной записи хранения**, которое потребуется указать на портале публикации, чтобы получать потенциальных клиентов для своего предложения на Azure Marketplace.

    Вот пример строки подключения.

    ```sql
    DefaultEndpointsProtocol=https;AccountName=myAccountName;AccountKey=myAccountKey;EndpointSuffix=core.screens.net
    ```

    :::image type="content" source="media/commercial-marketplace-lead-management-instructions-azure-table/azure-storage-keys.png" alt-text="Ключ службы хранилища Azure.":::


1. В области своей учетной записи хранения выберите **Таблицы** и нажмите **+ Таблица**, чтобы создать таблицу. Введите имя таблицы и нажмите кнопку **ОК**. Сохраните это значение, так как оно понадобится, если вы хотите настроить поток для получения уведомлений по электронной почте при получении потенциальных клиентов.

    ![Таблицы Azure](./media/commercial-marketplace-lead-management-instructions-azure-table/azure-tables.png)

    Вы можете использовать [Обозреватель службы хранилища Microsoft Azure](https://archive.codeplex.com/?p=azurestorageexplorer) или любое другое средство для просмотра данных в таблице хранилища. Данные также можно экспортировать в таблицу Azure.

## <a name="optional-use-power-automate-to-get-lead-notifications"></a>(Дополнительно.) Использование Power Automate для получения уведомлений о потенциальных клиентах

[Power Automate](https://docs.microsoft.com/flow/) можно использовать для автоматизации уведомления при каждом добавлении потенциального клиента в таблицу службы хранилища Microsoft Azure. Если у вас нет учетной записи, вы можете [зарегистрироваться, чтобы получить ее бесплатно](https://flow.microsoft.com/).

### <a name="lead-notification-example"></a>Пример уведомления о потенциальном клиенте

Этот пример можно использовать как руководство по созданию потока, который автоматически отправляет уведомление по электронной почте при добавлении нового потенциального клиента в хранилище таблиц Azure. В нем показано, как настроить повторение для отправки сведений о потенциальном клиенте каждый час при обновлении хранилища таблиц.

1. Выполните вход в учетную запись Power Automate.
1. На панели слева выберите **Мои потоки**.
1. На верхней панели выберите **+ Создать**.
1. В раскрывающемся списке выберите **+ По расписанию — с «нуля»** .

   ![Мои потоки + По расписанию — с «нуля»](./media/commercial-marketplace-lead-management-instructions-azure-table/ms-flow-scheduled-from-blank.png)

1. В окне **Создание запланированного потока** в поле **Повторять каждые** выберите **1** в качестве интервала и **Час** в качестве периодичности. Кроме того, при необходимости присвойте потоку имя. Нажмите кнопку **создания**.

   >[!NOTE]
   >Хотя в этом примере используется часовой интервал, вы можете выбрать оптимальный интервал и частоту в соответствии со своими деловыми потребностями.

   ![Создание потока по расписанию](./media/commercial-marketplace-lead-management-instructions-azure-table/build-scheduled-flow.png)

1. Выберите **+ Новый шаг**.
1. В окне **Выбор действия** найдите **Получение времени в прошлом**. Затем в разделе **Действия** выберите **Получение времени в прошлом**.

   ![Выбор действия](./media/commercial-marketplace-lead-management-instructions-azure-table/choose-an-action.png)

1. В окне **Получение времени в прошлом** в поле **Интервал** укажите **1**. Из раскрывающегося списка **Единица времени** выберите **Час**.

    >[!IMPORTANT]
    >Убедитесь, что интервал и единица времени, выбранные в шаге 8, соответствуют интервалу и периодичности, настроенным в шаге 5 в качестве параметров повторения.

    ![Настройка интервала получения времени в прошлом](./media/commercial-marketplace-lead-management-instructions-azure-table/ms-flow-getpast-time.png)

   >[!TIP]
   >Чтобы убедиться в правильности каждого шага, можно в любое время проверить поток. Чтобы проверить ваш поток, выберите **Средство проверки потоков**  в строке меню **Поток**.

   В следующих инструкциях описывается, как установить подключение к таблице и настроить логику обработки новых потенциальных клиентов.

1. Выберите **+ Новый шаг**. В окне **Выбор действия** найдите **Получение сущностей**.
1. В разделе **Действия** выберите **Получение сущностей (хранилище таблиц Azure)** .
1. В окне **Хранилище таблиц Azure** укажите информацию в следующих полях и нажмите **Создать**.

    * **Имя подключения**. Укажите понятное имя для установленного соединения между этим потоком и таблицей.
    * **Имя учетной записи хранения**. Укажите имя учетной записи хранения для вашей таблицы. Это имя можно найти на странице **Ключи доступа** учетной записи хранения.
    * **Общий ключ к хранилищу данных**. Укажите значение ключа для своей учетной записи хранения в таблице. Это значение можно найти на странице **Ключи доступа** учетной записи хранения.

      ![Окно «Хранилище таблиц Azure»](./media/commercial-marketplace-lead-management-instructions-azure-table/azure-table-storage.png)

   После выбора команды **Создать** отображается окно **Получение сущностей**. Здесь нужно выбрать **Показать расширенные параметры** и указать сведения в следующих полях.

   * **Таблица**. Выберите имя таблицы (в разделе [Создание таблицы](#create-a-table-in-your-storage-account)). На следующем рисунке показан запрос, когда `marketplaceleads` для этого примера выбрана таблица.

     ![Окно «Получение сущностей»](./media/commercial-marketplace-lead-management-instructions-azure-table/azure-table-get-entities.png)

   * **Запрос фильтра**. Установите этот флажок и вставьте эту функцию в поле: `Timestamp gt datetime'@{body('Get_past_time')}'`

     ![Получение сущностей, поле «Запрос фильтра»](./media/commercial-marketplace-lead-management-instructions-azure-table/azure-table-get-entities-filter-query.png)

1. После завершения настройки подключения к таблице Azure выберите **Новый шаг**, чтобы добавить условие для поиска новых потенциальных клиентов в таблице Azure.

1. В окне **Выбор действия** выберите **Действия**. Затем выберите **Элемент управления «Условие»** .

    ![Окно "Выберите действие"](./media/commercial-marketplace-lead-management-instructions-azure-table/azure-table-choose-an-action.png)

1. В окне **Условие** нажмите **Выбрать значение**. Затем во всплывающем окне выберите **Выражение**.

1. Вставьте `length(body('Get_entities')?['value'])` в поле **fx**. Нажмите **ОК** для добавления этой функции.

1. Чтобы завершить настройку условия:
    1. Из раскрывающегося списка выберите **больше**.
    2. Введите **0** в качестве значения.

        ![Окно условий](./media/commercial-marketplace-lead-management-instructions-azure-table/azure-table-condition.png)

   Выполнив следующие шаги, вы зададите действие, которое будет выполняться в зависимости от значения условия.

   * Если условие возвращает **Если «нет»** , ничего не происходит.
   * Если условие разрешается в значение **Да**, активируйте действие, которое подключает рабочую или учебную учетную запись для отправки сообщения электронной почты. 

1. Выберите **Добавить действие** в разделе **Если «да»** .

    ![Окно условий: добавление действия, если «да»](./media/commercial-marketplace-lead-management-instructions-azure-table/azure-table-condition-if-yes.png)

1. Щелкните **Отправка сообщения электронной почты (Office 365 Outlook)** .

    ![Окно условий: отправка сообщения электронной почты, если «да»](./media/commercial-marketplace-lead-management-instructions-azure-table/azure-table-condition-if-yes-send-email.png)

    >[!NOTE]
    >Чтобы использовать другого поставщика услуг электронной почты, выполните поиск и выберите **Отправить уведомление по электронной почте (почта)** в качестве действия. В инструкциях показано, как выполнить настройку с помощью Office 365 Outlook, но эти инструкции одинаковы для разных поставщиков служб электронной почты.

1. В окне Office 365 Outlook введите сведения в следующих полях.

    1. **Кому**. Введите адреса электронной почты всех пользователей, которые должны получить это уведомление.
    1. **Субъект**: Укажите тему электронного сообщения. Например, **Новые потенциальные клиенты!**
    1. **Текст**: Введите текст каждого письма (необязательно), а затем вставьте в текст сообщения `body('Get_entities')?['value']`.

    >[!NOTE]
    >В текст сообщения можно вставить дополнительные статические или динамические точки данных.

    ![Окно условий: выводить окно Office 365 Outlook, если «да»](./media/commercial-marketplace-lead-management-instructions-azure-table/azure-table-condition-if-yes-outlook.png)

1. Выберите **Сохранить**, чтобы сохранить поток. Power Automate автоматически тестирует поток на наличие ошибок. Если ошибки отсутствуют, выполнение потока начинается после сохранения.

На следующем рисунке показан пример того, как в итоге должен выглядеть поток.

![Пример окончательного потока](./media/commercial-marketplace-lead-management-instructions-azure-table/final-flow.png)

### <a name="manage-your-flow"></a>Управление потоком

После запуска потока вы можете им легко управлять. Вы его полностью контролируете. Например, вы можете его остановить или изменить, просмотреть журнал его выполнения и получить аналитику. На следующем рисунке показаны доступные параметры для управления потоком.

 ![Управление потоком](./media/commercial-marketplace-lead-management-instructions-azure-table/ms-flow-manage-completed.png)

Поток продолжает выполняться, пока вы не остановите его с помощью параметра **Отключить поток**.

Если вы не получаете по электронной почте уведомления о новых потенциальных клиентах, значит, они не добавлены в таблицу Azure. При возникновении ошибок в потоке вы получите сообщение электронной почты, аналогичное показанному в примере.

 ![Уведомление по электронной почте о сбое потока](./media/commercial-marketplace-lead-management-instructions-azure-table/ms-flow-failure-note.png)

## <a name="configure-your-offer-to-send-leads-to-the-azure-table"></a>Настройка предложения для сохранения потенциальных клиентов в таблице Azure

После того как все будет готово к настройке сведений об управлении потенциальными клиентами для вашего предложения на портале публикации, выполните следующие действия.

1. Перейдите на страницу **Настройка предложения** для своего предложения.

1. В разделе **Потенциальные клиенты** выберите **Подключить**.

    :::image type="content" source="./media/commercial-marketplace-lead-management-instructions-azure-table/customer-leads.png" alt-text="Потенциальные клиенты":::

1. Во всплывающем окне со **сведениями о подключении** в качестве места сохранения **данных о потенциальных клиентах** выберите **таблицу Azure**. 
     ![Управление потенциальными клиентами, сведения о подключении](./media/commercial-marketplace-lead-management-instructions-azure-table/connection-details.png)

1. Вставьте строку подключения из учетной записи хранения Azure, созданной на предыдущих шагах, в поле **Строка подключения учетной записи хранения**.
     ![Управление потенциальными клиентами, сведения о подключении для учетной записи хранения](./media/commercial-marketplace-lead-management-instructions-azure-table/azure-table-connection-details.png)

1. **Контактный адрес электронной почты**. Введите адреса электронной почты сотрудников организации, которые должны получать уведомления по электронной почте при обнаружении нового интереса. Можно указать несколько адресов электронной почты, разделяя их точкой с запятой.

1. Щелкните **ОК**.

Чтобы убедиться в том, что вы успешно подключились к месту назначения потенциальных клиентов, нажмите кнопку **Проверить**. При успешном подключении вы получите тестового потенциального клиента в месте назначения потенциальных клиентов.

>[!NOTE]
>Прежде чем вы сможете получать сведения о потенциальных клиентах для своего предложения необходимо завершить настройку его остальной части и опубликовать его.

При создании потенциальных клиентов Microsoft отправляет их в таблицу Azure. Если вы настроили поток, на указанный вами адрес электронной почты также будет отправлено письмо.
