---
title: Развертывание виртуальной машины из виртуальных жестких дисков в Azure Marketplace | Документация Майкрософт
description: Здесь описано, как зарегистрировать виртуальную машину из виртуального жесткого диска, развернутого в Azure.
services: Azure, Marketplace, Cloud Partner Portal,
documentationcenter: ''
author: v-miclar
manager: Patrick.Butler
editor: ''
ms.assetid: ''
ms.service: marketplace
ms.workload: ''
ms.tgt_pltfrm: ''
ms.devlang: ''
ms.topic: article
ms.date: 11/30/2018
ms.author: pbutlerm
ms.openlocfilehash: 9157ce7f8f16bc60a6d5c16fa992a5402cf2d7ad
ms.sourcegitcommit: 5b869779fb99d51c1c288bc7122429a3d22a0363
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2018
ms.locfileid: "53190736"
---
# <a name="deploy-a-vm-from-your-vhds"></a>Развертывание виртуальной машины из дисков VHD

В этом разделе описано, как развернуть виртуальную машину из виртуального жесткого диска, развернутого в Azure.  Здесь перечислены необходимые инструменты и описывается способ их использования для создания пользовательского образа виртуальной машины и его последующего развертывания в Azure с помощью скриптов PowerShell.

Передав виртуальные жесткие диски (обобщенный VHD с ОС и от нуля до нескольких VHD данных) в учетную запись хранения Azure, их можно зарегистрировать как пользовательский образ виртуальной машины. Затем можно приступать к тестированию образа. Так как VHD с ОС является обобщенным, вы не можете напрямую развертывать виртуальную машину, указав URL-адрес этого VHD.

Дополнительные сведения об образах виртуальных машин см. в следующих записях блога:

- [Образ виртуальной машины](https://azure.microsoft.com/blog/vm-image-blog-post/)
- [Запись блога о способах использования PowerShell при работе с образами виртуальных машин](https://azure.microsoft.com/blog/vm-image-powershell-how-to-blog-post/)


## <a name="prerequisite-install-the-necessary-tools"></a>Предварительные требования: установка необходимых инструментов

Если это еще не сделано, установите Azure PowerShell и Azure CLI, выполнив инструкции в следующих статьях:

- [Установка Azure PowerShell в ОС Windows с помощью PowerShellGet](https://docs.microsoft.com/powershell/azure/install-azurerm-ps)
- [Установите Azure CLI 2.0](https://docs.microsoft.com/cli/azure/install-azure-cli).


## <a name="deployment-steps"></a>Шаги по развертыванию

Для создания и развертывания пользовательского образа виртуальной машины будут применяться перечисленные ниже действия.

1. Создайте пользовательский образ виртуальной машины, который предназначен для записи и генерализации образа. 
2. Создайте сертификаты и сохраните их в новом хранилище ключей Azure. Сертификат является обязательным для создания безопасного подключения WinRM к виртуальной машине.  Можно использовать шаблон Azure Resource Manager и сценарий Azure PowerShell. 
3. Разверните виртуальную машину из пользовательского образа виртуальной машины, используя предоставленные шаблон и сценарий.

После развертывания виртуальной машины вы сможете [сертифицировать образ своей виртуальной машины](./cpp-certify-vm.md).

2.  Нажмите кнопку **Создать** и выполните поиск по запросу **Развертывание шаблона**, а затем выберите **Build your own template in Editor** (Создать собственный шаблон в редакторе).  <br/>
  ![Создание шаблона развертывания VHD на портале Azure](./media/publishvm_021.png)

3. Скопируйте этот [шаблон JSON](./cpp-deploy-json-template.md) и вставьте его в редактор, а затем щелкните **Сохранить**. <br/>
  ![Сохранение шаблона развертывания VHD на портале Azure](./media/publishvm_022.png)

4. Укажите значения параметров на страницах свойств **Настраиваемое развертывание**.

   <table> <tr> <td valign="top"> <img src="./media/publishvm_023.png" alt="Custom deployment property page 1"> </td> <td valign="top"> <img src="./media/publishvm_024.png" alt="Custom deployment property page 2"> </td> </tr> </table> <br/> 

   |  **Параметр**              |   **Описание**                                                            |
   |  -------------              |   ---------------                                                            |
   | User Storage Account Name (Имя учетной записи хранения)   | Имя учетной записи хранения, в которой находится обобщенный виртуальный жесткий диск                    |
   | User Storage Container Name (Имя контейнера хранилища пользователя) | Имя контейнера, в котором находится обобщенный виртуальный жесткий диск                          |
   | DNS Name for Public IP (DNS-имя для общедоступного IP-адреса)      | DNS-имя общедоступного IP-адреса                                                           |
   | Admin User Name (Имя администратора)             | Имя пользователя учетной записи администратора для новой виртуальной машины                                  |
   | Пароль администратора              | Пароль учетной записи администратора для новой виртуальной машины                                  |
   | тип ОС;                     | Операционная система виртуальной машины: `Windows` \| `Linux`                                    |
   | Идентификатор подписки             | Идентификатор выбранной подписки                                      |
   | Расположение                    | Географическое расположение развертывания                                        |
   | Размер виртуальной машины                     | [Размер виртуальной машины Azure](https://docs.microsoft.com/azure/virtual-machines/windows/sizes), например `Standard_A2` |
   | Имя общедоступного IP-адреса      | Имя общедоступного IP-адреса                                               |
   | Имя виртуальной машины                     | Имя новой виртуальной машины                                                           |
   | имя виртуальной сети;        | Имя виртуальной сети, используемой виртуальной машиной                                   |
   | NIC Name (Имя сетевой карты)                    | Имя сетевой карты, используемой для виртуальной сети               |
   | URL-адрес VHD                     | Полный URL-адрес виртуального жесткого диска с операционной системой                                                     |
   |  |  |
            
5. Когда предоставите эти значения, нажмите кнопку **Купить**. 

Azure начнет развертывание. Будет создана виртуальная машина с указанным неуправляемым VHD в определенном пути к учетной записи хранения.  На портале Azure можно отслеживать ход выполнения, щелкнув **Виртуальные машины** в левой части.  После создания виртуальной машины состояние изменится с `Starting` на `Running`. 


### <a name="deploy-a-vm-from-powershell"></a>Развертывание виртуальной машины из PowerShell

Чтобы развернуть большую виртуальную машину из только что созданного обобщенного образа VM, используйте следующие командлеты:

``` powershell
    $img = Get-AzureVMImage -ImageName "myVMImage"
    $user = "user123"
    $pass = "adminPassword123"
    $myVM = New-AzureVMConfig -Name "VMImageVM" -InstanceSize "Large" -ImageName $img.ImageName | Add-AzureProvisioningConfig -Windows -AdminUsername $user -Password $pass
    New-AzureVM -ServiceName "VMImageCloudService" -VMs $myVM -Location "West US" -WaitForBoot
```


## <a name="next-steps"></a>Дополнительная информация

Затем необходимо [создать пользовательский образ виртуальной Машины](cpp-create-user-image.md) для вашего решения.

