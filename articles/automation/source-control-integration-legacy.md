---
title: Использование интеграции системы управления версиями в службе автоматизации Azure — старая версия
description: В этой статье рассказывается, как использовать интеграцию системы управления версиями.
services: automation
ms.subservice: process-automation
ms.date: 12/04/2019
ms.topic: conceptual
ms.openlocfilehash: f1e4e288b5b95f355221188a45f1e6c764fde77c
ms.sourcegitcommit: ec682dcc0a67eabe4bfe242fce4a7019f0a8c405
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2020
ms.locfileid: "86187342"
---
# <a name="use-source-control-integration-in-azure-automation---legacy"></a>Использование интеграции системы управления версиями в службе автоматизации Azure — старая версия

> [!NOTE]
> Это новая возможность для системы управления версиями. Сведения о новой возможности см. в [статье о системе управления версиями (предварительная версия)](source-control-integration.md).

Интеграция системы управления версиями позволяет связать модули runbook из вашей учетной записи службы автоматизации с репозиторием системы управления версиями GitHub. Система управления версиями позволяет работать вместе с коллегами, отслеживать изменения и выполнять откат к более ранним версиям модулей Runbook. Например, система управления версиями позволяет синхронизировать различные ветви этой системы с учетными записями службы автоматизации, предназначенными для разработки, тестирования и работы готового продукта. Таким образом, вы сможете легко разместить в рабочей учетной записи службы автоматизации тот код, который был протестирован в среде разработки.

Система управления версиями позволяет отправлять код из службы автоматизации Azure в систему управления версиями или извлекать модули runbook из системы управления версиями в службу автоматизации Azure. В этой статье рассказывается, как настроить систему управления версиями в среде службы автоматизации Azure. Для начала настроим в службе автоматизации Azure доступ к репозиторию GitHub и рассмотрим различные операции, которые можно выполнить, используя интеграцию системы управления версиями. 

> [!NOTE]
> Система управления версиями поддерживает извлечение и отправку [модулей runbook рабочих процессов PowerShell](automation-runbook-types.md#powershell-workflow-runbooks), а также [модулей runbook PowerShell](automation-runbook-types.md#powershell-runbooks). [Графические модули Runbook](automation-runbook-types.md#graphical-runbooks) пока не поддерживаются.

## <a name="configure-source-control"></a>Настройка системы управления версиями

Настроить систему управления версиями в учетной записи службы автоматизации можно за два простых шага. Если у вас уже есть учетная запись GitHub, все делается за один шаг. 

### <a name="create-a-github-repository"></a>Создание репозитория GitHub

Если у вас уже есть учетная запись GitHub и репозиторий, который вы хотите связать со службой автоматизации Azure, выполните вход в имеющуюся учетную запись и переходите к шагу 2. В противном случае перейдите на сайт [GitHub](https://github.com/), зарегистрируйтесь и [создайте репозиторий](https://help.github.com/articles/create-a-repo/).

### <a name="set-up-source-control"></a>Установка системы управления версиями

1. На странице "Учетная запись автоматизации" портала Azure в разделе **Параметры учетной записи** щелкните **Система управления версиями**.

2. Откроется колонка "Система управления версиями", в которой можно указать данные учетной записи GitHub. Далее приведен список настраиваемых параметров.  

   | **Параметр** | **Описание** |
   |:--- |:--- |
   | Выбор источника |Укажите источник. В настоящее время поддерживается только **GitHub** . |
   | Авторизация |Щелкните кнопку **Авторизовать** , чтобы предоставить службе автоматизации Azure доступ к репозиторию GitHub. Если вы уже выполнили вход в учетную запись GitHub в другом окне, то будут использованы учетные данные этой учетной записи. После успешной авторизации на странице в **Свойство авторизации** отобразится ваше имя пользователя в GitHub. |
   | Выберите репозиторий |Выберите репозиторий GitHub из списка доступных репозиториев. |
   | Выберите ветвь |Выберите ветвь из списка доступных. Если вы не создавали ветвей, будет показана только ветвь **master** . |
   | Путь к папке Runbook |Путь к папке с модулями Runbook в репозитории GitHub, из которого требуется загружать или в который требуется отправлять код. Путь указывается в формате **/имя_папки/имя_вложенной_папки**. С вашей учетной записью службы автоматизации будут синхронизированы только модули из папки Runbook. Модули Runbook во вложенных подпапках папки с модулями Runbook **НЕ** будут синхронизированы. Чтобы синхронизировать все модули Runbook в репозитории, используйте символ **/** . |
3. Например, ваш репозиторий называется **PowerShellScripts**, и он содержит папку **RootFolder** с вложенной папкой **SubFolder**. Для выполнения синхронизации на уровне каждой папки можно использовать следующие строки:

   1. Чтобы синхронизировать модули runbook из **репозитория**, укажите следующий путь к папке с модулями runbook: **/**
   2. Чтобы синхронизировать модули runbook из **RootFolder**, укажите следующий путь к папке с модулями runbook: **/RootFolder**.
   3. Чтобы синхронизировать модули Runbook из папки **SubFolder**, укажите следующий путь к папке с модулями Runbook: **/корневая_папка/вложенная_папка**.
4. После настройки параметры отобразятся на странице "Настройка системы управления версиями".  

    ![Страница "Система управления версиями", отображающая параметры](media/source-control-integration-legacy/automation-SourceControlConfigure.png)
5. Когда вы нажмете кнопку **ОК**, интеграция системы управления версиями будет настроена для вашей учетной записи службы автоматизации. Также должны быть обновлены сведения из учетной записи GitHub. Щелкните эту область, чтобы просмотреть весь журнал заданий синхронизации системы управления версиями.  

    ![Значения для текущей настроенной конфигурации системы управления версиями](media/source-control-integration-legacy/automation-RepoValues.png)
6. После настройки системы управления версиями в учетной записи службы автоматизации создаются два [переменных ресурса](./shared-resources/variables.md). Кроме того, в учетную запись GitHub добавляется разрешенное приложение.

   * Переменная **Microsoft.Azure.Automation.SourceControl.Connection** содержит значения строки подключения, как показано ниже.  

     | **Параметр** | **Значение** |
     |:--- |:--- |
     | `Name`  |Microsoft.Azure.Automation.SourceControl.Connection |
     | `Type`  |Строка |
     | `Value` |{"Branch": \<*Your branch name*> , "рунбукфолдерпас": \<*Runbook folder path*> , "ProviderType": \<*has a value 1 for GitHub*> , "репозиторий": \<*Name of your repository*> , "Username": \<*Your GitHub user name*> } |

   * Переменная **Microsoft.Azure.Automation.SourceControl.OAuthToken**содержит надежно зашифрованное значение OAuthToken.  

     |**Параметр**            |**Значение** |
     |:---|:---|
     | `Name`  | `Microsoft.Azure.Automation.SourceControl.OAuthToken` |
     | `Type`  | `Unknown(Encrypted)` |
     | `Value` | <`Encrypted OAuthToken`> |  

     ![Окно, в котором показаны переменные системы управления версиями](media/source-control-integration-legacy/automation-Variables.png)  

   * **Система управления версиями службы автоматизации** будет добавлена в вашу учетную запись GitHub в виде авторизованного приложения. Чтобы просмотреть приложение, на домашней странице GitHub последовательно выберите **Profile** (Профиль)  > **Settings** (Параметры)  > **Applications** (Приложения). Это приложение позволяет службе автоматизации Azure синхронизировать репозиторий GitHub с учетной записью службы автоматизации.  

     ![Параметры приложений в GitHub](media/source-control-integration-legacy/automation-GitApplication.png)

## <a name="use-source-control-in-automation"></a>Использование системы управления версиями в службе автоматизации

Возврат модуля Runbook позволяет перенести изменения, внесенные в модуль Runbook в службе автоматизации Azure, в репозиторий системы управления версиями. Для возврата модуля Runbook сделайте следующее:

1. Находясь в своей учетной записи службы автоматизации, [создайте текстовый модуль runbook](./learn/automation-tutorial-runbook-textual.md) или [измените существующий](automation-edit-textual-runbook.md). Этот модуль может быть модулем Runbook рабочего процесса PowerShell или сценария PowerShell.  
2. Завершив изменение модуля runbook, сохраните его и щелкните **Возврат** на странице правки.  

    ![Окно, отображающее кнопку возврата в GitHub.](media/source-control-integration-legacy/automation-CheckinButton.png)

     > [!NOTE] 
     > При возврате модуля из службы автоматизации Azure перезаписывается код, имеющийся в системе управления версиями. Инструкция командной строки для возврата, эквивалентная команде Git, выглядит следующим образом: **git add + git commit + git push**  

3. После нажатия кнопки **Возврат** появится запрос подтверждения. Щелкните **Да**, чтобы продолжить.  

    ![Диалоговое окно, подтверждающее возврат в систему управления версиями.](media/source-control-integration-legacy/automation-CheckinMessage.png)
4. Возврат запускает модуль runbook для управления исходным кодом: **Sync-MicrosoftAzureAutomationAccountToGitHubV1**. Этот модуль Runbook подключается к GitHub и передает изменения из службы автоматизации Azure в ваш репозиторий. Чтобы просмотреть журнал заданий возврата, вернитесь на вкладку **Интеграция системы управления версиями** и откройте страницу "Синхронизация репозитория". На этой странице будут показаны все задания из системы управления версиями. Выберите задание, которое хотите просмотреть, и щелкните его.  

    ![Окно, показывающее результаты задания синхронизации.](media/source-control-integration-legacy/automation-CheckinRunbook.png)

   > [!NOTE]
   > Модули Runbook системы управления версиями — это особые модули Runbook службы автоматизации, недоступные для просмотра и изменения. Они не включаются в список модулей Runbook, но в списке заданий отображаются задачи синхронизации.

5. Имя измененного модуля Runbook передается в возвращаемый модуль в качестве входного параметра. Вы можете [просмотреть сведения о задании](automation-runbook-execution.md#job-statuses), развернув модуль runbook на странице "Синхронизация репозитория".  

    ![Окно, показывающее входные данные для задания синхронизации.](media/source-control-integration-legacy/automation-CheckinInput.png)
6. Когда задание будет завершено, обновите репозиторий GitHub, чтобы увидеть изменения.  Репозиторий должен содержать фиксацию с сообщением фиксации **Обновлено *имя модуля Runbook* в службе автоматизации Azure**.  

### <a name="sync-runbooks-from-source-control-to-azure-automation"></a>Синхронизация модулей Runbook из системы управления версиями в службу автоматизации Azure

Кнопка синхронизации на странице "Синхронизация репозитория" позволяет извлечь все модули Runbook из папки с модулями в вашем репозитории в учетную запись службы автоматизации. Один репозиторий можно синхронизировать с несколькими учетными записями службы автоматизации. Для синхронизации модуля Runbook сделайте следующее.

1. В учетной записи службы автоматизации, где настроена система управления версиями, откройте страницу "Интеграция системы управления версиями"/"Синхронизация репозитория" и нажмите кнопку **Синхронизировать**.  Когда появится запрос на подтверждение, щелкните **Да**, чтобы продолжить.  

    ![Кнопка синхронизации с сообщением, подтверждающим, что все модули runbook будут синхронизированы](media/source-control-integration-legacy/automation-SyncButtonwithMessage.png)

2. Синхронизация запускает модуль runbook **Sync-MicrosoftAzureAutomationAccountFromGitHubV1**, который подключается к GitHub и извлекает изменения из репозитория в службу автоматизации Azure. Новое задание появится на странице "Синхронизация репозитория", соответствующей этому действию. Для просмотра страницы сведений о задании синхронизации щелкните соответствующее задание.  

    ![Окно, показывающее результаты синхронизации задания синхронизации в репозитории GitHub](media/source-control-integration-legacy/automation-SyncRunbook.png)

    > [!NOTE]
    > При синхронизации из системы управления версиями черновики модулей Runbook в учетной записи службы автоматизации будут заменены **ВСЕМИ** модулями Runbook из системы управления версиями. Инструкция командной строки для синхронизации, эквивалентная команде Git, выглядит следующим образом: **git pull**

![Окно, показывающее все журналы из приостановленного задания синхронизации системы управления версиями.](media/source-control-integration-legacy/automation-AllLogs.png)

## <a name="disconnect-source-control"></a>Отключение системы управления версиями

Чтобы отключиться от учетной записи GitHub, откройте страницу "Синхронизация репозитория" и нажмите кнопку **Отключить**. После отключения системы управления версиями все ранее синхронизированные модули Runbook останутся в вашей учетной записи службы автоматизации. При этом страница "Синхронизация репозитория" станет неактивной.  

  ![Окно, в котором отображается кнопка "Отключить", для отключения системы управления версиями.](media/source-control-integration-legacy/automation-Disconnect.png)

## <a name="next-steps"></a>Дальнейшие действия

* Сведения об интеграции системы управления версиями со службой автоматизации Azure см. в [Служба автоматизации Azure. Интеграция системы управления версиями и службы автоматизации Azure](https://azure.microsoft.com/blog/azure-automation-source-control-13/).  
* Сведения об интеграции системы управления версиями runbook с помощью Visual Studio Online см. в [Служба автоматизации Azure. Интеграция системы управления версиями runbook с использованием службы Visual Studio Online](https://azure.microsoft.com/blog/azure-automation-integrating-runbook-source-control-using-visual-studio-online/).  
