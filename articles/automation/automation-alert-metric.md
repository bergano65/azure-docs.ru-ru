---
title: Мониторинг модулей runbook службы автоматизации Azure с помощью оповещений метрик
description: В этой статье описывается, как настроить оповещение метрики на основе состояния завершения Runbook.
services: automation
ms.date: 08/10/2020
ms.topic: article
ms.openlocfilehash: 8767687f0b72d3469bef570770ac81fa8300097f
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "88055940"
---
# <a name="monitor-runbooks-with-metric-alerts"></a>Мониторинг модулей runbook с помощью оповещений метрик

В этой статье вы узнаете, как создать [оповещение метрики](../azure-monitor/platform/alerts-metric-overview.md) на основе состояния завершения Runbook.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com)

## <a name="create-alert"></a>Создание оповещения

Оповещения позволяют определить условия мониторинга и действие, предпринимаемое при соблюдении этого условия.

1. Запустите службу автоматизации Azure в портал Azure, щелкнув **все службы**, а затем выполнив поиск и выбрав **учетные записи службы автоматизации**.

2. В списке учетных записей службы автоматизации выберите учетную запись, для которой нужно создать оповещение. 

3. В разделе **мониторинг**выберите **оповещения** , а затем выберите **+ новое правило генерации оповещений**. Область для целевого объекта уже определена и связана с вашей учетной записью службы автоматизации.

### <a name="configure-alert-criteria"></a>Настройка условий оповещения

1. Нажмите кнопку **Выбрать условие**. Выберите **метрики** для **типа сигнала**и в списке выберите " **всего заданий** ".

2. На странице **Настроить логику сигналов** определяется логика, активирующая оповещение. В архивном графе вам предоставляется два измерения — **Имя Runbook** и **Состояние**. Измерения представляют собой различные свойства для метрики, которые можно использовать для фильтрации результатов. В поле **Имя Runbook** выберите runbook, для которого требуется получать оповещения, или оставьте его пустым, чтобы получать оповещения обо всех модулях runbook. В раскрывающемся списке **Состояние** выберите состояние, которое необходимо отслеживать. Значения имени runbook и состояния, которые содержатся в раскрывающемся списке, предназначены только для заданий, выполненных за последнюю неделю.

   Если вы хотите создать оповещение о состоянии или модуле Runbook, который не отображается в раскрывающемся списке, щелкните параметр **Добавить пользовательское значение** рядом с измерением. Это действие открывает диалоговое окно, которое позволяет указать пользовательское значение, которое еще не было выдаваться для этого измерения. Если введено значение, которое не существует для свойства, оповещение не сработает.

   > [!NOTE]
   > Если не указать имя для измерения **имя Runbook** , то при наличии модулей Runbook, соответствующих критериям состояния, включая скрытые системные модули Runbook, вы получите предупреждение.

    Например, чтобы оповещать, когда модуль Runbook возвращает состояние _сбоя_ , помимо указания имени модуля Runbook, для измерения **состояние** добавить пользовательское значение измерения **не удалось**.

    :::image type="content" source="./media/automation-alert-metric/specify-dimension-custom-value.png" alt-text="Укажите пользовательское значение измерения" border="false":::

3. В **разделе логики оповещения** определите условие и порог для оповещения. Предварительная версия определенного условия показана ниже.

4. В разделе **оценено на основе**выберите интервал времени для запроса и частоту выполнения запроса. Например, если вы выберете **за последние 5 минут** в течение **периода**и **каждые 1 минуту** для **частоты**, оповещение ищет количество модулей Runbook, удовлетворяющих критериям за последние 5 минут. Этот запрос выполняется каждую минуту, и когда условия оповещения, которые вы определили, отсутствуют в течение 5-минутного периода, оповещение разрешается самостоятельно. По завершении нажмите кнопку **Готово**.

   ![Выбор ресурса для оповещения](./media/automation-alert-activity-log/configure-signal-logic.png)

### <a name="define-the-action-to-take"></a>Определение предпринимаемого действия

1. В разделе **Группа действий**выберите **указать группу действий**. Группа действий содержит действия, которые можно использовать для нескольких оповещений. Они могут включать в себя (но не ограничиваются) уведомления электронной почты, модули Runbook, веб-перехватчики и многое другое. Дополнительные сведения о группах действий и действиях по созданию, которые отправляют уведомления по электронной почте, см. в статье [Создание групп действий и управление ими](../azure-monitor/platform/action-groups.md).

### <a name="define-alert-details"></a>Определение сведений об оповещении

1. В разделе **сведения о правиле оповещений**дайте оповещению понятное имя и описание. Задайте **степень серьезности** в соответствии с условием оповещения. Существует пять степеней серьезности в диапазоне от 0 до 5. Оповещения обрабатываются одинаково, независимо от степени серьезности. Степень серьезности можно сопоставить в соответствии с вашей бизнес-логикой.

1. По умолчанию правила включаются при создании, если только **не** выбран параметр **включить правило генерации оповещений при создании**. Для оповещений, созданных в отключенном состоянии, их можно включить в будущем, когда будете готовы. Выберите **создать правило генерации оповещений** , чтобы сохранить изменения.

## <a name="receive-notification"></a>Получение уведомления

При соблюдении условий оповещения группа действий выполняет определенное действие. В приведенном здесь примере отправляется сообщение электронной почты. На следующем изображении показан пример сообщения электронной почты, получаемого после активации оповещения:

![Оповещение по электронной почте](./media/automation-alert-activity-log/alert-email.png)

Если метрика больше не превышает определенный порог, оповещение деактивируется и группа действий выполняет определенное действие. Если для типа действия выбрано сообщение, отправляется электронное сообщение со сведениями о разрешении.

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения см. в [Использование оповещения для активации runbook службы автоматизации Azure](automation-create-alert-triggered-runbook.md).
