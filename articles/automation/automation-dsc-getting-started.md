---
title: Начало работы со службой State Configuration службы автоматизации Azure
description: В этой статье объясняется, как выполнять самые распространенные задачи в службе State Configuration службы автоматизации Azure.
services: automation
ms.service: automation
ms.subservice: dsc
author: mgoedtel
ms.author: magoedte
ms.date: 04/15/2019
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 0e98078fe2799d1c524190c8ced36588f35498b4
ms.sourcegitcommit: ec682dcc0a67eabe4bfe242fce4a7019f0a8c405
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2020
ms.locfileid: "86186441"
---
# <a name="get-started-with-azure-automation-state-configuration"></a>Начало работы со службой State Configuration службы автоматизации Azure

В этой статье пошагово объясняется, как выполнять самые распространенные задачи с помощью службы State Configuration службы автоматизации Azure, например создание, импорт и компилирование конфигураций, подключение управляемых компьютеров, а также просмотр отчетов. Общие сведения о службе State Configuration см. в разделе [Обзор службы State Configuration](automation-dsc-overview.md). Документацию по DSC см. в статье [Общие сведения о службе настройки требуемого состояния Windows PowerShell](/powershell/scripting/dsc/overview/overview).

Если вам необходим пример среды, настроенной без выполнения действий, описанных в этой статье, вы можете использовать [шаблон управляемого узла службы автоматизации Azure](https://github.com/Azure/azure-quickstart-templates/tree/master/101-automation-configuration). Этот шаблон позволяет настроить полнофункциональную среду State Configuration (DSC), в том числе виртуальную машину Azure, которой управляет State Configuration (DSC).

## <a name="prerequisites"></a>Предварительные требования

Для выполнения примеров из этой статьи необходимо следующее.

- Учетная запись службы автоматизации Azure. Указания по созданию учетной записи запуска от имени пользователя для службы автоматизации Azure см. в статье [Проверка подлинности модулей Runbook в Azure с помощью учетной записи запуска от имени](./manage-runas-account.md).
- Виртуальная машина Azure Resource Manager (неклассическая) под управлением поддерживаемой [операционной системы](automation-dsc-overview.md#operating-system-requirements). Инструкции по созданию виртуальной машины см. в статье [Создание первой виртуальной машины Windows на портале Azure](../virtual-machines/windows/quick-create-portal.md).

## <a name="create-a-dsc-configuration"></a>Создание конфигурации DSC

Создайте простую [конфигурацию DSC](/powershell/scripting/dsc/configurations/configurations), которая обеспечивает наличие или отсутствие компонента Windows **веб-сервера** (IIS) в зависимости от назначения узлов.

1. Запустите [VSCode](https://code.visualstudio.com/docs) (или любой текстовый редактор).
1. Введите следующий текст:

    ```powershell
    configuration TestConfig
    {
        Node IsWebServer
        {
            WindowsFeature IIS
            {
                Ensure               = 'Present'
                Name                 = 'Web-Server'
                IncludeAllSubFeature = $true
            }
        }

        Node NotWebServer
        {
            WindowsFeature IIS
            {
                Ensure               = 'Absent'
                Name                 = 'Web-Server'
            }
        }
    }
    ```
1. Сохраните файл под именем **TestConfig.ps1**.

В этой конфигурации вызывается один ресурс в каждом блоке узла — [ресурс WindowsFeature](/powershell/scripting/dsc/reference/resources/windows/windowsfeatureresource). Этот ресурс обеспечивает наличие или отсутствие компонента **Web-Server**.

## <a name="import-a-configuration-into-azure-automation"></a>Импорт конфигурации в службу автоматизации Azure

Теперь импортируйте конфигурацию в учетную запись службы автоматизации.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице "Учетная запись автоматизации" в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)** .
1. На странице "Настройка состояния (DSC)" выберите вкладку **Конфигурации**, а затем щелкните **Добавить**.
1. На панели "Импорт конфигурации" перейдите к файлу `TestConfig.ps1` на своем компьютере.

   ![Снимок экрана: колонка **Импорт конфигурации**](./media/automation-dsc-getting-started/AddConfig.png)

1. Нажмите кнопку **ОК**.

## <a name="view-a-configuration-in-azure-automation"></a>Просмотр конфигурации в службе автоматизации Azure

После импорта конфигурацию можно просмотреть на портале Azure.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице "Учетная запись автоматизации" в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)** .
1. На странице "Настройка состояния (DSC)" выберите вкладку **Конфигурации**, а затем щелкните **TestConfig**. Это имя конфигурации, импортированной во время предыдущей процедуры.
1. На странице "Настройка TestConfig" щелкните **Просмотреть источник конфигурации**.

   ![Снимок экрана: колонка "TestConfig configuration" (Конфигурация TestConfig)](./media/automation-dsc-getting-started/ViewConfigSource.png)

   Откроется страница "Источник конфигурации TestConfig", в которой будет отображаться код PowerShell для конфигурации.

## <a name="compile-a-configuration-in-azure-automation"></a>Компилирование конфигурации в службе автоматизации Azure

Прежде чем применить требуемое состояние к узлу, конфигурацию DSC, определяющую это состояние, следует компилировать в одну или несколько конфигураций узла (MOF-документы) и разместить на опрашивающем сервере Automation DSC. Подробное описание компилирования конфигураций в State Configuration (DSC) см. в разделе [Компилирование конфигураций в службе State Configuration службы автоматизации Azure](automation-dsc-compile.md).
Дополнительные сведения о компилировании конфигураций см. в статье [Конфигурации DSC](/powershell/scripting/dsc/configurations/configurations).

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице "Учетная запись автоматизации" в разделе **Управление конфигурацией** щелкните **Настройка состояния (DSC)** .
1. На странице "Настройка состояния (DSC)" выберите вкладку **Конфигурации**, а затем щелкните **TestConfig**. Это имя ранее импортированной конфигурации.
1. На странице "Настройка TestConfig" щелкните **Скомпилировать**, а затем выберите **Да**. Запустится задание компиляции.

   ![Снимок экрана: страница TestConfig configuration (Конфигурация TestConfig) с выделенной кнопкой "Скомпилировать"](./media/automation-dsc-getting-started/CompileConfig.png)

> [!NOTE]
> Во время компилирования конфигурации в службе автоматизации Azure MOF-файлы любой созданной конфигурации узла автоматически развертываются на опрашиваемом сервере.

## <a name="view-a-compilation-job"></a>Просмотр задания компиляции

После запуска компиляции задание можно просмотреть в области **Задания компиляции** на странице **Конфигурация**. На плитке **Задания компиляции** отображаются выполняющиеся, выполненные и невыполненные задания. Если открыть панель задания компиляции, отобразятся сведения об этом задании, в том числе все обнаруженные ошибки или предупреждения, входные параметры, используемые в конфигурации, а также журналы компиляции.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице "Учетная запись автоматизации" в разделе **Управление конфигурацией** щелкните **Настройка состояния (DSC)** .
1. На странице "Настройка состояния (DSC)" выберите вкладку **Конфигурации**, а затем щелкните **TestConfig**. Это имя ранее импортированной конфигурации.
1. В разделе **Задания компиляции** выберите задание компиляции, которое нужно просмотреть. Откроется страница "Задание компиляции", на которой будет указана дата запуска этого задания.

   ![Снимок экрана: страница "Задание компиляции"](./media/automation-dsc-getting-started/CompilationJob.png)

1. Чтобы просмотреть дополнительные сведения о задании, щелкните любую область на странице "Задание компиляции".

## <a name="view-node-configurations"></a>Просмотр конфигураций узлов

При успешном выполнении задания компиляции создается одна или несколько конфигураций узлов. Конфигурация узла — это MOF-документ, который развертывается на опрашивающем сервере и готов к извлечению и применению одним или несколькими узлами. Конфигурации узлов можно просмотреть в учетной записи службы автоматизации на странице State Configuration (DSC). Имя конфигурации узла имеет следующий формат: `ConfigurationName.NodeName`.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице "Учетная запись автоматизации" в разделе **Управление конфигурацией** щелкните **Настройка состояния (DSC)** .
1. На странице State Configuration (DSC) выберите вкладку **Скомпилированные конфигурации**.

   ![Снимок экрана: вкладка "Скомпилированные конфигурации"](./media/automation-dsc-getting-started/NodeConfigs.png)

## <a name="enable-an-azure-resource-manager-vm-for-management-with-state-configuration"></a>Подключение виртуальной машины Azure Resource Manager для управления с помощью State Configuration

С помощью службы State Configuration можно управлять виртуальными машинами Azure (классическими или Resource Manager), локальными виртуальными машинами, компьютерами Linux, виртуальными машинами AWS и локальными физическими компьютерами. В этой статье вы узнаете, как включать только виртуальные машины Azure Resource Manager. Дополнительные сведения о подключении машин других типов см. в статье [Подключение компьютеров для управления с помощью службы State Configuration службы автоматизации Azure](automation-dsc-onboarding.md).

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице "Учетная запись автоматизации" в разделе **Управление конфигурацией** щелкните **Настройка состояния (DSC)** .
1. На странице State Configuration (DSC) откройте вкладку **Узлы** и щелкните **+ Добавить**.

   ![Снимок экрана: страница "Узлы DSC" с выделенной кнопкой "Добавить виртуальную машину Azure"](./media/automation-dsc-getting-started/OnboardVM.png)

1. На странице "Виртуальные машины" выберите свою виртуальную машину.
1. На странице сведений о виртуальной машине щелкните **+ Подключить**.

   > [!IMPORTANT]
   > ВМ должна быть виртуальной машиной Azure Resource Manager под управлением [поддерживаемой операционной системы](automation-dsc-overview.md#operating-system-requirements).

2. На странице "Регистрация" в поле **Имя конфигурации узла** выберите имя той конфигурации узла, которую необходимо применить к виртуальной машине. На этом этапе указывать имя необязательно. После подключения узла назначенную конфигурацию узла можно изменить.

3. Установите флажок **Перезагрузить узел при необходимости** и нажмите кнопку **ОК**.

   ![Снимок экрана: колонка "Регистрация"](./media/automation-dsc-getting-started/RegisterVM.png)

   Указанная вами конфигурация узла будет применяться к виртуальной машине с интервалом, указанным в параметре **Частота обновления режима настройки**. Виртуальная машина будет проверять наличие изменений в конфигурации узла с интервалами, указанными в параметре **Частота обновления**. Дополнительные сведения об использовании этих значений см. в статье [Настройка локального диспетчера конфигураций](/powershell/scripting/dsc/managing-nodes/metaConfig).

Azure запустит процесс подключения виртуальной машины. Когда он будет завершен, виртуальная машина появится на вкладке **Узлы** на странице State Configuration (DSC) в учетной записи автоматизации.

## <a name="view-the-list-of-managed-nodes"></a>Просмотр списка управляемых узлов

Список всех виртуальных машин, подключенных для управления, можно просмотреть в учетной записи службы автоматизации на вкладке **Узлы** на странице State Configuration (DSC).

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице "Учетная запись автоматизации" в разделе **Управление конфигурацией** щелкните **Настройка состояния (DSC)** .
1. На странице State Configuration (DSC) выберите вкладку **Узлы**.

## <a name="view-reports-for-managed-nodes"></a>Просмотр отчетов для управляемых узлов

Каждый раз, когда служба State Configuration проверяет согласованность на управляемом узле, узел отправляет отчет о состоянии на опрашиваемый сервер. Отчеты для соответствующего узла можно посмотреть на его странице.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице "Учетная запись автоматизации" в разделе **Управление конфигурацией** щелкните **Настройка состояния (DSC)** .
1. На странице State Configuration (DSC) выберите вкладку **Узлы**. Здесь можно просмотреть обзор состояния конфигурации и подробности о каждом узле.

   ![Снимок экрана страницы "Узел"](./media/automation-dsc-getting-started/NodesTab.png)

1. На вкладке **Узлы** выберите запись узла, чтобы открыть область отчетов. Выберите отчет, в котором нужно просмотреть дополнительные сведения.

   ![Снимок экрана: колонка отчетов](./media/automation-dsc-getting-started/NodeReport.png)

В колонке для отдельного отчета можно увидеть следующие сведения о состоянии для соответствующей проверки согласованности.

- Отчет о состоянии. Возможны следующие значения:
    * Соответствует: узел соответствует требованиям проверки.
   * Неудача: конфигурация не прошла проверку.
   * Не соответствует: узел находится в режиме `ApplyandMonitor`, а компьютер не находится в нужном состоянии.
- Время начала проверки согласованности.
- Общее время выполнения проверки согласованности.
- Тип проверки согласованности.
- Все ошибки, в том числе код и сообщение ошибки.
- Все ресурсы DSC, используемые в конфигурации, и состояние каждого ресурса (находится ли узел в требуемом состоянии для этого ресурса). Щелкните ресурс, чтобы получить дополнительные сведения о нем.
- Имя, IP-адрес и режим конфигурации узла.

Кроме того, можно щелкнуть **Просмотреть необработанный отчет**, чтобы просмотреть фактические данные, которые узел отправляет на сервер.
Дополнительные сведения об использовании этих данных см. в статье [Использование сервера отчетов DSC](/powershell/scripting/dsc/pull-server/reportserver).

После подключения узла первый отчет станет доступным через некоторое время. Может пройти до 30 минут, прежде чем первый отчет станет доступным после подключения узла.

## <a name="reassign-a-node-to-a-different-node-configuration"></a>Переназначение другой конфигурации узлу

Узел можно назначить для использования конфигурации, которая отличается от назначенной изначально.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице "Учетная запись автоматизации" в разделе **Управление конфигурацией** щелкните **Настройка состояния (DSC)** .
1. На странице State Configuration (DSC) выберите вкладку **Узлы**.
1. На вкладке **Узлы** щелкните имя узла, который необходимо переназначить.
1. На странице этого узла нажмите кнопку **Назначить конфигурацию узла**.

    ![Снимок экрана: страница сведений "Узел" с выделенной кнопкой "Назначить конфигурацию узла"](./media/automation-dsc-getting-started/AssignNode.png)

1. На странице "Назначить конфигурацию узла" выберите конфигурацию, которую необходимо назначить узлу, и нажмите кнопку**OK**.

    ![Снимок экрана: страница "Назначить конфигурацию узла"](./media/automation-dsc-getting-started/AssignNodeConfig.png)

## <a name="unregister-a-node"></a>Отмена регистрации узла

Если больше не требуется управлять узлом с помощью службы State Configuration, можно отменить регистрацию этого узла.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице "Учетная запись автоматизации" в разделе **Управление конфигурацией** щелкните **Настройка состояния (DSC)** .
1. На странице State Configuration (DSC) выберите вкладку **Узлы**.
1. На вкладке **Узлы** щелкните имя узла, регистрацию которого необходимо отменить.
1. На панели этого узла нажмите щелкните **Отменить регистрацию**.

    ![Снимок экрана: страница сведений "Узел" с выделенной кнопкой "Отменить регистрацию"](./media/automation-dsc-getting-started/UnregisterNode.png)

## <a name="next-steps"></a>Дальнейшие действия

- Общие сведения см. в разделе [Обзор службы State Configuration службы автоматизации Azure](automation-dsc-overview.md).
- Информацию о том, как включить эту функцию для виртуальных машин в своей среде, см. в разделе [Подключение службы State Configuration службы автоматизации Azure](automation-dsc-onboarding.md).
- Дополнительные сведения о DSC для PowerShell см. в разделе [Общие сведения о службе Desired State Configuration для Windows PowerShell](/powershell/scripting/dsc/overview/overview).
- Сведения о ценах см. на странице [с расценками для службы настройки состояния службы автоматизации Azure](https://azure.microsoft.com/pricing/details/automation/).
- Справочник по командлетам PowerShell см. в документации по [Az.Automation](/powershell/module/az.automation/?view=azps-3.7.0#automation).
