---
title: Управление решением для отслеживания изменений и инвентаризации в службе автоматизации Azure
description: В этой статье рассказывается, как использовать решение для отслеживания изменений и инвентаризации, чтобы отслеживать изменения программного обеспечения и служб Майкрософт в вашей среде.
services: automation
ms.subservice: change-inventory-management
ms.date: 11/02/2020
ms.topic: conceptual
ms.openlocfilehash: 99cdc4191320efb37b37e4ec38e808f3961a1207
ms.sourcegitcommit: 7863fcea618b0342b7c91ae345aa099114205b03
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/03/2020
ms.locfileid: "93288743"
---
# <a name="manage-change-tracking-and-inventory"></a>Управление решением для отслеживания изменений и инвентаризации

При добавлении нового файла или раздела реестра для отслеживания служба автоматизации Azure включает ее для [Отслеживание изменений и инвентаризации](overview.md). В этой статье описывается настройка отслеживания, проверка результатов отслеживания и обработку предупреждений при обнаружении изменений.

Перед использованием процедур, описанных в этой статье, убедитесь, что вы включили Отслеживание изменений и инвентаризацию на виртуальных машинах с помощью одного из следующих методов:

* [Включение Отслеживания изменений и инвентаризации в учетной записи службы автоматизации](enable-from-automation-account.md)
* [Включение Отслеживание изменений и инвентаризации путем обзора портал Azure](enable-from-portal.md)
* [Включение Отслеживания изменений и инвентаризации в последовательности runbook](enable-from-runbook.md)
* [Включение Отслеживания изменений и инвентаризации на виртуальной машине Azure](enable-from-vm.md)

## <a name="limit-the-scope-for-the-deployment"></a><a name="scope-configuration"></a>Ограничение области развертывания

Отслеживание изменений и инвентаризация использует конфигурацию области в пределах рабочей области, чтобы определить целевые компьютеры для приема изменений. Дополнительные сведения см. в разделе [Limit отслеживание изменений и Inventory Deployment Scope](manage-scope-configurations.md).

## <a name="track-files"></a>Отслеживание изменений в файлах

С помощью Отслеживание изменений и инвентаризации можно отслеживание изменений в файлах и папках или каталогах. В этом разделе описывается настройка отслеживания файлов в Windows и в Linux.

### <a name="configure-file-tracking-on-windows"></a>Настройка отслеживания изменений в файлах Windows

Чтобы настроить отслеживание изменений в файлах на компьютере с Windows:

1. Войдите на [портал Azure](https://portal.azure.com).

2. На портале Azure щелкните **Все службы**. В списке ресурсов выберите **Автоматизация**. По мере ввода, список фильтрует предложения на основе введенных данных. Выберите элемент **Учетные записи службы автоматизации**.

3. В списке учетных записей службы автоматизации выберите учетную запись, выбранную при включении Отслеживание изменений и инвентаризации.

4. В учетной записи службы автоматизации в разделе **Управление конфигурацией** выберите **Отслеживание изменений**.

5. Выберите **изменить параметры** (символ шестеренки).

6. На странице "Конфигурация рабочей области" выберите **Файлы Windows** и нажмите кнопку **+ Добавить** , чтобы добавить новый файл для отслеживания.

7. В области добавить файл Windows для Отслеживание изменений введите сведения о файле или папке для трассировки и нажмите кнопку **сохранить**. В следующей таблице указаны свойства, которые можно использовать для получения сведений.

    |Свойство  |Описание  |
    |---------|---------|
    |Активировано     | Значение true, если параметр применен, и false, если нет.        |
    |Имя элемента     | Понятное имя файла для отслеживания.        |
    |Группа     | Имя группы для логического группирования файлов.        |
    |Укажите путь     | Путь для проверки наличия файла, например, **c:\temp\\\*.txt**. Вы также можете использовать переменные среды, такие как `%winDir%\System32\\\*.*`.       |
    |Тип пути     | Тип пути. Возможные значения: File и Folder.        |    
    |Рекурсия     | Значение true, если используется рекурсия при поиске отслеживаемого элемента, или false, если нет.        |    
    |Отправка содержимого файла | Значение true, если нужно отправлять содержимое файла при отслеживании изменений, и false, если нет.|

    Если вы планируете настроить мониторинг файлов и папок с помощью подстановочных знаков, учитывайте следующее.

    - Для отслеживания нескольких файлов необходимы подстановочные знаки.
    - Подстановочные знаки могут использоваться только в последнем сегменте пути, например *к:\фолдер\филе* или */etc/*. conf *
    - Если у переменной среды недопустимый путь, проверка будет успешной, но запуск ресурса по этому пути завершится сбоем.
    - При задании пути следует избегать использования общих путей, таких как *c:*. * *, что приведет к слишком большому количеству папок.

8. Укажите значение true для параметра **Отправка содержимого файла**. Этот параметр включает отслеживание содержимого файла для указанного пути к файлу.

### <a name="configure-file-tracking-on-linux"></a>Настройка отслеживания изменений в файлах Linux

Чтобы настроить отслеживание файла на компьютере с Linux, сделайте следующее:

1. Выберите **изменить параметры** (символ шестеренки).

2. На странице Конфигурация рабочей области выберите **файлы Linux** , а затем нажмите кнопку **+ Добавить** , чтобы добавить новый файл для трассировки.

3. На странице **Добавление файла Linux для отслеживание изменений** введите сведения о файле или каталоге для трассировки, а затем нажмите кнопку **сохранить**. В следующей таблице указаны свойства, которые можно использовать для получения сведений.

    |Свойство  |Описание  |
    |---------|---------|
    |Активировано     | Значение true, если параметр применен, и false, если нет.        |
    |Имя элемента     | Понятное имя файла для отслеживания.        |
    |Группа     | Имя группы для логического группирования файлов.        |
    |Укажите путь     | Путь для проверки наличия файла, например **/etc/*.conf**.       |
    |Тип пути     | Тип пути. Допускаются значения "Файл" и "Каталог".        |
    |Рекурсия     | Значение true, если используется рекурсия при поиске отслеживаемого элемента, или false, если нет.        |
    |Использовать sudo     | Значение true, чтобы использовать sudo при проверке наличия элемента, или false, если использовать sudo не нужно.         |
    |Ссылки     | Параметр, определяющий обработку символических ссылок при обзоре каталогов. Возможны следующие значения:<br> Пропустить — игнорирование символических ссылок без включения ссылочных файлов и каталогов.<br>Переходить — переход по символическим ссылкам во время рекурсий и включение ссылочных файлов и каталогов.<br>Управление — следует символической ссылкой и позволяет изменять возвращаемое содержимое.<br>**Примечание.** Параметр Manage не рекомендуется, так как он не поддерживает извлечение содержимого файлов.    |
    |Отправка содержимого файла | Значение true, если нужно отправлять содержимое файла при отслеживании изменений, и false, если нет. |

4. Убедитесь, что указано **значение true** для **отправки содержимого файла**. Этот параметр включает отслеживание содержимого файла для указанного пути к файлу.

   ![Добавление файла Linux](./media/manage-change-tracking/add-linux-file.png)

## <a name="track-file-contents"></a>Отслеживание содержимого файла

Отслеживание содержимого файла позволяет просматривать содержимое файла до и после отслеживаемого изменения. Эта функция сохраняет содержимое файла в [учетной записи хранения](../../storage/common/storage-account-overview.md) после каждого изменения. Ниже приведены некоторые правила, которые необходимо выполнить для отслеживания содержимого файла.

* Для хранения содержимого файла требуется стандартная учетная запись хранения с моделью развертывания Resource Manager.
* Не используйте учетные записи хранения классической модели развертывания и модели "Премиум". См. статью об [учетных записях службы хранилища Azure](../../storage/common/storage-account-create.md).
* Учетную запись хранения можно подключить только к одной учетной записи службы автоматизации.
* Отслеживание изменений и инвентаризации должны быть включены в учетной записи службы автоматизации.

### <a name="enable-tracking-for-file-content-changes"></a>Включение отслеживания изменений для содержимого файлов

Чтобы включить отслеживание изменений в содержимом файла, выполните следующие действия.

1. Выберите **изменить параметры** (символ шестеренки).

2. Выберите **содержимое файла** , а затем щелкните **ссылку**. При выборе этого варианта открывается страница **Добавление расположения содержимого для отслеживание изменений** .

   ![Добавить расположение содержимого](./media/manage-change-tracking/enable.png)

3. Выберите подписку и учетную запись хранения для хранения содержимого файла.

5. Если вы хотите включить отслеживание содержимого файла для всех существующих отслеживаемых файлов, выберите **Вкл.** для пункта **Отправка содержимого файла для всех параметров**. Позже вы сможете изменить этот параметр для каждого пути к файлу.

   ![Настройка учетной записи хранения](./media/manage-change-tracking/storage-account.png)

6. Решение для отслеживания изменений и инвентаризации отображает учетную запись хранения и URI подписанного URL-адреса (SAS), когда включает отслеживание изменений для содержимого файлов. Срок действия подписей истекает через 365 дней. их можно повторно создать, выбрав **Повторное создание**.

   ![Вывод ключей учетной записи](./media/manage-change-tracking/account-keys.png)

### <a name="view-the-contents-of-a-tracked-file"></a>Просмотр содержимого отслеживаемого файла

После того как решение для отслеживания изменений и инвентаризации обнаруживает изменение отслеживаемого файла, содержимое файла можно просмотреть на панели "Сведения об изменениях".  

![Список изменений](./media/manage-change-tracking/change-list.png)

1. На странице **Отслеживание изменений** в учетной записи службы автоматизации выберите файл в списке изменений, а затем щелкните **Просмотреть изменения содержимого файла** , чтобы просмотреть содержимое файла. В области сведения об изменении отображаются стандартные сведения о файле до и после каждого свойства.

   ![Сведения об изменении](./media/manage-change-tracking/change-details.png)

2. В двух столбцах отображается содержимое файла до и после изменений. Вы можете выбрать **Встроенный** , чтобы просмотреть встроенное представление изменений.

## <a name="track-registry-keys"></a>Отслеживание разделов реестра

Чтобы настроить разделы реестра для отслеживания на компьютерах с Windows, сделайте следующее:

1. На странице **Отслеживание изменений** в учетной записи службы автоматизации выберите **изменить параметры** (символ шестеренки).

2. На странице "Конфигурация рабочей области" выберите **Реестр Windows**.

3. Выберите **+ Добавить** , чтобы добавить новый раздел реестра для трассировки.

4. На странице **Добавление реестра Windows для отслеживание изменений** введите сведения о ключе для трассировки и нажмите кнопку **сохранить**. В следующей таблице указаны свойства, которые можно использовать для получения сведений. При указании пути реестра он должен быть ключом, а не значением.

    |Свойство  |Описание  |
    |---------|---------|
    |Активировано     | Значение true, если параметр применен, и false, если нет.        |
    |Имя элемента     | Понятное имя раздела реестра, который нужно отслеживать.        |
    |Группа     | Имя группы для логического группирования разделов реестра.        |
    |Раздел реестра Windows   | Имя ключа с путем, например `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders\Common Startup` .      |

## <a name="search-logs-for-change-records"></a>Поиск записей об изменениях в журналах

Вы можете искать различные записи об изменениях с помощью поисковых запросов к журналам Azure Monitor. Откройте страницу "Отслеживание изменений" и щелкните **Log Analytics**. Откроется страница "Журналы". Следующая таблица содержит примеры запросов поиска по журналам для получения записей об изменениях.

|Запрос  |Описание  |
|---------|---------|
|`ConfigurationData`<br> &#124; `where ConfigDataType == "WindowsServices" and SvcStartupType == "Auto"`<br> &#124; `where SvcState == "Stopped"`<br> &#124; `summarize arg_max(TimeGenerated, *) by SoftwareName, Computer`         | Показывает самые последние записи инвентаризации для служб Майкрософт, для которых установлено значение "Автоматический" и которые были остановлены. Результаты ограничены самой последней записью для указанного имени программного обеспечения и компьютера.    |
|`ConfigurationChange`<br> &#124; `where ConfigChangeType == "Software" and ChangeCategory == "Removed"`<br> &#124; `order by TimeGenerated desc`|Показывает записи об изменениях для удаленного программного обеспечения.|

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о конфигурациях областей см. в разделе [Limit отслеживание изменений и Inventory Deployment Scope](manage-scope-configurations.md).
* Если необходимо выполнить поиск в журналах, хранящихся в журналах Azure Monitor, см. раздел [Поиск по журналам в Azure Monitor журналах](../../azure-monitor/log-query/log-query-overview.md).
* Если вы завершили развертывание, см. раздел [удаление отслеживание изменений и инвентаризации](remove-feature.md).
* Сведения об удалении виртуальных машин из Отслеживание изменений и инвентаризации см. в статье [Удаление виртуальных машин из отслеживание изменений и инвентаризации](remove-vms-from-change-tracking.md).
* Сведения об устранении ошибок функции см. в статье [Устранение неполадок с решением для отслеживания изменений и инвентаризации](../troubleshoot/change-tracking.md).
