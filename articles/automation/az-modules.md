---
title: Использование модулей Az в службе автоматизации Azure
description: Эта статья содержит сведения об использовании модулей Az в службе автоматизации Azure
services: automation
ms.service: automation
ms.subservice: shared-capabilities
author: georgewallace
ms.author: gwallace
ms.date: 02/08/2019
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: a076c924d57aadfae477a5df0d128aad8e67af60
ms.sourcegitcommit: c174d408a5522b58160e17a87d2b6ef4482a6694
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59796282"
---
# <a name="az-module-support-in-azure-automation"></a>Поддержка модулей Az в службе автоматизации Azure

Служба автоматизации Azure поддерживает возможность использования [модуля Az Azure Powershell](/powershell/azure/new-azureps-module-az?view=azps-1.1.0) в модулях runbook. Модуль Az не импортируется автоматически в какую-либо новую или имеющуюся учетную запись службы автоматизации. В этой статье описывается использование модулей Az в службе автоматизации Azure.

## <a name="considerations"></a>Рекомендации

При использовании модуля Az в службе автоматизации Azure необходимо учитывать много нюансов. В учетной записи службы автоматизации модули runbook и модули Az могут использоваться в решениях более высокого уровня. Изменение модулей runbook или обновление модулей может вызвать проблемы с модулями runbook. Перед импортом новых модулей `Az` следует тщательно проверить все модули runbook и решения в отдельной учетной записи службы автоматизации. Любые изменения в модулях могут отрицательно сказаться на решениях более высокого уровня, таких как "Управление обновлениями" и "Запуск и остановка виртуальных машин в нерабочее время". Мы рекомендуем не изменять модули Az и модули runbook в учетных записях службы автоматизации, содержащие какие-либо решения. Это поведение не относится к модулям Az. Это поведение следует принимать во внимание при внесении любых изменений в учетную запись службы автоматизации.

При импорте модуля `Az` в учетную запись службы автоматизации он не импортируется автоматически в сеанс PowerShell, используемый модулями runbook. Модули импортируются в сеанс PowerShell в следующих ситуациях:

* если командлет из модуля вызывается из модуля runbook;
* если модуль runbook импортирует его явным образом с помощью командлета `Import-Module`;
* если в сеанс PowerShell импортируется другой модуль в зависимости от модуля.

> [!IMPORTANT]
> Очень важно убедиться, что модули runbook в учетной записи службы автоматизации импортируют в сеанс PowerShell, используемый модулем runbook, либо модули `Az`, либо модули `AzureRM`, но не оба типа сразу. Если в модуль runbook импортировать сначала `Az`, а затем `AzureRM`, модуль runbook будет выполнен, но в потоках задания будет отображаться [ошибка со ссылкой на метод get_SerializationSettings](troubleshoot/runbooks.md#get-serializationsettings) и командлеты не будут надлежащим образом выполнены. Если импортировать сначала `AzureRM`, а затем `Az`, модуль runbook будет по-прежнему выполнен, но вы получите сообщение об ошибке в потоках задания о том, что модуль `Az` и `AzureRM` нельзя импортировать в один сеанс или использовать в одном и том же модуле runbook.

## <a name="migrating-to-az-modules"></a>Переход к модулям Az

Мы рекомендуем проверить переход на использование модулей Az вместо модулей AzureRM в тестовой учетной записи службы автоматизации. После создания этой учетной записи службы автоматизации можно выполнить следующие действия, чтобы убедиться, что ваш переход осуществляется плавно.

### <a name="stop-and-unschedule-all-runbook-that-uses-azurerm-modules"></a>Остановка и отмена запланированного выполнения всех runbook, использующих модули AzureRM

Чтобы убедиться, что не выполняются какие-либо имеющиеся модули runbook, использующие командлеты `AzureRM`, необходимо выполнить остановку и отменить запланированное выполнение всех модулей runbook, использующих модули `AzureRM`. Вы можете увидеть, какие расписания существуют и какие расписания необходимо удалить, выполнив следующую команду:

  ```powershell-interactive
  Get-AzureRmAutomationSchedule -AutomationAccountName "<AutomationAccountName>" -ResourceGroupName "<ResourceGroupName>" | Remove-AzureRmAutomationSchedule -WhatIf
  ```

Очень важно просмотреть каждое расписание отдельно, чтобы убедиться, что при необходимости его можно запланировать повторно в будущем для модулей runbook.

### <a name="import-the-az-modules"></a>Импорт модулей Az

Импортируйте только те модули Az, которые необходимы модулям runbook. Не импортируйте общий модуль `Az`, так как он включает в себя все модули `Az.*`, которые необходимо импортировать. Это указание касается всех модулей.

Модуль [Az.Accounts](https://www.powershellgallery.com/packages/Az.Accounts/1.1.0) является зависимостью для других модулей `Az.*`. По этой причине этот модуль необходимо импортировать в учетную запись службы автоматизации, прежде чем импортировать другие модули.

В учетной записи службы автоматизации в области **Общие ресурсы** выберите **Модули**. Нажмите кнопку **Обзор коллекции**, чтобы открыть страницу **Обзор коллекции**.  На панели поиска введите имя модуля (например, `Az.Accounts`). На странице модулей PowerShell щелкните **Импорт**, чтобы импортировать модуль в учетную запись службы автоматизации.

![Импорт модулей из учетной записи службы автоматизации](media/az-modules/import-module.png)

Этот процесс импорта можно также выполнить с помощью [коллекции PowerShell](https://www.powershellgallery.com), выполнив поиск модуля. Найдя модуль, выберите его и на вкладке **Служба автоматизации Azure** щелкните **Deploy to Azure Automation** (Развертывание в службе автоматизации Azure).

![Импорт модулей непосредственно из коллекции](media/az-modules/import-gallery.png)

## <a name="test-your-runbooks"></a>Тестирование модулей runbook

Сразу после импорта модулей `Az` в учетную запись службы автоматизации можно приступать к изменению модулей runbook, чтобы вместо них использовать модуль Az. Большая часть командлетов имеют одно и то же имя за исключением того, что `AzureRM` было изменено на `Az`. Список модулей, которые не следуют данной процедуре, см. в [списке исключений](/powershell/azure/migrate-from-azurerm-to-az?view=azps-1.1.0#change-module-imports-and-cmdlet-names).

Одним из способов тестирования модулей runbook перед изменением модуля runbook для использования новых командлетов является использование `Enable-AzureRMAlias -Scope Process` в начале runbook. Если добавить его в модуль runbook, он может выполняться без изменений.

## <a name="after-migration-details"></a>Сведения о состоянии после перехода

После того как переход выполнен, больше не запускайте модули runbook с помощью модулей `AzureRM` в учетной записи. Кроме того, мы рекомендуем не импортировать и не обновлять модули `AzureRM` в этой учетной записи. Начиная с этого момента, мы рекомендуем перенести эту учетную запись в `Az` и работать только с модулями `Az`. После создания учетной записи службы автоматизации имеющиеся модули `AzureRM` по-прежнему будут установлены, а учебные модули runbook по-прежнему будут создаваться с помощью командлетов `AzureRM`. Эти модули Runbook не должны выполняться.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об использовании модулей Az см. в статье [Get started with Azure PowerShell](/powershell/azure/get-started-azureps?view=azps-1.1.0) (Начало работы с Azure PowerShell).
