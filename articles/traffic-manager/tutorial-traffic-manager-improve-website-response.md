---
title: Руководство. Перенаправление трафика для улучшения отклика веб-сайта с помощью диспетчера трафика Azure
description: В этом руководстве показано, как создать профиль диспетчера трафика для создания быстродействующего веб-сайта.
services: traffic-manager
author: asudbring
Customer intent: As an IT Admin, I want to route traffic so I can improve website response by choosing the endpoint with lowest latency.
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/23/2018
ms.author: allensu
ms.openlocfilehash: 8f64e3aa7cbe5441df1861b3176cc7e2072afa2a
ms.sourcegitcommit: cfbc8db6a3e3744062a533803e664ccee19f6d63
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2019
ms.locfileid: "65991961"
---
# <a name="tutorial-improve-website-response-using-traffic-manager"></a>Руководство по Улучшение отклика веб-сайта с помощью диспетчера трафика

В этом руководстве показано, как создать быстродействующий веб-сайт, используя профиль диспетчера трафика, направляющий трафик пользователей на веб-сайт с минимальной задержкой. Обычно центр обработки данных с минимальной задержкой является одним из географически ближайших.

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание двух виртуальных машин для работы базового веб-сайта в IIS.
> * Создание двух тестовых виртуальных машин, чтобы увидеть работу диспетчера трафика в действии.
> * Настройка имени DNS для виртуальных машин, работающих под управлением IIS.
> * Создание профиля диспетчера трафика для повышения производительности веб-сайта.
> * Добавление конечных точек виртуальной машины в профиль диспетчера трафика.
> * Просмотр диспетчера трафика в действии

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>Технические условия

Чтобы увидеть диспетчер трафика в действии, для этого руководства требуется развернуть следующее:

- два экземпляра базовый веб-сайтов работают в разных регионах Azure - **восточной части США** и **Западная Европа**.
- для тестирования диспетчера трафика — одна виртуальная машина в двух тестовых виртуальных машин **восточной части США** и второй виртуальной Машины в **Западная Европа**. Тестовые виртуальные машины используются для иллюстрации того, как диспетчер трафика направляет трафик пользователя на веб-сайт, который выполняется в том же регионе, так как это обеспечивает наименьшую задержку.

### <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу https://portal.azure.com.

### <a name="create-websites"></a>Создание веб-сайтов

В этом разделе вы создадите два экземпляра веб-сайта, которые предоставляют две конечные точки службы для профиля диспетчера трафика в двух регионах Azure. Создание двух веб-сайтов состоит из следующих этапов:

1. Создайте две виртуальные машины для работающего базового веб-сайта: одну в **восточной части США**, а другую — в **Западной Европе**.
2. Установите сервер IIS на каждой виртуальной машине и обновите страницу по умолчанию веб-сайта, отображающую имя виртуальной машины, к которой пользователь подключается при посещении веб-сайта.

#### <a name="create-vms-for-running-websites"></a>Создание виртуальных машин для работающих веб-сайтов

В этом разделе вы создадите две виртуальные машины, *myIISVMEastUS* и *myIISVMWEurope*, в регионах Azure **восточная часть США** и **Западная Европа**.

1. В верхнем левом углу портала Azure, выберите **создать ресурс** > **вычислений** > **Windows Server 2019 Datacenter**.
2. В разделе **Создание виртуальной машины** введите или выберите следующие значения на вкладке **Основные сведения**:

   - **Подписка** > **Группа ресурсов**. Выберите **создать** и введите **myResourceGroupTM1**.
   - **Сведения об экземпляре** > **Имя виртуальной машины**. Тип *myIISVMEastUS*.
   - **Сведения об экземпляре** > **регион**:  Выберите **Восточная часть США**.
   - **Учетная запись администратора** > **Username**:  Введите выбранное имя пользователя.
   - **Учетная запись администратора** > **пароль**:  Введите выбранный пароль. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-the-password-requirements-when-creating-a-vm).
   - **Правила для входящих портов** > **общедоступных входящих портов**: Выберите **Разрешить выбранные порты**.
   - **Правила для входящих портов** > **выберите входящие порты**: Выберите **RDP** и **HTTP** в этом поле.

3. Выберите **управления** , или откройте вкладку **далее: диски**, затем **Далее: Сетевые подключения**, затем **далее: Управление**. В разделе **Мониторинг** задайте **Выкл.** для параметра **Диагностика загрузки**.
4. Выберите **Review + create** (Просмотреть и создать).
5. Проверьте параметры и нажмите кнопку **создать**.  
6. Выполните действия, чтобы создать вторую виртуальную Машину с именем *myIISVMWEurope*, с помощью **группы ресурсов** имя *myResourceGroupTM2*, **расположение** из *Западная Европа*и все остальные параметры так же, как *myIISVMEastUS*.
7. Создание виртуальных машин может занять несколько минут. Прежде чем выполнять оставшиеся шаги, обязательно дождитесь создания обеих виртуальных машин.

   ![Создание виртуальной машины](./media/tutorial-traffic-manager-improve-website-response/createVM.png)

#### <a name="install-iis-and-customize-the-default-web-page"></a>Установка IIS и настройка веб-страницы по умолчанию

В этом разделе вы установите сервер IIS на две виртуальные машины — *myIISVMEastUS* &  и *myIISVMWEurope*, а затем обновите страницу веб-сайта по умолчанию. На настроенной странице веб-сайта отображается имя виртуальной машины, к которой вы подключаетесь при посещении веб-сайта в веб-браузере.

1. В меню слева щелкните **Все ресурсы**, а затем в списке ресурсов выберите виртуальную машину *myIISVMEastUS*, расположенную в группе ресурсов *myResourceGroupTM1*.
2. На странице **Обзор** щелкните **Подключить**, а затем в разделе **подключения к виртуальной машине** выберите **Скачать RDP-файл**.
3. Откройте этот RDP-файл. При появлении запроса выберите **Подключиться**. Введите имя пользователя и пароль, указанные при создании виртуальной машины. Возможно, потребуется выбрать **More choices** (Дополнительные варианты), а затем **Use a different account** (Использовать другую учетную запись), чтобы указать учетные данные, введенные при создании виртуальной машины.
4. Нажмите кнопку **ОК**.
5. При входе в систему может появиться предупреждение о сертификате. Если вы получили предупреждение, выберите **Да** или **Продолжить**.
6. На рабочем столе сервера перейдите к **Средства администрирования Windows**>**Диспетчер сервера**.
7. Запустите на VM1 Windows PowerShell и выполните в нем приведенные ниже команды, чтобы установить сервер IIS и изменить стандартный HTM-файл.

    ```powershell-interactive
    # Install IIS
    Install-WindowsFeature -name Web-Server -IncludeManagementTools

    # Remove default htm file
    remove-item C:\inetpub\wwwroot\iisstart.htm

    #Add custom htm file
    Add-Content -Path "C:\inetpub\wwwroot\iisstart.htm" -Value $("Hello World from " + $env:computername)
    ```

     ![Установка IIS и настройка веб-страницы](./media/tutorial-traffic-manager-improve-website-response/deployiis.png)
8. Закройте RDP-подключение к *myIISVMEastUS*.
9. Повторите шаги 1–8 путем создания RDP-подключения к виртуальной машине *myIISVMWEurope* в группе ресурсов *myResourceGroupTM2*, чтобы установить IIS и настроить веб-страницу по умолчанию.

#### <a name="configure-dns-names-for-the-vms-running-iis"></a>Настройка имен DNS для виртуальных машин, работающих под управлением IIS

Диспетчер трафика направляет трафик пользователя на основе имени DNS конечных точек службы. В этом разделе вы настроите DNS-имена для серверов IIS *myIISVMEastUS* и *myIISVMWEurope*.

1. В меню слева щелкните **Все ресурсы**, а затем в списке ресурсов выберите виртуальную машину *myIISVMEastUS*, расположенную в группе ресурсов *myResourceGroupTM1*.
2. На странице **Обзор** в разделе **DNS-имя** выберите **Настроить**.
3. На странице **Конфигурация** в разделе метки DNS-имени добавьте уникальное имя, а затем выберите **Сохранить**.
4. Повторите шаги 1 – 3, для виртуальной Машины с именем *myIISVMWestEurope* , расположенную в *myResourceGroupTM2* группы ресурсов.

### <a name="create-test-vms"></a>Создание тестовых виртуальных машин

В этом разделе вы создадите виртуальную машину (*myVMEastUS* и *myVMWestEurope*) в каждом регионе Azure (**восточная часть США** и **Западная Европа**). Эти виртуальные машины будут использоваться для тестирования того, как диспетчер трафика направляет трафик к ближайшему серверу IIS при переходе к веб-сайту.

1. В верхнем левом углу портала Azure, выберите **создать ресурс** > **вычислений** > **Windows Server 2019 Datacenter**.
2. В разделе **Создание виртуальной машины** введите или выберите следующие значения на вкладке **Основные сведения**:

   - **Подписка** > **Группа ресурсов**. Выберите **myResourceGroupTM1**.
   - **Сведения об экземпляре** > **Имя виртуальной машины**. Тип *myVMEastUS*.
   - **Сведения об экземпляре** > **регион**:  Выберите **Восточная часть США**.
   - **Учетная запись администратора** > **Username**:  Введите выбранное имя пользователя.
   - **Учетная запись администратора** > **пароль**:  Введите выбранный пароль. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-the-password-requirements-when-creating-a-vm).
   - **Правила для входящих портов** > **общедоступных входящих портов**: Выберите **Разрешить выбранные порты**.
   - **Правила для входящих портов** > **выберите входящие порты**: Выберите **RDP** в этом поле.

3. Выберите **управления** , или откройте вкладку **далее: диски**, затем **Далее: Сетевые подключения**, затем **далее: Управление**. В разделе **Мониторинг** задайте **Выкл.** для параметра **Диагностика загрузки**.
4. Выберите **Review + create** (Просмотреть и создать).
5. Проверьте параметры и нажмите кнопку **создать**.  
6. Выполните действия, чтобы создать вторую виртуальную Машину с именем *myVMWestEurope*, с помощью **группы ресурсов** имя *myResourceGroupTM2*, **расположение** из *Западная Европа*и все остальные параметры так же, как *myVMEastUS*.
7. Создание виртуальных машин может занять несколько минут. Прежде чем выполнять оставшиеся шаги, обязательно дождитесь создания обеих виртуальных машин.

## <a name="create-a-traffic-manager-profile"></a>Создать профиль диспетчера трафика

Создайте профиль диспетчера трафика, который направляет трафик пользователя к конечной точке с минимальной задержкой.

1. В верхней левой части экрана выберите **Создать ресурс** > **Сети** > **Профиль диспетчера трафика** > **Создать**.
2. В разделе **Создание профиля диспетчера трафика** введите или выберите следующие сведения, примите значения по умолчанию для остальных параметров и нажмите кнопку **Создать**:

    | Параметр                 | Значение                                              |
    | ---                     | ---                                                |
    | ИМЯ                   | Оно должно быть уникальным в пределах зоны trafficmanager.net. В результате будет создано DNS-имя trafficmanager.net, которое будет использоваться для доступа к профилю диспетчера трафика.                                   |
    | Метод маршрутизации          | Выберите маршрутизацию по **производительности**.                                       |
    | Подписка            | Выберите свою подписку.                          |
    | Группа ресурсов          | Выберите группу ресурсов, *myResourceGroupTM1*. |
    | Расположение                | Выберите **Восточная часть США**. Этот параметр задает расположение группы ресурсов и не влияет на профиль диспетчера трафика, который будет развернут глобально.                              |
    |

    ![Создать профиль диспетчера трафика](./media/tutorial-traffic-manager-improve-website-response/traffic-manager-profile.png)

## <a name="add-traffic-manager-endpoints"></a>Добавление конечных точек диспетчера трафика

Добавьте две виртуальные машины под управлением сервера IIS — *myIISVMEastUS* & *myIISVMWEurope* — для маршрутизации трафика пользователя к ближайшей к нему конечной точке.

1. На панели поиска портала выполните поиск имени профиля диспетчера трафика, созданного в предыдущем разделе, и выберите профиль в отображаемых результатах.
2. В колонке **Профиль диспетчера трафика** в разделе **Параметры** щелкните **Конечные точки**, а затем выберите **Добавить**.
3. Введите или выберите следующие значения, примите значения по умолчанию для остальных параметров и нажмите кнопку **ОК**:

    | Параметр                 | Value                                              |
    | ---                     | ---                                                |
    | type                    | Конечная точка Azure                                   |
    | ИМЯ           | myEastUSEndpoint                                        |
    | Тип целевого ресурса           | Общедоступный IP-адрес                          |
    | Целевой ресурс          | **Выберите общедоступный IP-адрес**, чтобы показать список ресурсов с общедоступными IP-адресами в этой же подписке. В разделе **Ресурс** выберите общедоступный IP-адрес с именем *myIISVMEastUS-ip*. Это общедоступный IP-адрес виртуальной машины сервера IIS в восточной части США.|
    |        |           |

4. Повторите шаги 2 и 3, чтобы добавить другую конечную точку с именем *myWestEuropeEndpoint* для общедоступного IP-адреса *myIISVMWEurope-ip*, связанного с виртуальной машиной *myIISVMWEurope* сервера IIS.
5. После добавления обе конечные точки отобразятся в колонке **Профиль диспетчера трафика** с состоянием **В сети**.

    ![Добавление конечной точки диспетчера трафика](./media/tutorial-traffic-manager-improve-website-response/traffic-manager-endpoint.png)

## <a name="test-traffic-manager-profile"></a>Тестирование профиля диспетчера трафика

В этом разделе вы протестируете, как диспетчер трафика направляет трафик пользователя к ближайшим виртуальным машинам, где работает веб-сайт, для предоставления минимальной задержки. Чтобы увидеть диспетчер трафика в действии, выполните следующие действия:

1. Определите DNS-имя профиля диспетчера трафика.
2. Просмотрите диспетчер трафика в действии следующим образом:
    - В веб-браузере из тестовой виртуальной машины (*myVMEastUS*), расположенной в регионе **восточная часть США**, перейдите к DNS-имени вашего профиля диспетчера трафика.
    - В веб-браузере из тестовой виртуальной машины (*myVMWEurope*), расположенной в регионе **Западная Европа**, перейдите к DNS-имени вашего профиля диспетчера трафика.

### <a name="determine-dns-name-of-traffic-manager-profile"></a>Определение DNS-имени профиля диспетчера трафика

В этом руководстве для простоты используется DNS-имя профиля диспетчера трафика для посещения веб-сайтов.

Вы можете определить DNS-имя профиля диспетчера трафика следующим образом:

1. На панели поиска портала выполните поиск имени **профиля диспетчера трафика**, созданного в предыдущем разделе. В отображенных результатах щелкните профиль диспетчера трафика.
2. Нажмите **Обзор**.
3. В **профиле диспетчера трафика** отображается DNS-имя только что созданного профиля диспетчера трафика. В рабочей среде, используя запись DNS CNAME, настройте имя личного домена, которое указывает на имя домена диспетчера трафика.

   ![DNS-имя диспетчера трафика](./media/tutorial-traffic-manager-improve-website-response/traffic-manager-dns-name.png)

### <a name="view-traffic-manager-in-action"></a>Просмотр диспетчера трафика в действии

В этом разделе вы увидите диспетчер трафика в действии.

1. В меню слева выберите **Все ресурсы**, а затем в списке ресурсов щелкните виртуальную машину *myVMEastUS*, расположенную в группе ресурсов *myResourceGroupTM1*.
2. На странице **Обзор** щелкните **Подключить**, а затем в разделе **подключения к виртуальной машине** выберите **Скачать RDP-файл**.
3. Откройте этот RDP-файл. При появлении запроса выберите **Подключиться**. Введите имя пользователя и пароль, указанные при создании виртуальной машины. Возможно, потребуется выбрать **More choices** (Дополнительные варианты), а затем **Use a different account** (Использовать другую учетную запись), чтобы указать учетные данные, введенные при создании виртуальной машины.
4. Нажмите кнопку **ОК**.
5. При входе в систему может появиться предупреждение о сертификате. Если вы получили предупреждение, выберите **Да** или **Продолжить**.
1. В веб-браузере на виртуальной машине *myVMEastUS* введите DNS-имя вашего профиля диспетчера трафика, чтобы просмотреть веб-сайт. Так как виртуальная машина находится в **восточной части США**, вы будете направлены к ближайшему веб-сайту, размещенному на ближайшем сервере IIS *myIISVMEastUS*, расположенном в **восточной части США**.

   ![Тестирование профиля диспетчера трафика](./media/tutorial-traffic-manager-improve-website-response/eastus-traffic-manager-test.png)

2. Затем подключитесь к виртуальной машине *myVMWestEurope*, расположенной в **Западной Европе**, выполнив шаги 1–5, и перейдите к доменному имени профиля диспетчера трафика с этой виртуальной машины. Так как виртуальная машина находится в **Западной Европе**, вы будете перенаправлены на веб-сайт, размещенный на ближайшем сервере IIS *myIISVMWEurope*, расположенном в **Западной Европе**.

   ![Тестирование профиля диспетчера трафика](./media/tutorial-traffic-manager-improve-website-response/westeurope-traffic-manager-test.png)

## <a name="delete-the-traffic-manager-profile"></a>Удаление профиля диспетчера трафика

Если больше не нужны, удалите группы ресурсов (**ResourceGroupTM1** и **ResourceGroupTM2**). Чтобы это сделать, выберите группу ресурсов (**ResourceGroupTM1** или **ResourceGroupTM2**), а затем щелкните **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Распределение трафика между несколькими конечными точками](traffic-manager-configure-weighted-routing-method.md)
