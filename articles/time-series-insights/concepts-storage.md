---
title: Общие сведения о хранилище — Azure Time Series Insights Gen2 | Документация Майкрософт
description: Сведения о хранении данных в Azure Time Series Insights Gen2.
author: lyrana
ms.author: lyhughes
manager: deepakpalled
ms.workload: big-data
ms.service: time-series-insights
services: time-series-insights
ms.topic: conceptual
ms.date: 09/28/2020
ms.custom: seodec18
ms.openlocfilehash: 1b512a80fcfc26efbe5c008884509aebfd86ed3e
ms.sourcegitcommit: 10d00006fec1f4b69289ce18fdd0452c3458eca5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2020
ms.locfileid: "95020850"
---
# <a name="data-storage"></a>Хранилище данных

В этой статье описывается хранение данных в службе "аналитика временных рядов Azure" Gen2. Он охватывает теплое и холодное, доступность данных и рекомендации.

## <a name="provisioning"></a>Подготовка

При создании среды Gen2 "аналитика временных рядов Azure" можно использовать следующие варианты.

* Холодный объем хранилища данных:
  * Создайте новый ресурс службы хранилища Azure в подписке и регионе, выбранном для вашей среды.
  * Присоедините уже существующую учетную запись хранения Azure. Этот параметр доступен только при развертывании из [шаблона](/azure/templates/microsoft.timeseriesinsights/allversions)Azure Resource Manager и не отображается в портал Azure.
* Горячий объем данных:
  * Горячий магазин является необязательным и может быть включен или отключен во время подготовки или после него. Если вы решили включить горячее хранение позднее и в холодном хранилище уже есть данные, ознакомьтесь с [этим](concepts-storage.md#warm-store-behavior) разделом, чтобы понять ожидаемое поведение. Время хранения данных для горячего хранения можно настроить в течение 7 – 31 дня, а также при необходимости можно изменить.

Когда событие принимается, оно индексируется как в горячем (если включено), так и в холодном хранилище.

[![Общие сведения о хранилище](media/concepts-storage/pipeline-to-storage.png)](media/concepts-storage/pipeline-to-storage.png#lightbox)

> [!WARNING]
> Владелец учетной записи хранения BLOB-объектов Azure, где находятся данные холодного хранилища, имеет полный доступ ко всем данным в учетной записи. В эти права доступа входят разрешения на запись и удаление. Не изменяйте или не удаляйте данные, записываемые в Gen2 временных рядов Azure, так как это может привести к потере данных.

## <a name="data-availability"></a>Доступность данных

Служба "аналитика временных рядов Azure" Gen2 секции и индексы данных для оптимальной производительности запросов. Данные становятся доступными для запроса из горячего (если включено) и холодного хранилища после индексирования. Объем принимаемых данных и скорость пропускной способности для каждого раздела могут повлиять на доступность. Ознакомьтесь с [ограничениями пропускной способности](./concepts-streaming-ingress-throughput-limits.md) источника [событий и рекомендациями по оптимизации производительности](./concepts-streaming-ingestion-event-sources.md#streaming-ingestion-best-practices) . Вы также можете настроить [оповещение](./time-series-insights-environment-mitigate-latency.md#monitor-latency-and-throttling-with-alerts) о задержке, чтобы получать уведомления, если в среде возникают проблемы при обработке данных.

> [!IMPORTANT]
> До появления данных может произойти период до 60 секунд. Если уровень задержки значительно выше, отправьте запрос в службу поддержки на портале Azure.

## <a name="warm-store"></a>Горячий магазин

Данные в "горячем" хранилище доступны только через [API запросов временных рядов](./concepts-query-overview.md), [Обозреватель TSI "аналитика временных рядов Azure](./concepts-ux-panels.md)" или [соединитель Power BI](./how-to-connect-power-bi.md). Запросы на горячий магазин освобождаются, и квота отсутствует, но существует [ограничение в 30](/rest/api/time-series-insights/reference-api-limits#query-apis---limits) одновременных запросов.

### <a name="warm-store-behavior"></a>Поведение теплого хранилища

* Если этот параметр включен, все потоки данных, переданные в среду, будут направляться в горячее хранилище независимо от отметки времени события. Обратите внимание, что конвейер приема потоковой передачи создан для потоковой передачи практически в реальном времени и приема исторических событий [не поддерживается](./concepts-streaming-ingestion-event-sources.md#historical-data-ingestion).
* Срок хранения вычисляется на основе того, когда событие было проиндексировано в горячий магазин, а не на метку времени события. Это означает, что после истечения срока хранения данные больше не будут доступны в горячем хранилище, даже если метка времени события относится к будущему.
  * Пример. событие с прогнозами погоды из 10 дней принимается и индексируется в контейнере горячего хранения, настроенном с периодом хранения в 7 дней. По истечении 7 дней прогноз становится недоступным в горячий магазин, но его можно запрашивать из холодного времени.
* Если включить горячее хранение в существующей среде, в которой уже есть последние данные, индексированные в холодном хранилище, обратите внимание, что горячий магазин не будет заполнен этими данными.
* Если вы только что включили горячее хранение и столкнулись с проблемами при просмотре последних данных в обозревателе, можно временно переключить запросы на горячее хранение:

   [![Отключить горячий запрос](media/concepts-storage/toggle-warm.png)](media/concepts-storage/toggle-warm.png#lightbox)

## <a name="cold-store"></a>Холодный магазин

В этом разделе описываются сведения о службе хранилища Azure, относящиеся к Gen2 Azure Time Series Insights.

Подробное описание хранилища BLOB-объектов Azure см. в статье [Общие сведения о хранилище BLOB-объектов Azure](../storage/blobs/storage-blobs-introduction.md).

### <a name="your-cold-storage-account"></a>Учетная запись холодного хранения

Gen2 "аналитика временных рядов Azure" позволяет хранить до двух копий каждого события в учетной записи хранения Azure. Одна копия хранит события, упорядоченные по времени приема, всегда разрешая доступ к событиям в упорядоченной по времени последовательности. Со временем служба "аналитика временных рядов Azure" Gen2 также создает повторно секционированную копию данных для оптимизации выполнения запросов.

Все ваши данные хранятся в учетной записи хранения Azure бессрочно.

#### <a name="writing-and-editing-blobs"></a>Запись и редактирование больших двоичных объектов

Чтобы обеспечить производительность запросов и доступность данных, не изменяйте и не удаляйте большие двоичные объекты, создаваемые Gen2 Azure Time Series Insights.

#### <a name="accessing-cold-store-data"></a>Доступ к данным холодного хранения

Помимо доступа к данным из обозревателя службы " [аналитика временных рядов Azure](./concepts-ux-panels.md) " и [API запросов временных рядов](./concepts-query-overview.md), вам также может потребоваться получить доступ к данным непосредственно из файлов Parquet, хранящихся в холодном хранилище. Например, можно считывать, преобразовывать и очищать данные в записной книжке Jupyter, а затем использовать их для обучения модели Машинного обучения Azure в том же рабочем процессе Spark.

Для доступа к данным непосредственно из учетной записи хранения Azure необходим доступ на чтение к учетной записи, используемой для хранения данных Gen2 временных рядов Azure. Затем можно считывать выбранные данные на основе времени создания файла Parquet, расположенного в папке `PT=Time`, описанной ниже в разделе [Формат файла Parquet](#parquet-file-format-and-folder-structure).  Дополнительные сведения о включении доступа на чтение для учетной записи хранения см. в статье об [управлении доступом к ресурсам учетной записи хранения](../storage/blobs/anonymous-read-access-configure.md).

#### <a name="data-deletion"></a>Удаление данных

Не удаляйте файлы Gen2 службы "аналитика временных рядов Azure". Управляйте взаимосвязанными данными только в Azure Time Series Insights Gen2.

### <a name="parquet-file-format-and-folder-structure"></a>Формат файла Parquet и структура папок

Parquet — это формат столбца с открытым исходным кодом, предназначенный для эффективного хранения и производительности. Служба "аналитика временных рядов Azure" Gen2 использует Parquet для включения производительности запросов на основе идентификатора временных рядов в масштабе.  

Дополнительные сведения о типе файла Parquet см. в [документации по Parquet](https://parquet.apache.org/documentation/latest/).

Служба "аналитика временных рядов Azure" Gen2 хранит копии данных следующим образом:

* Первая начальная копия секционируется по времени приема и сохраняет данные в примерном порядке поступления. Эти данные содержатся в папке `PT=Time`:

  `V=1/PT=Time/Y=<YYYY>/M=<MM>/<YYYYMMDDHHMMSSfff>_<TSI_INTERNAL_SUFFIX>.parquet`

* Вторая повторно секционированная копия группируется по идентификаторам временных рядов и находится в папке `PT=TsId`:

  `V=1/PT=TsId/<TSI_INTERNAL_NAME>.parquet`

Метка времени в именах больших двоичных объектов в `PT=Time` папке соответствует времени прибытия данных в Gen2 службы "аналитика временных рядов Azure", а не метки времени событий.

С течением времени данные в папке `PT=TsId` будут оптимизированы для запросов и не являются статическими. Во время повторного секционирования некоторые события могут присутствовать в нескольких больших двоичных объектах. Именование больших двоичных объектов в этой папке не обязательно будет оставаться неизменным.

В общем случае, если требуется доступ к данным напрямую через Parquet файлы, используйте `PT=Time` папку.  Будущие функции будут включать эффективный доступ к `PT=TsId` папке.

> [!NOTE]
>
> * `<YYYY>` сопоставляется с представлением 4-значного числа года.
> * `<MM>` сопоставляется с представлением 2-значного числа месяца.
> * `<YYYYMMDDHHMMSSfff>` сопоставляется с представлением отметки времени с 4-значным числом года (`YYYY`), 2-значным числом месяца (`MM`), 2-значным числом дня (`DD`), 2-значным числом часа (`HH`), 2-значным числом минуты (`MM`), 2-значным числом секунды (`SS`) и 3-значным числом миллисекунды (`fff`).

События Gen2 "аналитика временных рядов Azure" сопоставлены с содержимым файла Parquet следующим образом:

* Каждое событие сопоставляется с отдельной строкой.
* Каждая строка содержит столбец **метки времени** с меткой времени события. Свойство time-stamp никогда не имеет значение NULL. По умолчанию используется **событие, поставленное в очередь** , если свойство метки времени не указано в источнике события. Сохраненная метка времени всегда имеет формат UTC.
* Каждая строка включает в себя столбцы ИДЕНТИФИКАТОРов временных рядов (TSID), как определено при создании среды Gen2 для аналитики временных рядов Azure. Имя свойства TSID содержит суффикс `_string`.
* Все остальные свойства, отправленные как данные телеметрии, сопоставляются с именами столбцов, заканчивающимися на `_bool` (Boolean), `_datetime` (отметка времени), `_long` (Long), `_double` (Double), `_string` (строка) или `dynamic` (Dynamic), в зависимости от типа свойства.  Дополнительные сведения см. в статье о [поддерживаемых типах данных](./concepts-supported-data-types.md).
* Эта схема сопоставления применяется к первой версии формата файла (**V=1**) и хранится в базовой папке с тем же именем. По мере развития этой функции схема сопоставления может измениться, а номер версии — увеличиться.

## <a name="next-steps"></a>Дальнейшие действия

* Ознакомьтесь со сведениями о [моделировании данных](./concepts-model-overview.md).

* Спланируйте [среду Gen2 "аналитика временных рядов Azure](./how-to-plan-your-environment.md)".