---
title: Устранение неполадок при развертывании Azure SQL ребра
description: Дополнительные сведения о возможных ошибках при развертывании Azure SQL Server
keywords: SQL ребро, устранение неполадок, ошибки развертывания
services: sql-edge
ms.service: sql-edge
ms.topic: troubleshooting
author: SQLSourabh
ms.author: sourabha
ms.reviewer: sstein
ms.date: 09/22/2020
ms.openlocfilehash: 517fed0dd9eb1736344546bde9f79e52ee17182f
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91333109"
---
# <a name="troubleshooting-azure-sql-edge-deployments"></a>Устранение неполадок при развертывании Azure SQL ребра 

В этой статье содержатся сведения о возможных ошибках, возникающих при развертывании и использовании пограничных контейнеров Azure SQL, а также методы устранения неполадок, помогающие устранить эти проблемы. 

Azure SQL ребра поддерживает две модели развертывания: 
- Подключенное развертывание с помощью Azure IoT Edge: Azure SQL ребр доступен в Azure Marketplace и может быть развернут как модуль для [Azure IOT Edge](../iot-edge/about-iot-edge.md). Дополнительные сведения см. в статье [Развертывание SQL Azure для пограничных вычислений](deploy-portal.md).<br>

- Отключенное развертывание. образы контейнера ребра SQL Azure можно извлечь из центра DOCKER и развернуть либо в виде автономного контейнера DOCKER, либо в кластере kubernetes. Дополнительные сведения см. в статьях [развертывание Azure SQL с помощью DOCKER](disconnected-deployment.md) и [развертывание контейнера Azure SQL в Kubernetes](deploy-kubernetes.md).

## <a name="troubleshooting-iot-edge-device-and-deployments"></a>Устранение неполадок IoT Edge устройств и развертываний

Если при развертывании SQL-сервера с помощью Azure IoT Edge появляется сообщение об ошибке, убедитесь, что `iotedge` служба правильно настроена и запущена. Следующие документы могут быть полезны при устранении проблем, связанных с Azure IoT Edge.
- [Распространенные проблемы и способы их устранения для Azure IOT Edge](../iot-edge/troubleshoot-common-errors.md).
- [Устранение неполадок устройства с IoT Edge](../iot-edge/troubleshoot.md)

## <a name="docker-command-errors"></a>Ошибки команды Docker

Если вы получаете ошибки, связанные с командами `docker`, убедитесь, что служба Docker запущена, и попробуйте выполнить запуск с повышенными привилегиями.

Например, при выполнении команд `docker` в Linux вы можете получить следующее сообщение об ошибке:

```output
Cannot connect to the Docker daemon. Is the docker daemon running on this host?
```

Если вы получаете эту ошибку в Linux, попробуйте выполнить те же команды с префиксом `sudo`. Если этот способ также не сработает, убедитесь, что служба Docker запущена, и при необходимости запустите ее.

```bash
sudo systemctl status docker
sudo systemctl start docker
```

В Windows убедитесь, что PowerShell или командная строка запущены от имени администратора.

## <a name="azure-sql-edge-container-startup-errors"></a>Ошибки запуска контейнера пограничных контейнеров Azure SQL

Если контейнер SQL не удается запустить, попробуйте выполнить следующие тесты:

- Если вы используете Azure IoT Edge, убедитесь, что образы модулей успешно скачаны и что переменные среды и параметры создания контейнера правильно указаны в манифесте модуля.

- Если используется развертывание на основе DOCKER или kubernetes, убедитесь, что `docker run` команда правильно сформирована. Дополнительные сведения см. в статье [развертывание Azure SQL Server с помощью DOCKER](disconnected-deployment.md) и [развертывание контейнера Azure SQL в Kubernetes](deploy-kubernetes.md).

- Если возникает ошибка `failed to create endpoint CONTAINER_NAME on network bridge. Error starting proxy: listen tcp 0.0.0.0:1433 bind: address already in use.`, вы пытаетесь сопоставить порт контейнера 1433 с уже используемым портом. Это может произойти, если SQL Server работает локально на размещающем компьютере. Это также может произойти, если вы запустили два пограничных контейнера SQL и пытаетесь сопоставлять их с одним и тем же портом узла. В этом случае используйте параметр `-p`, чтобы сопоставить порт контейнера 1433 с другим портом узла. Пример: 

    ```bash
    sudo docker run --cap-add SYS_PTRACE -e 'ACCEPT_EULA=1' -e 'MSSQL_SA_PASSWORD=yourStrong(!)Password' -p 1433:1433 --name azuresqledge -d mcr.microsoft.com/azure-sql-edge-developer.
    ```

- Если при попытке запуска контейнера возникает ошибка `Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.30tdout=1&tail=all: dial unix /var/run/docker.sock: connect: permission denied`, добавьте пользователя в группу docker в Ubuntu. После этого выйдите из системы и выполните вход снова, чтобы применить изменения к новым сеансам. 

   ```bash
    usermod -aG docker $USER
   ```

- Проверьте наличие сообщений об ошибках от контейнера.

   ```bash
   docker logs e69e056c702d
   ```

- Если вы используете программное обеспечение для управления контейнером, убедитесь, что оно поддерживает привилегированное выполнение процессов контейнера. Процесс sqlservr в контейнере выполняется в привилегированном режиме.

- По умолчанию контейнеры SQL Azure пограничных контейнеров выполняются как непривилегированные пользователи с именем `mssql` . Если вы используете точки подключения или тома данных для сохранения данных, убедитесь, что у `mssql` пользователя есть соответствующие разрешения на том. Дополнительные сведения см. в разделе [Запуск от имени пользователя, не являющегося корневым](configure.md#run-azure-sql-edge-as-non-root-user) , и [Сохранение данных](configure.md#persist-your-data).

- Если контейнер DOCKER для SQL Server выходит сразу после запуска, проверьте журналы DOCKER. Если вы используете PowerShell в Windows с помощью команды `docker run`, используйте двойные кавычки вместо одинарных. В PowerShell Core используйте одинарные кавычки.

- Проверьте [журналы ошибок SQL Server](#errorlogs).

## <a name="sql-edge-connection-failures"></a>Ошибки соединения с ребром SQL

Если не удается подключиться к экземпляру SQL Server, выполняющемуся в контейнере, попробуйте выполнить следующие тесты:

- Убедитесь, что контейнер SQL Server работает, просмотрев столбец **состояние** `docker ps -a` выходных данных. При необходимости запустите его с помощью команды `docker start <Container ID>`.

- Если в сопоставлении задан отличный от установленного по умолчанию (1433) порт узла, убедитесь, что порт указан в строке подключения. Сопоставление порта можно проверить в столбце **PORTS** (Порты) в выходных данных команды `docker ps -a`. Дополнительные сведения о подключении к Azure SQL ребр см. в статье [подключение и запрос SQL Azure](connect.md) .

- Если вы ранее развернули SQL ребро с сопоставленным томом данных или контейнером томов данных и теперь используете существующий сопоставленный том данных или контейнер томов данных, SQL Server не учитывает значение `MSSQL_SA_PASSWORD` переменной среды. Вместо этого используется ранее настроенный пароль пользователя SA. Это происходит потому, что SQL Server повторно использует существующие файлы базы данных master в сопоставленном томе или контейнере томов данных. При выполнении этой проблемы можно использовать следующие параметры:

    - Подключение с использованием ранее использованного пароля, если он по-прежнему доступен.
    - Настройте SQL Server для использования другого сопоставленного тома или контейнера томов данных.
    - Удалите существующие файлы главной базы данных (master. mdf и mastlog. mdf) из сопоставленного тома или контейнера томов данных.

- Проверьте [журналы ошибок SQL Server](#errorlogs).

## <a name="sql-edge-setup-and-error-logs"></a><a id="errorlogs"></a> Настройка SQL Server и журналы ошибок

По умолчанию журналы ошибок SQL Server находятся в каталоге **/var/opt/MSSQL/log** в контейнере, и к ним можно получить доступ одним из следующих способов:

- Если вы подключили каталог хоста к каталогу **/var/opt/mssql** при создании контейнера, вместо этого можно выполнять поиск в подкаталоге **log** по сопоставленному пути на узле.
- С помощью интерактивной командной строки для подключения к контейнеру. Если контейнер не запущен, сначала запустите его. Затем проверьте журналы с помощью интерактивной командной строки. Идентификатор контейнера можно получить, выполнив команду `docker ps`.

    ```bash
    docker start <ContainerID>
    docker exec -it <ContainerID> "/bin/bash"
    ```

    Из сеанса Bash внутри контейнера выполните следующие команды:

    ```bash
    cd /var/opt/mssql/log
    cat errorlog
    ```
- Если контейнер SQL помещается в работу и работает, и вы можете подключиться к экземпляру с помощью клиентских средств, то можно использовать хранимую процедуру `sp_readerrorlog` для чтения содержимого журнала ошибок SQL Server.

## <a name="execute-commands-in-a-container"></a>Выполнение команд в контейнере

Вы можете выполнять команды из работающего контейнера с помощью терминала узла.

Чтобы получить идентификатор контейнера, выполните следующую команду:

```bash
docker ps -a
```

Чтобы запустить терминал Bash в контейнере, выполните следующую команду:

```bash
docker exec -it <Container ID> /bin/bash
```

После этого вы можете выполнять команды так, как если бы они выполнялись из терминала внутри контейнера. По завершении введите `exit`. В этом случае завершается интерактивный сеанс команд, однако контейнер продолжает работать.

### <a name="enabling-verbose-logging"></a>Включение подробного ведения журнала

Если уровень ведения журнала по умолчанию для обработчика потоковой передачи не предоставляет достаточно сведений, можно включить ведение журнала отладки для обработчика потоковой передачи в SQL Server. Чтобы включить ведение журнала отладки, добавьте `RuntimeLogLevel=debug` переменную среды в развертывание SQL Server. После включения ведения журнала отладки попытайтесь воспроизвести проблему и проверьте журналы на наличие соответствующих сообщений или исключений. 

> [!NOTE]
> Параметр подробного ведения журнала следует использовать только для устранения неполадок, а не для обычной рабочей нагрузки. 


## <a name="next-steps"></a>Дальнейшие шаги

- [Машинное обучение и искусственный интеллект с помощью ONNX в SQL Server ребра](onnx-overview.md)
- [Потоковая передача данных в SQL Azure для пограничных вычислений](stream-data.md)
- [Хранение и очистка данных](data-retention-overview.md)
- [Заполнение временных зазоров и ввода отсутствующие значения](imputing-missing-values.md)







