---
title: Развертывание Azure SQL с помощью портал Azure
description: Узнайте, как развернуть Azure SQL с помощью портал Azure
keywords: Развертывание SQL для пограничных вычислений
services: sql-edge
ms.service: sql-edge
ms.topic: conceptual
author: SQLSourabh
ms.author: sourabha
ms.reviewer: sstein
ms.date: 09/22/2020
ms.openlocfilehash: ffd967797a4e586387a0385169672220727f78a7
ms.sourcegitcommit: 53acd9895a4a395efa6d7cd41d7f78e392b9cfbe
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/22/2020
ms.locfileid: "90886745"
---
# <a name="deploy-azure-sql-edge"></a>Развертывание SQL Azure для пограничных вычислений 

Azure SQL Server — это ядро реляционной базы данных, оптимизированное для развертывания IoT и Azure IoT Edge. Эта служба предоставляет возможности для создания высокопроизводительного хранилища данных и уровня обработки для приложений и решений Интернета вещей. В этом кратком руководстве описано, как начать работу с создания модуля SQL Azure для пограничных вычислений в Azure IoT Edge с помощью портала Azure.

## <a name="before-you-begin"></a>Перед началом

* Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись Azure](https://azure.microsoft.com/free/).
* Войдите на [портал Azure](https://portal.azure.com/).
* Создайте [Центр Интернета вещей](../iot-hub/iot-hub-create-through-portal.md).
* Зарегистрируйте [устройство IoT Edge на портале Azure](../iot-edge/how-to-register-device-portal.md).
* Подготовьте устройство IoT Edge к [развертыванию модуля IoT Edge с помощью портала Azure](../iot-edge/how-to-deploy-modules-portal.md).

> [!NOTE]   
> Сведения о развертывании виртуальной машины Linux в Azure в качестве устройства IoT Edge см. в этом [кратком руководстве](../iot-edge/quickstart-linux.md).

## <a name="deploy-sql-edge-module-from-azure-marketplace"></a>Развертывание модуля SQL для пограничных вычислений из Azure Marketplace

Azure Marketplace — это интернет-магазин приложений и служб, где вы можете просматривать разнообразные корпоративные приложения и решения, сертифицированные и оптимизированные для работы в Azure, включая [модули IoT Edge](https://azuremarketplace.microsoft.com/marketplace/apps/category/internet-of-things?page=1&subcategories=iot-edge-modules). SQL Azure для пограничных вычислений можно развернуть на пограничном устройстве из Marketplace.

1. Найдите модуль SQL для пограничных вычислений в Azure Marketplace.<br><br>

   ![SQL для пограничных вычислений в Marketplace](media/deploy-portal/find-offer-marketplace.png)

2. Выберите оптимальный план программного обеспечения для ваших задач и щелкните **Создать**. <br><br>

   ![Выбор плана программного обеспечения](media/deploy-portal/pick-correct-plan.png)

3. На странице "Целевые устройства для модуля IoT Edge" укажите следующие сведения и щелкните **Создать**.

   |**Поле**  |**Описание**  |
   |---------|---------|
   |Подписка  |  Подписка Azure, в которой был создан Центр Интернета вещей. |
   |Центр Интернета вещей   |  Имя центра Интернета вещей, в котором зарегистрировано устройство IoT Edge. Указав его, выберите вариант "Развертывание на устройстве".|
   |Имя устройства IoT Edge  |  Имя устройства IoT Edge, где будет развернут экземпляр SQL для пограничных вычислений. |

4. На странице **Set modules On Device: (Установка модулей на устройстве** ) щелкните модуль Azure SQL ребра в разделе **IOT Edge modules (модули**). Имя модуля по умолчанию имеет значение *азурескледже*. 

5. В разделе *Параметры модуля* в колонке **Обновление IOT Edge модуля** укажите нужные значения для *имени модуля IOT Edge*, *перезапустите политику* и *желаемое состояние*. 

   > [!IMPORTANT]    
   > Не изменяйте или не обновляйте параметры **URI образа** в модуле.

6. В разделе *переменные среды* в колонке **Обновление IOT Edge модуля** укажите нужные значения переменных среды. Полный список переменных среды пограничных устройств SQL Azure см. в разделе [Настройка с помощью переменных среды](configure.md#configure-by-using-environment-variables). Для модуля определены следующие переменные среды по умолчанию. 

   |**Параметр**  |**Описание**|
   |---------|---------|
   | Имя | Имя модуля. |
   | MSSQL_SA_PASSWORD  | Измените значение по умолчанию, чтобы указать надежный пароль для учетной записи администратора SQL ребра. |
   | MSSQL_LCID   | Измените значение по умолчанию, чтобы задать нужный идентификатор языка для использования с SQL Server. Например, значение 1036 соответствует французскому языку. |
   | MSSQL_COLLATION | Измените значение по умолчанию, чтобы задать параметры сортировки по умолчанию для SQL Server. Этот параметр переопределяет заданное по умолчанию сопоставление идентификатора языка (LCID) и параметров сортировки. |

   > [!IMPORTANT]    
   > Не изменяйте или не обновляйте переменную среды **ACCEPT_EULA** для модуля.

7. В разделе *Параметры создания контейнера* в колонке **Обновление IOT Edge модуль** обновите следующие параметры согласно требованиям. 
   - **Порт узла:** Сопоставьте указанный порт узла с портом 1433 (порт SQL по умолчанию) в контейнере.
   - **Привязки** и **подключения.** если необходимо развернуть несколько модулей SQL, убедитесь, что вы обновляете параметр Mount, чтобы создать новую пару исходных & для постоянного тома. Дополнительные сведения о подключениях и томах см. в разделе [об использовании томов](https://docs.docker.com/storage/volumes/) в документации Docker. 

   ```json
   {
    "HostConfig": {
        "CapAdd": [
            "SYS_PTRACE"
        ],
        "Binds": [
            "sqlvolume:/sqlvolume"
        ],
        "PortBindings": {
            "1433/tcp": [
                {
                    "HostPort": "1433"
                }
            ]
        },
        "Mounts": [
            {
                "Type": "volume",
                "Source": "sqlvolume",
                "Target": "/var/opt/mssql"
            }
        ]
    },
    "Env": [
        "MSSQL_AGENT_ENABLED=TRUE",
        "ClientTransportType=AMQP_TCP_Only",
        "PlanId=asde-developer-on-iot-edge"
    ]
   }
   ```
   > [!IMPORTANT]    
   > Не изменяйте `PlanId` переменную среды, определенную в параметре Create config. Если это значение изменено, контейнер Azure SQL не запускается. 
   
8. На панели **обновление IOT Edge модуль** нажмите кнопку **Обновить**.
9. На странице **Установка модулей на устройстве** нажмите кнопку **далее: Маршруты >** , если необходимо определить маршруты для развертывания. В противном случае щелкните **проверить и создать**. Дополнительные сведения о настройке маршрутов см. [в разделе Развертывание модулей и установка маршрутов в IOT Edge](../iot-edge/module-composition.md).
11. На панели **обновление IOT Edge модуль** нажмите кнопку **создать**.

## <a name="connect-to-azure-sql-edge"></a>Подключение к службе SQL Azure для пограничных вычислений

На следующем шаге воспользуемся средством командной строки SQL Azure для пограничных вычислений **sqlcmd** внутри контейнера для подключения к SQL Azure для пограничных вычислений.

> [!NOTE]      
> Средства командной строки SQL (sqlcmd) недоступны в ARM64 версии контейнеров Azure SQL.

1. Выполните команду `docker exec -it`, чтобы запустить интерактивную оболочку bash внутри запущенного контейнера. В следующем примере `azuresqledge` используется имя, заданное `Name` параметром модуля IOT Edge.

   ```bash
   sudo docker exec -it azuresqledge "bash"
   ```

2. После входа в контейнер подключитесь локально с помощью sqlcmd. Средство sqlcmd не включено в путь по умолчанию, поэтому необходимо указать полный путь.

   ```bash
   /opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P "<YourNewStrong@Passw0rd>"
   ```

   > [!TIP]    
   > Вы можете опустить пароль в командной строке. В этом случае вы получите приглашение для его ввода.

3. Если все сработает должным образом, вы перейдете к приглашению команды **sqlcmd**: `1>`.

## <a name="create-and-query-data"></a>Создание и запрос данных

В следующих разделах приведено пошаговое руководство по созданию базы данных, добавлению данных и запуску запроса с использованием **sqlcmd** и Transact-SQL.

### <a name="create-a-new-database"></a>Создание базы данных

Выполните следующие шаги, чтобы создать базу данных `TestDB`.

1. В приглашении команды **sqlcmd** вставьте следующую команду Transact-SQL, чтобы создать тестовую базу данных:

   ```sql
   CREATE DATABASE TestDB
   Go
   ```

2. В следующей строке напишите запрос, который должен вернуть имена всех баз данных на сервере:

   ```sql
   SELECT Name from sys.Databases
   Go
   ```

### <a name="insert-data"></a>Добавление данных

Теперь создайте таблицу `Inventory` и вставьте две новых строки.

1. В приглашении команды **sqlcmd** переключите контекст на новую базу данных `TestDB`:

   ```sql
   USE TestDB
   ```

2. Создайте таблицу `Inventory`:

   ```sql
   CREATE TABLE Inventory (id INT, name NVARCHAR(50), quantity INT)
   ```

3. Вставьте данные в новую таблицу:

   ```sql
   INSERT INTO Inventory VALUES (1, 'banana', 150); INSERT INTO Inventory VALUES (2, 'orange', 154);
   ```

4. Введите `GO`, чтобы выполнить предыдущие команды:

   ```sql
   GO
   ```

### <a name="select-data"></a>Выбор данных

Теперь выполните запрос, чтобы вернуть данные из таблицы `Inventory`.

1. В приглашении команды **sqlcmd** введите запрос, который должен вернуть из таблицы `Inventory` строки, где количество превышает 152:

   ```sql
   SELECT * FROM Inventory WHERE quantity > 152;
   ```

2. Выполните команду:

   ```sql
   GO
   ```

### <a name="exit-the-sqlcmd-command-prompt"></a>Выход из приглашения команды sqlcmd

1. Чтобы завершить сеанс **sqlcmd**, введите `QUIT`:

   ```sql
   QUIT
   ```

2. Чтобы выйти из интерактивной командной строки в контейнере, введите команду `exit`. Контейнер продолжит работать после выхода из интерактивной оболочки bash.

## <a name="connect-from-outside-the-container"></a> Подключение из-за пределов контейнера

Вы можете подключать и выполнять запросы SQL к экземпляру SQL Azure с помощью любого внешнего средства Linux, Windows или macOS, поддерживающего подключения SQL. Дополнительные сведения о подключении к контейнеру SQL для пограничных вычислений из внешней среды см. в [этой статье](https://docs.microsoft.com/azure/azure-sql-edge/connect).

Из этого краткого руководства вы узнали, как развернуть модуль SQL для пограничных вычислений на устройстве IoT Edge. 

## <a name="next-steps"></a>Next Steps

- [Машинное обучение и искусственный интеллект с помощью ONNX в SQL Server ребра](onnx-overview.md)
- [Создание комплексного решения IoT с использованием SQL Server с помощью IoT Edge](tutorial-deploy-azure-resources.md)
- [Потоковая передача данных в SQL Azure для пограничных вычислений](stream-data.md)
- [Устранение ошибок развертывания](troubleshoot.md)
