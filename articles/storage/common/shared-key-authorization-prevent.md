---
title: Запретить авторизацию с помощью общего ключа (Предварительная версия)
titleSuffix: Azure Storage
description: Чтобы клиенты могли использовать Azure AD для авторизации запросов, можно запретить запросы к учетной записи хранения, авторизованной с помощью общего ключа (Предварительная версия).
services: storage
author: tamram
ms.service: storage
ms.topic: how-to
ms.date: 08/20/2020
ms.author: tamram
ms.reviewer: fryu
ms.openlocfilehash: 3d46df8847a5865c42438ea36245ead0f1e6e528
ms.sourcegitcommit: e69bb334ea7e81d49530ebd6c2d3a3a8fa9775c9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/27/2020
ms.locfileid: "88951123"
---
# <a name="prevent-shared-key-authorization-for-an-azure-storage-account-preview"></a>Запретить авторизацию общего ключа для учетной записи хранения Azure (Предварительная версия)

Каждый защищенный запрос к учетной записи хранения Azure должен быть полномочным. По умолчанию запросы могут быть авторизованы либо с учетными данными Azure Active Directory (Azure AD), либо с помощью ключа доступа учетной записи для авторизации с общим ключом. Из этих двух типов авторизации Azure AD обеспечивает более высокую безопасность и простоту использования общего ключа, а также рекомендует Майкрософт. Чтобы клиенты могли использовать Azure AD для авторизации запросов, можно запретить запросы к учетной записи хранения, авторизованной с помощью общего ключа (Предварительная версия).

Если запретить общий ключ авторизации для учетной записи хранения, служба хранилища Azure отклоняет все последующие запросы к этой учетной записи, которые авторизованы с помощью ключей доступа к учетной записи. Только защищенные запросы, которые разрешены в Azure AD, будут выполнены. Дополнительные сведения об использовании Azure AD см. [в разделе Авторизация доступа к BLOB-объектам и очередям с помощью Azure Active Directory](storage-auth-aad.md).

> [!WARNING]
> Служба хранилища Azure поддерживает авторизацию Azure AD для запросов только к хранилищу BLOB-объектов и очередей. Если запретить проверку подлинности с помощью общего ключа для учетной записи хранения, запросы к службе файлов Azure или хранилищу таблиц, в которых используется авторизация с использованием общего ключа, завершатся ошибкой.
>
> В течение предварительной версии запросы к службе файлов Azure или хранилищу таблиц, которые используют маркеры подписанного URL-адрес (SAS), созданные с помощью ключей доступа к учетной записи, будут выполнены, если авторизация общего ключа запрещена. Дополнительные сведения см. [в разделе о предварительной версии](#about-the-preview).
>
> Запрет на доступ к общим ключам для учетной записи хранения не влияет на подключения SMB к службе "файлы Azure".
>
> Корпорация Майкрософт рекомендует либо перенести все файлы Azure или данные хранилища таблиц в отдельную учетную запись хранения, прежде чем запретить доступ к учетной записи через общий ключ, или не применять этот параметр к учетным записям хранения, поддерживающим рабочие нагрузки службы файлов Azure или хранилища таблиц.

В этой статье описывается, как обнаруживать запросы, отправленные с помощью авторизации общего ключа, и как исправлять авторизацию общего ключа для вашей учетной записи хранения. Дополнительные сведения о регистрации в предварительной версии см. в разделе [о предварительной версии](#about-the-preview).

## <a name="detect-the-type-of-authorization-used-by-client-applications"></a>Определение типа авторизации, используемой клиентскими приложениями

Если запретить авторизацию общего ключа для учетной записи хранения, запросы от клиентов, использующих ключи доступа к учетной записи для авторизации с общим ключом, завершатся ошибкой. Чтобы понять, как запрещающая авторизация общего ключа может повлиять на клиентские приложения перед внесением этого изменения, включите ведение журнала и метрики для учетной записи хранения. Затем можно проанализировать закономерности запросов к вашей учетной записи в течение определенного периода времени, чтобы определить, как запросы разрешены.

Используйте метрики, чтобы определить количество запросов, получаемых учетной записью хранения, которые имеют разрешения с общим ключом или подписанный URL-адрес (SAS). Используйте журналы, чтобы определить, какие клиенты отправляют эти запросы.

Дополнительные сведения об интерпретации запросов, выполняемых с помощью подписанного URL-доступа в предварительной версии, см. [в разделе о предварительной версии](#about-the-preview).

### <a name="monitor-how-many-requests-are-authorized-with-shared-key"></a>Отслеживание количества запросов, разрешенных с помощью общего ключа

Чтобы проконтролировать авторизацию запросов к учетной записи хранения, используйте обозреватель метрик Azure в портал Azure. Дополнительные сведения о обозреватель метрик см. в статье [Приступая к работе с Azure обозреватель метрик](../../azure-monitor/platform/metrics-getting-started.md).

Выполните следующие действия, чтобы создать метрику, которая отслеживает запросы, созданные с помощью общего ключа или SAS.

1. Войдите в свою учетную запись хранения на портале Azure. В разделе **мониторинг** выберите **метрики**.
1. Выберите **Добавить метрику**. В диалоговом окне **Метрика** укажите следующие значения:
    1. В поле **область** оставьте значение имя учетной записи хранения.
    1. Задайте для **пространства имен метрик** *учетные записи*. Эта метрика будет сообщать обо всех запросах к учетной записи хранения.
    1. Задайте для поля **Метрика** значение *транзакции*.
    1. Задайте для поля **агрегирование** значение *Sum*.

    Новая метрика будет отображать сумму количества транзакций по учетной записи хранения в течение заданного интервала времени. Результирующая метрика отображается, как показано на следующем рисунке:

    :::image type="content" source="media/shared-key-authorization-prevent/configure-metric-account-transactions.png" alt-text="Снимок экрана, показывающий, как настроить метрику для суммирования транзакций, выполненных с помощью общего ключа или SAS":::

1. Затем нажмите кнопку **Добавить фильтр** , чтобы создать фильтр по метрике для типа авторизации.
1. В диалоговом окне **Фильтр** укажите следующие значения:
    1. Задайте для **Свойства** значение *Проверка подлинности*.
    1. Задайте для поля **оператор** знак равенства (=).
    1. В поле **значения** выберите *ключ учетной записи* и *SAS*.
1. В правом верхнем углу выберите диапазон времени, для которого требуется просмотреть метрику. Можно также указать, насколько детализирована Статистическая обработка запросов, указав интервалы в диапазоне от 1 минуты до 1 месяца. Например, задайте для **диапазона времени** значение 30 дней, а для параметра **гранулярность времени** — значение 1 день, чтобы увидеть запросы, агрегированные по дням за последние 30 дней.

После настройки метрики запросы к учетной записи хранения начнут отображаться на диаграмме. На следующем рисунке показаны запросы, которые были проверены с помощью общего ключа или созданы с помощью маркера SAS. Запросы объединяются в день за последние тридцати дней.

:::image type="content" source="media/shared-key-authorization-prevent/metric-shared-key-requests.png" alt-text="Снимок экрана, показывающий агрегированные запросы, имеющие общий ключ":::

Вы также можете настроить правило генерации оповещений, чтобы уведомить вас о том, что для учетной записи хранения выполняется определенное число запросов, имеющих общий ключ. Дополнительные сведения см. в статье [Создание и просмотр оповещений метрик, а также управление ими с помощью Azure Monitor](../../azure-monitor/platform/alerts-metric.md).

### <a name="analyze-logs-to-identify-clients-that-are-authorizing-requests-with-shared-key-or-sas"></a>Анализ журналов для выявления клиентов, которые разрабатывают запросы с общим ключом или SAS

Журналы службы хранилища Azure записывают сведения о запросах к учетной записи хранения, в том числе о том, как был выполнен запрос. Вы можете проанализировать журналы, чтобы определить, какие клиенты должны авторизовать запросы с общим ключом или маркером SAS.

Чтобы оценить порядок авторизации в учетной записи хранения Azure, можно использовать ведение журнала службы хранилища Azure Azure Monitor (Предварительная версия). Дополнительные сведения см. в статье [мониторинг службы хранилища Azure](../common/monitor-storage.md).

Ведение журнала службы хранилища Azure в Azure Monitor поддерживает использование запросов журналов для анализа данных журнала. Для запроса журналов можно использовать рабочую область Azure Log Analytics. Дополнительные сведения о запросах журналов см. в разделе [учебник. Начало работы с log Analytics запросами](../../azure-monitor/log-query/get-started-portal.md).

#### <a name="create-a-diagnostic-setting-in-the-azure-portal"></a>Создайте параметр диагностики в портал Azure

Чтобы записывать данные службы хранилища Azure с Azure Monitor и анализировать их с помощью Log Analytics Azure, необходимо сначала создать параметр диагностики, который указывает, какие типы запросов и какие услуги хранилища будут записывать данные. Чтобы создать параметр диагностики в портал Azure, выполните следующие действия.

1. Зарегистрируйтесь в [журнале службы хранилища Azure в Azure Monitor предварительной версии](https://forms.microsoft.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbRxW65f1VQyNCuBHMIMBV8qlUM0E0MFdPRFpOVTRYVklDSE1WUTcyTVAwOC4u).
1. Создайте новую рабочую область Log Analytics в подписке, которая содержит вашу учетную запись хранения Azure, или используйте существующую рабочую область Log Analytics. После настройки ведения журнала для учетной записи хранения журналы будут доступны в рабочей области Log Analytics. Дополнительные сведения см. в статье [Create a Log Analytics workspace in the Azure portal](../../azure-monitor/learn/quick-create-workspace.md) (Создание рабочей области Log Analytics на портале Azure).
1. Войдите в свою учетную запись хранения на портале Azure.
1. В разделе Мониторинг выберите **параметры диагностики (Предварительная версия)**.
1. Выберите службу хранилища Azure, для которой требуется регистрировать запросы. Например, выберите **BLOB-объект** для записи запросов в хранилище BLOB-объектов.
1. Выберите **Добавить параметр диагностики**.
1. Укажите имя для параметра диагностики.
1. В разделе **сведения о категории**в **разделе Журнал** выберите **сторажереад**, **сторажеврите**и **сторажеделете** , чтобы регистрировать все запросы данных для выбранной службы.
1. В разделе **сведения о назначении**выберите **Отправить log Analytics**. Выберите подписку и созданную ранее рабочую область Log Analytics, как показано на следующем рисунке.

    :::image type="content" source="media/shared-key-authorization-prevent/create-diagnostic-setting-logs.png" alt-text="Снимок экрана, показывающий, как создать параметр диагностики для запросов ведения журнала":::

Вы можете создать параметр диагностики для каждого типа ресурса хранилища Azure в учетной записи хранения.

После создания параметра диагностики запросы к учетной записи хранения затем регистрируются в соответствии с этим параметром. Дополнительные сведения см. в статье [Создание параметров диагностики для сбора журналов ресурсов и метрик в Azure](../../azure-monitor/platform/diagnostic-settings.md).

Ссылки на поля, доступные в журналах службы хранилища Azure в Azure Monitor, см. в разделе [журналы ресурсов (Предварительная версия)](../common/monitor-storage-reference.md#resource-logs-preview).

#### <a name="query-logs-for-requests-made-with-shared-key-or-sas"></a>Журналы запросов для запросов с общим ключом или SAS

Журналы службы хранилища Azure в Azure Monitor включают тип авторизации, который использовался для выполнения запроса к учетной записи хранения. Чтобы получить журналы для запросов, выполненных за последние семь дней, которые были проверены с помощью общего ключа или SAS, откройте рабочую область Log Analytics. Затем вставьте следующий запрос в новый запрос к журналу и запустите его. Этот запрос отображает десять IP-адресов, которые чаще всего отправляют запросы, которые были проверены с помощью общего ключа или SAS:

```kusto
StorageBlobLogs
| where AuthenticationType in ("AccountKey", "SAS") and TimeGenerated > ago(7d)
| summarize count() by CallerIpAddress, UserAgentHeader, AccountName
| top 10 by count_ desc
```

Вы также можете настроить правило генерации оповещений на основе этого запроса, чтобы уведомить вас о запросах, имеющих общий ключ или SAS. Дополнительные сведения см. в статье [Создание, просмотр и Управление оповещениями журнала с помощью Azure Monitor](../../azure-monitor/platform/alerts-log.md).

## <a name="remediate-authorization-via-shared-key"></a>Исправлять авторизацию через общий ключ

После анализа способа авторизации запросов к учетной записи хранения можно предпринять действия по предотвращению доступа через общий ключ. Но сначала необходимо обновить все приложения, использующие авторизацию общего ключа, чтобы использовать Azure AD. Вы можете отслеживать журналы и метрики, как описано в разделе [Определение типа авторизации, используемой клиентскими приложениями](#detect-the-type-of-authorization-used-by-client-applications) для отслеживания перехода. Дополнительные сведения об использовании Azure AD с данными BLOB-объектов и очередей см. в разделе [авторизация доступа к BLOB-объектам и очередям с помощью Azure Active Directory](storage-auth-aad.md).

Если вы уверены, что можете безопасно отклонять запросы, которым разрешен общий ключ, можно задать для свойства **алловшаредкэйакцесс** учетной записи хранения **значение false**.

Свойство **алловшаредкэйакцесс** не задано по умолчанию и не возвращает значение, пока оно не будет явно задано. Учетная запись хранения разрешает запросы, которые были разрешены с помощью общего ключа, если свойство имеет значение **null** или имеет значение **true**.

> [!WARNING]
> Если клиенты в данный момент обращаются к данным в учетной записи хранения с общим ключом, корпорация Майкрософт рекомендует перенести эти клиенты в Azure AD, прежде чем запретить доступ к учетной записи хранения с общим ключом.

# <a name="azure-portal"></a>[Портал Azure](#tab/portal)

Чтобы запретить авторизацию общего ключа для учетной записи хранения в портал Azure, выполните следующие действия.

1. Войдите в свою учетную запись хранения на портале Azure.
1. Выберите параметр **конфигурации** в разделе **Параметры**.
1. Установите для параметра **Разрешить доступ к общему ключу** значение **отключено**.

    :::image type="content" source="media/shared-key-authorization-prevent/shared-key-access-portal.png" alt-text="Снимок экрана, показывающий, как запретить общий доступ к ключам для учетной записи":::

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Чтобы запретить авторизацию общего ключа для учетной записи хранения с Azure CLI, установите Azure CLI версии 2.9.1 или более поздней. Дополнительные сведения см. в статье [Установка Azure CLI](/cli/azure/install-azure-cli). Затем настройте свойство **алловшаредкэйакцесс** для новой или существующей учетной записи хранения.

В следующем примере показано, как задать свойство **алловшаредкэйакцесс** с помощью Azure CLI. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```azurecli-interactive
$storage_account_id=$(az resource show \
    --name <storage-account> \
    --resource-group <resource-group> \
    --resource-type Microsoft.Storage/storageAccounts \
    --query id \
    --output tsv)

az resource update \
    --ids $storage_account_id \
    --set properties.allowSharedKeyAccess=false

az resource show \
    --name <storage-account> \
    --resource-group <resource-group> \
    --resource-type Microsoft.Storage/storageAccounts \
    --query properties.allowSharedKeyAccess \
    --output tsv
```

---

После того как вы запретили авторизацию общего ключа, выполнение запроса к учетной записи хранения с помощью авторизации с общим ключом завершится ошибкой с кодом 403 (запрещено). Служба хранилища Azure возвращает ошибку, указывающую на то, что для учетной записи хранения не разрешена авторизация на основе ключей.

### <a name="verify-that-shared-key-access-is-not-allowed"></a>Убедитесь, что общий доступ к ключам запрещен.

Чтобы убедиться, что авторизация с общим ключом больше не разрешена, можно попытаться вызвать операцию с данными с помощью ключа доступа учетной записи. В следующем примере предпринимается попытка создать контейнер с помощью ключа доступа. Этот вызов завершится ошибкой, если авторизация общего ключа запрещена для учетной записи хранения. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```azurecli-interactive
az storage container create \
    --account-name <storage-account> \
    --name sample-container \
    --account-key <key>
    --auth-mode key
```

> [!NOTE]
> Анонимные запросы не разрешены и будут продолжены, если вы настроили учетную запись хранения и контейнер для анонимного общего доступа на чтение. Дополнительные сведения см. в статье [Настройка анонимного общего доступа на чтение для контейнеров и больших двоичных объектов](../blobs/anonymous-read-access-configure.md).

### <a name="check-the-shared-key-access-setting-for-multiple-accounts"></a>Проверка параметров доступа к общим ключам для нескольких учетных записей

Чтобы проверить параметр доступа к общему ключу в наборе учетных записей хранения с оптимальной производительностью, можно использовать обозреватель графа ресурсов Azure в портал Azure. Дополнительные сведения об использовании обозревателя графа ресурсов см. в статье [Краткое руководство. выполнение первого запроса Graph в Azure с помощью обозревателя Graph](/azure/governance/resource-graph/first-query-portal).

При выполнении следующего запроса в обозревателе графа ресурсов возвращается список учетных записей хранения и отображается параметр доступа к общему ключу для каждой учетной записи.

```kusto
resources
| where type =~ 'Microsoft.Storage/storageAccounts'
| extend allowSharedKeyAccess = parse_json(properties).allowSharedKeyAccess
| project subscriptionId, resourceGroup, name, allowSharedKeyAccess
```

## <a name="understand-how-disallowing-shared-key-affects-sas-tokens"></a>Сведения о том, как запретить общий ключ влияет на маркеры SAS

Если общий ключ запрещен для учетной записи хранения, служба хранилища Azure обрабатывает токены SAS на основе типа SAS и службы, которая является целью запроса. В следующей таблице показано, как каждый тип SAS является полномочным, и как служба хранилища Azure будет работать с этим SAS, если свойство **алловшаредкэйакцесс** учетной записи хранения имеет **значение false**.

| Тип SAS | Тип авторизации | Поведение, если Алловшаредкэйакцесс имеет значение false |
|-|-|-|
| SAS делегирования пользователя (только хранилище BLOB-объектов) | Azure AD | Запрос разрешен. Корпорация Майкрософт рекомендует использовать SAS для делегирования пользователей, если это возможно для обеспечения высокого уровня безопасности. |
| SAS службы | Общий ключ | Запрос запрещен для хранилища BLOB-объектов. Запрос разрешен для хранилища очередей и таблиц, а для файлов Azure. Дополнительные сведения см. в статье [запросы с маркерами SAS разрешены для очередей, таблиц и файлов, если алловшаредкэйакцесс имеет значение false](#requests-with-sas-tokens-are-permitted-for-queues-tables-and-files-when-allowsharedkeyaccess-is-false) в разделе **о предварительной версии** . |
| SAS учетной записи | Общий ключ | Запрос запрещен для хранилища BLOB-объектов. Запрос разрешен для хранилища очередей и таблиц, а для файлов Azure. Дополнительные сведения см. в статье [запросы с маркерами SAS разрешены для очередей, таблиц и файлов, если алловшаредкэйакцесс имеет значение false](#requests-with-sas-tokens-are-permitted-for-queues-tables-and-files-when-allowsharedkeyaccess-is-false) в разделе **о предварительной версии** . |

Дополнительные сведения о подписанных URL-адресах см. в статье об [использование подписанных URL-адресов SAS в службе хранилища Azure](storage-sas-overview.md).

## <a name="consider-compatibility-with-other-azure-tools-and-services"></a>Рассмотрите вопросы совместимости с другими инструментами и службами Azure

Для взаимодействия с хранилищем Azure в службах Azure используется авторизация общего ключа. Если запретить общий ключ авторизации для учетной записи хранения, эти службы не смогут получить доступ к данным в этой учетной записи, и ваши приложения могут быть неблагоприятно затронуты.

Некоторые инструменты Azure предлагают возможность использовать авторизацию Azure AD для доступа к службе хранилища Azure. В следующей таблице перечислены некоторые популярные инструменты Azure и заметки о том, могут ли они использовать Azure AD для авторизации запросов к службе хранилища Azure.

| Средство Azure | Авторизация Azure AD в службе хранилища Azure |
|-|-|
| Портал Azure | Поддерживается. Сведения об авторизации учетной записи Azure AD из портал Azure см. в разделе [Выбор способа авторизации доступа к данным BLOB-объектов или очередей в портал Azure](storage-access-blobs-queues-portal.md). |
| AzCopy | Поддерживается для хранилища BLOB-объектов. Сведения об авторизации операций AzCopy см. в разделе [Выбор порядка предоставления учетных данных авторизации](storage-use-azcopy-v10.md#choose-how-youll-provide-authorization-credentials) в документации AzCopy. |
| Обозреватель службы хранилища Azure | Поддерживается только для хранилища BLOB-объектов и Azure Data Lake Storage 2-го поколения. Доступ Azure AD к хранилищу очередей не поддерживается. Убедитесь, что выбран правильный клиент Azure AD. Дополнительные сведения см. в статье [Приступая к работе с обозреватель службы хранилища](/azure/vs-azure-tools-storage-manage-with-storage-explorer?tabs=windows#sign-in-to-azure) |
| Azure PowerShell | Поддерживается. Сведения о том, как авторизовать команды PowerShell с помощью Azure AD для доступа к данным BLOB-объектов и очередей, см. [в статье запуск команд PowerShell с учетными данными Azure AD для доступа к данным BLOB-объектов или очередей](authorize-active-directory-powershell.md). |
| Azure CLI | Поддерживается. Сведения о том, как авторизовать команды Azure CLI с помощью Azure AD для доступа к данным BLOB-объектов и очередей, см. [в статье выполнение команд Azure CLI с учетными данными Azure AD для доступа к данным BLOB-объектов или очередей](authorize-data-operations-cli.md). |
| Центр Интернета вещей Azure | Поддерживается. Дополнительные сведения см. в статье [Поддержка центра Интернета вещей для виртуальных сетей](../../iot-hub/virtual-network-support.md). |
| Azure Cloud Shell | Azure Cloud Shell — это интегрированная оболочка в портал Azure. Azure Cloud Shell размещает файлы для сохранения в общей папке Azure в учетной записи хранения. Эти файлы станут недоступными, если авторизация общего ключа запрещена для этой учетной записи хранения. Дополнительные сведения см. [в статье Connecting a Microsoft Azure Files Storage](/azure/cloud-shell/overview#connect-your-microsoft-azure-files-storage). <br /><br /> Чтобы выполнить команды в Azure Cloud Shell для управления учетными записями хранения, для которых запрещен доступ к общим ключам, сначала убедитесь, что вам предоставлены необходимые разрешения для этих учетных записей с помощью управления доступом на основе ролей (RBAC). Дополнительные сведения см. в статье [что такое управление доступом на основе ролей в Azure (Azure RBAC)](../../role-based-access-control/overview.md). |

## <a name="about-the-preview"></a>Сведения о предварительной версии

Предварительная версия для разрешения авторизации общего ключа доступна в общедоступном облаке Azure. Она поддерживается для учетных записей хранения, использующих только модель развертывания Azure Resource Manager. Сведения о том, какие учетные записи хранения используют модель развертывания Azure Resource Manager, см. в разделе [типы учетных записей хранения](storage-account-overview.md#types-of-storage-accounts).

Чтобы зарегистрироваться для использования предварительной версии, ознакомьтесь с разделом служба [хранилища Azure, разрешающая общий доступ к общим ключам](https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbRxW65f1VQyNCuBHMIMBV8qlUN1o4TUtUUzZBV0JYVlhKQ1FITDlVUUU0Ui4u).

> [!IMPORTANT]
> Эта предварительная версия не предназначена для использования в рабочей среде.

Предварительная версия включает ограничения, описанные в следующих разделах.

### <a name="metrics-and-logging-report-all-requests-made-with-a-sas-regardless-of-how-they-are-authorized"></a>Отчеты о метриках и ведении журнала все запросы, созданные с помощью SAS, независимо от того, как они разрешены

Метрики Azure и вход в систему Azure Monitor не различают разные типы подписанных URL-подписей в предварительной версии. Фильтр **SAS** в Azure обозреватель метрик и поле **SAS** в службе хранилища azure ведение журнала в Azure Monitor оба запроса, которые являются полномочными для любого типа SAS. Однако для разных типов подписанного URL-доступа авторизация выполняется по-разному и ведет себя иначе, если доступ к общим ключам запрещен.

- Маркер SAS службы или маркер SAS учетной записи имеет разрешение с общим ключом и не будет разрешено для запроса к хранилищу BLOB-объектов, если свойство **алловшаредкэйакцесс** имеет значение **false**.
- ПОДПИСАНный URL-адрес делегирования пользователя разрешается с помощью Azure AD и будет разрешен для запроса к хранилищу BLOB-объектов, если свойство **алловшаредкэйакцесс** имеет значение **false**.

При оценке трафика в учетную запись хранения следует помнить, что метрики и журналы, как описано в разделе [Определение типа авторизации, используемой клиентскими приложениями](#detect-the-type-of-authorization-used-by-client-applications) , могут включать запросы, созданные с помощью SAS для делегирования пользователей. Дополнительные сведения о том, как служба хранилища Azure реагирует на SAS, если свойство **алловшаредкэйакцесс** имеет значение **false**, см. в разделе [понимание того, как запрещен общий ключ влияет на маркеры SAS](#understand-how-disallowing-shared-key-affects-sas-tokens).

### <a name="requests-with-sas-tokens-are-permitted-for-queues-tables-and-files-when-allowsharedkeyaccess-is-false"></a>Запросы с маркерами SAS разрешены для очередей, таблиц и файлов, если Алловшаредкэйакцесс имеет значение false

Если доступ к общим ключам не разрешен для учетной записи хранения во время предварительной версии, подписанные URL-адрес, предназначенные для целевых ресурсов очереди, таблицы или службы файлов Azure, остаются разрешенными. Это ограничение относится как к токенам SAS службы, так и к маркерам SAS учетной записи. Оба типа SAS додаются авторизации с помощью общего ключа.

## <a name="next-steps"></a>Следующие шаги

- [Авторизация доступа к данным в службе хранилища Azure](storage-auth.md)
- [Авторизация доступа к BLOB-объектам и очередям с помощью Azure Active Directory](storage-auth-aad.md)
- [Авторизация с помощью общего ключа](/rest/api/storageservices/authorize-with-shared-key)