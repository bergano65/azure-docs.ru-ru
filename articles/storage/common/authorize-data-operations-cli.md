---
title: Выберите способ авторизации доступа к данным BLOB-объектов или очередей с помощью Azure CLI
titleSuffix: Azure Storage
description: Укажите, как авторизовать операции с данными большого двоичного объекта или очереди с помощью Azure CLI. Вы можете авторизовать операции с данными с помощью учетных данных Azure AD, ключа доступа к учетной записи или маркера подписанного URL-доступа (SAS).
services: storage
author: tamram
ms.service: storage
ms.topic: how-to
ms.date: 08/18/2020
ms.author: tamram
ms.reviewer: ozgun
ms.subservice: common
ms.custom: devx-track-azurecli
ms.openlocfilehash: a089ffb7631ded7bd36a4eee5fb862ced3fd2ad0
ms.sourcegitcommit: 02ca0f340a44b7e18acca1351c8e81f3cca4a370
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "88589068"
---
# <a name="choose-how-to-authorize-access-to-blob-or-queue-data-with-azure-cli"></a>Выберите способ авторизации доступа к данным BLOB-объектов или очередей с помощью Azure CLI

Служба хранилища Azure предоставляет расширения для Azure CLI, которые позволяют указать, как вы хотите авторизовать операции с данными BLOB-объектов или очередей. Авторизовать операции с данными можно следующими способами.

- С помощью субъекта безопасности Azure Active Directory (Azure AD). Корпорация Майкрософт рекомендует использовать учетные данные Azure AD для обеспечения высокого уровня безопасности и простоты использования.
- С помощью ключа доступа к учетной записи или маркера подписанного URL-доступа (SAS).

## <a name="specify-how-data-operations-are-authorized"></a>Указание порядка авторизации операций с данными

Azure CLI команды для чтения и записи данных большого двоичного объекта и очереди включают необязательный `--auth-mode` параметр. Укажите этот параметр, чтобы указать, как должна быть разрешена операция с данными:

- Задайте для параметра значение, чтобы выполнить `--auth-mode` `login` Вход с помощью субъекта безопасности Azure AD (рекомендуется).
- Присвойте `--auth-mode` параметру устаревшее `key` значение, чтобы попытаться получить ключ доступа к учетной записи, используемый для авторизации. Если опустить `--auth-mode` параметр, Azure CLI также попытается получить ключ доступа.

Чтобы использовать этот `--auth-mode` параметр, убедитесь, что установлен Azure CLI версии 2.0.46 или более поздней. Выполните команду `az --version`, чтобы узнать установленную версию.

> [!IMPORTANT]
> Если опустить `--auth-mode` параметр или присвоить ему значение `key` , Azure CLI пытается использовать ключ доступа учетной записи для авторизации. В этом случае корпорация Майкрософт рекомендует указать ключ доступа либо в команде, либо в переменной среды **AZURE_STORAGE_KEY** . Дополнительные сведения о переменных среды см. в разделе [Настройка переменных среды для параметров авторизации](#set-environment-variables-for-authorization-parameters).
>
> Если ключ доступа не предоставлен, Azure CLI пытается вызвать поставщик ресурсов службы хранилища Azure, чтобы получить его для каждой операции. Выполнение большого количества операций с данными, требующих вызова поставщика ресурсов, может привести к регулированию. Дополнительные сведения об ограничениях поставщиков ресурсов см. [в разделе целевые показатели масштабируемости и производительности для поставщика ресурсов службы хранилища Azure](scalability-targets-resource-provider.md).

## <a name="authorize-with-azure-ad-credentials"></a>Авторизация с помощью учетных данных Azure AD

При входе в Azure CLI с учетными данными Azure AD возвращается маркер доступа OAuth 2,0. Этот маркер автоматически используется Azure CLI для авторизации последующих операций с данными в хранилище BLOB-объектов или очередей. Для поддерживаемых операций больше не требуется передавать ключ учетной записи или маркер SAS с помощью команды.

Вы можете назначать разрешения для данных BLOB-объектов и очередей субъекту безопасности Azure AD через Управление доступом на основе ролей (RBAC). Дополнительные сведения о ролях Azure в службе хранилища Azure см. в статье [Управление правами доступа к данным службы хранилища Azure с помощью RBAC](storage-auth-aad-rbac.md).

### <a name="permissions-for-calling-data-operations"></a>Разрешения для вызова операций с данными

Расширения службы хранилища Azure поддерживаются для операций с данными BLOB-объектов и очередей. Действия, которые можно вызывать, зависят от разрешений, предоставленных субъекту безопасности Azure AD, с которым вы входите в Azure CLI. Разрешения для контейнеров или очередей службы хранилища Azure назначаются через RBAC. Например, если назначена роль **читателя данных большого двоичного объекта** , можно выполнять команды сценариев, считывающие данные из контейнера или очереди. Если вам назначена роль **участника данных большого двоичного объекта** , можно выполнять команды сценариев, которые считывают, записывают или удаляют контейнер или очередь или содержащиеся в них данные.

Дополнительные сведения о разрешениях, необходимых для каждой операции службы хранилища Azure в контейнере или очереди, см. в разделе [операции хранилища вызовов с токенами OAuth](/rest/api/storageservices/authorize-with-azure-active-directory#call-storage-operations-with-oauth-tokens).  

### <a name="example-authorize-an-operation-to-create-a-container-with-azure-ad-credentials"></a>Пример. авторизация операции для создания контейнера с учетными данными Azure AD

В следующем примере показано, как создать контейнер из Azure CLI с помощью учетных данных Azure AD. Чтобы создать контейнер, необходимо войти в Azure CLI, и вам потребуется группа ресурсов и учетная запись хранения. Дополнительные сведения о создании этих ресурсов см. в разделе [Краткое руководство. Создание, скачивание и получение списка больших двоичных объектов с помощью Azure CLI](../blobs/storage-quickstart-blobs-cli.md).

1. Прежде чем создавать контейнер, назначьте себе роль [Участник данных в хранилище BLOB-объектов](../../role-based-access-control/built-in-roles.md#storage-blob-data-contributor). Несмотря на то, что вы являетесь владельцем учетной записи, вам нужны явные разрешения на выполнение операций с данными с учетной записью хранения. Дополнительные сведения о назначении ролей Azure см. [в разделе Предоставление доступа к данным BLOB-объектов и очередей Azure с помощью RBAC в портал Azure](storage-auth-aad-rbac.md).

    > [!IMPORTANT]
    > Распространение назначений ролей Azure может занять несколько минут.

1. Вызовите команду [AZ Storage Container Create](/cli/azure/storage/container#az-storage-container-create) , указав `--auth-mode` для параметра значение, чтобы `login` создать контейнер с использованием учетных данных Azure AD. Не забудьте заменить значения заполнителей в угловых скобках собственными значениями.

    ```azurecli
    az storage container create \
        --account-name <storage-account> \
        --name sample-container \
        --auth-mode login
    ```

## <a name="authorize-with-the-account-access-key"></a>Авторизация с помощью ключа доступа учетной записи

Если вы владеете ключом учетной записи, вы можете вызвать любую операцию с данными службы хранилища Azure. В общем случае использование ключа учетной записи менее безопасно. Если ключ учетной записи скомпрометирован, все данные в вашей учетной записи могут быть скомпрометированы.

В следующем примере показано, как создать контейнер с помощью ключа доступа учетной записи. Укажите ключ учетной записи и укажите `--auth-mode` параметр со `key` значением:

```azurecli
az storage container create \
    --account-name <storage-account> \
    --name sample-container \
    --account-key <key>
    --auth-mode key
```

## <a name="authorize-with-a-sas-token"></a>Авторизация с помощью маркера SAS

Если вы владеете маркером SAS, вы можете вызывать операции с данными, разрешенные SAS. В следующем примере показано, как создать контейнер с помощью маркера SAS:

```azurecli
az storage container create \
    --account-name <storage-account> \
    --name sample-container \
    --sas-token <token>
```

## <a name="set-environment-variables-for-authorization-parameters"></a>Установка переменных среды для параметров авторизации

Можно указать параметры авторизации в переменных среды, чтобы избежать их включения при каждом вызове операции с данными в хранилище Azure. В следующей таблице описаны доступные переменные среды.

| Переменная среды                  | Описание                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|    AZURE_STORAGE_ACCOUNT              |    имя учетной записи хранения. Эту переменную следует использовать в сочетании с ключом учетной записи хранения или маркером SAS. Если они отсутствуют, Azure CLI пытается получить ключ доступа к учетной записи хранения с помощью учетной записи Azure AD с проверкой подлинности. Если одновременно выполняется большое количество команд, может быть достигнут предел регулирования поставщика ресурсов службы хранилища Azure. Дополнительные сведения об ограничениях поставщиков ресурсов см. [в разделе целевые показатели масштабируемости и производительности для поставщика ресурсов службы хранилища Azure](scalability-targets-resource-provider.md).             |
|    AZURE_STORAGE_KEY                  |    Ключ учетной записи хранения. Эта переменная должна использоваться в сочетании с именем учетной записи хранения.                                                                                                                                                                                                                                                                          |
|    AZURE_STORAGE_CONNECTION_STRING    |    Строка подключения, включающая ключ учетной записи хранения или маркер SAS. Эта переменная должна использоваться в сочетании с именем учетной записи хранения.                                                                                                                                                                                                                       |
|    AZURE_STORAGE_SAS_TOKEN            |    Токен подписанного URL-доступа (SAS). Эта переменная должна использоваться в сочетании с именем учетной записи хранения.                                                                                                                                                                                                                                                            |
|    AZURE_STORAGE_AUTH_MODE            |    Режим авторизации, с помощью которого выполняется команда. Допустимые значения: `login` (рекомендуется) или `key` . Если указать `login` , Azure CLI использует учетные данные Azure AD для авторизации операции с данными. При указании устаревшего `key` режима Azure CLI пытается запросить ключ доступа к учетной записи и авторизовать команду с помощью ключа.    |

## <a name="next-steps"></a>Дальнейшие действия

- [Использование Azure CLI для назначения роли Azure доступа к данным BLOB-объектов и очередей](storage-auth-aad-rbac-cli.md)
- [Авторизация доступа к данным BLOB-объектов и очередей с помощью управляемых удостоверений для ресурсов Azure](storage-auth-aad-msi.md)
