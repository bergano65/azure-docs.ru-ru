---
title: Запуск отработки отказа учетной записи хранения
titleSuffix: Azure Storage
description: Сведения об инициации отработки отказа учетной записи в случае, когда основная конечная точка для вашей учетной записи хранения становится недоступной. Отработка отказа преобразует дополнительный регион в основной регион учетной записи хранения.
services: storage
author: tamram
ms.service: storage
ms.topic: how-to
ms.date: 06/11/2020
ms.author: tamram
ms.reviewer: artek
ms.subservice: common
ms.custom: devx-track-azurecli, devx-track-azurepowershell
ms.openlocfilehash: 74f4c30f7aa018502f3437fd4a577f8c2a9de491
ms.sourcegitcommit: 656c0c38cf550327a9ee10cc936029378bc7b5a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2020
ms.locfileid: "89077952"
---
# <a name="initiate-a-storage-account-failover"></a>Запуск отработки отказа учетной записи хранения

Если первичная конечная точка геоизбыточной учетной записи хранения становится недоступной по какой-либо причине, можно запустить отработку отказа учетной записи. Отработка отказа преобразует дополнительную конечную точку в основную конечную точку учетной записи хранения. Когда отработка отказа завершится, клиенты смогут записывать данные в новый основной регион. Принудительная отработка отказа позволяет поддерживать высокий уровень доступности для ваших приложений.

В этой статье показано, как запустить отработку отказа учетной записи для учетной записи хранения с помощью портала Azure, PowerShell или интерфейса командной строки Azure. Дополнительные сведения об отработке отказа см. в статье [Аварийное восстановление и отработка отказа учетной записи хранения](storage-disaster-recovery-guidance.md).

> [!WARNING]
> Отработка отказа учетной записи обычно приводит к потере некоторых данных. Чтобы понять влияние данных и последствия отработки отказа учетной записи, обратитесь к статье [Understand the account failover process](storage-disaster-recovery-guidance.md#understand-the-account-failover-process) (Понимание процесса отработки отказа учетной записи).

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

## <a name="prerequisites"></a>Предварительные требования

Прежде чем можно будет выполнить отработку отказа учетной записи хранения, убедитесь, что ваша учетная запись хранения настроена для георепликации. Ваша учетная запись хранения может использовать любой из следующих вариантов избыточности:

- Геоизбыточное хранилище (GRS) или геоизбыточное хранилище с доступом для чтения (RA-GRS)
- Хранилище, избыточное в геопоясе (ГЗРС) или геоизбыточное хранилище с доступом на чтение (RA-ГЗРС)

Дополнительные сведения о избыточности службы хранилища Azure см. в статье [избыточность службы хранилища Azure](storage-redundancy.md).

## <a name="initiate-the-failover"></a>Запуск отработки отказа

## <a name="portal"></a>[Портал](#tab/azure-portal)

Чтобы начать отработку отказа учетной записи на портале Azure, выполните следующие действия.

1. Войдите в свою учетную запись хранения.
1. В разделе **Параметры** выберите **Георепликация**. На следующем рисунке показано состояние георепликации и отработки отказа учетной записи хранения.

    :::image type="content" source="media/storage-initiate-account-failover/portal-failover-prepare.png" alt-text="Снимок экрана, отображающий состояние георепликации и отработки отказа":::

1. Убедитесь, что ваша учетная запись хранения настроена для использования геоизбыточного хранилища (GRS) или геоизбыточного хранилища с доступом для чтения (RA-GRS). Если это не так, то выберите **Конфигурация** под разделом **Параметры**, чтобы обновить учетную запись до геоизбыточной.
1. Свойство **Время последней синхронизации** указывает на расстояние между дополнительным и основным регионами. **Время последней синхронизации** дает возможность оценить объем потери данных после завершения отработки отказа. Дополнительные сведения о проверке свойства **время последней синхронизации** см. в разделе [Проверка свойства времени последней синхронизации для учетной записи хранения](last-sync-time-get.md).
1. Выберите **Подготовка к отработке отказа**.
1. Просмотрите диалоговое окно подтверждения. Когда будете готовы, введите **Да**, чтобы подтвердить и запустить отработку отказа.

    :::image type="content" source="media/storage-initiate-account-failover/portal-failover-confirm.png" alt-text="Снимок экрана, отображающий диалоговое окно подтверждения в случае отработки отказа учетной записи":::

## <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

Функция отработки отказа учетной записи общедоступна, но по-прежнему использует модуль предварительной версии для PowerShell. Чтобы запустить отработку отказа учетной записи с помощью PowerShell, сначала необходимо установить модуль AZ. Storage [1.1.1-Preview](https://www.powershellgallery.com/packages/Az.Storage/1.1.1-preview) . Чтобы установить модуль, выполните следующие действия.

1. Удалите все ранее установленные версии Azure PowerShell.

    - Удалите все предыдущие установки Azure PowerShell из Windows с помощью параметра **Apps & features** (Приложения и компоненты) в разделе **Параметры**.
    - Удалите все модули **Azure** из `%Program Files%\WindowsPowerShell\Modules` .

1. Убедитесь, что у вас установлена последняя версия PowerShellGet. Откройте окно Windows PowerShell и выполните следующую команду, чтобы установить последнюю версию:

    ```powershell
    Install-Module PowerShellGet –Repository PSGallery –Force
    ```

1. После установки PowerShellGet закройте и снова откройте окно PowerShell.

1. Установите Azure PowerShell последней версии:

    ```powershell
    Install-Module Az –Repository PSGallery –AllowClobber
    ```

1. Установите модуль предварительной версии службы хранилища Azure, поддерживающий отработку отказа учетной записи.

    ```powershell
    Install-Module Az.Storage –Repository PSGallery -RequiredVersion 1.1.1-preview –AllowPrerelease –AllowClobber –Force
    ```

Чтобы инициировать отработку отказа учетной записи с помощью PowerShell, выполните следующую команду.

```powershell
Invoke-AzStorageAccountFailover -ResourceGroupName <resource-group-name> -Name <account-name>
```

## <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Для отработки отказа с помощью интерфейса командной строки Azure выполните следующие команды.

```azurecli-interactive
az storage account show \ --name accountName \ --expand geoReplicationStats
az storage account failover \ --name accountName
```

---

## <a name="important-implications-of-account-failover"></a>Важные последствия отработки отказа учетной записи

При запуске отработки отказа учетной записи для вашей учетной записи хранения записи DNS для дополнительной конечной точки обновляются таким образом, чтобы дополнительная конечная точка становилась основной конечной точкой. Убедитесь, что понимаете возможные последствия для вашей учетной записи хранения, прежде чем начать отработку отказа.

Чтобы оценить степень вероятной потери данных перед запуском отработки отказа, проверьте свойство **время последней синхронизации** . Дополнительные сведения о проверке свойства **время последней синхронизации** см. в разделе [Проверка свойства времени последней синхронизации для учетной записи хранения](last-sync-time-get.md).

После отработки отказа тип вашей учетной записи хранения автоматически преобразуется в локально избыточное хранилище (LRS) в новом основном регионе. Вы можете снова включить геоизбыточное хранилище (GRS) или геоизбыточное хранилище с доступом для чтения (RA-GRS) для вашего аккаунта. Обратите внимание, что преобразование в тип репликации из LRS на GRS или RA-GRS влечет за собой дополнительные затраты. Дополнительные сведения см. на странице [Сведения о стоимости пропускной способности](https://azure.microsoft.com/pricing/details/bandwidth/).

После повторного включения GRS для учетной записи хранения Microsoft начинает репликацию данных в вашей учетной записи в новый вторичный регион. Время репликации зависит от объема реплицируемых данных.  

## <a name="next-steps"></a>Дальнейшие действия

- [Аварийное восстановление и отработка отказа учетной записи хранения](storage-disaster-recovery-guidance.md)
- [Проверка свойства "Время последней синхронизации" для учетной записи хранения](last-sync-time-get.md)
- [Разработка высокодоступных приложений с геоизбыточностью](geo-redundant-design.md)
- [Руководство по Создание высокодоступного приложения с помощью хранилища BLOB-объектов](../blobs/storage-create-geo-redundant-storage.md)
