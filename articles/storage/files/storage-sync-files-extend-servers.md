---
title: Руководство. Расширение файловых серверов Windows с использованием службы "Синхронизация файлов Azure" | Документация Майкрософт
description: Узнайте, как расширить файловые сервера Windows с помощью службы "Синхронизация файлов Azure" от начала до конца.
services: storage
author: wmgries
ms.service: storage
ms.topic: tutorial
ms.date: 10/23/2018
ms.author: wgries
ms.component: files
ms.openlocfilehash: cc34411cc27870dbd9c707a34ebf34b96c7253dc
ms.sourcegitcommit: c2c279cb2cbc0bc268b38fbd900f1bac2fd0e88f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/24/2018
ms.locfileid: "49986123"
---
# <a name="tutorial-extend-windows-file-servers-with-azure-file-sync"></a>Руководство. Расширение файловых серверов Windows с использованием службы "Синхронизация файлов Azure"
В этом руководстве мы покажем основные шаги, необходимые для повышения емкости хранилища сервера Windows с использованием службы "Синхронизация файлов Azure". Хотя в этом руководстве мы используем виртуальную машину Azure для Windows Server, этот процесс обычно выполняется на локальных серверах. Если вы готовы развернуть службу "Синхронизация файлов Azure" в собственной среде, вместо этого воспользуйтесь [этой статьей](storage-sync-files-deployment-guide.md).

> [!div class="checklist"]
> * Развертывание службы синхронизации хранилища
> * Подготовка сервера Windows к работе со службой синхронизации файлов Azure
> * Установка агента службы синхронизации файлов Azure
> * Регистрация Windows Server в службе синхронизации хранилища
> * Создание группы синхронизации и конечной точки облака
> * Создание конечной точки сервера

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="sign-in-to-azure"></a>Вход в Azure
Войдите на портал Azure по адресу https://portal.azure.com.

## <a name="prepare-your-environment"></a>Подготовка среды
Перед развертыванием службы "Синхронизация файлов Azure" в рамках этого руководства необходимо настроить несколько элементов. Кроме учетной записи службы хранилища и общего файлового ресурса создается виртуальная машина Windows Server 2016 Datacenter и подготавливается служба "Синхронизация файлов Azure".

### <a name="create-a-folder-and-txt-file"></a>Создание папки и TXT-файла

На локальном компьютере создайте папку с именем *FilesToSync* и добавьте текстовый файл с именем *mytestdoc.txt*. Вы отправите этот файл в общую папку позже в рамках этого руководства.

### <a name="create-a-storage-account"></a>Создание учетной записи хранения

[!INCLUDE [storage-create-account-portal-include](../../../includes/storage-create-account-portal-include.md)]

### <a name="create-a-file-share"></a>Создание общей папки
Затем вы создадите общий файловый ресурс.

1. После развертывания учетной записи хранения Azure щелкните **Перейти к ресурсу**.
1. Щелкните **Файлы** из области учетной записи хранения.

    ![Выбор элемента "Файлы"](./media/storage-sync-files-extend-servers/click-files.png)

1. Щелкните **+ File Share** (+ Общий файловый ресурс).

    ![Нажатие кнопки добавления общего файлового ресурса](./media/storage-sync-files-extend-servers/create-file-share-portal2.png)

1. Назовите общую папку *afsfileshare* и введите "1" для **квоты**, а затем нажмите кнопку **Создать**. Размер квоты не может превышать 5 ТиБ, однако в рамках этого руководства достаточно 1 ГБ.

    ![Указание имени и квоты для нового общего файлового ресурса](./media/storage-sync-files-extend-servers/create-file-share-portal3.png)

1. Выберите новый общий файловый ресурс, а затем в расположении общего файлового ресурса нажмите кнопку **Отправить**.

    ![Отправка файла](./media/storage-sync-files-extend-servers/create-file-share-portal5.png)

1. Перейдите к папке *FilesToSync*, где вы создали TXT-файл, выберите *mytestdoc.txt* и нажмите кнопку **Отправить**.

    ![Обзор общего файлового ресурса](./media/storage-sync-files-extend-servers/create-file-share-portal6.png)

На этом этапе вы создали учетную запись Службы хранилища Azure и общий файловый ресурс с одним файлом в Azure. Теперь вы создадите виртуальную машину Azure с Windows Server 2016 Datacenter, чтобы представить в этом руководстве локальный сервер.

### <a name="deploy-a-vm-and-attach-a-data-disk"></a>Развертывание виртуальной машины и подключение диска данных

1. Затем разверните меню в левой части портала и выберите **Создать ресурс** в верхнем левом углу портала Azure.
1. В поле поиска над списком ресурсов **Azure Marketplace** найдите и выберите **Windows Server 2016 Datacenter**, затем выберите **Создать**.
1. На вкладке **Основные сведения** в разделе **Сведения о проекте** выберите группу ресурсов, созданную для этого руководства.

   ![Ввод основных сведений о виртуальной машине в колонке портала](./media/storage-sync-files-extend-servers/vm-resource-group-and-subscription.png)

1. В разделе **Подробности об экземпляре** введите имя виртуальной машины, например *myVM*.
1. Оставьте значения по умолчанию для **региона**, **параметров доступности**, **образа** и **размера**.
1. В разделе **Учетная запись администратора** введите **имя пользователя** и **пароль** для виртуальной машины.
1. В разделе **Правила входящего порта**, щелкните **Разрешить выбранные порты**, а затем выберите **RDP (3389)** и **HTTP** из раскрывающегося списка.

   Перед созданием виртуальной машины необходимо создать диск данных.

1. Щелкните **Next:Disks** (Далее: диски)

   ![Добавление дисков данных](./media/storage-sync-files-extend-servers/vm-add-data-disk.png)

1. В разделе **Диски** в списке **Disk options** (Параметры диска) оставьте значения по умолчанию.
1. В разделе **Диски данных** щелкните **Создать и подключить новый диск**.

1. Оставьте значения по умолчанию, изменив **Размер (ГиБ)** на **1 ГБ** в целях этого руководства.

   ![Сведения о диске данных](./media/storage-sync-files-extend-servers/vm-create-new-disk-details.png)

1. Последовательно выберите **ОК**.
1. Щелкните **Review + create** (Просмотреть и создать).
1. Нажмите кнопку **Создать**.

   Щелкните значок **Уведомления**, чтобы просмотреть **ход выполнения развертывания**. Создание виртуальной машины займет несколько минут.

1. После развертывания виртуальной машины щелкните **Перейти к ресурсу**.

   ![Переход к ресурсу](./media/storage-sync-files-extend-servers/vm-gotoresource.png)

   На этом этапе вы создали виртуальную машину и подключили диск данных. Теперь необходимо подключиться к виртуальной машине.

### <a name="connect-to-your-vm"></a>Подключение к виртуальной машине

1. На портал Azure на странице свойств виртуальной машины нажмите кнопку **Подключиться**.

   ![Подключение к виртуальной машине Azure с портала](./media/storage-sync-files-extend-servers/connect-vm.png)

1. На странице **подключения к виртуальной машине** сохраните значения по умолчанию, чтобы использовать подключение по **IP-адресу** через порт 3389, и нажмите кнопку **Скачать RDP-файл**.

   ![Скачивание RDP-файла](./media/storage-sync-files-extend-servers/download-rdp.png)

1. Откройте скачанный RDP-файл и при появлении запроса нажмите кнопку **Подключиться**.
1. В окне **Безопасность Windows** выберите **Варианты выбора** и нажмите **Использовать другую учетную запись**. Введите имя пользователя в формате *localhost\имя_пользователя*, а затем введите созданный для этой виртуальной машины пароль и нажмите кнопку **ОК**.

   ![Дополнительные варианты](./media/storage-sync-files-extend-servers/local-host2.png)

1. При входе в систему может появиться предупреждение о сертификате. Щелкните **Да** или **Продолжить**, чтобы создать подключение.

### <a name="prepare-the-windows-server"></a>Подготовка Windows Server
Для сервера **Windows Server 2016 Datacenter** отключите **конфигурацию усиленной безопасности Internet Explorer**. Этот шаг необходим только при начальной регистрации на сервере. Конфигурацию можно включить повторно после регистрации сервера.

На виртуальной машине **Windows Server 2016 Datacenter** **диспетчер сервера** откроется автоматически.  Если **диспетчер сервера** не открывается по умолчанию, найдите его в обозревателе.

1. В **диспетчере сервера** щелкните **Локальный сервер**.

   ![Элемент "Локальный сервер" в левой части пользовательского интерфейса диспетчера сервера](media/storage-sync-files-extend-servers/prepare-server-disable-ieesc-1.png)

1. Перейдите по ссылке **Конфигурация усиленной безопасности Internet Explorer** на вложенной панели **Свойства**.  

    ![Панель "Конфигурация усиленной безопасности Internet Explorer" в пользовательском интерфейсе диспетчера сервера](media/storage-sync-files-extend-servers/prepare-server-disable-ieesc-2.png)

1. В диалоговом окне **Конфигурация усиленной безопасности Internet Explorer** установите переключатель **Выкл.** в разделе **Администраторы** и **Пользователи**.

    ![Всплывающее окно "Конфигурация усиленной безопасности Internet Explorer" с установленным переключателем "Выкл."](media/storage-sync-files-extend-servers/prepare-server-disable-ieesc-3.png)

   Теперь вы можете добавить диск данных к виртуальной машине.

### <a name="add-the-data-disk"></a>Добавление диска данных

1. В виртуальной машине **Windows Server 2016 Datacenter** нажмите кнопку **Files and storage services** (Файловые службы и службы хранилища)  > **Тома** > **Диски**.

    ![Диск данных](media/storage-sync-files-extend-servers/your-disk.png)

1. Щелкните правой кнопкой мыши диск размером 1 ГБ с именем **Msft Virtual Disk** и выберите **Новый том**.
1. Завершите работу мастера, оставив значения по умолчанию, и отметьте присвоенную букву диска, а затем выберите **Создать**.
1. Нажмите кнопку **Закрыть**

   На этом этапе вы ввели диск в интерактивный режим и создали том. Чтобы убедиться, что добавление диска данных прошло успешно, откройте обозреватель на виртуальной машине и убедитесь, что новый диск присутствует.

1. В обозревателе на виртуальной машине разверните узел **Этот компьютер** и дважды щелкните новый диск. В этом примере это диск F.
1. Щелкните службу правой кнопкой мыши и выберите **Создать** > **Папка**. Назовите папку *FilesToSync*.
1. Дважды щелкните папку **FilesToSync**.
1. Щелкните службу правой кнопкой мыши и выберите **Создать** > **Text Document** (Текстовый документ). Назовите текстовый файл *MyTestFile*.

    ![Добавление нового текстового файла](media/storage-sync-files-extend-servers/new-file.png)

1. Закройте **обозреватель** и **диспетчер сервера**.

### <a name="download-the-azurerm-powershell-module"></a>Скачивание модуля AzureRM PowerShell
Затем на виртуальной машине **Windows Server 2016 Datacenter** установите на сервер модуль **AzureRM PowerShell**.

1. На виртуальной машине откройте окно PowerShell с повышенными привилегиями.
1. Выполните следующую команду:

   ```powershell
   Install-Module -Name AzureRM -AllowClobber
   ```

   > [!NOTE]
   > Если установленная версия NuGet предшествует версии 2.8.5.201, вам будет предложено скачать и установить последнюю версию NuGet.

   По умолчанию коллекция PowerShell не используется как доверенный репозиторий для PowerShellGet. При первом использовании PSGallery отображается следующее сообщение:

   ```output
   Untrusted repository

   You are installing the modules from an untrusted repository. If you trust this repository, change its InstallationPolicy value by running the Set-PSRepository cmdlet.

   Are you sure you want to install the modules from 'PSGallery'?
   [Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is "N"):
   ```

1. Ответьте `Yes` или `Yes to All`, чтобы продолжить установку.

Модуль `AzureRM` — это общий модуль для командлетов Azure PowerShell. Во время его установки скачиваются все доступные модули Azure Resource Manager и устанавливаются все соответствующие командлеты.

На этом этапе мы завершили настройку среды для руководства. Вы готовы начать развертывание **службы синхронизации хранилища**.

## <a name="deploy-the-service"></a>Развертывание службы 
Развертывание функции "Синхронизация файлов Azure" начинается с размещения ресурса **службы синхронизации хранилища** в группе ресурсов выбранной вами подписки. Служба синхронизации хранилища унаследовала разрешения на доступ от подписки и группы ресурсов, в которую она была развернута.

1. На портале Azure щелкните **Создать ресурс** и найдите службу **Синхронизация файлов Azure**.
1. В результатах поиска выберите **Синхронизация файлов Azure**.
1. Выберите **Создать**, чтобы открыть вкладку **Развертывание службы синхронизации хранилища**.

   ![Развертывание службы синхронизации хранилища](media/storage-sync-files-extend-servers/afs-info.png)

   В открывшейся области введите следующие сведения:

   | Значение | ОПИСАНИЕ |
   | ----- | ----- |
   | **Имя** | Уникальное имя (в подписке) для службы синхронизации хранилища.<br><br>В этом руководстве мы используем *afssyncservice02*. |
   | **Подписка** | Подписка, используемая в этом руководстве. |
   | **Группа ресурсов** | Группа ресурсов, используемая в этом руководстве.<br><br>В этом руководстве мы используем *afsresgroup101918*. |
   | **Местоположение.** | Восточная часть США |

1. По завершении выберите **Создать**, чтобы развернуть **службу синхронизации хранилища**.
1. Выберите вкладку **Уведомления** и **Перейти к ресурсу**.

## <a name="install-the-agent"></a>Установка агента.
Агент службы синхронизации файлов Azure — это скачиваемый пакет, позволяющий синхронизировать Windows Server с общим файловым ресурсом Azure.

1. Вернитесь в виртуальную машину **Windows Server 2016 Datacenter** и откройте **Internet Explorer**.
1. Перейдите к [Центру загрузки Майкрософт](https://go.microsoft.com/fwlink/?linkid=858257). Прокрутите вниз до раздела **Azure File Sync Agent** (Агент службы синхронизации файлов Azure) и выберите **Загрузка**.

   ![Скачивание агента синхронизации](media/storage-sync-files-extend-servers/sync-agent-download.png)

1. Установите флажок **StorageSyncAgent_V3_WS2016.EXE** и выберите **Далее**.

   ![Выбор агента](media/storage-sync-files-extend-servers/select-agent.png)

1. Выберите следующие элементы для файла: **Разрешить один раз** > **Выполнить** > **Открыть**.
1. Если вы еще не сделали этого, закройте окно PowerShell.
1. Примите значения по умолчанию в **мастере установки агента синхронизации хранилища**.
1. Щелкните **Install**(Установить).
1. Нажмите кнопку **Готово**

Вы развернули службу синхронизации Azure и установили агент на виртуальной машине **Windows Server 2016 Datacenter**. Теперь вам необходимо зарегистрировать виртуальную машину в **службе синхронизации хранилища**.

## <a name="register-windows-server"></a>Регистрация Windows Server
При регистрации Windows Server в службе синхронизации хранилища между сервером (или кластером) и службой синхронизации хранилища устанавливаются отношения доверия. Сервер можно зарегистрировать только в одной службе синхронизации хранилища, и он может синхронизироваться с другими серверами и файловыми ресурсами Azure, связанными с той же службой синхронизации хранилища.

После установки **агента службы синхронизации файлов Azure** пользовательский интерфейс регистрации сервера запустится автоматически. Если он не запустился, его можно открыть вручную, перейдя в расположение файла: C:\Program Files\Azure\StorageSyncAgent\ServerRegistration.exe.

1. После открытия пользовательского интерфейса регистрации сервера выберите **ОК**.
1. Выберите **Вход**, чтобы приступить к работе.
1. Войдите, используя свои учетные данные Azure, и щелкните **Вход**.
1. Введите следующие сведения:

   ![Снимок экрана пользовательского интерфейса регистрации сервера](media/storage-sync-files-extend-servers/signin.png)

   | | |
   | ----- | ----- |
   | Значение | ОПИСАНИЕ |
   | **подписка Azure**; | Подписка, содержащая службу синхронизации хранилища в этом руководстве. |
   | **Группа ресурсов** | Группа ресурсов, содержащая службу синхронизации хранилища в этом руководстве. В этом руководстве мы использовали *afsresgroup101918*. |
   | **Служба синхронизации хранилища** | Имя службы синхронизации хранилища, которое используется в этом руководстве. В этом руководстве мы использовали *afssyncservice02*. |

1. Для завершения процесса регистрации сервера нажмите кнопку **Зарегистрировать**.
1. В рамках процесса регистрации будет запрошен дополнительный вход. Войдите и нажмите кнопку **Далее**.
1. Последовательно выберите **ОК**.

## <a name="create-a-sync-group"></a>Создание группы синхронизации
Группа синхронизации определяет топологию синхронизации для набора файлов. Группа синхронизации должна содержать одну облачную конечную точку, которая представляет собой общий файловый ресурс Azure, и одну или несколько конечных точек сервера. Конечная точка сервера представляет собой путь в зарегистрированном сервере.

1. Чтобы создать группу синхронизации, на [портале Azure](https://portal.azure.com/) перейдите к службе синхронизации хранилища, созданной для этого руководства, и выберите **+ Sync group** (+ Группа синхронизации). В этом руководстве мы использовали *afssyncservice02* в качестве примера.

   ![Создание группы синхронизации на портале Azure](media/storage-sync-files-extend-servers/add-sync-group.png)

1. В открывшейся области введите следующую информацию, чтобы создать группу синхронизации с облачной конечной точкой:

   | Значение | ОПИСАНИЕ |
   | ----- | ----- |
   | **Имя группы синхронизации** | Это имя должно быть уникальным в службе синхронизации хранилища. Вы можете выбрать любое подходящее имя. В этом руководстве мы используем *afssyncgroup*.|
   | **Подписка** | Подписка, в которой развернута служба синхронизации хранилища для этого руководства. |
   | **Учетная запись хранения** |Щелкните **Выберите учетную запись хранения**. В открывшейся области выберите учетную запись хранения, в которой находится общий файловый ресурс Azure, созданный для этого руководства. Мы использовали *afsstoracct101918*. |
   | **Общая папка Azure** | Имя общего файлового ресурса Azure, созданного для этого руководства. Мы использовали *afsfileshare*. |

1. Нажмите кнопку **Создать**.

Если выбрать группу синхронизации, вы увидите, что теперь у вас есть одна **облачная конечная точка**.

## <a name="add-a-server-endpoint"></a>Добавление конечной точки сервера
Конечная точка сервера представляет собой определенное расположение на зарегистрированном сервере, например папку в томе сервера.

1. Чтобы добавить конечную точку сервера, выберите созданную группу синхронизации и щелкните **Добавление конечной точки сервера**.

   ![Добавление новой конечной точки сервера в области группы синхронизации](media/storage-sync-files-extend-servers/add-server-endpoint.png)

1. В открывшейся области **Добавление конечной точки сервера** введите следующие сведения, чтобы создать конечную точку сервера:

   | | |
   | ----- | ----- |
   | Значение | ОПИСАНИЕ |
   | **Зарегистрированный сервер** | Имя сервера, созданного для этого руководства. В этом руководстве мы использовали *afsvm101918*. |
   | **Путь** | Путь к диску на Windows Server, созданному для этого руководства. В нашем примере это *f:\filestosync*. |
   | **Уровни в облаке** | Оставьте отключенным для этого руководства. |
   | **Свободное место на томе** | Оставьте незаполненным для этого руководства. |

1. Нажмите кнопку **Создать**.

Теперь ваши файлы будут синхронизироваться по всем общим файловым ресурсам Azure и Windows Server.

![Служба хранилища Azure успешно синхронизирована](media/storage-sync-files-extend-servers/files-synced-in-azurestorage.png)

## <a name="clean-up-resources"></a>Очистка ресурсов

[!INCLUDE [storage-files-clean-up-portal](../../../includes/storage-files-clean-up-portal.md)]

## <a name="next-steps"></a>Дополнительная информация
В этом руководстве вы ознакомились с основными шагами, необходимыми для повышения емкости хранилища Windows Server с использованием службы "Синхронизация файлов Azure". Перейдите по этой ссылке, чтобы более подробно ознакомиться с планированием для развертывания службы "Синхронизации файлов Azure".

> [!div class="nextstepaction"]
> [Планирование развертывания службы синхронизации файлов Azure](./storage-sync-files-planning.md)