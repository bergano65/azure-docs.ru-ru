---
title: Миграция рядов StorSimple 8000 в Синхронизация файлов Azure
description: Узнайте, как перенести устройство StorSimple 8100 или 8600 в Синхронизация файлов Azure.
author: fauhse
ms.service: storage
ms.topic: how-to
ms.date: 10/16/2020
ms.author: fauhse
ms.subservice: files
ms.openlocfilehash: 4aec299e15964d45ad949034ba02729ff43934de
ms.sourcegitcommit: 4f4a2b16ff3a76e5d39e3fcf295bca19cff43540
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2020
ms.locfileid: "93043127"
---
# <a name="storsimple-8100-and-8600-migration-to-azure-file-sync"></a>Миграция StorSimple 8100 и 8600 на Синхронизация файлов Azure

Серия StorSimple 8000 представлена физическими, локальными устройствами и компонентами облачных служб 8100 или 8600. Данные любого из этих устройств можно перенести в Синхронизация файлов Azureную среду. Синхронизация файлов Azure является стратегически долгосрочной службой Azure по умолчанию, в которую можно перенести устройства StorSimple.

Серия StorSimple 8000 пойдет в [конец срока жизни](https://support.microsoft.com/en-us/lifecycle/search?alpha=StorSimple%208000%20Series) в декабре 2022. Важно начать планирование миграции как можно скорее. Эта статья содержит необходимые фундаментальные знания и этапы миграции для успешной миграции на Синхронизация файлов Azure.

## <a name="phase-1-prepare-for-migration"></a>Этап 1. Подготовка к миграции

В этом разделе содержатся действия, которые необходимо выполнить в начале миграции с томов StorSimple на общие файловые ресурсы Azure.

### <a name="inventory"></a>Inventory (Товары)

После начала планирования миграции сначала необходимо найти все устройства и тома StorSimple, которые необходимо перенести. После этого можно выбрать оптимальный способ миграции.

* Физические устройства StorSimple (серии 8000). Используйте это руководством по миграции.
* Виртуальные устройства, [серия StorSimple 1200, используйте другое руководством по миграции](storage-files-migration-storsimple-1200.md).

### <a name="migration-cost-summary"></a>Сводка по стоимости миграции

При миграции на файловые ресурсы Azure из томов StorSimple через задания службы преобразования данных в ресурс Диспетчер данных StorSimple бесплатно взимается плата. Другие затраты могут быть вызваны во время и после миграции:

* Исходящий трафик **сети:** Файлы StorSimple находятся в учетной записи хранения в определенном регионе Azure. Если вы подготавливаете файловые ресурсы Azure, которые вы переносите в учетную запись хранения, расположенную в том же регионе Azure, стоимость исходящих данных не будет выполнена. Вы можете переместить файлы в учетную запись хранения в другом регионе в рамках этой миграции. В этом случае к вам будут относиться расходы на исходящий трафик.
* **Транзакции в общей папке Azure:** При копировании файлов в файловый ресурс Azure (в рамках миграции или за пределы одной) стоимость транзакций применяется по мере записи файлов и метаданных. Рекомендуется запускать файловый ресурс Azure на уровне оптимизированных транзакций во время миграции. После завершения миграции переключитесь на нужный уровень. На следующих этапах это будет вызвано в соответствующей точке.
* **Изменение уровня файлового ресурса Azure:** Изменение уровня транзакций в общей папке Azure. В большинстве случаев эффективнее будет следовать рекомендациям, приведенным на предыдущем этапе.
* **Стоимость хранилища:** Когда эта миграция начнет копирование файлов в файловый ресурс Azure, будет потреблено хранилище файлов Azure и выставлен счет.
* **StorSimple:** Пока вы не сможете отменить подготовку устройств StorSimple и учетных записей хранения, стоимость StorSimple для хранилища, резервного копирования и устройств будет по-прежнему выполняться.

### <a name="direct-share-access-vs-azure-file-sync"></a>Прямой доступ к общим ресурсам и Синхронизация файлов Azure

Файловые ресурсы Azure позволяют создать целый мир возможностей для структурирования развертывания файловых служб. Файловый ресурс Azure — это просто общий ресурс SMB в облаке, который можно настроить для предоставления пользователям доступа непосредственно по протоколу SMB с помощью знакомой проверки подлинности Kerberos и существующих разрешений NTFS (списки ACL для файлов и папок), работающих в собственном режиме. Дополнительные сведения о [доступе к общим файловым ресурсам Azure на основе удостоверений](storage-files-active-directory-overview.md).

Альтернативой для прямого доступа является [Синхронизация файлов Azure](https://aka.ms/AFS). Синхронизация файлов Azure — это прямая аналоговая возможность кэшировать часто используемые файлы в локальной среде StorSimple.

Синхронизация файлов Azure — это облачная служба Майкрософт, основанная на двух основных компонентах:

* Синхронизация файлов и распределение по уровням облака.
* Общие файловые ресурсы как собственные хранилища в Azure, к которым можно получить доступ по нескольким протоколам, таким как SMB и File RESTFUL.

Файловые ресурсы Azure сохраняются важные аспекты качества файлов для сохраненных файлов, таких как атрибуты, разрешения и метки времени. При использовании файловых ресурсов Azure больше не требуется, чтобы приложение или служба считали файлы и папки, хранящиеся в облаке. К ним можно обращаться по привычным протоколам и клиентам, например проводнику Windows. Файловые ресурсы Azure позволяют хранить данные общего файлового сервера и данные приложений в облаке. Резервное копирование файлового ресурса Azure — это встроенная функция, которую можно дополнительно улучшить, Azure Backup.

В этой статье рассматриваются этапы миграции. Если вы хотите узнать больше о Синхронизация файлов Azure перед миграцией, см. следующие статьи:

* [Обзор Синхронизация файлов Azure](https://aka.ms/AFS "Обзор")
* [Синхронизация файлов Azure рекомендации по развертыванию](storage-sync-files-deployment-guide.md)

### <a name="storsimple-service-data-encryption-key"></a>Ключ шифрования данных службы StorSimple

При первой настройке устройства StorSimple он создал ключ шифрования данных службы и задал для него безопасное хранение ключа. Этот ключ используется для шифрования всех данных в связанной учетной записи хранения Azure, где устройство StorSimple хранит ваши файлы.

Ключ шифрования данных службы необходим для успешной миграции. Теперь самое время извлечь этот ключ из записей для каждого из устройств в инвентаризации.

Если вы не можете найти ключи в записях, можно получить ключ из устройства. У каждого устройства есть уникальный ключ шифрования. Чтобы получить ключ, сделайте следующее:

* Отправьте запрос в службу поддержки с помощью Microsoft Azure через портал Azure. В содержимом запроса должны быть серийные номера устройств StorSimple и запрос на получение ключа шифрования данных службы.
* Инженер службы поддержки StorSimple свяжется с вами с запросом на собрание по демонстрации экрана.
* Убедитесь, что перед началом собрания вы подключаетесь к устройству StorSimple [через последовательную консоль](../../storsimple/storsimple-8000-windows-powershell-administration.md#connect-to-windows-powershell-for-storsimple-via-the-device-serial-console) или через [Удаленный сеанс PowerShell](../../storsimple/storsimple-8000-windows-powershell-administration.md#connect-remotely-to-storsimple-using-windows-powershell-for-storsimple).

> [!CAUTION]
> При принятии решения о подключении к устройству StorSimple учитывайте следующее.
>
> * Подключение через HTTPS-сеанс является наиболее безопасным и рекомендуемым вариантом.
> * Прямое подключение к последовательной консоли устройства является безопасным, а подключение к последовательной консоли через сетевые коммутаторы — нет.
> * Соединения с сеансами HTTP являются вариантами, но *не зашифрованы*. Они не рекомендуются, если они не используются в закрытой доверенной сети.

### <a name="storsimple-volume-backups"></a>Резервные копии томов StorSimple

StorSimple предлагает разностные резервные копии на уровне тома. Файловые ресурсы Azure также имеют эту возможность, называемую моментальными снимками общего ресурса.

Примите решение о том, что в рамках миграции вы также обязаны переместить резервные копии.

> [!CAUTION]
> Здесь следует останавливаться, если необходимо перенести резервные копии с томов StorSimple.
>
> Сейчас вы можете перенести только самую последнюю резервную копию тома. Поддержка миграции резервных копий будет поступать в конце 2020. Если начать работу сейчас, вы не сможете "заложить" резервные копии позже. В предстоящей версии резервные копии должны быть воспроизведены в файловые ресурсы Azure от старых к новым, с помощью которых создаются моментальные снимки файловых ресурсов Azure.

Если вы хотите перенести только данные в реальном времени и не имеете никаких требований к резервному копированию, можно продолжить работу, следуя указаниям в этом разделе. Если у вас есть краткосрочное требование к хранению резервных копий, скажем, месяц или два, вы можете продолжить миграцию сейчас и отменить наполнение ресурсов StorSimple по истечении этого периода. Такой подход позволяет создавать столько журналов резервного копирования на стороне общей папки Azure, сколько необходимо. Для времени, в котором работают обе системы, применяется дополнительная плата, которая делает этот подход более предпочтительным, если вам требуется больше краткосрочного хранения резервных копий.

### <a name="map-your-existing-storsimple-volumes-to-azure-file-shares"></a>Сопоставьте существующие тома StorSimple с файловыми ресурсами Azure

[!INCLUDE [storage-files-migration-namespace-mapping](../../../includes/storage-files-migration-namespace-mapping.md)]

### <a name="number-of-storage-accounts"></a>Число учетных записей хранения

Скорее всего, миграция будет полезна при развертывании нескольких учетных записей хранения, которые содержат меньшее количество файловых ресурсов Azure.

Если общие файловые ресурсы являются высокоактивными (используются многими пользователями или приложениями), два файловых ресурса Azure могут достигнуть предельной производительности вашей учетной записи хранения. Поэтому рекомендуется выполнить миграцию на несколько учетных записей хранения, каждый из которых имеет собственные общие файловые ресурсы и обычно имеет не более двух или трех общих ресурсов на учетную запись хранения.

Рекомендуется развертывать учетные записи хранения с одним общим файловым ресурсом. Вы можете составить пул для нескольких файловых ресурсов Azure в одной учетной записи хранения, если в них есть архивные общие папки.

Эти рекомендации применяют больше возможностей к [прямому облачному доступу](#direct-share-access-vs-azure-file-sync) (через виртуальную машину или службу Azure), чем синхронизация файлов Azure. Если вы планируете использовать Синхронизация файлов Azure только в этих общих ресурсах, группировка нескольких записей в одну учетную запись хранения Azure вполне подойдет. Также учтите, что вы можете перенести приложение в облако, которое затем будет напрямую обращаться к общей папке. Или вы можете приступить к использованию службы в Azure, которая также будет полезна при наличии более высоких номеров операций ввода-вывода и пропускной способности.

Если вы сделали список общих папок, сопоставьте каждую общую папку с учетной записью хранения, где они будут размещаться.

> [!IMPORTANT]
> Выберите регион Azure и убедитесь, что каждая учетная запись хранения и Синхронизация файлов Azure ресурс соответствуют выбранному региону.

### <a name="phase-1-summary"></a>Сводка по этапу 1

В конце фазы 1:

* У вас есть хороший обзор устройств и томов StorSimple.
* Служба преобразования данных готова к доступу к томам StorSimple в облаке, так как вы получили ключ шифрования данных службы для каждого устройства StorSimple.
* У вас есть план, для которого необходимо выполнить миграцию томов, а также как сопоставлять тома с соответствующим количеством файловых ресурсов Azure и учетных записей хранения.

> [!CAUTION]
> Если необходимо перенести резервные копии с томов StorSimple, **здесь следует приостанавливаться**.
>
> Этот подход к миграции основан на новых возможностях службы преобразования данных, которые в настоящее время не могут перенести резервные копии. Поддержка миграции резервных копий будет поступать в конце 2020. Сейчас вы можете перенести только Интерактивные данные. Если начать работу сейчас, вы не сможете "заложить" резервные копии позже. Резервные копии должны быть воспроизведены в файловые ресурсы Azure от старых к новым для динамических данных, а моментальные снимки файловых ресурсов Azure — между.

Если вы хотите перенести только данные в реальном времени и не имеете никаких требований к резервному копированию, можно продолжить работу, следуя указаниям в этом разделе.

## <a name="phase-2-deploy-azure-storage-and-migration-resources"></a>Этап 2. Развертывание ресурсов службы хранилища Azure и переноса

В этом разделе рассматриваются вопросы развертывания различных типов ресурсов, необходимых в Azure. Некоторые будут содержать ваши данные после переноса, и некоторые из них потребуется только для миграции. Не приступите к развертыванию ресурсов до завершения плана развертывания. Иногда трудно, порой невозможно изменить некоторые аспекты ресурсов Azure после развертывания.

### <a name="deploy-storage-accounts"></a>Развертывание учетных записей хранения

Скорее всего, потребуется развернуть несколько учетных записей хранения Azure. Каждый из них будет содержать меньшее количество файловых ресурсов Azure, как в соответствии с планом развертывания, выполненного в предыдущем разделе этой статьи. Перейдите в портал Azure, чтобы [развернуть запланированные учетные записи хранения](../common/storage-account-create.md#create-a-storage-account). Рассмотрите возможность придерживаться следующих основных параметров для любой новой учетной записи хранения.

#### <a name="subscription"></a>Подписка

Вы можете использовать ту же подписку, которая использовалась для развертывания StorSimple, или другую. Единственное ограничение заключается в том, что подписка должна находиться в том же клиенте Azure Active Directory, что и подписка StorSimple. Перед началом миграции рассмотрите возможность перемещения подписки StorSimple в правильный клиент. Можно переместить только всю подписку. Отдельные ресурсы StorSimple нельзя переместить в другой клиент или подписку.

#### <a name="resource-group"></a>Группа ресурсов

Группы ресурсов помогают Организации ресурсов и разрешений управления администраторами. Узнайте больше о [группах ресурсов в Azure](../../azure-resource-manager/management/manage-resource-groups-portal.md#what-is-a-resource-group).

#### <a name="storage-account-name"></a>Имя учетной записи хранения

Имя вашей учетной записи хранения станет частью URL-адреса и имеет определенные ограничения по символам. В соглашении об именовании следует учитывать, что имена учетных записей хранения должны быть уникальными в мире, допускать только строчные буквы и цифры, требовать от 3 до 24 символов и не допускать специальных символов, таких как дефисы и символы подчеркивания. Дополнительные сведения см. в статье [правила именования ресурсов службы хранилища Azure](../../azure-resource-manager/management/resource-name-rules.md#microsoftstorage).

#### <a name="location"></a>Расположение

Расположение или регион Azure учетной записи хранения очень важен. Если вы используете Синхронизация файлов Azure, все учетные записи хранения должны находиться в том же регионе, что и ресурс службы синхронизации хранилища. Выбранная область Azure должна быть близкой или Центральной для локальных серверов и пользователей. После развертывания ресурса изменить его регион нельзя.

Вы можете выбрать другой регион, в котором находятся ваши данные StorSimple (учетная запись хранения).

> [!IMPORTANT]
> Если выбрать другой регион из текущего расположения учетной записи хранения StorSimple, плата за исходящий трафик [будет действовать](https://azure.microsoft.com/pricing/details/bandwidth) во время миграции. Данные не покидают регион StorSimple и не вводят новый регион учетной записи хранения. Если вы оставайтесь в одном регионе Azure, плата за пропускную способность не взимается.

#### <a name="performance"></a>Производительность

Вы можете выбрать хранилище класса Premium (SSD) для файловых ресурсов Azure или хранилища уровня "Стандартный". Хранилище уровня "Стандартный" включает [несколько уровней для файлового ресурса](storage-how-to-create-file-share.md#changing-the-tier-of-an-azure-file-share). Для большинства клиентов, выполняющих миграцию из StorSimple, подходит хранилище уровня "Стандартный".

По-прежнему не уверены?

* Выберите хранилище уровня "Премиум", если требуется [производительность файлового ресурса Azure](storage-files-planning.md#understanding-provisioning-for-premium-file-shares)уровня "Премиум".
* Выберите хранилище уровня "Стандартный" для рабочих нагрузок файлового сервера общего назначения, включая горячие данные и архивные данные. Также выберите хранилище уровня "Стандартный", если единственная рабочая нагрузка в общем ресурсе в облаке будет Синхронизация файлов Azure.

#### <a name="account-kind"></a>Тип учетной записи

* Для хранилища уровня "Стандартный *" выберите StorageV2 (общее назначение версии 2)*.
* Для файловых ресурсов уровня "Премиум" выберите *филестораже*.

#### <a name="replication"></a>Репликация

Доступно несколько параметров репликации. Дополнительные сведения о различных типах репликации.

Выбирайте можно только одним из следующих двух вариантов:

* *Локально избыточное хранилище (LRS)*.
* *Хранилище, избыточное в виде зоны (ZRS)* , недоступно во всех регионах Azure.

> [!NOTE]
> Только типы избыточности LRS и ZRS совместимы с большими файловыми ресурсами Azure 100-Тиб-Capacity.

Глобально избыточное хранилище (GRS) во всех вариантах в настоящее время не поддерживается. Вы можете переключить тип избыточности позже и перейти на GRS, когда она поступит в Azure.

#### <a name="enable-100-tib-capacity-file-shares"></a>Включить файловые ресурсы 100-Тиб-Capacity

:::row:::
    :::column:::
        :::image type="content" source="media/storage-files-how-to-create-large-file-share/large-file-shares-advanced-enable.png" alt-text="Изображение, показывающее вкладку &quot;Дополнительно&quot; в портал Azure для создания учетной записи хранения.":::
    :::column-end:::
    :::column:::
        В разделе **Дополнительно** мастера создания учетной записи хранения в портал Azure можно включить поддержку **больших файловых ресурсов** в этой учетной записи хранения. Если этот параметр недоступен, скорее всего, выбран неправильный тип избыточности. Убедитесь, что выбран параметр LRS или ZRS, чтобы он стал доступным.
    :::column-end:::
:::row-end:::

Включение больших файловых ресурсов размером 100 Тиб-емкости имеет несколько преимуществ:

* Производительность значительно увеличивается по сравнению с файловыми ресурсами объемом менее 5 Тиб (например, в 10 раз в секунду).
* Миграция будет завершена значительно быстрее.
* Вы гарантируете, что общая папка будет иметь достаточную емкость для хранения всех данных, которые будут перенесены в нее.
* Рассматривается будущее расширение.

### <a name="azure-file-shares"></a>Общие файловые ресурсы Azure

После создания учетных записей хранения перейдите в раздел **общей папки** учетной записи хранения и разверните соответствующее количество файловых ресурсов Azure в соответствии с планом миграции из фазы 1. Рассмотрите возможность соблюдения следующих основных настроек для новых файловых ресурсов в Azure.

:::row:::
    :::column:::
        :::image type="content" source="media/storage-files-migration-storsimple-8000/storage-files-migration-storsimple-8000-new-share.png" alt-text="Снимок экрана портал Azure, показывающий новый пользовательский интерфейс файлового ресурса.":::
    :::column-end:::
    :::column:::
        </br>**Имя**</br>Поддерживаются строчные буквы, цифры и дефисы.</br></br>**Квота**</br>Квота здесь сравнима с жесткой квотой SMB на экземпляре Windows Server. Не рекомендуется устанавливать квоту здесь, так как миграция и другие службы завершатся сбоем при достижении квоты.</br></br>**Уровни**</br>Выберите **транзакция, оптимизированная** для новой общей папки. Во время миграции возникнет много транзакций. Более экономично изменять свой уровень до уровня, который лучше всего подходит для вашей рабочей нагрузки.
    :::column-end:::
:::row-end:::

### <a name="storsimple-data-manager"></a>Диспетчер данных StorSimple

Ресурс Azure, в котором будут храниться задания миграции, называется **Диспетчер данных StorSimple**. Выберите **новый ресурс** и найдите его. Щелкните **Создать**.

Этот временный ресурс используется для оркестрации. После завершения миграции его можно отменить. Она должна быть развернута в той же подписке, группе ресурсов и регионе, что и учетная запись хранения StorSimple.

### <a name="azure-file-sync"></a>Синхронизация файлов Azure

С помощью Синхронизация файлов Azure можно добавить локальное кэширование наиболее часто используемых файлов. Подобно возможностям кэширования StorSimple, Синхронизация файлов Azure функция распределения облака обеспечивает задержку локального доступа в сочетании с улучшенным контролем доступной емкости кэша в экземпляре Windows Server и синхронизации нескольких сайтов. Если вы используете локальный кэш, то в локальной сети также поддерживаются Подготовка виртуальной машины Windows Server (физические серверы и отказоустойчивые кластеры) с достаточной емкостью хранилища с прямым подключением.

> [!IMPORTANT]
> Еще не настраиваете Синхронизация файлов Azure. Лучше настроить Синхронизация файлов Azure после завершения миграции общего ресурса. Развертывание Синхронизация файлов Azure не должно начинаться до фазы 4 миграции.

### <a name="phase-2-summary"></a>Сводка по этапу 2

В конце фазы 2 вы развернете учетные записи хранения и все файловые ресурсы Azure в них. У вас также будет ресурс Диспетчер данных StorSimple. При настройке заданий миграции вы будете использовать последнюю из этапов этапа 3.

## <a name="phase-3-create-and-run-a-migration-job"></a>Этап 3. Создание и запуск задания миграции

В этом разделе описывается, как настроить задание миграции и тщательно сопоставлять каталоги на томе StorSimple, который должен быть скопирован в выбранную целевую общую папку Azure. Чтобы приступить к работе, перейдите к Диспетчер данных StorSimple, найдите **определения заданий** в меню и выберите **+ Определение задания**. Целевой тип хранилища — это **файловый ресурс Azure** по умолчанию.

![Типы заданий миграции серии StorSimple 8000.](media/storage-files-migration-storsimple-8000/storage-files-migration-storsimple-8000-new-job-type.png "Снимок экрана определений заданий портал Azure с открытым диалоговым окном определения задания, которое запрашивает тип задания: копирование в общую папку или в контейнер больших двоичных объектов.")

> [!IMPORTANT]
> Перед выполнением любого задания миграции завершите автоматическое запланированное резервное копирование томов StorSimple.

:::row:::
    :::column:::
        ![Задание миграции для серии StorSimple 8000.](media/storage-files-migration-storsimple-8000/storage-files-migration-storsimple-8000-new-job.png "Снимок экрана формы создания нового задания для задания службы преобразования данных.")
    :::column-end:::
    :::column:::
        **Имя определения задания**</br>Это имя должно указывать на набор перемещаемых файлов. Рекомендуется дать ему такое же имя, как общая папка Azure. </br></br>**Расположение, в котором выполняется задание**</br>При выборе региона необходимо выбрать тот же регион, что и учетная запись хранения StorSimple, или, если он недоступен, регион находится рядом с ним. </br></br><h3>Источник</h3>**Исходная подписка**</br>Выберите подписку, в которой будет храниться ресурс StorSimple Device Manager. </br></br>**Ресурс StorSimple**</br>Выберите StorSimple Device Manager ваше устройство зарегистрировано в. </br></br>**Ключ шифрования данных службы**</br>Обратитесь к [предыдущему разделу этой статьи](#storsimple-service-data-encryption-key) , если вы не можете определить ключ в записях. </br></br>**Устройство**</br>Выберите устройство StorSimple, содержащее том, на котором требуется выполнить миграцию. </br></br>**Том**</br>Выберите исходный том. Позже вы решите, хотите ли вы перенести весь том или подкаталоги в целевую общую папку Azure. </br></br><h3>целевого объекта</h3>Выберите подписку, учетную запись хранения и файловый ресурс Azure в качестве целевого объекта для этого задания миграции.
    :::column-end:::
:::row-end:::

> [!IMPORTANT]
> Для выполнения миграции будет использоваться последняя резервная копия тома. Убедитесь, что имеется хотя бы одна резервная копия тома, или задание завершится ошибкой. Кроме того, убедитесь, что последняя резервная копия находится в недавнем объеме, чтобы максимально сократить общую папку. *Перед* запуском только что созданного задания можно вручную активировать и завершить создание другого тома.

### <a name="directory-mapping"></a>Сопоставление каталогов

Сопоставление каталогов является необязательным для задания миграции. Если оставить раздел пустым, *все* файлы и папки в корне тома StorSimple будут перемещены в корневую папку целевого файлового ресурса Azure. В большинстве случаев хранение содержимого всего тома в общем файловом ресурсе Azure не является лучшим подходом. Часто лучше разделить содержимое тома по нескольким файловым ресурсам в Azure. Если вы еще не сделали план, см. статью предварительное [Отображение тома StorSimple в файловые ресурсы Azure](#map-your-existing-storsimple-volumes-to-azure-file-shares) .

В рамках плана миграции, возможно, вы решили, что папки на томе StorSimple должны быть разделены на несколько файловых ресурсов Azure. Если это так, можно выполнить разделение, выполнив следующие действия.

1. Определение нескольких заданий для переноса папок на одном томе. У каждого из них будет один и тот же источник томов StorSimple, но другой файловый ресурс Azure в качестве целевого объекта.
1. Указание точного способа переноса папок из тома StorSimple в указанную общую папку с помощью раздела **сопоставление каталогов** в форме создания задания и следующей [семантики сопоставления](#semantic-elements).

> [!IMPORTANT]
> Невозможно проверить пути и выражения сопоставления в этой форме при отправке формы. Если сопоставления указаны неправильно, задание может либо завершиться неудачно, либо получить нежелательный результат. В этом случае лучше всего удалить файловый ресурс Azure, создать его повторно, а затем исправить операторы сопоставления в новом задании миграции для общей папки. Выполнение нового задания с фиксированными инструкциями сопоставления может исправить пропущенные папки и перенести их в существующую общую папку. Однако таким способом можно решить только те папки, которые были пропущены из-за неправильного написания пути.

#### <a name="semantic-elements"></a>Семантические элементы

Сопоставление выражается слева направо: [путь \саурце] \> [путь \таржет].

|Семантический символ          | Значение  |
|:---------------------------|:---------|
| **\\**                     | Индикатор корневого уровня.       |
| **\>**                     | [Source] и [оператор сопоставления целевого объекта.     |
|**\|** или RETURN (Новая строка) | Разделитель двух инструкций по сопоставлению папок. </br>Кроме того, этот символ можно опустить и нажать клавишу **Ввод** , чтобы получить следующее выражение сопоставления в отдельной строке.        |

### <a name="examples"></a>Примеры
Перемещает содержимое *данных пользователя* папки в корневую папку целевого файлового ресурса:
``` console
\User data > \\
```
Перемещает содержимое всего тома в новый путь на целевом общем файловом ресурсе:
``` console
\ \> \Apps\HR tracker
```
Перемещает содержимое исходной папки в новый путь на целевом общем файловом ресурсе:
``` console
\HR resumes-Backup \> \Backups\HR\resumes
```
Сортирует несколько исходных расположений в новой структуре каталогов:
``` console
\HR\Candidate Tracker\v1.0 > \Apps\Candidate tracker
\HR\Candidates\Resumes > \HR\Candidates\New
\Archive\HR\Old Resumes > \HR\Candidates\Archived
```

### <a name="semantic-rules"></a>Семантические правила

* Всегда указывайте пути к папкам относительно корневого уровня.
* Начните каждый путь к папке с помощью индикатора корневого уровня \" .
* Не включайте буквы дисков.
* При указании нескольких путей исходный или конечный путь не может перекрываться:</br>
   Недопустимый пример перекрытия исходного пути:</br>
    *\\Папка > folder\1 \\*</br>
    *\\папка \\ 1 \\ 2 > \\ folder2*</br>
   Недопустимый пример перекрытия целевого пути:</br>
   *\\> папки \\*</br>
   *\\Folder2 > \\*</br>
* Исходные папки, которые не существуют, будут игнорироваться.
* Будут созданы структуры папок, не существующие в целевом объекте.
* Как и в случае с Windows, имена папок не чувствительны к регистру, но сохраняют регистр.

> [!NOTE]
> Содержимое папки *\System Volume Information* и *$Recycle. bin* на томе StorSimple не будет скопировано заданием преобразования.

### <a name="phase-3-summary"></a>Сводка по этапу 3

В конце фазы 3 вы запустили задания службы преобразования данных из томов StorSimple в файловые ресурсы Azure. Теперь вы можете сосредоточиться на настройке Синхронизация файлов Azure для общего ресурса (после завершения заданий миграции для общего ресурса) или в направлении общего доступа для информационных работников и приложений к общему файловому ресурсу Azure.

## <a name="phase-4-access-your-azure-file-shares"></a>Этап 4. доступ к файловым ресурсам Azure

Есть две основные стратегии доступа к файловым ресурсам Azure:

* **Синхронизация файлов Azure** : [развертывание синхронизация файлов Azure](#deploy-azure-file-sync) в локальном экземпляре Windows Server. Синхронизация файлов Azure обладает всеми преимуществами локального кэша, как StorSimple.
* **Прямой-общий доступ** : [развертывание прямого доступа к общему ресурсу](#deploy-direct-share-access). Используйте эту стратегию, если ваш сценарий доступа к общей папке Azure не будет полезен при локальном кэшировании или у вас больше нет возможности разместить локальный экземпляр Windows Server. Здесь пользователи и приложения продолжат получать доступ к общим ресурсам SMB по протоколу SMB. Эти общие ресурсы больше не находятся на локальном сервере, а непосредственно в облаке.

Вы уже решили, какой вариант лучше подходит для вас на [этапе 1](#phase-1-prepare-for-migration) этого руководством.

Оставшаяся часть этого раздела посвящена инструкциям по развертыванию.

### <a name="deploy-azure-file-sync"></a>Развертывание Синхронизации файлов Azure

Пора развернуть часть Синхронизация файлов Azure.

1. Создайте Синхронизация файлов Azure облачный ресурс.
1. Разверните агент Синхронизация файлов Azure на локальном сервере.
1. Зарегистрируйте сервер в облачном ресурсе.

Пока не создавайте группы синхронизации. Настройка синхронизации с файловым ресурсом Azure должна выполняться только после завершения заданий миграции в общую папку Azure. Если вы начали использовать Синхронизация файлов Azure до завершения миграции, это сделает миграцию ненужной, так как вы не смогли понять, когда пришло время начать вырезание.

#### <a name="deploy-the-azure-file-sync-cloud-resource"></a>Развертывание облачного ресурса Синхронизация файлов Azure

[!INCLUDE [storage-files-migration-deploy-afs-sss](../../../includes/storage-files-migration-deploy-azure-file-sync-storage-sync-service.md)]

> [!TIP]
> Если вы хотите изменить регион Azure, в котором хранятся данные, после завершения миграции, разверните службу синхронизации хранилища в том же регионе, что и целевые учетные записи хранения для этой миграции.

#### <a name="deploy-an-on-premises-windows-server-instance"></a>Развертывание локального экземпляра Windows Server

* Создайте Windows Server 2019 (как минимум 2012 R2) в качестве виртуальной машины или физического сервера. Также поддерживается отказоустойчивый кластер Windows Server. Не используйте сервер, который находится на передней панели StorSimple 8100 или 8600.
* Подготавливайте или добавляйте непосредственно подключенное хранилище. Хранилище, подключенное к сети, не поддерживается.

Рекомендуется присвоить новому экземпляру Windows Server значение, превышающее объем хранилища, которое локально доступно для кэширования на устройстве StorSimple 8100 или 8600. Экземпляр Windows Server используется точно так же, как и устройство StorSimple. При наличии того же объема хранилища, что и устройство, процесс кэширования должен быть похожим, если это не так. Вы можете добавить или удалить хранилище из экземпляра Windows Server в. Эта возможность позволяет масштабировать локальный размер тома и объем локального хранилища, доступного для кэширования.

#### <a name="prepare-the-windows-server-instance-for-file-sync"></a>Подготовка экземпляра Windows Server к синхронизации файлов

[!INCLUDE [storage-files-migration-deploy-afs-agent](../../../includes/storage-files-migration-deploy-azure-file-sync-agent.md)]

#### <a name="configure-azure-file-sync-on-the-windows-server-instance"></a>Настройка Синхронизация файлов Azure в экземпляре Windows Server

Зарегистрированный локальный экземпляр Windows Server должен быть готов к работе и подключен к Интернету для этого процесса.

> [!IMPORTANT]
> Прежде чем продолжать, необходимо завершить миграцию файлов и папок StorSimple в файловый ресурс Azure. Убедитесь, что в общую папку не внесены изменения.

[!INCLUDE [storage-files-migration-configure-sync](../../../includes/storage-files-migration-configure-sync.md)]

> [!IMPORTANT]
> Не забудьте включить распределение по уровням облака. Распределение по уровням облака — это Синхронизация файлов Azure функция, которая позволяет локальному серверу иметь меньше ресурсов хранилища, чем хранится в облаке, но имеет доступ к полному пространству имен. Локально интересные данные также кэшируются локально для быстрой и локальной производительности доступа. Другой причиной включения уровня облака в этом шаге является то, что мы не хотим синхронизировать содержимое файлов на этом этапе. В настоящее время необходимо переместить только пространство имен.

### <a name="deploy-direct-share-access"></a>Развертывание прямого доступа к общему ресурсу

:::row:::
    :::column:::
        [![Пошаговое руководство и демонстрационные материалы по безопасному предоставлению файловых ресурсов Azure непосредственно в информационные работники и приложения — щелкните для воспроизведения!](./media/storage-files-migration-storsimple-8000/azure-files-direct-access-video-placeholder.png)](https://youtu.be/KG0OX0RgytI)
    :::column-end:::
    :::column:::
        Это видео представляет собой руководство и демонстрацию того, как безопасно предоставлять файловые ресурсы Azure непосредственно информационным работникам и приложениям за пять простых шагов.</br>
        В этом видеоролике содержатся ссылки на отдельную документацию по следующим темам:

* [Общие сведения об удостоверениях](storage-files-active-directory-overview.md)
* [Присоединение к домену в учетной записи хранения](storage-files-identity-auth-active-directory-enable.md)
* [Обзор сетей для файловых ресурсов Azure](storage-files-networking-overview.md)
* [Настройка общедоступных и частных конечных точек](storage-files-networking-endpoints.md)
* [Настройка VPN типа S2S](storage-files-configure-s2s-vpn.md)
* [Настройка VPN-подключения Windows P2S](storage-files-configure-p2s-vpn-windows.md)
* [Как настроить VPN-подключение P2S для Linux](storage-files-configure-p2s-vpn-linux.md)
* [Настройка пересылки DNS](storage-files-networking-dns.md)
* [Настройка DFS-N](https://aka.ms/AzureFiles/Namespaces)
   :::column-end:::
:::row-end:::

### <a name="phase-4-summary"></a>Сводка по этапу 4

На этом этапе вы создали и запустили несколько заданий службы преобразования данных в Диспетчер данных StorSimple. Эти задания перенесли файлы и папки в файловые ресурсы Azure. Вы также развернули Синхронизация файлов Azure или подготовили учетные записи сети и хранения для прямого доступа к общим ресурсам.

## <a name="phase-5-user-cut-over"></a>Этап 5. Вырезание пользователя

На этом этапе вы все равно собираетесь создать перенос:

* Планируйте время простоя.
* Изменяйте любые изменения, внесенные пользователями и приложениями, созданные на стороне StorSimple, пока выполняются задания преобразования данных на этапе 3.
* Завершите работу пользователей с новым экземпляром Windows Server, используя Синхронизация файлов Azure или файловые ресурсы Azure через прямой доступ к общему ресурсу.

### <a name="plan-your-downtime"></a>Планирование времени простоя

Этот подход к миграции требует некоторого времени простоя для пользователей и приложений. Цель — сократить время простоя до минимума. Следующие рекомендации могут помочь:

* Обеспечьте доступ к томам StorSimple во время выполнения заданий преобразования данных.
* Завершив выполнение заданий переноса данных для общего ресурса, можно удалить доступ пользователей (по крайней мере, доступ на запись) из томов или общих папок StorSimple. Окончательный файл Robocopy будет перехватывать общую папку Azure. Затем вы можете вырезать пользователей. Место запуска средства Robocopy зависит от того, выбрано ли использование Синхронизация файлов Azure или прямой доступ к общему ресурсу. В разделе, посвященном Robocopy, рассматривается эта тема.
* После того как средство Robocopy будет выполнено, вы сможете предоставить пользователям доступ к новому расположению в общем файловом ресурсе Azure или в общем ресурсе SMB на экземпляре Windows Server с Синхронизация файлов Azure. Зачастую развертывание DFS-N поможет быстро и эффективно выполнить быструю и эффективную работу. Она обеспечит целостность существующих общих адресов и переуказывает на новое расположение, в котором содержатся перенесенные файлы и папки.

### <a name="determine-when-your-namespace-has-fully-synced-to-your-server"></a>Определение полной синхронизации пространства имен с сервером

При использовании Синхронизация файлов Azure для файлового ресурса Azure важно определить, что полное пространство имен завершило загрузку на сервер, *прежде чем* запускать локальный Robocopy. Время, затрачиваемое на загрузку пространства имен, зависит от числа элементов в файловом ресурсе Azure. Существует два метода определения, было ли пространство имен полностью получено на сервере.

#### <a name="azure-portal"></a>Портал Azure

Вы можете использовать портал Azure, чтобы увидеть, когда пространство имен будет полностью получено.

* Войдите в портал Azure и перейдите в группу синхронизации. Проверьте состояние синхронизации группы синхронизации и конечной точки сервера.
* Будет скачано интересное направление. Если конечная точка сервера была подготовлена заново, будет показана **начальная синхронизация** , которая указывает, что пространство имен по-прежнему остается в списке.
После внесения изменений в все, но **начальную синхронизацию** пространство имен будет полностью заполнено на сервере. Теперь можно продолжить локальный Robocopy.

#### <a name="windows-server-event-viewer"></a>Просмотр событий Windows Server

Можно также использовать Просмотр событий в экземпляре Windows Server, чтобы определить, когда пространство имен будет полностью получено.

1. Откройте **Просмотр событий** и перейдите в раздел " **приложения и службы** ".
1. Перейдите на страницу и откройте **микрософт\филесинк\ажент\телеметри**.
1. Найдите Последнее **событие 9102** , соответствующее завершенному сеансу синхронизации.
1. Выберите **сведения** и убедитесь, что вы ищете событие, в котором **загружается** значение **синкдиректион** .
1. Для того времени, когда пространство имен завершило загрузку на сервер, будет существовать одно событие с **сценарием** , значение **фуллгхостедсинк** и **HRESULT**  =  **0**.
1. Если пропустить это событие, можно также найти другие **события 9102** с **синкдиректион**  =  **download** и **сценарий**  =  **«регуларсинк»**. При поиске одного из этих событий также указывается, что загрузка и синхронизация пространства имен завершились с обычными сеансами синхронизации, независимо от того, есть ли в данный момент синхронизация или нет.

### <a name="a-final-robocopy"></a>Окончательный элемент Robocopy

На этом этапе существуют различия между локальным экземпляром Windows Server и устройством StorSimple 8100 или 8600.

1. Необходимо отследить изменения, которые пользователи или приложения создавались на стороне StorSimple во время миграции.
1. В случаях, когда вы используете Синхронизация файлов Azure: устройство StorSimple имеет заполненный кэш и экземпляр Windows Server с пространством имен, в настоящее время не хранящееся в локальном режиме содержимого файлов. Окончательное средство Robocopy может помочь в переходе к локальному кэшу Синхронизация файлов Azure, изменив содержимое локально кэшированного файла так, как доступно и может уместиться на сервере Синхронизация файлов Azure.
1. Некоторые файлы могли остаться за пределами задания преобразования данных из-за недопустимых символов. Если да, скопируйте их в экземпляр Windows Server с поддержкой Синхронизация файлов Azure. Позже их можно будет настроить так, чтобы они синхронизировались. Если вы не используете Синхронизация файлов Azure для конкретной общей папки, лучше переименование файлов с недопустимыми символами на томе StorSimple. Затем запустите Robocopy непосредственно в общем файловом ресурсе Azure.

> [!WARNING]
> *Не следует* запускать Robocopy, прежде чем на сервере будет полностью загружено пространство имен для файлового ресурса Azure. Дополнительные сведения см. [в разделе Определение момента полной загрузки пространства имен на сервер](#determine-when-your-namespace-has-fully-synced-to-your-server).

 Вы хотите скопировать только те файлы, которые были изменены после последнего запуска задания миграции, и файлы, которые еще не были перемещены через эти задания. Вы можете решить проблему, почему они не были перемещены позже на сервере после завершения миграции. Дополнительные сведения см. в разделе [Синхронизация файлов Azure устранение неполадок](storage-sync-files-troubleshoot.md#how-do-i-see-if-there-are-specific-files-or-folders-that-are-not-syncing).

Robocopy имеет несколько параметров. В следующем примере демонстрируется законченная команда и список причин для выбора этих параметров.

```console
Robocopy /MT:16 /UNILOG:<file name> /TEE /B /MIR /COPYALL /DCOPY:DAT <SourcePath> <Dest.Path>
```

Фон:

:::row:::
   :::column span="1":::
      /MT
   :::column-end:::
   :::column span="1":::
      Позволяет использовать средство Robocopy для работы с многопоточными потоками. Значение по умолчанию — 8, а максимальное — 128.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /УНИЛОГ:<file name>
   :::column-end:::
   :::column span="1":::
      Выводит состояние в файл журнала как Юникод (перезаписывает существующий журнал).
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /ти
   :::column-end:::
   :::column span="1":::
      Вывод в окно консоли. Используется в сочетании с выходными данными в файл журнала.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /B
   :::column-end:::
   :::column span="1":::
      Запускает Robocopy в том же режиме, что и приложение резервного копирования. Она позволяет Robocopy перемещать файлы, к которым у текущего пользователя нет разрешений.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /мир
   :::column-end:::
   :::column span="1":::
      Позволяет Robocopy расдумать только о различиях между источником (устройством StorSimple) и целевым объектом (каталог Windows Server).
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /COPY: копифлаг [s]
   :::column-end:::
   :::column span="1":::
      Точность копирования файлов (по умолчанию —/COPY: DAT), флаги копирования: D = данные, A = атрибуты, T = метки времени, S = безопасность = NTFS ACL, O = сведения о владельце, U = данные аудита.
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /копялл
   :::column-end:::
   :::column span="1":::
      СКОПИРУЙТЕ все сведения о файле (эквивалентно/COPY: ДАТСАУ).
   :::column-end:::
:::row-end:::
:::row:::
   :::column span="1":::
      /ДКОПИ: копифлаг [s]
   :::column-end:::
   :::column span="1":::
      Точность для копии каталогов (по умолчанию/ДКОПИ: DA), флаги копирования: D = данные, A = Attributes, T = метки времени.
   :::column-end:::
:::row-end:::

При настройке исходного и целевого расположения команды Robocopy убедитесь, что вы просматриваете структуру источника и целевого объекта, чтобы убедиться, что они совпадают. Если вы использовали функцию сопоставления каталогов в задании миграции, структура корневого каталога может отличаться от структуры тома StorSimple. В этом случае может потребоваться несколько заданий Robocopy, по одному для каждого подкаталога.

Эта команда Robocopy использует/мир, поэтому она не перемещает файлы, которые одинаковы (например, многоуровневые файлы). Но если вы получаете неправильный исходный и целевой путь,/мир также удаляет структуры каталогов в экземпляре Windows Server или в общей папке Azure, которые отсутствуют в пути к источнику StorSimple. Они должны точно совпадать с тем, чтобы задание Robocopy достигло предполагаемой цели обновления перенесенного содержимого с учетом последних изменений, внесенных во время миграции.

Просмотрите файл журнала Robocopy, чтобы узнать, остались ли файлы. Если проблемы существуют, исправьте их и повторно запустите команду Robocopy. Не отменяйте ресурсы StorSimple, прежде чем устранять нерешенные проблемы с файлами и папками, которые вам интересуют.

Если вы не используете Синхронизация файлов Azure для кэширования конкретной общей папки Azure, а вместо этого направите прямой доступ к общему ресурсу:

1. [Подключите файловый ресурс Azure](storage-how-to-use-files-windows.md#mount-the-azure-file-share) как сетевой диск к локальному компьютеру Windows.
1. Выполните Robocopy между StorSimple и подключенным файловым ресурсом Azure. Если файлы не копируются, исправьте их имена на стороне StorSimple, чтобы удалить недопустимые символы. Затем повторите попытку Robocopy. Ранее указанная команда Robocopy может выполняться несколько раз, не вызывая ненужного отзыва в StorSimple.

### <a name="user-cut-over"></a>Вырезание пользователя

Если вы используете Синхронизация файлов Azure, скорее всего, потребуется создать общие ресурсы SMB на этом экземпляре Windows Server с поддержкой Синхронизация файлов Azure, который соответствует общим папкам на томах StorSimple. Вы можете загрузить этот шаг и сделать его более ранним, чтобы не потерять время. Но необходимо убедиться, что до этого момента никто не имеет доступа к возникновению изменений в экземпляре Windows Server.

При наличии развертывания DFS-N можно указать DFN-Namespaces для новых расположений папок сервера. Если у вас нет развертывания DFS-N и вы построили устройство 8100 или 8600 локально с помощью экземпляра Windows Server, вы можете отключить этот сервер от домена. Затем присоедините новый экземпляр Windows Server с поддержкой Синхронизация файлов Azure. Во время этого процесса присвойте серверу одно и то же имя сервера и общие имена в качестве старого сервера, чтобы вырезание не оставалось прозрачным для пользователей, групповых политик и сценариев.

Дополнительные сведения о [DFS-N](https://aka.ms/AzureFiles/Namespaces).

## <a name="deprovision"></a>Отзыв

При отмене наполнения ресурса вы теряете доступ к конфигурации этого ресурса и его данным. Отмена инициализации не может быть отменена. Не продолжайте, пока не подтвердите, что:

* Миграция завершена.
* Нет никакой зависимости от файлов StorSimple, папок или резервных копий томов, которые вы собираетесь отменить.

Прежде чем приступать к работе, рекомендуется отслеживать новое развертывание Синхронизация файлов Azure в рабочей среде в течение определенного момента. Это время позволяет устранять возникающие проблемы. После развертывания Синхронизация файлов Azure в течение нескольких дней можно приступить к отмене подготовки ресурсов в следующем порядке:

1. Отмените наполнение ресурса Диспетчер данных StorSimple с помощью портал Azure. Все задания служб DTS будут удалены вместе с ним. Вы не сможете легко получить журналы копирования. Если они важны для ваших записей, извлеките их перед отменой подготовки.
1. Убедитесь, что физические устройства StorSimple были перенесены, а затем отмените их регистрацию. Если вы не уверены, что они были перенесены, не продолжайте. Если вы отмените предоставление этих ресурсов, пока они все еще нужны, вы не сможете восстановить данные или их конфигурацию.
1. Если в Device Manager StorSimple не осталось больше зарегистрированных устройств, можно приступить к удалению самого Device Manager ресурса.
1. Теперь пришло время удалить учетную запись хранения StorSimple в Azure. Опять же, убедитесь, что миграция завершена, и что никакие данные не зависят от этих данных, прежде чем продолжать.
1. Отсоедините физическое устройство StorSimple от центра обработки данных.
1. Если вы владеете устройством StorSimple, вы можете перезапустить его с компьютера. Если устройство арендовано, проинформируйте Лессор и верните устройство соответствующим образом.

Миграция завершена.

> [!NOTE]
> У вас по-прежнему есть вопросы или возникли проблемы?</br>
> Мы здесь можем помочь AzureFilesMigration@microsoft.com .

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте больше о [Синхронизация файлов Azure: AKA.MS/AFS](https://aka.ms/AFS).
* Общие сведения о гибкости политик распределения по [уровням облака](storage-sync-cloud-tiering.md) .
* [Включите Azure Backup](../../backup/backup-afs.md#configure-backup-from-the-file-share-pane) в файловых ресурсах Azure, чтобы запланировать моментальные снимки и определить расписания хранения резервных копий.
* Если вы видите в портал Azure, что некоторые файлы постоянно не синхронизируются, просмотрите инструкции по [устранению неполадок](storage-sync-files-troubleshoot.md) , чтобы устранить эти проблемы.
