---
title: Модель контроля доступа для Azure Data Lake Storage 2-го поколения | Документация Майкрософт
description: Узнайте, как настроить доступ к контейнеру, каталогу и файлу на уровне файлов в учетных записях, имеющих иерархическое пространство имен.
author: normesta
ms.subservice: data-lake-storage-gen2
ms.service: storage
ms.topic: conceptual
ms.date: 11/10/2020
ms.author: normesta
ms.openlocfilehash: 3ddcbe57112251a428e11d6c164cdb1224553f98
ms.sourcegitcommit: cd9754373576d6767c06baccfd500ae88ea733e4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2020
ms.locfileid: "94959209"
---
# <a name="access-control-model-in-azure-data-lake-storage-gen2"></a>Модель контроля доступа в Azure Data Lake Storage 2-го поколения

Data Lake Storage 2-го поколения поддерживает следующие механизмы авторизации:

- Авторизация общего ключа
- Авторизация подписанного URL-доступа (SAS)
- Управление доступом на основе ролей (Azure RBAC)
- Списки управления доступом (ACL)

[Общий ключ и авторизация SAS](#shared-key-and-shared-access-signature-sas-authorization) предоставляют доступ пользователю (или приложению), не требуя от них удостоверения в Azure Active Directory (Azure AD). Эти две формы проверки подлинности не влияют на Azure RBAC и ACL.

Для Azure RBAC и ACL требуется, чтобы пользователь (или приложение) имел удостоверение в Azure AD.  Azure RBAC позволяет предоставлять «грубый» доступ к данным учетной записи хранения, таким как доступ на чтение или запись ко **всем** данным в учетной записи хранения, тогда как списки управления доступом позволяют предоставить «детализированный доступ», например доступ на запись к определенному каталогу или файлу.  

Эта статья посвящена Azure RBAC и ACL, а также тому, как система анализирует их вместе, чтобы принимать решения об авторизации для ресурсов учетной записи хранения.

<a id="role-based-access-control"></a>

## <a name="role-based-access-control-azure-rbac"></a>Управление доступом на основе ролей (Azure RBAC)

Azure RBAC использует назначения ролей для применения наборов разрешений к [субъектам безопасности](https://docs.microsoft.com/azure/role-based-access-control/overview#security-principal). Участник безопасности — это объект, представляющий пользователя, группу, субъект-службу или управляемое удостоверение, определенное в Azure Active Directory (AD). Набор разрешений может предоставить субъекту безопасности уровень грубой детализации, такой как доступ на чтение или запись для **всех** данных в учетной записи хранения или **всех** данных в контейнере. 

Следующие роли позволяют субъекту безопасности получать доступ к данным в учетной записи хранения. 

|Роль|Описание|
|--|--|
| [владелец данных BLOB-объектов хранилища](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#storage-blob-data-owner); | Полный доступ к контейнерам и данным хранилища BLOB-объектов. Этот доступ позволяет субъекту безопасности задать владельца элемента и изменить списки управления доступом для всех элементов. |
| [участник данных BLOB-объектов хранилища](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#storage-blob-data-owner); | Доступ на чтение, запись и удаление контейнеров хранилища BLOB-объектов и больших двоичных объектов. Этот доступ не позволяет субъекту безопасности задать владение элементом, но он может изменить список управления доступом для элементов, принадлежащих субъекту безопасности. |
| [читатель данных больших двоичных объектов хранилища](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#storage-blob-data-reader). | Чтение и перечисление контейнеров хранилища BLOB-объектов и больших двоичных объектов. |

Роли, такие как [владелец](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#owner), [участник](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#contributor), [читатель](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#reader)и [участник учетной записи хранения](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#storage-account-contributor) , позволяют субъекту безопасности управлять учетной записью хранения, но не предоставляют доступ к данным в этой учетной записи. Однако эти роли (за исключением **читателя**) могут получить доступ к ключам хранилища, которые можно использовать в различных клиентских средствах для доступа к данным.

## <a name="access-control-lists-acls"></a>Списки управления доступом (ACL)

Списки управления доступом позволяют применять уровень доступа к каталогам и файлам с более тонкими возможностями. *Список управления доступом* представляет собой конструкцию разрешений, содержащую ряд *записей ACL*. Каждая запись ACL связывает субъект безопасности с уровнем доступа.  Дополнительные сведения см. [в разделе списки управления доступом (ACL) в Azure Data Lake Storage 2-го поколения](data-lake-storage-access-control.md).

## <a name="how-permissions-are-evaluated"></a>Как оцениваются разрешения

Во время авторизации на основе субъекта безопасности разрешения оцениваются в следующем порядке.

: один: &nbsp; &nbsp; назначения ролей Azure оцениваются первыми и имеют приоритет над любыми назначениями ACL.

: два: &nbsp; &nbsp; Если операция полностью проверена на основе назначения ролей Azure, списки ACL не оцениваются.

: три: &nbsp; &nbsp; Если операция не является полностью авторизации, вычисляются списки ACL.

> [!div class="mx-imgBorder"]
> ![поток разрешений для хранилища Data Lake](./media/control-access-permissions-data-lake-storage/data-lake-storage-permissions-flow.png)

Так как разрешения на доступ оцениваются системой, вы **не можете** использовать ACL для **ограничения** доступа, уже предоставленного назначением роли. Это связано с тем, что система сначала оценивает назначения ролей Azure, и если назначение предоставляет достаточные права доступа, ACL игнорируются. 

На следующей схеме показан поток разрешений для трех распространенных операций: листинг содержимого каталога, чтение файла и запись файла.

> [!div class="mx-imgBorder"]
> ![Пример потока разрешений для хранилища Data Lake](./media/control-access-permissions-data-lake-storage/data-lake-storage-permissions-example.png)

## <a name="permissions-table-combining-azure-rbac-and-acl"></a>Таблица разрешений: объединение RBAC и ACL Azure

В следующей таблице показано, как объединить роли Azure и записи ACL, чтобы субъект безопасности мог выполнять операции, перечисленные в столбце **Операция** . В этой таблице показан столбец, представляющий каждый уровень вымышленной иерархии каталогов. Существует столбец для корневого каталога контейнера ( `/` ), подкаталог с именем « **Орегон**», вложенный каталог в каталоге «Орегон» и текстовый файл в каталоге **Portland**«Портленде» с именем **Data.txt**. Отображение в этих столбцах является [коротким](data-lake-storage-access-control.md#short-forms-for-permissions) представлением записи ACL, необходимой для предоставления разрешений. Если для выполнения операции не требуется запись ACL, в столбце **появляется значение недоступно (** _неприменимо_).

|    Операция             | Назначенная роль RBAC               |    /        | Каталог Oregon/     | Portland/ | Data.txt |             
|--------------------------|----------------------------------|-------------|-------------|-----------|----------|
| Чтение файла Data.txt            |   Владелец данных BLOB-объектов хранилища        | Н/Д      | Н/Д      | Н/Д       | Н/Д    |  
|                          |   Участник данных BLOB-объектов хранилища  | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Читатель данных больших двоичных объектов хранилища       | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Отсутствуют                           | `--X`    | `--X`    | `--X`     | `R--`  |
| Добавление в файл Data.txt       |   Владелец данных BLOB-объектов хранилища        | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Участник данных BLOB-объектов хранилища  | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Читатель данных больших двоичных объектов хранилища       | `--X`    | `--X`    | `--X`     | `-W-`  |
|                          |   Нет                           | `--X`    | `--X`    | `--X`     | `RW-`  |
| Удаление файла Data.txt          |   Владелец данных BLOB-объектов хранилища        | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Участник данных BLOB-объектов хранилища  | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Читатель данных больших двоичных объектов хранилища       | `--X`    | `--X`    | `-WX`     | Н/Д    |
|                          |   Отсутствуют                           | `--X`    | `--X`    | `-WX`     | Н/Д    |
| Создание файла Data.txt          |   Владелец данных BLOB-объектов хранилища        | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Участник данных BLOB-объектов хранилища  | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Читатель данных больших двоичных объектов хранилища       | `--X`    | `--X`    | `-WX`     | Н/Д    |
|                          |   Отсутствуют                           | `--X`    | `--X`    | `-WX`     | Н/Д    |
| Перечисление /                   |   Владелец данных BLOB-объектов хранилища        | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Участник данных BLOB-объектов хранилища  | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Читатель данных больших двоичных объектов хранилища       | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Отсутствуют                           | `R-X`    | Н/Д      | Н/Д       | Н/Д    |
| Перечисление для каталога /Oregon/            |   Владелец данных BLOB-объектов хранилища        | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Участник данных BLOB-объектов хранилища  | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Читатель данных больших двоичных объектов хранилища       | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Отсутствуют                           | `--X`    | `R-X`    | Н/Д       | Н/Д    |
| Перечисление для каталога /Oregon/Portland/   |   Владелец данных BLOB-объектов хранилища        | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Участник данных BLOB-объектов хранилища  | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Читатель данных больших двоичных объектов хранилища       | Н/Д      | Н/Д      | Н/Д       | Н/Д    |
|                          |   Отсутствуют                           | `--X`    | `--X`    | `R-X`     | Н/Д    |


> [!NOTE] 
> Чтобы просмотреть содержимое контейнера в Обозреватель службы хранилища Azure, субъекты безопасности должны [войти в обозреватель службы хранилища с помощью Azure AD](https://docs.microsoft.com/azure/vs-azure-tools-storage-manage-with-storage-explorer?tabs=windows#add-a-resource-via-azure-ad)и (как минимум) иметь доступ на чтение (R--) к корневой папке ( `\` ) контейнера. Этот уровень разрешений дает им возможность перечислить содержимое корневой папки. Если вы не хотите, чтобы содержимое корневой папки было видимым, можно назначить им роль [читателя](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#reader) . С этой ролью они смогут перечислять контейнеры в учетной записи, но не содержимое контейнера. Затем можно предоставить доступ к конкретным каталогам и файлам с помощью списков управления доступом.   

## <a name="security-groups"></a>Группы безопасности

[!INCLUDE [Security groups](../../../includes/azure-storage-data-lake-groups.md)]

## <a name="limits-on-azure-role-assignments-and-acl-entries"></a>Ограничения для назначений ролей Azure и записей ACL

С помощью групп вероятность превышения максимального количества назначений ролей в каждой подписке и максимального количества записей ACL для каждого файла или каталога. Ограничения описаны в приведенной ниже таблице.

[!INCLUDE [Security groups](../../../includes/azure-storage-data-lake-rbac-acl-limits.md)] 

## <a name="shared-key-and-shared-access-signature-sas-authorization"></a>Авторизация общего ключа и подписи общего доступа (SAS)

Azure Data Lake Storage 2-го поколения также поддерживает проверку подлинности с помощью [общих ключей](https://docs.microsoft.com/rest/api/storageservices/authorize-with-shared-key) и методов [SAS](https://docs.microsoft.com/azure/storage/common/storage-sas-overview?toc=/azure/storage/blobs/toc.json) . Характеристика этих методов проверки подлинности заключается в том, что с вызывающим объектом не связано удостоверение, поэтому не удается выполнить авторизацию на основе разрешений субъекта безопасности.

В случае с общим ключом вызывающий объект эффективно получает доступ "суперпользователя", что означает полный доступ ко всем операциям со всеми ресурсами, включая данные, задание владельца и изменение списков управления доступом.

Маркеры SAS включают в себя допустимые разрешения. Разрешения, включенные в маркер SAS, эффективно применяются ко всем решениям об авторизации, но без дополнительных проверок списков ACL.

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения о списках управления доступом см.  [в разделе списки управления доступом (ACL) в Azure Data Lake Storage 2-го поколения](data-lake-storage-access-control.md).

