---
title: Настройка анонимного общего доступа на чтение для контейнеров и больших двоичных объектов
titleSuffix: Azure Storage
description: Узнайте, как разрешить или запретить анонимный доступ к данным большого двоичного объекта для учетной записи хранения. Установите параметр общего доступа к контейнеру, чтобы сделать контейнеры и большие двоичные объекты доступными для анонимного доступа.
services: storage
author: tamram
ms.service: storage
ms.topic: how-to
ms.date: 11/03/2020
ms.author: tamram
ms.reviewer: fryu
ms.subservice: blobs
ms.openlocfilehash: a808a6bb0d4dc75f02147bbfdd74d17b34e96f6e
ms.sourcegitcommit: 96918333d87f4029d4d6af7ac44635c833abb3da
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2020
ms.locfileid: "93313984"
---
# <a name="configure-anonymous-public-read-access-for-containers-and-blobs"></a>Настройка анонимного общего доступа на чтение для контейнеров и больших двоичных объектов

Служба хранилища Azure поддерживает необязательный анонимный открытый доступ на чтение для контейнеров и больших двоичных объектов. Анонимный доступ к данным по умолчанию никогда не разрешен. Если явно не включить анонимный доступ, все запросы к контейнеру и его BLOB-объектам должны быть разрешены. При настройке параметра общего уровня доступа контейнера для разрешения анонимного доступа клиенты могут считывать данные в этом контейнере без авторизации запроса.

> [!WARNING]
> Если контейнер настроен для общего доступа, любой клиент может считывать данные в этом контейнере. Общий доступ представляет потенциальную угрозу безопасности, поэтому если ваш сценарий не требует его, корпорация Майкрософт рекомендует запретить ее для учетной записи хранения. Дополнительные сведения см. [в разделе Предотвращение анонимного общего доступа на чтение к контейнерам и BLOB-объектам](anonymous-read-access-prevent.md).

В этой статье описывается, как настроить анонимный открытый доступ на чтение для контейнера и его больших двоичных объектов. Сведения о анонимном доступе к данным большого двоичного объекта из клиентского приложения см. в статье [доступ к открытым контейнерам и BLOB-объектам анонимно с помощью .NET](anonymous-read-access-client.md).

## <a name="about-anonymous-public-read-access"></a>Общие сведения о анонимном доступе на чтение

Открытый доступ к данным по умолчанию всегда запрещен. Существует два отдельных параметра, которые влияют на открытый доступ:

1. **Разрешить общий доступ для учетной записи хранения.** По умолчанию учетная запись хранения позволяет пользователю с соответствующими разрешениями разрешить общий доступ к контейнеру. Данные большого двоичного объекта недоступны для общего доступа, если пользователь не выполняет дополнительные действия для явной настройки параметра общего доступа контейнера.
1. **Настройте параметр общего доступа контейнера.** По умолчанию параметр общего доступа контейнера отключен, что означает необходимость авторизации для каждого запроса к контейнеру или его данным. Пользователь с соответствующими разрешениями может изменить параметр общего доступа контейнера, чтобы разрешить анонимный доступ только в том случае, если для учетной записи хранения разрешен анонимный доступ.

В следующей таблице показано, как оба параметра вместе влияют на общий доступ к контейнеру.

| Параметр общего доступа | Общий доступ отключен для контейнера (параметр по умолчанию) | Для общего доступа к контейнеру задано значение Container. | Общий доступ. контейнер имеет значение BLOB |
|--|--|--|--|
| Общий доступ запрещен для учетной записи хранения | Нет общего доступа к контейнеру в учетной записи хранения. | Нет общего доступа к контейнеру в учетной записи хранения. Параметр учетной записи хранения переопределяет параметр контейнера. | Нет общего доступа к контейнеру в учетной записи хранения. Параметр учетной записи хранения переопределяет параметр контейнера. |
| Для учетной записи хранения разрешен общий доступ (параметр по умолчанию) | Нет общего доступа к этому контейнеру (конфигурация по умолчанию). | Общий доступ разрешен для этого контейнера и его больших двоичных объектов. | Общий доступ разрешен для больших двоичных объектов в этом контейнере, но не для самого контейнера. |

## <a name="allow-or-disallow-public-read-access-for-a-storage-account"></a>Разрешить или запретить общий доступ на чтение для учетной записи хранения

По умолчанию учетная запись хранения настроена таким образом, чтобы разрешить пользователю с соответствующими разрешениями предоставлять общий доступ к контейнеру. Если разрешен общий доступ, пользователь с соответствующими разрешениями может изменить параметр общего доступа контейнера, чтобы разрешить анонимный открытый доступ к данным в этом контейнере. Данные большого двоичного объекта никогда не доступны для общего доступа, если только пользователь не выберет дополнительный шаг, чтобы явно настроить параметр общего доступа контейнера.

Помните, что открытый доступ к контейнеру всегда отключен по умолчанию и должен быть явно настроен для разрешения анонимных запросов. Независимо от параметра в учетной записи хранения данные никогда не будут доступны для общего доступа, если пользователь с соответствующими разрешениями не получит этот дополнительный шаг для включения общего доступа к контейнеру.

Запрещение общего доступа для учетной записи хранения предотвращает анонимный доступ ко всем контейнерам и BLOB-объектам в этой учетной записи. Если для учетной записи запрещен общий доступ, невозможно настроить параметр общего доступа для контейнера, чтобы разрешить анонимный доступ. Для повышения безопасности корпорация Майкрософт рекомендует запретить общий доступ к учетным записям хранения, если для вашего сценария требуется анонимный доступ пользователей к ресурсам большого двоичного объекта.

> [!IMPORTANT]
> Запрет общего доступа для учетной записи хранения переопределяет параметры общего доступа для всех контейнеров в этой учетной записи хранения. Если общий доступ запрещен для учетной записи хранения, все будущие анонимные запросы к этой учетной записи завершатся ошибкой. Перед изменением этого параметра необходимо понимать влияние на клиентские приложения, которые могут обращаться к данным в учетной записи хранения анонимно. Дополнительные сведения см. [в разделе Предотвращение анонимного общего доступа на чтение к контейнерам и BLOB-объектам](anonymous-read-access-prevent.md).

Чтобы разрешить или запретить общий доступ для учетной записи хранения, настройте свойство **алловблобпубликакцесс** учетной записи. Это свойство доступно для всех учетных записей хранения, созданных с помощью модели развертывания Azure Resource Manager. Дополнительные сведения см. в разделе [Общие сведения об учетной записи хранения](../common/storage-account-overview.md).

Свойство **алловблобпубликакцесс** не задано по умолчанию и не возвращает значение, пока оно не будет явно задано. Учетная запись хранения разрешает общий доступ, если свойство имеет значение **null** или **true**.

# <a name="azure-portal"></a>[Портал Azure](#tab/portal)

Чтобы разрешить или запретить общий доступ к учетной записи хранения в портал Azure, выполните следующие действия.

1. Войдите в свою учетную запись хранения на портале Azure.
1. Выберите параметр **конфигурации** в разделе **Параметры**.
1. Установите флажок **общий доступ к BLOB-объекту** **включен** или **отключен**.

    :::image type="content" source="media/anonymous-read-access-configure/blob-public-access-portal.png" alt-text="Снимок экрана, показывающий, как разрешить или запретить общий доступ к BLOB-объектам для учетной записи":::

# <a name="powershell"></a>[PowerShell](#tab/powershell)

Чтобы разрешить или запретить общий доступ к учетной записи хранения с помощью PowerShell, установите [Azure PowerShell версии 4.4.0](https://www.powershellgallery.com/packages/Az/4.4.0) или более поздней. Затем настройте свойство **алловблобпубликакцесс** для новой или существующей учетной записи хранения.

В следующем примере создается учетная запись хранения, и свойству **алловблобпубликакцесс** явно присваивается **значение true**. Затем она обновляет учетную запись хранения, чтобы присвоить свойству **алловблобпубликакцесс** **значение false**. В этом примере также извлекается значение свойства в каждом случае. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```powershell
$rgName = "<resource-group>"
$accountName = "<storage-account>"
$location = "<location>"

# Create a storage account with AllowBlobPublicAccess set to true (or null).
New-AzStorageAccount -ResourceGroupName $rgName `
    -AccountName $accountName `
    -Location $location `
    -SkuName Standard_GRS
    -AllowBlobPublicAccess $false

# Read the AllowBlobPublicAccess property for the newly created storage account.
(Get-AzStorageAccount -ResourceGroupName $rgName -Name $accountName).AllowBlobPublicAccess

# Set AllowBlobPublicAccess set to false
Set-AzStorageAccount -ResourceGroupName $rgName `
    -AccountName $accountName `
    -AllowBlobPublicAccess $false

# Read the AllowBlobPublicAccess property.
(Get-AzStorageAccount -ResourceGroupName $rgName -Name $accountName).AllowBlobPublicAccess
```

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Чтобы разрешить или запретить общий доступ для учетной записи хранения с Azure CLI, установите Azure CLI версии 2.9.0 или более поздней. Дополнительные сведения см. в статье [Установка Azure CLI](/cli/azure/install-azure-cli). Затем настройте свойство **алловблобпубликакцесс** для новой или существующей учетной записи хранения.

В следующем примере создается учетная запись хранения, и свойству **алловблобпубликакцесс** явно присваивается **значение true**. Затем она обновляет учетную запись хранения, чтобы присвоить свойству **алловблобпубликакцесс** **значение false**. В этом примере также извлекается значение свойства в каждом случае. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```azurecli-interactive
az storage account create \
    --name <storage-account> \
    --resource-group <resource-group> \
    --kind StorageV2 \
    --location <location> \
    --allow-blob-public-access true

az storage account show \
    --name <storage-account> \
    --resource-group <resource-group> \
    --query allowBlobPublicAccess \
    --output tsv

az storage account update \
    --name <storage-account> \
    --resource-group <resource-group> \
    --allow-blob-public-access false

az storage account show \
    --name <storage-account> \
    --resource-group <resource-group> \
    --query allowBlobPublicAccess \
    --output tsv
```

# <a name="template"></a>[Шаблон](#tab/template)

Чтобы разрешить или запретить общий доступ к учетной записи хранения с помощью шаблона, создайте шаблон со свойством **алловблобпубликакцесс** , для которого задано значение **true** или **false**. Следующие шаги описывают создание шаблона в портал Azure.

1. В портал Azure выберите **создать ресурс**.
1. В **поле Поиск в Marketplace** введите **шаблон развертывание** и нажмите клавишу **Ввод**.
1. Выберите **шаблоны развертывания (развернуть с помощью пользовательских шаблонов) (Предварительная версия)** , нажмите кнопку **создать** , а затем выберите **построить собственный шаблон в редакторе**.
1. В редакторе шаблонов вставьте следующий код JSON, чтобы создать новую учетную запись, и задайте для свойства **алловблобпубликакцесс** **значение true** или **false**. Не забудьте заменить заполнители в угловых скобках собственными значениями.

    ```json
    {
        "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
        "contentVersion": "1.0.0.0",
        "parameters": {},
        "variables": {
            "storageAccountName": "[concat(uniqueString(subscription().subscriptionId), 'template')]"
        },
        "resources": [
            {
            "name": "[variables('storageAccountName')]",
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2019-06-01",
            "location": "<location>",
            "properties": {
                "allowBlobPublicAccess": false
            },
            "dependsOn": [],
            "sku": {
              "name": "Standard_GRS"
            },
            "kind": "StorageV2",
            "tags": {}
            }
        ]
    }
    ```

1. при сохранении шаблона;
1. Укажите параметр группы ресурсов, а затем нажмите кнопку " **Проверка и создание** ", чтобы развернуть шаблон и создать учетную запись хранения с настроенным свойством **алловблобпубликакцесс** .

---

> [!NOTE]
> Запрет общего доступа для учетной записи хранения не влияет на статические веб-сайты, размещенные в этой учетной записи хранения. Контейнер **$Web** всегда является общедоступным.
>
> После обновления параметра общего доступа для учетной записи хранения может потребоваться до 30 секунд, прежде чем изменение будет полностью распространено.

Чтобы разрешить или запретить общий доступ к BLOB-объекту, требуется поставщик ресурсов службы хранилища Azure версии 2019-04-01 или более поздней. Дополнительные сведения см. в статье [REST API поставщика ресурсов службы хранилища Azure](/rest/api/storagerp/).

В примерах в этом разделе показано, как прочитать свойство **алловблобпубликакцесс** учетной записи хранения, чтобы определить, разрешен или запрещен общий доступ. Дополнительные сведения о том, как проверить, настроен ли параметр общего доступа учетной записи для предотвращения анонимного доступа, см. в разделе [исправление анонимного общего доступа](anonymous-read-access-prevent.md#remediate-anonymous-public-access).

## <a name="set-the-public-access-level-for-a-container"></a>Установка общего уровня доступа для контейнера

Чтобы предоставить анонимным пользователям доступ на чтение к контейнеру и его BLOB-объектам, сначала разрешите общий доступ для учетной записи хранения, а затем установите уровень общего доступа контейнера. Если для учетной записи хранения отказано в общем доступе, вы не сможете настроить общий доступ для контейнера.

Если для учетной записи хранения разрешен общий доступ, можно настроить контейнер со следующими разрешениями.

- **Нет общего доступа для чтения:** Доступ к контейнеру и его BLOB-объектам можно получить только с помощью полномочного запроса. Этот параметр используется по умолчанию для всех новых контейнеров.
- **Общий доступ на чтение только для больших двоичных объектов:** Большие двоичные объекты в контейнере могут считываться анонимным запросом, но данные контейнера недоступны анонимно. Анонимные клиенты не могут перечислять большие двоичные объекты внутри контейнера.
- **Общий доступ на чтение для контейнера и его больших двоичных объектов:** Данные контейнера и BLOB-объекта могут считываться анонимным запросом, за исключением параметров разрешений контейнера и метаданных контейнера. Клиенты могут перечислять большие двоичные объекты внутри контейнера с помощью анонимного запроса, но не могут перечислять контейнеры в учетной записи хранения.

Нельзя изменить общий уровень доступа для отдельного большого двоичного объекта. Уровень общего доступа задается только на уровне контейнера. Вы можете задать общий уровень доступа контейнера при создании контейнера или изменить параметр в существующем контейнере.

# <a name="azure-portal"></a>[Портал Azure](#tab/portal)

Чтобы обновить общий уровень доступа для одного или нескольких существующих контейнеров в портал Azure, выполните следующие действия.

1. Перейдите к обзору учетной записи хранения в портал Azure.
1. В разделе **Служба BLOB-объектов** в колонке меню выберите **контейнеры**.
1. Выберите контейнеры, для которых необходимо задать общий уровень доступа.
1. Используйте кнопку **изменить уровень доступа** , чтобы отобразить параметры общего доступа.
1. Выберите нужный уровень общего доступа в раскрывающемся списке **общедоступный уровень доступа** и нажмите кнопку ОК, чтобы применить изменения к выбранным контейнерам.

    ![Снимок экрана, на котором показано, как настроить уровень общего доступа на портале](./media/anonymous-read-access-configure/configure-public-access-container.png)

Если общий доступ запрещен для учетной записи хранения, невозможно установить общий уровень доступа контейнера. Если вы попытаетесь задать общий уровень доступа контейнера, вы увидите, что этот параметр отключен, так как для учетной записи запрещен общий доступ.

:::image type="content" source="media/anonymous-read-access-configure/container-public-access-blocked.png" alt-text="Снимок экрана, показывающий, что этот параметр имеет общий уровень доступа, заблокирован, если доступ запрещен":::

# <a name="powershell"></a>[PowerShell](#tab/powershell)

Чтобы обновить общий уровень доступа для одного или нескольких контейнеров с помощью PowerShell, вызовите команду [Set-азсторажеконтаинеракл](/powershell/module/az.storage/set-azstoragecontaineracl) . Авторизовать эту операцию, передав ключ учетной записи, строку подключения или подписанный URL-адрес (SAS). Операция [Set Container ACL](/rest/api/storageservices/set-container-acl) , которая задает общий уровень доступа контейнера, не поддерживает авторизацию в Azure AD. Дополнительные сведения см. в разделе [разрешения на вызов операций с данными большого двоичного объекта и очереди](/rest/api/storageservices/authorize-with-azure-active-directory#permissions-for-calling-blob-and-queue-data-operations).

В следующем примере создается контейнер с отключенным общим доступом, а затем обновляется параметр общего доступа контейнера, чтобы предоставить анонимный доступ к контейнеру и его BLOB-объектам. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```powershell
# Set variables.
$rgName = "<resource-group>"
$accountName = "<storage-account>"

# Get context object.
$storageAccount = Get-AzStorageAccount -ResourceGroupName $rgName -Name $accountName
$ctx = $storageAccount.Context

# Create a new container with public access setting set to Off.
$containerName = "<container>"
New-AzStorageContainer -Name $containerName -Permission Off -Context $ctx

# Read the container's public access setting.
Get-AzStorageContainerAcl -Container $containerName -Context $ctx

# Update the container's public access setting to Container.
Set-AzStorageContainerAcl -Container $containerName -Permission Container -Context $ctx

# Read the container's public access setting.
Get-AzStorageContainerAcl -Container $containerName -Context $ctx
```

Если общий доступ запрещен для учетной записи хранения, невозможно установить общий уровень доступа контейнера. При попытке задать общий уровень доступа контейнера служба хранилища Azure возвращает ошибку, указывающую, что общий доступ не разрешен в учетной записи хранения.

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Чтобы обновить общий уровень доступа для одного или нескольких контейнеров с Azure CLI, вызовите команду [AZ Storage Container Set Permission](/cli/azure/storage/container#az-storage-container-set-permission) . Авторизовать эту операцию, передав ключ учетной записи, строку подключения или подписанный URL-адрес (SAS). Операция [Set Container ACL](/rest/api/storageservices/set-container-acl) , которая задает общий уровень доступа контейнера, не поддерживает авторизацию в Azure AD. Дополнительные сведения см. в разделе [разрешения на вызов операций с данными большого двоичного объекта и очереди](/rest/api/storageservices/authorize-with-azure-active-directory#permissions-for-calling-blob-and-queue-data-operations).

В следующем примере создается контейнер с отключенным общим доступом, а затем обновляется параметр общего доступа контейнера, чтобы предоставить анонимный доступ к контейнеру и его BLOB-объектам. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```azurecli-interactive
az storage container create \
    --name <container-name> \
    --account-name <account-name> \
    --resource-group <resource-group>
    --public-access off \
    --account-key <account-key> \
    --auth-mode key

az storage container show-permission \
    --name <container-name> \
    --account-name <account-name> \
    --account-key <account-key> \
    --auth-mode key

az storage container set-permission \
    --name <container-name> \
    --account-name <account-name> \
    --public-access container \
    --account-key <account-key> \
    --auth-mode key

az storage container show-permission \
    --name <container-name> \
    --account-name <account-name> \
    --account-key <account-key> \
    --auth-mode key
```

Если общий доступ запрещен для учетной записи хранения, невозможно установить общий уровень доступа контейнера. При попытке задать общий уровень доступа контейнера служба хранилища Azure возвращает ошибку, указывающую, что общий доступ не разрешен в учетной записи хранения.

# <a name="template"></a>[Шаблон](#tab/template)

Недоступно

---

## <a name="check-the-public-access-setting-for-a-set-of-containers"></a>Проверьте параметр общего доступа для набора контейнеров.

Можно проверить, какие контейнеры в одной или нескольких учетных записях хранения настроены для общего доступа, выполнив список контейнеров и проверив параметры общего доступа. Этот подход является практичным вариантом, если учетная запись хранения не содержит большое количество контейнеров или при проверке параметра по небольшому числу учетных записей хранения. Однако производительность может снизиться при попытке перечисления большого количества контейнеров.

В следующем примере PowerShell используется для получения параметра общего доступа для всех контейнеров в учетной записи хранения. Не забудьте заменить значения заполнителей в квадратных скобках собственными значениями:

```powershell
$rgName = "<resource-group>"
$accountName = "<storage-account>"

$storageAccount = Get-AzStorageAccount -ResourceGroupName $rgName -Name $accountName
$ctx = $storageAccount.Context

Get-AzStorageContainer -Context $ctx | Select Name, PublicAccess
```

## <a name="next-steps"></a>Дальнейшие действия

- [Запретить анонимный общий доступ на чтение к контейнерам и BLOB-объектам](anonymous-read-access-prevent.md)
- [Анонимный доступ к открытым контейнерам и BLOB-объектам с помощью .NET](anonymous-read-access-client.md)
- [Авторизация доступа к службе хранилища Azure](../common/storage-auth.md)
