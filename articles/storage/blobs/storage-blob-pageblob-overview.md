---
title: Общие сведения о страничных BLOB-объектах Azure | Документация Майкрософт
description: Общие сведения о страничных BLOB-объектах Azure и их преимуществах, включая варианты использования с примерами сценариев.
services: storage
author: tamram
ms.service: storage
ms.topic: article
ms.date: 06/15/2020
ms.author: tamram
ms.reviewer: wielriac
ms.subservice: blobs
ms.openlocfilehash: 447653cdcaeb1a0bbf891a26e8bc0af5ead87fdb
ms.sourcegitcommit: 3543d3b4f6c6f496d22ea5f97d8cd2700ac9a481
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/20/2020
ms.locfileid: "86518713"
---
# <a name="overview-of-azure-page-blobs"></a>Общие сведения о страничных BLOB-объектах Azure

Служба хранилища Azure предлагает три типа хранилища BLOB-объектов: блочные, добавочные и страничные BLOB-объекты. Блочные BLOB-объекты состоят из блоков и идеально подходят для хранения текстовых или двоичных файлов, а также для эффективной передачи больших файлов. Добавочные большие двоичные объекты также состоят из блоков, но они оптимизированы для операций добавления и поэтому полезны для сценариев ведения журнала. Страничные BLOB-объекты состоят из 512-байтовых страниц, общий размер которых не превышает 8 ТБ, и создаются для частых произвольных операций чтения и записи. Страничные BLOB-объекты являются основой дисков IaaS Azure. В этой статье рассматриваются возможности и преимущества страничных BLOB-объектов.

Страничные BLOB-объекты — это коллекция 512-байтовых страниц, которые предоставляют возможность чтения и записи произвольных диапазонов байтов. Таким образом, страничные BLOB-объекты идеально подходят для хранения структур данных на основе индексов и разреженных структур данных, таких как диски ОС и диски данных для виртуальных машин и баз данных. Например, в базе данных SQL Azure страничные BLOB-объекты используются в качестве базового постоянного хранилища для баз данных. Более того, страничные BLOB-объекты также часто используются для файлов с обновлениями на основе диапазонов.  

Основные возможности страничных BLOB-объектов Azure: интерфейс REST, устойчивость базового хранилища и возможности эффективной миграции в Azure. Подробнее эти возможности рассматриваются в следующем разделе. Кроме того, страничные BLOB-объекты Azure сейчас поддерживаются в хранилищах двух типов: класса Premium и Standard. Хранилище класса Premium предназначено специально для рабочих нагрузок, требующих постоянной производительности и низкой задержки, делая страничные BLOB-объекты уровня "Премиум" идеальными для сценариев высокопроизводительных хранилищ. Учетные записи хранения уровня "Стандартный" являются более экономичными для выполнения рабочих нагрузок без учета задержек.

## <a name="sample-use-cases"></a>Примеры вариантов использования

Рассмотрим несколько вариантов использования страничных BLOB-объектов, начиная с дисков IaaS Azure. Страничные BLOB-объекты Azure — это основа платформы виртуальных дисков IaaS Azure. Диски ОС и диски данных Azure реализуются как виртуальные диски, где данные надежно хранятся на платформе службы хранилища Azure, а затем доставляются на виртуальные машины для достижения максимальной производительности. Диски Azure хранятся в [формате VHD](https://technet.microsoft.com/library/dd979539.aspx) Hyper-V и в виде [страничного BLOB-объекта](/rest/api/storageservices/Understanding-Block-Blobs--Append-Blobs--and-Page-Blobs#about-page-blobs) в службе хранилища Azure. Помимо использования виртуальных дисков для виртуальных машин IaaS Azure, страничные BLOB-объекты также поддерживают сценарии PaaS и DBaaS, например службу базы данных SQL Azure, в которой сейчас эти объекты используются для хранения данных SQL, обеспечивая выполнение произвольных операций чтения и записи для базы данных. Еще один пример: при использовании службы PaaS для общего доступа к мультимедиа для приложений совместного редактирования видео страничные BLOB-объекты обеспечивают быстрый доступ к произвольным расположениям в мультимедиа. Они также предоставляют возможность нескольким пользователям быстро и эффективно редактировать и объединять одно и то же мультимедиа. 

Корпорация Майкрософт в своих основных службах, таких как Azure Site Recovery и Azure Backup, а также многие сторонние разработчики реализовали ведущие в отрасли инновационные возможности с помощью интерфейса REST страничного BLOB-объекта. Ниже приведены уникальные сценарии, реализованные в Azure. 

* Управление добавочными моментальными снимками, направляемыми приложением. С помощью моментальных снимков страничного BLOB-объекта и интерфейсов REST API приложения могут сохранять контрольные точки приложения без дорогостоящего дублирования данных. Служба хранилища Azure поддерживает локальные моментальные снимки для страничных BLOB-объектов, для которых не требуется копирование всего BLOB-объекта. Общедоступные API-интерфейсы этих моментальных снимков также обеспечивают доступ к разностным данным между моментальными снимками и их копирование.
* Динамическая миграция приложений и данных из локальной среды в облако. Скопируйте локальные данные и используйте интерфейсы API для записи непосредственно в страничный BLOB-объект Azure, а локальная виртуальная машина продолжит работу. После этого вы можете быстро выполнить отработку отказа на виртуальную машину Azure с использованием этих данных. Таким образом можно перенести виртуальные машины и виртуальные диски из локальной среды в облако с минимальным временем простоя, так как миграция данных выполняется в фоновом режиме, а время простоя, необходимое для отработки отказа, будет сокращено (в минутах).
* Общий доступ [на основе SAS](../common/storage-sas-overview.md), который позволяет выполнять сценарии, такие как несколько читателей и один писатель с поддержкой управления параллелизмом.

## <a name="pricing"></a>Цены

Оба типа хранилища, предоставляемые страничными BLOB-объектами, имеют собственную модель ценообразования. Страничные BLOB-объекты уровня "Премиум" соответствуют модели ценообразования для управляемых дисков, в то время как для стандартных страничных BLOB-объектов выставляется счет по используемому размеру и Дополнительные сведения см. на [странице цен на страничные BLOB-объекты Azure](https://azure.microsoft.com/pricing/details/storage/page-blobs/).

## <a name="page-blob-features"></a>Возможности страничных BLOB-объектов

### <a name="rest-api"></a>REST API

Чтобы приступить к разработке с использованием страничных BLOB-объектов, см. статью [Краткое руководство по передаче, скачиванию и составлению списка больших двоичных объектов с помощью .NET](storage-dotnet-how-to-use-blobs.md). Например, рассмотрим получение доступа к страничным BLOB-объектам с помощью клиентской библиотеки хранилища для .NET. 

На следующей схеме изображены общие связи между учетной записью, контейнерами и страничными BLOB-объектами.

![Снимок экрана с связями между учетной записью, контейнерами и страничными BLOB-объектами](./media/storage-blob-pageblob-overview/storage-blob-pageblob-overview-figure1.png)

#### <a name="creating-an-empty-page-blob-of-a-specified-size"></a>Создание пустого страничного BLOB-объекта указанного размера

# <a name="net-v12-sdk"></a>[NET (пакет SDK версии 12)](#tab/dotnet).

Сначала получите ссылку на контейнер. Чтобы создать страничный BLOB-объект, вызовите метод [жетпажеблобклиент](/dotnet/api/azure.storage.blobs.specialized.specializedblobextensions.getpageblobclient) , а затем вызовите метод [пажеблобклиент. Create](/dotnet/api/azure.storage.blobs.specialized.pageblobclient.create) . Передайте максимальный размер создаваемого большого двоичного объекта. Этот размер должен быть кратен 512 байт.

:::code language="csharp" source="~/azure-storage-snippets/blobs/howto/dotnet/dotnet-v12/CRUD.cs" id="Snippet_CreatePageBlob":::

# <a name="net-v11-sdk"></a>[.NET (пакет SDK версии 11)](#tab/dotnet11).

Для создания страничного BLOB-объекта сначала создается объект **CloudBlobClient** с базовым URI доступа к хранилищу BLOB-объектов для вашей учетной записи хранения (*pbaccount* на рис. 1) и объектом **StorageCredentialsAccountAndKey**, как показано в приведенном ниже примере. В примере демонстрируется создание ссылки на объект **CloudBlobContainer**, а затем создание контейнера (*testvhds*), если он еще не существует. После этого с помощью объекта **CloudBlobContainer** следует создать ссылку на объект **CloudPageBlob**, указав имя страничного BLOB-объекта (os4.vhd), к которому необходимо получить доступ. Чтобы создать страничный BLOB-объект, вызовите [CloudPageBlob. Create](/dotnet/api/microsoft.azure.storage.blob.cloudpageblob.create), передав максимальный размер создаваемого большого двоичного объекта. Этот размер (*blobSize*) должен быть кратен 512 байтам.

```csharp
using Microsoft.Azure;
using Microsoft.Azure.Storage;
using Microsoft.Azure.Storage.Blob;

long OneGigabyteAsBytes = 1024 * 1024 * 1024;
// Retrieve storage account from connection string.
CloudStorageAccount storageAccount = CloudStorageAccount.Parse(
    CloudConfigurationManager.GetSetting("StorageConnectionString"));

// Create the blob client.
CloudBlobClient blobClient = storageAccount.CreateCloudBlobClient();

// Retrieve a reference to a container.
CloudBlobContainer container = blobClient.GetContainerReference("testvhds");

// Create the container if it doesn't already exist.
container.CreateIfNotExists();

CloudPageBlob pageBlob = container.GetPageBlobReference("os4.vhd");
pageBlob.Create(16 * OneGigabyteAsBytes);
```

---

#### <a name="resizing-a-page-blob"></a>Изменение размера страничного BLOB-объекта

# <a name="net-v12-sdk"></a>[NET (пакет SDK версии 12)](#tab/dotnet).

Чтобы изменить размер страничного BLOB-объекта после создания, используйте метод [изменения размера](/dotnet/api/azure.storage.blobs.specialized.pageblobclient.resize?view=azure-dotnet) . Запрошенный размер должен быть кратен 512 байтам.

:::code language="csharp" source="~/azure-storage-snippets/blobs/howto/dotnet/dotnet-v12/CRUD.cs" id="Snippet_ResizePageBlob":::

# <a name="net-v11-sdk"></a>[.NET (пакет SDK версии 11)](#tab/dotnet11).

Чтобы изменить размер страничного BLOB-объекта после создания, используйте метод [изменения размера](/dotnet/api/microsoft.azure.storage.blob.cloudpageblob.resize) . Запрошенный размер должен быть кратен 512 байтам.

```csharp
pageBlob.Resize(32 * OneGigabyteAsBytes);
```

---

#### <a name="writing-pages-to-a-page-blob"></a>Запись страниц в страничный BLOB-объект

# <a name="net-v12-sdk"></a>[NET (пакет SDK версии 12)](#tab/dotnet).

Для записи страниц используйте метод [пажеблобклиент. уплоадпажес](/dotnet/api/azure.storage.blobs.specialized.pageblobclient.uploadpages) .  

:::code language="csharp" source="~/azure-storage-snippets/blobs/howto/dotnet/dotnet-v12/CRUD.cs" id="Snippet_WriteToPageBlob":::

# <a name="net-v11-sdk"></a>[.NET (пакет SDK версии 11)](#tab/dotnet11).

Для записи страниц используйте метод [CloudPageBlob.WritePages](/dotnet/api/microsoft.azure.storage.blob.cloudpageblob.beginwritepages).  

```csharp
pageBlob.WritePages(dataStream, startingOffset); 
```

---

Это позволит записать последовательный набор страниц размером до 4 МБ. Записываемое смещение должно начинаться на границе 512 байт (startingOffset % 512 == 0), а заканчиваться на границе 512 — 1. 

Как только запрос на запись последовательного набора страниц успешно выполняется в службе BLOB-объектов и реплицируется для обеспечения устойчивости, запись фиксируется и клиенту отправляется уведомление о том, что запись завершена успешно.  

На схеме ниже показано 2 отдельных операции записи:

![Диаграмма, на которой показаны два отдельных параметра записи.](./media/storage-blob-pageblob-overview/storage-blob-pageblob-overview-figure2.png)

1.  Операция записи, начинающаяся со смещения 0 длиной 1024 байт 
2.  Операция записи, начинающаяся со смещения 4096 длиной 1024 байт 

#### <a name="reading-pages-from-a-page-blob"></a>Чтение страниц из страничного BLOB-объекта

# <a name="net-v12-sdk"></a>[NET (пакет SDK версии 12)](#tab/dotnet).

Для чтения страниц используйте метод [пажеблобклиент. download](/dotnet/api/azure.storage.blobs.specialized.blobbaseclient.download) для чтения диапазона байтов из страничного BLOB-объекта. 

:::code language="csharp" source="~/azure-storage-snippets/blobs/howto/dotnet/dotnet-v12/CRUD.cs" id="Snippet_ReadFromPageBlob":::

# <a name="net-v11-sdk"></a>[.NET (пакет SDK версии 11)](#tab/dotnet11).

Для чтения страниц используйте метод [CloudPageBlob.DownloadRangeToByteArray](/dotnet/api/microsoft.azure.storage.blob.icloudblob.downloadrangetobytearray), чтобы считать диапазон байтов из страничного BLOB-объекта. 

```csharp
byte[] buffer = new byte[rangeSize];
pageBlob.DownloadRangeToByteArray(buffer, bufferOffset, pageBlobOffset, rangeSize); 
```

---

Это даст возможность загрузить весь большой двоичный объект или диапазон байтов, начиная со смещения в большом двоичном объекте. При чтении смещение не должно начинаться с величины, кратной 512. При чтении байтов со страницы NUL служба возвращает нулевые байты.

На следующем рисунке показана операция чтения со смещением 256 и размером диапазона 4352. Возвращенные данные выделены оранжевым цветом. Для страниц NUL возвращаются нули.

![Схема, показывающая операцию чтения со смещением 256 и размером диапазона 4352](./media/storage-blob-pageblob-overview/storage-blob-pageblob-overview-figure3.png)

Если большой двоичный объект является фрагментарным, возможно, потребуется загружать только значимые области страницы. Это позволит не оплачивать передачу нулевых байтов и сократить задержку при загрузке.  

# <a name="net-v12-sdk"></a>[NET (пакет SDK версии 12)](#tab/dotnet).

Чтобы определить, какие страницы поддерживаются данными, используйте [пажеблобклиент. GetPageRanges](/dotnet/api/azure.storage.blobs.specialized.pageblobclient.getpageranges). Вы можете перечислить возвращаемые диапазоны и загрузить данные в каждом диапазоне. 

:::code language="csharp" source="~/azure-storage-snippets/blobs/howto/dotnet/dotnet-v12/CRUD.cs" id="Snippet_ReadValidPageRegionsFromPageBlob":::

# <a name="net-v11-sdk"></a>[.NET (пакет SDK версии 11)](#tab/dotnet11).

Чтобы определить, какие страницы поддерживаются данными, используйте метод [CloudPageBlob.GetPageRanges](/dotnet/api/microsoft.azure.storage.blob.cloudpageblob.getpageranges). Вы можете перечислить возвращаемые диапазоны и загрузить данные в каждом диапазоне. 

```csharp
IEnumerable<PageRange> pageRanges = pageBlob.GetPageRanges();

foreach (PageRange range in pageRanges)
{
    // Calculate the range size
    int rangeSize = (int)(range.EndOffset + 1 - range.StartOffset);

    byte[] buffer = new byte[rangeSize];

    // Read from the correct starting offset in the page blob and
    // place the data in the bufferOffset of the buffer byte array
    pageBlob.DownloadRangeToByteArray(buffer, bufferOffset, range.StartOffset, rangeSize); 

    // Then use the buffer for the page range just read
}
```

---

#### <a name="leasing-a-page-blob"></a>Сдача страничного BLOB-объекта в аренду

Операция сдачи большого двоичного объекта в аренду устанавливает блокировку на большом двоичном объекте для операций записи и удаления, а также управляет ею. Эта операция полезна, если к страничному BLOB-объекту осуществляется доступ из нескольких клиентов. При ее применении запись в большой двоичный объект в текущий момент может осуществляться только одним клиентом. К примеру, в дисках Azure этот механизм сдачи в аренду используется, чтобы управление диском осуществлялось только с одной виртуальной машины. Длительность блокировки может составлять 15–60 секунд либо быть бесконечной. Дополнительные сведения см. в [этой документации](/rest/api/storageservices/lease-blob).

В дополнение к богатому набору интерфейсов API, страничные BLOB-объекты также обеспечивают общий доступ, устойчивость и повышенную безопасность. Далее мы рассмотрим эти преимущества подробнее. 

### <a name="concurrent-access"></a>Одновременный доступ

REST API страничного BLOB-объекта и его механизм сдачи в аренду позволяет приложениям получать доступ к страничному BLOB-объекту из нескольких клиентов. Например, предположим, что нужно создать распределенную облачную службу, которая использует объекты хранилища совместно с несколькими пользователями. Это может быть веб-приложение, обслуживающее большую коллекцию изображений для нескольких пользователей. Один из вариантов для реализации — использование виртуальной машины с подключенными дисками. К недостаткам этого относится (а) ограничение подключения диска только к одной виртуальной машине, что уменьшает масштабируемость, гибкость и повышает риски. Если возникла проблема с виртуальной машиной или службой, запущенной на виртуальной машине, по истечении срока действия аренды или ее разрыва образ будет недоступен. Кроме того, требуются дополнительные затраты на виртуальную машину IaaS. 

Альтернативным вариантом является использование страничных BLOB-объектов напрямую через интерфейсы REST API службы хранилища Azure. Этот вариант не требует использования дорогостоящих виртуальных машин IaaS, предоставляет гибкие возможности прямого доступа из нескольких клиентов, упрощает классическую модель развертывания (так как не нужно подключать и отключать диски) и исключает риски возникновения проблем на виртуальной машине. И обеспечивается тот же уровень производительности для произвольных операций чтения и записи, что и на диске.

### <a name="durability-and-high-availability"></a>Высокая доступность и устойчивость

Хранилища класса Standard и Premium — это надежные хранилища, в которых данные страничных BLOB-объектов всегда реплицируются для обеспечения устойчивости и высокого уровня доступности. Дополнительные сведения об избыточности службы хранилища Azure см. в этой [документации](../common/storage-redundancy.md). Azure постоянно доставляет устойчивость корпоративного уровня для дисков IaaS и страничных BLOB-объектов с [годовой процентной ставкой сбоев](https://en.wikipedia.org/wiki/Annualized_failure_rate).

### <a name="seamless-migration-to-azure"></a>Простая миграция в Azure

Для клиентов и разработчиков, заинтересованных в реализации своего собственного пользовательского решения резервного копирования, Azure также предлагает добавочные моментальные снимки, которые содержат только разностные данные. Эта возможность позволяет избежать затрат на начальную полную копию, что значительно снижает расходы на резервное копирование. Помимо возможности эффективно считывать и копировать разностные данные есть другая эффективная возможность, которая помогает внедрить еще больше инноваций от разработчиков, обеспечивая лучшие в своем классе резервное копирование и аварийное восстановление. Вы можете настроить свое собственное решение резервного копирования или аварийного восстановления для виртуальных машин в Azure, используя [моментальные снимки больших двоичных объектов](/rest/api/storageservices/snapshot-blob), интерфейс API [Get Page Ranges](/rest/api/storageservices/get-page-ranges) и интерфейс API [Incremental Copy Blob](/rest/api/storageservices/incremental-copy-blob), с помощью которого можно легко копировать добавочные данные для аварийного восстановления. 

Кроме того, во многих предприятиях важные рабочие нагрузки уже запущены в центрах обработки данных в локальной среде. При переносе рабочей нагрузки в облако одной из основных проблем является время простоя, необходимое для копирования данных, и риск возникновения других непредвиденных проблем после переключения. Во многих случаях простой может быть препятствием для миграции в облако. Используя REST API страничных BLOB-объектов, Azure устраняет эту проблему, обеспечивая перенос в облако с минимальными нарушениями работы важных рабочих нагрузок. 

Примеры создания моментального снимка и восстановления страничного BLOB-объекта из моментального снимка см. в статье о [настройке процесса резервного копирования с помощью добавочных моментальных снимков](../../virtual-machines/windows/incremental-snapshots.md).
