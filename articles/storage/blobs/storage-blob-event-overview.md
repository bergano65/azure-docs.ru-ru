---
title: Реагирование на события хранилища BLOB-объектов Azure | Документация Майкрософт
description: Используйте службу "Сетка событий Azure" для подписки и реагирования на события хранилища BLOB-объектов. Сведения о модели событий, фильтрации событий и методиках использования событий.
author: normesta
ms.author: normesta
ms.date: 04/06/2020
ms.topic: conceptual
ms.service: storage
ms.subservice: blobs
ms.reviewer: dineshm
ms.openlocfilehash: e67a323e03ae8ac0a0e34df1f7cc1ee4fe0901d3
ms.sourcegitcommit: a43a59e44c14d349d597c3d2fd2bc779989c71d7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/25/2020
ms.locfileid: "95901508"
---
# <a name="reacting-to-blob-storage-events"></a>Реагирование на события хранилища BLOB-объектов

События службы хранилища Azure позволяют приложениям реагировать на события, такие как создание и удаление больших двоичных объектов. При этом не требуется сложный код или дорогостоящие и неэффективные службы опроса. Лучшим вариантом является оплата только тех компонентов, которые вы используете.

События хранилища BLOB-объектов отправляются с помощью службы " [Сетка событий Azure](https://azure.microsoft.com/services/event-grid/) " для подписчиков, таких как функции Azure, Azure Logic Apps или даже для собственного прослушивателя HTTP. Сетка событий обеспечивает надежную доставку событий в приложения с помощью многофункциональных политик повтора и недоставленных сообщений.

Полный список событий, поддерживаемых хранилищем BLOB-объектов, см. в статье [схема событий хранилища BLOB-объектов](../../event-grid/event-schema-blob-storage.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json) .

К распространенным сценариям событий хранилища BLOB-объектов относятся обработка изображений и видео, индексирование поиска и любые рабочие процессы, ориентированные на файлы. Асинхронная передача файлов идеально подходит для событий. Когда изменения вносятся редко, а сценарий требует немедленного реагирования, архитектура на основе событий может быть особенно эффективной.

Если вы хотите испытать события хранилища BLOB-объектов, см. любую из следующих кратких руководств:

|Если вы хотите использовать это средство:    |См. следующую статью: |
|--|-|
|Портал Azure    |[Краткое руководство. Отправка событий хранилища BLOB-объектов в конечную веб-точку с помощью портала Azure](../../event-grid/blob-event-quickstart-portal.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)|
|PowerShell    |[Краткое руководство. Маршрутизация событий хранилища в конечную точку веб-сайта с помощью PowerShell](./storage-blob-event-quickstart-powershell.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)|
|Azure CLI    |[Краткое руководство. Маршрутизация событий хранилища в конечную точку веб-узла с Azure CLI](./storage-blob-event-quickstart.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)|

Подробные примеры реагирования на события хранилища BLOB-объектов с помощью функций Azure см. в следующих статьях:

- [Учебник. Использование событий Azure Data Lake Storage 2-го поколения для обновления разностной таблицы кирпичей](data-lake-storage-events.md)данных.
- [Руководство по Автоматическое изменение размера переданных изображений с помощью службы "Сетка событий"](../../event-grid/resize-images-on-storage-blob-upload-event.md?tabs=dotnet)

>[!NOTE]
> Интеграция событий поддерживается только для учетных записей хранения типа **StorageV2 (общее назначение версии 2)**, **блоккблобстораже** и **блобстораже** . **Хранилище (общее назначение** версии 1) *не поддерживает интеграцию со службой "* сетка событий".

## <a name="the-event-model"></a>Модель событий

Сетка событий использует [подписки на события](../../event-grid/concepts.md#event-subscriptions) для маршрутизации сообщений о событиях подписчикам. На этом рисунке показана связь между издателями событий, подписками на события и обработчиками событий.

![Модель Сетки событий](./media/storage-blob-event-overview/event-grid-functional-model.png)

Сначала подпишите конечную точку на событие. Затем при активации события служба "Сетка событий" отправит данные об этом событии в конечную точку.

См. статью о [схеме событий хранилища BLOB-объектов](../../event-grid/event-schema-blob-storage.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json) для просмотра:

> [!div class="checklist"]
> * Полный список событий хранилища BLOB-объектов и процедура запуска каждого события.
> * Пример данных, которые сетка событий будет передавать для каждого из этих событий.
> * Назначение каждой пары «ключ — значение», отображаемой в данных.

## <a name="filtering-events"></a>Фильтрация событий

События больших двоичных объектов [можно фильтровать](/cli/azure/eventgrid/event-subscription?view=azure-cli-latest) по типу события, имени контейнера или имени объекта, который был создан или удален. Фильтры в сетке событий соответствуют началу или концу темы, поэтому события с совпадающим субъектом переходят на подписчик.

Дополнительные сведения о том, как применять фильтры, см. в разделе [Фильтрация событий для сетки событий](../../event-grid/how-to-filter-events.md).

Тема событий хранилища BLOB-объектов использует следующий формат:

```
/blobServices/default/containers/<containername>/blobs/<blobname>
```

Чтобы сопоставить все события для учетной записи хранения, фильтры темы можно оставить пустыми.

Чтобы сопоставить события из больших двоичных объектов, созданных в наборе контейнеров с общим префиксом, используйте фильтр `subjectBeginsWith`, подобный этому:

```
/blobServices/default/containers/containerprefix
```

Чтобы сопоставить события из больших двоичных объектов, созданных в конкретном контейнере, используйте фильтр `subjectBeginsWith`, подобный этому:

```
/blobServices/default/containers/containername/
```

Чтобы сопоставить события из больших двоичных объектов, созданных в конкретном контейнере с общим префиксом имени большого двоичного объекта, используйте фильтр `subjectBeginsWith`, подобный этому:

```
/blobServices/default/containers/containername/blobs/blobprefix
```

Чтобы сопоставить события из больших двоичных объектов, созданных в конкретном контейнере с общим суффиксом имени большого двоичного объекта, используйте фильтр `subjectEndsWith`, такой как ".log" или ".jpg". Дополнительные сведения см. в статье [Основные понятия в службе "Сетка событий Azure"](../../event-grid/concepts.md#event-subscriptions).

## <a name="practices-for-consuming-events"></a>Рекомендации по потреблению событий

Приложения, которые обрабатывают события хранилища BLOB-объектов, должны следовать нескольким рекомендациям:
> [!div class="checklist"]
> * Так как в один обработчик событий можно настроить маршрутизацию событий из нескольких подписок, не следует предполагать, что события поступают из определенного источника. Но необходимо проверять тему сообщения, чтобы убедиться, что оно поступает из ожидаемой учетной записи хранения.
> * Подобным образом убедитесь, что вы готовы к обработке этого типа событий (eventType), а также не следует предполагать, что все получаемые события будут иметь ожидаемый тип.
> * По мере того как сообщения могут поступать после некоторой задержки, используйте поля eTag, чтобы узнать, не устарели ли ваши сведения об объектах. Сведения об использовании поля ETag см. в разделе [Управление параллелизмом в хранилище BLOB-объектов](../common/storage-concurrency.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json#managing-concurrency-in-blob-storage). 
> * Так как сообщения могут приступать не по порядку, используйте поля Sequencer, чтобы понять порядок событий в любом конкретном объекте. Поле Sequencer представляет собой строковое значение, представляющее логическую последовательность событий для любого конкретного имени большого двоичного объекта. Для понимания относительной последовательности двух событий в одном и том же имени большого двоичного объекта можно использовать стандартное сравнение строк.
> * События хранилища гарантируют доставку подписчикам по крайней мере, что гарантирует вывод всех сообщений. Однако из-за повторных попыток или доступности подписок могут возникнуть дублирующиеся сообщения. Дополнительные сведения о доставке сообщений и повторных попытках см. в разделе [Доставка сообщений в сетке событий и повторная](../../event-grid/delivery-and-retry.md)попытка.
> * Используйте поле blobType чтобы понять, какой тип операций разрешен в большом двоичном объекте и какие типы клиентских библиотек следует использовать для доступа к большому двоичному объекту. Допустимые значения: `BlockBlob` или `PageBlob`. 
> * Для доступа к большому двоичному объекту используйте поле url с конструкторами `CloudBlockBlob` и `CloudAppendBlob`.
> * Игнорируйте поля, которые вам непонятны. Такой подход поможет обеспечить устойчивость к новым функциям, которые могут быть добавлены в будущем.
> * Если необходимо, чтобы событие **Microsoft. Storage. BlobCreated** вызывалось только при полной фиксации блочного большого двоичного объекта, отфильтруйте событие для `CopyBlob` `PutBlob` `PutBlockList` вызовов REST API, или `FlushWithClose` . Эти вызовы API активируют событие **Microsoft. Storage. BlobCreated** только после полной фиксации данных в блочном BLOB-объекте. Сведения о создании фильтра см. в разделе [Фильтрация событий для сетки событий](../../event-grid/how-to-filter-events.md).


## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с дополнительными сведениями о Сетке событий и попробуйте использовать события хранилища BLOB-объектов:

- [An introduction to Azure Event Grid](../../event-grid/overview.md) (Общие сведения о службе "Сетка событий Azure")
- [Схема событий хранилища BLOB-объектов](../../event-grid/event-schema-blob-storage.md?toc=%2fazure%2fstorage%2fblobs%2ftoc.json)
- [Маршрутизация событий хранилища больших двоичных объектов в пользовательскую веб-конечную точку](storage-blob-event-quickstart.md)