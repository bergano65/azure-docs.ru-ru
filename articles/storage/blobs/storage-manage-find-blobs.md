---
title: Управление данными больших двоичных объектов Azure и их поиск с помощью тегов индекса BLOB-объектов (Предварительная версия)
description: Узнайте, как использовать теги индекса больших двоичных объектов для категоризации, управления и запроса объектов BLOB.
author: mhopkins-msft
ms.author: mhopkins
ms.date: 10/19/2020
ms.service: storage
ms.subservice: common
ms.topic: conceptual
ms.reviewer: klaasl
ms.custom: references_regions
ms.openlocfilehash: 3174dbd36d9bb39ce606ec12f88397f795e91526
ms.sourcegitcommit: 0a9df8ec14ab332d939b49f7b72dea217c8b3e1e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/18/2020
ms.locfileid: "94832438"
---
# <a name="manage-and-find-azure-blob-data-with-blob-index-tags-preview"></a>Управление данными больших двоичных объектов Azure и их поиск с помощью тегов индекса BLOB-объектов (Предварительная версия)

Так как наборы данных увеличиваются, поиск определенного объекта в Sea может оказаться затруднительным. Теги индекса больших двоичных объектов предоставляют возможности управления данными и обнаружения с помощью атрибутов тегов индекса "ключ-значение". Вы можете классифицировать и найти объекты в одном контейнере или во всех контейнерах в учетной записи хранения. При изменении требований к данным объекты можно динамически классифицировать, обновив Теги индекса. Объекты могут оставаться на месте в текущей организации контейнера.

Теги индекса больших двоичных объектов позволяют:

- Динамически классифицировать большие двоичные объекты с помощью тегов индекса "ключ — значение"
- Быстрый поиск конкретных больших двоичных объектов с тегами во всей учетной записи хранения
- Указание условного поведения для API-интерфейсов BLOB-объектов на основе оценки тегов индекса
- Использование тегов индекса для расширенных элементов управления в таких функциях, как [Управление жизненным циклом BLOB-объектов](storage-lifecycle-management-concepts.md)

Рассмотрим ситуацию, когда у вас есть миллионы больших двоичных объектов в вашей учетной записи хранения, доступ к которым осуществляется множеством разных приложений. Необходимо найти все связанные данные из одного проекта. Вы не знаете, что такое область, так как данные можно распределять по нескольким контейнерам с разными соглашениями об именовании. Однако ваши приложения передают все данные с тегами, основанными на их проекте. Вместо того чтобы выполнять поиск по миллионам больших двоичных объектов и сравнивать имена и свойства, можно использовать `Project = Contoso` в качестве условия обнаружения. Индекс BLOB-объекта фильтрует все контейнеры во всей учетной записи хранения, чтобы быстро найти и вернуть только набор из 50 больших двоичных объектов `Project = Contoso` .

Чтобы приступить к работе с примерами использования индекса больших двоичных объектов, см. раздел [Использование тегов индекса больших двоичных объектов для управления и поиска данных](storage-blob-index-how-to.md).

## <a name="blob-index-tags-and-data-management"></a>Теги индекса BLOB-объектов и управление данными

Префиксы имени контейнера и BLOB-объекта — это одномерные классификации. Теги индекса больших двоичных объектов позволяют использовать многомерную классификацию для [типов данных больших двоичных объектов (блоков, добавлений или страниц)](/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs). Многомерные классификации изначально индексируются хранилищем BLOB-объектов Azure, что позволяет быстро находить данные.

Рассмотрим следующие пять больших двоичных объектов в вашей учетной записи хранения:

- *container1/transaction.csv*
- *контейнера container2/campaign.docx*
- *фотографии и bannerphoto.png*
- *архивы, завершенные и 2019review.pdf*
- *журналы/2020/01/01/logfile.txt*


Эти большие двоичные объекты разделяются с помощью префикса *контейнера, виртуальной папки или имени большого двоичного объекта*. Вы можете задать атрибут тега индекса для `Project = Contoso` этих пяти больших двоичных объектов, чтобы классифицировать их вместе, сохраняя их текущую организацию префиксов. Добавление тегов индекса устраняет необходимость в перемещении данных, предоставляя возможность фильтрации и поиска данных с помощью индекса.

## <a name="setting-blob-index-tags"></a>Задание тегов индекса больших двоичных объектов

Теги индекса больших двоичных объектов — это атрибуты ключевого значения, которые могут применяться к новым или существующим объектам в вашей учетной записи хранения. Теги индекса можно указать во время отправки с помощью команды [поместить BLOB-объект](/rest/api/storageservices/put-blob), [разместить список блокировок](/rest/api/storageservices/put-block-list)или скопировать операции с [BLOB-объектом](/rest/api/storageservices/copy-blob) и необязательный `x-ms-tags` заголовок. Если у вас уже есть большие двоичные объекты в учетной записи хранения, вызовите функцию [Set BLOB Tags](/rest/api/storageservices/set-blob-tags) , передав отформатированный XML-документ с помощью тегов индекса в тексте запроса.

> [!IMPORTANT]
> Задание тегов индекса больших двоичных объектов может выполняться [владельцем данных большого двоичного объекта хранилища](/azure/role-based-access-control/built-in-roles#storage-blob-data-owner) и любым пользователем с подписанным URL-адресом, имеющим разрешение на доступ к тегам большого двоичного объекта ( `t` разрешение SAS).
>
> Кроме того, пользователи RBAC с `Microsoft.Storage/storageAccounts/blobServices/containers/blobs/tags/write` разрешением могут выполнять эту операцию.

Вы можете применить один тег к большому двоичному объекту, чтобы описать момент завершения обработки данных.

> "Процесседдате" = "2020-01-01"

К большому двоичному объекту можно применить несколько тегов, чтобы сделать их более описательными.

> "Проект" = "contoso"  
> "Классифицированные" = "true"  
> "Состояние" = "не обработано"  
> "Priority" = "01"

Чтобы изменить существующие атрибуты тега индекса, извлеките существующие атрибуты тега, измените атрибуты тега и замените на операцию [Set BLOB Tags](/rest/api/storageservices/set-blob-tags) . Чтобы удалить все теги индекса из большого двоичного объекта, вызовите `Set Blob Tags` операцию без указания атрибутов тега. Так как теги индекса больших двоичных объектов являются подресурсом для содержимого данных большого двоичного объекта, `Set Blob Tags` не изменяют никакое базовое содержимое и не изменяют время последнего изменения или ETag для объекта BLOB. Можно создавать или изменять теги индекса для всех текущих базовых BLOB-объектов и предыдущих версий. Однако Теги с моментальными снимками или обратимо удаленные BLOB-объекты нельзя изменить.

К тегам индекса больших двоичных объектов применяются следующие ограничения.

- Каждый большой двоичный объект может содержать до 10 тегов индекса больших двоичных объектов
- Длина ключей тегов должна составлять от одного до 128 символов
- Значения тегов должны быть в диапазоне от 0 до 256 символов
- В ключах и значениях тегов учитывается регистр
- Ключи и значения тегов поддерживают только строковые типы данных. Любые числа, даты, время или специальные символы сохраняются в виде строк.
- Ключи и значения тегов должны соответствовать следующим правилам именования:
  - Буквенно-цифровые символы:
    - от **a** до **z** (строчные буквы);
    - от **A** до **Z** (прописные буквы);
    - от **0** до **9** (цифры).
  - Допустимые специальные символы: пробел, плюс, минус, точка, двоеточие, знак равенства, символ подчеркивания, косая черта ( ` +-.:=_/` )

## <a name="getting-and-listing-blob-index-tags"></a>Получение и перечисление тегов индекса больших двоичных объектов

Теги индекса больших двоичных объектов хранятся как подресурсы вместе с данными больших двоичных объектов и могут извлекаться независимо от базового содержимого данных большого двоичного объекта. Теги индекса больших двоичных объектов для одного большого двоичного объекта можно получить с помощью операции [получения тегов больших двоичных](/rest/api/storageservices/get-blob-tags) объектов. Операция [List blobs](/rest/api/storageservices/list-blobs) с `include:tags` параметром также возвратит все большие двоичные объекты в контейнере вместе с их тегами индекса больших двоичных объектов.

> [!IMPORTANT]
> Получение и перечисление тегов индекса больших двоичных объектов может осуществляться [владельцем данных большого двоичного объекта хранилища](/azure/role-based-access-control/built-in-roles#storage-blob-data-owner) и любым пользователем с подписанным URL-адресом, имеющим разрешение на доступ к тегам большого двоичного объекта ( `t` разрешение SAS).
>
> Кроме того, пользователи RBAC с `Microsoft.Storage/storageAccounts/blobServices/containers/blobs/tags/read` разрешением могут выполнять эту операцию.

Для больших двоичных объектов, имеющих по крайней мере один тег индекса BLOB-объектов, `x-ms-tag-count` возвращается в виде [списка больших двоичных объектов](/rest/api/storageservices/list-blobs), [получение большого двоичного объекта](/rest/api/storageservices/get-blob)и [Получение свойств больших двоичных](/rest/api/storageservices/get-blob-properties) объектов, указывающих количество тегов индекса в большом двоичном объекте.

## <a name="finding-data-using-blob-index-tags"></a>Поиск данных с помощью тегов индекса больших двоичных объектов

Механизм индексирования предоставляет атрибуты "ключ-значение" в многомерном индексе. После задания тегов индекса они существуют в большом двоичном объекте и могут быть получены немедленно. Обновление индекса больших двоичных объектов может занять некоторое время. После обновления индекса больших двоичных объектов можно использовать собственные возможности запросов и обнаружения, предоставляемые хранилищем BLOB-объектов.

Операция [Поиск больших двоичных объектов по тегам](/rest/api/storageservices/find-blobs-by-tags) позволяет получить отфильтрованный набор больших двоичных объектов, Теги индекса которых соответствуют заданному выражению запроса. `Find Blobs by Tags` поддерживает фильтрацию по всем контейнерам в вашей учетной записи хранения или можно ограничить область фильтрации только одним контейнером. Так как все ключи и значения тега индекса являются строками, реляционные операторы используют лексикографическим порядком сортировку.

> [!IMPORTANT]
> Поиск данных с помощью тегов индекса больших двоичных объектов может выполняться [владельцем данных большого двоичного объекта хранилища](/azure/role-based-access-control/built-in-roles#storage-blob-data-owner) и любым пользователем с подписанным URL-адресом, имеющим разрешение на поиск больших двоичных объектов по тегам ( `f` разрешение SAS).
>
> Кроме того, пользователи RBAC с `Microsoft.Storage/storageAccounts/blobServices/containers/blobs/filter/action` разрешением могут выполнять эту операцию.

Следующие критерии применяются к фильтрации индекса больших двоичных объектов.

- Ключи тегов должны быть заключены в двойные кавычки (")
- Значения тегов и имена контейнеров должны быть заключены в одинарные кавычки (')
- Символ @ разрешен только для фильтрации по определенному имени контейнера (например, `@container = 'ContainerName'` ).
- Фильтры применяются с сортировкой лексикографическим порядком по строкам
- Недопустимые операции с одинаковым диапазоном на одном и том же ключе (например, `"Rank" > '10' AND "Rank" >= '15'` )
- При использовании функции RESTFUL для создания критерия фильтра символы должны быть в кодировке URI

В таблице ниже показаны все допустимые операторы для `Find Blobs by Tags` :

|  Оператор  |  Описание  | Пример |
|------------|---------------|---------|
|     =      |     Равно     | `"Status" = 'In Progress'` |
|     >      |  Больше чем | `"Date" > '2018-06-18'` |
|     >=     |  Больше или равно | `"Priority" >= '5'` |
|     <      |  Меньше чем   | `"Age" < '32'` |
|     <=     |  Меньше или равно  | `"Company" <= 'Contoso'` |
|    AND     |  Логическое и  | `"Rank" >= '010' AND "Rank" < '100'` |
| @container | Область действия для определенного контейнера | `@container = 'videofiles' AND "status" = 'done'` |

> [!NOTE]
> При настройке и запросе тегов необходимо иметь представление о лексикографическом порядке.
>
> - Числа сортируются до букв. Числа сортируются на основе первой цифры.
> - Прописные буквы сортируются перед строчными буквами.
> - Символы не являются стандартными. Некоторые символы сортируются перед числовыми значениями. Другие символы сортируются до или после букв.

## <a name="conditional-blob-operations-with-blob-index-tags"></a>Условные операции с BLOB-объектами с тегами индекса больших двоичных объектов

В остальных версиях 2019-10-10 и выше большинство [API службы BLOB-объектов](/rest/api/storageservices/operations-on-blobs) теперь поддерживают условный заголовок, то `x-ms-if-tags` есть операция будет выполнена только при выполнении условия индекса большого двоичного объекта. Если условие не выполнено, вы получите `error 412: The condition specified using HTTP conditional header(s) is not met` .

`x-ms-if-tags`Заголовок может быть объединен с другими существующими условными заголовками HTTP (если-Match, если-None-Match и т. д.). Если в запросе указано несколько условных заголовков, для выполнения операции все они должны оцениваться как true. Все условные заголовки фактически объединяются с логическими и.

В таблице ниже показаны допустимые операторы для условных операций.

|  Оператор  |  Описание  | Пример |
|------------|---------------|---------|
|     =      |     Равно     | `"Status" = 'In Progress'` |
|     <>     |   Не равно   | `"Status" <> 'Done'` |
|     >      |  Больше чем | `"Date" > '2018-06-18'` |
|     >=     |  Больше или равно | `"Priority" >= '5'` |
|     <      |  Меньше чем   | `"Age" < '32'` |
|     <=     |  Меньше или равно  | `"Company" <= 'Contoso'` |
|    AND     |  Логическое и  | `"Rank" >= '010' AND "Rank" < '100'` |
|     ИЛИ     | Логическое или   | `"Status" = 'Done' OR "Priority" >= '05'` |

> [!NOTE]
> Существует два дополнительных оператора, которые не равны и являются логическими или, которые разрешены в условном `x-ms-if-tags` заголовке для операций с BLOB-объектами, но не существуют в `Find Blobs by Tags` операции.

## <a name="platform-integrations-with-blob-index-tags"></a>Интеграция платформ с тегами индекса больших двоичных объектов

Теги индекса больших двоичных объектов помогают не только классифицировать, управлять и выполнять поиск данных больших двоичных объектов, но также обеспечивают интеграцию с другими функциями хранилища BLOB-объектов, такими как [Управление жизненным циклом](storage-lifecycle-management-concepts.md).

### <a name="lifecycle-management"></a>Управление жизненным циклом

С помощью `blobIndexMatch` фильтра правил в управлении жизненным циклом можно перемещать данные на дополнительные уровни или удалять данные на основе тегов индекса, примененных к BLOB-объектам. Вы можете более детально использовать правила и перемещать или удалять большие двоичные объекты, если они соответствуют заданным критериям.

Можно задать сопоставление индекса больших двоичных объектов в качестве отдельного фильтра, установленного в правиле жизненного цикла для применения действий к данным с тегами. Также можно объединить как префикс, так и индекс большого двоичного объекта для соответствия более конкретным наборам данных. Указание нескольких фильтров в правиле жизненного цикла применяет логическую операцию и. Действие будет применено только в том случае, если *все* условия фильтра совпадают.

Следующий пример правила управления жизненным циклом применяется к блочным BLOB-объектам в контейнере с именем *видеофилес*. Уровни правил позволяют хранить большие двоичные объекты в архивном хранилище только в том случае, если данные соответствуют критериям тега индекса большого двоичного объекта `"Status" == 'Processed' AND "Source" == 'RAW'` .

# <a name="portal"></a>[Портал](#tab/azure-portal)

![Пример правила соответствия индекса больших двоичных объектов для управления жизненным циклом в портал Azure](media/storage-blob-index-concepts/blob-index-lifecycle-management-example.png)

# <a name="json"></a>[JSON](#tab/json)

```json
{
    "rules": [
        {
            "enabled": true,
            "name": "ArchiveProcessedSourceVideos",
            "type": "Lifecycle",
            "definition": {
                "actions": {
                    "baseBlob": {
                        "tierToArchive": {
                            "daysAfterModificationGreaterThan": 0
                        }
                    }
                },
                "filters": {
                    "blobIndexMatch": [
                        {
                            "name": "Status",
                            "op": "==",
                            "value": "Processed"
                        },
                        {
                            "name": "Source",
                            "op": "==",
                            "value": "RAW"
                        }
                    ],
                    "blobTypes": [
                        "blockBlob"
                    ],
                    "prefixMatch": [
                        "videofiles/"
                    ]
                }
            }
        }
    ]
}
```

---

## <a name="permissions-and-authorization"></a>Разрешения и авторизация

Вы можете авторизовать доступ к тегам индекса больших двоичных объектов, используя один из следующих подходов:

- Использование управления доступом на основе ролей Azure (Azure RBAC) для предоставления разрешений субъекту безопасности Azure Active Directory (Azure AD). Используйте Azure AD для обеспечения высокого уровня безопасности и простоты в использовании. Дополнительные сведения об использовании Azure AD с операциями BLOB-объектов см. в разделе [авторизация доступа к BLOB-объектам и очередям с помощью Azure Active Directory](../common/storage-auth-aad.md).
- Использование подписанного URL-адрес (SAS) для делегирования доступа к индексу большого двоичного объекта. Дополнительные сведения о подписанных URL-адресах см. в статье об [использование подписанных URL-адресов SAS в службе хранилища Azure](../common/storage-sas-overview.md).
- Использование ключей доступа к учетной записи для авторизации операций с общим ключом. Дополнительные сведения см. в статье [Авторизация с помощью общего ключа](/rest/api/storageservices/authorize-with-shared-key).

Теги индекса больших двоичных объектов являются подресурсом для данных больших двоичных объектов. Пользователь с разрешениями или маркером SAS для чтения или записи больших двоичных объектов может не иметь доступа к тегам индекса больших двоичных объектов.

### <a name="role-based-access-control"></a>Управление доступом на основе ролей

Вызывающим объектам, использующим [удостоверение Azure AD](../common/storage-auth-aad.md) , могут быть предоставлены следующие разрешения на работу с тегами индекса BLOB-объектов.

| Операции с тегами индекса больших двоичных объектов                                          | Действие Azure RBAC                                                             |
|--------------------------------------------------------------------|-------------------------------------------------------------------------------|
| [Задать теги больших двоичных объектов](/rest/api/storageservices/set-blob-tags)           | Microsoft. Storage/storageAccounts/Блобсервицес/Containers/blobs/Tags/запись    |
| [Получение тегов больших двоичных объектов](/rest/api/storageservices/get-blob-tags)           | Microsoft. Storage/storageAccounts/Блобсервицес/контейнеры/BLOB-объекты/Теги/чтение     |
| [Поиск больших двоичных объектов по тегам](/rest/api/storageservices/find-blobs-by-tags) | Microsoft. Storage/storageAccounts/Блобсервицес/Containers/blobs/Filter/действие |

Для операций с тегами индекса требуются дополнительные разрешения, отделенные от базовых данных большого двоичного объекта. Роли [владельца данных BLOB-объекта хранилища](/azure/role-based-access-control/built-in-roles#storage-blob-data-owner) предоставляются разрешения для всех трех операций тегов индекса больших двоичных объектов. [Модулю чтения BLOB-объектов хранилища](/azure/role-based-access-control/built-in-roles#storage-blob-data-reader) предоставляются только разрешения `Find Blobs by Tags` для `Get Blob Tags` операций и.

### <a name="sas-permissions"></a>Разрешения SAS

Вызывающим объектам, использующим [подписанный URL-адрес (SAS)](../common/storage-sas-overview.md) , могут быть предоставлены разрешения для выполнения тегов индекса больших двоичных объектов.

#### <a name="blob-sas"></a>SAS BLOB-объекта

Следующие разрешения могут быть предоставлены в SAS большого двоичного объекта, чтобы разрешить доступ к тегам индекса BLOB-объектов. Только разрешения на чтение и запись больших двоичных объектов недостаточно, чтобы разрешить чтение или запись тегов индекса.

| Разрешение | Символ URI | Разрешенные операции                |
|------------|------------|-----------------------------------|
| Теги индекса |     t      | Получение и задание тегов индекса для большого двоичного объекта |

#### <a name="container-sas"></a>SAS контейнера

Чтобы разрешить фильтрацию по тегам больших двоичных объектов, можно предоставить следующие разрешения в SAS контейнера. `Blob List`Разрешение недостаточно, чтобы разрешить фильтрацию больших двоичных объектов по тегам индекса.

| Разрешение | Символ URI | Разрешенные операции         |
|------------|------------|----------------------------|
| Теги индекса |     f      | Поиск больших двоичных объектов с помощью тегов индекса |

## <a name="choosing-between-metadata-and-blob-index-tags"></a>Выбор между метаданными и тегами индекса больших двоичных объектов

Теги индекса больших двоичных объектов и метаданные предоставляют возможность хранения произвольных определяемых пользователем свойств ключа и значений вместе с ресурсом большого двоичного объекта. Они могут быть получены и заданы напрямую без возврата или изменения содержимого большого двоичного объекта. Можно использовать метаданные и теги индекса.

Только теги индекса автоматически индексируются и становятся доступными для поиска в собственной службе хранилища BLOB-объектов. Метаданные не могут индексироваться и выполнять поиск в собственном режиме. Необходимо использовать отдельную службу, например [Поиск Azure](../../search/search-blob-ai-integration.md). Теги индекса больших двоичных объектов имеют дополнительные разрешения для чтения, фильтрации и записи, которые отделены от базовых данных больших двоичных объектов. Метаданные используют те же разрешения, что и BLOB-объект, и возвращаются в виде заголовков HTTP с помощью операций [получения большого двоичного объекта](/rest/api/storageservices/get-blob) и [получения свойств больших двоичных объектов](/rest/api/storageservices/get-blob-properties) . Теги индекса больших двоичных объектов шифруются при хранении с помощью [ключа, управляемого корпорацией Майкрософт](../common/storage-service-encryption.md). Метаданные шифруются при хранении с использованием того же ключа шифрования, который указан для данных большого двоичного объекта.

В следующей таблице перечислены различия между метаданными и тегами индекса больших двоичных объектов.

|              |   Метаданные   |   Теги индекса больших двоичных объектов  |
|--------------|--------------|--------------------|
| **Ограничения**      | Без числового ограничения, 8 КБ, с учетом регистра | 10 тегов на количество больших двоичных объектов, 768 байт на тег, с учетом регистра |
| **Обновления**    | Не допускается на уровне архива, `Set Blob Metadata` заменяет все существующие метаданные, `Set Blob Metadata` изменяет время последнего изменения большого двоичного объекта | Допускается для всех уровней доступа, `Set Blob Tags` заменяет все существующие теги, `Set Blob Tags` не изменяет время последнего изменения большого двоичного объекта |
| **Хранилище**     | Сохранение с данными большого двоичного объекта | Подресурс данных большого двоичного объекта |
| **Индексирование & запросов** | Необходимо использовать отдельную службу, например поиск Azure. | Возможности индексирования и запросов, встроенные в хранилище BLOB-объектов |
| **Шифрование** | Зашифровано при хранении с тем же ключом шифрования, который используется для данных больших двоичных объектов | Шифрование неактивных ключей с помощью ключа шифрования, управляемого корпорацией Майкрософт |
| **Цены** | Размер метаданных включается в затраты на хранилище для большого двоичного объекта. | Фиксированные затраты на тег индекса |
| **Ответ заголовка** | Метаданные возвращаются в виде заголовков в `Get Blob` и `Get Blob Properties` | Счетчик тегов, возвращаемый `Get Blob` или `Get Blob Properties` , Теги возвращаются только `Get Blob Tags` и `List Blobs` |
| **Разрешения**  | Разрешения на чтение или запись данных большого двоичного объекта расширяются на метаданные | Для чтения, фильтрации или записи тегов индекса требуются дополнительные разрешения. |
| **Именование** | Имена метаданных должны соответствовать правилам именования идентификаторов C# | Теги индекса больших двоичных объектов поддерживают более широкий диапазон буквенно-цифровых символов |

## <a name="pricing"></a>Цены

Цены на индекс BLOB-объектов доступны в общедоступной предварительной версии и могут быть изменены для обеспечения общедоступности. Вы платите за ежемесячное среднее число тегов индекса в учетной записи хранения. Для механизма индексирования не взимается никаких затрат. Запросы к `Set Blob Tags` , `Get Blob Tags` и `Find Blobs by Tags` начисляются в соответствии с соответствующими типами операций. [Дополнительные сведения см. в разделе цены на блочные BLOB](https://azure.microsoft.com/pricing/details/storage/blobs/)-объекты.

## <a name="regional-availability-and-storage-account-support"></a>Поддержка региональной доступности и учетных записей хранения

Теги индекса BLOB-объектов доступны только для учетных записей общего назначения v2 (GPv2) с отключенным иерархическое пространством имен (HNS). Учетные записи общего назначения (GPV1) не поддерживаются, но вы можете обновить любую учетную запись GPv1 до учетной записи GPv2.

Теги индекса не поддерживаются в учетных записях хранения класса Premium. Дополнительные сведения об учетных записях хранения см. в статье [Общие сведения об учетной записи хранения](../common/storage-account-overview.md).

В общедоступной предварительной версии Теги индекса больших двоичных объектов доступны только в следующих регионах:

- Центральная Канада
- Восточная Канада
- Центральная Франция
- Южная Франция

Чтобы приступить к работе, см. раздел [Использование тегов индекса больших двоичных объектов для управления и поиска данных](storage-blob-index-how-to.md).

> [!IMPORTANT]
> Чтобы использовать предварительную версию индекса больших двоичных объектов в учетных записях хранения, необходимо зарегистрировать подписку. См. раздел [условия и известные проблемы](#conditions-and-known-issues) этой статьи.

### <a name="register-your-subscription-preview"></a>Регистрация подписки (Предварительная версия)

Так как теги индекса больших двоичных объектов доступны только в общедоступной предварительной версии, необходимо зарегистрировать подписку, прежде чем использовать эту функцию. Чтобы отправить запрос, выполните следующие команды в PowerShell или интерфейсе командной строки.

#### <a name="register-by-using-powershell"></a>Регистрация с помощью PowerShell

```powershell
Register-AzProviderFeature -FeatureName BlobIndex -ProviderNamespace Microsoft.Storage
Register-AzResourceProvider -ProviderNamespace Microsoft.Storage
```

#### <a name="register-by-using-azure-cli"></a>Регистрация с помощью Azure CLI

```azurecli
az feature register --namespace Microsoft.Storage --name BlobIndex
az provider register --namespace 'Microsoft.Storage'
```

## <a name="conditions-and-known-issues"></a>Условия и известные проблемы

В этом разделе описаны известные проблемы и условия в общедоступной предварительной версии тегов индекса больших двоичных объектов. Эта функция не должна использоваться для рабочих нагрузок, пока не достигнет общедоступной версии (GA), так как поведение может измениться.

- Для предварительной версии необходимо сначала зарегистрировать подписку, прежде чем использовать индекс BLOB-объектов для вашей учетной записи хранения в регионах предварительного просмотра.
- В предварительной версии поддерживаются только учетные записи GPv2. Учетные записи больших двоичных объектов, Блоккблобстораже и HNS не поддерживаются. Учетные записи GPv1 не поддерживаются.
- При передаче страничных BLOB-объектов с тегами индекса теги не сохраняются. Задайте теги после отправки страничного BLOB-объекта.
- Если фильтрация ограничена одним контейнером, `@container` может передаваться только в том случае, если все теги индекса в выражении фильтра являются проверками равенства (ключ = значение).
- При использовании оператора Range с `AND` условием можно указать только то же имя ключа тега индекса ( `"Age" > '013' AND "Age" < '100'` ).
- Управление версиями и индекс BLOB-объектов не поддерживается. Теги индекса больших двоичных объектов сохраняются для версий, но не передаются в обработчик индекса больших двоичных объектов.
- Отсутствует API для определения индексации тегов индекса.
- Отработка отказа учетной записи не поддерживается. После отработки отказа индекс BLOB-объекта может не обновиться должным образом.
- Управление жизненным циклом поддерживает только проверки равенства с совпадением индекса больших двоичных объектов.
- `Copy Blob` не копирует Теги индекса BLOB-объектов из исходного большого двоичного объекта в новый целевой BLOB-объект. Вы можете указать теги, которые необходимо применить к целевому большому двоичному объекту во время операции копирования.
- `Copy Blob` (Асинхронная копия) из другой учетной записи хранения с примененными тегами для целевого большого двоичного объекта обработчику индекса больших двоичных объектов не нужно возвращать большой двоичный объект и его теги в наборе фильтров. Используйте `Copy Blob` из URL-адреса (Синхронная копия).
- Теги сохраняются при создании моментального снимка. Однако повышение уровня моментального снимка не поддерживается и может привести к созданию пустого набора тегов.

## <a name="faq"></a>Вопросы и ответы

**Может ли индекс BLOB-объектов фильтровать и запрашивать содержимое в больших двоичных объектах?**

Нет, если необходимо выполнить поиск в данных большого двоичного объекта, используйте ускорение запросов или поиск Azure.

**Существуют ли какие – либо требования к значениям тегов индекса?**

Теги индекса больших двоичных объектов поддерживают только типы строковых данных и запросы возвращают результаты с лексикографическом упорядочением. Для чисел следует отпустить номер. Для даты и времени Храните в формате, совместимом с ISO 8601.

**Являются ли Теги индексов BLOB-объектов и Azure Resource Manager тегами?**

Нет, диспетчер ресурсов Теги помогают упорядочить ресурсы плоскости управления, такие как подписки, группы ресурсов и учетные записи хранения. Теги индекса обеспечивают управление BLOB-объектами и их обнаружение на плоскости данных.

## <a name="next-steps"></a>Дальнейшие действия

Пример использования индекса больших двоичных объектов см. в разделе [использование индекса больших двоичных объектов для управления и поиска данных](storage-blob-index-how-to.md).

Узнайте об [управлении жизненным циклом](storage-lifecycle-management-concepts.md) и задайте правило с сопоставлением индекса больших двоичных объектов.
