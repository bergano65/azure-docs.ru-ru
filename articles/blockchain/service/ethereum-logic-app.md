---
title: Использование соединителя Ethereum Блокчейн с Azure Logic Apps Azure Блокчейн Service
description: Сведения об использовании блокчейн-соединителя Ethereum с Azure Logic Apps для активации функций и реагирования на события смарт-контракта.
ms.date: 10/14/2019
ms.topic: article
ms.reviewer: chrisseg
ms.openlocfilehash: 4a9acfd6098ed45fd92c7e3047b5d1446eeddbd6
ms.sourcegitcommit: b77e97709663c0c9f84d95c1f0578fcfcb3b2a6c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/22/2019
ms.locfileid: "74325223"
---
# <a name="use-the-ethereum-blockchain-connector-with-azure-logic-apps"></a>Использование блокчейн-соединителя Ethereum с Azure Logic Apps

Выполняйте действия смарт-контракта и реагируйте на его события с помощью [блокчейн-соединителя Ethereum](https://docs.microsoft.com/connectors/blockchainethereum/) с [Azure Logic Apps](https://docs.microsoft.com/azure/logic-apps/). Предположим, что вам требуется создать микрослужбу на основе REST, которая возвращает сведения из реестра блокчейна. С помощью приложения логики вы можете принимать HTTP-запросы, которые запрашивают сведения, хранящиеся в реестре блокчейна.

## <a name="prerequisites"></a>предварительным требованиям

Выполните дополнительную предварительную проверку [: используйте Visual Studio Code для подключения к сети консорциума Блокчейн службы Azure](connect-vscode.md). В этом кратком руководстве описывается, как установить [Пакет средств разработки Блокчейна Azure для Ethereum](https://marketplace.visualstudio.com/items?itemName=AzBlockchain.azure-blockchain) и настроить среду разработки блокчейна.

## <a name="create-a-logic-app"></a>Создайте приложение логики

С помощью Azure Logic Apps можно планировать, автоматизировать бизнес-процессы и рабочие процессы, когда необходимо интегрировать системы и службы. Сначала создайте логику, в которой используется блокчейн-соединитель Ethereum.

1. На [портале Azure](https://portal.azure.com) выберите **Создать ресурс** > **Интеграция** > **Приложение логики**.
1. В разделе **Создание приложения логики** предоставьте сведения о расположении для приложения логики. Когда все будет готово, выберите **Создать**.

    См. сведения о [создании автоматизированных рабочих процессов с использованием Azure Logic Apps](../../logic-apps/quickstart-create-first-logic-app-workflow.md).

1. После развертывания приложения в Azure выберите ресурс приложения логики.
1. В разделе **Шаблоны** конструктора Logic Apps щелкните **Пустое приложение логики**.

Каждое приложение логики должно запускаться по триггеру, который активируется, когда происходит определенное событие или если выполняются заданные условия. При каждом срабатывании триггера обработчик Logic Apps создает экземпляр приложения логики, запускающий и выполняющий рабочий процесс.

В блокчейне-соединителе Ethereum доступен один триггер и несколько действий. Выбор триггера или действия зависит от вашего сценария.

В зависимости от назначения рабочего процесса:

* если он активируется при возникновении события в блокчейне, [используйте триггер события](#use-the-event-trigger);
* если он запрашивает или развертывает смарт-контракт, [используйте действия](#use-actions);
* если в нем используется типичный сценарий, [создайте рабочий процесс с помощью комплекта разработчика](#generate-a-workflow).

## <a name="use-the-event-trigger"></a>Использование триггера события

Если требуется, чтобы приложение логики выполнялось после возникновения события смарт-контракта, используйте триггеры событий блокчейна Ethereum. Например, при вызове функции смарт-контракта требуется отправить сообщение электронной почты.

1. В конструкторе Logic Apps выберите блокчейн-соединитель Ethereum.
1. На вкладке **Триггеры** выберите **При возникновении события смарт-контракта**.
1. Измените или [создайте подключение API](#create-an-api-connection) к службе "Блокчейн Azure".
1. Введите сведения о смарт-контракте, в котором вы будете проверять наличие событий.

    ![Конструктор Logic Apps, где отображаются свойства триггера событий](./media/ethereum-logic-app/event-properties.png)

    | Свойство | ОПИСАНИЕ |
    |----------|-------------|
    | **ABI контракта** | Двоичный интерфейс приложения (ABI) контракта определяет интерфейсы смарт-контракта. См. сведения о [получении ABI контракта](#get-the-contract-abi). |
    | **Адрес смарт-контракта** | Адрес контракта — это адрес назначения смарт-контракта в блокчейне Ethereum. См. сведения о [получении адреса контракта](#get-the-contract-address). |
    | **Имя события** | Выберите событие смарт-контракта, которое вы будете проверять. Событие активирует приложение логики. |
    | **Интервал** и **Частота** | Выберите частоту проверки события. |

1. Щелкните **Сохранить**.

Чтобы завершить создание приложения логики, можно добавить новый шаг, выполняющий действие на основе триггера события блокчейна Ethereum. Например, можно отправить сообщение электронной почты.

## <a name="use-actions"></a>Использование действий

Используйте действия блокчейна Ethereum, если требуется, чтобы приложение логики выполняло действие в реестре блокчейна. Например, требуется создать микрослужбу на основе REST, которая вызывает функцию смарт-контракта при выполнении HTTP-запроса к приложению логики.

Для действий соединителя требуется триггер. Действие блокчейн-соединителя Ethereum можно использовать в качестве следующего шага после триггера, например триггера HTTP-запроса к микрослужбе.

1. В конструкторе приложений логики щелкните элемент **Новый шаг** рядом с триггером.
1. Выберите блокчейн-соединитель Ethereum.
1. На вкладке **Действия** выберите одно из доступных действий.

    ![Конструктор Logic Apps, где отображаются свойства действий](./media/ethereum-logic-app/action-properties.png)

1. Измените или [создайте подключение API](#create-an-api-connection) к службе "Блокчейн Azure".
1. В зависимости от выбранного действия укажите следующие сведения о функции смарт-контракта.

    | Свойство | ОПИСАНИЕ |
    |----------|-------------|
    | **ABI контракта** | ABI контракта определяет интерфейсы смарт-контракта. См. сведения о [получении ABI контракта](#get-the-contract-abi). |
    | **Байт-код контракта** | Скомпилированный байт-код смарт-контракта. См. сведения о [получении байт-кода контракта](#get-the-contract-bytecode). |
    | **Адрес смарт-контракта** | Адрес контракта — это адрес назначения смарт-контракта в блокчейне Ethereum. См. сведения о [получении адреса контракта](#get-the-contract-address). |
    | **Имя функции смарт-контракта** | Выберите имя функции смарт-контракта для действия. Список заполняется сведениями в интерфейсе ABI контракта. |

    После выбора имени функции смарт-контракта могут отобразиться обязательные поля для параметров функции. Введите значения или динамическое содержимое, необходимое для вашего сценария.

Теперь вы можете использовать приложение логики. При активации события приложения логики запускается действие блокчейна Ethereum. Например, триггер HTTP-запроса запускает действие блокчейна Ethereum для получения значения состояния смарт-контракта. В ответ на запрос предоставляется HTTP-ответ с нужным значением.

## <a name="generate-a-workflow"></a>Создание рабочего процесса

Пакет средств разработки Azure для блокчейна для расширения Visual Studio Code Ethereum может создавать рабочие процессы приложения логики для распространенных сценариев. Здесь доступны четыре сценария:

* публикация данных в экземпляре Базы данных SQL Azure;
* публикация событий в экземпляре Сетки событий Azure или Служебной шины Azure;
* публикация отчетов;
* микрослужба на основе REST.

 Пакет средств разработки Azure для блокчейна использует Truffle для упрощения разработки блокчейна. Чтобы создать приложение логики на основе смарт-контракта, требуется решение Truffle для смарт-контракта. Вам также потребуется подключение к сети консорциума службы "Блокчейн Azure". См. сведения о [подключении к сети консорциума службы "Блокчейн Azure" с помощью Visual Studio Code](connect-vscode.md).

Например, с помощью следующих действий можно создать приложение логики микрослужб на основе REST, основанное на смарт-контракте **HelloBlockchain** краткого руководства:

1. На боковой панели обозревателя Visual Studio Code разверните папку **contracts** своего решения:
1. Щелкните правой кнопкой мыши файл **HelloBlockchain.sol** и в меню выберите пункт **Создать микрослужбы для смарт-контрактов**.

    ![Панель Visual Studio Code, где выбрано действие создания микрослужб для смарт-контрактов](./media/ethereum-logic-app/generate-logic-app.png)

1. На палитре команд щелкните **Приложение логики**.
1. Введите **адрес контракта**. См. сведения о [получении адреса контракта](#get-the-contract-address).
1. Выберите подписку и группу ресурсов Azure для приложения логики.

    В каталоге **generatedLogicApp** создается конфигурация приложения логики и файлы кода.

1. Просмотрите каталог **generatedLogicApp/HelloBlockchain**. Для каждой функции, события и свойства смарт-контракта существует JSON-файл приложения логики.
1. Откройте файл **generatedLogicApp/HelloBlockchain/Service/property.RequestMessage.logicapp.json** и скопируйте содержимое.

    ![JSON-файл с кодом, который нужно скопировать](./media/ethereum-logic-app/requestmessage.png)

1. В приложении логики выберите **Представление кода приложения логики**. Замените имеющийся JSON-файл созданным JSON-файлом приложения логики.

    ![Представление кода приложения логики, где уже заменен код приложения](./media/ethereum-logic-app/code-view.png)

1. Выберите **Конструктор**, чтобы переключиться в представление конструктора.
1. Приложение логики содержит основные шаги для сценария. Но вам нужно обновить сведения о конфигурации для блокчейн-соединителя Ethereum.
1. Выберите шаг **Подключения** и измените или [создайте подключение API](#create-an-api-connection) к службе "Блокчейн Azure".

    ![Представление конструктора, где выбран элемент "Подключения"](./media/ethereum-logic-app/microservice-logic-app.png)

1. Теперь вы можете использовать приложение логики. Чтобы протестировать микрослужбу на основе REST, отправьте запрос HTTP POST к URL-адресу запроса приложения логики. Скопируйте содержимое поля **URL-адрес HTTP POST** из шага **При получении HTTP-запроса**.

    ![Панель конструктора Logic Apps, где представлен URL-адрес HTTP POST](./media/ethereum-logic-app/post-url.png)

1. Создайте запрос HTTP POST с помощью cURL. Замените текст заполнителя *\<URL-адрес HTTP POST\>* URL-адресом из предыдущего шага.

    ``` bash
    curl -d "{}" -H "Content-Type: application/json" -X POST "<HTTP POST URL>"
    ```

    Команда cURL возвращает ответ от приложения логики. В этом случае в качестве ответа возвращаются выходные данные функции смарт-контракта **RequestMessage**.

    ![Выходные данные функции смарт-контракта RequestMessage](./media/ethereum-logic-app/curl.png)

См. сведения об [использовании Пакета средств разработки блокчейна Azure для Ethereum](https://github.com/Microsoft/vscode-azure-blockchain-ethereum/wiki).

## <a name="create-an-api-connection"></a>Создание подключения API

Для блокчейн-соединителя Ethereum требуется подключение API к блокчейну. Соединитель API можно использовать для нескольких приложений логики. Некоторые свойства являются обязательными, а другие зависят от вашего сценария.

> [!IMPORTANT]
> Для создания транзакций в блокчейне требуются закрытый ключ или адрес учетной записи и пароль. Требуется только одна форма проверки подлинности. Вам не нужно предоставлять закрытый ключ и сведения об учетной записи. Для запросов контрактов транзакция не требуется. Если вы используете действия, которые запрашивают сведения о состоянии контракта, закрытый ключ или адрес учетной записи и пароль не требуются.

Чтобы настроить подключение к участнику службы "Блокчейн Azure", используйте доступные свойства из следующего списка с учетом своего сценария.

| Свойство | ОПИСАНИЕ |
|----------|-------------|
|**Имя подключения** | Имя подключения API. обязательный параметр. |
|**Конечная точка Ethereum RPC** | HTTP-адрес узла транзакций службы "Блокчейн Azure". обязательный параметр. См. сведения о [получении конечной точки RPC](#get-the-rpc-endpoint). |
|**Закрытый ключ** | Закрытый ключ учетной записи Ethereum. Для транзакций требуются закрытый ключ, адрес учетной записи и пароль. См. сведения о [получении закрытого ключа](#get-the-private-key). |
|**Адрес учетной записи** | Адрес учетной записи участника службы "Блокчейн Azure". Для транзакций требуются закрытый ключ, адрес учетной записи и пароль. См. сведения о [получении адреса учетной записи](#get-the-account-address). |
|**Пароль учетной записи** | Пароль учетной записи задается при создании участника. Сведения о сбросе пароля см. в разделе [Учетная запись Ethereum](consortium.md#ethereum-account).|

## <a name="get-the-rpc-endpoint"></a>Получение конечной точки RPC

Для подключения к сети блокчейна требуется адрес конечной точки RPC службы "Блокчейн Azure". Адрес конечной точки можно получить с помощью Пакета средств разработки Блокчейна Azure для Ethereum или на портале Azure.

**Пакет средств разработки:**

1. В разделе **Служба "Блокчейн Azure"** в Visual Studio Code щелкните правой кнопкой мыши консорциум.
1. Щелкните **Копировать адрес конечной точки RPC**.

    ![Панель Visual Studio Code, где отображается консорциум с выбранным действием "Копировать адрес конечной точки RPC"](./media/ethereum-logic-app/devkit-rpc.png)

    Конечная точка RPC скопируется в буфер обмена.

**Портал Azure:**

1. Войдите на [портале Azure](https://portal.azure.com).
1. Перейдите в область участника службы "Блокчейн Azure". Выберите **Transaction nodes** (Узлы транзакций) и щелкните ссылку на узел транзакций по умолчанию.

    ![Страница узлов транзакций, где выбран узел по умолчанию](./media/ethereum-logic-app/transaction-nodes.png)

1. Последовательно выберите **Строки подключения** > **Ключи доступа**.
1. Скопируйте адрес конечной точки из раздела **HTTPS (ключ доступа 1)** или **HTTPS (ключ доступа 2)** .

    ![Портал Azure, где открыты ключи доступа для строки подключения](./media/ethereum-logic-app/connection-string.png)

    Конечная точка RPC представляет собой URL-адрес HTTPS, который содержит адрес и ключ доступа к узлу транзакций участника службы "Блокчейн Azure".

## <a name="get-the-private-key"></a>Получение закрытого ключа

Закрытый ключ учетной записи Ethereum можно использовать для проверки подлинности при отправке транзакции в блокчейн. Открытый и закрытый ключи учетной записи Ethereum создаются из назначенного набора 12 слов. Этот назначенный набор создается Пакетом средств разработки Блокчейна Azure для Ethereum при подключении к участнику консорциума службы "Блокчейн Azure". Адрес конечной точки можно получить с помощью расширения комплекта SDK.

1. Откройте палитру команд (F1) в Visual Studio Code.
1. Выберите **Azure блокчейн: Получение закрытого ключа**.
1. Выберите назначенный набор, который вы сохранили при подключении к участнику консорциума.

    ![Палитра команд с возможностью выбрать символ](./media/ethereum-logic-app/private-key.png)

    Закрытый ключ скопируется в буфер обмена.

## <a name="get-the-account-address"></a>Получение адреса учетной записи

Вы можете использовать учетную запись и пароль участника для проверки подлинности при отправке транзакции в блокчейн. Пароль задается при создании участника.

1. На портале Azure перейдите на страницу обзора службы "Блокчейн Azure".
1. Скопируйте адрес **учетной записи участника**.

    ![Страница сводных сведений с адресом учетной записи участника](./media/ethereum-logic-app/member-account.png)

Дополнительные сведения об адресе и пароле учетной записи см. в разделе [Учетная запись Ethereum](consortium.md#ethereum-account).

## <a name="get-the-contract-abi"></a>Получение ABI контракта

ABI контракта определяет интерфейсы смарт-контракта. В нем описывается взаимодействие со смарт-контрактом. ABI контракта можно получить с помощью Пакета средств разработки Блокчейна Azure для Ethereum. Также его можно извлечь из файла метаданных контракта, который создается компилятором Solidity.

**Пакет средств разработки:**

Если для создания смарт-контракта использовался комплект SDK или Truffle, вы можете скопировать интерфейс ABI контракта в буфер обмена с помощью расширения.

1. На панели обозревателя Visual Studio Code разверните папку **build/contracts** проекта Solidity.
1. Правой кнопкой мыши щелкните JSON-файл метаданных контракта. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Щелкните **Скопировать ABI контракта**.

    ![Панель Visual Studio Code, где выбрано действие "Скопировать ABI контракта"](./media/ethereum-logic-app/abi-devkit.png)

    ABI контракта скопируется в буфер обмена.

**Файл метаданных контракта:**

1. Откройте файл метаданных контракта, содержащийся в папке **build/contracts** проекта Solidity. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Найдите раздел **abi** в файле JSON.
1. Скопируйте массив JSON **abi**.

    ![Код ABI в файле метаданных контракта](./media/ethereum-logic-app/abi-metadata.png)

## <a name="get-the-contract-bytecode"></a>Получение байт-кода контракта

Байт-код контракта — это скомпилированный смарт-контракт, выполняемый виртуальной машиной Ethereum. Байт-код контракта можно получить с помощью Пакета средств разработки Блокчейна Azure для Ethereum. Также его можно извлечь из компилятора Solidity.

**Пакет средств разработки:**

Если для создания смарт-контракта использовался комплект SDK или Truffle, вы можете скопировать байт-код контракта в буфер обмена с помощью расширения.

1. На панели обозревателя Visual Studio Code разверните папку **build/contracts** проекта Solidity.
1. Правой кнопкой мыши щелкните JSON-файл метаданных контракта. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Щелкните **Скопировать байт-код контракта**.

    ![Панель Visual Studio Code, где выбрано действие "Скопировать байт-код контракта"](./media/ethereum-logic-app/bytecode-devkit.png)

    Байт-код контракта скопируется в буфер обмена.

**Файл метаданных контракта:**

1. Откройте файл метаданных контракта, содержащийся в папке **build/contracts** проекта Solidity. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Найдите элемент **bytecode** в файле JSON.
1. Скопируйте значение **bytecode**.

    ![Панель Visual Studio Code, где представлен байт-код в составе метаданных](./media/ethereum-logic-app/bytecode-metadata.png)

**С использованием компилятора Solidity:**

Чтобы создать байт-код контракта, используйте команду `solc --bin <smart contract>.sol`.

## <a name="get-the-contract-address"></a>Получение адреса контракта

Адрес контракта — это адрес назначения смарт-контракта в блокчейне Ethereum. Этот адрес используется для отправки транзакции или запроса состояния смарт-контракта. Адрес контракта можно получить из выходных данных миграции Truffle или файла метаданных контракта.

**Выходные данные миграции Truffle:**

Truffle отображает адрес контракта после развертывания смарт-контракта. Скопируйте **адрес контракта** из выходных данных.

![Выходные данные миграции Truffle в Visual Studio Code, где представлен адрес контракта](./media/ethereum-logic-app/contract-address-truffle.png)

**Файл метаданных контракта:**

1. Откройте файл метаданных контракта, содержащийся в папке **build/contracts** проекта Solidity. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Найдите раздел **networks** в файле JSON.
1. Частные сети определяются по целочисленному идентификатору сети. Найдите значение адреса в разделе сети.
1. Скопируйте значение **address**.

![Метаданные в Visual Studio Code, где представлено значение адреса](./media/ethereum-logic-app/contract-address-metadata.png)

## <a name="next-steps"></a>Дополнительная информация

Просмотрите видео о [распространенных сценариях работы с Logic Apps](https://channel9.msdn.com/Shows/Blocktalk/Doing-more-with-Logic-Apps?term=logic%20apps%20blockchain&lang-en=true).
