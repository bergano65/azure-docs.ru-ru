---
title: Настройка Диспетчер данных Блокчейн с помощью портал Azure Azure Блокчейн Service
description: Создание Диспетчер данных Блокчейн для службы Блокчейн Azure и управление им с помощью портал Azure.
ms.date: 11/04/2019
ms.topic: article
ms.reviewer: chroyal
ms.openlocfilehash: 03c22a7a23f1579a846746f21ce048b3425399c3
ms.sourcegitcommit: 5ab4f7a81d04a58f235071240718dfae3f1b370b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2019
ms.locfileid: "74977031"
---
# <a name="configure-blockchain-data-manager-using-the-azure-portal"></a>Настройка диспетчера данных блокчейна с помощью портала Azure

Настройте Диспетчер данных Блокчейн для службы Блокчейн Azure, чтобы записать данные блокчейн и отправить их в службу "Сетка событий Azure".

Чтобы настроить экземпляр Диспетчер данных Блокчейн, сделайте следующее:

* Создание экземпляра Диспетчер данных Блокчейн для узла транзакции службы Блокчейн Azure
* Добавление приложений блокчейн

## <a name="prerequisites"></a>Технические условия

* Полное [руководство. Создание члена блокчейн с помощью портал Azure](create-member.md) или [краткого руководства: создание члена Блокчейн службы блокчейн Azure с помощью Azure CLI](create-member-cli.md)
* Создайте [раздел Сетки событий](../../event-grid/custom-event-quickstart-portal.md#create-a-custom-topic).
* Подробные сведения см. в статье об [обработчиках событий в службе "Сетка событий Azure"](../../event-grid/event-handlers.md).

## <a name="create-instance"></a>Создание экземпляра

Каждый экземпляр диспетчера данных блокчейна подключается к узлу транзакций службы "Блокчейн Azure" и отслеживает его. Только пользователи с доступом к узлу транзакции могут создать подключение. Экземпляр регистрирует все необработанные данные о блоках и транзакциях из узла транзакций.

Исходящее подключение отправляет данные блокчейна в службу "Сетка событий Azure". При создании экземпляра вы настраиваете одно исходящее подключение. Диспетчер данных блокчейна для каждого отдельного экземпляра поддерживает несколько исходящих подключений к разделам Сетки событий. Данные блокчейна можно отправлять в одно или несколько назначений. Чтобы добавить другое назначение, просто добавьте дополнительные исходящие подключения к экземпляру.

1. Войдите на [портале Azure](https://portal.azure.com).
1. Перейдите к члену службы Azure Блокчейн, который вы хотите подключить к Блокчейн Диспетчер данных. Щелкните **Blockchain Data Manager** (Диспетчер данных блокчейна).
1. Выберите **Добавить**.

    ![Добавление диспетчера данных блокчейна](./media/data-manager-portal/add-instance.png)

    Введите следующие сведения:

    Параметр | Описание
    --------|------------
    Name | Введите уникальное имя для подключенного диспетчера данных блокчейна. Имя Диспетчер данных Блокчейн может содержать строчные буквы и цифры и имеет длину не более 20 символов.
    Узел транзакции | Выберите узел транзакции. Отображаются только узлы транзакций, у которых есть доступ на чтение.
    Имя подключения | Введите уникальное имя исходящего подключения, в которое отправляются данные транзакций блокчейна.
    Конечная точка Сетки событий | Выберите раздел сетки событий в той же подписке, что и экземпляр Диспетчер данных Блокчейн.

1. Нажмите кнопку **ОК**.

    Создание экземпляра диспетчера данных блокчейна занимает менее минуты. Когда завершается развертывание экземпляра, он запускается автоматически. Выполняющийся экземпляр Диспетчер данных Блокчейн захватывает события блокчейн из узла Transaction и отправляет данные в исходящие подключения.

    Новый экземпляр появится в списке экземпляров Блокчейн Диспетчер данных для члена службы Блокчейн Azure.

    ![Список экземпляров элементов данных Блокчейн](./media/data-manager-portal/instance-list.png)

## <a name="add-blockchain-application"></a>Добавление приложения блокчейн

При добавлении приложения блокчейн Блокчейн Диспетчер данных декодирует события и состояние свойства для приложения. В противном случае отправляются только данные необработанных блоков и необработанных транзакций. Блокчейн Диспетчер данных также обнаруживает контрактные адреса при развертывании контракта. К экземпляру Диспетчер данных Блокчейн можно добавить несколько приложений блокчейн.

> [!IMPORTANT]
> В настоящее время блокчейн приложения, объявляющие [типы массивов](https://solidity.readthedocs.io/en/v0.5.12/types.html#arrays) или [типов сопоставлений](https://solidity.readthedocs.io/en/v0.5.12/types.html#mapping-types) , не полностью поддерживаются. Свойства, объявленные как массив или типы сопоставления, не будут декодированы в сообщениях *контрактпропертиесмсг* или *декодедконтрактевентсмсг* .

Для добавления приложения блокчейн Диспетчер данных требуется интерфейс ABI смарт-контракта и развернутый файл байтового кода.

### <a name="get-contract-abi-and-bytecode"></a>Получение интерфейса ABI и байтового кода контракта

ABI контракта определяет интерфейсы смарт-контракта. В нем описывается взаимодействие со смарт-контрактом. ABI контракта можно скопировать в буфер обмена через [расширение Пакета средств разработки Блокчейна Azure для Ethereum](https://marketplace.visualstudio.com/items?itemName=AzBlockchain.azure-blockchain).

1. На панели обозревателя Visual Studio Code разверните папку **build/contracts** проекта Solidity.
1. Правой кнопкой мыши щелкните JSON-файл метаданных контракта. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Щелкните **Скопировать ABI контракта**.

    ![Панель Visual Studio Code, где выбрано действие "Скопировать ABI контракта"](./media/data-manager-portal/abi-devkit.png)

    ABI контракта скопируется в буфер обмена.

1. Сохраните массив **abi** в JSON-файл. Например, с именем *abi.json*. Он понадобится вам на одном из следующих шагов.

Диспетчеру данных блокчейна нужен развернутый байт-код для смарт-контракта. Развернутый байт-код отличается от байт-кода смарт-контракта. Чтобы скопировать байт в буфер обмена, используйте расширение пакета средств разработки Azure блокчейн.

1. На панели обозревателя Visual Studio Code разверните папку **build/contracts** проекта Solidity.
1. Правой кнопкой мыши щелкните JSON-файл метаданных контракта. Имя файла — это имя смарт-контракта, за которым следует расширение **.json**.
1. Выберите **Копировать байты транзакции**.

    ![Панель Visual Studio Code с выделением байта копии для транзакции копирования](./media/data-manager-portal/bytecode-devkit.png)

    Байт-код копируется в буфер обмена.

1. Сохраните **байт-код** в виде JSON-файла. Например, с именем *bytecode.json*. Он понадобится вам на одном из следующих шагов.

В следующем примере показаны файлы *abi.json* и *bytecode.json*, открытые в редакторе VS Code. Ваши файлы должны выглядеть примерно так же.

![Пример содержимого файлов abi.json и bytecode.json](./media/data-manager-portal/contract-files.png)

### <a name="create-contract-abi-and-bytecode-url"></a>Создание ABI и URL-адреса байт-кода контракта

Диспетчеру данных блокчейна при добавлении приложения нужно, чтобы файлы ABI и байт-кода для контракта были доступны по URL-адресу. Для предоставления частного URL-адреса можно использовать учетную запись хранения Azure.

#### <a name="create-storage-account"></a>Создание учетной записи хранения

[!INCLUDE [storage-create-account-portal-include](../../../includes/storage-create-account-portal-include.md)]

#### <a name="upload-contract-files"></a>Отправка файлов контракта

1. Создайте новый контейнер для учетной записи хранения. Выберите **Контейнеры > Контейнер**.

    ![Создание контейнера учетной записи хранения](./media/data-manager-portal/create-container.png)

    | Поле | Описание |
    |-------|-------------|
    | Name  | Присвойте контейнеру имя, например *smartcontract*. |
    | Public access level (Уровень общего доступа) | Выберите *Private (no anonymous access)* (Частный (без анонимного доступа)). |

1. Нажмите кнопку **ОК**, чтобы создать контейнер.
1. Выберите контейнер и щелкните **Отправить**.
1. Выберите оба файла JSON, которые вы создали в разделе, посвященном [получению ABI и байт-кода контракта](#get-contract-abi-and-bytecode).

    ![Отправка большого двоичного объекта](./media/data-manager-portal/upload-blobs.png)

    Щелкните **Отправить**.

#### <a name="generate-url"></a>Создание URL-адреса

Создайте подписанный URL-адрес для каждого большого двоичного объекта.

1. Выберите большой двоичный объект с кодом JSON для ABI.
1. Щелкните **Создать SAS**.
1. Задайте требуемый срок действия подписи доступа, и щелкните **Создать маркер SAS BLOB-объекта и URL-адрес**.

    ![Создание маркера SAS](./media/data-manager-portal/generate-sas.png)

1. Создайте **URL-адрес SAS BLOB-объекта** и сохраните его для использования в следующем разделе.
1. Повторите шаги [по созданию URL-адреса](#generate-url) для большого двоичного объекта с кодом JSON для байт-кода.

### <a name="add-application-to-instance"></a>Добавить приложение в экземпляр

1. Выберите экземпляр диспетчера данных блокчейна из списка экземпляров.
1. Выберите **Blockchain applications** (Приложения блокчейна).
1. Выберите **Добавить**.

    ![Добавление приложения блокчейна](./media/data-manager-portal/add-application.png)

    Введите имя приложения блокчейна и URL-адреса ABI и байт-кода для смарт-контракта.

    Параметр | Описание
    --------|------------
    Name | Введите уникальное имя приложения блокчейна, которое нужно отслеживать.
    Contract ABI (ABI контракта) | URL-адрес файла ABI контракта. Подробные сведения см. в разделе о [создании ABI и URL-адреса байт-кода контракта](#create-contract-abi-and-bytecode-url).
    Contract Bytecode (Байт-код контракта) | URL-путь к файлу байт-кода. Подробные сведения см. в разделе о [создании ABI и URL-адреса байт-кода контракта](#create-contract-abi-and-bytecode-url).

1. Нажмите кнопку **ОК**.

    Когда приложение будет создано, оно появится в списке приложений блокчейна.

    ![Список приложений блокчейна](./media/data-manager-portal/artifact-list.png)

Вы можете удалить учетную запись хранения Azure или использовать ее для настройки других приложений блокчейна. Если вы хотите удалить учетную запись хранения Azure, можно сразу удалить группу ресурсов. При этом удаляется связанная учетная запись хранения и другие ресурсы, связанные с этой группой ресурсов.

## <a name="stop-instance"></a>Останавливает экземпляр

Если необходимо отключить запись событий блокчейн и отправку данных в исходящие подключения, то следует закрыть экземпляр Блокчейн Manager. Когда экземпляр остановлен, плата за Диспетчер данных Блокчейн не взимается. Дополнительные сведения см. на странице [цен](https://azure.microsoft.com/pricing/details/blockchain-service).

1. Перейдите к разделу **Обзор** и выберите пункт **Закрыть**.

    ![Останавливает экземпляр](./media/data-manager-portal/stop-instance.png)

## <a name="next-steps"></a>Дальнейшие действия

Попробуйте следующее руководство по созданию обозревателя сообщений блокчейн TRANSACTION с помощью Блокчейн Диспетчер данных и Azure Cosmos DB.

> [!div class="nextstepaction"]
> [Использование Диспетчер данных Блокчейн для отправки данных в Azure Cosmos DB](data-manager-cosmosdb.md)