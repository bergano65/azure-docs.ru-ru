---
title: Автоматическая подготавливает устройства Windows с помощью DPS-Azure IoT Edge | Документация Майкрософт
description: Использование имитированного устройства на компьютере Windows для тестирования автоматической подготовки устройств для Azure IoT Edge с помощью Службы подготовки устройств к добавлению в Центр Интернета вещей
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 01/09/2019
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: ad92d4cf0d5b61c778b87114d4be6c23557f8e26
ms.sourcegitcommit: 12d902e78d6617f7e78c062bd9d47564b5ff2208
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/24/2019
ms.locfileid: "74457136"
---
# <a name="create-and-provision-a-simulated-iot-edge-device-with-a-virtual-tpm-on-windows"></a>Создание и инициализация имитации устройства IoT Edge с помощью виртуального доверенного платформенного модуля в Windows

Устройства Azure IoT Edge можно подготовить автоматически с помощью [Службы подготовки устройств к добавлению в Центр Интернета вещей](../iot-dps/index.yml) точно так же, как и другие устройства. При необходимости ознакомьтесь с [процессом автоматической подготовки](../iot-dps/concepts-auto-provisioning.md), прежде чем продолжить.

Служба DPS поддерживает симметричную аттестацию ключей для IoT Edge устройств как отдельной регистрации, так и групповой регистрации. Если для групповой регистрации выбран параметр "это IoT Edge устройство" в аттестации симметричного ключа, все устройства, зарегистрированные в этой группе регистрации, будут помечены как IoT Edgeные. 

В этой статье показано, как протестировать автоматическую подготовку на имитации устройства IoT Edge, выполнив следующие действия.

* Создание экземпляра Службы подготовки устройств к добавлению в Центр Интернета вещей.
* Создание имитированного устройства на компьютере Windows с имитированным доверенным платформенным модулем (TPM) для обеспечения безопасности оборудования.
* Создание отдельной регистрации устройства.
* Установка среды выполнения IoT Edge и подключение устройства к Центру Интернета вещей.

> [!NOTE]
> TPM 2,0 необходим при использовании аттестации доверенного платформенного модуля с DPS и может использоваться только для создания отдельных, а не групп, регистраций.

> [!TIP]
> В этой статье описывается тестирование автоматической подготовки с помощью аттестации TPM на виртуальных устройствах, но многие из них применяются и при использовании физического аппаратного обеспечения TPM.

## <a name="prerequisites"></a>предварительным требованиям

* Компьютер для разработки Windows. В этой статье используется Windows 10.
* Действующий Центр Интернета вещей.

## <a name="set-up-the-iot-hub-device-provisioning-service"></a>Настройка Службы подготовки устройств к добавлению в Центр Интернета вещей

Создайте экземпляр Службы подготовки устройств к добавлению в Центр Интернета вещей в Azure и свяжите его со своим Центром Интернета вещей. Следуйте инструкциям по [настройке Службы подготовки устройств к добавлению в Центр Интернета вещей на портале Azure](../iot-dps/quick-setup-auto-provision.md).

После запуска Службы подготовки устройств к добавлению в Центр Интернета вещей скопируйте значение **Область идентификатора** на странице обзора. Это значение используется при настройке среды выполнения IoT Edge.

> [!TIP]
> При использовании физического устройства доверенного платформенного модуля необходимо определить **ключ подтверждения**, уникальный для каждого микросхемы TPM и полученный от изготовителя МИКРОсхемы TPM, связанного с ним. Можно создать уникальный **идентификатор регистрации** для устройства TPM, например, СОЗДАВ хэш SHA-256 для ключа подтверждения.
>
> Следуйте инструкциям в статье [Управление регистрацией устройств с помощью портала Azure](../iot-dps/how-to-manage-enrollments.md) , чтобы создать регистрацию в службе DPS, а затем перейдите к разделу [установка среды выполнения IOT Edge](#install-the-iot-edge-runtime) в этой статье, чтобы продолжить.

## <a name="simulate-a-tpm-device"></a>Имитация устройства TPM

Создайте имитированное устройства доверенного платформенного модуля на компьютере Windows для разработки. Получите **идентификатор регистрации** и **ключ подтверждения** для устройства и используйте их для создания отдельной записи регистрации в DPS.

При регистрации в Службе подготовки устройств к добавлению в Центр Интернета вещей есть возможность объявить **Первоначальное состояние двойника устройства**. В двойнике устройства можно задать теги для группировки устройств по любой требуемой для решения метрике, например по региону, среде, расположению или типу устройства. Эти теги используются для создания [автоматических развертываний](how-to-deploy-monitor.md).

Выберите язык пакета SDK для создания имитации устройства, а затем создайте отдельную регистрацию.

При создании отдельной регистрации выберите **значение true** , чтобы объявить, что имитируемое устройство TPM на компьютере разработки Windows является **IOT Edge устройством**.

Руководства по использованию виртуальных устройств и отдельной регистрации:

* [C](../iot-dps/quick-create-simulated-device.md)
* [Java](../iot-dps/quick-create-simulated-device-tpm-java.md)
* [C#](../iot-dps/quick-create-simulated-device-tpm-csharp.md)
* [Node.js](../iot-dps/quick-create-simulated-device-tpm-node.md)
* [Python](../iot-dps/quick-create-simulated-device-tpm-python.md)

Создав отдельную регистрацию, сохраните значение **идентификатора регистрации**. Это значение используется при настройке среды выполнения IoT Edge.

## <a name="install-the-iot-edge-runtime"></a>Установка среды выполнения IoT Edge

Среда выполнения IoT Edge развертывается на всех устройствах IoT Edge. Ее компоненты выполняются в контейнерах и позволяют развертывать дополнительные контейнеры на устройстве, чтобы обеспечить возможность выполнения кода в граничной системе.

При подготовке устройства вам потребуются следующие сведения:

* Значение **области идентификаторов** DPS
* Созданный **идентификатор регистрации** устройства

Установите среду выполнения IoT Edge на устройстве, где выполняется имитация TPM. Вы настроите среду выполнения IoT Edge для автоматического, а не ручной подготовки.

> [!TIP]
> Не закрывайте окно с запущенным симулятором TPM во время установки и тестирования.

Дополнительные сведения об установке IoT Edge в Windows, включая предварительные требования и инструкции для таких задач, как Управление контейнерами и обновление IoT Edge, см. в [статье Установка среды выполнения Azure IOT EDGE в Windows](how-to-install-iot-edge-windows.md).

1. Откройте окно PowerShell с правами администратора. Не забудьте использовать сеанс AMD64 PowerShell при установке IoT Edge, а не PowerShell (x86).

1. Команда **deploy-IoTEdge** проверяет, что компьютер Windows находится в поддерживаемой версии, включает функцию контейнеров, а затем загружает среду выполнения значок Кита и среду выполнения IOT Edge. Команда по умолчанию использует контейнеры Windows.

   ```powershell
   . {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
   Deploy-IoTEdge
   ```

1. На этом этапе устройства IoT Core могут перезапускаться автоматически. Другие устройства Windows 10 или Windows Server могут предложить перезагрузку. Если да, перезагрузите устройство прямо сейчас. Когда устройство будет готово, снова запустите PowerShell от имени администратора.

1. Команда **Initialize-IoTEdge** настраивает среду выполнения IoT Edge на вашем компьютере. По умолчанию при выполнении команды применяется подготовка вручную с помощью контейнеров Windows. Используйте флаг `-Dps`, чтобы использовать службу подготовки устройств вместо подготовки вручную.

   Замените значения заполнителей для `{scope_id}` и `{registration_id}` данными, собранными ранее.

   ```powershell
   . {Invoke-WebRequest -useb https://aka.ms/iotedge-win} | Invoke-Expression; `
   Initialize-IoTEdge -Dps -ScopeId {scope ID} -RegistrationId {registration ID}
   ```

## <a name="verify-successful-installation"></a>Проверка успешного выполнения установки

Если среда выполнения запущена успешно, можете перейти в Центр Интернета вещей и начать развертывание модулей IoT Edge на устройстве. Чтобы убедиться, что среда выполнения установлена и запущена успешно, используйте следующие команды на устройстве:  

Проверьте состояние службы IoT Edge.

```powershell
Get-Service iotedge
```

Просмотрите журналы службы за последние пять минут.

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; Get-IoTEdgeLog
```

Просмотрите список запущенных модулей.

```powershell
iotedge list
```

## <a name="next-steps"></a>Дополнительная информация

Процесс регистрации Службы подготовки устройств к добавлению в Центр Интернета вещей позволяет задать идентификатор устройства и теги двойников устройств параллельно с подготовкой нового устройства. Эти значения можно использовать для указания отдельных устройств или групп устройств с помощью автоматического управления устройствами. См. дополнительные сведения о развертывании и мониторинге модулей IoT Edge с поддержкой масштабирования с помощью [портала Azure](how-to-deploy-monitor.md) или [Azure CLI](how-to-deploy-monitor-cli.md).
