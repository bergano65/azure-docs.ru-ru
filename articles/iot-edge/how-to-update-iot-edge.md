---
title: Обновление устройств Azure IoT Edge до последней версии | Документация Майкрософт
description: Сведения об обновлении устройства IoT Edge для запуска последних версий управляющей программы безопасности и среды выполнения IoT Edge
keywords: ''
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 10/05/2018
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 1522d9c9bc4fda178d8571fb57cb9c94ed1044ae
ms.sourcegitcommit: 6b7c8b44361e87d18dba8af2da306666c41b9396
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2018
ms.locfileid: "51567797"
---
# <a name="update-the-iot-edge-runtime"></a>Обновление среды выполнения IoT Edge

Выпускаются новые версии службы IoT Edge, поэтому вам может понадобиться обновить устройства IoT Edge, чтобы воспользоваться новейшими функциями и улучшениями системы безопасности. В этой статье представлены сведения об обновлении устройств IoT Edge при наличии новой версии. 

Если вы хотите перейти на новую версию, вам необходимо обновить два компонента устройства IoT Edge. Первый компонент — управляющая программа безопасности, которая выполняется на устройстве и запускает среду выполнения при запуске устройства. В настоящее время обновить управляющую программу безопасности можно только на самом устройстве. Второй компонент — это среда выполнения, состоящая из модулей центра и агента Edge. В зависимости от структуры развертывания среду выполнения можно обновить как на устройстве, так и удаленно. 

Последнюю версию Azure IoT Edge можно найти [на сайте GitHub](https://github.com/Azure/azure-iotedge/releases).

## <a name="update-the-security-daemon"></a>Обновление управляющей программы безопасности

Управляющая программа безопасности IoT Edge — это собственный компонент, который необходимо обновить с помощью диспетчера пакетов на устройстве IoT Edge. 

Проверьте версию управляющей программы безопасности, запущенной на вашем устройстве, с помощью команды `iotedge version`. 

### <a name="linux-devices"></a>Устройства Linux

Для обновления управляющей программы безопасности на устройствах Linux используйте команду apt-get или соответствующий диспетчер пакетов. 

```bash
apt-get update
apt-get install libiothsm iotedge
```

### <a name="windows-devices"></a>Устройства Windows

На устройствах Windows удалите управляющую программу с помощью сценария PowerShell, а затем переустановите ее. Сценарий установки автоматически извлекает последнюю версию управляющей программы безопасности. Во время процесса установки вам необходимо снова указать строку подключения для своего устройства. 

Удалите управляющую программу безопасности в сеансе PowerShell администратора. 

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; `
UnInstall-SecurityDaemon
```

Переустановите управляющую программу безопасности в зависимости от контейнеров, используемых на устройстве IoT Edge: Windows или Linux. Замените фразу **\<Windows or Linux\>** операционной системой контейнера. 

```powershell
. {Invoke-WebRequest -useb aka.ms/iotedge-win} | Invoke-Expression; `
Install-SecurityDaemon -Manual -ContainerOS <Windows or Linux>
```

## <a name="update-the-runtime-containers"></a>Обновление контейнеров среды выполнения

Способ обновления контейнеров центра и агента Edge зависит от используемых тегов в развертывании: последовательные теги (например, 1.0) или конкретные теги (например, 1.0.2). 

Проверьте версию модулей агента IoT Edge и центра Edge, используемую в настоящее время на вашем устройстве, с помощью команд `iotedge logs edgeAgent` или `iotedge logs edgeHub`. 

  ![Просмотр версии контейнеров](./media/how-to-update-iot-edge/container-version.png)

### <a name="understand-iot-edge-tags"></a>Сведения о тегах IoT Edge

Образы агента и центра Edge отмечены тегами версии IoT Edge, с которой они связаны. Существует два способа использования тегов с образами среды выполнения: 

* **Последовательные теги**: используются только первые два значения номера версии для получения последнего образа, соответствующего этим цифрам. Например, 1.0 обновляется всякий раз, когда появляется новый выпуск, указывающий на последнюю версию 1.0.x. Если среда выполнения контейнера на устройстве IoT Edge снова извлекает образ, модули среды выполнения обновляются до последней версии. Такой подход рекомендуется использовать для разработки. Для развертываний с портала Azure по умолчанию установлены последовательные теги. 
* **Конкретные теги**: используются все три значения номера версии для явной установки версии образа. Например, 1.0.2 не изменится после первоначального выпуска. Вы можете объявить новый номер версии в манифесте развертывания, когда будете готовы к обновлению. Такой подход рекомендуется использовать для производственных целей.

### <a name="update-a-rolling-tag-image"></a>Обновление образа последовательного тега

Если вы используете последовательные теги в своем развертывании (например, mcr.microsoft.com/azureiotedge-hub:**1.0**), вам необходимо принудительно запустить среду выполнения контейнера на устройстве, чтобы извлечь последнюю версию образа. 

Удалите локальную версию образа с устройства IoT Edge. 

```cmd/sh
docker rmi mcr.microsoft.com/azureiotedge-hub:1.0
docker rmi mcr.microsoft.com/azureiotedge-agent:1.0
```

Для удаления образов может потребоваться использовать флаг force `-f`. 

Служба IoT Edge извлечет последние версии образов среды выполнения и автоматически запустит их на вашем устройстве. 

### <a name="update-a-specific-tag-image"></a>Обновление образа конкретного тега

Если в своем развертывании вы используете конкретные теги (например, mcr.microsoft.com/azureiotedge-hub:**1.0.2**), вам нужно всего лишь обновить тег в манифесте развертывания и применить изменения к устройству. 

На портале Azure образы развертывания среды выполнения объявляются в разделе **Настройка дополнительных параметров среды выполнения Edge**. 

[Настройка дополнительных параметров среды выполнения Edge](./media/how-to-update-iot-edge/configure-runtime.png)

В манифесте развертывания JSON обновите образы модулей в разделе **systemModules**. 

```json
"systemModules": {
  "edgeAgent": {
    "type": "docker",
    "settings": {
      "image": "mcr.microsoft.com/azureiotedge-agent:1.0.2",
      "createOptions": ""
    }
  },
  "edgeHub": {
    "type": "docker",
    "status": "running",
    "restartPolicy": "always",
    "settings": {
      "image": "mcr.microsoft.com/azureiotedge-hub:1.0.2",
      "createOptions": "{\"HostConfig\":{\"PortBindings\":{\"5671/tcp\":[{\"HostPort\":\"5671\"}], \"8883/tcp\":[{\"HostPort\":\"8883\"}],\"443/tcp\":[{\"HostPort\":\"443\"}]}}}"
    }
  }
},
```

## <a name="next-steps"></a>Дополнительная информация

Ознакомьтесь с последними выпусками Azure IoT Edge [на сайте GitHub](https://github.com/Azure/azure-iotedge/releases).

Будьте в курсе последних обновлений и объявлений,просматривая блог, посвященный [Интернету вещей](https://azure.microsoft.com/blog/topics/internet-of-things/). 