---
title: Мониторинг развертываний IoT Edge — Azure IoT Edge
description: Высокоуровневый мониторинг, включая сообщаемые свойства edgeHub и edgeAgent и метрики автоматического развертывания.
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 04/21/2020
ms.topic: conceptual
ms.reviewer: veyalla
ms.service: iot-edge
ms.custom: devx-track-azurecli
services: iot-edge
ms.openlocfilehash: 4ff4d5a810eb79fb11e66591cd0b695062b1c9f6
ms.sourcegitcommit: 3792cf7efc12e357f0e3b65638ea7673651db6e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91450185"
---
# <a name="monitor-iot-edge-deployments"></a>Мониторинг развертываний IoT Edge

Azure IoT Edge предоставляет отчеты, позволяющие отслеживать сведения о модулях, развернутых на устройствах IoT Edge, в режиме реального времени. Служба Центра Интернета вещей извлекает сведения о состоянии этих устройств и предоставляет эти сведения оператору для мониторинга. Мониторинг также важен для [развертываний, выполняемых в большом масштабе](module-deployment-monitoring.md), включая автоматические развертывания и многоуровневые развертывания.

Как устройства, так и модули имеют схожие данные, такие как подключение, поэтому получение значений выполняется в соответствии с идентификатором устройства или модуля.

Служба Центра Интернета вещей собирает данные, сообщаемые двойниками устройств и модулей, и предоставляет счетчики различных состояний, в которых могут находиться устройства. Служба Центра Интернета вещей упорядочивает эти данные в четыре группы метрик:

| Тип | Описание |
| --- | ---|
| Цель | Отображает устройства IoT Edge, которые соответствуют условиям назначения развертывания. |
| Применено | Отображает целевые устройства IoT Edge, которые не используются другими развертываниями с высшим приоритетом. |
| Сообщение об успехе | Отображает устройства IoT Edge, которые передали сведения об успешном развертывании модулей. |
| Сообщение о сбое | Отображает устройства IoT Edge, которые передали сведения, что при развертывании одного или нескольких модулей произошел сбой. Для дальнейшего изучения ошибки удаленно подключитесь к этим устройствам и просмотрите файлы журнала. |

Служба центра Интернета вещей делает эти данные доступными для мониторинга на портале Azure и в Azure CLI.

## <a name="monitor-a-deployment-in-the-azure-portal"></a>Мониторинг развертывания на портале Azure

Чтобы просмотреть сведения о развертывании и узнать, какое устройство его выполняет, сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к своему Центру Интернета вещей.
1. В меню слева выберите **IoT Edge**.
1. Выберите вкладку **Развертывания IoT Edge**.
1. Изучите список развертывания. Для каждого развертывания можно просмотреть следующие сведения:

    | Столбец | Описание |
    | --- | --- |
    | ID | Имя развертывания. |
    | Тип | Тип развертывания: **Развертывание** или **Многоуровневое развертывание**. |
    | Target Condition (Условие назначения); | Тег, используемый для определения целевых устройств. |
    | Приоритет | Номер приоритета, назначенный для развертывания. |
    | Метрики системы | Количество двойников устройств в Центре Интернета вещей, которые соответствуют целевому состоянию. **Применено** — количество устройств, применивших содержимое развертывания на своих двойниках модулей в Центре Интернета вещей. |
    | Метрики устройств | Количество устройств IoT Edge, которые сообщают об успешном выполнении или ошибках в клиентской среде выполнение IoT Edge. |
    | Пользовательские метрики | Количество устройств Edge, которые сообщают данные для любых метрик, определенных вами для развертывания. |
    | Время создания | Метка времени, когда было создано развертывание. Метка времени используется, чтобы разорвать связи, если два развертывания имеют одинаковый приоритет. |

1. Выберите развертывание, которое вы хотите отслеживать.  
1. На странице **Сведения о развертывании** прокрутите вниз до нижнего раздела и выберите вкладку **Целевое условие**. Выберите **Показать**, чтобы просмотреть список устройств, которые соответствуют целевому условию. Можно изменить условие, а также **приоритет**. Если вы внесли изменения, нажмите **Сохранить**.

   ![Просмотр целевых устройств для развертывания](./media/how-to-monitor-iot-edge-deployments/target-devices.png)

1. Выберите вкладку **Метрики**. Если выбрать метрику из раскрывающегося списка **Выберите метрику**, появится кнопка **Показать** для отображения результатов. Можно также выбрать **Изменить метрики**, чтобы настроить критерии для всех настраиваемых метрик, которые определены. Если вы внесли изменения, нажмите **Сохранить**.

   ![Просмотр метрик для развертывания](./media/how-to-monitor-iot-edge-deployments/deployment-metrics-tab.png)

Сведения о внесении изменений в развертывание см. в разделе [Изменение развертывания](how-to-deploy-at-scale.md#modify-a-deployment).

## <a name="monitor-a-deployment-with-azure-cli"></a>Мониторинг развертывания с помощью Azure CLI

Для отображения сведений об одном развертывании используйте команду [az IoT Edge deployment show](/cli/azure/ext/azure-iot/iot/edge/deployment#ext-azure-iot-az-iot-edge-deployment-show).

```cli
az iot edge deployment show --deployment-id [deployment id] --hub-name [hub name]
```

Эта команда принимает следующие параметры:

* **--deployment-id** — имя существующего развертывания в центре IoT. Обязательный параметр.
* **--hub-name** — имя концентратора IoT, в котором существует развертывание. Центр должен быть в текущей подписке. Переключитесь на нужную подписку с помощью команды `az account set -s [subscription name]`

Проверьте развертывание в командном окне. Свойство **metrics** перечисляет количество каждой метрики, которое оценивается каждым центром.

* **targetedCount** — это система метрики, которая определяет количество двойников устройств в Центре Интернета вещей, которые соответствуют условию назначения.
* **appliedCount** — это система метрики, которая определяет количество устройств, в которых применено содержимое развертывания к двойникам модулей в Центре Интернета вещей.
* **reportedSuccessfulCount** — метрика устройства, которая указывает количество устройств IoT Edge в отчете об успешном развертывании, из клиентской среды выполнения IoT Edge.
* **reportedFailedCount** — это метрика устройства, которая определяет количество устройств IoT Edge в отчете о сбое развертывания из клиентской среды выполнения IoT Edge.

Можно отобразить список идентификаторов устройств или объектов для каждой из метрик с помощью команды [az IoT Edge deployment show-metric](/cli/azure/ext/azure-iot/iot/edge/deployment#ext-azure-iot-az-iot-edge-deployment-show-metric).

```cli
az iot edge deployment show-metric --deployment-id [deployment id] --metric-id [metric id] --hub-name [hub name]
```

Эта команда принимает следующие параметры.

* **--deployment-id** — имя существующего развертывания в центре IoT.
* **--metric-id** — имя метрики, для которой нужно отобразить список идентификаторов устройств, например `reportedFailedCount`.
* **--hub-name** — имя концентратора IoT, в котором существует развертывание. Центр должен быть в текущей подписке. Переключитесь на нужную подписку с помощью команды `az account set -s [subscription name]`.

Сведения о внесении изменений в развертывание см. в разделе [Изменение развертывания](how-to-deploy-cli-at-scale.md#modify-a-deployment).

## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как [отслеживать двойников модуля](how-to-monitor-module-twins.md), в первую очередь, IOT Edge агент и модули среды выполнения IOT Edge концентратора для подключения и работоспособности развертываний IOT Edge.
