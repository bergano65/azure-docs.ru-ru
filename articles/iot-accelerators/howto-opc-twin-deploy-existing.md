---
title: Как развернуть модуль управления устройства OPC UA Интернета вещей Azure в существующий проект | Документация Майкрософт
description: Как развернуть OPC Двойника в существующий проект.
author: dominicbetts
ms.author: dobett
ms.date: 11/26/2018
ms.topic: conceptual
ms.service: iot-industrialiot
services: iot-industrialiot
manager: philmea
ms.openlocfilehash: 9b1dee8ea43d01825449cb6010fbfa62e4715cff
ms.sourcegitcommit: 8313d5bf28fb32e8531cdd4a3054065fa7315bfd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2019
ms.locfileid: "59047268"
---
# <a name="deploy-opc-twin-to-an-existing-project"></a>Развертывание OPC Двойника в существующий проект

OPC Двойник модуля выполняется в IoT Edge и предоставляет несколько служб edge на Двойник устройства OPC и реестра службы. 

Двойник устройства OPC micro служба упрощает обмен данными между операторами фабрики и устройствам сервера OPC UA на заводской площадке через модуль Edge Интернета вещей для Двойников OPC. Micro service предоставляет службы OPC UA (обзора, чтение, запись и выполнение) с помощью REST API. 

Реестр устройств OPC UA micro службы предоставляет доступ к зарегистрированные приложения OPC UA и их конечные точки. Администраторы и операторы можно зарегистрировать и отменить регистрацию новых приложений OPC UA и обзор существующих данных, включая их конечные точки. Помимо приложения и управление конечными точками Служба реестра также каталоги зарегистрированных модулей Edge Интернета вещей для Двойников устройства OPC. Предоставляет API службы управления функциональности модуля edge, например, запуск или остановка обнаружения серверов (сканирования службы) или активации новой конечной точки двойники, может осуществляться с помощью службы micro Двойника OPC.

Модуль лежит удостоверение "контролер". Контролер управляет двойника конечной точки, который соответствует конечные точки сервера OPC UA, которые были активированы с помощью соответствующего интерфейса API реестра OPC UA. Этой конечной точки двойников перевод JSON OPC UA, получил от службы micro OPC Двойника, работающее в облаке в OPC UA двоичные сообщения, отправляемые через защищенный канал с отслеживанием состояния, чтобы управляемые конечной точки. Контролер также обнаружения служб, которые отправляют события обнаружения устройства к службе адаптации устройства OPC UA для обработки данных, когда эти события привести обновлений в реестр OPC UA.  В этой статье показано, как развернуть OPC Двойника модуля в существующий проект. 

> [!NOTE]
> Дополнительные сведения о подробных сведений о развертывании и инструкции см. в разделе со сведениями о GitHub [репозитория](https://github.com/Azure/azure-iiot-opc-twin-module).

## <a name="prerequisites"></a>Технические условия

Убедитесь, что у вас есть PowerShell и [Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-az-ps) установлены расширения.   Если вы этого не сделали еще, клонируйте этот репозиторий GitHub.  Откройте командную строку или терминала и выполните:

```bash
git clone --recursive https://github.com/Azure/azure-iiot-components 
cd azure-iiot-components
```

## <a name="deploy-industrial-iot-services-to-azure"></a>Развертывание служб промышленного Интернета вещей в Azure

1. Откройте окно командной строки или терминале выполните:

   ```bash
   deploy
   ```

2. Следуйте инструкциям на экране, чтобы назначить имя группе ресурсов развертывания и имя веб-сайта.   Скрипт подготовит micro служб и зависимости платформы Azure, в группе ресурсов в подписке Azure.  Скрипт также регистрирует приложение в клиенте Azure Active Directory (AAD) для поддержки проверки подлинности на основе OAUTH.  Развертывание займет несколько минут.  Пример, которую вы видите после успешного развертывания решения:

   ![Развертывание Двойника OPC промышленного Интернета вещей в существующий проект](media/howto-opc-twin-deploy-existing/opc-twin-deploy-existing1.png)

   Выходные данные содержат URL-адрес общедоступной конечной точки. 

3. После успешного выполнения сценария, выберите, хотите ли вы сохранить env-файле.  Требуется среде env-файле, если вы хотите подключиться к облачной конечной точки, с помощью средств, таких как консоль или развернуть модули для разработки и отладки.

## <a name="troubleshooting-deployment-failures"></a>Устранение неполадок развертывания

### <a name="resource-group-name"></a>Имя группы ресурсов

Убедитесь, что использовать короткие и простые имя группы ресурсов.  Имя также используется для имени ресурсы таким образом оно должно подчиняться с требованиями к именованию ресурсов.  

### <a name="website-name-already-in-use"></a>Имя веб-сайта уже используется

Вполне возможно, что имя веб-сайта уже используется.  При возникновении этой ошибки, необходимо использовать имя приложения.

### <a name="azure-active-directory-aad-registration"></a>Регистрация в Azure Active Directory (AAD)

Скрипт развертывания пытается зарегистрировать два приложения AAD в Azure Active Directory.  В зависимости от того, ваши права для выбранного клиента AAD развертывание может завершиться ошибкой. Существуют два варианта:

1. Если вы выбрали с клиентом AAD из списка клиентов, перезапустите сценарий и выберите его из списка.
2. Кроме того развертывание частного клиента AAD в другой подписке, перезапустите сценарий и выберите, чтобы использовать его.

> [!WARNING]
> Никогда не переходил без проверки подлинности.  Если вы решили сделать это, любой пользователь может доступа к конечным точкам управления устройствами OPC из Интернета без проверки подлинности.   Вы всегда можете [вариант развертывания «local»](howto-opc-twin-deploy-dependencies.md) тестовая.

## <a name="deploy-an-all-in-one-industrial-iot-services-demo"></a>Развертывание демонстрационной службы Интернета вещей промышленного All-In-one

Вместо необходимых служб и зависимости можно также развернуть все в одном demo.  Все в одной демонстрации содержит три сервера OPC UA, OPC Двойник модуля, всех микрослужб и образец веб-приложения.  Он предназначен для демонстрационных целей.

1. Убедитесь, что у вас есть клон репозитория (см. выше). Откройте командную строку или терминала в корне репозитория и выполните:

   ```bash
   deploy -type demo
   ```

2. Следуйте инструкциям на экране, чтобы назначить новое имя группы ресурсов и имя веб-сайта.  После успешного развертывания сценарий выводит URL-адрес конечной точки веб-приложения.

## <a name="deployment-script-options"></a>Параметры скрипта развертывания

Сценарий принимает следующие параметры:

```bash
-type
```

Тип развертывания (виртуальной машины, local, демонстрация)

```bash
-resourceGroupName
```

Может быть именем существующей или новой группы ресурсов.

```bash
-subscriptionId
```

Необязательно, идентификатор подписки, где будут развертываться ресурсы.

```bash
-subscriptionName
```

Или имя подписки.

```bash
-resourceGroupLocation
```

Необязательно, расположение группы ресурсов. Если указано, будет предпринята попытка создать новую группу ресурсов в этом расположении.

```bash
-aadApplicationName
```

Имя для приложения AAD для регистрации в разделе. 

```bash
-tenantId
```

Клиент AAD для использования.

```bash
-credentials
```

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как развернуть OPC Двойника в существующий проект, вот мы предлагаем:

> [!div class="nextstepaction"]
> [Безопасный обмен данными клиента OPC и PLC OPC ](howto-opc-vault-deploy-existing-client-plc-communication.md)
