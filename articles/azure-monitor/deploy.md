---
title: Развертывание Azure Monitor
description: Описание различных действий, необходимых для полной реализации Azure Monitor для мониторинга всех ресурсов в подписке Azure.
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 07/27/2020
ms.openlocfilehash: 0a5c788b4429b5048a1b94fa8adfb2d9367982da
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "90033478"
---
# <a name="deploy-azure-monitor"></a>Развертывание Azure Monitor
Включение Azure Monitor наблюдения за всеми ресурсами Azure — это сочетание настройки Azure Monitor компонентов и Настройка ресурсов Azure для создания данных мониторинга для Azure Monitor для сбора. В этой статье описываются различные действия, необходимые для полной реализации Azure Monitor использования общей конфигурации для мониторинга всех ресурсов в подписке Azure. Основные описания для каждого шага предоставляются со ссылками на другую документацию для получения подробных сведений о конфигурации.

> [!IMPORTANT]
> Функции Azure Monitor и их конфигурации будут различаться в зависимости от бизнес-требований, которые сбалансированы с учетом стоимости включенных функций. На каждом шаге ниже определяется, есть ли потенциальная стоимость, и следует оценить эти затраты, прежде чем продолжить выполнение этого шага. Полные сведения о ценах см. на [Azure Monitor ценах](https://azure.microsoft.com/pricing/details/monitor/) .

## <a name="configuration-goals"></a>Цели настройки
Цель полной реализации Azure Monitor состоит в том, чтобы сосчитать все доступные данные из всех облачных ресурсов и приложений и включить столько функций, сколько возможно в Azure Monitor на основе этих данных.

Данные, собранные Azure Monitor, отправляются в [Azure Monitor метрики](platform/data-platform-metrics.md) или в [журналы Azure Monitor](platform/data-platform-logs.md). Каждый из них хранит различные виды данных и позволяет выполнять различные виды анализа и оповещения. Описание различных типов оповещений см. в разделе [Сравнение метрик и журналов Azure Monitorности](platform/data-platform.md) [в Microsoft Azure](platform/alerts-overview.md) . 

Некоторые данные можно отправить в метрики и журналы, чтобы использовать их с различными функциями. В таких случаях может потребоваться настроить каждый из них отдельно. Например, данные метрик автоматически отправляются ресурсами Azure в метрики, которые поддерживают обозреватель метрик и оповещения метрик. Необходимо создать параметр диагностики для каждого ресурса, чтобы отправить те же данные метрики в журналы, что позволяет анализировать тенденции производительности с помощью других данных журнала, использующих Log Analytics. В следующих разделах указывается, куда отправляются данные, и включается каждый шаг, необходимый для отправки данных во все возможные расположения.

У вас могут быть дополнительные требования, такие как мониторинг ресурсов за пределами Azure и отправка данных за пределами Azure Monitor. Такие требования можно получить с помощью дополнительной настройки функций, описанных в этой статье. Чтобы получить дополнительные параметры конфигурации, перейдите по ссылкам на каждый шаг.

## <a name="collect-data-from-azure-resources"></a>Получение данных из ресурсов Azure

> [!NOTE]
> Полный обзор мониторинга виртуальных машин с Azure Monitor см. в статье [мониторинг ресурсов Azure с помощью Azure Monitor](insights/monitor-azure-resource.md) .

Некоторые средства мониторинга ресурсов Azure доступны автоматически без какой-либо настройки, в то время как для получения дополнительных данных мониторинга необходимо выполнить действия по настройке. В следующей таблице приведены шаги по настройке, необходимые для сбора всех доступных данных из ресурсов Azure, включая данные о шагах, которые отправляются в Azure Monitor метрики и журналы Azure Monitor. В следующих разделах подробно описывается каждый шаг.

[![Развертывание мониторинга ](media/deploy/deploy-azure-resources.png) ресурсов Azure](media/deploy/deploy-azure-resources.png#lightbox)

### <a name="no-configuration"></a>Отсутствие конфигурации
При создании подписки Azure не требуется настраивать следующие функции Azure Monitor. Нет никаких затрат, связанных с этим мониторингом.

[Журналы Azure Active Directory](../active-directory/reports-monitoring/overview-reports.md) — предоставляют журнал на уровне клиента о действиях входа и аудите изменений, внесенных в Azure Active Directory. Подробные сведения о журналах Azure Active Directory и их просмотре в портал Azure см. в отчетах [о действиях аудита на](../active-directory/reports-monitoring/concept-audit-logs.md) портале Azure Active Directory и в [отчете о действиях входа на](../active-directory/reports-monitoring/concept-sign-ins.md) портале Azure Active Directory.

[Журнал действий](platform/platform-logs-overview.md) — содержит сведения о событиях уровня группы управления и подписки, произошедших в Azure. События автоматически записываются в журнал действий при создании нового ресурса Azure, изменении ресурса или выполнении значительных действий. Вы можете просматривать события в портал Azure и создавать оповещения журнала действий при создании определенных событий. Подробные сведения о журнале действий и способах его просмотра в портал Azure см. в [журнале действий Azure](platform/activity-log.md) .

[Метрики платформы](platform/metrics-supported.md) — автоматически собираются из служб Azure в [метрики Azure Monitor](platform/data-platform-metrics.md). Эти данные часто отображаются на странице **Обзор** в портал Azure для различных служб. Дополнительные сведения об анализе метрик платформы в портал Azure см. в статье [Приступая к работе с Azure обозреватель метрик](platform/metrics-getting-started.md) . 


### <a name="create-log-analytics-workspace"></a>Создание рабочей области Log Analytics
Требуется по крайней мере одна рабочая область Log Analytics для включения [журналов Azure Monitor](platform/data-platform-logs.md), необходимых для сбора таких данных в виде журналов из ресурсов Azure, сбора данных из гостевой операционной системы виртуальных машин Azure, а также для получения наиболее подробных сведений об Azure Monitor. Другие службы, такие как Azure Sentinel и центр безопасности Azure, также используют рабочую область Log Analytics и могут использовать один и тот же ресурс, который используется для Azure Monitor. Для поддержки этого мониторинга можно начать с одной рабочей области, но ознакомьтесь с разработкой  [развертывания Azure Monitor журналов](platform/design-logs-deployment.md) , чтобы получить рекомендации по использованию нескольких рабочих областей.

Создание Log Analytics рабочей области не взимается, но после настройки данных для их сбора может взиматься плата. См. статью [Управление потреблением и затратами с помощью журналов Azure Monitor](platform/manage-cost-storage.md).  

Чтобы создать начальную рабочую область Log Analytics, см. раздел [создание log Analytics рабочей области на портал Azure](learn/quick-create-workspace.md) . Дополнительные сведения см. [в разделе Управление доступом к данным и рабочим областям журнала в Azure Monitor](platform/manage-access.md) для настройки доступа. 

### <a name="create-diagnostic-setting-to-collect-tenant-and-subscription-logs"></a>Создание параметра диагностики для сбор журналов клиентов и подписок
Хотя [журналы Azure Active Directory](../active-directory/reports-monitoring/overview-reports.md) для клиента и [Журнал действий](platform/platform-logs-overview.md) для своей подписки собираются автоматически, отправка их в рабочую область log Analytics позволяет анализировать эти события с другими данными журнала с помощью запросов журнала в log Analytics. Это также позволяет создавать предупреждения запросов журнала, которые являются единственным способом оповещения о Azure Active Directory журналах и предоставляют более сложную логику по сравнению с оповещениями журнала действий.

Отправка журнала действий в рабочую область не взимается, но для журналов Azure Active Directory используется прием данных и срок хранения. 

См. статью [Интеграция журналов Azure AD с Azure Monitor журналами](../active-directory/reports-monitoring/howto-integrate-activity-logs-with-log-analytics.md) и [Создание параметров диагностики для отправки журналов и метрик платформы в различные места назначения](platform/diagnostic-settings.md) , чтобы создать параметр диагностики для клиента и подписки для отправки записей журнала в рабочую область log Analytics. 

### <a name="create-diagnostic-setting-to-collect-resource-logs-and-platform-metrics"></a>Создание параметра диагностики для сбора журналов ресурсов и метрик платформы
Ресурсы в Azure автоматически создают [журналы ресурсов](platform/platform-logs-overview.md) , предоставляющие сведения об операциях, выполняемых в рамках ресурса. В отличие от метрик платформы, необходимо настроить сбор журналов ресурсов. Создайте параметр диагностики для отправки их в рабочую область Log Analytics, чтобы объединить их с другими данными, используемыми в журналах Azure Monitor. Один и тот же параметр диагностики можно использовать для отправки метрик платформы для большинства ресурсов в ту же рабочую область, что позволяет анализировать данные метрик с помощью запросов журнала с другими собранными данными.

Для этой коллекции есть затраты, поэтому перед реализацией в значительном количестве ресурсов следует обратиться к [Azure Monitor ценам](https://azure.microsoft.com/pricing/details/monitor/) . Дополнительные сведения об оптимизации затрат на сбор журналов см. в статье [об управлении использованием и затратами Azure Monitor журналов](platform/manage-cost-storage.md) .

Сведения о создании параметров диагностики для ресурса Azure см. в статье [Создание параметров диагностики для сбора журналов и метрик ресурсов в Azure](platform/diagnostic-settings.md#create-in-azure-portal) . Так как для каждого ресурса Azure необходимо создать параметр диагностики, см. Дополнительные сведения об использовании [политики Azure](../governance/policy/overview.md) для автоматического создания параметров при каждом создании ресурса Azure в разделе [развертывание Azure Monitor в масштабе](deploy-scale.md) .

### <a name="enable-insights-and-solutions"></a>Включение аналитических сведений и решений
Аналитические сведения и решения обеспечивают специализированный мониторинг для конкретной службы или решения. Insights использует более новые функции Azure Monitor например книги, поэтому следует использовать аналитику, если она доступна для вашей службы. Они автоматически доступны в каждой подписке Azure, но для полной функциональности может потребоваться определенная конфигурация. Как правило, они используют метрики платформы и ресурсы, настроенные ранее, и могут собираются дополнительные данные.

Решения должны быть добавлены в каждую подписку и работать исключительно с данными из журналов Azure Monitor и могут получать дополнительные данные журнала.

У вас нет затрат на решения или аналитические сведения, но вы можете платить за любые данные, которые они собираются.

Список доступных аналитических сведений и решений в Azure Monitor см. в разделе [что отслеживается Azure Monitor?](monitor-reference.md) . Сведения о каждой уникальной конфигурации или ценах см. в документации по каждой из них. 

## <a name="collect-data-from-virtual-machines"></a>Получение данных с виртуальных машин

> [!NOTE]
> Полное пошаговое инструкции по мониторингу виртуальных машин с Azure Monitor см. в статье [мониторинг виртуальных машин Azure с помощью Azure Monitor](insights/monitor-vm-azure.md) . 

Виртуальные машины создают аналогичные данные как другие ресурсы Azure, но для получения данных из гостевой операционной системы необходим агент. Сравнение агентов, используемых Azure Monitor, см. в статье [Общие сведения об агентах Azure Monitor](platform/agents-overview.md) . 

[Azure Monitor для виртуальных машин](insights/vminsights-overview.md) использует агент log Analytics и агент зависимостей для получения данных из гостевой операционной системы виртуальных машин, поэтому эти агенты можно развернуть как часть реализации этого анализа. Это позволяет агенту Log Analytics для других служб, использующих такие службы, как центр безопасности Azure.


[![Развертывание виртуальной машины ](media/deploy/deploy-azure-vm.png) Azure](media/deploy/deploy-azure-vm.png#lightbox)


### <a name="configure-workspace-for-azure-monitor-for-vms"></a>Настройка рабочей области для Azure Monitor для виртуальных машин
Для Azure Monitor для виртуальных машин требуется рабочая область Log Analytics, которая обычно совпадает с созданной для получения данных из других ресурсов Azure. Перед включением виртуальных машин необходимо добавить решение, необходимое для Azure Monitor для виртуальных машин в рабочую область.

Дополнительные сведения о настройке рабочей области Log Analytics для Azure Monitor для виртуальных машин см. в статье [Настройка рабочей области log Analytics для Azure Monitor для виртуальных машин](insights/vminsights-configure-workspace.md) .

### <a name="enable-azure-monitor-for-vms-on-each-virtual-machine"></a>Включение Azure Monitor для виртуальных машин на каждой виртуальной машине
После настройки рабочей области можно включить каждую виртуальную машину, установив агент Log Analytics и агент зависимостей. Существует несколько способов установки этих агентов, включая политику Azure, которая позволяет автоматически настраивать каждую виртуальную машину в том виде, в котором она создана. Данные о производительности и сведения о процессе, собранные Azure Monitor для виртуальных машин, хранятся в журналах Azure Monitor.

Параметры развертывания агентов на виртуальных машинах и их включения для мониторинга см. в статье [включение Azure Monitor для виртуальных машин обзор](insights/vminsights-enable-overview.md) .

### <a name="configure-workspace-to-collect-events"></a>Настройка рабочей области для получения событий
Azure Monitor для виртуальных машин соберет данные о производительности, а также сведения и зависимости процессов из гостевой операционной системы каждой виртуальной машины. Агент Log Analytics также может получать журналы из гостевой системы, включая журнал событий из Windows и syslog из Linux. Он извлекает конфигурацию для этих журналов из Log Analytics рабочей области, к которой он подключен. Рабочую область нужно настроить только один раз, и каждый раз, когда агент подключится, будут скачаны все изменения конфигурации. 

Дополнительные сведения о настройке рабочей области Log Analytics для получения дополнительных данных с виртуальных машин агента см. [в разделе источники данных агента в Azure Monitor](platform/agent-data-sources.md) .

> [!NOTE]
> Можно также настроить рабочую область для сбора данных счетчиков производительности, но это скорее всего будет избыточным с данными производительности, собранными Azure Monitor для виртуальных машин. Данные о производительности, собранные рабочей областью, будут храниться в таблице *производительности* , а данные о производительности, собранные Azure Monitor для виртуальных машин, хранятся в таблице *инсигхтсметрикс* . Настройте сбор производительности в рабочей области только в том случае, если требуются счетчики, которые еще не собраны Azure Monitor для виртуальных машин.

### <a name="diagnostic-extension-and-telegraf-agent"></a>Диагностическое расширение и агент Telegraf
Azure Monitor для виртуальных машин использует агент Log Analytics, который отправляет данные о производительности в рабочую область Log Analytics, но не Azure Monitor метрики. Отправка этих данных в метрики позволяет анализировать их с помощью обозреватель метрик и использовать с оповещениями метрик. Для этого требуется расширение диагностики в Windows и агент Telegraf в Linux.

Дополнительные сведения об установке и настройке этих агентов см. в [статье Установка и настройка расширения системы диагностики Microsoft Azure (WAD)](platform/diagnostics-extension-windows-install.md) и [Получение пользовательских метрик для виртуальной машины Linux с помощью агента инфлуксдата Telegraf](platform/collect-custom-metrics-linux-telegraf.md) .


## <a name="monitor-applications"></a>Мониторинг приложений
Azure Monitor отслеживает пользовательские приложения с помощью [Application Insights](app/app-insights-overview.md), которые необходимо настроить для каждого приложения, которое требуется отслеживать. Процесс настройки зависит от типа наблюдаемого приложения и типа мониторинга, который требуется выполнить. Данные, собранные Application Insights, хранятся в Azure Monitor метриках, Azure Monitor журналах и хранилище BLOB-объектов Azure, в зависимости от функции. Данные о производительности хранятся в метриках Azure Monitor и Azure Monitor журналов без дополнительной настройки.

### <a name="create-an-application-resource"></a>Создание ресурса приложения
Необходимо создать ресурс в Application Insights для каждого приложения, которое вы будете отслеживать. Данные журнала, собранные Application Insights, хранятся в журналах Azure Monitor для приложения на основе рабочей области. Данные журнала для классических приложений хранятся отдельно от рабочей области Log Analytics, как описано в разделе [Структура данных](platform/data-platform-logs.md#structure-of-data).

 При создании приложения необходимо выбрать, будет ли использоваться классическая среда или на основе рабочей области. См. раздел [создание Application Insights ресурса](app/create-new-resource.md) для создания классического приложения. Чтобы создать приложение на основе рабочей области, см. раздел [ресурсы Application Insights на основе рабочих областей (Предварительная версия)](app/create-workspace-resource.md) .

### <a name="configure-codeless-or-code-based-monitoring"></a>Настройка отслеживания на основе кода или кода
Чтобы включить мониторинг для приложения, необходимо решить, будет ли использоваться мониторинг на основе кода или кода. Процесс настройки зависит от этого решения и типа приложения, за которым вы будете отслеживаться.

**Мониторинг с некодированным кодом** проще всего реализовать, и его можно настроить после разработки кода. Обновление кода не требуется. Дополнительные сведения о включении мониторинга в зависимости от приложения см. в следующих ресурсах.

- [Приложения, размещенные в веб-приложениях Azure](app/azure-web-apps.md)
- [Приложения Java](app/java-in-process-agent.md)
- [Приложения ASP.NET, размещенные в IIS на виртуальной машине Azure или в масштабируемом наборе виртуальных машин Azure](app/azure-vm-vmss-apps.md)
- [Приложения ASP.NET, размещенные в IIS локально на виртуальной машине](app/monitor-performance-live-website-now.md)


**Мониторинг на основе кода** является более настраиваемым и собирает дополнительные данные телеметрии, но требует добавления зависимости к коду в пакетах SDK Application Insights пакета NuGet. Дополнительные сведения о включении мониторинга в зависимости от приложения см. в следующих ресурсах.

- [Приложения ASP.NET](app/asp-net.md)
- [Приложения ASP.NET Core](app/asp-net-core.md)
- [Консольные приложения .NET](app/console.md)
- [Java](app/java-get-started.md)
- [Node.js](app/nodejs.md)
- [Python](app/opencensus-python.md)
- [другие платформы.](app/platforms.md)

### <a name="configure-availability-testing"></a>Настройка тестирования доступности
Тесты доступности в Application Insights — это повторяющиеся тесты, которые отслеживают доступность и скорость реагирования приложения через регулярные интервалы от точек мира. Вы можете создать простую проверку связи или создать последовательность веб-запросов для имитации пользовательских транзакций с соответствующими затратами. 

В разделе [мониторинг доступности любого веб-сайта](app/monitor-web-app-availability.md) приведены сведения о различных видах тестов и сведения о их создании.

### <a name="configure-profiler"></a>Настройка профилировщика
Профилировщик в Application Insights предоставляет трассировку производительности для приложений .NET. Он помогает выявление "горячего" пути кода, который занимает самое длинное время при обработке определенного веб-запроса. Процесс настройки профилировщика зависит от типа приложения. 

Дополнительные сведения о настройке профилировщика см. в статье [Профилирование рабочих приложений в Azure с помощью Application Insights](app/profiler-overview.md) .

### <a name="configure-snapshot-debugger"></a>Настройка Snapshot Debugger
Snapshot Debugger в Application Insights отслеживает данные телеметрии исключений из приложения .NET и собирает моментальные снимки в самых частых исключениях, чтобы получить сведения, необходимые для диагностики проблем в рабочей среде. Процесс настройки Snapshot Debugger зависит от типа приложения. 

Дополнительные сведения о настройке Snapshot Debugger см. в разделе [Отладка моментальных снимков на исключениях в приложениях .NET](app/snapshot-debugger.md) .


## <a name="visualize-data"></a>Визуализируйте данные
Аналитические сведения и решения будут включать собственные книги и представления для анализа данных. Кроме того, вы можете создавать собственные [визуализации](visualizations.md) , в том числе книги для Azure Monitor данных и панелей мониторинга, чтобы объединять Azure Monitor данные с данными из других служб в Azure.


### <a name="create-workbooks"></a>Создание книг
[Книги](platform/workbooks-overview.md) в Azure Monitor позволяют создавать сложные визуальные отчеты в портал Azure. Можно объединять различные наборы данных из метрик Azure Monitor и Azure Monitor журналов для создания Объединенных интерактивных интерфейсов. Доступ к коллекции книг можно получить на вкладке **книги** в меню Azure Monitor. 

Дополнительные сведения о создании пользовательских книг см. в разделе [книги Azure Monitor](platform/workbooks-overview.md) .

### <a name="create-dashboards"></a>Создавайте панели мониторинга
[Панели мониторинга Azure](../azure-portal/azure-portal-dashboards.md) — это основная технология панелей мониторинга для Azure, позволяющая объединять Azure Monitor данные с данными из других служб, чтобы обеспечить единую область прозрачности в инфраструктуре Azure. Дополнительные сведения о создании панели мониторинга, содержащей данные из журналов Azure Monitor, см. в разделе [Создание и совместное использование панелей мониторинга log Analytics данных](learn/tutorial-logs-dashboards.md) . 

Дополнительные сведения о создании панели мониторинга, содержащей данные из Application Insights, см. в статье [Создание настраиваемых панелей мониторинга с помощью Application Insights Azure](learn/tutorial-app-dashboards.md) . 

## <a name="alerts"></a>видны узлы
Оповещения в Azure Monitor заранее уведомляют о важных данных или шаблонах, определенных в данных мониторинга. Некоторые аналитические данные будут создавать предупреждения без настройки. Для других сценариев необходимо создать [правила генерации оповещений](platform/alerts-overview.md) , включающие анализируемые данные, а также критерии создания предупреждений и группы действий, которые определяют действие, выполняемое при создании предупреждения. 


### <a name="create-action-groups"></a>Создание групп действий
[Группы действий](platform/action-groups.md) — это набор параметров уведомлений, используемых правилами генерации оповещений для определения действия, выполняемого при срабатывании оповещения. Примеры действий включают отправку почты или текста, вызов веб-перехватчика или отправку данных в средство ITSM. Для каждого правила генерации оповещений требуется по крайней мере одна группа действий, а одна группа действий может использоваться несколькими правилами генерации оповещений.

Дополнительные сведения о создании группы действий и описание различных действий, которые она может включать, см. в разделе [Создание групп действий и управление ими в портал Azure](platform/action-groups.md) .


### <a name="create-alert-rules"></a>Создание правил генерации оповещений
Существует несколько типов правил генерации оповещений, определяемых типом используемых данных. У каждого из них есть различные возможности и другие затраты. Основная стратегия, которую следует выполнить, заключается в том, чтобы использовать тип правила генерации оповещений с наименьшей ценой, обеспечивающей требуемую логику.

- [Правила журнала действий](platform/activity-log-alerts.md). Создает предупреждение в ответ на новое событие журнала действий, соответствующее указанным условиям. На эти оповещения не взимается плата, поэтому они должны быть вашим первым выбором. Дополнительные сведения о создании оповещений журнала действий см. в статье [Создание, просмотр и Управление оповещениями журнала действий с помощью Azure Monitor](platform/alerts-activity-log.md) .
- [Правила генерации оповещений метрик](platform/alerts-metric-overview.md). Создает предупреждение в ответ на одно или несколько значений метрик, превышающих пороговое значение. Оповещения метрик имеют состояние, что означает, что предупреждение будет автоматически закрываться, когда значение падает ниже порогового значения, а уведомления будут отправляться только при изменении состояния. На оповещения метрик взимается плата, но это значительно меньше, чем оповещения журнала. Дополнительные сведения о создании оповещений метрик см. в статье [Создание и Просмотр оповещений метрик и управление ими с помощью Azure Monitor](platform/alerts-metric.md) .
- [Правила генерации оповещений журнала](platform/alerts-unified-log.md). Создает предупреждение, если результаты запроса расписания соответствуют указанным критериям. Они являются наиболее ресурсоемкими правилами генерации оповещений, но они позволяют использовать наиболее сложные критерии. Дополнительные сведения о создании предупреждений о запросах журнала см. в статье [Создание, просмотр и Управление оповещениями журнала с помощью Azure Monitor](platform/alerts-log.md) .
- [Оповещения приложений](app/monitor-web-app-availability.md) позволяют выполнять профилактическое тестирование производительности и доступности веб-приложения. Вы можете выполнять простую проверку связи без каких-либо затрат, но есть затраты на более сложное тестирование. Описание различных тестов и сведения о их создании см. в разделе [мониторинг доступности любого веб-сайта](app/monitor-web-app-availability.md) .


## <a name="next-steps"></a>Дальнейшие шаги

- См. статью [развертывание Azure Monitor в масштабе с помощью политики Azure](deploy-scale.md).