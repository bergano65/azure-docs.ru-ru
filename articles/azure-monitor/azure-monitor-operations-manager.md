---
title: Azure Monitor для существующих клиентов Operations Manager
description: Руководство для существующих пользователей Operations Manager переходить к наблюдению за определенными рабочими нагрузками для Azure Monitor в рамках перехода в облако.
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 01/11/2021
ms.openlocfilehash: b1262533c3398a774b85e4143289a9b7c342aeab
ms.sourcegitcommit: e559daa1f7115d703bfa1b87da1cf267bf6ae9e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100593580"
---
# <a name="azure-monitor-for-existing-operations-manager-customers"></a>Azure Monitor для существующих клиентов Operations Manager
В этой статье приводятся рекомендации для клиентов, которые в настоящее время используют [System Center Operations Manager](/system-center/scom/welcome) и планируют переход на [Azure Monitor](overview.md) по мере переноса бизнес-приложений и других ресурсов в Azure. Предполагается, что ваша конечная цель является полноценным переходом в облако, что позволяет заменять как можно больше Operations Manager функциональности с Azure Monitor, не нарушая требования бизнеса и ИТ-деятельности. 

Конкретные рекомендации, описанные в этой статье, изменятся как Azure Monitor и Operations Manager добавить компоненты. При этом основная стратегия будет оставаться стабильной.

> [!IMPORTANT]
> Существует несколько затрат на реализацию некоторых Azure Monitor функций, описанных здесь, поэтому перед развертыванием во всей среде следует оценить их ценность.

## <a name="prerequisites"></a>Предварительные требования
В этой статье предполагается, что вы уже используете [Operations Manager](/system-center/scom) и по крайней мере имеют базовое представление о [Azure Monitor](overview.md). Полное сравнение этих двух значений см. в разделе [руководство по мониторингу облака: Обзор платформ мониторинга](/azure/cloud-adoption-framework/manage/monitor/platform-overview). В этой статье подробно описаны различия функций между двумя, чтобы помочь вам понять некоторые рекомендации, описанные здесь. 


## <a name="general-strategy"></a>Общая стратегия
Нет средств миграции для преобразования ресурсов из Operations Manager в Azure Monitor, поскольку эти платформы являются принципиально разными. Миграция вместо [стандартной Azure Monitor будет реализована](deploy.md) , пока вы продолжаете использовать Operations Manager. При настройке Azure Monitor в соответствии с требованиями к различным приложениям и компонентам, а также по мере того, как она получает больше функций, можно начать с учета различных пакетов управления и агентов в Operations Manager.

Общая стратегия, рекомендуемая в этой статье, такая же, как и в [руководстве по мониторингу в облаке](/azure/cloud-adoption-framework/manage/monitor/), которое рекомендует использовать стратегию [гибридного мониторинга облака](/azure/cloud-adoption-framework/manage/monitor/cloud-models-monitor-overview#hybrid-cloud-monitoring) , которая позволяет постепенно переходить в облако. Хотя некоторые функции могут перекрываться, эта стратегия позволит поддерживать существующие бизнес-процессы по мере знакомства с новой платформой. Отказываться от Operations Manager функциональности, так как ее можно заменить на Azure Monitor. Использование нескольких средств мониторинга повышает сложность, но позволяет воспользоваться преимуществами Azure Monitor возможности мониторинга облачных рабочих нагрузок следующего поколения, сохраняя возможность Operations Manager возможности мониторинга серверного программного обеспечения и компонентов инфраструктуры, которые могут быть локальными или другими облаками. 


## <a name="components-to-monitor"></a>Компоненты для отслеживания
Он помогает классифицировать различные типы рабочих нагрузок, которые необходимо отслеживать, чтобы определить отдельную стратегию мониторинга для каждой из них. [Руководство по мониторингу в облаке. формулировка стратегии мониторинга](/azure/cloud-adoption-framework/strategy/monitoring-strategy#high-level-modeling) предоставляет подробные сведения о различных слоях в среде, которые требуют мониторинга в процессе работы от устаревших корпоративных приложений до современных приложений в облаке.

Перед облаком вы использовали Operations Manager для мониторинга всех слоев. Когда вы начинаете переход с помощью инфраструктуры как услуги (IaaS), вы продолжаете использовать Operations Manager для виртуальных машин, но начинаете использовать Azure Monitor для облачных ресурсов. По мере дальнейшего перехода на современные приложения с помощью платформы как услуги (PaaS) вы можете сосредоточиться на Azure Monitor и начать снятие Operations Managerных функций.


![Облачные модели](/azure/cloud-adoption-framework/strategy/media/monitoring-strategy/cloud-models.png)

Эти слои можно упростить в следующих категориях, которые более подробно описаны в оставшейся части этой статьи. Хотя каждая рабочая нагрузка мониторинга в среде может не соответствовать ни одной из этих категорий, каждая из них должна быть достаточно близкой к определенной категории для применения общих рекомендаций.

**Бизнес-приложения.** Приложения, которые предоставляют функциональные возможности, характерные для вашего бизнеса. Они могут быть внутренними или внешними и часто разрабатываются внутренним образом с помощью пользовательского кода. Устаревшие приложения обычно размещаются на виртуальных или физических компьютерах под управлением Windows или Linux, а новые приложения будут основаны на службах приложений в Azure, таких как веб-приложения Azure и функции Azure.

**Службы Azure.** Ресурсы в Azure, которые поддерживают бизнес-приложения, перенесенные в облако. Сюда входят такие службы, как служба хранилища Azure, Azure SQL и Azure IoT. Сюда также входят виртуальные машины Azure, так как они отслеживаются как другие службы Azure, но приложения и программное обеспечение, работающие в гостевой операционной системе этих виртуальных машин, нуждаются в более подробном наблюдении за пределами узла.

**Серверное программное обеспечение.** Программное обеспечение, работающее на виртуальных и физических компьютерах, которое поддерживает бизнес-приложения или Упакованные приложения, обеспечивающие общие функциональные возможности для вашего бизнеса. Примерами могут служить Internet Information Server (IIS), SQL Server, Exchange и SharePoint. Сюда также входит операционная система Windows или Linux на виртуальных и физических компьютерах.

**Локальная инфраструктура.** Компоненты, относящиеся к локальной среде, требующие мониторинга. Сюда входят такие ресурсы, как физические серверы, хранилища и сетевые компоненты. Это компоненты, которые виртуализованы при переходе в облако.

## <a name="sample-walkthrough"></a>Пример пошагового руководства
Ниже приведено гипотетическое пошаговое руководство по миграции с Operations Manager на Azure Monitor. Это не представляет полную сложность фактической миграции, но по крайней мере предоставляет базовые шаги и последовательность. В следующих разделах подробно описан каждый из этих шагов.

Ваша среда перед перемещением компонентов в Azure основана на виртуальных и физических компьютерах, расположенных локально или с поставщиком управляемых служб. Она полагается на Operations Manager для мониторинга бизнес-приложений, серверного программного обеспечения и других компонентов инфраструктуры в среде, например физических серверов и сетей. Вы используете стандартные пакеты управления для серверного программного обеспечения, например IIS, SQL Server и различных программных продуктов, и настраиваете эти пакеты управления для конкретных требований. Вы создаете пользовательские пакеты управления для бизнес-приложений и других компонентов, которые невозможно отслеживать с помощью существующих пакетов управления, и настраивают Operations Manager для поддержки бизнес-процессов.

Миграция в Azure начинается с IaaS, перенося виртуальные машины, поддерживающие бизнес-приложения, в Azure. Требования к мониторингу этих приложений и серверного программного обеспечения, от которых они зависят, не меняются, и вы продолжаете использовать Operations Manager на этих серверах с существующими пакетами управления. 

Azure Monitor включены для служб Azure сразу после создания подписки Azure. Он автоматически собирает метрики платформы и журнал действий, а также настраивает собираемые журналы ресурсов, чтобы можно было интерактивно анализировать все доступные данные телеметрии с помощью запросов журнала. Вы включаете Azure Monitor для виртуальных машин на виртуальных машинах для анализа данных мониторинга во всей среде, а также для обнаружения отношений между компьютерами и процессами. Вы расширяете использование Azure Monitor на локальные физические и виртуальные машины, включая на них серверы с поддержкой ARC. 

Вы включаете Application Insights для каждого из бизнес-приложений. Он определяет различные компоненты каждого приложения, начинает накапливать данные об использовании и производительности, а также определяет ошибки, происходящие в коде. Тесты доступности создаются для упреждающего тестирования внешних приложений и предупреждения о проблемах производительности или доступности. Хотя Application Insights предоставляет мощные функции, которые у вас нет в Operations Manager, вы продолжаете полагаться на пользовательские пакеты управления, разработанные для бизнес-приложений, так как они включают сценарии мониторинга, еще не охваченные Azure Monitor. 

Когда вы получаете опыт работы с Azure Monitor, вы начинаете создавать правила генерации оповещений, которые могут заменить некоторые функции пакета управления и начать развивать бизнес-процессы для использования новой платформы мониторинга. Это позволяет начать удалять компьютеры и пакеты управления из группы управления Operations Manager. Вы продолжаете использовать пакеты управления для критического серверного программного обеспечения и локальной инфраструктуры, но продолжаете отслеживать новые функции в Azure Monitor, позволяющие снять с учета дополнительные функциональные возможности.

## <a name="monitor-azure-services"></a>Мониторинг служб Azure
Для служб Azure требуется, чтобы Azure Monitor собираются данные телеметрии, и она включена в момент создания подписки Azure. [Журнал действий](essentials/activity-log.md) автоматически собирается для подписки, а [метрики платформы](essentials/data-platform-metrics.md) автоматически собираются из всех создаваемых ресурсов Azure. Вы можете сразу начать использовать [Обозреватель метрик](essentials/metrics-getting-started.md), аналогичный представлениям производительности в консоли управления, но он обеспечивает интерактивный анализ и [Расширенные статистические](essentials/metrics-charts.md) данные. [Создайте оповещение метрики](alerts/alerts-metric.md) , которое будет уведомлено, когда значение пересекает порог или [Добавить диаграмму на панель мониторинга Azure](essentials/metrics-charts.md#pinning-to-dashboards) для отображения.

[![Обозреватель метрик](media/azure-monitor-operations-manager/metrics-explorer.png)](media/azure-monitor-operations-manager/metrics-explorer.png#lightbox)

[Создайте параметр диагностики](essentials/diagnostic-settings.md) для каждого ресурса Azure, чтобы отправить метрики и [журналы ресурсов](essentials/resource-logs.md), которые предоставляют сведения о внутренней операции каждого ресурса в log Analytics рабочей области. Это предоставляет все доступные данные телеметрии для ресурсов и позволяет использовать [log Analytics](logs/log-analytics-overview.md) для интерактивного анализа данных журнала и производительности с помощью расширенного языка запросов, не имеющего эквивалента в Operations Manager. Можно также создать [оповещения о запросах журнала](alerts/alerts-log-query.md), которые могут использовать сложную логику для определения условий предупреждений и корреляции данных между несколькими ресурсами.

[![Аналитика журналов](media/azure-monitor-operations-manager/log-analytics.png)](media/azure-monitor-operations-manager/log-analytics.png#lightbox)

[Аналитические](monitor-reference.md) сведения в Azure Monitor похожи на пакеты управления в том, что они обеспечивают уникальный мониторинг для конкретной службы Azure. Аналитические сведения в настоящее время доступны для нескольких служб, включая сетевые подключения, хранилища и контейнеры, а другие постоянно добавляются.

[![Пример анализа](media/azure-monitor-operations-manager/insight.png)](media/azure-monitor-operations-manager/insight.png#lightbox)


Аналитические данные основаны на [книгах](visualize/workbooks-overview.md) в Azure Monitor, которые объединяют метрики и записывают запросы в расширенные Интерактивные отчеты. Создание собственных книг для объединения данных из нескольких служб аналогично созданию пользовательских представлений и отчетов в консоли управления.

### <a name="azure-management-pack"></a>Пакет управления Azure
[Пакет управления Azure](https://www.microsoft.com/download/details.aspx?id=50013) позволяет Operations Manager обнаруживать ресурсы Azure и отслеживать их работоспособность на основе определенного набора сценариев мониторинга. Для этого пакета управления требуется выполнить дополнительную настройку для каждого ресурса в Azure, но может быть полезно обеспечить определенную видимость ресурсов Azure в консоли управления, пока бизнес-процессы не будут развиваться с учетом Azure Monitor.

[![Пакет управления Azure](media/azure-monitor-operations-manager/operations-console.png)](media/azure-monitor-operations-manager/operations-console.png#lightbox)

 Вы можете использовать пакет управления Azure, если вы хотите видеть определенные ресурсы Azure в консоли Operations и интегрировать некоторые базовые предупреждения с существующими процессами. Фактически он использует данные, собранные Azure Monitor. Для долгосрочного мониторинга ресурсов Azure следует Azure Monitor. 


## <a name="monitor-server-software-and-local-infrastructure"></a>Мониторинг серверного программного обеспечения и локальной инфраструктуры
При перемещении компьютеров в облако требования к мониторингу для их программного обеспечения не меняются. Вам больше не нужно отслеживать их физические компоненты, так как они виртуализованы, но операционная система на виртуальной машине и ее рабочие нагрузки имеют те же требования, что и их среда.

[Azure Monitor для виртуальных машин](vm/vminsights-overview.md) является основным компонентом в Azure Monitor для мониторинга виртуальных машин и их гостевой операционной системы и рабочих нагрузок. Как и в случае с Operations Manager, Azure Monitor для виртуальных машин использует агент для получения данных из гостевой операционной системы виртуальных машин. Это те же данные о производительности и событиях, которые обычно используются пакетами управления для анализа и оповещений. Не существует правил, позволяющих выявление и оповещение о проблемах для бизнес-приложений и серверного программного обеспечения, работающего на этих компьютерах. Необходимо создать собственные правила генерации оповещений для упреждающего уведомления об обнаруженных проблемах.

[![Производительность Azure Monitor для виртуальных машин](media/azure-monitor-operations-manager/vm-insights-performance.png)](media/azure-monitor-operations-manager/vm-insights-performance.png#lightbox)

Azure Monitor также не измеряет работоспособность различных приложений и служб, работающих на виртуальной машине. Оповещения метрик могут автоматически разрешаться, когда значение падает ниже порогового значения, но Azure Monitor в настоящее время не может определять критерии работоспособности для приложений и служб, работающих на компьютере, и не предоставляет сводный показатель работоспособности для группирования работоспособности связанных компонентов.

> [!NOTE]
> Новая [функция работоспособности гостевой системы для Azure Monitor для виртуальных машин](vm/vminsights-health-overview.md) теперь доступна в общедоступной предварительной версии и предупреждает о состоянии работоспособности набора метрик производительности. Это изначально ограничивается конкретным набором счетчиков производительности, связанных с гостевой операционной системой, а не приложениями и другими рабочими нагрузками, выполняемыми на виртуальной машине.
> 
> [![Работоспособность гостевых Azure Monitor для виртуальных машин](media/azure-monitor-operations-manager/vm-insights-guest-health.png)](media/azure-monitor-operations-manager/vm-insights-guest-health.png#lightbox)

Мониторинг программного обеспечения на компьютерах в гибридной среде обычно использует сочетание Azure Monitor для виртуальных машин и Operations Manager, в зависимости от требований каждого компьютера и готовности к разработке рабочих процессов, связанных с Azure Monitor. Агент управления Майкрософт (называемый агентом Log Analytics в Azure Monitor) используется обеими платформами, чтобы один компьютер можно было одновременно отслеживать одновременно.

> [!NOTE]
> В будущем Azure Monitor для виртуальных машин будет переходить к [агенту Azure Monitor](agents/azure-monitor-agent-overview.md), который в настоящее время находится в общедоступной предварительной версии. Он будет совместим с Microsoft Monitoring Agent, чтобы одна и та же виртуальная машина продолжала отслеживаться обеими платформами.

Продолжайте использовать Operations Manager для функций, которые еще не могут быть предоставлены Azure Monitor. Сюда входят пакеты управления для критического серверного программного обеспечения, например IIS, SQL Server или Exchange. Кроме того, могут быть разработаны пользовательские пакеты управления для локальной инфраструктуры, к которым невозможно подключиться с Azure Monitor. Также продолжайте использовать Operations Manager, если он тесно интегрирован в рабочие процессы, пока вы не сможете перейти на модернизации операции службы, где Azure Monitor и другие службы Azure могут быть дополнены или заменены. 

Используйте Azure Monitor на виртуальных машинах, чтобы повысить уровень текущего мониторинга, даже если он не заменил Operations Manager. Ниже приведены примеры функций, уникальных для Azure Monitor.

- Обнаружение и отслеживание связей между виртуальными машинами и их внешними зависимостями.
- Просмотр агрегированных данных о производительности на нескольких виртуальных машинах в интерактивных диаграммах и книгах.
- Используйте [запросы журналов](logs/log-query-overview.md) для интерактивного анализа данных телеметрии с виртуальных машин с данными из других ресурсов Azure.
- Создание [правил генерации оповещений журнала](alerts/alerts-log-query.md) на основе сложной логики на нескольких виртуальных машинах.

[![Azure Monitor для виртуальных машинная схема](media/azure-monitor-operations-manager/vm-insights-map.png)](media/azure-monitor-operations-manager/vm-insights-map.png#lightbox)

Помимо виртуальных машин Azure Azure Monitor для виртуальных машин может отслеживать компьютеры в локальной среде и в других облаках с помощью [серверов с поддержкой Arc](../azure-arc/servers/overview.md). Серверы с поддержкой Arc позволяют управлять компьютерами под управлением Windows и Linux, размещенными за пределами Azure, в корпоративной сети или в другом поставщике облачных служб, в соответствии с тем, как вы управляете собственными виртуальными машинами Azure.



## <a name="monitor-business-applications"></a>Мониторинг бизнес-приложений
Обычно пользовательские пакеты управления требуются для мониторинга бизнес-приложений с Operations Manager, используя агенты, установленные на каждой виртуальной машине. Application Insights в Azure Monitor наблюдает за веб-приложениями независимо от того, находятся ли они в Azure, в других облаках или в локальной среде, поэтому их можно использовать для всех приложений независимо от того, перенесены ли они в Azure.

Если наблюдение за бизнес-приложением ограничено функциями, предоставляемыми [шаблоном производительности приложения .NET]() в Operations Manager, скорее всего, вы можете перейти на Application Insights без потери функциональности. Фактически, Application Insights будет включать в себя значительное количество дополнительных функций, включая следующие:

- Автоматическое обнаружение и мониторинг компонентов приложения.
- Собирайте подробные данные об использовании приложения и производительности, такие как время отклика, частота сбоев и скорость запросов.
- Собирайте данные браузера, такие как Просмотры страниц и производительность загрузки.
- Обнаружение исключений и детализация трассировки стека и связанных запросов.
- Выполните расширенный анализ с помощью таких функций, как [Распределенная трассировка](app/distributed-tracing.md) и [интеллектуальное обнаружение](app/proactive-diagnostics.md).
- Используйте [Обозреватель метрик](essentials/metrics-getting-started.md) для интерактивного анализа данных о производительности.
- Используйте [запросы журналов](logs/log-query-overview.md) для интерактивного анализа собранных данных телеметрии вместе с данными, собранными для служб Azure и Azure Monitor для виртуальных машин.

[![Application Insights](media/azure-monitor-operations-manager/application-insights.png)](media/azure-monitor-operations-manager/application-insights.png#lightbox)

В некоторых случаях может потребоваться продолжить использование Operations Manager в дополнение к Application Insights, пока вы не сможете добиться требуемой функциональности. Примеры, в которых может потребоваться продолжить Operations Manager, включают следующее:

-  [Тесты доступности](app/monitor-web-app-availability.md), которые позволяют отслеживать доступность и реагирование приложений и получать оповещения о них, запрашивают входящие запросы от IP-адресов агентов веб-тестов. Если политика не разрешает такой доступ, может потребоваться использовать [мониторы доступности веб-приложений](/system-center/scom/web-application-availability-monitoring-template) в Operations Manager.
- В Operations Manager можно задать любой интервал опроса для тестов доступности, при этом многие клиенты проверяют каждые 60-120 секунд. Application Insights имеет минимальный интервал опроса в 5 минут, что может быть слишком длинным для некоторых клиентов.
- Значительный объем мониторинга в Operations Manager выполняется путем сбора событий, создаваемых приложениями, и запуска скриптов на локальном агенте. Они не являются стандартными вариантами в Application Insights, поэтому для достижения бизнес-требований может потребоваться пользовательская работа. Это могут быть пользовательские правила генерации оповещений, в которых данные событий хранятся в Log Analytics рабочей области, а сценарии, запущенные в гостевой виртуальной машине, используют [гибридную рабочую роль Runbook](../automation/automation-hybrid-runbook-worker.md).
- В зависимости от языка, на котором написано приложение, может быть ограничено [Инструментирование, которое можно использовать с Application Insights](app/platforms.md).

Следуя рекомендациям в других разделах этого руководств, продолжайте использовать Operations Manager для бизнес-приложений, но воспользуйтесь преимуществами дополнительных функций, предоставляемых Application Insights. Так как вы можете заменить критически важные функции на Azure Monitor, можно приступить к снятию с учета пользовательских пакетов управления.


## <a name="next-steps"></a>Дальнейшие шаги

- Подробное сравнение Azure Monitor и System Center Operations Manager и дополнительные сведения о проектировании и реализации гибридной среды мониторинга см. в статье по [мониторингу облака](/azure/cloud-adoption-framework/manage/monitor/) .
- Узнайте больше о [мониторинге ресурсов Azure в Azure Monitor](essentials/monitor-azure-resource.md).
- Узнайте больше о [мониторинге виртуальных машин Azure в Azure Monitor](vm/monitor-vm-azure.md).
- Узнайте больше о [Azure Monitor для виртуальных машин](vm/vminsights-overview.md).
- Узнайте больше о [Application Insights](app/app-insights-overview.md).