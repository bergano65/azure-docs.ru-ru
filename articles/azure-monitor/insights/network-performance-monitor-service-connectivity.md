---
title: Монитор производительности сети в Azure Log Analytics | Документация Майкрософт
description: С помощью монитора подключений службы в Мониторе производительности сети вы можете отслеживать сетевые подключения к любой конечной точке с открытым TCP-портом.
ms.service: azure-monitor
ms.subservice: logs
ms.topic: conceptual
author: abshamsft
ms.author: absha
ms.date: 02/20/2018
ms.openlocfilehash: dd02dad6d0f5b42181ad0bb27201384a6336ed6e
ms.sourcegitcommit: 5acd8f33a5adce3f5ded20dff2a7a48a07be8672
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/24/2019
ms.locfileid: "72898820"
---
# <a name="service-connectivity-monitor"></a>Монитор подключений службы

С помощью монитора подключений службы в [Мониторе производительности сети](network-performance-monitor.md) можно отслеживать сетевые подключения к любой конечной точке с открытым TCP-портом. К таким конечным точкам относятся веб-сайты, приложения SaaS, приложения PaaS и базы данных SQL. 

С помощью монитора подключений службы можно выполнять следующие функции. 

- Мониторинг сетевых подключений к приложениям и сетевым службам из нескольких филиалов или расположений. К приложениям и сетевым службам относятся Office 365, Dynamics CRM, внутренние бизнес-приложения и базы данных SQL.
- Встроенные тесты для отслеживания сетевых подключений к конечным точкам Office 365 и Dynamics 365. 
- Определение времени отклика, задержки сети, потери пакетов, возникших при подключении к конечной точке.
- Определение причины ухудшения производительности приложения (сеть или проблема в конечной точке поставщика приложения).
- Определение активных точек в сети, которые могут быть причиной ухудшения производительности приложения, путем просмотра задержек, вызываемых каждым прыжком на карте топологии.


![Монитор подключений службы](media/network-performance-monitor-service-endpoint/service-endpoint-intro.png)


## <a name="configuration"></a>Настройка 
Чтобы открыть конфигурацию Монитора производительности сети, откройте решение [Монитор производительности сети](network-performance-monitor.md) и нажмите кнопку **Настройка**.

![Настройка Монитора производительности сети](media/network-performance-monitor-service-endpoint/npm-configure-button.png)


### <a name="configure-log-analytics-agents-for-monitoring"></a>Настройка агентов Log Analytics для мониторинга
Включите следующие правила брандмауэра на узлах, используемых для мониторинга, чтобы решение могло определить топологию подключения от узлов к конечной точке службы: 

```
netsh advfirewall firewall add rule name="NPMDICMPV4Echo" protocol="icmpv4:8,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV6Echo" protocol="icmpv6:128,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV4DestinationUnreachable" protocol="icmpv4:3,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV6DestinationUnreachable" protocol="icmpv6:1,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV4TimeExceeded" protocol="icmpv4:11,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV6TimeExceeded" protocol="icmpv6:3,any" dir=in action=allow 
```

### <a name="create-service-connectivity-monitor-tests"></a>Создание тестов монитора подключений службы 

Начните создавать тесты для отслеживания сетевых подключений к конечным точкам службы.

1. Перейдите на вкладку **Монитор подключений службы**.
2. Нажмите кнопку **Добавить тест** и введите имя и описание теста. На рабочую область можно создать не более 450 тестов. 
3. Выберите тип теста.<br>

    * Выберите **Веб**, чтобы отслеживать подключение к службе, которая отвечает на запросы HTTP(S), например outlook.office365.com или bing.com.<br>
    * Выберите **Сеть**, чтобы отслеживать подключение к службе, которая отвечает на запрос TCP, но не отвечает на запросы HTTP(S), например SQL Server, FTP-сервер или SSH-порт. 
    * Например, чтобы создать веб-тест для учетной записи хранения BLOB-объектов, выберите **Web** и введите Target в качестве *йоурсторажеаккаунт*. BLOB.Core.Windows.NET. Аналогичным образом можно создавать тесты для хранилища таблиц, очередей и файлов Azure с помощью [этой ссылки.](https://docs.microsoft.com/azure/storage/common/storage-account-overview#storage-account-endpoints)
4. Если вы не хотите выполнять такие измерения сети, как задержки сети, потери пакетов, а также обнаружение топологии, снимите флажок **Проведите измерения сети**. Оставьте этот флажок установленным, чтобы получить максимальные преимущества от возможности. 
5. В поле **Цель** введите URL-адрес, полное доменное имя или IP-адрес, сетевое подключение к которому необходимо отслеживать.
6. В поле **Номер порта** введите номер порта целевой службы. 
7. В поле **Периодичность проведения тестирования** введите значение частоты выполнения тестов. 
8. Выберите узлы, из которых требуется отслеживать сетевые подключения к службе. Убедитесь, что число агентов, добавляемых для каждого теста, меньше 150. Любой агент может проверить максимальное 150 конечных точек и агентов.

    >[!NOTE]
    > Для узлов под управлением сервера Windows эта возможность подразумевает выполнение измерений производительности сети с помощью запросов по протоколу TCP. Для узлов под управлением клиента Windows эта возможность подразумевает выполнение измерений производительности сети с помощью запросов по протоколу ICMP. В некоторых случаях целевое приложение блокирует входящие запросы на основе ICMP, когда узлы основаны на клиенте Windows. Решение не может выполнить измерение сети. В таких случаях рекомендуется использовать узлы под управлением Windows Server. 

9. Если не нужно создавать события работоспособности для выбранных элементов, снимите флажок **Enable Health Monitoring in the targets covered by this test** (Включить мониторинг работоспособности в целевых объектах, на которые распространяется этот тест). 
10. Выберите условия мониторинга. Вы можете задать настраиваемые пороговые значения для создания событий работоспособности. Каждый раз, когда значение условия превышает выбранное пороговое значение для выбранной пары сетей или подсетей, создается событие работоспособности. 
11. Нажмите кнопку **Сохранить**, чтобы сохранить конфигурацию. 

    ![Конфигурации тестов для монитора подключений службы](media/network-performance-monitor-service-endpoint/service-endpoint-configuration.png)



## <a name="walkthrough"></a>Пошаговое руководство 

Перейдите к представлению панели мониторинга Монитора производительности сети. На странице **Монитор подключений службы** представлены сводные данные работоспособности разных созданных вами тестов. 

![Страница монитора подключений службы](media/network-performance-monitor-service-endpoint/service-endpoint-blade.png)

На странице **Тесты** щелкните элемент, чтобы просмотреть дополнительные сведения о тестах. В таблице слева можно просмотреть сведения о состоянии работоспособности на определенный момент времени и значения времени отклика службы, задержки сети и потери пакетов для всех тестов. Чтобы просмотреть моментальный снимок о состоянии сети на другой момент времени в прошлом, выберите элемент управления "Network State Recorder" (Запись состояния сети). Выберите в таблице тест, который необходимо изучить. В области справа на диаграммах можно просмотреть исторические тенденции изменения значений потери, задержки и времени отклика. Щелкните ссылку **Сведения о тесте**, чтобы просмотреть сведения о производительности на каждом узле.

![Тесты монитора подключений службы](media/network-performance-monitor-service-endpoint/service-endpoint-tests.png)

В представлении **Тестирование узлов** можно отслеживать сетевые подключения из каждого узла. Выберите узел, работа которого замедлилась. Это узел, на котором приложение работает медленно.

Определите причину ухудшения производительности приложения (из-за сети или из-за каких-либо проблем в конечной точке поставщика приложения), наблюдая за корреляцией между временем отклика приложения и задержкой сети. 

* **Проблема в приложении.** Если происходит резкое увеличение времени отклика, но задержка сети остается постоянной, то можно предположить, что сеть работает нормально и проблема возникла в конечной точке приложения. 

    ![Проблема с приложением монитора подключений службы](media/network-performance-monitor-service-endpoint/service-endpoint-application-issue.png)

* **Неполадки в сети.** Если резкое увеличение времени отклика сопровождается соответствующим увеличением задержки сети, то можно предположить, что увеличение времени отклика происходит из-за увеличения задержки сети. 

    ![Проблема с сетью монитора подключений службы](media/network-performance-monitor-service-endpoint/service-endpoint-network-issue.png)

Определив, что проблема кроется в сети, щелкните ссылку на представление **Топология**, чтобы определить проблемный прыжок на карте топологии. Пример показан на следующем рисунке. Общая задержка между узлом и конечной точкой приложения составляет 105 мс, а снижение на 96 мс произошло из-за прыжка, помеченного красным цветом. После определения проблемного прыжка можно выполнить корректирующее действие. 

![Тесты монитора подключений службы](media/network-performance-monitor-service-endpoint/service-endpoint-topology.png)

## <a name="diagnostics"></a>Диагностика: 

Если вы заметили неисправность, сделайте следующее.

* Если для времени отклика службы, потери пакетов в сети и задержки отображается значение "Недоступно", это может быть вызвано одной или несколькими из следующих причин.

    - Приложение не работает.
    - Узел, используемый для проверки сетевого подключения к службе, не работает.
    - Неверный целевой объект, введенный в конфигурации теста.
    - У узла нет сетевых подключений.

* Если для времени отклика службы отображается допустимое значение, а для потери пакетов в сети и задержки отображается значение "Недоступно", это может быть вызвано одной или несколькими из следующих причин.

    - Если узел, используемый для проверки сетевых подключений к службе, является клиентским компьютером Windows, целевая служба блокирует запросы ICMP или сетевой брандмауэр блокирует запросы ICMP, исходящие из узла.
    - В конфигурации теста не установлен флажок **Проведите измерения сети**. 

* Если для времени отклика службы указано значение "Недоступно", а для потери пакетов в сети и задержки указаны допустимые значения, возможно, целевая служба не является веб-приложением. Измените конфигурацию теста и выберите для типа теста значение **Сеть** вместо **Веб**. 

* Если приложение работает медленно, определите причину ухудшения производительности приложения (сеть или проблема в конечной точке поставщика приложения).

## <a name="gcc-office-urls-for-us-government-customers"></a>URL-адреса GCC Office для клиентов правительства США
Для государственных организаций США Виргиния только URL-адреса с DOD — это встроенные NPM. Клиентам, использующим URL-адреса GCC, необходимо создать пользовательские тесты и добавить каждый URL-адрес по отдельности.

| Поле | GCC |
|:---   |:--- |
| Портал Office 365 и общий доступ | portal.apps.mil |
| Проверка подлинности и удостоверение Office 365 | * login.microsoftonline.us <br> * api.login.microsoftonline.com <br> * clientconfig.microsoftonline-p.net <br> * login.microsoftonline.com <br> * login.microsoftonline-p.com <br> * login.windows.net <br> * loginex.microsoftonline.com <br> * login-us.microsoftonline.com <br> * nexus.microsoftonline-p.com <br> * mscrl.microsoft.com <br> * secure.aadcdn.microsoftonline-p.com |
| Office Online | * adminwebservice.gov.us.microsoftonline.com <br>  * adminwebservice-s1-bn1a.microsoftonline.com <br> * adminwebservice-s1-dm2a.microsoftonline.com <br> * becws.gov.us.microsoftonline.com <br> * provisioningapi.gov.us.microsoftonline.com <br> * officehome.msocdn.us <br> * prod.msocdn.us <br> * portal.office365.us <br> * webshell.suite.office365.us <br> * www. office365.us <br> * activation.sls.microsoft.com <br> * crl.microsoft.com <br> * go.microsoft.com <br> * insertmedia.bing.office.net <br> * ocsa.officeapps.live.com <br> * ocsredir.officeapps.live.com <br> * ocws.officeapps.live.com <br> * office15client.microsoft.com <br>* officecdn.microsoft.com <br> * officecdn.microsoft.com.edgesuite.net <br> * officepreviewredir.microsoft.com <br> * officeredir.microsoft.com <br> * ols.officeapps.live.com  <br> * r.office.microsoft.com <br> * cdn.odc.officeapps.live.com <br> * odc.officeapps.live.com <br> * officeclient.microsoft.com |
| Exchange Online | * outlook.office365.us <br> * attachments.office365-net.us <br> * autodiscover-s.office365.us <br> * manage.office365.us <br> * scc.office365.us |
| MS Teams | gov.teams.microsoft.us | 

## <a name="next-steps"></a>Дальнейшие действия
[Выполните поиск по журналам](../../azure-monitor/log-query/log-query-overview.md), чтобы просмотреть подробные записи данных о производительности сети.
