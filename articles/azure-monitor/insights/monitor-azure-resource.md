---
title: Мониторинг ресурсов Azure с помощью Azure Monitor | Документация Майкрософт
description: Описывается, как выполнять сбор и анализ данных мониторинга ресурсов Azure с помощью Azure Monitor.
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 10/08/2019
ms.openlocfilehash: e3a8e8b908c9d278654bfe992474811d6a9ddb86
ms.sourcegitcommit: 83610f637914f09d2a87b98ae7a6ae92122a02f1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/13/2020
ms.locfileid: "91993712"
---
# <a name="monitoring-azure-resources-with-azure-monitor"></a>Мониторинг ресурсов Azure с помощью Azure Monitor
При наличии критически важных приложений и бизнес-процессов, использующих ресурсы Azure, необходимо отслеживать эти ресурсы на предмет их доступности, производительности и работы. В этой статье описаны данные мониторинга, созданные ресурсами Azure, а также анализ таких данных и оповещений о них с помощью функций Azure Monitor.

> [!IMPORTANT]
> Эта статья относится ко всем службам в Azure, использующим Azure Monitor. Вычислительные ресурсы, включая виртуальные машины и службы приложений, создают те же данные мониторинга, которые описаны здесь, но также имеют гостевую операционную систему, которая может создавать журналы и метрики. Дополнительные сведения о том, как собираются и анализируются эти данные, см. в документации по мониторингу этих служб.

## <a name="what-is-azure-monitor"></a>Общие сведения об Azure Monitor
Azure Monitor — это комплексная служба мониторинга в Azure, которая предоставляет полный набор функций для отслеживания ресурсов Azure в дополнение к ресурсам в других облаках и локальных средах. [Azure Monitor платформа данных](../platform/data-platform.md) собирает данные в [журналы](../platform/data-platform-logs.md) и [метрики](../platform/data-platform-metrics.md) , где их можно анализировать вместе с помощью полного набора средств мониторинга. См. полный список приложений и служб, которые можно отслеживать, Azure Monitor, [что отслеживается Azure Monitor?](../monitor-reference.md).

После создания ресурса Azure Monitor включается и начинает сбор метрик и журналов действий, которые можно [просматривать и анализировать на портале Azure](#monitoring-in-the-azure-portal). В некоторых конфигурациях можно собирать дополнительные данные мониторинга и включать дополнительные функции. Дополнительные сведения о требованиях к конфигурации см. в разделе [Данные мониторинга](#monitoring-data) ниже.


## <a name="costs-associated-with-monitoring"></a>Затраты, связанные с мониторингом
Анализ данных мониторинга, собираемых по умолчанию, не влечет за собой расходы. Это включает следующие действия.

- Сбор метрик платформы и их анализ с помощью обозревателя метрик.
- Сбор журнала действий и его анализ на портале Azure.
- Создание правила генерации оповещений журнала действий.

Сбор и экспорт журналов и метрик в Azure Monitor осуществляются бесплатно, но могут возникнуть затраты, связанные с назначением.

- Затраты, связанные с приемом и хранением данных при сборе журналов и метрик в рабочей области Log Analytics. См. [Цены Azure Monitor на Log Analytics](https://azure.microsoft.com/pricing/details/monitor/).
- Затраты, связанные с хранением данных при сборе журналов и метрик в учетную запись хранения Azure. См. [Цены Azure Storage на хранилище больших двоичных объектов](https://azure.microsoft.com/pricing/details/storage/blobs/).
- Затраты, связанные с потоковой передачей концентратора событий при пересылке журналов и метрик в Центры событий Azure. См. [Цены на Центры событий Azure](https://azure.microsoft.com/pricing/details/event-hubs/).

Возможны затраты на Azure Monitor, связанные со следующим. См. [Цены на Azure Monitor](https://azure.microsoft.com/pricing/details/monitor/).

- Выполнение запроса журнала.
- Создание правила генерации оповещений для запросов метрик или журналов.
- Отправка уведомления из любого правила генерации оповещений.
- Доступ к метрикам через API.

## <a name="monitoring-data"></a>Данные мониторинга
Ресурсы в Azure создают [журналы](../platform/data-platform-logs.md) и [метрики](../platform/data-platform-metrics.md), представленные на приведенной ниже схеме. Ознакомьтесь с документацией по каждой из служб Azure, чтобы узнать, какие данные они создают и какие дополнительные решения или аналитические сведения предоставляют.

![Обзор](media/monitor-azure-resource/logs-metrics.png)



- [Метрики платформы](../platform/data-platform-metrics.md) — числовые значения, которые автоматически собираются через регулярные интервалы и описывают некоторый аспект ресурса на определенный момент времени. 
- [Журналы ресурсов](../platform/platform-logs-overview.md) — дают представление об операциях, которые были выполнены с ресурсом Azure (плоскость данных), например о получении секрета из Key Vault или запросе к базе данных. Содержимое и структура журналов ресурсов зависит от типа ресурса и службы Azure.
- [Журнал действий](../platform/platform-logs-overview.md) — предоставляет полезные сведения об операциях с каждым ресурсом Azure в подписке извне (плоскость управления), например о создании нового ресурса или запуске виртуальной машины. Это информация позволяет ответить на вопросы "Что? Кто? Когда?", касающиеся любой операции записи (PUT, POST, DELETE) для ресурсов в вашей подписке.


## <a name="configuration-requirements"></a>Требования настройки

### <a name="configure-monitoring"></a>Настройка мониторинга
Некоторые данные мониторинга собираются автоматически, но вы можете настроить некоторые параметры в зависимости от требований. Подробные сведения о каждом типе данных мониторинга см. ниже.

- [Метрики платформы](../platform/data-platform-metrics.md) — метрики платформы автоматически собираются в [Метрики Azure Monitor](../platform/data-platform-metrics.md) без дополнительной настройки. Создайте параметр диагностики для отправки записей в журналы Azure Monitor или для перенаправления их за пределы Azure.
- [Журналы ресурсов](../platform/platform-logs-overview.md) — журналы ресурсов автоматически создаются ресурсами Azure, но не собираются без параметра диагностики.  Создайте параметр диагностики для отправки записей в журналы Azure Monitor или для перенаправления их за пределы Azure.
- [Журнал действий](../platform/platform-logs-overview.md) — журнал действий автоматически собирается без дополнительной настройки. Его можно просмотреть на портале Azure. Создайте параметр диагностики, чтобы скопировать его в журналы Azure Monitor или переслать за пределы Azure.

### <a name="log-analytics-workspace"></a>Рабочая область Log Analytics
Для сбора данных в журналы Azure Monitor требуется рабочая область Log Analytics. Вы можете быстро приступить к наблюдению за службой, создав новую рабочую область, но бывает полезно использовать рабочую область, которая собирает данные из других служб. См. раздел [Создание рабочей области Log Analytics на портале Azure](../learn/quick-create-workspace.md) для получения дополнительных сведений о создании рабочей области и раздел [Проектирование развертывания журналов Azure Monitor](../platform/design-logs-deployment.md) для определения оптимальной структуры рабочей области в зависимости от ваших требований. Если вы используете существующую рабочую область в организации, вам потребуются соответствующие разрешения, как описано в разделе [Управление доступом к данным журнала и рабочим областям в Azure Monitor](../platform/manage-access.md). 





## <a name="diagnostic-settings"></a>Параметры диагностики
Параметры диагностики определяют, куда будут отправляться журналы ресурсов и метрики для определенного ресурса. Возможные места назначения

- [Рабочая область Log Analytics](../platform/resource-logs.md#send-to-log-analytics-workspace), которая позволяет анализировать данные с другими данными мониторинга, собранными Azure Monitor, используя эффективные запросы журналов, а также другие функции Azure Monitor, такие как оповещения журнала и визуализации. 
- [Концентраторы событий](../platform/resource-logs.md#send-to-azure-event-hubs) для потоковой передачи данных во внешние системы, такие как сторонние решения SIEM и другие решения Log Analytics. 
- [Учетная запись хранения Azure](../platform/resource-logs.md#send-to-azure-storage), которая используется для аудита, статического анализа или резервного копирования.

Выполните процедуру, описанную в разделе [Создание параметра диагностики для сбора журналов и метрик платформы в Azure](../platform/diagnostic-settings.md), для создания параметров диагностики и управления ими на портале Azure. См. раздел [Создание параметра диагностики в Azure с помощью шаблона Resource Manager](../samples/resource-manager-diagnostic-settings.md), чтобы определить их в шаблоне и включить полный мониторинг ресурса при создании.


## <a name="monitoring-in-the-azure-portal"></a>Мониторинг на портале Azure
 Вы можете получить доступ к данным мониторинга для большинства ресурсов Azure из меню ресурса на портале Azure. Это обеспечит доступ к данным одного ресурса с помощью стандартных средств Azure Monitor. Некоторые службы Azure предоставляют различные параметры, поэтому для получения дополнительных сведений следует обратиться к документации по этой службе. Используйте меню **Azure Monitor** для анализа данных из всех отслеживаемых ресурсов. 

### <a name="overview"></a>Обзор
Многие службы отображают данные мониторинга на странице **Обзор**, что позволяет быстро оценить их работу. Как правило, этот механизм основан на подмножестве метрик платформы, хранящихся в службе метрик Azure Monitor. Другие параметры мониторинга, как правило, доступны в разделе **мониторинг** меню службы.

![Страница "Обзор"](media/monitor-azure-resource/overview-page.png)


### <a name="insights-and-solutions"></a>Аналитические сведения и решения 
Некоторые службы предоставляют средства, выходящие за рамки стандартных функций Azure Monitor. [Аналитические сведения](./insights-overview.md) предоставляет настраиваемый интерфейс мониторинга, основанный на платформе данных и стандартных функциях Azure Monitor. [Решения](./solutions.md) предоставляют стандартную логику мониторинга, основанную на журналах Azure Monitor. 

Если у службы есть аналитические сведения Azure Monitor, доступ к ним можно получить в разделе **Мониторинг** в меню каждого ресурса. Все аналитические сведения и решения доступны в меню **Azure Monitor**.

![Аналитика в портал Azure](media/monitor-azure-resource/insights.png)

### <a name="metrics"></a>Метрики
Анализируйте метрики на портале Azure с помощью [обозревателя метрик](../platform/metrics-getting-started.md), который доступен в пункте меню **Метрики** для большинства служб. Это средство позволяет работать с отдельными метриками или объединять несколько метрик для выявления корреляций и тенденций. 

- Дополнительные сведения об обозревателе метрик см. в статье [Начало работы с обозревателем метрик Azure](../platform/metrics-getting-started.md).
- Дополнительные возможности обозревателя метрик, такие как использование нескольких метрик и применение фильтров и разбиения, см. в разделе [Дополнительные возможности обозревателя метрик Azure](../platform/metrics-charts.md).

![Обозреватель метрик в портал Azure](media/monitor-azure-resource/metrics.png)


### <a name="activity-log"></a>Журнал действий 
Просмотрите записи в журнале действий на портале Azure, установив фильтр на текущий ресурс. Скопируйте журнал действий в рабочую область Log Analytics, чтобы получить к ней доступ для использования в запросах журналов и книгах. 

- Дополнительные сведения о просмотре журнала действий и получении записей с помощью различных методов см. в разделе [Просмотр и получение событий журнала действий Azure](../platform/activity-log.md#view-the-activity-log).
- Сведения о событиях, регистрируемых в журнале, см. в документации по службе Azure.

![Журнал действий](media/monitor-azure-resource/activity-log.png)

### <a name="azure-monitor-logs"></a>Журналы Azure Monitor
Журналы Azure Monitor объединяют журналы и метрики из нескольких служб и других источников данных для анализа с помощью мощного инструмента для работы с запросами. Как описано выше, создайте параметр диагностики для сбора метрик платформы, журнала действий и журналов ресурсов в рабочей области Log Analytics в Azure Monitor.

[Log Analytics](../log-query/get-started-portal.md) позволяет работать с [запросами журналов](../log-query/log-query-overview.md). Это эффективная функция Azure Monitor, которая позволяет выполнять расширенный анализ данных журнала с помощью полнофункционального языка запросов. Откройте Log Analytics в разделе **Журналы** в меню **Мониторинг** для ресурса Azure, чтобы работать с запросами к журналам, используя ресурс в качестве [области запроса](../log-query/scope.md#query-scope). Это позволяет анализировать данные в нескольких таблицах только для этого ресурса. Используйте раздел **Журналы** в меню Azure Monitor, чтобы получить доступ к журналам для всех ресурсов. 

- См. сведения о том, как [начать работу с запросами журналов в Azure Monitor](../log-query/get-started-queries.md) с помощью языка запросов.
- Сведения о сборе журналов ресурсов в журналах Azure Monitor и о том, как получить доступ к ним в запросе, см. в разделе [Сбор журналов ресурсов Azure в рабочей области Log Analytics в Azure Monitor](../platform/resource-logs.md#send-to-log-analytics-workspace).
- Описание структурирования данных журнала ресурсов в журналах Azure Monitor см. в разделе [Режим сбора](../platform/resource-logs.md#send-to-log-analytics-workspace).
- Дополнительные сведения о таблице в журналах Azure Monitor см. в документации по каждой службе Azure.

![Log Analytics на портале Azure](media/monitor-azure-resource/logs.png)

## <a name="monitoring-from-command-line"></a>Мониторинг из командной строки
Доступ к данным мониторинга, собранным из ресурса, можно получить из командной строки или включить в скрипт, используя [Azure PowerShell](/powershell/azure/) или [интерфейс командной строки Azure](/cli/azure/). 

- Сведения о доступе к данным метрик из интерфейса командной строки см. в разделе [Справочники по метрикам CLI](/cli/azure/monitor/metrics).
- Сведения о доступе к журналам Azure Monitor с помощью запроса к журналу из интерфейса командной строки см. в разделе [Справочник по CLI Log Analytics](/cli/azure/ext/log-analytics/monitor/log-analytics).
- Сведения о доступе к данным метрик из Azure PowerShell см. в разделе [Справочник по метрикам Azure PowerShell](/powershell/module/azurerm.insights/get-azurermmetric).
- Сведения о доступе к данным журналов Azure Monitor с помощью запроса журнала из Azure PowerShell см. в разделе [Справочник по запросам журнала Azure PowerShell](/powershell/module/az.operationalinsights/Invoke-AzOperationalInsightsQuery).

## <a name="monitoring-from-rest-api"></a>Мониторинг с REST API
Включите данные мониторинга, собранные из ресурса, в пользовательское приложение, используя REST API.

- Дополнительные сведения о доступе к метрикам из REST API Azure Monitor см. в разделе [Пошаговое руководство по REST API Azure Monitor](../platform/rest-api-walkthrough.md).
- Сведения о доступе к данным журналов Azure Monitor с помощью запроса журнала из Azure PowerShell см. в разделе [REST API Azure Log Analytics](https://dev.loganalytics.io/).

## <a name="alerts"></a>видны узлы
[Оповещения](../platform/alerts-overview.md) позволяют заранее получать уведомления и принимать меры в связи с важными условиями, обнаруженными в ваших данных мониторинга. Вы создаете правило генерации оповещений, определяющее целевой объект оповещения, условия создания оповещения и ответные действия.

Для различных типов правил генерации оповещений используются различные виды данных мониторинга.

- [Оповещение журнала действий](../platform/alerts-activity-log.md) — оповещение выдается при создании в журнале действий записи, соответствующей указанным условиям. Это позволяет получать уведомления, например при создании определенного типа ресурса или сбое изменения конфигурации.
- [Оповещение метрики](../platform/alerts-metric.md) — создает оповещение, если значение метрики превышает определенный порог. Оповещения метрик быстро реагируют на изменения и могут автоматически разрешаться после устранения проблемы.
- [Оповещение при запросе журнала](../platform/alerts-log.md) — выполнение запроса журнала через регулярные промежутки времени и создание оповещения при обнаружении определенного условия. Это позволяет выполнять сложный анализ по нескольким наборам данных.

Используйте **Оповещения** из меню ресурса для просмотра оповещений и управления правилами генерации оповещений для этого ресурса. Только оповещения журнала действий и метрик используют отдельные ресурсы Azure в качестве целевых объектов. Оповещения о запросах журнала используют рабочую область Log Analytics в качестве целевого объекта и основываются на запросе, который может обращаться к любым журналам, хранящимся в этой рабочей области. Используйте меню Azure Monitor для просмотра и контроля оповещений для всех ресурсов, а также управления правилами генерации оповещений для запросов журналов.

- Дополнительные сведения о создании правил генерации оповещений см. в статьях, посвященных различным типам оповещений.
- Дополнительные сведения о создании группы действий, которая позволяет управлять ответами на оповещения, см. в разделе [Создание групп действий и управление ими на портале Azure](../platform/action-groups.md).



## <a name="next-steps"></a>Дальнейшие действия

* См. сведения о журналах ресурсов для разных служб Azure в описании [поддерживаемых служб, схем и категорий для журналов ресурсов Azure](../platform/resource-logs-schema.md).