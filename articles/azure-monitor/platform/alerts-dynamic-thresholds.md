---
title: Создание оповещений с динамическими пороговыми значениями в Azure Monitor
description: Создание оповещений с использованием динамических пороговых значений на основе машинного обучения
author: yanivlavi
services: azure-monitor
ms.service: azure-monitor
ms.topic: conceptual
ms.date: 04/26/2019
ms.author: yalavi
ms.reviewer: mbullwin
ms.openlocfilehash: 750aded128804468ae557d7c016a50c5378d9217
ms.sourcegitcommit: 6bb98654e97d213c549b23ebb161bda4468a1997
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/03/2019
ms.locfileid: "74762524"
---
# <a name="metric-alerts-with-dynamic-thresholds-in-azure-monitor"></a>Оповещения метрик с динамическими пороговыми значениями в Azure Monitor

Оповещения по метрикам с динамическими порогами — это обнаружение на основе сложного машинного обучения, которое позволяет изучить исторические сведения о поведении метрик, отслеживать закономерности и аномалии, свидетельствующие о потенциальном наличии проблем. Они поддерживают как простой пользовательский интерфейс, так и операции в крупном масштабе, позволяя настроить правила генерации оповещений в полностью автоматическом режиме с помощью API Azure Resource Manager.

Созданное правило генерации оповещений срабатывает только, когда отслеживаемая метрика проявляет нетипичное поведение, то есть выходит за пределы настроенных для нее порогов.

Нам очень важны ваши отзывы, которые вы можете отправить на адрес <azurealertsfeedback@microsoft.com>.

## <a name="why-and-when-is-using-dynamic-condition-type-recommended"></a>Когда и для чего можно использовать динамический тип условия?

1. **Масштабируемые предупреждения** — правила оповещений с динамическим пороговым значением могут одновременно создавать собственные пороговые значения для сотен рядов метрик, тем самым предоставляя такую же простоту в определении правила генерации оповещений для одной метрики. Они предоставляют меньше предупреждений для создания и управления. Для их создания можно использовать либо портал Azure, либо Azure Resource Manager API. Масштабируемый подход особенно полезен при работе с измерениями метрик или при применении к нескольким ресурсам, например ко всем ресурсам подписки.  [Дополнительные сведения о настройке оповещений по метрикам с динамическими порогами с помощью шаблонов](alerts-metric-create-templates.md).

1. **Интеллектуальное распознавание шаблона метрики** . с помощью нашей технологии машинного обучения мы можем автоматически обнаруживать закономерности и адаптировать их к изменениям метрик с течением времени, что часто может включать в себя сезонности (ежечасно, ежедневно или еженедельно). Адаптация к поведению метрик в зависимости от времени и предупреждений, основанных на отклонениях от его шаблона, снижает нагрузку на пороговое значение "Right" для каждой метрики. Алгоритм машинного обучения, который применяется для создания динамических порогов, специально разработан для устранения слишком шумных (с низкой точностью) и слишком широких (с низкой полнотой) порогов для метрик без очевидных тенденций.

1. **Интуитивная конфигурация** — динамические пороговые значения позволяют настраивать оповещения метрик с помощью высокоуровневых концепций, что позволяет избежать необходимости иметь обширные знания о метрике предметной области.

## <a name="how-to-configure-alerts-rules-with-dynamic-thresholds"></a>Как правильно настроить оповещения с динамическими порогами?

Вы можете настроить оповещения с динамическими порогами с помощью функции "Оповещения метрики" в Azure Monitor. [Дополнительные сведения о настройке оповещений по метрикам](alerts-metric.md).

## <a name="how-are-the-thresholds-calculated"></a>Как вычисляются пороговые значения?

Динамические пороги постоянно изучают ряд данных метрики и пытаются смоделировать их по нескольким алгоритмам и методам. Она выявляет закономерности в данных, например периодические изменения (ежечасно, ежедневно, еженедельно), и поддерживает обработку шумных метрик (например, использование ЦП или памяти компьютера) и метрик с низкой дисперсией (например, уровень доступности и количество ошибок).

Пороги выбираются так, чтобы любое отклонение от выбранных значений обозначало аномальное поведение метрики.

> [!NOTE]
> Периодическое определение шаблона имеет значение часа, дня или недели. Это означает, что другие шаблоны, такие как бихаурли или семивикли, могут не быть обнаружены.

## <a name="what-does-sensitivity-setting-in-dynamic-thresholds-mean"></a>Что означает параметр "Sensitivity" (Чувствительность) в настройке динамических порогов?

Чувствительность порога для оповещения — это концепция высокого уровня, которая обозначает допустимое отклонение от типичного поведения метрики, при превышении которого срабатывает оповещение.
Такой параметр не требует понимания предметной области и сведений о статических пороговых значениях метрики. Доступны следующие варианты.

- Высокий — пороги будут близки к ожидаемому поведению данных метрики. Правило генерации оповещений будет запущено при наименьшем отклонении, что приведет к дополнительным предупреждениям.
- Средний (используется по умолчанию) — менее строгий и более сбалансированный уровень порога, на котором создается меньше оповещений, чем на высоком уровне.
- Низкий — пороги будут достаточно "вольными", то есть располагаются дальше от ожидаемых значений метрик. Правило генерации оповещений будет запущено только в больших отклонениях, что приведет к уменьшению количества предупреждений.

## <a name="what-are-the-operator-setting-options-in-dynamic-thresholds"></a>Что означает параметр "Operator" (Оператор) в настройке динамических порогов?

Одно правило генерации оповещений с динамическими порогами может создавать пороги для верхнего и нижнего пределов на основе поведения конкретной метрики.
Вы можете настроить срабатывание оповещения по одному из следующих трех условий.

- Больше верхнего порогового значения или меньше нижнего порогового значения (по умолчанию)
- Больше верхнего порогового значения
- Меньше нижнего порогового значения

## <a name="what-do-the-advanced-settings-in-dynamic-thresholds-mean"></a>Что можно настроить в дополнительных параметрах для динамических порогов?

**Неудачные периоды** . динамические пороговые значения также позволяют настроить "нарушения числа для активации предупреждения", минимальное количество отклонения, необходимое в течение определенного периода времени для создания предупреждения системой (временное окно по умолчанию — четыре отклонения в 20 минут). Пользователь может настроить периоды сбоя и поведение оповещения, изменяя периоды сбоя и временное окно. Эта возможность сокращает количество "шума" от лишних оповещений при кратковременных всплесках. Пример.

Чтобы инициировать оповещение, если проблема возникает непрерывно в течение 20 минут, то есть 4 раза подряд с группировкой по 5-минутному периоду, используйте следующие параметры:

![Настройки периода сбоя для непрерывного нарушения в течение 20 минут, 4 раза подряд по периодам с группировкой по 5 минут](media/alerts-dynamic-thresholds/0008.png)

Чтобы инициировать оповещение при нарушении динамического порогового значения в течение 20 минут за последние 30 минут с 5-минутным периодом, используйте следующие параметры:

![Настройки периода сбоя для нарушения в течение 20 минут за последние 30 минут с группировкой по 5 минут](media/alerts-dynamic-thresholds/0009.png)

**Игнорировать данные до** — пользователи могут определить начальную дату, с которой система начнет вычисление порогов. Такая возможность полезна, например, если ресурс ранее работал в режиме тестирования, и только сейчас переводится в рабочую нагрузку для рабочей среды. Это означает, что поведение любых метрик на стадии тестирования следует исключить из рассмотрения.

## <a name="how-do-you-find-out-why-a-dynamic-thresholds-alert-was-triggered"></a>Как узнать, почему было активировано оповещение о динамических пороговых значениях?

Вы можете исследовать активированные экземпляры предупреждений в представлении "предупреждения", щелкнув ссылку в сообщении электронной почты или в тексте сообщения или браузер, чтобы просмотреть представление "предупреждения" в портал Azure. Дополнительные [сведения о представлении "предупреждения"](alerts-overview.md#alerts-experience).

В представлении "предупреждения" отображаются следующие сведения:

- Все сведения о метрике на момент срабатывания предупреждения о динамических пороговых значениях.
- Диаграмма периода, в котором было активировано оповещение, включающее динамические пороговые значения, используемые в данный момент времени.
- Возможность отправки отзывов о предупреждениях о динамических пороговых значениях и представлениях предупреждений, что может улучшить обнаружение в будущем.

## <a name="will-slow-behavior-changes-in-the-metric-trigger-an-alert"></a>Будет ли снижение производительности в метрике активировать оповещение?

Скорее всего, нет. Динамические пороговые значения подходят для обнаружения значительных отклонений, а не постепенно накапливающихся проблем.

## <a name="how-much-data-is-used-to-preview-and-then-calculate-thresholds"></a>Какой объем данных используется для анализа и вычисления порогов?

Когда и Alert создаются впервые, пороговые значения, отображаемые на диаграмме, рассчитываются на основе достаточного количества исторических данных для вычисления ежедневных или дневных сезонных шаблонов (10 дней). После создания правила генерации оповещений динамические пороговые значения используют все необходимые исторические данные, которые будут постоянно изучены и адаптированы на основе новых данных, чтобы сделать пороги более точными. Это означает, что после этого вычисления на диаграмме также будут отображаться еженедельные шаблоны.

## <a name="how-much-data-is-needed-to-trigger-an-alert"></a>Сколько данных необходимо для активации предупреждения?

Если у вас есть новый ресурс или отсутствуют данные метрики, то динамические пороговые значения не будут вызывать предупреждения до тех пор, пока не будут доступны данные за три дня, чтобы обеспечить точное пороговое значение.

## <a name="dynamic-thresholds-best-practices"></a>Рекомендации по динамическим порогам

Динамические пороги можно применять к любой платформе или пользовательской метрике в Azure Monitor. Они также настроены для метрик распространенных приложений и инфраструктур.
Следующие подразделы являются рекомендациями по настройке оповещений для некоторых из этих метрик с использованием динамических порогов.

### <a name="dynamic-thresholds-on-virtual-machine-cpu-percentage-metrics"></a>Динамические пороги для метрик процента потребления ЦП виртуальной машины

1. На [портале Azure](https://portal.azure.com) выберите **Монитор**. В представлении "Монитор" объединены все параметры мониторинга и все данные.

2. Щелкните **Оповещения** и выберите **+ Новое правило генерации оповещений**.

    > [!TIP]
    > В большинстве колонок ресурсов в меню ресурсов также есть **оповещения** в разделе **Мониторинг**, и вы также можете создать оповещения там.

3. Щелкните **Выбор цели**, в загружаемой контекстной области выберите целевой ресурс, для которого следует создать оповещение. В раскрывающихся списках **Подписка** и **'Virtual Machines' Resource type** (Тип ресурса "Виртуальная машина") найдите ресурс, который вы хотите отслеживать. Вы также можете найти ресурс с помощью панели поиска.

4. После выбора целевого ресурса щелкните **Добавить условие**.

5. Выберите **Процент ЦП**.

6. При необходимости уточните метрику, настроив**период** и **агрегирование**. Не рекомендуется использовать тип агрегирования "Максимальный" для этого типа метрики, так как он не точно представляет реакцию на событие. Статистический порог более подходит для типа агрегирования "Максимальный".

7. Вы увидите график метрики за последние 6 часов. Определите параметры оповещений.
    1. **Тип условия** — выберите параметр "Динамический".
    1. **Чувствительность** — выберите средний или низкий уровень чувствительности, чтобы сократить количество лишних оповещений.
    1. **Оператор** — выберите параметр "Больше чем", если реакция на событие не представляет использование приложения.
    1. **Частота** — рассмотрите возможность снижения частоты на основе влияния оповещений на бизнес.
    1. **Failing Periods** (Периоды сбоя) (расширенный параметр) — окно должно быть не менее 15 минут. Например, если период равен пяти минутам, периоды сбоя должны быть равны трем или большему числу.

8. На диаграмме метрик отображаются вычисленные пороговые значения на основе последних данных.

9. Нажмите кнопку **Done**(Готово).

10. Заполните **сведения об оповещении**, такие как **имя правила генерации оповещений**, **описание** и **серьезность**.

11. Добавьте группу действий в оповещение: выберите имеющуюся или создайте группу действий.

12. Нажмите кнопку **Готово** для сохранения правила генерации оповещений метрики.

> [!NOTE]
> Правила генерации оповещений метрики, созданные на портале, создаются в той же группе ресурсов, что и целевой ресурс.

### <a name="dynamic-thresholds-on-application-insights-http-request-execution-time"></a>Динамические пороги для времени выполнения HTTP-запроса в Application Insights

1. На [портале Azure](https://portal.azure.com) выберите **Монитор**. В представлении "Монитор" объединены все параметры мониторинга и все данные.

2. Щелкните **Оповещения** и выберите **+ Новое правило генерации оповещений**.

    > [!TIP]
    > В большинстве колонок ресурсов в меню ресурсов также есть **оповещения** в разделе **Мониторинг**, и вы также можете создать оповещения там.

3. Щелкните **Выбор цели**, в загружаемой контекстной области выберите целевой ресурс, для которого следует создать оповещение. В раскрывающихся списках **Подписка** и **'Application Insights' Resource type** (Тип ресурса "Application Insights") найдите ресурс, который вы хотите отслеживать. Вы также можете найти ресурс с помощью панели поиска.

4. После выбора целевого ресурса щелкните **Добавить условие**.

5. Выберите **Время выполнения HTTP-запроса**.

6. При необходимости уточните метрику, настроив**период** и **агрегирование**. Не рекомендуется использовать тип агрегирования "Максимальный" для этого типа метрики, так как он не точно представляет реакцию на событие. Статистический порог более подходит для типа агрегирования "Максимальный".

7. Вы увидите график метрики за последние 6 часов. Определите параметры оповещений.
    1. **Тип условия** — выберите параметр "Динамический".
    1. **Оператор** — выберите "Больше чем", чтобы уменьшить количество оповещений при улучшении продолжительности.
    1. **Частота** — рассмотрите возможность снижения частоты на основе влияния оповещений на бизнес.

8. На диаграмме метрик отображаются вычисленные пороговые значения на основе последних данных.

9. Нажмите кнопку **Done**(Готово).

10. Заполните **сведения об оповещении**, такие как **имя правила генерации оповещений**, **описание** и **серьезность**.

11. Добавьте группу действий в оповещение: выберите имеющуюся или создайте группу действий.

12. Нажмите кнопку **Готово** для сохранения правила генерации оповещений метрики.

> [!NOTE]
> Правила генерации оповещений метрики, созданные на портале, создаются в той же группе ресурсов, что и целевой ресурс.

## <a name="interpreting-dynamic-threshold-charts"></a>Интерпретация динамических диаграмм пороговых значений

Ниже приведена диаграмма, показывающая метрику, ее динамические пределы и некоторые предупреждения, возникающие, когда значение выходит за пределы допустимых порогов.

![Дополнительные сведения о настройке оповещений метрик](media/alerts-dynamic-thresholds/threshold-picture-8bit.png)

Используйте следующие сведения для интерпретации предыдущей диаграммы.

- **Синяя линия** — фактическая измеренная метрика с течением времени.
- **Синяя затененная область** — показывает допустимый диапазон для метрики. Пока значения метрик остаются в пределах этого диапазона, предупреждение не выдается.
- **Синие точки** . Если щелкнуть часть диаграммы, а затем навести указатель мыши на синюю линию, в курсоре появится синяя точка, показывающая отдельное агрегированное значение метрики.
- **Всплывающее окно с синей точкой** — показывает измеряемое значение метрики (синяя точка), а также верхние и нижние значения разрешенного диапазона.  
- **Красная точка с черным кругом** — показывает первое значение метрики из допустимого диапазона. Это значение, которое запускает оповещение метрики и помещает его в активное состояние.
- **Красные точки**— обозначают дополнительные измеряемые значения за пределами допустимого диапазона. Они не будут вызывать дополнительные оповещения о метриках, но оповещение остается в активном состоянии.
- **Красная область** — показывает время, когда значение метрики находится за пределами допустимого диапазона. Предупреждение остается в активном состоянии, если последующие измеряемые значения выходят за пределы допустимого диапазона, но новые предупреждения не срабатывают.
- **Конец красной области** . когда синяя линия помещается в допустимые значения, красная область останавливается, а измеряемая строка значения становится синей. Состояние оповещения метрики, запущенного во время красной точки с черным контуром, задается как разрешенное. 
