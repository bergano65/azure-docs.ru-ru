---
title: Получение журналов IIS с помощью агента Log Analytics в Azure Monitor
description: Службы IIS (Internet Information Services) хранят данные об активности пользователей в файлах журналов, собираемых службой Azure Monitor.  В этой статье описано, как настроить сбор журналов IIS и сведения о записях, созданных ими в службе Azure Monitor.
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 11/13/2020
ms.openlocfilehash: a089631ab199b0fe997bba001561c6b027034e2c
ms.sourcegitcommit: 9826fb9575dcc1d49f16dd8c7794c7b471bd3109
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2020
ms.locfileid: "94628753"
---
# <a name="collect-iis-logs-with-log-analytics-agent-in-azure-monitor"></a>Получение журналов IIS с помощью агента Log Analytics в Azure Monitor
Службы IIS (IIS) хранит данные о действиях пользователей в файлах журнала, которые могут собираться агентом Log Analytics и храниться в [Azure Monitor журналах](data-platform.md).

> [!IMPORTANT]
> В этой статье рассматривается сбор журналов IIS с помощью [агента log Analytics](log-analytics-agent.md) , который является одним из агентов, используемых Azure Monitor. Другие агенты собираются разные данные и настраиваются по-разному. Список доступных агентов и данных, которые они могут собираются, см. в разделе [Обзор агентов Azure Monitor](agents-overview.md) .

![Журналы IIS](media/data-sources-iis-logs/overview.png)

## <a name="configuring-iis-logs"></a>Настройка журналов IIS
Служба Azure Monitor собирает записи из файлов журналов, созданных службами IIS, поэтому вам необходимо [настроить IIS для ведения журнала](/previous-versions/orphan-topics/ws.11/hh831775(v=ws.11)).

Служба Azure Monitor поддерживает только те файлы журналов IIS, которые хранятся в формате W3C, и не поддерживает настраиваемые поля или расширенное ведение журналов IIS. Она не собирает журналы в формате NCSA или в собственном формате IIS.

Настройте журналы IIS в Azure Monitor из [меню дополнительных параметров](agent-data-sources.md#configuring-data-sources) для агента log Analytics.  Никакие настройки, кроме выбора параметра **Сбор файлов журналов IIS в формате W3C** , не требуются.


## <a name="data-collection"></a>Сбор данных
Azure Monitor собирает записи журнала IIS из каждого агента при каждом изменении отметок времени журнала. Журнал считывается каждые **5 минут**. Если по какой-либо причине IIS не обновляет метку времени до момента, когда создается новый файл, записи будут собираться после создания нового файла. Частота создания нового файла определяется параметром **расписания развертывания файла журнала** для сайта IIS, который по умолчанию имеет значение один раз в день. Если параметр имеет значение **ежечасно** , Azure Monitor собирает журнал каждый час. Если параметр имеет значение **ежедневно** , Azure Monitor собирает журнал каждые 24 часа.

> [!IMPORTANT]
> Рекомендуется задать для **расписания развертывания файла журнала** значение **ежечасно**. Если задано **ежедневное** значение, вы можете столкнуться с пиковыми нагрузками на данные, так как они будут собираться только один раз в день.

## <a name="iis-log-record-properties"></a>Свойства записей в журналах IIS
Записи в журналах IIS относятся к типу **W3CIISLog** и обладают свойствами, описанными в таблице ниже.

| Свойство. | Описание |
|:--- |:--- |
| Компьютер |Имя компьютера, с которого было получено событие. |
| cIP |IP-адрес клиента. |
| csMethod |Метод запроса, такой как GET или POST. |
| csReferer |Сайт, с которого пользователь перешел на текущий сайт. |
| csUserAgent |Тип браузера клиента. |
| csUserName |Имя прошедшего проверку пользователя, который подключился к серверу. Анонимные пользователи обозначаются дефисом. |
| csUriStem |Целевой объект запроса, такой как веб-страница. |
| csUriQuery |Запрос, который пытался выполнить клиент (если есть). |
| ManagementGroupName |Имя группы управления для агентов Operations Manager.  Для других агентов это AOI-\<workspace ID\>. |
| RemoteIPCountry |Страна или регион IP-адреса клиента. |
| RemoteIPLatitude |Широта IP-адреса клиента. |
| RemoteIPLongitude |Долгота IP-адреса клиента. |
| scStatus |Код состояния HTTP. |
| scSubStatus |Код ошибки подсостояния . |
| scWin32Status |Код состояния Windows. |
| sIP |IP-адрес веб-сервера. |
| SourceSystem |OpsMgr |
| sPort |Порт на сервере, к которому подключен клиент. |
| sSiteName |Имя сайта IIS. |
| TimeGenerated |Дата и время регистрации записи. |
| TimeTaken |Время обработки запроса в миллисекундах. |

## <a name="log-queries-with-iis-logs"></a>Запросы для получения записей журналов IIS
В следующей таблице представлены различные примеры запросов к журналу, извлекающих записи из журналов IIS.

| Запрос | Описание |
|:--- |:--- |
| W3CIISLog |Все записи в журнале IIS. |
| W3CIISLog &#124; where scStatus==500 |Все записи журнала IIS с состоянием возврата 500. |
| W3CIISLog &#124; summarize count() by cIP |Число записей в журнале IIS по IP-адресу клиента. |
| W3CIISLog &#124; где Кшост = = "www \. contoso.com" &#124; суммировать Count () по ксуристем |Число записей журнала IIS по URL-адресу узла www \. contoso.com. |
| W3CIISLog &#124; summarize sum(csBytes) by Computer &#124; take 500000 |Общее количество байтов, полученных каждым компьютером IIS. |

## <a name="next-steps"></a>Дальнейшие действия
* Настройте в службе Azure Monitor сбор других [источников данных](agent-data-sources.md) для анализа.
* Узнайте больше о [запросах журнала](../log-query/log-query-overview.md), которые можно применять для анализа данных, собираемых из источников данных и решений.
