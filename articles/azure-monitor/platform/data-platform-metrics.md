---
title: Метрики в Azure Monitor | Документация Майкрософт
description: Описывает метрики в Azure Monitor, которые являются данными упрощенного мониторинга, поддерживающими сценарии практически в реальном времени.
documentationcenter: ''
author: bwren
manager: carmonm
editor: tysonn
ms.service: azure-monitor
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/26/2019
ms.author: bwren
ms.openlocfilehash: e534754e46e6f2ad9b99b67d24d9f7da63a51a4f
ms.sourcegitcommit: 55f7fc8fe5f6d874d5e886cb014e2070f49f3b94
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2019
ms.locfileid: "71258366"
---
# <a name="metrics-in-azure-monitor"></a>Метрики в Azure Monitor

> [!NOTE]
> Платформа данных Azure Monitor основана на двух основных типах данных: Метрики и журналы. В этой статье описываются метрики. Подробные сведения о журналах и [Azure Monitor платформе данных](data-platform.md) для сравнения двух служб см. в [журналах Azure Monitor](data-platform-logs.md) .

Метрики в Azure Monitor являются облегченными и способны поддерживать сценарии практически в реальном времени, что делает их особенно полезными для предупреждений и быстрого обнаружения проблем. В этой статье описывается структура метрик, возможные действия с ними и определение различных источников данных, которые хранят данные в метриках.

## <a name="what-are-metrics"></a>Что такое метрики
Метрики — это числовые значения, которые описывают конкретный аспект системы в определенный момент времени. Метрики собираются с регулярными интервалами и полезны для создания предупреждений, так как их можно часто выдавать, а оповещение может быть быстро запущено с относительно простой логикой.

## <a name="what-can-you-do-with-azure-monitor-metrics"></a>Что можно сделать с помощью метрик Azure Monitor?
В следующей таблице перечислены различные способы использования данных метрик в Azure Monitor.

|  |  |
|:---|:---|
| Анализировать | Используйте [Обозреватель метрик](metrics-charts.md) для анализа собранных метрик на диаграмме и сравнения метрик из разных ресурсов. |
| Визуализировать | Закрепление диаграммы из обозревателя метрик на [панели мониторинга Azure](../learn/tutorial-app-dashboards.md).<br>Создание [книги](../app/usage-workbooks.md) для объединения с несколькими наборами данных в интерактивном отчете. Экспортируйте результаты запроса в [Grafana](grafana-plugin.md) , чтобы использовать его панель мониторинга и объединить с другими источниками данных. |
| Оповещение | Настройте [правило оповещения метрики](alerts-metric.md) , которое отправляет уведомление или выполняет [Автоматическое действие](action-groups.md) , когда значение метрики пересекает порог. |
| Автоматизация |  Используйте [Автомасштабирование](autoscale-overview.md) для увеличения или уменьшения ресурсов на основе значения метрики, перевернутого пороговое значение. |
| Экспорт | [Перенаправление метрик в журналы](resource-logs-collect-storage.md) для анализа данных в Azure Monitor метриках вместе с данными в журналах Azure Monitor и для хранения значений метрик дольше 93 дней.<br>Потоковая передача метрик в [концентратор событий](stream-monitoring-data-event-hubs.md) для их направления на внешние системы. |
| Получить | Доступ к значениям метрик из командной строки с помощью [командлетов PowerShell](https://docs.microsoft.com/powershell/module/az.applicationinsights)<br>Доступ к значениям метрик из пользовательского приложения с помощью [REST API](rest-api-walkthrough.md).<br>Доступ к значениям метрик из командной строки с помощью [CLI](/cli/azure/monitor/metrics). |
| Архив | [Архивация](..//learn/tutorial-archive-data.md) журнала производительности и работоспособности ресурса в целях соответствия требованиям, аудита или автономной отчетности. |

## <a name="how-is-data-in-azure-monitor-metrics-structured"></a>Как структурированы данные в метриках Azure Monitor?
Данные, собранные метриками Azure Monitor, хранятся в базе данных временных рядов, которая оптимизирована для анализа данных с отметками времени. Каждый набор значений метрик представляет собой временный ряд со следующими свойствами:

* Время, когда было собрано значение
* Ресурс, с которым связано значение
* Пространство имен, действующее как категория метрики
* Имя метрики
* Само значение
* Некоторые метрики могут иметь несколько измерений, как описано в [многомерных](#multi-dimensional-metrics) метриках. Пользовательские метрики могут иметь до 10 измерений.

## <a name="multi-dimensional-metrics"></a>Многомерные метрики
Одной из проблем с метриками данных является то, что она часто содержит ограниченные сведения для предоставления контекста для собранных значений. Azure Monitor решает эту проблему с многомерными метриками. Измерения метрики — это пары имя-значение, которые используются для передачи дополнительных данных с описаниями значения метрики. Например, _доступное место на диске_ может иметь измерение с именем _Drive_ со значениями _C:_ , _D:_ , что позволит просматривать либо доступное дисковое пространство на всех дисках, либо отдельно для каждого диска.

В примере ниже показаны два набора данных для гипотетической метрики с названием _Пропускная способность сети_. В первом наборе данных нет измерений. Во втором наборе данных показаны значения с двумя измерениями, _IP-адрес_ и _Направление_:

### <a name="network-throughput"></a>Пропускная способность сети

| Метка времени     | Значение метрики |
| ------------- |:-------------|
| 8/9/2017 8:14 | 1331,8 Кбит/с |
| 8/9/2017 8:15 | 1141,4 Кбит/с |
| 8/9/2017 8:16 | 1110,2 Кбит/с |

Такая метрика без измерений поможет найти ответ только на простые вопросы, например о том, какой была пропускная способность в определенный момент времени.

### <a name="network-throughput--two-dimensions-ip-and-direction"></a>Пропускная способность сети и два измерения ("IP-адрес" и "Направление")

| Метка времени     | Измерение "IP-адрес"   | Измерение "Направление" | Значение метрики|
| ------------- |:-----------------|:------------------- |:-----------|
| 8/9/2017 8:14 | IP-адрес — 192.168.5.2 | Направление — отправка    | 646,5 Кбит/с |
| 8/9/2017 8:14 | IP-адрес — 192.168.5.2 | Направление — получение | 420,1 Кбит/с |
| 8/9/2017 8:14 | IP-адрес — 10.24.2.15  | Направление — отправка    | 150,0 Кбит/с |
| 8/9/2017 8:14 | IP-адрес — 10.24.2.15  | Направление — получение | 115,2 Кбит/с |
| 8/9/2017 8:15 | IP-адрес — 192.168.5.2 | Направление — отправка    | 515,2 Кбит/с |
| 8/9/2017 8:15 | IP-адрес — 192.168.5.2 | Направление — получение | 371,1 Кбит/с |
| 8/9/2017 8:15 | IP-адрес — 10.24.2.15  | Направление — отправка    | 155,0 Кбит/с |
| 8/9/2017 8:15 | IP-адрес — 10.24.2.15  | Направление — получение | 100,1 Кбит/с |

Эта метрика поможет найти ответ на вопросы о том, какая пропускная способность для каждого IP-адреса и сколько данных было отправлено и получено. Многомерные метрики имеют дополнительные значения аналитики и диагностики в отличие от метрик без измерений.

## <a name="interacting-with-azure-monitor-metrics"></a>Взаимодействие с метриками Azure Monitor
Используйте [Обозреватель метрик](metrics-charts.md) для интерактивного анализа данных в базе данных метрик и создания диаграммы значений нескольких метрик с течением времени. Вы можете закрепить диаграммы на панели мониторинга, чтобы просматривать их с другими визуализациями. Кроме того, вы можете извлечь метрики с помощью [REST API мониторинга Azure](rest-api-walkthrough.md).

![Обозреватель метрик](media/data-platform/metrics-explorer.png)

## <a name="sources-of-azure-monitor-metrics"></a>Источники метрик Azure Monitor
Существует три основных источника метрик, собираемых службой Azure Monitor. После сбора метрик в базе данных метрик Azure Monitor их можно вычислить вместе, независимо от их источника.

**Метрики платформы** создаются ресурсами Azure и наглядно отображают работоспособность и производительность этих ресурсов. Каждый тип ресурсов создает [отдельный набор метрик](metrics-supported.md), который не нужно настраивать. Метрики платформы собираются из ресурсов Azure с частотой в одну минуту, если в определении метрики не указано иное. 

**Метрики гостевой ОС** собираются из гостевой операционной системы виртуальной машины. Включите метрики гостевой ОС для виртуальных машин Windows с помощью [расширения диагностики Windows (WAD)](../platform/diagnostics-extension-overview.md) и виртуальных машин Linux с [агентом инфлуксдата Telegraf](https://www.influxdata.com/time-series-platform/telegraf/).

**Метрики приложений** создаются службой Application Insights для отслеживаемых приложений и помогают обнаруживать проблемы производительности и отслеживать тенденции использования приложений. Сюда входит ряд значений, в том числе значения _Время отклика сервера_ и _Исключения браузера_.

**Пользовательские метрики** — это метрики, определяемые в дополнение к стандартным метрикам, которые доступны автоматически. Вы можете [определить пользовательские метрики в приложении](../app/api-custom-events-metrics.md) , которое отслеживается Application Insights или создать пользовательские метрики для службы Azure с помощью [API настраиваемых метрик](metrics-store-custom-rest-api.md).

## <a name="retention-of-metrics"></a>Хранение метрик
Для большинства ресурсов в Azure метрики хранятся в течение 93 дней. Существуют некоторые исключения.

**Метрики гостевой ОС**
-   **Классические метрики гостевой ОС**. Это счетчики производительности, собираемые [расширением диагностики Windows (WAD)](../platform/diagnostics-extension-overview.md) или [диагностическое расширение Linux (lad)](../../virtual-machines/extensions/diagnostics-linux.md) и направляемые в учетную запись хранения Azure. Срок хранения этих метрик составляет 14 дней.
-   **Метрики гостевой ОС отправляются в метрики Azure Monitor**. Это счетчики производительности, собираемые модулем диагностики Windows (WAD) и отправляемые в [приемник Azure Monitor](diagnostics-extension-overview.md#data-storage)или через [Агент инфлуксдата Telegraf](https://www.influxdata.com/time-series-platform/telegraf/) на компьютерах Linux. Срок хранения этих метрик составляет 93 дней.
-   **Метрики гостевой ОС, собранные агентом log Analytics**. Это счетчики производительности, собираемые агентом Log Analytics и отправляемые в рабочую область Log Analytics. Срок хранения этих метрик составляет 31 день, и его можно продлить до 2 лет.

**Application Insights метрики на основе журнала**. 
- В фоновом [режиме метрики на основе журнала](../app/pre-aggregated-metrics-log-metrics.md) переводятся в запросы журнала. Их хранение соответствует хранению событий в базовых журналах. Для Application Insightsных ресурсов журналы хранятся в течение 90 дней.


> [!NOTE]
> Вы можете [Отправить метрики платформы для Azure Monitor ресурсов в рабочую область log Analytics](resource-logs-collect-storage.md) для долгосрочного прогнозирования.





## <a name="next-steps"></a>Следующие шаги

- Дополнительные сведения о [платформе Azure Monitor Data Platform](data-platform.md).
- Сведения о [данных журнала в Azure Monitor](data-platform-logs.md).
- Узнайте о [доступных данных мониторинга](data-sources.md) для различных источников в Azure.
