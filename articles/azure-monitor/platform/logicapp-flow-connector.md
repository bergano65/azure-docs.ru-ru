---
title: Использование журналов Azure Monitor с Azure Logic Apps и автоматизацией электропитания
description: Узнайте, как можно использовать Azure Logic Apps и Power автоматизирующие для быстрой автоматизации повторяемых процессов с помощью соединителя Azure Monitor.
ms.service: azure-monitor
ms.subservice: logs
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 03/13/2020
ms.openlocfilehash: 2ef7095d186902425adb5065c470325be1283023
ms.sourcegitcommit: 5f7b75e32222fe20ac68a053d141a0adbd16b347
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/31/2020
ms.locfileid: "87475742"
---
# <a name="azure-monitor-logs-connector-for-logic-apps-and-power-automate"></a>Соединитель Azure Monitor журналов для Logic Apps и автоматизации энергосбережения
[Azure Logic Apps](../../logic-apps/index.yml) и [Power автоматизировать](https://flow.microsoft.com) позволяют создавать автоматизированные рабочие процессы с помощью сотен действий для различных служб. Соединитель Azure Monitor Logs позволяет создавать рабочие процессы, которые извлекают данные из Log Analytics рабочей области или приложения Application Insights в Azure Monitor. В этой статье описываются действия, входящие в соединитель, и приводится пошаговое руководство по созданию рабочего процесса с использованием этих данных.

Например, можно создать приложение логики, которое будет использовать Azure Monitor данные журнала в уведомлении по электронной почте от Office 365, создать ошибку в Azure DevOps или опубликовать сообщение о резерве.  Вы можете запускать рабочие процессы с помощью простого расписания или какого-либо действия в подключенной службе, например при получении почты или твита. 

## <a name="connector-limits"></a>Ограничения соединителей
Соединитель журналов Azure Monitor имеет следующие ограничения:
* Максимальный размер данных: 16 МБ
* Максимальный размер ответа на запрос 100 МБ
* Максимальное число записей: 500 000
* Максимальное время ожидания запроса 110 секунд.

В зависимости от размера данных и используемого запроса соединитель может попасть в пределы и завершиться с ошибкой. Эти случаи можно обойти, если вы настраиваете повторение триггера для более частого выполнения и запросы меньше данных. Можно использовать запросы, которые объединяют данные, чтобы вернуть меньше записей и столбцов.

## <a name="actions"></a>Действия
В следующей таблице описаны действия, входящие в соединитель журналов Azure Monitor. Оба варианта позволяют выполнять запрос к журналу в Log Analytics рабочей области или Application Insights приложении. Разница заключается в способе возврата данных.

> [!NOTE]
> Соединитель журналов Azure Monitor заменяет [соединитель log Analytics Azure](/connectors/azureloganalytics/) и [соединитель Application Insights Azure](/connectors/applicationinsights/). Этот соединитель предоставляет те же функции, что и другие, и является предпочтительным методом для выполнения запроса к Log Analytics рабочей или Application Insights приложению.


| Действие | Описание |
|:---|:---|
| [Выполнение запроса и вывод списка результатов](/connectors/azuremonitorlogs/#run-query-and-list-results) | Возвращает каждую строку в виде своего собственного объекта. Используйте это действие, если требуется работать с каждой строкой отдельно в оставшейся части рабочего процесса. Для действия обычно следует действие a [для каждого действия](../../logic-apps/logic-apps-control-flow-loops.md#foreach-loop). |
| [Выполнение запроса и визуализация результатов](/connectors/azuremonitorlogs/#run-query-and-visualize-results) | Возвращает все строки результирующего набора в виде одного отформатированного объекта. Используйте это действие, если вы хотите использовать результирующий набор вместе в оставшейся части рабочего процесса, например отправить результаты в почту.  |

## <a name="walkthroughs"></a>Пошаговые руководства
В следующих учебниках показано использование соединителей Azure Monitor в Azure Logic Apps. Такой же пример можно выполнить с помощью Power автоматизиру. Единственное отличие состоит в том, как создать исходный рабочий процесс и запустить его по завершении. Настройка рабочего процесса и действий одинакова между ними. Чтобы приступить к работе, см. статью [Создание последовательности из шаблона в Power автоматизиру](/power-automate/get-started-logic-template) .


### <a name="create-a-logic-app"></a>Создание приложения логики

Перейдите в **Logic Apps** в портал Azure и нажмите кнопку **Добавить**. Выберите **подписку**, **группу ресурсов**и **регион** для хранения нового приложения логики и присвойте ему уникальное имя. Вы можете включить **log Analytics** параметр, чтобы получать сведения о данных и событиях времени выполнения, как описано в разделе [Настройка Azure Monitor журналов и получение диагностических данных для Azure Logic Apps](../../logic-apps/monitor-logic-apps-log-analytics.md). Этот параметр не требуется для использования соединителя журналов Azure Monitor.

![Создание приложения логики](media/logicapp-flow-connector/create-logic-app.png)


Щелкните **проверить + создать** , а затем **создать**. После завершения развертывания щелкните **Перейти к ресурсу** , чтобы открыть **конструктор Logic Apps**.

### <a name="create-a-trigger-for-the-logic-app"></a>Создание триггера для приложения логики
В разделе **Запуск с общим триггером**выберите **повторение**. Будет создано приложение логики, которое автоматически запускается с постоянным интервалом. В поле **Частота** действия выберите **день** и в поле **интервал** введите **1** , чтобы запустить рабочий процесс один раз в день.

![Действие повторения](media/logicapp-flow-connector/recurrence-action.png)

## <a name="walkthrough-mail-visualized-results"></a>Пошаговое руководство. визуальные результаты по почте
В следующем руководстве показано, как создать приложение логики, которое отправляет результаты запроса журнала Azure Monitor по электронной почте. 

### <a name="add-azure-monitor-logs-action"></a>Действие "добавить Azure Monitor журналов"
Щелкните **+ новый шаг** , чтобы добавить действие, выполняемое после действия повторение. В разделе **Выбор действия**введите **Azure Monitor** , а затем выберите **Azure Monitor журналы**.

![Действие Azure Monitor журналов](media/logicapp-flow-connector/select-azure-monitor-connector.png)

Щелкните **Azure Log Analytics – Run query and visualize results** (Azure Log Analytics – выполнить запрос и отобразить результаты).

![Действие "выполнить запрос и визуализировать результаты"](media/logicapp-flow-connector/select-query-action-visualize.png)


### <a name="add-azure-monitor-logs-action"></a>Действие "добавить Azure Monitor журналов"

Выберите **подписку** и **группу ресурсов** для рабочей области log Analytics. Выберите *рабочую область log Analytics* для **типа ресурса** , а затем выберите имя рабочей области в разделе **имя ресурса**.

В окне **Запрос** добавьте следующий запрос журнала.  

```Kusto
Event
| where EventLevelName == "Error" 
| where TimeGenerated > ago(1day)
| summarize TotalErrors=count() by Computer
| sort by Computer asc   
```

Выберите *задать в запросе* для **диапазона времени** и **таблицы HTML** для **типа диаграммы**.
   
![Действие "выполнить запрос и визуализировать результаты"](media/logicapp-flow-connector/run-query-visualize-action.png)

Почта будет отправлена учетной записью, связанной с текущим соединением. Можно указать другую учетную запись, щелкнув **изменить подключение**.

### <a name="add-email-action"></a>Добавить действие электронной почты

Щелкните **+ новый шаг**, а затем — **+ Добавить действие**. В разделе **Выбор действия**введите **Outlook** , а затем выберите **Office 365 Outlook**.

![Выбор соединителя Outlook](media/logicapp-flow-connector/select-outlook-connector.png)

Выберите **Отправить сообщение электронной почты (v2)**.

![Окно выбора Office 365 Outlook](media/logicapp-flow-connector/select-mail-action.png)

Щелкните в любом месте поля **текст** , чтобы открыть окно **динамического содержимого** со значениями из предыдущих действий в приложении логики. Выберите **Просмотреть больше** , а затем **текст** , который является результатом запроса в действии log Analytics.

![Выбор текста](media/logicapp-flow-connector/select-body.png)

В окне **Кому** укажите адрес электронной почты получателя, а в окне **Тема** — тему сообщения. 

![Действие почты](media/logicapp-flow-connector/mail-action.png)


### <a name="save-and-test-your-logic-app"></a>Сохранение и тестирование приложения логики
Нажмите кнопку **сохранить** и **запустите** , чтобы выполнить тестовый запуск приложения логики.

![Сохранение и запуск](media/logicapp-flow-connector/save-run.png)


После завершения приложения логики Проверьте почту указанного получателя.  Вы должны получить сообщение с текстом, подобным этому:

![Пример электронного сообщения](media/logicapp-flow-connector/sample-mail.png)



## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о запросах журнала в Azure Monitor см. в [этой статье](../log-query/log-query-overview.md).
- Дополнительные сведения о [Logic Apps](../../logic-apps/index.yml)
- Дополнительные сведения о [Power автоматизируются](https://flow.microsoft.com).
