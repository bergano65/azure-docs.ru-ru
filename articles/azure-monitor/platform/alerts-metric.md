---
title: Создание, Просмотр оповещений метрик и управление ими с помощью Azure Monitor
description: Узнайте, как использовать портал Azure или CLI для создания, просмотра и управления правилами оповещений метрик.
author: harelbr
ms.author: harelbr
ms.topic: conceptual
ms.date: 08/11/2020
ms.subservice: alerts
ms.openlocfilehash: 8b1015573e4c01f01d82c7c152b66db80bef0aee
ms.sourcegitcommit: f88074c00f13bcb52eaa5416c61adc1259826ce7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/21/2020
ms.locfileid: "92342167"
---
# <a name="create-view-and-manage-metric-alerts-using-azure-monitor"></a>Создание и просмотр оповещений метрик, а также управление ими с помощью Azure Monitor

Оповещения метрик в Azure Monitor позволяют получать уведомления, когда одна из метрик пересекает пороговое значение. Оповещения метрик работают со множеством многомерных метрик платформы, пользовательских метрик, стандартных и пользовательских метрик Application Insights. В этой статье описывается создание, просмотр и управление правилами оповещений метрик с помощью портал Azure и Azure CLI. Правила генерации оповещений метрик можно также создать с помощью шаблонов Azure Resource Manager, которые описаны в [отдельной статье](alerts-metric-create-templates.md).

Подробнее о том, как работают оповещения метрик, см. в [этом обзоре](alerts-metric-overview.md).

## <a name="create-with-azure-portal"></a>Создание с помощью портала Azure

Следующая процедура описывает, как создать правило генерации оповещений метрики на портале Azure:

1. В [портал Azure](https://portal.azure.com)щелкните **монитор**. В колонке "Монитор" объединены все параметры мониторинга и данные в одном представлении.

2. Щелкните **Оповещения** и выберите **+ Новое правило генерации оповещений**.

    > [!TIP]
    > В большинстве колонок ресурсов в меню ресурсов также есть **оповещения** в разделе **Мониторинг**, и вы также можете создать оповещения там.

3. Щелкните **Выбор цели**, в загружаемой контекстной области выберите целевой ресурс, для которого следует создать оповещение. В раскрывающихся списках **Подписка** и **Тип ресурса** найдите ресурс, который вы хотите отслеживать. Вы также можете найти ресурс с помощью панели поиска.

4. Если выбранный ресурс имеет метрики, по которым можно создавать оповещения, эти метрики будут отображаться на вкладке **Available signals** (Доступные сигналы) в правом нижнем углу. Полный список типов ресурсов, поддерживаемых для оповещений метрик, см. в этой [статье](./alerts-metric-near-real-time.md#metrics-and-dimensions-supported).

5. После выбора целевого ресурса щелкните **Добавить условие**.

6. Вы увидите список сигналов, поддерживаемых для ресурса, и сможете выбрать метрику, для которой хотите создать оповещение.

7. Вы увидите диаграмму для метрики за последние шесть часов. С помощью раскрывающегося списка **период диаграммы** выберите, чтобы просмотреть более длительный журнал для метрики.

8. Если у метрики есть измерения, вы увидите таблицу измерений. Выберите одно или несколько значений для каждого измерения.
    - Отображаемые значения измерений основаны на данных метрик за последние три дня.
    - Если искомое значение не отображается, нажмите кнопку "+", чтобы добавить пользовательское значение.
    - Можно также **выбрать \* *_ для любого из измерений. _*Выберите \* *_ будет динамически масштабировать выделенный фрагмент до всех текущих и будущих значений для измерения.

    Правило оповещения метрики оценивает условие для всех комбинаций выбранных значений. [Дополнительные сведения о том, как срабатывают оповещения на основе многомерных метрик](alerts-metric-overview.md).

9. Выберите тип _*порог**, **оператор**и **тип агрегирования**. Это определит логику, которую будет оценивать правило оповещения метрики.
    - При использовании **статического** порогового значения продолжайте определять **пороговое значение**. Диаграмма метрик может помочь определить, что может быть разумным пороговым значением.
    - Если используется **динамическое** пороговое значение, продолжайте определять **чувствительность к пороговому значению**. На диаграмме метрик отображаются вычисленные пороговые значения на основе последних данных. [Дополнительные сведения о типе условия "Динамические пороговые значения" и значениях параметра конфиденциальности](alerts-dynamic-thresholds.md).

10. При необходимости уточните условие, изменив **гранулярность статистической обработки** и **частоту вычисления**. 

11. Нажмите кнопку **Done**(Готово).

12. При необходимости добавьте еще один критерий, если вы хотите отслеживать сложное правило генерации оповещений. Сейчас пользователи могут применять правила оповещения с одиночным условием динамического порогового значения.

13. Заполните **сведения о предупреждении** , такие как имя, **Описание**и **серьезность** **правила оповещения**.

14. Добавьте группу действий в оповещение: выберите имеющуюся или создайте группу действий.

15. Нажмите кнопку **Готово** для сохранения правила генерации оповещений метрики.

> [!NOTE]
> Правила генерации оповещений метрики, созданные на портале, создаются в той же группе ресурсов, что и целевой ресурс.

## <a name="view-and-manage-with-azure-portal"></a>Просмотр и управление с помощью портала Azure

Вы можете просматривать правила генерации оповещений метрики и управлять ими, используя колонку "Управление правилами" в разделе "Оповещения". В приведенной ниже процедуре показано, как просмотреть свои правила генерации оповещений метрики и изменить одно из них.

1. На портале Azure выберите **Монитор**.

2. Щелкните **Оповещения**, а затем **Управление правилами**.

3. В колонке **Управление правилами** вы можете просмотреть все правила генерации оповещений по подпискам. Вы можете дополнительно отфильтровать правила с помощью  **группы ресурсов**, **типа ресурса**и **ресурса**. Если вы хотите видеть только оповещения метрики, выберите метрику в качестве **типа сигнала**.

    > [!TIP]
    > В колонке **Управление правилами** вы можете выбрать несколько правил генерации оповещений и включить или отключить их. Это может быть полезно, когда необходимо выполнить обслуживание определенных целевых ресурсов.

4. Щелкните имя правила генерации оповещений метрики, которое вы хотите изменить.

5. На вкладке "Изменить правило" щелкните **критерии предупреждения**, которые вы хотите отредактировать. Вы можете изменить метрику, условие порогового значения и другие поля по мере необходимости.

    > [!NOTE]
    > Нельзя изменить **целевой ресурс** и **имя правила генерации оповещений** после создания оповещения метрики.

6. Нажмите кнопку **Готово**, чтобы сохранить изменения.


## <a name="with-azure-cli"></a>С помощью Azure CLI

В предыдущих разделах были описаны способы создания, просмотра и управления правилами оповещений метрик с помощью портал Azure. В этом разделе вы узнаете, как сделать то же самое с помощью кроссплатформенного [Azure CLI](/cli/azure/get-started-with-azure-cli?view=azure-cli-latest). Самый быстрый способ начать использовать Azure CLI посредством [Azure Cloud Shell](../../cloud-shell/overview.md?view=azure-cli-latest). В этой статье мы будем использовать Cloud Shell.

1. Перейдите в портал Azure, щелкните **Cloud Shell**.

2. В командной строке вы можете использовать команды с параметром ``--help``, чтобы узнать больше о команде и о том, как ее использовать. Например, следующая команда отображает список команд, доступных для создания, просмотра оповещений метрик и управления ими.

    ```azurecli
    az monitor metrics alert --help
    ```

3. Вы можете создать простое правило генерации оповещений метрики, которое срабатывает, если средняя загрузка ЦП на виртуальной машине превышает 90 %.

    ```azurecli
    az monitor metrics alert create -n {nameofthealert} -g {ResourceGroup} --scopes {VirtualMachineResourceID} --condition "avg Percentage CPU > 90" --description {descriptionofthealert}
    ```

4. Вы можете просмотреть все оповещения метрики в группе ресурсов, используя следующую команду.

    ```azurecli
    az monitor metrics alert list  -g {ResourceGroup}
    ```

5. Вы можете увидеть подробности определенного правила генерации оповещений метрики, используя имя или идентификатор ресурса правила.

    ```azurecli
    az monitor metrics alert show -g {ResourceGroup} -n {AlertRuleName}
    ```

    ```azurecli
    az monitor metrics alert show --ids {RuleResourceId}
    ```

6. Вы можете отключить правило генерации оповещений, используя следующую команду.

    ```azurecli
    az monitor metrics alert update -g {ResourceGroup} -n {AlertRuleName} --enabled false
    ```

7. Вы можете удалить правило генерации оповещений метрики, используя следующую команду.

    ```azurecli
    az monitor metrics alert delete -g {ResourceGroup} -n {AlertRuleName}
    ```

## <a name="with-powershell"></a>С помощью PowerShell

Правила генерации оповещений метрик имеют доступные командлеты PowerShell:

- [Add-AzMetricAlertRuleV2](/powershell/module/az.monitor/add-azmetricalertrulev2): создание нового правила оповещения метрики или обновление существующего.
- [Get-AzMetricAlertRuleV2](/powershell/module/az.monitor/get-azmetricalertrulev2): получение одного или нескольких правил оповещений метрик.
- [Remove-AzMetricAlertRuleV2](/powershell/module/az.monitor/remove-azmetricalertrulev2): Удаление правила оповещения метрики.

## <a name="with-rest-api"></a>С помощью REST API

- [Создать или обновить](/rest/api/monitor/metricalerts/createorupdate): создание нового правила оповещения метрики или обновление существующего.
- [Получить](/rest/api/monitor/metricalerts/get): получение определенного правила оповещения метрики.
- [Список по группе ресурсов](/rest/api/monitor/metricalerts/listbyresourcegroup): получение списка правил генерации оповещений метрик в определенной группе ресурсов.
- [Список по подписке](/rest/api/monitor/metricalerts/listbysubscription): получение списка правил оповещений метрик в определенной подписке.
- [Обновление](/rest/api/monitor/metricalerts/update): обновление правила оповещения метрики.
- [Удалить](/rest/api/monitor/metricalerts/delete): Удаление правила оповещения метрики.

## <a name="next-steps"></a>Дальнейшие шаги

- [Создание оповещений метрик с помощью шаблонов Azure Resource Manager](./alerts-metric-create-templates.md)
- [Принципы работы оповещений метрик](alerts-metric-overview.md)
- [Принципы работы оповещений метрик с условием динамического порогового значения](alerts-dynamic-thresholds.md)
- [Схема полезных данных](./alerts-metric-near-real-time.md#payload-schema)
- [Устранение неполадок в оповещениях метрик](alerts-troubleshoot-metric.md)
