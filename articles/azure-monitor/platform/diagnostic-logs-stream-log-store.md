---
title: Stream журналов диагностики в рабочую область Log Analytics в Azure Monitor
description: Узнайте, как выполнять потоковую передачу журналов диагностики Azure в рабочую область Log Analytics в Azure Monitor.
author: johnkemnetz
services: azure-monitor
ms.service: azure-monitor
ms.topic: conceptual
ms.date: 04/04/2018
ms.author: johnkem
ms.subservice: logs
ms.openlocfilehash: 33d8f2e7c65a786d1ecb389574fe186efb6fb705
ms.sourcegitcommit: 956749f17569a55bcafba95aef9abcbb345eb929
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2019
ms.locfileid: "58630790"
---
# <a name="stream-azure-diagnostic-logs-to-log-analytics-workspace-in-azure-monitor"></a>Stream журналов диагностики в рабочую область Log Analytics в Azure Monitor

**[Журналы диагностики Azure](diagnostic-logs-overview.md)**  может передаваться в близком к реальному времени, в рабочую область Log Analytics в Azure Monitor с помощью портала, командлетов PowerShell или интерфейса командной строки Azure.

## <a name="what-you-can-do-with-diagnostics-logs-in-a-log-analytics-workspace"></a>Что вы можно делать с журналами диагностики в рабочей области Log Analytics

Azure Monitor предоставляет гибкую журнала запросов и анализа средство, которое позволяет получить представление о данных журналов, созданные из ресурсов Azure. Ниже перечислены некоторые возможности:

* **Запрос журнала** -записи, сложные запросы, over, данные журнала, сопоставление журналов из различных источников и создавать диаграммы, можно закрепить на панели мониторинга Azure.
* **Предупреждения** -обнаружить, когда одно или несколько событий соответствуют определенному запросу и получать уведомления на адрес электронной почты или веб-перехватчика вызов, с помощью оповещений Azure Monitor.
* **Расширенная аналитика**. Применение машинного обучения и алгоритмов сопоставления шаблонов для выявления возможных проблем, обнаруженных в журналах.

## <a name="enable-streaming-of-diagnostic-logs-to-log-analytics-workspace"></a>Включение потоковой передачи журналов диагностики в рабочую область Log Analytics

Потоковую передачу журналов диагностики можно включить программно, через портал или с помощью [REST API Azure Monitor](https://docs.microsoft.com/rest/api/monitor/diagnosticsettings). В любом случае создается параметр диагностики, в котором указывается рабочая область Log Analytics, а также категории журналов и метрики, которые требуется отправить в эту рабочую область. Категория **журналов диагностики** — это тип журналов, которые может предоставить ресурс.

Рабочая область Log Analytics не обязательно должна находиться в той же подписке, в которой находится ресурс, выдающий журналы, если у пользователя, настраивающего параметр, имеется соответствующий доступ RBAC к обеим подпискам.

> [!NOTE]
> Отправка многомерных метрик с помощью параметров диагностики сейчас не поддерживается. Метрики с измерениями экспортируются как преобразованные в плоскую структуру одномерные метрики, агрегированные по значениям измерений.
>
> *Пример*. Метрику "Входящие сообщения" в концентраторе событий можно изучить и вывести в виде диаграммы на уровне очереди. Но при экспорте с помощью параметров диагностики метрика будет представлена в виде всех входящих сообщений для всех очередей концентратора событий.
>
>

## <a name="stream-diagnostic-logs-using-the-portal"></a>Потоковая передача журналов диагностики с помощью портала
1. На портале перейдите к Azure Monitor и щелкните **параметров диагностики** в **параметры** меню.


2. При необходимости отфильтруйте список по группе или типу ресурса, а затем щелкните ресурс, для которого необходимо задать параметр диагностики.

3. Если параметров для выбранного ресурса не существует, вам будет предложено создать параметр. Щелкните Turn on diagnostics (Включить диагностику).

   ![Добавление параметра диагностики — имеющиеся параметры отсутствуют](media/diagnostic-logs-stream-log-store/diagnostic-settings-none.png)

   Если в ресурсе имеются параметры, для него отобразится список настроенных параметров. Нажмите Add diagnostic setting (Добавить параметр диагностики).

   ![Добавление параметра диагностики — имеющиеся параметры](media/diagnostic-logs-stream-log-store/diagnostic-settings-multiple.png)

3. Введите имя параметра и установите флажок для **Отправить в Log Analytics**, затем выберите рабочую область Log Analytics.

   ![Добавление параметра диагностики — имеющиеся параметры](media/diagnostic-logs-stream-log-store/diagnostic-settings-configure.png)

4. Выберите команду **Сохранить**.

Через несколько секунд новый параметр появится в списке параметров для данного ресурса, и сразу же после создания данных о событии журналы диагностики будут отправлены в необходимую рабочую область. Обратите внимание на то, что между созданием события и его появлением в Log Analytics может пройти до 15 минут.

### <a name="via-powershell-cmdlets"></a>С помощью командлетов PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

Для включения потоковой передачи с помощью [командлетов Azure PowerShell](../../azure-monitor/platform/powershell-quickstart-samples.md) применяется командлет `Set-AzDiagnosticSetting` с такими параметрами:

```powershell
Set-AzDiagnosticSetting -ResourceId [your resource ID] -WorkspaceID [resource ID of the Log Analytics workspace] -Categories [list of log categories] -Enabled $true
```

Обратите внимание на то, что свойство workspaceID содержит полный идентификатор рабочей области, а не идентификатор и ключ рабочей области, отображаемые в Log Analytics.

### <a name="via-azure-cli"></a>С помощью интерфейса командной строки Azure

Чтобы включить потоковую передачу с помощью [Azure CLI](../../azure-monitor/platform/cli-samples.md), используйте команду [az monitor diagnostic-settings create](/cli/azure/monitor/diagnostic-settings#az-monitor-diagnostic-settings-create).

```azurecli
az monitor diagnostic-settings create --name <diagnostic name> \
    --workspace <log analytics name or object ID> \
    --resource <target resource object ID> \
    --resource-group <log analytics workspace resource group> \
    --logs '[
    {
        "category": <category name>,
        "enabled": true
    }
    ]'
```

Вы можете расширить набор категорий в журнале диагностики, добавив словари в массив JSON, переданный в качестве параметра `--logs`.

Аргумент `--resource-group` является обязательным, только если `--workspace` — не идентификатор объекта.

## <a name="how-do-i-query-the-data-from-a-log-analytics-workspace"></a>Как запрос данных из рабочей области Log Analytics?

В колонке "журналы" на портале Azure Monitor можно запросить журналы диагностики в рамках решения управления журналами в таблице AzureDiagnostics. Существуют также [несколько решений для мониторинга для ресурсов Azure](../../azure-monitor/insights/solutions.md) можно установить, чтобы мгновенно получать представление о данных журналов, отправляемых в Azure Monitor.

### <a name="known-limitation-column-limit-in-azurediagnostics"></a>Известное ограничение: ограничение количества столбцов в AzureDiagnostics
Так как они отправляют много ресурсов, типы данных отправляются в той же таблице (_AzureDiagnostics_), схема этой таблицы — это принудительный набор схем все различные типы данных собираются. Например при создании параметров диагностики для сбора следующих типов данных, передача данных выполняется в той же рабочей области:
- Аудит журналов 1 ресурсов (имеющая схеме, состоящей из столбцов A, B и C)  
- Журналы ошибок 2 ресурсов (имеющая схеме, состоящей из столбцов, D, E и F)  
- Журналы потоков данных из ресурсов 3 (имеющая схеме, состоящей из столбцов G, H и я)  
 
В таблице AzureDiagnostics будет выглядеть следующим образом, с демонстрационными данными:  
 
| ResourceProvider | Категория | A | b | C | D | E | F | G. | H | I |
| -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- |
| Microsoft.Resource1 | AuditLogs | x1 | y1 | z1 |
| Microsoft.Resource2 | ErrorLogs | | | | Вопрос 1 | W1 | e1 |
| Microsoft.Resource3 | DataFlowLogs | | | | | | | J1 | K1 | L1|
| Microsoft.Resource2 | ErrorLogs | | | | вопрос 2 | W2 | e2 |
| Microsoft.Resource3 | DataFlowLogs | | | | | | | J3 | K3 | L3|
| Microsoft.Resource1 | AuditLogs | x5 | y5 | z5 |
| ... |
 
Нет явного ограничения, любой заданной таблицы журнала Azure, не имеющий более чем 500 столбцов. После достижения любой строки, содержащие данные с любой столбец за пределами первые 500, будут удалены во время приема. В таблице AzureDiagnostics является особенно подвержены быть влияет это ограничение. Обычно это происходит либо, так как множества различных источников данных передаются на той же рабочей области, или несколько источников очень подробные данные, отправляемые в той же рабочей области. 
 
#### <a name="azure-data-factory"></a>Фабрика данных Azure  
Фабрика данных Azure, из-за очень подробный набор журналов, — это ресурс, известно, что особенно влиять на это ограничение. например:  
- *Параметры пользователя, определенные для любого действия в конвейере*: будет новый столбец, созданный для каждого параметра пользователя с уникальным именем для любого действия. 
- *Вводимые и выдаваемые действиями*: они различаются деятельности к и формироваться большое число столбцов, из-за своей природе verbose. 
 
Как с широкой предложения решение ниже, рекомендуется выделить ADF журналы в собственной рабочей области, чтобы свести к минимуму вероятность возникновения этих журналов, влияя на другие типы журналов, собираемых в рабочие области. Мы планируем специально подобрали журналы для фабрики данных Azure доступны по середине апреля 2019 г.
 
#### <a name="workarounds"></a>Обходные пути
Короткий срок, пока не будет переопределена ограничение 500 столбцов, рекомендуется разделить на отдельные рабочие области, чтобы снизить вероятность превышения ограничения на типы подробные данные.
 
Более системы диагностики Azure переходят от единой, разреженными схемы в отдельные таблицы для каждого типа данных; в паре с поддержкой динамических типов, это существенно повысит удобство использования, поступающих в журналах Azure через механизм системы диагностики Azure. Вы уже видели это выберите типы ресурсов Azure, например [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/reports-monitoring/howto-analyze-activity-logs-log-analytics) или [Intune](https://docs.microsoft.com/intune/review-logs-using-azure-monitor) журналы. Выполните поиск новости о новых типов ресурсов в Azure, поддерживающих эти проверенные журналы на [обновления Azure](https://azure.microsoft.com/updates/) блога!


## <a name="next-steps"></a>Дальнейшие действия

* [Дополнительные сведения о журналах диагностики Azure](diagnostic-logs-overview.md)

