---
title: Журналы Azure Monitor для поставщиков услуг | Документация Майкрософт
description: Журналы Azure Monitor могут помочь поставщикам управляемых служб (MSP), большим предприятиям, независимым поставщикам программного обеспечения (ISV) и поставщикам услуг размещения управлять и отслеживать серверы в локальной или облачной инфраструктуре клиента.
ms.subservice: logs
ms.topic: conceptual
author: MeirMen
ms.author: meirm
ms.date: 02/03/2020
ms.openlocfilehash: e49f9caaeb1b16daa49fabb217b6fc40fff17f53
ms.sourcegitcommit: 3d79f737ff34708b48dd2ae45100e2516af9ed78
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "87081480"
---
# <a name="azure-monitor-logs-for-service-providers"></a>Журналы Azure Monitor для поставщиков услуг

Log Analytics рабочие области в Azure Monitor могут помочь поставщикам управляемых служб (MSP), большим предприятиям, независимым поставщикам программного обеспечения (ISV) и поставщикам услуг размещения управлять серверами в локальной или облачной инфраструктуре клиента.

Крупные предприятия во многом сходны с поставщиками услуг, особенно те, которые используют единую ИТ-структуру для централизованного управления ИТ-системами в различных подразделениях. Для простоты в этом документе мы будем использовать термин *поставщик услуг*, но все описанные возможности доступны также для предприятий и других клиентов.

Для партнеров и поставщиков услуг, которые являются частью программы [поставщика облачных решений (CSP)](https://partner.microsoft.com/en-US/membership/cloud-solution-provider) , Log Analytics в Azure Monitor является одной из служб Azure, доступных в подписках Azure CSP.

Log Analytics в Azure Monitor также может использовать поставщик услуг, управляющий ресурсами клиентов, с помощью функции делегированного управления ресурсами Azure в [Azure лигхсаусе](../../lighthouse/overview.md).

## <a name="architectures-for-service-providers"></a>Архитектуры для поставщиков служб

Log Analytics рабочие области предоставляют администратору способ управления потоком и изоляцией данных [журнала](data-platform-logs.md) и создания архитектуры, которая решает конкретные бизнес-потребности. В [этой статье](design-logs-deployment.md) объясняются вопросы проектирования, развертывания и миграции для рабочей области, а в статье [Управление доступом](manage-access.md) обсуждаются способы применения и управления разрешениями для записи данных в журнал. Для поставщиков служб действуют дополнительные рекомендации.

Существует три возможных архитектуры для поставщиков служб, связанные с рабочими областями Log Analytics:

### <a name="1-distributed---logs-are-stored-in-workspaces-located-in-the-customers-tenant"></a>1. распределенные — журналы хранятся в рабочих областях, расположенных в клиенте клиента.

В этой архитектуре рабочая область развертывается у арендатора клиента и используется для размещения всех журналов этого клиента.

Существует два способа, которым администраторы поставщика услуг могут получить доступ к рабочей области Log Analytics в клиенте клиента.

- Клиент может добавить отдельных пользователей от поставщика услуг в качестве [Azure Active Directory гостевых пользователей (B2B)](../../active-directory/b2b/what-is-b2b.md). Чтобы получить доступ к этим рабочим областям, Администраторы поставщика услуг должны войти в каталог каждого клиента в портал Azure. Это также требует от клиентов управлять индивидуальным доступом для каждого администратора поставщика услуг.
- Для повышения масштабируемости и гибкости поставщики служб могут использовать [делегированные возможности управления ресурсами Azure](../../lighthouse/concepts/azure-delegated-resource-management.md) [лигхсаусе Azure](../../lighthouse/overview.md) для доступа к клиенту клиента. При использовании этого метода Администраторы поставщиков услуг включаются в группу пользователей Azure AD в клиенте поставщика услуг, и эта группа получает доступ в процессе адаптации для каждого клиента. Эти администраторы могут получить доступ к рабочим областям каждого клиента в рамках собственного клиента поставщика услуг, а не выполнять вход в клиент каждого клиента по отдельности. Таким образом, доступ к ресурсам рабочих областей клиентов Log Analytics сокращает объем работы, необходимый на стороне клиента, и упрощает сбор и анализ данных между несколькими клиентами, управляемыми одним и тем же поставщиком услуг, с помощью таких средств, как [Azure Monitor книги](../..//azure-monitor/platform/workbooks-overview.md). Дополнительные сведения см. [в статье мониторинг ресурсов клиентов в масштабе](../../lighthouse/how-to/monitor-at-scale.md).

Ниже перечислены преимущества распределенной архитектуры.

* Клиент может подтвердить определенные уровни разрешений с помощью [делегированного управления ресурсами Azure](../../lighthouse/concepts/azure-delegated-resource-management.md)или управлять доступом к журналам, используя собственный [доступ на основе ролей](../../role-based-access-control/overview.md).
* Журналы можно собирать из всех типов ресурсов, а не только данных виртуальной машины на основе агентов. Например, журналы аудита Azure.
* У каждого клиента могут быть собственные параметры рабочей области, такие как период хранения и ограничение на использование данных.
* Изоляция между клиентами для соблюдения нормативных требований и требований соответствия.
* Плата за каждую рабочую область будет включена в подписку клиента.

Недостатки распределенной архитектуры:

* Централизованное визуализация и анализ данных в клиентских клиентах с помощью таких средств, как Azure Monitor книги, может привести к более медленной работе, особенно при анализе данных в более чем 50 рабочих областях.
* Если клиенты не подключены для управления делегированными ресурсами Azure, Администраторы поставщика услуг должны быть подготовлены в каталоге клиента, и поставщик услуг больше не сможет управлять большим количеством клиентов одновременно.

### <a name="2-central---logs-are-stored-in-a-workspace-located-in-the-service-provider-tenant"></a>2. централизованные журналы хранятся в рабочей области, расположенной в клиенте поставщика услуг

В этой архитектуре журналы хранятся не у арендаторов клиента, а в едином централизованном расположении в одной из подписок поставщика служб. Для агентов, установленных на виртуальных машинах клиента, настраивается отправка журналов в эту рабочую область с использованием идентификатора рабочей области и секретного ключа.

Преимущества централизованной архитектуры:

* Удобное управление большим числом клиентов и их интеграция в различные серверные системы.
* Поставщик служб является полным владельцем журналов и различных артефактов, таких как функции и сохраненные запросы.
* Поставщик служб может формировать аналитические сведения для всех клиентов.

Недостатки централизованной архитектуры:

* Эта архитектура подходит только для данных виртуальных машин на основе агента. Она не распространяется на источники данных PaaS, SaaS и источники данных структуры Azure.
* С разделением данных, объединенных в одну рабочую область, между клиентами могут возникнуть трудности. Единственный эффективный способ сделать это — использовать полное доменное имя компьютера (FQDN) или идентификатор подписки Azure.
* Данные всех клиентов будут храниться в одном регионе с единым счетом и с одинаковыми параметрами хранения и конфигурации.
* Для структуры Azure и служб PaaS, таких как система диагностики Azure и журналы аудита Azure, требуется, чтобы рабочая область и ресурс находились в одном клиенте, поэтому эти службы не могут отправлять журналы в центральную рабочую область.
* Все агенты виртуальных машин для всех клиентов будут проходить проверку подлинности в центральной рабочей области с помощью одинаковых идентификаторов рабочей области и ключей. Невозможно заблокировать журналы от указанного клиента, не прерывая работу других клиентов.

### <a name="3-hybrid---logs-are-stored-in-workspace-located-in-the-customers-tenant-and-some-of-them-are-pulled-to-a-central-location"></a>3. Гибридные журналы хранятся в рабочей области, расположенной в клиенте клиента, а некоторые из них извлекаются в центральное расположение.

Третий вариант архитектуры представляет собой сочетание первых двух вариантов. Он основан на первой распределенной архитектуре, в которой журналы являются локальными для каждого клиента, но использует определенный механизм для создания центрального репозитория журналов. Часть журналов извлекается в центральное расположение для создания отчетов и аналитики. Эта часть журналов может включать небольшое число типов данных или сводку действия, например ежедневную статистику.

Существует два варианта реализации журналов в центральном расположении:

1. Центральная рабочая область: поставщик служб может создать рабочую область в клиенте и использовать сценарий, который переносит данные из различных рабочих областей в это центральное расположение с помощью [API запроса](https://dev.loganalytics.io/) в составе [API сбора данных](../../azure-monitor/platform/data-collector-api.md). Вместо сценария может использоваться [приложение логики Azure](../../logic-apps/logic-apps-overview.md).

2. Power BI в качестве центрального расположения. Power BI может служить центральным расположением, когда различные рабочие области экспортируют данные в него с помощью интеграции между рабочей областью Log Analytics и [Power BI](../../azure-monitor/platform/powerbi.md).

## <a name="next-steps"></a>Дальнейшие действия

* Автоматизация создания и настройки рабочих областей с помощью [шаблонов Resource Manager](template-workspace-configuration.md).

* Автоматизация создания рабочих областей с помощью [PowerShell](../../azure-monitor/platform/powershell-workspace-configuration.md).

* Использование [оповещений](../../azure-monitor/platform/alerts-overview.md) для интеграции с существующими системами.

* Создание сводных отчетов с помощью [Power BI](../../azure-monitor/platform/powerbi.md)

* Подключение клиентов к [управлению делегированными ресурсами Azure](../../lighthouse/concepts/azure-delegated-resource-management.md).
