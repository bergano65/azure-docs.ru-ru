---
title: Автомасштабирование в Azure с помощью пользовательской метрики
description: Узнайте, как масштабировать ресурс на основе пользовательской метрики в Azure.
ms.topic: conceptual
ms.date: 05/07/2017
ms.subservice: autoscale
ms.openlocfilehash: 7758c440c75af5819099110dcbdaf5a86a1d2a04
ms.sourcegitcommit: b8f2fee3b93436c44f021dff7abe28921da72a6d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/18/2020
ms.locfileid: "77425125"
---
# <a name="get-started-with-auto-scale-by-custom-metric-in-azure"></a>Начало работы с автомасштабированием на основе пользовательской метрики в Azure
В этой статье описывается, как масштабировать ресурс на основе пользовательской метрики на портале Azure.

Azure Monitor Автомасштабирование применяется только к [масштабируемым наборам виртуальных машин](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [облачным службам](https://azure.microsoft.com/services/cloud-services/), [службам приложений, веб-приложениям](https://azure.microsoft.com/services/app-service/web/), [кластеру Azure обозреватель данных](https://azure.microsoft.com/services/data-explorer/) .   
Среда службы интеграции и [службы управления API](https://docs.microsoft.com/azure/api-management/api-management-key-concepts).

## <a name="lets-get-started"></a>Начало работы
В данной статье предполагается, что у вас есть веб-приложение, для которого настроена среда Application Insights. Если вы еще не сделали этого, вы можете [настроить Application Insights для веб-сайта ASP.NET][1] .

- Открыть [портал Azure][2]
- В левой области навигации щелкните значок Azure Monitor.
  ![Запуск Azure Monitor][3]
- Выберите параметр "Автомасштабирование" для просмотра всех ресурсов, к которым применяется автомасштабирование, а также его текущего состояния. ![Обнаружение автомасштабирования в Azure Monitor][4]
- В Azure Monitor откройте колонку "Автомасштабирование" и выберите ресурс, который требуется масштабировать.
  > Примечание. В приведенных ниже действиях используется план службы приложений, связанный с веб-приложением, для которого настроена Application Insights.
- В колонке "Параметр масштабирования" для ресурса обратите внимание, что текущее количество экземпляров равно 1. Щелкните Enable autoscale (Включить автомасштабирование).
  ![Параметр масштабирования для нового веб-приложения][5]
- Укажите имя для параметра масштабирования и щелкните Add a rule (Добавить правило). Параметры правила масштабирования откроются в правой части в виде контекстной области. Если загрузка ЦП ресурса превышает 70 %, по умолчанию для параметра масштабирования количество экземпляров будет задано равным 1. Измените вверху источник метрики на Application Insights, выберите ресурс App Insights в раскрывающемся списке "Ресурс", а затем пользовательскую метрику, на основе которой будет выполняться масштабирование.
  ![Масштабирование на основе пользовательской метрики][6]
- Как и на предыдущем шаге, добавьте правило масштабирования, которое будет уменьшать количество масштабируемых элементов на 1, если значение пользовательской метрики опустится ниже порогового значения.
  ![Масштабирование на основе использования ЦП][7]
- Задайте ограничения для экземпляров. Например, если необходимо выполнить масштабирование в пределах 2–5 экземпляров в зависимости от колебаний пользовательской метрики, следует задать для параметров "Минимум" и "По умолчанию" значение 2, а для параметра "Максимум" — значение 5.
  > Примечание. Если возникнут проблемы при чтении метрик ресурсов и текущая емкость будет меньше емкости по умолчанию, компонент автомасштабирования выполнит масштабирование до значения по умолчанию, чтобы обеспечить доступность ресурса. Если текущая емкость превышает емкость по умолчанию, количество экземпляров не будет уменьшено.
- Щелкните "Сохранить".

Поздравляем! Вы создали параметр масштабирования, который позволит автоматически масштабировать веб-приложение на основе пользовательской метрики.

> Примечание. Эти действия также применимы для начала работы с VMSS или ролью облачной службы.

<!--Reference-->
[1]: https://docs.microsoft.com/azure/application-insights/app-insights-asp-net
[2]: https://portal.azure.com
[3]: ./media/autoscale-custom-metric/azure-monitor-launch.png
[4]: ./media/autoscale-custom-metric/discover-autoscale-azure-monitor.png
[5]: ./media/autoscale-custom-metric/scale-setting-new-web-app.png
[6]: ./media/autoscale-custom-metric/scale-by-custom-metric.png
[7]: ./media/autoscale-custom-metric/autoscale-setting-custom-metrics-ai.png

