---
title: Настраиваемые поля в Azure Monitor | Документация Майкрософт
description: Функция настраиваемых полей Azure Monitor позволяет создавать собственные поля с возможностью поиска из записей в Log Analytics рабочей области, которые добавляют свойства собранной записи.  В этой статье описывается процедура создания настраиваемого поля и представлено пошаговое руководство с примером события.
services: log-analytics
documentationcenter: ''
author: bwren
manager: jwhit
editor: tysonn
ms.assetid: 31572b51-6b57-4945-8208-ecfc3b5304fc
ms.service: log-analytics
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/23/2019
ms.author: bwren
ms.openlocfilehash: f6b9c21a3d65e75abe11e705eba058b1d1fb17ff
ms.sourcegitcommit: dcf3e03ef228fcbdaf0c83ae1ec2ba996a4b1892
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2019
ms.locfileid: "70012734"
---
# <a name="create-custom-fields-in-a-log-analytics-workspace-in-azure-monitor"></a>Создание настраиваемых полей в рабочей области Log Analytics в Azure Monitor

> [!NOTE]
> В этой статье описывается, как анализировать текстовые данные в Log Analytics рабочей области по мере их сбора. Рекомендуется анализировать текстовые данные в фильтре запроса после их сбора, следуя рекомендациям, описанным в разделе [анализ текстовых данных в Azure Monitor](../log-query/parse-text.md). Он предоставляет несколько преимуществ по сравнению с использованием настраиваемых полей.

Функция **настраиваемых полей** Azure Monitor позволяет расширять существующие записи в рабочей области log Analytics, добавляя собственные поля с возможностью поиска.  Настраиваемые поля автоматически заполняются на основе данных, извлеченных из других свойств в той же записи.

![Обзор](media/custom-fields/overview.png)

Так, в примере записи ниже полезные данные содержатся в описании события. Извлечение этих данных в отдельное свойство делает их доступными для таких действий, как сортировка и фильтрация.

![Пример извлечения](media/custom-fields/sample-extract.png)

> [!NOTE]
> В предварительной версии этой функции поддерживаются только 100 настраиваемых полей на рабочую область.  С выходом общедоступной версии это число увеличится.

## <a name="creating-a-custom-field"></a>Создание настраиваемого поля
При создании настраиваемого поля в Log Analytics нужно обозначить данные, которые будут использоваться для его заполнения.  Для быстрого выявления этих данных в службе используется метод под названием FlashExtract, разработанный в Microsoft Research.  Вместо предоставления явных инструкций Azure Monitor узнать о данных, которые необходимо извлечь из предоставленных примеров.

В следующих разделах описаны шаги по созданию настраиваемого поля.  В конце этой статьи приведено пошаговое руководство по извлечению данных.

> [!NOTE]
> Настраиваемое поле заполняется по мере добавления записей, соответствующих указанным критериям, в рабочую область Log Analytics, поэтому она будет отображаться только для записей, собранных после создания настраиваемого поля.  Настраиваемое поле не будет добавлено в записи, которые при его создании уже находились в хранилище данных.
> 

### <a name="step-1--identify-records-that-will-have-the-custom-field"></a>Шаг 1. Определение записей, которые будут содержать настраиваемое поле
Прежде всего нужно определить записи, которые будут содержать настраиваемое поле.  Начните с [стандартного запроса](../log-query/log-query-overview.md) к журналу, а затем выберите запись, которая будет использоваться в качестве модели, из которой Azure Monitor узнается.  После выбора параметра извлечения данных в настраиваемое поле откроется **мастер извлечения полей** , где нужно проверить и уточнить условия.

1. Перейдите в раздел **журналы** и используйте [запрос для получения записей](../log-query/log-query-overview.md) , которые будут иметь настраиваемое поле.
2. Выберите запись, которую Log Analytics будет использовать в качестве модели для извлечения данных, нужных для заполнения поля.  Обозначьте данные, которые нужно извлечь из этой записи. Log Analytics будет использовать эту информацию, чтобы определить логику заполнения настраиваемого поля для всех подобных записей.
3. Разверните свойства записи, нажмите кнопку с многоточием слева от верхнего свойства записи и выберите **извлечь поля из**.
4. Откроется **Мастер извлечения полей** , и выбранная запись отобразится в столбце **основной пример** .  Настраиваемое поле будет определено для записей, значения в свойствах которых соответствуют выбранным.  
5. Если полученный результат вам не подходит, уточните условия, выбрав дополнительные поля.  Чтобы изменить значения полей для условий, отмените выбор записи и выберите другую запись, соответствующую необходимым условиям.

### <a name="step-2---perform-initial-extract"></a>Шаг 2. Выполнение начального извлечения
После определения записей, которые будут иметь настраиваемое поле, необходимо указать данные, которые требуется извлечь.  На основе этих данных Log Analytics определит аналогичные шаблоны в схожих записях.  После этого вы сможете проверить результаты и указать дополнительные сведения, которые Log Analytics будет использовать при анализе.

1. Выделите текст в примере записи, для которой требуется заполнить настраиваемое поле.  Затем откроется диалоговое окно, в котором можно указать имя и тип данных для поля и выполнить начальное извлечение.  К имени поля будет автоматически добавлено **\__CF**.
2. Нажмите кнопку **Извлечь** , чтобы запустить анализ собранных записей.  
3. В разделах **Сводка** и **Результаты поиска** отобразятся результаты извлечения. Таким образом вы сможете проверить правильность извлечения.  В разделе **Сводка** содержатся условия, используемые для поиска записей, и количество всех определенных значений данных.  В разделе **Результаты поиска** приведен подробный список записей, соответствующих условиям.

### <a name="step-3--verify-accuracy-of-the-extract-and-create-custom-field"></a>Шаг 3. Проверка правильности извлечения и создание настраиваемого поля
После выполнения начального извлечения в Log Analytics отобразятся результаты на основе предварительно собранных данных.  Если эти результаты правильные, можно сразу перейти к созданию настраиваемого поля.  В противном случае нужно уточнить результаты, чтобы улучшить логику Log Analytics.

1. Если какие-либо значения, определенные в ходе начального извлечения, неверны, щелкните значок **Изменить** рядом с неправильной записью и выберите команду **Изменить этот выделенный элемент**.
2. Эта запись скопируется в раздел **Дополнительные примеры** под столбцом **Основной пример**.  Здесь можно выделить необходимую часть данных, чтобы указать Log Analytics на правильный выбор.
3. Нажмите кнопку **Извлечь** , чтобы использовать эту информацию для оценки всех существующих записей.  Для других записей могут быть изменены результаты на основе этих новых сведений.
4. Вносите исправления до тех пор, пока во всех записях в извлечении не будут правильно определены данные для заполнения нового настраиваемого поля.
5. Добившись удовлетворительных результатов, нажмите кнопку **Save Extract** (Сохранить извлечение).  Теперь настраиваемое поле определено, но оно еще не добавлено к записям.
6. Подождите, пока не будут собраны новые записи, соответствующие указанным условиям, и выполните поиск по журналу снова. После этого новые записи будут содержать настраиваемое поле.
7. Используйте настраиваемое поле, как и другие свойства записи.  Его можно применять для объединения и группирования данных, а также для создания новых сведений для анализа.

## <a name="viewing-custom-fields"></a>Просмотр настраиваемых полей
Список всех настраиваемых полей в группе управления можно просмотреть из меню **Дополнительные параметры** рабочей области Log Analytics на портале Azure.  Выберите вкладку **Данные**, а затем — раздел **Настраиваемые поля**, чтобы просмотреть список всех настраиваемых полей в рабочей области.  

![Настраиваемые поля](media/custom-fields/list.png)

## <a name="removing-a-custom-field"></a>Удаление настраиваемого поля
Настраиваемое поле можно удалить двумя способами.  Первый способ — использовать параметр **Удалить** для каждого поля при просмотре полного списка (процедура его открытия описана выше).  Второй способ — извлечь запись , нажать кнопку слева от поля  и в открывшемся меню выбрать пункт удаления настраиваемого поля.

## <a name="sample-walkthrough"></a>Пошаговое руководство
В этом разделе описывается полная процедура создания настраиваемого поля.  В этом примере извлекается имя службы в событиях Windows, которые указывают на изменение состояния службы.  Это зависит от событий, созданных диспетчером управления службами во время запуска системы на компьютерах Windows.  Если вы хотите выполнить этот пример, необходимо, чтобы на компьютере был включен [сбор информационных событий в системном журнале](data-sources-windows-events.md).

Мы введем запрос, как на снимке экрана ниже, для возврата всех событий, созданных диспетчером служб, с идентификатором 7036, т. е. событий запуска или остановки службы.

![Запрос](media/custom-fields/query.png)

Затем мы выбираем и развернув любую запись с ИДЕНТИФИКАТОРом события 7036.

![Исходная запись](media/custom-fields/source-record.png)

Для определения настраиваемых полей нажмите кнопку с многоточием рядом со свойством Top.

![Извлечение полей](media/custom-fields/extract-fields.png)

После этого откроется **мастер извлечения полей**, и в столбце **Основной пример** будут выбраны поля **EventLog** и **EventID**.  Это означает, что настраиваемое поле будет определено для событий системного журнала с идентификатором 7036.  Этих полей достаточно. Нам больше не нужно ничего выбирать.

![Main Example](media/custom-fields/main-example.png)

Мы выделим имя службы в свойстве **RenderedDescription** и назначим службе имя **Service**.  Настраиваемое поле будет называться **Service_CF**. В данном случае типом поля является строка, поэтому мы можем оставить это без изменений.

![Заголовок поля](media/custom-fields/field-title.png)

После извлечения мы увидим, что имя службы определено правильно только для некоторых записей.   В разделе **Результаты поиска** видно, что **адаптер производительности WMI** выделен не полностью.  **Сводка** показывает, что одна запись определила **Установщик модулей** вместо **установщика модулей Windows**.  

![Результаты поиска](media/custom-fields/search-results-01.png)

Начнем с записи об **адаптере производительности WMI** .  Щелкнем рядом с ней значок изменения, а затем — **Modify this highlight**(Изменить это выделение).  

![Изменение выделения](media/custom-fields/modify-highlight.png)

Выделим полное название адаптера, включая **WMI** , и выполним извлечение повторно.  

![Дополнительный пример](media/custom-fields/additional-example-01.png)

Как видно, записи с **адаптером производительности WMI** исправлены. Кроме того, служба Log Analytics использовала эту информацию для определения записей с **установщиком модулей Windows**.

![Результаты поиска](media/custom-fields/search-results-02.png)

Теперь можно выполнить запрос, который проверяет, создан ли **Service_CF** , но еще не добавлен в какие-либо записи. Это связано с тем, что настраиваемое поле не работает с существующими записями, поэтому необходимо дождаться сбора новых записей.

![Начальное количество](media/custom-fields/initial-count.png)

По истечении некоторого времени будут собраны новые события, и поле **Service_CF** начнет добавляться к записям, соответствующим нашим условиям.

![Окончательные результаты](media/custom-fields/final-results.png)

Теперь мы можем использовать настраиваемое поле, как и другие свойства записи.  Для иллюстрации этого мы создадим запрос, который группирует записи по новому полю **Service_CF**. Таким образом мы сможем проверить, какие службы наиболее активные.

![Группировка по запросу](media/custom-fields/query-group.png)

## <a name="next-steps"></a>Следующие шаги
* Сведения о [запросах журнала](../log-query/log-query-overview.md) для построения запросов с помощью настраиваемых полей для критериев.
* Отслеживайте [пользовательские файлы журналов](data-sources-custom-logs.md), которые можно анализировать с помощью настраиваемых полей.

