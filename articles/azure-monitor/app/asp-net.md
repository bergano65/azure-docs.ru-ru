---
title: Настройка аналитики веб-приложения для ASP.NET с помощью Azure Application Insights | Документация Майкрософт
description: Настройка средств аналитики производительности, доступности и поведения пользователей для веб-сайта ASP.NET, размещенного локально или в Azure.
services: application-insights
documentationcenter: .net
author: mrbullwinkle
manager: carmonm
ms.assetid: d0eee3c0-b328-448f-8123-f478052751db
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.topic: conceptual
ms.date: 03/14/2019
ms.author: mbullwin
ms.openlocfilehash: 358ca13548f0215fabee949c5fa3dee64beb2d6d
ms.sourcegitcommit: 2d0fb4f3fc8086d61e2d8e506d5c2b930ba525a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/18/2019
ms.locfileid: "57996963"
---
# <a name="set-up-application-insights-for-your-aspnet-website"></a>Настройка Application Insights для веб-сайта ASP.NET

Эта процедура настраивает веб-приложение ASP.NET для отправки данных телеметрии в службу [Azure Application Insights](../../azure-monitor/app/app-insights-overview.md). Она работает для приложений ASP.NET, размещенных на сервере IIS локально или в облаке. Она предоставляет диаграммы и эффективный язык запросов, который поможет определить производительность приложений и способ использования приложений пользователями, а также автоматические оповещения о сбоях или проблемах с производительностью. Многим разработчикам нравятся эти функции в изначальном виде, но при необходимости их можно расширить и настроить данные телеметрии.

Настройка выполняется несколькими щелчками в Visual Studio. Вы можете избежать расходов, ограничив объем телеметрии. Эта функция позволяет экспериментировать и выполнять отладку или наблюдать за сайтом с небольшим числом пользователей. Если вы хотите отслеживать рабочий сайт, вы можете легко увеличить лимит позже.

## <a name="prerequisites"></a>Технические условия
Чтобы добавить Application Insights для веб-сайта ASP.NET, сделайте следующее:

- Установите [Visual Studio 2017 для Windows](https://www.visualstudio.com/downloads/) со следующими рабочими нагрузками:
    - ASP.NET и веб-разработка.
    - разработка Azure;

Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.

## <a name="ide"></a> Шаг 1. Добавление пакета SDK для Application Insights

> [!IMPORTANT]
> Снимки экрана в этом примере основаны на Visual Studio 2017 версии 15.9.9. Процесс добавления Application Insights зависит от всех версий Visual Studio 2017, а также по типу шаблона ASP.NET. Более старые версии могут иметь альтернативный текст, например «Настроить Application Insights».

Щелкните правой кнопкой мыши имя вашего веб-приложения в обозревателе решений и выберите **добавить** > **Телеметрия Application Insights**

![Снимок экрана с окном обозревателя решений, где выделен параметр "Настроить Application Insights"](./media/asp-net/add-telemetry-new.png)

(Вам может быть предложено обновление до последней версии SDK. Это зависит от версии пакета SDK Application Insights. Когда появится запрос, выберите **Обновить пакет SDK**.)

![Снимок экрана с сообщением о доступности новой версии пакета SDK для Microsoft Application Insights. Выделен параметр "Обновить SDK"](./media/asp-net/0002-update-sdk.png)

Экран "Конфигурация Application Insights":

Выберите **Начать**.

![Снимок экрана с окном страницы "Зарегистрировать приложение в Application Insights"](./media/asp-net/00004-start-free.png)

Если вы хотите задать группу ресурсов или расположение, где будут храниться данные, щелкните **Настроить параметры**. Группы ресурсов используются для управления доступом к данным. Например, если имеется несколько приложений, которые являются частью одной системы, вы можете поместить их данные Application Insights в одну группу ресурсов.

 Выберите **Зарегистрировать**.

![Снимок экрана с окном страницы "Зарегистрировать приложение в Application Insights"](./media/asp-net/00005-register-ed.png)

 Данные телеметрии будут отправляться на [портал Azure](https://portal.azure.com) как во время отладки, так и после публикации приложения.
> [!NOTE]
> Если вы не хотите отправлять данные телеметрии на портал во время отладки, просто добавьте пакет SDK Application Insights в приложение, но не настраивайте ресурс на портале. Во время отладки можно просмотреть данные телеметрии в Visual Studio. Позже вы сможете вернуться на эту страницу настроек или можете дождаться, когда приложение будет развернуто, и [переключиться на данные телеметрии во время выполнения](../../azure-monitor/app/monitor-performance-live-website-now.md).

## <a name="run"></a> Шаг 2. Запуск приложения для Android
Запустите приложение, нажав клавишу F5. Откройте разные страницы, чтобы создать некоторый объем данных телеметрии.

В Visual Studio вы увидите число записанных в журнал событий.

![Снимок экрана, где отображается Visual Studio Кнопка Application Insights доступна во время отладки.](./media/asp-net/00006-Events.png)

## <a name="step-3-see-your-telemetry"></a>Шаг 3. Просмотр данных телеметрии
Вы можете просмотреть данные телеметрии в Visual Studio или на веб-портале Application Insights. Выполните поиск данных телеметрии в Visual Studio для отладки приложения. Отслеживайте производительность и использование на веб-портале в режиме реального времени. 

### <a name="see-your-telemetry-in-visual-studio"></a>Просмотр данных телеметрии в Visual Studio

Чтобы просмотреть данные Application Insights в Visual Studio, сделайте следующее.  Выберите **Обозреватель решений** > **Подключенные службы**, щелкните правой кнопкой мыши **Application Insights**, а затем выберите **Поиск действующей телеметрии**.

В окне поиска Application Insights в Visual Studio вы увидите данные телеметрии приложения, созданные в серверной части приложения. Поэкспериментируйте с фильтрами и щелкните любое событие, чтобы просмотреть подробные сведения.

![Снимок экрана, где показано представление данных, полученных в ходе сеанса отладки, в окне Application Insights.](./media/asp-net/55.png)

> [!Tip]
> Если данные не отображаются, проверьте диапазон времени и щелкните значок поиска.

[Дополнительные сведения о средствах Application Insights в Visual Studio](../../azure-monitor/app/visual-studio.md).

<a name="monitor"></a>
### <a name="see-telemetry-in-web-portal"></a>Просмотр данных телеметрии на веб-портале

Вы можете также просматривать данные телеметрии на веб-портале Application Insights, если только не решили установить только пакет SDK. На портале представлено больше дополнительных диаграмм, средств анализа и представлений различных компонентов, чем в Visual Studio. На портале также доступны оповещения.

Откройте ресурс Application Insights. Войдите на [портал Azure](https://portal.azure.com/) и найдите его или выберите **Обозреватель решений** > **Подключенные службы**, щелкните правой кнопкой мыши **Application Insights** > **Открыть портал Application Insights**.

На портале откроется представление данных телеметрии из приложения.

![Снимок экрана, где отображается страница с обзором Application Insights](./media/asp-net/007.png)

На портале щелкните любую плитку, чтобы просмотреть подробные сведения.

[Дополнительные сведения об использовании Application Insights на портале Azure](../../azure-monitor/app/app-insights-dashboards.md).

## <a name="step-4-publish-your-app"></a>Шаг 4. Публикация приложения
Опубликуйте приложение на сервере IIS или в Azure. Просмотрите [динамический поток метрик](../../azure-monitor/app/metrics-explorer.md#live-metrics-stream), чтобы убедиться в бесперебойной работе приложения.

Телеметрия создается на портале Application Insights, где можно отслеживать метрики, выполнять поиск данных телеметрии и настраивать [панели мониторинга](../../azure-monitor/app/app-insights-dashboards.md). Можно также использовать эффективный [язык запросов Kusto](/azure/kusto/query/) для анализа использования и производительности или поиска определенных событий.

Кроме того, можно продолжить анализировать телеметрию в [Visual Studio](../../azure-monitor/app/visual-studio.md) с помощью таких средств, как поиск по журналу диагностики и [тренды](../../azure-monitor/app/visual-studio-trends.md).

> [!NOTE]
> Если приложение отправляет достаточно данных телеметрии для достижения [пределов регулирования](../../azure-monitor/app/pricing.md#limits-summary), включается автоматическая [выборка](../../azure-monitor/app/sampling.md). Выборка позволяет уменьшить количество данных телеметрии, отправляемых из приложения, сохраняя связанные данные в целях диагностики.
>
>

## <a name="land"></a>Все готово

Поздравляем! Вы установили в приложение пакет Application Insights и настроили его для отправки данных телеметрии в службу Application Insights в Azure.

Ресурс Azure, который получает данные телеметрии приложения, определяется *ключом инструментирования*. Вы найдете этот ключ в файле ApplicationInsights.config.


## <a name="upgrade-to-future-sdk-versions"></a>Обновление до будущих версий пакета SDK
Чтобы установить [новый выпуск пакета SDK](https://github.com/Microsoft/ApplicationInsights-dotnet-server/releases), откройте **диспетчер пакетов NuGet** и выполните фильтрацию по установленным пакетам. Выберите элемент **Microsoft.ApplicationInsights.Web**, а затем — элемент **Обновить**.

Если были выполнены какие-либо настройки файла ApplicationInsights.config, то прежде чем выполнять обновление, сохраните его копию. Затем объедините изменения в новой версии.

## <a name="next-steps"></a>Дальнейшие действия

Существуют и другие статьи, к которым можно обратиться, если вас интересуют такие темы, как:

* [инструментирование веб-приложения во время выполнения;](../../azure-monitor/app/monitor-performance-live-website-now.md)
* [Облачные службы Azure](../../azure-monitor/app/cloudservices.md)

### <a name="more-telemetry"></a>Дополнительные данные телеметрии

* **[Данные загрузки браузера и страниц](../../azure-monitor/app/javascript.md)**  — вставьте фрагмент кода в веб-страницы.
* **[Более подробные зависимости и данные отслеживание исключений](../../azure-monitor/app/monitor-performance-live-website-now.md)**  — установите монитор состояния на сервере.
* **[Добавьте в приложение код для пользовательских событий](../../azure-monitor/app/api-custom-events-metrics.md)**, чтобы считать, фиксировать время и измерять действия пользователя.
* **[Получение данных журнала](../../azure-monitor/app/asp-net-trace-logs.md)**  — согласовывайте данные журналов с данными телеметрии.

### <a name="analysis"></a>Анализ

* **[Работа с Application Insights в Visual Studio](../../azure-monitor/app/visual-studio.md)**<br/>Содержит сведения об отладке с помощью телеметрии, о поиске по журналу диагностики и детализации кода.
* **[Работа с порталом Application Insights](../../azure-monitor/app/app-insights-dashboards.md)**<br/> Содержит сведения о панелях мониторинга, эффективных средствах диагностики и анализа, оповещениях, картах динамических зависимостей приложения, а также сведения об экспорте данных телеметрии.
* **[Аналитика](../../azure-monitor/log-query/get-started-portal.md)**  — эффективный язык запросов.

### <a name="alerts"></a>Оповещения

* [Тесты доступности](../../azure-monitor/app/monitor-web-app-availability.md). Создавайте тесты, позволяющие проверить, доступен ли ваш сайт в Интернете.
* [Интеллектуальная диагностика](../../azure-monitor/app/proactive-diagnostics.md). Эти тесты выполняются автоматически, поэтому вам не нужно их настраивать. Благодаря ей вы узнаете о необычном количестве неудачных запросов.
* [Оповещения о метриках](../../azure-monitor/app/alerts.md). Настроить оповещения, чтобы получать уведомления, если метрика превысила пороговое значение. Их можно настроить для пользовательских метрик, добавляемых в код приложения.

### <a name="automation"></a>Служба автоматизации

* [Создание ресурсов Application Insights с помощью PowerShell](../../azure-monitor/app/powershell.md)
