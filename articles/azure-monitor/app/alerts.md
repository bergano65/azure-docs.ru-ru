---
title: Задание оповещений в Azure Application Insights | Документация Майкрософт
description: Получайте уведомления о малом времени отклика, исключениях или других изменениях производительности или использования в веб-приложении.
services: application-insights
documentationcenter: ''
author: mrbullwinkle
manager: carmonm
ms.reviewer: lagayhar
ms.assetid: f8ebde72-f819-4ba5-afa2-31dbd49509a5
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.topic: conceptual
ms.date: 01/23/2019
ms.author: mbullwin
ms.openlocfilehash: 8026576478b16b753ba960155c383ffec62c61ce
ms.sourcegitcommit: 6e32f493eb32f93f71d425497752e84763070fad
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/10/2019
ms.locfileid: "59469802"
---
# <a name="set-alerts-in-application-insights"></a>Настройка оповещений в Application Insights
[Azure Application Insights][start] может предупреждать об изменениях в метриках производительности или использования в веб-приложении. 

Application Insights выполняет мониторинг живого приложения на [разнообразных платформах][platforms], чтобы помочь вам диагностировать проблемы с производительностью и понять закономерности использования приложения.

Существует несколько типов оповещений:

* [**Оповещения о метриках** ](../../azure-monitor/platform/alerts-metric-overview.md) сообщит о том, когда метрика достигает порогового значения за некоторый период — такие как время отклика, количество исключений, использование ЦП или количества просмотров страницы.
* [**Оповещения журналов** ](../../azure-monitor/platform/alerts-unified-log.md) используется для описания оповещений, где сигнал оповещения основан на пользовательский запрос Kusto.
* [**веб-тесты**][availability], сообщающие о том, что сайт недоступен в Интернете или медленно реагирует на запросы. [Подробнее][availability]
* [**Упреждающая диагностика**](../../azure-monitor/app/proactive-diagnostics.md) автоматически настроена для отправки уведомлений о необычных показателях производительности.

## <a name="set-a-metric-alert"></a>Задание оповещения о метриках
Откройте вкладку "правила генерации оповещений" и затем использовать кнопку «Добавить».

![На вкладке "правила генерации оповещений" выберите добавить оповещение. Установите приложение в качестве ресурса для измерения, введите имя оповещения и выберите метрику.](./media/alerts/01-set-metric.png)

* Выбирайте ресурс прежде других свойств. **Выберите ресурс («компоненты»)** , если нужно задать предупреждения для метрик производительности или использования.
* Имя, присваиваемое предупреждению, должно быть уникальным в пределах группы ресурсов (не только приложения).
* Аккуратно указывайте единицы измерения для пороговых значений.
* Если установить флажок Email owners (Отправлять по электронной почте владельцам), оповещения будут отправляться по электронной почте всем, кто имеет доступ к этой группе ресурсов. Чтобы предоставить такой доступ другим пользователям, добавьте их в [группу ресурсов или подписку](../../azure-monitor/app/resources-roles-access-control.md) (но не ресурс).
* Если в поле Additional emails (Дополнительные электронные адреса) указать электронные адреса, оповещения будут отправляться на эти адреса отдельных пользователей или групп (независимо от того, установлен ли флажок Email owners [Отправлять по электронной почте владельцам]). 
* Задайте [адрес объекта webhook](../../azure-monitor/platform/alerts-webhooks.md), если вы настроили веб-приложение, которое будет реагировать на оповещения. Оно будет вызываться, когда оповещение будет активировано и разрешено. (Обратите внимание, что в настоящее время параметры запроса не передаются как свойства объекта webhook.)
* Вы можете отключить или включить оповещение: см. кнопки вверху.

*Я не вижу "добавить оповещение".*

* Вы используете учетную запись организации? Вы можете настроить оповещения, если у вас есть доступ к этому ресурсу приложения на правах владельца или участника. Взгляните на вкладке управления доступом. [Дополнительная информация о контроле доступа][roles].

> [!NOTE]
> В колонке "Оповещения" вы увидите, что оповещение уже настроено: [Упреждающая диагностика](../../azure-monitor/app/proactive-failure-diagnostics.md). Это автоматическое оповещение, которое отслеживает одну определенную метрику — процент сбоев запросов. Если вы не хотите отключать упреждающее оповещение, не нужно задавать собственное оповещение о проценте сбоев запросов.
> 
> 

## <a name="see-your-alerts"></a>Отображение оповещений
Вы получите сообщение электронной почты при изменении состояния предупреждения с неактивного на активное. 

Текущее состояние каждого предупреждения отображается на вкладке "правила генерации оповещений".

Ниже показана сводка недавних действий в раскрывающемся списке оповещений.

![Раскрывающийся список оповещений](./media/alerts/010-alert-drop.png)

Журнал изменений состояния находится в журнале действий.

![На вкладке "Обзор" нажмите кнопку Параметры, журналы аудита](./media/alerts/09-alerts.png)

## <a name="how-alerts-work"></a>Принципы работы оповещений
* У оповещения бывает три состояния: Never activated (Еще не активировалось), "Активировано" и "Разрешено". Активация означает, что при последней оценке указанное условие имело значение true.
* Когда оповещение изменяет состояние, создается уведомление. (Если при создании оповещения его условие уже имело значение true, возможно, вы не получите уведомление, пока условие не примет значение false.)
* Каждое уведомление создает электронное сообщение, если вы установили флажок отправки электронных сообщений или указали электронные адреса. Можно также просмотреть раскрывающийся список уведомлений.
* Каждый раз при получении метрики выполняется оценка оповещения (но не в других случаях).
* При такой оценке выполняется вычисление метрики за предыдущий период и ее сравнение с пороговым значением для определения нового состояния оповещения.
* Выбранный вами период определяет интервал, для которого выполняется вычисление метрики. Он не влияет на периодичность оценки оповещения. Она зависит от частоты получения метрик.
* Если в течение некоторого времени для определенной метрики не поступает никаких данных, то такая ситуация оказывает различное влияние на оценку оповещения и на диаграммы в обозревателе метрик. Если данные не поступают в обозреватель метрик в течение периода, превышающего интервал выборки диаграммы, то на диаграмме будет отображено значение 0. При этом не будет выполняться повторная оценка оповещения, основанного на прежней метрике, и его состояние останется неизменным. 
  
    Когда, наконец, данные поступят, значение диаграммы снова станет ненулевым. Будет выполнена оценка оповещения на основе данных, доступных за указанный вами период. Если новая точка данных — это единственная доступная в периоде, то для вычисления будет использована только она.
* Даже если задать длительный период, оповещение может часто менять свое состояние с "предупреждение" на "работоспособен" и наоборот. Это может происходить, если значение метрики находится вблизи порогового значения. Для порогового значения не предусмотрен гистерезис: переход из состояния "предупреждение" в состояние "работоспособен" и наоборот происходит при одном и том же значении.

## <a name="what-are-good-alerts-to-set"></a>Какие оповещения следует настраивать
Это зависит от приложения. Прежде всего, лучше не задавать слишком много метрик. Просмотрите диаграммы метрик во время выполнения приложения, чтобы понять, как работает приложение в нормальном режиме. Это поможет найти способы повышения его производительности. Затем настройте оповещения, которые будут предупреждать вас, если метрики превысят пределы обычного режима работы. 

Чаще всего используются следующие оповещения.

* [Метрики браузера][client] (особенно показатель **времени загрузки страницы** браузера) удобно использовать для веб-приложений. Если на странице имеется много сценариев, следует искать **исключения браузера**. Чтобы получить эти метрики и оповещения, необходимо настроить [мониторинг веб-страниц][client].
* **Время ответа сервера** для серверной части веб-приложений. Кроме настройки оповещений следите за этой метрикой, чтобы определить, насколько пропорционально она меняется по мере увеличения частоты запросов, так как изменение может указывать на то, что в приложении заканчиваются ресурсы. 
* **Исключения сервера.** Чтобы отобразить их, необходимо выполнить [дополнительную настройку](../../azure-monitor/app/asp-net-exceptions.md).

Не забывайте, что [упреждающая диагностика частоты сбоев](../../azure-monitor/app/proactive-failure-diagnostics.md) автоматически отслеживает скорость, с которой приложение отвечает на запросы с кодом ошибки.

## <a name="how-to-set-an-exception-alert-using-custom-log-search"></a>Как задать оповещение исключения, используя пользовательский поиск по журналам

В этом разделе будут рассмотрены как задать предупреждения об исключении на основе запроса. Например предположим, что мы хотим оповещение, когда скорость неудачных превышает 10% за последние 24 часа.

1. Перейдите к ресурсу Application Insight на портале Azure.
2. Слева в разделе настроить, щелкните на **предупреждения**.

    ![Слева в разделе настройки выберите оповещения](./media/alerts/1appinsightalert.png)

3. В верхней части вкладки оповещений выберите **новое правило генерации оповещений**.

     ![В верхней части вкладки оповещений щелкните новое правило генерации оповещений](./media/alerts/2createalert.png)

4. Ресурс должен выбираться автоматически. Чтобы задать условие, щелкните **добавить условие**.

    ![Нажмите кнопку Добавить условие](./media/alerts/3addcondition.png)

5. На вкладке «Настройка логики сигнала» выберите **пользовательский поиск по журналам**

    ![Щелкните пользовательский поиск по журналам](./media/alerts/4customlogsearch.png)

6. На вкладке поиска пользовательского журнала введите запрос в поле «Запрос поиска». В этом примере мы используем ниже запрос Kusto.
    ```kusto
    let percentthreshold = 10;
    let period = 24h;
    requests
    | where timestamp >ago(period)
    | summarize requestsCount = sum(itemCount)
    | project requestsCount, exceptionsCount = toscalar(exceptions | where timestamp >ago(period) | summarize sum(itemCount))
    | extend exceptionsRate = toreal(exceptionsCount)/toreal(requestsCount) * 100
    | where exceptionsRate > percentthreshold

    ```

    ![В поле поиска введите запрос](./media/alerts/5searchquery.png)
    
    > [!NOTE]
    > Эти действия также можно применить к другим типам оповещения на основе запроса. Дополнительные сведения о языке запросов Kusto из этого [Kusto Приступая к работе doc](https://docs.microsoft.com/azure/kusto/concepts/) или это [памятки по SQL для Kusto](https://docs.microsoft.com/azure/kusto/query/sqlcheatsheet)

7. В разделе «Логику оповещений» выберите ли он основан на количество результатов или измерение метрик. Затем выберите условие (больше, чем, равно, меньше чем) и пороговое значение. При изменении этих значений, вы можете заметить изменения предложения условия предварительной версии. В этом примере мы используем «равно».

    ![В разделе логику оповещений выберите условия и параметры, предоставляемые на основе, а затем введите пороговое значение](./media/alerts/6alertlogic.png)

8. В разделе «На основе оцененных» задайте период и частота. Период здесь должно соответствовать значению, мы поместили для периода, в приведенном выше запросе. Нажмите кнопку **сделать**.

    ![Задайте период и частота внизу и нажмите кнопку Готово](./media/alerts/7evaluate.png)

9. Мы видим, условие, которое мы создали с помощью расчетная Месячная стоимость. Ниже в разделе [«Группы действий»](../platform/action-groups.md) можно создать новую группу или выберите существующую. Если требуется, можно настроить действия.

    ![Щелкните на вкладке выберите или создайте кнопки в группе действий](./media/alerts/8actiongroup.png)

10. Наконец, добавьте в сведениях о предупреждении (оповещений имя правила, описание, уровень серьезности). Когда все будет готово, нажмите кнопку **создать правило генерации оповещений** внизу.

    ![В разделе сведения о предупреждении введите имя правила генерации оповещений, ввести описание и выберите уровень серьезности](./media/alerts/9alertdetails.png)

## <a name="how-to-unsubscribe-from-classic-alert-e-mail-notifications"></a>Как отменить подписку на уведомления классического оповещения по электронной почте

Этот раздел относится к **доступности классического оповещения**, **оповещения о метриках Application Insights**, а в **классической предупреждениях аномалии**.

Если любое из следующих применяется вы получаете уведомления по электронной почте для этих классические оповещения:

* Ваш адрес электронной почты указан в поле уведомления по электронной почте получателям в параметрах правил генерации оповещений.

* Активируется параметр для отправки уведомлений по электронной почте пользователям с определенными ролями для подписки, и содержать соответствующие роли для конкретной подписки Azure.

![Снимок экрана уведомления о предупреждении](./media/alerts/alert-notification.png)

Для улучшения управления, безопасности и конфиденциальности, обычно рекомендуется явно указать получателей уведомлений для оповещений в классическом **получателей уведомлений по электронной почте** поля. Параметр для уведомления всем пользователям с определенными ролями предоставляется для обеспечения обратной совместимости.

Чтобы отменить подписку на уведомления по электронной почте, созданные определенным правилом генерации оповещений, удалить ваш адрес электронной почты из **получателей уведомлений по электронной почте** поля.

Если ваш адрес электронной почты не указан явно, рекомендуется отключить параметр, чтобы автоматически уведомлять все члены некоторых ролей и вместо этого список всех пользователя электронных сообщений, которые должны получать уведомления для этого правила генерации оповещений в уведомление по электронной почте поле получателей.

## <a name="who-receives-the-classic-alert-notifications"></a>Кто получает (классические) оповещения?

Этот раздел относится только к классическим оповещениям, он поможет вам оптимизировать уведомления так, чтобы они приходили только желаемым получателям. Чтобы узнать больше о различиях между [классических оповещений](../platform/alerts-classic.overview.md) и новые предупреждения возникают, обратитесь к [статье с обзором оповещений](../platform/alerts-overview.md). Для управления уведомлениями в новом интерфейсе оповещений используйте [группы действий](../platform/action-groups.md).

* Мы рекомендуем использовать определенных получателей для классических оповещений.

* Если флажок **bulk/group** (массовый/групповой) включен, оповещения на основе соответствующих метрик Application Insights будут отправляться пользователям с ролями владельца, участника или читателя в подписке. Фактически, _все_ пользователи, имеющие доступ к подписке Application Insights, находятся в области действия и будут получать уведомления.

> [!NOTE]
> При отключении используемого флажка **bulk/group** (массовый/груповой) вы не сможете отменить изменение.

Используйте новые возможности оповещений и оповещения почти в реальном времени, если вам нужно уведомлять пользователей в зависимости от их ролей. С помощью [групп действий](../platform/action-groups.md) вы можете настроить уведомления по электронной почте для пользователей с любой из ролей — участника, владельца или читателя (не объединяемых вместе как один параметр).

## <a name="automation"></a>Служба автоматизации
* [Автоматическая настройка оповещений с помощью PowerShell](../../azure-monitor/app/powershell-alerts.md)
* [Использование объектов webhook для автоматизации реагирования на оповещения](../../azure-monitor/platform/alerts-webhooks.md)

## <a name="see-also"></a>См. также
* [Доступность веб-тестов](../../azure-monitor/app/monitor-web-app-availability.md)
* [Автоматическая настройка оповещений](../../azure-monitor/app/powershell-alerts.md)
* [Упреждающая диагностика](../../azure-monitor/app/proactive-diagnostics.md) 

<!--Link references-->

[availability]: ../../azure-monitor/app/monitor-web-app-availability.md
[client]: ../../azure-monitor/app/javascript.md
[platforms]: ../../azure-monitor/app/platforms.md
[roles]: ../../azure-monitor/app/resources-roles-access-control.md
[start]: ../../azure-monitor/app/app-insights-overview.md

