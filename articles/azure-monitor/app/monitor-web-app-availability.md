---
title: Наблюдение за доступностью и скоростью реагирования веб-сайта | Документация Майкрософт
description: Настройка веб-тестов в Application Insights. Получение оповещений, когда веб-сайт становится недоступным или медленно реагирует на запросы.
ms.topic: conceptual
ms.date: 09/16/2019
ms.reviewer: sdash
ms.openlocfilehash: 82b433407906c09d38a46c842334153525fb3c17
ms.sourcegitcommit: 273c04022b0145aeab68eb6695b99944ac923465
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "97007931"
---
# <a name="monitor-the-availability-of-any-website"></a>Мониторинг доступности любого веб-сайта

После развертывания веб-приложения или веб-сайта можно настроить повторяющиеся тесты для отслеживания доступности и реагирования. [Azure Application Insights](./app-insights-overview.md) отправляет веб-запросы через одинаковые промежутки времени из разных точек по всему миру. Он может оповещать вас о том, что приложение не отвечает, или если оно реагирует слишком медленно.

Вы можете настроить тесты доступности для любой конечной точки HTTP или HTTPS, доступной из Интернета. Вам не нужно вносить никаких изменений в тестируемый веб-сайт. На самом деле, даже не обязательно быть владельцем сайта. Можно проверить доступность REST API, от которой зависит служба.

### <a name="types-of-availability-tests"></a>Типы тестов доступности:

Существует три типа тестов доступности.

* [Тест проверки связи с URL-адресом](#create-a-url-ping-test)– простой тест, который вы можете создать на портале Azure.
* [Многошаговый веб-тест](availability-multistep.md): запись последовательности веб-запросов, которую можно воспроизводить для тестирования более сложных сценариев. Многошаговые веб-тесты создаются в Visual Studio Enterprise и передаются на портал для выполнения.
* [Тесты доступности пользовательской трассировки](/dotnet/api/microsoft.applicationinsights.telemetryclient.trackavailability?view=azure-dotnet). Если вы решили создать пользовательское приложение для выполнения тестов доступности, `TrackAvailability()` метод можно использовать для отправки результатов в Application Insights.

**Для каждого Application Insights ресурса можно создать до 100 тестов доступности.**

## <a name="create-an-application-insights-resource"></a>Создание ресурса Application Insights

Чтобы создать тест доступности, сначала необходимо создать ресурс Application Insights. Если вы уже создали ресурс, перейдите к следующему разделу, чтобы [создать тест проверки связи по URL-адресу](#create-a-url-ping-test).

На портал Azure выберите **создать ресурс**  >  **средства для разработчиков**  >  **Application Insights** и [Создайте ресурс Application Insights](create-new-resource.md).

## <a name="create-a-url-ping-test"></a>Создание теста проверки связи с URL-адресом

Имя "Проверка связи по URL-адресу" является битом атрибутаDurableService. Для проверки доступности веб-узла этот тест не использует ICMP (Протокол управляющих сообщений Интернета). Вместо этого для проверки того, отвечает ли конечная точка, используется более сложная функциональность HTTP-запросов. Он также измеряет производительность, связанную с этим ответом, и добавляет возможность установки настраиваемых критериев успеха, связанных с более сложными функциями, такими как синтаксический анализ зависимых запросов и разрешение на повторные попытки.

Чтобы создать первый запрос на доступность, откройте область доступность и выберите **создать тест**.

![Укажите хотя бы URL-адрес своего веб-сайта](./media/monitor-web-app-availability/availability-create-test-001.png)

### <a name="create-a-test"></a>Создание теста

|Параметр| Объяснение
|----|----|----|
|**URL-адрес** |  Вы можете указать URL-адрес любой веб-страницы, которую требуется протестировать, но он должен быть видимым из общедоступного Интернета. URL-адрес может содержать строку запроса, поэтому вы, например, сможете немного поупражняться в работе с базой данных. Если URL-адрес указывает на перенаправление, мы будем переходить по нему до 10 раз.|
|**Анализ зависимых запросов**| Обрабатываются изображения, сценарии, файлы стилей и другие файлы, которые являются частью тестируемой веб-страницы. Записанное время ответа включает время, затраченное на получение этих файлов. Тест завершается ошибкой, если какие-либо из этих ресурсов невозможно загрузить в течение времени ожидания для всего теста. Если этот флажок не установлен, то тест запросит только файл по указанному URL-адресу. Включение этого параметра приводит к более тщательной проверке. Тест может завершиться ошибкой в случаях, которые могут быть незаметны при ручном просмотре сайта.
|**Разрешить повторные попытки**|при неудачном завершении теста оно повторяется через короткий интервал. Сообщение об ошибке отобразится только после трех неудачных попыток подряд. Последующие тесты будут выполняться с обычной частотой. Повторные попытки будут временно приостановлены до следующей успешной попытки. Это правило действует в любом расположении тестирования. **Рекомендуется использовать этот вариант**. В среднем около 80 % неудачных попыток решаются при повторной попытке.|
|**Периодичность проведения тестирования**| Задает частоту выполнения теста для всех тестовых расположений. При стандартной частоте в пять минут и с пятью тестовыми расположениями ваш сайт будет проверяться в среднем каждую минуту.|
|**Расположения тестирования**| Определяет места, из которых наши серверы отправляют веб-запросы на указанный URL-адрес. Чтобы вы могли различать проблемы с веб-сайтом и сетью, **мы рекомендуем использовать не менее пяти расположений**. Вы можете выбрать до 16 таких расположений.

**Если ваш URL-адрес не виден из общедоступного Интернета, можно выбрать выборочное открытие брандмауэра, чтобы разрешить только тестовые транзакции с помощью**. Дополнительные сведения об исключениях брандмауэра для агентов тестирования доступности см. в описании [IP-адресов](./ip-addresses.md#availability-tests).

> [!NOTE]
> Настоятельно рекомендуется выполнять тестирование из нескольких расположений, в которых не **менее пяти расположений**. Это позволяет предотвратить ложные предупреждения, которые могут возникнуть в результате временных проблем с определенным местоположением. Кроме того, мы обнаружили, что оптимальной конфигурацией является то, что **количество тестовых расположений будет равно порогу расположения предупреждений + 2**.

### <a name="success-criteria"></a>Критерии успешного завершения

|Параметр| Объяснение
|----|----|----|
| **Время ожидания тестирования** |Уменьшите значение этого параметра, чтобы получать оповещения о медленных откликах. Тест считается неудачной попыткой, если ответы от сайта не были получены в течение заданного периода. Если выбрать параметр **Анализировать зависимые запросы**, все изображения, файлы стилей, скрипты и другие зависимые ресурсы будут получены в течение этого периода.|
| **HTTP-ответ** | Возвращаемый код состояния, который считается успешным результатом. Код 200 указывает на возврат нормальной веб-страницы.|
| **Совпадение содержимого** | Произвольная строка, например "Welcome!". Проверим наличие точного совпадения (с учетом регистра) в каждом ответе. Это должна быть строка обычного текста без подстановочных знаков. Не забывайте, что если контент страницы изменяется, необходимо обновить эту строку. **В совпадении содержимого поддерживаются только символы английского алфавита** |

### <a name="alerts"></a>видны узлы

|Параметр| Объяснение
|----|----|----|
|**Почти в реальном времени (предварительная версия)** | Мы рекомендуем использовать оповещения "Почти в реальном времени". Настройка этого типа оповещений выполняется после создания теста доступности.  |
|**Классический** | Мы не рекомендуем использовать классический тип оповещений для новых тестов доступности.|
|**Пороговое значение для расположения оповещения**|Мы рекомендуем как минимум 3 из 5 расположений. Оптимальное отношение между пороговым значением для оповещения расположения и числом тестовых расположений: **пороговое значение для оповещения расположения** = **число расположений теста** – 2, минимум с пятью расположениями теста.|

### <a name="location-population-tags"></a>Теги заполнения расположения

Для атрибута географического расположения можно использовать следующие теги заполнения при развертывании теста проверки связи с URL-адресом доступности с помощью Azure Resource Manager.

#### <a name="azure-gov"></a>Azure gov

| Отображаемое имя   | Имя заполнения     |
|----------------|---------------------|
| US Gov (Вирджиния) | государственных организаций США-ва-AZR        |
| US Gov (Аризона)  | государственных организаций США-PHX-AZR       |
| US Gov (Техас)    | государственных организаций США-TX-AZR        |
| Восточная часть США (DoD)     | государственных организаций США-ддеаст-AZR    |
| Центральная часть США (DoD)  | государственных организаций США-ддцентрал-AZR |

#### <a name="azure"></a>Azure

| Отображаемое имя                           | Имя заполнения   |
|----------------------------------------|-------------------|
| Восточная Австралия                         | EMEA-Au-SYD-ребро  |
| Brazil South                           | Латам-BR-ГРУ-ребро |
| Центральная часть США                             | US-FL-Миа-ребро    |
| Восточная Азия                              | Азиатско--HK-хкн-AZR   |
| Восточная часть США                                | US-ва-Ash-AZR     |
| Южная Франция (прежнее название — Франция) | EMEA-CH-зрх-ребро  |
| Центральная Франция                         | EMEA-fr-одного-ребро  |
| Japan East                             | Азиатско--JP-Кав-ребро  |
| Северная Европа                           | EMEA-GB-db3-AZR   |
| Центрально-северная часть США                       | US-Il-CH1-AZR     |
| Центрально-южная часть США                       | US-TX-SN1-AZR     |
| Southeast Asia                         | Азиатско--SG-Sin-AZR   |
| западная часть Соединенного Королевства                                | EMEA-SE-сохранены-ребро  |
| Западная Европа                            | EMEA-NL-AMS-AZR   |
| западная часть США                                | US-CA-SJC-AZR     |
| южная часть Соединенного Королевства                               | EMEA-ru-MSA-ребро  |

## <a name="see-your-availability-test-results"></a>Просмотр результатов теста доступности

Результаты теста доступности можно отображать как в виде графика, так и в виде точечной диаграммы.

Через несколько минут нажмите кнопку " **Обновить** ", чтобы просмотреть результаты теста.

![На снимке экрана показана страница доступность с выделенной кнопкой "Обновить".](./media/monitor-web-app-availability/availability-refresh-002.png)

В представлении точечная диаграмма отображаются образцы результатов теста, в которых содержатся диагностические сведения о тестовых шагах. Обработчик тестов хранит сведения о диагностике тестов, которые завершились сбоем. Диагностические сведения об успешно выполненных тестах хранятся для подмножества выполнений. Наведите указатель мыши на любую из зеленых или красных точек, чтобы увидеть тест, имя теста и расположение.

![Представление строк](./media/monitor-web-app-availability/availability-scatter-plot-003.png)

Выберите конкретный тест, расположение или сократите период времени, чтобы просмотреть дополнительные результаты для нужного периода времени. Используйте обозреватель поиска, чтобы просмотреть результаты всех тестов или воспользуйтесь запросами аналитики, чтобы запустить пользовательские отчеты для этих данных.

## <a name="inspect-and-edit-tests"></a> Изменение и проверка тестов

Чтобы изменить, временно отключить или удалить тест, нажмите кнопку с многоточием рядом с именем теста. После внесения изменений изменения конфигурации для распространения на все агенты тестирования могут занять до 20 минут.

![Просмотр сведений о тесте. Изменение и отключение веб-теста](./media/monitor-web-app-availability/edit.png)

При обслуживании службы может потребоваться отключить тесты доступности или правила оповещения, связанные с ними.

## <a name="if-you-see-failures"></a>При возникновении сбоев

Щелкните красную точку.

![Щелкните красную точку.](./media/monitor-web-app-availability/open-instance-3.png)

С помощью результатов тестов доступности вы увидите сведения о транзакциях для всех компонентов. Здесь можно:

* изучить ответ, полученный от сервера;
* диагностировать сбой на основе коррелированной телеметрии на стороне сервера, собранной во время обработки теста доступности, завершившегося сбоем;
* добавить в журнал проблему или рабочий элемент в Git или Azure Boards для отслеживания проблемы; ошибка будет содержать ссылку на это событие;
* открыть результат веб-теста в Visual Studio.

См. дополнительные сведения об [интерфейсе сквозной диагностики транзакций](./transaction-diagnostics.md).

Щелкните строку исключения, чтобы просмотреть подробности исключения на стороне сервера, вызвавшего сбой искусственного теста доступности. Можно также получить [отладочный моментальный снимок](./snapshot-debugger.md) для более широкой диагностики на уровне кода.

![Диагностика на стороне сервера](./media/monitor-web-app-availability/open-instance-4.png)

Помимо необработанных результатов, можно также просмотреть две метрики доступности в [Обозреватель метрик](../platform/metrics-getting-started.md).

1. Доступность. Количество успешно выполненных тестов (в процентах).
2. Продолжительность теста. Средняя длительность всех тестов.

## <a name="automation"></a>Автоматизация

* [Используйте сценарии PowerShell, чтобы настройка теста доступности](./powershell.md#add-an-availability-test) выполнялась автоматически.
* Настройте вызов [webhook](../platform/alerts-webhooks.md), активируемый оповещением.

## <a name="troubleshooting"></a>Устранение неполадок

См. инструкции по [устранению неполадок](troubleshoot-availability.md).

## <a name="next-steps"></a>Дальнейшие действия

* [Оповещения о доступности](availability-alerts.md)
* [Многошаговые веб-тесты](availability-multistep.md)

