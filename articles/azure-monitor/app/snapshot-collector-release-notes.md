---
title: Заметки о выпуске для пакета NuGet Microsoft. ApplicationInsights. SnapshotCollector — Application Insights
description: Заметки о выпуске пакета NuGet Microsoft. ApplicationInsights. SnapshotCollector, используемого Snapshot Debuggerом Application Insights.
ms.topic: conceptual
author: pharring
ms.author: pharring
ms.date: 11/10/2020
ms.openlocfilehash: faacb78ca7f055bb8e9a469afb894bc30ee87501
ms.sourcegitcommit: 4bee52a3601b226cfc4e6eac71c1cb3b4b0eafe2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/11/2020
ms.locfileid: "94507557"
---
# <a name="release-notes-for-microsoftapplicationinsightssnapshotcollector"></a>Заметки о выпуске Microsoft. ApplicationInsights. SnapshotCollector

Эта статья содержит заметки о выпусках для пакета NuGet Microsoft. ApplicationInsights. SnapshotCollector для приложений .NET, которые используются Snapshot Debuggerом Application Insights.

Дополнительные [сведения](./snapshot-debugger.md) о Application Insights snapshot Debugger для приложений .NET.

Чтобы получить отчеты об ошибках и отзывы, откройте вопрос на сайте GitHub по адресу https://github.com/microsoft/ApplicationInsights-dotnet

## <a name="release-notes"></a>Заметки о выпуске

## <a name="1373"></a>[1.3.7.3](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.3.7.3)
Выпуск Point для решения нескольких проблем с высоким уровнем влияния.
### <a name="bug-fixes"></a>Исправленные ошибки
- Исправлена операция обнаружения PDB в папке Wwwroot/Bin, которая была разорвана при изменении алгоритма поиска символов в 1.3.6.
- Исправлена шум Екстрактваскалледмултиплетимесексцептион в телеметрии.

## <a name="137"></a>[1.3.7](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.3.7)
### <a name="changes"></a>Изменения
Целевой объект SnapshotCollector netcoreapp 2.0 зависит от Microsoft. ApplicationInsights. AspNetCore >= 2.1 (опять же). Это меняет поведение до 1.3.5. Мы попытались обновить его в 1.3.6, но некоторые сценарии службы приложений Azure были нарушены.
### <a name="new-features"></a>Новые функции
Snapshot Collector считывает и анализирует ConnectionString из переменной среды APPLICATIONINSIGHTS_CONNECTION_STRING или из Телеметриконфигуратион. В основном это значение используется для установки конечной точки для подключения к службе моментальных снимков. Дополнительные сведения см. в [документации по строкам подключения](./sdk-connection-string.md).
### <a name="bug-fixes"></a>Исправленные ошибки
- Переключение на использование HttpClient для всех целевых объектов, за исключением net45, так как в некоторых средах возникла ошибка WebRequest из-за несовместимого экземпляр SecurityProtocol (требуется TLS 1,2).

## <a name="136"></a>[1.3.6](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.3.6)
### <a name="changes"></a>Изменения
- SnapshotCollector теперь зависит от Microsoft. ApplicationInsights >= 2.5.1 для всех целевых платформ. Это может быть критическим изменением, если ваше приложение зависит от более старой версии пакета SDK для Microsoft. ApplicationInsights.
- Удалите поддержку TLS 1,0 и 1,1 в службе "отправку моментальных снимков".
- Период сканирования PDB теперь по умолчанию составляет 24 часа, а не 15 минут. Можно настроить с помощью Пдбресканинтервал в Снапшотколлекторконфигуратион.
- При сканировании PDB выполняется поиск только папок верхнего уровня, а не рекурсивных. Это может быть критическим изменением, если символы находятся во вложенных папках двоичной папки.
### <a name="new-features"></a>Новые функции
- Поворот журнала в Снапшотуплоадер, чтобы избежать заполнения папки Logs старыми файлами.
- Поддержка деоптимизации (через ReJIT при присоединении) для приложений .NET Core 3,0.
- Добавление символов в пакет NuGet.
- Задайте дополнительные метаданные при отправке минидампа.
- В Снапшотколлектортелеметрипроцессор Добавлено инициализированное свойство. Это CancellationToken, которая будет отменена, когда Snapshot Collector полностью инициализирована и подключена к конечной точке службы.
- Теперь моментальные снимки можно записывать для исключений в динамически создаваемых методах. Например, скомпилированные деревья выражений, созданные Entity Framework запросами.
### <a name="bug-fixes"></a>Исправленные ошибки
- Snapshot Collector загрузки AmbiguousMatchException из-за монитор состояния.
- Метод расширения Жетснапшотколлектор теперь выполняет поиск во всех Телеметрисинкс.
- Не запускайте отправку моментального снимка на неподдерживаемых платформах.
- Обрабатывайте исключение InvalidOperationException при деоптимизации динамических методов (например, Entity Framework).

## <a name="135"></a>[1.3.5](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.3.5)
- Добавлена поддержка для облаков независимых (более старые версии не будут работать в облаках независимых).
- Упрощено добавление сборщика моментальных снимков с помощью Аддснапшотколлектор (). Дополнительные сведения см. [здесь](./snapshot-debugger-appservice.md).
- Используйте параметр FISMA MD5 для проверки блоков BLOB-объектов. Это позволяет избежать алгоритма шифрования .NET MD5 по умолчанию, который недоступен, если ОС настроена на режим совместимости с FIPS.
- Пропуск .NET Frameworkных кадров при деоптимизации вызовов функций. Это поведение можно контролировать с помощью параметра конфигурации Деоптимизеигноредмодулес.
- Добавьте `DeoptimizeMethodCount` параметр конфигурации, разрешающий деоптимизацию нескольких вызовов функций. Дополнительные сведения

## <a name="134"></a>[1.3.4](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.3.4)
- Разрешить структурированные ключи инструментирования.
- Повышение надежности Снапшотуплоадер — продолжайте запуск, даже если старые журналы отгрузки нельзя перемещать.
- Повторная включение дополнительных данных телеметрии, когда SnapshotUploader.exe выходит немедленно (было отключено в 1.3.3).
- Упростите внутреннюю телеметрию.
- _Экспериментальная функция_ : планы сбора точка прикрепления: Добавление "снапшотонфирстоккуренце". Дополнительные сведения см. [здесь](https://gist.github.com/alexaloni/5b4d069d17de0dabe384ea30e3f21dfe).

## <a name="133"></a>[1.3.3](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.3.3)
- Исправлена ошибка, которая привела к зависанию SnapshotUploader.exe и не отправке моментальных снимков для приложений .NET Core.

## <a name="132"></a>[1.3.2](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.3.2)
- _Экспериментальная функция_ : планы сбора точка прикрепления. Дополнительные сведения см. [здесь](https://gist.github.com/alexaloni/5b4d069d17de0dabe384ea30e3f21dfe).
- SnapshotUploader.exe будет завершаться, когда среда выполнения выгружает AppDomain, из которого загружается SnapshotCollector, а не ожидает завершения процесса. Это повышает надежность сборщика при размещении в IIS.
- Добавьте конфигурацию, чтобы разрешить нескольким экземплярам SnapshotCollector, использующим один и тот же ключ инструментирования, совместно использовать один и тот же процесс Снапшотуплоадер: Шареуплоадерпроцесс (по умолчанию — `true` ).
- Сообщать о дополнительных телеметрии, когда SnapshotUploader.exe немедленно завершает работу.
- Уменьшено количество файлов поддержки, SnapshotUploader.exe необходимо записать на диск.

## <a name="131"></a>[1.3.1](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.3.1)
- Удалите поддержку для сбора моментальных снимков с помощью API Ртлклонеусерпроцесс и поддержки только API Псскаптуреснапшотс.
- Увеличьте ограничение по умолчанию, определяющее количество моментальных снимков, которое может быть захвачено за 10 минут с 1 до 3.
- Разрешить SnapshotUploader.exe согласовывать TLS 1,1 и 1,2
- Сообщать о дополнительной телеметрии, когда Снапшотуплоадер регистрирует предупреждение или ошибку
- Прекратить создание моментальных снимков, когда серверная служба сообщает о достижении ежедневной квоты (моментальные снимки 50 за день)
- Добавьте дополнительный флажок SnapshotUploader.exe, чтобы запретить одновременное выполнение двух экземпляров.

## <a name="130"></a>[1.3.0](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.3.0)
### <a name="changes"></a>Изменения
- Для приложений, предназначенных для .NET Framework, Snapshot Collector теперь зависит от Microsoft. ApplicationInsights версии 2.3.0 или выше.
Он использовался как 2.2.0 или выше.
Мы считаем, что это не будет проблемой для большинства приложений, но сообщите нам о том, что это изменение не позволит вам использовать последнюю Snapshot Collector.
- Используйте экспоненциальные задержки при отправке моментальных снимков при повторной попытке загрузки.
- Используйте Сервертелеметричаннел (если доступно) для более надежной отчетности телеметрии.
- Используйте "Сдкинтерналоператионсмонитор" для первоначального подключения к службе Snapshot Debugger, чтобы она игнорировалась отслеживанием зависимостей.
- Улучшите телеметрию для первоначального подключения к службе Snapshot Debugger.
- Сообщить о дополнительных телеметрии для:
  - Версия службы приложений Azure.
  - Экземпляры вычислений Azure.
  - Контейнеры.
  - Приложение функции Azure.
### <a name="bug-fixes"></a>Исправленные ошибки
- Если для интервала сброса счетчика проблемы задано значение 24 дня, интерпретируется как 24 часа.
- Исправлена ошибка, при которой отработка моментального снимка прекращает обработку новых моментальных снимков, если при удалении моментального снимка возникло исключение.

## <a name="123"></a>[1.2.3](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.2.3)
- Исправьте подпись строгого имени с двоичными файлами отгрузки моментальных снимков.

## <a name="122"></a>[1.2.2](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.2.2)
### <a name="changes"></a>Изменения
- Файлы, необходимые для Снапшотуплоадер (64). exe, теперь внедряются в качестве ресурсов в основную библиотеку DLL. Это означает, что папка Снапшотколлекторфилес больше не создается, что упрощает сборку и развертывание и снижает беспорядок в обозреватель решений. Следите за обновлениями, чтобы проверить изменения в `.csproj` файле. `Microsoft.ApplicationInsights.SnapshotCollector.targets`Файл больше не требуется.
- Данные телеметрии записываются в ресурс Application Insights, даже если для Провидеанонимаустелеметри задано значение false. Это значит, что мы можем реализовать функцию проверки работоспособности в портал Azure. Провидеанонимаустелеметри влияет только на данные телеметрии, отправляемые в корпорацию Майкрософт для поддержки и улучшения продукта.
- Если Темпфолдер или Шадовкопифолдер перенаправляются в переменные среды, обеспечьте бездействие сборщика до тех пор, пока не будут заданы эти переменные среды.
- Для приложений, подключающихся к Интернету через прокси-сервер, Snapshot Collector теперь автоматически определяет все параметры прокси-сервера и передает их SnapshotUploader.exe.
- Уменьшите приоритет процесса Снапшотуплаодер (где это возможно). Этот приоритет можно переопределить с помощью параметра Исловприоиртиснапшотуплоадер.
- Добавлен метод расширения Жетснапшотколлектор в Телеметриконфигуратион для сценариев, в которых необходимо настроить Snapshot Collector программным способом.
- Задайте версию пакета SDK Application Insights (вместо версии приложения) в телеметрических данных, доступных для клиентов.
- Отправка первого события пульса через две минуты.
### <a name="bug-fixes"></a>Исправленные ошибки
- Исправьте NullReferenceException, если исключения содержат неопределенные или неизменяемые словари данных.
- В загрузчике повторите попытку выполнить повторное выполнение PDB-файла в несколько раз при получении нарушения общего доступа.
- Исправление повторяющихся данных телеметрии, когда несколько потоков вызывают конвейер телеметрии при запуске.

## <a name="121"></a>[1.2.1](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.2.1)
### <a name="changes"></a>Изменения
- Файлы комментариев XML doc теперь включены в пакет NuGet.
- Добавлен метод расширения Ексклудефромснапшоттинг для сценариев, в которых вы уверены, что `System.Exception` у вас есть шум, и вы хотите избежать создания моментальных снимков для него.
- Добавлено свойство конфигурации Исенабледвхенпрофилинг, значение по умолчанию — true. Это изменение из предыдущих версий, где создание моментального снимка было временно отключено, если Application Insights Profiler выполнялась детальная коллекция. Старое поведение можно восстановить, задав для этого свойства значение false.
### <a name="bug-fixes"></a>Исправленные ошибки
- Правильно подпишите SnapshotUploader64.exe.
- Защита от двойной инициализации обработчика данных телеметрии.
- Предотвращение двойного ведения журнала телеметрии в приложениях с несколькими конвейерами.
- Исправление ошибки с временем истечения срока действия плана сбора, что может помешать моментальному снимку через 24 часа.

## <a name="120"></a>[1.2.0](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.2.0)
Крупнейшим изменением в этой версии (таким образом, переход на новый дополнительный номер версии) является перезапись конвейера создания и обработки моментального снимка. В предыдущих версиях эта функция была реализована в машинном коде (Продуктионбреакпоинтс *. dll и снапшосолдер*. exe). Новая реализация — это весь управляемый код с P/Invoke. Для первой версии, использующей новый конвейер, мы не использовали исходное поведение. Новая реализация обеспечивает более эффективное создание отчетов об ошибках и настраивает нас для будущих улучшений.

### <a name="other-changes-in-this-version"></a>Другие изменения в этой версии
- MinidumpUploader.exe был переименован в SnapshotUploader.exe (или SnapshotUploader64.exe).
- Добавлена телеметрия по времени для деоптимизации или реоптимизации запросов.
- Добавлено сжатие Gzip для отправки минидампа.
- Исправлена проблема, при которой PDB-файлы заблокированы, что препятствует обновлению сайта.
- Заносить в журнал исходное имя папки (Снапшотколлекторфилес) при теневом копировании.
- Настройте ограничения памяти для 64-разрядных процессов, чтобы предотвратить перезагрузку сайта из-за нехватки ресурсов.
- Устранена проблема, из-за которой моментальные снимки собираются даже после отключения.
- Регистрировать события пульса в ресурсе AI клиента.
- Увеличьте скорость моментального снимка, удалив "источник" из идентификатора проблемы.

## <a name="112"></a>[1.1.2](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.1.2)
### <a name="changes"></a>Изменения
Дополнительные данные телеметрии использования
- Обнаружение версий и ОС .NET и отчетов
- Обнаружение и отчет о дополнительных средах Azure (облачная служба, Service Fabric)
- Записывать и сообщать метрики исключений (число одноэкземплярных исключений и количество вызовов TrackException) в телеметрии пульса.
### <a name="bug-fixes"></a>Исправленные ошибки
- Правильная обработка SqlException, где не создается внутреннее исключение (Win32Exception).
- Обрезать конечные пробелы в папках символов, что привело к неправильному анализу аргументов командной строки для MinidumpUploader.
- Предотвращение неограниченного повтора неудачных попыток подключения к конечной точке агента Snapshot Debugger.

## <a name="110"></a>[1.1.0](https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector/1.1.0)
### <a name="changes"></a>Изменения
- Добавлена защита памяти узла. Эта функция снижает влияние на память главного компьютера.
- Улучшение процесса просмотра снимков портал Azure.