---
title: Устранение неполадок тестов доступности Application Insights Azure
description: Устранение неполадок веб-тестов в Azure Application Insights. Получение оповещений, когда веб-сайт становится недоступным или медленно реагирует на запросы.
ms.topic: conceptual
author: lgayhardt
ms.author: lagayhar
ms.date: 11/19/2020
ms.reviewer: sdash
ms.openlocfilehash: 368c45433247c441631bdf79bfc9caa28a41f1b4
ms.sourcegitcommit: 65db02799b1f685e7eaa7e0ecf38f03866c33ad1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/03/2020
ms.locfileid: "96546762"
---
# <a name="troubleshooting"></a>Устранение неполадок

Эта статья поможет вам устранить распространенные проблемы, которые могут возникнуть при использовании мониторинга доступности.

## <a name="troubleshooting-report-steps-for-ping-tests"></a>Устранение неполадок с отчетами для проверки связи

Отчет об устранении неполадок позволяет легко диагностировать распространенные проблемы, которые приводят к сбою **проверок связи** .

![Анимация перехода с вкладки "доступность" путем выбора ошибки в сведениях о сквозной транзакции для просмотра отчета об устранении неполадок](./media/troubleshoot-availability/availability-to-troubleshooter.gif)

1. На вкладке доступность Application Insights ресурса выберите общий или один из тестов доступности.
2. В разделе "Детализация" слева или на точечной диаграмме выберите пункт **не пройден** .
3. На странице сведения о сквозной транзакции выберите событие, а затем в разделе "Сводка по отчетам об устранении неполадок" выберите **[перейти к шагу]** , чтобы просмотреть отчет об устранении неполадок.

> [!NOTE]
>  Если шаг повторного использования подключения отсутствует, шаги разрешения DNS, подключения и TLS-транспорта будут отсутствовать.

|Шаг | Сообщение об ошибке | Возможные причины |
|-----|---------------|----------------|
| Повторное использование подключения | Недоступно | Обычно зависит от ранее установленного соединения, что означает, что шаг веб-теста является зависимым. Для этого не потребуется выполнять шаг DNS, подключение или SSL. |
| Разрешение DNS | Не удалось разрешить удаленное имя: "ваш URL-адрес" | Сбой процесса разрешения DNS, вероятнее всего из-за неправильно настроенных записей DNS или временных сбоев DNS-сервера. |
| Установление соединения | Попытка подключения не удалась, так как подключенная сторона не ответила должным образом через некоторое время. | Обычно это означает, что сервер не отвечает на HTTP-запрос. Распространенной причиной является то, что наши агенты тестирования блокируются брандмауэром на сервере. Если вы хотите выполнить тестирование в виртуальной сети Azure, добавьте тег службы доступности в вашу среду.|
| Транспорт TLS  | Клиент и сервер не могут взаимодействовать, так как они не имеют общего алгоритма.| Поддерживаются только TLS 1,0, 1,1 и 1,2. Протокол SSL не поддерживается. Этот шаг не проверяет SSL-сертификаты и устанавливает только безопасное подключение. Этот шаг будет отображаться только при возникновении ошибки. |
| Получение заголовка ответа | Не удалось считать данные из транспортного соединения. Соединение было закрыто. | Сервер зафиксировал ошибку протокола в заголовке ответа. Например, соединение закрывается сервером, когда ответ не полностью. |
| Получение текста ответа | Не удалось считать данные из транспортного соединения: соединение было закрыто. | Сервер зафиксировал ошибку протокола в тексте ответа. Например, соединение закрывается сервером, когда ответ не полностью прочитан, или размер фрагмента данных в теле фрагмента отклика неверен. |
| Проверка ограничения перенаправления | На этой веб-странице слишком много перенаправлений. Этот цикл будет завершен здесь, так как этот запрос превысил ограничение на автоматическое перенаправление. | Существует ограничение в 10 перенаправлений для каждого теста. |
| Проверка кода состояния | `200 - OK` не соответствует ожидаемому состоянию `400 - BadRequest` . | Возвращаемый код состояния, который считается успешным результатом. Код 200 указывает на возврат нормальной веб-страницы. |
| Проверка содержимого | Требуемый текст "Hello" не появился в ответе. | Строка не является точным совпадением с учетом регистра в ответе, например строка "Добро пожаловать!". Это должна быть простая строка без подстановочных знаков (например, звездочка). При изменении содержимого страницы может потребоваться обновить строку. Для совпадения содержимого поддерживаются только английские символы. |
  
## <a name="common-troubleshooting-questions"></a>Общие вопросы по устранению неполадок

### <a name="site-looks-okay-but-i-see-test-failures-why-is-application-insights-alerting-me"></a>Сайт выглядит правильно, но возникают сбои тестирования. Почему Application Insights оповещает меня?

   * Включены ли в тест **зависимые запросы на анализ** ? Это приводит к тщательной проверке ресурсов, таких как сценарии, изображения и т. д. Эти типы сбоев могут быть не заметны в браузере. Проверьте все изображения, скрипты, таблицы стилей и любые другие файлы, загружаемые на страницу. Если какой-либо из них завершается неудачей, тест сообщается как сбой, даже если Главная HTML-страница загружается без проблем. Чтобы десенситизе тест на такие сбои ресурсов, просто снимите флажки для запросов, зависимых от анализа, из конфигурации теста.

   * Чтобы уменьшить вероятность шума от временной сети нестабильной работе и т. д., убедитесь, что установлен флажок Включить повторные попытки для конфигурации ошибок тестирования. Вы также можете выполнять тестирование из любого расположения и соответствующим образом управлять пороговым значением правила генерации оповещений для предотвращения проблем с конкретными расположениями, вызывающих ненужные оповещения.

   * Щелкните любую из красных точек в интерфейсе точечной диаграммы доступности или любую ошибку доступности в обозревателе поиска, чтобы просмотреть сведения о причинах сбоя. Результат теста, а также коррелированные данные телеметрии на стороне сервера (если они включены) должны помочь понять, почему тест завершился ошибкой. Распространенные причины временных неполадок — проблемы сети или подключения.

   * Истекло ли время ожидания теста? Мы прерываем тесты через две минуты. Если ваша проверка связи или многошаговый тест занимает более двух минут, мы воспринимаем это как сбой. Разбейте тест на несколько сеансов, которые можно выполнить последовательно.

   * Все ли расположения сообщили о сбоях? Если только некоторые их них прислали отчет о сбое, возможно, причина в проблемах с сетью или CDN. Щелкая красные точки, вы можете понять, почему расположение сообщило о сбое.

### <a name="i-did-not-get-an-email-when-the-alert-triggered-or-resolved-or-both"></a>Мне не пришло сообщение электронной почты при активации или разрешении оповещения.

Проверьте конфигурацию классических оповещений, чтобы убедиться, что ваш адрес электронной почты явно указан, или список рассылки, в который вы входите, настроен для получения уведомлений. Если это так, проверьте конфигурацию списка рассылки, чтобы убедиться, что он может получать внешние сообщения электронной почты. Проверьте также, не настроил ли администратор электронной почты политики, которые могут вызвать эту проблему.

### <a name="i-did-not-receive-the-webhook-notification"></a>Я не получаю уведомления веб-перехватчика.

Убедитесь, что приложение, получающее уведомления от веб-перехватчика, доступно и успешно обрабатывает запросы веб-перехватчика. Дополнительную информацию см. [здесь](../platform/alerts-log-webhook.md).

### <a name="i-am-getting--403-forbidden-errors-what-does-this-mean"></a>Я получаю 403 недопустимых ошибок, что это значит?

Эта ошибка означает, что необходимо добавить исключения брандмауэра, чтобы разрешить агентам доступности тестировать целевой URL-адрес. Полный список разрешенных IP-адресов агента см. в статье об [исключении IP](./ip-addresses.md#availability-tests).

### <a name="intermittent-test-failure-with-a-protocol-violation-error"></a>Периодические сбои тестирования и ошибка с уведомлением о нарушении протокола.

Ошибка ("нарушение протокола...За возвратом каретки должен следовать перевод строки") свидетельствует о возможной неполадке с сервером (или зависимостями). Такое происходит, когда в ответе задаются неправильно сформированные заголовки. Это может быть вызвано подсистемами балансировки нагрузки или сетями доставки содержимого (CDN). В частности, некоторые заголовки могут не использовать символ CRLF для обозначения конца строки, что нарушает спецификацию HTTP и, следовательно, не проходит проверку на уровне WebRequest .NET. Проверьте ответ на плашечные заголовки, которые могут быть нарушены.

> [!NOTE]
> При переходе по URL-адресу в браузерах, для которых установлена упрощенная проверка заголовков HTTP, может не произойти сбой. См. подробное описание проблемы в этой записи блога: http://mehdi.me/a-tale-of-debugging-the-linkedin-api-net-and-http-protocol-violations/  

### <a name="i-dont-see-any-related-server-side-telemetry-to-diagnose-test-failures"></a>Я не вижу связанных данных телеметрии на стороне сервера для диагностики сбоев тестирования? *

Если служба Application Insights настроена для серверного приложения, возможно, это произошло из-за [выборки](./sampling.md) в операции. Выберите другой результат доступности.

### <a name="can-i-call-code-from-my-web-test"></a>Можно ли вызывать код из моего веб-теста?

Нет. Действия теста должны находиться в WEBTEST-файле. Кроме того, нельзя вызывать другие веб-тесты и использовать циклы. Но есть несколько подключаемых модулей, которые могут оказаться полезными.


### <a name="is-there-a-difference-between-web-tests-and-availability-tests"></a>Есть ли разница между понятиями "веб-тесты" и "тесты доступности"?

Эти два термина могут быть взаимозаменяемыми. Тест доступности является более универсальным термином, так как кроме многошаговых веб-тестов вам доступны проверка связи с отдельным URL-адресом.

### <a name="id-like-to-use-availability-tests-on-our-internal-server-that-runs-behind-a-firewall"></a>Мне нужно использовать тесты доступности на нашем внутреннем сервере, который работает за брандмауэром.

   Существует два возможных решения:

   * Разрешите в брандмауэре входящие запросы с [IP-адресов агентов веб-тестирования](./ip-addresses.md).
   * Напишите собственный код для периодической проверки внутреннего сервера. Запустите код в виде фонового процесса на тестовом сервере за брандмауэром. Процесс тестирования может отправлять результаты в Application Insights с помощью API [TrackAvailability()](/dotnet/api/microsoft.applicationinsights.telemetryclient.trackavailability) в основном пакете SDK. Для этого тестовый сервер должен иметь исходящий доступ к конечной точке приема в Application Insights, что представляет гораздо меньшую угрозу безопасности, чем разрешение входящих запросов. Результаты будут отображаться в колонках веб-тестов доступности, хотя процесс будет немного упрощен из доступных для тестов, созданных с помощью портала. Пользовательские тесты доступности также будут отображаться как результаты доступности в аналитике, поиске и метриках.

### <a name="uploading-a-multi-step-web-test-fails"></a>Сбой отправки многошагового веб-теста.

Некоторые причины, по которым он может произойти:
   * Максимальный размер — 300 000.
   * Циклы не поддерживаются.
   * Ссылки на другие веб-тесты не поддерживаются.
   * Источники данных не поддерживаются.

### <a name="my-multi-step-test-doesnt-complete"></a>Мой многошаговый тест не выполняется.

Максимальное количество запросов в тесте — 100. Кроме того, тест будет остановлен, если он выполняется дольше двух минут.

### <a name="how-can-i-run-a-test-with-client-certificates"></a>Как запустить тест с клиентскими сертификатами?

В настоящее время это не поддерживается.

## <a name="who-receives-the-classic-alert-notifications"></a>Кто получает (классические) оповещения?

Этот раздел относится только к классическим оповещениям, он поможет вам оптимизировать уведомления так, чтобы они приходили только желаемым получателям. Чтобы узнать больше о различиях между [классическими оповещениями](../platform/alerts-classic.overview.md) и новыми возможностями оповещений, ознакомьтесь с [обзорной статьей об оповещениях](../platform/alerts-overview.md). Чтобы управлять оповещениями в новом интерфейсе оповещений, используйте [группы действий](../platform/action-groups.md).

* Мы рекомендуем использовать определенных получателей для классических оповещений.

* Если флажок **bulk/group** (массовый/групповой) включен, оповещения о сбоях из X из Y расположений будут оправляться пользователям с ролями администратора или соадминистратора.  По сути, _все_ администраторы _подписки_ будут получать уведомления.

* Для оповещений о метриках доступности параметр **многогруппового** флажка, если он включен, отправляет пользователям с ролями владельца, участника или читателя в подписке. Фактически, _все_ пользователи, имеющие доступ к подписке Application Insights, находятся в области действия и будут получать уведомления. 

> [!NOTE]
> При отключении используемого флажка **bulk/group** (массовый/груповой) вы не сможете отменить изменение.

Используйте новые возможности оповещений и оповещения почти в реальном времени, если вам нужно уведомлять пользователей в зависимости от их ролей. С помощью [групп действий](../platform/action-groups.md) вы можете настроить уведомления по электронной почте для пользователей с любой из ролей — участника, владельца или читателя (не объединяемых вместе как один параметр).

## <a name="next-steps"></a>Дальнейшие шаги

* [Многошаговое веб-тестирование](availability-multistep.md)
* [Проверки связи URL-адреса](monitor-web-app-availability.md)