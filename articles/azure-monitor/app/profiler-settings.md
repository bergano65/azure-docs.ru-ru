---
title: Использование панели параметров Azure Application Insights Profiler | Документация Майкрософт
description: Просмотр состояния средства Profiler и запуск сеансов профилирования
ms.service: azure-monitor
ms.subservice: application-insights
ms.topic: conceptual
author: cweining
ms.author: cweining
ms.date: 08/06/2018
ms.reviewer: mbullwin
ms.openlocfilehash: b383ef8c92325b0ad6561bee9b654c78e4054338
ms.sourcegitcommit: 8e271271cd8c1434b4254862ef96f52a5a9567fb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2019
ms.locfileid: "72820487"
---
# <a name="configure-application-insights-profiler"></a>Настройка Application Insights Profiler

## <a name="updated-profiler-agent"></a>Обновленный агент профилировщика
Триггеры поддерживаются только в версии 2,6 или более поздней версии агента профилировщика. Если вы используете службу приложений Azure, агент будет обновлен автоматически. Вы можете увидеть, какая версия агента будет запущена, если вы перейдете на URL-адрес KUDU для веб-сайта и добавите \Диагностиксервицес к концу, например: https://yourwebsite.scm.azurewebsites.net/diagnosticservices. Веб-задание Application Insights Profiler должно иметь версию 2,6 или более позднюю. Вы можете принудительно выполнить обновление, перезапустив веб-приложение. 

Если вы запускаете профилировщик на виртуальной машине или в облачной службе, необходимо установить расширение Windows система диагностики Azure (WAD) версии 16.0.4 или более новой. Чтобы проверить версию WAD, войдите на виртуальную машину и просмотрите этот каталог: C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\1.16.0.4. Имя каталога — это установленная версия WAD. Агент виртуальной машины Azure автоматически обновит WAD, когда станут доступны новые версии.

## <a name="profiler-settings-page"></a>Страница параметров профилировщика

Чтобы открыть панель "Параметры Application Insights Profiler Azure", перейдите в область производительности Application Insights, а затем нажмите кнопку **Configure Profiler (настроить профилировщик** ).

![Ссылка на страницу открытия параметров профилировщика][configure-profiler-entry]

Откроется страница, которая выглядит следующим образом:

![Страница параметров профилировщика][configure-profiler-page]

Страница **настройка Application Insights Profiler** включает следующие функции.

| | |
|-|-|
Профилировать сейчас | Запускает сеансы профилирования для всех приложений, связанных с этим экземпляром Application Insights.
триггеры; | Позволяет настраивать триггеры, которые приводят к запуску профилировщика. 
Недавние сеансы профилирования | Отображает сведения о прошлых сеансах профилирования.

## <a name="profile-now"></a>Профилировать сейчас
Этот параметр позволяет запускать сеанс профилирования по требованию. Если щелкнуть эту ссылку, все агенты профилировщика, отправляющие данные в этот экземпляр Application Insights, начнут записывать профиль. Через 5 – 10 минут сеанс профиля будет показан в списке ниже.

Чтобы пользователь вручную инициировал сеанс профилировщика, ему требуется как минимум доступ на запись к своей роли для компонента Application Insights. В большинстве случаев этот доступ предоставляется автоматически и никаких дополнительных операций не требуется. При возникновении проблем роль области подписки, которую нужно добавить, будет иметь роль "участник Application Insights компонента". [Дополнительные сведения об управлении доступом к роли с помощью мониторинга Azure см](https://docs.microsoft.com/azure/azure-monitor/app/resources-roles-access-control). здесь.

## <a name="trigger-settings"></a>Параметры триггера
![Всплывающее меню параметров триггера][trigger-settings-flyout]

При нажатии кнопки триггеры в строке меню открывается окно Параметры триггера. Вы можете настроить триггер для запуска профилирования, если процент использования ЦП или памяти достигает заданного уровня.

| | |
|-|-|
Кнопка "вкл./выкл." | On: профилировщик может запускаться этим триггером; Выкл. Этот триггер не запускает профилировщик.
Порог памяти | Если этот процент памяти используется, профилировщик будет запущен.
Duration | Задает период времени, в течение которого профилировщик будет запускаться при запуске.
Cooldown | Задает период времени, в течение которого профилировщик будет ожидать повторной проверки использования памяти или ЦП после его активации.

## <a name="recent-profiling-sessions"></a>Недавние сеансы профилирования
В этом разделе страницы отображаются сведения о последних сеансах профилирования. Сеанс профилирования представляет собой период времени, в течение которого агент профилировщика проходил профиль на одном из компьютеров, на которых размещено приложение. Можно открыть профили из сеанса, щелкнув одну из строк. Для каждого сеанса мы покажем следующее:

| | |
|-|-|
Кем активировано | Как был запущен сеанс с помощью триггера, профиля сейчас или выборки по умолчанию. 
Имя приложения | Имя приложения, для которого было выполнено профилирование.
Экземпляр компьютера | Имя компьютера, на котором выполнялся агент профилировщика.
Timestamp | Время, когда был захвачен профиль.
Трассировка | Число трассировок, которые были присоединены к отдельным запросам.
% загрузки ЦП | Процент ЦП, который использовался во время работы профилировщика.
Свободной | Процент памяти, который использовался во время работы профилировщика.

## <a id="profileondemand"></a>Использование веб-тестов производительности для создания трафика в приложении

Вы можете запустить средство Profiler вручную одним щелчком. Предположим, вы выполняете веб-тест производительности. Вам понадобятся трассировки, которые помогут понять, как работает веб-приложение под нагрузкой. Очень важна возможность контролировать время записи трассировок, так как вам известно, когда будет выполняться нагрузочный тест. Однако это время может не совпадать с интервалом случайной выборки.

В следующем разделе объясняется, как работает этот сценарий.

### <a name="step-1-generate-traffic-to-your-web-app-by-starting-a-web-performance-test"></a>Шаг 1. Создание трафика для веб-приложения путем запуска веб-теста производительности

Если в веб-приложение уже поступает входящий трафик или вы хотите создавать трафик вручную, пропустите этот раздел и перейдите к шагу 2.

1. На портале Application Insights выберите **Настройка** > **Тестирование производительности**. 

1. Нажмите кнопку **Создать**, чтобы запустить новый тест производительности.

   ![Создание теста производительности][create-performance-test]

1. В области **Новый тест производительности** настройте целевой URL-адрес теста. Примите все параметры по умолчанию, а затем выберите **Запустить тест**, чтобы запустить нагрузочный тест.

    ![Настройка нагрузочного теста][configure-performance-test]

    Вы увидите, что новый тест будет поставлен в очередь первым, а за ним будет следовать состояние *Выполняется*.

    ![Нагрузочный тест отправлен и поставлен в очередь][load-test-queued]

    ![Нагрузочный тест выполняется][load-test-in-progress]

### <a name="step-2-start-a-profiler-on-demand-session"></a>Шаг 2. Запуск сеанса профилировщика по запросу

1. После запуска нагрузочного теста можно запустить средство Profiler для записи трассировок для веб-приложения в то время, когда оно получает нагрузку.

1. Перейдите на панель **настройки средства Profiler**.


### <a name="step-3-view-traces"></a>Шаг 3. Просмотр трассировок

После завершения работы средства Profiler следуйте инструкциям в уведомлении, чтобы перейти на панель "Производительность" и просмотреть трассировки.

## <a name="next-steps"></a>Дальнейшие действия
[Профилирование приложений в рабочей среде Azure с помощью Application Insights Profiler](profiler-overview.md?toc=/azure/azure-monitor/toc.json)

[profiler-on-demand]: ./media/profiler-settings/Profiler-on-demand.png
[configure-profiler-entry]: ./media/profiler-settings/configure-profiler-entry.png
[configure-profiler-page]: ./media/profiler-settings/configureBlade.png
[trigger-settings-flyout]: ./media/profiler-settings/CPUTrigger.png
[create-performance-test]: ./media/profiler-settings/new-performance-test.png
[configure-performance-test]: ./media/profiler-settings/configure-performance-test.png
[load-test-queued]: ./media/profiler-settings/load-test-queued.png
[load-test-in-progress]: ./media/profiler-settings/load-test-inprogress.png
[enable-app-insights]: ./media/profiler-settings/enable-app-insights-blade-01.png
[update-site-extension]: ./media/profiler-settings/update-site-extension-01.png
[change-and-save-appinsights]: ./media/profiler-settings/change-and-save-appinsights-01.png
[app-settings-for-profiler]: ./media/profiler-settings/appsettings-for-profiler-01.png
[check-for-extension-update]: ./media/profiler-settings/check-extension-update-01.png
[profiler-timeout]: ./media/profiler-settings/profiler-timeout.png
