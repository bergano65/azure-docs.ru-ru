---
title: Устранение неполадок с резервным копированием файлов Azure.
description: Сведения об устранении неполадок, возникающих при защите файловых ресурсов в Azure.
ms.date: 02/10/2020
ms.topic: troubleshooting
ms.openlocfilehash: 2030620446f414f985f86218b96c6db78ab090a1
ms.sourcegitcommit: e2b36c60a53904ecf3b99b3f1d36be00fbde24fb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/24/2020
ms.locfileid: "88763683"
---
# <a name="troubleshoot-problems-while-backing-up-azure-file-shares"></a>Устранение неполадок при резервном копировании файловых ресурсов Azure

В этой статье содержатся сведения об устранении неполадок, возникающих при настройке резервного копирования или восстановлении файловых ресурсов Azure с помощью службы Azure Backup.

## <a name="common-configuration-issues"></a>Распространенные проблемы конфигурации

### <a name="could-not-find-my-storage-account-to-configure-backup-for-the-azure-file-share"></a>Не удалось найти учетную запись хранения для настройки резервного копирования для файлового ресурса Azure.

- Подождите, пока процесс обнаружения завершится.
- Убедитесь, что любая общая папка в учетной записи хранения уже защищена другим хранилищем служб восстановления.

  >[!NOTE]
  >Все файловые ресурсы в учетной записи хранения могут быть защищены только одним хранилищем Служб восстановления. С помощью [этого скрипта](scripts/backup-powershell-script-find-recovery-services-vault.md) можно найти хранилище служб восстановления, в котором зарегистрирована ваша учетная запись хранения.

- Убедитесь, что общая папка отсутствует в неподдерживаемых учетных записях хранения. Для поиска поддерживаемых учетных записей хранения можно обратиться к [матрице поддержки резервного копирования файловых ресурсов Azure](azure-file-share-support-matrix.md) .
- Убедитесь, что общая длина имени учетной записи хранения и имени группы ресурсов не превышает 84 символов в случае использования новых учетных записей хранения и 77 символов в случае использования классических учетных записей хранения.
- Проверьте параметры брандмауэра учетной записи хранения, чтобы убедиться, что включен параметр разрешить доверенным службам Майкрософт доступ к учетной записи хранения.

### <a name="error-in-portal-states-discovery-of-storage-accounts-failed"></a>Ошибка в состояниях портала не удалось обнаружить учетные записи хранения

Если у вас есть Партнерская подписка (с поддержкой CSP), игнорируйте ошибку. Если ваша подписка не поддерживает CSP и ваши учетные записи хранения невозможно обнаружить, обратитесь в службу поддержки.

### <a name="selected-storage-account-validation-or-registration-failed"></a>Сбой при проверке выбранной учетной записи хранения или регистрации

Повторите попытку регистрации. Если проблема не исчезнет, обратитесь в службу поддержки.

### <a name="could-not-list-or-find-file-shares-in-the-selected-storage-account"></a>Не удалось перечислить или найти общие папки в выбранной учетной записи хранения

- Убедитесь, что учетная запись хранения существует в группе ресурсов и не была удалена или перемещена после последней проверки или регистрации в хранилище.
- Убедитесь, что общая папка, которую вы хотите защитить, не была удалена.
- Убедитесь, что учетная запись хранения является поддерживаемой учетной записью хранения для резервного копирования файловых ресурсов. Для поиска поддерживаемых учетных записей хранения можно обратиться к [матрице поддержки резервного копирования файловых ресурсов Azure](azure-file-share-support-matrix.md) .
- Убедитесь, что файловый ресурс уже защищен в том же хранилище служб восстановления.

### <a name="backup-file-share-configuration-or-the-protection-policy-configuration-is-failing"></a>Сбой резервного копирования конфигурации файлового ресурса (или конфигурации политики защиты)

- Повторите настройку, чтобы узнать, не повторяется ли проблема.
- Убедитесь, что общая папка, которую вы хотите защитить, не была удалена.
- Если вы пытаетесь защитить несколько файловых ресурсов одновременно, а некоторые из общих папок завершаются сбоем, попробуйте еще раз настроить резервное копирование для неудачных файловых ресурсов.

### <a name="unable-to-delete-the-recovery-services-vault-after-unprotecting-a-file-share"></a>Не удается удалить хранилище служб восстановления после снятия защиты с общей папки

В портал Azure откройте **Vault**  >  **инфраструктуру резервного копирования**хранилища  >  **учетные записи хранения** и нажмите кнопку **отменить регистрацию** , чтобы удалить учетные записи хранения из хранилища служб восстановления.

>[!NOTE]
>Хранилище служб восстановления можно удалить только после отмены регистрации всех учетных записей хранения, зарегистрированных в хранилище.

## <a name="common-backup-or-restore-errors"></a>Распространенные ошибки резервного копирования или восстановления

>[!NOTE]
>Ознакомьтесь с [этим документом](./backup-rbac-rs-vault.md#minimum-role-requirements-for-the-azure-file-share-backup) , чтобы убедиться, что у вас есть необходимые разрешения для выполнения операций резервного копирования или восстановления.

### <a name="filesharenotfound--operation-failed-as-the-file-share-is-not-found"></a>Филешаренотфаунд-не удалось выполнить операцию, так как общая папка не найдена

Код ошибки: Филешаренотфаунд

Сообщение об ошибке: не удалось выполнить операцию, так как общая папка не найдена

Убедитесь, что общая папка, которую вы пытаетесь защитить, не была удалена.

### <a name="usererrorfileshareendpointunreachable--storage-account-not-found-or-not-supported"></a>Усереррорфилешариндпоинтунреачабле — учетная запись хранения не найдена или не поддерживается.

Код ошибки: Усереррорфилешариндпоинтунреачабле

Сообщение об ошибке: учетная запись хранения не найдена или не поддерживается

- Убедитесь, что учетная запись хранения существует в группе ресурсов и не была удалена или удалена из группы ресурсов после последней проверки.

- Убедитесь, что учетная запись хранения является поддерживаемой учетной записью хранения для резервного копирования файловых ресурсов.

### <a name="afsmaxsnapshotreached--you-have-reached-the-max-limit-of-snapshots-for-this-file-share-you-will-be-able-to-take-more-once-the-older-ones-expire"></a>Афсмаксснапшотреачед — достигнуто максимальное число моментальных снимков для этой общей папки; Вы сможете использовать больше времени после истечения срока действия старых

Код ошибки: Афсмаксснапшотреачед

Сообщение об ошибке: достигнуто максимальное число моментальных снимков для этой общей папки; после истечения срока действия старых версий вы сможете использовать больше.

- Эта ошибка может возникать при создании нескольких резервных копий по запросу для общей папки.
- Существует ограничение в 200 моментальных снимков на общую папку, включая те, которые были Azure Backup. Старые запланированные резервные копии (или моментальные снимки) очищаются автоматически. Если достигнут максимальный предел, необходимо удалить резервные копии по запросу (или моментальные снимки).

Удалите резервные копии по запросу (моментальные снимки файловых ресурсов Azure) с портала решения "Файлы Azure".

>[!NOTE]
> Если удалить моментальные снимки, созданные службой Azure Backup, точки восстановления будут утеряны.

### <a name="usererrorstorageaccountnotfound--operation-failed-as-the-specified-storage-account-does-not-exist-anymore"></a>Усереррорсторажеаккаунтнотфаунд-не удалось выполнить операцию, так как указанная учетная запись хранения больше не существует

Код ошибки: Усереррорсторажеаккаунтнотфаунд

Сообщение об ошибке: не удалось выполнить операцию, так как указанная учетная запись хранения больше не существует.

Убедитесь, что учетная запись хранения еще существует и не удалена.

### <a name="usererrordtsstorageaccountnotfound--the-storage-account-details-provided-are-incorrect"></a>Усереррордтссторажеаккаунтнотфаунд-указаны неправильные сведения об учетной записи хранения

Код ошибки: Усереррордтссторажеаккаунтнотфаунд

Сообщение об ошибке: указаны неправильные сведения об учетной записи хранения.

Убедитесь, что учетная запись хранения еще существует и не удалена.

### <a name="usererrorresourcegroupnotfound--resource-group-doesnt-exist"></a>Усереррорресаурцеграупнотфаунд — группа ресурсов не существует

Код ошибки: Усереррорресаурцеграупнотфаунд

Сообщение об ошибке: Группа ресурсов не существует

Выберите существующую группу ресурсов или создайте другую.

### <a name="parallelsnapshotrequest--a-backup-job-is-already-in-progress-for-this-file-share"></a>Параллелснапшотрекуест — задание резервного копирования уже выполняется для этой общей папки

Код ошибки: Параллелснапшотрекуест

Сообщение об ошибке: задание резервного копирования уже выполняется для этого файлового ресурса.

- Резервное копирование файловых ресурсов не поддерживает параллельные запросы моментальных снимков к одной и той же общей папке.

- Дождитесь завершения существующего задания резервного копирования и повторите попытку. Если вы не можете найти задание резервного копирования в хранилище служб восстановления, проверьте другие хранилища служб восстановления в той же подписке.

### <a name="filesharebackupfailedwithazurerprequestthrottling-filesharerestorefailedwithazurerprequestthrottling--file-share-backup-or-restore-failed-due-to-storage-service-throttling-this-may-be-because-the-storage-service-is-busy-processing-other-requests-for-the-given-storage-account"></a>Филешаребаккупфаиледвисазурерпрекуестсроттлинг/Филешарересторефаиледвисазурерпрекуестсроттлинг-не удалось выполнить резервное копирование или восстановление файлового ресурса из-за регулирования службы хранилища. Это может быть вызвано тем, что служба хранилища занята обработкой других запросов для указанной учетной записи хранения.

Код ошибки: Филешаребаккупфаиледвисазурерпрекуестсроттлинг/Филешарересторефаиледвисазурерпрекуестсроттлинг

Сообщение об ошибке: не удалось выполнить резервное копирование или восстановление общей папки из-за регулирования службы хранилища. Это может быть связано с тем, что служба хранения занята обработкой других запросов для данной учетной записи хранения.

Попробуйте выполнить операцию резервного копирования и восстановления позже.

### <a name="targetfilesharenotfound--target-file-share-not-found"></a>Таржетфилешаренотфаунд — не найдена целевая общая папка

Код ошибки: Таржетфилешаренотфаунд

Сообщение об ошибке: не найдена целевая файловая папка.

- Убедитесь, что выбранная учетная запись хранения существует, а Целевая общая папка не удалена.

- Убедитесь, что учетная запись хранения является поддерживаемой учетной записью хранения для резервного копирования файловых ресурсов.

### <a name="usererrorstorageaccountislocked--backup-or-restore-jobs-failed-due-to-storage-account-being-in-locked-state"></a>Усереррорсторажеаккаунтислоккед. не удалось выполнить задания резервного копирования или восстановления, так как учетная запись хранения находится в заблокированном состоянии

Код ошибки: Усереррорсторажеаккаунтислоккед

Сообщение об ошибке: задания резервного копирования или восстановления завершились сбоем, так как учетная запись хранения находится в заблокированном состоянии.

Удалите блокировку учетной записи хранения или используйте команду **удалить блокировку** вместо **блокировки чтения** и повторите операцию резервного копирования или восстановления.

### <a name="datatransferservicecoflimitreached--recovery-failed-because-number-of-failed-files-are-more-than-the-threshold"></a>Дататрансферсервицекофлимитреачед — сбой восстановления, так как количество файлов с ошибками превышает пороговое значение

Код ошибки: Дататрансферсервицекофлимитреачед

Сообщение об ошибке: сбой восстановления, так как число файлов с ошибками превышает пороговое значение.

- Причины сбоя восстановления перечислены в файле (путь указан в сведениях о задании). Устраните ошибки и повторите операцию восстановления только для файлов с ошибками.

- Распространенные причины сбоев при восстановлении файлов:

  - файлы, которые не удалось использовать в данный момент
  - каталог с тем же именем, что и у неисправного файла, существует в родительском каталоге.

### <a name="datatransferserviceallfilesfailedtorecover--recovery-failed-as-no-file-could-be-recovered"></a>Дататрансферсервицеаллфилесфаиледторековер — сбой восстановления, так как не удалось восстановить файл

Код ошибки: Дататрансферсервицеаллфилесфаиледторековер

Сообщение об ошибке: восстановление завершилось сбоем, так как не удалось восстановить файл.

- Причины сбоя восстановления перечислены в файле (путь указан в сведениях о задании). Перечитайте информацию об ошибках и повторите операцию восстановления только для файлов с ошибками.

- Распространенные причины сбоев при восстановлении файлов:

  - файлы, которые не удалось использовать в данный момент
  - каталог с тем же именем, что и у неисправного файла, существует в родительском каталоге.

### <a name="usererrordtssourceurinotvalid---restore-fails-because-one-of-the-files-in-the-source-does-not-exist"></a>Усереррордтссаурцеуринотвалид — сбой восстановления, так как один из файлов в источнике не существует

Код ошибки: Дататрансферсервицесаурцеуринотвалид

Сообщение об ошибке: сбой восстановления, так как один из файлов в источнике не существует.

- Выбранные элементы отсутствуют в данных точки восстановления. Чтобы восстановить файлы, укажите правильный список файлов.
- Моментальный снимок файлового ресурса, соответствующий точке восстановления, удален вручную. Выберите другую точку восстановления и повторите операцию.

### <a name="usererrordtsdestlocked--a-recovery-job-is-in-process-to-the-same-destination"></a>Усереррордтсдестлоккед — задание восстановления обрабатывается в том же месте назначения

Код ошибки: Усереррордтсдестлоккед

Сообщение об ошибке: задание восстановления выполняется в том же месте назначения.

- Резервное копирование файловых ресурсов не поддерживает параллельное восстановление для одной и той же целевой общей папки.

- Подождите, пока процесс восстановления завершится, и повторите попытку. Если вы не можете найти задание восстановления в хранилище служб восстановления, проверьте другие хранилища служб восстановления в той же подписке.

### <a name="usererrortargetfilesharefull--restore-operation-failed-as-target-file-share-is-full"></a>Усереррортаржетфилешарефулл: сбой операции восстановления, так как Целевая общая папка заполнена

Код ошибки: Усереррортаржетфилешарефулл

Сообщение об ошибке: операция восстановления завершилась сбоем, так как целевая файловая папка заполнена.

Увеличьте квоту на размер целевого файлового ресурса, чтобы разместить данные восстановления, и повторите операцию восстановления.

### <a name="usererrortargetfilesharequotanotsufficient--target-file-share-does-not-have-sufficient-storage-size-quota-for-restore"></a>УсереррортаржетфилешарекуотанотсуффиЦиент — у целевой общей папки недостаточно квоты на размер хранилища для восстановления

Код ошибки: УсереррортаржетфилешарекуотанотсуффиЦиент

Сообщение об ошибке: Целевая общая папка не имеет достаточной квоты на размер хранилища для восстановления

Увеличьте квоту на размер целевого файлового ресурса для размещения данных восстановления и повторите операцию.

### <a name="file-sync-prerestorefailed--restore-operation-failed-as-an-error-occurred-while-performing-pre-restore-operations-on-file-sync-service-resources-associated-with-the-target-file-share"></a>Не удалось выполнить операцию Синхронизация файлов Прересторефаилед-Restore, так как при выполнении операций предварительного восстановления для Синхронизация файлов ресурсов службы, связанных с целевой общей папкой, произошла ошибка.

Код ошибки: Синхронизация файлов Прересторефаилед

Сообщение об ошибке: не удалось выполнить операцию восстановления, так как произошла ошибка при выполнении операций предварительного восстановления для Синхронизация файловных ресурсов службы, связанных с целевой общей папкой.

Попробуйте восстановить данные позже. Если проблема будет повторяться, обратитесь в службу поддержки Майкрософт.

### <a name="azurefilesyncchangedetectioninprogress--azure-file-sync-service-change-detection-is-in-progress-for-the-target-file-share-the-change-detection-was-triggered-by-a-previous-restore-to-the-target-file-share"></a>Азурефилесинкчанжедетектионинпрогресс-Синхронизация файлов Azure выполняется обнаружение изменений службы для целевой общей папки. Обнаружение изменений было активировано предыдущим восстановлением в целевом общем файловом ресурсе

Код ошибки: Азурефилесинкчанжедетектионинпрогресс

Сообщение об ошибке: для целевого файлового ресурса выполняется обнаружение изменений службы Синхронизация файлов Azure. Обнаружение изменений было активировано предыдущим восстановлением в целевом общем файловом ресурсе.

Используйте другую целевую общую папку. Кроме того, перед повторной попыткой восстановления можно дождаться завершения обнаружения изменений службы Синхронизация файлов Azure для целевого файлового ресурса.

### <a name="usererrorafsrecoverysomefilesnotrestored--one-or-more-files-could-not-be-recovered-successfully-for-more-information-check-the-failed-file-list-in-the-path-given-above"></a>Усереррорафсрековерисомефилеснотресторед — не удалось восстановить один или несколько файлов. Дополнительные сведения см. в списке файлов с ошибками в указанном выше пути.

Код ошибки: Усереррорафсрековерисомефилеснотресторед

Сообщение об ошибке: не удалось восстановить один или несколько файлов. Дополнительные сведения см. в списке файлов по указанному выше пути.

- Причины сбоя восстановления перечислены в файле (путь указан в сведениях о задании). Устраните причины и повторите операцию восстановления только для файлов с ошибками.
- Распространенные причины сбоев при восстановлении файлов:

  - файлы, которые не удалось использовать в данный момент
  - каталог с тем же именем, что и у неисправного файла, существует в родительском каталоге.

### <a name="usererrorafssourcesnapshotnotfound--azure-file-share-snapshot-corresponding-to-recovery-point-cannot-be-found"></a>Усереррорафссаурцеснапшотнотфаунд — моментальный снимок файлового ресурса Azure, соответствующий точке восстановления, не найден

Код ошибки: Усереррорафссаурцеснапшотнотфаунд

Сообщение об ошибке: не удается найти моментальный снимок файлового ресурса Azure, соответствующий точке восстановления

- Убедитесь, что моментальный снимок файлового ресурса, соответствующий точке восстановления, которую вы пытаетесь использовать для восстановления, все еще существует.

  >[!NOTE]
  >При удалении моментального снимка файлового ресурса, созданного Azure Backup, соответствующие точки восстановления становятся непригодными для использования. Рекомендуется не удалять моментальные снимки, чтобы гарантировать Гарантированное восстановление.

- Попробуйте выбрать другую точку восстановления для восстановления данных.

### <a name="usererroranotherrestoreinprogressonsametarget--another-restore-job-is-in-progress-on-the-same-target-file-share"></a>Усереррораносеррестореинпрогрессонсаметаржет — выполняется другое задание восстановления в той же целевой общей папке

Код ошибки: Усереррораносеррестореинпрогрессонсаметаржет

Сообщение об ошибке: выполняется другое задание восстановления в той же целевой общей папке

Используйте другую целевую общую папку. Кроме того, можно отменить или дождаться завершения другого восстановления.

## <a name="common-modify-policy-errors"></a>Распространенные ошибки политики изменения

### <a name="bmsusererrorconflictingprotectionoperation--another-configure-protection-operation-is-in-progress-for-this-item"></a>Бмсусереррорконфликтингпротектионоператион — выполняется другая операция настройки защиты для этого элемента

Код ошибки: Бмсусереррорконфликтингпротектионоператион

Сообщение об ошибке: выполняется другая операция настройки защиты для этого элемента.

Дождитесь завершения предыдущей операции изменения политики и повторите попытку позже.

### <a name="bmsusererrorobjectlocked--another-operation-is-in-progress-on-the-selected-item"></a>Бмсусерерроробжектлоккед — в выбранном элементе выполняется другая операция

Код ошибки: Бмсусерерроробжектлоккед

Сообщение об ошибке: в выбранном элементе выполняется другая операция.

Дождитесь завершения другой выполняемой операции и повторите попытку позже.

## <a name="common-soft-delete-related-errors"></a>Распространенные ошибки, связанные с обратимым удалением

### <a name="usererrorrestoreafsinsoftdeletestate--this-restore-point-is-not-available-as-the-snapshot-associated-with-this-point-is-in-a-file-share-that-is-in-soft-deleted-state"></a>Усерерроррестореафсинсофтделетестате — эта точка восстановления недоступна, так как моментальный снимок, связанный с этой точкой, находится в общей папке, которая находится в состоянии обратимого удаления.

Код ошибки: Усерерроррестореафсинсофтделетестате

Сообщение об ошибке: Эта точка восстановления недоступна, так как моментальный снимок, связанный с этой точкой, находится в общем файловом ресурсе, который находится в состоянии обратимого удаления.

Невозможно выполнить операцию восстановления, если файловый ресурс находится в состоянии обратимого удаления. Удалите файловый ресурс с портала файлов или используйте [сценарий отмены удаления](scripts/backup-powershell-script-undelete-file-share.md) , а затем попробуйте выполнить восстановление.

### <a name="usererrorrestoreafsindeletestate--listed-restore-points-are-not-available-as-the-associated-file-share-containing-the-restore-point-snapshots-has-been-deleted-permanently"></a>Усерерроррестореафсинделетестате. перечисленные точки восстановления недоступны, так как связанная общая папка, содержащая моментальные снимки точек восстановления, была удалена без возможности восстановления

Код ошибки: Усерерроррестореафсинделетестате

Сообщение об ошибке. указанные точки восстановления недоступны, так как связанная общая папка, содержащая моментальные снимки точек восстановления, была удалена без возможности восстановления.

Проверьте, удален ли архивный файловый ресурс. Если он был в обратимо удаленном состоянии, проверьте, не не был ли восстановлен срок хранения обратимого удаления. В любом из этих случаев все моментальные снимки будут безвозвратно утрачены и их невозможно будет восстановить.

>[!NOTE]
> Рекомендуется не удалять резервную копию файлового ресурса, а если она находится в обратимо удаленном состоянии, отменить удаление до окончания срока хранения обратимого удаления, чтобы избежать потери всех точек восстановления.

### <a name="usererrorbackupafsinsoftdeletestate---backup-failed-as-the-azure-file-share-is-in-soft-deleted-state"></a>Усереррорбаккупафсинсофтделетестате-не удалось выполнить резервное копирование, так как файловый ресурс Azure находится в обратимо удаленном состоянии

Код ошибки: Усереррорбаккупафсинсофтделетестате

Сообщение об ошибке: не удалось выполнить архивацию, так как файловый ресурс Azure находится в обратимо удаленном состоянии

Удалите файловый ресурс с **портала файлов** или с помощью [скрипта отмены удаления](scripts/backup-powershell-script-undelete-file-share.md) , чтобы продолжить резервное копирование и предотвратить постоянное удаление данных.

### <a name="usererrorbackupafsindeletestate--backup-failed-as-the-associated-azure-file-share-is-permanently-deleted"></a>Усереррорбаккупафсинделетестате-не удалось выполнить резервное копирование, так как связанная общая папка Azure удалена без возможности восстановления

Код ошибки: Усереррорбаккупафсинделетестате

Сообщение об ошибке: не удалось выполнить архивацию, так как связанная общая папка Azure удалена без возможности восстановления

Проверьте, не удаляется ли резервная копия файлового ресурса без возможности восстановления. Если да, то следует прерывать резервное копирование для общей папки во избежание неповторяемых сбоев резервного копирования. Дополнительные сведения о том, как отключить защиту, см. в разделе [Отключение защиты для файлового ресурса Azure](./manage-afs-backup.md#stop-protection-on-a-file-share) .

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о резервном копировании файловых ресурсов Azure см. в следующих статьях:

- [Резервное копирование файловых ресурсов Azure](backup-afs.md)
- [Часто задаваемые вопросы о резервном копировании файловых ресурсов Azure](backup-azure-files-faq.md)
