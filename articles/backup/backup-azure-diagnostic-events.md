---
title: Использование параметров диагностики для хранилищ служб восстановления
description: Статья, в которой описывается использование старых и новых событий диагностики для Azure Backup
ms.topic: conceptual
ms.date: 10/30/2019
ms.openlocfilehash: 875adb82aeeb56b378a84ca01e716c7189abc64f
ms.sourcegitcommit: 653e9f61b24940561061bd65b2486e232e41ead4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2019
ms.locfileid: "74281107"
---
# <a name="using-diagnostics-settings-for-recovery-services-vaults"></a>Использование параметров диагностики для хранилищ служб восстановления

Azure Backup отправляет диагностические события, которые можно собирать и использовать в целях анализа, оповещения и создания отчетов. 

Вы можете настроить параметры диагностики для хранилища служб восстановления с помощью портал Azure, перейдя в хранилище и выбрав пункт меню " **параметры диагностики** ". Если щелкнуть **+ Добавить параметр диагностики** , вы сможете отправить одно или несколько событий диагностики в учетную запись хранения, концентратор событий или рабочую область log Analytics (La).

![Колонка "параметры диагностики"](./media/backup-azure-diagnostics-events/diagnostics-settings-blade.png)

## <a name="diagnostics-events-available-for-azure-backup-users"></a>События диагностики, доступные для пользователей Azure Backup

Azure Backup предоставляет следующие диагностические события, каждый из которых предоставляет подробные данные о конкретном наборе артефактов, относящихся к резервному копированию:
* кореазуребаккуп
* аддоназуребаккупалертс
* аддоназуребаккуппротектединстанце
* аддоназуребаккупжобс
* аддоназуребаккупполици
* аддоназуребаккупстораже 

[Модель данных для событий диагностики Azure Backup](https://aka.ms/diagnosticsdatamodel)

Данные для этих событий можно отправлять в учетную запись хранения, в LA рабочую область или в концентратор событий. При отправке этих данных в LA рабочую область необходимо выбрать переключатель для **конкретного ресурса** на экране **настройки диагностики** (Дополнительные сведения см. в разделах ниже).

## <a name="using-diagnostics-settings-with-log-analytics-la"></a>Использование параметров диагностики с Log Analytics (ла)

Выполнив согласование с планом Log Analytics Azure, Azure Backup теперь позволяет отсылать данные диагностики хранилища в выделенные LA таблицы для резервного копирования. Они называются [таблицами, связанными с ресурсами](https://docs.microsoft.com/azure/azure-monitor/platform/resource-logs-collect-workspace#resource-specific).

Чтобы отправить данные диагностики хранилища в LA:
1.  Перейдите в хранилище и щелкните **параметры диагностики**. Щелкните **+ Добавить параметр диагностики**.
2.  Присвойте имя параметру диагностики.
3.  Установите флажок **отправить на log Analytics** и выберите log Analytics рабочую область.
4.  Выберите **ресурс определенные** в переключателе и проверьте следующие шесть событий — **кореазуребаккуп**, **аддоназуребаккупалертс**, **аддоназуребаккуппротектединстанце**, **аддоназуребаккупжобс**, **AddonAzureBackupPolicy**и **AddonAzureBackupStorage**.
5.  Щелкните **Save**(Сохранить).

![Режим, зависящий от ресурса](./media/backup-azure-diagnostics-events/resource-specific-blade.png)

После передачи данных в LA рабочую область выделенные таблицы для каждого из этих событий создаются в рабочей области. Можно выполнить запрос к любой из этих таблиц напрямую, а также при необходимости выполнять объединения или объединения между этими таблицами.

> [!IMPORTANT]
> Перечисленные выше шесть событий, а именно, Кореазуребаккуп, Аддоназуребаккупалертс, Аддоназуребаккуппротектединстанце, Аддоназуребаккупжобс, AddonAzureBackupPolicy и AddonAzureBackupStorage, поддерживаются **только** в режиме, характерном для ресурса. **Обратите внимание, что если вы попытаетесь отправить данные для этих шести событий в система диагностики Azure режиме, данные не будут передаваться в LA рабочую область.**

## <a name="legacy-event"></a>Устаревшее событие

Обычно все данные диагностики, связанные с резервным копированием для хранилища, содержатся в одном событии с именем "установите azurebackupreport". Шесть событий, описанных выше, по сути являются декомпозицией всех данных, содержащихся в установите azurebackupreport. 

В настоящее время мы продолжаем поддерживать событие установите azurebackupreport для обратной совместимости, в случаях, когда у пользователей есть пользовательские запросы к этому событию, например пользовательские оповещения журнала, пользовательские визуализации и т. д. Однако мы рекомендуем выбирать новые события для всех новых параметров диагностики в хранилище, так как это упрощает работу с данными в запросах журналов, обеспечивает лучшую возможность обнаружения схем и их структуры, повышает производительность в обоих приема. задержка и время выполнения запроса. В конце концов, поддержка использования режима система диагностики Azure будет понижена, и поэтому выбор новых событий может помочь избежать сложных миграций.

Вы можете создать отдельные параметры диагностики для установите azurebackupreport и шесть новых событий, пока не будут перенесены все пользовательские запросы на использование данных из новых таблиц. На рисунке ниже показан пример хранилища с двумя параметрами диагностики. Первый параметр с именем **Setting1** отправляет данные о событии установите AZUREBACKUPREPORT в La рабочую область в режиме AzureDiagnostics. Второй параметр с именем **Setting2** отправляет данные из шести новых событий Azure Backup в La рабочую область в режиме конкретного ресурса.

![Два параметра](./media/backup-azure-diagnostics-events/two-settings-example.png)

> [!IMPORTANT]
> Событие установите azurebackupreport поддерживается **только** в режиме система диагностики Azure. **Обратите внимание, что при попытке отправить данные для этого события в режиме, определенном для ресурса, данные не будут передаваться в LA рабочую область.**

> [!NOTE]
> Переключатель для система диагностики Azure или ресурса отображается только в том случае, если пользователь проверяет **поправку на log Analytics**. Чтобы отправить данные в учетную запись хранения или концентратор событий, пользователь может просто выбрать требуемое назначение и проверить любое из требуемых событий без дополнительных входов. Опять же, рекомендуется не выбирать устаревшие установите azurebackupreport событий, пересылаемые вперед.

## <a name="users-sending-azure-site-recovery-events-to-log-analytics-la"></a>Пользователи, отправляющие события Azure Site Recovery Log Analytics (ла)

События Azure Backup и Azure Site Recovery отправляются из одного хранилища служб восстановления. Поскольку Azure Site Recovery в настоящее время не подключены к таблицам, связанным с ресурсами, пользователи, желающие отправить Azure Site Recovery события в LA, направляются на использование **только** режима система диагностики Azure (см. изображение ниже). **Выбор режима для конкретного ресурса для Azure Site Recovery событий предотвратит отправку необходимых данных в La рабочую область**.

![События Site Recovery](./media/backup-azure-diagnostics-events/site-recovery-settings.png)

Для суммирования описанных выше нюансов:

* Если у вас уже есть LA диагностика с система диагностики Azure и вы записали пользовательские запросы поверх него, не заполняйте **этот параметр,** пока не перенесите запросы на использование данных из новых событий.
* Если вы также хотите подключить новые таблицы (как рекомендуется), создайте **Новый** параметр диагностики, выберите **ресурс** и выберите шесть новых событий, как указано выше.
* Если в данный момент вы отправляете Azure Site Recovery события в LA, не выбирайте режим для этих событий. в противном случае данные для этих **событий не будут** передаваться в La рабочую область. Вместо этого создайте **дополнительный параметр диагностики**, выберите **система диагностики Azure**и выберите соответствующие события Azure Site Recovery.

На рисунке ниже показан пример пользователя с тремя параметрами диагностики для хранилища. Первый параметр с именем **Setting1** отправляет данные из события установите AZUREBACKUPREPORT в La Workspace в режиме AzureDiagnostics. Второй параметр с именем **Setting2** отправляет данные из шести новых событий Azure Backup в La рабочую область в режиме конкретного ресурса. Третий параметр с именем **Setting3**отправляет данные из событий Azure Site Recovery в La рабочую область в режиме система диагностики Azure.

![Три параметра](./media/backup-azure-diagnostics-events/three-settings-example.png)

## <a name="next-steps"></a>Дополнительная информация

[Изучение модели данных Log Analytics для событий диагностики](https://aka.ms/diagnosticsdatamodel)
