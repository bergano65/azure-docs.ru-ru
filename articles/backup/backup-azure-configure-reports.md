---
title: Настройка отчетов для службы Azure Backup
description: Настройка отчетов Power BI для службы Azure Backup с помощью хранилища Служб восстановления.
services: backup
author: adigan
manager: shivamg
ms.service: backup
ms.topic: conceptual
ms.date: 01/30/2019
ms.author: adigan
ms.openlocfilehash: e3004a44958d75d18d608a2fbed7ccc44a00dc93
ms.sourcegitcommit: 62d3a040280e83946d1a9548f352da83ef852085
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2019
ms.locfileid: "59278831"
---
# <a name="configure-azure-backup-reports"></a>Настройка отчетов службы архивации Azure
В этой статье описаны этапы, позволяющие настроить отчеты для Azure Backup с помощью хранилища Служб восстановления. Из этой статьи вы также вы узнаете, как использовать эти отчеты в Power BI. Выполнив описанные здесь действия, вы сможете сразу перейти в Power BI, чтобы просмотреть, настроить и создать отчеты.

> [!IMPORTANT]
> С 1 ноября 2018 года у некоторых клиентов могут возникнуть проблемы при загрузке данных в Power BI через приложение Azure Backup. Возникает ошибка с текстом "В конце входного JSON-файла были обнаружены лишние символы. Исключение создано интерфейсом IDataReader."
Такая проблема связана с изменением формата загрузки данных в учетную запись хранения.
Получите последнюю версию приложения (версия 1.8), чтобы избежать этой проблемы.
>
>

## <a name="supported-scenarios"></a>Поддерживаемые сценарии использования.
- Отчеты службы Azure Backup поддерживаются для резервного копирования виртуальных машин Azure, файлов или папок в облако с помощью агента служб восстановления Microsoft Azure.
- Отчеты для Базы данных SQL Azure, Общих папок Azure, Data Protection Manager и сервера Azure Backup пока не поддерживаются.
- Отчеты можно просматривать по всем хранилищам и подпискам, если настроить одну учетную запись хранения для всех хранилищ. Выбранная учетная запись хранения должна быть создана в том же регионе, что и хранилище Служб восстановления.
- В Power BI частота запланированного обновления для отчетов составляет 24 часа. Также можно выполнить нерегламентированный обновление отчетов в Power BI. В этом случае для создания отчетов используются данные, которые присутствуют в клиентской учетной записи хранения на момент обновления.

## <a name="prerequisites"></a>Необходимые компоненты
- Создайте [учетную запись хранения Azure](../storage/common/storage-quickstart-create-account.md), чтобы настроить ее для отчетов. Она будет использоваться для хранения данных для отчетов.
- [Создайте учетную запись Power BI](https://powerbi.microsoft.com/landing/signin/) для просмотра, настройки и создания собственных отчетов с помощью портала Power BI.
- Зарегистрируйте поставщик ресурсов **Microsoft.insights**, если он еще не зарегистрирован. Используйте подписки для учетной записи хранения и хранилище Служб восстановления, чтобы данные отчетов передавались в учетную запись хранения. Для этого перейдите на портал Azure, выберите **Подписки** > **Поставщики ресурсов** и установите флажок для нужного поставщика, чтобы зарегистрировать его.

## <a name="configure-storage-account-for-reports"></a>Настройка учетной записи хранения для отчетов
Чтобы настроить учетную запись хранения для хранилища Служб восстановления с помощью портала Azure, выполните описанные ниже действия. Эта настройка выполняется только один раз. Настроив учетную запись хранения, вы сможете сразу перейти в Power BI, чтобы просмотреть, настроить и создать отчеты.

1. Если вы уже открыли хранилище Служб восстановления, перейдите к следующему шагу. В противном случае откройте портал Azure и выберите **Все службы**.

   * В списке ресурсов введите **Службы восстановления**.
   * Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Когда вы увидите пункт **Хранилища служб восстановления**, щелкните его.
   * После этого отобразится список хранилищ служб восстановления, в котором нужно выбрать хранилище.

     Затем откроется панель мониторинга выбранного хранилища.
2. В списке элементов, которые отображаются в разделе **Мониторинг и отчеты** под хранилищем, щелкните **Отчеты службы архивации**, чтобы настроить для отчетов эту учетную запись хранения.

      ![Шаг 2. Выбор пункта меню Backup Reports (Отчеты резервного копирования)](./media/backup-azure-configure-reports/backup-reports-settings.PNG)
3. В колонке **Отчеты службы архивации** выберите ссылку **Параметры диагностики**. Откроется окно **Параметры диагностики**, в котором можно отправить данные в клиентскую учетную запись хранения.

      ![Включение диагностики, шаг 3](./media/backup-azure-configure-reports/backup-azure-configure-reports.png)
4. Щелкните **Включить диагностику**, чтобы открыть окно настройки учетной записи хранения.

      ![Включение диагностики, шаг 4](./media/backup-azure-configure-reports/enable-diagnostics.png)
5. В поле **Имя** введите имя параметра. Установите флажок **Архивировать в учетную запись хранения**, чтобы данные отчетов начали поступать в учетную запись хранения.

      ![Включение диагностики, шаг 5](./media/backup-azure-configure-reports/select-setting-name.png)
6. Щелкните **Учетная запись хранения**, выберите из списка нужную подписку и учетную запись для хранения данных отчетов, а затем щелкните **ОК**.

      ![Шаг 6. Выбор учетной записи хранения](./media/backup-azure-configure-reports/select-subscription-sa.png)
7. В разделе **Журнал** установите флажок **AzureBackupReport**. Переместите ползунок, чтобы выбрать период хранения для этих данных отчетов. Данные будут храниться в учетной записи в течение периода, выбранного с помощью этого ползунка.

      ![Сохранение учетной записи хранения, шаг 7](./media/backup-azure-configure-reports/save-diagnostic-settings.png)
8. Просмотрите все изменения и щелкните **Сохранить**. Это действие сохраняет все изменения, и теперь учетная запись хранения настроена для хранения данных отчетов.

9. В таблице **Параметры диагностики** теперь отображаются новые параметры хранилища. Если вы их не видите, обновите таблицу.

      ![Просмотр параметра диагностики, шаг 9](./media/backup-azure-configure-reports/diagnostic-setting-row.png)

> [!NOTE]
> Когда вы настроите отчеты и сохраните учетную запись хранения, *подождите 24 часа*, пока завершится начальная отправка данных. Только после этого импортируйте приложение Azure Backup в Power BI. Дополнительные сведения см. в разделе [Часто задаваемые вопросы](#frequently-asked-questions).
>
>

## <a name="view-reports-in-power-bi"></a>Просмотр отчетов в Power BI
После настройки учетной записи хранения для отчетов с помощью хранилища Служб восстановления данные отчетов начнут поступать примерно через 24 часа. Через 24 часа после настройки учетной записи хранения выполните следующие действия, чтобы просмотреть отчеты в Power BI.
Если вы хотите настроить отчет и предоставить его в совместный доступ, создайте рабочую область и выполните следующие действия

1. Войдите в [Power BI](https://powerbi.microsoft.com/landing/signin/).
2. Выберите **Получение данных**. Для параметра **Другие способы создания своего содержимого** выберите значение **Пакеты содержимого служб**. Выполните действия, указанные в статье [Подключение к используемым службам с помощью Power BI](https://powerbi.microsoft.com/documentation/powerbi-content-packs-services/).

3. На панели **Поиск** введите **Azure Backup** и выберите действие **Получить сейчас**.

      ![Получение пакета содержимого](./media/backup-azure-configure-reports/content-pack-get.png)
4. Введите имя учетной записи хранения, которая была настроена на шаге 5, и щелкните **Далее**.

    ![Введите имя учетной записи хранения](./media/backup-azure-configure-reports/content-pack-storage-account-name.png)    
5. Укажите метод проверки подлинности "Ключ" и введите ключ для этой учетной записи хранения. Чтобы [просмотреть или скопировать ключи учетных записей хранения](../storage/common/storage-account-manage.md#access-keys), перейдите в свою учетную запись хранения на портале Azure.

     ![Ввод учетной записи хранения](./media/backup-azure-configure-reports/content-pack-storage-account-key.png) <br/>

6. Выберите **Войти**. После входа в систему появится уведомление об импорте данных.

    ![Импорт пакета содержимого](./media/backup-azure-configure-reports/content-pack-importing-data.png) <br/>

    Когда импорт завершится, вы увидите уведомление **об успешном завершении**. Если в учетной записи хранения накопилось много данных, импорт пакета содержимого может занять немного больше времени.

    ![Успешный импорт пакета содержимого](./media/backup-azure-configure-reports/content-pack-import-success.png) <br/>

7. После успешного импорта данных пакет содержимого **Azure Backup** появится в колонке **Приложения** в области навигации. Теперь списки в разделах **Панели мониторинга**, **Отчеты**и **Наборы данных** содержат службу Azure Backup.

8. В разделе **Панели мониторинга** выберите **Azure Backup**, чтобы просмотреть закрепленные ключевые отчеты.

      ![Панель мониторинга службы Azure Backup](./media/backup-azure-configure-reports/azure-backup-dashboard.png) <br/>
9. Чтобы просмотреть полный набор отчетов, выберите любой отчет на панели мониторинга.

      ![Работоспособность задания службы Azure Backup](./media/backup-azure-configure-reports/azure-backup-job-health.png) <br/>
10. Щелкните любую вкладку в списке отчетов, чтобы посмотреть отчеты по этой области.

      ![Вкладки с отчетами службы Azure Backup](./media/backup-azure-configure-reports/reports-tab-view.png)


## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

### <a name="how-do-i-check-if-reporting-data-has-started-flowing-into-a-storage-account"></a>Как проверить, поступают ли данные отчетов в учетную запись хранения?
Откройте учетную запись хранения, которую вы здесь настроили, и выберите контейнеры. Если в контейнере есть запись insights-logs-azurebackupreport, это указывает, что данные отчетов начали поступать.

### <a name="what-is-the-frequency-of-data-push-to-a-storage-account-and-the-azure-backup-content-pack-in-power-bi"></a>С какой частотой данные отправляются в учетную запись хранения и в пакет содержимого службы Azure Backup в Power BI?
  Для новых пользователей передача данных в учетную запись хранения займет около 24 часов. Когда первоначальная отправка данных завершится, данные обновляются с частотой, которая указана на следующем изображении.

  * Данные, связанные с **заданиями**, **оповещениями**, **элементами резервного копирования**, **хранилищами**, **защищенными серверами** и **политиками**, передаются в клиентскую учетную запись хранения сразу же по мере добавления в журнал.

  * Данные, связанные с **хранилищем**, отправляются в клиентскую учетную запись хранения каждые 24 часа.

       ![Частота принудительной отправки данных отчетов службы Azure Backup](./media/backup-azure-configure-reports/reports-data-refresh-cycle.png)

  * Power BI имеет [запланированное обновление один раз в день](https://powerbi.microsoft.com/documentation/powerbi-refresh-data/#what-can-be-refreshed). Вы можете вручную обновить данные в Power BI для пакета содержимого.

### <a name="how-long-can-i-retain-reports"></a>Как долго я могу хранить отчеты?
При настройке учетной записи хранения вы можете выбрать период хранения данных отчетов в учетной записи хранения. Выполните шаг 6 из раздела [Настройка учетной записи хранения для отчетов](backup-azure-configure-reports.md#configure-storage-account-for-reports). Кроме того, отчеты можно [анализировать в Excel](https://powerbi.microsoft.com/documentation/powerbi-service-analyze-in-excel/) и сохранять на более длительный период времени, если возникнет такая потребность.

### <a name="will-i-see-all-my-data-in-reports-after-i-configure-the-storage-account"></a>Увижу ли я все свои данные в отчетах после настройки учетной записи хранения?
 Все данные, созданные после настройки учетной записи хранения, будут отправлены в учетную запись хранения и станут доступны в отчетах. Выполняющиеся задания не отражаются в отчетах. Сведения о них будут переданы после их завершения или сбоя.

### <a name="if-i-already-configured-the-storage-account-to-view-reports-can-i-change-the-configuration-to-use-another-storage-account"></a>Если для отчетов уже настроена учетная запись хранения, могу ли я изменить конфигурацию и использовать другую учетную запись хранения?
Да, вы можете изменить конфигурацию, чтобы указать другую учетную запись хранения. Используйте новую учетную запись хранения при подключении к пакету содержимого службы Azure Backup. Кроме того, после настройки новой учетной записи хранения новые данные будут отправляться именно в нее. Но старые данные (собранные до изменения конфигурации) останутся в старой учетной записи хранения.

### <a name="can-i-view-reports-across-vaults-and-subscriptions"></a>Могу ли я ли просмотреть отчеты по нескольким хранилищам и подпискам?
Да, можно настроить одну и ту же учетную запись хранения для всех хранилищ, чтобы просматривать отчеты по нескольким хранилищам. Кроме того, можно настроить ту же учетную запись хранения для хранилищ между подписками. Тогда вы сможете использовать эту учетную запись хранения при подключении к пакету содержимого службы Azure Backup в Power BI для просмотра отчетов. Выбранная учетная запись хранения должна быть создана в том же регионе, что и хранилище Служб восстановления.

## <a name="troubleshooting-errors"></a>Устранение ошибок
| Сведения об ошибке | Разрешение |
| --- | --- |
| После настройки учетной записи хранения для отчетов по резервному копированию параметр **Учетная запись хранения** сохраняет значение **Не настроено**. | Если вы успешно настроили учетную запись хранения, данные отчетов будут поступать нормально, несмотря на эту проблему. Чтобы устранить ее, откройте портал Azure и выберите **Все службы** > **Параметры диагностики** > **Хранилище служб восстановления** > **Настройка параметра**. Удалите настроенный ранее параметр и создайте новый параметр в той же колонке. Но теперь в поле **Имя** выберите **служба**. После этого отобразится настроенная учетная запись хранения. |
|После импорта пакета содержимого Azure Backup в Power BI появляется сообщение об ошибке "404 — контейнер не найден". | Как уже упоминалось выше, необходимо подождать 24 часа после настройки отчетов в хранилище Служб восстановления, чтобы они правильно отобразились в Power BI. Если вы обращаетесь к этим отчетам до того, как пройдут 24 часа, возникает эта ошибка, так как в хранилище еще нет полных данных для отображения правильных отчетов. |

## <a name="next-steps"></a>Дальнейшие действия
После того, как вы настроили учетную запись хранения и импортировали пакет содержимого службы Azure Backup, нужно настроить эти отчеты и применить модель данных отчетов для создания отчетов. Дополнительные сведения см. в следующих руководствах.

* [Использование данных модель отчета об архивации Azure](backup-azure-reports-data-model.md)
* [Фильтр отчетов в Power BI](https://powerbi.microsoft.com/documentation/powerbi-service-about-filters-and-highlighting-in-reports/)
* [Создание отчетов в Power BI](https://powerbi.microsoft.com/documentation/powerbi-service-create-a-new-report/)
