---
title: Резервное копирование SQL Server виртуальной машины из области ВМ
description: Из этой статьи вы узнаете, как выполнять резервное копирование SQL Server баз данных на виртуальных машинах Azure из области ВМ.
ms.topic: conceptual
ms.date: 08/13/2020
ms.openlocfilehash: 3d44c856d264c784d07b8301fa5605affddd7c02
ms.sourcegitcommit: ac7ae29773faaa6b1f7836868565517cd48561b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/25/2020
ms.locfileid: "88827483"
---
# <a name="back-up-a-sql-server-from-the-vm-pane"></a>Резервное копирование SQL Server из области ВМ

В этой статье объясняется, как выполнить резервное копирование SQL Server, выполняемых на виртуальных машинах Azure, с помощью службы [Azure Backup](backup-overview.md) . Резервное копирование SQL Server виртуальных машин можно выполнять двумя способами:

- Виртуальная машина Azure с одним SQL Server: инструкции из этой статьи описывают, как создать резервную копию SQL Server виртуальной машины непосредственно из представления виртуальной машины.
- Несколько SQL Server виртуальных машин Azure. Вы можете настроить хранилище служб восстановления и настроить резервное копирование для нескольких виртуальных машин. Следуйте инструкциям в [этой статье](backup-sql-server-database-azure-vms.md) для этого сценария.

## <a name="before-you-start"></a>Перед началом работы

1. Проверьте свою среду с помощью [матрицы поддержки](sql-support-matrix.md).
2. Ознакомьтесь с [обзором](backup-azure-sql-database.md) Azure Backup для SQL Server виртуальной машины.
3. Убедитесь, что виртуальная машина имеет [сетевое подключение](backup-sql-server-database-azure-vms.md#establish-network-connectivity).

## <a name="configure-backup-on-the-sql-server"></a>Настройка резервного копирования на SQL Server

Вы можете включить резервное копирование на SQL Server виртуальной машине из области **резервного копирования** на виртуальной машине. Этот метод выполняет два действия:

- Регистрирует виртуальную машину SQL со службой Azure Backup, чтобы предоставить ей доступ.
- Автозащита всех SQL Server экземпляров, выполняющихся внутри виртуальной машины. Это означает, что политика резервного копирования применяется ко всем существующим базам данных, а также к базам данных, которые будут добавлены в эти экземпляры в будущем.

1. Выберите баннер в верхней части страницы, чтобы открыть SQL Server представление резервной копии.

    ![SQL Server представление резервной копии](./media/backup-sql-server-vm-from-vm-pane/sql-server-backup-view.png)

    >[!NOTE]
    >Не видите баннер? Баннер отображается только для тех SQL Server виртуальных машин, которые созданы с помощью образов Azure Marketplace. Кроме того, она отображается для виртуальных машин, защищенных с помощью резервного копирования виртуальных машин Azure. Для других образов можно настроить резервное копирование, как описано [здесь](backup-sql-server-database-azure-vms.md).

2. Введите имя хранилища служб восстановления. Хранилище — это логическая сущность для хранения всех резервных копий и управления ими. При создании нового хранилища:

    - Он будет создан в той же подписке и регионе, что и SQL Serverная виртуальная машина, которую вы защищаете.
    - Он будет создан с параметром геоизбыточного хранилища (GRS) для всех резервных копий. Если вы хотите изменить тип избыточности, сделайте это перед защитой виртуальной машины. Дополнительные сведения см. в [этой статье](backup-create-rs-vault.md#set-storage-redundancy).

3. Выберите **политику архивации**. Можно выбрать политику по умолчанию или любые другие существующие политики, созданные в хранилище. Если вы хотите создать новую политику, обратитесь к [этой статье](backup-sql-server-database-azure-vms.md#create-a-backup-policy) , чтобы получить пошаговое руководство.

    ![Выберите политику архивации](./media/backup-sql-server-vm-from-vm-pane/backup-policy.png)

4. Выберите **Включить резервное копирование**. Выполнение операции может занять несколько минут.

    ![Выберите включить резервное копирование](./media/backup-sql-server-vm-from-vm-pane/enable-backup.png)

5. После завершения операции вы увидите **имя хранилища** в баннере.

    ![Имя хранилища отображается в баннере](./media/backup-sql-server-vm-from-vm-pane/vault-name.png)

6. Выберите баннер, чтобы перейти в представление хранилища, где можно просмотреть все зарегистрированные виртуальные машины и их состояние защиты.

    ![Представление хранилища с зарегистрированными виртуальными машинами](./media/backup-sql-server-vm-from-vm-pane/vault-view.png)

7. Для образов, отличных от Marketplace, регистрация может быть успешной, но **Настройка резервного копирования** может быть невозможна, пока для расширения Azure Backup не будет предоставлено разрешение на доступ к SQL Server. В таких случаях столбец **готовность к резервному копированию** читается как **не готовый**. Необходимо вручную [назначить соответствующие разрешения](backup-azure-sql-database.md#set-vm-permissions) для образов, отличных от Marketplace, чтобы можно было запустить настройку резервного копирования.

    ![Готовность к резервному копированию не готова](./media/backup-sql-server-vm-from-vm-pane/backup-readiness-not-ready.png)

8. Для дальнейшей работы или мониторинга, которые необходимо выполнить на резервном SQL Server виртуальной машине, перейдите в соответствующее хранилище служб восстановления. Перейдите к **элементу архивации** , чтобы просмотреть все базы данных, которые были архивированы в этом хранилище, и активируйте такие операции, как резервное копирование и восстановление по запросу. Аналогичным образом перейдите к **заданиям резервного копирования** , чтобы [отслеживать](manage-monitor-sql-database-backup.md) задания, соответствующие операциям, таким как настройка защиты, резервное копирование и восстановление.

    ![Просмотр резервных копий баз данных в элементах резервного копирования](./media/backup-sql-server-vm-from-vm-pane/backup-items.png)

>[!NOTE]
>Резервная копия не настраивается автоматически ни на одном из новых SQL Server экземпляров, которые могут быть добавлены позже на защищенную виртуальную машину. Чтобы настроить резервное копирование только что добавленных экземпляров, необходимо перейти в хранилище, в которое зарегистрирована виртуальная машина, и выполнить действия, описанные [здесь](backup-sql-server-database-azure-vms.md).

## <a name="next-steps"></a>Дальнейшие действия

Вы узнаете, как выполнять следующие задачи:

- [Восстановление резервных копий баз данных SQL Server](restore-sql-database-azure-vm.md)
- [Управление резервными копиями баз данных SQL Server](manage-monitor-sql-database-backup.md)
