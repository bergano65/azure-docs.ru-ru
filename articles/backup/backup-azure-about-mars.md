---
title: Сведения об агенте MARS
description: Узнайте, как агент MARS поддерживает сценарии резервного копирования.
ms.topic: conceptual
ms.date: 08/04/2020
ms.openlocfilehash: 8e4ace0c17dbe75e989981db56583ed9477b3716
ms.sourcegitcommit: 97a0d868b9d36072ec5e872b3c77fa33b9ce7194
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87562605"
---
# <a name="about-the-microsoft-azure-recovery-services-mars-agent"></a>Сведения об агенте Службы восстановления Microsoft Azure (MARS)

В этой статье описывается, как служба Azure Backup использует агент Службы восстановления Microsoft Azure (MARS) для резервного копирования и восстановления файлов, папок, тома или состояния системы с локального компьютера в Azure.

## <a name="backup-scenarios"></a>Сценарии резервного копирования

Агент MARS поддерживает следующие сценарии резервного копирования:

![Сценарии резервного копирования MARS](./media/backup-try-azure-backup-in-10-mins/backup-scenarios.png)

- **Файлы и папки**. Выборочная защита файлов и папок Windows.
- **Уровень громкости**: защита всего тома Windows компьютера.
- **Уровень системы**: защита всего состояния системы Windows.

### <a name="additional-scenarios"></a>Дополнительные сценарии

- **Резервное копирование конкретных файлов и папок на виртуальных машинах Azure**. основной способ резервного копирования виртуальных машин Azure — использовать расширение Azure Backup на виртуальной машине. Расширение создает резервную копию всей виртуальной машины. Если вы хотите создать резервную копию конкретных файлов и папок в виртуальной машине, можно установить агент MARS на виртуальных машинах Azure. Дополнительные сведения см. [в статье Архитектура: Встроенная резервная копия виртуальных машин Azure](./backup-architecture.md#architecture-built-in-azure-vm-backup).

- **Автономное заполнение**. Первоначальные полные резервные копии данных в Azure обычно передают большие объемы данных и нуждаются в дополнительной пропускной способности сети. Последующие резервные копии переносят только разностный или добавочный объем данных. Azure Backup сжимает исходные резервные копии. В процессе *автономного заполнения*Azure Backup могут использовать диски для передачи сжатых данных начальной архивации в автономный режим в Azure. Дополнительные сведения см. в разделе [Azure Backup автономная архивация с помощью Azure Data Box](offline-backup-azure-data-box.md).

## <a name="restore-scenarios"></a>Сценарии восстановления

Агент MARS поддерживает следующие сценарии восстановления:

![Сценарии восстановления режима MARS](./media/backup-try-azure-backup-in-10-mins/restore-scenarios.png)

- **Тот же сервер**: сервер, на котором изначально была создана резервная копия.
  - **Файлы и папки**: выберите отдельные файлы и папки, которые требуется восстановить.
  - **Уровень громкости**: выберите том и точку восстановления, которые требуется восстановить. Затем восстановите его в том же расположении или в другом расположении на том же компьютере.  Создание копии существующих файлов, перезапись существующих файлов или пропуск восстановления существующих файлов.
  - **Уровень системы**: выберите состояние системы и точку восстановления для восстановления на том же компьютере в указанном расположении.

- **Альтернативный сервер**: сервер, отличный от сервера, на котором была создана резервная копия.
  - **Файлы и папки**: выберите отдельные файлы и папки, точки восстановления которых требуется восстановить на целевой компьютер.
  - **Уровень громкости**: выберите том и точку восстановления, которые требуется восстановить в другое расположение. Создание копии существующих файлов, перезапись существующих файлов или пропуск восстановления существующих файлов.
  - **Уровень системы**: выберите состояние системы и точку восстановления для восстановления в качестве файла состояния системы на альтернативный компьютер.

## <a name="backup-process"></a>Процесс резервного копирования

1. В портал Azure создайте [хранилище служб восстановления](install-mars-agent.md#create-a-recovery-services-vault)и выберите файлы, папки и состояние системы из **целей резервного копирования**.
2. [Скачайте учетные данные хранилища служб восстановления и установщик агента](./install-mars-agent.md#download-the-mars-agent) на локальный компьютер.

3. [Установите агент](./install-mars-agent.md#install-and-register-the-agent) и используйте Скачанные учетные данные хранилища для регистрации компьютера в хранилище служб восстановления.
4. В консоли агента на клиенте [Настройте резервное копирование](./backup-windows-with-mars-agent.md#create-a-backup-policy) , чтобы указать, что следует архивировать, когда следует выполнять резервное копирование (расписание), как долго резервные копии должны храниться в Azure (политика хранения) и приступить к защите.

![Схема агента Azure Backup](./media/backup-try-azure-backup-in-10-mins/backup-process.png)

### <a name="additional-information"></a>Дополнительные сведения

- **Начальное резервное копирование** (первая резервная копия) выполняется в соответствии с настройками резервного копирования.  Агент MARS использует VSS для создания моментального снимка томов, выбранных для резервного копирования. Агент использует только операцию записи системы Windows для записи моментального снимка. Он не использует модули записи VSS приложений и не отслеживает моментальные снимки, совместимые с приложениями. После создания моментального снимка с помощью VSS агент MARS создает виртуальный жесткий диск (VHD) в папке кэша, указанной при настройке резервного копирования. Агент также хранит контрольные суммы для каждого блока данных.

- **Добавочное резервное копирование** (последующие резервные копии) выполняется в соответствии с указанным расписанием. Во время добавочного резервного копирования определяются измененные файлы и создается новый виртуальный жесткий диск. VHD сжимается и шифруется, а затем отправляется в хранилище. После завершения добавочного резервного копирования новый виртуальный жесткий диск объединяется с VHD, созданным после начальной репликации. Этот объединенный виртуальный жесткий диск предоставляет Последнее состояние, которое будет использоваться для сравнения текущей резервной копии.

- Агент MARS может запускать задание резервного копирования в **оптимизированном режиме** с помощью журнала изменений USN (порядковый номер обновления) или в **неоптимизированном режиме** путем проверки изменений в каталогах или файлах с помощью сканирования всего тома. Неоптимизированный режим медленнее, так как агент должен сканировать каждый файл в томе и сравнить его с метаданными для определения измененных файлов.  **Начальное резервное копирование** всегда будет выполняться в неоптимизированном режиме. Если предыдущая резервная копия завершилась сбоем, то следующее запланированное задание архивации будет запущено в неоптимизированном режиме. Дополнительные сведения об этих режимах и способах их проверки см. в [этой статье](backup-azure-troubleshoot-slow-backup-performance-issue.md#cause-backup-job-running-in-unoptimized-mode).

## <a name="next-steps"></a>Дальнейшие действия

[Таблица поддержки агента Служб восстановления Microsoft Azure](./backup-support-matrix-mars-agent.md)

[Агент MARS: вопросы и ответы](./backup-azure-file-folder-backup-faq.md)
