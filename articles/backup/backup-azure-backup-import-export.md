---
title: Заполнение автономной резервной копии с помощью службы импорта и экспорта Azure
description: Узнайте, как можно использовать Azure Backup для отправки данных из сети с помощью службы импорта и экспорта Azure. В этой статье описывается автономное заполнение начальных резервных копий данных с помощью службы импорта и экспорта Azure.
ms.reviewer: saurse
ms.topic: conceptual
ms.date: 05/17/2018
ms.openlocfilehash: 5611b5a6fc9ba8bbff11e35449caf0dd9d33fa21
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85373308"
---
# <a name="offline-backup-workflow-in-azure-backup"></a>Автономное резервное копирование в Azure Backup

В службу архивации Azure встроено несколько эффективных методов, которые позволяют экономить затраты на сеть и хранилище во время передачи начальных полных резервных копий данных в Azure. Первоначальные полные резервные копии обычно передают большие объемы данных и требуют большей пропускной способности сети по сравнению с последующими резервными копиями, которые передают только изменения или добавления. Служба Azure Backup может использовать диски для передачи автономных резервных копий данных в Azure в рамках автономного заполнения.

Процесс автономного заполнения Azure Backup тесно интегрирован со [службой импорта и экспорта Azure](../storage/common/storage-import-export-service.md). Эту службу можно использовать для перемещения данных начальной архивации в Azure с помощью дисков. Если у вас есть терабайты (TBs) исходных данных резервного копирования, которые должны передаваться по сети с высокой задержкой и низкой пропускной способностью, можно использовать рабочий процесс автономного заполнения для доставки начальной резервной копии на один или несколько жестких дисков в центр обработки данных Azure. На следующем рисунке показана схема рабочего процесса.

  ![Обзор процесса автономного импорта рабочего процесса](./media/backup-azure-backup-import-export/offlinebackupworkflowoverview.png)

Процесс автономного резервного копирования состоит из следующих этапов.

1. Вместо отправки по сети данные резервной копии записываются в промежуточное расположение.
1. Используйте служебную программу *AzureOfflineBackupDiskPrep* для записи данных в промежуточное расположение на один или несколько дисков SATA.
1. В рамках подготовительной работы служебная программа *AzureOfflineBackupDiskPrep* создает задание импорта Azure. Отправьте диски SATA в ближайший центр обработки данных Azure и создайте ссылку на задание импорта для привязки к действиям.
1. В центре обработки данных Azure данные с дисков копируются в учетную запись хранилища Azure.
1. Служба Azure Backup копирует данные резервной копии из учетной записи хранилища в хранилище служб восстановления, при этом создается расписание для добавочных резервных копий.

## <a name="supported-configurations"></a>Поддерживаемые конфигурации

Следующие Azure Backup функции или рабочие нагрузки поддерживают использование автономного резервного копирования для:

> [!div class="checklist"]
>
> * Резервное копирование файлов и папок с помощью агента Службы восстановления Microsoft Azure (MARS), также называемого агентом Azure Backup.
> * Резервное копирование всех рабочих нагрузок и файлов с помощью System Center Data Protection Manager (DPM).
> * Резервное копирование всех рабочих нагрузок и файлов с Microsoft Azure Backup Server.

   > [!NOTE]
   > Автономное резервное копирование не поддерживается для резервных копий состояния системы, выполненных с помощью агента Azure Backup.

[!INCLUDE [backup-upgrade-mars-agent.md](../../includes/backup-upgrade-mars-agent.md)]

## <a name="prerequisites"></a>Предварительные условия

  > [!NOTE]
  > Следующие предварительные требования и рабочий процесс применяются только к автономному резервному копированию файлов и папок с помощью [последнего агента служб восстановления Azure](https://aka.ms/azurebackup_agent). Сведения о выполнении автономного резервного копирования для рабочих нагрузок с помощью System Center DPM или Azure Backup Server см. в разделе [Рабочий процесс автономного резервного копирования для DPM и Azure Backup Server](backup-azure-backup-server-import-export.md).

Перед запуском рабочего процесса автономного резервного копирования выполните следующие предварительные требования.

* Создайте [хранилище служб восстановления](backup-azure-recovery-services-vault-overview.md). Чтобы создать хранилище, выполните действия, описанные в разделе [Создание хранилища служб восстановления](tutorial-backup-windows-server-to-azure.md#create-a-recovery-services-vault).
* Убедитесь, что на сервере Windows или клиенте Windows установлена только [Последняя версия агента Azure Backup](https://aka.ms/azurebackup_agent) и что компьютер зарегистрирован в хранилище служб восстановления.
* Azure PowerShell 3.7.0 требуется на компьютере, на котором работает агент Azure Backup. Скачайте и [установите 3.7.0 версию Azure PowerShell](https://github.com/Azure/azure-powershell/releases/tag/v3.7.0-March2017).
* На компьютере, на котором работает агент Azure Backup, убедитесь, что установлен Microsoft ребр или Internet Explorer 11 и включен JavaScript.
* Создайте учетную запись хранения Azure в той же подписке, что и хранилище служб восстановления.
* Убедитесь, что у вас есть [необходимые разрешения](../active-directory/develop/howto-create-service-principal-portal.md) для создания приложения Azure Active Directory. Рабочий процесс автономного резервного копирования создает приложение Azure Active Directory в подписке, связанной с учетной записью хранения Azure. Целью приложения является предоставление Azure Backup с безопасным и ограниченным доступом к службе импорта и экспорта Azure, которая необходима для рабочего процесса автономного резервного копирования.
* Зарегистрируйте поставщик ресурсов *Microsoft. ImportExport* с подпиской, которая содержит учетную запись хранения Azure. Выполните приведенные ниже действия, чтобы зарегистрировать поставщика ресурсов.
    1. В главном меню выберите **подписки**.
    1. Если вы подписаны на несколько подписок, выберите подписку, которую планируется использовать для автономной архивации. Если вы используете только одну подписку, появится ваша подписка.
    1. В меню Подписка выберите **поставщики ресурсов** , чтобы просмотреть список поставщиков.
    1. В списке поставщиков прокрутите вниз до элемента *Microsoft. ImportExport*. Если **состояние** — **зарегистрировано**, выберите **зарегистрировать**.

        ![Регистрация поставщика ресурсов](./media/backup-azure-backup-import-export/registerimportexport.png)

* Создается расположение промежуточного хранения, которое может быть общей сетевой папкой или любым дополнительным диском на компьютере (внутренним или внешним) с достаточным местом на диске для хранения исходной копии. Например, если требуется создать резервную копию файлового сервера размером 500 ГБ, убедитесь, что промежуточная область составляет не менее 500 ГБ. (В результате сжатия используется меньшее количество.)
* При отправке дисков в Azure используйте только 2,5-дюймовый SSD или 2,5-дюймовый или 3,5-дюймовый внутренний жесткий диск SATA II/III. Можно использовать жесткие диски размером до 10 ТБ. См. раздел [Supported hardware](../storage/common/storage-import-export-requirements.md#supported-hardware) (Поддерживаемое оборудование), чтобы узнать, какой последний набор дисков поддерживает эта служба.
* Диски SATA должны быть подключены к компьютеру (*компьютер копирования*), на котором выполняется копирование данных резервной копии из промежуточного расположения на диски SATA. Убедитесь, что BitLocker включен на компьютере копирования.

## <a name="workflow"></a>Рабочий процесс

В этом разделе описывается рабочий процесс автономного резервного копирования, который позволяет доставлять данные в центр обработки данных Azure и отправлять их в службу хранилища Azure. Если у вас возникли вопросы о службе импорта или о любом аспекте процесса, см. [документацию с обзором службы импорта и экспорта Azure](../storage/common/storage-import-export-service.md).

## <a name="initiate-offline-backup"></a>Инициирование автономного резервного копирования

1. При планировании резервного копирования на агенте служб восстановления отображается эта страница.

    ![Страница «Импорт»](./media/backup-azure-backup-import-export/offlinebackup_inputs.png)

1. Выберите параметр **перенести с помощью моих собственных дисков**.

    > [!NOTE]
    > Используйте параметр Azure Data Box для перевода данных начальной резервной копии в автономный режим. Этот параметр позволяет экономить усилия, необходимые для приобретения собственных дисков, совместимых с Azure. Он предоставляет собственные, безопасные и антивандальную Azure Data Box устройства, к которым данные резервного копирования могут быть непосредственно записаны агентом служб восстановления.

1. Нажмите кнопку **Далее**и тщательно заполните поля.

    ![Введите сведения о диске](./media/backup-azure-backup-import-export/your-disk-details.png)

   Поля, которые вы заполните,:

    * **Расположение промежуточного хранения**: место временного хранения, в которое записывается исходная резервная копия. Промежуточное расположение может находиться в общей сетевой папке или на локальном компьютере. Если компьютер копирования и исходный компьютер отличаются, укажите полный сетевой путь к промежуточному расположению.
    * **Учетная запись хранения Azure Resource Manager**: имя учетной записи хранения Resource Manager (общего назначения версии 1 или общего назначения версии 2) в любой подписке Azure.
    * **Контейнер хранилища Azure**. имя целевого контейнера хранилища BLOB-объектов в учетной записи хранения Azure, в которой данные резервной копии импортируются перед копированием в хранилище служб восстановления.
    * **Идентификатор подписки Azure**: идентификатор подписки Azure, в которой создана учетная запись хранения Azure.
    * **Имя задания импорта Azure**: уникальное имя, по которому служба импорта и экспорта Azure Azure Backup отслеживание передачи данных, отправляемых на диски в Azure.
  
   После заполнения полей нажмите кнопку **Далее**. Сохраните **промежуточное расположение** и сведения о **имени задания импорта Azure** . Она необходима для подготовки дисков.

1. При появлении запроса войдите в свою подписку Azure. Необходимо выполнить вход, чтобы Azure Backup можно было создать Azure Active Directory приложение. Введите необходимые разрешения для доступа к службе импорта и экспорта Azure.

    ![Страница входа в подписку Azure](./media/backup-azure-backup-import-export/azure-login.png)

1. Завершите рабочий процесс. В консоли агента Azure Backup выберите пункт **Архивировать сейчас**.

    ![Создать резервную копию сейчас](./media/backup-azure-backup-import-export/backupnow.png)

1. На странице **Подтверждение** мастера нажмите кнопку **создать резервную копию**. Начальная резервная копия записывается в промежуточное расположение в процессе установки.

   ![Подтвердите, что будете готовы к архивации](./media/backup-azure-backup-import-export/backupnow-confirmation.png)

    После завершения операции расположение промежуточного хранения можно использовать для подготовки диска.

   ![Страница мастера создания резервной копии](./media/backup-azure-backup-import-export/opbackupnow.png)

## <a name="prepare-sata-drives-and-ship-to-azure"></a>Подготовка дисков SATA и их отправка в Azure

Служебная программа *AzureOfflineBackupDiskPrep* подготавливает диски SATA, которые отправляются в ближайший центр обработки данных Azure. Эта служебная программа доступна в каталоге установки агента Azure Backup по следующему пути:

```*\Microsoft Azure Recovery Services Agent\Utils\\*```

1. Перейдите в каталог и скопируйте каталог *AzureOfflineBackupDiskPrep* на другой компьютер, на котором подключены диски SATA. На компьютере с подключенными дисками SATA убедитесь, что:

   * Компьютер копирования может получить доступ к промежуточному расположению для рабочего процесса автономного заполнения, используя тот же сетевой путь, который был указан в рабочем процессе в разделе "Запуск автономной архивации".
   * На компьютере копирования включен BitLocker.
   * Установите Azure PowerShell 3.7.0.
   * Установлены последние Совместимые браузеры (Microsoft ребр или Internet Explorer 11), а поддержка JavaScript включена.
   * Компьютер копирования может получить доступ к порталу Azure. При необходимости компьютер копирования может быть таким же, как и исходный компьютер.

     > [!IMPORTANT]
     > Если исходный компьютер является виртуальной машиной, то копирующий компьютер должен быть физическим сервером или клиентским компьютером, отличным от исходного компьютера.

1. Откройте командную строку с повышенными привилегиями на компьютере копирования с каталогом служебной программы *AzureOfflineBackupDiskPrep* в качестве текущего каталога. Выполните следующую команду:

    ```.\AzureOfflineBackupDiskPrep.exe s:<Staging Location Path>```

    | Параметр | Описание: |
    | --- | --- |
    | s:&lt;*Staging Location Path*&gt; (Путь к расположению промежуточного хранения) |Этот обязательный ввод используется для указания пути к промежуточному расположению, введенному в рабочем процессе в разделе "Запуск автономной архивации". |
    | p:&lt;*Path to PublishSettingsFile*&gt; (Путь к PublishSettingsFile) |Этот необязательный ввод используется для указания пути к файлу параметров публикации Azure, введенному в рабочем процессе в разделе "Запуск автономной архивации". |

    При выполнении команды программа запрашивает выбор задания импорта Azure, которое соответствует дискам, которые необходимо подготовить. Если с указанным промежуточным расположением связано только одно задание импорта, отобразится страница, подобная этой.

    ![Входные данные средства подготовки диска Azure](./media/backup-azure-backup-import-export/diskprepconsole0_1.png) <br/>

1. Введите имя без завершающего двоеточия для подключенного диска, который вы хотите подготовить для передачи в Azure.
1. При появлении запроса подтвердите форматирование диска.
1. Вам будет предложено войти в подписку Azure. Введите свои учетные данные.

    ![Вход в подписку Azure](./media/backup-azure-backup-import-export/signindiskprep.png) <br/>

    Затем средство начнет подготовку диска и скопировать данные резервной копии. Если на указанном диске недостаточно места для резервных данных, может потребоваться подключить дополнительные диски. <br/>

    По завершении успешного выполнения средства командная строка предоставляет три фрагмента информации:

   1. один или несколько предоставленных вами дисков готовы к отправке в Azure;
   1. Вы получите подтверждение о том, что задание импорта было создано. В задании импорта используется предоставленное вами имя.
   1. средство отображает адрес доставки для центра обработки данных Azure.

      ![Подготовка диска Azure завершена](./media/backup-azure-backup-import-export/console2.png)<br/>

1. Сведения о доставке можно обновить по завершении выполнения команды.

1. Отправьте диски по адресу, указанному средством. Сохраним контрольный номер для дальнейшего использования.

   > [!IMPORTANT]
   > Ни один из двух заданий импорта Azure не может иметь один и тот же номер для отслеживания. Убедитесь, что диски, подготовленные программой в рамках одного задания импорта Azure, поставляются вместе в одном пакете, а для пакета существует один уникальный номер для отслеживания. Не следует объединять диски, подготовленные в рамках отдельных заданий импорта Azure, в одном пакете.

## <a name="update-shipping-details-on-the-azure-import-job"></a>Обновление сведений о доставке в задании импорта Azure

Следующая процедура обновляет сведения о доставке задания импорта Azure. Эта информация включает следующие сведения:

* Имя перевозчика, который доставляет диски в Azure.
* Возвращают сведения о доставке дисков.

1. Войдите в подписку Azure.
1. В главном меню выберите **все службы**. В диалоговом окне **все службы** введите **Импорт**. Если вы видите **задания импорта и экспорта**, выберите его.

    ![Введите сведения о доставке](./media/backup-azure-backup-import-export/search-import-job.png)<br/>

    Откроется меню **задания импорта и экспорта** , в котором появится список всех заданий импорта и экспорта в выбранной подписке.

1. Если у вас несколько подписок, выберите подписку, используемую для импорта данных резервных копий. Затем выберите только что созданное задание импорта, чтобы открыть его сведения.

    ![Проверка сведений о доставке](./media/backup-azure-backup-import-export/import-job-found.png)<br/>

1. В меню **Параметры** задания импорта выберите пункт **Управление сведениями о доставке**. Введите сведения о возвращающейся доставке.

    ![Хранение сведений о доставке](./media/backup-azure-backup-import-export/shipping-info.png)<br/>

1. Если у вас есть номер отслеживания от оператора доставки, выберите баннер на странице Обзор задания импорта Azure и введите следующие сведения.

   > [!IMPORTANT]
   > Убедитесь, что информация об операторе и номер для отслеживания были обновлены в течение двух недель после создания задания импорта Azure. Сбой проверки этих данных в течение двух недель может привести к удалению задания, а также к тому, что диски не обрабатываются.

   ![Оповещение об обновлении отслеживания](./media/backup-azure-backup-import-export/joboverview.png)<br/>

   ![Информация о перевозчике и номер отслеживания](./media/backup-azure-backup-import-export/tracking-info.png)

### <a name="time-to-process-the-drives"></a>Время на обработку дисков

Количество времени, затрачиваемое на обработку задания импорта Azure, может меняться. Время обработки зависит от таких факторов, как время доставки, тип задания, тип и размер копируемых данных, а также размер указанных дисков. Служба импорта и экспорта Azure не имеет соглашения об уровне обслуживания. После получения дисков служба стремится завершить копирование данных резервного копирования в учетную запись хранения Azure в течение 7 – 10 дней.

### <a name="monitor-azure-import-job-status"></a>Мониторинг состояния задания импорта Azure

Вы можете отслеживать состояние задания импорта из портал Azure. Перейдите на страницу **Импорт и экспорт заданий** и выберите задание. Дополнительные сведения о состоянии заданий импорта см. в статье [что такое служба импорта и экспорта Azure?](../storage/common/storage-import-export-service.md).

### <a name="finish-the-workflow"></a>Завершение рабочего процесса

Когда задание импорта будет выполнено, данные начальной резервной копии появятся в вашей учетной записи хранения. Во время следующего запланированного резервного копирования Azure Backup копирует содержимое данных из учетной записи хранения в хранилище служб восстановления.

   ![Копирование данных в хранилище служб восстановления](./media/backup-azure-backup-import-export/copyingfromstorageaccounttoazurebackup.png)<br/>

При следующем запланированном резервном копировании служба Azure Backup выполнит добавочное резервное копирование.

### <a name="clean-up-resources"></a>Очистка ресурсов

После завершения начальной архивации можно безопасно удалить данные, импортированные в контейнер хранилища Azure, и данные резервных копий в промежуточном расположении.

## <a name="next-steps"></a>Дальнейшие шаги

* Вопросы о рабочем процессе службы импорта и экспорта Azure см. в статье [Использование службы импорт и экспорт Microsoft Azure для перемещения данных в хранилище BLOB-объектов](../storage/common/storage-import-export-service.md).
