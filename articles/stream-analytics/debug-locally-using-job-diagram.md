---
title: Отладка запросов Azure Stream Analytics локально с помощью схемы заданий в Visual Studio
description: В этой статье описывается, как выполнять локальную отладку запросов с помощью схемы заданий в средствах Azure Stream Analytics для Visual Studio.
author: su-jie
ms.author: sujie
ms.reviewer: mamccrea
ms.service: stream-analytics
ms.topic: conceptual
ms.date: 01/23/2020
ms.openlocfilehash: 106b1f0b765700803d2cd55b5e049fae5be3dfad
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "76847203"
---
# <a name="debug-azure-stream-analytics-queries-locally-using-job-diagram-in-visual-studio"></a>Отладка запросов Azure Stream Analytics локально с помощью схемы заданий в Visual Studio

Задания, которые не выводят результаты или непредвиденные результаты, являются общими сценариями устранения неполадок для потоковых запросов. Вы можете использовать схему заданий при локальном тестировании запроса в Visual Studio, чтобы проверить промежуточный результирующий набор и метрики для каждого шага. Схемы заданий позволяют быстро изолировать источник проблемы при устранении неполадок.

## <a name="debug-a-query-using-job-diagram"></a>Отладка запроса с помощью схемы задания

Для преобразования входных данных в выходные данные используется скрипт Azure Stream Analytics. На схеме задания показано, как потоки данных из источников ввода (концентратор событий, центр Интернета вещей и т. д.) выполняются с помощью нескольких шагов запроса и, наконец, для вывода приемников. Каждый шаг запроса сопоставляется с временным результирующим набором, определенным в скрипте с помощью `WITH` инструкции. Вы можете просмотреть данные, а также метрики каждого шага запроса в каждом промежуточном результирующем наборе, чтобы найти источник проблемы.

> [!NOTE]
> Эта схема заданий показывает только данные и метрики для локального тестирования в одном узле. Его не следует использовать для настройки производительности и устранения неполадок.

### <a name="start-local-testing"></a>Запуск локального тестирования

С помощью этого [краткого руководства](stream-analytics-quick-create-vs.md) вы узнаете, как создать задание Stream Analytics с помощью Visual Studio или [экспортировать существующее задание в локальный проект](stream-analytics-vs-tools.md#export-jobs-to-a-project). Если вы хотите протестировать запрос с локальными входными данными, выполните следующие [инструкции](stream-analytics-live-data-local-testing.md). Если вы хотите протестировать с помощью Live input, перейдите к следующему шагу.

> [!NOTE]
> Если вы экспортируете задание в локальный проект и хотите протестировать поток входных данных в реальном времени, необходимо указать учетные данные для всех входных данных.  

Выберите источник входных и выходных данных в редакторе скриптов и щелкните **запустить локально**. Диаграмма заданий отображается в правой части.

### <a name="view-the-intermediate-result-set"></a>Просмотр промежуточного результирующего набора  

1. Выберите шаг запроса, чтобы перейти к скрипту. Вы автоматически направляете соответствующий скрипт в редакторе слева.

   ![Сценарий навигации по схеме заданий](./media/debug-locally-using-job-diagram/navigate-script.png)

2. Выберите шаг запроса и щелкните **Предварительный просмотр** в диалоговом окне извлеченные. Результирующий набор отображается на вкладке в нижней части окна результатов.

   ![Результат предварительного просмотра схемы заданий](./media/debug-locally-using-job-diagram/preview-result.png)

### <a name="view-step-metrics"></a>Просмотреть метрики шага

В этом разделе вы изучите метрики, доступные для каждой части схемы.

#### <a name="input-sources-live-stream"></a>Источники входных данных (динамический поток)

![Источники активных входных данных схемы заданий](./media/debug-locally-using-job-diagram/live-input.png)

|Метрика|Описание|
|-|-|
|**таксириде**| Имя входа.|
|**Концентратор событий** | Тип источника входных данных.|
|**События**|Число прочитанных событий.|
|**Источники событий с невыполненной отпротоколированием**|Количество сообщений, которое необходимо прочитать для концентраторов событий и входных данных центра Интернета вещей.|
|**События в байтах**|Число переданных байтов.|
| **События со сниженной производительностью**|Число событий с проблемой, отличной от десериализации.|
|**Ранние события**| Число событий, имеющих отметку времени приложения до верхнего предела.|
|**Поздние события**| Число событий, имеющих отметку времени приложения после верхнего предела.|
|**Источники событий**| Число считанных единиц данных. например больших двоичных объектов.|

#### <a name="input-sources-local-input"></a>Источники входных данных (локальный вход)

![Локальные входные источники схемы заданий](./media/debug-locally-using-job-diagram/local-input.png)

|Метрика|Описание|
|-|-|
|**таксириде**| Имя входа.|
|**Количество строк**| Число строк, созданных на шаге.|
|**Размер данных**| Размер данных, создаваемых на этом шаге.|
|**Локальный вход**| Используйте в качестве входных данных локальные данные.|

#### <a name="query-steps"></a>Шаги запроса

![Шаг запроса схемы заданий](./media/debug-locally-using-job-diagram/query-step.png)

|Метрика|Описание|
|-|-|
|**TripData**|Имя временного результирующего набора.|
|**Количество строк**| Число строк, созданных на шаге.|
|**Размер данных**| Размер данных, создаваемых на этом шаге.|
  
#### <a name="output-sinks-live-output"></a>Приемники выходных данных (выходные данные в реальном времени)

![Схема заданий. локальные приемники выходных данных](./media/debug-locally-using-job-diagram/live-output.png)

|Метрика|Описание|
|-|-|
|**регионагжех**|Имя выхода.|
|**События**|Число событий, выводимых в приемники.|

#### <a name="output-sinks-local-output"></a>Приемники выходных данных (локальный вывод)

![Схема заданий. локальные приемники выходных данных](./media/debug-locally-using-job-diagram/local-output.png)

|Метрика|Описание|
|-|-|
|**регионагжех**|Имя выхода.|
|**Локальный выход**| Вывод результатов в локальный файл.|
|**Количество строк**| Число строк выходных данных в локальный файл.|
|**Размер данных**| Размер выходных данных в локальном файле.|

### <a name="close-job-diagram"></a>Закрыть схему заданий

Если схема задания больше не нужна, выберите **Закрыть** в правом верхнем углу. После закрытия окна схемы необходимо снова запустить Локальное тестирование, чтобы увидеть его.

### <a name="view-job-level-metrics-and-stop-running"></a>Просмотр метрик уровня задания и завершение работы

Другие метрики уровня задания отображаются во всплывающей консоли. Если вы хотите прерывать задание, нажмите клавиши **CTRL + C** в консоли.

![Задание завершения задания диаграммы заданий](./media/debug-locally-using-job-diagram/stop-job.png)

## <a name="limitations"></a>Ограничения

* Приемники выходных данных Power BI и Azure Data Lake Storage 1-го поколения не поддерживаются из-за ограничений модели проверки подлинности.

* Для облачных входных данных поддерживаются [политики времени](stream-analytics-out-of-order-and-late-events.md), а для локальных входных данных — нет.

## <a name="next-steps"></a>Дальнейшие шаги

* [Краткое руководство. Создание задания Stream Analytics с использованием инструментов Azure Stream Analytics для Visual Studio](stream-analytics-quick-create-vs.md)
* [Просмотр заданий Azure Stream Analytics с помощью Visual Studio](stream-analytics-vs-tools.md)
* [Тестирование реальных данных в локальной среде с помощью инструментов Azure Stream Analytics для Visual Studio (предварительная версия)](stream-analytics-live-data-local-testing.md)
