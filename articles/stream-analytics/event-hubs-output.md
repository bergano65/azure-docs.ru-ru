---
title: Выходные данные концентраторов событий из Azure Stream Analytics
description: В этой статье описывается, как выводить данные из Azure Stream Analytics в концентраторы событий Azure.
author: mamccrea
ms.author: mamccrea
ms.reviewer: mamccrea
ms.service: stream-analytics
ms.topic: conceptual
ms.date: 09/23/2020
ms.openlocfilehash: 86a6c1a15d804a6c758e90dbd4bdd7057a7a2716
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91295292"
---
# <a name="event-hubs-output-from-azure-stream-analytics"></a>Выходные данные концентраторов событий из Azure Stream Analytics

[Центры событий Azure](https://azure.microsoft.com/services/event-hubs/) — это высокомасштабируемая служба приема данных о событиях публикации и подписки. Она может принимать миллионы событий в секунду. Концентратор событий может использоваться в качестве места назначения выходных данных, например в случае, когда выходные данные задания Stream Analytics становятся входными данными для другого задания потоковой передачи. Сведения о максимальном размере сообщений и оптимизации размера пакета см. в разделе [Размер пакета выходных данных](#output-batch-size).

## <a name="output-configuration"></a>Конфигурация выходных данных

В следующей таблице приведены параметры, необходимые для настройки потоков данных из концентраторов событий в качестве выходных данных.

| Имя свойства | Описание |
| --- | --- |
| Псевдоним выходных данных | Понятное имя, которое используется в запросах для направления выходных данных запроса в концентратор событий. |
| Пространство имен концентратора событий | Контейнер для набора сущностей обмена сообщениями. При создании концентратора событий создается также пространство имен концентратора событий. |
| Имя концентратора событий | Имя выходных данных концентратора событий. |
| Имя политики концентратора событий | Политика общего доступа, которую можно создать на вкладке **Настройка** концентратора событий. Каждой политике общего доступа присваивается имя, а также для нее задаются разрешения и ключи доступа. |
| Ключ политики концентратора событий | Ключ общего доступа, используемый для аутентификации доступа к пространству имен концентратора событий. |
| Столбец ключа раздела | Необязательный параметр. Этот столбец содержит ключ раздела для выходных данных концентратора событий. |
| Формат сериализации событий | Формат сериализации для выходных данных. Поддерживаются форматы JSON, CSV и Avro. |
| Кодирование | В настоящее время единственным поддерживаемым форматом кодирования файлов CSV и JSON является UTF-8. |
| Разделитель | Применяется только для сериализации в формате CSV. Служба Stream Analytics позволяет использовать ряд распространенных разделителей для сериализации данных в формате CSV. Поддерживаются такие разделители: запятая, точка с запятой, пробел, табуляция и вертикальная черта. |
| Формат | Применяется только для сериализации в формате JSON. Вариант **строки-разделители** предусматривает форматирование выходных данных таким образом, что каждый объект JSON будет отделен новой строкой. Если выбрать вариант **строки-разделители**, то JSON считывает по одному объекту за раз. Все содержимое само по себе не будет допустимым форматом JSON. Вариант **массив** означает, что выходные данные будут отформатированы как массив объектов JSON.  |
| Столбцы свойств | Необязательный параметр. Столбцы с разделителями-запятыми, которые необходимо присоединить как пользовательские свойства исходящего сообщения вместо полезных данных. Дополнительные сведения об этой функции см. в разделе [Свойства пользовательских метаданных для выходных данных](#custom-metadata-properties-for-output). |

## <a name="partitioning"></a>Секционирование

Секционирование зависит от выравнивания секций. Если ключ раздела для выходных данных концентратора событий не согласован с вышестоящим (предыдущим) шагом запроса, то число модулей записи совпадает с количеством разделов в выходных данных концентратора событий. Каждый модуль записи использует [класс EventHubSender](/dotnet/api/microsoft.servicebus.messaging.eventhubsender?view=azure-dotnet&preserve-view=true) для отправки событий в определенный раздел. Если ключ раздела для выходных данных концентратора событий не согласован с вышестоящим (предыдущим) шагом запроса, то число модулей записи совпадает с количеством разделов на этом предыдущем шаге. Каждый модуль записи использует [класс SendBatchAsync](/dotnet/api/microsoft.servicebus.messaging.eventhubclient.sendasync?view=azure-dotnet&preserve-view=true) в **EventHubClient** для отправки событий во все разделы выходных данных. 

## <a name="output-batch-size"></a>Размер выходного пакета

Максимальный размер сообщения составляет 256 КБ или 1 МБ на сообщение. Дополнительные сведения см. в разделе [ограничения концентраторов событий](../event-hubs/event-hubs-quotas.md). Если секционирование ввода-вывода не согласовано, каждое событие упаковывается по отдельности в `EventData` и отправляется в составе пакета, пока его размер не достигнет максимального размера сообщения. Это также происходит, если используются [пользовательские свойства метаданных](#custom-metadata-properties-for-output). Если разделение входных и выходных данных согласовано, то нескольких событий упаковываются в один экземпляр `EventData`, пока его размер не достигнет максимального размера сообщения, после чего он отправляется.

## <a name="custom-metadata-properties-for-output"></a>Свойства пользовательских метаданных для выходных данных

Столбцы запросов можно прикреплять к исходящим сообщениям как пользовательские свойства. Эти столбцы не переходят в полезные данные. Свойства представлены в виде словаря в выходном сообщении. *Ключ* — это имя столбца, а *значение* — это значение столбца в словаре свойств. Поддерживаются все типы данных Stream Analytics, кроме записи и массива.

В следующем примере поля `DeviceId` и `DeviceStatus` добавляются в метаданные.

1. Используйте следующий запрос:

   ```sql
   select *, DeviceId, DeviceStatus from iotHubInput
   ```

1. Настройте `DeviceId,DeviceStatus` в выходных данных столбцы свойств.

   :::image type="content" source="media/event-hubs-output/property-columns.png" alt-text="Столбцы свойств":::

На следующем рисунке изображены ожидаемые свойства выходного сообщения, проверенные в EventHub с помощью [обозревателя служебной шины](https://github.com/paolosalvatori/ServiceBusExplorer).

:::image type="content" source="media/event-hubs-output/custom-properties.png" alt-text="Столбцы свойств":::

## <a name="next-steps"></a>Дальнейшие действия

* [Краткое руководство. по созданию задания Stream Analytics с помощью портала Azure](stream-analytics-quick-create-portal.md)
* [Краткое руководство. Создание задания Azure Stream Analytics с помощью Azure CLI](quick-create-azure-cli.md)
* [Краткое руководство. Создание задания Azure Stream Analytics с помощью шаблона ARM](quick-create-azure-resource-manager.md)
* [Краткое руководство. Создание задания Stream Analytics с помощью Azure PowerShell](stream-analytics-quick-create-powershell.md)
* [Краткое руководство. Создание задания Azure Stream Analytics с помощью Visual Studio](stream-analytics-quick-create-vs.md)
* [Краткое руководство. Создание задания Azure Stream Analytics в Visual Studio Code](quick-create-visual-studio-code.md)
