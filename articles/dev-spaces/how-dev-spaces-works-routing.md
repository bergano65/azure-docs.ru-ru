---
title: Как работает маршрутизация с Azure Dev Spaces
services: azure-dev-spaces
ms.date: 03/24/2020
ms.topic: conceptual
description: Описывает процессы, работающие с Power Azure Dev Spaces и принцип работы маршрутизации.
keywords: Azure Dev Spaces, Dev Spaces, Docker, Kubernetes, Azure, AKS, Служба Azure Kubernetes, контейнеры
ms.openlocfilehash: 2d2c6f336222b4ae0907d6579289a8cad8d73aa6
ms.sourcegitcommit: d103a93e7ef2dde1298f04e307920378a87e982a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/13/2020
ms.locfileid: "91977975"
---
# <a name="how-routing-works-with-azure-dev-spaces"></a>Как работает маршрутизация с Azure Dev Spaces

[!INCLUDE [Azure Dev Spaces deprecation](../../includes/dev-spaces-deprecation.md)]

Azure Dev Spaces предоставляет несколько способов быстро перебора и отладки приложений Kubernetes, а также совместной работы в кластере Службы Azure Kubernetes (AKS). После запуска проекта в пространстве разработки Azure Dev Spaces предоставляет дополнительные возможности сети и маршрутизации для проекта.

В этой статье описывается, как маршрутизация работает с пространствами разработки.

## <a name="how-routing-works"></a>Принцип работы маршрутизации

Пространство разработки построено на основе AKS и использует те же [Основные понятия сети](../aks/concepts-network.md). Azure Dev Spaces также имеет централизованную службу *ингрессманажер* и развертывает свой собственный контроллер входящего трафика в кластере AKS. Служба *ингрессманажер* отслеживает кластеры AKS с помощью пространств разработки и дополняет контроллер Azure dev Spaces входящего трафика в кластере с помощью входящих объектов для маршрутизации модулей приложения. Контейнер девспацес-proxy в каждом модуле Pod добавляет `azds-route-as` заголовок HTTP для HTTP-трафика в пространство разработчика на основе URL-адреса. Например, запрос к URL-адресу *http://azureuser.s.default.serviceA.fedcba09...azds.io* будет получать заголовок HTTP с `azds-route-as: azureuser` . Контейнер девспацес-proxy не добавит `azds-route-as` заголовок, если он уже существует.

При выполнении HTTP-запроса к службе извне кластера запрос переходит на входной контроллер. Входной контроллер направляет запрос непосредственно в соответствующий Pod на основе входящих в него объектов и правил. Контейнер девспацес-proxy в Pod получает запрос, добавляет `azds-route-as` заголовок на основе URL-адреса, а затем направляет запрос в контейнер приложения.

При выполнении HTTP-запроса к службе из другой службы в кластере запрос сначала проходит через контейнер девспацес-proxy вызывающей службы. Контейнер девспацес-proxy просматривает HTTP-запрос и проверяет `azds-route-as` заголовок. На основе заголовка контейнер девспацес-proxy выполнит поиск IP-адреса службы, связанной со значением заголовка. Если IP-адрес найден, контейнер девспацес-proxy перенаправит запрос на этот IP-адрес. Если IP-адрес не найден, контейнер девспацес-proxy направляет запрос в родительский контейнер приложения.

Например, приложения *Service* a и *serviceB* развертываются в родительском пространстве разработки, именуемом *по умолчанию*. *Служба* a использует *serviceB* и выполняет HTTP-вызовы. Пользователь Azure создает Дочернее пространство разработки на основе пространства *по умолчанию* с именем *azureuser*. Пользователь Azure также развертывает собственную версию *Service* a в своем дочернем пространстве. Когда выполняется запрос к *http://azureuser.s.default.serviceA.fedcba09...azds.io* :

![Маршрутизация Azure Dev Spaces](media/how-dev-spaces-works/routing.svg)

1. Контроллер входящего трафика находит IP-адрес модуля Pod, связанного с URL-адресом *Service azureuser*.
1. Входной контроллер находит IP-адрес для Pod в пространстве разработки пользователя Azure и направляет запрос в модуль *Service a. azureuser* .
1. Контейнер девспацес-proxy в модуле *Service a. azureuser* получает запрос и добавляет его `azds-route-as: azureuser` в качестве заголовка HTTP.
1. Контейнер девспацес-proxy в модуле *Service a. azureuser* выполняет маршрутизацию запроса в контейнер приложения *Service* a в модуль Service a *. azureuser* .
1. Приложение *Service* a в модуле *Service a. Azureuser* выполняет вызов *serviceB*. Приложение *Service* a также содержит код для сохранения существующего `azds-route-as` заголовка, который в данном случае имеет значение `azds-route-as: azureuser` .
1. Контейнер девспацес-proxy в модуле *Service a. azureuser* получает запрос и выполняет поиск IP-адреса *serviceB* на основе значения `azds-route-as` заголовка.
1. Контейнер девспацес-proxy в модуле *Service a. azureuser* Pod не находит IP-адрес для *serviceB. azureuser*.
1. Контейнер девспацес-proxy в модуле *Service a. azureuser* ищет IP-адрес *serviceB* в родительском пространстве, то есть *serviceB. по умолчанию*.
1. Контейнер девспацес-proxy в модуле *Service a. azureuser* находит IP-адрес для *serviceB. Default* и направляет запрос в модуль *serviceB. Default* .
1. Контейнер девспацес-proxy в модуле *serviceB. Default* получает запрос и направляет запрос в контейнер приложения *ServiceB* в Pod *serviceB. Default* .
1. Приложение *serviceB* в модуле *serviceB. Default* возвращает ответ на модуль *Service a. azureuser* .
1. Контейнер девспацес-proxy в модуле *Service a. azureuser* получает ответ и направляет ответ в контейнер приложения *Service* a в модуле *Service a. azureuser* .
1. Приложение *Service* a получает ответ и возвращает собственный ответ.
1. Контейнер девспацес-proxy в модуле *Service a. azureuser* получает ответ от контейнера приложения *Service* a и направляет ответ исходному вызывающему объекту за пределами кластера.

Весь остальной TCP-трафик, который не проходит через контроллер входящего трафика, и девспацес контейнеры прокси без изменений.

## <a name="sharing-a-dev-space"></a>Совместное использование пространства разработки

Работая с командой, вы можете поделиться пространством разработки во всей группе и создать производные пространства разработки. Пространство разработки может использоваться любым сотрудником, у которого есть доступ к группе ресурсов пространства разработки.

Можно также создать новое пространство разработки, полученное из другого пространства разработки. При создании производного пространства разработки метка *azds.IO/Parent-Space=Parent-Space-Name* добавляется в пространство имен производного пространства разработки. Кроме того, все приложения из родительского пространства разработки используются совместно с производным пространством разработки. При развертывании обновленной версии приложения в производном пространстве разработки оно будет существовать только в производном пространстве разработки, а родительское пространство разработки останется без изменений. Можно использовать не более трех уровней производных пространств разработки или *бабушкх* .

Производное пространство разработки также будет Intelligent маршрутизировать запросы между собственными приложениями и приложениями, которые совместно используются от его родителя. Маршрутизация работает, пытаясь направить запрос к приложению в производном пространстве разработки и вернуться к общему приложению из родительского пространства разработки. Маршрутизация вернется к общему приложению в области «бабушке», если приложение не находится в родительском пространстве.

Пример:
* Пространство разработки *по умолчанию* имеет приложения *Service* a и *serviceB*.
* *Azureuser* пространства разработки является производным от *значения по умолчанию*.
* Обновленная версия *Service* a развертывается в *azureuser*.

При использовании *azureuser*все запросы к *Service* a будут направляться в обновленную версию в *azureuser*. Запрос к *serviceB* сначала попытается направляться в *azureuser* версию *serviceB*. Так как она не существует, она будет направляться в версию *serviceB* *по умолчанию* . При удалении версии *azureuser* *Service* a все запросы к *Service* a будут возвращаться к использованию версии *Service*a *по умолчанию* .

## <a name="next-steps"></a>Дальнейшие действия

Пример того, как Azure Dev Spaces использует маршрутизацию для обеспечения быстрой итерации и разработки, см. в статье [как выполнять удаленную отладку кода с Azure dev Spaces][how-it-works-remote-debugging].


[how-it-works-remote-debugging]: how-dev-spaces-works-remote-debugging.md