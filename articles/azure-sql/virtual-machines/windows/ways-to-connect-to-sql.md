---
title: Подключение к виртуальной машине SQL Server (Resource Manager) | Документация Майкрософт
description: Сведения о том, как подключиться к виртуальной машине SQL Server в Azure. В этом разделе используется классическая модель развертывания. Сценарии различаются в зависимости от конфигурации сети и расположения клиента.
services: virtual-machines-windows
documentationcenter: na
author: MashaMSFT
tags: azure-resource-manager
ms.assetid: aa5bf144-37a3-4781-892d-e0e300913d03
ms.service: virtual-machines-sql
ms.topic: how-to
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 12/12/2017
ms.author: mathoma
ms.reviewer: jroth
ms.openlocfilehash: 26052441d19abb6a0c423a3b3d6f6c2d21478814
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91272065"
---
# <a name="connect-to-a-sql-server-virtual-machine-on-azure"></a>Подключение к виртуальной машине SQL Server в Azure
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

## <a name="overview"></a>Обзор

В этом разделе показано, как подключиться к SQL на виртуальной машине Azure. Здесь рассмотрены некоторые [общие сценарии подключения](#connection-scenarios), а также описаны [действия на портале по изменению параметров подключения](#change). Если необходимо устранить неполадки или настроить подключение за пределами портала, см. инструкции по [настройке вручную](#manual) ниже. 

Если вам нужно полное пошаговое руководство по подготовке и подключению, см. статью [Как подготовить виртуальную машину SQL Server на платформе Windows на портале Azure](create-sql-vm-portal.md).

## <a name="connection-scenarios"></a>Сценарии подключения

Способ подключения клиента к виртуальной машине SQL Server зависит от расположения клиента и конфигурации сети.

При подготовке виртуальной машины SQL Server на портале Azure вы можете указать тип **подключения SQL**.

![Общедоступное подключение SQL во время подготовки](./media/ways-to-connect-to-sql/sql-vm-portal-connectivity.png)

Варианты подключения:

| Параметр | Описание |
|---|---|
| **Открытый** | Подключение к SQL Server через Интернет. |
| **Частное** | Подключение к SQL Server в пределах одной виртуальной сети. |
| **Локальное** | Локальное подключение к SQL Server на той же виртуальной машине. | 

В следующих разделах более подробно описаны типы подключения **Общедоступное** и **Частное**.

## <a name="connect-to-sql-server-over-the-internet"></a>Подключение к SQL Server через Интернет

Если вы хотите подключиться к ядру СУБД SQL Server из Интернета, на портале во время подготовки выберите для **подключения SQL** вариант **Общедоступное**. Действия, автоматически выполняемые порталом:

* включение протокола TCP/IP для SQL Server;
* настройка правила брандмауэра для открытия TCP-порта SQL Server (по умолчанию 1433);
* включение аутентификации SQL Server, требуемой для предоставления общего доступа;
* настройка группы безопасности сети на виртуальной машине для применения ко всему TCP-трафику, поступающему на порт SQL Server.

> [!IMPORTANT]
> Образ виртуальной машины для выпусков SQL Server Developer и Express не включает протокол TCP/IP автоматически. Для выпусков Developer и Express после создания виртуальной машины необходимо [вручную включить протокол TCP/IP](#manualtcp) в диспетчере конфигурации SQL Server.

После этого любой клиент с доступом к Интернету сможет подключиться к экземпляру SQL Server, указав общедоступный IP-адрес виртуальной машины или имя DNS, назначенное этому IP-адресу. Если порт SQL Server — 1433, необходимо указать его в строке подключения. Следующая строка подключения позволяет подключиться к виртуальной машине SQL с меткой DNS `sqlvmlabel.eastus.cloudapp.azure.com` с использованием проверки подлинности SQL (также можно использовать общедоступный IP-адрес).

```
Server=sqlvmlabel.eastus.cloudapp.azure.com;Integrated Security=false;User ID=<login_name>;Password=<your_password>
```

Хотя строка подключения обеспечивает подключение клиентов через Интернет, это не значит, что любой пользователь сможет подключиться к вашему экземпляру SQL Server. Внешние клиенты должны иметь правильные имя пользователя и пароль. Тем не менее для обеспечения дополнительной безопасности можно использовать вместо порта 1433 другой порт. Например, если вы настроите SQL Server на прослушивание порта 1500 и настроите соответствующие правила брандмауэра и группы безопасности сети, для подключения можно будет добавить к имени сервера номер порта. В примере ниже предыдущий порт изменяется после добавления номера настраиваемого порта (**1500**) к имени сервера:

```
Server=sqlvmlabel.eastus.cloudapp.azure.com,1500;Integrated Security=false;User ID=<login_name>;Password=<your_password>"
```

> [!NOTE]
> При обращении к SQL Server на виртуальной машине через Интернет, за все данные, поступающие из центра обработки данных Azure, взимается обычная [плата за исходящий трафик](https://azure.microsoft.com/pricing/details/data-transfers/).

## <a name="connect-to-sql-server-within-a-virtual-network"></a>Подключение к SQL Server в пределах одной виртуальной сети

Если на портале вы выберете для **подключения SQL** вариант **Частное**, Azure настроит большинство параметров так же, как и для варианта **Общедоступное**. Единственное отличие заключается в том, что отсутствует правило группы безопасности сети для разрешения внешнего трафика через порт SQL Server (по умолчанию 1433).

> [!IMPORTANT]
> Образ виртуальной машины для выпусков SQL Server Developer и Express не включает протокол TCP/IP автоматически. Для выпусков Developer и Express после создания виртуальной машины необходимо [вручную включить протокол TCP/IP](#manualtcp) в диспетчере конфигурации SQL Server.

Частное подключение часто используется в сочетании с [виртуальной сетью](../../../virtual-network/virtual-networks-overview.md), что позволяет реализовать несколько сценариев. Вы можете подключить виртуальные машины в одной виртуальной сети, даже если они расположены в разных группах ресурсов. Если используется [VPN типа «сеть-сеть»](../../../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md), можно создать гибридную архитектуру, обеспечивающую подключение виртуальных машин к локальным сетям и компьютерам.

Виртуальные сети также позволяют присоединять виртуальные машины Azure к домену. Это единственный способ использовать проверку подлинности Windows для SQL Server. Другие сценарии подключения требуют проверки подлинности SQL с использованием имен пользователей и паролей.

Если вы настроили DNS в своей виртуальной сети, то сможете подключиться к экземпляру SQL Server, указав имя узла виртуальной машины SQL Server в строке подключения. В следующем примере также предполагается, что настроена проверка подлинности Windows, а пользователю предоставлен доступ к экземпляру SQL Server.

```
Server=mysqlvm;Integrated Security=true
```

## <a name="change-sql-connectivity-settings"></a><a id="change"></a> Изменение параметров подключения к SQL

[!INCLUDE [windows-virtual-machines-sql-use-new-management-blade](../../../../includes/windows-virtual-machines-sql-new-resource.md)]

Можно изменить параметры подключения для вашей виртуальной машины SQL Server на портале Azure.

1. На портале Azure выберите **Виртуальные машины SQL**.

2. Выберите виртуальную машину SQL Server.

3. В разделе **Параметры** выберите **Безопасность**.

4. Измените **уровень подключения SQL**, выбрав необходимый параметр. При необходимости эту область можно использовать, чтобы изменить порт SQL Server или параметры аутентификации SQL.

   ![Изменение параметров подключения к SQL](./media/ways-to-connect-to-sql/sql-vm-portal-connectivity-change.png)

5. Подождите несколько минут, пока установка обновления не будет завершена.

   ![Уведомление об обновлении виртуальной машины SQL](./media/ways-to-connect-to-sql/sql-vm-updating-notification.png)

## <a name="enable-tcpip-for-developer-and-express-editions"></a><a id="manualtcp"></a> Включение TCP/IP для выпусков Developer и Express

При изменении параметров подключения к SQL Server Azure не включает протокол TCP/IP для выпусков SQL Server Developer и Express автоматически. Ниже описано, как вручную включить TCP/IP для удаленного подключения по IP-адресу.

Сначала подключитесь к виртуальной машине SQL Server через удаленный рабочий стол.

[!INCLUDE [Connect to SQL Server VM with remote desktop](../../../../includes/virtual-machines-sql-server-remote-desktop-connect.md)]

Затем включите протокол TCP/IP в **диспетчере конфигурации SQL Server**.

[!INCLUDE [Connect to SQL Server VM with remote desktop](../../../../includes/virtual-machines-sql-server-connection-tcp-protocol.md)]

## <a name="connect-with-ssms"></a>Подключение к SSMS

Ниже показано, как создать необязательную метку DNS для виртуальной машины Azure и подключиться с помощью SQL Server Management Studio (SSMS).

[!INCLUDE [Connect to SQL Server in a VM Resource Manager](../../../../includes/virtual-machines-sql-server-connection-steps-resource-manager.md)]

## <a name="manual-configuration-and-troubleshooting"></a><a id="manual"></a> Настройка вручную и устранение неполадок

Хотя портал предоставляет возможности для автоматической настройки подключения, полезно знать, как настроить подключение вручную. Знакомство с требованиями также будет полезным при устранении неполадок.

В следующей таблице перечислены требования для подключения к SQL Server на виртуальной машине Azure.

| Требование | Описание |
|---|---|
| [Включите режим проверки подлинности SQL Server](/sql/database-engine/configure-windows/change-server-authentication-mode#use-ssms) | Для удаленного подключения к виртуальной машине требуется проверка подлинности SQL Server, если в виртуальной сети не настроена служба Active Directory. |
| [Создайте имя входа SQL](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/create-a-login) | При использовании проверки подлинности SQL требуются учетные данные SQL с именем пользователя и паролем, у которых есть разрешения для доступа к целевой базе данных. |
| [Включите протокол TCP/IP](#manualtcp) | SQL Server должен разрешать подключения по протоколу TCP. |
| [Включите правило брандмауэра для порта SQL Server](https://docs.microsoft.com/sql/database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access) | Брандмауэр на виртуальной машине должен разрешать входящий трафик на порту SQL Server (по умолчанию 1433). |
| [Создайте правило группы безопасности сети для TCP 1433](../../../virtual-network/manage-network-security-group.md#create-a-security-rule) | Необходимо разрешить виртуальной машине получать трафик через порт SQL Server (по умолчанию 1433), если нужно выполнить подключение через Интернет. Для локальных подключений и подключений к виртуальным сетям это не требуется. Это единственный шаг, выполняемый на портале Azure. |

> [!TIP]
> Действия, описанные в предыдущей таблице, выполняются при настройке подключения на портале. Используйте их только для проверки конфигурации или настройки подключения к SQL Server вручную.

## <a name="next-steps"></a>Дальнейшие действия

Инструкции по подготовке и действия по подключению приведены в статье [Как подготовить виртуальную машину SQL Server на платформе Windows на портале Azure](create-sql-vm-portal.md).

Другие темы, связанные с запуском SQL Server на виртуальных машинах Azure, рассматриваются в статье [SQL Server на виртуальных машинах Azure](sql-server-on-azure-vm-iaas-what-is-overview.md).
