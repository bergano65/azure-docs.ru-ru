---
title: Подготавливает виртуальную машину Windows к портал Azure
description: В этом руководстве описываются параметры, доступные при использовании портал Azure для инициализации SQL Server на виртуальной машине Windows.
services: virtual-machines-windows
documentationcenter: na
author: MashaMSFT
tags: azure-resource-manager
ms.assetid: 1aff691f-a40a-4de2-b6a0-def1384e086e
ms.service: virtual-machines-sql
ms.topic: how-to
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: infrastructure-services
ms.date: 11/07/2019
ms.author: mathoma
ms.reviewer: jroth
ms.custom: seo-lt-2019
ms.openlocfilehash: a7cd15bab0b26a13f9ffb818aa29e8e262c0bd06
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91332922"
---
# <a name="how-to-use-the-azure-portal-to-provision-a-windows-virtual-machine-with-sql-server"></a>Использование портал Azure для инициализации виртуальной машины Windows с SQL Server

[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

В этом руководстве описаны параметры, позволяющие использовать портал Azure для инициализации SQL Server на виртуальной машине Windows. В этой статье описываются дополнительные параметры конфигурации, отличные от [краткого руководства по SQL Server виртуальной машине](sql-vm-create-portal-quickstart.md), который посвящен более глубокой настройке. 

Используйте это руководство, чтобы создать собственную виртуальную машину SQL Server. Его также можно использовать как справочник по параметрам, доступным на портале Azure.

> [!TIP]
> Если у вас есть вопросы по виртуальным машинам SQL Server, см. раздел [часто задаваемых вопросов](frequently-asked-questions-faq.md).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="sql-server-virtual-machine-gallery-images"></a><a id="select"></a> Образы из коллекции виртуальных машин SQL Server

При создании виртуальной машины SQL Server можно выбрать один из нескольких предварительно настроенных образов, доступных в коллекции виртуальных машин. Ниже приведены инструкции по выбору одного из образов SQL Server 2017.

1. На портале Azure в меню слева выберите **Azure SQL**. Если **Azure SQL** отсутствует в списке, выберите **Все службы** и в поле поиска введите *Azure SQL*. 

   Можно также выбрать звездочку рядом с **Azure SQL** , чтобы сохранить ее в избранном, и добавить ее в качестве элемента в левую навигацию. 

1. Щелкните **+ Добавить**, чтобы открыть страницу **Выбор варианта развертывания SQL**. Чтобы просмотреть дополнительные сведения, щелкните **Показать подробности**. 
1. Введите *2017* в поле поиска изображений SQL Server на плитке **виртуальные машины SQL** , а затем выберите **бесплатная SQL Server Лицензия: SQL Server 2017 Developer на Windows Server 2016** из раскрывающегося списка. 

   ![Выбор образа виртуальной машины SQL](./media/create-sql-vm-portal/select-sql-vm-image-portal.png)

   > [!TIP]
   > В этой статье используется выпуск Developer, поскольку он является полнофункциональным бесплатным выпуском SQL Server для тестирования разработки. Вы оплачиваете только стоимость выполнения виртуальной машины. Но вы можете выбрать для использования в этом пошаговом руководстве любой образ. Описание доступных образов см. в разделе [Начало работы с виртуальными машинами SQL](sql-server-on-azure-vm-iaas-what-is-overview.md#payasyougo).

   > [!TIP]
   > Стоимость лицензий для SQL Server включена в цену секунды использования создаваемой виртуальной машины и зависит от выпуска и числа ядер. Однако выпуск SQL Server Developer Edition предоставляется бесплатно для разработки и тестирования, а не для рабочей среды. Кроме того, SQL Express предоставляется бесплатно для упрощенных рабочих нагрузок (менее 1 ГБ памяти, менее 10 ГБ хранилища). Можно также использовать собственную лицензию (BYOL) и платить только за виртуальную машину. Имена таких образов содержат префикс {BYOL}. 
   >
   > Дополнительные сведения об этих параметрах см. в [руководстве по выбору ценовой категории для виртуальных машин Azure SQL Server](pricing-guidance.md).


1. Нажмите кнопку **создания**.


## <a name="1-configure-basic-settings"></a>1. Настройка основных параметров.

На вкладке **Основные сведения** укажите следующую информацию.

* На вкладке **Сведения о проекте** должна быть выбрана правильная подписка. 
* В разделе **Группа ресурсов** выберите имеющуюся группу ресурсов из списка или щелкните **Создать**, чтобы создать новую группу ресурсов. Группа ресурсов — это коллекция связанных ресурсов в Azure (виртуальные машины, учетные записи хранения, виртуальные сети и т. д.). 

  ![Подписка](./media/create-sql-vm-portal/basics-project-details.png)

  > [!NOTE]
  > Рекомендуется использовать новую группу ресурсов для тестирования или изучения процесса развертывания SQL Server в Azure. После завершения теста удалите группу ресурсов, чтобы автоматически удалить виртуальную машину и все ресурсы, связанные с этой группой ресурсов. Дополнительные сведения о группах ресурсов см. в статье [Общие сведения об Azure Resource Manager](../../../active-directory-b2c/overview.md).


* В разделе **Сведения об экземпляре**:

    1. В поле **Имя виртуальной машины** введите уникальное имя ВМ.  
    1. Выберите расположение для параметра **Регион**. 
    1. В этом руководстве оставьте в поле **Параметры доступности** значение _Избыточность инфраструктуры не требуется_. См. подробнее о [регионах и доступности виртуальных машин в Azure](../../../virtual-machines/windows/availability.md). 
    1. В списке **Образ** выберите _Free SQL Server License: SQL Server 2017 Developer on Windows Server 2016_ (Бесплатная лицензия на SQL Server: SQL Server 2017 Developer на базе Windows Server 2016).  
    1. Выберите **Изменить размер** для параметра **Размер** виртуальной машины, а затем выберите предложение **A2 Basic**. Обязательно очистите ресурсы после завершения работы с ними, чтобы предотвратить любые непредвиденные расходы. Для рабочих нагрузок изучите рекомендации по размерам машин SQL Server и их настройке в статье [Рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure](performance-guidelines-best-practices.md).

    ![Подробности об экземпляре](./media/create-sql-vm-portal/basics-instance-details.png)

> [!IMPORTANT]
> В расчетную ежемесячную стоимость, указанную в окне **Выбор размера**, не включена стоимость лицензирования SQL Server. Это только стоимость виртуальной машины. Для выпусков SQL Server Express и Developer указана итоговая расчетная стоимость. Получить сведения о других выпусках можно на странице [цен на виртуальные машины Windows](https://azure.microsoft.com/pricing/details/virtual-machines/windows/), где вы можете выбрать целевой выпуск SQL Server. См. также [руководство по выбору ценовой категории для виртуальных машин Azure SQL Server](pricing-guidance.md) и статью [Размеры виртуальных машин](../../../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).

* В разделе **учетная запись администратора**укажите имя пользователя и пароль. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../../../virtual-machines/windows/faq.md#what-are-the-password-requirements-when-creating-a-vm).

   ![Учетная запись администратора](./media/create-sql-vm-portal/basics-administrator-account.png)

* В разделе **Правила входящего порта** щелкните **Разрешить выбранные порты**, а затем выберите **RDP (3389)** из раскрывающегося списка. 

   ![Правила для входящих портов](./media/create-sql-vm-portal/basics-inbound-port-rules.png)


## <a name="2-configure-optional-features"></a>2. Настройка дополнительных возможностей

### <a name="disks"></a>Диски

На вкладке **Диски** настройте параметры диска. 

* Для параметра **Тип диска ОС** выберите нужный тип диска для операционной системы в раскрывающемся списке. Для рабочих систем рекомендуется использовать категорию "Премиум", но она недоступна для виртуальной машины категории "Базовый". Чтобы использовать SSD (цен. категория "Премиум"), измените размер виртуальной машины. 
* В разделе **Дополнительно** выберите **Да** для параметра **Использование управляемых дисков**.

   > [!NOTE]
   > Корпорация Майкрософт рекомендует использовать управляемые диски для SQL Server. Управляемые диски управляют хранилищем в фоновом режиме. Кроме того, когда виртуальные машины с управляемыми дисками находятся в одной группе доступности, Azure распределяет ресурсы хранения, чтобы обеспечить соответствующую избыточность. Дополнительные сведения см. в статье [Общие сведения об управляемых дисках Azure](../../../virtual-machines/managed-disks-overview.md). Подробные сведения об управляемых дисках в группе доступности см. в статье [Управление доступностью виртуальных машин Windows в Azure](../../../virtual-machines/windows/manage-availability.md).

![Параметры диска виртуальной машины SQL](./media/create-sql-vm-portal/azure-sqlvm-disks.png)
  
  
### <a name="networking"></a>Сеть

На вкладке **Сеть** настройте сетевые параметры. 

* Создайте новую **виртуальную сеть** или используйте существующую виртуальную сеть для SQL Server виртуальной машины. Также выберите значение для параметра **Подсеть**. 

* В разделе **Сетевая группа безопасности сети**выберите базовую группу безопасности или расширенную группу безопасности. Выбор параметра "базовый" позволяет выбрать входящие порты для SQL Server виртуальной машины, которые имеют одинаковые значения, настроенные на вкладке " **основные** ". Выбор параметра дополнительно позволяет выбрать существующую группу безопасности сети или создать новую. 

* Вы можете изменить другие параметры сети или оставить их значения по умолчанию.

![Параметры сети виртуальной машины SQL](./media/create-sql-vm-portal/azure-sqlvm-networking.png)

#### <a name="monitoring"></a>Наблюдение

На вкладке **мониторинг** Настройте мониторинг и автоматическое завершение работы. 

* В Azure по умолчанию включен параметр **Диагностика загрузки** в учетной записи хранения, которая будет использоваться для виртуальной машины. На этой вкладке можно изменить эти параметры и включить **систему диагностики гостевых ОС**. 
* На этой вкладке можно также включить **управляемое удостоверение, назначенное системой** , и выполнить **Автоматическое завершение работы** . 

![Параметры управления виртуальной машиной SQL](./media/create-sql-vm-portal/azure-sqlvm-management.png)


## <a name="3-configure-sql-server-settings"></a>3. Настройка параметров SQL Server

На вкладке **Настройки SQL Server** укажите нужные параметры и настройте оптимизацию для SQL Server. Для SQL Server можно настроить следующие параметры.

- [Соединение](#connectivity)
- [Аутентификация](#authentication)
- [Интеграция с Azure Key Vault](#azure-key-vault-integration)
- [Конфигурация хранилища](#storage-configuration)
- [Автоматическая установка исправлений](#automated-patching)
- [Автоматическая архивация](#automated-backup)
- [Службы машинного обучения](#machine-learning-services)


### <a name="connectivity"></a>Соединение

В разделе **Подключение SQL**укажите необходимый тип доступа к экземпляру SQL Server на этой виртуальной машине. В рамках этого пошагового руководства выберите **Общедоступный (Интернет)** для подключения к SQL Server с компьютеров или из служб в Интернете. Если этот параметр выбран, Azure автоматически настраивает брандмауэр и группу безопасности сети, чтобы разрешить трафик через выбранный порт.

> [!TIP]
> По умолчанию сервер SQL Server ожидает передачи данных через стандартный порт **1433**. Для повышения безопасности измените порт в предыдущем диалоговом окне, чтобы ожидать передачи данных через нестандартный порт, например 1401. При изменении порта необходимо подключиться с помощью этого порта из любого клиентского средства, например SQL Server Management Studio (SSMS).

![Безопасность виртуальной машины SQL](./media/create-sql-vm-portal/azure-sqlvm-security.png)

Чтобы подключиться к SQL Server через Интернет, также необходимо включить проверку подлинности SQL Server, как описано в следующем разделе.

Если вы не хотите включать подключения к ядру СУБД через Интернет, выберите один из следующих вариантов:

* **Локальное (только в виртуальной машине)** — для подключения к SQL Server только в пределах самой виртуальной машины.
* **Частное (в виртуальной сети)** — для подключения к SQL Server с машин или из служб в той же виртуальной сети.

Как правило, чтобы повысить уровень безопасности, необходимо выбрать наиболее подходящий тип подключения для выполнения вашего сценария. Но все эти параметры являются защищаемыми с помощью правил группы безопасности сети (NSG) и проверки подлинности SQL/Windows. Вы можете изменить NSG после создания виртуальной машины. Дополнительные сведения см. в статье [Вопросы безопасности SQL Server на виртуальных машинах Azure](security-considerations-best-practices.md).

### <a name="authentication"></a>Аутентификация

Если требуется SQL Server проверка подлинности, выберите **включить** в разделе **Проверка подлинности SQL** на вкладке **параметры SQL Server** .

![Проверка подлинности SQL Server](./media/create-sql-vm-portal/azure-sqlvm-authentication.png)

> [!NOTE]
> Если вы планируете получить доступ к SQL Server через Интернет (параметр общедоступного подключения), необходимо включить проверку подлинности SQL здесь. Для общего доступа к SQL Server требуется проверка подлинности SQL.

Если вы включаете проверку подлинности SQL Server, укажите **имя для входа** и **пароль**. Это имя для входа настроено в качестве имени входа для проверки подлинности SQL Server и члена предопределенной роли сервера **sysadmin** . Дополнительные сведения о режимах проверки подлинности см. в [этой статье](https://docs.microsoft.com/sql/relational-databases/security/choose-an-authentication-mode).

Если вы предпочитаете не включать проверку подлинности SQL Server, можно использовать учетную запись локального администратора на виртуальной машине для подключения к экземпляру SQL Server.

### <a name="azure-key-vault-integration"></a>Интеграция с хранилищем ключей Azure

Чтобы сохранить секреты безопасности в Azure для шифрования, на вкладке **Параметры SQL Server** прокрутите вниз до раздела **Интеграция Azure Key Vault**. Выберите **Включить** и укажите необходимые сведения. 

![Интеграция с хранилищем ключей Azure](./media/create-sql-vm-portal/azure-sqlvm-akv.png)

В следующей таблице перечислены параметры, необходимые для настройки интеграции Azure Key Vault (AKV).

| ПАРАМЕТР | DESCRIPTION | ПРИМЕР |
| --- | --- | --- |
| **URL-адрес хранилища ключей** |Расположение хранилища ключей. |`https://contosokeyvault.vault.azure.net/` |
| **Имя субъекта** |Имя субъекта-службы Azure Active Directory. Этот имя также называется идентификатором клиента. |`fde2b411-33d5-4e11-af04eb07b669ccf2` |
| **Секрет субъекта** |Секрет субъекта-службы Azure Active Directory. Этот секрет также называется секретом клиента. |`9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM=` |
| **Имя учетных данных** |**Имя учетных данных**: интеграция AKV создает учетные данные в SQL Server и позволяет виртуальной машине получить доступ к хранилищу ключей. Выберите имя для этих учетных данных. |`mycred1` |

Дополнительные сведения см. в статье [Настройка интеграции хранилища ключей Azure для SQL Server на виртуальных машинах Azure (Resource Manager)](azure-key-vault-integration-configure.md).

### <a name="storage-configuration"></a>Конфигурация хранилища

На вкладке **Параметры SQL Server** в разделе **Конфигурация хранилища** выберите **Изменить конфигурацию**, чтобы открыть страницу "Конфигурация хранилища, оптимизированного для высокой производительности", и укажите требования к хранилищу.

![Конфигурация хранилища виртуальной машины SQL](./media/create-sql-vm-portal/sql-vm-storage-configuration-provisioning.png)

В разделе **Storage optimized for**(Оптимизация хранилища) выберите один из следующих вариантов.

* **Общая** — это значение по умолчанию, которое поддерживает большинство рабочих нагрузок.
* **Транзакционная обработка** оптимизирует хранилище для рабочих нагрузок OLTP в традиционных базах данных.
* **Хранилище данных** оптимизирует хранилище для рабочих нагрузок аналитики и отчетов.

![Конфигурация хранилища виртуальной машины SQL](./media/create-sql-vm-portal/sql-vm-storage-configuration.png)

Можно оставить значения по умолчанию или вручную изменить топологию хранилища в соответствии с потребностями в операциях ввода-вывода. Дополнительные сведения см. в статье о [настройке хранилища](storage-configuration.md). 

### <a name="sql-server-license"></a>Лицензия SQL Server

Если вы являетесь клиентом Software Assurance, вы можете использовать [преимущество гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-benefit/) , чтобы получить собственную лицензию SQL Server и сэкономить на ресурсах. 

![Лицензия на виртуальную машину SQL](./media/create-sql-vm-portal/azure-sqlvm-license.png)

### <a name="automated-patching"></a>Автоматическое исправление

**Automated patching** включен по умолчанию. Автоматическая установка исправлений позволяет Azure автоматически исправлять SQL Server и операционную систему. Укажите день недели, время и длительность периода обслуживания. Azure устанавливает исправления в период обслуживания. Расписание периода обслуживания использует языковой стандарт виртуальной машины. Если вы не хотите, чтобы Azure автоматически исправляет SQL Server и операционную систему, выберите **Отключить**.  

![Автоматическая установка исправлений на виртуальной машине SQL](./media/create-sql-vm-portal/azure-sqlvm-automated-patching.png)

Дополнительные сведения см. в статье [Автоматическая установка исправлений SQL Server на виртуальных машинах Azure (Resource Manager)](automated-patching.md).

### <a name="automated-backup"></a>Автоматическая архивация

Включите автоматическую архивацию для всех баз данных в разделе **Автоматическая архивация**. По умолчанию автоматическая архивация отключена.

Во время включения автоматического резервного копирования SQL можно настроить следующие параметры:

* срок хранения (в днях) для резервных копий;
* учетная запись хранения, используемая для резервных копий;
* параметр шифрования и пароль для резервных копий.
* архивация системных баз данных;
* настройка расписания архивации баз данных.

Чтобы зашифровать резервную копию, выберите **включить**. Затем введите **пароль**. Azure создает сертификат для шифрования резервных копий и использует указанный пароль для защиты этого сертификата. По умолчанию расписание задается автоматически, но можно создать график резервного копирования вручную, выбрав **Вручную**. 

![Автоматическая архивация на виртуальной машине SQL](./media/create-sql-vm-portal/automated-backup.png)

Дополнительную информацию см. в статье [Автоматическая архивация SQL Server на виртуальных машинах Azure (Resource Manager)](automated-backup-sql-2014.md).


### <a name="machine-learning-services"></a>Служба машинного обучения

Вы можете включить [Службы машинного обучения](/sql/advanced-analytics/). Этот параметр позволяет использовать машинное обучение с Python и R в SQL Server 2017. Выберите **Включить** в окне **Параметры SQL Server**.


## <a name="4-review--create"></a>4. Отзыв и создание

На вкладке " **Проверка и создание** " выполните следующие действия.
1. Проверьте сводные данные.
1. Выберите **создать** , чтобы создать SQL Server, группу ресурсов и ресурсы, указанные для этой виртуальной машины.

Развертывание можно отслеживать на портале Azure. Если нажать кнопку **Уведомления** в верхней части окна, будут показаны основные сведения о состоянии развертывания.

> [!NOTE]
> Пример времени для развертывания SQL Server виртуальной машины в Azure. тестовая SQL Server виртуальная машина, подготовленная в регионе "Восточная часть США" с параметрами по умолчанию, занимает около 12 минут. В зависимости от вашего региона и выбранных параметров могут возникать более быстрые или медленные периоды развертывания.

## <a name="open-the-vm-with-remote-desktop"></a><a id="remotedesktop"></a> Открытие виртуальных машин с помощью удаленного рабочего стола

Выполните следующие действия, чтобы подключиться к SQL Server виртуальной машине с помощью протокол удаленного рабочего стола (RDP).

[!INCLUDE [Connect to SQL Server VM with remote desktop](../../../../includes/virtual-machines-sql-server-remote-desktop-connect.md)]

После подключения к виртуальной машине SQL Server вы можете запустить SQL Server Management Studio и подключиться с проверкой подлинности Windows, используя свои учетные данные локального администратора. Если включена проверка подлинности SQL Server, можно также подключиться с проверкой подлинности SQL, используя имя пользователя и пароль SQL, настроенные во время подготовки.

Доступ к машине позволяет напрямую изменять настройки компьютера и SQL Server в зависимости от ваших требований. Например, можно настроить параметры брандмауэра или изменить параметры конфигурации SQL Server.

## <a name="connect-to-sql-server-remotely"></a><a id="connect"></a> Удаленное подключение к SQL Server

В рамках этого пошагового руководства для виртуальной машины используется **открытый** доступ и **аутентификация SQL Server**. Эти параметры позволяют автоматически настроить виртуальную машину для получения доступа к экземпляру SQL Server из любого клиента через Интернет (при условии, что будет использоваться правильное имя пользователя SQL).

> [!NOTE]
> Если вы не выбрали открытый доступ во время подготовки, можно изменить параметры подключения к SQL на портале после подготовки. Дополнительные сведения см. в разделе [об изменении параметров подключения SQL](ways-to-connect-to-sql.md#change).

В следующих разделах описано, как подключиться к вашему экземпляру виртуальной машины SQL Server через Интернет.

[!INCLUDE [Connect to SQL Server in a VM Resource Manager](../../../../includes/virtual-machines-sql-server-connection-steps-resource-manager.md)]

  > [!NOTE]
  > В этом примере используется общий порт 1433. Однако если во время развертывания виртуальной машины SQL Server был указан другой порт (например, 1401), это значение потребуется изменить. 


## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об использовании SQL Server в Azure см. в статье [Приступая к работе с SQL Server в виртуальных машинах Azure](sql-server-on-azure-vm-iaas-what-is-overview.md) и [Часто задаваемые вопросы об SQL Server в виртуальных машинах Azure](frequently-asked-questions-faq.md).
