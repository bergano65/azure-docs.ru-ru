---
title: Обзор групп доступности Always On SQL Server
description: В этой статье описаны группы доступности Always On SQL Server в Виртуальных машинах Azure.
services: virtual-machines
documentationCenter: na
author: MashaMSFT
editor: monicar
tags: azure-service-management
ms.assetid: 601eebb1-fc2c-4f5b-9c05-0e6ffd0e5334
ms.service: virtual-machines-sql
ms.topic: overview
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 10/07/2020
ms.author: mathoma
ms.custom: seo-lt-2019, devx-track-azurecli
ms.openlocfilehash: 4919abd29ecf10c9116257750374ef53b4bd9d16
ms.sourcegitcommit: 400f473e8aa6301539179d4b320ffbe7dfae42fe
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/28/2020
ms.locfileid: "92789919"
---
# <a name="always-on-availability-group-on-sql-server-on-azure-vms"></a>Группы доступности Always On для SQL Server на виртуальных машинах Azure
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

В этой статье приводятся общие сведения о группах доступности Always On для SQL Server на виртуальных машинах Azure. 

## <a name="overview"></a>Обзор

Группы доступности Always On на виртуальных машинах Azure аналогичны [группам доступности Always On в локальной среде](/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server). Но виртуальные машины размещаются в среде Azure, а значит придется учесть ряд дополнительных аспектов, например избыточность виртуальных машин и маршрутизация трафика в сети Azure. 

На следующей схеме показано использование группы доступности SQL Server на виртуальных машинах Azure:

![Группа доступности](./media/availability-group-overview/00-EndstateSampleNoELB.png)


## <a name="vm-redundancy"></a>Избыточность виртуальных машин 

Для повышения избыточности и обеспечения высокого уровня доступности виртуальные машины SQL Server должны находиться в одной [группе доступности](../../../virtual-machines/windows/tutorial-availability-sets.md#availability-set-overview) или в разных [зонах доступности](../../../availability-zones/az-overview.md).

Группа доступности служит средством для объединения ресурсов, которые необходимо размещать в разных зонах доступности. Этот механизм запрещает одновременное задействование ресурсов из одной группы при плановом развертывании обновлений. 


## <a name="connectivity"></a>Соединение 

В обычном локальном развертывании клиенты подключаются к прослушивателю группы доступности через имя виртуальной сети (VNN), а этот прослушиватель направляет трафик на подходящие реплики SQL Server в зоне доступности. Но в сети Azure существует дополнительное требование по маршрутизации трафика. 

Если SQL Server размещен на виртуальных машинах Azure, вам нужно настроить [подсистему балансировки нагрузки](availability-group-vnn-azure-load-balancer-configure.md) для передачи трафика прослушивателю группы доступности. В SQL Server 2019 CU8 и более поздних версиях можно настроить [прослушиватель имени распределенной сети (DNN)](availability-group-distributed-network-name-dnn-listener-configure.md) вместо обычного прослушивателя VNN для группы доступности. 


### <a name="vnn-listener"></a>Прослушиватель VNN 

Служба [Azure Load Balancer](../../../load-balancer/load-balancer-overview.md) позволяет направлять трафик от клиентов на обычный прослушиватель VNN групп доступности, размещенный в сети Azure. 

Подсистема балансировки нагрузки хранит IP-адреса прослушивателя VNN. Если используется несколько групп доступности, для каждой из них требуется собственный прослушиватель VNN. Одна подсистема балансировки нагрузки может обслуживать несколько прослушивателей.

Прежде всего [настройте подсистему балансировки нагрузки](availability-group-vnn-azure-load-balancer-configure.md). 

### <a name="dnn-listener"></a>Прослушиватель DNN

В SQL Server 2019 версии CU8 добавлена поддержка прослушивателя имени распределенной сети (DNN). Прослушиватель DNN заменяет собой традиционный прослушиватель группы доступности, избавляя от необходимости создавать Azure Load Balancer для перенаправления трафика в сеть Azure. 

Прослушиватель DNN рекомендуется в качестве решения для обеспечения высокой доступности и аварийного восстановления в сети Azure, так как позволяет упростить развертывание, снизить затраты и ресурсы на обслуживание, а также сократить время отработки отказа в случае сбоя. 

Разверните прослушиватель DNN вместо существующего прослушивателя VNN или используйте их параллельно, чтобы у групп доступности было две раздельные точки подключения, из которых одна использует имя (и порт, если он отличается от стандартного) прослушивателя VNN, а вторая — имя и порт прослушивателя DNN. Такой механизм может оказаться полезным для тех клиентов, которые хотят избежать задержек отработки отказа, связанных с наличием подсистемы балансировки нагрузки, сохраняя преимущества, предоставляемые сочетанием SQL Server и прослушивателя VNN, например распределенные группы доступности, брокер служб и файловый поток. Дополнительные сведения см. в статье [Взаимодействие функций прослушивателя DNN и SQL Server](availability-group-dnn-interoperability.md).

Прежде всего [настройте прослушиватель DNN](availability-group-distributed-network-name-dnn-listener-configure.md).


## <a name="deployment"></a>Развертывание 

У вас есть несколько вариантов с разным уровнем автоматизации для развертывания групп доступности в SQL Server на виртуальных машинах Azure. 

В следующей таблице собраны данные о доступных вариантах для сравнения. 

| |**[Портал Azure](availability-group-azure-portal-configure.md)**|**[Azure CLI / PowerShell](./availability-group-az-commandline-configure.md)**|**[Шаблоны быстрого запуска](availability-group-quickstart-template-configure.md)**|**[Вручную](availability-group-manually-configure-prerequisites-tutorial.md)** | 
|---------|---------|---------|--------- |---------|
|**Версия SQL Server** |2016 и выше |2016 и выше|2016 и выше|2012 и выше|
|**Выпуск SQL Server** |Enterprise |Enterprise |Enterprise |Enterprise, Standard|
|**Версия Windows Server**| 2016 и выше | 2016 и выше | 2016 и выше | Все| 
|**Автоматическое создание кластера**|Да|Да | Да |Нет|
|**Автоматическое создание группы доступности** |Да |Нет|Нет|Нет|
|**Независимое создание прослушивателя и подсистемы балансировки нагрузки** |Нет|Нет|Нет|Да|
|**Возможность создать прослушиватель DNN**|Нет|Нет|Нет|Да|
|**Конфигурация кворума WSFC**|Облако-свидетель|Облако-свидетель|Облако-свидетель|Все|
|**Аварийное восстановление в нескольких регионах** |Нет|Нет|Нет|Да|
|**Поддержка нескольких подсетей** |Да|Да|Да|Да|
|**Поддержка существующего каталога AD**|Да|Да|Да|Да|
|**Аварийное восстановление с несколькими зонами в одном регионе**|Да|Да|Да|Да|
|**Распределенная группа доступности без домена приложения**|Нет|Нет|Нет|Да|
|**Распределенная группа доступности без кластера** |Нет|Нет|Нет|Да|
||||||



## <a name="considerations"></a>Рекомендации 

Для отказоустойчивого кластера гостевых виртуальных машин IaaS Azure рекомендуется использовать один сетевой адаптер на сервер (узел кластера) и одну подсеть. Сеть Azure обладает физической избыточностью, что делает ненужными дополнительные сетевые адаптеры и подсети в кластере гостевых виртуальных машин IaaS Azure. Несмотря на то, что отчет о проверке кластера выдаст предупреждение о том, что узлы доступны только в одной сети, это предупреждение можно спокойно проигнорировать в отказоустойчивых кластерах гостевых виртуальных машин IaaS Azure. 

## <a name="next-steps"></a>Дальнейшие действия

Изучите [рекомендации по обеспечению высокой доступности и аварийного восстановления](hadr-cluster-best-practices.md), а затем переходите к развертыванию группы доступности [вручную](availability-group-manually-configure-prerequisites-tutorial.md) либо с помощью [портала Azure](availability-group-azure-portal-configure.md), [Azure CLI или PowerShell](./availability-group-az-commandline-configure.md) и [шаблонов быстрого запуска](availability-group-quickstart-template-configure.md).

Кроме того, вы можете развернуть [группу доступности без кластеров](availability-group-clusterless-workgroup-configure.md) или [группу доступности в нескольких регионах](availability-group-manually-configure-multiple-regions.md).