---
title: Управление несколькими базами данных с помощью эластичных пулов
description: Управление и масштабирование нескольких баз данных в базе данных SQL Azure — сотни и тысячи-использование эластичных пулов. Фиксированная цена за ресурсы, которые можно распределить туда, где они нужны.
services: sql-database
ms.service: sql-database
ms.subservice: elastic-pools
ms.custom: sqldbrb=1
ms.devlang: ''
ms.topic: conceptual
author: oslake
ms.author: moslake
ms.reviewer: ninarn, sstein
ms.date: 12/9/2020
ms.openlocfilehash: d1ba9445441f38c55b40a8f8ca55471ea8b0a06d
ms.sourcegitcommit: 273c04022b0145aeab68eb6695b99944ac923465
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "97008594"
---
# <a name="elastic-pools-help-you-manage-and-scale-multiple-databases-in-azure-sql-database"></a>Управление несколькими базами данных в Базе данных SQL Azure и их масштабирование с помощью эластичных пулов
[!INCLUDE[appliesto-sqldb](../includes/appliesto-sqldb.md)]

Эластичные пулы базы данных SQL Azure — это простое и экономичное решение для управления и масштабирования нескольких баз данных, имеющих различные и непредсказуемые требования к использованию. Базы данных в эластичном пуле находятся на одном сервере и совместно используют множество ресурсов по заданной цене. Пулы эластичных БД в базе данных SQL Azure позволяют разработчикам SaaS оптимизировать соотношение цены и производительности для группы баз данных с назначенным бюджетом и при этом обеспечить эластичность производительности для каждой базы данных.

## <a name="what-are-sql-elastic-pools"></a>Эластичные пулы SQL

Разработчики SaaS создают приложения на основе уровней данных большого размера, состоящих из нескольких баз данных. Обычно для каждого клиента подготавливается одна база данных. Но разные клиенты часто имеют различные и непредсказуемые закономерности использования, и трудно спрогнозировать требования к ресурсам каждого отдельного пользователя базы данных. Обычно имеется два варианта:

- избыточная подготовка ресурсов в соответствии с пиковой нагрузкой и переплата или
- подготовка недостаточного числа ресурсов в целях экономии в ущерб производительности и удовлетворенности клиентов во время всплесков загрузки.

Эластичные пулы устраняют эту проблему, обеспечивая базы данных необходимыми ресурсами производительности, когда они нужны. Они предоставляют простой механизм распределения ресурсов в рамках прогнозируемого бюджета. Дополнительные сведения о шаблонах разработки для приложений SaaS, использующих пулы эластичных БД, см. в статье [Шаблоны разработки для мультитенантных приложений SaaS с использованием Базы данных Azure SQL](saas-tenancy-app-design-patterns.md).
>
> [!IMPORTANT]
> Плата за пул эластичных баз данных не зависит от количества баз данных. Вы платите за каждый час существования пула с максимальным количеством единиц eDTU или виртуальных ядер. Использование или активность пула менее одного часа оплачивается как один час.

Пулы эластичных баз данных позволяют разработчикам покупать ресурсы для пула, который совместно используется несколькими базами данных, чтобы обеспечить работу отдельных баз данных в непрогнозируемые периоды использования. Вы можете настроить ресурсы для пула с использованием [модели приобретения на основе единиц DTU](service-tiers-dtu.md) или [модели приобретения на основе виртуальных ядер](service-tiers-vcore.md). Требование к ресурсу для пула определяется совокупным использованием его баз данных. Количество ресурсов, доступных для пула, определяется бюджетом разработчика. Разработчик просто добавляет базы данных в пул, при необходимости задающий минимальное и максимальное количество ресурсов для баз данных (минимальное и максимальное количество DTU или минимальное или максимальное число виртуальных ядер в зависимости от выбранной модели перебора), а затем задает ресурсы пула на основе их бюджета. С помощью пулов разработчик может легко перевести качество своих услуг с уровня небольшой новой компании на уровень состоявшегося бизнеса с возможностями роста.

Отдельным базам данных в пуле предоставляется возможность гибкого автоматического масштабирования в рамках заданных параметров. В условиях интенсивной нагрузки база данных может использовать дополнительные ресурсы для удовлетворения потребности. При небольших нагрузках базы данных используют меньше ресурсов, а при отсутствии нагрузок не используют их вовсе. Подготовка ресурсов для всего пула, а не для отдельной базы данных упрощает задачи управления. Кроме того, используя пул, вы можете спрогнозировать расходы. Дополнительные ресурсы можно добавить в существующий пул с минимальным временем простоя. Точно так же, если ресурсы больше не нужны, они могут быть удалены из имеющегося пула в любой момент. Вы также можете добавлять или удалять базы данных из пула. Если у базы данных прогнозируемо низкие показатели использования ресурсов, ее можно удалить.

> [!NOTE]
> Базы данных перемещаются в эластичный пул или из него без простоев, за исключением короткого периода (порядка нескольких секунд) в конце операции, когда удаляются подключения к базе данных.

## <a name="when-should-you-consider-a-sql-database-elastic-pool"></a>Использование эластичного пула службы "База данных SQL"

Пулы хорошо подходят для большого числа баз данных с конкретными закономерностями использования. Для заданной базы данных эта закономерность характеризуется низким средним использованием с относительно редкими пиками использования. И наоборот, несколько баз данных с постоянным средним уровнем интенсивной загрузки не должны помещаться в один и тот же эластичный пул.

Чем больше баз данных можно добавить в пул, тем больше экономия. В зависимости от шаблона использования приложения можно увидеть экономию с помощью двух баз данных S3.

Следующие разделы помогут вам понять, как оценить преимущества, связанные с использованием пула с определенным набором баз данных. В примерах используются пулы уровня Стандартный, однако эти же принципы применимы к пулам уровней Базовый и Премиум.

### <a name="assessing-database-utilization-patterns"></a>Оценка закономерностей использования баз данных

На следующем рисунке показан пример базы данных, которая большую часть времени находится в режиме ожидания, но также у нее периодически возникают пики активности. Такая модель использования хорошо подходит для пула:

   ![отдельная база данных, подходящая для пула](./media/elastic-pool-overview/one-database.png)

На диаграмме показано использование DTU в течение 1 часа времени с 12:00 до 1:00, где каждая точка данных имеет детализацию в 1 минуту. При 12:10 DB1 пик до 90 DTU, но общее среднее использование составляет менее пяти DTU. Для запуска этой рабочей нагрузки в отдельной базе данных требуется объем вычислительных ресурсов S3, но при этом большая часть ресурсов останется неиспользуемой в периоды низкой активности.

Пул позволяет разделить эти незадействованные единицы DTU между несколькими базами данных, тем самым сокращая общее число необходимых единиц DTU и, следовательно, расходы.

На основе предыдущего примера предположим, что существуют дополнительные базы данных с закономерностями использования, схожими с закономерностью использования базы данных DB1. На следующих двух рисунках показано использование четырех и двадцати баз данных на одной диаграмме, чтобы продемонстрировать, что их использование не пересекается во времени при использовании модели приобретения на основе единиц DTU:

   ![четыре базы данных с закономерностями использования, подходящими для пула](./media/elastic-pool-overview/four-databases.png)

   ![двадцать баз данных с закономерностями использования, подходящими для пула](./media/elastic-pool-overview/twenty-databases.png)

Совокупное использование DTU для всех 20 баз данных представлено черной линией на рисунке выше. На рисунке видно, что совокупное использование DTU никогда не превышает 100 DTU, и показано, что 20 баз данных могут совместно использовать 100 eDTU в этом периоде времени. Это приводит к 20-кратному сокращению количества единиц DTU и 13-кратному снижению цены по сравнению с размещением каждой базы данных с объемом вычислительных ресурсов S3 для отдельных баз данных.

Этот пример является идеальным по следующим причинам.

- Существует большая разница между пиковым использованием и средним использованием для каждой базы данных.
- Пиковое использование для каждой базы данных возникает в разное время.
- eDTU совместно используются многими базами данных.

В модели приобретения DTU Цена пула является функцией пула Edtu. Хотя цена единицы eDTU для пула в 1,5 раза выше цены единицы DTU для отдельной базы данных, **единицы eDTU пула могут совместно использоваться множеством баз данных, следовательно, требуется меньшее общее число единиц eDTU**. Эти различия в цене и совместное использование единиц eDTU является основой возможности экономии, которую может предоставить пул.

В модели приобретения Виртуальное ядро Цена за единицу Виртуальное ядро для эластичных пулов совпадает с ценой единицы Виртуальное ядро для отдельных баз данных.

## <a name="how-do-i-choose-the-correct-pool-size"></a>Выбор пула правильного размера

Наилучший размер пула зависит от совокупного количества ресурсов, необходимых для всех баз данных в пуле. Для этого необходимо определить следующее:

- Максимальное количество ресурсов вычислений, используемых всеми базами данных в пуле.  Ресурсы вычислений индексируются по Edtu или виртуальных ядер в зависимости от выбранной модели приобретения.
- Максимальное число байтов памяти, используемых всеми базами данных в пуле.

Сведения об уровнях служб и ограничениях ресурсов в каждой модели закупок см. в статье [модель приобретения на основе DTU](service-tiers-dtu.md) или [модель приобретения на основе виртуальное ядро](service-tiers-vcore.md).

Следующие шаги помогут оценить более экономичность пула, чем отдельные базы данных.

1. Оцените количество единиц eDTU или виртуальных ядер, необходимых для пула, следующим образом:

Модель приобретения на основе единиц DTU:

MAX (<*Общее число баз данных* X *средней загрузки DTU на> базы данных* , <*число параллельных пиковых нагрузок баз данных* X *пиковое использование DTU на базу данных*>)

Модель приобретения на основе виртуальных ядер:

MAX (<*Общее число баз данных* x *среднего уровня использования Виртуальное ядро на базу данных*>, <*число параллельных пиковых нагрузок баз данных* X *Пиковая загрузка в DB*>)

2. Оцените общий объем хранилища, необходимый для пула, добавив размер данных, необходимый для всех баз данных в пуле. Для модели приобретения DTU Определите размер пула eDTU, который обеспечивает такой объем хранения.
3. Для модели приобретения на основе единиц DTU выберите максимальную из оценок количества единиц eDTU, полученных на шаге 1 и шаге 2. Для модели приобретения на основе виртуальных ядер выберите оценку количества виртуальных ядер, полученную на шаге 1.
4. В статье [Цены на Базу данных SQL Azure](https://azure.microsoft.com/pricing/details/sql-database/) найдите наименьший размер пула, который будет больше оценки, полученной на шаге 3.
5. Сравните цену пула, полученную на шаге 4, с ценой использования соответствующих размеров вычислений для отдельных баз данных.

> [!IMPORTANT]
> Если количество баз данных в пуле приближается к максимально поддерживаемому, обязательно рассмотрите возможность [управления ресурсами в сжатых пулах эластичных БД](elastic-pool-resource-management.md).

## <a name="using-other-sql-database-features-with-elastic-pools"></a>Использование других функций базы данных SQL с эластичными пулами

### <a name="elastic-jobs-and-elastic-pools"></a>Эластичные задания и эластичные пулы

Пул упрощает выполнение задач управления, так как позволяет выполнять сценарии в **[заданиях обработки эластичных БД](elastic-jobs-overview.md)**. Задания обработки эластичных БД позволяют сократить объем трудоемких операций, связанных с управлением большим количеством баз данных.

Дополнительные сведения о других средствах баз данных для работы с несколькими базами данных см. в статье [Развертывание с помощью Базы данных SQL Azure](elastic-scale-introduction.md).

### <a name="business-continuity-options-for-databases-in-an-elastic-pool"></a>Возможности обеспечения непрерывности бизнес-процессов для баз данных в эластичных пулах

Базы данных в пуле поддерживают те же [возможности по обеспечению непрерывности бизнес-процессов](business-continuity-high-availability-disaster-recover-hadr-overview.md), что и отдельные базы данных.

- **Восстановление на момент времени**

  При восстановлении до точки во времени используются создаваемые автоматически резервные копии баз данных, чтобы восстановить базу данных в пуле на определенный момент времени. Ознакомьтесь с разделом [Восстановление до точки во времени](recovery-using-backups.md#point-in-time-restore)

- **Геовосстановление**

  Геовосстановление используется по умолчанию, когда база данных недоступна из-за происшествия в регионе, где она размещена. Ознакомьтесь с разделом [Восстановление базы данных SQL Azure или переход на базу данных-получатель при отказе](disaster-recovery-guidance.md)

- **активная георепликация;**

  Для приложений c более высокими требованиями к восстановлению по сравнению с возможностями геовосстановления настройте [активную георепликацию](active-geo-replication-overview.md) или [группу автоматической отработки отказа](auto-failover-group-overview.md).

## <a name="creating-a-new-sql-database-elastic-pool-using-the-azure-portal"></a>Создание нового эластичного пула базы данных SQL с помощью портала Azure

На портале Azure эластичный пул можно создать двумя способами.

1. Перейдите в [портал Azure](https://portal.azure.com) , чтобы создать эластичный пул. Найдите и выберите **Azure SQL**.
2. Выберите **Добавить**, чтобы открыть страницу **выбора варианта развертывания SQL**. Чтобы просмотреть дополнительные сведения о пулах эластичных БД, выберите **Показать подробности** в плитке **базы данных** .
3. На плитке **базы данных** выберите **эластичный пул** в раскрывающемся списке **тип ресурса** , а затем выберите **создать**:

   ![Создание эластичного пула](./media/elastic-pool-overview/create-elastic-pool.png)

4. Также можно создать эластичный пул, перейдя к существующему серверу и щелкнув **+ создать пул** , чтобы создать пул непосредственно на этом сервере.

> [!NOTE]
> На сервере можно создать несколько пулов, но в один пул нельзя добавлять базы данных с разных серверов.

Уровень служб пула определяет возможности, которые будут доступны для эластичных баз данных в пуле, и максимальное количество ресурсов для каждой базы данных. См. сведения об ограничениях ресурсов для эластичных пулов в [модели на основе DTU](resource-limits-dtu-elastic-pools.md#elastic-pool-storage-sizes-and-compute-sizes). Сведения об ограничениях ресурсов в модели на основе виртуальных ядер для эластичных пулов см. в разделе [Ограничения ресурсов для эластичных пулов при использовании модели на основе виртуальных ядер](resource-limits-vcore-elastic-pools.md).

Чтобы настроить ресурсы и цены на пул, щелкните **Настроить пул**. Выберите уровень служб, добавьте базы данных в пул и настройте ограничения ресурсов для пула и его баз данных.

После настройки пула щелкните "Применить", введите имя пула и нажмите кнопку "ОК", чтобы создать пул.

## <a name="monitor-an-elastic-pool-and-its-databases"></a>Мониторинг эластичного пула и его баз данных

На портале Azure можно отслеживать использование эластичного пула и баз данных в этом пуле. Можно также внести ряд изменений в эластичный пул и отправить все изменения одновременно. К таким изменениям относятся добавление или удаление баз данных, изменение параметров эластичного пула и изменение параметров базы данных.

В сочетании с рейтингами производительности можно использовать встроенные [средства](https://docs.microsoft.com/azure/azure-sql/database/alerts-insights-configure-portal) [мониторинга производительности](https://docs.microsoft.com/azure/azure-sql/database/performance-guidance) и оповещения.  Кроме того, База данных SQL может [выдавать значения метрик и журналы ресурсов](https://docs.microsoft.com/azure/azure-sql/database/metrics-diagnostic-telemetry-logging-streaming-export-configure?tabs=azure-portal) для упрощения мониторинга.

## <a name="customer-case-studies"></a>Примеры реальных клиентов

- [SnelStart](https://azure.microsoft.com/resources/videos/azure-sql-database-case-study-snelstart/)

  SnelStart использовал эластичные пулы с базой данных SQL Azure, чтобы быстро расширить свои бизнес-службы с частотой 1 000 новых баз данных SQL Azure в месяц.

- [Umbraco](https://azure.microsoft.com/resources/videos/azure-sql-database-case-study-umbraco/)

  Umbraco использует эластичные пулы с базой данных SQL Azure, чтобы быстро подготавливать и масштабировать службы для тысяч клиентов в облаке.

- [Daxko/CSI](https://customers.microsoft.com/story/726277-csi-daxko-partner-professional-service-azure)

   Daxko/CSI использует эластичные пулы с базой данных SQL Azure для ускорения цикла разработки и улучшения служб и производительности клиентов.

## <a name="next-steps"></a>Следующие шаги

- Сведения о ценах см. на странице с [ценами на эластичный пул](https://azure.microsoft.com/pricing/details/sql-database/elastic).
- Чтобы масштабировать эластичные пулы, см. разделы [Масштабирование эластичных пулов](elastic-pool-scale.md) и [Масштабирование эластичного пула — пример кода](scripts/monitor-and-scale-pool-powershell.md)
- Дополнительные сведения о шаблонах разработки для приложений SaaS, использующих пулы эластичных БД, см. в статье [Шаблоны разработки для мультитенантных приложений SaaS с использованием Базы данных Azure SQL](saas-tenancy-app-design-patterns.md).
- Дополнительные сведения об эластичных пулах см. в статье [Общие сведения о приложении SaaS Wingtip](saas-dbpertenant-wingtip-app-overview.md).
- Сведения об управлении ресурсами в эластичных пулах с множеством баз данных см. в статье [Управление ресурсами в пулах эластичных БД](elastic-pool-resource-management.md).
