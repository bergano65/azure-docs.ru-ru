---
title: Авторизация доступа к серверу и базе данных с помощью имен входа и учетных записей пользователей
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Сведения о том, как база данных SQL Azure, SQL Управляемый экземпляр и Azure синапсе выполняют проверку подлинности пользователей для доступа с помощью имен входа и учетных записей пользователей. Также Узнайте, как предоставить роли базы данных и явные разрешения для авторизации имен входа и пользователей для выполнения действий и запроса данных.
keywords: безопасность баз данных SQL, управление безопасностью баз данных, защита входа в систему, безопасность баз данных, доступ к базе данных
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: conceptual
author: VanMSFT
ms.author: vanto
ms.reviewer: sstein
ms.date: 03/23/2020
ms.openlocfilehash: ca458bebf75f8e77774236166704794b817b7c3f
ms.sourcegitcommit: 419c8c8061c0ff6dc12c66ad6eda1b266d2f40bd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2020
ms.locfileid: "92167140"
---
# <a name="authorize-database-access-to-sql-database-sql-managed-instance-and-azure-synapse-analytics"></a>Авторизация доступа к базе данных SQL, SQL Управляемый экземпляр и Azure синапсе Analytics
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

В этой статье вы узнаете о следующих возможностях:

- Параметры для настройки базы данных SQL Azure, Azure SQL Управляемый экземпляр и Azure синапсе Analytics (ранее — хранилище данных SQL) позволяют пользователям выполнять административные задачи и получать доступ к данным, хранящимся в этих базах данных.
- Конфигурация доступа и авторизации после первоначального создания нового сервера.
- Как добавить имена входа и учетные записи пользователей в базе данных master и учетные записи пользователей, а затем предоставить эти учетные записи разрешения администратора.
- Добавление учетных записей пользователей в пользовательские базы данных, связанных с именами входа или содержащимися в них учетными записями пользователей.
- Настройка учетных записей пользователей с разрешениями в пользовательских базах данных с помощью ролей базы данных и явных разрешений.

> [!IMPORTANT]
> В оставшейся части этой статьи в качестве баз данных используются базы данных SQL Azure, Azure SQL Управляемый экземпляр и Azure синапсе, и сервер ссылается на [сервер](logical-servers.md) , который управляет базами данных для базы Azure SQL и Azure синапсе.

## <a name="authentication-and-authorization"></a>Аутентификация и авторизация

[**Проверка подлинности**](security-overview.md#authentication) — это процесс проверки пользователя на то, что он заказывает. Пользователь подключается к базе данных с помощью учетной записи пользователя.
Когда пользователь пытается подключиться к базе данных, он предоставляет учетную запись пользователя и сведения о проверке подлинности. Проверка подлинности пользователя выполняется с помощью одного из следующих двух методов проверки подлинности:

- [Проверка подлинности SQL](https://docs.microsoft.com/sql/relational-databases/security/choose-an-authentication-mode#connecting-through-sql-server-authentication).

  При использовании этого метода проверки подлинности пользователь отправляет имя учетной записи пользователя и связанный пароль для установления соединения. Этот пароль хранится в базе данных master для учетных записей пользователей, связанных с именем входа, или хранится в базе данных, содержащей учетные записи пользователей, *не* связанные с именем входа.
- [Аутентификация Azure Active Directory](authentication-aad-overview.md)

  При использовании этого метода проверки подлинности пользователь отправляет имя учетной записи пользователя и запрашивает, что служба использует учетные данные, хранящиеся в Azure Active Directory (Azure AD).

**Имена входа и пользователи**. учетная запись пользователя в базе данных может быть связана с именем входа, хранящимся в базе данных master, или именем пользователя, хранящимся в отдельной базе данных.

- **Имя входа** — это отдельная учетная запись в базе данных master, с которой может быть связана учетная запись пользователя в одной или нескольких базах данных. Если используется имя для входа, вместе с ним хранятся учетные данные для учетной записи пользователя.
- **Учетная запись пользователя** — это отдельная учетная запись в любой базе данных, которая может быть, но не обязательно связана с именем входа. Если учетная запись пользователя не связана с именем для входа, то учетные данные хранятся вместе с учетной записью пользователя.

[**Авторизация**](security-overview.md#authorization) для доступа к данным и выполнения различных действий управляется с помощью ролей базы данных и явных разрешений. Авторизация относится к разрешениям, назначенным пользователю, и определяет, что разрешено выполнять пользователю. Авторизация контролируется [членством в роли](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles) базы данных пользователя и [разрешениями уровня объектов](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine). Обычно пользователям рекомендуется предоставлять наименьшие необходимые привилегии.

## <a name="existing-logins-and-user-accounts-after-creating-a-new-database"></a>Существующие имена входа и учетные записи пользователей после создания новой базы данных

При первом развертывании SQL Azure укажите имя входа администратора и соответствующий пароль для этого имени входа. Эта административная учетная запись называется **администратором сервера**. Следующая конфигурация имен входа и пользователей в базах данных master и User происходит во время развертывания:

- Имя входа SQL с правами администратора создается с использованием указанного имени входа. [Имя входа](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/principals-database-engine#sa-login) — это отдельная учетная запись пользователя для входа в базу данных SQL, SQL управляемый экземпляр и Azure синапсе.
- Этому имени входа предоставляются полные административные разрешения на все базы данных в качестве [участника уровня сервера](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/principals-database-engine). Имя входа имеет все доступные разрешения и не может быть ограничено. В Управляемый экземпляр SQL это имя входа добавляется к [предопределенной роли сервера sysadmin](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/server-level-roles) (эта роль не существует в базе данных SQL Azure).
- [user account](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/getting-started-with-database-engine-permissions#database-users) `dbo` Для этого имени входа в каждой пользовательской базе данных создается учетная запись пользователя с именем. У пользователя [dbo](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/principals-database-engine) есть все разрешения базы данных, и он сопоставлен с `db_owner` предопределенной ролью базы данных. Дополнительные предопределенные роли базы данных обсуждаются далее в этой статье.

Чтобы найти учетные записи администратора для базы данных, откройте портал Azure и перейдите на вкладку **Свойства** сервера или управляемого экземпляра.

![Администраторы SQL Server](./media/logins-create-manage/sql-admins.png)

![Снимок экрана, посвященный пункту меню "Свойства".](./media/logins-create-manage/sql-admins2.png)

> [!IMPORTANT]
> Имя для входа администратора нельзя изменить после его создания. Чтобы сбросить пароль администратора сервера, на [портале Azure](https://portal.azure.com) щелкните **Серверы SQL**, выберите в списке сервер и щелкните **Сбросить пароль**. Чтобы сбросить пароль для Управляемый экземпляр SQL, перейдите в портал Azure, щелкните экземпляр и нажмите кнопку **Сброс пароля**. Можно также использовать PowerShell или Azure CLI.

## <a name="create-additional-logins-and-users-having-administrative-permissions"></a>Создание дополнительных учетных записей и пользователей, имеющих административные разрешения

На этом этапе сервер или управляемый экземпляр настраивается для доступа только с помощью одного имени входа SQL и учетной записи пользователя. Для создания дополнительных учетных записей с полными или частичными административными разрешениями доступны следующие варианты (в зависимости от режима развертывания).

- **Создание учетной записи администратора Azure Active Directory с полными разрешениями администратора**

  Включите проверку подлинности Azure Active Directory и создайте учетную запись администратора Azure AD. Одну учетную запись Azure Active Directory можно настроить в качестве администратора развертывания SQL Azure с полными разрешениями администратора. Эта учетная запись может быть отдельной учетной записью или группой безопасности. Администратор Azure AD **должен** быть настроен, если вы хотите использовать учетные записи Azure AD для подключения к базе данных sql, управляемый экземпляр SQL или Azure синапсе. Подробные сведения о включении проверки подлинности Azure AD для всех типов развертывания SQL Azure см. в следующих статьях:

  - [Использование проверки подлинности Azure Active Directory для проверки подлинности с помощью SQL](authentication-aad-overview.md)
  - [Настройка и администрирование аутентификации Azure Active Directory с помощью SQL](authentication-aad-configure.md)

- **В Управляемый экземпляр SQL создайте имена входа SQL с полными разрешениями администратора.**

  - Создайте дополнительное имя входа SQL в базе данных master.
  - Добавьте имя входа к [предопределенной роли сервера sysadmin](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/server-level-roles) с помощью инструкции [ALTER Server Role](https://docs.microsoft.com/sql/t-sql/statements/alter-server-role-transact-sql) . Это имя для входа будет иметь полные административные разрешения.
  - Кроме того, можно создать [имя входа Azure AD](authentication-aad-configure.md#provision-azure-ad-admin-sql-managed-instance) с помощью синтаксиса [CREATE LOGIN](/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-mi-current) .

- **В базе данных SQL создайте имена входа SQL с ограниченными административными разрешениями.**

  - Создайте дополнительное имя входа SQL в базе данных master.
  - Создайте учетную запись пользователя в базе данных master, связанной с новым именем входа.
  - Добавьте учетную запись пользователя в `dbmanager` , `loginmanager` роль или обе в `master` базе данных с помощью инструкции [ALTER ROLE](https://docs.microsoft.com/sql/t-sql/statements/alter-role-transact-sql) (для Azure синапсе используйте инструкцию [sp_addrolemember](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-addrolemember-transact-sql) ).

  > [!NOTE]
  > `dbmanager``loginmanager`роли и **не** относятся к развертываниям управляемый экземпляр SQL.

  Члены этих [специальных ролей главной базы данных](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles#special-roles-for--and-) для базы данных SQL Azure имеют права на создание баз данных и управление ими, а также на создание имен входа и управление ими. В базах данных, созданных пользователем, который является членом `dbmanager` роли, член сопоставляется с `db_owner` предопределенной ролью базы данных и может входить в эту базу данных и управлять ею с помощью `dbo` учетной записи пользователя. Эти роли не имеют явных разрешений вне базы данных master.

  > [!IMPORTANT]
  > Невозможно создать дополнительное имя входа SQL с полными правами администратора в базе данных SQL.

## <a name="create-accounts-for-non-administrator-users"></a>Создание учетных записей для пользователей без прав администратора

Учетные записи для пользователей, не имеющих прав администратора, можно создать одним из двух способов:

- **Создает вход**

  Создайте имя входа SQL в базе данных master. Затем создайте учетную запись пользователя в каждой базе данных, к которой пользователю требуется доступ, и свяжите учетную запись пользователя с этим именем входа. Этот подход предпочтителен, если пользователь должен получить доступ к нескольким базам данных и вы хотите синхронизировать пароли. Однако этот подход имеет сложности при использовании георепликации, так как имя входа должно быть создано как на сервере-источнике, так и на вторичном сервере (серверах). Дополнительные сведения см. в статье [Настройка безопасности базы данных SQL Azure для геовосстановления или отработки отказа](active-geo-replication-security-configure.md).
- **Создание учетной записи пользователя**

  Создайте учетную запись пользователя в базе данных, к которой пользователю требуется доступ (также называемый [автономным пользователем](/sql/relational-databases/security/contained-database-users-making-your-database-portable)).

  - С базой данных SQL всегда можно создавать учетные записи этого типа.
  - Благодаря Управляемый экземпляр SQL, поддерживающей [участников сервера Azure AD](authentication-aad-configure.md#create-contained-users-mapped-to-azure-ad-identities), можно создавать учетные записи пользователей для проверки подлинности в SQL управляемый экземпляр, не требуя создания пользователей базы данных в качестве пользователя автономной базы данных.

  При таком подходе сведения о проверке подлинности пользователя хранятся в каждой базе данных и автоматически реплицируются в геореплицированные базы данных. Однако если одна и та же учетная запись существует в нескольких базах данных и используется проверка подлинности SQL Azure, пароли необходимо синхронизировать вручную. Кроме того, если у пользователя есть учетная запись в разных базах данных с разными паролями, помните, что эти пароли могут стать проблемой.

> [!IMPORTANT]
> Чтобы создать автономных пользователей, сопоставленных с удостоверениями Azure AD, необходимо войти в систему с помощью учетной записи Azure AD, которая является администратором в базе данных в базе данных SQL Azure. В SQL Управляемый экземпляр имя входа SQL с `sysadmin` разрешениями также может создавать имя входа или пользователя Azure AD.

Примеры, демонстрирующие создание имен входа и пользователей, см. в следующих статьях:

- [Создание имени входа для базы данных SQL Azure](https://docs.microsoft.com/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-current#examples-1)
- [Создание имени входа для Управляемый экземпляр Azure SQL](https://docs.microsoft.com/sql/t-sql/statements/create-login-transact-sql?view=azuresqldb-mi-current#examples-2)
- [Создание имени входа для Azure синапсе](https://docs.microsoft.com/sql/t-sql/statements/create-login-transact-sql?view=azure-sqldw-latest#examples-3)
- [Создание пользователя](https://docs.microsoft.com/sql/t-sql/statements/create-user-transact-sql#examples)
- [Создание пользователей, содержащихся в Azure AD](authentication-aad-configure.md#create-contained-users-mapped-to-azure-ad-identities)

> [!TIP]
> Руководство по безопасности, включающее создание пользователей в базе данных SQL Azure, см. в статье [руководство. Защита базы данных SQL Azure](secure-database-tutorial.md).

## <a name="using-fixed-and-custom-database-roles"></a>Использование фиксированных и пользовательских ролей базы данных

После создания учетной записи пользователя в базе данных на основе имени входа или автономного пользователя можно авторизовать этого пользователя для выполнения различных действий и доступа к данным в определенной базе данных. Для авторизации доступа можно использовать следующие методы:

- **Предопределенные роли базы данных**

  Добавьте учетную запись пользователя к [предопределенной роли базы данных](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles). Существует 9 фиксированных ролей базы данных, каждый из которых имеет определенный набор разрешений. Наиболее распространенные предопределенные роли базы данных: **db_owner**, **db_ddladmin**, **db_datawriter**, **db_datareader**, **db_denydatawriter**и **db_denydatareader**. Роль **db_owner** обычно используется для предоставления полных прав ограниченному числу пользователей. Другие фиксированные роли можно использовать для быстрого получения простых баз данных при разработке, но их не рекомендуется использовать для большинства рабочих баз данных. Например, предопределенная роль базы данных **db_datareader** предоставляет доступ на чтение к каждой таблице в базе данных, что более строго требуется.

  - Чтобы добавить пользователя к предопределенной роли базы данных, выполните следующие действия.

    - В базе данных SQL Azure используйте инструкцию [ALTER ROLE](https://docs.microsoft.com/sql/t-sql/statements/alter-role-transact-sql) . Примеры см. в разделе [ALTER ROLE examples](https://docs.microsoft.com/sql/t-sql/statements/alter-role-transact-sql#examples) .
    - Azure синапсе. Используйте инструкцию [sp_addrolemember](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-addrolemember-transact-sql) . Примеры см. в разделе [sp_addrolemember примеры](https://docs.microsoft.com/sql/t-sql/statements/alter-role-transact-sql).

- **Пользовательская роль базы данных**

  Создайте пользовательскую роль базы данных с помощью инструкции [CREATE ROLE](https://docs.microsoft.com/sql/t-sql/statements/create-role-transact-sql) . Настраиваемая роль позволяет создавать собственные пользовательские роли базы данных и тщательно предоставлять каждой роли минимальные разрешения, необходимые для нужд бизнеса. Затем можно добавить пользователей в пользовательскую роль. Если пользователь является участником нескольких ролей, то ему предоставлены разрешения всех этих ролей.
- **Предоставление разрешений напрямую**

  Предоставьте [разрешения](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine) учетной записи пользователя напрямую. Существует более 100 разрешений, которые можно по отдельности предоставлять или отменять в базе данных SQL. Многие эти разрешения являются частью других разрешений. Например, разрешение `UPDATE` на схеме включает в себя разрешение `UPDATE` для каждой таблицы в этой схеме. Как и в большинстве систем разрешений, отмена разрешения переопределяет предоставление. Так как некоторые разрешения включены в другие разрешения и их достаточно много, необходимо внимательно изучить их, чтобы спроектировать соответствующую систему разрешений, которая будет надежно защищать базу данных. Изучите список разрешений на [этой странице](https://docs.microsoft.com/sql/relational-databases/security/permissions-database-engine) и ознакомьтесь с [графическим представлением](https://docs.microsoft.com/sql/relational-databases/security/media/database-engine-permissions.png) разрешений.

## <a name="using-groups"></a>Использование групп

Эффективное управление доступом использует разрешения, назначенные Active Directory группам безопасности, фиксированным или пользовательским ролям, а не отдельным пользователям.

- При использовании Azure Active Directory проверки подлинности помещайте Azure Active Directory пользователей в группу безопасности Azure Active Directory. Создайте пользователя автономной базы данных для группы. Добавьте одного или нескольких пользователей базы данных в качестве члена в пользовательские или встроенные роли базы данных с конкретными разрешениями, соответствующими этой группе пользователей.

- При использовании проверки подлинности SQL создайте пользователей автономной базы данных в базе данных. Поместите одного или нескольких пользователей базы данных в пользовательскую роль базы данных с конкретными разрешениями, соответствующими этой группе пользователей.

  > [!NOTE]
  > Можно также использовать группы для пользователей неавтономной базы данных.

Ознакомьтесь со следующими возможностями, которые можно использовать, чтобы ограничить или расширить права:

- Чтобы безопасно временно повысить уровень разрешений, можно использовать [олицетворение](https://docs.microsoft.com/dotnet/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server) и [подписание модулей](https://docs.microsoft.com/dotnet/framework/data/adonet/sql/signing-stored-procedures-in-sql-server).
- [Безопасности на уровне строк](https://docs.microsoft.com/sql/relational-databases/security/row-level-security) может использоваться, чтобы ограничить доступ пользователя к строкам.
- [Маскирование данных](dynamic-data-masking-overview.md) позволяет снизить уязвимость конфиденциальных данных.
- [хранимые процедуры](https://docs.microsoft.com/sql/relational-databases/stored-procedures/stored-procedures-database-engine) .

## <a name="next-steps"></a>Дальнейшие действия

Обзор всех баз данных SQL Azure и функций безопасности SQL Управляемый экземпляр см. в статье [Общие сведения о безопасности](security-overview.md).
