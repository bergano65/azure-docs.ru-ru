---
title: Устранение неполадок синхронизации данных SQL
description: Узнайте, как выявлять, устранять и устранять распространенные проблемы с синхронизация данных SQL в Azure.
services: sql-database
ms.service: sql-database
ms.subservice: data-movement
ms.custom: data sync, sqldbrb=1
ms.devlang: ''
ms.topic: troubleshooting
author: stevestein
ms.author: sstein
ms.reviewer: ''
ms.date: 12/20/2018
ms.openlocfilehash: cb66c0371914b29c3db911823519b29df8c4b16c
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91616471"
---
# <a name="troubleshoot-issues-with-sql-data-sync"></a>Устранение неполадок с синхронизацией данных SQL
[!INCLUDE[appliesto-sqldb](../includes/appliesto-sqldb.md)]

В этой статье описывается, как устранять известные проблемы с синхронизация данных SQL в Azure. Если существует решение проблемы, оно представлено ниже.

Общие сведения о синхронизации данных SQL см. в статье [Синхронизация данных в нескольких облачных и локальных базах данных с помощью синхронизации данных SQL в Azure](sql-data-sync-data-sql-server-sql-database.md).

> [!IMPORTANT]
> Синхронизация данных SQL пока **не поддерживает** Управляемый экземпляр SQL Azure.

## <a name="sync-issues"></a>Проблемы синхронизации

- [Сбой синхронизации в пользовательском интерфейсе портала для локальных баз данных, связанных с агентом клиента](#sync-fails)

- [Моя группа синхронизации застряла в состоянии обработки](#sync-stuck)

- [В таблицах отображаются неверные данные](#sync-baddata)

- [Несогласованные данные первичного ключа после успешной синхронизации](#sync-pkdata)

- [Я вижу значительное снижение производительности](#sync-perf)

- [Я вижу следующее сообщение: "не удается вставить значение NULL в столбец \<column> . Столбец не допускает значений NULL». Что это означает, и как это можно исправить?](#sync-nulls)

- [Как синхронизация данных обрабатывает циклические ссылки? То есть, когда одни и те же данные синхронизируются в нескольких группах синхронизации и сохраняются в результате изменения?](#sync-circ)

### <a name="sync-fails-in-the-portal-ui-for-on-premises-databases-that-are-associated-with-the-client-agent"></a><a name="sync-fails"></a>Ошибка синхронизации в ​​пользовательском интерфейсе портала данных SQL для локальных баз данных, связанных с агентом клиента

Ошибка синхронизации в ​​пользовательском интерфейсе портала данных синхронизации данных SQL для локальных баз данных, связанных с агентом клиента. На локальном компьютере, на котором запущен агент, в журнале событий содержатся ошибки System.IO.IOException. Они указывают, что на диске недостаточно места.

- **Причина**. Недостаточно места на диске.

- **Решение**. Освободите дополнительное место на диске, на котором находится каталог %TEMP%.

### <a name="my-sync-group-is-stuck-in-the-processing-state"></a><a name="sync-stuck"></a> Моя группа синхронизации зависла в процессе обработки

Группа синхронизации в службе синхронизации данных SQL находилась в состоянии обработки в течение длительного времени. Она не реагирует на команду **stop**, новые записи в журналах отсутствуют.

К фиксации группы синхронизации в состоянии обработки может привести любое из следующих условий:

- **Причина**. Агент клиента находится вне сети

- **Решение**. Убедитесь, что агент клиента в сети, а затем повторите попытку.

- **Причина**. Агент клиента удален или отсутствует.

- **Решение**. Агент клиента удален или отсутствует:

    1. Удалите XML-файл агента из установочной папки синхронизации данных SQL, если файл существует.
    1. Установите агент на локальном компьютере (это может быть тот же или другой компьютер). Затем отправьте ключ, созданный на портале для агента, который находится вне сети.

- **Причина**. Служба синхронизации данных SQL остановлена.

- **Решение**. Перезапустите службу синхронизации данных SQL.

    1. В меню **Пуск** найдите пункт **службы**.
    1. В результатах поиска выберите **службы**.
    1. Найдите службу **Синхронизация данных SQL** .
    1. Если состояние службы — **остановлено**, щелкните правой кнопкой мыши имя службы и выберите **запустить**.

> [!NOTE]
> Если приведенные выше сведения не вывели группу синхронизации из состояния обработки, служба поддержки Майкрософт может сбросить состояние группы синхронизации. Чтобы сбросить состояние группы синхронизации, на [странице Microsoft Q&A вопрос для базы данных SQL Azure](https://docs.microsoft.com/answers/topics/azure-sql-database.html)создайте запись. Укажите в ней идентификатор подписки и идентификатор группы синхронизации, которую нужно сбросить. Специалист службы поддержки Майкрософт ответит на вашу запись и сообщит вам, когда состояние будет сброшено.

### <a name="i-see-erroneous-data-in-my-tables"></a><a name="sync-baddata"></a>Неверные данные в таблицах

Если в синхронизации участвуют таблицы с одинаковыми именам, но из разных схем базы данных, то после синхронизации в них отображаются ошибочные данные.

- **Причина**. В процессе подготовки синхронизации данных SQL Sync используются одни и те же таблицы отслеживания для таблиц с одинаковыми именами, но в разных схемах. По этой причине изменения из обеих таблиц отражаются в одной таблице отслеживания. Это приводит к неправильному изменению данных во время синхронизации.

- **Решение**. Убедитесь, что имена таблиц, участвующих в синхронизации, отличаются, даже если они относятся к разным схемам в базе данных.

### <a name="i-see-inconsistent-primary-key-data-after-a-successful-sync"></a><a name="sync-pkdata"></a> После успешной синхронизации отображаются несогласованные данные первичного ключа

После синхронизации, которая считается успешной, в журнале нет неудачных или пропущенных строк, но вы видите, что данные первичного ключа не согласованы между базами данных в группе синхронизации.

- **Причина**. Это сделано намеренно. Изменения в любом столбце первичного ключа приводят к несогласованным данным в строках, в которых был изменен первичный ключ.

- **Решение**. Чтобы предотвратить эту проблему, убедитесь, что данные в столбце первичного ключа не изменены. Чтобы устранить эту проблему после ее возникновения, удалите строку, которая содержит несогласованные данные, из всех конечных точек в группе синхронизации. Затем снова вставьте эту строку.

### <a name="i-see-a-significant-degradation-in-performance"></a><a name="sync-perf"></a>Значительное снижение производительности

Производительность может снизиться до такой степени, что вы даже не сможете открыть пользовательский интерфейс синхронизации данных.

- **Причина**. Наиболее вероятной причиной является петля синхронизации. Петля синхронизации возникает, когда группа синхронизации А активирует синхронизацию с группой по синхронизации Б, которая затем запускает синхронизацию с группой синхронизации А. Фактическая ситуации может быть более сложной, так как петля может включать более двух групп синхронизации. Проблема заключается в зацикливании синхронизации из-за перекрытия групп синхронизации.

- **Решение**. Наилучшим решением является предотвращение. Убедитесь, что в группах синхронизации нет циклических ссылок. Любая строка, синхронизируемая с одной группой синхронизации, не может синхронизироваться c другой группой синхронизации.

### <a name="i-see-this-message-cannot-insert-the-value-null-into-the-column-column-column-does-not-allow-nulls-what-does-this-mean-and-how-can-i-fix-it"></a><a name="sync-nulls"></a> Я вижу следующее сообщение: "не удается вставить значение NULL в столбец \<column> . В столбце запрещены значения NULL". Что это означает, и как это можно исправить? 
Это сообщение об ошибке указывает на одну из двух следующих проблем:
-  У таблицы нет первичного ключа. Чтобы устранить эту проблему, добавьте первичный ключ во все таблицы, которые синхронизируются.
-  В инструкции CREATE INDEX присутствует предложение WHERE. Служба синхронизации данных не может обработать такое условие. Чтобы устранить эту проблему, удалите предложение WHERE или вручную внесите изменения во все базы данных. 
 
### <a name="how-does-data-sync-handle-circular-references-that-is-when-the-same-data-is-synced-in-multiple-sync-groups-and-keeps-changing-as-a-result"></a><a name="sync-circ"></a> Как синхронизация данных обрабатывает циклические ссылки? То есть, когда одни и те же данные синхронизируются в нескольких группах синхронизации и в результате постоянно изменяются?
Синхронизация данных не обрабатывает циклические ссылки. Не используйте их. 

## <a name="client-agent-issues"></a>Проблемы в работе агента клиента

Сведения о том, как устранить проблемы с агентом клиента, см. в разделе [Troubleshoot Data Sync Agent issues](sql-data-sync-agent-overview.md#agent-tshoot) (Устранение проблем с агентом синхронизации данных).

## <a name="setup-and-maintenance-issues"></a>Проблемы установки и обслуживания

- [ Появляется уведомление "нет свободного места на диске" ](#setup-space)

- [Не удается удалить группу синхронизации](#setup-delete)

- [Я не могу отменить регистрацию базы данных SQL Server](#setup-unreg)

- [У меня нет необходимых привилегий для запуска системных служб](#setup-perms)

- [База данных находится в состоянии "Устарела"](#setup-date)

- [Группа синхронизации имеет состояние "устарело"](#setup-date2)

- [Невозможно удалить группу синхронизации в течение трех минут после удаления или остановки агента](#setup-delete2)

- [Что происходит, когда я восстанавливаю потерянную или поврежденную базу данных?](#setup-restore)

### <a name="i-get-a-disk-out-of-space-message"></a><a name="setup-space"></a> Я получаю сообщение "диск не хватает места"

- **Причина**. Сообщение "disk out of space" (нет свободного места на диске) может отображаться, если нужно удалить лишние файлы. Это могут быть лишние файлы, обнаруженные антивирусным программным обеспечением, или файлы, которые были открыты при попытке выполнить операции удаления.

- **Решение**. Вручную удалите файлы синхронизации, которые находятся в папке %temp% (`del \*sync\* /s`). Затем удалите подкаталоги в папке %temp%.

> [!IMPORTANT]
> Не удаляйте файлы во время синхронизации.

### <a name="i-cant-delete-my-sync-group"></a><a name="setup-delete"></a>Невозможно удалить группу синхронизации

Вам не удается удалить группу синхронизации. Любая из следующих ситуаций может помешать удалению группы синхронизации:

- **Причина**. Агент клиента находится в автономном режиме.

- **Решение**. Убедитесь, что агент клиента в сети, а затем повторите попытку.

- **Причина**. Агент клиента удален или отсутствует.

- **Решение**. Агент клиента удален или отсутствует:  
    a. Удалите XML-файл агента из установочной папки синхронизации данных SQL, если файл существует.  
    b. Установите агент на локальном компьютере (это может быть тот же или другой компьютер). Затем отправьте ключ, созданный на портале для агента, который находится вне сети.

- **Причина**. База данных находится в автономном режиме.

- **Решение**. Убедитесь, что базы данных находятся в режиме «в сети».

- **Причина**. Группа синхронизации подготавливается или синхронизируется.

- **Решение**. Дождитесь завершения процесса подготовки или синхронизации и повторите попытку удалить группу синхронизации.

### <a name="i-cant-unregister-a-sql-server-database"></a><a name="setup-unreg"></a> Я не могу отменить регистрацию базы данных SQL Server

- **Причина**. Скорее всего, вы пытаетесь отменить регистрацию базы данных, которая уже удалена.

- **Решение**. Чтобы отменить регистрацию SQL Server базы данных, выберите базу данных и щелкните **принудительное удаление**.

  Если эта операция не удалила базу данных из группы синхронизации, выполните следующие действия.

  1. Остановите, а затем перезапустите службу узла агента клиента.  
    a. Щелкните меню **Пуск**.  
    b. В поле поиска введите **services.msc**.  
    c. В разделе **Программы** области результатов поиска дважды щелкните **Службы**.  
    d. Щелкните правой кнопкой мыши службу **синхронизации данных SQL**.  
    д) Если служба запущена, остановите ее.  
    е) Щелкните правой кнопкой мыши службу и выберите **Запуск**.  
    ж. Проверьте, зарегистрирована ли еще база данных. Если она больше не зарегистрирована, процедура завершена. В противном случае перейдите к следующему шагу.
  1. Откройте приложение агента клиента (SqlAzureDataSyncAgent).
  1. Выберите **Изменить учетные данные**, а затем введите учетные данные для базы данных.
  1. Выполните отмену регистрации.

### <a name="i-dont-have-sufficient-privileges-to-start-system-services"></a><a name="setup-perms"></a> У меня недостаточно прав для запуска системных служб

- **Причина**. Эта ошибка возникает в двух ситуациях:
  -   Имя пользователя или пароль неверны.
  -   Указанная учетная запись пользователя не имеет достаточных привилегий для входа в систему в качестве службы.

- **Решение**. Предоставьте учетной записи пользователя учетные данные для входа в качестве службы.

  1. Последовательно выберите **Пуск**  >  **панели управления**  >  **Администрирование**администрирование  >  **Локальная политика безопасности**  >  **локальный**  >  **пользователь Rights Management**.
  1. Выберите **Вход в качестве службы**.
  1. В диалоговом окне **Свойства** добавьте учетную запись пользователя.
  1. Нажмите кнопку **Apply** (Применить), а затем нажмите кнопку **ОК**.
  1. Закройте все окна.

### <a name="a-database-has-an-out-of-date-status"></a><a name="setup-date"></a> База данных имеет состояние "устарело"

- **Причина**. Служба синхронизации данных SQL удаляет базы данных, которые были отключены более 45 дней (с момента отключения базы данных от сети). Если база данных находится вне сети более 45 дней, а затем возвращается в сеть, ее состояние имеет значение **Out-of-Date** (Устарела).

- **Решение**. Чтобы избежать состояния **Out-of-Date** (Устарела), нужно сделать так, чтобы ни одна из ваших баз данных не находилась вне сети более 45 дней.

  Если база данных находится в состоянии **Out-of-Date** (Устарела), сделайте следующее.

  1. Удалите базу данных в состоянии **Out-of-Date** (Устарела) из группы синхронизации.
  1. Добавьте базу данных обратно в группу синхронизации.

  > [!WARNING]
  > Все изменения, внесенные в эту базу данных в автономном режиме, будут потеряны.

### <a name="a-sync-group-has-an-out-of-date-status"></a><a name="setup-date2"></a> Группа синхронизации находится в состоянии "Устарела"

- **Причина**. Если одно или несколько изменений не применяются в течение всего периода хранения (45 дней), группа синхронизации может стать устаревшей.

- **Решение**. Чтобы избежать состояния **Out-of-Date** (Устарела) группы синхронизации, регулярно проверяйте результаты заданий синхронизации в средстве просмотра журнала. Изучайте и устраняйте проблемы изменений, которые не применяются.

  Если группа синхронизации находится в состоянии **Out-of-Date** (Устарела), необходимо удалить ее и создать заново.

### <a name="a-sync-group-cant-be-deleted-within-three-minutes-of-uninstalling-or-stopping-the-agent"></a><a name="setup-delete2"></a>Группу синхронизации не удается устранить в течение трех минут после удаления или остановки агента

Вы не можете удалить группу синхронизации в течение трех минут после удаления или остановки связанного агента синхронизации данных SQL.

- **Решение**.

  1. Удалите группу синхронизации, в то время как связанные агенты синхронизации подключены к сети (рекомендуется).
  1. Если агент находится вне сети, но установлен, подключите его к сети на локальном компьютере. Дождитесь, пока состояние агента не изменится на **В сети** на портале синхронизации данных SQL. Удалите группу синхронизации.
  1. Если агент находится вне сети, потому что он был удален, выполните следующие действия.  
    a.  Удалите XML-файл агента из установочной папки синхронизации данных SQL, если файл существует.  
    b.  Установите агент на локальном компьютере (это может быть тот же или другой компьютер). Затем отправьте ключ, созданный на портале для агента, который находится вне сети.  
    c. Попробуйте удалить группу синхронизации.

### <a name="what-happens-when-i-restore-a-lost-or-corrupted-database"></a><a name="setup-restore"></a> Что происходит при восстановлении потерянной или поврежденной базы данных?

Если вы восстанавливаете потерянную или поврежденную базу данных из резервной копии, могут быть несогласованности в данных групп синхронизации к которой принадлежит база данных.

## <a name="next-steps"></a>Дальнейшие шаги
Дополнительные сведения о синхронизации данных SQL см. в следующих материалах:

-   Обзор. [Синхронизация данных в нескольких облачных и локальных базах данных с помощью синхронизации данных SQL в Azure](sql-data-sync-data-sql-server-sql-database.md)
-   Настройка синхронизации данных
    - На портале — [учебник. настройка синхронизация данных SQL для синхронизации данных между базой данных SQL Azure и SQL Server](sql-data-sync-sql-server-configure.md)
    - С помощью PowerShell
        -  [Синхронизация нескольких баз данных в базе данных SQL Azure с помощью PowerShell](scripts/sql-data-sync-sync-data-between-sql-databases.md)
        -  [Использование PowerShell для синхронизации между базой данных в базе данных SQL Azure и базой данных в экземпляре SQL Server](scripts/sql-data-sync-sync-data-between-azure-onprem.md)
-   Агент синхронизации данных: [Агент синхронизации данных для синхронизации данных SQL в Azure](sql-data-sync-agent-overview.md)
-   Рекомендации: [Рекомендации по синхронизации данных SQL в Azure](sql-data-sync-best-practices.md)
-   Мониторинг: [Мониторинг синхронизации данных SQL с помощью журналов Azure Monitor](sql-data-sync-monitor-sync.md)
-   Обновление схемы синхронизации
    -   С помощью Transact-SQL — [Автоматизируйте репликацию изменений схемы в Синхронизация данных SQL в Azure](sql-data-sync-update-sync-schema.md)
    -   С помощью PowerShell: [Использование PowerShell для обновления схемы синхронизации в существующей группе синхронизации](scripts/update-sync-schema-in-sync-group.md).

Дополнительные сведения о Базе данных SQL см. в разделах:

-   [Обзор Базы данных SQL](sql-database-paas-overview.md)
-   [Управление жизненным циклом базы данных](https://msdn.microsoft.com/library/jj907294.aspx)
