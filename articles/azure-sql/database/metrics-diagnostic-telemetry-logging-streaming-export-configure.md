---
title: Настройка потокового экспорта метрик и журналов ресурсов
description: Узнайте, как настроить потоковый экспорт метрик и журналов ресурсов, включая интеллектуальный анализ диагностики из базы данных SQL Azure и Управляемый экземпляр SQL Azure, в целевое назначение для хранения сведений об использовании ресурсов и статистике выполнения запросов.
services: sql-database
ms.service: sql-db-mi
ms.subservice: performance
ms.custom: seoapril2019
ms.devlang: sqldbrb=2
ms.topic: how-to
author: danimir
ms.author: danil
ms.reviewer: jrasnik, sstein
ms.date: 04/06/2020
ms.openlocfilehash: b1e1de694b6333a350d034b08225aeea117ae703
ms.sourcegitcommit: 400f473e8aa6301539179d4b320ffbe7dfae42fe
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/28/2020
ms.locfileid: "92790480"
---
# <a name="configure-streaming-export-of-azure-sql-database-and-sql-managed-instance-diagnostic-telemetry"></a>Настройка потокового экспорта для базы данных SQL Azure и телеметрии диагностики SQL Управляемый экземпляр
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

В этой статье вы узнаете о метриках производительности и журналах ресурсов для базы данных SQL Azure, которые можно экспортировать в одно из нескольких назначений для анализа. Вы узнаете, как настроить потоковую передачу данных телеметрии диагностики с помощью портал Azure, PowerShell, Azure CLI, REST API и шаблонов Azure Resource Manager.

Вы также узнаете о назначениях, с помощью которых можно выполнить потоковую передачу диагностических данных диагностики и выбрать один из этих вариантов. К параметрам назначения относятся:

- [Log Analytics и аналитика SQL](#stream-into-sql-analytics)
- [Центры событий](#stream-into-event-hubs)
- [Хранилище Azure](#stream-into-azure-storage)

## <a name="diagnostic-telemetry-for-export"></a>Данные телеметрии диагностики для экспорта

Наиболее важным из данных телеметрии диагностики, которые можно экспортировать, является журнал Intelligent Insights (SQLInsights). [Intelligent Insights](intelligent-insights-overview.md) использует встроенную аналитику для постоянного отслеживания использования базы данных с помощью искусственного интеллекта и обнаружения нарушений событий, которые приводят к низкой производительности. После обнаружения будет выполнен подробный анализ, создающий журнал Intelligent Insights с интеллектуальной оценкой проблемы. Эта оценка состоит из анализа первопричин проблемы с производительностью базы данных и возможных рекомендаций по повышению производительности. Чтобы просмотреть его содержимое, необходимо настроить потоковый экспорт этого журнала.

Помимо потоковой передачи экспорта журнала Intelligent Insights можно также экспортировать различные метрики производительности и дополнительные журналы базы данных. В следующей таблице описаны метрики производительности и журналы ресурсов, которые можно настроить для потоковой трансляции при экспорте в одно из нескольких назначений. Эти данные диагностики можно настроить для отдельных баз данных, эластичных пулов и баз данных в составе пулов, а также для управляемых экземпляров и баз данных экземпляров.

| Данные телеметрии диагностики для баз данных | Поддержка Базы данных SQL Azure | Поддержка Управляемого экземпляра SQL Azure |
| :------------------- | ----- | ----- |
| [Основные метрики](#basic-metrics): содержит количество единиц DTU/ЦП, ограничение DTU/ЦП, процент считанных физических данных, процент записи в журнал, успешных/неудачных или заблокированных подключениями брандмауэра, процент сеансов, процент рабочих ролей, хранилище, процент хранения и процентное соотношение хранилища XTP. | Да | Нет |
| [Расширенный экземпляр и приложение](#advanced-metrics): содержит данные системной базы данных tempdb и размер файла журнала, а затем используется файл журнала процента tempdb. | Да | Нет |
| [QueryStoreRuntimeStatistics](#query-store-runtime-statistics): содержит сведения о статистике времени выполнения запросов, такие как загрузка ЦП и статистика длительности запросов. | Да | Да |
| [QueryStoreWaitStatistics](#query-store-wait-statistics): содержит сведения о статистике ожидания запросов (запросы, ожидающие выполнения запросов), такие как ЦП, журнал и блокировка. | Да | Да |
| [Ошибки](#errors-dataset): содержит сведения об ошибках SQL в базе данных. | Да | Да |
| [DatabaseWaitStatistics](#database-wait-statistics-dataset) содержит статистику по значениям времени ожидания различных типов для базы данных. | Да | Нет |
| [Время ожидания](#time-outs-dataset): содержит сведения об истечении времени ожидания в базе данных. | Да | Нет |
| [Блоки](#blockings-dataset): содержит сведения о блокировании событий в базе данных. | Да | Нет |
| [Взаимоблокировки](#deadlocks-dataset): содержит сведения о событиях взаимоблокировки в базе данных. | Да | Нет |
| [Аутоматиктунинг](#automatic-tuning-dataset): содержит сведения о рекомендациях по автоматической настройке для базы данных. | Да | Нет |
| [SQLInsights](#intelligent-insights-dataset): содержит Intelligent Insights производительности для базы данных. Дополнительные сведения см. в статье об [Intelligent Insights](intelligent-insights-overview.md). | Да | Да |

> [!NOTE]
> Параметры диагностики нельзя настроить для **системных баз данных** , таких как базы данных master, msdb, Model, Resource и tempdb.

## <a name="streaming-export-destinations"></a>Назначений для экспорта потоковой передачи

Данные телеметрии диагностики можно передавать в один из следующих ресурсов Azure для анализа.

- **[Рабочая область log Analytics](#stream-into-sql-analytics)** :

  [SQL Analytics](../../azure-monitor/insights/azure-sql.md)может использовать данные, потоковые в [log Analytics рабочей области](../../azure-monitor/platform/resource-logs.md#send-to-log-analytics-workspace) . SQL Analytics — это облачное решение мониторинга, которое обеспечивает интеллектуальный Мониторинг баз данных, включая отчеты о производительности, предупреждения и рекомендации по устранению рисков. Потоки данных, переданные в рабочую область Log Analytics, можно анализировать с помощью собранных данных мониторинга, а также использовать другие функции Azure Monitor, такие как оповещения и визуализации.
- **[Концентраторы событий Azure](#stream-into-event-hubs)** :

  Потоковая передача данных в [концентратор событий Azure](../../azure-monitor/platform/resource-logs.md#send-to-azure-event-hubs)обеспечивает следующие функциональные возможности.

  - **Потоковая передача журналов в сторонние системы ведения журналов и телеметрии** . потоковая передача всех метрик и журналов ресурсов в один концентратор событий для передачи данных журнала в СТОРОННИЕ средства SIEM или log Analytics.
  - **Создание настраиваемой платформы для телеметрии и ведения журналов** . Благодаря высоко масштабируемой природе концентраторов событий "публикация — подписка" можно гибко принимать метрики и журналы ресурсов в настраиваемую платформу телеметрии. Дополнительные сведения см. в статье [Разработка и изменение размера платформы телеметрии глобальной шкалы в концентраторах событий Azure](https://azure.microsoft.com/documentation/videos/build-2015-designing-and-sizing-a-global-scale-telemetry-platform-on-azure-event-Hubs/) .
  - **Просмотр сведений о работоспособности службы путем потоковой передачи данных в Power BI** : использование концентраторов событий, Stream Analytics и Power BI для преобразования диагностических данных в практически в реальном времени аналитические сведения о службах Azure. Дополнительные сведения об этом решении см. в разделе [Stream Analytics и Power BI. панель мониторинга для потоковой передачи данных в режиме реального времени](../../stream-analytics/stream-analytics-power-bi-dashboard.md) .
- Служба **[хранилища Azure](#stream-into-azure-storage)** :

  Потоковая передача данных в службу [хранилища Azure](../../azure-monitor/platform/resource-logs.md#send-to-azure-storage) позволяет архивировать огромные объемы телеметрии диагностики в течение доли стоимости предыдущих двух вариантов потоковой передачи.

Это диагностическая данные телеметрии, переданные в одно из этих назначений, можно использовать для оценки статистики использования ресурсов и выполнения запросов для упрощения мониторинга производительности.

![На схеме показано множество баз данных и баз данных SQL в управляемых экземплярах, отправляющих данные телеметрии в система диагностики Azure, которые пересылают сведения Аналитика SQL Azure, концентратору событий и хранилищу.](./media/metrics-diagnostic-telemetry-logging-streaming-export-configure/architecture.png)

## <a name="enable-and-configure-the-streaming-export-of-diagnostic-telemetry"></a>Включение и настройка потоковой трансляции телеметрии диагностики

Вы можете включить ведение таких журналов метрик и диагностической телеметрии и управлять ими, используя один из следующих методов:

- Портал Azure
- PowerShell
- Azure CLI
- REST API Azure Monitor
- Шаблон Azure Resource Manager

> [!NOTE]
> Чтобы включить потоковую передачу журнала аудита для телеметрии безопасности, см. статью [Настройка аудита для базы данных](./auditing-overview.md#setup-auditing) и [журналы аудита в Azure Monitor журналов и концентраторах событий Azure](https://techcommunity.microsoft.com/t5/Azure-SQL-Database/SQL-Audit-logs-in-Azure-Log-Analytics-and-Azure-Event-Hubs/ba-p/386242).

## <a name="configure-the-streaming-export-of-diagnostic-telemetry"></a>Настройка потокового экспорта телеметрии диагностики

Для включения и настройки потоковой передачи диагностических данных диагностики можно использовать меню " **параметры диагностики** " портал Azure. Кроме того, можно использовать PowerShell, Azure CLI, шаблоны [REST API](/rest/api/monitor/diagnosticsettings)и [Диспетчер ресурсов](../../azure-monitor/samples/resource-manager-diagnostic-settings.md) для настройки потоковой передачи диагностических данных диагностики. Вы можете задать следующие назначения для потоковой передачи диагностических данных диагностики: служба хранилища Azure, концентраторы событий Azure и журналы Azure Monitor.

> [!IMPORTANT]
> Потоковая передача телеметрии диагностики по умолчанию отключена.

Перейдите на одну из следующих вкладок, чтобы пошаговое руководство по настройке потоковой трансляции диагностических данных диагностики в портал Azure и для сценариев, выполняющих те же действия с помощью PowerShell и Azure CLI.

# <a name="azure-portal"></a>[Портал Azure](#tab/azure-portal)

### <a name="elastic-pools-in-azure-sql-database"></a>Эластичные пулы в базе данных SQL Azure

Вы можете настроить ресурс эластичного пула для сбора следующих данных телеметрии диагностики:

| Ресурс | Мониторинг телеметрии |
| :------------------- | ------------------- |
| **Эластичный пул** | [Основные метрики](metrics-diagnostic-telemetry-logging-streaming-export-configure.md#basic-metrics) содержат сведения о EDTU/ЦП, процентах EDTU и ЦП, проценте считанных физических данных, проценте записи журнала, проценте ресурсов, процентах рабочих ролей, хранении, проценте хранения, предельном объеме хранилища и процентах хранилища XTP. |

Чтобы настроить потоковую передачу телеметрии для эластичных пулов и баз данных в составе пула, необходимо отдельно настроить каждую из них.

- Включение потоковой передачи телеметрии диагностики для эластичного пула
- Включить потоковую передачу телеметрии диагностики для каждой базы данных в эластичном пуле

Контейнер эластичного пула имеет собственную телеметрию, отделяющая данные телеметрии отдельной базы данных в составе пула.

Чтобы включить потоковую передачу телеметрии диагностики для ресурса эластичного пула, выполните следующие действия.

1. Перейдите к ресурсу **эластичного пула** в портал Azure.
2. Выберите **Параметры диагностики** .
3. Выберите **Включить диагностику** , если предыдущие параметры отсутствуют, или **Настройка параметра** , чтобы изменить предыдущий параметр.

   ![Включение диагностики для эластичных пулов](./media/metrics-diagnostic-telemetry-logging-streaming-export-configure/diagnostics-settings-container-elasticpool-enable.png)

4. Введите имя настройки для вашей собственной ссылки.
5. Выберите целевой ресурс для данных диагностики потоковой передачи: **архивировать в учетную запись хранения** , **передавать в концентратор событий** или **отправить в log Analytics** .
6. Для log Analytics выберите **настроить** и создайте новую рабочую область, выбрав **+ создать рабочую область** или выбрав существующую рабочую область.
7. Установите флажок для телеметрии диагностики эластичного пула: **основные** метрики.
   ![Настройка диагностики для эластичных пулов](./media/metrics-diagnostic-telemetry-logging-streaming-export-configure/diagnostics-settings-container-elasticpool-selection.png)

8. Щелкните **Сохранить** .
9. Кроме того, настройте потоковую передачу телеметрии диагностики для каждой базы данных в эластичном пуле, который необходимо отслеживать, выполнив действия, описанные в следующем разделе.

> [!IMPORTANT]
> Помимо настройки телеметрии диагностики для эластичного пула, необходимо также настроить данные телеметрии диагностики для каждой базы данных в эластичном пуле.

### <a name="databases-in-azure-sql-database"></a>Базы данных SQL Azure

Вы можете настроить ресурс базы данных, чтобы получить следующие данные телеметрии диагностики:

| Ресурс | Мониторинг телеметрии |
| :------------------- | ------------------- |
| **Одна база данных или в составе пула** | [Базовые метрики](metrics-diagnostic-telemetry-logging-streaming-export-configure.md#basic-metrics) содержат процент DTU, использованные DTU, предел DTU, процент загрузки ЦП, процент прочитанных физических данных, процент записи в журнал, успешных и неудачных или заблокированных подключениями брандмауэра, процент сеансов, процент рабочих ролей, хранилище, процент хранилища, процентное соотношение хранилища XTP и взаимоблокировки. |

Чтобы включить потоковую передачу диагностических данных диагностики для одной или в составе пула, выполните следующие действия.

1. Перейдите к ресурсу **базы данных SQL** Azure.
2. Выберите **Параметры диагностики** .
3. Выберите **Включить диагностику** , если предыдущие параметры отсутствуют, или **Настройка параметра** , чтобы изменить предыдущий параметр. Вы можете создать до трех параллельных подключений к телеметрии диагностики потоков.
4. Выберите **Добавить параметр диагностики** , чтобы настроить параллельную потоковую передачу диагностических данных в несколько ресурсов.

   ![Включение диагностики для баз данных в одной и в составе пула](./media/metrics-diagnostic-telemetry-logging-streaming-export-configure/diagnostics-settings-database-sql-enable.png)

5. Введите имя настройки для вашей собственной ссылки.
6. Выберите целевой ресурс для данных диагностики потоковой передачи: **архивировать в учетную запись хранения** , **передавать в концентратор событий** или **отправить в log Analytics** .
7. Для стандартных средств мониторинга на основе событий установите следующие флажки для телеметрии журнала диагностики базы данных: **SQLInsights** , **аутоматиктунинг** , **QueryStoreRuntimeStatistics** , **QueryStoreWaitStatistics** , **Errors** , **DatabaseWaitStatistics** , **время ожидания** , **блоки** и **взаимоблокировки** .
8. Чтобы получить дополнительные возможности мониторинга на основе одной минуты, установите флажок для **основных** метрик.

   ![Настройка диагностики для базы данных SQL Azure](./media/metrics-diagnostic-telemetry-logging-streaming-export-configure/diagnostics-settings-database-sql-selection.png)
9. Щелкните **Сохранить** .
10. Повторите эти действия для каждой базы данных, которую необходимо отслеживать.

> [!TIP]
> Повторите эти действия для каждой отдельной базы данных, которую необходимо отслеживать.

### <a name="instances-in-azure-sql-managed-instance"></a>Экземпляры в Azure SQL Управляемый экземпляр

Вы можете настроить ресурс управляемого экземпляра для сбора следующих данных телеметрии диагностики:

| Ресурс | Мониторинг телеметрии |
| :------------------- | ------------------- |
| **Управляемый экземпляр** | [ResourceUsageStats](#resource-usage-stats-for-managed-instances) содержит количество виртуальных ядер, средний процент использования ЦП, а также сведения о запросах ввода-вывода, прочитанных и записанных байтах, зарезервированном и используемом дисковом пространстве. |

Чтобы настроить потоковую передачу телеметрии для управляемых экземпляров и баз данных экземпляров, необходимо отдельно настроить каждую из них:

- Включить потоковую передачу телеметрии диагностики для управляемого экземпляра
- Включить потоковую передачу телеметрии диагностики для каждой базы данных экземпляра

Контейнер управляемого экземпляра имеет собственные данные телеметрии, отдельно от телеметрии каждой базы данных экземпляра.

Чтобы включить потоковую передачу телеметрии диагностики для ресурса управляемого экземпляра, выполните следующие действия.

1. Перейдите к ресурсу **управляемого экземпляра** в портал Azure.
2. Выберите **Параметры диагностики** .
3. Выберите **Включить диагностику** , если предыдущие параметры отсутствуют, или **Настройка параметра** , чтобы изменить предыдущий параметр.

   ![Включение диагностики для управляемого экземпляра](./media/metrics-diagnostic-telemetry-logging-streaming-export-configure/diagnostics-settings-container-mi-enable.png)

4. Введите имя настройки для вашей собственной ссылки.
5. Выберите целевой ресурс для данных диагностики потоковой передачи: **архивировать в учетную запись хранения** , **передавать в концентратор событий** или **отправить в log Analytics** .
6. Для log Analytics выберите **настроить** и создайте новую рабочую область, выбрав **+ создать рабочую область** или используя существующую рабочую область.
7. Установите флажок для телеметрии диагностики экземпляра: **ресаурцеусажестатс** .

   ![Настройка диагностики для управляемого экземпляра](./media/metrics-diagnostic-telemetry-logging-streaming-export-configure/diagnostics-settings-container-mi-selection.png)

8. Щелкните **Сохранить** .
9. Кроме того, настройте потоковую передачу телеметрии диагностики для каждой базы данных экземпляра в управляемом экземпляре, за которым вы хотите наблюдать, выполнив действия, описанные в следующем разделе.

> [!IMPORTANT]
> Помимо настройки телеметрии диагностики для управляемого экземпляра, необходимо также настроить данные телеметрии диагностики для каждой базы данных экземпляра.

### <a name="databases-in-azure-sql-managed-instance"></a>Базы данных в Azure SQL Управляемый экземпляр

Вы можете настроить ресурс базы данных экземпляра для сбора следующих данных телеметрии диагностики:

| Ресурс | Мониторинг телеметрии |
| :------------------- | ------------------- |
| **База данных экземпляра** | [ResourceUsageStats](#resource-usage-stats-for-managed-instances) содержит количество виртуальных ядер, средний процент использования ЦП, а также сведения о запросах ввода-вывода, прочитанных и записанных байтах, зарезервированном и используемом дисковом пространстве. |

Чтобы включить потоковую передачу телеметрии диагностики для базы данных экземпляра, выполните следующие действия.

1. Перейдите к ресурсу **базы данных экземпляра** в управляемом экземпляре.
2. Выберите **Параметры диагностики** .
3. Выберите **Включить диагностику** , если предыдущие параметры отсутствуют, или **Настройка параметра** , чтобы изменить предыдущий параметр.
   - Можно создать до трех (3) параллельных подключений к телеметрии диагностики Stream.
   - Выберите **+Add diagnostic setting** (+ Добавить параметр диагностики), чтобы настроить параллельную потоковую передачу данных диагностики на несколько ресурсов.

   ![Включение диагностики для баз данных экземпляров](./media/metrics-diagnostic-telemetry-logging-streaming-export-configure/diagnostics-settings-database-mi-enable.png)

4. Введите имя настройки для вашей собственной ссылки.
5. Выберите целевой ресурс для данных диагностики потоковой передачи: **архивировать в учетную запись хранения** , **передавать в концентратор событий** или **отправить в log Analytics** .
6. Установите флажки для телеметрии диагностики базы данных: **SQLInsights** , **QueryStoreRuntimeStatistics** , **QueryStoreWaitStatistics** и **Errors** .
   ![Настройка диагностики для баз данных экземпляров](./media/metrics-diagnostic-telemetry-logging-streaming-export-configure/diagnostics-settings-database-mi-selection.png)
7. Щелкните **Сохранить** .
8. Повторите эти действия для каждой базы данных экземпляра, которую необходимо отслеживать.

> [!TIP]
> Повторите эти действия для каждой базы данных экземпляра, которую необходимо отслеживать.

# <a name="powershell"></a>[PowerShell](#tab/azure-powershell)

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

> [!IMPORTANT]
> Модуль PowerShell Azure Resource Manager по-прежнему поддерживается, но вся будущая разработка предназначена для модуля AZ. SQL. Сведения об этих командлетах см. в разделе [AzureRM.Sql](/powershell/module/AzureRM.Sql/). Аргументы команд в модулях Az и AzureRm практически идентичны.

Включить ведение журналов метрик и диагностики можно с помощью PowerShell.

- Чтобы включить хранение метрик и журналов ресурсов в учетной записи хранения, используйте следующую команду:

  ```powershell
  Set-AzDiagnosticSetting -ResourceId [your resource id] -StorageAccountId [your storage account id] -Enabled $true
  ```

  Идентификатор учетной записи хранения представляет собой идентификатор ресурса целевой учетной записи хранения.

- Чтобы включить потоковую передачу метрик и журналов ресурсов в концентратор событий, используйте следующую команду:

  ```powershell
  Set-AzDiagnosticSetting -ResourceId [your resource id] -ServiceBusRuleId [your service bus rule id] -Enabled $true
  ```

  Идентификатор правила служебной шины Azure — это строка в формате:

  ```powershell
  {service bus resource ID}/authorizationrules/{key name}
  ```

- Чтобы включить отправку метрик и журналов ресурсов в Log Analytics рабочую область, используйте следующую команду:

  ```powershell
  Set-AzDiagnosticSetting -ResourceId [your resource id] -WorkspaceId [resource id of the log analytics workspace] -Enabled $true
  ```

- Идентификатор ресурса рабочей области Log Analytics можно получить с помощью следующей команды:

  ```powershell
  (Get-AzOperationalInsightsWorkspace).ResourceId
  ```

Можно объединять эти параметры, чтобы получить несколько вариантов вывода.

**Настройка нескольких ресурсов Azure**

Чтобы обеспечить поддержку нескольких подписок, используйте сценарий PowerShell. Дополнительные сведения см. в статье [Enable Azure resource metrics logging using PowerShell](/archive/blogs/msoms/enable-azure-resource-metrics-logging-using-powershell) (Включение ведения журнала метрик ресурсов Azure с помощью PowerShell).

Укажите идентификатор ресурса рабочей области в \<$WSID\> качестве параметра при выполнении сценария `Enable-AzureRMDiagnostics.ps1` для отправки диагностических данных из нескольких ресурсов в рабочую область.

- Чтобы получить идентификатор рабочей области \<$WSID\> для данных диагностики, используйте следующий скрипт:

  ```powershell
  $WSID = "/subscriptions/<subID>/resourcegroups/<RG_NAME>/providers/microsoft.operationalinsights/workspaces/<WS_NAME>"
  .\Enable-AzureRMDiagnostics.ps1 -WSID $WSID
  ```

  Замените \<subID\> идентификатором подписки, \<RG_NAME\> именем группы ресурсов и \<WS_NAME\> именем рабочей области.

# <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

Можно включить ведение журналов метрик и диагностики с помощью Azure CLI.

> [!IMPORTANT]
> Скрипты для включения ведения журнала диагностики поддерживаются для Azure CLI v 1.0. В настоящее время Azure CLI версии 2.0 не поддерживается.

- Чтобы включить хранение метрик и журналов ресурсов в учетной записи хранения, используйте следующую команду:

  ```azurecli-interactive
  azure insights diagnostic set --resourceId <resourceId> --storageId <storageAccountId> --enabled true
  ```

  Идентификатор учетной записи хранения представляет собой идентификатор ресурса целевой учетной записи хранения.

- Чтобы включить потоковую передачу метрик и журналов ресурсов в концентратор событий, используйте следующую команду:

  ```azurecli-interactive
  azure insights diagnostic set --resourceId <resourceId> --serviceBusRuleId <serviceBusRuleId> --enabled true
  ```

  Идентификатор правила служебной шины — это строка в формате:

  ```azurecli-interactive
  {service bus resource ID}/authorizationrules/{key name}
  ```

- Чтобы включить отправку метрик и журналов ресурсов в Log Analytics рабочую область, используйте следующую команду:

  ```azurecli-interactive
  azure insights diagnostic set --resourceId <resourceId> --workspaceId <resource id of the log analytics workspace> --enabled true
  ```

Можно объединять эти параметры, чтобы получить несколько вариантов вывода.

---

## <a name="stream-into-sql-analytics"></a>Потоковая передача в SQL Analytics

База данных SQL Azure и метрики Управляемый экземпляр Azure и журналы ресурсов, которые передаются в рабочую область Log Analytics, могут быть использованы Аналитика SQL Azure. Аналитика SQL Azure — это облачное решение, которое наблюдает за производительностью отдельных баз данных, эластичных пулов и баз данных в составе пула, а также управляемых экземпляров и баз данных экземпляров в масштабе и нескольких подписках. Она помогает собирать и визуализировать метрики производительности, а также содержит встроенные средства анализа для устранения неполадок производительности.

![Обзор службы "Аналитика SQL Azure"](./media/metrics-diagnostic-telemetry-logging-streaming-export-configure/azure-sql-sol-overview.png)

### <a name="installation-overview"></a>Обзор установки

Вы можете отслеживать коллекцию баз данных и коллекций баз данных с помощью Аналитика SQL Azure, выполнив следующие действия.

1. Создайте решение "Аналитика SQL Azure" из Azure Marketplace.
2. Создайте рабочую область Log Analytics в решении.
3. Настройте для баз данных потоковую передачу телеметрии диагностики в рабочую область.

Потоковую передачу данных телеметрии диагностики можно настроить с помощью встроенного параметра **Send to log Analytics** на вкладке параметры диагностики в портал Azure. Вы также можете включить потоковую передачу в рабочую область Log Analytics, используя параметры диагностики с помощью [командлетов PowerShell](metrics-diagnostic-telemetry-logging-streaming-export-configure.md?tabs=azure-powershell#configure-the-streaming-export-of-diagnostic-telemetry), [Azure CLI](metrics-diagnostic-telemetry-logging-streaming-export-configure.md?tabs=azure-cli#configure-the-streaming-export-of-diagnostic-telemetry), [Azure Monitor REST API](/rest/api/monitor/diagnosticsettings)или [шаблонов диспетчер ресурсов](../../azure-monitor/samples/resource-manager-diagnostic-settings.md).

### <a name="create-an-azure-sql-analytics-resource"></a>Создание ресурса Аналитика SQL Azure

1. Выполните поиск по запросу "Аналитика SQL Azure" в Azure Marketplace и выберите найденное решение.

   ![Поиск службы Аналитика SQL Azure на портале](./media/metrics-diagnostic-telemetry-logging-streaming-export-configure/sql-analytics-in-marketplace.png)

2. На экране обзора решения выберите **создать** .

3. В форме "Аналитика SQL Azure" введите необходимые дополнительные сведения: имя рабочей области, подписку, группу ресурсов, расположение и ценовую категорию.

   ![Настройка службы "Аналитика SQL Azure" на портале](./media/metrics-diagnostic-telemetry-logging-streaming-export-configure/sql-analytics-configuration-blade.png)

4. Нажмите **ОК** для подтверждения, а затем выберите **Создать** .

### <a name="configure-the-resource-to-record-metrics-and-resource-logs"></a>Настройка ресурса для записи метрик и журналов ресурсов

Необходимо отдельно настроить потоковую передачу телеметрии для отдельных баз данных, пулов эластичных БД, управляемых экземпляров и баз данных экземпляров. Самый простой способ настроить расположение метрик в записи ресурса — использовать портал Azure. Подробные инструкции см. [в статье Настройка потоковой трансляции телеметрии диагностики](metrics-diagnostic-telemetry-logging-streaming-export-configure.md?tabs=azure-portal#configure-the-streaming-export-of-diagnostic-telemetry).

### <a name="use-azure-sql-analytics-for-monitoring-and-alerting"></a>Использование Аналитика SQL Azure для мониторинга и оповещений

Вы можете использовать SQL Analytics в качестве иерархической панели мониторинга для просмотра ресурсов базы данных.

- Сведения об использовании Аналитика SQL Azure см. в разделе [мониторинг с помощью SQL Analytics](../../azure-monitor/insights/azure-sql.md).
- Сведения о настройке оповещений для в SQL Analytics см. в статье [Создание оповещений для базы данных, эластичных пулов и управляемых экземпляров](../../azure-monitor/insights/azure-sql.md#analyze-data-and-create-alerts).

## <a name="stream-into-event-hubs"></a>Потоковая передача в Центры событий

Вы можете выполнять потоковую передачу метрик базы данных SQL Azure и Azure SQL Управляемый экземпляр и журналы ресурсов в концентраторы событий, используя встроенный **поток в параметре концентратора событий** в портал Azure. Идентификатор правила служебной шины можно также включить с помощью параметров диагностики с помощью командлетов PowerShell, Azure CLI или Azure Monitor REST API. Убедитесь, что концентратор событий находится в том же регионе, что база данных и сервер.

### <a name="what-to-do-with-metrics-and-resource-logs-in-event-hubs"></a>Что делать с метриками и журналами ресурсов в концентраторах событий

Выполнив потоковую передачу выбранных данных в Центры событий, вы становитесь на один шаг ближе к включению дополнительных сценариев мониторинга. Центры событий выступают в качестве "двери" для конвейера событий. После сбора данных в концентраторе событий их можно преобразовывать и сохранять с помощью поставщика аналитики в реальном времени или адаптера хранения. Центры событий отделяют производство потока событий от потребления этих событий. Таким образом потребители событий могут получать доступ к событиям по собственному расписанию. Дополнительные сведения о Центрах событий см. в следующих статьях:

- [Что такое Центры событий?](../../event-hubs/event-hubs-about.md)
- [Приступая к работе с Центрами событий](../../event-hubs/event-hubs-dotnet-standard-getstarted-send.md)

Потоковые метрики в Центрах событий можно использовать для следующих целей:

- **Просмотр работоспособности службы путем потоковой передачи данных с горячий путь в Power BI**

  С помощью Центров событий, Stream Analytics и Power BI можно в близком к реальному времени получать аналитическую информацию о службах Azure на основе метрик и диагностических данных. Обзор настройки концентраторов событий, обработки данных в Stream Analytics и вывода информации через Power BI см. в статье [Stream Analytics и Power BI. Панель мониторинга для анализа потоковой передачи данных](../../stream-analytics/stream-analytics-power-bi-dashboard.md).

- **Потоковая передача журналов в сторонние потоки ведения журналов и телеметрии**

  С помощью потоковой передачи концентраторов событий можно получить метрики и журналы ресурсов в различных решениях по мониторингу и анализу журналов сторонних разработчиков.

- **Создание пользовательской платформы для телеметрии и ведения журнала**

  У вас уже есть платформа телеметрии, созданная на заказ, или вы планируете ее создать? Высокая масштабируемость публикации и подписки концентраторов событий позволяет гибко принимать метрики и журналы ресурсов. Ознакомьтесь с [руководством Дэна Росановы (Dan Rosanova) по использованию Центров событий для глобальной платформы телеметрии](https://azure.microsoft.com/documentation/videos/build-2015-designing-and-sizing-a-global-scale-telemetry-platform-on-azure-event-Hubs/).

## <a name="stream-into-azure-storage"></a>Потоковая передача в службу хранилища Azure

Вы можете хранить метрики и журналы ресурсов в службе хранилища Azure, используя встроенный архив в **учетную запись хранения** в портал Azure. Хранилище можно также включить с помощью параметров диагностики с помощью командлетов PowerShell, Azure CLI или Azure Monitor REST API.

### <a name="schema-of-metrics-and-resource-logs-in-the-storage-account"></a>Схема метрик и журналов ресурсов в учетной записи хранения

После настройки метрик и сбора журналов ресурсов в учетной записи хранения, выбранной для доступа к первым строкам данных, создается контейнер хранилища. Вот как выглядит структура большого двоичного объекта:

```powershell
insights-{metrics|logs}-{category name}/resourceId=/SUBSCRIPTIONS/{subscription ID}/ RESOURCEGROUPS/{resource group name}/PROVIDERS/Microsoft.SQL/servers/{resource_server}/ databases/{database_name}/y={four-digit numeric year}/m={two-digit numeric month}/d={two-digit numeric day}/h={two-digit 24-hour clock hour}/m=00/PT1H.json
```

Или даже еще проще:

```powershell
insights-{metrics|logs}-{category name}/resourceId=/{resource Id}/y={four-digit numeric year}/m={two-digit numeric month}/d={two-digit numeric day}/h={two-digit 24-hour clock hour}/m=00/PT1H.json
```

Например, имя большого двоичного объекта для основных метрик может быть следующим:

```powershell
insights-metrics-minute/resourceId=/SUBSCRIPTIONS/s1id1234-5679-0123-4567-890123456789/RESOURCEGROUPS/TESTRESOURCEGROUP/PROVIDERS/MICROSOFT.SQL/ servers/Server1/databases/database1/y=2016/m=08/d=22/h=18/m=00/PT1H.json
```

Имя BLOB-объекта для хранения данных из эластичного пула выглядит следующим образом:

```powershell
insights-{metrics|logs}-{category name}/resourceId=/SUBSCRIPTIONS/{subscription ID}/ RESOURCEGROUPS/{resource group name}/PROVIDERS/Microsoft.SQL/servers/{resource_server}/ elasticPools/{elastic_pool_name}/y={four-digit numeric year}/m={two-digit numeric month}/d={two-digit numeric day}/h={two-digit 24-hour clock hour}/m=00/PT1H.json
```

## <a name="data-retention-policy-and-pricing"></a>Политика хранения данных и цены

Если выбрать Центры событий или учетную запись хранения, можно указать политику хранения. Эта политика удаляет данные, которые хранятся дольше выбранного периода времени. При указании Log Analytics политика хранения определяется на основании выбранной ценовой категории. В этом случае предоставляемые бесплатные единицы приема данных позволяют выполнять бесплатный мониторинг нескольких баз данных каждый месяц. Любое потребление диагностических данных диагностики за пределами бесплатных модулей может повлечь расходы.

> [!IMPORTANT]
> Активные базы данных с более тяжелыми рабочими нагрузками принимают больше данных, чем простаивающие базы данных. Дополнительные сведения см. в статье [цены на log Analytics](https://azure.microsoft.com/pricing/details/monitor/).

Если вы используете Аналитика SQL Azure, вы можете отслеживать потребление данных, выбрав **рабочую область OMS** в меню навигации аналитика SQL Azure, а затем выбрав **Использование** и **предполагаемые затраты** .

## <a name="metrics-and-logs-available"></a>Доступные метрики и журналы

В этом разделе статьи описывается отслеживание телеметрии для отдельных баз данных, баз данных в составе пула, эластичных пулов, управляемых экземпляров и баз данных экземпляров. Собранные данные телеметрии мониторинга в SQL Analytics можно использовать для собственного пользовательского анализа и разработки приложений с помощью [Azure Monitor языка запросов журналов](../../azure-monitor/log-query/get-started-queries.md) .

### <a name="basic-metrics"></a>Основные метрики

Сведения об основных метриках по ресурсам см. в следующих таблицах.

> [!NOTE]
> Параметр "основные метрики" ранее назывался всеми метриками. Изменения были внесены только в именование и не были изменены отслеживаемые метрики. Это изменение было инициировано для предоставления дополнительных категорий метрик в будущем.

#### <a name="basic-metrics-for-elastic-pools"></a>Основные метрики для эластичных пулов

|**Ресурс**|**Метрики**|
|---|---|
|Эластичный пул|Сведения о проценте использования DTU, используемых единицах DTU, ограничении DTU, проценте использования ЦП, проценте чтения физических данных, проценте записей в журнал, проценте сеансов, проценте рабочих ролей, хранилище, проценте хранилища, ограничении хранилища, проценте хранилища XTP. |

#### <a name="basic-metrics-for-single-and-pooled-databases"></a>Основные метрики для баз данных в одной и в составе пула

|**Ресурс**|**Метрики**|
|---|---|
|Одна база данных и в составе пула|Сведения о проценте использования DTU, используемых единицах DTU, ограничении DTU, проценте использования ЦП, проценте чтения физических данных, проценте записей в журнал, проценте успешных, неудачных или заблокированных подключений брандмауэра, проценте сеансов, проценте рабочих ролей, хранилище, проценте хранилища, проценте хранилища XTP и взаимоблокировках. |

### <a name="advanced-metrics"></a>Дополнительные метрики

Дополнительные сведения о дополнительных метриках см. в следующей таблице.

|**Метрика**|**Отображаемое имя метрики**|**Описание**|
|---|---|---|
|sqlserver_process_core_percent<sup>1</sup>|Процент ядра процесса SQL|Процент использования ЦП для процесса SQL, измеряемый операционной системой.|
|sqlserver_process_memory_percent<sup>1</sup> |Процент памяти процесса SQL|Процент использования памяти для процесса SQL, измеряемый операционной системой.|
|tempdb_data_size<sup>2</sup>| Размер файла данных tempdb в КБ |Размер файла данных tempdb в килобайтах.|
|tempdb_log_size<sup>2</sup>| Размер файла журнала tempdb в КБ |Размер файла журнала tempdb в килобайтах.|
|tempdb_log_used_percent<sup>2</sup>| Процент использования журнала tempdb |Используемый журнал в процентах tempdb.|

<sup>1</sup> эта метрика доступна для баз данных, использующих модель приобретения Виртуальное ядро с 2 виртуальных ядер и выше, или 200 DTU и выше для моделей приобретения на основе DTU.

<sup>2</sup> эта метрика доступна для баз данных, использующих модель приобретения Виртуальное ядро с 2 виртуальных ядер и выше, или 200 DTU и выше для моделей приобретения на основе DTU. Эта метрика в настоящее время недоступна для масштабируемых баз данных или хранилищ данных.

### <a name="basic-logs"></a>Основные журналы

Сведения о телеметрии, доступные для всех журналов, описаны в следующих таблицах. Дополнительные сведения см. в разделе [Поддерживаемые диагностические данные телеметрии](#diagnostic-telemetry-for-export).

#### <a name="resource-usage-stats-for-managed-instances"></a>Статистика использования ресурсов для управляемых экземпляров

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure.|
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Тип|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: ResourceUsageStats |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: MANAGEDINSTANCES |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя управляемого экземпляра |
|ResourceId|Универсальный код ресурса (URI) |
|SKU_s|SKU продукта SQL Управляемый экземпляр |
|virtual_core_count_s|Доступное количество виртуальных ядер |
|avg_cpu_percent_s|Average CPU percentage (Средний процент использования ЦП) |
|reserved_storage_mb_s|Зарезервированная емкость хранилища в управляемом экземпляре |
|storage_space_used_mb_s|Использованный объем хранилища в управляемом экземпляре |
|io_requests_s|Количество операций ввода-вывода |
|io_bytes_read_s|Количество считанных байтов операций ввода-вывода |
|io_bytes_written_s|Количество записанных байтов операций ввода-вывода |

#### <a name="query-store-runtime-statistics"></a>Статистика среды выполнения хранилища запросов

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Тип|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: QueryStoreRuntimeStatistics. |
|OperationName|Имя операции. Всегда: QueryStoreRuntimeStatisticsEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|query_hash_s|Хэш запроса. |
|query_plan_hash_s|Хэш плана запроса. |
|statement_sql_handle_s|Дескриптор SQL инструкции. |
|interval_start_time_d|Начальное значение datetimeoffset интервала в тактах с 01.01.1900 |
|interval_end_time_d|Конечное значение datetimeoffset интервала в тактах с 01.01.1900 |
|logical_io_writes_d|Общее число логических операций записи ввода-вывода |
|max_logical_io_writes_d|Максимальное число логических операций записи ввода-вывода при выполнении каждого запроса |
|physical_io_reads_d|Общее число физических операций чтения ввода-вывода |
|max_physical_io_reads_d|Максимальное число логических операций чтения ввода-вывода при выполнении каждого запроса |
|logical_io_reads_d|Общее число логических операций чтения ввода-вывода |
|max_logical_io_reads_d|Максимальное число логических операций чтения ввода-вывода при выполнении каждого запроса |
|execution_type_d|Тип выполнения. |
|count_executions_d|Число выполнений запроса |
|cpu_time_d|Общее процессорное время, затраченное на выполнение запроса, в микросекундах |
|max_cpu_time_d|Максимальное потребление процессорного времени на выполнение одного запроса в микросекундах |
|dop_d|Сумма степеней параллелизма |
|max_dop_d|Максимальная степень параллелизма, используемая для выполнения одного запроса |
|rowcount_d|Общее число возвращаемых строк |
|max_rowcount_d|Максимальное число строк, возвращаемых при выполнении одного запроса |
|query_max_used_memory_d|Общий объем используемой памяти в килобайтах |
|max_query_max_used_memory_d|Максимальный объем памяти, используемой при выполнении одного запроса, в килобайтах |
|duration_d|Общее время выполнения запроса в миллисекундах |
|max_duration_d|Максимальное время выполнения одного запроса |
|num_physical_io_reads_d|Общее число физических операций чтения |
|max_num_physical_io_reads_d|Максимальное число физических операций чтения при выполнении каждого запроса |
|log_bytes_used_d|Общий объем записанного журнала в байтах |
|max_log_bytes_used_d|Максимальное число байтов журнала, используемых при выполнения каждого запроса |
|query_id_d|Идентификатор запроса в хранилище запросов |
|plan_id_d|Идентификатор плана в хранилище запросов |

Дополнительные сведения о [статистических данных времени выполнения хранилища запросов](/sql/relational-databases/system-catalog-views/sys-query-store-runtime-stats-transact-sql).

#### <a name="query-store-wait-statistics"></a>Статистика времени ожидания хранилища запросов

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Тип|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: QueryStoreWaitStatistics. |
|OperationName|Имя операции. Всегда: QueryStoreWaitStatisticsEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|wait_category_s|Категория времени ожидания |
|is_parameterizable_s|Указывает, подлежит ли запрос параметризации |
|statement_type_s|Тип инструкции |
|statement_key_hash_s|Хэш ключа инструкции |
|exec_type_d|Типа выполнения. |
|total_query_wait_time_ms_d|Общее время ожидания запроса в определенной категории времени ожидания |
|max_query_wait_time_ms_d|Максимальное время ожидания запроса при отдельном выполнении в определенной категории времени ожидания. |
|query_param_type_d|0 |
|query_hash_s|Хэш запроса в хранилище запросов |
|query_plan_hash_s|Хэш плана запроса в хранилище запросов. |
|statement_sql_handle_s|Дескриптор инструкции в хранилище запросов. |
|interval_start_time_d|Начальное значение datetimeoffset интервала в тактах с 01.01.1900 |
|interval_end_time_d|Конечное значение datetimeoffset интервала в тактах с 01.01.1900 |
|count_executions_d|Количество выполнений запроса. |
|query_id_d|Идентификатор запроса в хранилище запросов |
|plan_id_d|Идентификатор плана в хранилище запросов |

Дополнительные сведения о [статистических данных времени ожидания хранилища запросов](/sql/relational-databases/system-catalog-views/sys-query-store-wait-stats-transact-sql).

#### <a name="errors-dataset"></a>Набор данных ошибок

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Тип|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: Errors. |
|OperationName|Имя операции. Всегда: ErrorEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|Сообщение|Сообщение об ошибке в виде обычного текста. |
|user_defined_b|Указывает, установлен ли бит ошибки пользователем. |
|error_number_d|Код ошибки |
|Severity|Серьезность ошибки. |
|state_d|Состояние ошибки. |
|query_hash_s|Хэш запроса, завершившегося сбоем (при наличии) |
|query_plan_hash_s|Хэш плана запроса для запроса, завершившегося сбоем (при наличии) |

Дополнительные сведения о [сообщениях об ошибках SQL](/sql/relational-databases/errors-events/database-engine-events-and-errors).

#### <a name="database-wait-statistics-dataset"></a>Набор данных статистики времени ожидания базы данных

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Тип|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: DatabaseWaitStatistics. |
|OperationName|Имя операции. Всегда: DatabaseWaitStatisticsEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|wait_type_s|Имя типа времени ожидания. |
|start_utc_date_t [UTC]|Время начала измеренного периода |
|end_utc_date_t [UTC]|Время окончания измеренного периода |
|delta_max_wait_time_ms_d|Максимальное время ожидания при выполнении одного запроса. |
|delta_signal_wait_time_ms_d|Общее время ожидания сигнала |
|delta_wait_time_ms_d|Общее время ожидания в течение периода. |
|delta_waiting_tasks_count_d|Число ожидающих задач. |

Дополнительные сведения о [статистике времени ожидания базы данных](/sql/relational-databases/system-dynamic-management-views/sys-dm-os-wait-stats-transact-sql).

#### <a name="time-outs-dataset"></a>Набор данных времени ожидания

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Тип|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: Timeouts. |
|OperationName|Имя операции. Всегда: TimeoutEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|error_state_d|Код состояния ошибки. |
|query_hash_s|Хэш запроса, если он доступен |
|query_plan_hash_s|Хэш плана запроса, если он доступен |

#### <a name="blockings-dataset"></a>Набор данных блокировки

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Тип|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: Blocks. |
|OperationName|Имя операции. Всегда: BlockEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|lock_mode_s|Режим блокировки, используемый для запроса. |
|resource_owner_type_s|Владелец блокировки |
|blocked_process_filtered_s|Отчет о заблокированных процессах в формате XML |
|duration_d|Длительность блокировки в микросекундах |

#### <a name="deadlocks-dataset"></a>Набор данных взаимоблокировки

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC] |Метка времени, когда был записан журнал |
|Тип|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: Deadlocks. |
|OperationName|Имя операции. Всегда: DeadlockEvent. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|deadlock_xml_s|Отчет о взаимоблокировке в формате XML |

#### <a name="automatic-tuning-dataset"></a>Набор данных автоматической настройки

|Свойство|Описание|
|---|---|
|TenantId|Идентификатор клиента |
|SourceSystem|Всегда: Azure. |
|TimeGenerated [UTC]|Метка времени, когда был записан журнал |
|Тип|Всегда: AzureDiagnostics. |
|ResourceProvider|Имя поставщика ресурсов. Всегда: MICROSOFT.SQL. |
|Категория|Имя категории. Всегда: AutomaticTuning. |
|Ресурс|Имя ресурса. |
|ResourceType|Имя типа ресурса. Всегда: SERVERS/DATABASES. |
|SubscriptionId|GUID подписки для базы данных |
|ResourceGroup|Имя группы ресурсов для базы данных |
|LogicalServerName_s|Имя сервера для базы данных |
|LogicalDatabaseName_s|Имя базы данных. |
|ElasticPoolName_s|Имя эластичного пула для базы данных (при наличии) |
|DatabaseName_s|Имя базы данных. |
|ResourceId|Универсальный код ресурса (URI) |
|RecommendationHash_s|Уникальный хэш рекомендаций по автоматической настройке |
|OptionName_s|Операция автоматической настройки |
|Schema_s|Схема базы данных |
|Table_s|Затронутая таблица |
|IndexName_s|Имя индекса |
|IndexColumns_s|Имя столбца |
|IncludedColumns_s|Включенные столбцы |
|EstimatedImpact_s|Предполагаемое влияние JSON-файла рекомендаций по автоматической настройке |
|Event_s|Тип события автоматической настройки |
|Timestamp_t|Метка времени последнего обновления |

#### <a name="intelligent-insights-dataset"></a>Набор данных Intelligent Insights

Дополнительные сведения о [формате журнала Intelligent Insights](intelligent-insights-use-diagnostics-log.md).

## <a name="next-steps"></a>Дальнейшие действия

Чтобы научиться включать ведение журнала и узнать, какие метрики и категории журналов поддерживаются различными службами Azure, ознакомьтесь со следующими статьями:

- [Общие сведения о метриках в Microsoft Azure](../../azure-monitor/platform/data-platform.md)
- [Общие сведения о журналах платформы Azure](../../azure-monitor/platform/platform-logs-overview.md)

Дополнительные сведения о Центрах событий см. в статье:

- [Что такое Центры событий Azure?](../../event-hubs/event-hubs-about.md)
- [Приступая к работе с Центрами событий](../../event-hubs/event-hubs-dotnet-standard-getstarted-send.md)

Сведения о настройке оповещений на основе данных телеметрии из log Analytics см. в следующих статьях:

- [Создание оповещений для базы данных SQL Azure и Управляемый экземпляр Azure SQL](../../azure-monitor/insights/azure-sql.md#analyze-data-and-create-alerts)