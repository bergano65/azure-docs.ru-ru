---
title: Мониторинг производительности базы данных с помощью Intelligent Insights
description: Intelligent Insights в базе данных SQL Azure и Azure SQL Управляемый экземпляр использует встроенную аналитику для постоянного отслеживания использования базы данных с помощью искусственного интеллекта и обнаружения событий, вызывающих низкую производительность.
services: sql-database
ms.service: sql-db-mi
ms.subservice: performance
ms.custom: sqldbrb=2
ms.devlang: ''
ms.topic: conceptual
author: danimir
ms.author: danil
ms.reviewer: jrasnik, carlrab
ms.date: 06/12/2020
ms.openlocfilehash: 96557a6049b316a69c32e96012206eab128e024a
ms.sourcegitcommit: 93462ccb4dd178ec81115f50455fbad2fa1d79ce
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/06/2020
ms.locfileid: "85986510"
---
# <a name="intelligent-insights-using-ai-to-monitor-and-troubleshoot-database-performance-preview"></a>Intelligent Insights использование искусственного интеллекта для отслеживания и устранения неполадок производительности базы данных (Предварительная версия)
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

Intelligent Insights в базе данных SQL Azure и Управляемый экземпляр SQL Azure позволяет узнать, что происходит с производительностью базы данных.

Intelligent Insights использует встроенный аналитический механизм базы данных постоянного отслеживания использования базы данных с помощью искусственного интеллекта и обнаружения аварийных событий, снижающих производительность. После обнаружения будет выполнен подробный анализ, создающий журнал ресурсов Intelligent Insights (именуемый SQLInsights) с интеллектуальной оценкой проблемы. Эта оценка состоит из анализа первопричин проблемы с производительностью базы данных и возможных рекомендаций по повышению производительности.

## <a name="what-can-intelligent-insights-do-for-you"></a>Что Intelligent Insights может сделать для вас?

Intelligent Insights — уникальная функция встроенного аналитического механизма Azure, который предлагает следующие возможности:

- Упреждающий мониторинг
- специализированная аналитика производительности;
- заблаговременное выявление снижения производительности базы данных;
- анализ первопричин обнаруженных проблем;
- рекомендации по повышению производительности;
- возможность развертывания сотен тысяч баз данных;
- положительное влияние на ресурсы DevOps и совокупную стоимость владения.

## <a name="how-does-intelligent-insights-work"></a>Как работает Intelligent Insights?

Intelligent Insights анализирует производительность базы данных и сравнивает ее рабочую нагрузку за последний час с базовыми показателями рабочей нагрузки за последние семь дней. Рабочая нагрузка базы данных состоит из запросов, которые считаются наиболее важными для производительности базы данных, такие как наиболее повторяющиеся запросы и запросы наибольшего размера. Поскольку каждая база данных уникальна в зависимости от структуры, данных, использования и приложений, каждая создаваемая Базовая нагрузка зависит от конкретной рабочей нагрузки. Независимо от базовых показателей рабочей нагрузки Intelligent Insights также отслеживает абсолютные рабочие пороговые значения и обнаруживает проблемы, связанные с повышенным временем ожидания, критическими исключениями и параметризацией запросов, которые могут негативно повлиять на производительность.

После обнаружения проблемы снижения производительности в нескольких наблюдаемых метриках с помощью искусственного интеллекта выполняется анализ. Его результаты записываются в журнал диагностики. Они содержат ценную аналитику по операциям с базой данных. Intelligent Insights позволяет легко отслеживать проблемы с производительностью базы данных с момента их выявления и до устранения. Каждая обнаруженная проблема отслеживается по всему жизненному циклу — от изначального обнаружения проблемы и проверки улучшения производительности до ее решения.

![Рабочий процесс анализа производительности базы данных](./media/intelligent-insights-overview/intelligent-insights-concept.png)

Метрики, используемые для измерения и обнаружения проблем с производительностью базы данных, основаны на длительности запроса, запросов с истекшим временем ожидания, повышенном времени ожидания и запросах с ошибками. Дополнительные сведения о метриках см. в разделе [метрики обнаружения](#detection-metrics).

Выявленные снижения производительности базы данных записываются в журнал SQLInsights с помощью интеллектуальных записей, состоящих из следующих свойств:

| Свойство. | Сведения |
| :------------------- | ------------------- |
| сведения о базе данных; | Метаданные базы данных, для которой была обнаружена аналитика. Например, URI ресурса. |
| Наблюдаемый диапазон времени | Время начала и окончания периода обнаруженной аналитики. |
| Затронутые метрики | Метрики, вызвавшие создание аналитики: <ul><li>Увеличение длительности запросов [с].</li><li>Повышенное время ожидания [с].</li><li>Запросы, время ожидания которых истекло [процент].</li><li>Запросы, завершившиеся сбоем [процент].</li></ul>|
| Значение последствий | Значение измеренной метрики. |
| Затронутые запросы и коды ошибок | Хэш запроса или код ошибки. Их можно легко сопоставить с затронутыми запросами. Предоставляются метрики увеличения продолжительности запросов, времени ожидания, счетчиков времени ожидания или кодов ошибок. |
| Обнаружения | Проблема обнаруживается в базе данных во время события. Существуют 15 шаблонов обнаружения. Дополнительные сведения см. в статье [Устранение проблем с производительностью базы данных SQL Azure с помощью Intelligent Insights](intelligent-insights-troubleshoot-performance.md). |
| Анализ первопричин | Анализ первопричин обнаруженной проблемы в понятном для понимания формате. Некоторые аналитические данные могут содержать рекомендации по улучшению производительности, если это возможно. |
|||

Практические сведения об использовании Intelligent Insights с Аналитика SQL Azure и типичных сценариях использования см. в этом видео:

> [!VIDEO https://channel9.msdn.com/Shows/Azure-Friday/Get-Intelligent-Insights-for-Improving-Azure-SQL-Database-Performance/player]
>

Intelligent Insights неисправностей обнаружения и устранения проблем с производительностью базы данных. Чтобы использовать Intelligent Insights для устранения проблем с производительностью базы данных, см. статью [Устранение неполадок с производительностью Intelligent Insights](intelligent-insights-troubleshoot-performance.md).

## <a name="intelligent-insights-options"></a>Параметры Intelligent Insights

Доступны следующие параметры Intelligent Insights:

| Intelligent Insights, параметр | Поддержка Базы данных SQL Azure | Поддержка Управляемого экземпляра SQL Azure |
| :----------------------------- | ----- | ----- |
| **Настройка Intelligent Insights** . настройка анализа Intelligent Insights для баз данных. | Да | Да |
| **Stream Insights для аналитика SQL Azure** --Stream Insights для аналитика SQL Azure. | Да | Да |
| **Stream Insights для концентраторов событий Azure** — Stream Insights to концентраторы событий для дальнейшей пользовательской интеграции. | Да | Да |
| **Stream Insights для службы хранилища Azure** — Stream Insights в службе хранилища Azure для дальнейшего анализа и долгосрочного архивирования. | Да | Да |

> [!NOTE]
> Intelligent Insights — это предварительная версия функции, недоступная в следующих регионах: Западная Европа, Северная Европа, Западная часть США 1 и Восточная часть США 1.

## <a name="configure-the-export-of-the-intelligent-insights-log"></a>Настройка экспорта журнала Intelligent Insights

Выходные данные Intelligent Insights могут быть передаваться в поток в одном из нескольких назначений для анализа:

- Выходные данные в Log Analytics рабочей области можно использовать с [аналитика SQL Azure](https://docs.microsoft.com/azure/log-analytics/log-analytics-azure-sql) для просмотра аналитических сведений через пользовательский интерфейс портал Azure. Это интегрированное решение Azure, а также наиболее типичный способ просмотра аналитических сведений.
- Вывод потоковой передачи в концентраторы событий Azure можно использовать для разработки пользовательских сценариев мониторинга и оповещения.
- Выходные данные, потоковые передачи в службу хранилища Azure можно использовать для разработки пользовательских приложений, например для создания пользовательских отчетов, долгосрочной архивации данных и т. д.

Интеграция Аналитика SQL Azure, концентраторов событий Azure, службы хранилища Azure или продуктов сторонних производителей для использования осуществляется с помощью первого включения ведения журнала Intelligent Insights ("SQLInsights") в колонке "параметры диагностики" базы данных, а затем настраивает данные журнала Intelligent Insights для потоковой передачи в одно из этих назначений.

Дополнительные сведения о включении ведения журнала Intelligent Insights и настройке метрик и данных журнала ресурсов для потоковой передачи на использование продукта см. в разделе [метрики и журнал диагностики](metrics-diagnostic-telemetry-logging-streaming-export-configure.md).

### <a name="set-up-with-azure-sql-analytics"></a>Настройка для использования с Аналитикой SQL Azure

Аналитика SQL Azure решение предоставляет графический пользовательский интерфейс, возможности создания отчетов и оповещения о производительности базы данных с использованием Intelligent Insights данных журнала ресурсов.

Добавление Аналитика SQL Azure на панель мониторинга портал Azure из Marketplace и создание рабочей области см. в разделе [configure аналитика SQL Azure](../../azure-monitor/insights/azure-sql.md#configuration)

Чтобы использовать Intelligent Insights с Аналитика SQL Azure, настройте передачу данных журнала Intelligent Insights в Аналитика SQL Azure рабочей области, созданной на предыдущем шаге, в разделе [метрики и ведение журнала диагностики](metrics-diagnostic-telemetry-logging-streaming-export-configure.md).

Ниже приведен пример просмотра данных Intelligent Insights в Аналитике SQL Azure:

![Отчет Intelligent Insights](./media/intelligent-insights-overview/intelligent-insights-azure-sql-analytics.png)

### <a name="set-up-with-event-hubs"></a>Настройка для использования с Центрами событий

Чтобы использовать Intelligent Insights с концентраторами событий, настройте Intelligent Insights данные журнала для потоковой передачи в концентраторы событий, см. раздел [метрики и журнал диагностики](metrics-diagnostic-telemetry-logging-streaming-export-configure.md) и [потоковая передача журналов диагностики Azure в концентраторы событий](../../azure-monitor/platform/resource-logs-stream-event-hubs.md).

Сведения об использовании концентраторов событий для настройки настраиваемого мониторинга и оповещений см. в статье [что делать с метриками и журналами диагностики в концентраторах событий](metrics-diagnostic-telemetry-logging-streaming-export-configure.md#what-to-do-with-metrics-and-resource-logs-in-event-hubs).

### <a name="set-up-with-azure-storage"></a>Настройка для использования со службой хранилища Azure

Чтобы использовать Intelligent Insights с хранилищем, настройте Intelligent Insights данные журналов для потоковой передачи в хранилище, см. раздел [метрики, ведение журнала диагностики](metrics-diagnostic-telemetry-logging-streaming-export-configure.md) и [потоковая передача в службу хранилища Azure](metrics-diagnostic-telemetry-logging-streaming-export-configure.md#stream-into-azure-storage).

### <a name="custom-integrations-of-intelligent-insights-log"></a>Настраиваемая интеграция журнала Intelligent Insights

Сведения об использовании Intelligent Insights со сторонними инструментами, а также при разработке пользовательских предупреждений и мониторинга см. [в статье Использование журнала диагностики производительности Intelligent Insights базы данных](intelligent-insights-use-diagnostics-log.md).

## <a name="detection-metrics"></a>Метрики обнаружения

Метрики, используемые в моделях обнаружения, создаваемых Intelligent Insights, отслеживают:

- Query duration (Длительность запросов)
- Запросы, время ожидания которых истекло
- повышенное время ожидания;
- запросы, завершившиеся сбоем.

Метрики длительности запросов и времени ожидания запросов используются в качестве основных моделей для обнаружения проблем, связанных с производительностью рабочей нагрузки базы данных. Причина этого состоит в том, что они непосредственно измеряют рабочую нагрузку. Для обнаружения всех возможных вариантов снижения производительности рабочей нагрузки в качестве дополнительных моделей используются метрики повышенного времени ожидания и запросов, завершенных сбоем. Это позволяет выявлять проблемы, влияющие на производительность рабочей нагрузки.

Система автоматически учитывает изменения рабочей нагрузки и числа запросов к базе данных, чтобы динамически определять нормальные и ненормальные пороговые значения производительности базы данных.

Все метрики учитываются вместе в различных сочетаниях благодаря научной модели данных, позволяющей классифицировать каждую обнаруженную проблему с производительностью. Intelligent Insight предоставляет следующие сведения:

- сведения об обнаруженной проблеме с производительностью;
- анализ первопричин обнаруженных проблем;
- Рекомендации по повышению производительности отслеживаемой базы данных, где это возможно.

## <a name="query-duration"></a>Query duration (Длительность запросов)

Модель снижения производительности из-за повышения длительности запросов анализирует отдельные запросы и выявляет увеличение времени, необходимого для компиляции и выполнения запроса, по сравнению с базовыми показателями производительности.

Если встроенные аналитические средства обнаруживают значительное увеличение времени компиляции запроса или выполнения запроса, которое влияет на производительность рабочей нагрузки, эти запросы помечаются как проблемы снижения производительности при выполнении запросов.

Журнал диагностики Intelligent Insights содержит хэш запроса, снижающего производительность, который указывает, связано ли это снижение с увеличением времени компиляции или выполнения запроса. Он также содержит увеличенную длительность запроса.

## <a name="timeout-requests"></a>Запросы, время ожидания которых истекло

Модель снижения производительности из-за истечения времени ожидания запросов анализирует отдельные запросы и выявляет увеличение числа случаев истечения времени ожидания на уровне выполнения запроса, а также общее число случаев истечения времени ожидания запросов на уровне базы данных по сравнению с периодом базовых показателей производительности.

Некоторые из запросов могут истекать даже до того, как достигнут этапа исполнения. С помощью средств прерванных рабочих процессов и запросов, встроенные аналитические меры и анализируют все запросы, которые достигли базы данных, находятся ли они на этапе выполнения или нет.

Как только число выполненных запросов, время ожидания которых истекло, или число прерванных рабочих ролей запросов превысит системное пороговое значение, журнал диагностики заполнится ценной аналитикой.

Созданная аналитика содержит число запросов, время ожидания которых истекло. Снижение производительности связано с увеличением числа запросов, время ожидания которых истекло на этапе выполнения, или с увеличением числа запросов, время ожидания которых истекло на общем уровне базы данных. Если увеличение числа запросов, время ожидания которых истекло, является существенным для производительности базы данных, то эти запросы помечаются как снижающие производительность из-за истечения времени ожидания.

## <a name="excessive-wait-times"></a>Повышенное время ожидания

Модель повышенного времени ожидания отслеживает отдельные запросы к базе данных. Она выявляет необычно высокие значения статистики по времени ожидания запросов, превышающие абсолютные пороговые значения, управляемые системой. Следующий запрос с чрезмерными метриками времени ожидания наблюдается при использовании, [статистики ожидания хранилища запросов (sys. query_store_wait_stats)](/sql/relational-databases/system-catalog-views/sys-query-store-wait-stats-transact-sql):

- достижение лимитов ресурсов;
- достижение лимитов ресурсов эластичного пула;
- чрезмерное количество рабочих потоков или потоков сеансов;
- чрезмерная блокировка базы данных;
- нехватка памяти;
- прочая статистика времени ожидания.

Достижение лимитов ресурсов или лимитов ресурсов эластичных пулов означает, что потребление доступных ресурсов подписки или эластичного пула превысило абсолютный порог. Это является признаком снижения производительности рабочей нагрузки. Чрезмерное количество рабочих потоков или потоков сеансов указывает, что число инициализированных рабочих потоков или сеансов достигло абсолютного порога. Это является признаком снижения производительности рабочей нагрузки.

Чрезмерная блокировка базы данных указывает, что счетчик блокировок в базе данных достиг абсолютного порога. Эта статистика указывает на снижение производительности рабочей нагрузки. Нехватка памяти — это условие, при котором количество потоков, запрашивающих временно предоставляемый буфер памяти, достигло абсолютного порога. Эта статистика указывает на снижение производительности рабочей нагрузки.

Прочая статистика времени ожидания указывает, что различные метрики, измеряемые с помощью компонента Query Store Wait Stats, превысили абсолютное пороговое значение. Это является признаком снижения производительности рабочей нагрузки.

После обнаружения повышенного времени ожидания, в зависимости от доступных данных, в журнал диагностики Intelligent Insights записываются хэши запросов, снижающих производительность, и запросов, производительность которых понизилась. В него также добавляются сведения о метриках, выявивших запросы с повышенным временем ожидания выполнения и измеривших это время.

## <a name="errored-requests"></a>Запросы с ошибками

Модель снижения производительности из-за запросов с ошибками отслеживает отдельные запросы и выявляет увеличение количества запросов с ошибками по сравнению с периодом базовых показателей. Эта модель также отслеживает критические исключения, которые пересекает абсолютные пороговые значения, управляемые встроенными средствами анализа. Система автоматически учитывает количество запросов к базе данных и изменения рабочей нагрузки за отслеживаемый период.

Когда измеряемое увеличение запросов с ошибками относительно общего количества выполняемых запросов становится значительным и влияет на производительность рабочей нагрузки, затронутые запросы помечаются как снижающие производительность из-за запросов с ошибками.

Журнал Intelligent Insights выводит количество запросов с ошибками. Указывает, связано ли снижение производительности с увеличением запросов с ошибками или достижением порога отслеживаемого критического исключения. Он также содержит измеренное время снижения производительности.

Если какое-либо из отслеживаемых критических исключений превышает абсолютное пороговое значение, управляемое системой, создается ценная аналитика, содержащая сведения о критическом исключении.

## <a name="next-steps"></a>Дальнейшие шаги

- Узнайте, как [осуществлять мониторинг баз данных с помощью SQL Analytics](../../azure-monitor/insights/azure-sql.md).
- Узнайте, как [устранять проблемы с производительностью Intelligent Insights](intelligent-insights-troubleshoot-performance.md).
