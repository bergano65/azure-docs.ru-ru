---
title: Настройка подключения виртуальной машины Azure
titleSuffix: Azure SQL Managed Instance
description: Подключение к Управляемому экземпляру SQL Azure с виртуальной машины Azure с помощью SQL Server Management Studio.
services: sql-database
ms.service: sql-managed-instance
ms.subservice: operations
ms.custom: ''
ms.devlang: ''
ms.topic: quickstart
author: jovanpop-msft
ms.author: jovanpop
ms.reviewer: sstein, srbozovi, bonova
ms.date: 02/18/2019
ms.openlocfilehash: a1f496d59fa626dc8750493591128f7363afa40d
ms.sourcegitcommit: eb6bef1274b9e6390c7a77ff69bf6a3b94e827fc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/05/2020
ms.locfileid: "91620262"
---
# <a name="quickstart-configure-an-azure-vm-to-connect-to-azure-sql-managed-instance"></a>Краткое руководство. Настройка виртуальной машины Azure для подключения к Управляемому экземпляру SQL Azure
[!INCLUDE[appliesto-sqlmi](../includes/appliesto-sqlmi.md)]

В этом кратком руководстве показано, как настроить виртуальную машину Azure для подключения к Управляемому экземпляру SQL Azure с помощью SQL Server Management Studio (SSMS). 


Сведения об установке подключения "точка — сеть" с локального клиентского компьютера см. в кратком руководстве по [настройке подключения "точка — сеть"](point-to-site-p2s-configure.md).

## <a name="prerequisites"></a>Предварительные требования

Как отправная точка используются ресурсы, созданные при работе с кратким руководством [Создание управляемого экземпляра](instance-create-quickstart.md).

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com/).

## <a name="create-a-new-subnet-vnet"></a>Создание подсети в виртуальной сети

Здесь показано, как создать подсеть в виртуальной сети Управляемого экземпляра SQL, чтобы виртуальная машина Azure могла подключаться к управляемому экземпляру. Подсеть Управляемого экземпляра предназначена для управляемых экземпляров. Вы не сможете создать в ней какие-либо другие ресурсы, например виртуальные машины Azure.

1. Откройте группу ресурсов управляемого экземпляра, который вы создали при работе с кратким руководством [Создание управляемого экземпляра](instance-create-quickstart.md). Выберите виртуальную сеть для управляемого экземпляра.

   ![Ресурсы Управляемого экземпляра SQL](./media/connect-vm-instance-configure/resources.png)

2. Выберите **Подсети**, а затем щелкните **+ Подсеть**, чтобы создать новую подсеть.

   ![Подсети Управляемого экземпляра SQL](./media/connect-vm-instance-configure/subnets.png)

3. Заполните форму, используя сведения в этой таблице:

   | Параметр| Рекомендуемое значение | Описание |
   | ---------------- | ----------------- | ----------- |
   | **Имя** | Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](/azure/architecture/best-practices/resource-naming).|
   | **Диапазон адресов (блок CIDR)** | Допустимый диапазон значений | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
   | **Группа безопасности сети** | None | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
   | **Таблица маршрутов** | None | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
   | **Конечные точки службы** | Выбрано: 0 | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
   | **Делегирование подсети** | None | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|

   ![Создание подсети Управляемого экземпляра SQL для клиентской виртуальной машины](./media/connect-vm-instance-configure/new-subnet.png)

4. Нажмите кнопку **ОК**, чтобы создать дополнительную подсеть в виртуальной сети Управляемого экземпляра SQL.

## <a name="create-a-vm-in-the-new-subnet"></a>Создание виртуальной машины в новой подсети 

Ниже показано, как создать виртуальную машину в новой подсети для подключения к Управляемому экземпляру SQL.

## <a name="prepare-the-azure-virtual-machine"></a>Подготовка виртуальной машины Azure

Так как Управляемый экземпляр SQL размещается в частной виртуальной сети, необходимо создать виртуальную машину Azure с помощью какого-либо установленного клиентского инструмента SQL, например SQL Server Management Studio или Azure Data Studio. Этот инструмент позволяет подключаться к Управляемому экземпляру SQL и выполнять запросы. В этом кратком руководстве используется SQL Server Management Studio.

Самый простой способ создать виртуальную машину клиента со всеми необходимыми инструментами — использовать шаблоны Azure Resource Manager.

1. Убедитесь, что вы вошли на портал Azure в другой вкладке браузера. Затем нажмите следующую кнопку, чтобы создать клиентскую виртуальную машину и установить SQL Server Management Studio:

   [![Изображение с кнопкой "Развернуть в Azure".](https://azuredeploy.net/deploybutton.png)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fjovanpop-msft%2Fazure-quickstart-templates%2Fsql-win-vm-w-tools%2F201-vm-win-vnet-sql-tools%2Fazuredeploy.json)

2. Заполните форму, используя сведения из следующей таблицы:

   | Параметр| Рекомендуемое значение | Описание |
   | ---------------- | ----------------- | ----------- |
   | **Подписка** | Допустимая подписка | Необходимо использовать подписку, в которой есть разрешение на создание ресурсов. |
   | **Группа ресурсов** |Группа ресурсов, которую вы указали при работе с кратким руководством по [созданию Управляемого экземпляра SQL](instance-create-quickstart.md).|Необходимо использовать группу ресурсов, в которой находится виртуальная сеть.|
   | **Расположение** | Расположение группы ресурсов | Это значение заполняется на основе выбранной группы ресурсов. |
   | **Имя виртуальной машины**  | Любое допустимое имя | Сведения о допустимых именах см. в статье [Соглашения об именовании](/azure/architecture/best-practices/resource-naming).|
   |**Имя входа администратора**|Любое допустимое имя пользователя|Сведения о допустимых именах см. в статье [Соглашения об именовании](/azure/architecture/best-practices/resource-naming). Не используйте serveradmin. Это имя зарезервировано для роли уровня сервера.<br>Используйте это имя пользователя каждый раз при [подключении к виртуальной машине](#connect-to-the-virtual-machine).|
   |**Пароль**|Любой допустимый пароль|Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../../virtual-machines/windows/faq.md#what-are-the-password-requirements-when-creating-a-vm).<br>Используйте этот пароль каждый раз при [подключении к виртуальной машине](#connect-to-the-virtual-machine).|
   | **Размер виртуальной машины** | Любой допустимый размер | Размера по умолчанию в этом шаблоне **Standard_B2s** достаточно для работы с этим руководством. |
   | **Расположение**|[resourceGroup().location].| Не меняйте это значение. |
   | **имя виртуальной сети;**|Виртуальная сеть, в которой вы создали управляемый экземпляр.|
   | **Имя подсети**|Имя подсети, созданной при выполнении предыдущей процедуры| Не выбирайте подсеть, в которой создан управляемый экземпляр.|
   | **Расположение артефактов** | [deployment().properties.templateLink.uri] | Не меняйте это значение. |
   | **artifacts Location Sas token** (Маркер SAS расположения артефактов) | Не указывайте | Не меняйте это значение. |

   ![создание виртуальной машины клиента](./media/connect-vm-instance-configure/create-client-sql-vm.png)

   Если вы использовали предложенное имя виртуальной сети и подсеть по умолчанию из статьи [Создание Управляемого экземпляра SQL](instance-create-quickstart.md), не изменяйте последние два параметра. В противном случае следует заменить эти значения на те, которые вы ввели при настройке сетевой среды.

3. Установите флажок **Я принимаю указанные выше условия**.
4. Выберите **Приобрести**, чтобы развернуть виртуальную машину Azure в вашей сети.
5. Щелкните значок **Уведомления**, чтобы просмотреть состояние развертывания.

> [!IMPORTANT]
> После создания виртуальной машины подождите примерно 15 минут, прежде чем продолжить. Это время требуется, чтобы завершить установку SQL Server Management Studio с помощью скриптов, запускаемых после создания виртуальной машины.

## <a name="connect-to-the-virtual-machine"></a>Подключитесь к виртуальной машине

Ниже показано, как подключиться к только что созданной виртуальной машине по протоколу удаленного рабочего стола.

1. После завершения развертывания перейдите в ресурс виртуальной машины.

    ![Снимок экрана, на котором показан портал Azure со страницей обзора для выбранной виртуальной машины и выделена кнопка "Подключиться".](./media/connect-vm-instance-configure/vm.png)  

2. Выберите **Подключиться**.

   Для виртуальной машины отобразится форма файла протокола удаленного рабочего стола (RDP-файл), а также общедоступный IP-адрес и номер порта.

   ![Форма RDP](./media/connect-vm-instance-configure/rdp.png)  

3. Выберите **Скачать RDP-файл**.

   > [!NOTE]
   > Вы также можете подключаться к виртуальной машине по протоколу SSH.

4. Закройте форму **Connect to virtual machine** (Подключение к виртуальной машине).
5. Чтобы подключиться к виртуальной машине, откройте скачанный RDP-файл.
6. При появлении запроса выберите **Подключиться**. На компьютере Mac вам понадобится клиент RDP, например [Remote Desktop Client](https://apps.apple.com/app/microsoft-remote-desktop-10/id1295203466?mt=12) из Mac App Store.

7. Введите имя пользователя и пароль, указанные при создании виртуальной машины, и нажмите кнопку **ОК**.

8. При входе в систему может появиться предупреждение о сертификате. Чтобы продолжить процесс подключения, выберите **Да** или **Продолжить**.

Вы подключились к виртуальной машине на панели мониторинга диспетчера сервера.

## <a name="connect-to-sql-managed-instance"></a>Подключение к Управляемому экземпляру SQL 

1. На виртуальной машине откройте SQL Server Management Studio.

   Так как SSMS запускается впервые, открытие может занять несколько минут ввиду выполнения конфигурации.
2. В диалоговом окне **Подключение к серверу** в поле **Имя сервера** введите полное **имя узла** для управляемого экземпляра. Выберите **Проверка подлинности SQL Server**, укажите имя пользователя и пароль, а затем нажмите кнопку **Подключиться**.

    ![Подключение SSMS](./media/connect-vm-instance-configure/ssms-connect.png)  

После подключения можно просмотреть системные и пользовательские базы данных на узле "Базы данных" и различные объекты на узлах "Безопасность", "Объекты сервера", "Репликация", "Управление", "Агент SQL Server" и "Профилировщик XEvent".

## <a name="next-steps"></a>Дальнейшие действия

- Краткое руководство по подключению с локального клиентского компьютера с помощью подключения "точка — сеть" см. в [этой статье](point-to-site-p2s-configure.md).
- Обзор вариантов подключения для приложений см. в статье [Подключение приложений к Управляемому экземпляру SQL](connect-application-instance.md).
- Чтобы восстановить существующую базу данных SQL Server из локальной среды в управляемом экземпляре, можно использовать [Azure Database Migration Service для миграции](../../dms/tutorial-sql-server-to-managed-instance.md) или [команду T-SQL RESTORE](restore-sample-database-quickstart.md) для восстановления из файла резервной копии базы данных.
