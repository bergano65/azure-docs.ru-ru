---
title: Высокая доступность службы базы данных SQL Azure | Документация Майкрософт
description: Узнайте о возможностях и функциях высокой доступности службы базы данных SQL Azure
services: sql-database
ms.service: sql-database
ms.subservice: high-availability
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: jovanpop-msft
ms.author: sashan
ms.reviewer: carlrab, sashan
manager: craigg
ms.date: 04/17/2019
ms.openlocfilehash: ec9f5aa8163ea9bb838b1a95ab8ad49233a72643
ms.sourcegitcommit: c174d408a5522b58160e17a87d2b6ef4482a6694
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59698235"
---
# <a name="high-availability-and-azure-sql-database"></a>Высокая доступность и база данных SQL Azure

Цель архитектура высокого уровня доступности в базе данных SQL Azure — для гарантии того, что работает базы данных и выполнение 99,99% времени, не беспокоясь о последствиях операций обслуживания и простоев. Azure автоматически обрабатывает критические обслуживания задачи, такие как установка исправлений, резервное копирование, обновления Windows и SQL, а также незапланированных событий, такие как базового сбои оборудования, программного обеспечения или сети.  Когда нижележащего экземпляра SQL, которой установлено исправление или выполняет отработку отказа, время простоя несущественно Если вы [применять логику повторных попыток](sql-database-develop-overview.md#resiliency) в вашем приложении. Базу данных SQL Azure можно быстро восстановить даже в самых критических обстоятельствах, что гарантирует постоянную доступность ваших данных.

Решение высокого уровня доступности позволяет убедиться, что зафиксированные данные теряются из-за сбоев, что операции обслуживания не влияют на рабочей нагрузки и базы данных не будет единой точки отказа в архитектуру программного обеспечения. Периоды обслуживания и простой, из-за которых нужно остановить рабочую нагрузку во время обновления или обслуживания базы данных, отсутствуют. 

Существует две модели архитектуры высокого уровня доступности, которые используются в базе данных SQL Azure.

- Стандартный доступности модель, которая основана на разделение вычислительных мощностей и системы хранения.  Он полагается на высокую доступность и надежность на уровне хранилища. Эта архитектура предназначен для ориентированных на бюджет бизнес-приложений, может выдержать некоторым ухудшением производительности во время ее обслуживания.
- Модель доступности уровня "премиум", которая основана на кластере процессов ядра базы данных. Он используется тот факт, что всегда есть кворума узлов ядра базы данных. Эта архитектура предназначен для критически важных приложений с высокой производительности операций ввода-ВЫВОДА, высокая частота транзакций и гарантии минимальное влияние на производительность к рабочей нагрузке во время ее обслуживания.

База данных SQL Azure выполняется на последнюю стабильную версию ядра СУБД SQL Server и ОС Windows, и большинство пользователей не можно заметить, что обновления выполняются непрерывно.

## <a name="basic-standard-and-general-purpose-service-tier-availability"></a>Доступность уровня служб для ценовых категорий "Базовый", "Стандартный" и "Общего назначения"

Эти уровни обслуживания используют архитектура стандартный доступности. На следующем рисунке показана четыре разных узлах с помощью отдельных уровней вычислений и хранения.

![Разделение уровней вычисления и хранения](media/sql-database-high-availability/general-purpose-service-tier.png)

Модель стандартный доступности включает в себя два слоя:

- Слой вычислений без отслеживания состояния, который запускает `sqlserver.exe` обработки и содержит только временные и кэшированных данных на подключенный диск SSD, такие как базы данных TempDB, базы данных model, кэш планов, буферный пул и столбец пуле хранилищ. Этот узел без отслеживания состояния, обслуживается Azure Service Fabric, который инициализирует `sqlserver.exe`, управляет работоспособности узла и при необходимости выполняет отработку отказа на другой узел.
- Уровень данных с отслеживанием состояния с файлами базы данных (.mdf/.ldf), которые хранятся в хранилище BLOB-объектов Azure. Хранилище больших двоичных объектов имеет встроенные данных доступности и резервирования. Это гарантирует, что каждая запись в файл журнала или страницы в файле данных будет сохранен, даже если процесс SQL Server аварийно завершает работу.

Каждый раз, когда обновляется ядро базы данных или операционной системы или обнаружена ошибка, Azure Service Fabric переместит без отслеживания состояния процесса SQL Server на другой узел без отслеживания состояния вычислений с достаточным объемом свободного. Данные в хранилище BLOB-объектов Azure, не затронуто перемещением и вложенные файлы данных или журнала в только что инициализированный процесса SQL Server. Этот процесс гарантирует 99,99% доступность, но высокая рабочая нагрузка может снизиться производительность во время перехода с момента запуска нового экземпляра SQL Server с кэшем "холодных".

## <a name="premium-and-business-critical-service-tier-availability"></a>Доступность уровня служб ценовых категорий "Премиум" и "Критически важный для бизнеса"

"Премиум", а также использовать уровни критически важный для бизнеса службы модель доступности уровня "премиум", которая интегрируется вычислительные ресурсы (процесс SQL Server Database Engine) и хранилище (локально подключенный диск SSD) на одном узле. Высокий уровень доступности достигается путем репликации вычисления и хранилище для создания кластера из узлов трех до четырех - дополнительные узлы. 

![Кластер узлов ядра СУБД](media/sql-database-high-availability/business-critical-service-tier.png)

Базовые файлы базы данных (.mdf/.ldf) будут размещены на вложенные хранилища SSD для предоставления очень низкой задержкой операций ввода-ВЫВОДА для рабочей нагрузки. Высокий уровень доступности реализуется с помощью технологии похожа на SQL Server [группы доступности AlwaysOn](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server). Кластер включает в себя одной первичной репликой (процесс SQL Server), доступен для чтения и записи пользовательских рабочих нагрузок, но до трех вторичных реплик (вычисления и хранилище) содержащий копии данных. Основной узел постоянно передает дополнительные узлы в порядке изменения и гарантирует, что данные синхронизируются по крайней мере одна вторичная реплика перед фиксацией каждой транзакции. Этот процесс гарантирует, что в случае сбоя основного узла по любой причине всегда есть полностью синхронизированной узел выполнить отработку отказа. Azure Service Fabric инициирует отработку отказа. Когда вторичная реплика становится новым основным узлом, чтобы убедиться, что в кластере имеется достаточное количество узлов (набор кворума) создается другая вторичная реплика. После завершения отработки отказа соединения SQL автоматически направляются к новым основным узлом.

Как дополнительное преимущество модель доступности для уровня "премиум" включает в себя возможность перенаправления подключения SQL только для чтения к одной из вторичных реплик. Эта функция называется [масштабирование для чтения](sql-database-read-scale-out.md). Он содержит 100% дополнительной вычислительной мощности без дополнительной платы в режим аппаратного операций только для чтения, таких как аналитических рабочих нагрузок, от первичной реплики.

## <a name="zone-redundant-configuration"></a>Конфигурация с избыточностью в пределах зоны

По умолчанию кластера узлов для уровня "премиум" модель доступности создается в одном центре обработки данных. С появлением [зоны доступности Azure](../availability-zones/az-overview.md), база данных SQL можно разместить разные реплики в кластере в разных зонах доступности в одном регионе. Чтобы исключить единую точку сбоя, круг управления также дублируется в нескольких зонах в виде трех кругов шлюзов. Маршрутизацией для конкретного круга шлюза управляет [диспетчер трафика Azure](../traffic-manager/traffic-manager-overview.md) (ATM). Так как избыточное Конфигурация зоны на уровнях служб "премиум" или критически важный для бизнеса не обеспечивает дополнительную избыточность баз данных, вы можете включить ничего не предоставляются бесплатно. Если выбрать конфигурацию с избыточностью зоны, можно сделать устойчивыми баз данных уровня "премиум" или критически важный для бизнеса к гораздо большим количеством сбоев, включая катастрофический центра обработки данных, без изменения логики приложения. Можно также преобразовать любые существующие базы данных или пулы уровня "Премиум" или "Критически важный для бизнеса" в конфигурацию с избыточностью в пределах зоны.

Так как базы данных с избыточностью зоны имеют реплик в разных центрах обработки данных на некоторое расстояние друг между ними, задержка сети может увеличить время фиксации и тем самым повлиять на производительность некоторых рабочих нагрузок OLTP. Вы всегда можете вернуться к конфигурации с одной зоной, отключив параметр избыточности в пределах зоны. Этот процесс выполняется в оперативном режиме, аналогичную регулярного обновления уровня. В конце этого процесса база данных или пул переносится из круга с избыточностью в пределах зоны в круг с одной зоной, или наоборот.

> [!IMPORTANT]
> Базы данных с избыточностью зоны и эластичные пулы в настоящий момент поддерживается только на уровнях служб "премиум" и критически важный для бизнеса. По умолчанию резервные копии и записи аудита хранятся в хранилище RA-GRS, поэтому они могут не оказаться автоматически доступны в случае сбоя всей зоны. 

На следующей схеме показана версия архитектуры с высоким уровнем доступности и избыточностью в пределах зоны.

![Архитектура с высоким уровнем доступности и избыточностью в пределах зоны](./media/sql-database-high-availability/zone-redundant-business-critical-service-tier.png)

## <a name="accelerated-database-recovery-adr"></a>Ускоренное восстановление базы данных (ADR)

[Ускорение восстановления базы данных (ADR)](sql-database-accelerated-database-recovery.md) новый компонент ядра базы данных SQL, который значительно повышает доступность базы данных, особенно при наличии долго выполняет транзакции. В настоящее время функция ADR доступна для отдельных баз данных, эластичных пулов и Хранилища данных SQL Azure.

## <a name="conclusion"></a>Заключение

База данных SQL Azure включает встроенные функции высокой доступности решения, которое тесно интегрирована с платформой Azure. Он зависит, Service Fabric для обнаружения сбоев и восстановления, хранилище BLOB-объектов Azure для защиты данных и зоны доступности для повышения отказоустойчивости. Кроме того базы данных Azure SQL использует технологию группы доступности AlwaysOn из SQL Server для репликации и отработки отказа. Сочетание этих технологий позволяет приложениям полностью реализовать преимущества смешанной хранения модели и поддерживает самые требовательные соглашения об уровне обслуживания.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте больше о [зонах доступности Azure](../availability-zones/az-overview.md).
- Дополнительные сведения о [Service Fabric](../service-fabric/service-fabric-overview.md).
- Дополнительные сведения о [диспетчере трафика Azure](../traffic-manager/traffic-manager-overview.md).
- Чтобы изучить дополнительные возможности обеспечения высокой доступности и аварийного восстановления, ознакомьтесь с [непрерывностью бизнес-процессов](sql-database-business-continuity.md).
