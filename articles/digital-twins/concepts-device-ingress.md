---
title: Возможность подключения устройств с помощью Azure Digital Twins и входящие данные телеметрии | Документация Майкрософт
description: Общие сведения о подключении устройства с помощью Azure Digital Twins
author: alinamstanciu
manager: bertvanhoof
ms.service: digital-twins
services: digital-twins
ms.topic: conceptual
ms.date: 12/14/2018
ms.author: alinast
ms.openlocfilehash: 374a27b10b3928838b10e4fba24e1f36721c162a
ms.sourcegitcommit: c2e61b62f218830dd9076d9abc1bbcb42180b3a8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/15/2018
ms.locfileid: "53433685"
---
# <a name="device-connectivity-and-telemetry-ingress"></a>Возможность подключения устройств и входящие данные телеметрии

Данные телеметрии, отправленные устройствами и датчиками, составляют основу любого решения Интернета вещей. Таким образом, представление этих разрозненных ресурсов и управление ими в контексте расположения является главной проблемой в разработке приложений Интернета вещей. Azure Digital Twins упрощает процесс разработки решений Интернета вещей, объединяя устройства и датчики с пространственным интеллектуальным графом.

Чтобы начать работу, создайте ресурс Центра Интернета вещей Azure в корне пространственного графа. Ресурсы Центра Интернета вещей позволяют всем устройствам в корневом пространстве отправлять сообщения. Создав Центр Интернета вещей, зарегистрируйте устройства с помощью датчиков в пределах экземпляра Digital Twins. Устройства могут отправлять данные в службу Digital Twins через [пакет SDK для устройств Azure IoT](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-sdks#azure-iot-device-sdks).

Пошаговые инструкции по подключению устройств см. в статье [Руководство по развертыванию Azure Digital Twins и настройке пространственного графа](tutorial-facilities-setup.md). Вкратце можно выделить следующие шаги:

- Развертывание экземпляра Digital Twins с [портала Azure](https://portal.azure.com).
- Создание пространств в графе.
- Создание ресурса Центра Интернета вещей и назначение его пространству в графе.
- Создание устройств и датчиков в графе и назначение их пространствам, созданным ранее.
- Создание сопоставителя для фильтрации сообщений телеметрии на основе условий.
- Создание [определяемой пользователем функции](concepts-user-defined-functions.md) и назначение ее пространству в графе для пользовательской обработки сообщений телеметрии.
- Назначение роли, позволяющей определяемой пользователем функции получить доступ к данным графа.
- Получение строки подключения устройства Центра Интернета вещей из API управления Digital Twins.
- Настройка строки подключения на устройстве с помощью пакета SDK для устройств Azure IoT.

В следующих разделах вы узнаете, как получить строку подключения устройства Центра Интернета вещей из API управления Digital Twins. Вы также узнаете, как использовать формат сообщений телеметрии Центра Интернета вещей для отправки данных телеметрии, основанных на датчиках. Digital Twins требует, чтобы каждая часть получаемых данных телеметрии была связана с датчиком в пространственном графе. Это требование гарантирует обработку и маршрутизацию данных в соответствующем пространственном контексте.

## <a name="get-the-iot-hub-device-connection-string-from-the-management-api"></a>Получение строки подключения устройства Центра Интернета вещей из API управления

[!INCLUDE [Digital Twins Management API](../../includes/digital-twins-management-api.md)]

Выполните вызов GET в API устройства с использованием параметра `includes=ConnectionString`, чтобы получить строку подключения устройства Центра Интернета вещей. Отфильтруйте строку по GUID или идентификатору оборудования, чтобы найти необходимое устройство.

```plaintext
YOUR_MANAGEMENT_API_URL/devices/YOUR_DEVICE_GUID?includes=ConnectionString
```

| Параметр | Заменить на |
| --- | --- |
| *YOUR_DEVICE_GUID* | идентификатор устройства; |

```plaintext
YOUR_MANAGEMENT_API_URL/devices?hardwareIds=YOUR_DEVICE_HARDWARE_ID&includes=ConnectionString
```

| Значение параметра | Заменить на |
| --- | --- |
| *YOUR_DEVICE_HARDWARE_ID* | Идентификатор оборудования устройства |

В полезных данных ответа скопируйте свойство устройства **connectionString**. Вы используете его, когда вызовете пакет SDK для устройств Azure IoT для отправки данных в Digital Twins.

## <a name="device-to-cloud-message"></a>Сообщение с устройства в облако

Вы можете настроить формат сообщений и полезные данные устройства в соответствии с потребностями вашего решения. Используйте любой контракт данных, который можно сериализовать в массив или поток байтов, который поддерживается [классом сообщений клиента устройств Azure IoT, Message(byte[] byteArray)](https://docs.microsoft.com/dotnet/api/microsoft.azure.devices.client.message.-ctor?view=azure-dotnet#Microsoft_Azure_Devices_Client_Message__ctor_System_Byte___). Сообщение может содержать пользовательский двоичный формат по вашему выбору, пока вы декодируете контракт данных в соответствующей определяемой пользователем функции. К сообщениям, отправляемым с устройства в облако, применяется только одно требование. Необходимо поддерживать набор свойств, чтобы убедиться в том, что ваше сообщение будет соответствующим образом направлено механизму обработки.

### <a name="telemetry-properties"></a>Свойства телеметрии

 Содержимое полезных данных **сообщения** может быть произвольными данными размером до 256 КБ. Существует ряд требований, ожидаемый для свойств типа [`Message.Properties`](https://docs.microsoft.com/dotnet/api/microsoft.azure.devices.client.message.properties?view=azure-dotnet). В таблице показаны обязательные и необязательные свойства, поддерживаемые системой.

| Имя свойства | Значение | Обязательно | ОПИСАНИЕ |
|---|---|---|---|
| **DigitalTwins-Telemetry** | 1.0 | Yes | Постоянное значение, которое идентифицирует сообщение в системе. |
| **DigitalTwins-SensorHardwareId** | `string(72)` | Yes | Уникальный идентификатор датчика, отправляющего **сообщение**. Это значение должно соответствовать свойству **HardwareId** объекта, чтобы система могла его обработать. Например, `00FF0643BE88-CO2`. |
| **CreationTimeUtc** | `string` | Нет  | Строка даты в формате [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601), идентифицирующая время выборки полезных данных. Например, `2018-09-20T07:35:00.8587882-07:00`. |
| **CorrelationId** | `string` | Нет  | UUID, который может использоваться для трассировки событий в системе. Например, `cec16751-ab27-405d-8fe6-c68e1412ce1f`.

### <a name="send-your-message-to-digital-twins"></a>Отправка сообщения в Digital Twins

Используйте вызов [SendEventAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.devices.client.deviceclient.sendeventasync?view=azure-dotnet) или [SendEventBatchAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.devices.client.deviceclient.sendeventbatchasync?view=azure-dotnet) свойства DeviceClient для отправки сообщения в Digital Twins.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о возможностях обработки данных Azure Digital Twins и определяемых пользователем функциях см. в статье [Обработка данных и определяемые пользователем функции](concepts-user-defined-functions.md).
