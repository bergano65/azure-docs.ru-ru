---
title: Переместить экземпляр в другой регион Azure
titleSuffix: Azure Digital Twins
description: См. статью как переместить экземпляр Digital двойников для Azure из одного региона Azure в другой.
author: baanders
ms.author: baanders
ms.date: 08/26/2020
ms.topic: how-to
ms.custom: subject-moving-resources
ms.service: digital-twins
ms.openlocfilehash: cb532098cda290654d6bdebe9cec2edab8ccbf99
ms.sourcegitcommit: 0b9fe9e23dfebf60faa9b451498951b970758103
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/07/2020
ms.locfileid: "94355793"
---
# <a name="move-an-azure-digital-twins-instance-to-a-different-azure-region"></a>Перемещение экземпляра Azure Digital двойников в другой регион Azure

Если необходимо переместить экземпляр Digital двойников из одного региона в другой, текущий процесс — повторно создать ресурсы в новом регионе, а затем удалить исходные ресурсы. В конце этого процесса вы будете работать с новым экземпляром Azure Digital двойников, который идентичен первому, за исключением обновленного расположения.

В этой статье содержатся инструкции по выполнению полного перемещения и копированию всех элементов, необходимых для того, чтобы новый экземпляр совпадал с исходным.

Этот процесс состоит из следующих шагов.

1. Подготовка: Скачайте исходные модели, двойников и Graph.
1. Перемещение. Создайте новый экземпляр Azure Digital двойников в новом регионе.
1. Переместить: повторно заполнить новый экземпляр Azure Digital двойников.
    - Загрузите исходные модели, двойников и Graph.
    - Повторное создание конечных точек и маршрутов.
    - Повторно свяжите подключенные ресурсы.
1. Очистка исходных ресурсов: удаление исходного экземпляра.

## <a name="prerequisites"></a>Предварительные требования

Прежде чем пытаться повторно создать экземпляр Digital двойников для Azure, перейдем к компонентам исходного экземпляра, чтобы получить четкое представление о всех частях, которые необходимо создать заново.

Вот несколько вопросов, которые стоит учесть:

* Какие *модели* передаются в мой экземпляр? Сколько?
* Что такое *двойников* в моем экземпляре? Сколько?
* Какова общая форма *графа* в своем экземпляре? Сколько связей?
* Какие *конечные точки* имеются в моем экземпляре?
* Какие *маршруты* имеются в моем экземпляре? У них есть фильтры?
* Где мой экземпляр *подключается к другим службам Azure* ? Ниже перечислены некоторые распространенные точки интеграции.

    - Служба "Сетка событий Azure", концентраторы событий Azure или служебная шина Azure
    - Функции Azure
    - Azure Logic Apps
    - Azure Time Series Insights
    - Azure Maps
    - Служба подготовки устройств к добавлению в Центр Интернета вещей Azure
* Какие другие *персональные или корпоративные приложения* имеют подключение к моему экземпляру?

Эти сведения можно получить с помощью [портал Azure](https://portal.azure.com), [интерфейсов API и пакетов SDK](how-to-use-apis-sdks.md)для Azure Digital двойников, [команд интерфейса командной строки Azure Digital двойников](how-to-use-cli.md)или образца [обозревателя Digital двойников (ADT)](/samples/azure-samples/digital-twins-explorer/digital-twins-explorer/) .

## <a name="prepare"></a>Подготовка.

В этом разделе Вы подготовитесь к повторному созданию экземпляра путем загрузки исходных моделей, двойников и Graph из исходного экземпляра. В этой статье для этой задачи используется пример [обозревателя ADT](/samples/azure-samples/digital-twins-explorer/digital-twins-explorer/) .

>[!NOTE]
>Возможно, у вас уже есть файлы, содержащие модели или диаграмму в вашем экземпляре. Если это так, вам не нужно загружать все повторно — только отсутствующие элементы или элементы, которые могли быть изменены с момента первоначальной отправки этих файлов. Например, у вас могут быть двойников, которые были обновлены новыми данными.

### <a name="limitations-of-adt-explorer"></a>Ограничения обозревателя ADT

[Пример ADT Explorer](/samples/azure-samples/digital-twins-explorer/digital-twins-explorer/) — это пример клиентского приложения, который поддерживает визуальное представление графа и обеспечивает визуальное взаимодействие с вашим экземпляром. В этой статье показано, как использовать ее для загрузки и последующей перезагрузки, моделей, двойников и графов.

Этот пример не является полным средством. Она не была протестирована и не была построена для работы с графами большого размера. Поэтому следует иметь в виду следующие готовые примеры ограничений:

* В настоящее время пример был протестирован только на диаграммах размером до 1 000 узлов и 2 000 связей.
* Пример не поддерживает повторную попытку в случае периодического сбоя.
* Пример не обязательно уведомляет пользователя о том, что отправленные данные неполны.
* Образец не обрабатывает ошибки, возникающие из очень больших графов, которые превышают доступные ресурсы, такие как память.

Если образец не способен справиться с размером графа, можно экспортировать и импортировать граф с помощью других средств разработчика Digital двойников для Azure:

* [Команды интерфейса командной строки Azure Digital двойников](how-to-use-cli.md)
* [Интерфейсы API и пакеты SDK для цифровых двойников Azure](how-to-use-apis-sdks.md)

### <a name="set-up-the-adt-explorer-application"></a>Настройка приложения обозревателя ADT

Чтобы продолжить работу с обозревателем ADT, сначала Скачайте пример кода приложения и настройте его для запуска на вашем компьютере.

Чтобы получить пример, см. [ADT Explorer](/samples/azure-samples/digital-twins-explorer/digital-twins-explorer/). Нажмите кнопку **скачать ZIP** -файл, чтобы скачать этот пример кода на компьютер в качестве **Azure_Digital_Twins__ADT__explorer.zip**. Распакуйте файл.

Затем установите и настройте разрешения для обозревателя ADT. Следуйте инструкциям в разделе [Настройка Azure Digital двойников и ADT Explorer](quickstart-adt-explorer.md#set-up-azure-digital-twins-and-adt-explorer) в кратком руководстве по цифровому двойников в Azure. В этом разделе рассматриваются следующие шаги:

1. Настройка экземпляра Digital двойников для Azure. Эту часть можно пропустить, так как у вас уже есть экземпляр.
1. Настройте локальные учетные данные Azure, чтобы предоставить доступ к вашему экземпляру.
1. Запустите обозреватель ADT и настройте его для подключения к экземпляру. Вы будете использовать *имя узла* исходного экземпляра Azure Digital двойников, который вы перемещаете.

Теперь вы должны запустить пример приложения ADT Explorer в браузере на своем компьютере. Пример должен быть подключен к исходному экземпляру Azure Digital двойников.

:::image type="content" source="media/how-to-move-regions/explorer-blank.png" alt-text="Окно браузера, в котором отображается приложение, выполняемое на localhost: 3000. Приложение называется ADT Explorer и содержит поля для обозревателя запросов, представления модели, представления графа и обозревателя свойств. Данные на экране пока отсутствуют." lightbox="media/how-to-move-regions/explorer-blank.png":::

Чтобы проверить подключение, нажмите кнопку **выполнить запрос** , чтобы запустить запрос по умолчанию, отображающий все двойников и связи в графе в поле **Обозреватель графов** .

:::image type="content" source="media/how-to-move-regions/run-query.png" alt-text="В правом верхнем углу окна будет выделено окно Запуск запроса." lightbox="media/how-to-move-regions/run-query.png":::

Вы можете выйти из обозревателя ADT, так как вы снова будете использовать его в этой статье для повторной отправки этих элементов в новый экземпляр в целевом регионе.

### <a name="download-models-twins-and-graph"></a>Загрузка моделей, двойников и Graph

Затем скачайте модели, двойников и Graph в свое решение на компьютер.

Чтобы загрузить все эти элементы одновременно, сначала убедитесь, что в поле **представление графа** отображается полный граф. Если полный график еще не появился, перезапустите запрос по умолчанию `SELECT * FROM digitaltwins` в окне **Обозреватель запросов** .
 
Затем выберите значок " **Экспорт графа** " в поле **представления графа** .

:::image type="content" source="media/how-to-move-regions/export-graph.png" alt-text="В поле представление графа выделяется значок. Отображается стрелка, указывающая за пределы облака." lightbox="media/how-to-move-regions/export-graph.png":::

Это действие активирует ссылку для **скачивания** в **представлении графа** . Выберите его, чтобы скачать представление результатов запроса на основе JSON, которое включает в себя модели, двойников и связи. Это действие должно загрузить JSON-файл на компьютер.

>[!NOTE]
>Если скачанный файл имеет другое расширение, попробуйте изменить расширение напрямую и измените его на JSON.

## <a name="move"></a>Переместить

Далее предстоит выполнить "перемещение" экземпляра, создав новый экземпляр в целевом регионе. Затем вы заполните его данными и компонентами из исходного экземпляра.

### <a name="create-a-new-instance"></a>Создание нового экземпляра

Сначала создайте новый экземпляр Azure Digital двойников в целевом регионе. Выполните действия, описанные в разделе [Настройка экземпляра и проверки подлинности](how-to-set-up-instance-portal.md). Помните следующие указатели:

* Вы можете иметь одно и то же имя для нового экземпляра, *Если* оно находится в другой группе ресурсов. Если необходимо использовать ту же группу ресурсов, которая содержит исходный экземпляр, то новому экземпляру потребуется собственное уникальное имя.
* Введите новый целевой регион при появлении запроса на расположение.

После завершения этого шага вам потребуется имя узла нового экземпляра, чтобы продолжить настройку данных. Если вы не записали имя узла во время установки, выполните следующие [инструкции](how-to-set-up-instance-portal.md#verify-success-and-collect-important-values) , чтобы получить его из портал Azure.

### <a name="repopulate-the-old-instance"></a>Повторно заполнить старый экземпляр

Далее вы настроите новый экземпляр, чтобы он был копией исходного.

#### <a name="upload-the-original-models-twins-and-graph-by-using-adt-explorer"></a>Отправка исходных моделей, двойников и Graph с помощью обозревателя ADT

В этом разделе вы можете передать модели, двойников и Graph в новый экземпляр. Если в исходном экземпляре отсутствуют модели, двойников или Graph, или вы не хотите перемещать их в новый экземпляр, можно перейти к [следующему разделу](#re-create-endpoints-and-routes).

В противном случае вернитесь в окно браузера, в котором работает обозреватель ADT, и выполните следующие действия.

##### <a name="connect-to-the-new-instance"></a>Подключиться к новому экземпляру

В настоящее время ADT Explorer подключен к исходному экземпляру Azure Digital двойников. Переключите соединение, чтобы оно указывало на новый экземпляр, нажав кнопку **Вход** в правом верхнем углу окна.

:::image type="content" source="media/how-to-move-regions/sign-in.png" alt-text="Обозреватель ADT выделяет значок входа в правом верхнем углу окна. Значок показывает простой силуэт человека, который был занят силуэт ключа." lightbox="media/how-to-move-regions/sign-in.png":::

Замените **URL-адрес ADT** в соответствии с новым экземпляром. Измените это значение, чтобы оно считывает *https://{имя узла нового экземпляра}*.

Выберите **Подключиться**. Возможно, вам будет предложено войти еще раз с учетными данными Azure или предоставить согласие этого приложения для вашего экземпляра.

##### <a name="upload-models-twins-and-graph"></a>Передача моделей, двойников и Graph

Затем передайте компоненты решения, скачанные ранее, в новый экземпляр.

Чтобы передать модели, двойников и Graph, щелкните значок **Импорт графа** в поле **представление графа** . Этот параметр отправляет все три из этих компонентов одновременно. Он даже передает модели, которые в настоящее время не используются в графе.

:::image type="content" source="media/how-to-move-regions/import-graph.png" alt-text="В окне &quot;Представление графа&quot; выделен значок. В нем отображается стрелка, указывающая на облако." lightbox="media/how-to-move-regions/import-graph.png":::

В поле выбора файла перейдите к загруженному графу. Выберите файл Graph **. JSON** и нажмите кнопку **Открыть**.

Через несколько секунд обозреватель ADT открывает представление **импорта** , которое показывает предварительную версию диаграммы для загрузки.

Чтобы подтвердить отправку графа, щелкните значок **сохранить** в правом верхнем углу окна **представления графа** .

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-move-regions/graph-preview-save.png" alt-text="Выделите значок сохранить на панели просмотра диаграммы." lightbox="media/how-to-move-regions/graph-preview-save.png":::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

ADT Explorer теперь передает модели и граф (включая двойников и связи) в новый экземпляр Azure Digital двойников. Вы должны увидеть сообщение об успешном выполнении, указывающее, сколько моделей, двойников и связей было отправлено.

:::row:::
    :::column:::
        :::image type="content" source="media/how-to-move-regions/import-success.png" alt-text="Диалоговое окно, указывающее на успешность импорта графа. Он считывает &quot;Импорт выполнен успешно. 2 импортированные модели. 4 двойников импортированы. два импортированных отношения. &quot;" lightbox="media/how-to-move-regions/import-success.png":::
    :::column-end:::
    :::column:::
    :::column-end:::
    :::column:::
    :::column-end:::
:::row-end:::

Чтобы убедиться, что все отправлено успешно, нажмите кнопку **выполнить запрос** в окне **Обозреватель графов** , чтобы запустить запрос по умолчанию, отображающий все двойников и связи в графе. Это действие также обновляет список моделей в поле **представление модели** .

:::image type="content" source="media/how-to-move-regions/run-query.png" alt-text="Наведите внимание на кнопку выполнить запрос в правом верхнем углу окна." lightbox="media/how-to-move-regions/run-query.png":::

Вы должны увидеть граф со всеми ее двойниковми и связями, отображаемыми в окне **Обозреватель графов** . Вы также должны увидеть модели, перечисленные в поле **представление модели** .

:::image type="content" source="media/how-to-move-regions/post-upload.png" alt-text="Представление обозревателя ADT, в котором показаны две модели, выделенные в поле представление модели, и диаграмма, выделенная в окне Обозреватель графов." lightbox="media/how-to-move-regions/post-upload.png":::

Эти представления подтверждают, что модели, двойников и Graph были повторно переданы в новый экземпляр в целевом регионе.

#### <a name="re-create-endpoints-and-routes"></a>Повторное создание конечных точек и маршрутов

Если в исходном экземпляре имеются конечные точки или маршруты, их потребуется создать повторно в новом экземпляре. Если в исходном экземпляре нет конечных точек или маршрутов или вы не хотите перемещать их в новый экземпляр, можно перейти к [следующему разделу](#relink-connected-resources).

В противном случае выполните действия, описанные в разделе [инструкции. Управление конечными точками и маршрутами](how-to-manage-routes-portal.md) с помощью нового экземпляра. Помните следующие указатели:

* Вам *не* нужно повторно создавать сетку событий, концентраторы событий или ресурс служебной шины, которые вы используете для конечной точки. Дополнительные сведения см. в разделе "необходимые условия" в инструкциях конечной точки. Необходимо только повторно создать конечную точку в экземпляре Digital двойников для Azure.
* Можно повторно использовать конечные точки и имена маршрутов, так как они относятся к разным экземплярам.
* Не забудьте добавить необходимые фильтры к создаваемым маршрутам.

#### <a name="relink-connected-resources"></a>Повторно связать подключенные ресурсы

Если у вас есть другие приложения или ресурсы Azure, подключенные к исходному экземпляру Azure Digital двойников, необходимо изменить подключение, чтобы они достигли нового экземпляра. Эти ресурсы могут включать другие службы Azure, персональные или корпоративные приложения, настроенные для работы с Azure Digital двойников.

Если у вас нет других ресурсов, подключенных к исходному экземпляру, или вы не хотите перемещать их на новый экземпляр, можно перейти к [следующему разделу](#verify).

В противном случае примите во внимание подключенные ресурсы в вашем сценарии. Вам не нужно удалять и повторно создавать подключенные ресурсы. Вместо этого нужно просто изменить точки, в которых они подключаются к экземпляру Azure Digital двойников через имя узла. Затем вы обновляете эти точки, чтобы использовать имя узла нового экземпляра вместо исходного.

Конкретные ресурсы, которые необходимо изменить, зависят от вашего сценария, но вот некоторые распространенные точки интеграции:

* Функции Azure. Если у вас есть функция Azure, код которой содержит имя узла исходного экземпляра, следует изменить это значение на имя узла нового экземпляра и повторно опубликовать функцию.
* Служба "Сетка событий", "концентраторы событий" или "служебная шина".
* Azure Logic Apps.
* Аналитика временных рядов.
* Azure Maps.
* Служба подготовки устройств для центра Интернета вещей.
* Личные или корпоративные приложения за пределами Azure, такие как клиентское приложение, созданное в [руководстве: создание кода для клиентского приложения](tutorial-code.md), которое подключается к экземпляру и вызывает интерфейсы API цифровых двойников Azure.
* Регистрация приложений Azure AD *не* требует повторного создания. Если вы используете [регистрацию приложения](how-to-create-app-registration.md) для подключения к API-интерфейсам цифровых двойников Azure, вы можете повторно использовать ту же регистрацию приложения в новом экземпляре.

После завершения этого шага новый экземпляр в целевом регионе должен быть копией исходного экземпляра.

## <a name="verify"></a>Проверка

Чтобы убедиться, что новый экземпляр настроен правильно, используйте следующие средства:

* [Портал Azure](https://portal.azure.com). Портал хорошо подходит для проверки существования нового экземпляра и находится в правильном целевом регионе. Кроме того, он хорошо подходит для проверки конечных точек и маршрутов и подключений к другим службам Azure.
* [Команды интерфейса командной строки Azure Digital двойников](how-to-use-cli.md). Эти команды хорошо подходят для проверки существования нового экземпляра и его расположения в правильном целевом регионе. Они также могут использоваться для проверки данных экземпляра.
* [Обозреватель ADT](/samples/azure-samples/digital-twins-explorer/digital-twins-explorer/). ADT Explorer хорошо подходит для проверки данных экземпляра, таких как модели, двойников и графики.
* [Интерфейсы API и пакеты SDK для цифровых двойников Azure](how-to-use-apis-sdks.md). Эти ресурсы хорошо подходят для проверки данных экземпляра, таких как модели, двойников и графики. Они также хорошо подходят для проверки конечных точек и маршрутов.

Вы также можете попробовать запустить любые пользовательские приложения или сквозные потоки, работающие с исходным экземпляром, чтобы убедиться, что они правильно работают с новым экземпляром.

## <a name="clean-up-source-resources"></a>Очистка исходных ресурсов

Теперь, когда новый экземпляр настроен в целевом регионе с копией данных и подключений исходного экземпляра, можно удалить исходный экземпляр.

Вы можете использовать [портал Azure](https://portal.azure.com), [Azure CLI](how-to-use-cli.md)или [API-интерфейсы плоскости управления](how-to-use-apis-sdks.md#overview-control-plane-apis).

Чтобы удалить экземпляр с помощью портал Azure, [откройте портал](https://portal.azure.com) в окне браузера и перейдите к исходному экземпляру Azure Digital двойников, выполнив поиск по имени на панели поиска портала.

Нажмите кнопку **Удалить** и следуйте инструкциям на экране, чтобы завершить удаление.

:::image type="content" source="media/how-to-move-regions/delete-instance.png" alt-text="Просмотрите сведения об экземпляре Digital двойников для Azure в портал Azure на вкладке Обзор. Кнопка Удалить выделена.":::