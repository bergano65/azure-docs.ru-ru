---
title: Списки исключений брандмауэра веб-приложения в передней дверце Azure — портал Azure
description: В этой статье содержатся сведения о конфигурации списков исключений в Azure спереди с портал Azure.
services: web-application-firewall
author: vhorne
ms.service: web-application-firewall
ms.date: 11/10/2020
ms.author: victorh
ms.topic: conceptual
ms.openlocfilehash: 943124982fe1f2ccf142bb9161ec8ada07e63df5
ms.sourcegitcommit: 6109f1d9f0acd8e5d1c1775bc9aa7c61ca076c45
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2020
ms.locfileid: "94444985"
---
# <a name="web-application-firewall-waf-with-front-door-service-exclusion-lists"></a>Брандмауэр веб-приложения (WAF) с списками исключений службы Front дверь 

Иногда брандмауэр веб-приложения (WAF) может блокировать запрос, который требуется разрешить приложению. Например, Active Directory вставляет маркеры, используемые для проверки подлинности. Эти токены могут содержать специальные символы, которые могут вызывать ложное срабатывание из правил WAF. Списки исключений WAF позволяют пропустить некоторые атрибуты запроса при проверке WAF.  Список исключений можно настроить с помощью  [PowerShell](https://docs.microsoft.com/powershell/module/az.frontdoor/New-AzFrontDoorWafManagedRuleExclusionObject?view=azps-3.5.0), [Azure CLI](https://docs.microsoft.com/cli/azure/ext/front-door/network/front-door/waf-policy/managed-rules/exclusion?view=azure-cli-latest#ext-front-door-az-network-front-door-waf-policy-managed-rules-exclusion-add), [API-интерфейса RESTful](https://docs.microsoft.com/rest/api/frontdoorservice/webapplicationfirewall/policies/createorupdate)или портал Azure. В следующем примере показана конфигурация портал Azure. 
## <a name="configure-exclusion-lists-using-the-azure-portal"></a>Настройка списков исключений с помощью портал Azure
**Управление исключениями** доступно на портале WAF в разделе **управляемые правила** .

![Управление исключениями ](../media/waf-front-door-exclusion/exclusion1.png)
 ![ Управление exclusion_add](../media/waf-front-door-exclusion/exclusion2.png)

 Пример списка исключений: ![ управление exclusion_define](../media/waf-front-door-exclusion/exclusion3.png)

Этот пример исключает значение в поле заголовка *пользователя* . Допустимый запрос может включать в себя поле *пользователя* , содержащее строку, которая активирует правило внедрения кода SQL. Вы можете исключить параметр *пользователя* в этом случае, чтобы правило WAF не вычислит что-либо в поле.

Следующие атрибуты могут быть добавлены к спискам исключений по имени. Значения используемых полей не оцениваются по правилам WAF, но их имена оцениваются. Список исключений удаляет проверку значения поля.

* Имя заголовка запроса
* Имя файла Cookie запроса
* Имя аргументов строки запроса
* Имя запроса текст записи аргументов

Вы можете указать точное соответствие заголовка запроса, текста, файла cookie или атрибута строки запроса.  Либо при необходимости вы можете задать частичное соответствие. Поддерживаются следующие операторы соответствия:

- **Equals** : этот оператор используется для точного совпадения. Например, чтобы выбрать заголовок с именем **беарертокен** , используйте оператор Equals с селектором, установленным как **беарертокен**.
- **Starts with** : этот оператор находит все поля, которые начинаются с указанного значения селектора.
- **Ends with** : этот оператор находит все поля запроса, заканчивающиеся на указанное значение селектора.
- **Contains** : этот оператор находит все поля запроса, которые содержат указанное значение селектора.
- **Равно Any** : Этот оператор соответствует всем полям запроса. * — значение селектора.

Имена заголовков и файлов cookie не чувствительны к регистру.

Если значение заголовка, значение cookie, значение аргумента POST или значение аргумента запроса выдает ложные срабатывания для некоторых правил, можно исключить эту часть запроса из рассмотрения правилом:


|Матчвариабленаме из журналов WAF  |Исключение правила на портале  |
|---------|---------|
|Кукиевалуе: SOME_NAME        |Имя файла Cookie запроса равно SOME_NAME|
|HeaderValue: SOME_NAME        |Имя заголовка запроса равно SOME_NAME|
|Постпарамвалуе: SOME_NAME     |Текст запроса POST args name равно SOME_NAME|
|Куерипарамвалуе: SOME_NAME    |Имя аргументов строки запроса равно SOME_NAME|


Сейчас мы поддерживаем исключения правил для указанных выше Матчвариабленамес в журналах WAF. Для любого другого Матчвариабленамес необходимо либо отключить правила, предоставляющие ложные срабатывания, либо создать пользовательское правило, которое явно разрешает эти запросы. В частности, если Матчвариабленаме имеет значение CookieName, Хеадернаме, Постпарамнаме или Куерипарамнаме, это означает, что само имя активирует правило. В настоящее время исключение правила не поддерживает эти Матчвариабленамес.


Если вы исключите аргументы запроса POST с именем *foo* , ни одно правило не должно показывать ПОСТПАРАМВАЛУЕ: foo как матчвариабленаме в журналах WAF. Однако вы по-прежнему можете увидеть правило с Матчвариабленаме Инитиалбодиконтентс, которое соответствует значению параметра POST параметра FOO, так как значения параметров POST являются частью Инитиалбодиконтентс.

Списки исключений можно применить ко всем правилам в наборе управляемых правил, к правилам для конкретной группы правил или к одному правилу, как показано в предыдущем примере.

## <a name="define-exclusion-based-on-web-application-firewall-logs"></a>Определение исключения на основе журналов брандмауэра веб-приложения
 [Мониторинг и ведение журнала брандмауэра веб-приложения Azure](waf-front-door-monitor.md) отображает соответствующие сведения о заблокированном запросе. Если значение заголовка, значение cookie, значение аргумента POST или значение аргумента запроса выдают ложные срабатывания для некоторых правил, то эту часть запроса можно исключить из рассмотрения правилом. В следующей таблице показаны примеры значений из журналов WAF и соответствующие условия исключения.

|Матчвариабленаме из журналов WAF    |Исключение правила на портале|
|--------|------|
|Кукиевалуе: SOME_NAME  |Имя файла Cookie запроса равно SOME_NAME|
|HeaderValue: SOME_NAME  |Имя заголовка запроса равно SOME_NAME|
|Постпарамвалуе: SOME_NAME|  Текст запроса POST args name равно SOME_NAME|
|Куерипарамвалуе: SOME_NAME| Имя аргументов строки запроса равно SOME_NAME|


## <a name="next-steps"></a>Дальнейшие действия

После настройки параметров WAF Узнайте, как просматривать журналы WAF. Дополнительные сведения см. в статье [Диагностика передней дверцы](../afds/waf-front-door-monitor.md).
