---
title: Сведения о процессе перемещения в службе Azure Resource Mover
description: Сведения о процессе перемещения ресурсов между регионами с помощью службы Azure Resource Mover
author: rayne-wiselman
manager: evansma
ms.service: resource-move
ms.topic: overview
ms.date: 09/09/2020
ms.author: raynew
ms.openlocfilehash: 4d520f51717aa11dba55697d63852b17e0ba9cf0
ms.sourcegitcommit: 80b9c8ef63cc75b226db5513ad81368b8ab28a28
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2020
ms.locfileid: "90604501"
---
# <a name="about-the-move-process"></a>Сведения о процессе перемещения

Перемещайте ресурсы Azure между регионами Azure с помощью службы [Azure Resource Mover](overview.md). В этой статье перечислены компоненты, используемые службой Resource Mover, а также описывается процесс перемещения. 


## <a name="components"></a>Components

Эти компоненты используются во время перемещения ресурсов в другой регион.

**Компонент** | **Сведения**
--- | ---
**Resource Mover** |  Служба Resource Mover координирует работу с [поставщиками ресурсов Azure](https://docs.microsoft.com/azure/azure-resource-manager/management/resource-providers-and-types) для оркестрации перемещения ресурсов между регионами. Служба Resource Mover анализирует зависимости ресурсов, а также отслеживает их состояние и управляет ими в процессе перемещения. 
**Коллекция перемещения** |  Коллекция перемещения — это объект [Azure Resource Manager](https://docs.microsoft.com/azure/azure-resource-manager/management/overview).<br/><br/> Эта коллекция создается в процессе перемещения между регионами для каждого парного сочетания исходных и целевых регионов в подписке. Коллекция содержит метаданные и сведения о конфигурации ресурсов, которые требуется переместить.<br/><br/>Ресурсы, добавленные в коллекцию перемещения, должны относиться к одной подписке, но могут находиться в разных группах ресурсов. 
**Ресурс перемещения** | При добавлении ресурса в коллекцию перемещения он будет отслеживаться Resource Mover как ресурс перемещения.<br/><br/> Средство Resource Mover содержит сведения обо всех ресурсах перемещения в коллекции перемещения и поддерживает связь "один к одному" между исходным и целевым ресурсами. 
**Зависимости** | Resource Mover проверяет ресурсы, добавляемые в коллекцию, и определяет, имеют ли ресурсы какие-либо зависимости, отсутствующие в коллекции перемещения.<br/><br/> Определив зависимости ресурса, их можно добавить в коллекцию перемещения и тоже переместить. Кроме того, можно выбрать другие существующие ресурсы в целевом регионе. Все зависимости должны быть разрешены перед началом перемещения. 



## <a name="move-region-process"></a>Процесс перемещения между регионами 

![Схема, демонстрирующая шаги перемещения](./media/about-move-process/move-steps.png)

При перемещении каждого ресурса выполняются основные шаги.

**Step** | **Сведения** | **Состояние/проблемы**
--- | --- | --- 
**Шаг 1. Выбор ресурсов** | Выбор ресурса. Ресурс добавляется в коллекцию перемещения. | Состояние ресурса меняется на *Prepare pending* (Ожидается подготовка).<br/><br/> Если ресурс имеет зависимости, состояние *Validate dependency* (Проверка зависимостей) указывает, что необходимо добавить зависимые ресурсы в коллекцию перемещения.
**Шаг 2. Проверка зависимостей** | Запустите процесс проверки.<br/><br/> Если проверка показывает, что зависимые ресурсы находятся в состоянии ожидания, добавьте их в коллекцию перемещения. <br/><br/> Добавьте все зависимые ресурсы, даже если их не нужно перемещать. Позже можно указать, что перемещаемые ресурсы должны использовать разные ресурсы в целевом регионе.<br/><br/> Повторяйте проверку до тех пор, пока не останется необработанных зависимостей. | После добавления всех зависимостей и проверки состояние ресурсов меняется на *Prepare pending* (Ожидается подготовка) без возникновения проблем.
**Шаг 3. Подготовка** | Запустите процесс подготовки. Этапы подготовки зависят от ресурсов, которые вы перемещаете:<br/><br/> - **Ресурсы без отслеживания состояния**. Ресурсы без отслеживания состояния имеют только сведения о конфигурации. Для перемещения этих ресурсов не требуется непрерывная репликация данных. В качестве примера можно привести виртуальные сети Azure, сетевые адаптеры, подсистемы балансировки нагрузки и группы безопасности сети. Для этого типа ресурсов процесс подготовки создает шаблон Azure Resource Manager.<br/><br/> - **Ресурсы с отслеживанием состояния**. Ресурсы с отслеживанием состояния содержат сведения о конфигурации и данные, которые необходимо переместить. В качестве примера можно привести виртуальные машины Azure и базы данных SQL Azure. Процесс подготовки различается для каждого ресурса. Он может включать в себя репликацию исходного ресурса в целевой регион. | При запуске состояние ресурса изменяется на *Prepare in progress* (Выполняется подготовка).<br/><br/> После завершения подготовки состояние ресурса изменяется на *Initiate move pending* (Ожидание начала перемещения) без возникновения проблем.<br/><br/> Если перемещение завершается сбоем, состояние ресурса изменяется на *Prepare failed* (Сбой подготовки).
**Шаг 4. Начало перемещения** | Запустите процесс перемещения. Метод перемещения зависит от типа ресурса.<br/><br/> - **Без отслеживания состояния**. Как правило, для ресурсов без отслеживания состояния в процессе перемещения развертывается импортированный шаблон в целевом регионе. Шаблон основан на параметрах исходных ресурсов и изменениях, внесенных в целевые параметры вручную.<br/><br/> - **С отслеживанием состояния** Для ресурсов с отслеживанием состояния процесс перемещения может включать в себя создание ресурса или копии в целевом регионе.<br/><br/>  Для ресурсов с отслеживанием состояния запуск перемещения может привести к простою исходных ресурсов. Например, виртуальных машин или SQL. | При отключении перемещения состояние изменяется на *Initiate move in progress* (Начало перемещения).<br/><br/> При успешном запуске операции инициирования перемещения состояние ресурса изменяется на *Commit move pending* (Ожидается фиксация перемещения) без возникновения проблем. <br/><br/> Неудачный процесс перемещения завершается изменением состояния на *Initiate move failed* (Не удалось запустить перемещение).
**Шаг 5, вариант 1. Отмена перемещения** | После первоначального перемещения нужно решить, следует ли выполнить полное перемещение. Если нет, можно отменить перемещение и Resource Mover удалит ресурсы, созданные в целевом объекте. После завершения процесса отмены репликация ресурсов с отслеживанием состояния продолжится. Этот вариант удобен для тестирования. | При отмене перемещения ресурсов их состояние изменяется на *Discard in progress* (Выполняется отмена).<br/><br/> При успешной отмене состояние ресурсов изменяется на *Initiate move pending* (Ожидается запуск перемещения) без возникновения проблем.<br/><br/> Если выполнить отмену не удалось, состояние ресурсов изменится на *Discard move failed* (Сбой отмены перемещения). 
**Шаг 5, вариант 2. Режим фиксации** | После первоначального перемещения, если требуется выполнить полное перемещение, проверьте ресурсы в целевом регионе, и когда будете готовы, зафиксируйте перемещение.<br/><br/> Для ресурсов с отслеживанием состояния фиксация может привести к тому, что исходные ресурсы, например виртуальные машины или SQL, станут недоступными. | Если вы зафиксируете перемещение, состояние ресурса изменится на *Commit move in progress** (Выполняется фиксация перемещения).<br/><br/> После успешной фиксации состояние ресурса изменится на *Commit move completed* (Фиксация перемещения завершена) без возникновения проблем.<br/><br/> При сбое фиксации состояние ресурса изменится на *Commit move failed* (Сбой фиксации перемещения).
**Шаг 6. Удаление ресурсов** | После фиксации перемещения и проверки ресурсов в целевом регионе можно удалить исходный ресурс. | После фиксации перемещения состояние ресурса изменяется на *Delete source pending* (Ожидается удаление исходных объектов).


## <a name="move-region-states"></a>Состояние регионов перемещения

Процесс перемещения имеет ряд состояний, и в каждом из них могут возникнуть проблемы. Они обобщены в блок-схеме.

![Блок-схема возможных состояний и проблем](./media/about-move-process/process.png)


### <a name="dependency-analysis"></a>анализ зависимостей

По мере выполнения процесса перемещения может появиться запрос на проверку зависимостей, если:
- Ресурс использует зависимые ресурсы, которые не входят в коллекцию перемещения.
- Зависимый ресурс в коллекции перемещения имеет собственные зависимости, которых нет в коллекции перемещения.
- Вы изменили целевые параметры для ресурса, и вам нужно повторно проверить зависимости.


### <a name="remove-resources"></a>Удаление ресурсов

Если вы не хотите перемещать ресурс, его можно удалить из коллекции перемещения. Как правило, ресурс удаляется из коллекции вместе со всеми связанными действиями или объектами, такими как репликация или сохраненные шаблоны. Что именно происходит при удалении ресурса, зависит от типа ресурса и его состояния при удалении. [Подробнее](remove-move-resources.md).

## <a name="move-impact"></a>Влияние перемещения

В таблице приведены сведения о влиянии перемещения ресурсов между регионами.

**Поведение** | **Между регионами**
--- | --- | --- 
**Data** | Перемещаются данные и метаданные ресурсов.<br/><br/> Метаданные временно сохраняются, чтобы наблюдать за состоянием зависимостей ресурсов и операций с ними.
**Ресурс** | Исходный ресурс остается неизменным, чтобы гарантировать работоспособность приложений и возможность их удаления (при необходимости) после перемещения.<br/><br/> Ресурс создается в целевом регионе.
**Процесс перемещения** | Многоэтапный процесс, требующий мониторинга и вмешательства вручную.
Тестирование. | Проверка перемещения важна, так как после перемещения приложения должны по-прежнему работать в целевом регионе согласно ожиданиям.
**Простой** |  Потери данных не ожидается, но возможно возникновение временного простоя в процессе перемещения ресурсов.



## <a name="next-steps"></a>Дальнейшие действия

[Руководство по перемещению виртуальных машин Azure между регионами](tutorial-move-region-virtual-machines.md)
[Руководство по перемещению ресурсов SQL Azure в другой регион](tutorial-move-region-sql.md)