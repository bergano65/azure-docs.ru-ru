---
title: Мониторинг использования пропускной способности операции в Azure Cosmos DB
description: Узнайте, как отслеживать использование пропускной способности или единиц запросов для операции в Azure Cosmos DB. Владельцы учетной записи Azure Cosmos DB могут понять, какие операции занимают больше единиц запросов.
ms.service: cosmos-db
ms.topic: how-to
author: kanshiG
ms.author: govindk
ms.date: 04/09/2020
ms.openlocfilehash: e3ec3bc0e0c6028eb5d7a90ee1920938d792941b
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "85260752"
---
# <a name="how-to-monitor-throughput-or-request-unit-usage-of-an-operation-in-azure-cosmos-db"></a>Мониторинг пропускной способности или использования единиц запросов для операции в Azure Cosmos DB

Azure Monitor для Azure Cosmos DB предоставляет представление метрик для мониторинга учетной записи и создания панелей мониторинга. Метрики по Azure Cosmos DB собираются по умолчанию, для этого компонента не требуется явно включать или настраивать что-либо. Метрика " **Общая единица запросов** " используется для получения сведений об использовании единиц запросов для различных типов операций. Позже можно будет проанализировать, какие операции используют большую часть пропускной способности. По умолчанию данные о пропускной способности суммируются с интервалом в 1 минуту. Однако можно изменить единицу статистической обработки, изменив параметр гранулярности времени.

Существует два способа анализа данных об использовании единиц запросов.

* В течение заданного интервала времени, в течение которого операции занимают больше единиц запросов.
* Какие операции в целом являются общими для рабочей нагрузки за счет использования большего числа единиц запросов.
Этот анализ позволяет сосредоточиться на таких операциях, как INSERT, Upsert и смотреть их индексирование. Вы можете узнать, не превышено ли индексирование конкретных полей, и изменить [политику индексирования](index-policy.md#include-exclude-paths) для включения или исключения путей.

Если вы видите, что некоторые запросы занимают больше единиц запросов, можно выполнить следующие действия:

* Пересмотрите, если запрашивается правильный объем данных.
* Измените запрос, чтобы использовать индекс с предложением фильтра.
* Выполнение менее затратных вызовов функций UDF.
* Определите ключи секции, чтобы уменьшить вентилятор из запроса в разные секции.
* Вы также можете использовать метрики запроса, возвращенные в ответе на вызов, сведения о журнале диагностики и статью о [настройке производительности запросов](sql-api-query-metrics.md) , чтобы получить дополнительные сведения о выполнении запроса.
* Вы можете начать с Sum, а затем просмотреть среднее использование с помощью правильного измерения.

## <a name="view-the-total-request-unit-usage-metric"></a>Просмотр общей метрики использования единиц запросов

1. Войдите на [портал Azure](https://portal.azure.com/).

1. Выберите **монитор** на панели навигации слева и щелкните **метрики**.

   :::image type="content" source="./media/monitor-request-unit-usage/monitor-metrics-blade.png" alt-text="Область метрик в Azure Monitor":::

1. В области **Метрики** щелкните **Выбрать ресурс** и выберите требуемые **подписку** и **группу ресурсов**. В поле **Тип ресурса** выберите **Учетные записи Azure Cosmos DB**, выберите одну из существующих учетных записей Azure Cosmos и нажмите кнопку **Применить**.

   :::image type="content" source="./media/monitor-request-unit-usage/select-cosmos-db-account.png" alt-text="Область метрик в Azure Monitor":::

1. Далее выберите метрику **Общее количество единиц запроса** из списка доступных метрик. Подробные сведения о всех доступных метриках в списке см. в статье с [перечнем метрик по категориям](monitor-cosmos-db-reference.md). В этом примере выберем **Общие единицы запроса** и **AVG** в качестве значения статистической обработки. Помимо этих сведений, можно также выбрать **диапазон времени** и **степень детализации времени** для метрик. Вы можете просмотреть метрики максимум за последние 30 дней.  После применения фильтра отображается диаграмма на его основе. На ней можно увидеть среднее количество единиц запросов, употреблявшихся в минуту за выбранный период.  

   :::image type="content" source="./media/monitor-request-unit-usage/request-unit-usage-metric.png" alt-text="Область метрик в Azure Monitor":::

## <a name="filters-for-request-unit-usage"></a>Фильтры для использования единиц запросов

Можно также фильтровать метрики и получать диаграммы, отображаемые конкретными **CollectionName**, **DatabaseName**, **OperationType**, **Region**, **Status**и **StatusCode**. Параметры **Добавить фильтр** и **Применить разбиение** позволяют фильтровать данные об использовании единиц запросов и группировать метрики.

Чтобы получить сведения об использовании единиц запросов для каждой операции либо по общему (SUM), либо по среднему значению, выберите **Применить разделение** и выберите **тип операции** и значение фильтра, как показано на следующем рисунке:

   :::image type="content" source="./media/monitor-request-unit-usage/request-unit-usage-operations.png" alt-text="Область метрик в Azure Monitor":::

Если вы хотите просмотреть сведения об использовании единиц запросов по коллекциям, выберите **Применить разделение** и выберите имя коллекции в качестве фильтра. Вы увидите разговор, как показано ниже, с выбором коллекций на панели мониторинга. Затем можно выбрать определенное имя коллекции, чтобы просмотреть дополнительные сведения:

   :::image type="content" source="./media/monitor-request-unit-usage/request-unit-usage-collection.png" alt-text="Область метрик в Azure Monitor":::

## <a name="next-steps"></a>Дальнейшие действия

* Отслеживайте Azure Cosmos DB данные с помощью [параметров диагностики](cosmosdb-monitor-resource-logs.md) в Azure.
* [Аудит операций Azure Cosmos DB плоскости управления](audit-control-plane-logs.md)
