---
title: Типы разрешения конфликтов и политики разрешения в Azure Cosmos DB
description: В этой статье описаны категории конфликтов и политики их устранения в Azure Cosmos DB.
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/20/2020
ms.author: mjbrown
ms.reviewer: sngun
ms.openlocfilehash: 49400ad0da86eddf7bbbd51dd92101084cdf1ee1
ms.sourcegitcommit: f796e1b7b46eb9a9b5c104348a673ad41422ea97
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/30/2020
ms.locfileid: "91570096"
---
# <a name="conflict-types-and-resolution-policies-when-using-multiple-write-regions"></a>Типы конфликтов и политики разрешения при использовании нескольких регионов записи

Конфликты и политики их устранения целесообразно изучать, если ваша учетная запись Azure Cosmos DB настроена на несколько регионов записи.

Для учетных записей Azure Cosmos, настроенных с несколькими регионами записи, конфликты обновления могут возникать, когда модули записи одновременно обновляют один и тот же элемент в нескольких регионах. Конфликты обновления могут быть следующих трех типов:

* **Конфликты вставки**. Эти конфликты могут возникать, когда приложение одновременно вставляет два или более элементов с одним и тем же уникальным индексом в двух или более регионах. Например, этот конфликт может возникать со свойством ID.

* **Конфликты замены**. Эти конфликты могут возникать, когда приложение обновляет один и тот же элемент одновременно в двух или более регионах.

* **Конфликты удаления**. Эти конфликты могут возникать, когда приложение одновременно удаляет элемент в одном регионе и обновляет его в другом регионе.

## <a name="conflict-resolution-policies"></a>Политик разрешения конфликтов

Azure Cosmos DB предлагает гибкий механизм, управляемый политиками, для разрешения конфликтов записи. Вы можете выбрать из двух политик разрешения конфликтов в контейнере Azure Cosmos:

* **Последняя запись WINS (лвв)**: Эта политика разрешения по умолчанию использует определенное системой свойство timestamp. (на основе протокола синхронизации времени). При использовании API SQL можно указать любое другое настраиваемое числовое свойство (например, собственное представление метки времени), которое будет использоваться для разрешения конфликтов. Настраиваемое числовое свойство также называется *путем разрешения конфликтов*. 

  Если во время вставки или замены двух или более элементов возникает конфликт, приоритет получает элемент с более высоким значением пути устранения конфликтов. Если несколько элементов имеют одинаковое числовое значение пути устранения конфликта, то приоритет определяется системой. Гарантируется, что во всех регионах используется та же версия единственного элемента, получившего приоритет. При наличии конфликтов удаления удаленная версия всегда имеет приоритет в конфликтах вставки или замены. Этот результат происходит независимо от значения пути разрешения конфликтов.

  > [!NOTE]
  > Последняя запись WINS является политикой разрешения конфликтов по умолчанию и использует отметку времени `_ts` для следующих API: SQL, MongoDB, Cassandra, Gremlin и Table. Настраиваемое числовое свойство доступно только для API SQL.

  Дополнительные сведения см. в разделе с [примерами использования политик устранения конфликтов LWW](how-to-manage-conflicts.md).

* **Custom**: Эта политика разрешения предназначена для определяемой приложением семантики для сверки конфликтов. При установке этой политики в контейнере Azure Cosmos необходимо также зарегистрировать *хранимую процедуру Merge*. Эта процедура вызывается автоматически при обнаружении конфликтов в транзакции базы данных на сервере. Система гарантирует только однократное выполнение слияния в рамках протокола обязательств.  

  Если вы настраиваете контейнер с помощью параметра Custom Resolution и не регистрируете процедуру слияния в контейнере или процедура Merge вызывает исключение во время выполнения, конфликты записываются в *канал конфликтов*. Приложение должно затем устранить конфликты в веб-канале. Дополнительные сведения см. в разделе с [примерами использования веб-каналов и настраиваемой политики устранения конфликтов](how-to-manage-conflicts.md).

  > [!NOTE]
  > Настраиваемая политика устранения конфликтов доступна только для учетных записей API SQL.

## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как настроить политики разрешения конфликтов.

* [Настройка нескольких регионов записи для приложений](how-to-multi-master.md)
* [Управление политиками разрешения конфликтов](how-to-manage-conflicts.md)
* [Чтение из веб-канала конфликтов](how-to-manage-conflicts.md#read-from-conflict-feed)
