---
title: Создание контейнеров и баз данных Azure Cosmos в режиме автомасштабирования.
description: Узнайте о преимуществах, сценариях использования и подготовке баз данных и контейнеров Azure Cosmos в режиме автомасштабирования.
author: kirillg
ms.author: kirillg
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 06/04/2020
ms.openlocfilehash: 20b0bcfe5043d4767199c36796fa1123ed779363
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "84791152"
---
# <a name="create-azure-cosmos-containers-and-databases-with-autoscale-throughput"></a>Создание контейнеров и баз данных Azure Cosmos с автомасштабируемой пропускной способностью

Azure Cosmos DB дает возможность настроить подготовленную пропускную способность со стандартным (вручную) масштабированием или с автомасштабированием для баз данных и контейнеров. В этой статье описываются преимущества и примеры использования подготовленной автомасштабируемой пропускной способности. 

Подготовленная автомасштабируемая пропускная способность оптимальна для критически важных рабочих нагрузок с переменными или непредсказуемыми моделями трафика, и для высокой производительности и масштабирования в данном случае требуется соглашение об уровне обслуживания. 

Автоматическое масштабирование Azure Cosmos DB **позволяет автоматически и мгновенно масштабировать пропускную способность (число единиц запросов в секунду)** для базы данных или контейнера с учетом использования и без ущерба для доступности, задержки, пропускной способности или производительности рабочей нагрузки. 

## <a name="benefits-of-autoscale"></a>Преимущества автомасштабирования

Базы данных и контейнеры Azure Cosmos, настроенные с использованием подготовленной автомасштабируемой пропускной способности, имеют следующие преимущества.

* **Простой:** Автомасштабирование снижает сложность управления числом единиц запросов в секунду за счет пользовательских сценариев или масштабирования емкости вручную. 

* **Масштабируемость.** Базы данных и контейнеры автоматически масштабируют подготовленную пропускную способность по мере необходимости. Это не нарушает работу клиентских соединений, приложений и не влияет на соглашения об уровне обслуживания Azure Cosmos DB.

* **Экономичность.** Автомасштабирование помогает оптимизировать число единиц запросов в секунду и затраты за счет уменьшения масштаба в период неактивности. Вы платите только за ресурсы, потребляемые в час для рабочей нагрузки. Из всех часов в месяце, если вы установили параметр автомасштабирования Max единиц запросов в секунду (Тмакс) и используете полную сумму Тмакс в 66% от часов, вы сэкономите с автомасштабированием. Дополнительные сведения см. в статье [Выбор между стандартной (ручной) и подготовленной пропускной способностью для автомасштабирования](how-to-choose-offer.md) .

* **Высокая доступность.** Базы данных и контейнеры, для которых применяется автомасштабирование, используют одинаковую глобально распределенную, отказоустойчивую, высокодоступную серверную часть Azure Cosmos DB для обеспечения надежности и высокой доступности данных.

## <a name="use-cases-of-autoscale"></a>Сценарии использования автомасштабирования

Существуют следующие варианты использования автомасштабирования.

* **Переменные или непредсказуемые рабочие нагрузки.** Если рабочие нагрузки предполагают переменные или непредсказуемые пиковые значения, автомасштабирование помогает сгладить пики за счет масштабирования по мере использования. В качестве примера можно привести интернет-магазины розничной торговли, в которых модели трафика меняются в зависимости от сезонности; рабочие нагрузки IOT с пиковыми значениями в разные моменты времени; бизнес-приложения, достигающие пиковых значений несколько раз в месяц или в год, и т. д. При использовании автомасштабирования больше не придется вручную подготавливать емкость для пиковых или средних нагрузок. 

* **Новые приложения.** Если вы разрабатываете новое приложение и вам неизвестна требуемая пропускная способность (число единиц запросов в секунду), автомасштабирование упростит начальный этап работы. Можно начать с автомасштабирования на уровне 400–4000 единиц запросов в секунду, отслеживать использование и определить требуемое число единиц запросов в секунду.

* **Последние использованные приложения.** Для приложений, которые используются в течение нескольких часов несколько раз в день, в неделю или в месяц (например, приложения с небольшим объемом трафика/веб-сайт или блог), автомасштабирование настраивает емкость для управления пиковыми значениями потребления и масштабирует пропускную способность при их превышении. 

* **Рабочие нагрузки разработки и тестирования.** Если вы или ваша команда использует базы данных и контейнеры Cosmos Azure в рабочее время, но они не требуются ночью или в выходные дни, автомасштабирование позволяет сократить затраты путем масштабирования до минимума в период неактивности. 

* **Запланированные производственные рабочие нагрузки/запросы.** При наличии серии запланированных запросов или операций, которые необходимо выполнить во время простоя, можно легко сделать это с помощью автомасштабирования. Если необходимо выполнить рабочую нагрузку, пропускная способность будет автоматически увеличиваться по мере необходимости и уменьшаться по завершении выполнения. 

Создание настраиваемого решения для устранения этих проблем не только отнимает много времени, но также приводит к усложнению конфигурации или кода приложения. Автомасштабирование позволяет выполнять указанные выше сценарии и устраняет необходимость в настраиваемом или ручном масштабировании емкости. 

## <a name="how-autoscale-provisioned-throughput-works"></a>Принципы работы подготовленной автомасштабируемой пропускной способности

При настройке контейнеров и баз данных с автомасштабированием указывается максимальная требуемая пропускная способность `Tmax`. Azure Cosmos DB масштабирует пропускную способность `T` таким образом `0.1*Tmax <= T <= Tmax`. Например, если установить максимальную пропускную способность равной 20 000 единиц запросов в секунду, то пропускная способность будет масштабироваться в пределах между 2000 и 20 000 единиц запросов в секунду. Поскольку масштабирование происходит автоматически и мгновенно, выполнение всех запросов в пределах подготовленной пропускной способности `Tmax` осуществляется без задержки. 

За каждый час вам будет выставляться счет за наибольшую пропускную способность `T`, до которой система была масштабирована за этот час.

Начальное значение для максимальной автомасштабируемой пропускной способности `Tmax` равно 4000 единиц запросов в секунду, и оно масштабируется в пределах между 400–4000 единиц запросов в секунду. Можно задать `Tmax` с шагом в 1000 единиц запросов в секунду и в любое время изменить это значение.  

## <a name="enable-autoscale-on-existing-resources"></a>Включение автомасштабирования для существующих ресурсов

Используйте [портал Azure](how-to-provision-autoscale-throughput.md#enable-autoscale-on-existing-database-or-container) для включения автомасштабирования для существующей базы данных или контейнера. Вы также можете в любое время переключаться между автомасштабированием и стандартной пропускной способностью, подготовленной вручную. Дополнительные сведения см. в этой [документации](autoscale-faq.md#how-does-the-migration-between-autoscale-and-standard-manual-provisioned-throughput-work). В настоящее время для всех API можно использовать только портал Azure, чтобы включить Автомасштабирование для существующих ресурсов.

## <a name="throughput-and-storage-limits-for-autoscale"></a><a id="autoscale-limits"></a> Ограничения пропускной способности и хранилища при использовании автомасштабирования

Для любого значения `Tmax` в базе данных или контейнере может храниться всего `0.01 * Tmax GB`. По достижении этого объема хранимых данных максимальное число единиц запросов в секунду будет автоматически увеличено с учетом нового объема хранилища без ущерба для работы приложения. 

Например, если начать с максимальной пропускной способности в 50 000 ЕЗ/с (с масштабированием от 5000 до 50 000 ЕЗ/с), можно хранить до 500 ГБ данных. Если объем ваших данных превысит этот лимит и достигнет, например, 600 ГБ, новая максимальная пропускная способность составит 60 000 ЕЗ/с (с масштабированием от 6000 до 60 000 ЕЗ/с).

При использовании пропускной способности уровня базы данных с автомасштабированием первые 25 контейнеров могут совместно использовать не более 4000 единиц запросов в секунду (масштабирование в пределах 400–4000 единиц запросов в секунду) при условии, что размер хранилища не превышает 40 ГБ. Дополнительные сведения см. в этой [документации](autoscale-faq.md#can-i-change-the-max-rus-on-the-database-or-container).

## <a name="comparison--containers-configured-with-manual-vs-autoscale-throughput"></a>Сравнение — контейнеры, настроенные с масштабируемой вручную или автомасштабируемой пропускной способностью
Дополнительные сведения см. в этой [документации](how-to-choose-offer.md), описывающей выбор между стандартно (вручную) масштабируемой и автомасштабируемой пропускной способностью.  

|| Контейнеры со стандартно (вручную) масштабируемой пропускной способностью  | Контейнеры с автомасштабируемой пропускной способностью |
|---------|---------|---------|
| **Подготовленная пропускная способность (единиц запросов в секунду)** | Подготовленная вручную. | Масштабируемая автоматически и мгновенно на основе моделей использования рабочих нагрузок. |
| **Ограничение скорости запросов и операций (429)**  | Это возможно, если потребление превышает подготовленную емкость. | Этого не происходит, если единицы запросов в секунду потребляются в заданном диапазоне автомасштабируемой пропускной способности.    |
| **Планирование ресурсов** |  Необходимо спланировать ресурсы и обеспечить необходимую пропускную способность. |    Система автоматически принимает меры по планированию ресурсов и управлению емкостью. |
| **Цены** | Вы оплачиваете единицы запросов в секунду, подготовленных вручную, потребленные за час, используя [тариф за стандартное (вручную) масштабирование в ЕЗ/с в час](https://azure.microsoft.com/pricing/details/cosmos-db/). | Вы платите за максимально потребленное за час число единиц запросов в секунду, до которого система масштабировалась в течение этого часа. <br/><br/> Для учетных записей с одним регионом записи вы платите за число единиц запросов в секунду, потребляемых в час, используя функцию [автомасштабирование числа единиц запросов в секунду за час](https://azure.microsoft.com/pricing/details/cosmos-db/). <br/><br/>Для учетных записей с несколькими регионами записи дополнительная плата за автомасштабирование не взимается. Вы платите за пропускную способность по часам, используя один и тот же [тариф по числу единиц запросов на секунду в нескольких источниках](https://azure.microsoft.com/pricing/details/cosmos-db/). |
| **Оптимален для различных типов рабочих нагрузок** |  Прогнозируемые и стабильные рабочие нагрузки|   Переменные или непредсказуемые рабочие нагрузки  |

## <a name="next-steps"></a>Дальнейшие действия

* Изучите [часто задаваемые вопросы об автомасштабировании](autoscale-faq.md).
* Узнайте, как [выбрать автомасштабируемую или масштабируемую вручную пропускную способность](how-to-choose-offer.md).
* Узнайте, как [подготовить автомасштабируемую пропускную способность для базы данных или контейнера Azure Cosmos](how-to-provision-autoscale-throughput.md).
* Дополнительные сведения о [секционировании](partition-data.md) в Azure Cosmos DB.


