---
title: Уникальные ключи в Azure Cosmos DB
description: Узнайте, как использовать уникальные ключи в базе данных Azure Cosmos DB
author: aliuy
ms.service: cosmos-db
ms.devlang: na
ms.topic: conceptual
ms.date: 10/30/2018
ms.author: andrl
ms.openlocfilehash: 36b57fd98de206641422d80bf3ea3d2a3853f578
ms.sourcegitcommit: da3459aca32dcdbf6a63ae9186d2ad2ca2295893
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/07/2018
ms.locfileid: "51252570"
---
# <a name="unique-keys-in-azure-cosmos-db"></a>Уникальные ключи в Azure Cosmos DB

Уникальные ключи предоставляют вам возможность добавить слой целостности данных в контейнер Cosmos. При создании контейнера Cosmos создайте политику уникальных ключей. С уникальными ключами вы гарантируете уникальность одного или нескольких значений в логической секции (вы можете гарантировать уникальность каждого [ключа секции](partition-data.md)). После создания контейнера с политикой уникальных ключей он предотвращает создание любых новых или обновленных повторяющихся элементов в логической секции, как указано в ограничениях уникального ключа. Ключ раздела в сочетании с уникальным ключом гарантирует уникальность элемента в области контейнера.

Например, рассмотрим контейнер Cosmos с адресом электронной почты как ограничение уникального ключа и `CompanyID` как ключ секции. Настроив адрес электронной почты пользователя уникальным ключом, вы убедитесь, что каждый элемент содержит уникальный адрес электронной почты в пределах заданного `CompanyID`. Невозможно создать два элемента с дублирующимся адресом электронной почты и с тем же значением ключа секции.  

Если нужно, чтобы пользователи могли создавать несколько элементов с одинаковым адресом электронной почты, но не с тем же именем, фамилией, то можно добавить дополнительные пути для политики уникальных ключей. Поэтому вместо создания уникального ключа на основе адреса электронной почты можно также создать уникальный ключ, который представляет собой комбинацию имени, фамилии и электронной почты (составной уникальный ключ). В этом случае разрешено каждое уникальное сочетание трех значений в пределах заданного `CompanyID`. Например, контейнер может содержать элементы со следующими значениями, в которых каждый элемент соблюдает ограничение уникального ключа.

|CompanyID|Имя|Фамилия|Адрес электронной почты|
|---|---|---|---|
|Contoso|Гэби|Дюперре|gaby@contoso.com |
|Contoso|Гэби|Дюперре|gaby@fabrikam.com|
|Fabrikam|Гэби|Дюперре|gaby@fabrikam.com|
|Fabrikam|Иван|Дюперре|gaby@fabrikam.com|
|Fabrkam|   |Дюперре|gaby@fabraikam.com|
|Fabrkam|   |   |gaby@fabraikam.com|

При попытке вставить другой элемент с сочетаниями, которые перечислены в приведенной выше таблице, вы получите сообщение об ошибке, указывающее, что ограничение уникального ключа не выполнено. Вы получите ответное сообщение "Ресурс с указанным идентификатором или именем уже существует" или "Ресурс с определенным идентификатором, именем или уникальным индексом уже существует".  

## <a name="defining-a-unique-key"></a>Определение уникального ключа

Уникальные ключи можно определить только при создании контейнера Cosmos. Уникальный ключ ограничивается логической секцией. В предыдущем примере при секционировании контейнера на основе индекса вы получите повторяющиеся элементы в каждой логической секции. При создании уникальных ключей рассмотрим следующие свойства:

* Невозможно обновить имеющийся контейнер для использования другого уникального ключа. Другими словами, после создания контейнера с политикой уникальных ключей политику невозможно изменить.

* Если вы хотите задать уникальный ключ для уже существующего контейнера, необходимо создать контейнер с ограничением уникального ключа и использовать соответствующее средство миграции данных для их перемещения из существующего контейнера в новый. Для контейнеров SQL используйте [средство переноса данных](import-data.md) для перемещения данных. Для контейнеров MongoDB используйте [mongoimport.exe или mongorestore.exe](mongodb-migrate.md) для перемещения данных.

* Политика уникальных ключей может содержать до 16 значений путей (например, /firstName, /lastName, /address/zipCode). Каждая политика уникальных ключей может содержать не более 10 ограничений уникальных ключей или сочетаний. А комбинированные пути для каждого ограничения уникального индекса не должны содержать более 60 символов. В предыдущем примере имя, фамилия и адрес электронной почты в совокупности являются только одним ограничением, которое использует три из 16 возможных путей.

* Если контейнер содержит политику уникальных ключей, то затраты единиц запросов для создания, обновления и удаления элемента становятся значительно выше.

* Разреженные уникальные ключи не поддерживаются. Если значения некоторых уникальных путей отсутствуют, они рассматриваются как имеющие значение null, которое принимает участие в ограничении уникальности. Таким образом, может существовать только один элемент со значением null для удовлетворения этого ограничения.

* В именах уникальных ключей учитывается регистр. Например, рассмотрим контейнер с ограничением уникального ключа равным /address/zipcode. Если в данных есть поле с именем ZipCode, Cosmos DB вставляет "null" в качестве уникального ключа, так как "zipcode" не совпадает с "ZipCode". Во всех других записях, которые содержат ZipCode, в уникальный ключ невозможно вставить еще одно значение null, поскольку это нарушит требование уникальности ключа.

## <a name="supported-apis-and-sdks"></a>Поддерживаемые API-интерфейсы и пакеты SDK

Компонент уникальных ключей в настоящее время поддерживается следующими API Cosmos DB и клиентскими пакетами SDK: 

|Клиентские драйверы|API-интерфейс SQL|API Cassandra|API MongoDB|API Gremlin|API таблицы|
|---|---|---|---|---|---|
|.NET|Yes|Нет |Yes|Нет |Нет |
|Java|Yes|Нет |Yes|Нет |Нет |
|Python|Yes|Нет |Yes|Нет |Нет |
|Node/JS|Yes|Нет |Yes|Нет |Нет |

## <a name="next-steps"></a>Дополнительная информация

* Подробнее о [логических разделах](partition-data.md).
