---
title: Создание искусственного ключа секции в Azure Cosmos DB для равномерного распределения данных и рабочей нагрузки.
description: Сведения об использовании искусственных ключей секций в контейнерах Azure Cosmos
author: rimman
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 07/23/2019
ms.author: rimman
ms.openlocfilehash: bf60c674f9f43c01a3090efa3ac1f0e2e0674efa
ms.sourcegitcommit: c72ddb56b5657b2adeb3c4608c3d4c56e3421f2c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/24/2019
ms.locfileid: "68467842"
---
# <a name="create-a-synthetic-partition-key"></a>Создание искусственного ключа секции

Рекомендуется использовать ключ секции с множеством различных значений, например с сотнями или тысячами. Главное — это равномерное распределение данных и рабочей нагрузки по всем элементам, связанным с этими значениями ключа секции. Если такое свойство не существует в данных, можно создать *Виртуальный ключ секции*. В этом документе описаны некоторые основные методы создания искусственного ключа секции для контейнера Cosmos.

## <a name="concatenate-multiple-properties-of-an-item"></a>Сцепление нескольких свойств элемента

Вы можете создать ключ секции, объединив несколько значений свойств в одно искусственное свойство `partitionKey`. Эти ключи называются искусственными ключами. Рассмотрим следующий пример документа:

```JavaScript
{
"deviceId": "abc-123",
"date": 2018
}
```

Для предыдущего документа одним из вариантов является установка /deviceId или /date в качестве ключа секции. Используйте этот параметр, если вы хотите секционировать контейнер на основе идентификатора или даты устройства. Другой вариант заключается в сцеплении этих двух значений в искусственное свойство `partitionKey`, которое используется в качестве ключа секции.

```JavaScript
{
"deviceId": "abc-123",
"date": 2018,
"partitionKey": "abc-123-2018"
}
```

В сценариях реального времени в базе данных могут быть тысячи элементов. Вместо того, чтобы добавлять искусственный ключ вручную, определите логику на стороне клиента для сцепления значений и вставьте искусственный ключ в элементы в контейнерах Cosmos.

## <a name="use-a-partition-key-with-a-random-suffix"></a>Использование ключа секции со случайным суффиксом

Другой возможной стратегией равномерного распределения рабочей нагрузки является добавление случайного числа в конце значения ключа секции. При таком распределении элементов вы можете выполнять параллельные операции записи по секциям.

Например, если ключ секции представляет собой дату, Вы можете выбрать случайное число от 1 до 400 и сцепить его как суффикс к дате. Этот метод приводит к получению значений ключа `2018-08-09.1`секции`2018-08-09.2`, таких как, и т `2018-08-09.400`. д., с помощью. Так как вы рандомизируете ключ секции, ежедневные операции записи в контейнере распределяются равномерно по нескольким секциям. Этот метод обеспечивает оптимальный параллелизм и высокую общую пропускную способность.

## <a name="use-a-partition-key-with-pre-calculated-suffixes"></a>Использование ключа секции с предварительно вычисленными суффиксами 

Стратегия случайного суффикса может значительно повысить пропускную способность записи, но при этом трудно считать конкретный элемент. Вы не узнаете значение суффикса, которое использовалось при написании элемента. Чтобы упростить чтение отдельных элементов, используйте стратегию предварительно вычисляемых суффиксов. Вместо того чтобы использовать случайное число для распределения элементов между секциями, используйте число, вычисляемое на основе чего-либо, которое нужно запросить.

Рассмотрим предыдущий пример, в котором контейнер использует дату в качестве ключа секции. Теперь предположим, что у каждого элемента `Vehicle-Identification-Number` есть`VIN`атрибут (), к которому требуется получить доступ. Кроме того, предположим, что вы часто выполняете запросы для поиска `VIN`элементов по в дополнение к дате. Прежде чем приложение запишет элемент в контейнер, оно может вычислить суффикс хэша на основе номера ТС и добавить его к дате ключа секции. Вычисление может создать число от 1 до 400, которое распределено равномерно. Этот результат похож на результат, созданный методом стратегии случайного суффикса. Значением ключа секции будет дата, сцепленная с вычисленным результатом.

С помощью этой стратегии записи равномерно распределяются по значениям ключа секции и по секциям. Вы можете легко читать определенный элемент и дату, так как можете вычислить значение ключа секции для конкретного `Vehicle-Identification-Number`объекта. Преимущество этого метода заключается в том, что можно избежать создания одного ключа горячей секции, т. е. ключа секции, который выполняет всю рабочую нагрузку. 

## <a name="next-steps"></a>Следующие шаги

Подробнее о концепции разделения вы можете узнать в следующих статьях:

* Подробнее о [логических секциях](partition-data.md).
* Подробнее о [подготовке пропускной способности в контейнерах и базах данных Azure Cosmos](set-throughput.md).
* Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).
