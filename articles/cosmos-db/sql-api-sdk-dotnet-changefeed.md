---
title: Заметки к выпуску API и пакета SDK обработчика канала изменений для Azure Cosmos DB .NET
description: Сведения об API и пакете SDK для обработчика канала изменений, включая даты выхода, даты прекращения, а также изменения, внесенные в каждую версию пакета SDK для обработчика канала изменений в .NET.
author: anfeldma-ms
ms.service: cosmos-db
ms.subservice: cosmosdb-sql
ms.devlang: dotnet
ms.topic: reference
ms.date: 05/11/2020
ms.author: anfeldma
ms.openlocfilehash: 679f3113cddbfe13370483f2678154f4dd1f8ab2
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85392069"
---
# <a name="net-change-feed-processor-sdk-download-and-release-notes"></a>Пакет SDK обработчика канала изменений: заметки о скачивании и выпуске

> [!div class="op_single_selector"]
>
> * [Пакет SDK версии 3 для .NET](sql-api-sdk-dotnet-standard.md)
> * [Пакет SDK для .NET версии 2](sql-api-sdk-dotnet.md)
> * [Пакет SDK для .NET Core версии 2](sql-api-sdk-dotnet-core.md)
> * [Пакет SDK для веб-канала изменений .NET версии 2](sql-api-sdk-dotnet-changefeed.md)
> * [Node.js](sql-api-sdk-node.md)
> * [Пакет SDK для Java версии 4](sql-api-sdk-java-v4.md)
> * [Пакет SDK для Async Java версии 2](sql-api-sdk-async-java.md)
> * [Пакет SDK для Sync Java версии 2](sql-api-sdk-java.md)
> * [Python](sql-api-sdk-python.md)
> * ПОСЛЕДУЮЩИЕ (/рест/АПИ
> * [Поставщик ресурсов RESTFUL] (/рест/АПИ
> * [SQL](sql-api-query-reference.md)
> * [Групповой исполнитель — .NET v2](sql-api-sdk-bulk-executor-dot-net.md)
> * [Исполнитель массовых операций — Java](sql-api-sdk-bulk-executor-java.md)

|   |   |
|---|---|
|**Скачивание пакета SDK**|[NuGet](https://www.nuget.org/packages/Microsoft.Azure.DocumentDB.ChangeFeedProcessor/)|
|**Документация по API**|[Справочная документация по изменению API библиотеки обработчика веб-каналов](/dotnet/api/microsoft.azure.documents.changefeedprocessor?view=azure-dotnet)|
|**Начало работы**|[Начало работы с пакетом SDK для обработчика канала изменений в .NET](change-feed.md)|
|**Текущая поддерживаемая платформа**| [Microsoft .NET Framework 4.5](https://www.microsoft.com/download/details.aspx?id=30653)</br> [Microsoft .NET Core](https://www.microsoft.com/net/download/core) |

> [!NOTE]
> Если вы используете обработчик канала изменений, найдите последнюю версию 3.x [пакета SDK для .NET](change-feed-processor.md) со встроенной поддержкой канала изменений. 

## <a name="release-notes"></a>Заметки о выпуске

### <a name="v2-builds"></a>Сборки версии 2

### <a name="230"></a><a name="2.3.0"></a>2.3.0
* Добавлен новый метод `ChangeFeedProcessorBuilder.WithCheckpointPartitionProcessorFactory` и соответствующий открытый интерфейс `ICheckpointPartitionProcessorFactory`. Это позволяет в реализации интерфейса `IPartitionProcessor` использовать встроенный механизм создания контрольных точек. Новая фабрика аналогична существующей `IPartitionProcessorFactory`, за исключением того, что метод `Create` в ней принимает дополнительный параметр `ILeaseCheckpointer`.
* Для одного экземпляра `ChangeFeedProcessorBuilder` можно использовать только один из двух методов: `ChangeFeedProcessorBuilder.WithPartitionProcessorFactory` или `ChangeFeedProcessorBuilder.WithCheckpointPartitionProcessorFactory`.

### <a name="228"></a><a name="2.2.8"></a>2.2.8
* Повышены качество и стабильность.
  * Добавлена поддержка обнаружения длительного процесса чтения канала изменений. Если такой процесс занимает больше времени, чем указано в свойстве `ChangeFeedProcessorOptions.ChangeFeedTimeout`, выполняются следующие действия:
    * Прерывается операция чтения канала изменений для проблемной секции.
    * Экземпляр обработчика веб-канала изменений отменяет владение проблемной арендой. Отмененная аренда будет снова получена при следующей операции получения аренды, тем же или другим экземпляром обработчика канала изменений. Это означает, что чтение канала изменений начнется заново.
    * Сообщение об этой проблеме передается в монитор работоспособности. Монитор работоспособности по умолчанию отправляет все обнаруженные проблемы в журнал трассировки.
  * Добавлено новое открытое свойство `ChangeFeedProcessorOptions.ChangeFeedTimeout`. Значение этого свойства по умолчанию равно 10 минутам.
  * Добавлено новое открытое значение перечисления `Monitoring.MonitoredOperation.ReadChangeFeed`. Если для параметра `HealthMonitoringRecord.Operation` задано значение `Monitoring.MonitoredOperation.ReadChangeFeed`, значит проблема с работоспособностью связана с чтением канала изменений.

### <a name="227"></a><a name="2.2.7"></a>2.2.7
* Улучшена стратегия балансировки нагрузки для сценария, в котором получение всех аренд занимает больше времени, чем установленный срок действия аренды, например из-за проблем с сетью:
  * В этом сценарии алгоритм балансировки нагрузки ранее ошибочно объявлял срок действия аренды истекшим, что приводило к перехвату аренды у активных владельцев. Это могло приводить к ненужному перераспределению большого количества аренд.
  * В этом выпуске эта проблема исправлена, и теперь повторные попытки не выполняются в случае конфликта при получении аренды с истекшим сроком действия, если владелец аренды не изменился, то есть получение аренды с истекшим сроком действия откладывается до следующей итерации балансировки нагрузки.

### <a name="226"></a><a name="2.2.6"></a>2.2.6
* Улучшена обработка исключений Observer.
* Добавлены сведения об ошибках Observer:
  * Если операции с Observer прерываются из-за исключения, вызванного ProcessChangesAsync, CloseAsync получит параметр reason с заданным значением ChangeFeedObserverCloseReason.ObserverError.
  * Добавлены трассировки для выявления ошибок в пользовательском коде в Observer.

### <a name="225"></a><a name="2.2.5"></a>2.2.5
* Добавлена поддержка обработки разбиения коллекций, использующих пропускную способность общей базы данных.
  * В этом выпуске устранена такая проблема: во время разбиения коллекций с использованием пропускной способности общей базы данных происходило перераспределение разделов с созданием только одного диапазона ключей дочернего элемента (а не двух). В таких ситуациях обработчик канала изменений может зависнуть, удаляя аренду для старого диапазона ключей раздела и не создавая новые аренды. В этом выпуске эта проблема исправлена.

### <a name="224"></a><a name="2.2.4"></a>2.2.4
* Добавлено новое свойство ChangeFeedProcessorOptions.StartContinuation для включения поддержки при запуске канала изменений из маркера продолжения запроса. Используется, только если возвращается пустая коллекция аренды или для аренды не настроен параметр ContinuationToken. Для аренды в коллекции аренды с настроенным и используемым параметром ContinuationToken свойство ChangeFeedProcessorOptions.StartContinuation игнорируется.

### <a name="223"></a><a name="2.2.3"></a>2.2.3
* Добавлена поддержка пользовательского хранилища для хранения маркеров продолжения для секций.
  * Например, хранилище пользовательской аренды может быть коллекцией аренд Azure Cosmos DB, секционированной любым способом.
  * Хранилища пользовательских аренд могут использовать новый общедоступный интерфейс ILeaseStoreManager и свойство ChangeFeedProcessorBuilder.WithLeaseStoreManager(ILeaseStoreManager) точки расширяемости.
  * Для интерфейса ILeaseManager выполнен рефакторинг в нескольких интерфейсах роли.
* Незначительное критическое изменение: удалено свойство точки расширяемости ChangeFeedProcessorBuilder.WithLeaseManager(ILeaseManager). Вместо этого используйте свойство ChangeFeedProcessorBuilder.WithLeaseStoreManager(ILeaseStoreManager).

### <a name="222"></a><a name="2.2.2"></a>2.2.2
* Этот выпуск устраняет проблему, которая происходит во время обработки разбиения в отслеживаемой коллекции и использования секционированной коллекции аренд. При обработке аренды для разбиения секций, аренда, соответствующая этой секции, не будет удалена. В этом выпуске эта проблема исправлена.

### <a name="221"></a><a name="2.2.1"></a>2.2.1
* Исправлено вычисление оценки для учетных записей с несколькими источниками и нового формата токена сеанса.

### <a name="220"></a><a name="2.2.0"></a>2.2.0
* Добавлена поддержка для секционированных коллекций аренд. Ключ секции должен быть определен как /id.
* Небольшое критическое изменение: методы интерфейса IChangeFeedDocumentClient и класса ChangeFeedDocumentClient были изменены для включения параметров RequestOptions и CancellationToken. IChangeFeedDocumentClient представляет собой точку расширяемости с дополнительными возможностями, которая позволяет создавать собственную реализацию клиента документов, которая будет использоваться с обработчиком канала изменений, например декорировать клиент документов и перехватывать все вызовы к нему для дополнительной трассировки, обработки ошибок и т. д. После этого обновления в код, который реализует IChangeFeedDocumentClient, необходимо будет включить новые параметры.
* Незначительные улучшения системы диагностики.

### <a name="210"></a><a name="2.1.0"></a>2.1.0
* Добавлен новый API, Task&lt;IReadOnlyList&lt;RemainingPartitionWork&gt;&gt; IRemainingWorkEstimator.GetEstimatedRemainingWorkPerPartitionAsync(). Его можно использовать для получения оценки работ для каждого раздела.
* Поддерживает Microsoft.Azure.DocumentDB SDK 2.0. Требуется Microsoft.Azure.DocumentDB 2.0 или более поздней версии.

### <a name="206"></a><a name="2.0.6"></a>2.0.6
* Добавлено общедоступное свойство ChangeEventHost.HostName для совместимости с версией 1.

### <a name="205"></a><a name="2.0.5"></a>2.0.5
* Исправлено состояние гонки, которое возникло во время разделения секций. Состояние гонки может привести к получению аренды и немедленной потере права на нее при разделении секций, а также привести к состязанию. Проблема с состоянием гонки исправлена в этом выпуске.

### <a name="204"></a><a name="2.0.4"></a>2.0.4
* Пакет SDK общей доступности.

### <a name="203-prerelease"></a><a name="2.0.3-prerelease"></a>2.0.3-prerelease
* Исправлены следующие ошибки:
  * При разделении секции может дублироваться обработка документов, созданных до разделения.
  * API GetEstimatedRemainingWork возвратил 0 при отсутствии аренды в коллекции.

* Приведенные ниже исключения сделаны общедоступными. Расширения, реализующие IPartitionProcessor, могут выдавать эти исключения.
  * Microsoft.Azure.Documents.ChangeFeedProcessor.Exceptions.LeaseLostException. 
  * Microsoft.Azure.Documents.ChangeFeedProcessor.Exceptions.PartitionException. 
  * Microsoft.Azure.Documents.ChangeFeedProcessor.Exceptions.PartitionNotFoundException.
  * Microsoft.Azure.Documents.ChangeFeedProcessor.Exceptions.PartitionSplitException. 

### <a name="202-prerelease"></a><a name="2.0.2-prerelease"></a>Предварительный выпуск 2.0.2:
* Незначительные изменения в API:
  * Удаление ChangeFeedProcessorOptions.IsAutoCheckpointEnabled как устаревшего.

### <a name="201-prerelease"></a><a name="2.0.1-prerelease"></a>2.0.1-prerelease
* Улучшения стабильности:
  * Улучшение обработки при инициализации хранилища аренды. Если хранилище аренды пустое, инициализировать его может только один экземпляр обработчика. Остальные будут находиться в состоянии ожидания.
  * Более стабильное и эффективное обновление и освобождение аренды. Обновление и освобождение аренды одной секции не зависит от обновления других. В версии 1 процедура последовательно выполнялась для всех секций.
* Новый API версии 2:
  * Шаблон построителя для повышения гибкости при создании процессора: класс ChangeFeedProcessorBuilder.
    * Может принимать любое сочетание параметров.
    * Может принимать экземпляр DocumentClient для мониторинга и (или) коллекции аренды (недоступно в версии 1).
  * IChangeFeedObserver.ProcessChangesAsync теперь принимает CancellationToken.
  * IRemainingWorkEstimator — средство оценки оставшихся трудозатрат можно использовать отдельно от процессора.
  * Новые точки расширяемости:
    * IPartitionLoadBalancingStrategy — для пользовательской балансировки нагрузки в секциях между экземплярами процессора.
    * ILease, ILeaseManager — для пользовательского управления арендой.
    * IPartitionProcessor — для пользовательского обработки изменений в секции.
* Для ведения журнала используется библиотека [LibLog](https://github.com/damianh/LibLog).
* Полная обратная совместимость с API версии 1.
* Новая база кода.
* Совместимость с [пакетом SDK .NET для SQL](sql-api-sdk-dotnet.md) версии 1.21.1 и выше.

### <a name="v1-builds"></a>Сборки версии 1

### <a name="133"></a><a name="1.3.3"></a>1.3.3
* В журнал записываются дополнительные сведения.
* Исправлена утечка DocumentClient при неоднократном вызове оценки работы в режиме ожидания.

### <a name="132"></a><a name="1.3.2"></a>1.3.2
* Исправления в оценке работы в режиме ожидания.

### <a name="131"></a><a name="1.3.1"></a>1.3.1
* Улучшение стабильности.
  * Устранена проблема с отмененными задачами, которая могла вызывать остановку работы наблюдателей в некоторых секциях.
* Поддержка использования контрольных точек вручную.
* Совместимость с [пакетом SDK .NET для SQL](sql-api-sdk-dotnet.md) версии 1.21 и выше.

### <a name="120"></a><a name="1.2.0"></a>1.2.0
* Добавляет поддержку .NET Standard 2.0. Теперь пакет поддерживает моникеры платформ `netstandard2.0` и `net451`.
* Совместимость с [пакетом SDK для .NET для SQL](sql-api-sdk-dotnet.md) версии 1.17.0 и более поздних версий.
* Совместимость с [пакетом SDK для .NET Core для SQL](sql-api-sdk-dotnet-core.md) версии 1.5.1 и более поздних версий.

### <a name="111"></a><a name="1.1.1"></a>1.1.1
* Устраняет проблему при расчете оставшейся работы, если канал изменений был пуст или никакие действия не ожидались.
* Совместимость с [пакетом SDK для .NET для SQL](sql-api-sdk-dotnet.md) версии 1.13.2 и более поздних версий.

### <a name="110"></a><a name="1.1.0"></a>1.1.0
* Добавлен метод для оценки оставшейся работы для обработки в веб-канале изменений.
* Совместимость с [пакетом SDK для .NET для SQL](sql-api-sdk-dotnet.md) версии 1.13.2 и более поздних версий.

### <a name="100"></a><a name="1.0.0"></a>1.0.0
* Пакет SDK общей доступности.
* Совместимость с [пакетом SDK для .NET для SQL](sql-api-sdk-dotnet.md) версии 1.14.1 и более ранних версий.

## <a name="release--retirement-dates"></a>Даты выпуска и выбытия

Корпорация Майкрософт отправит уведомление минимум за **12 месяцев** до вывода пакета SDK из эксплуатации, чтобы обеспечить более плавный переход на новую или поддерживаемую версию.

Новые функции, возможности и оптимизации добавляются только в текущую версию пакета SDK, поэтому рекомендуется как можно раньше обновлять пакет SDK до последней версии. 

Любые запросы к Cosmos DB с помощью выведенного из эксплуатации пакета SDK будут отклонены службой.

<br/>

| Версия | Дата выпуска | Дата вывода |
| --- | --- | --- |
| [2.3.0](#2.3.0) |2 апреля 2020 г. |--- |
| [2.2.8](#2.2.8) |28 октября 2019 г. |--- |
| [2.2.7](#2.2.7) |14 мая 2019 г. |--- |
| [2.2.6](#2.2.6) |29 января 2019 г. |--- |
| [2.2.5](#2.2.5) |13 декабря 2018 г. |--- |
| [2.2.4](#2.2.4) |29 ноября 2018 г. |--- |
| [2.2.3](#2.2.3) |19 ноября 2018 г. |--- |
| [2.2.2](#2.2.2) |31 октября 2018 г. |--- |
| [2.2.1](#2.2.1) |24 октября 2018 г. |--- |
| [1.3.3](#1.3.3) |8 мая 2018 г. |--- |
| [1.3.2](#1.3.2) |18 апреля 2018 г. |--- |
| [1.3.1](#1.3.1) |13 марта 2018 г. |--- |
| [1.2.0](#1.2.0) |31 октября 2017 г. |--- |
| [1.1.1](#1.1.1) |29 августа 2017 г. |--- |
| [1.1.0](#1.1.0) |13 августа 2017 г. |--- |
| [1.0.0](#1.0.0) |7 июля 2017 г. |--- |

## <a name="faq"></a>ВОПРОСЫ И ОТВЕТЫ

[!INCLUDE [cosmos-db-sdk-faq](../../includes/cosmos-db-sdk-faq.md)]

## <a name="see-also"></a>См. также раздел

Дополнительные сведения о Cosmos DB см. на странице службы [Microsoft Azure Cosmos DB](https://azure.microsoft.com/services/cosmos-db/).
