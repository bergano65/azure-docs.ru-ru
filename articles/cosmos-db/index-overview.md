---
title: Индексирование в Azure Cosmos DB
description: Сведения об осуществлении индексации в Azure Cosmos DB.
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 11/10/2018
ms.author: mjbrown
ms.openlocfilehash: c0525cfba16fb61f8388ae4d6a693be3bb71674c
ms.sourcegitcommit: 1f9e1c563245f2a6dcc40ff398d20510dd88fd92
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2018
ms.locfileid: "51628761"
---
# <a name="indexing-in-azure-cosmos-db"></a>Индексирование в Azure Cosmos DB

Azure Cosmos DB — это база данных без использования схем, которая позволяет выполнять итерацию приложения, не отвлекаясь на управление схемами или индексами. По умолчанию Azure Cosmos DB автоматически индексирует все элементы в контейнере. И разработчикам не нужно создавать схемы или вторичные индексы.

## <a name="items-as-trees"></a>Элементы в виде деревьев

Azure Cosmos DB проецирует элементы в контейнер в виде документов JSON и представляет их в виде деревьев, нормализуя структуру и значения экземпляров для всех элементов по принципу  **структуры динамически закодированного пути**. В этом представлении каждая метка документа JSON, который содержит имена и значения свойств, становится узлом дерева. Концевые элементы этого дерева содержат фактические значения, а промежуточные узлы предоставляют сведения о схеме. На следующем рисунке представлены деревья для двух элементов (1 и 2) в контейнере:

![Древовидное представление двух разных элементов, размещенных в контейнере Azure Cosmos](./media/index-overview/indexing-as-tree.png)

Корневой псевдоузел создается в качестве родительского для реальных узлов, которые соответствуют меткам в базовом документе. Вложенные структуры данных определяют иерархию этого дерева. На среднем уровне создаются искусственные узлы с числовыми значениями (0, 1 и т. д.) для представления перечислений и индексов массивов.

## <a name="index-paths"></a>Пути индекса

Azure Cosmos DB представляет элементы в виде документов JSON, а индексы в виде деревьев. Вы можете настраивать политики для путей в этом дереве. Для разных путей можно включать и отключать индексирование. Такой подход может обеспечить повышение производительности при записи и понижение требований к хранилищу индексов в тех случаях, когда шаблоны запросов известны заранее. Дополнительные сведения см. в статье [о путях индексов](index-paths.md).

## <a name="indexing-under-the-hood"></a>Внутренние механизмы индексирования

База данных Azure Cosmos применяет автоматическое индексирование данных, то есть индексируется каждый путь в дереве, который вы не исключили явным образом.

База данных Azure Cosmos использует для индексов инвертированную структуру данных, сохраняя сведения о каждом элементе и повышая эффективность их представления для запросов. Дерево индексов представляет собой документ, созданный путем объединения всех деревьев, представляющих отдельные элементы в контейнере. Это дерево индексов со временем увеличивается по мере добавления новых и (или) обновления существующих элементов в контейнере. В отличие от индексирования в реляционной базе данных, Azure Cosmos DB не запускает этот процесс с нуля при добавлении новых полей, а просто добавляет новые элементы в существующую структуру. 

Каждый узел в дереве индексов соответствует одной записи индекса, которая содержит значения метки и положения (термин) и идентификаторы элементов (разноски). Разноски, показанные на изображении инвертированного индекса в фигурных скобках (например, так: {1,2}), соответствуют тем элементам, которые содержат определенное значение метки (например, Document1 и Document2). При использовании единого подхода к меткам схемы и значениям экземпляров достигается важное преимущество: все содержимое упаковано в один большой индекс. Значение экземпляра, которое сохраняется в концевых элементах, никогда не дублируется. Оно может выполнять разные роли в разных элементах с разными метками схемы, но это всегда одно и то же значение. На следующем рисунке показан пример инвертированного индексирования для разных элементов:

![Внутренние механизмы индексирования с использованием инвертированного индекса](./media/index-overview/inverted-index.png)

> [!NOTE]
> Инвертированный индекс очень похож на структуры индексирования, которые используются в поисковых системах в сфере сбора информации. Применение этого метода позволяет Azure Cosmos DB находить в базе данных любой элемент, независимо от структуры его схемы.

Чтобы получить нормализованный путь, индекс кодирует весь прямой путь (от корня к нужному значению) и сведения о типе значения. Закодированные путь и значение обеспечивают разные типы индексирования, например по диапазонам и пространственным типам. Кодирование значений выполняется так, чтобы получить уникальные значения или сочетания для набора путей.

## <a name="querying-with-indexes"></a>Выполнение запросов с использованием индексов

Инвертированный индекс позволяет посредством запроса быстро определять документы, соответствующие предикату запроса. Так как инвертированный индекс использует при создании путей одинаковый подход к схеме и значениям экземпляров, он также представляет собой дерево. Это позволяет сериализовать индекс и результаты в допустимый документ JSON и возвращать его вместе с нужными документами в представлении дерева. Такой метод поддерживает рекурсию по результатам для дополнительных запросов. На следующем рисунке показан пример индексирования для точечного запроса:  

![Пример точечного запроса](./media/index-overview/index-point-query.png)

Для запроса в диапазоне используется определяемая пользователем функция GermanTax, которая выполняется при обработке запросов. Определяемой пользователем функцией может быть любая зарегистрированная функция Javascript, которая добавит в запрос расширенную логику программирования. На следующем рисунке показан пример индексирования для запроса в диапазоне:

![Пример запроса в диапазоне](./media/index-overview/index-range-query.png)

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения об индексировании вы найдете в следующих статьях.

- [Политика индексирования](index-policy.md)
- [Типы индексов](index-types.md)
- [Пути индексов](index-paths.md)
- [Управление политикой индексирования](how-to-manage-indexing-policy.md)