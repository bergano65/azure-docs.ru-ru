---
title: Предложение ORDER BY в Azure Cosmos DB
description: Дополнительные сведения о предложении SQL ORDER BY для Azure Cosmos DB. Используйте SQL в качестве языка запросов JSON Azure Cosmos DB.
author: timsander1
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 06/06/2020
ms.author: tisande
ms.openlocfilehash: c4ae66884602989284a427bdc33de7612bd9a8df
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "84484326"
---
# <a name="order-by-clause-in-azure-cosmos-db"></a>Предложение ORDER BY в Azure Cosmos DB

Необязательное `ORDER BY` предложение задает порядок сортировки результатов, возвращаемых запросом.

## <a name="syntax"></a>Синтаксис
  
```sql  
ORDER BY <sort_specification>  
<sort_specification> ::= <sort_expression> [, <sort_expression>]  
<sort_expression> ::= {<scalar_expression> [ASC | DESC]} [ ,...n ]  
```  

## <a name="arguments"></a>Аргументы
  
- `<sort_specification>`  
  
   Указывает свойство или выражение, по которому производится сортировка результирующего набора запроса. Столбец сортировки может быть указан как имя или псевдоним свойства.  
  
   Можно указать несколько свойств. Имена свойств должны быть уникальными. Последовательность свойств сортировки в `ORDER BY` предложении определяет организацию отсортированного результирующего набора. То есть результирующий набор сортируется по первому свойству, а затем упорядоченный список сортируется по второму свойству и т. д.  
  
   Имена свойств, упоминаемых в `ORDER BY` предложении, должны соответствовать свойству в списке выбора или к свойству, определенному в коллекции, указанной в `FROM` предложении, без каких-либо неоднозначностей.  
  
- `<sort_expression>`  
  
   Задает одно или несколько свойств или выражений для сортировки результирующего набора запроса.  
  
- `<scalar_expression>`  
  
   Дополнительные сведения см. в разделе [Скалярные выражения](sql-query-scalar-expressions.md).  
  
- `ASC | DESC`  
  
   Указывает порядок сортировки значений в указанном столбце — по возрастанию или по убыванию. `ASC` Сортировка от наименьшего значения до самого высокого. `DESC` Сортировка от самого высокого значения к наименьшему значению. `ASC` порядок сортировки по умолчанию. Значения NULL рассматриваются как минимально возможные значения.  
  
## <a name="remarks"></a>Remarks  
  
   `ORDER BY`Для предложения требуется, чтобы политика индексирования включала индекс для полей, для которых выполняется сортировка. Среда выполнения запросов Azure Cosmos DB поддерживает сортировку по имени свойства, а не к вычисленным свойствам. Azure Cosmos DB поддерживает несколько `ORDER BY` свойств. Чтобы выполнить запрос с несколькими свойствами ORDER BY, необходимо определить [составной индекс](index-policy.md#composite-indexes) для полей, для которых выполняется сортировка.

> [!Note]
> Если свойства, для которых выполняется сортировка, могут быть неопределенными для некоторых документов и вы хотите получить их в запросе ORDER BY, необходимо явно включить этот путь в индекс. Политика индексирования по умолчанию не допускает получение документов, в которых свойство Sort не определено. [Ознакомьтесь с примерами запросов к документам с некоторыми отсутствующими полями](#documents-with-missing-fields).

## <a name="examples"></a>Примеры

Например, Вот запрос, извлекающий семейства в порядке возрастания названия резидентного города:

```sql
    SELECT f.id, f.address.city
    FROM Families f
    ORDER BY f.address.city
```

Вы получите такие результаты:

```json
    [
      {
        "id": "WakefieldFamily",
        "city": "NY"
      },
      {
        "id": "AndersenFamily",
        "city": "Seattle"
      }
    ]
```

Следующий запрос получает семейство `id` s в порядке их даты создания элемента. Элемент `creationDate` — это число, представляющее *время эпохи*или затраченное время с января по 1, 1970 в секундах.

```sql
    SELECT f.id, f.creationDate
    FROM Families f
    ORDER BY f.creationDate DESC
```

Вы получите такие результаты:

```json
    [
      {
        "id": "WakefieldFamily",
        "creationDate": 1431620462
      },
      {
        "id": "AndersenFamily",
        "creationDate": 1431620472
      }
    ]
```

Кроме того, можно упорядочить по нескольким свойствам. Запрос, который упорядочивается по нескольким свойствам, требует [составного индекса](index-policy.md#composite-indexes). Обратите внимание на следующий запрос:

```sql
    SELECT f.id, f.creationDate
    FROM Families f
    ORDER BY f.address.city ASC, f.creationDate DESC
```

Этот запрос получает семейство `id` в порядке возрастания названия города. Если несколько элементов имеют одинаковое название города, запрос будет упорядочен по `creationDate` убыванию.

## <a name="documents-with-missing-fields"></a>Документы с отсутствующими полями

Запросы с `ORDER BY` , которые выполняются для контейнеров с политикой индексирования по умолчанию, не возвращают документы, в которых свойство Sort не определено. Если вы хотите включить документы, в которых свойство Sort не определено, следует явно включить это свойство в политику индексирования.

Например, ниже приведен контейнер с политикой индексирования, которая не содержит никаких путей явно `"/*"` .

```json
{
    "indexingMode": "consistent",
    "automatic": true,
    "includedPaths": [
        {
            "path": "/*"
        }
    ],
    "excludedPaths": []
}
```

При выполнении запроса, включающего `lastName` в `Order By` предложение, результаты будут содержать только те документы, для которых `lastName` определено свойство. Мы не определили явный включаемый путь для `lastName` , так что любые документы без a `lastName` не будут отображаться в результатах запроса.

Ниже приведен запрос, который сортирует по `lastName` двум документам, один из которых не `lastName` определен:

```sql
    SELECT f.id, f.lastName
    FROM Families f
    ORDER BY f.lastName
```

Результаты включают только документ с определенными `lastName` :

```json
    [
        {
            "id": "AndersenFamily",
            "lastName": "Andersen"
        }
    ]
```

Если мы обновляем политику индексирования контейнера, чтобы явно включить в нее путь `lastName` , в результатах запроса будут включены документы со свойством неопределенной сортировки. Необходимо явно определить путь, который будет приводить к этому скалярному значению (а не за его пределами). Необходимо использовать `?` символ в определении пути в политике индексирования, чтобы обеспечить явное индексирование свойства `lastName` и отсутствие дополнительных вложенных путей. Если в `Order By` запросе используется [составной индекс](index-policy.md#composite-indexes), результаты будут всегда содержать документы с неопределенным свойством Sort в результатах запроса.

Ниже приведен пример политики индексации, которая позволяет использовать в результатах запроса документы с неопределенными данными `lastName` :

```json
{
    "indexingMode": "consistent",
    "automatic": true,
    "includedPaths": [
        {
            "path": "/lastName/?"
        },
        {
            "path": "/*"
        }
    ],
    "excludedPaths": []
}
```

Если выполнить тот же запрос снова, `lastName` в результатах запроса будут отображаться отсутствующие документы:

```sql
    SELECT f.id, f.lastName
    FROM Families f
    ORDER BY f.lastName
```

Вы получите такие результаты:

```json
[
    {
        "id": "WakefieldFamily"
    },
    {
        "id": "AndersenFamily",
        "lastName": "Andersen"
    }
]
```

Если изменить порядок сортировки на `DESC` , отсутствующие документы `lastName` будут отображаться в результатах запроса последними:

```sql
    SELECT f.id, f.lastName
    FROM Families f
    ORDER BY f.lastName DESC
```

Вы получите такие результаты:

```json
[
    {
        "id": "AndersenFamily",
        "lastName": "Andersen"
    },
    {
        "id": "WakefieldFamily"
    }
]
```

> [!Note]
> Только пакет SDK для .NET версии 3.4.0 или более поздней поддерживает СОРТИРОВКу с использованием смешанных типов. Поэтому, если требуется выполнить сортировку по сочетанию неопределенных и определенных значений, следует использовать эту версию (или более позднюю).

Нельзя управлять порядком, в результатах которого отображаются разные типы. В приведенном выше примере мы показали, как неопределенные значения были отсортированы перед строковыми значениями. Например, если вместо этого требуется более полный контроль над порядком сортировки неопределенных значений, можно присвоить любому неопределенному свойству строковое значение "ааааааааа" или "зззззззз", чтобы убедиться, что они были либо первыми, либо последними.

## <a name="next-steps"></a>Дальнейшие действия

- [Начало работы](sql-query-getting-started.md)
- [Indexing policy in Azure Cosmos DB](index-policy.md) (Политики индексации в Azure Cosmos DB)
- [Предложение ЛИМИТа смещения](sql-query-offset-limit.md)
