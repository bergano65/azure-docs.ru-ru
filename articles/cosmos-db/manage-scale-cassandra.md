---
title: Эластичное масштабирование с помощью API Cassandra в Azure Cosmos DB
description: Сведения о параметрах, доступных для масштабирования учетной записи API Cassandra в Azure Cosmos DB, и их преимуществах и недостатках
author: TheovanKraay
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 07/29/2020
ms.author: thvankra
ms.openlocfilehash: cbd5dbd81cf8cda117447a15d4a73ae8a546f181
ms.sourcegitcommit: 3bcce2e26935f523226ea269f034e0d75aa6693a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2020
ms.locfileid: "92482525"
---
# <a name="elastically-scale-an-azure-cosmos-db-cassandra-api-account"></a>Эластичное масштабирование учетной записи API Cassandra в Azure Cosmos DB

Существует множество вариантов для изучения эластичного характера API для Cassandra в Azure Cosmos DB. Чтобы понять, как выполнять эффективное масштабирование в Azure Cosmos DB, важно знать, как подготовить правильное число единиц запросов (ЕЗ/с), чтобы соответствовать требованиям к производительности в системе. Дополнительные сведения о единицах запроса см. в [этой статье](request-units.md). 

Для API Cassandra вы можете получить сведения о расходуемых единицах запросов для отдельных запросов с помощью [.NET и пакетов SDK для Java](./find-request-unit-charge-cassandra.md). Это может оказаться полезным при определении числа ЕЗ/с для подготовки в службе.

:::image type="content" source="./media/request-units/request-units.png" alt-text="Операции с базой данных потребляют единицы запроса" border="false":::

## <a name="handling-rate-limiting-429-errors"></a>Обработка ограничения частоты (429 ошибок)

Azure Cosmos DB возвращает ограниченные по частоте ошибки (429), если клиенты потребляют больше ресурсов (ЕЗ/с), чем подготовлено. API Cassandra в Azure Cosmos DB преобразует эти исключения в ошибки перегрузки в собственном протоколе Cassandra. 

Если система не чувствительна к задержке, может быть достаточно обработать ограничение частоты пропускной способности, выполнив повторные попытки. Сведения о том, как прозрачно обрабатывать ограничение частоты с помощью [расширения Azure Cosmos DB](https://github.com/Azure/azure-cosmos-cassandra-extensions) для [политики повтора Cassandra](https://docs.datastax.com/en/developer/java-driver/4.4/manual/core/retries/) в Java, см. в [примере кода Java](https://github.com/Azure-Samples/azure-cosmos-cassandra-java-retry-sample). Для обработки ограничения по частоте можно также использовать [расширение Spark](https://mvnrepository.com/artifact/com.microsoft.azure.cosmosdb/azure-cosmos-cassandra-spark-helper).

## <a name="manage-scaling"></a>Управление масштабированием

Если необходимо уменьшить задержку, существует ряд вариантов управления масштабированием и подготовки пропускной способности (ЕЗ) в API Cassandra:

* [вручную с помощью портала Azure](#use-azure-portal);
* [программным образом, используя функции уровня управления](#use-control-plane);
* [программным образом, используя команды CQL с конкретным пакетом SDK](#use-cql-queries);
* [динамически с помощью автомасштабирования](#use-autoscale).

В следующих разделах объясняются преимущества и недостатки каждого из подходов. Затем вы можете выбрать оптимальную стратегию, чтобы сбалансировать потребности в масштабировании системы, общую стоимость и эффективность решения.

## <a name="use-the-azure-portal"></a><a id="use-azure-portal"></a>Использование портала Azure

Вы можете масштабировать ресурсы в учетной записи API Cassandra в Azure Cosmos DB с помощью портала Azure. Дополнительные сведения см. в статье [Обеспечение необходимой пропускной способности для контейнеров и баз данных](set-throughput.md). В этой статье объясняются относительные преимущества настройки пропускной способности на уровне [базы данных](set-throughput.md#set-throughput-on-a-database) или [контейнера](set-throughput.md#set-throughput-on-a-container) на портале Azure. Термины "база данных" и "контейнер", упомянутые в этих статьях, сопоставляются с "пространством ключей" и "таблицей" для API Cassandra.

Преимущество этого метода заключается в том, что он является прямым комплексным способом управления пропускной способностью в базе данных. Однако недостатком является то, что во многих случаях для выполнения масштабирования может потребоваться как экономичность, так и высокая производительность определенных уровней автоматизации. В следующих разделах описаны соответствующие сценарии и методы.

## <a name="use-the-control-plane"></a><a id="use-control-plane"></a>Использование уровня управления

API Azure Cosmos DB для Cassandra обеспечивает возможность программной настройки пропускной способности с помощью различных функций уровня управления. Инструкции и примеры см. в статьях об [Azure Resource Manager](./templates-samples-cassandra.md), [PowerShell](powershell-samples.md) и [Azure CLI](cli-samples.md).

Преимущество этого метода заключается в том, что вы можете автоматизировать масштабирование ресурсов на основе таймера, чтобы учитывать пиковую активность или периоды низкой активности. Рассмотрим наш пример [здесь](https://github.com/Azure-Samples/azure-cosmos-throughput-scheduler), чтобы узнать, как это сделать с помощью Функций Azure и PowerShell.

Недостатком этого подхода может быть то, что вы не сможете среагировать на непредсказуемо изменяющиеся потребности в масштабировании в режиме реального времени. Вместо этого может потребоваться использовать контекст приложения в системе на уровне клиента или пакета SDK или использовать [автомасштабирование](provision-throughput-autoscale.md).

## <a name="use-cql-queries-with-a-specific-sdk"></a><a id="use-cql-queries"></a>Использование запросов QL с конкретным пакетом SDK

Вы можете динамически масштабировать систему с помощью кода, выполняя [команды CQL ALTER](cassandra-support.md#keyspace-and-table-options) для определенных базы данных или контейнера.

Преимущество такого подхода заключается в том, что он позволяет вам отвечать на запросы масштабирования динамически и в соответствии с вашими настройками, которые подходят для приложения. При таком подходе к вам по-прежнему будет применяться стандартная тарификация за ЕЗ/с. Если потребности в масштабировании системы в основном являются прогнозируемыми (около 70 % или более), использование пакета SDK с CQL может оказаться более экономично выгодным методом автоматического масштабирования по сравнению с использованием автомасштабирования. Недостаток этого подхода заключается в том, что реализация повторных попыток может быть довольно сложной, а ограничение по частоте может увеличить задержку.

## <a name="use-autoscale-provisioned-throughput"></a><a id="use-autoscale"></a>Использование подготовленной пропускной способности автомасштабирования

Помимо стандартного (ручного) или программного способа подготовки пропускной способности, можно также настроить контейнеры Cosmos для Azure с помощью подготовленной пропускной способности автомасштабирования. Функция автомасштабирования автоматически и мгновенно выполняет масштабирование в соответствии с потребностями в рамках указанных диапазонов единиц запросов, не нарушая соглашения об уровне обслуживания. Дополнительные сведения см. в статье о [создании контейнеров и баз данных Azure Cosmos с помощью автомасштабирования](provision-throughput-autoscale.md).

Преимущество такого подхода заключается в том, что это самый простой способ учитывать потребности в масштабировании системы. Ограничение скорости не будет применяться **в пределах настроенных диапазонов единиц**. Недостатком является то, что, если потребности в масштабировании системы предсказуемы, автомасштабирование может оказаться менее экономично выгодным способом для соответствия потребностей в масштабировании, чем использование собственных уровней управления или пакета SDK, описанных выше.

Чтобы задать или изменить максимальную пропускную способность (ЕЗ) для автомасштабирования с помощью CQL, выполните следующую команду (заменяя имя пространства ключей/таблицы соответствующим образом):

```Bash
# to set max throughput (RUs) for autoscale at keyspace level:
create keyspace <keyspace name> WITH cosmosdb_autoscale_max_throughput=5000;

# to alter max throughput (RUs) for autoscale at keyspace level:
alter keyspace <keyspace name> WITH cosmosdb_autoscale_max_throughput=4000;

# to set max throughput (RUs) for autoscale at table level:
create table <keyspace name>.<table name> (pk int PRIMARY KEY, ck int) WITH cosmosdb_autoscale_max_throughput=5000;

# to alter max throughput (RUs) for autoscale at table level:
alter table <keyspace name>.<table name> WITH cosmosdb_autoscale_max_throughput=4000;
```

## <a name="next-steps"></a>Дальнейшие действия

- Начните с [создания учетной записи API Cassandra, базы данных и таблицы](create-cassandra-api-account-java.md) с помощью приложения Java.