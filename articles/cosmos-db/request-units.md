---
title: Единицы запросов в качестве валюты пропускной способности и производительности в Azure Cosmos DB
description: Сведения о том, как задать и оценить количество необходимых единиц запросов в Azure Cosmos DB
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/23/2020
ms.openlocfilehash: 13644baf197184f6872cce75fd3f9097d2116e79
ms.sourcegitcommit: d767156543e16e816fc8a0c3777f033d649ffd3c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/26/2020
ms.locfileid: "92536391"
---
# <a name="request-units-in-azure-cosmos-db"></a>Единицы запросов в базе данных Azure Cosmos DB

Azure Cosmos DB поддерживает многие интерфейсы API, такие как SQL, MongoDB, Cassandra, Gremlin и Таблицы. У каждого API есть собственный набор операций базы данных, начиная от простого считывания и записи точек и заканчивая сложными запросами. Каждая операция базы данных потребляет системные ресурсы. Потребление зависит от сложности операции.

Затраты на все операции с базами данных нормализованы с помощью Azure Cosmos DB и выражаются *единицами запросов* (или, в качестве коротких). Можно считать, что в качестве валюты производительности разрабатываются системные ресурсы, такие как ЦП, операции ввода-вывода и память, необходимые для выполнения операций с базой данных, поддерживаемых Azure Cosmos DB.

Затраты на чтение точки (т. е. получение одного элемента по его ИДЕНТИФИКАТОРу и значению ключа секции) для элемента размером 1 КБ — 1 единица запроса (или 1 единица запросов). Цены на остальные операции с базой данных выражаются в ЕЗ аналогичным образом. Независимо от того, какие API вы используете для взаимодействия с контейнером Azure Cosmos, затраты всегда измеряются в ЕЗ. Является ли операция базы данных записью, чтением точки или запросом, затраты всегда измеряются в версии-получателей.

Обобщенная схема использования ЕЗ представлена на следующем изображении.

:::image type="content" source="./media/request-units/request-units.png" alt-text="Операции с базой данных потребляют единицы запроса" border="false":::

Чтобы обеспечить планирование пропускной способности и управление ею, Azure Cosmos DB гарантирует, что количество ЕЗ для операции базы данных над определенным набором данных является детерминированным. Вы можете изучить заголовок ответа, чтобы отслеживать количество ЕЗ, потребляемых любой операцией базы данных. Если вы понимаете [факторы, влияющие на сборы за единицу](request-units.md#request-unit-considerations) и требования к пропускной способности вашего приложения, можно эффективно выполнять ваши приложения.

Тип учетной записи Cosmos Azure, которую вы используете, определяет способ получения счета за использование. Существует три режима, в которых можно создать учетную запись:

1. **Подготовленный режим пропускной способности** . в этом режиме вы предоставляете число получателей для приложения в секунду с шагом в 100 ГБ в секунду. Чтобы масштабировать подготовленную пропускную способность для приложения, можно увеличить или уменьшить число получателей в любое время с шагом в 100 RUs. Это можно сделать программным способом или с помощью портала Azure. Счет выставляется на почасовой основе в течение поддерживаемого объема в секунду. Дополнительные сведения см. в статье [подготовленная пропускная способность](set-throughput.md) .

   Вы можете обеспечить пропускную способность с помощью двух различных уровней детализаций:

   * **Контейнеры** . Дополнительные сведения см. [в статье о подготовке пропускной способности в контейнере Azure Cosmos](how-to-provision-container-throughput.md).
   * **Базы данных** . Дополнительные сведения см. [в статье о подготовке пропускной способности в базе данных Azure Cosmos](how-to-provision-database-throughput.md).

2. **Режим без сервера** . в этом режиме вам не нужно подготавливать пропускную способность при создании ресурсов в учетной записи Azure Cosmos. По окончании расчетного периода вы получаете счет за количество единиц запросов, использованных операциями базы данных. Дополнительные сведения см. в статье [пропускная способность бессерверных](serverless.md) операций. 

3. **Режим автомасштабирования** . в этом случае можно автоматически и мгновенно масштабировать пропускную способность (единиц запросов в секунду) базы данных или контейнера на основе их использования, не влияя на доступность, задержку, пропускную способность или производительность рабочей нагрузки. Этот режим хорошо подходит для критически важных рабочих нагрузок с переменными или непредсказуемыми шаблонами трафика и требует соглашения об уровне обслуживания для высокой производительности и масштабирования. Дополнительные сведения см. в статье о [пропускной способности автомасштабирования](provision-throughput-autoscale.md) . 

## <a name="request-unit-considerations"></a>Рекомендации по оценке необходимого количества единиц запросов

При оценке количества получателей, потребляемых рабочей нагрузкой, учитывайте следующие факторы.

* **Размер элемента** . По мере увеличения размера элемента число ЕЗ, потребляемое для чтения или записи элемента, также увеличивается.

* **Индексация элемента** . По умолчанию каждый элемент индексируется автоматически. Если вы решили не индексировать некоторые элементы в контейнере, потребляется меньше ЕЗ.

* **Количество свойств элемента** . Предполагая, что индексирование выполняется по умолчанию для всех свойств, количество ЕЗ, потребляемых для записи элемента, увеличивается по мере увеличения количества свойств элемента.

* **Индексируемые свойства** . Свойства, которые индексируются по умолчанию, определяются политикой индексирования для каждого контейнера. Чтобы сократить потребление ЕЗ в операциях записи, ограничьте количество индексированных свойств.

* **Согласованность данных** . уровни согласованности строгого и ограниченного устаревания требуют примерно в два раза больше, чем при выполнении операций чтения, по сравнению с другими ослабленными уровнями согласованности.

* **Тип операций чтения** : стоимость чтения точек значительно меньше, чем количество запросов.

* **Шаблоны запросов** . Сложность запроса влияет на количество ЕЗ, потребляемых операцией. Факторы, которые влияют на стоимость операций запросов: 
 
  * Количество результатов запроса.
  * Количество предикатов.
  * Характер предикатов.
  * Количество определяемых пользователем функций.
  * Размер исходных данных.
  * Размер результирующего набора.
  * Проекции.

  Один и тот же запрос для одних и тех же данных всегда будет иметь одинаковое количество запросов на повторные выполнения.

* **Использование скриптов** : как и в случае с запросами, хранимые процедуры и триггеры используют в базе данных, которая усложняет выполнение операций. При разработке приложения проверяйте [заголовки со стоимостью запросов](./optimize-cost-reads-writes.md#measuring-the-ru-charge-of-a-request), чтобы лучше понять, как ресурсы производительности используются каждой из операций.

## <a name="request-units-and-multiple-regions"></a>Единицы запросов и несколько регионов

Если вы подготавливаете *"r '* RUS в контейнере Cosmos (или базе данных), Cosmos DB гарантирует доступность *r* в *каждом* регионе, связанном с вашей учетной записью Cosmos. Нельзя выборочно назначать ЕЗ для определенного региона. Объект RUs, подготовленный для контейнера Cosmos (или базы данных), подготавливается во всех регионах, связанных с вашей учетной записью Cosmos.

При условии, что для контейнера Cosmos настроено значение *R* , а с учетной записью Cosmos связано *"N"* регионов, общее число получателей, доступных глобально в контейнере = *R* x *N* .

Выбранная [Модель согласованности](consistency-levels.md) также влияет на пропускную способность. Вы можете получить приблизительно 2,5 пропускную способность чтения для более ослабленных уровней согласованности (например, *сеанса* , *согласованного префикса* и *окончательной* согласованности) по сравнению с более надежными уровнями согласованности (например, *ограниченной устаревания* или *строгой* согласованностью).

## <a name="next-steps"></a>Дальнейшие действия

- Подробнее о [подготовке пропускной способности в контейнерах и базах данных Azure Cosmos](set-throughput.md).
- Дополнительные сведения о [бессерверных Azure Cosmos DB](serverless.md).
- Подробнее о [логических секциях](./partitioning-overview.md).
- Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
- Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).
- Узнайте, как [найти плату за единицу запросов для операции](find-request-unit-charge.md).
- Узнайте, как [оптимизировать стоимость подготовленной пропускной способности в Azure Cosmos DB](optimize-cost-throughput.md).
- Узнайте, как [оптимизировать чтение и запись затрат в Azure Cosmos DB](optimize-cost-reads-writes.md).
- Узнайте, как [оптимизировать стоимость запросов в Azure Cosmos DB](./optimize-cost-reads-writes.md).
- Узнайте, как [использовать метрики для мониторинга пропускной способности](use-metrics.md).