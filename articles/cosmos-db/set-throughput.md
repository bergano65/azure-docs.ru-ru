---
title: Подготовка пропускной способности в контейнерах и базах данных Azure Cosmos
description: Сведения о настройке подготовленной пропускной способности для контейнеров и баз данных Azure Cosmos.
author: markjbrown
ms.author: mjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 11/10/2020
ms.openlocfilehash: 0dc55f4d77fde48590b1fbf206ed988e8fb9ec0e
ms.sourcegitcommit: b4880683d23f5c91e9901eac22ea31f50a0f116f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/11/2020
ms.locfileid: "94490276"
---
# <a name="introduction-to-provisioned-throughput-in-azure-cosmos-db"></a>Общие сведения о подготовленной пропускной способности в Azure Cosmos DB
[!INCLUDE[appliesto-all-apis](includes/appliesto-all-apis.md)]

Azure Cosmos DB дает возможность настроить подготовленную пропускную способность для баз данных и контейнеров. Существуют два типа подготовленной пропускной способности: стандартная (настроенная вручную) и автомасштабируемая. В этой статье приводятся общие сведения о том, как работает подготовленная пропускная способность. 

База данных Azure Cosmos представляет собой единицу управления для набора контейнеров. База данных состоит из набора схемонезависимых контейнеров. Контейнер Azure Cosmos — это единица масштабируемости как для пропускной способности, так и для хранения. Контейнер горизонтально разделяется между набором компьютеров в регионе Azure и распределяется по всем регионам Azure, связанным с учетной записью Azure Cosmos.

В Azure Cosmos DB можно подготовить пропускную способность на уровне двух компонентов:
 
- контейнеры Azure Cosmos;
- базы данных Azure Cosmos.

## <a name="set-throughput-on-a-container"></a>Настройка пропускной способности в контейнере  

Пропускная способность, подготавливаемая для контейнера Azure Cosmos, резервируется исключительно для этого контейнера. Контейнер получает подготовленную пропускную способность постоянно. Финансовой гарантией подготовленной пропускной способности в контейнере являются соглашения об уровне обслуживания. Чтобы узнать, как настроить стандартную пропускную способность (вручную) для контейнера, ознакомьтесь со статьей [Подготовка пропускной способности в контейнере Azure Cosmos](how-to-provision-container-throughput.md). Чтобы узнать, как настроить автомасштабируемую пропускную способность для контейнера, ознакомьтесь с разделом [Подготовка автомасштабируемой пропускной способности](how-to-provision-autoscale-throughput.md).

Настройка подготовленной пропускной способности для контейнера — широко применяемый подход. Вы можете гибко масштабировать пропускную способность для контейнера, подготавливая любой объем пропускной способности с помощью [единиц запроса (ЕЗ)](request-units.md). 

Пропускная способность, подготовленная для контейнера, равномерно распределяется между физическими секциями. Это подразумевает, что применяется эффективный ключ секции, который позволяет равномерно распределить логические секции между физическими секциями. Пропускная способность также равномерно распределяется между всеми логическими секциями контейнера. Невозможно выборочно указать пропускную способность для логических разделов. Так как один логический раздел контейнера или несколько размещаются в физическом разделе, физические разделы относятся исключительно к данному контейнеру и поддерживают пропускную способность, подготовленную для контейнера. 

Если Рабочая нагрузка, запущенная в логической секции, использует больше пропускной способности, выделенной для физической секции, возможно, ваши операции будут ограничены с учетом частоты. Что называется _горячей секцией_ , происходит, когда одна логическая секция имеет непропорциональное количество запросов, чем другие значения ключа секции.

При ограничении скорости можно либо увеличить подготовленную пропускную способность для всего контейнера, либо повторить операцию. Также следует убедиться, что выбран ключ раздела, который равномерно распределяет объем хранилища и запросов. Дополнительные сведения о секционировании см. [в разделе секционирование и горизонтальное масштабирование в Azure Cosmos DB](partitioning-overview.md).

Рекомендуется настроить пропускную способность на уровне гранулярности контейнера, если требуется предсказуемая производительность контейнера.

На следующем рисунке показано, как в физическом разделе размещаются один или несколько логических разделов контейнера.

:::image type="content" source="./media/set-throughput/resource-partition.png" alt-text="Физическая секция, на которой размещена одна или несколько логических секций контейнера" border="false":::

## <a name="set-throughput-on-a-database"></a>Настройка пропускной способности в базе данных

При подготовке пропускной способности для базы данных Azure Cosmos пропускная способность распределяется между всеми контейнерами (называемыми общими контейнерами базы данных) в этой базе данных. Исключением является случай, если вы указали подготовленную пропускную способность для определенных контейнеров в базе данных. Совместное использование пропускной способности, подготовленной на уровне базы данных, ее контейнерами аналогично размещению базы данных в кластере виртуальных машин. Так как все контейнеры в базе данных совместно используют ресурсы, доступные на компьютере, естественно, что для любого конкретного контейнера невозможно обеспечить прогнозируемую производительность. Чтобы узнать, как настроить подготовленную пропускную способность для базы данных, ознакомьтесь со статьей [Подготовка пропускной способности для базы данных в Azure Cosmos DB](how-to-provision-database-throughput.md). Чтобы узнать, как настроить автомасштабируемую пропускную способность для базы данных, ознакомьтесь с разделом [Подготовка автомасштабируемой пропускной способности](how-to-provision-autoscale-throughput.md).

Так как все контейнеры в базе данных совместно используют подготовленную пропускную способность, Azure Cosmos DB не предоставляет никаких гарантий относительно прогнозируемой пропускной способности для определенного контейнера в этой базе данных. Часть пропускной способности, которую может получить определенный контейнер, зависит от:

* числа контейнеров;
* выбора ключей разделов для различных контейнеров;
* распределения рабочей нагрузки между различными логическими разделами контейнеров. 

Мы рекомендуем настроить пропускную способность на уровне базы данных, когда требуется совместно использовать пропускную способность в нескольких контейнерах, но нежелательно выделять ее какому-либо определенному контейнеру. 

В следующих примерах показано, когда предпочтительнее подготовить пропускную способность на уровне базы данных:

* Совместное использование пропускной способности базы данных набором контейнеров удобно для мультитенантного приложения. Каждый пользователь может быть представлен отдельным контейнером Azure Cosmos.

* Совместное использование подготовленной пропускной способности базы данных набором контейнеров удобно, если выполняется перенос базы данных NoSQL, например MongoDB или Cassandra, размещенной в кластере виртуальных машин или на локальных физических серверах, в Azure Cosmos DB. Подготовленную пропускную способность, настроенную в базе данных Azure Cosmos, можно представить как логический эквивалент (но более экономичный и эластичный) вычислительной мощности кластера MongoDB или Cassandra.  

Все контейнеры, создаваемые внутри базы данных с подготовленной пропускной способностью, должны создаваться с помощью [ключа секции](partitioning-overview.md). В любой момент времени пропускная способность, выделенная контейнеру в базе данных, распределяется по всем логическим секциям этого контейнера. При наличии контейнеров с общей подготовленной пропускной способностью, настроенной на уровне базы данных, невозможно выборочно применить пропускную способность к конкретному контейнеру или логической секции. 

Если рабочая нагрузка, выполняемая в логическом разделе, потребляет больше пропускной способности, чем выделено определенному логическому разделу, скорость выполнения операций будет ограничена. При ограничении скорости можно либо увеличить пропускную способность для всей базы данных, либо повторить операцию. Дополнительные сведения о секционировании см. в статье о [логических разделах](partitioning-overview.md).

Контейнеры в базе данных с общей пропускной способностью совместно используют пропускную способность (ЕЗ/с), выделенную этой базе данных. В базе данных можно использовать до четырех контейнеров с минимальной пропускной способностью в 400 ЕЗ/с. Если подготовлена стандартная пропускная способность (вручную), то для каждого нового контейнера после первых четырех дополнительно потребуется не менее 100 ЕЗ/с. Например, при использовании общей пропускной способности базы данных с восемью контейнерами минимальное значение для базы данных составит 800 ЕЗ/с. При подготовленной пропускной способности автомасштабирования можно использовать до 25 контейнеров в базе данных с автомасштабированием max 4000 единиц запросов в секунду (масштабирование между 400-4000 единиц запросов в секунду).

> [!NOTE]
> В феврале 2020 года мы представили изменение, которое позволяет использовать общую пропускную способность не более чем для 25 контейнеров, что обеспечивает более эффективное совместное использование пропускной способности между контейнерами. После первых 25 контейнеров в базу данных можно добавить дополнительные контейнеры, только если для них [подготовлена выделенная пропускная способность](#set-throughput-on-a-database-and-a-container), которая отделена от общей пропускной способности базы данных.<br>
Если учетная запись Azure Cosmos DB уже содержит базу данных с общей пропускной способностью, используемой более чем 25 контейнерами, то эта учетная запись и все остальные учетные записи в той же подписке Azure будут исключены из этого изменения. Если у вас есть отзывы или вопросы, обратитесь в [службу поддержки продуктов](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade). 

Если ваши рабочие нагрузки предполагают удаление и повторное создание всех коллекций в базе данных, рекомендуется удалять пустую базу данных и создавать новую базу данных перед созданием коллекции. На следующем рисунке показано, как в физическом разделе можно разместить один логический раздел или несколько, которые относятся к разным контейнерам в базе данных.

:::image type="content" source="./media/set-throughput/resource-partition2.png" alt-text="Физическая секция, на которой размещена одна или несколько логических секций, принадлежащих разным контейнерам " border="false":::

## <a name="set-throughput-on-a-database-and-a-container"></a>Настройка пропускной способности для базы данных и контейнера

Вы можете объединить эти две модели. Допускается подготовка пропускной способности для базы данных и для контейнера. В следующем примере показано, как подготовить стандартную пропускную способность (вручную) для базы данных Azure Cosmos и контейнера.

* Вы можете создать базу данных Azure Cosmos с именем *Z* со стандартной подготовленной пропускной способностью, составляющей *K* единиц запроса. 
* Затем создайте в этой базе данных пять контейнеров с именами *A* , *B* , *C* , *D* и *E*. При создании контейнера B обязательно включите параметр **Provision dedicated throughput for this container** (Подготовить выделенную пропускную способность для этого контейнера) и явно настройте для него *P* единиц запроса. Общую и выделенную пропускную способность можно настроить только при создании базы данных и контейнера. 

   :::image type="content" source="./media/set-throughput/coll-level-throughput.png" alt-text="Настройка пропускной способности на уровне контейнера":::

* Пропускная способность в *K* единиц запроса совместно используется в четырех контейнерах: *A* , *C* , *D* и *E*. Точный объем пропускной способности, доступной для *A* , *C* , *D* и *E* , меняется. Не существует Соглашений об уровне обслуживания для пропускной способности каждого отдельного контейнера.
* Контейнер *B* гарантированно будет получать пропускную способность в *P* единиц запроса. Он поддерживается Соглашением об уровне обслуживания.

> [!NOTE]
> Контейнер с подготовленной пропускной способностью невозможно преобразовать в общий контейнер базы данных. И наоборот, невозможно преобразовать общий контейнер базы данных, чтобы он использовал выделенную пропускную способность.

## <a name="update-throughput-on-a-database-or-a-container"></a>Изменение пропускной способности для базы данных и контейнера

После создания контейнера или базы данных Azure Cosmos можно изменить настроенную подготовленную пропускную способность. Максимальная подготовленная пропускная способность, которую можно настроить для базы данных или контейнера, не ограничивается.

### <a name="current-provisioned-throughput"></a><a id="current-provisioned-throughput"></a> Текущая подготовленная пропускная способность

Подготовленную пропускную способность контейнера или базы данных можно получить в портал Azure или с помощью пакетов SDK:

* [Container. реадсраугхпутасинк](/dotnet/api/microsoft.azure.cosmos.container.readthroughputasync?view=azure-dotnet&preserve-view=true) в пакете SDK для .NET.
* [Космосконтаинер. реадсраугхпут](/java/api/com.azure.cosmos.cosmosasynccontainer.readthroughput?view=azure-java-stable&preserve-view=true) в пакете SDK для Java.

Ответ этих методов также содержит [минимальную подготовленную пропускную способность](concepts-limits.md#storage-and-database-operations) для контейнера или базы данных:

* [Сраугхпутреспонсе. минсраугхпут](/dotnet/api/microsoft.azure.cosmos.throughputresponse.minthroughput?view=azure-dotnet&preserve-view=true) в пакете SDK для .NET.
* [Сраугхпутреспонсе. жетминсраугхпут ()](/java/api/com.azure.cosmos.models.throughputresponse.getminthroughput?view=azure-java-stable&preserve-view=true) в пакете SDK для Java.

Фактический минимальный номер единицы запросов в секунду может различаться в зависимости от конфигурации учетной записи. Но обычно это максимальное значение:

* 400 ЕЗ/с 
* Текущий объем хранилища в ГБ * 10 единиц запросов в секунду (если в вашем контейнере или базе данных не будет более 1 ТБ данных, см. нашу программу для работы с [большими объемами памяти и низкой пропускной способностью](#high-storage-low-throughput-program)).
* Максимальное значение единиц запросов в секунду, подготовленное для базы данных или контейнера/100
* Число контейнеров * 100 единиц запросов в секунду (только для базы данных общей пропускной способности)

### <a name="changing-the-provisioned-throughput"></a>Изменение подготовленной пропускной способности

Вы можете масштабировать подготовленную пропускную способность контейнера или базы данных с помощью портал Azure или пакетов SDK:

* [Container. реплацесраугхпутасинк](/dotnet/api/microsoft.azure.cosmos.container.replacethroughputasync?view=azure-dotnet&preserve-view=true) в пакете SDK для .NET.
* [Космосконтаинер. реплацесраугхпут](/java/api/com.azure.cosmos.cosmosasynccontainer.replacethroughput?view=azure-java-stable&preserve-view=true) в пакете SDK для Java.

Если вы **уменьшаете подготовленную пропускную способность** , вы сможете сделать это как [минимум](#current-provisioned-throughput).

Если вы **увеличиваете подготовленную пропускную способность** , в большинстве случаев операция выполняется мгновенно. Однако существуют случаи, когда операция может занять больше времени из-за системных задач по подготовке необходимых ресурсов. В этом случае попытка изменить подготовленную пропускную способность во время выполнения этой операции приведет к получению ответа HTTP 423 с сообщением об ошибке, объясняющим, что выполняется другая операция масштабирования.

> [!NOTE]
> Если вы планируете очень крупную рабочую нагрузку приема, которая потребует значительного увеличения подготовленной пропускной способности, не забывайте, что операция масштабирования не имеет соглашения об уровне обслуживания и, как упоминалось в предыдущем абзаце, может занять длительное время, когда увеличение велико. Возможно, потребуется заранее спланировать и запустить масштабирование до запуска рабочей нагрузки и использовать приведенные ниже методы для проверки хода выполнения.

Можно программно проверить ход выполнения масштабирования, прочитав [текущую подготовленную пропускную способность](#current-provisioned-throughput) и используя:

* [Сраугхпутреспонсе. исреплацепендинг](/dotnet/api/microsoft.azure.cosmos.throughputresponse.isreplacepending?view=azure-dotnet&preserve-view=true) в пакете SDK для .NET.
* [Сраугхпутреспонсе. исреплацепендинг ()](/java/api/com.azure.cosmos.models.throughputresponse.isreplacepending?view=azure-java-stable&preserve-view=true) в пакете SDK для Java.

[Azure Monitor метрики](monitor-cosmos-db.md#view-operation-level-metrics-for-azure-cosmos-db) можно использовать для просмотра журнала подготовленной пропускной способности (единиц запросов в секунду) и хранилища в ресурсе.

## <a name="high-storage--low-throughput-program"></a><a id="high-storage-low-throughput-program"></a> Программа высокой емкости для хранения и низкой пропускной способности

Как описано в разделе [Текущая подготовленная пропускная способность](#current-provisioned-throughput) выше, Минимальная пропускная способность, которую можно подготовить для контейнера или базы данных, зависит от ряда факторов. Одним из них является объем хранящихся в настоящее время данных, так как Azure Cosmos DB обеспечивает минимальную пропускную способность 10 единиц запросов в секунду на хранилище.

Это может быть проблемой в ситуациях, когда необходимо хранить большие объемы данных, но при этом требуется использовать низкие требования к пропускной способности. Чтобы лучше реализовать эти сценарии, Azure Cosmos DB представила **программу "высокая емкость или низкая пропускная способность"** , которая уменьшает ограничение в единицах запросов в секунду на допустимые учетные записи с 10 до 1.

В настоящее время необходимо иметь по крайней мере один контейнер или базу данных с общей пропускной способностью, содержащую более 1 ТБ данных в вашей учетной записи. Чтобы присоединиться к этой программе и оценить полную пригодность, достаточно заполнить [этот опрос](https://customervoice.microsoft.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbRzBPrdEMjvxPuDm8fCLUtXpUREdDU0pCR0lVVFY5T1lRVEhWNUZITUJGMC4u). После этого Группа Azure Cosmos DB продолжит работу и продолжит работу с адаптации.

## <a name="comparison-of-models"></a>Сравнение моделей
В этой таблице показано сравнение стандартной (настроенной вручную) пропускной способности для базы данных и контейнера. 

|**Параметр**  |**Стандартная (настроенная вручную) пропускная способность для базы данных**  |**Стандартная (настроенная вручную) пропускная способность для контейнера**|**Автомасштабируемая пропускная способность для базы данных** | **Автомасштабируемая пропускная способность для контейнера**|
|---------|---------|---------|---------|---------|
|Точка входа (минимальное число ЕЗ/с) |400 ЕЗ/с (после первых четырех контейнеров для каждого дополнительного контейнера требуется не менее 100 ЕЗ/с).</li> |400| Автомасштабирование от 400 до 4000 ЕЗ/с. Допускается до 25 контейнеров без минимального числа ЕЗ/с на контейнер.</li> | Автомасштабирование от 400 до 4000 ЕЗ/с.|
|Минимальное число ЕЗ/с на контейнер|100|400|--|Автомасштабирование от 400 до 4000 ЕЗ/с.|
|Максимум ЕЗ|Без ограничений, для базы данных.|Без ограничений, для контейнера.|Без ограничений, для базы данных.|Без ограничений, для контейнера.
|ЕЗ, назначенные или доступные для определенного контейнера|Нет гарантий. ЕЗ, назначенные для заданного контейнера зависят от свойств. Свойствами могут быть выбор ключей разделов контейнеров, совместно использующих пропускную способность, распределение рабочей нагрузки и число контейнеров. |Все ЕЗ, настроенные для контейнера, резервируются исключительно для него.|Нет гарантий. ЕЗ, назначенные для заданного контейнера зависят от свойств. Свойствами могут быть выбор ключей разделов контейнеров, совместно использующих пропускную способность, распределение рабочей нагрузки и число контейнеров. |Все ЕЗ, настроенные для контейнера, резервируются исключительно для него.|
|Максимальный размер хранилища для контейнера|Без ограничений.|Неограниченно|Неограниченно|Неограниченно|
|Максимальная пропускная способность на логический раздел контейнера|10 000 ЕЗ/с|10 000 ЕЗ/с|10 000 ЕЗ/с|10 000 ЕЗ/с|
|Максимальная пропускная способность (данные + индекс) на логический раздел контейнера|20 ГБ|20 ГБ|20 ГБ|20 ГБ|

## <a name="next-steps"></a>Дальнейшие действия

* Подробнее о [логических секциях](partitioning-overview.md).
* Узнайте, как [подготовить стандартную (настраиваемую вручную) пропускную способность для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Узнайте, как [подготовить стандартную (настраиваемую вручную) пропускную способность базы данных Azure Cosmos](how-to-provision-database-throughput.md).
* Узнайте, как [подготовить автомасштабируемую пропускную способность для базы данных или контейнера Azure Cosmos](how-to-provision-autoscale-throughput.md).
