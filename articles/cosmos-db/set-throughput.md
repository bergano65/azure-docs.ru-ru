---
title: Подготовка пропускной способности для Azure Cosmos DB
description: Сведения о настройке подготовленной пропускной способности для контейнеров и баз данных Azure Cosmos DB.
author: aliuy
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/25/2018
ms.author: andrl
ms.openlocfilehash: 24b6beec8ecda993667464be5c74dab50fd93201
ms.sourcegitcommit: ba4570d778187a975645a45920d1d631139ac36e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2018
ms.locfileid: "51278894"
---
# <a name="provision-throughput-for-cosmos-db-containers-and-databases"></a>Подготовка пропускной способности для контейнеров и баз данных Cosmos DB

База данных Cosmos представляет собой единицу управления для набора контейнеров. База данных состоит из набора схемонезависимых контейнеров. Контейнер Cosmos — это единица масштабируемости как для пропускной способности, так и для хранения. Контейнер горизонтально разделяется между набором машин в регионе Azure и распределяется по всем регионах Azure, связанным с учетной записью Cosmos.

Azure Cosmos DB позволяет настроить пропускную способность на двух уровнях детализации — в **контейнерах Cosmos** и **базах данных Cosmos**.

# <a name="setting-throughput-on-a-cosmos-container"></a>Настройка пропускной способности в контейнере Cosmos  

Пропускная способность, подготавливаемая в контейнере Cosmos, резервируется исключительно для контейнера. Контейнер получает подготовленную пропускную способность постоянно. Финансовой гарантией подготовленной пропускной способности в контейнере являются соглашения об уровне обслуживания. Чтобы настроить пропускную способность для контейнера, см. статью о том, [как подготовить пропускную способность в контейнере Cosmos](how-to-provision-container-throughput.md).

Настройка подготавливаемой пропускной способности для контейнера — широко используемый подход. Хотя пропускную способность для контейнера можно гибко масштабировать, подготавливая любой объем пропускной способности (в единицах запроса — RU), нельзя выборочно указать пропускную способность для логических разделов. Когда рабочая нагрузка, выполняемая в логическом разделе, потребляет больше выделенной ему пропускной способности, скорость выполнения операций будет ограничена. При ограничении скорости можно либо увеличить пропускную способность для всего контейнера, либо повторить операцию. Дополнительные сведения о секционировании см. в статье о [логических разделах](partition-data.md).

Если нужно получить гарантированную производительность для определенного контейнера, рекомендуется настроить пропускную способность на уровне контейнера.

Пропускная способность в контейнере Cosmos равномерно распределяется по всем его логическим разделам. Так как один или несколько логических разделов контейнера размещаются в разделе ресурсов, физические разделы относятся исключительно к данному контейнеру и поддерживают пропускную способность, подготовленную для контейнера. На следующем рисунке показано, как в разделе ресурсов размещаются один или несколько логических разделов контейнера:

![Раздел ресурсов](./media/set-throughput/resource-partition.png)

# <a name="setting-throughput-on-a-cosmos-database"></a>Настройка пропускной способности в базе данных Cosmos

При подготовке пропускной способности в базе данных Cosmos пропускная способность распределяется между всеми контейнерами в базе данных, если не указана подготовленная пропускная способность для определенных контейнеров. Совместное использование пропускной способности базы данных ее контейнерами аналогично размещению базы данных в кластере виртуальных машин. Так как все контейнеры в базе данных совместно используют ресурсы, доступные на компьютере, естественно, что для любого конкретного контейнера нельзя обеспечить прогнозируемую производительность. Чтобы настроить пропускную способность для базы данных, см. статью о [настройке подготовленной пропускной способности в базе данных Cosmos](how-to-provision-database-throughput.md).

Настройка пропускной способности в базе данных Cosmos гарантирует, что подготовленная пропускная способность будет постоянно доступна. Так как все контейнеры в базе данных совместно используют подготовленную пропускную способность, Cosmos DB не предоставляет никаких гарантий прогнозируемой пропускной способности для определенного контейнера в этой базе данных. Часть пропускной способности, которую может получить определенный контейнер, зависит от:

* числа контейнеров;
* выбора ключей разделов для различных контейнеров;
* распределения рабочей нагрузки между различными логическими разделами контейнеров. 

Рекомендуется настроить пропускную способность на уровне базе данных, когда требуется совместно использовать пропускную способность в нескольких контейнерах, но нежелательно выделять ее какому-либо определенному контейнеру. Ниже приведен ряд примеров, когда предпочтительнее подготовить пропускную способность на уровне базы данных.

* Совместное использование пропускной способности базы данных набором контейнеров полезно для мультитенантного приложения. Каждый пользователь может быть представлен отдельным контейнером Cosmos.

* Совместное использование подготовленной пропускной способности базы данных набором контейнеров полезно в том случае, если выполняется перенос базы данных NoSQL (например, MongoDB, Cassandra), размещенной в кластере виртуальных машин или на локальных физических серверах, в Cosmos DB. Подготовленную пропускную способность, настроенную в базе данных Cosmos, можно представить как логический эквивалент (но более экономичный и эластичный) вычислительной мощности кластера MongoDB или Cassandra.  

В любой отдельно взятый момент времени пропускная способность, выделенная контейнеру в базе данных, распределяется по всем логическим разделам этого контейнера. При наличии контейнеров с общей подготовленной пропускной способностью на уровне базы данных нельзя выборочно применить пропускную способность к конкретному контейнеру или логическому разделу. Если рабочая нагрузка, выполняемая в логическом разделе, потребляет больше пропускной способности, чем выделено определенному логическому разделу, скорость выполнения операций будет ограничена. При ограничении скорости можно либо увеличить пропускную способность для всего контейнера, либо повторить операцию. Дополнительные сведения о секционировании см. в статье о [логических разделах](partition-data.md).

В одном разделе ресурсов можно разместить несколько логических разделов, совместно использующих пропускную способность, подготовленную для базы данных. В то время как отдельный логический раздел контейнера всегда ограничен разделом ресурсов, логические разделы L в контейнерах C, совместно использующие подготовленную пропускную способность базы данных, можно сопоставить и разместить в физических разделах R. На следующем рисунке показано, как в разделе ресурсов можно разместить один или несколько логических разделов, которые относятся к разным контейнерам в базе данных:

![Раздел ресурсов](./media/set-throughput/resource-partition2.png)

## <a name="setting-throughput-on-a-cosmos-database-and-a-container"></a>Настройка пропускной способности для базы данных Cosmos и контейнера

Можно объединить две модели, подготовив пропускную способность как для базы данных, так и для контейнера. В следующем примере показано, как подготовить пропускную способность для базы данных Cosmos и контейнера.

* Можно создать базу данных Cosmos с именем Z с подготовленной пропускной способностью, составляющей K единиц запросов. 
* Затем создайте в этой базе данных пять контейнеров с именами A, B, C, D и E.
* Можно явно настроить P единиц запросов подготовленной пропускной способности в контейнере B.
* Пропускная способность в объеме K единиц запросов совместно используется четырьмя контейнерами — A, C, D и E. Точный объем пропускной способности, доступный для A, C, D и E, различается, а соглашения об уровне обслуживания для каждого отдельного контейнера не предусмотрены.
* Контейнер B гарантированно будет постоянно получать пропускную способность в P единиц запросов и поддерживается соглашениями об уровне обслуживания.

## <a name="comparison-of-models"></a>Сравнение моделей

|**Квота**  |**Пропускная способность, подготовленная на уровне базы данных**  |**Пропускная способность, подготовленная на уровне контейнера**|
|---------|---------|---------|
|Единица масштабируемости|Контейнер|Контейнер|
|Минимум ЕЗ |400 |400|
|Минимум ЕЗ на контейнер|100|400|
|Минимум ЕЗ, необходимый для потребления 1 ГБ хранилища|40|40|
|Максимум ЕЗ|Без ограничений, для базы данных|Без ограничений, для контейнера|
|ЕЗ, назначенные/доступные для определенного контейнера|Нет гарантий. Количество ЕЗ, назначаемых тому или иному контейнеру, зависит от таких свойств, как выбор ключей разделов контейнеров, которые совместно используют пропускную способность, распределение рабочей нагрузки, количество контейнеров. |Все ЕЗ, настроенные для контейнера, резервируются исключительно для него.|
|Максимальный размер хранилища для контейнера|Без ограничений|Без ограничений|
|Максимальная пропускная способность на логический раздел контейнера|10 000 ЕЗ|10 000 ЕЗ|
|Максимальная пропускная способность (данные + индекс) на логический раздел контейнера|10 ГБ|10 ГБ|

## <a name="next-steps"></a>Дополнительная информация

* Подробнее о [логических разделах](partition-data.md).
* Сведения о том, [как подготовить пропускную способность для контейнера Cosmos](how-to-provision-container-throughput.md).
* Сведения о том, [как подготовить пропускную способность для базы данных Cosmos](how-to-provision-database-throughput.md).

