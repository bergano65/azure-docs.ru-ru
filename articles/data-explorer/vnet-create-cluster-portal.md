---
title: Создание кластера Azure Data Explorer & DB в виртуальной сети
description: В этой статье вы узнаете, как создать кластер Azure Data Explorer в виртуальной сети.
author: orspod
ms.author: orspodek
ms.reviewer: basaba
ms.service: data-explorer
ms.topic: conceptual
ms.date: 03/24/2020
ms.openlocfilehash: 99c32122fc48aaea7428fa559d7289713849f34e
ms.sourcegitcommit: 980c3d827cc0f25b94b1eb93fd3d9041f3593036
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2020
ms.locfileid: "80548899"
---
# <a name="create-an-azure-data-explorer-cluster-in-your-virtual-network"></a>Создание кластера Azure Data Explorer в виртуальной сети

Azure Data Explorer поддерживает развертывание кластера в подсети в виртуальной сети (VNet). Эта возможность позволяет получить доступ к кластеру в частном порядке из виртуальной сети Azure или локальных ресурсов доступа, таких как Event Hub и Storage внутри виртуальной сети, и ограничить входящий и исходящий трафик.

## <a name="prerequisites"></a>Предварительные требования

* Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись](https://azure.microsoft.com/free/) Azure, прежде чем начинать работу.
* Войдите на [портал Azure](https://portal.azure.com/).

## <a name="create-network-security-group-nsg"></a>Создание группы сетевой безопасности (NSG)

[Группы сетевой безопасности (NSG)](/azure/virtual-network/security-overview) предоставляют возможность управления доступом к сети в VNet. Доступ к Azure Data Explorer можно с помощью двух конечных точек HTTP (443) и TDS (1433). Следующие правила NSG должны быть настроены, чтобы обеспечить доступ к этим конечным точкам для управления, мониторинга и правильной работы кластера.

Для создания группы сетевой безопасности:

1. Выберите **кнопку «Создай кнопку ресурса»** в верхнем левом углу портала.
1. Поиск *группы сетевой безопасности*.
1. В рамках **группы сетевой безопасности**, в нижней части экрана, выберите **Создать**.
1. В окне **группы безопасности Сети** заполните следующую информацию.

   ![Создание формы NSG](media/vnet-create-cluster-portal/network-security-group.png)

    **Параметр** | **Рекомендуемое значение** | **Описание поля**
    |---|---|---|
    | Подписка | Ваша подписка | Выберите подписку Azure, которую вы хотите использовать для кластера.|
    | Группа ресурсов | Ваша группа ресурсов | Воспользуйтесь существующей группой ресурсов или создайте новую. |
    | Имя | AzureDataExplorerNsg | Выберите имя, идентифицирует группу сетевой безопасности (NSG) в группе ресурсов.  |
    | Регион | *Западная часть США* | Выберите регион в соответствии со своими потребностями.
    | | | |

1. Выберите **Отзыв и создание**, чтобы просмотреть свои сведения о кластере, и нажмите кнопку **Создать**, чтобы подготовить кластер.

1. Когда развертывание будет завершено, выберите **Перейти ресурсу**.

    ![Переход к ресурсу](media/vnet-create-cluster-portal/notification-nsg.png)

1. Во вкладке **Входящие правила безопасности** выберите **«Добавить**.
1. В окне **входящего правила безопасности Добавить** заполните следующую информацию.

    ![Создание входящего правила NSG](media/vnet-create-cluster-portal/nsg-inbound-rule.png)

    **Параметр** | **Рекомендуемое значение** 
    |---|---|
    | Источник | ServiceTag
    | Тег службы источника | AzureDataExplorerManagement
    | Диапазоны исходных портов | *
    | Назначение | Виртуальная сеть
    | Диапазоны портов назначения | *
    | Протокол | TCP
    | Действие | Allow
    | Priority | 100
    | Имя | AllowAzureDataExplorerManagement
    | | |
    
1. Повторите предыдущие два шага для всех входящих и исходящих зависимостей в [зависимостях для развертывания VNet.](/azure/data-explorer/vnet-deployment#dependencies-for-vnet-deployment) Кроме того, правила исходящего из них могут быть заменены единым правилом, позволяющим *интернету* для портов 443 и 80.
    
    Правила NSG для входящих и исходящих зависимостей должны выглядеть следующим образом:

    ![Правила групп безопасности сети (NSG)](media/vnet-create-cluster-portal/nsg-rules.png)

## <a name="create-public-ip-addresses"></a>Создание общедоступных IP-адресов

Для создания общедоступных IP-адресов запроса (Engine):

1. Выберите **кнопку «Создай кнопку ресурса»** в верхнем левом углу портала.
1. Поиск *группы сетевой безопасности*.
1. Под **общедоступным IP-адресом,** в нижней части экрана, выберите **Создать**.
1. В панели **общедоступных IP-адресов** заполните следующую информацию.
   
   ![Создание общедоступной формы IP](media/vnet-create-cluster-portal/public-ip-blade.png)

    **Параметр** | **Рекомендуемое значение** | **Описание поля**
    |---|---|---|
    | Версия IP-адреса | IPv4 | Выберите версию IP. Мы поддерживаем только IPv4.|
    | Sku | Standard | Нам требуется **стандарт** для запроса (Engine) URI конечная точка. |
    | Имя | двигатель-пип | Выберите имя, идентифицирует ли ваш общедоступный IP-адрес в группе ресурсов.
    | Подписка | Ваша подписка | Выберите подписку Azure, которую вы хотите использовать для общего IP- иС.|
    | Группа ресурсов | Ваша группа ресурсов | Воспользуйтесь существующей группой ресурсов или создайте новую. |
    | Расположение | *Западная часть США* | Выберите регион в соответствии со своими потребностями.
    | | | |

1. Выберите **Создать** для создания общедоступного IP-адреса.

1. Для создания общественного IP-адреса (Управления данными) следуйте тем же инструкциям и выберите 
    * **Sku**: Основные
    * **Назначение IP-адреса**: Статическое

## <a name="create-virtual-network-and-subnet"></a>Создание виртуальной сети и подсети

Для создания виртуальной сети и подсети:

1. Выберите **кнопку «Создай кнопку ресурса»** в верхнем левом углу портала.
1. Поиск *виртуальной сети*.
1. Под **виртуальной сети**, в нижней части экрана, выберите **Создать**.
1. В окне **виртуальной сети Create** заполните следующую информацию.

   ![Создание виртуальной сетевой формы](media/vnet-create-cluster-portal/vnet-blade.png)

    **Параметр** | **Рекомендуемое значение** | **Описание поля**
    |---|---|---|
    | Подписка | Ваша подписка | Выберите подписку Azure, которую вы хотите использовать для кластера.|
    | Группа ресурсов | Ваша группа ресурсов | Воспользуйтесь существующей группой ресурсов или создайте новую. |
    | Имя | AzureDataExplorerVnet | Выберите имя, идентифицирует вашу виртуальную сеть в группе ресурсов.
    | Регион | *Западная часть США* | Выберите регион в соответствии со своими потребностями.
    | | | |

    > [!NOTE]
    > Для производственных нагрузок спланируйте размер подсети в соответствии с [размером подсети плана в VNet](/azure/data-explorer/vnet-deployment#plan-subnet-size-in-your-vnet)

1. Выберите **Отзыв и создание**, чтобы просмотреть свои сведения о кластере, и нажмите кнопку **Создать**, чтобы подготовить кластер.

1. Когда развертывание будет завершено, выберите **Перейти ресурсу**.
1. Перейдите к лезвию **подсетей** и выберите подсеть **по умолчанию.**
    
    ![Лезвие подсетей](media/vnet-create-cluster-portal/subnets.png)

1. В окне подсети **по умолчанию:**
    1. Выберите **группу сетевой безопасности** из меню выпадения. 
    1. Выберите название группы сетевой безопасности, в данном случае **AzureDataExplorerNsg.** 
    1. **Сохранить**

    ![Настройка подсети](media/vnet-create-cluster-portal/subnet-nsg.png)

## <a name="create-a-cluster"></a>Создание кластера

Создание кластера Azure Data Explorer с определенным набором ресурсов вычислений и хранения в группе ресурсов Azure, описанной в [создании кластера.](create-cluster-database-portal.md#create-a-cluster)

1. Перед завершением создания кластера в окне **кластера Azure Data Explorer** выберите вкладку **Network,** чтобы предоставить виртуальные сведения о сети с помощью ресурсов, созданных в предыдущих вкладок:

   ![Создание формы кластерного vnet](media/vnet-create-cluster-portal/create-cluster-form-vnet.png)

    **Параметр** | **Рекомендуемое значение** | **Описание поля**
    |---|---|---|
    | Подписка | Ваша подписка | Выберите подписку Azure, которую вы хотите использовать для сетевых ресурсов.|
    | Виртуальная сеть | AzureDataExplorerVnet | Выберите виртуальную сеть, созданную в предыдущих шагах.
    | Подсеть | default | Выберите подсеть, созданную в предыдущих шагах.
    | Запрос общественного IP | двигатель-пип | Выберите общедоступный IP-запрос, созданный в предыдущих шагах.
    | Данные, проглатывающие публичный IP | dm-pip | Выберите общедоступный IP-адрес, созданный в предыдущих шагах.
    | | | |

1. Выберите **Обзор и создайте** для создания кластера.
1. Когда развертывание будет завершено, выберите **Перейти ресурсу**.

Чтобы развернуть кластер Azure Data Explorer в виртуальную сеть, используйте кластер Deploy Azure Data Explorer в шаблоне [Управления ресурсами VNet](https://azure.microsoft.com/resources/templates/101-kusto-vnet/) Azure.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Развертывание исследователя данных Azure в виртуальную сеть](vnet-create-cluster-portal.md)