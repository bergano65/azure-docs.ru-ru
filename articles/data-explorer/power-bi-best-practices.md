---
title: Рекомендации по использованию Power BI для запроса и визуализации данных обозреватель данных Azure
description: В этой статье вы узнаете о рекомендациях по использованию Power BI для запроса и визуализации данных обозреватель данных Azure.
author: orspod
ms.author: orspodek
ms.reviewer: gabil
ms.service: data-explorer
ms.topic: conceptual
ms.date: 09/26/2019
ms.openlocfilehash: db1d530c9cab77ae612c83a0d4f52478fb9ee270
ms.sourcegitcommit: 49cf9786d3134517727ff1e656c4d8531bbbd332
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/13/2019
ms.locfileid: "74024037"
---
# <a name="best-practices-for-using-power-bi-to-query-and-visualize-azure-data-explorer-data"></a>Рекомендации по использованию Power BI для запроса и визуализации данных обозреватель данных Azure

Обозреватель данных Azure — это быстрая и высокомасштабируемая служба для изучения данных журналов и телеметрии. [Power BI](https://docs.microsoft.com/power-bi/) — это решение бизнес-аналитики, которое позволяет визуализировать данные и совместно использовать результаты в Организации. Обозреватель данных Azure предоставляет три варианта подключения к данным в Power BI. Используйте [Встроенный соединитель](power-bi-connector.md), [импортируйте запрос из Azure обозреватель данных в Power BI](power-bi-imported-query.md)или используйте [SQL-запрос](power-bi-sql-query.md). В этой статье содержатся советы по созданию запросов и визуализации данных Azure обозреватель данных с помощью Power BI. 

## <a name="best-practices-for-using-power-bi"></a>Рекомендации по использованию Power BI 

При работе с терабайтами новых необработанных данных следуйте приведенным ниже рекомендациям по обеспечению привязки и обновления Power BI панелей мониторинга и отчетов.

* **Источник** перемещения. Перенесите только те данные, которые необходимы для Power BI отчетов. Для углубленного интерактивного анализа используйте [веб-интерфейс Azure обозреватель данных](web-query-data.md) , оптимизированный для специального исследования с помощью языка запросов Kusto.

* **Составная** модель. Используйте [составную модель](https://docs.microsoft.com/power-bi/desktop-composite-models) , чтобы объединить агрегированные данные для панелей мониторинга верхнего уровня с отфильтрованными операционными необработанными данными. Можно четко определить, когда следует использовать необработанные данные и когда следует использовать агрегированное представление. 

* **Режим импорта и режим DirectQuery** — используйте режим **импорта** для взаимодействия с меньшими наборами данных. Режим **DirectQuery** используется для больших, часто обновляемых наборов данных. Например, создайте таблицы измерений с помощью режима **импорта** , так как они небольшие и не меняются часто. Установите интервал обновления в соответствии с ожидаемой частотой обновлений данных. Создание таблиц фактов с помощью режима **DirectQuery** , так как эти таблицы велики и содержат необработанные данные. Используйте эти таблицы для представления отфильтрованных данных с помощью [детализации](https://docs.microsoft.com/power-bi/desktop-drillthrough)Power BI.

* **Параллелизм** . Azure обозреватель данных — это линейная масштабируемая платформа данных, поэтому вы можете повысить производительность отрисовки панели мониторинга, увеличив параллелизм сквозного потока следующим образом:

   * Увеличьте число [одновременных подключений в DirectQuery в Power BI](https://docs.microsoft.com/power-bi/desktop-directquery-about#maximum-number-of-connections-option-for-directquery).

   * Используйте [слабую согласованность для улучшения параллелизма](/azure/kusto/concepts/queryconsistency). Это может повлиять на актуальность данных.

* **Действующие срезы** — используйте [срезы синхронизации](https://docs.microsoft.com/power-bi/visuals/power-bi-visualization-slicers#sync-and-use-slicers-on-other-pages) , чтобы предотвратить загрузку данных отчетами перед тем, как будете готовы. После структурирования набора данных, размещения всех визуальных элементов и пометки всех срезов можно выбрать срез синхронизации для загрузки только необходимых данных.

* **Использование фильтров** . используйте столько Power BI фильтров, сколько возможно, чтобы сосредоточиться на поиске обозреватель данных Azure по соответствующим сегментам данных.

* **Эффективные визуальные элементы** — выберите наиболее производительные визуальные элементы для данных.

## <a name="tips-for-using-the-azure-data-explorer-connector-for-power-bi-to-query-data"></a>Советы по использованию соединителя Azure обозреватель данных для Power BI запроса данных

В следующем разделе приведены советы и рекомендации по использованию языка запросов Kusto с Power BI. Использование [соединителя Azure обозреватель данных для](power-bi-connector.md) визуализации данных Power BI

### <a name="complex-queries-in-power-bi"></a>Сложные запросы в Power BI

Сложные запросы более легко выражаются в Kusto, чем в Power Query. Они должны быть реализованы в виде [функций Kusto](/azure/kusto/query/functions)и вызываться в Power BI. Этот метод является обязательным при использовании **DirectQuery** с операторами `let` в запросе Kusto. Поскольку Power BI соединяет два запроса, и операторы `let` нельзя использовать с оператором `join`, могут возникать синтаксические ошибки. Поэтому сохраните каждую часть объединения как функцию Kusto и разрешите Power BI объединить эти две функции.

### <a name="how-to-simulate-a-relative-date-time-operator"></a>Имитация относительного оператора даты и времени

Power BI не содержит *относительный* оператор даты и времени, например `ago()`.
Для имитации `ago()`используйте сочетание функций `DateTime.FixedLocalNow()` и `#duration` Power BI.

Вместо этого запроса с помощью оператора `ago()`:

```kusto
    StormEvents | where StartTime > (now()-5d)
    StormEvents | where StartTime > ago(5d)
``` 

Используйте следующий эквивалентный запрос:

```powerquery-m
let
    Source = Kusto.Contents("help", "Samples", "StormEvents", []),
    #"Filtered Rows" = Table.SelectRows(Source, each [StartTime] > (DateTime.FixedLocalNow()-#duration(5,0,0,0)))
in
    #"Filtered Rows"
```

### <a name="reaching-kusto-query-limits"></a>Достижение лимитов запросов Kusto 

По умолчанию Kusto запросы возвращают до 500 000 строк или 64 МБ, как описано в разделе [ограничения запросов](/azure/kusto/concepts/querylimits). Эти значения по умолчанию можно переопределить с помощью **дополнительных параметров** в окне подключения **Azure обозреватель данных (Kusto)** :

![Дополнительные параметры](media/power-bi-best-practices/advanced-options.png)

Эти параметры выдают [инструкции SET](/azure/kusto/query/setstatement) с запросом на изменение ограничений по умолчанию для запросов.

  * **Ограничить номер записи результата запроса** создает `set truncationmaxrecords`
  * **Ограничение размера данных результата запроса в байтах** создает `set truncationmaxsize`
  * **Отключение усечения результирующего набора** создает `set notruncation`

### <a name="using-query-parameters"></a>Использование параметров запроса

[Параметры запроса](/azure/kusto/query/queryparametersstatement) можно использовать для динамического изменения запроса. 

#### <a name="using-a-query-parameter-in-the-connection-details"></a>Использование параметра запроса в сведениях о подключении

Используйте параметр запроса для фильтрации сведений в запросе и оптимизации производительности запросов.
 
В окне " **изменение запросов** " > " **Главная** " **Расширенный редактор**

1. Найдите следующий раздел запроса:

    ```powerquery-m
    Source = Kusto.Contents("<Cluster>", "<Database>", "<Query>", [])
    ```
   
   Например,

    ```powerquery-m
    Source = Kusto.Contents("Help", "Samples", "StormEvents | where State == 'ALABAMA' | take 100", [])
    ```

1. Замените соответствующую часть запроса параметром. Разделите запрос на несколько частей и объедините их обратно с помощью амперсанда (&) вместе с параметром.

   Например, в приведенном выше запросе мы рассмотрим `State == 'ALABAMA'` часть и разделите ее на: `State == '` и `'`, и мы поместим параметр `State` между ними:
   
    ```kusto
    "StormEvents | where State == '" & State & "' | take 100"
    ```

1. Если запрос содержит кавычки, их необходимо кодировать правильно. Например, следующий запрос: 

   ```kusto
   "StormEvents | where State == "ALABAMA" | take 100" 
   ```

   будет отображаться в **Расширенный редактор** , как показано ниже, с двумя кавычками:

   ```kusto
    "StormEvents | where State == ""ALABAMA"" | take 100"
   ```

   Его следует заменить следующим запросом с тремя кавычками:

   ```kusto
   "StormEvents | where State == """ & State & """ | take 100"
   ```

#### <a name="use-a-query-parameter-in-the-query-steps"></a>Использование параметра запроса в шагах запроса

Параметр запроса можно использовать на любом шаге запроса, который его поддерживает. Например, отфильтруйте результаты на основе значения параметра.

![Фильтрация результатов с помощью параметра](media/power-bi-best-practices/filter-using-parameter.png)

### <a name="dont-use-power-bi-data-refresh-scheduler-to-issue-control-commands-to-kusto"></a>Не используйте Power BI Планировщик обновления данных, чтобы выдать команды управления Kusto

Power BI включает Планировщик обновления данных, который может периодически выдавать запросы к источнику данных. Этот механизм не следует использовать для планирования Kusto команд управления, поскольку Power BI предполагает, что все запросы доступны только для чтения.

### <a name="power-bi-can-send-only-short-lt2000-characters-queries-to-kusto"></a>Power BI может передавать только короткие (&lt;2000 символов) запросы в Kusto

Если выполнение запроса в Power BI приводит к следующей ошибке: _"DataSource. Error: Web. contents не удалось получить содержимое из..."_ запрос может быть длиннее 2000 символов. Power BI использует **PowerQuery** для запроса Kusto, ВЫДАВАЯ HTTP-запрос GET, который кодирует запрос как часть получаемого URI. Таким образом, Kusto запросы, выданные Power BI, ограничиваются максимальной длиной URI запроса (2000 символов, за вычетом небольшого смещения). В качестве обходного решения можно определить [хранимую функцию](/azure/kusto/query/schema-entities/stored-functions) в Kusto и иметь Power BI использовать эту функцию в запросе.

## <a name="next-steps"></a>Дополнительная информация

[Визуализация данных с помощью соединителя Azure обозреватель данных для Power BI](power-bi-connector.md)




