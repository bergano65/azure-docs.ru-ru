---
title: Рекомендации по использованию Power BI для запроса и визуализации данных Azure Data Explorer
description: В этой статье вы узнаете лучшие практики использования Power BI для запроса и визуализации данных Azure Data Explorer.
author: orspod
ms.author: orspodek
ms.reviewer: gabil
ms.service: data-explorer
ms.topic: conceptual
ms.date: 09/26/2019
ms.openlocfilehash: db1d530c9cab77ae612c83a0d4f52478fb9ee270
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79251743"
---
# <a name="best-practices-for-using-power-bi-to-query-and-visualize-azure-data-explorer-data"></a>Рекомендации по использованию Power BI для запроса и визуализации данных Azure Data Explorer

Обозреватель данных Azure — это быстрая и высокомасштабируемая служба для изучения данных журналов и телеметрии. [Power BI](https://docs.microsoft.com/power-bi/) — это бизнес-аналитика, которое позволяет визуализировать данные и делиться результатами в организации. Azure Data Explorer предоставляет три варианта подключения к данным в Power BI. Используйте [встроенный разъем,](power-bi-connector.md) [импортируйте запрос из Azure Data Explorer в Power BI,](power-bi-imported-query.md)или используйте [запрос S'L.](power-bi-sql-query.md) В этой статье вам предоставляются советы по запросу и визуализации данных Azure Data Explorer с помощью Power BI. 

## <a name="best-practices-for-using-power-bi"></a>Лучшие практики для использования Power BI 

При работе с терабайтами свежих необработанных данных следуйте этим рекомендациям, чтобы держать панели мониторинга Power BI и отчеты быстро и обновляются:

* **Путешествия свет** - Принесите только данные, которые вам нужны для ваших отчетов power BI. Для глубокого интерактивного анализа используйте [веб-миноносец Azure Data Explorer,](web-query-data.md) который оптимизирован для специального исследования с языком запросов Kusto.

* **Композитная модель** - Используйте [композитную модель](https://docs.microsoft.com/power-bi/desktop-composite-models) для объединения агрегированных данных для панелей мониторинга верхнего уровня с отфильтрованными оперативными необработанными данными. Можно четко определить, когда использовать необработанные данные и когда использовать агрегированное представление. 

* **Режим импорта по сравнению с режимом Direct's** - Используйте режим **импорта** для взаимодействия небольших наборов данных. Используйте режим **Direct's** для больших, часто обновляемых наборов данных. Например, создавайте таблицы измерений с помощью режима **Импорта,** поскольку они малы и не часто меняются. Установите интервал обновления в соответствии с ожидаемой скоростью обновления данных. Создавайте таблицы фактов с помощью режима **Direct's,** так как эти таблицы являются большими и содержат необработанные данные. Используйте эти таблицы для представления отфильтрованных данных с помощью [сверлящего](https://docs.microsoft.com/power-bi/desktop-drillthrough)Power BI.

* **Параллелизм** - Azure Data Explorer является линейно масштабируемой платформой данных, поэтому можно повысить производительность визуализации панели мониторинга, увеличив параллелизм сквозного потока следующим образом:

   * Увеличьте количество [одновременных подключений в Directquery в Power BI.](https://docs.microsoft.com/power-bi/desktop-directquery-about#maximum-number-of-connections-option-for-directquery)

   * Используйте [слабую последовательность для улучшения параллелизма.](/azure/kusto/concepts/queryconsistency) Это может повлиять на свежесть данных.

* **Эффективные слайсеры** — Используйте [срезы синхронизации,](https://docs.microsoft.com/power-bi/visuals/power-bi-visualization-slicers#sync-and-use-slicers-on-other-pages) чтобы предотвратить загрузку данных отчетов до того, как вы будете готовы. После структурирования набора данных, размещения всех визуальных элементов и отметки всех срезов можно выбрать срез синхронизации для загрузки только необходимых данных.

* **Используйте фильтры** - Используйте как можно больше фильтров Power BI, чтобы сфокусировать поиск Azure Data Explorer на соответствующих осколках данных.

* **Эффективные визуальные эффекты** - Выберите наиболее эффективные визуальные эффекты для ваших данных.

## <a name="tips-for-using-the-azure-data-explorer-connector-for-power-bi-to-query-data"></a>Советы по использованию разъема Azure Data Explorer для Power BI для запроса данных

Следующий раздел включает в себя советы и рекомендации по использованию языка запроса Kusto с Power BI. Используйте [разъем Azure Data Explorer для Power BI](power-bi-connector.md) для визуализации данных

### <a name="complex-queries-in-power-bi"></a>Сложные запросы в Power BI

Сложные запросы легче выражаются в Кусто, чем в Power Query. Они должны быть реализованы в качестве [функций Kusto,](/azure/kusto/query/functions)и вызваны в Power BI. Этот метод необходим при использовании `let` **Direct's'ry** с операторами в вашем запросе Kusto. Поскольку Power BI объединяет два `let` запроса, а операторы не могут использоваться с оператором, `join` могут возникнуть ошибки синтаксиса. Таким образом, сохраните каждую часть соединения в качестве функции Kusto и позвольте Power BI объединить эти две функции вместе.

### <a name="how-to-simulate-a-relative-date-time-operator"></a>Как смоделировать оператора относительного времени даты

Power BI не содержит *относительного* оператора времени `ago()`даты, например.
Для `ago()`имитации, используйте `#duration` комбинацию и функции `DateTime.FixedLocalNow()` Power BI.

Вместо этого запроса `ago()` с помощью оператора:

```kusto
    StormEvents | where StartTime > (now()-5d)
    StormEvents | where StartTime > ago(5d)
``` 

Используйте следующий эквивалентный запрос:

```powerquery-m
let
    Source = Kusto.Contents("help", "Samples", "StormEvents", []),
    #"Filtered Rows" = Table.SelectRows(Source, each [StartTime] > (DateTime.FixedLocalNow()-#duration(5,0,0,0)))
in
    #"Filtered Rows"
```

### <a name="reaching-kusto-query-limits"></a>Достижение пределов запроса Kusto 

Kusto запросы возвращаются по умолчанию до 500 000 строк или 64 МБ, как описано в [лимитах запросов.](/azure/kusto/concepts/querylimits) Вы можете переопределить эти значения по умолчанию, используя **расширенные параметры** в окне соединения **Azure Data Explorer (Kusto):**

![Дополнительные параметры](media/power-bi-best-practices/advanced-options.png)

Эти параметры [выдают инструкции](/azure/kusto/query/setstatement) с запросом для изменения лимитов запроса по умолчанию:

  * **Ограничение числа записи результатов запроса** генерирует`set truncationmaxrecords`
  * **Ограничение размера результатов запроса в Байтах** генерирует`set truncationmaxsize`
  * **Усечение отсутствовательных результатов** генерирует`set notruncation`

### <a name="using-query-parameters"></a>Использование параметров запроса

Параметры [запроса](/azure/kusto/query/queryparametersstatement) можно использовать для динамического изменения запроса. 

#### <a name="using-a-query-parameter-in-the-connection-details"></a>Использование параметра запроса в деталях соединения

Используйте параметр запроса для фильтрации информации в запросе и оптимизации производительности запроса.
 
В окне **edit Запросы,** **Домашний** > **Расширенный редактор**

1. Найти следующий раздел запроса:

    ```powerquery-m
    Source = Kusto.Contents("<Cluster>", "<Database>", "<Query>", [])
    ```
   
   Пример:

    ```powerquery-m
    Source = Kusto.Contents("Help", "Samples", "StormEvents | where State == 'ALABAMA' | take 100", [])
    ```

1. Замените соответствующую часть запроса параметром. Разделите запрос на несколько частей и переконуируем их обратно с помощью амперсанда (&) вместе с параметром.

   Например, в приведенном выше запросе `State == 'ALABAMA'` мы возьмем часть и `State == '` `'` разделим ее на: и разместим `State` параметр между ними:
   
    ```kusto
    "StormEvents | where State == '" & State & "' | take 100"
    ```

1. Если ваш запрос содержит кавычки, кодируйте их правильно. Например, следующий запрос: 

   ```kusto
   "StormEvents | where State == "ALABAMA" | take 100" 
   ```

   появится в **Расширенном Редакторе** следующим образом с двумя кавычками:

   ```kusto
    "StormEvents | where State == ""ALABAMA"" | take 100"
   ```

   Он должен быть заменен следующим запросом тремя кавычками:

   ```kusto
   "StormEvents | where State == """ & State & """ | take 100"
   ```

#### <a name="use-a-query-parameter-in-the-query-steps"></a>Используйте параметр запроса в шагах запроса

Параметр запроса можно использовать в любом шаге запроса, который его поддерживает. Например, отфильтровать результаты на основе значения параметра.

![результаты фильтрации с использованием параметра](media/power-bi-best-practices/filter-using-parameter.png)

### <a name="dont-use-power-bi-data-refresh-scheduler-to-issue-control-commands-to-kusto"></a>Не используйте планировщик обновления данных Power BI для выдачи команд управления Kusto

Power BI включает в себя планировщик обновления данных, который может периодически выдавать запросы в отношении источника данных. Этот механизм не должен использоваться для планирования команд управления на Kusto, поскольку Power BI предполагает, что все запросы только считываются.

### <a name="power-bi-can-send-only-short-lt2000-characters-queries-to-kusto"></a>Power BI может отправлять&lt;только короткие запросы в Кусто

Если запуск запроса в Power BI приводит к следующей ошибке: _"DataSource.Error: Web.Contents не удалось получить содержимое от ..."_ запрос, вероятно, больше, чем 2000 символов. Power BI использует **Power'sry** для запроса Kusto, выдавая запрос HTTP GET, который кодирует запрос как часть извлекаемого URI. Таким образом, запросы Kusto, выданные Power BI, ограничены максимальной длиной запроса URI (2000 символов, минус небольшое смещение). Как обходной путь можно определить [сохраненную функцию](/azure/kusto/query/schema-entities/stored-functions) в Kusto и использовать эту функцию Power BI в запросе.

## <a name="next-steps"></a>Дальнейшие действия

[Визуализация данных с помощью соединителя Azure Data Explorer для Power BI](power-bi-connector.md)




