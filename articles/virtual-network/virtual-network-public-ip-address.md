---
title: Управление общедоступными IP-адресами | Документация Майкрософт
titleSuffix: Azure Virtual Network
description: Управление общедоступными IP-адресами.  Также Узнайте, как общедоступный IP-адрес является ресурсом с собственными настраиваемыми параметрами.
services: virtual-network
documentationcenter: na
author: asudbring
manager: KumudD
editor: ''
tags: azure-resource-manager
ms.assetid: bb71abaf-b2d9-4147-b607-38067a10caf6
ms.service: virtual-network
ms.subservice: ip-services
ms.devlang: NA
ms.topic: how-to
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/06/2019
ms.author: kumud
ms.openlocfilehash: 92e71a8c08ef2c64509d7e00b0c43abdd58cf036
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91804033"
---
# <a name="manage-public-ip-addresses"></a>Управление общедоступными IP-адресами

Общие сведения об общедоступном IP-адресе, а также о его создании, изменении и удалении. Общедоступный IP-адрес — это ресурс с собственными настраиваемыми параметрами. Назначение общедоступного IP-адреса ресурсу Azure, который поддерживает общие IP-адреса, позволяет следующее.
- Входящий трафик из Интернета к ресурсам, таким как виртуальные машины Azure, шлюзы приложений Azure, подсистемы балансировки нагрузки Azure, VPN-шлюзы Azure и другие. Можно по-прежнему взаимодействовать с некоторыми ресурсами из Интернета, такими как виртуальные машины, если виртуальная машина не имеет назначенного ей общего IP-адреса. Пока виртуальная машина является частью пула внутренней подсистемы балансировки нагрузки, то взаимодействовать невозможно, потому что подсистема балансировки нагрузки имеет назначенный общедоступный IP-адрес. Чтобы определить, можно ли ресурсу для определенной службы Azure назначить общедоступный IP-адрес или он может обращаться через общедоступный IP-адрес другого ресурса Azure, см. документацию для службы.
- Исходящие подключения к Интернету используют предсказуемый IP-адрес. Например, виртуальная машина может отправлять данные в Интернет, не имея назначенного общедоступного IP-адреса. Ее адресом по умолчанию будет сетевой адрес, преобразуемый Azure в непредсказуемый общедоступный адрес. Назначение ресурсу общедоступного IP-адреса позволяет узнать, какой IP-адрес используется для исходящих соединений. Хоть адрес и предсказуемый, он может измениться в зависимости от выбранного метода назначения. Дополнительные сведения см. в разделе [Создание общедоступного IP-адреса](#create-a-public-ip-address). Дополнительную информацию об исходящих подключениях ресурсов Azure см. в разделе [Основные сведения об исходящих подключениях](../load-balancer/load-balancer-outbound-connections.md?toc=%2fazure%2fvirtual-network%2ftoc.json).

## <a name="before-you-begin"></a>Перед началом

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

Перед выполнением действий, описанных в любом разделе этой статьи, выполните следующие задачи.

- Если у вас нет учетной записи Azure, зарегистрируйтесь для получения [бесплатной пробной учетной записи](https://azure.microsoft.com/free).
- При использовании портала перейдите по адресу https://portal.azure.com и войдите с использованием своей учетной записи Azure.
- При использовании команд PowerShell для работы с этой статьей выполняйте их в [Azure Cloud Shell](https://shell.azure.com/powershell) или в PowerShell на своем компьютере. Azure Cloud Shell — это бесплатная интерактивная оболочка, с помощью которой можно выполнять действия, описанные в этой статье. Она включает предварительно установленные общие инструменты Azure и настроена для использования с вашей учетной записью. Для работы с этим руководством требуется модуль Azure PowerShell версии 1.0.0 и выше. Выполните командлет `Get-Module -ListAvailable Az`, чтобы узнать установленную версию. Если вам необходимо выполнить обновление, ознакомьтесь со статьей, посвященной [установке модуля Azure PowerShell](/powershell/azure/install-az-ps). Если модуль PowerShell запущен локально, необходимо также выполнить командлет `Connect-AzAccount`, чтобы создать подключение к Azure.
- При использовании команд интерфейса командной строки Azure (CLI) для работы с этой статьей выполняйте их в [Azure Cloud Shell](https://shell.azure.com/bash) или в интерфейсе командной строки на своем компьютере. Для этого руководства требуется Azure CLI 2.0.31 или более поздней версии. Выполните командлет `az --version`, чтобы узнать установленную версию. Если вам необходимо выполнить установку или обновление, см. статью [Установка Azure CLI 2.0](/cli/azure/install-azure-cli). Если Azure CLI запущен локально, необходимо также выполнить командлет `az login`, чтобы создать подключение к Azure.

Учетная запись, с которой выполняется вход или подключение к Azure с помощью, должна быть назначена роли " [участник сети](../role-based-access-control/built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) " или [настраиваемой роли](../role-based-access-control/custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json) , которой назначены соответствующие действия, перечисленные в разделе [разрешения](#permissions).

За использование общедоступных IP-адресов взимается номинальная плата. Сведения о расценках см. на странице с [ценами на IP-адреса](https://azure.microsoft.com/pricing/details/ip-addresses).

## <a name="create-a-public-ip-address"></a>Создание общедоступного IP-адреса

Инструкции по созданию общедоступных IP-адресов с помощью портала, PowerShell или CLI см. на следующих страницах:

 * [Создание общедоступного IP-адреса — портал](https://docs.microsoft.com/azure/virtual-network/create-public-ip-portal?tabs=option-create-public-ip-standard-zones)
 * [Создание общедоступного IP-адреса — PowerShell](https://docs.microsoft.com/azure/virtual-network/create-public-ip-powershell?tabs=option-create-public-ip-standard-zones)
 * [Создание общедоступного IP-адреса — Azure CLI](https://docs.microsoft.com/azure/virtual-network/create-public-ip-cli?tabs=option-create-public-ip-standard-zones)

>[!NOTE]
>Хотя портал предоставляет возможность создания двух общедоступных IP-адресов (один IPv4 и один IPv6), команды PowerShell и CLI создают один ресурс с адресом для одной или другой IP-версии. Если требуется два ресурса общедоступного IP-адреса, по одному для каждой версии IP, необходимо дважды выполнить команду, указав другие имена и IP-версии для ресурсов общедоступного IP-адреса.

Дополнительные сведения о конкретных атрибутах общедоступного IP-адреса во время создания см. в таблице ниже.

   |Параметр|Необходим?|Подробнее|
   |---|---|---|
   |Версия IP-адреса|Да| Выберите IPv4 или IPv6 или оба варианта. При выборе обеих общедоступных IP-адресов создается 1 адрес IPv4 и 1 IPv6-адрес. Дополнительные сведения об [IPv6 в Azure виртуальных сетей](../virtual-network/ipv6-overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json).|
   |номер SKU|Да|Все общедоступные IP-адреса, созданные до появления номеров SKU, — это **базовые** общедоступные IP-адреса SKU. Номер SKU нельзя изменить после создания общедоступного IP-адреса. Изолированные виртуальные машины, виртуальные машины в группе доступности или масштабируемые наборы виртуальных машин могут использовать номера SKU категории "Базовый" или "Стандартный". Смешивание номеров SKU между виртуальными машинами в группах доступности или масштабируемыми наборами или отдельными виртуальными машинами не допускается. Номер SKU **Базовый**. При создании общедоступного IP-адреса в регионе, который поддерживает зоны доступности, параметр **Availability zone** (Зона доступности) принимает значение *Нет* по умолчанию. Базовые общедоступные IP-адреса не поддерживают зоны доступности. Номер SKU **Стандартный**. Общедоступный IP-адрес стандартного номера SKU может быть связан с виртуальной машиной или интерфейсной частью подсистемы балансировки нагрузки. При создании общедоступного IP-адреса в регионе, который поддерживает зоны доступности, параметр **Availability zone** (Зона доступности) принимает значение *Избыточное между зонами* по умолчанию. Дополнительные сведения о зонах доступности см. в параметре **Зона доступности**. Стандартный номер SKU необходим при связывании адреса с подсистемой балансировки нагрузки категории "Стандартный". Дополнительные сведения о подсистемах балансировки нагрузки см. в статье [Azure Load Balancer Standard overview (Preview)](../load-balancer/load-balancer-standard-overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json) (Обзор Azure Load Balancer категории "Стандартный" (предварительная версия)). При назначении общедоступного IP-адреса стандартных SKU сетевому интерфейсу виртуальной машины необходимо явно разрешить предполагаемый трафик с помощью [группы безопасности сети](security-overview.md#network-security-groups). Обмен данными с ресурсом будет невозможен, пока вы не создадите и не свяжете группу безопасности сети и явно не разрешите нужный трафик.|
   |name|Да|Имя должно быть уникальным в пределах выбранной группы ресурсов.|
   |Назначение IP-адресов|Да|**Динамическое** — динамические адреса назначаются, только если общедоступный IP-адрес связан с ресурсом Azure, который запускается в первый раз. Динамические адреса, назначенные ресурсу (например, виртуальной машине), могут измениться после остановки (освобождения) и последующего перезапуска этой виртуальной машины. Если виртуальная машина перезагружается или остановлена (не освобождается), адрес не изменится. Динамические адреса освобождаются, когда удаляется связь ресурса общедоступного IP-адреса и связанного с ним ресурса. **Статическое** — статические адреса назначаются при создании общедоступного IP-адреса. Статические адреса не освобождаются, пока не будет удален ресурс общедоступного IP-адреса. Если адрес не связан с ресурсом, его метод назначения можно изменить после создания адреса. Если адрес связан с ресурсом, то его метод назначения невозможно изменить. При выборе *IPv6* для **версии IP**метод назначения должен быть *динамическим* для базового SKU.  Адреса стандартных номеров SKU *статичны* для IPv4 и IPv6. |
   |Время ожидания простоя (в минутах)|Нет|Время (в минутах), в течение которого подключение TCP или HTTP остается открытым без привязки к клиентам при отправке запросов для проверки активности. При выборе IPv6 в качестве **версии IP** это значение невозможно изменить. |
   |Метка DNS-имени|Нет|Должна быть уникальной в пределах расположения Azure, в котором создается имя (для всех подписок и клиентов). Azure автоматически регистрирует имя и IP-адрес в своей DNS (вы можете подключаться к ресурсу, используя это имя). Azure добавляет подсеть по умолчанию, например *location.cloudapp.azure.com* (где location — это выбранное вами расположение) к имени, которое вы предоставили, для создания полного имени DNS. Если вы решили создать обе версии адресов, им назначается одинаковое имя DNS. Служба Azure DNS по умолчанию содержит обе записи имен IPv4 (A) и IPv6 (AAAA) и отвечает на поиск имени DNS, используя обе записи. Клиент выбирает, с каким адресом (IPv4 или IPv6) взаимодействовать. Вместо или в дополнение к использованию метки DNS-имени с суффиксом по умолчанию можно использовать службу Azure DNS для настройки DNS-имени с пользовательским суффиксом, которое преобразуется в общедоступный IP-адрес. Дополнительные сведения см. в разделе [Общедоступный IP-адрес](../dns/dns-custom-domain.md?toc=%2fazure%2fvirtual-network%2ftoc.json#public-ip-address).|
   |Имя (отображается, только если выбран вариант "IP-версия **обоих**")|Да, если выбрать версию IP для **обоих**|Имя должно отличаться от того, что вы ввели для первого **имени** в этом списке. Если вы решили создать IPv4- и IPv6-адрес, портал создаст два отдельных ресурса общедоступных IP-адресов, каждому из которых назначена своя версия.|
   |Назначение IP-адресов (отображается, только если выбран вариант "IP-версия **обоих**")|Да, если выбрать версию IP для **обоих**|Те же ограничения, что и для назначения IP-адресов выше|
   |Подписка|Да|Должен существовать в той же [подписке](../azure-glossary-cloud-terminology.md?toc=%2fazure%2fvirtual-network%2ftoc.json#subscription) , что и ресурс, к которому вы свяжете общедоступный IP-адрес.|
   |Группа ресурсов|Да|Может находиться в той же или другой [группе ресурсов](../azure-glossary-cloud-terminology.md?toc=%2fazure%2fvirtual-network%2ftoc.json#resource-group) , что и ресурс, к которому вы свяжете общедоступный IP-адрес.|
   |Расположение|Да|Должно находиться в том же [расположении](https://azure.microsoft.com/regions), которое также называется регионом, как ресурс, к которому вы свяжете общедоступный IP-адрес.|
   |Зона доступности| Нет | Этот параметр отображается только в том случае, если выбрано поддерживаемое расположение. Список поддерживаемых расположений см. в статье [Общие сведения о зонах доступности в Azure (предварительная версия)](../availability-zones/az-overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json). При выборе номера SKU **Базовый**, значение *Нет* будет выбрано автоматически. Если нужно гарантировать наличие определенной зоны, можно выбрать ее. Ни один вариант нельзя считать избыточным между зонами. При выборе номера SKU **Стандартный** автоматически выбирается избыточность между зонами, благодаря чему путь к данным становится устойчивым к сбоям зоны. Если нужно обеспечить определенную зону, неустойчивую к сбоям зоны, можно выбрать ее.

## <a name="view-modify-settings-for-or-delete-a-public-ip-address"></a>Просмотр, изменение параметров или удаление общедоступного IP-адреса

   - **Представление/список**: Просмотр параметров общедоступного IP-адреса, включая SKU, адрес, любые применимые ассоциации (например, сетевой адаптер виртуальной машины, Load Balancer интерфейсный сервер).
   - **Изменение**. чтобы изменить параметры с помощью сведений на шаге 4, [Создайте общедоступный IP-адрес](#create-a-public-ip-address), например время ожидания ПРОСТОЯ, метку DNS-имени или метод назначения.
   >[!WARNING]
   >Чтобы изменить назначение для общедоступного IP-адреса со статического на динамический, необходимо сначала отменить связь адреса из любых применимых IP-конфигураций (см. раздел **Delete** ).  Также обратите внимание, что при изменении метода назначения со статического на динамический вы теряете IP-адрес, назначенный общедоступному IP-адресу. В Azure общедоступные DNS-серверы поддерживают сопоставление между статическими или динамическими адресами и метками (определенными) имени DNS. При этом динамический IP-адрес можно изменить при запуске виртуальной машины, которая была остановлена (освобождена). Чтобы предотвратить изменение адреса, назначьте статический IP-адрес.
   
|Операция|Портал Azure|Azure PowerShell|Azure CLI|
|---|---|---|---|
|Представление | В разделе **Обзор** общедоступного IP-адреса |[Get-азпублиЦипаддресс](/powershell/module/az.network/get-azpublicipaddress) для получения объекта общедоступного IP-адреса и просмотра его параметров| [AZ Network public-IP демонстрация](/cli/azure/network/public-ip#az-network-public-ip-show) для отображения параметров|
|Список | В категории **общедоступные IP-адреса** |[Get-азпублиЦипаддресс](/powershell/module/az.network/get-azpublicipaddress) для получения одного или нескольких объектов общедоступного IP-адреса и просмотра его параметров|[AZ Network public-IP List](/cli/azure/network/public-ip#az-network-public-ip-list) для вывода списка общедоступных IP-адресов|
|Изменить | Для несвязанного IP-адреса выберите **Конфигурация** , чтобы изменить время ожидания простоя, метку DNS-имени или изменить назначение базового IP-адреса со статического на динамический.  |[Set-азпублиЦипаддресс](/powershell/module/az.network/set-azpublicipaddress) для обновления параметров |[AZ Network public-IP-обновление](/cli/azure/network/public-ip#az-network-public-ip-update) для обновления |

   - **Удаление**: для удаления общедоступных IP-адресов необходимо, чтобы объект общедоступного объекта не был связан с IP-конфигурацией или сетевым адаптером виртуальной машины. Дополнительные сведения см. в таблице ниже.

|Ресурс|Портал Azure|Azure PowerShell|Azure CLI|
|---|---|---|---|
|[Виртуальная машина](https://docs.microsoft.com/azure/virtual-network/remove-public-ip-address-vm)|Выберите отменить связь **, чтобы отрвать связь с IP** -адресом из конфигурации сетевого адаптера, а затем выберите **Удалить**.|[Set-азпублиЦипаддресс](/powershell/module/az.network/set-azpublicipaddress) , чтобы отменить связь IP-адреса с КОНФИГУРАЦИЕЙ сетевого адаптера; [Remove-азпублиЦипаддресс](/powershell/module/az.network/remove-azpublicipaddress) to delete|[AZ Network общедоступное обновление IP-адрес — удалите](/cli/azure/network/public-ip#az-network-public-ip-update) , чтобы отменить связь IP-адреса с КОНФИГУРАЦИЕЙ сетевого адаптера. [AZ Network public-IP Delete](/cli/azure/network/public-ip#az-network-public-ip-delete) для удаления |
|Интерфейс Load Balancer | Перейдите к неиспользуемому общедоступному IP-адресу и выберите " **сопоставить** " и укажите Load Balancer с соответствующей конфигурацией ИНТЕРФЕЙСНЫХ IP-адресов, чтобы заменить ее (затем старый IP может быть удален с помощью того же метода, что и для виртуальной машины).  | [Set-азлоадбаланцерфронтендипконфиг](/powershell/module/az.network/set-azloadbalancerfrontendipconfig) , чтобы связать новый интерфейс конфигурации внешнего IP-адреса с общедоступной Load Balancer; [Remove-азпублиЦипаддресс](/powershell/module/az.network/remove-azpublicipaddress) для удаления; также может использовать [Remove-азлоадбаланцерфронтендипконфиг](/powershell/module/az.network/remove-azloadbalancerfrontendipconfig) для удаления внешней IP-конфигурации, если имеется более одного |[AZ Networking переднего плана IP-адреса](/cli/azure/network/lb/frontend-ip?view=azure-cli-latest#az_network_lb_frontend_ip_update) , чтобы связать новый интерфейс конфигурации внешнего IP-адреса с общедоступной Load Balancer; [Remove-азпублиЦипаддресс](/powershell/module/az.network/remove-azpublicipaddress) для удаления; также можно использовать команду [AZ Network фунтов интерфейса-IP Delete](/cli/azure/network/lb/frontend-ip?view=azure-cli-latest#az_network_lb_frontend_ip_delete) для удаления внешней IP-конфигурации, если имеется более одного.|
|Брандмауэр|Недоступно| [Освобождение ()](https://docs.microsoft.com/azure/firewall/firewall-faq#how-can-i-stop-and-start-azure-firewall) для отмены выделения брандмауэра и удаления всех IP-конфигураций | [AZ Network Firewall IP-Config удаление](/cli/azure/ext/azure-firewall/network/firewall/ip-config#ext_azure_firewall_az_network_firewall_ip_config_delete) для удаления IP-адреса (но необходимо использовать PowerShell для отмены выделения памяти)|

>[!NOTE]
>После создания некоторых ресурсов их общедоступные IP-адреса не могут быть изменены или удалены.  Это: шлюз Azure NAT, VPN-шлюз Azure, шлюз приложений Azure.

## <a name="virtual-machine-scale-sets"></a>Масштабируемые наборы виртуальных машин

При использовании масштабируемого набора виртуальных машин с общедоступными IP-адресами не существует отдельных общедоступных объектов, связанных с отдельными экземплярами виртуальных машин. Однако [для создания IP-адресов экземпляра можно использовать](https://azure.microsoft.com/resources/templates/101-vmms-with-public-ip-prefix/)объект префикса общедоступного протокола IP.

Чтобы получить список общедоступных IP-адресов в масштабируемом наборе виртуальных машин, можно использовать PowerShell ([Get-азпублиЦипаддресс-виртуалмачинескалесетнаме](/powershell/module/az.network/get-azpublicipaddress)) или CLI ([AZ vmss List-instance-public-IP](/cli/azure/vmss?view=azure-cli-latest#az_vmss_list_instance_public_ips)).

Дополнительные сведения см. в статье [Сеть для масштабируемых наборов виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-networking#public-ipv4-per-virtual-machine).

## <a name="assign-a-public-ip-address"></a>Назначение общедоступного IP-адреса

Узнайте, как назначать общедоступные IP-адреса следующим ресурсам:

- Виртуальная машина [Windows](../virtual-machines/windows/quick-create-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json) или [Linux](../virtual-machines/linux/quick-create-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json) (при создании) или на [существующую виртуальную машину](virtual-network-network-interface-addresses.md#add-ip-addresses)
- [Общедоступные Load Balancer](../load-balancer/load-balancer-get-started-internet-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json)
- [Шлюз приложений](../application-gateway/application-gateway-create-gateway-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json)
- [Подключение типа "сеть — сеть" с помощью VPN-шлюза](../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json)
- [Масштабируемый набор виртуальных машин](../virtual-machine-scale-sets/virtual-machine-scale-sets-portal-create.md?toc=%2fazure%2fvirtual-network%2ftoc.json)

## <a name="permissions"></a>Разрешения

Для выполнения задач с общедоступными IP-адресами учетной записи должна быть назначена роль [Участник сетей](../role-based-access-control/built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) или [пользовательская](../role-based-access-control/custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json) роль, которой назначены соответствующие разрешения, перечисленные в таблице ниже.

| Действие                                                             | Имя                                                           |
| ---------                                                          | -------------                                                  |
| Microsoft.Network/publicIPAddresses/read                           | Чтение общедоступного IP-адреса.                                          |
| Microsoft.Network/publicIPAddresses/write                          | Создание или обновление общедоступного IP-адреса.                           |
| Microsoft.Network/publicIPAddresses/delete                         | Удаление общедоступного IP-адреса                                     |
| Microsoft.Network/publicIPAddresses/join/action                    | Связывание общедоступного IP-адреса с ресурсом.                    |

## <a name="next-steps"></a>Дальнейшие шаги

- Создайте общедоступный IP-адрес с помощью примеров сценариев [PowerShell](powershell-samples.md) или [Azure CLI](cli-samples.md) либо на основе [шаблонов Azure Resource Manager](template-samples.md).
- Создание и назначение [определений политик Azure](policy-samples.md) для общедоступных IP-адресов
