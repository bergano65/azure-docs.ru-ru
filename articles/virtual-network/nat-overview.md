---
title: Что такое NAT виртуальной сети Azure
titlesuffix: Azure Virtual Network
description: Обзор возможностей, ресурсов, архитектуры и реализации виртуальной сети NAT. Узнайте, как работает NAT в виртуальной сети и как использовать ресурсы шлюза NAT в облаке.
services: virtual-network
documentationcenter: na
author: asudbring
manager: KumudD
ms.service: virtual-network
ms.subservice: nat
Customer intent: As an IT administrator, I want to learn more about Virtual Network NAT, its NAT gateway resources, and what I can use them for.
ms.devlang: na
ms.topic: overview
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/14/2020
ms.author: allensu
ms.openlocfilehash: 3ef219841769d7bdc5fc6e3f3aa50465b6159f82
ms.sourcegitcommit: 61d850bc7f01c6fafee85bda726d89ab2ee733ce
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2020
ms.locfileid: "84341326"
---
# <a name="what-is-virtual-network-nat"></a>Что такое NAT виртуальной сети?

NAT (преобразование сетевых адресов) виртуальной сети упрощает возможность исходящего интернет-подключения для виртуальных сетей. При настройке NAT в подсети все исходящие подключения используют указанные статические общедоступные IP-адреса.  Исходящее подключение возможно без подсистемы балансировки нагрузки или общедоступных IP-адресов путем прямого подключения к виртуальным машинам. NAT полностью управляемое и отличается высокой устойчивостью.

<!-- 
<img src="./media/nat-overview/flow-map.svg" width="270" align="center">
![Virtual Network NAT](./media/nat-overview/flow-map.svg)
-->

<p align="center">
  <img src="./media/nat-overview/flow-map.svg" width="256" title="NAT виртуальной сети">
</p>



*Рисунок. NAT виртуальной сети*

## <a name="static-ip-addresses-for-outbound-only"></a>Статические IP-адреса только для исходящего трафика

Исходящие подключения можно определить для каждой подсети с использованием NAT.  У нескольких подсетей в одной виртуальной сети могут быть разные ресурсы NAT. Подсеть настраивается путем указания того, какой ресурс шлюза NAT использовать. Все исходящие потоки UDP и TCP из любого экземпляра виртуальной машины будут использовать NAT. 

NAT совместимо с ресурсами общедоступного IP-адреса с SKU "Стандартный", ресурсами префикса общедоступного IP-адреса или их сочетанием.  Вы можете использовать префикс общедоступного IP-адреса напрямую или распространять общедоступные IP-адреса префикса по нескольким ресурсам шлюза NAT. NAT будет очищать весь трафик, кроме трафика в диапазоне IP-адресов префикса.  Это облегчает работу с любым списком разрешенных IP-адресов для развертываний.

Весь исходящий трафик для подсети автоматически обрабатывается NAT без каких-либо пользовательских настроек.  Определяемые пользователем маршруты не нужны. У NAT есть приоритет над другими сценариями исходящих подключений, и оно заменяет стандартный адрес назначения в Интернете для подсети.

## <a name="on-demand-snat-with-multiple-ip-addresses-for-scale"></a>SNAT по запросу при использовании нескольких IP-адресов для масштабирования

NAT использует "преобразование сетевых адресов портов" (PNAT или PAT), которое рекомендуется для большинства рабочих нагрузок. Динамические или дивергентные рабочие нагрузки можно легко разместить с помощью выделения исходящего потока по запросу. Исключается расширенное предварительное планирование, предварительное распределение и, как следствие, избыточная подготовка исходящих ресурсов. Ресурсы портов SNAT являются общими, доступны во всех подсетях, использующих конкретный ресурс шлюза NAT, и предоставляются при необходимости.

По одному общедоступному IP-адресу NAT можно выполнять до 64 000 параллельных потоков UDP и TCP. Можно начать с одного IP-адреса и увеличить масштаб до 16 общедоступных IP-адресов.

NAT позволяет создавать потоки из виртуальной сети в Интернете. Возврат трафика из Интернета разрешен только в ответ на активный поток.

В отличие от исходящих SNAT-подключений подсистемы балансировки нагрузки, NAT не имеет ограничений на то, какой частный IP-адрес экземпляра виртуальной машины может устанавливать исходящие подключения.  Дополнительные конфигурации IP-адресов могут создавать исходящее подключение к Интернету с использованием NAT.

## <a name="coexistence-of-inbound-and-outbound"></a>Сосуществование входящего и исходящего трафика

NAT совместимо со следующими ресурсами SKU "Стандартный":

- Подсистема балансировки нагрузки
- Общедоступный IP-адрес
- Префикс общедоступного IP-адреса

При совместном использовании с NAT эти ресурсы обеспечивают входящее подключение к Интернету для подсетей. NAT обеспечивает все исходящие подключения к Интернету из ваших подсетей.

В отношении NAT и совместимых функций SKU "Стандартный" учитывается направление запуска потока. Сценарии входящих и исходящих подключений могут сосуществовать. Эти сценарии будут получать правильные преобразованные сетевые адреса, так как эти функции учитывают направление потока. 

<!-- 
<img src="./media/nat-overview/flow-direction4.svg" width="500" align="center">
![Virtual Network NAT flow direction](./media/nat-overview/flow-direction4.svg)
-->
<p align="center">
  <img src="./media/nat-overview/flow-direction4.svg" width="512" title="Направление потоков в NAT виртуальной сети">
</p>

*Рисунок. Направление потоков в NAT виртуальной сети*

## <a name="fully-managed-highly-resilient"></a>Полное управление и высокая устойчивость

NAT полностью горизонтально масштабируется с самого начала. Не требуются операции по увеличению или расширению.  Azure управляет работой NAT.  NAT всегда располагает несколькими доменами сбоя и может выдерживать многочисленные сбои без простоя.

## <a name="tcp-reset-for-unrecognized-flows"></a>Сброс TCP для неопознанных потоков

Частная сторона NAT отправляет пакеты сброса TCP при попытках обмена данными в рамках TCP-подключения, которого не существует. Одним из таких примеров являются подключения, время ожидания простоя которых истекло. Следующий полученный пакет вернет сброс TCP по частному IP-адресу, чтобы сообщить о закрытии и принудительно закрыть подключение.

Общедоступная сторона NAT не создает пакеты сброса TCP или любой другой трафик.  Создается только трафик, генерируемый пользовательской виртуальной сетью.

## <a name="configurable-tcp-idle-timeout"></a>Настраиваемое время ожидания в режиме простоя для TCP-подключения

По умолчанию время ожидания в режиме простоя для TCP-подключения равно 4 минутам, но его можно увеличить до 120 минут. Любое действие с потоком также может повлечь сброс таймера простоя, в том числе проверка активности TCP-подключения.

## <a name="regional-or-zone-isolation-with-availability-zones"></a>Региональная и зональная изоляция с помощью зон доступности

По умолчанию NAT действует в пределах региона. При создании сценариев с [зонами доступности](../availability-zones/az-overview.md) NAT можно изолировать в пределах определенной зоны (зональное развертывание).

<!-- 
<img src="./media/nat-overview/az-directions.svg" width="500" align="center">
![Virtual Network NAT with availability zones](./media/nat-overview/az-directions.svg)
-->

<p align="center">
  <img src="./media/nat-overview/az-directions.svg" width="512" title="NAT виртуальной сети с зонами доступности">
</p>

*Рисунок. NAT виртуальной сети с зонами доступности*

## <a name="multi-dimensional-metrics-for-observability"></a>Многомерные метрики для наблюдаемости

Вы можете отслеживать работу NAT, используя многомерные метрики, доступные в Azure Monitor. Эти метрики можно использовать для отслеживания использования и устранения неполадок.  Ресурсы шлюза NAT предполагают следующие метрики:
- Байты
- Пакеты
- Отброшенные пакеты
- Общее число подключений SNAT
- Число переходов состояния подключения SNAT за интервал

<!-- "ADD when PM is done" Learn more about [NAT gateway metrics](./nat-gateway-metrics.md) -->

## <a name="sla"></a>Соглашение об уровне обслуживания

В общедоступной версии услуга NAT доступна не менее чем на 99,9 %.


## <a name="pricing"></a>Цены

Шлюз NAT оплачивается по двум отдельным единицам измерения:

| средство измерения. | Тариф |
| --- | --- |
| Часы использования ресурса | 0,045 долл. США в час |
| Обработанные данные | 0,045 долл. США за ГБ |

Часы использования ресурса учитываются как период времени, в течение которого существует ресурс шлюза NAT.
Учитываются обработанные данные всего трафика, проходящего через ресурс шлюза NAT.

## <a name="availability"></a>Доступность

NAT виртуальной сети и ресурс шлюза NAT поддерживаются во всех [регионах](https://azure.microsoft.com/global-infrastructure/regions/) общедоступного облака Azure.

## <a name="support"></a>Поддержка

Поддержка NAT осуществляется с помощью стандартных каналов.

## <a name="feedback"></a>Отзывы

Нам важно знать, как можно улучшить эту услугу. Кроме того, вы можете вносить предложения и идеи для NAT в разделе [UserVoice](https://aka.ms/natuservoice).


## <a name="limitations"></a>Ограничения

* NAT совместимо с общедоступным IP-адресом номера SKU (цен. категории "Стандартный"), префиксами общедоступного IP-адреса и ресурсами подсистемы балансировки нагрузки. Ресурсы ценовой категории "Базовый"(например, Load Balancer ценовой категории "Базовый") и все производные от них продукты несовместимы с NAT.  Базовые ресурсы необходимо размещать в подсети, в которой не настроено NAT.
* Поддерживается семейство IPv4-адресов.  NAT не взаимодействует с семейством IPv6-адресов.  NAT нельзя развернуть в подсети с префиксом IPv6.
* Ведение журнала потоков NSG не поддерживается при использовании NAT.
* NAT не распространяется на несколько виртуальных сетей.

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о [ресурсе шлюза NAT](./nat-gateway-resource.md).
* [Расскажите в UserVoice, что нам следует создать далее для NAT виртуальной сети](https://aka.ms/natuservoice).

