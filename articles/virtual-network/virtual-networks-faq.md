---
title: Виртуальная сеть Azure. Вопросы и ответы
titlesuffix: Azure Virtual Network
description: Ответы на наиболее часто задаваемые вопросы о виртуальных сетях Microsoft Azure.
services: virtual-network
documentationcenter: na
author: KumudD
manager: twooley
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/12/2019
ms.author: kumud
ms.openlocfilehash: ecb840d97a45479d32079766807b4f2788cc29ec
ms.sourcegitcommit: 49c4b9c797c09c92632d7cedfec0ac1cf783631b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/05/2019
ms.locfileid: "70382905"
---
# <a name="azure-virtual-network-frequently-asked-questions-faq"></a>Виртуальная сеть Azure: часто задаваемые вопросы

## <a name="virtual-network-basics"></a>Основные сведения о виртуальных сетях

### <a name="what-is-an-azure-virtual-network-vnet"></a>Что представляет собой виртуальная сеть Azure?
Виртуальная сеть Azure — это представление сети в облаке. Это логическая изоляция облака Azure, выделенного для вашей подписки. С помощью виртуальной сети можно подготовить VPN к работе в Azure и управлять ею. Кроме того, при необходимости можно связать виртуальную сеть с другими виртуальными сетями в Azure или с локальной ИТ-инфраструктурой для создания гибридных или распределенных решений. Каждая создаваемая виртуальная сеть имеет собственный блок CIDR и может быть связана с другими виртуальных сетей и локальными сетями при условии, что блоки CIDR не перекрываются. Кроме того, вы можете изменять настройки DNS-серверов для виртуальных сетей и разбивать виртуальные сети на подсети.

Вы можете использовать виртуальные сети для указанных ниже целей.

* Создание выделенной виртуальной сети только для частного облака. Иногда для вашего решения не нужна распределенная конфигурация. При создании виртуальной сети подключенные к ней службы и виртуальные машины могут безопасно обмениваться данными непосредственно друг с другом в облаке. В рамках вашего решения вы все еще можете настроить подключения конечных точек для виртуальных машин и служб, которым необходимо подключение к Интернету.

* Безопасное расширение центра обработки данных. С помощью виртуальных сетей можно создавать традиционные VPN типа «сеть-сеть» (S2S) для безопасного масштабирования емкости центра обработки данных. Для создания безопасного подключения между корпоративным VPN-шлюзом и Azure в VPN-подключениях S2S используется IPsec.

* Включите сценарии гибридного облака. Виртуальные сети предоставляют гибкие возможности для использования целого ряда сценариев гибридного облака. Вы можете безопасно подключать облачные приложения к локальным системам любого типа, например к большим ЭВМ и системам под управлением ОС Unix.

### <a name="how-do-i-get-started"></a>Как начать работу?
Чтобы начать работу, ознакомьтесь с [документацией по виртуальным сетям](https://docs.microsoft.com/azure/virtual-network/). В ней представлены описание и информация о развертывании для всех компонентов виртуальной сети.

### <a name="can-i-use-vnets-without-cross-premises-connectivity"></a>Можно ли использовать виртуальные сети без распределенных подключений?
Да. Вы можете использовать виртуальную сеть без локального подключения. Например, вы можете запустить исключительно в виртуальной сети Azure контроллеры доменов Active Directory для Microsoft Windows Server или фермы SharePoint.

### <a name="can-i-perform-wan-optimization-between-vnets-or-a-vnet-and-my-on-premises-data-center"></a>Можно ли выполнять оптимизацию глобальной сети между виртуальными сетями или между виртуальной сетью и локальным центром обработки данных?
Да. Вы можете развернуть [виртуальные сетевые устройства оптимизации глобальной сети](https://azure.microsoft.com/marketplace/?term=wan+optimization), предоставляемые несколькими поставщиками через Azure Marketplace.

## <a name="configuration"></a>Конфигурация

### <a name="what-tools-do-i-use-to-create-a-vnet"></a>Какие средства необходимо использовать для создания виртуальной сети?
Для создания или настройки виртуальной сети можно использовать указанные ниже средства.

* портала Azure
* PowerShell
* Azure CLI
* Файл конфигурации сети (netcfg — только для классических виртуальных сетей). См. статью [Настройка виртуальной сети с помощью файла конфигурации сети](virtual-networks-using-network-configuration-file.md).

### <a name="what-address-ranges-can-i-use-in-my-vnets"></a>Какие диапазоны адресов можно использовать в виртуальных сетях?
Любой диапазон IP-адресов, определенный в [RFC 1918](https://tools.ietf.org/html/rfc1918). Например, 10.0.0.0/16. Невозможно добавить следующий диапазон адресов:
* 224.0.0.0/4 (многоадресная рассылка)
* 255.255.255.255/32 (широковещательный адрес)
* 127.0.0.0/8 (петлевой адрес);
* 169.254.0.0/16 (локальный адрес канала);
* 168.63.129.16/32 (внутренний DNS)

### <a name="can-i-have-public-ip-addresses-in-my-vnets"></a>Можно ли в виртуальных сетях использовать общедоступные IP-адреса?
Да. Дополнительные сведения о диапазонах общедоступных IP-адресов см. в разделе [Create a virtual network](manage-virtual-network.md#create-a-virtual-network) (Создание виртуальной сети). Общедоступные IP-адреса не доступны непосредственно из Интернета.

### <a name="is-there-a-limit-to-the-number-of-subnets-in-my-vnet"></a>Существует ли ограничение на количество подсетей в виртуальной сети?
Да. Дополнительные сведения см. в разделе [Ограничения сети](../azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#networking-limits). Адресные пространства подсетей не должны пересекаться друг с другом.

### <a name="are-there-any-restrictions-on-using-ip-addresses-within-these-subnets"></a>Существуют ли ограничения на использование IP-адресов в пределах этих подсетей?
Да. Azure резервирует 5 IP-адресов в каждой подсети. Это x. x. x. 0-x. x. x. 3 и последний адрес подсети. x. x. x. 1-x. x. x. 3 зарезервировано в каждой подсети для служб Azure.   
- x. x. x. 0: Сетевой адрес
- x. x. x. 1: Зарезервировано Azure для шлюза по умолчанию
- x. x. x. 2, x. x. x. 3: Зарезервировано Azure для отображения Azure DNS IP-адресов в пространстве виртуальной сети
- x. x. x. 255: Сетевой широковещательный адрес

### <a name="how-small-and-how-large-can-vnets-and-subnets-be"></a>Насколько большими или малыми могут быть виртуальные сети и подсети?
Самая маленькая поддерживаемая подсеть — /29, а самая большая — /8 (согласно определениям подсети CIDR).

### <a name="can-i-bring-my-vlans-to-azure-using-vnets"></a>Можно ли переносить виртуальные локальные сети в Azure с помощью виртуальных сетей?
Нет. Виртуальные сети представляют собой наложения Layer-3. Azure не поддерживает семантику Layer-2.

### <a name="can-i-specify-custom-routing-policies-on-my-vnets-and-subnets"></a>Можно ли в виртуальных сетях и подсетях задавать настраиваемые политики маршрутизации?
Да. Вы можете создать таблицу маршрутов и связать ее с подсетью. Дополнительные сведения о маршрутизации в Azure см. в разделе [Настраиваемые маршруты](virtual-networks-udr-overview.md#custom-routes).

### <a name="do-vnets-support-multicast-or-broadcast"></a>Поддерживают ли виртуальные сети технологии многоадресной или широковещательной рассылки?
Нет. Многоадресная и широковещательная рассылка не поддерживаются.

### <a name="what-protocols-can-i-use-within-vnets"></a>Какие протоколы можно использовать в рамках виртуальных сетей?
Вы можете использовать в виртуальных сетях протоколы TCP, UDP и ICMP, относящиеся к стеку TCP/IP. Между виртуальными сетями поддерживается одноадресная передача. Исключением является одноадресная передача по протоколу DHCP (исходный порт UDP/68, конечный порт UDP/67). В виртуальных сетях блокируются многоадресные и широковещательные рассылки, инкапсулированные пакеты IP in IP и пакеты, передаваемые по протоколу GRE (Generic Routing Encapsulation). 

### <a name="can-i-ping-my-default-routers-within-a-vnet"></a>Можно ли в виртуальной сети проверять связь с маршрутизаторами по умолчанию?
Нет.

### <a name="can-i-use-tracert-to-diagnose-connectivity"></a>Можно ли использовать команду tracert для диагностики подключения?
Нет.

### <a name="can-i-add-subnets-after-the-vnet-is-created"></a>Можно ли добавлять подсети после создания виртуальной сети?
Да. Вы можете в любое время добавлять подсети в виртуальные сети при условии, что диапазон адресов добавляемой подсети не принадлежит другой подсети и в диапазоне адресов виртуальной сети остается свободное место.

### <a name="can-i-modify-the-size-of-my-subnet-after-i-create-it"></a>Можно ли изменить размер подсети после ее создания?
Да. Вы можете добавлять, удалять, расширять или уменьшать подсеть (если в ней не развернуты виртуальные машины и службы).

### <a name="can-i-modify-subnets-after-i-created-them"></a>Можно ли изменять подсети после их создания?
Да. Вы можете добавлять, удалять и изменять блоки CIDR, используемые виртуальной сетью.

### <a name="if-i-am-running-my-services-in-a-vnet-can-i-connect-to-the-internet"></a>Могут ли службы, работающие в виртуальной сети, подключиться к Интернету?
Да. Все службы, развернутые в виртуальной сети, могут подключаться к Интернету. Дополнительные сведения об исходящих интернет-подключениях в Azure см. в статье [Исходящие подключения в Azure](../load-balancer/load-balancer-outbound-connections.md?toc=%2fazure%2fvirtual-network%2ftoc.json). Если вы хотите подключить входящий трафик к ресурсу, развернутому с помощью Resource Manager, необходимо назначить ему общедоступный IP-адрес. Дополнительные сведения об общедоступных IP-адресах см. в [этой статье](virtual-network-public-ip-address.md). У каждой облачной службы, развернутой в Azure, есть общедоступный виртуальный IP-адрес. Чтобы эти службы могли принимать подключения из Интернета, необходимо определить входные конечные точки для ролей "платформа как услуга" и конечные точки для виртуальных машин.

### <a name="do-vnets-support-ipv6"></a>Поддерживают ли виртуальные сети протокол IPv6?
Нет. В настоящее время невозможно использовать протокол IPv6 в виртуальных сетях. Однако вы можете назначить IPv6-адреса подсистемам балансировки нагрузки Azure для распределения нагрузки виртуальных машин. Дополнительные сведения см. в статье [Общие сведения о поддержке IPv6 для Azure Load Balancer](../load-balancer/load-balancer-ipv6-overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json).

### <a name="can-a-vnet-span-regions"></a>Может ли виртуальная сеть охватывать несколько регионов?
Нет. Виртуальную сеть можно использовать только в пределах одного региона. Однако она охватывает зоны доступности. См. дополнительные сведения о [зонах доступности](../availability-zones/az-overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json). Вы можете подключать виртуальные сети в разных регионах с помощью пиринговой связи. Дополнительные сведения см. в статье [Пиринг между виртуальными сетями](virtual-network-peering-overview.md).

### <a name="can-i-connect-a-vnet-to-another-vnet-in-azure"></a>Можно ли подключить виртуальную сеть к другой виртуальной сети в Azure?
Да. Вы можете подключить одну виртуальную сеть к другой с помощью одного из следующих методов.
- **Пиринг между виртуальными сетями**. Дополнительные сведения см. в статье [Обзор пиринга между виртуальными сетями](virtual-network-peering-overview.md)
- **VPN-шлюз Azure**. Дополнительные сведения см. в статье [Настройка подключения VPN-шлюза между виртуальными сетями с помощью Azure CLI](../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json). 

## <a name="name-resolution-dns"></a>Разрешение имен (DNS)

### <a name="what-are-my-dns-options-for-vnets"></a>Каковы параметры DNS для виртуальных сетей?
Все доступные параметры DNS есть в таблице решений на странице [Разрешение имен для виртуальных машин и экземпляров ролей](virtual-networks-name-resolution-for-vms-and-role-instances.md) .

### <a name="can-i-specify-dns-servers-for-a-vnet"></a>Можно ли указать DNS-серверы для виртуальной сети?
Да. Вы можете указать IP-адреса DNS-сервера в параметрах виртуальной сети. Этот параметр используется в качестве DNS-сервера по умолчанию для всех виртуальных машин в виртуальной сети.

### <a name="how-many-dns-servers-can-i-specify"></a>Сколько DNS-серверов можно указать?
См. раздел [Ограничения сети](../azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#networking-limits).

### <a name="can-i-modify-my-dns-servers-after-i-have-created-the-network"></a>Можно ли изменять DNS-серверы после создания сети?
Да. Вы можете в любое время изменить список DNS-серверов для виртуальной сети. После изменения списка DNS-серверов необходимо перезапустить все виртуальные машины в виртуальной сети, чтобы они начали использовать параметры нового DNS-сервера.

### <a name="what-is-azure-provided-dns-and-does-it-work-with-vnets"></a>Что такое DNS, предоставленная Azure, и работает ли она с виртуальными сетями?
DNS, предоставленная Azure, — это мультитенантная служба DNS, предлагаемая корпорацией Майкрософт. Azure регистрирует в этой службе все ваши виртуальные машины и экземпляры ролей облачной службы. Эта служба выполняет разрешение имен по имени узла для виртуальных машин и экземпляров ролей, содержащихся в одной и той же облачной службе, и по FQDN для виртуальных машин и экземпляров ролей в одной и той же виртуальной сети. Дополнительные сведения о DNS см. в статье [Разрешение имен для виртуальных машин и экземпляров ролей](virtual-networks-name-resolution-for-vms-and-role-instances.md).

Существует следующее ограничение: разрешение имен между клиентами с помощью службы DNS, предоставленной Azure, выполняется только для первых 100 облачных служб в виртуальной сети. Если вы используете собственный DNS-сервер, то это ограничение не применяется.

### <a name="can-i-override-my-dns-settings-on-a-per-vm-or-cloud-service-basis"></a>Можно ли переопределять параметры DNS для каждой виртуальной машины или облачной службы?
Да. Чтобы переопределить параметры сети по умолчанию, можно задать DNS-серверы для каждой виртуальной машины или облачной службы. Тем не менее, рекомендуем максимально широко использовать DNS уровня сети.

### <a name="can-i-bring-my-own-dns-suffix"></a>Можно использовать собственный суффикс DNS?
Нет. Невозможно указать пользовательский суффикс DNS для виртуальных сетей.

## <a name="connecting-virtual-machines"></a>Подключение виртуальных машин

### <a name="can-i-deploy-vms-to-a-vnet"></a>Можно ли развертывать виртуальные машины в виртуальной сети?
Да. Все сетевые интерфейсы (сетевые адаптеры), подключенные к виртуальной машине, развернутой по модели развертывания с помощью Resource Manager, должны быть подключены к виртуальной сети. Виртуальные машины, развернутые с помощью классической модели развертывания, можно (но не обязательно) подключать к виртуальной сети.

### <a name="what-are-the-different-types-of-ip-addresses-i-can-assign-to-vms"></a>Какие типы IP-адресов можно назначать для виртуальных машин?
* **Частные**. Назначаются каждому сетевому адаптеру на каждой виртуальной машине. Для назначения адресов может применяться статический или динамический метод. Частные IP-адреса назначаются из диапазона, указанного в параметрах подсети виртуальной сети. Ресурсам, развернутым с помощью классической модели развертывания, назначаются частные IP-адреса, даже если они не подключены к виртуальной сети. Поведение метода распределения различается в зависимости от того, был ли ресурс развернут с помощью Resource Manager или классической модели развертывания. 

  - **Resource Manager**. Динамический или статистический частный IP-адрес остается назначенным виртуальной машине (Resource Manager), пока этот ресурс не будет удален. Разница заключается в том, что при использовании статистического адреса вы выбираете адрес для назначения, а при использовании динамического его выбирает Azure. 
  - **Классическая модель развертывания**. Динамический частный IP-адрес может измениться при перезапуске виртуальной машины (классическая модель развертывания) после того, как она была остановлена (освобождена). Если необходимо присвоить постоянный частный IP-адрес ресурсу, развернутому с помощью классической модели развертывания, назначьте ему частный IP-адрес с помощью статического метода.

* **Общедоступные**. Могут назначаться для сетевых адаптеров, подключенных к виртуальным машинам, развернутым по модели развертывания с помощью Azure Resource Manager. Для назначения адресов может применяться статический или динамический метод распределения. Все виртуальные машины и экземпляры ролей облачных служб, развернутые по классической модели развертывания, существуют в облачной службе, которой назначается *динамический* общедоступный виртуальный IP-адрес. В качестве виртуального IP-адреса может быть назначен общедоступный *статический* IP-адрес, который также называется [зарезервированным IP-адресом](virtual-networks-reserved-public-ip.md). Общедоступные IP-адреса можно назначать отдельным виртуальным машинам или экземплярам ролей облачных служб, развернутым по классической модели. Эти адреса называются [общедоступными IP-адресами уровня экземпляра (ILPIP)](virtual-networks-instance-level-public-ip.md) и могут назначаться динамически.

### <a name="can-i-reserve-a-private-ip-address-for-a-vm-that-i-will-create-at-a-later-time"></a>Можно ли зарезервировать частный IP-адрес для виртуальной машины, которую я планирую создать позже?
Нет. Зарезервировать частный IP-адрес невозможно. Если частный IP-адрес доступен, DHCP-сервер назначает его виртуальной машине или экземпляру роли. Это может оказаться любая виртуальная машина, а не обязательно та, для которой вы хотите использовать определенный частный IP-адрес. Но вы можете изменить частный IP-адрес уже созданной виртуальной машины на любой доступный частный IP-адрес.

### <a name="do-private-ip-addresses-change-for-vms-in-a-vnet"></a>Изменяются ли частные IP-адреса виртуальных машин в виртуальной сети?
Здесь возможны варианты в зависимости от обстоятельств. Нет, если виртуальная машина развернута с помощью Resource Manager, независимо от того, как присвоен IP-адрес: с помощью статического или динамического метода распределения. Если виртуальная машина была развернута с помощью классической модели развертывания, динамические IP-адреса могут изменяться при перезапуске виртуальной машины после того, как она была остановлена (освобождена). В случае удаления виртуальной машины, развернутой с помощью любой модели развертывания, назначенный ей адрес освобождается.

### <a name="can-i-manually-assign-ip-addresses-to-nics-within-the-vm-operating-system"></a>Можно ли вручную назначать IP-адреса для сетевых адаптеров в операционной системе виртуальной машины?
Да, но не рекомендуем. Только при необходимости, например при назначении нескольких IP-адресов для виртуальной машины. Дополнительные сведения см. в статье [Добавление IP-адресов в операционную систему виртуальной машины](virtual-network-multiple-ip-addresses-portal.md#os-config). Если IP-адрес, назначенный сетевой карте Azure, подключенной к виртуальной машине, изменяется и IP-адрес в операционной системе виртуальной машины отличается, вы потеряете связь с виртуальной машиной.

### <a name="if-i-stop-a-cloud-service-deployment-slot-or-shutdown-a-vm-from-within-the-operating-system-what-happens-to-my-ip-addresses"></a>Что происходит с IP-адресами, когда я останавливаю слот развертывания облачной службы или завершаю работу виртуальной машины средствами операционной системы?
Отсутствует. IP-адреса (общедоступный виртуальный, общедоступный или частный) остаются назначенными для слота развертывания облачной службы или для виртуальной машины.

### <a name="can-i-move-vms-from-one-subnet-to-another-subnet-in-a-vnet-without-redeploying"></a>Можно ли перемещать виртуальные машины между подсетями виртуальной сети без повторного развертывания?
Да. Дополнительные сведения см. в статье [Перемещение виртуальной машины или экземпляра роли в другую подсеть](virtual-networks-move-vm-role-to-subnet.md).

### <a name="can-i-configure-a-static-mac-address-for-my-vm"></a>Можно ли настроить статический MAC-адрес для виртуальной машины?
Нет. Настроить MAC-адрес статически невозможно.

### <a name="will-the-mac-address-remain-the-same-for-my-vm-once-its-created"></a>Остается ли MAC-адрес виртуальной машины неизменным после ее создания?
Да, MAC-адрес остается неизменным для виртуальной машины, развернутой по модели с помощью Resource Manager или по классической модели развертывания, пока виртуальная машина не будет удалена. Ранее MAC-адрес освобождался также при остановке (освобождении) виртуальной машины, но теперь MAC-адрес сохраняется даже для виртуальных машин в состоянии "Освобождено". MAC-адрес остается назначенным сетевому интерфейсу, пока сетевой интерфейс не будет удален или пока не будет изменен частный IP-адрес, назначенный основной IP-конфигурации основного сетевого интерфейса. 

### <a name="can-i-connect-to-the-internet-from-a-vm-in-a-vnet"></a>Можно ли подключиться к Интернету из виртуальной машины, находящейся в виртуальной сети?
Да. Все виртуальные машины и экземпляры ролей облачных служб, развернутые в виртуальной сети, могут подключаться к Интернету.

## <a name="azure-services-that-connect-to-vnets"></a>Службы Azure, которые подключаются к виртуальным сетям

### <a name="can-i-use-azure-app-service-web-apps-with-a-vnet"></a>Могу ли я использовать веб-приложения службы приложений Azure с виртуальной сетью?
Да. Вы можете развернуть веб-приложения в виртуальной сети с помощью ASE (Среда службы приложений), подключить серверную часть приложений к виртуальных сетей с помощью интеграции с виртуальной сетью и заблокировать входящий трафик в приложении с конечными точками службы. Дополнительные сведения см. в следующих статьях:

* [Сетевые функции службы приложений](../app-service/networking-features.md)
* [Создание веб-приложений в среде службы приложений](../app-service/environment/app-service-web-how-to-create-a-web-app-in-an-ase.md?toc=%2fazure%2fvirtual-network%2ftoc.json)
* [Интеграция приложения с виртуальной сетью Azure](../app-service/web-sites-integrate-with-vnet.md?toc=%2fazure%2fvirtual-network%2ftoc.json)
* [Ограничения доступа для службы приложений](../app-service/app-service-ip-restrictions.md)

### <a name="can-i-deploy-cloud-services-with-web-and-worker-roles-paas-in-a-vnet"></a>Можно ли развернуть в виртуальной сети облачные службы с веб-ролями и рабочими ролями (платформа как услуга)?
Да. Вы можете (по своему усмотрению) развертывать экземпляры ролей облачных служб в виртуальных сетях. Для этого нужно указать имя виртуальной сети и сопоставления роли и подсети в разделе конфигурации сети в конфигурации службы. Не нужно обновлять никакие двоичные файлы.

### <a name="can-i-connect-a-virtual-machine-scale-set-to-a-vnet"></a>Можно ли подключить масштабируемый набор виртуальных машин к виртуальной сети?
Да. Необходимо подключить масштабируемый набор виртуальных машин к виртуальной сети.

### <a name="is-there-a-complete-list-of-azure-services-that-can-i-deploy-resources-from-into-a-vnet"></a>Существует ли полный список служб Azure, ресурсы которых можно развернуть в виртуальной сети?
Да. Дополнительные сведения см. в статье [Интеграция виртуальной сети для служб Azure](virtual-network-for-azure-services.md).

### <a name="which-azure-paas-resources-can-i-restrict-access-to-from-a-vnet"></a>К каким ресурсам Azure PaaS можно предоставить доступ в виртуальной сети?

К ресурсам, развернутым с помощью некоторых служб Azure PaaS (таких как служба хранилища Azure и База данных SQL Azure), можно ограничить доступ, предоставляя его только к ресурсам в виртуальной сети через конечные точки служб. Дополнительные сведения см. в статье [Конечные точки служб для виртуальной сети](virtual-network-service-endpoints-overview.md).

### <a name="can-i-move-my-services-in-and-out-of-vnets"></a>Можно ли перемещать службы в виртуальные сети и из них?
Нет. Невозможно перемещать службы в виртуальные сети и из них. Чтобы переместить ресурс в другую виртуальную сеть, необходимо удалить его, а затем повторно развернуть.

## <a name="security"></a>Безопасность

### <a name="what-is-the-security-model-for-vnets"></a>Какова модель безопасности для виртуальных сетей?
Виртуальные сети изолированы друг от друга и от других служб, размещенных в инфраструктуре Azure. Виртуальная сеть — это граница доверия.

### <a name="can-i-restrict-inbound-or-outbound-traffic-flow-to-vnet-connected-resources"></a>Можно ли ограничить входящий или исходящий трафик к ресурсам, подключенным к виртуальной сети?
Да. Вы можете применить [группы безопасности сети](security-overview.md) для отдельных подсетей в виртуальной сети и (или) для подключенных к виртуальной сети сетевых адаптеров.

### <a name="can-i-implement-a-firewall-between-vnet-connected-resources"></a>Можно ли развернуть брандмауэр между ресурсами, подключенными к виртуальной сети?
Да. Вы можете развернуть [виртуальные сетевые устройства с ролью брандмауэра](https://azure.microsoft.com/marketplace/?term=firewall), предоставляемые несколькими поставщиками через Azure Marketplace.

### <a name="is-there-information-available-about-securing-vnets"></a>Могу ли я получить информацию о защите виртуальных сетей?
Да. Дополнительные сведения см. в статье [Обзор сетевой безопасности Azure](../security/fundamentals/network-overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json).

## <a name="apis-schemas-and-tools"></a>API-интерфейсы, схемы и инструменты

### <a name="can-i-manage-vnets-from-code"></a>Можно ли управлять виртуальными сетями из кода?
Да. В [Azure Resource Manager](/rest/api/virtual-network) и [классической](https://go.microsoft.com/fwlink/?LinkId=296833) модели развертывания можно использовать интерфейсы API-интерфейсов RESTful для виртуальных сетей.

### <a name="is-there-tooling-support-for-vnets"></a>Существуют ли специальные программные средства для работы с виртуальными сетями?
Да. Дополнительные сведения об использовании средств:
- Развертывание виртуальных сетей по модели [Azure Resource Manager](manage-virtual-network.md#create-a-virtual-network) или [классической модели развертывания](virtual-networks-create-vnet-classic-pportal.md) с помощью портала Azure.
- Управление виртуальными сетями, развернутыми по модели [Azure Resource Manager](/powershell/module/az.network) или [классической модели развертывания](/powershell/module/servicemanagement/azure/?view=azuresmps-3.7.0), с помощью PowerShell.
- Развертывание виртуальных сетей, развернутых по модели [Azure Resource Manager](/cli/azure/network/vnet) или [классической модели развертывания](../virtual-machines/azure-cli-arm-commands.md?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-network-commands-to-manage-network-resources), и управление ими с помощью интерфейса командной строки Azure.  

## <a name="vnet-peering"></a>Пиринг VNet

### <a name="what-is-vnet-peering"></a>Что такое пиринг виртуальных сетей?
Пиринг виртуальных сетей позволяет эффективно соединять виртуальные сети. Пиринговая связь между виртуальными сетями позволяет направлять трафик между ними в частном порядке через IPv4-адреса. Виртуальные машины в пиринговых виртуальных сетях могут взаимодействовать друг с другом, как если бы они были в той же сети. Эти виртуальные сети могут быть в одном или в разных регионах (во втором случае установка связи также известна как глобальный пиринг виртуальных сетей). Пиринговые подключения виртуальной сети также могут создаваться в подписках Azure.

### <a name="can-i-create-a-peering-connection-to-a-vnet-in-a-different-region"></a>Могу ли я создать пиринговое подключение к виртуальной сети в другом регионе?
Да. Глобальный пиринг виртуальных сетей позволяет создавать пиринговую связь между виртуальными сетями в разных регионах. Глобальный пиринг виртуальных сетей доступен во всех общедоступных регионах Azure, в регионах облака Китая и в облачных регионах для государственных организаций. Вы не можете глобально одноранговые узлы из общедоступных регионов Azure в регионы национальных облаков.

### <a name="what-are-the-constraints-related-to-global-vnet-peering-and-load-balancers"></a>Каковы ограничения, связанные с глобальным Пирингом виртуальных сетей и подсистемами балансировки нагрузки?
Если две виртуальные сети находятся в разных регионах (пиринг глобальной виртуальной сети), вы не сможете подключиться к ресурсам, использующим базовый Load Balancer. Вы можете подключиться к ресурсам, использующим Load Balancer (цен. категория "Стандартный").
В следующих ресурсах используются базовые подсистемы балансировки нагрузки, что означает, что вы не можете взаимодействовать с ними в глобальной виртуальной сети.
- Виртуальные машины за базовыми подсистемами балансировки нагрузки
- Масштабируемые наборы виртуальных машин с базовыми подсистемами балансировки нагрузки 
- Кэш Redis 
- SKU шлюза приложений (v1)
- Платформа Service Fabric
- SQL MI
- Управление API
- Служба домен Active Directory (добавляет)
- Приложения логики
- HDInsight
-   Пакетная служба Azure
- AKS
- Среда службы приложений

Вы можете подключаться к этим ресурсам через ExpressRoute или VNet-VNet через шлюзы виртуальной сети.

### <a name="can-i-enable-vnet-peering-if-my-virtual-networks-belong-to-subscriptions-within-different-azure-active-directory-tenants"></a>Могу ли я включить пиринг виртуальной сети, если мои виртуальные сети относятся к подпискам в разных клиентах Azure Active Directory?
Да. Установка пиринга виртуальной сети (локальный или глобальный) возможна, если ваши подписки принадлежат к разным клиентам Azure Active Directory. Это можно сделать с помощью PowerShell или интерфейса командной строки. Портал пока не поддерживаются.

### <a name="my-vnet-peering-connection-is-in-initiated-state-why-cant-i-connect"></a>Пиринговое подключение виртуальной сети находится в состоянии *Начато*, почему я не могу установить подключение?
Если подключение пиринга находится в *инициированном* состоянии, это означает, что вы создали только одну ссылку. Чтобы установить успешное подключение, необходимо создать двунаправленную связь. Например, чтобы установить пиринговое подключение виртуальной сети А к виртуальной сети В, нужно создать связь из сети VNetA к сети VNetB и из сети VNetB к сети VNetA. Создание обеих связей приведет к изменению состояния на *подключено*.

### <a name="my-vnet-peering-connection-is-in-disconnected-state-why-cant-i-create-a-peering-connection"></a>Пиринговое подключение виртуальной сети находится в состоянии *Отключено*. Почему я не могу установить пиринговое подключение?
Если соединение с пирингом виртуальной сети находится в *отключенном* состоянии, это означает, что одна из созданных ссылок удалена. Чтобы восстановить подключение пиринга, необходимо удалить связь и создать ее заново.

### <a name="can-i-peer-my-vnet-with-a-vnet-in-a-different-subscription"></a>Можно ли настроить пиринговое подключение своей виртуальной сети к виртуальной сети в другой подписке?
Да. Можно установить пиринговое подключение виртуальных сетей во всех подписках и регионах.

### <a name="can-i-peer-two-vnets-with-matching-or-overlapping-address-ranges"></a>Могу ли я установить пиринг между двумя виртуальными сетями с совпадающими или перекрывающимися диапазонами адресов?
Нет. Чтобы включить пиринг виртуальных сетей, адресные пространства не должны перекрывать друг друга.

### <a name="how-much-do-vnet-peering-links-cost"></a>Сколько стоит создание связей для пиринга виртуальных сетей?
Создание пирингового подключения виртуальных сетей бесплатно. Передача данных через пиринговые подключения оплачивается. Дополнительные сведения см. [здесь](https://azure.microsoft.com/pricing/details/virtual-network/).

### <a name="is-vnet-peering-traffic-encrypted"></a>Шифруется ли пиринговый трафик виртуальной сети?
Нет. Трафик между ресурсами в пиринговых виртуальных сетях частный и изолированный. Он полностью хранится в магистральной сети Майкрософт.

### <a name="why-is-my-peering-connection-in-a-disconnected-state"></a>Почему соединение пиринга находится в *отключенном* состоянии?
Пиринговые подключения виртуальных сетей переходят в состояние *Отключено*, когда удаляется одна из связей пиринга виртуальных сетей. Вам нужно удалить обе связи, чтобы повторно установить успешное пиринговое подключение.

### <a name="if-i-peer-vneta-to-vnetb-and-i-peer-vnetb-to-vnetc-does-that-mean-vneta-and-vnetc-are-peered"></a>Если настроить пиринговое подключение между сетями VNetA и VNetB, а затем между сетями VNetB и VNetC, будет ли это означать, что между сетями VNetA и VNetC также установлено пиринговое подключение?
Нет. Транзитивный пиринг не поддерживается. Для пиринга между сетями VNetA и VNetC нужно использовать именно эти сети.

### <a name="are-there-any-bandwidth-limitations-for-peering-connections"></a>Есть ли ограничения пропускной способности для пиринговых подключений?
Нет. Пиринг виртуальных сетей (локальный или глобальный) не предусматривает каких-либо ограничений пропускной способности. Пропускная способность ограничивается только виртуальной машиной или вычислительным ресурсом.

### <a name="how-can-i-troubleshoot-vnet-peering-issues"></a>Как устранить неполадки пиринга в виртуальной сети?
Ниже приведено [пошаговое описание средства устранения неполадок](https://support.microsoft.com/en-us/help/4486956/troubleshooter-for-virtual-network-peering-issues) .

## <a name="virtual-network-tap"></a>TAP виртуальной сети

### <a name="which-azure-regions-are-available-for-virtual-network-tap"></a>В каких регионах Azure доступна функция TAP виртуальной сети?
Предварительная версия TAP для виртуальной сети доступна во всех регионах Azure. Отслеживаемые сетевые интерфейсы, ресурс TAP виртуальной сети и сборщик или решение для аналитики должны быть развернуты в одном регионе.

### <a name="does-virtual-network-tap-support-any-filtering-capabilities-on-the-mirrored-packets"></a>Поддерживает ли TAP виртуальной сети какие-либо возможности фильтрации зеркальных пакетов?
Возможности фильтрации не поддерживаются предварительной версией TAP виртуальной сети. После добавления конфигурации TAP в сетевой интерфейс глубокая копия всего входящего и исходящего трафика, передаваемого через этот сетевой интерфейс, передается потоком в место назначения TAP.

### <a name="can-multiple-tap-configurations-be-added-to-a-monitored-network-interface"></a>Можно ли добавить несколько конфигураций TAP в отслеживаемый сетевой интерфейс?
У отслеживаемого сетевого интерфейса может быть только одна конфигурация TAP. Проверяйте отдельное [партнерское решение](virtual-network-tap-overview.md#virtual-network-tap-partner-solutions) о возможности потоковой передачи нескольких копий трафика TAP в средства аналитики по своему усмотрению.

### <a name="can-the-same-virtual-network-tap-resource-aggregate-traffic-from-monitored-network-interfaces-in-more-than-one-virtual-network"></a>Может ли один и тот же ресурс TAP виртуальной сети агрегировать трафик из отслеживаемых сетевых интерфейсов в более чем одной виртуальной сети?
Да. Один ресурс TAP виртуальной сети можно использовать для агрегирования зеркального трафика из отслеживаемых сетевых интерфейсов в пиринговых виртуальных сетях, размещенных в той же или другой подписке. Ресурс TAP виртуальной сети и целевая подсистема балансировки нагрузки или целевой сетевой интерфейс должны находиться в одной и той же подписке. Все подписки должны быть размещены в одном клиенте Azure Active Directory.

### <a name="are-there-any-performance-considerations-on-production-traffic-if-i-enable-a-virtual-network-tap-configuration-on-a-network-interface"></a>Возникнут ли какие-либо сложности с производительностью рабочего трафика, если включить конфигурацию TAP виртуальной сети для сетевого интерфейса?

TAP для виртуальной сети используется предварительная версия. На этапе предварительной версии соглашение об уровне обслуживания не действует. Эту функцию не следует использовать для производственных рабочих нагрузок. Если сетевой интерфейс виртуальной машины включен с конфигурацией TAP, то те же ресурсы на узле Azure, выделенные виртуальной машине для отправки рабочего трафика, используются для выполнения функции зеркального отображения и отправки зеркальных пакетов. Выберите правильный размер виртуальной машины [Linux](../virtual-machines/linux/sizes.md?toc=%2fazure%2fvirtual-network%2ftoc.json) или [Windows](../virtual-machines/linux/sizes.md?toc=%2fazure%2fvirtual-network%2ftoc.json), чтобы обеспечить достаточно ресурсов виртуальной машины для отправки рабочего трафика и зеркального трафика.

### <a name="is-accelerated-networking-for-linuxcreate-vm-accelerated-networking-climd-or-windowscreate-vm-accelerated-networking-powershellmd-supported-with-virtual-network-tap"></a>Поддерживается ли ускорение работы в сети для [Linux](create-vm-accelerated-networking-cli.md) или [Windows](create-vm-accelerated-networking-powershell.md) с помощью TAP виртуальной сети?

Можно будет добавить конфигурацию TAP в сетевой интерфейс, подключенный к виртуальной машине, для которой включено ускорение работы в сети. Но добавление конфигурации TAP повлияет не производительность и задержку виртуальной машины, так как разгрузка зеркального трафика для ускорения работы в сети Azure в настоящее время не поддерживается.

## <a name="virtual-network-service-endpoints"></a>Конечные точки службы для виртуальной сети

### <a name="what-is-the-right-sequence-of-operations-to-set-up-service-endpoints-to-an-azure-service"></a>Какова правильная последовательность операций для настройки конечных точек службы Azure?
Для защиты ресурса службы Azure через конечные точки службы необходимо выполнить два действия.
1. Включите конечные точки для службы Azure.
2. Настройте списки управления доступом виртуальной сети в службе Azure.

Первым шагом является операция на стороне сети и вторым – операция на стороне службы ресурсов. Оба действия выполняются либо с помощью администратора, либо разными администраторами на основании разрешений RBAC, предоставленных ролей администратора. Мы рекомендуем сначала включить конечные точки службы виртуальной сети перед настройкой списков управления доступом в виртуальной сети на стороне службы Azure. Поэтому эти действия необходимо выполнить в приведенной выше последовательности, чтобы настроить конечные точки службы виртуальной сети.

>[!NOTE]
> Обе операции, описанные выше, должны быть завершены, прежде чем можно ограничить доступ к службе Azure для разрешенных виртуальных сетей и подсетей. Только включение конечных точек для службы Azure на стороне сети не предоставляет ограниченный доступ. Кроме того, необходимо также настроить списки управления доступом в виртуальной сети на стороне службы Azure.

Некоторые службы (например, SQL и CosmosDB) разрешают исключения из указанной выше последовательности с помощью флага **игноремиссингвнетсервицеендпоинт** . После установки флага в **значение true**списки управления доступом виртуальной сети можно настроить на стороне службы Azure перед настройкой конечных точек службы на стороне сети. Служба Azure предоставляет этот флажок, чтобы помочь клиентам в тех случаях, когда конкретный IP-адрес брандмауэров в службе Azure и включение конечных точек службы на стороне сети может привести к перемещению подключения, так как исходный IP-адрес меняется из публичных IPv4-адресов в собственный адрес. Настройка списков управления доступом в виртуальной сети на стороне службы Azure перед настройкой конечных точек службы поможет избежать потери подключения.

### <a name="do-all-azure-services-reside-in-the-azure-virtual-network-provided-by-the-customer-how-does-vnet-service-endpoint-work-with-azure-services"></a>Могут ли все службы Azure находиться в виртуальной сети Azure, предоставленной клиентом? Как конечная точка службы виртуальной сети работает со службами Azure?

Нет, не все службы Azure находятся в виртуальной сети клиента. Большинство служб данных Azure, таких как служба хранилища Azure, SQL Azure и Azure Cosmos DB, — это службы с несколькими клиентами, к которым можно получить доступ через общедоступные IP-адреса. Подробнее об интеграции виртуальных сетей для служб Azure можно узнать [здесь](virtual-network-for-azure-services.md). 

При использовании функции конечных точек службы в виртуальной сети (включение конечной точки службы в виртуальной сети на стороне сети и настройка соответствующих списков управления доступом виртуальной сети на стороне службы Azure) доступ к службе Azure ограничивается из разрешенной виртуальной сети и подсети.

### <a name="how-does-vnet-service-endpoint-provide-security"></a>Как конечная точка службы виртуальной сети обеспечивает безопасность?

Функция конечной точки службы виртуальной сети (включенная конечная точка службы виртуальной сети и настройка соответствующих списков ACL для виртуальной сети на стороне службы Azure) ограничивает доступ службы Azure к разрешенной виртуальной сети и подсетям, тем самым обеспечивая безопасность на уровне сети и изоляция трафика службы Azure. Весь трафик, использующий конечные точки службы виртуальной сети, проходит через магистраль Майкрософт, обеспечивая тем самым еще один уровень изоляции от общедоступного Интернета. Кроме того, клиенты могут выбрать полностью отказаться от открытого доступа в Интернет для ресурсов служб Azure и разрешить трафик только из своей виртуальной сети, используя IP-брандмауэры и списки управления доступом для виртуальной сети, защищая, таким образом, ресурсы служб Azure от несанкционированного доступа.      

### <a name="what-does-the-vnet-service-endpoint-protect---vnet-resources-or-azure-service"></a>Что же защищает виртуальная конечная точка службы виртуальной сети – ресурсы Azure или службу Azure?
Конечные точки службы виртуальной сети помогают защитить ресурсы служб Azure. Ресурсы виртуальной сети защищены с помощью групп безопасности сети (NSG).

### <a name="is-there-any-cost-for-using-vnet-service-endpoints"></a>Взимается ли плата за использование конечных точек службы виртуальной сети?

Нет, за использование конечных точек службы виртуальной сети дополнительная плата не взимается.

### <a name="can-i-turn-on-vnet-service-endpoints-and-set-up-vnet-acls-if-the-virtual-network-and-the-azure-service-resources-belong-to-different-subscriptions"></a>Можно ли включить конечные точки службы виртуальной сети и настроить списки управления доступом в виртуальной сети, если виртуальная сеть и ресурсы служб Azure относятся к разным подпискам?

Да, это возможно. Виртуальные сети и ресурсы служб Azure могут находиться в одной или разных подписках. Единственное требование заключается в том, чтобы они были размещены в одном клиенте Active Directory (AD).

### <a name="can-i-turn-on-vnet-service-endpoints-and-set-up-vnet-acls-if-the-virtual-network-and-the-azure-service-resources-belong-to-different-ad-tenants"></a>Можно ли включить конечные точки службы виртуальной сети и настроить списки управления доступом в виртуальной сети, если виртуальная сеть и ресурсы служб Azure относятся к разным клиентам AD?
Нет, конечные точки службы виртуальной сети и списки управления доступом в виртуальной сети в разных клиентах AD не поддерживаются.

### <a name="can-an-on-premises-devices-ip-address-that-is-connected-through-azure-virtual-network-gateway-vpn-or-expressroute-gateway-access-azure-paas-service-over-vnet-service-endpoints"></a>Может ли IP-адрес локального устройства, подключенный через шлюз виртуальной сети Azure (VPN) или шлюз ExpressRoute, получать доступ к службе Azure PaaS через конечные точки службы виртуальной сети?
По умолчанию ресурсы служб Azure, которые защищены в виртуальной сети, недоступны для локальных сетей. Чтобы разрешить трафик из локальной среды, необходимо также разрешить общедоступные IP-адреса (обычно это NAT) из локальных каналов или каналов ExpressRoute. Эти IP-адреса можно добавить в конфигурации брандмауэра IP-адресов для ресурсов служб Azure.

### <a name="can-i-use-vnet-service-endpoint-feature-to-secure-azure-service-to-multiple-subnets-within-a-virtual-network-or-across-multiple-virtual-networks"></a>Можно ли использовать функцию конечной точки службы виртуальной сети для защиты службы Azure в нескольких подсетях в виртуальной сети или в нескольких виртуальных сетях?
Чтобы защитить службы Azure в нескольких подсетях в виртуальной сети или в нескольких виртуальных сетях, включите конечные точки службы на стороне сети в каждой из подсетей независимо, а затем обеспечьте защиту ресурсов службы Azure для всех подсетей, настроив соответствующие списки ACL для виртуальной сети на стороне службы Azure.
 
### <a name="how-can-i-filter-outbound-traffic-from-a-virtual-network-to-azure-services-and-still-use-service-endpoints"></a>Как фильтровать исходящий трафик из виртуальной сети к службам Azure и по-прежнему использовать конечные точки службы?
Чтобы проверить или отфильтровать трафик, который поступает в службу Azure из виртуальной сети, можно развернуть в этой виртуальной сети виртуальное сетевое устройство. Это позволяет применять конечные точки служб к подсети, в которой развертывается виртуальное сетевое устройство, и обеспечить защиту ресурса службы Azure только в этой подсети через списки управления доступом в виртуальной сети. Это может также быть полезно, если вам требуется разрешить доступ к службе Azure из виртуальной сети только для определенных ресурсов Azure с использованием фильтрации виртуального сетевого устройства. Дополнительные сведения см. в разделе [Deploy highly available network virtual appliances](https://docs.microsoft.com/azure/architecture/reference-architectures/dmz/nva-ha) (Развертывание высокодоступных сетевых устройств).

### <a name="what-happens-when-you-access-an-azure-service-account-that-has-a-virtual-network-access-control-list-acl-enabled-from-outside-the-vnet"></a>Что происходит при доступе к учетной записи службы Azure с включенным списком управления доступом (ACL) из-за пределов виртуальной сети?
Ошибка HTTP 403 или HTTP 404.

### <a name="are-subnets-of-a-virtual-network-created-in-different-regions-allowed-to-access-an-azure-service-account-in-another-region"></a>Разрешен ли доступ для подсетей виртуальной сети, созданных в различных регионах, к учетной записи службы Azure в другом регионе? 
Да, большинство служб Azure виртуальной сети, созданные для разных регионов, могут получить доступ к службам Azure в другом регионе через конечные точки службы виртуальной сети. Например, если учетная запись Azure Cosmos DB находится в западной части США или в восточной части США, а виртуальная сеть находится в нескольких регионах, может ли виртуальная сеть получить доступ к базе данных Azure Cosmos DB. Хранилище и SQL являются исключениями и носят, по сути, региональный характер, поэтому и виртуальная сеть, и служба Azure должны находиться в одном регионе.
  
### <a name="can-an-azure-service-have-both-a-vnet-acl-and-an-ip-firewall"></a>Может ли служба Azure иметь как ACL виртуальной сети, так и брандмауэр IP?
Да, список ACL виртуальной сети и брандмауэр IP-адресов могут сосуществовать. Обе эти функции дополняют друг друга для обеспечения изоляции и безопасности.
 
### <a name="what-happens-if-you-delete-a-virtual-network-or-subnet-that-has-service-endpoint-turned-on-for-azure-service"></a>Что происходит при удалении виртуальной сети или подсети, которая имеет включенную конечную точку службы для службы Azure?
Удаление виртуальных сетей и подсетей являются независимыми операциями и поддерживаются даже в том случае, если конечные точки включены для служб Azure. В случаях, когда для этих виртуальных сетей и подсетей настроены списки управления доступом к виртуальной сети, сведения о списках ACL виртуальной сети, связанные с этой службой Azure, отключаются при удалении виртуальной сети или подсетей, в которых включена конечная точка службы виртуальной сети.
 
### <a name="what-happens-if-an-azure-service-account-that-has-a-vnet-service-endpoint-enabled-is-deleted"></a>Что произойдет, если учетная запись службы Azure с включенной конечной точкой службы виртуальной сети будет удалена?
Удаление учетной записи службы Azure является независимой операцией и поддерживается, даже если конечная точка службы включена на стороне сети, а списки ACL виртуальной сети настроены на стороне службы Azure. 

### <a name="what-happens-to-the-source-ip-address-of-a-resource-like-a-vm-in-a-subnet-that-has-vnet-service-endpoint-enabled"></a>Что происходит с исходным IP-адресом ресурса, например виртуальной машины, в подсети с включенной конечной точкой службы виртуальной сети?
При включении конечных точек служб для виртуальной сети исходные IP-адреса ресурсов в подсети виртуальной сети будут переключаться с использования общедоступных адресов IPv4 на частные адреса виртуальной сети Azure для трафика в службу Azure. Обратите внимание, что это может привести к сбою некоторых IP-брандмауэров, для которых в службах Azure задан общедоступный адрес IPV4. 

### <a name="does-the-service-endpoint-route-always-take-precedence"></a>Всегда ли маршрут конечной точки службы имеет приоритет?
Конечные точки службы добавляют системный маршрут, который имеет приоритет над маршрутами BGP и обеспечивает оптимальную маршрутизацию для трафика конечной точки службы. Конечные точки службы всегда направляют трафик служб непосредственно из виртуальной сети в службу в магистральной сети Microsoft Azure. Дополнительные сведения о том, как Azure выбирает маршрут, см. в статье [Маршрутизация трафика виртуальной сети Azure](virtual-networks-udr-overview.md).
 
### <a name="how-does-nsg-on-a-subnet-work-with-service-endpoints"></a>Как работает группа безопасности сети в подсети с конечными точками службы?
Для доступа к службе Azure группам безопасности сети необходимо разрешить исходящие подключения. Если ваши группы безопасности сети открыты для всего исходящего интернет-трафика, то трафик конечной точки службы должен работать. Можно также ограничить исходящий трафик для IP-адресов службы, используя только эти теги служб.  
 
### <a name="what-permissions-do-i-need-to-set-up-service-endpoints"></a>Какие разрешения необходимы для настройки конечных точек службы?
Пользователь с правами на запись в виртуальной сети может настроить конечные точки служб в виртуальных сетях независимо друг от друга. Чтобы защитить ресурсы службы Azure для виртуальной сети, пользователь должен иметь разрешение **Microsoft. Network/virtualNetworks/подсети/жоинвиасервицеендпоинт/Action** для добавляемых подсетей. Это разрешение по умолчанию включено во встроенную роль администратора служб и может быть изменено при создании настраиваемых ролей. Узнайте больше о встроенных ролях и назначении разрешений, определенных для [настраиваемых ролей](https://docs.microsoft.com/azure/role-based-access-control/custom-roles?toc=%2fazure%2fvirtual-network%2ftoc.json).
 

### <a name="can-i-filter-virtual-network-traffic-to-azure-services-allowing-only-specific-azure-service-resources-over-vnet-service-endpoints"></a>Можно ли фильтровать трафик из виртуальной сети к службам Azure, разрешая тем самым только определенные ресурсы служб, через конечные точки служб в виртуальной сети? 

Политики конечных точек служб виртуальной сети позволяют фильтровать трафик из виртуальной сети к службам Azure, разрешая тем самым только определенные ресурсы служб, через конечные точки служб. Политики конечных точек предоставляют возможность детального контроля доступа трафика из виртуальной сети к службам Azure. Дополнительные сведения о политиках конечных точек служб см. [здесь](virtual-network-service-endpoint-policies-overview.md).

### <a name="does-azure-active-directory-azure-ad-support-vnet-service-endpoints"></a>Поддерживает ли Azure Active Directory (Azure AD) конечные точки службы виртуальной сети?

Azure Active Directory (Azure AD) не поддерживает конечные точки службы изначально. Полный список служб Azure, поддерживающих конечные точки службы виртуальной сети, можно просмотреть [здесь](https://docs.microsoft.com/azure/virtual-network/virtual-network-service-endpoints-overview). Обратите внимание, что тег Microsoft. AzureActiveDirectory, указанный в разделе службы, поддерживающие конечные точки службы, используется для поддержки конечных точек службы для ADLS Gen 1. Для ADLS Gen 1 Интеграция виртуальной сети для Azure Data Lake Storage 1-го поколения использует безопасность конечной точки службы виртуальной сети между виртуальной сетью и Azure Active Directory (Azure AD) для создания дополнительных утверждений безопасности в маркере доступа. Эти утверждения используются для проверки подлинности виртуальной сети в учетной записи ADLS 1-го поколения и для предоставления доступа. Дополнительные сведения о [Azure Data Lake Store интеграции с виртуальной сетью для поколения 1] (.. /Дата-Лаке-Сторе/Дата-Лаке-Сторе-Нетворк-секурити.МД? TOC =% 2fazure% 2fvirtual — Network% 2ftoc. JSON

### <a name="are-there-any-limits-on-how-many-vnet-service-endpoints-i-can-set-up-from-my-vnet"></a>Существуют ли какие-либо ограничения на количество конечных точек службы в виртуальной сети, которые я могу настроить из своей виртуальной сети?
Общее количество конечных точек служб в виртуальной сети не ограничено. Для ресурса службы Azure (например, учетной записи хранения Azure) службы могут применять ограничения на количество подсетей, используемых для защиты ресурса. В следующей таблице приведены примеры некоторых ограничений. 

|||
|---|---|
|Служба Azure| Ограничения на правила виртуальной сети|
|Служба хранилища Azure| 100|
|Azure SQL| 128|
|Хранилище данных SQL Azure|  128|
|Azure KeyVault|    127|
|Azure Cosmos DB|   64|
|Концентратор событий Azure|   128|
|Служебная шина Azure| 128|
|Azure Data Lake Store V1|  100|
 
>[!NOTE]
> Ограничения могут быть изменены по усмотрению службы Azure. Чтобы получить подробную информацию о службах, просмотрите соответствующую документацию к службе. 




  



