---
title: Использование облачных служб с расширенной поддержкой (предварительная версия)
description: Сведения о создании и развертывании облачной службы Azure с помощью Azure Resource Manager в Visual Studio
author: ghogen
ms.service: cloud-services-extended-support
manager: jillfra
ms.custom: vs-azure
ms.workload: azure-vs
ms.topic: tutorial
ms.date: 10/5/2020
ms.author: ghogen
ms.openlocfilehash: b12f8beeee054e547a6b58750d8482d32ee14453
ms.sourcegitcommit: 3c8964a946e3b2343eaf8aba54dee41b89acc123
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2021
ms.locfileid: "98747262"
---
# <a name="create-and-deploy-a-azure-cloud-service-extended-support-using-visual-studio"></a>Создание и развертывание облачной службы Azure (расширенная поддержка) с помощью Visual Studio

Начиная с [Visual Studio 2019 версии 16.9](https://visualstudio.microsoft.com/vs/preview/) (сейчас предоставляется в предварительной версии) вы можете применять Azure Resource Manager (ARM) для работы с облачными службами, что значительно упрощает и осовременивает процессы обслуживания ресурсов Azure и управления ими. Эта возможность реализована через новую службу Azure, которая называется "Облачные службы (расширенная поддержка)". Вы можете опубликовать существующую облачную службу в Облачных службах (расширенная поддержка). Сведения об этой службе Azure см. в документации по [Облачным службам (расширенная поддержка)](overview.md).

> [!IMPORTANT]
> Облачные службы (расширенная поддержка) сейчас предоставляются в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="register-the-feature-for-your-subscription"></a>Регистрация функции для подписки
Облачные службы (расширенная поддержка) сейчас предоставляются в предварительной версии. Зарегистрируйте функцию для своей подписки следующим образом:

```powershell
Register-AzProviderFeature -FeatureName CloudServices -ProviderNamespace Microsoft.Compute
```
Дополнительные сведения см. в статье о [предварительных условия для развертывания Облачных служб (расширенная поддержка)](deploy-prerequisite.md).

## <a name="create-a-project"></a>Создание проекта

Visual Studio предоставляет шаблон проекта, на основе которого вы можете создать облачную службу Azure с расширенной поддержкой под названием **Облачная служба Azure (расширенная поддержка)** . Облачная служба — это обычная служба Azure общего назначения. После создания проекта Visual Studio предоставит возможность настроить облачную службу, отладить ее и развернуть в Azure.

### <a name="to-create-an-azure-cloud-service-extended-support-project-in-visual-studio"></a>Шаги по созданию проекта облачной службы Azure (расширенная поддержка) в Visual Studio

В этом разделе описывается процесс создания проекта облачной службы Azure в Visual Studio с применением одной или нескольких веб-ролей.

1. На начальном экране выберите **Создать проект**.

1. В поле поиска введите *облачная*, а затем выберите **Облачная служба Azure (расширенная поддержка)** .

   ![Новая облачная служба Azure с расширенной поддержкой](./media/choose-project-template.png)

1. Присвойте проекту имя и нажмите кнопку **Создать**.

   ![Присвоение проекту имени](./media/configure-new-project.png)

1. В диалоговом окне **Новая облачная служба Microsoft Azure** выберите роли, которые хотите добавить, и нажмите стрелку вправо, чтобы добавить их в решение.

    ![Выбор ролей для новой облачной службы Azure](./media/choose-roles.png)

1. Чтобы переименовать добавленную роль, наведите указатель мыши на роль в диалоговом окне **Новая облачная служба Microsoft Azure** и в контекстном меню выберите **Переименовать**. Вы также можете переименовать роль в решении (с помощью **обозревателя решений**) после ее добавления.

    ![Переименование роли для облачной службы Azure](./media/new-cloud-service-rename.png)

Проект Azure в Visual Studio связан с проектами ролей в решении. Проект также содержит *файл определения службы* и *файл конфигурации службы*:

- **файл определения службы** определяет параметры среды выполнения для приложения, в том числе требуемые роли, конечные точки и размер виртуальной машины;
- **файл конфигурации службы** (CSCFG-файл) задает количество выполняемых экземпляров роли, а также значения параметров, определенных для роли.

Дополнительные сведения об этих файлах см. в статье [Настройка ролей для облачной службы Azure в среде Visual Studio](https://docs.microsoft.com/visualstudio/azure/vs-azure-tools-configure-roles-for-cloud-service).

## <a name="publish-a-cloud-service"></a>Публикация облачной службы

1. Создайте или откройте проект облачной службы Azure в Visual Studio.

1. В **обозревателе решений** щелкните проект правой кнопкой мыши и в контекстном меню выберите **Опубликовать**.

   ![Страница входа](./media/publish-step-1.png)

1. **Учетная запись**: в раскрывающемся списке учетных записей выберите учетную запись или пункт **Добавить учетную запись**.

1. **Выбор подписки**: выберите подписку, которую следует использовать для развертывания. Для подписки, которую вы используете для развертывания облачных служб (расширенная поддержка), требуется наличие роли владельца или участника, назначенной с помощью управления доступом на основе ролей (RBAC). Если у вашей подписки нет ни одной из этих ролей, перед продолжением работы назначьте одну из них по [этим инструкциям](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-steps).

1. Нажмите **Далее**, чтобы перейти на страницу **Параметры**.

   ![Общие параметры](./media/publish-settings.png)

1. **Облачная служба**: в раскрывающемся списке выберите существующую облачную службу или пункт **Создать** и создайте облачную службу. Рядом с каждой облачной службой в скобках указывается центр обработки данных. Рекомендуется, чтобы расположение центра обработки данных для облачной службы совпадало с расположением центра обработки данных для учетной записи хранения.

   Если вы решили создать новую облачную службу, отобразится диалоговое окно **Create Cloud Service (extended support)** (Создание облачной службы (расширенная поддержка)). Укажите расположение и группу ресурсов, которые вы намерены использовать для этой облачной службы.

   ![Создание облачной службы с расширенной поддержкой](./media/extended-support-dialog.png)

1. **Конфигурация сборки**: выберите **Отладка** или **Выпуск**.

1. **Конфигурация службы**: выберите **Облако** или **Локально**.

1. **Учетная запись хранения**: выберите учетную запись хранения для этого развертывания или выберите **Создать** и создайте учетную запись хранения. Рядом с каждой учетной записью хранения в скобках указывается регион. Рекомендуется, чтобы расположение центра обработки данных для учетной записи хранения совпадало с расположением центра обработки данных для облачной службы (общие параметры).

   В учетной записи хранения Azure содержится пакет для развертывания приложения. После развертывания приложения пакет удаляется из учетной записи хранения.

1. **Хранилище ключей**: укажите хранилище ключей, в котором хранятся секреты для этой облачной службы. Эта возможность активна, если включен удаленный рабочий стол или в конфигурацию уже добавлены сертификаты.

1. **Включить удаленный рабочий стол для всех ролей**: установите этот флажок, чтобы удаленно подключаться к службе. Вам будет предложено указать учетные данные.

   ![Параметры удаленного рабочего стола](./media/remote-desktop-configuration.png)

1. Нажмите **Далее**, чтобы перейти на страницу **Параметры диагностики**.

   ![Параметры диагностики](./media/diagnostics-settings.png)

   Система диагностики позволяет устранять неполадки в облачной службе Azure (или на виртуальной машине Azure). Дополнительные сведения о системе диагностики см. в статье [Настройка системы диагностики для облачных служб и виртуальных машин Azure](https://docs.microsoft.com/visualstudio/azure/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines). Дополнительные сведения о службе Application Insights см. в статье [Что такое Azure Application Insights?](https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview)

1. Щелкните **ОК**, чтобы перейти к странице **Сводка**.

   ![Итоги](./media/publish-summary.png)

1. **Целевой профиль**: здесь вы можете создать профиль публикации на основе ранее выбранных параметров. Например, можно создать один профиль для тестовой среды, а другой — для рабочей. Чтобы сохранить профиль, выберите значок **Сохранить**. Мастер создаст профиль и сохранит его в проекте Visual Studio. Чтобы изменить имя профиля, откройте список **Целевой профиль**, а затем выберите **Управление**.

   > [!Note]
   > Профиль публикации отображается в обозревателе решений в Visual Studio, а параметры профиля записываются в файл с расширением AZUREPUBXML. Параметры сохраняются как атрибуты XML-тегов.

1. Когда все параметры развертывания проекта настроены, нажмите кнопку **Опубликовать** в нижней части диалогового окна. Состояние этого процесса можно отслеживать в окне вывода **Журнал действий Azure** в Visual Studio.

Поздравляем! Вы успешно опубликовали в Azure проект облачной службы с расширенной поддержкой. Вы можете повторить публикацию с теми же параметрами, применив тот же профиль публикации, или повторить все действия для создания нового.

## <a name="clean-up-azure-resources"></a>Очистка ресурсов Azure

Чтобы очистить ресурсы Azure, созданные при работе с этим учебником, откройте [портал Azure](https://portal.azure.com), выберите элемент **Группы ресурсов**, найдите и откройте группу ресурсов, которую назначили ранее для создания этой службы, и выберите **Удалить группу ресурсов**.

## <a name="next-steps"></a>Дальнейшие действия

Настройте непрерывную интеграцию (CI) с помощью кнопки **Настроить** на экране **Публикация**. Дополнительные сведения доступны в [документации по Azure Pipelines](https://docs.microsoft.com/azure/devops/pipelines).
