---
title: Сохранение списков ACL файлов, атрибутов и меток времени с помощью Azure Data Box
description: Списки ACL, метки времени и атрибуты, сохраняемые при копировании данных через SMB для Azure Data Box. Копирование метаданных с помощью средств копирования данных Windows и Linux.
services: databox
author: alkohli
ms.service: databox
ms.subservice: pod
ms.topic: conceptual
ms.date: 09/25/2019
ms.author: alkohli
ms.openlocfilehash: 74b8bfcd8cfedaa7c5e24b6c29d9229a4db5828a
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91450756"
---
# <a name="preserving-file-acls-attributes-and-timestamps-with-azure-data-box"></a>Сохранение списков ACL файлов, атрибутов и меток времени с помощью Azure Data Box

Azure Data Box позволяет сохранять списки управления доступом (ACL), метки времени и атрибуты файлов при отправке данных в Azure. В этой статье описываются метаданные, которые можно передать при копировании данных в Data Box с помощью SMB-сервера для отправки в службу файлов Azure. Для копирования метаданных в средства копирования данных Windows и Linux предоставляются определенные действия.

В этой статье списки ACL, метки времени и передаваемые атрибуты файлов в совокупности называются *метаданными*.

## <a name="transferred-metadata"></a>Метаданные передано

Следующие метаданные передаются, когда данные из Data Box передаются в службу файлов Azure.

#### <a name="timestamps"></a>Метки времени

Передаются следующие метки времени:
- CreationTime
- LastWriteTime

Следующая метка времени не переносится:
- LastAccessTime
  
#### <a name="file-attributes"></a>Атрибуты файла

Атрибуты файлов для файлов и каталогов передаются, если не указано иное.

Передаются следующие атрибуты файла:
- FILE_ATTRIBUTE_READONLY (только файл)
- FILE_ATTRIBUTE_HIDDEN
- FILE_ATTRIBUTE_SYSTEM
- FILE_ATTRIBUTE_DIRECTORY (только в каталоге)
- FILE_ATTRIBUTE_ARCHIVE
- FILE_ATTRIBUTE_TEMPORARY (только файл)
- FILE_ATTRIBUTE_NO_SCRUB_DATA

Следующие атрибуты файлов не передаются:
- FILE_ATTRIBUTE_OFFLINE
- FILE_ATTRIBUTE_NOT_CONTENT_INDEXED
  
Атрибуты только для чтения в каталогах не передаются.

#### <a name="acls"></a>списки управления доступом;

Все списки управления доступом для каталогов и файлов, копируемых в Data Box по протоколу SMB, копируются и переносятся. К переносу относятся как избирательные списки управления доступом (DACL), так и системные списки управления доступом (SACL). Для Linux передаются только списки управления доступом Windows NT.

Списки управления доступом не передаются при копировании данных через сетевую файловую систему (NTS) и при использовании службы копирования данных для передачи данных. Служба копирования данных считывает данные непосредственно из общих папок и не может читать списки управления доступом.

Даже если средство копирования данных не копирует списки ACL, списки управления доступом по умолчанию для каталогов и файлов передаются в службу файлов Azure. Списки ACL по умолчанию имеют разрешения для встроенной учетной записи администратора, системной учетной записи и учетной записи пользователя общего ресурса SMB, которая использовалась для подключения и копирования данных в Data Box.

Списки ACL содержат дескрипторы безопасности со следующими свойствами: списки управления доступом, владелец, группа, SACL.

По умолчанию перемещение списков ACL включено. Может потребоваться отключить этот параметр в локальном веб-ИНТЕРФЕЙСе на Data Box. Дополнительные сведения см. в статье [использование локального веб-интерфейса для администрирования Data Box и Data Box Heavy](./data-box-local-web-ui-admin.md).

> [!NOTE]
> Файлы с ACL, содержащие строки записи управления условным доступом (ACE), не копируются. Это известная проблема. Чтобы обойти это, скопируйте эти файлы в общую папку службы файлов Azure вручную, подключив общую папку, а затем используя средство копирования, которое поддерживает копирование списков ACL.

## <a name="copying-data-and-metadata"></a>Копирование данных и метаданных

Для перемещения списков управления доступом, меток времени и атрибутов данных используйте следующие процедуры для копирования данных в Data Box. 

### <a name="windows-data-copy-tool"></a>Средство копирования данных Windows

Чтобы скопировать данные в Data Box через SMB, используйте средство копирования файлов, совместимое с SMB, например `robocopy` . Следующий пример команды копирует все файлы и каталоги, передавая метаданные вместе с данными.

При использовании `/copyall` параметра или `/dcopy:DAT` Убедитесь, что необходимые права оператора резервного копирования не отключены. Дополнительные сведения см. в статье [использование локального веб-интерфейса для администрирования Data Box и Data Box Heavy](./data-box-local-web-ui-admin.md). 

```console
robocopy <Source> <Target> * /copyall /e /dcopy:DAT /r:3 /w:60 /is /nfl /ndl /np /MT:32 or 64 /fft /log+:<LogFile>
```

where

|Параметр |Описание |
|------------------- | ----- |
|`/copyall` |Копирует все атрибуты.|
|`/e`      |Копирует подкаталоги, включая пустые каталоги.         |
|`/dcopy:DAT`  |Копирует данные, атрибуты и метки времени. Примечание. для перемещения по каталогам необходимо использовать параметр/дкопи: DAT `CreationTime` . |
|`/r:3`    |Указывает 3 повторных попыток для неудачных копий.         |
|`/w:60`   |Указывает время ожидания в 60 секунд между повторными попытками.         |
|`/is`     |Включает одни и те же файлы.         |
|`/nfl`    |Не регистрирует имена файлов.         |
|`/ndl`    |Не регистрирует имена каталогов.        |
|`/np`     |Не отображает ход выполнения операции копирования.         |
|`/MT:32 or 64`  |Использует многопоточность с 32 или 64 потоками.           |
|`/fft`    |Сокращает степень детализации метки времени для любой файловой системы.        |
|`/log+:<LogFile>`  |Добавление выходных данных в существующий файл журнала.|

Дополнительные сведения об этих `robocopy` параметрах см. в разделе [учебник. копирование данных в Azure Data Box через SMB.](./data-box-deploy-copy-data.md)

### <a name="linux-data-copy-tool"></a>Средство копирования данных Linux

Передача метаданных в Linux состоит из двух этапов. Во-первых, вы копируете исходные данные с помощью такого средства `rsync` , как, которое не копирует метаданные. После копирования данных можно скопировать метаданные с помощью такого средства, как `smbcacls` или `cifsacl` . 

Приведенные ниже примеры команд выполняют первый шаг, копируя данные с помощью `rsync` . 

```console
cp -aR /etc /opt/ 
rsync -avP /etc /opt (-a copies a directory)
```

## <a name="next-steps"></a>Дальнейшие шаги

- [Копирование данных в Azure Data Box через SMB](./data-box-deploy-copy-data.md)