---
title: Подключение данных syslog к Azure Sentinel | Документация Майкрософт
description: Узнайте, как подключить данные syslog к Azure Sentinel.
services: sentinel
documentationcenter: na
author: rkarlin
manager: rkarlin
editor: ''
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/24/2019
ms.author: rkarlin
ms.openlocfilehash: b2be563efa3c09cffaf14dec2b871f3881af1a7a
ms.sourcegitcommit: 992e070a9f10bf43333c66a608428fcf9bddc130
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2019
ms.locfileid: "71240046"
---
# <a name="connect-your-external-solution-using-syslog"></a>Подключение внешнего решения с помощью syslog

Вы можете подключить любое локальное устройство, поддерживающее syslog, в метку Azure. Это делается с помощью агента, основанного на компьютере Linux между устройством и Sentinel. Если компьютер Linux находится в Azure, вы можете выполнить потоковую передачу журналов из устройства или приложения в выделенную рабочую область, созданную в Azure, и подключить ее. Если компьютер Linux не находится в Azure, можно выполнить потоковую передачу журналов с устройства на отдельную локальную ВИРТУАЛЬную машину или компьютер, на котором устанавливается агент для Linux. 

> [!NOTE]
> Если устройство поддерживает syslog CEF, подключение является более полным, и следует выбрать этот параметр и выполнить инструкции из раздела [подключение данных из CEF](connect-common-event-format.md).

## <a name="how-it-works"></a>Как это работает

Системный журнал (Syslog) — это протокол ведения журнала событий, который обычно используется в Linux. Приложения отправляют сообщения, которые могут храниться на локальном компьютере или передаваться в сборщик системного журнала. При установке агента Log Analytics для Linux он настраивает локальную управляющую программу Syslog для пересылки сообщений в агент. Затем агент отправляет сообщение в Azure Monitor, где создается соответствующая запись.

Дополнительные сведения см. [в разделе источники данных syslog в Azure Monitor](../azure-monitor/platform/data-sources-syslog.md).

> [!NOTE]
> Агент может получать журналы из нескольких источников, но должен быть установлен на выделенном прокси-компьютере.

## <a name="connect-your-syslog-appliance"></a>Подключение устройства системного журнала

1. В поле Sentinel Azure выберите **соединители данных** , а затем выберите соединитель **syslog** .

2. В колонке **системного журнала** выберите **открыть страницу соединителя**.

3. Установите агент Linux:
    
    - Если ваша виртуальная машина Linux находится в Azure, выберите **скачать и установить агент на виртуальной машине Linux в Azure**. В колонке **виртуальные машины** выберите виртуальные машины для установки агента, а затем нажмите кнопку **подключить**.
    - Если компьютер Linux не находится в Azure, выберите **скачать и установить агент на компьютере Linux без Azure**. В колонке **Direct Agent (прямой агент** ) скопируйте команду для **скачивания и подключения агента для Linux** и запустите его на компьютере. 
    
   > [!NOTE]
   > Убедитесь, что настройки безопасности для этих компьютеров настроены в соответствии с политикой безопасности вашей организации. Например, можно настроить параметры сети для согласования с политикой сетевой безопасности Организации, а также изменить порты и протоколы в управляющей программе в соответствии с требованиями безопасности.

4. Выберите **открыть рабочую область Конфигурация дополнительных параметров**.

5. В колонке **Дополнительные параметры** выберите **Data** > **syslog**. Затем добавьте средства для собираются соединителя.
    
    Добавьте в заголовки журналов средства, включаемые устройством syslog. Эту конфигурацию можно просмотреть в системном модуле syslog **-d** в `/etc/rsyslog.d/security-config-omsagent.conf` папке и в **r-syslog** из `/etc/syslog-ng/security-config-omsagent.conf`.
    
    Если вы хотите использовать аномальное обнаружение входа SSH с собранными данными, добавьте **AUTH** и **аусприв**. Дополнительные сведения см. в [следующем разделе](#configure-the-syslog-connector-for-anomalous-ssh-login-detection) .

6. После добавления всех средств, которые необходимо отслеживать, и настройки параметров серьезности для каждого из них, установите флажок **Применить к моим компьютерам следующую конфигурацию**.

7. Щелкните **Сохранить**. 

8. На устройстве syslog убедитесь, что вы отправляете указанные Вами средства.

9. Чтобы использовать соответствующую схему в Azure Monitor журналов системного журнала, выполните поиск **системного**журнала.

10. Функцию Kusto, описанную в разделе [Использование функций в Azure Monitor запросов к журналу](../azure-monitor/log-query/functions.md) , можно использовать для анализа сообщений системного журнала. Затем можно сохранить их как новую функцию Log Analytics для использования в качестве нового типа данных.

### <a name="configure-the-syslog-connector-for-anomalous-ssh-login-detection"></a>Настройка соединителя syslog для обнаружения аномальных входов SSH

> [!IMPORTANT]
> Аномальное обнаружение входа SSH в настоящее время находится в общедоступной предварительной версии.
> Эта функция предоставляется без соглашения об уровне обслуживания и не рекомендуется для рабочих нагрузок.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Sentinel Azure может применить машинное обучение (ML) к данным системного журнала для обнаружения аномальных Secure Shell (SSH). Сценарии включают:

- Невозможность перемещения — когда два успешных события входа происходят из двух расположений, которые не удается достичь в течение времени двух событий входа в систему.
- Неожиданное расположение — это расположение, из которого произошло успешное событие входа, подозрительное. Например, расположение не было недавно замечено.
 
Для этого обнаружения требуется определенная конфигурация соединителя данных syslog: 

1. В шаге 5 предыдущей процедуры убедитесь, что в качестве наблюдаемых средств выбраны обе **проверки подлинности** и **аусприв** . Используйте параметры по умолчанию для параметров серьезности, чтобы они были выбраны. Пример:
    
    > [!div class="mx-imgBorder"]
    > ![Средства, необходимые для обнаружения аномальных входов по протоколу SSH](./media/connect-syslog/facilities-ssh-detection.png)

2. Подождите, достаточно времени для сбора данных системного журнала. Затем перейдите в раздел **Azure Sentinel-Logs**и скопируйте и вставьте следующий запрос:
    
        Syslog |  where Facility in ("authpriv","auth")| extend c = extract( "Accepted\\s(publickey|password|keyboard-interactive/pam)\\sfor ([^\\s]+)",1,SyslogMessage)| where isnotempty(c) | count 
    
    Измените **диапазон времени** , если это необходимо, и выберите **выполнить**.
    
    Если полученное значение счетчика равно нулю, проверьте конфигурацию соединителя и убедитесь, что наблюдаемые компьютеры успешно выполнили вход в течение указанного периода времени для запроса.
    
    Если полученное число больше нуля, данные системного журнала подходят для обнаружения аномальных входов по протоколу SSH. Это обнаружение включается из**шаблона** > правил **аналитики** >   **(Предварительная версия) с аномальным обнаружением входа SSH**.

## <a name="next-steps"></a>Следующие шаги
В этом документе вы узнали, как подключить локальные устройства syslog к Azure Sentinel. Ознакомьтесь с дополнительными сведениями об Azure Sentinel в соответствующих статьях.
- Узнайте, как [получить представление о данных и потенциальных угрозах](quickstart-get-visibility.md).
- Приступая [к обнаружению угроз с помощью Azure Sentinel](tutorial-detect-threats-built-in.md).
