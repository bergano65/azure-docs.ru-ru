---
ms.date: 02/16/2021
ms.topic: reference-architecture
author: kriation
title: Эталонная архитектура Azure весны в облаке
ms.author: akaleshian
ms.service: spring-cloud
description: Эталонная архитектура — это основа, использующая типичный корпоративный центр и периферийный проект для использования Azure Веснного облака.
ms.openlocfilehash: 7d069e67e5161135b309aee3dc9c6ac921105623
ms.sourcegitcommit: 58ff80474cd8b3b30b0e29be78b8bf559ab0caa1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/17/2021
ms.locfileid: "100634368"
---
# <a name="azure-spring-cloud-reference-architecture"></a>Эталонная архитектура Azure весны в облаке

Эталонная архитектура — это основа, использующая типичный корпоративный центр и периферийный проект для использования Azure Веснного облака. В проекте пружинное облако Azure развертывается в одной периферийной зоне, которая зависит от общих служб, размещенных в центре. Архитектура построена с помощью компонентов для достижения принципов в [Microsoft Azure Well-Architected Framework][16].

Сведения о реализации этой архитектуры см. в репозитории [эталонной архитектуры Azure весны облака][10] в GitHub.

Варианты развертывания для этой архитектуры включают Azure Resource Manager (ARM), terraform и Azure CLI. Артефакты в этом репозитории предоставляют основу, которую можно настроить для конкретной среды. Вы можете группировать ресурсы, например брандмауэр Azure или шлюз приложений, в разные группы ресурсов или подписки. Эта группировка позволяет разделять разные функции, такие как ИТ-инфраструктура, безопасность, группы бизнес-приложений и т. д.

## <a name="planning-the-address-space"></a>Планирование адресного пространства

Для Azure Веснного облака требуются две выделенные подсети:

* Среда выполнения службы
* Приложения с пружинной загрузкой

Для каждой из этих подсетей требуется выделенный кластер. Несколько кластеров не могут совместно использовать одни и те же подсети. Минимальный размер каждой подсети —/28. Количество экземпляров приложений, которые может поддерживать Azure Веснного облака, зависит от размера подсети. Подробные требования к виртуальной сети (VNET) можно найти в разделе [требования к виртуальной][11] сети статьи [развертывание Azure веснного облака в виртуальной сети][17].

> [!WARNING]
> Выбранный размер подсети не может перекрывать существующее адресное пространство ВИРТУАЛЬНОЙ сети и не должен перекрываться с диапазонами адресов одноранговых или локальных подсетей.

## <a name="use-cases"></a>Варианты использования

Типичные способы использования этой архитектуры:

* Внутренние приложения, развернутые в гибридных облачных средах
* Внешние приложения

Эти варианты использования похожи, за исключением правил безопасности и сетевого трафика. Эта архитектура разработана для поддержки различных нюансов каждого из них.

## <a name="private-applications"></a>Частные приложения

В следующем списке описываются требования к инфраструктуре для частных приложений. Эти требования типичны в средах с высоким уровнем регулируемости.

* Нет прямого выхода в общедоступный Интернет, за исключением трафика управляющей плоскости.
* Трафик исходящего трафика должен проходить через Центральный виртуальный сетевой модуль (NVA) (например, брандмауэр Azure).
* Неактивных данных следует зашифровать.
* Передаваемые данные должны быть зашифрованы.
* Можно использовать конвейеры развертывания DevOps (например, Azure DevOps) и требовать сетевого подключения к Azure Веснного облака.
* Для обеспечения безопасности с нулевым доверием корпорации Майкрософт требуется, чтобы секреты, сертификаты и учетные данные хранились в безопасном хранилище. Рекомендуемая служба — Azure Key Vault.
* Записи службы доменных имен (DNS) узла приложений должны храниться в Частная зона DNS Azure.
* Разрешение имен для узлов в локальной среде и в облаке должно быть двунаправленным.
* Необходимо обеспечить соблюдение хотя бы одного теста безопасности.
* Зависимости служб Azure должны взаимодействовать через конечные точки службы или закрытые ссылки.
* Группы ресурсов, управляемые облачным развертыванием Azure весны, не должны изменяться.
* Подсети, управляемые с помощью облачного развертывания Azure весны, не должны изменяться.
* Подсеть должна иметь только один экземпляр Azure Веснного облака.
* Если для загрузки свойств конфигурации из репозитория используется [сервер конфигурации Azure пружины Cloud][8] , репозиторий должен быть частным.

Ниже перечислены компоненты, составляющие структуру.

* Локальная сеть
  * Служба доменных имен (DNS)
  * Шлюз
* Подписку центра
  * Подсеть брандмауэра Azure
  * Подсеть шлюза приложений
  * Подсеть общих служб
* Подключенная подписка
  * Одноранговый узел виртуальной сети
  * Подсеть бастиона для Azure

В следующем списке описаны службы Azure в этой эталонной архитектуре.

* [Azure веснного облака][1]— управляемая служба, разработанная и оптимизированная специально для приложений с пружинной загрузкой на основе Java и. [Стилтое][9] приложения на основе NET.

* [Azure Key Vault][2]: Служба управления учетными данными, поддерживающая оборудование, которая тесно интегрируется со службами Microsoft Identity и ресурсами вычислений.

* [Azure Monitor][3]: полный набор служб мониторинга для приложений, которые развертываются как в Azure, так и в локальной среде.

* [Центр безопасности Azure][4]— единая система управления безопасностью и защиты от угроз для рабочих нагрузок в локальной среде, нескольких облаках и Azure.

* [Azure pipelines][5]: Полнофункциональная служба непрерывной интеграции и непрерывной разработки (CI/CD), которая может автоматически развертывать обновленные приложения с пружинной загрузкой в Azure веснного облака.

На следующей схеме показана грамотно спроектированная конструкция концентратора и звезды, которая соответствует приведенным выше требованиям.

![Эталонная схема архитектуры для частных приложений](./media/spring-cloud-reference-architecture/architecture-private.png)

## <a name="public-applications"></a>Общедоступные приложения

В следующем списке описываются требования к инфраструктуре для общедоступных приложений. Эти требования типичны в средах с высоким уровнем регулируемости.

* Входящий трафик должен управляться по крайней мере шлюзом приложений или передней дверце Azure.
* Необходимо включить стандарт защиты Azure от атак DDoS.
* Нет прямого выхода в общедоступный Интернет, за исключением трафика управляющей плоскости.
* Трафик исходящего трафика должен пройти центральное сетевое устройство (NVA) (например, брандмауэр Azure).
* Неактивных данных следует зашифровать.
* Передаваемые данные должны быть зашифрованы.
* Можно использовать конвейеры развертывания DevOps (например, Azure DevOps) и требовать сетевого подключения к Azure Веснного облака.
* Для обеспечения безопасности с нулевым доверием корпорации Майкрософт требуется, чтобы секреты, сертификаты и учетные данные хранились в безопасном хранилище. Рекомендуемая служба — Azure Key Vault.
* Записи DNS узла приложений должны храниться в Частная зона DNS Azure.
* Адреса, направляемые через Интернет, должны храниться в общедоступном DNS-сервере Azure.
* Разрешение имен для узлов в локальной среде и в облаке должно быть двунаправленным.
* Необходимо обеспечить соблюдение хотя бы одного теста безопасности.
* Зависимости служб Azure должны взаимодействовать через конечные точки службы или закрытые ссылки.
* Группы ресурсов, управляемые облачным развертыванием Azure весны, не должны изменяться.
* Подсети, управляемые с помощью облачного развертывания Azure весны, не должны изменяться.
* Подсеть должна иметь только один экземпляр Azure Веснного облака.

Ниже перечислены компоненты, составляющие структуру.

* Локальная сеть
  * Служба доменных имен (DNS)
  * Шлюз
* Подписку центра
  * Подсеть брандмауэра Azure
  * Подсеть шлюза приложений
  * Подсеть общих служб
* Подключенная подписка
  * Одноранговый узел виртуальной сети
  * Подсеть бастиона для Azure

В следующем списке описаны службы Azure в этой эталонной архитектуре.

* [Azure веснного облака][1]— управляемая служба, разработанная и оптимизированная специально для приложений с пружинной загрузкой на основе Java и. [Стилтое][9] приложения на основе NET.

* [Azure Key Vault][2]: Служба управления учетными данными, поддерживающая оборудование, которая тесно интегрируется со службами Microsoft Identity и ресурсами вычислений.

* [Azure Monitor][3]: полный набор служб мониторинга для приложений, которые развертываются как в Azure, так и в локальной среде.

* [Центр безопасности Azure][4]— единая система управления безопасностью и защиты от угроз для рабочих нагрузок в локальной среде, нескольких облаках и Azure.

* [Azure pipelines][5]: Полнофункциональная служба непрерывной интеграции и непрерывной разработки (CI/CD), которая может автоматически развертывать обновленные приложения с пружинной загрузкой в Azure веснного облака.

* [Шлюз приложений Azure][6]. балансировщик нагрузки, отвечающий за трафик приложений с разгрузкой TLS на уровне 7.

* [Брандмауэр приложения Azure][7]— это функция шлюза приложений Azure, которая обеспечивает централизованную защиту приложений от распространенных уязвимостей и уязвимых мест.

На следующей схеме показана грамотно спроектированная конструкция концентратора и звезды, которая соответствует приведенным выше требованиям.

![Эталонная схема архитектуры для общедоступных приложений](./media/spring-cloud-reference-architecture/architecture-public.png)

## <a name="azure-spring-cloud-on-premises-connectivity"></a>Локальное подключение к облачному облаку Azure

Приложения, работающие в Azure Веснного облака, могут взаимодействовать с различными службами Azure, локальными и внешними ресурсами. Используя Центрально-лучевую конструкцию, приложения могут маршрутизировать трафик извне или к локальной сети с помощью Express Route или виртуальной частной сети типа "сеть — сеть" (VPN).

## <a name="azure-well-architected-framework-considerations"></a>Рекомендации по Azure Well-Architected Framework

[Платформа Azure Well-Architected Framework][16] — это набор принципов GUID, которые необходимо выполнить при создании надежной инфраструктуры. Платформа содержит следующие категории: оптимизация затрат, эффективное эксплуатацию, эффективность, надежность и безопасность.

### <a name="cost-optimization"></a>Оптимизация затрат

Из-за природы структуры распределенных систем неравномерность инфраструктуры является реальной. Это приводит к непредвиденным и неконтролируемых затратам. Облачное облако Azure строится с использованием компонентов, масштабируемых таким образом, чтобы он мог удовлетворить спрос и оптимизировать затраты. Основой этой архитектуры является служба Azure Kubernetes (AKS). Служба разработана таким образом, чтобы снизить сложность и эксплуатационные издержки на управление Kubernetes, в число которых входят эффективные эксплуатационные затраты на кластер.

Вы можете развернуть различные приложения и типы приложений в одном экземпляре Azure Веснного облака. Служба поддерживает автоматическое масштабирование приложений, активируемых метриками или расписаниями, которые могут повысить эффективность использования и экономичность.

Можно также использовать Application Insights и Azure Monitor для снижения эксплуатационных затрат. Благодаря видимости, предоставляемой исчерпывающим решением для ведения журнала, можно реализовать автоматизацию для масштабирования компонентов системы в режиме реального времени. Можно также проанализировать данные журнала, чтобы выявить неэффективные в коде приложения, которые можно решить, чтобы повысить общую стоимость и производительность системы.

### <a name="operational-excellence"></a>эффективность работы;

Azure Веснного облака решает несколько аспектов эксплуатации. Эти аспекты можно сочетать, чтобы обеспечить эффективную работу службы в рабочих средах, как описано в следующем списке.

* Azure Pipelines можно использовать для обеспечения надежности и единообразия развертываний, помогая избежать ошибок человека.
* Для хранения данных журнала и телеметрии можно использовать Azure Monitor и Application Insights.
  Вы можете оценить собранные данные журнала и метрики, чтобы обеспечить работоспособность и производительность приложений. Функция наблюдения за производительностью приложений (APM) полностью интегрирована в службу с помощью агента Java. Этот агент предоставляет сведения обо всех развернутых приложениях и зависимостях, не требуя дополнительного кода. Дополнительные сведения см. в записи блога по [легкому мониторингу приложений и зависимостей в Azure веснного облака][15].
* Центр безопасности Azure можно использовать для обеспечения безопасности приложений, предоставляя платформу для анализа и оценки предоставляемых данных.
* Служба поддерживает различные шаблоны развертывания. Дополнительные сведения см. в статье [Настройка промежуточной среды в Azure Spring Cloud][14].

### <a name="reliability"></a>Надежность

Azure Веснное облако разработано с AKS в качестве основы компонента. Хотя AKS обеспечивает уровень устойчивости посредством кластеризации, эта Эталонная архитектура включает в себя службы и архитектурные вопросы, позволяющие повысить доступность приложения в случае сбоя компонента.

Основываясь на четко определенной структуре концентратора и звезды, фундамент этой архитектуры гарантирует, что ее можно развернуть в нескольких регионах. В случае частного использования приложения архитектура использует Azure Частная зона DNS, чтобы обеспечить непрерывную доступность во время географического сбоя. Для общедоступного варианта использования приложения клиентская дверца Azure и шлюз приложений Azure обеспечивают доступность.

### <a name="security"></a>Безопасность

Безопасность этой архитектуры решается за счет соответствия отраслевым элементам управления и тестовым показателям. Элементы управления в этой архитектуре относятся к [матрице Cloud Control][19] (CCM) в [Cloud Security Alliance][18] (CSA) и [Microsoft Azure Foundation][20] (мафб) в [центре безопасности Интернета][21] (CIS). В примененных элементах управления основное внимание уделяется основным принципам разработки безопасности, сети и безопасности приложений. Вы обязаны управлять принципами разработки удостоверений, управления доступом и хранения данных, связанных с целевой инфраструктурой.

#### <a name="governance"></a>Система управления

Основной аспект управления тем, что эта архитектура устраняется за счет изоляции сетевых ресурсов. В CCM, DCS-08 рекомендует управление входящим и исходящим трафиком для центра обработки данных. Для удовлетворения этого элемента управления архитектура использует центрально-лучевой проект, использующий группы безопасности сети (группы безопасности сети) для фильтрации трафика Дальнего Востока между ресурсами. Архитектура также фильтрует трафик между центральными службами в концентраторе и ресурсами на периферийном сервере. Архитектура использует экземпляр брандмауэра Azure для управления трафиком между Интернетом и ресурсами в архитектуре.

В следующем списке показан элемент управления, который обращается к безопасности центра обработки данных в этой ссылке:

| Идентификатор элемента управления CCM на CSA | Домен управления CSA CCM |
| :----------------- | :----------------------|
| DCS-08 | Запись неавторизованных лиц по безопасности центра обработки данных |

#### <a name="network"></a>Сеть

Структура сети, поддерживающая эту архитектуру, является производной от традиционной модели концентратора и звезды. Это решение гарантирует, что сетевая изоляция является базовой конструкцией. CCM Control IVS-06 рекомендует, чтобы трафик между сетями и виртуальными машинами был ограничен и отслеживаться между доверенными и недоверенными средами. Эта архитектура принимает элемент управления путем реализации группы безопасности сети для трафика Восточной Азии, а брандмауэр Azure — для трафика Север-Южный. CCM Control IPY-04 рекомендует инфраструктуре использовать защищенные сетевые протоколы для обмена данными между службами. Службы Azure, поддерживающие эту архитектуру, используют стандартные безопасные протоколы, такие как TLS, для HTTP и SQL.

В следующем списке показаны элементы управления CCM, которые устраняют сетевую безопасность в этой ссылке:

| Идентификатор элемента управления CCM на CSA | Домен управления CSA CCM |
| :----------------- | :----------------------|
| IPY-04             | Сетевые протоколы      |
| IVS-06             | Безопасность сети       |

Реализация сети еще более защищена путем определения элементов управления из МАФБ. Элементы управления гарантируют, что трафик в среду ограничен общедоступным Интернетом.

В следующем списке показаны элементы управления CI, которые устраняют сетевую безопасность в этой ссылке:

| Идентификатор элемента управления CIS | Описание элемента управления CI |
| :------------- | :---------------------- |
| 6.2 | Убедитесь, что доступ по протоколу SSH ограничен Интернетом. |
| 6.3 | Убедитесь, что ни одна из баз данных SQL не разрешает входные сообщения 0.0.0.0/0 (любой IP-адрес). |
| 6,5 | Убедитесь, что наблюдатель за сетями включен. |
| 6.6 | Убедитесь, что входящий трафик с использованием UDP ограничен Интернетом. |

При развертывании в защищенной среде облачное облако Azure требует исходящего трафика управления из Azure. Для этого необходимо разрешить правила сети и приложения, перечисленные в области [ответственности клиента для запуска Azure веснного облака в виртуальной сети](/azure/spring-cloud/spring-cloud-vnet-customer-responsibilities).

#### <a name="application-security"></a>Защита приложений

Этот субъект-проект охватывает фундаментальные компоненты идентификации, защиты данных, управления ключами и конфигурации приложений. Приложение, развернутое в Azure Веснного облака, работает с минимальными привилегиями, необходимыми для работы. Набор элементов управления авторизацией напрямую связан с защитой данных при использовании службы. Управление ключами — это многоуровневый подход к безопасности приложений.

В следующем списке показаны элементы управления CCM, которые устраняют управление ключами в этой ссылке:

| Идентификатор элемента управления CCM на CSA | Домен управления CSA CCM |
| :----------------- | :--------------------- |
| РАСШИРЕННОЕ УПРАВЛЕНИЕ КЛЮЧАМИ — 01 | Право на шифрование и управление ключами |
| РАСШИРЕННОЕ УПРАВЛЕНИЕ КЛЮЧАМИ — 02 | Создание ключей шифрования и управления ключами |
| РАСШИРЕННОЕ УПРАВЛЕНИЕ КЛЮЧАМИ — 03 | Защита конфиденциальных данных с учетом шифрования и управления ключами |
| РАСШИРЕННОЕ УПРАВЛЕНИЕ КЛЮЧАМИ — 04 | Шифрование и доступ к хранилищу и управлению ключами |

С помощью CCM, расширенного управления ключами-02 и расширенного управления ключами-03 рекомендуются политики и процедуры, позволяющие управлять ключами и использовать протоколы шифрования для защиты конфиденциальных данных. Расширенное управление ключами (Cryptographic-01) рекомендует всем криптографическим ключам идентифицировать владельцев, чтобы ими можно было управлять. Расширенное управление ключами — 04 рекомендует использовать стандартные алгоритмы.

В следующем списке показаны элементы управления CI, которые устраняют управление ключами в этой ссылке:

| Идентификатор элемента управления CIS | Описание элемента управления CI |
| :------------- | :---------------------- |
| 8.1 | Убедитесь, что Дата окончания срока действия задана для всех ключей. |
| 8.2 | Убедитесь, что Дата окончания срока действия задана для всех секретов. |
| 8.4 | Убедитесь, что хранилище ключей подлежит восстановлению. |

Элементы управления CI 8,1 и 8,2 рекомендуют, чтобы даты истечения срока действия были заданы для учетных данных, чтобы обеспечить принудительное вращение. Элемент управления CIS 8,4 гарантирует, что содержимое хранилища ключей можно будет восстановить для обеспечения непрерывности бизнес-процессов.

Аспекты безопасности приложений задают основу для использования этой эталонной архитектуры для поддержки пружинной рабочей нагрузки в Azure.

## <a name="next-steps"></a>Дальнейшие действия

Изучите эту эталонную архитектуру с помощью развертываний ARM, terraform и Azure CLI, доступных в репозитории [эталонной архитектуры Azure "пружинное облако][10] ".

<!-- Reference links in article -->
[1]: /azure/spring-cloud/
[2]: /azure/key-vault/
[3]: /azure/azure-monitor/
[4]: /azure/security-center/
[5]: /azure/devops/pipelines/
[6]: /azure/application-gateway/
[7]: /azure/web-application-firewall/
[8]: /azure/spring-cloud/spring-cloud-tutorial-config-server/
[9]: https://steeltoe.io/
[10]: https://github.com/Azure/azure-spring-cloud-reference-architecture
[11]: /azure/spring-cloud/spring-cloud-tutorial-deploy-in-azure-virtual-network#virtual-network-requirements
[12]: /azure/spring-cloud/spring-cloud-vnet-customer-responsibilities#azure-spring-cloud-network-requirements
[13]: /azure/spring-cloud/spring-cloud-vnet-customer-responsibilities#azure-spring-cloud-fqdn-requirements--application-rules
[14]: /azure/spring-cloud/spring-cloud-howto-staging-environment
[15]: https://devblogs.microsoft.com/java/monitor-applications-and-dependencies-in-azure-spring-cloud/
[16]: /azure/architecture/framework/
[17]: /azure/spring-cloud/spring-cloud-tutorial-deploy-in-azure-virtual-network#virtual-network-requirements
[18]: https://cloudsecurityalliance.org/
[19]: https://cloudsecurityalliance.org/research/working-groups/cloud-controls-matrix
[20]: https://azure.microsoft.com/resources/cis-microsoft-azure-foundations-security-benchmark/
[21]: https://www.cisecurity.org/
