---
title: Анализ журналов и метрик в Azure Веснного облака | Документация Майкрософт
description: Узнайте, как анализировать диагностические данные в Azure с пружинным облаком
services: spring-cloud
author: jpconnock
manager: gwallace
editor: ''
ms.service: spring-cloud
ms.topic: conceptual
ms.date: 10/06/2019
ms.author: jeconnoc
ms.openlocfilehash: 955641f3511989baa5bfc3c0fa4d7df7ccbf9bfa
ms.sourcegitcommit: ae461c90cada1231f496bf442ee0c4dcdb6396bc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2019
ms.locfileid: "72554584"
---
# <a name="analyze-logs-and-metrics-with-diagnostics-settings"></a>Анализ журналов и метрик с помощью параметров диагностики

С помощью функции диагностики в Azure Веснного облака можно анализировать журналы и метрики с помощью любой из следующих служб:

* Используйте Log Analytics Azure, где данные записываются немедленно, без необходимости предварительной записи в хранилище.
* Сохраните их в учетной записи хранения для аудита или проверки вручную. Можно указать время хранения (в днях).
* Потоковая передача в концентратор событий для приема сторонними службами или решением пользовательской аналитики.

Чтобы начать работу, включите одну из этих служб для получения данных. Чтобы узнать о настройке Log Analytics, ознакомьтесь [со статьей начало работы с log Analytics в Azure Monitor](../azure-monitor/log-query/get-started-portal.md). 

## <a name="configure-diagnostics-settings"></a>Настройка параметров диагностики

1. В портал Azure перейдите к своему экземпляру Azure весны в облаке.
1. Выберите параметр **параметры диагностики** , а затем щелкните **Добавить параметр диагностики**.
1. Введите имя параметра, а затем выберите место, куда нужно отправить журналы. Можно выбрать любое сочетание следующих трех параметров.
    * **Архивация в учетную запись хранения**
    * **Поток в концентратор событий**
    * **Отправить на Log Analytics**

1. Выберите категорию журнала и категорию метрик, которые требуется отслеживать, а затем укажите время хранения (в днях). Время хранения применяется только к учетной записи хранения.
1. Щелкните **Сохранить**.

> [!NOTE]
> Между созданием журналов и метрик и их появлением в учетной записи хранения, концентраторе событий или Log Analytics может существовать промежуток в течение 15 минут.

## <a name="view-the-logs"></a>Просмотр журналов

### <a name="use-log-analytics"></a>Использование Log Analytics

1. В портал Azure в левой области выберите **log Analytics**.
1. Выберите рабочую область Log Analytics, которая была выбрана при добавлении параметров диагностики.
1. Чтобы открыть панель **поиска по журналам** , выберите **журналы**.
1. В поле поиска по **журналам** введите простой запрос, например:

    ```sql
    AppPlatformLogsforSpring
    | limit 50
    ```

1. Чтобы просмотреть результат поиска, выберите **выполнить**.
1. Можно выполнить поиск в журналах конкретного приложения или экземпляра, задав условие фильтра:

    ```sql
    AppPlatformLogsforSpring
    | where ServiceName == "YourServiceName" and AppName == "YourAppName" and InstanceName == "YourInstanceName"
    | limit 50
    ```

Дополнительные сведения о языке запросов, который используется в Log Analytics, см. в разделе [Azure Monitor запросы журналов](../azure-monitor/log-query/query-language.md).

### <a name="use-your-storage-account"></a>Использование учетной записи хранения 

1. На панели слева в портал Azure выберите **учетные записи хранения**.

1. Выберите учетную запись хранения, выбранную при добавлении параметров диагностики.
1. Чтобы открыть панель **BLOB-контейнера** , выберите **BLOB-объекты**.
1. Чтобы просмотреть журналы приложений, выполните поиск контейнера с именем **Insights-Logs-аппликатионконсоле**.
1. Чтобы просмотреть метрики приложения, выполните поиск контейнера с именем **Insights-метрики-pt1m**.

Дополнительные сведения об отправке диагностических сведений в учетную запись хранения см. [в статье хранение и Просмотр диагностических данных в службе хранилища Azure](https://docs.microsoft.com/azure/azure-monitor/platform/diagnostics-extension-to-storage).

### <a name="use-your-event-hub"></a>Использование концентратора событий

1. На панели слева в портал Azure выберите **концентраторы событий**.

1. Найдите и выберите концентратор событий, выбранный при добавлении параметров диагностики.
1. Чтобы открыть панель **списка концентраторов событий** , выберите **концентраторы событий**.
1. Чтобы просмотреть журналы приложений, выполните поиск концентратора событий с именем **Insights-Logs-аппликатионконсоле**.
1. Чтобы просмотреть метрики приложения, выполните поиск концентратора событий с именем **Insights-метрики-pt1m**.

Дополнительные сведения об отправке диагностических сведений в концентратор событий см. в статье [потоковая передача система диагностики Azure данных в критическом пути с помощью концентраторов событий](https://docs.microsoft.com/azure/azure-monitor/platform/diagnostics-extension-stream-event-hubs).

## <a name="analyze-the-logs"></a>Анализ журналов

Azure Log Analytics предоставляет Kusto, чтобы можно было выполнять запросы к журналам для анализа. Краткие сведения о запросах журналов с помощью Kusto см. в [руководстве по log Analytics](../azure-monitor/log-query/get-started-portal.md).

Журналы приложений предоставляют важную информацию о работоспособности, производительности и других приложениях приложения. В следующих разделах приведены некоторые простые запросы, помогающие понять текущее и предыдущее состояния приложения.

### <a name="show-application-logs-from-azure-spring-cloud"></a>Отображение журналов приложений из Azure Веснного облака

Чтобы просмотреть список журналов приложений из Azure Веснного облака, отсортированный по времени с самыми последними журналами, показанными в первую очередь, выполните следующий запрос:

```sql
AppPlatformLogsforSpring
| project TimeGenerated , ServiceName , AppName , InstanceName , Log
| sort by TimeGenerated desc
```

### <a name="show-logs-entries-containing-errors-or-exceptions"></a>Отображение записей журналов, содержащих ошибки или исключения

Чтобы проверить несортированные записи журнала, в которых упоминается ошибка или исключение, выполните следующий запрос:

```sql
AppPlatformLogsforSpring
| project TimeGenerated , ServiceName , AppName , InstanceName , Log
| where Log contains "error" or Log contains "exception"
```

Используйте этот запрос для поиска ошибок или изменения условий запроса для поиска конкретных кодов ошибок или исключений. 

### <a name="show-the-number-of-errors-and-exceptions-reported-by-your-application-over-the-last-hour"></a>Отображение количества ошибок и исключений, о которых сообщило приложение за последний час

Чтобы создать круговую диаграмму, отображающую количество ошибок и исключений, зарегистрированных приложением за последний час, выполните следующий запрос:

```sql
AppPlatformLogsforSpring
| where TimeGenerated > ago(1h)
| where Log contains "error" or Log contains "exception"
| summarize count_per_app = count() by AppName
| sort by count_per_app desc
| render piechart
```

### <a name="learn-more-about-querying-application-logs"></a>Дополнительные сведения о запросах журналов приложений

Azure Monitor предоставляет обширную поддержку для запросов журналов приложений с помощью Log Analytics. Дополнительные сведения об этой службе см. в разделе Начало [работы с запросами журналов в Azure Monitor](../azure-monitor/log-query/get-started-queries.md). Дополнительные сведения о создании запросов для анализа журналов приложений см. в разделе [Обзор запросов журналов в Azure Monitor](../azure-monitor/log-query/log-query-overview.md).
