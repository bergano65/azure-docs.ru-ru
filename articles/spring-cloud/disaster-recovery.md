---
title: Геоизбыточное аварийное восстановление Azure Spring Cloud | Документация Майкрософт
description: Узнайте, как защитить приложение Spring Cloud от региональных сбоев
author: bmitchell287
ms.service: spring-cloud
ms.topic: conceptual
ms.date: 10/24/2019
ms.author: brendm
ms.openlocfilehash: 81ca6b2c365b0dd8a249a337f51d78516cb2cc61
ms.sourcegitcommit: fdec8e8bdbddcce5b7a0c4ffc6842154220c8b90
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2020
ms.locfileid: "83657197"
---
# <a name="azure-spring-cloud-disaster-recovery"></a>Аварийное восстановление Azure Spring Cloud

В этой статье объясняются некоторые стратегии, которые можно использовать для защиты облачных приложений Azure Spring Cloud от простоя.  Любой регион или центр обработки данных может столкнуться с простоями, вызванными региональными авариями, но тщательное планирование может снизить влияние на клиентов.

## <a name="plan-your-application-deployment"></a>Планирование развертывания приложений

Приложения Azure Spring Cloud работают в определенном регионе.  Azure работает в различных странах по всему миру. Географическая территория Azure — это определенная область мира, содержащая по крайней мере один регион Azure. Регион Azure — это область в пределах географической территории, содержащая один или несколько центров обработки данных.  Каждый регион Azure образует пару с другим регионом в пределах той же географической территории. Эти два региона формируют пару регионов. Azure сериализует обновления платформ (плановое обслуживание) в парах регионов, чтобы одновременно обновлялся только один регион из пары. Если сбой затрагивает несколько регионов, по меньшей мере один регион в каждой паре будет приоритетным для восстановления.

Для высокой доступности и защиты от аварий необходимо развертывать приложения Spring Cloud в нескольких регионах.  Azure предоставляет список [парных регионов](../best-practices-availability-paired-regions.md), поэтому вы можете спланировать развертывания Spring Cloud в парах регионах.  При проектировании архитектуры микрослужбы рекомендуется учитывать три ключевых фактора: доступность по регионам, парные регионы Azure и доступность службы.

*  Доступность по регионам:  Выберите географическую область рядом с пользователями, чтобы сократить задержки в сети и время передачи.
*  Пары регионов Azure:  Выберите парные регионы в выбранной географической области, чтобы обеспечить согласованное обновление платформы и приоритетное восстановление при необходимости.
*  Доступность служб.   Определите тип пары регионов: горячий/горячий, горячий/теплый, горячий/холодный.

## <a name="use-azure-traffic-manager-to-route-traffic"></a>Использование диспетчера трафика Azure для маршрутизации трафика

[Диспетчер трафика Azure](../traffic-manager/traffic-manager-overview.md) предоставляет подсистему балансировки нагрузки на основе DNS, которая может распределять сетевой трафик между несколькими регионами.  Используйте Диспетчер трафика Azure, чтобы направлять клиентов в ближайший к ним экземпляр службы Azure Spring Cloud.  Чтобы обеспечить оптимальную производительность и избыточность, направляйте весь трафик приложений через Диспетчер трафика Azure до его отправки в службу Azure Spring Cloud.

Если у вас есть приложения Azure Spring Cloud в нескольких регионах, используйте Диспетчер трафика Azure для управления потоком трафика в приложения в каждом регионе.  Определите конечную точку Диспетчера трафика Azure для каждой службы с помощью IP-адреса службы. Клиенты должны подключаться к DNS-имени Диспетчера трафика Azure, указывающему на облачную службу Azure Spring Cloud.  Диспетчер трафика Azure распределяет трафик между определенными конечными точками.  Если при аварии в центре обработки данных возникнет сбой, Диспетчер трафика Azure направляет трафик из этого региона в его пару, гарантируя непрерывность обслуживания.

## <a name="create-azure-traffic-manager-for-azure-spring-cloud"></a>Создание диспетчера трафика Azure для Azure Spring Cloud

1. Создание Azure Spring Cloud в двух разных регионах.
Вам понадобятся два экземпляра службы Azure Spring Cloud, развернутые в двух разных регионах (Восточная часть США и Западная Европа). Запустите существующее приложение Azure Spring Cloud с помощью портала Azure, чтобы создать два экземпляра службы. Каждый будет использоваться в качестве основных конечных точек и конечных точек отработки отказа для диспетчера трафика. 

**Сведения о двух экземплярах службы:**

| Имя службы | Расположение | Приложение |
|--|--|--|
| service-sample-a | Восточная часть США | gateway / auth-service / account-service |
| service-sample-b | Западная Европа | gateway / auth-service / account-service |

2. Настройка личного домена для службы. Следуйте инструкциям в [документе о личном домене](spring-cloud-tutorial-custom-domain.md), чтобы настроить личный домен для этих двух существующих экземпляров службы. После успешной настройки оба экземпляра службы будут привязаны к пользовательскому домену: bcdr-test.contoso.com

3. Создайте диспетчер трафика и две конечные точки: [Создание профиля диспетчера трафика с помощью портала Azure](https://docs.microsoft.com/azure/traffic-manager/quickstart-create-traffic-manager-profile).

Вот профиль диспетчера трафика:
* DNS-имя диспетчера трафика: `http://asc-bcdr.trafficmanager.net`
* Профили конечных точек: 

| Профиль | Тип | Назначение | Приоритет | Параметры пользовательского заголовка |
|--|--|--|--|--|
| Профиль конечной точки А | Внешняя конечная точка | service-sample-a.asc-test.net | 1 | host: bcdr-test.contoso.com |
| Профиль конечной точки B | Внешняя конечная точка | service-sample-b.asc-test.net | 2 | host: bcdr-test.contoso.com |

4. Создайте запись CNAME в зоне DNS: bcdr-test.contoso.com CNAME asc-bcdr.trafficmanager.net. 

5. Среда полностью настроена. Клиенты смогут получить доступ к приложению по адресу bcdr-test.contoso.com