---
title: Диагностика и устранение неполадок при отсоединении с помощью DP центра Интернета вещей Azure
description: Узнайте, как диагностировать и устранять распространенные ошибки, связанные с подключением устройств к службе DPS центра Интернета вещей Azure.
author: xujing-ms
manager: nberdy
ms.service: iot-dps
services: iot-dps
ms.topic: conceptual
ms.date: 09/09/2019
ms.author: xujing
ms.openlocfilehash: b596a09e2185b38e6161ea4af2aa109e80faf248
ms.sourcegitcommit: dd69b3cda2d722b7aecce5b9bd3eb9b7fbf9dc0a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/12/2019
ms.locfileid: "70963425"
---
# <a name="troubleshooting-with-azure-iot-hub-device-provisioning-service"></a>Устранение неполадок с помощью службы подготовки устройств для центра Интернета вещей Azure

Проблемы с подключением для устройств IoT могут быть трудно устранять, поскольку существует множество возможных сбоев, таких как сбои аттестации, ошибки регистрации и т. д. В этой статье содержатся рекомендации по обнаружению и устранению проблем с подключением устройств с помощью [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview).

## <a name="using-azure-monitor-to-view-metrics-and-set-up-alerts"></a>Использование Azure Monitor для просмотра метрик и настройки оповещений

В следующей процедуре описывается, как просмотреть и настроить оповещение для метрики службы подготовки устройств для центра Интернета вещей. 

1. Войдите на [портале Azure](https://portal.azure.com).

2. Перейдите к службе подготовки устройств для центра Интернета вещей.

3. Выберите **Метрики**.

4. Выберите нужную метрику. 
   <br />В настоящее время для DP существует три метрики:

    | Имя метрики | Описание |
    |-------|------------|
    | Попытки аттестации | Число устройств, которые пытались пройти проверку подлинности в службе подготовки устройств|
    | Попытки регистрации | Число устройств, которые пытались зарегистрироваться в центре Интернета вещей после успешной проверки подлинности|
    | Назначенное устройство | Число устройств, успешно назначенных в центр Интернета вещей|

5. Выберите нужный метод агрегирования, чтобы создать визуальное представление метрики. 

6. Чтобы настроить оповещение метрики, выберите **новые правила генерации оповещений** в правом верхнем углу колонки метрика, аналогично, в колонке **оповещение** и выборе **новых правил генерации оповещений**.

7. Выберите **Добавить условие**, затем выберите нужную метрику и пороговое значение, следуя инструкциям.

Дополнительные сведения см [. в разделе что такое классические оповещения в Microsoft Azure?](../azure-monitor/platform/alerts-overview.md)

## <a name="using-log-analytic-to-view-and-resolve-errors"></a>Использование аналитики журналов для просмотра и устранения ошибок

1. Войдите на [портале Azure](https://portal.azure.com).

2. Перейдите в центр Интернета вещей.

3. Выберите **Параметры диагностики**.

4. Выберите **Включить диагностику**.

5. Включите сбор нужных журналов.

    | Имя журнала | Описание |
    |-------|------------|
    | DeviceOperations | Журналы, связанные с событиями подключения устройства |
    | ServiceOperations | Журналы событий, связанные с использованием пакета SDK для службы (например, создание или обновление групп регистрации)|

6. Включите **Send to log Analytics** ([см. цены](https://azure.microsoft.com/pricing/details/log-analytics/)). 

7. Перейдите на вкладку **журналы** в портал Azure в разделе ресурс службы подготовки устройств.

8. Нажмите кнопку **выполнить** , чтобы просмотреть последние события.

9. При наличии результатов `OperationName`найдите, `ResultType`, `ResultSignature`и `ResultDescription` (сообщение об ошибке), чтобы получить более подробные сведения об ошибке.


## <a name="common-error-codes"></a>Коды распространенных ошибок
Сведения в этой таблице помогут вам понять и устранить распространенные ошибки.

| Код ошибки| Описание | Код состояния HTTP |
|-------|------------|------------|
| 400 | Недопустимый текст запроса; Например, он не может быть проанализирован или объект не может быть проверен.| 400 неправильный формат |
| 401 | Не удается проверить маркер авторизации; Например, срок действия истек или не применяется к URI запроса. Этот код ошибки также возвращается на устройства как часть потока аттестации доверенного платформенного модуля. | 401 — недостаточно прав|
| 404 | Экземпляр службы подготовки устройств или ресурс (например, регистрация) не существует. |404 Не найдено |
| 412 | ETag в запросе не совпадает с ETag существующего ресурса согласно RFC7232). | 412. предусловие не выполнено |
| 429 | Операции регулируется службой. Конкретные ограничения службы см. в разделе [ограничения службы подготовки устройств](https://docs.microsoft.com/azure/azure-subscription-service-limits#iot-hub-device-provisioning-service-limits)к добавлению в центр Интернета вещей. | 429. слишком много запросов |
| 500 | Произошла внутренняя ошибка. | 500 — Внутренняя ошибка сервера|
