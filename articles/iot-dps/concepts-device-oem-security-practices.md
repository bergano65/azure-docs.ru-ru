---
title: Рекомендации по безопасности для изготовителей — служба подготовки устройств Azure IoT
description: Обзор общих методов обеспечения безопасности для изготовителей оборудования и производителей устройств, которые подготавливают устройства для регистрации в службе подготовки устройств Интернета вещей Azure (DPS).
author: timlt
ms.author: timlt
ms.date: 3/02/2020
ms.topic: conceptual
ms.service: iot-dps
ms.custom: iot-p0-scenario, iot-devices-deviceOEM
ms.reviewer: nberdy
ms.openlocfilehash: 788738082cbf9995fb2f7282bc3f574903275528
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "90527213"
---
# <a name="security-practices-for-azure-iot-device-manufacturers"></a>Рекомендации по безопасности для изготовителей устройств Azure IoT
По мере того как другие производители выпускают устройства IoT, полезно найти рекомендации по распространенным методикам. В этой статье приводятся рекомендуемые рекомендации по обеспечению безопасности, которые следует учитывать при производстве устройств для использования со службой подготовки устройств Интернета вещей Azure (DPS).  

> [!div class="checklist"]
> * Выбор параметров проверки подлинности устройства
> * Установка сертификатов на устройствах IoT
> * Интеграция доверенный платформенный модуль (TPM) (TPM) в производственный процесс

## <a name="selecting-device-authentication-options"></a>Выбор параметров проверки подлинности устройства
Основная цель любой меры безопасности устройств IoT — создать безопасное решение IoT. Но такие проблемы, как ограничения на оборудование, стоимость и уровень опыта безопасности, влияют на выбор вариантов. Кроме того, ваш подход к безопасности влияет на то, как ваши устройства Интернета вещей подключаются к облаку. Хотя существует [несколько элементов безопасности IOT](https://www.microsoft.com/research/publication/seven-properties-highly-secure-devices/) , необходимо учитывать, какой тип проверки подлинности должен использовать каждый клиент. 

Три широко используемых типа проверки подлинности: сертификаты X. 509, доверенные платформенные модули (TPM) и симметричные ключи. Хотя другие типы проверки подлинности существуют, большинство клиентов, создающих решения в Azure IoT, используют один из этих трех типов. Оставшаяся часть этой статьи используется для опроса профессионалов и недостатков использования каждого типа проверки подлинности.

### <a name="x509-certificate"></a>Сертификат X.509
Сертификаты X. 509 — это тип цифрового удостоверения, который можно использовать для проверки подлинности. Стандарт сертификата X. 509 описан в [документе IETF RFC 5280](https://tools.ietf.org/html/rfc5280). В Azure IoT существует два способа проверки подлинности сертификатов.
- Отпечатк. Для создания шестнадцатеричной строки на сертификате выполняется алгоритм отпечатка. Созданная строка является уникальным идентификатором для сертификата. 
- Проверка подлинности ЦС на основе полной цепочки. Цепочка сертификатов — это иерархический список всех сертификатов, необходимых для проверки подлинности сертификата конечного субъекта (EE). Чтобы проверить подлинность сертификата EE, необходимо пройти проверку подлинности каждого сертификата в цепочке, включая доверенный корневой ЦС. 

Специалисты по X. 509:
- X. 509 — это наиболее безопасный тип проверки подлинности, поддерживаемый в Azure IoT.
- X. 509 обеспечивает высокий уровень контроля в целях управления сертификатами.
- Для предоставления решений проверки подлинности на основе X. 509 доступны многие поставщики.

Недостатки для X. 509:
- Многим клиентам может потребоваться полагаться на внешних поставщиках для их сертификатов.
- Управление сертификатами может быть дорогостоящим и добавлять к общим затратам на решение.
- Управление жизненным циклом сертификатов может быть затруднительным, если логистика плохо продумана. 

### <a name="trusted-platform-module-tpm"></a>Доверенный платформенный модуль (TPM)
TPM, также известный как [ISO/IEC 11889](https://www.iso.org/standard/66510.html), является стандартом для безопасного создания и хранения криптографических ключей. TPM также ссылается на виртуальное или физическое устройство ввода-вывода, взаимодействующее с модулями, которые реализуют стандарт. Устройство TPM может существовать как дискретное оборудование, интегрированное оборудование, модуль на основе микропрограммы или программный модуль. 

Между доверенными платформенными модулями и симметричными ключами существует два основных различия: 
- Микросхемы TPM также могут хранить сертификаты X. 509.
- Аттестация TPM в DPS использует ключ подтверждения доверенного платформенного модуля (EK), форму асимметричной проверки подлинности. При использовании асимметричной проверки подлинности для шифрования используется открытый ключ, а для расшифровки используется отдельный закрытый ключ. Симметричные ключи, напротив, используют симметричную проверку подлинности, где закрытый ключ используется как для шифрования, так и для расшифровки. 

Специалисты по TPM:
- Доверенные платформенные модули включены в качестве стандартного оборудования на многих устройствах Windows со встроенной поддержкой операционной системы. 
- Аттестация доверенного платформенного модуля проще в защите, чем аттестация симметричного ключа на основе маркеров подписанного URL-адреса (SAS).
- Вы можете легко истечь и продлить учетные данные устройства. Служба DPS автоматически откатывает учетные данные центра Интернета вещей всякий раз, когда для устройства TPM происходит повторная инициализация.

Недостатки TPM: 
- Доверенные платформенные модули являются сложными и могут быть трудными для использования. 
- Разработка приложений с помощью доверенных платформенных модулей является сложной, если у вас нет физического доверенного платформенного модуля или эмулятора качества.
- Возможно, придется переконструировать доску устройства, чтобы включить в оборудование доверенный платформенный модуль. 
- Если выполнить откат EK на доверенном платформенном модуле, он уничтожит удостоверение TPM и создаст новый. Хотя физическая микросхема остается неизменной, она имеет новое удостоверение в решении IoT.

### <a name="symmetric-key"></a>Симметричный ключ
При использовании симметричных ключей для шифрования и расшифровки сообщений используется один и тот же ключ. В результате один и тот же ключ известен как для устройства, так и для службы, которая проверяет подлинность. Центр Интернета вещей Azure поддерживает подключения к симметричным ключам на основе токенов SAS. Проверка подлинности с симметричным ключом требует значительной ответственности за защиту ключей и обеспечения одинакового уровня безопасности с проверкой подлинности X. 509. При использовании симметричных ключей рекомендуется защищать ключи с помощью аппаратного модуля безопасности (HSM).

Преимущества для симметричного ключа:
- Использование симметричных ключей — самый простой и экономичный способ начать работу с проверкой подлинности.
- Использование симметричных ключей упрощает процесс, так как он не требует дополнительных действий. 

Недостатки симметричного ключа: 
- Симметричные ключи имеют значительный уровень усилий для защиты ключей. Один и тот же ключ используется совместно между устройством и облаком. Это означает, что ключ должен быть защищен в двух местах. В отличие от этого, запрос с доверенным платформенным модулем и сертификатами X. 509 подтверждает владение открытым ключом, не раскрывая закрытый ключ.
- Симметричные ключи упрощают соблюдение практических рекомендаций по обеспечению безопасности. Обычная тенденция с симметричными ключами заключается в жесткой кодировании незашифрованных ключей на устройствах. Хотя такой подход удобен, ключи остаются уязвимыми. Вы можете уменьшить риск, безопасно сохранив симметричный ключ на устройстве. Однако, если приоритет является в конечном итоге безопасностью, а не удобство, используйте сертификаты X. 509 или TPM для проверки подлинности. 

### <a name="shared-symmetric-key"></a>Общий симметричный ключ
Существует разновидность проверки подлинности с симметричным ключом, известная как общий симметричный ключ. Этот подход предполагает использование одного и того же симметричного ключа на всех устройствах. Рекомендуется избегать использования на устройствах общих симметричных ключей. 

Pro для общего симметричного ключа:
- Простота для реализации и недорогого создания в масштабе. 

Недостатки для общего симметричного ключа: 
- Очень уязвимо для атак. Преимущество простой реализации значительно превосходит риск. 
- При получении общего ключа любой пользователь может олицетворять свои устройства.
- Если вы полагаетесь на общий симметричный ключ, который становится скомпрометированным, то, скорее всего, будет потеряно Управление устройствами. 

### <a name="making-the-right-choice-for-your-devices"></a>Правильный вариант выбора для устройств
Чтобы выбрать метод проверки подлинности, убедитесь, что вы учитываете преимущества и затраты каждого подхода к уникальному производственному процессу.  Для проверки подлинности устройства обычно существует обратная связь между тем, насколько безопасным является данный подход, и насколько это удобно.  

## <a name="installing-certificates-on-iot-devices"></a>Установка сертификатов на устройствах IoT
При использовании сертификатов X. 509 для проверки подлинности устройств IoT в этом разделе содержатся рекомендации по интеграции сертификатов в производственный процесс. Необходимо принять несколько решений.  К ним относятся решения общих переменных сертификатов, время создания сертификатов и время их установки. 

Если вы используете пароль, то можете спросить, почему вы не можете использовать один и тот же сертификат на всех устройствах, так же, как вы сможете использовать один и тот же пароль на всех устройствах. Во-первых, использование одного и того же пароля в любом случае опасно. В практическом занятии компании предоставляются значительные от атак DDoS атаки, включая ту, которая занимала DNS в Восточном регионе США несколько лет назад. Никогда не используйте один и тот же пароль везде, даже с личными учетными записями. Во-вторых, сертификат не является паролем, он является уникальным удостоверением. Пароль подобен секретному коду, который любой пользователь может использовать для открытия дверцы в защищенном здании.  Это то, что вам известно, и вы можете предоставить пароль всем, кто сможет получить вход.  Сертификат похож на лицензию на драйвер с вашей фотографией и другими сведениями, которые можно увидеть в качестве защиты, чтобы обеспечить безопасное создание. Он связан с вашим пользователем.  При условии, что условие точно соответствует людям с лицензиями драйвера, вы можете использовать только вашу лицензию (удостоверение), чтобы получить возможность входа. 

### <a name="variables-involved-in-certificate-decisions"></a>Переменные, участвующие в принятии решений о сертификатах
Рассмотрим следующие переменные и то, как каждая из них влияет на общий производственный процесс. 

#### <a name="where-the-certificate-root-of-trust-comes-from"></a>Откуда берется корень сертификата доверия
Управление инфраструктурой открытых ключей (PKI) может быть дорогостоящим и сложным.  Особенно если у вашей компании нет опыта управления PKI. Доступны следующие параметра:
- Использование PKI стороннего производителя. Сертификаты промежуточной подписи можно приобрести у стороннего поставщика сертификатов. Также можно использовать частный центр сертификации (ЦС). 
- Используйте самостоятельно управляемую PKI. Вы можете поддерживать собственную систему PKI и создавать собственные сертификаты.
- Используйте службу безопасности [Azure Sphere](https://azure.microsoft.com/services/azure-sphere/) . Этот параметр применяется только к Azure Sphereным устройствам. 

#### <a name="where-certificates-are-stored"></a>Где хранятся сертификаты
Существует несколько факторов, влияющих на решение о том, где хранятся сертификаты. К этим факторам относятся тип устройства, ожидаемые коэффициенты прибыли (независимо от того, можно ли предоставить защищенное хранилище), возможности устройства и существующую технологию безопасности на устройстве, которое вы можете использовать. Следуйте приведенным ниже рекомендациям.
- В аппаратном модуле безопасности (HSM). Настоятельно рекомендуется использовать HSM. Проверьте, установлен ли модуль HSM на плате управления устройства. Если вы уверены, что у вас нет АППАРАТного модуля безопасности, обратитесь к производителю оборудования, чтобы найти HSM, соответствующие вашим потребностям.
- В безопасном месте на диске, например в доверенной среде выполнения (TEE).
- В локальной файловой системе или хранилище сертификатов. Например, хранилище сертификатов Windows. 

#### <a name="connectivity-at-the-factory"></a>Подключение в фабрике
Подключение по фабрике определяет способ и время получения сертификатов для установки на устройствах. Возможны следующие варианты подключения.
- Установлен. Наличие подключения является оптимальным, что упрощает процесс создания сертификатов локально. 
- Нет подключения. В этом случае вы используете подписанный сертификат из центра сертификации для создания сертификатов устройств локально и вне сети. 
- Нет подключения. В этом случае можно получить сертификаты, созданные заранее. Или можно использовать автономную PKI для создания сертификатов локально.

#### <a name="audit-requirement"></a>Требование аудита
В зависимости от типа создаваемых устройств, вам могут быть предъявляются нормативные требования для создания журнала аудита, определяющего способ установки удостоверений устройств на устройствах. Аудит добавляет значительные затраты на рабочую среду. Поэтому в большинстве случаев это необходимо делать только при необходимости. Если вы не уверены, требуется ли аудит, проверяйте свой юридический отдел компании. Параметры аудита: 
- Не является важной отраслью. Аудит не требуется.
- Конфиденциальная отрасль. Сертификаты должны устанавливаться в защищенной комнате в соответствии с требованиями сертификации. Если для установки сертификатов требуется безопасное место, скорее всего, вы уже знаете, как установить сертификаты на устройствах. И, возможно, у вас уже есть система аудита. 

#### <a name="length-of-certificate-validity"></a>Длительность срока действия сертификата
Как и лицензия драйвера, сертификаты имеют дату окончания срока действия, которая задается при их создании. Ниже приведены варианты срока действия сертификата.
- Обновление не требуется.  Этот подход использует длительный период продления, поэтому вам никогда не потребуется обновлять сертификат во время его существования. Хотя такой подход удобен, он также рискованен.  Вы можете снизить риск, используя защищенное хранилище, например HSM на устройствах. Однако рекомендуется избегать использования долгосрочных сертификатов.
- Требуется обновление.  Необходимо продлить сертификат в течение времени существования устройства. Срок действия сертификата зависит от контекста, и вам потребуется стратегия продления.  Стратегия должна содержать сведения о том, где вы получаете сертификаты, а также о типе функций, которые ваши устройства должны использовать в процессе продления. 

### <a name="when-to-generate-certificates"></a>Время создания сертификатов
Возможности подключения к Интернету в вашей фабрике повлияют на процесс создания сертификатов. Существует несколько способов создания сертификатов. 

- Предварительно загруженные сертификаты.  Некоторые поставщики HSM предлагают службу Premium, в которой поставщик HSM устанавливает сертификаты для клиента. Во-первых, клиенты предоставляют поставщику HSM доступ к сертификату подписи. Затем поставщик HSM устанавливает сертификаты, подписанные этим сертификатом подписи, на каждый HSM, покупается клиентом. Все, что нужно сделать, — это установить HSM на устройстве. Хотя эта служба добавляет затраты, она помогает оптимизировать производственный процесс.  И разрешает вопрос о том, когда устанавливать сертификаты.
- Сертификаты, созданные на устройстве.  Если устройства создают сертификаты внутренне, необходимо извлечь общедоступный сертификат X. 509 с устройства, чтобы зарегистрировать его в DPS. 
- Подключенная фабрика.  Если фабрика имеет подключение, сертификаты устройств можно создавать каждый раз, когда они вам нужны.
- Автономная фабрика с собственной PKI. Если у фабрики нет подключения и вы используете собственную PKI с поддержкой автономного режима, вы можете создавать сертификаты по мере необходимости.
- Автономная фабрика со сторонним PKI. Если у фабрики нет подключения и вы используете PKI стороннего производителя, необходимо заранее создать сертификаты. И потребуется создать сертификаты из расположения с подключением. 

### <a name="when-to-install-certificates"></a>Время установки сертификатов
После создания сертификатов для устройств IoT можно установить их на устройствах. 

Если вы используете предварительно загруженные сертификаты с АППАРАТным модулем безопасности, процесс упрощен. После установки HSM на устройстве код устройства может получить к нему доступ. Затем вы вызываете интерфейсы HSM API для доступа к сертификату, который хранится в HSM. Этот подход наиболее удобен для производственного процесса. 

Если вы не используете предварительно загруженный сертификат, необходимо установить сертификат в рамках рабочего процесса. Самый простой подход заключается в установке сертификата в HSM в то же время, когда вы затронет первоначальный образ встроенного по. Процесс должен добавить шаг для установки образа на каждом устройстве. После выполнения этого шага можно выполнить окончательные проверки качества и другие шаги, прежде чем приступать к упаковке и поставке устройства. 

Доступны программные средства, которые позволяют запускать процесс установки и окончательную проверку качества за один шаг. Эти средства можно изменить, чтобы создать сертификат или извлечь сертификат из предварительно созданного хранилища сертификатов. Затем программное обеспечение может установить сертификат, в котором необходимо установить его. Программные средства этого типа позволяют выполнять рабочее качество производства в масштабе. 

После установки сертификатов на устройствах следует узнать, как зарегистрировать устройства с помощью [DPS](about-iot-dps.md). 

## <a name="integrating-a-tpm-into-the-manufacturing-process"></a>Интеграция TPM в производственный процесс
Если вы используете доверенный платформенный модуль для проверки подлинности устройств IoT, в этом разделе содержатся рекомендации. В руководстве рассматриваются широко используемые устройства TPM 2,0 с поддержкой ключей кода проверки подлинности сообщений на основе хэша. Спецификация TPM для микросхемы TPM является стандартом ISO, который поддерживается организация TCG. Дополнительные сведения о TPM см. в спецификации [tpm 2,0](https://trustedcomputinggroup.org/tpm-library-specification/) и [ISO/IEC 11889](https://www.iso.org/standard/66510.html). 

### <a name="taking-ownership-of-the-tpm"></a>Смена владельца TPM
Важный шаг в производстве устройства с микросхемой TPM — стать владельцем TPM. Этот шаг является обязательным, чтобы можно было предоставить ключ владельцу устройства. Первым шагом является извлечение ключа подтверждения (EK) с устройства. Следующим шагом является фактическое утверждение владения. Это зависит от того, какой TPM и какую операционную систему вы используете. При необходимости обратитесь к изготовителю доверенного платформенного модуля или к разработчику операционной системы устройства, чтобы определить, как запрашивать владение. 

В процессе производства можно извлечь EK и владение утверждением в разное время, что повышает гибкость. Многие производители используют преимущества такой гибкости, добавляя аппаратный модуль безопасности (HSM) для повышения безопасности устройств. В этом разделе приводятся рекомендации по извлечению EK, утверждению владельца доверенного платформенного модуля, а также рекомендации по интеграции этих шагов в производственную шкалу. 

> [!IMPORTANT]
> В следующих руководствах предполагается использование дискретного встроенного по или встроенного доверенного платформенного модуля. В местах, где это применимо, руководство добавляет примечания об использовании недискретного или программного TPM. Если вы используете программный доверенный платформенный модуль, могут быть выполнены дополнительные действия, которые не включены в это руководство. Программные модули имеют множество реализаций, которые выходят за рамки этой статьи.  Как правило, можно интегрировать программный модуль TPM в следующую общую временную шкалу производства. Однако, в то время как программно имитируемый доверенный платформенный модуль подходит для создания прототипов и тестирования, он не может обеспечить тот же уровень безопасности, что и отдельное встроенное программное обеспечение или встроенный доверенный платформенный модуль. Как правило, рекомендуется избегать использования программного TPM в рабочей среде.

### <a name="general-manufacturing-timeline"></a>Общая временная шкала производства
На следующей временной шкале показано, как доверенный платформенный модуль проходит по рабочему процессу и завершается на устройстве. Каждый производственный процесс является уникальным, и на этой временной шкале показаны наиболее распространенные шаблоны. На временной шкале есть рекомендации по выполнению определенных действий с ключами. 

#### <a name="step-1-tpm-is-manufactured"></a>Шаг 1. производство TPM
- Если вы приобретаете для своих устройств доверенные платформенные модули, см. сведения в статье, посвященной извлечению общедоступных ключей подтверждения (EK_pubs). Это полезно, если изготовитель предоставляет список EK_pubs с поставляемыми устройствами. 
    > [!NOTE]
    > Вы можете предоставить изготовителю доверенного платформенного модуля доступ на запись к списку регистрации, используя политики общего доступа в службе подготовки.  Такой подход позволяет им добавлять доверенные платформенные модули в список регистрации.  Но это рано в процессе производства, и ему требуется доверие у производителя доверенного платформенного модуля. Сделайте это на свой собственный риск. 

- Если вы создаете доверенные платформенные модули для продаж производителям устройств, рассмотрите возможность предоставления клиентам списка EK_pubs вместе с их физическими доверенными платформенными модулями.  Предоставление клиентам EK_pubs сохраняет шаг в своем процессе. 
- Если вы создаете доверенные платформенные модули для использования с собственными устройствами, выясните, какая точка в процессе является наиболее удобной для извлечения EK_pub. EK_pub можно извлечь в любой из оставшихся точек временной шкалы. 

#### <a name="step-2-tpm-is-installed-into-a-device"></a>Шаг 2. доверенный платформенный модуль установлен на устройстве
На этом этапе производственного процесса следует выяснить, какой экземпляр DPS будет использоваться устройством. В результате вы можете добавить устройства в список регистрации для автоматической подготовки. Дополнительные сведения об автоматической подготовке устройств см. в [документации по службе DPS](about-iot-dps.md).
- Если вы еще не извлекли EK_pub, то теперь пора это сделать. 
- В зависимости от процесса установки доверенного платформенного модуля этот шаг также является хорошим временем, чтобы стать владельцем TPM. 

#### <a name="step-3-device-has-firmware-and-software-installed"></a>Шаг 3. на устройстве установлено встроенное по и программное обеспечение
На этом этапе процесса установите клиент DPS вместе с областью идентификатора и глобальным URL-адресом для подготовки.
- Теперь это последняя возможность извлечения EK_pub. Если программное обеспечение будет установлено на устройстве сторонним лицом, рекомендуется сначала извлечь EK_pub.
- Этот момент в производственном процессе идеально подходит для того, чтобы стать владельцем TPM.  
    > [!NOTE]
    > Если вы используете программный доверенный платформенный модуль, его можно установить сейчас.  Извлеките EK_pub в то же время.

#### <a name="step-4-device-is-packaged-and-sent-to-the-warehouse"></a>Шаг 4. Упаковка и отправка устройства в хранилище
Перед развертыванием устройство может находиться в хранилище за 6-12 месяцев. 

#### <a name="step-5-device-is-installed-into-the-location"></a>Шаг 5. устройство установлено в расположение
После того как устройство поступит в свое окончательное расположение, оно проходит через автоматическую подготовку с помощью DPS.

Дополнительные сведения см. в разделе [Подготовка](about-iot-dps.md#provisioning-process) и [аттестация доверенного платформенного модуля](concepts-tpm-attestation.md). 

## <a name="resources"></a>Ресурсы

В дополнение к рекомендуемым рекомендациям по безопасности в этой статье Azure IoT предоставляет ресурсы, помогающие выбрать безопасное оборудование и создать безопасные развертывания IoT: 
- Рекомендации по [безопасности](../iot-fundamentals/security-recommendations.md) Интернета вещей Azure для выполнения процесса развертывания. 
- [Центр безопасности Azure](https://azure.microsoft.com/services/security-center/) предлагает службу, помогающую создавать безопасные развертывания Интернета вещей. 
- Справку по оценке аппаратной среды см. в техническом документе, посвященном [оценке безопасности Интернета вещей](https://download.microsoft.com/download/D/3/9/D3948E3C-D5DC-474E-B22F-81BA8ED7A446/Evaluating_Your_IOT_Security_whitepaper_EN_US.pdf). 
- Сведения о выборе безопасного оборудования см. [в разделе безопасное оборудование для развертывания IOT](https://download.microsoft.com/download/C/0/5/C05276D6-E602-4BB1-98A4-C29C88E57566/The_right_secure_hardware_for_your_IoT_deployment_EN_US.pdf). 