---
title: Устранение проблем с производительностью реестра
description: Симптомы, причины и способы устранения распространенных проблем с производительностью реестра
ms.topic: article
ms.date: 08/11/2020
ms.openlocfilehash: 15129ebe1da2e52fac106a34863f609c440549ad
ms.sourcegitcommit: dbe434f45f9d0f9d298076bf8c08672ceca416c6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2020
ms.locfileid: "92148415"
---
# <a name="troubleshoot-registry-performance"></a>Устранение проблем с производительностью реестра

Эта статья поможет вам устранить проблемы, которые могут возникнуть при работе с реестром контейнеров Azure. 

## <a name="symptoms"></a>Симптомы

Может включать один или несколько из следующих элементов:

* Образы по запросу или Push-уведомления с помощью DOCKER CLI занимают больше времени, чем ожидалось
* Развертывание образов в службе, например Azure Kubernetes Service, занимает больше времени, чем ожидалось
* Вы не можете выполнить большое количество одновременных операций извлечения или принудительной отправки в ожидаемое время
* Операции Pull или Push в геореплицированном реестре занимают больше времени, чем ожидалось, или принудительно завершается с ошибкой `Error writing blob` или `Error writing manifest`

## <a name="causes"></a>Причины

* Скорость сетевого подключения может замедлять работу реестра — [решение](#check-expected-network-speed)
* При использовании клиентского [решения](#check-client-hardware) сжатие или извлечение слоя изображения может выполняться слишком долго  
* Вы достигли заданного предела на уровне службы реестра или [решения](#review-configured-limits) "среда"
* В геореплицированном реестре есть реплики в ближайших регионах — [решение](#configure-geo-replicated-registry)
* Вы извлекаете из географически нераспределенной реплики реестра — [решение](#configure-dns-for-geo-replicated-registry)

Если вы не решите проблему здесь, ознакомьтесь со статьей [Расширенный поиск и устранение неполадок](#advanced-troubleshooting) и [дальнейшие действия](#next-steps) для других вариантов.

## <a name="potential-solutions"></a>Возможные решения

### <a name="check-expected-network-speed"></a>Проверьте ожидаемую скорость сети

Проверьте скорость передачи и загрузки через Интернет или используйте такое средство, как Азуреспид, для тестирования [отправки](https://www.azurespeed.com/Azure/Uploadß) и [скачивания](https://www.azurespeed.com/Azure/Download) из хранилища BLOB-объектов Azure, в котором размещаются слои образа реестра.

Проверьте размер образа в соответствии с максимальным поддерживаемым размером и поддерживаемой пропускной способностью загрузки или загрузки для уровня службы реестра. Если реестр находится на уровне Basic или Standard, рассмотрите возможность обновления для повышения производительности. 

Для развертывания образа в других службах проверьте регионы, в которых находятся реестр и целевой объект. Чтобы повысить производительность, рассмотрите возможность поиска реестра и целевого объекта развертывания в одних и тех же или закрытых областях сети.

Связанные ссылки

* [Уровни службы Реестра контейнеров Azure](container-registry-skus.md)    
* [Реестр контейнеров: вопросы и ответы](container-registry-faq.md)
* [Целевые показатели производительности и масштабируемости для хранилища BLOB-объектов Azure](../storage/blobs/scalability-targets.md)

### <a name="check-client-hardware"></a>Проверка клиентского оборудования

Тип диска и ЦП в клиенте DOCKER могут влиять на скорость извлечения или сжатия слоев изображений на клиенте в рамках операций извлечения или принудительной отправки. Например, извлечение слоя на жестком диске займет больше времени, чем на диске с твердотельным состоянием. Сравните операции извлечения для сопоставимых образов из реестра контейнеров Azure и общедоступного реестра, например DOCKER Hub.

### <a name="review-configured-limits"></a>Проверка настроенных ограничений

Если вы одновременно отправляете или запрашиваете несколько многослойных изображений в реестре, ознакомьтесь с поддерживаемыми ограничениями операции чтения и Вритеопс для уровня службы реестра. Если реестр находится на уровне Basic или Standard, попробуйте обновить его, чтобы увеличить ограничения. Также обратитесь к поставщику сетевых услуг, посвященному регулированию сети, которое может возникать во многих параллельных операциях. 

Проверьте конфигурацию управляющей программы DOCKER на максимально одновременную передачу или загрузку для каждой операции отправки или извлечения на клиенте. При необходимости настройте более высокие ограничения.

Поскольку для каждого уровня изображения требуется отдельная операция чтения или записи в реестре, проверьте количество слоев в изображениях. Рассмотрите стратегии для уменьшения количества слоев изображений.

Связанные ссылки

* [Уровни службы Реестра контейнеров Azure](container-registry-skus.md)
* [dockerd](https://docs.docker.com/engine/reference/commandline/dockerd/)

### <a name="configure-geo-replicated-registry"></a>Настройка геореплицированного реестра

Клиент DOCKER, который передает образ в геореплицированный реестр, может не отправлять все слои изображения и его манифест в один реплицированный регион. Эта ситуация может возникать из-за того, что диспетчер трафика Azure направляет запросы реестра в ближайший к сети реплицированный реестр. Если вблизи реестра находятся два региона репликации, то слои образа и манифест могут быть распределены между ними, а операция отправки завершится ошибкой при проверке манифеста.

Чтобы для разрешения DNS-имен при передаче образов использовалась ближайшая реплика, настройте геореплицированный реестр в том же регионе Azure, где находится источник операций отправки, или в ближайшем регионе при работе вне Azure.

Для устранения неполадок с географически реплицируемыми реестрами можно также временно отключить маршрутизацию диспетчера трафика к одной или нескольким репликациям.

Связанные ссылки

* [Подготовка геореплицированного реестра контейнеров Azure](container-registry-geo-replication.md)

### <a name="configure-dns-for-geo-replicated-registry"></a>Настройка DNS для геореплицированного реестра

Если операции извлечения из геореплицированного реестра выполняются слишком долго, конфигурация DNS клиента может разрешаться в географически удаленный DNS-сервер. В этом случае диспетчер трафика может выполнять маршрутизацию запросов к реплике, расположенной близко к DNS-серверу, но удаленному от клиента. Запустите средство `nslookup` , например или `dig` (в Linux), чтобы определить реплику, к которой диспетчер трафика направляет запросы к реестру. Пример:

```console
nslookup myregistry.azurecr.io
```

Потенциальным решением является настройка более близкого DNS-сервера.

Связанные ссылки

* [Подготовка геореплицированного реестра контейнеров Azure](container-registry-geo-replication.md)
* [Устранение неполадок с операциями отправки с использованием геореплицированных реестров](container-registry-geo-replication.md#troubleshoot-push-operations-with-geo-replicated-registries)
* [Временное отключение маршрутизации к репликации](container-registry-geo-replication.md#temporarily-disable-routing-to-replication)
* [Вопросы и ответы по диспетчеру трафика](../traffic-manager/traffic-manager-faqs.md)

### <a name="advanced-troubleshooting"></a>Расширенный поиск проблем

Если разрешения для ресурсов реестра разрешены, [Проверьте работоспособность среды реестра](container-registry-check-health.md). Если выводятся сообщения об ошибках, ознакомьтесь со статьей [ссылка на ошибку](container-registry-health-error-reference.md) для потенциальных решений.

Если в реестре включен [Сбор журналов ресурсов](container-registry-diagnostics-audit-logs.md) , проверьте журнал контаинтеррегистрирепоситоревентс. В этом журнале хранятся сведения для таких операций, как push-уведомления или события извлечения. Запросите журнал о [сбоях операций на уровне репозитория](container-registry-diagnostics-audit-logs.md#repository-level-operation-failures). 

Связанные ссылки

* [Журналы для диагностической оценки и аудита](container-registry-diagnostics-audit-logs.md)
* [Реестр контейнеров: вопросы и ответы](container-registry-faq.md)
* [Рекомендации по использованию реестра контейнеров Azure](container-registry-best-practices.md)

## <a name="next-steps"></a>Дальнейшие действия

Если вы не решите проблему здесь, см. следующие параметры.

* Другие разделы по устранению неполадок в реестре:
  * [Устранение неполадок при входе в реестр](container-registry-troubleshoot-login.md)
  * [Устранение проблем с сетью с помощью реестра](container-registry-troubleshoot-access.md)
* Варианты [поддержки сообщества](https://azure.microsoft.com/support/community/)
* [Майкрософт: вопросы и ответы](/answers/products/)
* [Открытие запроса в службу поддержки](https://azure.microsoft.com/support/create-ticket/)