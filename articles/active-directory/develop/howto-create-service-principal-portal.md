---
title: Создание удостоверения для приложения Azure на портале | Документация Майкрософт
description: Описывается создание нового приложения Azure Active Directory и субъекта-службы, которые можно использовать в сочетании с контролем доступа на основе ролей в Azure Resource Manager для управления доступом к ресурсам.
services: active-directory
documentationcenter: na
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/17/2019
ms.author: ryanwi
ms.reviewer: tomfitz
ms.custom: aaddev, seoapril2019
ms.collection: M365-identity-device-management
ms.openlocfilehash: 825966fbb0db537aad8de39e69e17418e6432b44
ms.sourcegitcommit: 4b431e86e47b6feb8ac6b61487f910c17a55d121
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/18/2019
ms.locfileid: "68324681"
---
# <a name="how-to-use-the-portal-to-create-an-azure-ad-application-and-service-principal-that-can-access-resources"></a>Практическое руководство. Создание приложения Azure Active Directory и субъекта-службы с доступом к ресурсам с помощью портала

В этой статье показано, как создать новое приложение Azure Active Directory (Azure AD) и субъект-службу, которые можно использовать с контролем доступа на основе ролей. При наличии кода, для которого требуется доступ к ресурсам или их изменение, можно создать идентификатор для приложения. Этот идентификатор известен как субъект-служба. Затем субъекту-службе можно назначить необходимые разрешения. В этой статье показано, как создать субъект-службу с помощью портала. Здесь рассматривается однотенантное приложение — решение, используемое в пределах одной организации. Обычно однотенантная архитектура используется для создания бизнес-приложений в рамках организации.

> [!IMPORTANT]
> Вместо создания субъекта-службы вы можете применить управляемые удостоверения ресурсов Azure в качестве удостоверения приложения. Если ваш код выполняется в службе, которая поддерживает управляемые удостоверения и обращается к ресурсам, поддерживающим проверку подлинности Azure AD, управляемые удостоверения являются лучшим вариантом. Дополнительные сведения об управляемых удостоверениях для ресурсов Azure, включая службы, которые в настоящее время поддерживают их, см. в разделе [Что такое управляемые удостоверения для ресурсов Azure?](../managed-identities-azure-resources/overview.md)

## <a name="create-an-azure-active-directory-application"></a>Создание приложения Azure Active Directory

Перейдем к созданию удостоверения. Если у вас возникли сложности, проверьте [необходимые разрешения](#required-permissions), чтобы убедиться в том, что в учетной записи можно создать удостоверение.

1. Войдите в учетную запись Azure через [портал Azure](https://portal.azure.com).
1. Выберите **Azure Active Directory**.
1. Щелкните **Регистрация приложений**.
1. Выберите **Новая регистрация**.
1. Назовите приложение. Выберите поддерживаемый тип учетной записи, который определяет, кто может использовать приложение. В разделе **URI перенаправления**выберите вариант **Интернет** для типа приложения, которое требуется создать. Введите URI, на который отправляется маркер доступа. Вы не можете создать учетные данные для [собственного приложения](../manage-apps/application-proxy-configure-native-client-application.md). Этот тип нельзя использовать для автоматизированного приложения. Выбрав нужные значения, нажмите кнопку **Зарегистрировать**.

   ![Введите имя приложения](./media/howto-create-service-principal-portal/create-app.png)

Вы создали приложение Azure AD и субъект-службу.

## <a name="assign-the-application-to-a-role"></a>Назначение приложению роли

Чтобы обеспечить доступ к ресурсам в подписке, необходимо назначить приложению роль. Укажите, какая роль предоставляет приложению необходимые разрешения. Дополнительные сведения о доступных ролях см. в статье [RBAC: встроенные роли](../../role-based-access-control/built-in-roles.md).

Вы можете задать область действия на уровне подписки, группы ресурсов или ресурса. Разрешения наследуют более низкие уровни области действия. Например, добавление приложения в роль читателя для группы ресурсов означает, что оно может считывать группу ресурсов и все содержащиеся в ней ресурсы.

1. Перейдите на уровень области действия, которому вы хотите назначить приложение. Например, чтобы назначить роль в области действия подписки, выберите **Все службы** и **Подписки**.

   ![Например, назначьте роль в области действия подписки.](./media/howto-create-service-principal-portal/select-subscription.png)

1. Выберите определенную подписку, для которой хотите назначить приложение.

   ![Выбор подписки для назначения](./media/howto-create-service-principal-portal/select-one-subscription.png)

   Если требуемая подписка не отображается, выберите **фильтр глобальных подписок**. Убедитесь, что для портала была выбрана необходимая подписка.

1. Выберите **Управление доступом (IAM)** .
1. Выберите **Добавить назначение ролей**.
1. Выберите роль, которая будет назначена приложению. Чтобы позволить приложению выполнять такие действия, как **перезагрузка**, **запуск** и **остановка** экземпляров, выберите роль **Участник**. По умолчанию приложения Azure Active Directory не отображаются среди доступных вариантов. Чтобы найти приложение, выполните поиск по его имени и выберите его.

   ![Выберите роль для назначения приложению](./media/howto-create-service-principal-portal/select-role.png)

1. Выберите **Сохранить**, чтобы завершить назначение роли. Вы увидите свое приложение в списке пользователей, назначенных выбранной роли для выбранной области действия.

Субъект-служба настроен. Вы можете начать использовать его, чтобы выполнять скрипты или приложения. В следующем разделе показано, как получить значения, необходимые для использования при входе с помощью программного способа.

## <a name="get-values-for-signing-in"></a>Получение значений для входа

Когда выполняется программный вход, необходимо передать идентификатор клиента в запросе на проверку подлинности. Вам также понадобится идентификатор приложения и ключ проверки подлинности. Получить эти значения можно следующим образом.

1. Выберите **Azure Active Directory**.
1. В Azure Active Directory в разделе **Регистрация приложений** выберите нужное приложение.
1. Скопируйте идентификатор каталога (клиента) и сохраните его в коде приложения.

    ![Скопируйте каталог (идентификатор клиента) и сохраните его в коде приложения.](./media/howto-create-service-principal-portal/copy-tenant-id.png)

1. Скопируйте **идентификатор приложения** и сохраните его в коде приложения.

   ![Копирование идентификатора приложения (клиента)](./media/howto-create-service-principal-portal/copy-app-id.png)

## <a name="certificates-and-secrets"></a>Сертификаты и секреты
Управляющие приложения могут использовать два вида учетных данных для аутентификации в Azure AD: сертификаты и секреты приложений.  Рекомендуется использовать сертификат, но можно также создать новый секрет приложения.

### <a name="upload-a-certificate"></a>Загрузить сертификат

Вы можете использовать существующий сертификат, если он есть.  При необходимости можно создать самозаверяющий сертификат для целей тестирования. Откройте PowerShell и выполните команду [New-SelfSignedCertificate](/powershell/module/pkiclient/new-selfsignedcertificate) со следующими параметрами, чтобы создать самозаверяющий сертификат в хранилище сертификатов пользователя на компьютере: `$cert=New-SelfSignedCertificate -Subject "CN=DaemonConsoleCert" -CertStoreLocation "Cert:\CurrentUser\My"  -KeyExportPolicy Exportable -KeySpec Signature`.  Экспортируйте этот сертификат с помощью оснастки MMC " [Управление сертификатом пользователя](/dotnet/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in) ", доступной на панели управления Windows.

Чтобы отправить сертификат, выполните следующие действия.

1. Выберите **сертификаты & секреты**.
1. Выберите **отправить сертификат** и выберите сертификат (существующий сертификат или самозаверяющий сертификат, который вы экспортировали).

    ![Выберите отправить сертификат и выберите тот, который вы хотите добавить.](./media/howto-create-service-principal-portal/upload-cert.png)

1. Выберите **Добавить**.

После регистрации сертификата в приложении на портале регистрации приложений необходимо включить код клиентского приложения для использования сертификата.

### <a name="create-a-new-application-secret"></a>Создать новый секрет приложения

Если вы решили не использовать сертификат, можно создать новый секрет приложения.

1. Выберите **сертификаты & секреты**.
1. Выберите **секреты клиента — > новый секрет клиента**.
1. Введите описание секрета и длительность. Когда все будет готово, нажмите **Добавить**.

   После сохранения секрета клиента отображается значение секрета клиента. Это значение невозможно будет получить позже, поэтому скопируйте его сразу. Значение ключа необходимо предоставить вместе с идентификатором приложения для входа от имени приложения. Сохраните значение ключа, чтобы приложение могло получить к нему доступ.

   ![Скопируйте значение секрета, так как его невозможно получить позже](./media/howto-create-service-principal-portal/copy-secret.png)

## <a name="required-permissions"></a>Необходимые разрешения

У вас должны быть права на регистрацию приложения в клиенте Azure AD и назначение приложению роли в подписке Azure.

### <a name="check-azure-ad-permissions"></a>Проверка разрешений Azure AD

1. Выберите **Azure Active Directory**.
1. Запишите роль. Если вам назначена роль **Пользователь**, необходимо убедиться, что пользователи, не являющиеся администраторами, могут регистрировать приложения.

   ![Найдите свою роль. Если вы являетесь пользователем, убедитесь, что пользователи, не являющиеся администраторами, могут регистрировать приложения.](./media/howto-create-service-principal-portal/view-user-info.png)

1. Выберите **Параметры пользователя**.
1. Проверьте параметр **Регистрация приложений**. Это значение может быть задано только администратором. Если установлено значение **Да**, приложение в клиенте Azure AD может зарегистрировать любой пользователь.

Если для параметра регистрации приложений установлено значение **Нет**, регистрировать приложения такого типа могут только пользователи с ролью администратора. Дополнительные сведения о доступных ролях администратора и конкретных разрешениях в Azure AD, которые предоставляются каждой роли, см. в разделах [Доступные роли](../users-groups-roles/directory-assign-admin-roles.md#available-roles) и [Разрешения ролей](../users-groups-roles/directory-assign-admin-roles.md#role-permissions). Если вашей учетной записи назначена роль пользователя, а параметр регистрации приложений разрешает регистрацию только администраторам, обратитесь к администратору с просьбой назначить вам одну из ролей администратора, которая будет создавать регистрацию приложений и управлять всеми ее аспектами, или предоставить пользователям возможность регистрировать приложения.

### <a name="check-azure-subscription-permissions"></a>Проверка прав доступа к подпискам Azure

Чтобы вы могли назначить роль приложению Active Directory, вашей учетной записи в подписке Azure должно быть предоставлено разрешение `Microsoft.Authorization/*/Write`. Это разрешение предоставляется ролью [владельца](../../role-based-access-control/built-in-roles.md#owner) или [администратора доступа пользователей](../../role-based-access-control/built-in-roles.md#user-access-administrator). Если вашей учетной записи назначена роль **Участник**, то у вас нет соответствующего разрешения. При попытке назначить роль субъекту-службе вы увидите ошибку.

Чтобы проверить права доступа к подписке, выполните следующие действия.

1. Выберите свою учетную запись в правом верхнем углу и выберите **...-> мои разрешения**.

   ![Выбор учетной записи и разрешений пользователя](./media/howto-create-service-principal-portal/select-my-permissions.png)

1. В раскрывающемся списке выберите подписку, в которой необходимо создать субъект-службу. Затем выберите ссылку **Щелкните здесь, чтобы просмотреть полные сведения о доступе для этой подписки**.

   ![Выберите подписку, в которой нужно создать субъект-службу.](./media/howto-create-service-principal-portal/view-details.png)

1. Выберите **назначения ролей** , чтобы просмотреть назначенные роли, и определите, есть ли у вас соответствующие разрешения для назначения роли приложению AD. Если разрешения нет, обратитесь к администратору подписки с просьбой назначить вам роль администратора доступа пользователей. На следующем рисунке представлен пользователь, которому назначена роль владельца. Это значит, что у такого пользователя есть необходимые разрешения.

   ![В этом примере показано, что пользователь назначен роли владельца.](./media/howto-create-service-principal-portal/view-user-role.png)

## <a name="next-steps"></a>Следующие шаги

* Сведения о настройке мультитенантного приложения см. в статье [Управление ресурсами клиента с помощью Azure Active Directory и Resource Manager](../../azure-resource-manager/resource-manager-api-authentication.md).
* Дополнительные сведения о настройке политик безопасности см. в статье о [контроле доступа на основе ролей Azure](../../role-based-access-control/role-assignments-portal.md).  
* Список доступных действий, которые можно разрешить или запретить пользователям, см. в разделе [Операции поставщиков ресурсов Azure Resource Manager](../../role-based-access-control/resource-provider-operations.md).
