---
title: Создание приложения Azure AD & субъекта-службы на портале
titleSuffix: Microsoft identity platform
description: Создайте новый Azure Active Directory приложение & субъекта-службы для управления доступом к ресурсам с помощью управления доступом на основе ролей в Azure Resource Manager.
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: how-to
ms.date: 06/26/2020
ms.author: ryanwi
ms.reviewer: tomfitz
ms.custom: aaddev, seoapril2019, identityplatformtop40
ms.openlocfilehash: 8a4a4153261b93b3b17641e8561962c274570bd0
ms.sourcegitcommit: 126ee1e8e8f2cb5dc35465b23d23a4e3f747949c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "100104218"
---
# <a name="how-to-use-the-portal-to-create-an-azure-ad-application-and-service-principal-that-can-access-resources"></a>Практическое руководство. Создание приложения Azure Active Directory и субъекта-службы с доступом к ресурсам с помощью портала

В этой статье показано, как создать новое приложение Azure Active Directory (Azure AD) и субъект-службу, которые можно использовать с контролем доступа на основе ролей. При наличии приложений, размещенных служб или автоматизированных средств, которым требуется доступ к ресурсам или их изменение, можно создать удостоверение для приложения. Этот идентификатор известен как субъект-служба. Доступ к ресурсам ограничен ролями, назначенными субъекту-службе, что позволяет контролировать доступ к ресурсам и на каком уровне. По соображениям безопасности мы рекомендуем всегда использовать субъекты-службы с автоматизированными средствами, чтобы не допускать их входа с помощью удостоверения пользователя.

В этой статье показано, как создать субъект-службу в портал Azure с помощью портала. Здесь рассматривается однотенантное приложение — решение, используемое в пределах одной организации. Обычно однотенантная архитектура используется для создания бизнес-приложений в рамках организации.  [Для создания субъекта-службы также можно использовать Azure PowerShell](howto-authenticate-service-principal-powershell.md).

> [!IMPORTANT]
> Вместо создания субъекта-службы вы можете применить управляемые удостоверения ресурсов Azure в качестве удостоверения приложения. Если ваш код выполняется в службе, которая поддерживает управляемые удостоверения и обращается к ресурсам, поддерживающим проверку подлинности Azure AD, управляемые удостоверения являются лучшим вариантом. Дополнительные сведения об управляемых удостоверениях для ресурсов Azure, включая службы, которые в настоящее время поддерживают их, см. в разделе [Что такое управляемые удостоверения для ресурсов Azure?](../managed-identities-azure-resources/overview.md)

## <a name="app-registration-app-objects-and-service-principals"></a>Регистрация приложений, объекты приложений и субъекты-службы
Невозможно напрямую создать субъект-службу с помощью портал Azure.  При регистрации приложения с помощью портал Azure объект приложения и субъект-служба автоматически создаются в домашнем каталоге или клиенте.  Дополнительные сведения о взаимосвязи между регистрацией приложений, объектами приложений и субъектами-службами см. [в Azure Active Directory](app-objects-and-service-principals.md).

## <a name="permissions-required-for-registering-an-app"></a>Разрешения, необходимые для регистрации приложения

Необходимо иметь достаточные разрешения для регистрации приложения в клиенте Azure AD и назначения приложению роли в подписке Azure.

### <a name="check-azure-ad-permissions"></a>Проверка разрешений Azure AD

1. Выберите **Azure Active Directory**.
1. Запишите роль. Если вам назначена роль **Пользователь**, необходимо убедиться, что пользователи, не являющиеся администраторами, могут регистрировать приложения.

   ![Найдите свою роль. Если вы являетесь пользователем, убедитесь, что пользователи, не являющиеся администраторами, могут регистрировать приложения.](./media/howto-create-service-principal-portal/view-user-info.png)

1. На левой панели выберите **Параметры пользователя**.
1. Проверьте параметр **Регистрация приложений**. Это значение может быть задано только администратором. Если установлено значение **Да**, приложение в клиенте Azure AD может зарегистрировать любой пользователь.

Если для параметра регистрации приложений установлено значение **Нет**, регистрировать приложения такого типа могут только пользователи с ролью администратора. Дополнительные сведения о доступных ролях администратора и конкретных разрешениях в Azure AD, которые предоставляются каждой роли, см. в разделах [Доступные роли](../roles/permissions-reference.md#available-roles) и [Разрешения ролей](../roles/permissions-reference.md#role-permissions). Если вашей учетной записи назначена роль пользователя, но параметр регистрации приложения ограничен пользователями администратора, попросите администратора либо назначить вам одну из ролей администратора, которые могут создавать и управлять всеми аспектами регистрации приложений, либо разрешить пользователям регистрировать приложения.

### <a name="check-azure-subscription-permissions"></a>Проверка прав доступа к подпискам Azure

В вашей подписке Azure учетная запись должна иметь `Microsoft.Authorization/*/Write` доступ, чтобы назначить роль для приложения AD. Это разрешение предоставляется ролью [владельца](../../role-based-access-control/built-in-roles.md#owner) или [администратора доступа пользователей](../../role-based-access-control/built-in-roles.md#user-access-administrator). Если вашей учетной записи назначена роль **участника** , у вас нет соответствующего разрешения. При попытке назначить роль субъекта-службы возникает ошибка.

Чтобы проверить права доступа к подписке, выполните следующие действия.

1. Найдите и выберите **подписки** или выберите **подписки** на **домашней** странице.

   ![Поиск](./media/howto-create-service-principal-portal/select-subscription.png)

1. Выберите подписку, в которой необходимо создать субъект-службу.

   ![Выбор подписки для назначения](./media/howto-create-service-principal-portal/select-one-subscription.png)

   Если требуемая подписка не отображается, выберите **фильтр глобальных подписок**. Убедитесь, что для портала была выбрана необходимая подписка.

1. Выберите **Мои разрешения**. Затем выберите ссылку **Щелкните здесь, чтобы просмотреть полные сведения о доступе для этой подписки**.

   ![Выберите подписку, в которой нужно создать субъект-службу.](./media/howto-create-service-principal-portal/view-details.png)

1. Выберите **Просмотреть** в **назначениях ролей** , чтобы просмотреть назначенные роли, и определите, есть ли у вас соответствующие разрешения для назначения роли приложению AD. Если разрешения нет, обратитесь к администратору подписки с просьбой назначить вам роль администратора доступа пользователей. На следующем рисунке пользователю назначается роль владельца, а это значит, что у пользователя есть соответствующие разрешения.

   ![В этом примере показано, что пользователю назначена роль владельца.](./media/howto-create-service-principal-portal/view-user-role.png)

## <a name="register-an-application-with-azure-ad-and-create-a-service-principal"></a>Регистрация приложения в Azure AD и создание субъекта-службы

Перейдем к созданию удостоверения. Если у вас возникли сложности, проверьте [необходимые разрешения](#permissions-required-for-registering-an-app), чтобы убедиться в том, что в учетной записи можно создать удостоверение.

1. Войдите в учетную запись Azure через <a href="https://portal.azure.com/" target="_blank">портал Azure</a>.
1. Выберите **Azure Active Directory**.
1. Щелкните **Регистрация приложений**.
1. Выберите **Новая регистрация**.
1. Назовите приложение. Выберите поддерживаемый тип учетной записи, который определяет, кто может использовать приложение. В разделе **URI перенаправления** выберите вариант **Интернет** для типа приложения, которое требуется создать. Введите URI, на который отправляется маркер доступа. Вы не можете создать учетные данные для [собственного приложения](../manage-apps/application-proxy-configure-native-client-application.md). Этот тип нельзя использовать для автоматизированного приложения. Выбрав нужные значения, нажмите кнопку **Зарегистрировать**.

   ![Введите имя приложения](./media/howto-create-service-principal-portal/create-app.png)

Вы создали приложение Azure AD и субъект-службу.

## <a name="assign-a-role-to-the-application"></a>Назначение роли приложению

Чтобы получить доступ к ресурсам в подписке, необходимо назначить приложению роль. Укажите, какая роль предоставляет приложению необходимые разрешения. Дополнительные сведения о доступных ролях см. в статье [встроенные роли Azure](../../role-based-access-control/built-in-roles.md).

Вы можете задать область действия на уровне подписки, группы ресурсов или ресурса. Разрешения наследуют более низкие уровни области действия. Например, Добавление приложения в роль *читатель* для группы ресурсов означает, что она может читать группу ресурсов и все содержащиеся в ней ресурсы.

1. В портал Azure выберите уровень области, на которую требуется назначить приложение. Например, чтобы назначить роль в области действия подписки, выполните поиск и выберите **подписки** или выберите **подписки** на **домашней** странице.

   ![Например, назначьте роль в области действия подписки.](./media/howto-create-service-principal-portal/select-subscription.png)

1. Выберите определенную подписку, для которой хотите назначить приложение.

   ![Выбор подписки для назначения](./media/howto-create-service-principal-portal/select-one-subscription.png)

   Если требуемая подписка не отображается, выберите **фильтр глобальных подписок**. Убедитесь, что для портала была выбрана необходимая подписка.

1. Выберите **Управление доступом (IAM)** .
1. Выберите **Добавить назначение ролей**.
1. Выберите роль, которая будет назначена приложению. Например, чтобы разрешить приложению выполнять такие действия, как **Перезагрузка**, **Запуск** и **Завершение** экземпляров, выберите роль **участник** .  Дополнительные сведения о [доступных ролях](../../role-based-access-control/built-in-roles.md) по умолчанию приложения Azure AD не отображаются в доступных параметрах. Чтобы найти приложение, выполните поиск по его имени и выберите его.

   ![Выберите роль для назначения приложению](./media/howto-create-service-principal-portal/select-role.png)

1. Выберите **Сохранить**, чтобы завершить назначение роли. Приложение отобразится в списке пользователей с ролью для этой области.

Субъект-служба настроен. Вы можете начать использовать его, чтобы выполнять скрипты или приложения. Чтобы управлять субъектом-службой (разрешениями, разрешениями пользователя с полномочиями, просмотреть разрешения, просмотреть сведения о входе и многое другое), перейдите к разделу **корпоративные приложения**.

В следующем разделе показано, как получить значения, необходимые для использования при входе с помощью программного способа.

## <a name="get-tenant-and-app-id-values-for-signing-in"></a>Получение значений идентификатора клиента и приложения для входа

При программном входе передайте идентификатор клиента с запросом проверки подлинности и ИДЕНТИФИКАТОРом приложения.  Вам также потребуется сертификат или ключ проверки подлинности (описывается в следующем разделе). Получить эти значения можно следующим образом.

1. Выберите **Azure Active Directory**.
1. В Azure Active Directory в разделе **Регистрация приложений** выберите нужное приложение.
1. Скопируйте идентификатор каталога (клиента) и сохраните его в коде приложения.

    ![Скопируйте идентификатор каталога (клиента) и сохраните его в коде приложения](./media/howto-create-service-principal-portal/copy-tenant-id.png)

    Идентификатор каталога (клиента) также можно найти на странице обзора каталогов по умолчанию.

1. Скопируйте **идентификатор приложения** и сохраните его в коде приложения.

   ![Скопируйте идентификатор приложения (клиента)](./media/howto-create-service-principal-portal/copy-app-id.png)

## <a name="authentication-two-options"></a>Проверка подлинности: два параметра

Существуют два типа проверки подлинности, доступные для субъектов-служб: проверка подлинности на основе пароля (секрет приложения) и проверка подлинности на основе сертификатов. *Рекомендуется использовать сертификат*, но можно также создать секрет приложения.

### <a name="option-1-upload-a-certificate"></a>Вариант 1. Отправка сертификата

Вы можете использовать существующий сертификат, если он есть.  При необходимости можно создать самозаверяющий сертификат *только для тестирования*. Чтобы создать самозаверяющий сертификат, откройте PowerShell и выполните команду [New-SelfSignedCertificate](/powershell/module/pkiclient/new-selfsignedcertificate) со следующими параметрами, чтобы создать сертификат в хранилище сертификатов пользователя на компьютере:

```powershell
$cert=New-SelfSignedCertificate -Subject "CN=DaemonConsoleCert" -CertStoreLocation "Cert:\CurrentUser\My"  -KeyExportPolicy Exportable -KeySpec Signature
```

Экспортируйте этот сертификат в файл с помощью оснастки MMC " [Управление сертификатом пользователя](/dotnet/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in) ", доступной на панели управления Windows.

1. В меню **Пуск** выберите пункт **выполнить** , а затем введите **CertMgr. msc**.

   Появится средство диспетчера сертификатов для текущего пользователя.

1. Для просмотра сертификатов в разделе **Сертификаты — текущий пользователь** в левой области разверните узел **личный** каталог.
1. Щелкните правой кнопкой мыши созданный сертификат, выберите **все задачи — >экспорт**.
1. Следуйте указаниям мастера экспорта сертификатов.  Не экспортируйте закрытый ключ и экспортируйте его в. CER файл.

Чтобы отправить сертификат, выполните следующие действия.

1. Выберите **Azure Active Directory**.
1. В Azure Active Directory в разделе **Регистрация приложений** выберите нужное приложение.
1. Выберите **Сертификаты и секреты**.
1. Выберите **отправить сертификат** и выберите сертификат (существующий сертификат или самозаверяющий сертификат, который вы экспортировали).

    ![Выберите отправить сертификат и выберите тот, который вы хотите добавить.](./media/howto-create-service-principal-portal/upload-cert.png)

1. Выберите **Добавить**.

После регистрации сертификата в приложении на портале регистрации приложений включите код клиентского приложения для использования сертификата.

### <a name="option-2-create-a-new-application-secret"></a>Вариант 2. Создание нового секрета приложения

Если вы решили не использовать сертификат, можно создать новый секрет приложения.

1. Выберите **Azure Active Directory**.
1. В Azure Active Directory в разделе **Регистрация приложений** выберите нужное приложение.
1. Выберите **Сертификаты и секреты**.
1. Выберите **Секреты клиента -> Новый секрет клиента**.
1. Введите описание и срок действия секрета. Когда все будет готово, нажмите **Добавить**.

   После сохранения секрета клиента отображается значение секрета клиента. Скопируйте это значение, так как вы не сможете получить этот ключ позже. Вы получите значение ключа с ИДЕНТИФИКАТОРом приложения для входа в качестве приложения. Сохраните значение ключа, чтобы приложение могло получить к нему доступ.

   ![Скопируйте значение секрета, так как вы не сможете получить его позже](./media/howto-create-service-principal-portal/copy-secret.png)

## <a name="configure-access-policies-on-resources"></a>Настройка политик доступа к ресурсам
Помните, что может потребоваться настроить дополнительные разрешения для ресурсов, к которым приложению требуется доступ. Например, необходимо также [обновить политики доступа для хранилища ключей](../../key-vault/general/secure-your-key-vault.md#data-plane-and-access-policies) , чтобы предоставить приложению доступ к ключам, секретам или сертификатам.

1. В <a href="https://portal.azure.com/" target="_blank">портал Azure</a>перейдите к своему хранилищу ключей и выберите **политики доступа**.
1. Выберите **Добавить политику доступа**, а затем выберите разрешения ключа, секрета и сертификата, которые вы хотите предоставить приложению.  Выберите ранее созданный субъект-службу.
1. Выберите **Добавить** , чтобы добавить политику доступа, а затем нажмите кнопку **сохранить** , чтобы зафиксировать изменения.
    ![Добавление политики доступа](./media/howto-create-service-principal-portal/add-access-policy.png)

## <a name="next-steps"></a>Следующие шаги
* Узнайте, как [использовать Azure PowerShell для создания субъекта-службы](howto-authenticate-service-principal-powershell.md).
* Дополнительные сведения об указании политик безопасности см. в статье [Управление доступом на основе ролей в Azure (Azure RBAC)](../../role-based-access-control/role-assignments-portal.md).
* Список доступных действий, которые можно разрешить или запретить пользователям, см. в разделе [Операции поставщиков ресурсов Azure Resource Manager](../../role-based-access-control/resource-provider-operations.md).
* Сведения о работе с регистрацией приложений с помощью **Microsoft Graph** см. в справочнике по API [приложений](/graph/api/resources/application) .
