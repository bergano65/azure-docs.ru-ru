---
title: Настройка сопоставлений атрибутов Azure AD | Документация Майкрософт
description: Узнайте, что такое сопоставление атрибутов для приложений SaaS в Azure Active Directory и как настроить его в соответствии с потребностями вашего бизнеса.
services: active-directory
documentationcenter: ''
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 04/03/2019
ms.author: mimart
ms.collection: M365-identity-device-management
ms.openlocfilehash: c8337d18b5c6b484e45e6cefaec98e2684155a02
ms.sourcegitcommit: 375b70d5f12fffbe7b6422512de445bad380fe1e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/06/2019
ms.locfileid: "74900421"
---
# <a name="customizing-user-provisioning-attribute-mappings-for-saas-applications-in-azure-active-directory"></a>Настройка сопоставления атрибутов подготовки пользователей для приложений SaaS в Azure Active Directory

Microsoft Azure AD обеспечивает поддержку подготовки пользователей для сторонних приложений SaaS, таких как Salesforce, G Suite и др. При включении подготовки пользователей для стороннего приложения SaaS портал Azure определяет значения атрибутов с помощью сопоставлений атрибутов.

Существует предварительно настроенный набор атрибутов и сопоставлений атрибутов между объектами пользователей Azure AD и объектами пользователей приложения SaaS. Некоторые приложения управляют другими типами объектов вместе с пользователями, например группами.

Сопоставление атрибутов по умолчанию можно настроить в соответствии с потребностями вашего бизнеса. Таким образом, можно изменить или удалить существующие сопоставления атрибутов или создать новые сопоставления атрибутов.

## <a name="editing-user-attribute-mappings"></a>Изменение сопоставлений атрибутов пользователя

Чтобы получить доступ к функции **сопоставления** для подготовки пользователей, выполните следующие действия.

1. Войдите на [портал Azure Active Directory](https://aad.portal.azure.com).
1. В области слева выберите **корпоративные приложения** . Отображается список всех настроенных приложений, включая приложения, добавленные из коллекции.
1. Выберите любое приложение для загрузки его области управления приложениями, где можно просматривать отчеты и управлять параметрами приложения.
1. Выберите **подготовку** для управления параметрами подготовки учетных записей пользователей для выбранного приложения.
1. Разверните узел **сопоставления** , чтобы просмотреть и изменить атрибуты пользователей, переходящих между Azure AD и целевым приложением. Если целевое приложение поддерживает его, в этом разделе можно дополнительно настроить подготовку групп и учетных записей пользователей.

   ![Использование сопоставлений для просмотра и изменения атрибутов пользователя](./media/customize-application-attributes/21.png)

1. Выберите конфигурацию **сопоставления** , чтобы открыть экран связанного **атрибута сопоставление** . Для правильной работы приложения SaaS требуются некоторые сопоставления атрибутов. Для требуемых атрибутов функция **Удалить** недоступна.

   ![Использование сопоставления атрибутов для настройки сопоставлений атрибутов приложений](./media/customize-application-attributes/22.png)

   На этом снимке экрана видно, что атрибут **username** управляемого объекта в Salesforce заполняется значением **userPrincipalName** связанного объекта Azure Active Directory.

1. Выберите существующее **сопоставление атрибутов** , чтобы открыть экран **Изменение атрибута** . Здесь можно изменить атрибуты пользователя, которые передаются между Azure AD и целевым приложением.

   ![Изменение атрибутов пользователя с помощью атрибута "изменить атрибут"](./media/customize-application-attributes/23.png)

### <a name="understanding-attribute-mapping-types"></a>Основные сведения о типах сопоставления атрибутов

С помощью сопоставлений атрибутов можно управлять заполнением атрибутов в сторонних приложениях SaaS.
Поддерживаются четыре типа сопоставлений:

- **Прямое** — целевой атрибут заполняется значением атрибута связанного объекта в Azure AD.
- **Константа** — целевой атрибут заполняется указанной строкой.
- **Выражение** — целевой атрибут заполняется на основе результата выражения, похожего на сценарий.
  Дополнительные сведения см. в статье [Запись выражений для сопоставления атрибутов в Azure Active Directory](functions-for-customizing-application-data.md).
- **Нет** — целевой атрибут остается без изменений. Однако если целевой атрибут пуст, он заполняется заданным по умолчанию значением.

Вместе с четырьмя базовыми типами сопоставления настраиваемых атрибутов поддерживают понятие необязательного назначения значения **по умолчанию** . Назначение значения по умолчанию гарантирует, что целевой атрибут заполняется значением, если в Azure AD или целевом объекте нет значения. В наиболее распространенной конфигурации это поле остается пустым.

### <a name="understanding-attribute-mapping-properties"></a>Основные сведения о свойствах сопоставления атрибутов

В предыдущем разделе вы уже появились в свойстве типа сопоставления атрибутов.
Вместе с этим свойством сопоставления атрибутов также поддерживают следующие атрибуты:

- **Атрибут источника** — атрибут пользователя из исходной системы (например, Azure Active Directory).
- **Целевой атрибут** — атрибут пользователя в целевой системе (например, ServiceNow).
- **Сопоставлять объекты с помощью этого атрибута** — следует ли использовать это сопоставление для уникальной идентификации пользователей между исходной и целевой системами. Обычно он задается для атрибута userPrincipalName или mail в Azure AD, который обычно сопоставляется с полем имени пользователя в целевом приложении.
- **Приоритет сопоставления** — возможность указания нескольких атрибутов сопоставления. Если существует несколько, они оцениваются в порядке, определенном в этом поле. Как только соответствие найдено, дальнейшие атрибуты сопоставления не вычисляются.
- **Применить это сопоставление**
  - **Всегда** — применять это сопоставление как для действий создания, так и для обновления пользователей.
  - **Только во время создания** — применение этого сопоставления только для действий по созданию пользователя.

## <a name="matching-users-in-the-source-and-target--systems"></a>Сопоставление пользователей в исходной и целевой системах
Службу подготовки Azure AD можно развернуть как в сценариях "нуля" (где пользователи не завершают работу в целевой системе), так и в сценариях "серия статей Brownfield" (где пользователи уже существуют в целевой системе). Для поддержки обоих сценариев служба подготовки использует концепцию сопоставления атрибутов. Соответствующие атрибуты позволяют определить, как однозначно идентифицировать пользователя в источнике и сопоставить его с пользователем в целевом объекте. В рамках планирования развертывания следует указать атрибут, который может быть использован для уникальной идентификации пользователя в исходной и целевой системах. Обратите внимание на следующее:

- **Соответствующие атрибуты должны быть уникальными:** Клиенты часто используют такие атрибуты, как userPrincipalName, mail или Object ID в качестве соответствующего атрибута.
- **В качестве атрибутов сопоставления можно использовать несколько атрибутов:** Можно определить несколько атрибутов для оценки при сопоставлении пользователей и порядке их оценки (определяется приоритетом в пользовательском интерфейсе). Если, например, вы определяете три атрибута как совпадающие, и пользователь однозначно соответствует после вычисления первых двух атрибутов, служба не будет оценивать третий атрибут. Служба будет оценивать совпадающие атрибуты в указанном порядке и прекращать оценку при обнаружении соответствия.  
- **Значения в источнике и целевом объекте не должны точно совпадать:** Значение в целевом объекте может быть некоторой простой функцией значения в источнике. Таким образом, одна из них может иметь атрибут emailAddress в источнике и userPrincipalName в целевом объекте и соответствовать функции атрибута emailAddress, которая заменяет некоторые символы на какое-либо постоянное значение.  
- **Сопоставление на основе сочетания атрибутов не поддерживается:** Большинство приложений не поддерживают запросы на основе двух свойств. Поэтому невозможно выполнить сопоставление на основе сочетания атрибутов. Можно оценить отдельные свойства после другого.
- **Все пользователи должны иметь значение хотя бы для одного совпадающего атрибута:** При определении одного соответствующего атрибута все пользователи должны иметь значение для этого атрибута в исходной системе. Если, например, определить userPrincipalName в качестве атрибута сопоставления, все пользователи должны иметь userPrincipalName. Если вы определили несколько совпадающих атрибутов (например, extensionAttribute1 и mail), не все пользователи должны иметь одинаковый совпадающий атрибут. У одного пользователя может быть extensionAttribute1, но не почта, тогда как другой пользователь мог почтовые сообщения, но не extensionAttribute1. 
- **Целевое приложение должно поддерживать фильтрацию по атрибуту сопоставления:** Разработчики приложений могут выполнять фильтрацию для подмножества атрибутов в API-интерфейсе пользователя или группы. Для приложений в коллекции мы гарантируем, что сопоставление атрибута по умолчанию предназначено для атрибута, по которому API-интерфейс целевого приложения поддерживает фильтрацию. При изменении атрибута сопоставления по умолчанию для целевого приложения проверьте документацию по API стороннего разработчика, чтобы убедиться, что атрибут может быть отфильтрован.  

## <a name="editing-group-attribute-mappings"></a>Изменение сопоставлений атрибутов группы

Выбранное число приложений, например ServiceNow, Box и G Suite, поддерживает возможность подготавливать объекты группы и объекты-пользователи. Объекты группы могут содержать свойства группы, такие как отображаемые имена и псевдонимы электронной почты вместе с членами группы.

![Пример показывает ServiceNow с подготовленными объектами группы и пользователей](./media/customize-application-attributes/24.png)

Можно дополнительно включить или отключить подготовку групп, выбрав сопоставление групп в разделе **сопоставления**и установив для параметра **включено** на экране **сопоставление атрибутов** .

Атрибуты, подготовленные как часть объектов группы, можно настроить так же, как объекты пользователя, описанные ранее. 

> [!TIP]
> Подготовка объектов группы (свойства и участники) отличается от [присвоения групп](assign-user-or-group-access-portal.md) приложению. Вы можете назначить группу приложению, однако подготовить можно только те объекты пользователя, которые содержатся в группе. Для использования групп в назначениях подготовка объектов для всей группы не требуется.

## <a name="editing-the-list-of-supported-attributes"></a>Изменение списка поддерживаемых атрибутов

Атрибуты пользователя, поддерживаемые для заданного приложения, настроены предварительно. Большинство API-интерфейсов управления пользователями приложения не поддерживают обнаружение схемы. Таким образом, служба подготовки Azure AD не может динамически создавать список поддерживаемых атрибутов, выполнив вызовы к приложению.

Однако некоторые приложения поддерживают настраиваемые атрибуты, и служба подготовки Azure AD может считывать пользовательские атрибуты и записывать их в них. Чтобы ввести их определения в портал Azure, установите флажок **Показывать дополнительные параметры** в нижней части экрана **сопоставления атрибутов** , а затем выберите **изменить список атрибутов для** своего приложения.

Ниже приведены приложения и системы, поддерживающие настройку списка атрибутов.

- Salesforce
- ServiceNow
- Workday
- Azure Active Directory (поддерживаются [атрибуты по умолчанию API Graph Azure AD](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#user-entity) и расширения пользовательского каталога)
- Приложения, поддерживающие [SCIM 2.0](https://tools.ietf.org/html/rfc7643), где необходимо добавить атрибуты, определенные в [основной схеме](https://tools.ietf.org/html/rfc7643)

> [!NOTE]
> Изменение списка поддерживаемых атрибутов рекомендуется только для администраторов, которые настроили схему своих приложений и систем и имеют непосредственные знания об определении их атрибутов. Иногда для этого требуются навыки работы с API-интерфейсами и средствами разработчика, предоставляемыми приложением или системой.

При изменении списка поддерживаемых атрибутов предоставляются следующие свойства:

- **Имя** — системное имя атрибута, определенное в схеме целевого объекта.
- **Type** — тип данных, которые хранятся в атрибуте, как определено в схеме целевого объекта, может быть одним из следующих типов:
  - *Binary* — атрибут содержит двоичные данные.
  - *Boolean* — атрибут содержит значение True или False.
  - *DateTime* — атрибут содержит строку даты.
  - *Integer* — атрибут содержит целое число.
  - *Reference* — атрибут содержит идентификатор, который ссылается на значение, хранящееся в другой таблице в целевом приложении.
  - *String* — атрибут содержит текстовую строку.
- **Первичный ключ?** — Указывает, определен ли атрибут как поле первичного ключа в схеме целевого объекта.
- **Обязательный?** — Указывает, должен ли атрибут быть заполнен в целевом приложении или системе.
- **С несколькими значениями?** — Указывает, поддерживает ли атрибут несколько значений.
- **С учетом регистра?** — Определяет, учитывается ли регистр значений атрибутов.
- **Выражение API** — не используйте, если это не указано в документации по конкретному соединителю подготовки (например, Workday).
- **Упоминаемый атрибут объекта** . Если это Атрибут ссылочного типа, это меню позволяет выбрать таблицу и атрибут в целевом приложении, который содержит значение, связанное с атрибутом. Например, если у вас есть атрибут с именем Department, сохраненное значение которого указывает на объект в отдельной таблице Departments, необходимо выбрать Departments.Name. Ссылочные таблицы и поля первичного идентификатора, поддерживаемые для данного приложения, предварительно настроены и в настоящее время не могут быть изменены с помощью портал Azure, но могут быть изменены с помощью [API Graph](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-configure-with-custom-target-attributes).

#### <a name="provisioning-a-custom-extension-attribute-to-a-scim-compliant-application"></a>Подготовка пользовательского атрибута расширения для приложения, совместимого с SCIM
SCIM RFC определяет основную схему пользователей и групп, а также позволяет расширениям схемы в соответствии с потребностями вашего приложения. Чтобы добавить настраиваемый атрибут в приложение SCIM, выполните следующие действия.
   1. Войдите на [портал Azure Active Directory](https://aad.portal.azure.com), выберите **корпоративные приложения**, выберите приложение, а затем щелкните **Подготовка**.
   2. В разделе **сопоставления**выберите объект (пользователя или группу), для которого вы хотите добавить настраиваемый атрибут.
   3. В нижней части страницы выберите пункт **отобразить дополнительные параметры**.
   4. Выберите * * Изменить список атрибутов для *приложения*.
   5. В нижней части списка атрибутов введите сведения о настраиваемом атрибуте в предоставленных полях. Затем выберите **Добавить атрибут**.

Для приложений SCIM имя атрибута должно соответствовать шаблону, показанному в примере ниже. "Кустомекстенсионнаме" и "CustomAttribute" можно настроить в соответствии с требованиями приложения, например: urn: IETF: params: scim: schemas: Extension: 2.0: Кустомекстенсионнаме: CustomAttribute

Эти инструкции применимы только к приложениям с поддержкой SCIM. Такие приложения, как ServiceNow и Salesforce, не интегрированы с Azure AD с помощью SCIM, поэтому они не нуждаются в определенном пространстве имен при добавлении настраиваемого атрибута.

Настраиваемые атрибуты не могут быть ссылочными атрибутами или атрибутами с несколькими значениями. Настраиваемые атрибуты расширения с несколькими значениями в настоящее время поддерживаются только для приложений в коллекции.  
 
**Пример представления пользователя с атрибутом расширения:**

```json
   {
     "schemas": ["urn:ietf:params:scim:schemas:core:2.0:User",
      "urn:ietf:params:scim:schemas:extension:enterprise:2.0:User",
      "urn:ietf:params:scim:schemas:extension:CustomExtensionName:2.0:User"],
     "userName":"bjensen",
     "externalId":"bjensen",
     "name":{
       "formatted":"Ms. Barbara J Jensen III",
       "familyName":"Jensen",
       "givenName":"Barbara"
     },
     "urn:ietf:params:scim:schemas:extension:enterprise:2.0:User": {
     "employeeNumber": "701984",
     "costCenter": "4130",
     "organization": "Universal Studios",
     "division": "Theme Park",
     "department": "Tour Operations",
     "manager": {
       "value": "26118915-6090-4610-87e4-49d8ca9f808d",
       "$ref": "../Users/26118915-6090-4610-87e4-49d8ca9f808d",
       "displayName": "John Smith"
     }
   },
     "urn:ietf:params:scim:schemas:extension:CustomExtensionName:2.0:CustomAttribute:User": {
     "CustomAttribute": "701984",
   },
   "meta": {
     "resourceType": "User",
     "created": "2010-01-23T04:56:22Z",
     "lastModified": "2011-05-13T04:42:34Z",
     "version": "W\/\"3694e05e9dff591\"",
     "location":
 "https://example.com/v2/Users/2819c223-7f76-453a-919d-413861904646"
   }
 }
```


## <a name="provisioning-a-role-to-a-scim-app"></a>Подготовка роли для приложения SCIM
Выполните следующие действия, чтобы подготавливать роли для пользователя к приложению. Обратите внимание, что приведенное ниже описание относится только к пользовательским приложениям SCIM. Для приложений коллекции, таких как Salesforce и ServiceNow, используйте предварительно определенные сопоставления ролей. В приведенных ниже маркерах описывается преобразование атрибута AppRoleAssignments в формат, который требуется приложению.

- Сопоставление appRoleAssignment в Azure AD с ролью в приложении требует преобразования атрибута с помощью [выражения](https://docs.microsoft.com/azure/active-directory/manage-apps/functions-for-customizing-application-data). Атрибут appRoleAssignment **не должен сопоставляться напрямую** с атрибутом Role без использования выражения для анализа сведений о роли. 

- **синглеаппролеассигнмент** 
  - **Когда следует использовать:** Используйте выражение Синглеаппролеассигнмент для предоставления одной роли для пользователя и указания первичной роли. 
  - **Настройка:** Выполните описанные выше действия, чтобы переходить к странице сопоставления атрибутов и использовать выражение Синглеаппролеассигнмент для сопоставления с атрибутом Roles. Существует три атрибута роли: (роли [основной EQ "true"]. Отображение, роли [основной EQ "true]. Type и Roles [PRIMARY EQ" true "]. Value). В сопоставлениях можно включить любой или все атрибуты роли. Если вы хотите включить более одного объекта, просто добавьте новое сопоставление и включите его в качестве целевого атрибута.  
  
  ![Добавить Синглеаппролеассигнмент](./media/customize-application-attributes/edit-attribute-singleapproleassignment.png)
  - **Вопросы, которые следует учитывать**
    - Убедитесь, что пользователю не назначено несколько ролей. Мы не можем гарантировать, какая роль будет подготовлена.
    
  - **Пример выходных данных** 

   ```json
    {
      "schemas": [
          "urn:ietf:params:scim:schemas:core:2.0:User"
      ],
      "externalId": "alias",
      "userName": "alias@contoso.OnMicrosoft.com",
      "active": true,
      "displayName": "First Name Last Name",
      "meta": {
           "resourceType": "User"
      },
      "roles": [
         {
               "primary": true,
               "type": "WindowsAzureActiveDirectoryRole",
               "value": "Admin"
         }
      ]
   }
   ```
  
- **аппролеассигнментскомплекс** 
  - **Когда следует использовать:** Используйте выражение Аппролеассигнментскомплекс для инициализации нескольких ролей для пользователя. 
  - **Настройка:** Измените список поддерживаемых атрибутов, как описано выше, чтобы включить новый атрибут для ролей: 
  
    ![Добавление ролей](./media/customize-application-attributes/add-roles.png)<br>

    Затем используйте выражение Аппролеассигнментскомплекс для соотнесения с атрибутом пользовательской роли, как показано на рисунке ниже:

    ![Добавить Аппролеассигнментскомплекс](./media/customize-application-attributes/edit-attribute-approleassignmentscomplex.png)<br>
  - **Вопросы, которые следует учитывать**
    - Все роли будут подготовлены как первичные = false.
    - ЗАПИСЬ содержит тип роли. Запрос PATCH не содержит тип. Мы работаем над отправкой типа в запросах POST и PATCH.
    
  - **Пример выходных данных** 
  
   ```json
   {
       "schemas": [
           "urn:ietf:params:scim:schemas:core:2.0:User"
      ],
      "externalId": "alias",
      "userName": "alias@contoso.OnMicrosoft.com",
      "active": true,
      "displayName": "First Name Last Name",
      "meta": {
           "resourceType": "User"
      },
      "roles": [
         {
               "primary": false,
               "type": "WindowsAzureActiveDirectoryRole",
               "display": "Admin",
               "value": "Admin"
         },
         {
               "primary": false,
               "type": "WindowsAzureActiveDirectoryRole",
               "display": "User",
             "value": "User"
         }
      ]
   }
   ```

  


## <a name="provisioning-a-multi-value-attribute"></a>Подготовка атрибута с несколькими значениями
Некоторые атрибуты, такие как Фоненумберс и сообщения электронной почты, являются атрибутами с несколькими значениями, где может потребоваться указать различные типы телефонных номеров или сообщений электронной почты. Используйте приведенное ниже выражение для атрибутов с несколькими значениями. Он позволяет указать тип атрибута и соотнести его с соответствующим атрибутом пользователя Azure AD для значения. 

* phoneNumbers[type eq "work"].value
* phoneNumbers[type eq "mobile"].value
* phoneNumbers[type eq "fax"].value

   ```json
   "phoneNumbers": [
       {
         "value": "555-555-5555",
         "type": "work"
      },
      {
         "value": "555-555-5555",
         "type": "mobile"
      },
      {
         "value": "555-555-5555",
         "type": "fax"
      }
   ]
   ```

## <a name="restoring-the-default-attributes-and-attribute-mappings"></a>Восстановление атрибутов по умолчанию и сопоставления атрибутов

Если необходимо начать заново и сбросить существующие сопоставления обратно в состояние по умолчанию, можно установить флажок **Восстановить сопоставления по умолчанию** и сохранить конфигурацию. При этом все сопоставления задаются так, как если бы приложение было только что Добавлено в клиент Azure AD из коллекции приложений.

Выбор этого параметра приведет к принудительной повторной синхронизации всех пользователей во время выполнения службы подготовки.

> [!IMPORTANT]
> Настоятельно рекомендуется установить **состояние подготовки** в значение **Off** перед вызовом этого параметра.

## <a name="what-you-should-know"></a>Необходимая информация

- Процесс синхронизации в Microsoft Azure AD реализован очень эффективно. Во время цикла синхронизации в инициализированной среде обрабатываются только объекты, требующие обновления.
- Обновление сопоставлений атрибутов влияет на производительность цикла синхронизации. Чтобы обновить конфигурацию сопоставления атрибутов, необходимо повторно оценить все управляемые объекты.
- Рекомендуется, чтобы количество последовательных изменений в сопоставлении атрибутов было минимальным.
- Добавление атрибута Photo для подготовки к работе в приложении не поддерживается, так как нельзя указать формат для синхронизации фотографии. Вы можете запросить эту функцию на [голоса пользователя](https://feedback.azure.com/forums/169401-azure-active-directory)
- Атрибут Иссофтделетед часто является частью сопоставлений по умолчанию для приложения. Иссофтделетед может быть true в одном из четырех сценариев (пользователь выходит из области действия, поскольку он не назначен из приложения, пользователь выходит из области действия, так как не соответствует фильтру области, пользователь был обратимо удален в Azure AD, или свойство AccountEnabled имеет значение false.  для пользователя). 
- Служба подготовки Azure AD не поддерживает инициализацию значений NULL

## <a name="next-steps"></a>Дальнейшие действия

- [Автоматическая подготовка пользователей и ее отзыв для приложений SaaS](user-provisioning.md)
- [Запись выражений для сопоставления атрибутов](functions-for-customizing-application-data.md)
- [Фильтры области для подготовки пользователей](define-conditional-rules-for-provisioning-user-accounts.md)
- [Автоматическая подготовка пользователей и групп из Azure Active Directory в приложениях с использованием SCIM](use-scim-to-provision-users-and-groups.md)
- [Список учебников по интеграции приложений SaaS](../saas-apps/tutorial-list.md)
