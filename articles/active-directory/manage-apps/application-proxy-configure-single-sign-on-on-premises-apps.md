---
title: Единый вход SAML для локальных приложений с помощью прокси-сервера Azure AD App
description: Узнайте, как обеспечить единый вход для локальных приложений, защищенных с помощью проверки подлинности SAML. Предоставление удаленного доступа к локальным приложениям с помощью прокси приложения.
services: active-directory
documentationcenter: ''
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 10/24/2019
ms.author: mimart
ms.reviewer: japere
ms.custom: it-pro
ms.collection: M365-identity-device-management
ms.openlocfilehash: 59e4e527f25a32c8a5274db5eab5d33a7843bc3c
ms.sourcegitcommit: 653e9f61b24940561061bd65b2486e232e41ead4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2019
ms.locfileid: "74275586"
---
# <a name="saml-single-sign-on-for-on-premises-applications-with-application-proxy"></a>Единый вход SAML для локальных приложений с помощью прокси приложения

Вы можете предоставить возможность единого входа (SSO) в локальные приложения, защищенные с помощью проверки подлинности SAML, и предоставить удаленный доступ к этим приложениям через прокси приложения. С помощью единого входа SAML Azure Active Directory (Azure AD) выполняет проверку подлинности приложения с помощью учетной записи пользователя Azure AD. Azure AD передает приложению данные для входа через протокол соединения. Вы также можете сопоставлять пользователей с определенными ролями приложений на основе правил, определенных в заявках SAML. Включив прокси приложения в дополнение к SAML SSO, пользователи будут иметь внешний доступ к приложению и возможности простого единого входа.

Приложения должны иметь возможность использовать токены SAML, выданные **Azure Active Directory**. Эта конфигурация не применяется к приложениям, использующим локальный поставщик удостоверений. В этих сценариях рекомендуется просмотреть [ресурсы для переноса приложений в Azure AD](migration-resources.md).

Единый вход SAML с прокси приложения также работает с функцией шифрования токена SAML. Дополнительные сведения см. в статье [Настройка шифрования маркеров SAML в Azure AD](howto-saml-token-encryption.md).

Приведенные ниже схемы протоколов описывают последовательность единого входа для потока, инициированного поставщиком услуг, и потока, инициированного поставщиком удостоверений (IdP). Прокси приложения работает с SAML SSO путем кэширования запроса SAML и ответа в локальном приложении и обратно.

  ![Поток SP в SAML](./media/application-proxy-configure-single-sign-on-on-premises-apps/saml-sp-initiated-flow.png)

  ![Поток SP в SAML](./media/application-proxy-configure-single-sign-on-on-premises-apps/saml-idp-initiated-flow.png)

## <a name="create-an-application-and-set-up-saml-sso"></a>Создание приложения и Настройка единого входа SAML

1. В портал Azure выберите **Azure Active Directory > корпоративные приложения** и выберите **новое приложение**.

2. В разделе **Локальные приложения** выберите **Добавление локального приложения**.

3. Введите отображаемое имя нового приложения, а затем нажмите кнопку **Добавить**.

4. На странице **Обзор** приложения выберите **единый вход**.

5. Выберите **SAML** в качестве метода единого входа.

6. Сначала настройте единый вход SAML для работы в корпоративной сети. На странице **Настройка единого входа с помощью SAML** перейдите к разделу **Базовая конфигурация SAML** и выберите его значок **редактирования** (карандаш). Выполните действия, описанные в разделе [Ввод базовой конфигурации SAML](configure-single-sign-on-non-gallery-applications.md#step-1-edit-the-basic-saml-configuration) , чтобы настроить проверку подлинности на основе SAML для приложения.

7. Добавьте по крайней мере одного пользователя в приложение и убедитесь, что у тестовой учетной записи есть доступ к приложению. При подключении к корпоративной сети используйте тестовую учетную запись, чтобы узнать, есть ли у вас единый вход в приложение. 

   > [!NOTE]
   > После настройки прокси приложения вы вернетесь назад и обновите **URL-адрес ответа**SAML.

## <a name="publish-the-on-premises-application-with-application-proxy"></a>Публикация локального приложения с помощью прокси приложения

Прежде чем вы сможете предоставить единый вход для локальных приложений, необходимо включить прокси приложения и установить соединитель. Ознакомьтесь с руководством [Добавление локального приложения для удаленного доступа через прокси приложения в Azure AD](application-proxy-add-on-premises-application.md) , чтобы узнать, как подготовить локальную среду, установить и зарегистрировать соединитель, а также протестировать соединитель. Затем выполните следующие действия, чтобы опубликовать новое приложение с помощью прокси приложения. Другие параметры, не упомянутые ниже, см. в разделе [Добавление локального приложения в Azure AD](application-proxy-add-on-premises-application.md#add-an-on-premises-app-to-azure-ad) в этом руководстве.

1. Если приложение по-прежнему открыто в портал Azure, выберите **прокси приложения**. Укажите **внутренний URL-адрес** для приложения. Если вы используете личный домен, также необходимо отправить SSL-сертификат для приложения. 
   > [!NOTE]
   > Рекомендуется использовать пользовательские домены, когда это возможно, для оптимизированного взаимодействия с пользователем. Дополнительные сведения о [работе с пользовательскими доменами в Azure AD application proxy](application-proxy-configure-custom-domain.md).

2. Выберите **Azure Active Directory** в качестве метода **предварительной проверки подлинности** для приложения.

3. Скопируйте **внешний URL-адрес** для приложения. Этот URL-адрес потребуется для завершения настройки SAML.

4. С помощью тестовой учетной записи попытайтесь открыть приложение с **внешним URL-адресом** , чтобы убедиться, что прокси приложения настроен правильно. При возникновении проблем см. статью [Устранение неполадок прокси-сервера приложений и сообщения об ошибках](application-proxy-troubleshoot.md).

## <a name="update-the-saml-configuration"></a>Обновление конфигурации SAML

1. Если приложение по-прежнему открыто в портал Azure, выберите **единый вход**. 

2. На странице **Настройка единого входа с помощью SAML** перейдите к разделу **Базовая конфигурация SAML** и выберите его значок **редактирования** (карандаш). **Внешний URL-адрес** , настроенный в прокси приложения, автоматически заполняет поля **идентификатор**, **URL-адрес ответа**и **URL-адрес выхода** . Не изменяйте эти URL-адреса, так как они необходимы для правильной работы прокси приложения.

3. Измените **URL-адрес ответа** , настроенный ранее, чтобы его домен был доступен прокси приложения. Например, если **внешний URL-адрес** `https://contosotravel-f128.msappproxy.net`, а исходный **URL-адрес ответа** был `https://contosotravel.com/acs`, то необходимо обновить исходный **url-адрес ответа** на `https://contosotravel-f128.msappproxy.net/acs`. 

    ![Ввод основных данных конфигурации SAML](./media/application-proxy-configure-single-sign-on-on-premises-apps/basic-saml-configuration.png)


4. Установите флажок рядом с обновленным **URL-адресом ответа** , чтобы отметить его как значение по умолчанию.

   * Если требуемый **URL-адрес ответа** уже указан, пометьте этот **URL-адрес ответа** как используемый по умолчанию и удалите ранее настроенный **URL-адрес ответа**.

   * Для потока, инициированного поставщиком услуг, убедитесь, что серверное приложение указывает правильный **URL-адрес ответа** или URL-адрес службы утверждения для получения маркера проверки подлинности.

    > [!NOTE]
    > Если серверное приложение предполагает, что **URL-адрес ответа** является внутренним URL-адресом, необходимо либо использовать [Личные домены](application-proxy-configure-custom-domain.md) для сопоставления внутренних и внешних URL-адресов, либо установить расширение безопасного входа в мои приложения на устройствах пользователей. Это расширение будет автоматически перенаправляться в соответствующую службу прокси приложения. Сведения об установке расширения см. в статье [расширение безопасного входа в мои приложения](../user-help/my-apps-portal-end-user-access.md#download-and-install-the-my-apps-secure-sign-in-extension).
    
## <a name="test-your-app"></a>Тестирование приложения

Когда вы завершите выполнение этих шагов, ваше приложение будет настроено и запущено. Чтобы протестировать приложение, сделайте следующее:

1. Откройте браузер и перейдите по **внешнему URL-адресу** , созданному при публикации приложения. 
1. Войдите с помощью тестовой учетной записи, назначенной приложению. Вы сможете загрузить приложение и использовать единый вход в приложение.

## <a name="next-steps"></a>Дополнительная информация

- [Как прокси приложения Azure AD предоставляет единый вход?](application-proxy-single-sign-on.md)
- [Устранение неполадок прокси-сервера приложений](application-proxy-troubleshoot.md)
