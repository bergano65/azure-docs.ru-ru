---
title: Планирование развертывания Azure Active Directory единого входа
description: Справочные сведения по планированию, развертыванию и управлению SSO в Организации.
services: active-directory
author: jeevansd
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.topic: conceptual
ms.workload: identity
ms.date: 05/22/2019
ms.author: baselden
ms.reviewer: jeedes
ms.collection: M365-identity-device-management
ms.openlocfilehash: 733b0d7650d68bddae60cf524947590c2b689968
ms.sourcegitcommit: 6cbf5cc35840a30a6b918cb3630af68f5a2beead
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/05/2019
ms.locfileid: "68779364"
---
# <a name="plan-a-single-sign-on-deployment"></a>Планирование развертывания единого входа

Единый вход (SSO) означает доступ ко всем приложениям и ресурсам, которые требуются пользователю, войдя только один раз, используя одну учетную запись пользователя. С помощью единого входа пользователи могут получить доступ ко всем необходимым приложениям, не требуя проверки подлинности второй раз.

## <a name="benefits-of-sso"></a>Преимущества единого входа

Единый вход (SSO) обеспечивает безопасность и удобство при входе пользователей в приложения в Azure Active Directory (Azure AD). 

Многие организации используют приложения SaaS (программное обеспечение как услуга), такие как Office 365, Box и Salesforce, для повышения производительности пользователей. Исторически ИТ-персоналу требовалось отдельно создавать и обновлять учетные записи пользователей в каждом приложении SaaS, а пользователям необходимо запомнить пароль для каждого из них.

Azure Marketplace имеет более 3000 приложений с предварительно интегрированными подключениями единого входа, что упрощает их интеграцию в клиент.

## <a name="licensing"></a>Лицензирование

- **Лицензирование Azure AD** . единый вход для предварительно интегрированных приложений SaaS предоставляется бесплатно. Однако количество объектов в каталоге и компоненты, которые вы хотите развернуть, может потребовать дополнительных лицензий. Полный список требований к лицензиям см. в разделе [цены на Azure Active Directory](https://azure.microsoft.com/pricing/details/active-directory/).
- **Лицензирование приложений** . вам понадобятся соответствующие лицензии для приложений SaaS в соответствии с потребностями бизнеса. Обратитесь к владельцу приложения, чтобы определить, имеют ли пользователи, назначенные приложению, соответствующие лицензии для своих ролей в приложении. Если Azure AD управляет автоматической подготовкой на основе ролей, роли, назначенные в Azure AD, должны совпадать с количеством лицензий, принадлежащих приложению. Неправильное число лицензий, принадлежащих приложению, может привести к ошибкам во время подготовки или обновления пользователя.

## <a name="plan-your-sso-team"></a>Планирование команды единого входа

- **Общайтесь с** нужными заинтересованными лицами. при сбое технологических проектов, обычно это обусловлено несоответствием ожиданиям, результатами и обязанностями. Чтобы избежать этих ловушек, [Убедитесь, что вы знакомы](https://aka.ms/deploymentplans) с нужными заинтересованными лицами и что заинтересованные лица понимают их роли.
- **Планирование обмена данными** — связь очень важна для успеха любой новой службы. Заблаговременное взаимодействие с пользователями о том, как изменится их опыт, когда они изменятся, и как получить поддержку в случае возникновения проблем. Ознакомьтесь с вариантами [того, как пользователи будут обращаться к приложениям с поддержкой единого входа](end-user-experiences.md), и создавайте связи в соответствии с выбранным. 

## <a name="plan-your-sso-protocol"></a>Планирование протокола единого входа

Реализация единого входа, основанная на протоколах Федерации, повышает безопасность, надежность и удобство работы пользователей и упрощает реализацию. Многие приложения предварительно интегрированы в Azure AD с [пошаговыми руководствами](../saas-apps/tutorial-list.md). Их можно найти в [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/). Подробные сведения о каждом методе единого входа можно найти в статье [единый вход в приложения в Azure Active Directory](what-is-single-sign-on.md).

Существует два основных способа предоставления пользователям возможности единого входа в приложения:

- **С помощью федеративного единого входа** Azure AD выполняет проверку подлинности пользователя для приложения с помощью учетной записи Azure AD. Этот метод поддерживается для приложений, поддерживающих такие протоколы, как SAML 2,0, WS-Federation или OpenID Connect Connect, и является самым широким режимом единого входа. Рекомендуется использовать федеративный единый вход с Azure AD, когда приложение поддерживает его, а не единый вход на основе пароля и ADFS.

- Пользователи **единого входа, основанные на пароле** , входят в приложение с именем пользователя и паролем в первый раз. После первого входа Azure AD предоставляет приложению имя пользователя и пароль. Единый вход на основе пароля позволяет безопасно хранить пароли приложений и воспроизводить его с помощью расширения веб-браузера или мобильного приложения. Этот параметр использует существующий процесс входа, предоставляемый приложением, позволяет администратору управлять паролями и не требует от пользователя знания пароля.

### <a name="considerations-for-federation-based-sso"></a>Рекомендации по SSO на основе Федерации

- **Используя OpenID Connect Connect и OAuth** — если приложение, к которому вы подключаетесь, поддерживает его, используйте метод OIDC/OAuth 2,0, чтобы включить единый вход для этого приложения. Этот метод требует меньше конфигурации и обеспечивает более широкие возможности взаимодействия с пользователем. Дополнительные сведения см. в статьях [OAuth 2,0](../develop/v2-oauth2-auth-code-flow.md), [OpenID Connect Connect 1,0](../develop/v2-protocols-oidc.md)и [Azure Active Directory Guide для разработчиков](https://docs.microsoft.com/azure/active-directory/develop/active-directory-developers-guide).
- **Конфигурации конечных точек для единого входа на основе SAML** . Если вы используете SAML, разработчикам потребуется определенная информация до настройки приложения. Дополнительные сведения см. [в разделе изменение базовой конфигурации SAML](configure-single-sign-on-non-gallery-applications.md).
- **Управление сертификатами для единого входа на основе SAML** . при включении ФЕДЕРАТИВНОГО единого входа для приложения Azure AD создает сертификат, который по умолчанию действует в течение трех лет. При необходимости можно настроить дату истечения срока действия этого сертификата. Убедитесь, что у вас есть процессы обновления сертификатов до истечения срока их действия. Дополнительные сведения см. в статье [Управление сертификатами в Azure AD](https://docs.microsoft.com/azure/active-directory/active-directory-sso-certs).

### <a name="considerations-for-password-based-sso"></a>Рекомендации по использованию единого входа на основе пароля

Для использования Azure AD для единого входа на основе пароля требуется развернуть расширение браузера, которое будет безопасно извлекать учетные данные и заполнять формы для входа. Определите механизм для развертывания расширения в масштабе с помощью [поддерживаемых браузеров](https://docs.microsoft.com/azure/active-directory/active-directory-saas-access-panel-introduction). Возможны следующие значения.

- [групповая политика для Internet Explorer](https://azure.microsoft.com/documentation/articles/active-directory-saas-ie-group-policy/)
- [System Center Configuration Manager (SCCM) для Internet Explorer](https://docs.microsoft.com/sccm/core/clients/deploy/deploy-clients-to-windows-computers)
- [Управляемая пользователем загрузка и настройка для Chrome, Firefox, Microsoft ребр или IE](https://docs.microsoft.com/azure/active-directory/active-directory-saas-access-panel-introduction)

Дополнительные сведения см. в статье [Настройка единого входа](https://docs.microsoft.com/azure/active-directory/application-config-sso-how-to-configure-password-sso-non-gallery)с паролем.

#### <a name="capturing-login-forms-metadata-for-applications-that-arent-in-the-gallery"></a>Запись метаданных форм входа для приложений, которых нет в коллекции

Корпорация Майкрософт поддерживает запись метаданных в веб-приложение для сохранения паролей (с записью полей имени пользователя и пароля). В процессе настройки приложения для записи метаданных форм перейдите по URL-адресу входа. Попросите владельца приложения указать точный URL-адрес для входа. Эти сведения используются в процессе входа, сопоставляя учетные данные Azure AD с приложением во время входа.

Дополнительные сведения см. в статье [что такое доступ к приложениям и единый вход с помощью Azure AD? — единый вход на основе пароля](https://azure.microsoft.com/documentation/articles/active-directory-appssoaccess-whatis/).

#### <a name="indications-that-metadata-in-forms-needs-to-be-recaptured"></a>Указывают на необходимость перезаписи метаданных в формах

Когда приложения изменяют свой макет HTML, может потребоваться перезапись метаданных, чтобы скорректировать изменения. Типичные симптомы, указывающие на изменение макета HTML, включают:

- Пользователи, сообщающие о том, что при щелчке приложения на странице входа отображается сообщение "зависнуть"
- Пользователи, сообщающие о том, что имя пользователя или пароль не заполнены

#### <a name="shared-accounts"></a>Общие учетные записи

С точки зрения входа приложения с общими учетными записями не отличаются от приложения коллекции, использующего единый вход с помощью пароля для отдельных пользователей. Однако при планировании и настройке приложения, предназначенного для использования общих учетных записей, необходимо выполнить некоторые дополнительные действия.

1. Поработайте с бизнес-пользователями приложений, чтобы документировать следующие данные:
   1. Набор пользователей в Организации, которые будут использовать приложение
   1. Существующий набор учетных данных в приложении, связанном с набором пользователей 
1. Для каждого сочетания набора пользователей и учетных данных создайте группу безопасности в облаке или в локальной среде в соответствии с вашими требованиями.
1. Сбросьте общие учетные данные. После развертывания приложения в Azure AD пользователям не требуется пароль общей учетной записи. Так как Azure AD сохранит пароль, рассмотрите возможность его настройки как очень длинной, так и сложной. 
1. Настройте автоматическую смену пароля, если приложение поддерживает его. Таким образом, даже администратор, выполнивший начальную установку, будет узнавать пароль общей учетной записи. 

## <a name="plan-your-authentication-method"></a>Планирование метода проверки подлинности

Выбор правильного метода аутентификации является основным первым решением при настройке решения для гибридной идентификации Azure AD. Реализация метода аутентификации настраивается с помощью Azure AD Connect, что также дает возможность подготовить пользователей в облаке.

Чтобы выбрать метод аутентификации, необходимо учитывать время, имеющуюся инфраструктуру, сложность и стоимость реализации решения. Эти факторы отличаются для каждой организации и могут изменяться с течением времени. Следует выбрать тот, который наиболее полно соответствует конкретному сценарию. Дополнительные сведения см. [в статье Выбор правильного метода проверки подлинности для Azure Active Directory гибридного решения для идентификации](https://docs.microsoft.com/azure/security/fundamentals/choose-ad-authn).

## <a name="plan-your-security-and-governance"></a>Планируйте безопасность и управление 

Удостоверение — это новая основная Сводная таблица для внимания безопасности и инвестиций, так как периметр сети значительно проницаемым и менее эффективен при развертывании устройств BYOD и облачных приложений. 

### <a name="plan-access-reviews"></a>Планирование проверок доступа

Проверки [доступа](https://docs.microsoft.com/azure/active-directory/governance/create-access-review) позволяют организациям эффективно управлять членством в группах, доступом к корпоративным приложениям и назначениями ролей. Необходимо регулярно проверять доступ пользователей, чтобы обеспечить доступ к ним только тем, кто имеет право.

Ниже приведены некоторые ключевые темы, которые необходимо учитывать при настройке проверок доступа.

1. Определение ритмичности проверок доступа в соответствии с бизнес-нуждами. Это может быть так же часто, как раз в неделю, ежемесячно, ежегодно или в качестве упражнения по запросу.

1. Создание групп, представляющих рецензентов отчетов о доступе к приложениям. Необходимо убедиться, что заинтересованным лицам, которые наиболее знакомы с приложением и его целевыми пользователями и вариантами использования, являются участники ваших проверок доступа.

1. Выполнение проверки доступа включает в себя получение разрешений на доступ к приложениям пользователям, которым больше не требуется доступ. Планируйте обработку потенциальных запросов в службу поддержки от запрещенных пользователей. Удаленный пользователь останется в Azure AD в течение 30 дней, в течение которого они могут быть восстановлены администратором при необходимости. По истечении 30 дней пользователь будет окончательно удален. С помощью портала Azure Active Directory глобальный администратор может явно удалить недавно удаленного пользователя до наступления этого периода времени.

### <a name="plan-auditing"></a>Аудит плана

Azure AD предоставляет [отчеты с техническими сведениями и бизнес-аналитикой](https://azure.microsoft.com/documentation/articles/active-directory-view-access-usage-reports/). 

Доступны отчеты о безопасности и активности. В отчетах о безопасности отображаются пользователи, помеченные для риска, и рискованные входы в систему. Отчеты об активности помогают понять поведение пользователей в Организации за счет подробной информации о действиях входа и предоставления следов аудита всех имен входа. Отчеты можно использовать для управления рисками, повышения производительности и мониторинга соответствия.

| Тип отчета | Проверка доступа | Отчеты о безопасности | Отчет о входе |
|-------------|---------------|------------------|----------------|
| Используйте для проверки | Разрешения и использование приложения. | Потенциально скомпрометированные учетные записи | Кто получает доступ к приложениям |
| Возможные действия | Аудит доступа; отозвать разрешения | Отозвать доступ; принудительный сброс параметров безопасности | Запретить доступ |

Azure AD позволяет хранить данные аудита в течение 30 дней и предоставляет доступ к этим данным через портал администрирования Azure или через API для загрузки в системы анализа.

### <a name="consider-using-microsoft-cloud-application-security"></a>Попробуйте использовать Microsoft Cloud безопасность приложений

Microsoft Cloud App Security (МКАС) — это решение брокера безопасности для облака (КАСБ). Он предоставляет сведения о облачных приложениях и службах, предоставляет сложную аналитику для определения и борьбы с киберугроз, а также позволяет управлять передачей данных.

Развертывание МКАС позволяет:

- Используйте Cloud Discovery для отображения и обнаружения облачной среды и облачных приложений, используемых вашей организацией.
- Санкционирование и отмена санкционирования приложений в облаке
- Используйте удобные для развертывания соединители приложений, использующие API-интерфейсы поставщика, для отображения и управления приложениями, к которым вы подключаетесь.
- Используйте Управление условным доступом к приложениямную защиту, чтобы получить представление о доступе и действиях в облачных приложениях в режиме реального времени
- Обеспечивает непрерывное управление путем настройки, а затем непрерывной точной настройки политик.

Управление сеансом Microsoft Cloud Application Security (МКАС) доступно для любого браузера на любой основной платформе в любой операционной системе. Мобильные приложения и классические приложения также могут быть заблокированы или разрешены. С помощью встроенной интеграции с Azure AD можно поддерживать любые приложения, настроенные с помощью SAML, или приложения Open ID Connect с единым входом в Azure AD, включая [несколько популярных приложений](https://docs.microsoft.com/cloud-app-security/proxy-intro-aad).

Дополнительные сведения о МКАС см. в разделе [Общие сведения о Microsoft Cloud App Security](https://docs.microsoft.com/cloud-app-security/what-is-cloud-app-security). МКАС — это служба подписки на основе пользователей. Сведения о лицензировании можно посмотреть в [таблице лицензирования МКАС](https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RE2NXYO).

### <a name="use-conditional-access"></a>Использование условного доступа

С помощью условного доступа вы можете автоматизировать решения по управлению доступом на основе критериев для облачных приложений.

Политики условного доступа применяются после того, как пользователь прошел однофакторную аутентификацию. Таким образом, условный доступ не предназначен для защиты первой строки в таких сценариях, как атаки типа "отказ в обслуживании" (DoS), но может использовать сигналы этих событий для определения доступа. Например, можно использовать уровень риска входа, расположение запроса и т. д. Дополнительные сведения об условном доступе см. [в разделе Обзор](https://docs.microsoft.com/azure/active-directory/conditional-access/plan-conditional-access) и [план развертывания](https://docs.microsoft.com/azure/active-directory/conditional-access/plan-conditional-access).

## <a name="azure-sso-technical-requirements"></a>Технические требования для единого входа Azure

В следующем разделе описаны требования для настройки конкретного приложения, включая необходимые среды, конечные точки, сопоставление утверждений, обязательные атрибуты, сертификаты и используемые протоколы. Эти сведения понадобятся вам для настройки единого входа на [портале Azure AD](https://portal.azure.com/).

### <a name="authentication-mechanism-details"></a>Сведения о механизме проверки подлинности

Для всех предварительно интегрированных приложений SaaS Корпорация Майкрософт предоставляет учебник, и вам не понадобятся эти сведения. Если приложение не входит в магазин приложений или коллекцию, может потребоваться выполнить собираются следующие фрагменты данных:

- **Текущий поставщик удостоверений, применяемый приложением для единого входа,** например: AD FS, PingFederate, Okta
- **Протоколы, поддерживаемые целевым приложением** , например SAML 2,0, OpenID Connect Connect, OAuth, auth на основе форм, WS-подача, WS-Trust
- **Протокол, настраиваемый с помощью Azure AD** , например SAML 2,0 или 1,1, OpenID Connect Connect, OAuth, на основе форм, WS-подача

### <a name="attribute-requirements"></a>Требования к атрибутам

Существует предварительно настроенный набор атрибутов и сопоставлений атрибутов между объектами пользователей Azure AD и объектами пользователей приложения SaaS. Некоторые приложения управляют другими типами объектов, такими как группы. Спланируйте сопоставление атрибутов пользователей из Azure AD с приложением и [Настройте сопоставление атрибутов по умолчанию](https://docs.microsoft.com/azure/active-directory/manage-apps/customize-application-attributes) в соответствии с потребностями вашего бизнеса.

### <a name="certificate-requirements"></a>Требования к сертификатам

Сертификат для приложения должен быть обновлен, или существует риск, что пользователи не смогут получить доступ к приложению. Большинство сертификатов приложений SaaS хорошо подходит для 36 месяцев. Вы изменяете длительность сертификата в колонке приложения. Обязательно задокументируйте срок действия и Узнайте, как вы будете управлять продлением сертификата. 

Существует два способа управления сертификатами. 

- **Автоматическая смена сертификатов** — Майкрософт поддерживает [смену ключей подписывания в Azure AD](https://docs.microsoft.com/azure/active-directory/develop/active-directory-signing-key-rollover). Хотя это предпочтительный способ управления сертификатами, не все независимые поставщики программного обеспечения поддерживают этот сценарий.

- **Ручное обновление** — каждое приложение имеет свой собственный сертификат, срок действия которого истекает в зависимости от того, как он определен. До истечения срока действия сертификата приложения создайте новый сертификат и отправьте его поставщику программного обеспечения. Эти сведения можно извлечь из метаданных федерации. [Дополнительные сведения о метаданных федерации см. здесь.](https://docs.microsoft.com/azure/active-directory/develop/active-directory-federation-metadata)

## <a name="implement-sso"></a>Реализация единого входа

Для планирования и развертывания решения в Организации используйте следующие этапы.

### <a name="user-configuration-for-sso"></a>Конфигурация пользователя для единого входа

- **Поиск тестовых пользователей**

   Обратитесь к владельцу приложения и попросите его создать как минимум трех тестовых пользователей в приложении. Убедитесь, что сведения, которые будут использоваться в качестве основного идентификатора, заполнены правильно и соответствуют атрибуту, доступному в Azure AD. В большинстве случаев это будет сопоставлено с "NameID" для приложений на основе SAML. Для токенов JWT это «preferred_username».
   
   Создайте пользователя в Azure AD вручную в качестве облачного пользователя или синхронизируйте пользователя из локальной среды с помощью модуля синхронизации Azure AD Connect. Убедитесь, что сведения соответствуют утверждениям, отправляемым в приложение.

- **Настройка единого входа**

   В [списке приложений](https://docs.microsoft.com/azure/active-directory/active-directory-saas-tutorial-list)найдите и откройте учебник по SSO для своего приложения, а затем следуйте инструкциям этого руководства, чтобы успешно настроить приложение SaaS.

   Если не удается найти приложение, см. [документацию по пользовательскому приложению](https://docs.microsoft.com/azure/active-directory/application-config-sso-how-to-configure-federated-sso-non-gallery). Это поможет вам добавить приложение, которое не находится в коллекции Azure AD.

   При необходимости можно использовать утверждения, выданные в токене SAML для корпоративного приложения, с помощью [документации по Microsoft](https://docs.microsoft.com/azure/active-directory/active-directory-claims-mapping). Убедитесь, что эта карта сопоставлена с тем, что вы ожидаете получить в ответе SAML для вашего приложения. При возникновении проблем во время настройки воспользуйтесь нашим руководством по [отладке интеграции единого входа](https://docs.microsoft.com/azure/active-directory/develop/active-directory-saml-debugging).

Настраиваемое подключение приложений — это компонент лицензий Azure AD Premium P1 или P2.

### <a name="provide-sso-change-communications-to-end-users"></a>Предоставление пользователям связи изменения единого входа для конечных пользователей

Реализуйте свой план взаимодействия. Убедитесь, что вы знаете, что ваши конечные пользователи узнают о том, что ожидается изменение, когда оно приступит, что делать сейчас и как искать помощь.

### <a name="verify-end-user-scenarios-for-sso"></a>Проверка сценариев конечных пользователей на единый вход

Следующие тестовые случаи можно использовать для проведения тестов на корпоративных и личных устройствах, чтобы убедиться, что конфигурации единого входа работают правильно. В приведенных ниже сценариях предполагается, что пользователь переходит по URL-адресу приложения и проходит проверку подлинности, инициированную поставщиком услуг (потоком аутентификации, инициированной с помощью пакета обновления).

| Сценарий | Ожидаемый результат для потока проверки подлинности, инициированного пользователем |
|----------|---------------------------------------------------|
| Войдите в приложение с помощью IE во время работы в корпоративной сети. | Встроенная проверка подлинности Windows (IWA) не имеет дополнительных запросов. |
| Войдите в приложение с помощью IE, пока не найдетесь в корпоративной сети с новой попыткой входа. | Запрос на основе форм на AD FS Server. Пользователь успешно входит в систему и запрашивает MFA в браузере. |
| Войдите в приложение с помощью IE, пока не найдетесь в корпоративной сети с текущим сеансом и ни разу не выполнили MFA. | Пользователь не получает запрос на первый фактор. Пользователь получает запрос на MFA. |
| Войдите в приложение с помощью IE, пока не найдетесь в корпоративной сети с текущим сеансом и уже выполнили MFA в этом сеансе. | Пользователь не получает запрос на первый фактор. Пользователь не получает MFA. Пользователь ССОС в приложение. |
| Войдите в приложение с помощью Chrome, Firefox или Safari, пока не найдетесь в корпоративной сети с текущим сеансом и уже выполнили MFA в этом сеансе. | Пользователь не получает запрос на первый фактор. Пользователь не получает MFA. Единый вход пользователя в приложение. |
| Войдите в приложение с помощью Chrome, Firefox или Safari, пока не найдетесь в корпоративной сети с новой попыткой входа. | Запрос на основе форм на AD FS Server. Пользователь успешно входит в систему и запрашивает MFA в браузере. |
| Войдите в приложение с помощью Chrome/Firefox в корпоративной сети с текущим сеансом. | Пользователь не получает запрос на первый фактор. Пользователь не получает MFA. Единый вход пользователя в приложение. |
| Войдите в приложение с мобильным приложением приложения с новой попыткой входа. | Запрос на основе форм на AD FS Server. Пользователь успешно входит в систему и запрашивает MFA клиента ADAL. |
| Неавторизованный пользователь пытается войти в приложение с помощью URL-адреса для входа. | Запрос на основе форм на AD FS Server. Пользователю не удается войти с использованием первого фактора. |
| Полномочный пользователь пытается войти в систему, но вводит неверный пароль. | Пользователь переходит к URL-адресу приложения и получает неправильную ошибку имени пользователя или пароля. |
| Авторизованный пользователь щелкает ссылку в сообщении электронной почты и уже прошел проверку подлинности. | Пользователь щелкает URL-адрес и подписывается в приложение без дополнительных запросов. |
| Авторизованный пользователь щелкает ссылку в сообщении электронной почты и еще не прошел проверку подлинности. | Пользователь щелкает URL-адрес и запрашивает проверку подлинности с использованием первого фактора. |
| Полномочный пользователь входит в приложение с помощью мобильного приложения приложения (инициируется с помощью пакета обновления) с новой попыткой входа. | Запрос на основе форм на AD FS Server. Пользователь успешно входит в систему и запрашивает MFA клиента ADAL. |
| Неавторизованный пользователь пытается войти в приложение с помощью URL-адреса входа (инициированного поставщиком услуг). | Запрос на основе форм на AD FS Server. Пользователю не удается войти с использованием первого фактора. |
| Полномочный пользователь пытается войти в систему, но вводит неверный пароль.| Пользователь переходит к URL-адресу приложения и получает неправильную ошибку имени пользователя или пароля. |
| Полномочный пользователь входит в систему, а затем снова входит в систему. | Если URL-адрес выхода настроен, пользователь выходит из всех служб и предлагает выполнить проверку подлинности. |
| Полномочный пользователь входит в систему, а затем снова входит в систему. | Если URL-адрес выхода не настроен, пользователь будет автоматически входить в систему с использованием существующего маркера из существующего сеанса браузера Azure AD. |
| Авторизованный пользователь щелкает ссылку в сообщении электронной почты и уже прошел проверку подлинности. | Пользователь щелкает URL-адрес и подписывается в приложение без дополнительных запросов. |
| Авторизованный пользователь щелкает ссылку в сообщении электронной почты и еще не прошел проверку подлинности. | Пользователь щелкает URL-адрес и запрашивает проверку подлинности с использованием первого фактора. |

## <a name="manage-sso"></a>Управление единым входом

В этом разделе описаны требования и рекомендации для успешного управления единым входом.

### <a name="required-administrative-roles"></a>Обязательные административные роли

Всегда используйте роль с минимальными разрешениями, доступными для выполнения требуемой задачи в Azure Active Directory. Корпорация Майкрософт рекомендует [ознакомиться с различными доступными ролями](https://docs.microsoft.com/azure/active-directory/active-directory-assign-admin-roles-azure-portal) и выбрать нужную из них, чтобы удовлетворить потребности каждого персонажа для этого приложения. Некоторые роли, возможно, потребуется временно применить и удалить после завершения развертывания.

| Описания| Роли | Роль Azure AD (при необходимости) |
|--------|-------|-----------------------------|
| Администратор службы поддержки | Поддержка уровня 1 | Отсутствуют |
| Администратор удостоверений | Настройка и отладка при проблемах, влияющих на Azure AD | Глобальный администратор |
| Администратор приложения | Аттестация пользователей в приложении, Настройка для пользователей с разрешениями | Отсутствуют |
| Администраторы инфраструктуры | Владелец смены сертификата | Глобальный администратор |
| Владелец или заинтересованный бизнес | Аттестация пользователей в приложении, Настройка для пользователей с разрешениями | Отсутствуют |

Для управления ролями рекомендуется использовать [Управление привилегированными пользователями](https://docs.microsoft.com/azure/active-directory/active-directory-privileged-identity-management-configure) (PIM), чтобы обеспечить дополнительный аудит, контроль и проверку доступа для пользователей с разрешениями каталога.

### <a name="sso-certificate-lifecycle-management"></a>Управление жизненным циклом сертификатов единого входа

Важно выделить нужные роли и списки рассылки электронной почты с помощью управления жизненным циклом сертификата для подписи между Azure AD и приложением, которое настроено с помощью единого входа. Ниже приведены некоторые ключевые роли, которые мы рекомендуем использовать.

- Владелец для обновления свойств пользователя в приложении
- Владелец по требованию для поддержки прерываний и исправлений приложений
- Тесно отслеживаемый список рассылки электронной почты для уведомлений об изменениях, связанных с сертификатами

Максимальное время существования сертификата составляет три года. Рекомендуется установить процесс обработки изменения сертификата между Azure AD и приложением. Это может помочь предотвратить или уменьшить сбой из-за истечения срока действия сертификата или принудительного переключения сертификата.

### <a name="rollback-process"></a>Процесс отката

После завершения тестирования на основе тестовых случаев пора перейти в рабочую среду с помощью приложения. Переход в рабочую среду означает, что вы примените запланированные и протестированные конфигурации в рабочем клиенте и сделаете их пользователям. Однако важно спланировать, что делать в случае, если развертывание не будет запланировано. Если во время развертывания происходит сбой настройки единого входа, необходимо понимать, как уменьшить вероятность сбоя и снизить влияние на пользователей.

Доступность методов проверки подлинности в приложении будет определять оптимальную стратегию. Всегда Изучите подробную документацию для владельцев приложений, чтобы точно вернуться к исходному состоянию имени входа в случае возникновения проблем в развертывании.

- **Если приложение поддерживает несколько поставщиков удостоверений**, например LDAP и AD FS и ping, не удаляйте существующую конфигурацию единого входа во время развертывания. Вместо этого отключите его во время миграции на случай, если потребуется переключить его позже. 

- **Если приложение не поддерживает несколько поставщиков удостоверений** , но позволяет пользователям входить в систему, используя проверку подлинности на основе форм (имя пользователя и пароль), убедитесь, что пользователи могут вернуться к этому подходу на случай сбоя развертывания новой конфигурации единого входа.

### <a name="access-management"></a>управление доступом

Рекомендуется выбирать масштабируемый подход при управлении доступом к ресурсам. В число распространенных подходов входит использование локальных групп путем синхронизации через Azure AD Connect, [Создание динамических групп в Azure AD на основе атрибутов пользователя](https://docs.microsoft.com/azure/active-directory/active-directory-groups-dynamic-membership-azure-portal)или создание [групп самообслуживания](https://docs.microsoft.com/azure/active-directory/active-directory-accessmanagement-self-service-group-management) в Azure AD, управляемых владельцем ресурса.

### <a name="monitor-security"></a>Мониторинг безопасности

Рекомендуется настроить обычную ритмичность, в которой вы просматриваете различные аспекты безопасности приложений SaaS и выполняете все необходимые действия по исправлению.

### <a name="troubleshooting"></a>Устранение неполадок

Следующие ссылки представляют собой сценарии устранения неполадок. Вам может потребоваться создать конкретное руководство для персонала службы поддержки, включающего в себя эти сценарии, и действия по их устранению.

#### <a name="consent-issues"></a>Вопросы согласия

- [Непредвиденная ошибка согласия](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-unexpected-user-consent-prompt)

- [Ошибка при предоставлении согласия пользователем](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-unexpected-user-consent-error)

#### <a name="sign-in-issues"></a>Проблемы при входе

- [Проблемы при входе с пользовательского портала](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-other-problem-deeplink)

- [Проблемы при входе с панели доступа](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-other-problem-access-panel)

- [Ошибка на странице входа в приложение](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-problem-application-error)

- [Проблема при входе в приложение Майкрософт](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-problem-first-party-microsoft)

#### <a name="sso-issues-for-applications-listed-in-the-azure-application-gallery"></a>Проблемы единого входа для приложений, перечисленных в коллекции приложений Azure

- [Проблема с входом в службу единого входа для приложений, перечисленных в коллекции приложений Azure](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-problem-password-sso-gallery) 

- [Проблема с федеративным SSO для приложений, перечисленных в коллекции приложений Azure](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-problem-federated-sso-gallery)   

#### <a name="sso-issues-for-applications-not-listed-in-the-azure-application-gallery"></a>Проблемы единого входа для приложений, не перечисленных в коллекции приложений Azure

- [Проблема с ВХОДом паролей для приложений, не перечисленных в коллекции приложений Azure](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-problem-password-sso-non-gallery) 

- [Проблема с федеративным SSO для приложений, не перечисленных в коллекции приложений Azure](https://docs.microsoft.com/azure/active-directory/manage-apps/application-sign-in-problem-federated-sso-non-gallery)

## <a name="next-steps"></a>Следующие шаги

[Отладка единого входа на основе SAML](https://docs.microsoft.com/azure/active-directory/develop/active-directory-saml-debugging)

[Сопоставление утверждений для приложений с помощью PowerShell](https://docs.microsoft.com/azure/active-directory/active-directory-claims-mapping)

[Настройка утверждений, выданных в токене SAML](https://docs.microsoft.com/azure/active-directory/develop/active-directory-saml-claims-customization)

[Протокол SAML единого входа](https://docs.microsoft.com/azure/active-directory/develop/active-directory-single-sign-on-protocol-reference)

[Протокол единого выхода SAML](https://docs.microsoft.com/azure/active-directory/develop/active-directory-single-sign-out-protocol-reference)

[Azure AD B2B](https://docs.microsoft.com/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b) (для внешних пользователей, таких как партнеры и поставщики)

[Условный доступ Azure AD](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-azure-portal)

[Защита идентификации Azure](https://docs.microsoft.com/azure/active-directory/active-directory-identityprotection)

[Доступ с единым входом](https://docs.microsoft.com/azure/active-directory/active-directory-appssoaccess-whatis)

[Руководство по единому входу в приложение](https://docs.microsoft.com/azure/active-directory/saas-apps/tutorial-list)
