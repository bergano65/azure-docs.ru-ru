---
title: Настройка единого входа в Azure Active Directory | Документация Майкрософт
description: В этом руководстве показано, как с помощью портала Azure настроить единый вход на основе SAML для приложения в Azure Active Directory (Azure AD).
services: active-directory
author: CelesteDG
manager: mtillman
ms.service: active-directory
ms.subservice: app-mgmt
ms.topic: tutorial
ms.workload: identity
ms.date: 04/08/2019
ms.author: celested
ms.reviewer: arvinh,luleon
ms.collection: M365-identity-device-management
ms.openlocfilehash: a3d96799e69e2fdef3a4ffd1a436727e6a58da79
ms.sourcegitcommit: b8a8d29fdf199158d96736fbbb0c3773502a092d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/15/2019
ms.locfileid: "59565994"
---
# <a name="tutorial-configure-saml-based-single-sign-on-for-an-application-with-azure-active-directory"></a>Руководство. Настройка единого входа на основе SAML для приложения в Azure Active Directory

В этом руководстве показано, как с помощью [портала Azure](https://portal.azure.com) настроить единый вход на основе SAML для приложения в Azure Active Directory (Azure AD). Используйте это руководство, когда [руководство для конкретного приложения](../saas-apps/tutorial-list.md) недоступно. 

В этом руководстве портал Azure используется для таких целей:

> [!div class="checklist"]
> * Выбор режима единого входа на основе SAML
> * Настройка домена и URL-адресов для конкретного приложения
> * Настройка атрибутов пользователя
> * Создание сертификата подписи SAML
> * Назначение пользователей для приложения
> * Настройка приложения для единого входа на основе SAML
> * Проверка параметров SAML

## <a name="before-you-begin"></a>Перед началом работы

1. Если приложение еще не было добавлено в клиент Azure AD, ознакомьтесь со статьей [Краткое руководство. Добавление приложения в клиент Azure Active Directory](add-application-portal.md).

2. Запросите у поставщика приложения данные, описанные в разделе [Настройка основных параметров SAML](#configure-basic-saml-options).

3. Не используйте рабочую среду для тестирования шагов в этом руководстве. Если у вас нет нерабочей среды Azure AD, можно [получить пробную версию на один месяц](https://azure.microsoft.com/pricing/free-trial/).

4. Войдите на [портал Azure](https://portal.azure.com) в качестве администратора облачных приложений или администратора приложения для клиента Azure AD.

## <a name="select-a-single-sign-on-mode"></a>Выбор режима единого входа

Добавив приложение в клиент Azure AD, вы сможете настроить единый вход для приложения.

Чтобы открыть параметры единого входа, сделайте следующее:

1. На [портале Azure](https://portal.azure.com) в области навигации слева выберите **Azure Active Directory**. 

2. В разделе **Управление** на открывшейся навигационной панели **Azure Active Directory** выберите **Корпоративные приложения**. Вы увидите случайную выборку приложений, размещенных в арендаторе Azure AD. 

3. В меню **Тип приложения** выберите **Все приложения** и щелкните **Применить**.

4. Укажите имя приложения, для которого необходимо настроить единый вход. Например, здесь можно выбрать **GitHub-test**, чтобы настроить приложение, которое было добавлено с помощью [этого краткого руководства](add-application-portal.md).  

     ![Снимок экрана с панелью поиска приложения.](media/configure-single-sign-on-portal/azure-portal-application-search.png)

5. Выберите приложение, для которого нужно настроить единый вход.

6. В разделе **Управление** щелкните **Единый вход**. 

7. Выберите **SAML**, чтобы настроить единый вход. Откроется страница **Настройка единого входа с помощью SAML**.

## <a name="configure-basic-saml-options"></a>Настройка основных параметров SAML

Для настройки домена и URL-адресов сделайте следующее:

1. Обратитесь к поставщику приложения, чтобы получить правильные данные для следующих параметров:

    | Параметр конфигурации | Инициированный поставщиком услуг | Инициированный поставщиком удостоверений | ОПИСАНИЕ |
    |:--|:--|:--|:--|
    | Идентификатор (идентификатор сущности) | Требуется для некоторых приложений | Требуется для некоторых приложений | Однозначно определяет приложение, для которого выполняется настройка единого входа. Azure AD отправляет идентификатор в приложение в качестве параметра "Аудитория" токена SAML. Приложение должно проверить его. Это значение также отображается как идентификатор сущности во всех метаданных SAML, предоставленных приложением.|
    | URL-адрес ответа | Необязательно | Обязательно | Этот параметр указывает место, где приложение ожидает токен SAML. URL-адрес ответа также называется URL-адресом службы обработчика утверждений (ACS). |
    | URL-адрес входа | Обязательно | Не указывайте | Когда пользователь открывает этот URL-адрес, поставщик услуг выполняет перенаправление в Azure AD для аутентификации и входа пользователя в систему. Azure AD использует URL-адрес, чтобы запустить приложение из Office 365 или на панели доступа Azure AD. Если это поле пустое, Azure AD полагается на поставщика удостоверений, который инициирует единый вход, когда пользователь запускает приложение.|
    | Состояние ретранслятора | Необязательно | Необязательно | Указывает приложению, куда перенаправить пользователя после аутентификации. Обычно здесь указывается допустимый URL-адрес приложения. Но некоторые приложения используют это поле по-другому. Чтобы получить дополнительные сведения, обратитесь к поставщику приложения.
    | URL-адрес выхода. | Необязательно | Необязательно | Используется для отправки приложению ответов при завершении сеанса SAML.


2. Чтобы изменить основные параметры конфигурации SAML, выберите значок **Изменить** (карандаш) в правом верхнем углу раздела **Базовая конфигурация SAML**.

     ![Настройка сертификатов](media/configure-single-sign-on-portal/basic-saml-configuration-edit-icon.png)

3. В соответствующие поля на этой странице введите сведения, предоставленные поставщиком приложения на шаге 1.

4. В верхней части страницы щелкните **Сохранить**.

## <a name="configure-user-attributes-and-claims"></a>Настройка атрибутов пользователя и утверждений 

Вы можете выбирать, какие сведения Azure AD отправляет приложению в токене SAML каждый раз, когда пользователь входит в систему. Для изменения этой информации можно настроить пользовательские атрибуты. Например, Azure AD может отправлять в приложение при входе пользователя имя этого пользователя, адрес электронной почты и идентификатор сотрудника. 

Для надлежащей работы единого выхода эти атрибуты могут быть обязательными или необязательными. Чтобы получить дополнительные сведения, см. [руководство по конкретному приложению](../saas-apps/tutorial-list.md) или обратитесь к поставщику приложения.

1. Чтобы изменить атрибуты пользователя и утверждения, выберите значок **Изменить** (карандаш) в правом верхнем углу раздела **Атрибуты пользователя и утверждения**.

   **Значение идентификатора имени** принимает значение по умолчанию *user.principalname*. Идентификатор пользователя является уникальным идентификатором для каждого пользователя в приложении. Например, если адрес электронной почты является и именем пользователя, и уникальным идентификатором, задайте значение *user.mail*.

2. Чтобы изменить **значение идентификатора имени**, щелкните значок **Изменить** (карандаш) рядом с полем **Значение идентификатора имени**. Если потребуется, внесите соответствующие изменения в формат идентификатора и источник. Сохраните изменения, когда все будет готово. Дополнительные сведения об изменении утверждений см. в [практическом руководстве по настройке утверждений, выпускаемых в токене SAML для корпоративных приложений](../develop/active-directory-saml-claims-customization.md).

3. Чтобы добавить утверждение, щелкните **Добавить новое утверждение** в верхней части страницы. Введите **Имя** и выберите соответствующий источник. Если вы выберете источник **Атрибут**, следует выбрать требуемый **Атрибут источника**. Если вы выберете источник **Перевод**, следует выбрать требуемые значения параметров **Преобразование** и **Параметр 1**.

4. Щелкните **Сохранить**. В таблице появится новое утверждение.
 
## <a name="generate-a-saml-signing-certificate"></a>Создание сертификата для подписи SAML

Azure AD использует сертификат для подписи токенов SAML, отправляемых в приложение. 

1. Чтобы создать новый сертификат, щелкните значок **Изменить** (карандаш) в правом верхнем углу раздела **Сертификат подписи SAML**.

2. В разделе **Сертификат подписи SAML** выберите **Новый сертификат**.

3. Отобразится новая строка сертификата. Укажите в ней **дату окончания срока действия**. Дополнительные сведения о доступных параметрах конфигурации см. в статье [о расширенных параметрах подписывания сертификата](certificate-signing-options.md).

4. Щелкните **Сохранить** в верхней части раздела **Сертификат подписи SAML**. 

## <a name="assign-users-to-the-application"></a>Назначение пользователей для приложения

Перед развертыванием приложения в организации будет полезно протестировать единый вход на нескольких отдельных пользователях или группах.

> [!NOTE]
>
> Эти действия приведут вас в раздел настройки **пользователей и групп** на портале. Закончив эту настройку, вернитесь к разделу **Единый вход**, чтобы завершить работу с этим руководством.

Чтобы назначить пользователя или группу приложению, сделайте следующее:

1. Откройте приложение на портале, если оно еще не открыто.
2. На панели навигации для приложения выберите элемент **Пользователи и группы**.
3. Выберите **Добавить пользователя**.
4. В разделе **Добавление назначения** щелкните **Пользователи и группы**.
5. Чтобы найти конкретного пользователя, введите его имя пользователя в поле **Выберите участника или пригласите внешнего пользователя**. Затем выберите профиль или логотип из профиля пользователя и щелкните **Выбрать**. 
6. В области **Добавление назначения** щелкните **Назначить**. Когда процесс завершится, выбранные пользователи появятся в списке **Пользователи и группы**.

## <a name="set-up-the-application-to-use-azure-ad"></a>Настройка использования Azure AD в приложении

Осталось совсем немного.  На последнем этапе вы настроите в приложении использование Azure AD в качестве поставщика удостоверений SAML. 

1. Прокрутите вниз до раздела **Настройка <applicationName>**. В этом руководстве этот раздел называется **Настройка GitHub-test**. 
2. Скопируйте значение из каждой строки этого раздела. Теперь вставьте все эти значения в соответствующие строки в разделе **Базовая конфигурация SAML**. Например, скопируйте значение **URL-адрес входа** из раздела **Настройка GitHub-test** и вставьте его в поле **URL-адрес для входа** в разделе **Базовая конфигурация SAML** и т. д.
3. Завершив перенос значений в нужные поля, щелкните **Сохранить**.

## <a name="test-single-sign-on"></a>Проверка единого входа

Все готово для тестирования параметров.  

1. Откройте параметры единого входа для приложения. 
2. Прокрутите страницу до раздела **Validate single sign-on with <applicationName>** (Проверка единого входа с помощью). В этом руководстве этот раздел называется **Настройка GitHub-test**.
3. Выберите **Тест**. Отобразятся параметры тестирования.
4. Выберите **Войдите от имени текущего пользователя**. Этот тест позволит сначала увидеть, работает ли единый вход для вас как для администратора.

Если возникнет ошибка, появится сообщение об ошибке. Затем сделайте следующее:

1. Скопируйте и вставьте сведения об ошибке в поле **Как выглядит ошибка**.

    ![Получение рекомендаций по устранению](media/configure-single-sign-on-portal/error-guidance.png)

2. Щелкните **Получить рекомендации по устранению**. Отобразятся сведения о причине ошибки и рекомендации по ее устранению.  В этом примере пользователь не был назначен приложению.

3. Прочтите рекомендации по разрешению и устраните проблему, если возможно.

4. Выполните проверку еще раз, чтобы она завершилась успешно.

## <a name="next-steps"></a>Дополнительная информация
В этом руководстве вы настроили параметры единого входа для приложения. По завершении настройки вы назначили пользователя приложению и настроили приложение для использования единого входа на основе SAML. После этого вы выполнили проверку и убедились, что вход SAML работает надлежащим образом.

Вы выполнили такие действия:
> [!div class="checklist"]
> * выбор SAML для режима единого входа;
> * подключение к поставщику приложения, чтобы настроить домены и URL-адреса;
> * настройка атрибутов пользователя;
> * создание сертификата подписи SAML;
> * назначение вручную пользователей и групп для приложения;
> * настройка приложения для использования Azure AD в качестве поставщика удостоверений SAML;
> * тестирование единого входа на основе SAML.

Чтобы развернуть приложение для других пользователей в вашей организации, примените автоматическую подготовку пользователей.

> [!div class="nextstepaction"]
> [Сведения о назначении пользователей с автоматической подготовкой](configure-automatic-user-provisioning-portal.md)


