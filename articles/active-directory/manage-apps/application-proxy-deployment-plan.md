---
title: Планирование развертывания Azure Active Directory Application Proxy
description: Полное пошаговое планирование развертывания прокси приложения в Организации
services: active-directory
documentationcenter: azure
author: barbaraselden
manager: CelesteDG
ms.assetid: ''
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 04/04/2019
ms.author: baselden
ms.reviewer: ''
ms.openlocfilehash: cd19d1e0cdfa1b160734b23d7f50310948ded80d
ms.sourcegitcommit: aa042d4341054f437f3190da7c8a718729eb675e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/09/2019
ms.locfileid: "68879914"
---
# <a name="plan-an-azure-ad-application-proxy-deployment"></a>Планирование развертывания AD Application Proxy Azure

Azure Active Directory прокси приложения (Azure AD) — это безопасное и экономичное решение для удаленного доступа для локальных приложений. Он обеспечивает немедленный путь перехода для облачных (First) организаций для управления доступом к устаревшим локальным приложениям, которые еще не могут использовать современные протоколы. Дополнительные вводные сведения см. в статье [что такое прокси приложения](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy).

Прокси приложения рекомендуется использовать для предоставления удаленным пользователям доступа к внутренним ресурсам. Прокси приложения заменяет потребность в VPN или обратный прокси-сервер для этих вариантов использования удаленного доступа. Он не предназначен для пользователей, работающих в корпоративной сети. Эти пользователи, использующие прокси приложения для доступа к интрасети, могут столкнуться с нежелательными проблемами производительности.

Эта статья содержит ресурсы, необходимые для планирования, эксплуатации и управления AD Application Proxy Azure. 

## <a name="plan-your-implementation"></a>Планирование реализации

В следующем разделе представлено широкое представление ключевых элементов планирования, которые будут настроены для эффективной работы по развертыванию. 

### <a name="prerequisites"></a>предварительные требования

Прежде чем приступить к реализации, необходимо выполнить следующие предварительные требования. Дополнительные сведения о настройке среды, включая эти предварительные требования, можно найти в этом [руководстве](application-proxy-add-on-premises-application.md).

* **Соединители**: Соединители — это простые агенты, которые можно развернуть на:
   * Физическое оборудование в локальной среде
   * Виртуальная машина, размещенная в любом решении гипервизора
   * Виртуальная машина, размещенная в Azure, для обеспечения исходящего подключения к службе прокси приложения.

* Более подробный обзор см. в разделе Общие сведения о [соединителях Azure AD App прокси](application-proxy-connectors.md) .

     * Перед установкой соединителей на компьютерах соединителя необходимо [включить TLS 1,2](application-proxy-add-on-premises-application.md) .

     * По возможности разверните соединители в той [же сети](application-proxy-network-topology.md) и сегменте, что и серверные серверы веб-приложений. Рекомендуется развертывать соединители после завершения обнаружения приложений.
     * Для обеспечения высокой доступности и масштабирования в каждой группе соединителей рекомендуется использовать по крайней мере два соединителя. Наличие трех соединителей является оптимальным, если вам может потребоваться обслуживать компьютер в любой момент. Ознакомьтесь с [таблицей емкости соединителя](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy-connectors#capacity-planning) , чтобы определить тип компьютера, на котором следует установить соединители. Чем больше компьютер, тем больше буфер и будет выполняться соединитель.

* **Параметры сетевого доступа**: Соединители AD Application Proxy Azure подключаются [к Azure через HTTPS (TCP-порт 443) и HTTP (TCP-порт 80)](application-proxy-add-on-premises-application.md). 

   * Прерывание TLS-трафика соединителя не поддерживается и не позволит соединителям устанавливать защищенный канал с соответствующими конечными точками прокси приложения Azure.

   * Избегайте всех форм встроенной проверки исходящих соединений TLS между соединителями и Azure. Внутренняя проверка между соединителем и серверными приложениями возможна, но это может привести к снижению удобства работы пользователей, поэтому не рекомендуется.

   * Балансировка нагрузки самих соединителей также не поддерживается или даже не требуется.

### <a name="important-considerations-before-configuring-azure-ad-application-proxy"></a>Важные моменты, которые необходимо учесть перед настройкой AD Application Proxy Azure

Для настройки и реализации AD Application Proxy Azure необходимо соблюдение следующих основных требований.

*  **Адаптация Azure**: Перед развертыванием прокси приложения удостоверения пользователей должны быть синхронизированы из локального каталога или создаваться непосредственно в клиентах Azure AD. Синхронизация удостоверений позволяет Azure AD выполнить предварительную проверку подлинности пользователей до предоставления им доступа к опубликованным приложениям Application Proxy и получить сведения об идентификаторах пользователей для выполнения единого входа (SSO).

* **Требования к условному доступу**: Не рекомендуется использовать прокси приложения для доступа к интрасети, так как это увеличивает задержку, влияющую на пользователей. Рекомендуется использовать прокси приложения с политиками предварительной проверки подлинности и условного доступа для удаленного доступа из Интернета.  Подход к обеспечению условного доступа для использования в интрасети заключается в модернизировать приложений, чтобы они могли диретли проверку подлинности в AAD. Дополнительные сведения см. в разделе [ресурсы для переноса приложений в AAD](https://docs.microsoft.com/azure/active-directory/manage-apps/migration-resources) . 

* **Ограничения службы**: Для защиты от чрезмерного потребления ресурсов отдельными клиентами необходимо установить ограничения регулирования для каждого приложения и клиента. Сведения об этих ограничениях см. в статье ограничения [и ограничения службы Azure AD](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-service-limits-restrictions). Эти ограничения регулирования основаны на производительности, значительно превышающей объем типичного объема использования, и предоставляют буфер для большинства развертываний.

* **Общедоступный сертификат**: Если вы используете пользовательские доменные имена, необходимо приобрести Открытый сертификат, выданный доверенным центром сертификации, отличным от Майкрософт. В зависимости от требований Организации получение сертификата может занять некоторое время, и мы рекомендуем начать процесс как можно раньше. Прокси приложения Azure поддерживает стандартные, [подстановочные](application-proxy-wildcard.md)или сертификаты на основе SAN.

* **Требования к домену**: Для единого входа в опубликованные приложения с помощью ограниченного делегирования Kerberos (KCD) требуется, чтобы сервер, на котором работает соединитель, и сервер, на котором выполняется приложение, были присоединены к домену и принадлежать к одному домену или доверенным доменам.
Подробные сведения о данном разделе см. в разделе [KCD for единого входа](application-proxy-configure-single-sign-on-with-kcd.md) с помощью прокси приложения. Служба соединителя работает в контексте локальной системы и не должна быть настроена для использования настраиваемого удостоверения.

* **Записи DNS для URL-адресов**

   * Прежде чем использовать личные домены в прокси приложения, необходимо создать запись CNAME в общедоступной службе DNS, что позволяет клиентам разрешать пользовательскому заданному внешнему URL-адресу предварительно определенному прокси-серверу приложения. Если не создать запись CNAME для приложения, использующего личный домен, удаленные пользователи не смогут подключаться к приложению. Действия, необходимые для добавления записей CNAME, могут отличаться от поставщика DNS к поставщику, поэтому Узнайте, как [управлять записями и наборами записей DNS с помощью портал Azure](https://docs.microsoft.com/azure/dns/dns-operations-recordsets-portal).

   * Аналогичным образом узлы соединителей должны уметь разрешать внутренний URL-адрес публикуемых приложений.

* **Административные права и роли**

   * Для **установки соединителя** требуются права локального администратора для Windows Server, на котором она устанавливается. Кроме того, для проверки подлинности и регистрации экземпляра соединителя в клиенте Azure AD требуется как минимум роль *администратора приложения* . 

   * Для **публикации и администрирования приложений** требуется роль *администратора приложения* . Администраторы приложений могут управлять всеми приложениями в каталоге, включая регистрации, параметры единого входа, назначения пользователей и групп и лицензии, параметры прокси приложения и согласие. Она не предоставляет прав на управление условным доступом. Роль *администратора облачных приложений* обладает всеми возможностями администратора приложения, за исключением того, что она не позволяет управлять параметрами прокси приложения.

* **Лицензирование.** Прокси приложения доступен через подписку Azure AD Basic. Полный список вариантов лицензирования и функций см. на [странице цен на Azure Active Directory](https://azure.microsoft.com/pricing/details/active-directory/) .  

### <a name="application-discovery"></a>Обнаружение приложений

Скомпилируйте инвентаризацию всех приложений в области, публикуемых через прокси приложения, собрав следующие сведения:

| Тип сведений| Сведения для собраний |
|---|---|
| Тип службы| Пример: SharePoint, SAP, CRM, настраиваемое веб-приложение, API |
| Платформа приложений | Пример: Windows IIS, Apache в Linux, Tomcat, NGINX |
| Членство в домене| Полное доменное имя (FQDN) веб-сервера |
| Расположение приложения | Место расположения веб-сервера или фермы в вашей инфраструктуре |
| Внутренний доступ | Точный URL-адрес, используемый при внутреннем доступе к приложению. <br> Какой тип балансировки нагрузки используется для фермы? <br> Будет ли приложение рисовать содержимое из источников, отличных от самого себя.<br> Определите, работает ли приложение через WebSockets. |
| Внешний доступ | Решение поставщика, к которому приложение уже предоставляется извне. <br> URL-адрес, который вы хотите использовать для внешнего доступа. Если SharePoint, убедитесь, что для [этого руководства](https://docs.microsoft.com/SharePoint/administration/configure-alternate-access-mappings)настроены сопоставления альтернативного доступа. В противном случае необходимо будет определить внешние URL-адреса. |
| Общедоступный сертификат | Если используется личный домен, получите сертификат с соответствующим именем субъекта. Если сертификат существует, обратите внимание на серийный номер и расположение, откуда его можно получить. |
| Тип проверки подлинности| Тип проверки подлинности, поддерживаемый поддержкой приложения, такой как базовая, Windows Integration Authentication, основанная на формах, на основе заголовков и утверждения. <br>Если приложение настроено для работы с определенной учетной записью домена, запишите полное доменное имя учетной записи службы.<br> Если идентификатор и URL-адрес ответа основан на SAML. <br> Если на основе заголовков, решение поставщика и конкретные требования для обработки типа проверки подлинности. |
| Имя группы соединителей | Логическое имя для группы соединителей, которое будет назначено для передачи в это серверное приложение и единого входа. |
| Доступ пользователей и групп | Пользователи или группы пользователей, которым будет предоставлен внешний доступ к приложению. |
| Дополнительные требования | Обратите внимание на любые дополнительные требования к удаленному доступу или безопасности, которые следует проложить на публикацию приложения. |

Вы можете скачать [электронную таблицу инвентаризации приложений](https://aka.ms/appdiscovery) , чтобы выполнить инвентаризацию приложений.

### <a name="define-organizational-requirements"></a>Определение требований Организации

Ниже перечислены области, для которых необходимо определить бизнес-требования Организации. Каждая область содержит примеры требований

 **Access**

* Удаленные пользователи, присоединенные к домену или устройства, присоединенные к Azure AD, могут безопасно получать доступ к опубликованным приложениям с помощью простого единого входа (SSO).

* Удаленные пользователи с утвержденными личными устройствами могут безопасно получать доступ к опубликованным приложениям, если они зарегистрированы в MFA и зарегистрировали Microsoft Authenticatorное приложение на мобильном телефоне в качестве метода проверки подлинности.

**Контроль** 

* Администраторы могут определять и отслеживать жизненный цикл назначений пользователей для приложений, опубликованных через прокси приложения.

**Безопасность**

* Только пользователи, назначенные приложениям через членство в группе или по отдельности, могут получить доступ к этим приложениям.

**Производительность**

* По сравнению с доступностью приложения из внутренней сети не происходит ухудшения производительности приложения.

**Взаимодействие с пользователем**

* Пользователи знают, как получить доступ к своим приложениям, используя знакомые URL-адреса Организации на любой платформе устройств.

**Аудит**
* Администраторы могут выполнять аудит действий доступа пользователей.


### <a name="best-practices-for-a-pilot"></a>Рекомендации по пилотному развертыванию

Определите время и усилия, необходимые для полной Комиссии одного приложения для удаленного доступа с помощью единого входа (SSO). Это можно сделать, запустив пилотный проект, который считает его первоначальным обнаружением, публикацией и общим тестированием. Использование простого веб-приложения на основе IIS, уже предварительно настроенного для встроенной проверки подлинности Windows (IWA), поможет установить базовые показатели, так как эта настройка требует минимальных усилий для успешного развертывания удаленного доступа и единого входа.

Следующие элементы проектирования должны повышать успешное выполнение пилотной реализации непосредственно в рабочем клиенте.  

**Управление соединителем**:  

* Соединители играют ключевую роль в предоставлении локального программного обеспечения для работы с приложениями. Использование группы соединителей **по умолчанию** подходит для первоначального пилотного тестирования опубликованных приложений перед их переводом в рабочую среду. Успешно протестированные приложения можно переместить в группы производственных соединителей.

**Управление приложениями**:

* Скорее всего, ваш труд может запомнить внешний URL-адрес. Избегайте публикации приложения с помощью предварительно определенных суффиксов msappproxy.net или onmicrosoft.com. Вместо этого предоставьте привычный проверенный домен верхнего уровня с префиксом логического имени узла, например *Intranet. < customers_domain >. com*.

* Ограничение видимости значка пилотного приложения до пилотной группы путем скрытия значка запуска на портале Azure MyApps. При подготовке к производству можно ограничить область приложения соответствующей целевой аудиторией либо в том же подготовительном клиенте, либо путем публикации приложения в рабочем клиенте.

**Параметры единого входа**: Некоторые параметры единого входа имеют определенные зависимости, для настройки которых может потребоваться время, поэтому следует избегать задержки управления изменениями, гарантируя, что зависимости будут устранены заранее. К ним относятся узлы соединителей, присоединяющиеся к домену, для выполнения единого входа с помощью ограниченного делегирования Kerberos (KCD) и других операций, требующих много времени. Например, при необходимости единого входа на основе заголовка настраивается экземпляр доступа проверки связи.

**SSL между узлом соединителя и целевым приложением**: Безопасность имеет первостепенное значение, поэтому следует всегда использовать TLS между узлом соединителя и целевыми приложениями. Особенно если веб-приложение настроено для проверки подлинности на основе форм (FBA), так как учетные данные пользователя фактически передаются в виде открытого текста.

**Реализуйте добавочное и тестирование каждого шага**. Выполните базовое функциональное тестирование после публикации приложения, чтобы обеспечить соблюдение всех требований пользователя и бизнеса, следуя приведенным ниже инструкциям.

1. Проверка и проверка общего доступа к веб-приложению с отключенной предварительной проверкой подлинности.
2. В случае успешного включения предварительной проверки подлинности и назначения пользователей и групп. Проверка и проверка доступа.
3. Затем добавьте метод единого входа для своего приложения и проверьте его еще раз, чтобы проверить доступ.
4. При необходимости примените политики условного доступа и MFA. Проверка и проверка доступа.

**Средства устранения неполадок**: При устранении неполадок всегда начинайте с проверки доступа к опубликованному приложению из браузера на узле соединителя и убедитесь, что приложение работает должным образом. Чем проще программа установки, тем проще определить основную причину, поэтому попробуйте воспроизвести проблемы с минимальной конфигурацией, например с помощью одного соединителя и без единого входа. В некоторых случаях средства веб-отладки, такие как Fiddler Telerik, могут стать незаменимым для устранения неполадок доступа или содержимого в приложениях, доступ к которым осуществляется через прокси-сервер. Fiddler также может действовать в качестве прокси-сервера, помогающего отслеживать и отлаживать трафик для мобильных платформ, таких как iOS и Android, и практически все, что можно настроить для маршрутизации через прокси-сервер. Дополнительные сведения см. в разделе [руководство по устранению неполадок](application-proxy-troubleshoot.md) .

## <a name="implement-your-solution"></a>Реализация решения

### <a name="deploy-application-proxy"></a>Развертывание прокси приложения

Шаги по развертыванию прокси приложения описаны в этом [руководстве по добавлению локального приложения для удаленного доступа](application-proxy-add-on-premises-application.md). Если установка не выполнена, выберите пункт **Устранение неполадок прокси приложения** на портале или воспользуйтесь руководством по устранению неполадок, чтобы [установить соединитель агента прокси приложения](application-proxy-connector-installation-problem.md).

### <a name="publish-applications-via-application-proxy"></a>Публикация приложений через прокси приложения

Публикация приложений предполагает, что вы удовлетворены всеми необходимыми компонентами и у вас есть несколько соединителей, которые отображаются как зарегистрированные и активные на странице прокси приложения.

Вы также можете публиковать приложения с помощью [PowerShell](https://docs.microsoft.com/powershell/module/azuread/?view=azureadps-2.0-preview).

Ниже приведены рекомендации, которые следует выполнить при публикации приложения.

* **Использовать группы соединителей**: Назначьте группу соединителей, назначенную для публикации каждого соответствующего приложения. Для обеспечения высокой доступности и масштабирования в каждой группе соединителей рекомендуется использовать по крайней мере два соединителя. Наличие трех соединителей является оптимальным, если вам может потребоваться обслуживать компьютер в любой момент. Кроме того, см. статью [Публикация приложений в отдельных сетях и расположениях с помощью групп соединителей](application-proxy-connector-groups.md) , чтобы узнать, как можно использовать группы соединителей для сегментирования соединителей по сети или расположению.

* **Задать время ожидания внутреннего приложения**: Этот параметр полезен в сценариях, где приложению может потребоваться более 75 секунд для обработки транзакции клиента. Например, когда клиент отправляет запрос в веб-приложение, которое выступает в качестве внешнего интерфейса базы данных. Внешний интерфейс отправляет этот запрос на сервер базы данных, а затем ожидает ответа, но по времени, когда он получает ответ, время ожидания на стороне клиента диалога истекает. Если задать для параметра время ожидания значение Long, течение длительного времени для выполнения транзакций будет 180 секунд.

* **Использовать соответствующие типы файлов cookie**

   * **Файл cookie только для HTTP**: Обеспечивает дополнительную защиту за счет включения в прокси приложения флага HTTPOnly в заголовках ответов HTTP Set-cookie. Этот параметр позволяет снизить риск использования таких средств, как межсайтовые сценарии (XSS). Оставьте значение "нет" для агентов клиентов и пользователей, которым требуется доступ к файлу cookie сеанса. Например, клиент RDP/МТСК, подключающийся к шлюзу удаленный рабочий стол, опубликованному через прокси приложения.

   * **Защищенный файл cookie**: Если для файла cookie задан атрибут Secure, то агент пользователя (клиентское приложение) будет включать файл cookie только в HTTP-запросы, если запрос передается по защищенному каналу TLS. Это помогает снизить риск компрометации файла cookie по открытым текстовым каналам, поэтому он должен быть включен.

   * **Постоянный файл cookie**: Позволяет сохранять файл cookie сеанса прокси приложения для сохранения между замыканиями браузера по остающимся допустимым до истечения срока действия или удаления. Используется для сценариев, в которых многофункциональное приложение, например Office, обращается к документу в опубликованном веб-приложении без повторного запроса проверки подлинности. Будьте внимательны, но, так как постоянные файлы cookie могут в конечном итоге оставить службу под угрозой несанкционированного доступа, если они не используются совместно с другими компенсирующие элементы управления. Этот параметр следует использовать только для старых приложений, которые не могут обмениваться файлами cookie между процессами. Лучше обновить приложение, чтобы обрабатывать совместное использование файлов cookie между процессами, а не использовать этот параметр.

* **Перевод URL-адресов в заголовки**: Этот параметр включается для сценариев, в которых внутреннее DNS не может быть настроено в соответствии с общедоступным пространством имен организации (a. k. разделенный DNS). Если приложению не требуется исходный заголовок узла в запросе клиента, оставьте значение Да. В качестве альтернативы необходимо, чтобы соединитель использовал полное доменное имя во внутреннем URL-адресе для маршрутизации фактического трафика, и полное доменное имя во внешнем URL-адресе в качестве заголовка узла. В большинстве случаев эта альтернатива должна позволять приложению работать как обычно при удаленном доступе, но ваши пользователи теряют преимущества поиска в & вне URL-адреса.

* **Translate URLs in Application Body** (Преобразовывать URL-адреса в коде приложения): Включите преобразование ссылок на текст приложения для приложения, если нужно, чтобы ссылки из этого приложения были переведены обратно в ответ на клиент. Если этот компонент включен, эта функция предоставляет лучшие усилия при преобразовании всех внутренних ссылок, которые прокси приложения находит в ответах HTML и CSS, возвращаемых клиентам. Это полезно при публикации приложений, которые содержат в содержимом жестко заданные абсолютные или NetBIOS-ссылки ShortName, или приложения с содержимым, которое ссылается на другие локальные приложения.

Для сценариев, в которых опубликованное приложение ссылается на другие опубликованные приложения, включите преобразование ссылок для каждого приложения, чтобы вы могли контролировать взаимодействие с пользователем на уровне приложения.

Например, предположим, у вас есть три приложения, опубликованные с помощью прокси приложения. Они содержат ссылки друг на друга: Преимущества, расходы и командировки, а также четвертое приложение, обратная связь, которое не публикуется через прокси приложения.

![Рисунок 1](media/App-proxy-deployment-plan/link-translation.png)

При включении преобразования ссылок для приложения "преимущества" ссылки на расходы и командировки перенаправляются на внешние URL-адреса для этих приложений, чтобы пользователи, обращающиеся к приложениям извне корпоративной сети, могли получить к ним доступ. Ссылки с расходов и обратно на льготы не работают, так как для этих двух приложений не включено преобразование ссылок. Ссылка на отзыв не перенаправлена, так как отсутствует внешний URL-адрес, поэтому пользователи, использующие приложение "преимущества", не смогут получить доступ к приложению обратной связи извне корпоративной сети. См. подробные сведения о [преобразовании ссылок и других параметрах перенаправления](application-proxy-configure-hard-coded-link-translation.md).

### <a name="access-your-application"></a>Доступ к приложению

Существует несколько вариантов управления доступом к опубликованным ресурсам прокси приложения, поэтому выберите наиболее подходящий вариант в соответствии с конкретными потребностями и масштабируемостью. К общим подходам относятся: использование локальных групп, которые синхронизируются с помощью Azure AD Connect, создание динамических групп в Azure AD на основе атрибутов пользователя, использование групп самообслуживания, управляемых владельцем ресурса, или их сочетание. Дополнительные сведения о преимуществах каждого из них см. в разделе связанные ресурсы.

Самый прямой способ назначения пользователям доступа к приложению — перейти в параметры **Пользователи и группы** в левой области опубликованного приложения и напрямую назначить группы или отдельных пользователей.

![Рисунок 24](media/App-proxy-deployment-plan/add-user.png)

Вы также можете разрешить пользователям самостоятельный доступ к приложению, назначив группу, в которую они не входят, и настроив параметры самообслуживания.

![Рисунок 25](media/App-proxy-deployment-plan/allow-access.png)

Если параметр включен, пользователи смогут входить на портал MyApps и запрашивать доступ, а также быть автоматически утверждены и добавлены в уже разрешенную группу самообслуживания или должны быть утверждены от назначенного утверждающего лица.

Гостевые пользователи также могут [приглашать для доступа к внутренним приложениям, опубликованным через прокси приложения через Azure AD B2B](https://docs.microsoft.com/azure/active-directory/b2b/add-users-information-worker).

Для локальных приложений, которые обычно доступны анонимно, не требуют проверки подлинности, можно отключить параметр, расположенный в свойствах приложения.

![Рисунок 26](media/App-proxy-deployment-plan/assignment-required.png)


Если этот параметр не установлен в значение "нет", пользователи могут получить доступ к локальному приложению через Azure AD App прокси-сервер без разрешений, поэтому используйте с осторожностью.

После публикации приложение должно быть доступно, введя его внешний URL-адрес в браузере или с помощью значка в [https://myapps.microsoft.com](https://myapps.microsoft.com/).

### <a name="enable-pre-authentication"></a>Включить предварительную проверку подлинности

Убедитесь, что приложение доступно через прокси приложения, доступ к которому осуществляется через внешний URL-адрес. 

1. Перейдите в **Azure Active Directory** > **Корпоративные приложения** > **Все приложения** и выберите приложение, которым необходимо управлять.

2. Выберите **Прокси приложения**.

3. В поле **Предварительная проверка** подлинности используйте раскрывающийся список, чтобы выбрать **Azure Active Directory**, и выберите **сохранить**.

При включенной предварительной проверке подлинности Azure AD сначала выполнит проверку подлинности пользователей, а если единый вход — конфигуед, то серверное приложение также будет проверять пользователя перед предоставлением доступа к приложению. При изменении режима предварительной проверки подлинности с транзитного на Azure AD также настраивается внешний URL-адрес с помощью протокола HTTPS, поэтому все приложения, изначально настроенные для протокола HTTP, теперь защищаются с помощью протокола HTTPS.

### <a name="enable-single-sign-on"></a>Доступ с единым входом

ЕДИНЫЙ вход обеспечивает максимально возможный уровень взаимодействия с пользователем и безопасности, так как для доступа к Azure AD пользователям требуется только один вход. После предварительной проверки подлинности пользователь должен выполнить проверку подлинности с помощью соединителя прокси-сервера приложения, который выполняет аутентификацию в локальном приложении от имени пользователя. Серверное приложение обрабатывает имя входа так, как будто оно является пользователем. 

Выбор параметра **транзитный** позволяет пользователям получать доступ к опубликованному приложению без необходимости проходить проверку подлинности в Azure AD.

Выполнение единого входа возможно, только если Azure AD может опознать пользователя, запрашивающего доступ к ресурсу, поэтому приложение должно быть настроено для предварительной проверки подлинности пользователей с помощью Azure AD при доступе к функции единого входа. в противном случае параметры единого входа будут отключены.

Ознакомьтесь с единым входом в [приложения в Azure AD](what-is-single-sign-on.md) , чтобы помочь вам выбрать наиболее подходящий метод единого входа при настройке приложений.

###  <a name="working-with-other-types-of-applications"></a>Работа с приложениями других типов

AD Application Proxy Azure также может поддерживать приложения, разработанные для использования библиотеки аутентификация Azure AD ([ADAL](https://docs.microsoft.com/azure/active-directory/develop/active-directory-authentication-libraries)) или библиотеки проверки подлинности Майкрософт ([MSAL](https://azure.microsoft.com/blog/start-writing-applications-today-with-the-new-microsoft-authentication-sdks/)). Он поддерживает собственные клиентские приложения, используя созданные токены Azure AD, полученные в заголовке запроса клиента для выполнения предварительной проверки подлинности от имени пользователей.

Сведения о доступных конфигурациях прокси приложения см. в статье [Публикация собственных и мобильных клиентских приложений](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-native-client) и [приложений на основе утверждений](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-claims-aware-apps) .

### <a name="use-conditional-access-to-strengthen-security"></a>Использование условного доступа для усиления безопасности

Безопасность приложений требует расширенного набора возможностей безопасности, которые могут защищать и отвечать на сложные угрозы в локальной среде и в облаке. Злоумышленники чаще всего получают доступ к корпоративной сети через слабые, используемые по умолчанию или украденные учетные данные пользователя.  Безопасность на основе идентификации Майкрософт сокращает использование украденных учетных данных за счет управления и защиты привилегированных и непривилегированных удостоверений.

Для поддержки AD Application Proxy Azure можно использовать следующие возможности.

* Условный доступ на основе пользователей и расположений: Обеспечьте защиту конфиденциальных данных, ограничивая доступ пользователей на основе географического расположения или IP-адреса с [политиками условного доступа на основе расположения](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-locations).

* Условный доступ на основе устройств: Убедитесь, что только зарегистрированные, утвержденные и соответствующие требованиям устройства могут получать доступ к корпоративным данным с помощью [условного доступа на основе устройств](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-policy-connected-applications).

* Условный доступ на основе приложений: Работа не должна останавливаться, если пользователь не находится в корпоративной сети. [Обеспечьте безопасный доступ к корпоративным облачным и локальным приложениям](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-mam) и обеспечьте управление с помощью условного доступа.

* Условный доступ на основе рисков: Защитите свои данные от вредоносных хакеров с помощью [политики условного доступа на основе рисков](https://www.microsoft.com/cloud-platform/conditional-access) , которая может применяться ко всем приложениям и всем пользователям, будь то локальная или облачная.

* Панель доступа Azure AD: Развернув службу прокси приложения и обеспечивая надежную публикацию приложений, предложите пользователям простой центр для обнаружения всех своих приложений и доступа к ним. Повысьте производительность благодаря возможностям самообслуживания, таким как возможность запрашивать доступ к новым приложениям и группам или управлять доступом к этим ресурсам от имени других пользователей с помощью [панели доступа](https://aka.ms/AccessPanelDPDownload).

## <a name="manage-your-implementation"></a>Управляйте своей реализацией

### <a name="required-roles"></a>Обязательные роли

Корпорация Майкрософт представляет собой принцип предоставления минимально возможной привилегии для выполнения необходимых задач с помощью Azure AD. [Ознакомьтесь с различными доступными ролями Azure](https://docs.microsoft.com/azure/active-directory/active-directory-assign-admin-roles-azure-portal) и выберите нужную из них, чтобы удовлетворить потребности каждого персонажа. Некоторые роли, возможно, потребуется временно применить и удалить после завершения развертывания.

| Бизнес-роль| Бизнес-задачи| Роли Azure AD |
|---|---|---|
| Администратор службы поддержки | Обычно ограничивается подходящими конечными пользователями проблемами и выполняются ограниченные задачи, такие как изменение паролей пользователей, аннулирование маркеров обновления и мониторинг работоспособности служб. | Администратор службы поддержки |
| Администратор удостоверений| Ознакомьтесь с отчетами о входе в Azure AD и журналами аудита, чтобы отладить проблемы, связанные с прокси приложения.| Чтение данных безопасности |
| Владелец приложения| Создание и управление всеми аспектами корпоративных приложений, регистрацией приложений и параметрами прокси приложения.| Администратор приложения |
| Администратор инфраструктуры | Владелец смены сертификата | Администратор приложения |

Минимизация количества людей, имеющих доступ к защищенным сведениям или ресурсам, поможет уменьшить вероятность несанкционированного доступа вредоносного субъекта или злонамеренного пользователя, который случайно повлияет на конфиденциальный ресурс. 
 
Тем не менее пользователям по-прежнему приходится выполнять привилегированные операции, поэтому следует применять политики [Управление привилегированными пользователями](https://docs.microsoft.com/azure/active-directory/active-directory-privileged-identity-management-configure) на основе JIT, чтобы предоставить привилегированный доступ к ресурсам Azure по требованию и Azure AD — наш рекомендуемый подход. эффективное управление административным доступом и аудитом.

### <a name="reporting-and-monitoring"></a>Создание отчетов и мониторинг

Azure AD предоставляет дополнительные сведения об использовании приложений и работоспособности в Организации с помощью [журналов аудита и отчетов](https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-audit-logs). Прокси приложения также позволяет легко отслеживать соединители на портале Azure AD и в журналах событий Windows.

#### <a name="application-audit-logs"></a>Журналы аудита приложений

Эти журналы предоставляют подробные сведения о именах входа для приложений, настроенных с помощью прокси приложения, а также устройства и пользователя, обращающегося к приложению. [Журналы аудита](https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-audit-logs) находятся в портал Azure и в [API аудита](https://docs.microsoft.com/graph/api/resources/directoryaudit?view=graph-rest-beta) для экспорта. Кроме того, [отчеты об использовании и аналитике](https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-usage-insights-report) также доступны для вашего приложения.

#### <a name="application-proxy-connector-monitoring"></a>Мониторинг соединителя прокси приложения

Соединители и служба отвечают за выполнение задач, связанных с высоким уровнем доступности. Состояние соединителей можно отслеживать на странице прокси приложения на портале Azure AD. Дополнительные сведения о [соединителях Azure AD application proxy](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy-connectors#maintenance)см. в этой статье.

![Пример Соединители Azure AD Application Proxy](./media/application-proxy-connectors/app-proxy-connectors.png)

#### <a name="windows-event-logs-and-performance-counters"></a>Журналы событий Windows и счетчики производительности

Соединители имеют журналы администрирования и сеанса. В журналах администратора регистрируются основные события и соответствующие ошибки. В журналах сеансов содержатся все транзакции и подробные сведения об их обработке. Журналы и счетчики расположены в журналах событий Windows. Дополнительные сведения см. в статье об [соединителях Azure AD application proxy](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy-connectors#under-the-hood). Следуйте указаниям этого [руководства, чтобы настроить источники данных журнала событий в Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/platform/data-sources-windows-events).

### <a name="troubleshooting-guide-and-steps"></a>Руководство по устранению неполадок и инструкции

Узнайте больше о распространенных проблемах и способах их устранения с помощью нашего руководства по [устранению неполадок](application-proxy-troubleshoot.md) в сообщениях об ошибках. 

В следующих статьях рассматриваются распространенные сценарии, которые также можно использовать для создания руководств по устранению неполадок в Организации поддержки. 

* [Проблемы при отображении страницы приложения](application-proxy-page-appearance-broken-problem.md)
* [Слишком долгая загрузка приложения](application-proxy-page-load-speed-problem.md)
* [Ссылки на странице приложения не работают](application-proxy-page-links-broken-problem.md)
* [Порты, которые необходимо открыть для приложения](application-proxy-connectivity-ports-how-to.md)
* [Не удается найти рабочий соединитель в группе соединителей для приложения](application-proxy-connectivity-no-working-connector.md)
* [Настройка на портале администрирования](application-proxy-config-how-to.md)
* [Настройка единого входа в приложение](application-proxy-config-sso-how-to.md)
* [Проблема при создании приложения на портале администрирования](application-proxy-config-problem.md)
* [Настройка ограниченного делегирования Kerberos](application-proxy-back-end-kerberos-constrained-delegation-how-to.md)
* [Настройка с использованием PingAccess](application-proxy-back-end-ping-access-how-to.md)
* [Не удается получить доступ к этой ошибке корпоративного приложения](application-proxy-sign-in-bad-gateway-timeout-error.md)
* [Проблема при установке соединителя агента Application Proxy](application-proxy-connector-installation-problem.md)
* [Проблема при входе](application-sign-in-problem-on-premises-application-proxy.md)
