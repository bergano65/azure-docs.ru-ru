---
title: Планирование развертывания условного доступа Azure Active Directory
description: Узнайте, как проектировать политики условного доступа и обеспечить эффективное развертывание в своей организации.
services: active-directory
ms.service: active-directory
ms.subservice: conditional-access
ms.topic: how-to
ms.date: 10/16/2020
ms.author: baselden
author: BarbaraSelden
manager: daveba
ms.reviewer: joflore
ms.collection: M365-identity-device-management
ms.openlocfilehash: 0e44cb38435ca86ad7cd4709d5e99f5cf41fcf91
ms.sourcegitcommit: 28c5fdc3828316f45f7c20fc4de4b2c05a1c5548
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2020
ms.locfileid: "92366332"
---
# <a name="plan-a-conditional-access-deployment"></a>Планирование развертывания условного доступа

Планирование развертывания условного доступа очень важно для реализации стратегии доступа для приложений и ресурсов в организации.

В мире мобильных и облачных технологий пользователи могут откуда угодно обращаться к ресурсам вашей организации с помощью различных устройств и приложений. Поэтому уже недостаточно просто указать, кто имеет доступ к ресурсу. Помимо этого нужно учитывать, где находится пользователь, какое устройство он использует, к какому ресурсу он обращается и многое другое. 

Служба условного доступа Azure Active Directory (Azure AD) анализирует такие сигналы, как пользователь, устройство и расположение, чтобы автоматизировать принятие решений и применение корпоративных политик доступа к ресурсам. Политики условного доступа можно использовать для применения таких элементов управления доступом, как многофакторная проверка подлинности (MFA). Политики условного доступа позволяют предлагать пользователям MFA, когда это необходимо для обеспечения безопасности, и не вмешиваться в работу пользователей, когда это не требуется.

![Общие сведения об условном доступе](./media/plan-conditional-access/conditional-access-overview-how-it-works.png)

Корпорация Майкрософт предоставляет стандартные условные политики, называемые [параметрами безопасности по умолчанию](../fundamentals/concept-fundamentals-security-defaults.md), которые обеспечивают базовый уровень безопасности. Однако организации может потребоваться больше гибкости по сравнению с предложенными параметрами безопасности по умолчанию. Условный доступ можно использовать, чтобы настроить параметры безопасности по умолчанию с большей степенью детализации и установить новые политики, соответствующих вашим требованиям.

## <a name="learn"></a>Обучение

Перед началом работы необходимо ознакомиться с принципами работы и условиями использования [условного доступа](overview.md).

### <a name="benefits"></a>Преимущества

Преимущества развертывания условного доступа.

* Повышение производительности. Пользователи будут отрываться от работы только для выполнений единого входа (например, посредством MFA), если один или несколько сигналов подтверждают такую возможность. Политики условного доступа позволяют контролировать, когда пользователям предлагается пройти MFA, когда доступ блокируется и когда они должны использовать доверенное устройство.

* Управление рисками. Автоматизация оценки рисков с помощью условий политики означает, что рискованные входы тут же обнаруживаются и исправляются или блокируются. Взаимозависимость условного доступа с [Защитой идентификации](../identity-protection/overview-identity-protection.md) позволяет выявлять аномалии и подозрительные события, что дает возможность указать, когда доступ к ресурсам блокируется или фильтруется. 

* Обеспечение соответствия и системы управления. Условный доступ позволяет проводить аудит доступа к приложениям, представлять условия использования для принятия и ограничивать доступ на основе политик соответствия.

* Управление затратами. Перемещение политик доступа в Azure AD снижает зависимость от настраиваемых или локальных решений для условного доступа и затрат на инфраструктуру.

### <a name="license-requirements"></a>Требования лицензий

Ознакомьтесь с [требованиями лицензий для условного доступа](overview.md).

Если требуются дополнительные функции, могут потребоваться лицензии для них. Дополнительные сведения см. в разделе [Цены на Azure Active Directory](https://azure.microsoft.com/pricing/details/active-directory/).

### <a name="prerequisites"></a>Предварительные требования

* Рабочий арендатор Azure AD с включенной лицензией Azure AD Premium или пробной лицензией. [Создайте ее бесплатно](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), если нужно.

* Учетная запись с привилегиями администратора условного доступа.

* Пользователь без прав администратора, пароль которого вам известен, например testuser. Если вам нужно создать пользователя, воспользуйтесь статьей [Краткое руководство. Добавление или удаление пользователей в Azure Active Directory](../fundamentals/add-users-azure-active-directory.md).

* Группа, в которую входит пользователь без прав администратора. Если вам нужно создать группу, ознакомьтесь со статьей [Создание группы и добавление в нее пользователей в Azure Active Directory](../fundamentals/active-directory-groups-create-azure-portal.md).

### <a name="training-resources"></a>Учебные ресурсы

Для изучения условного доступа можно воспользоваться следующими ресурсами:


#### <a name="videos"></a>Видео

* [Что такое условный доступ?](https://youtu.be/ffMAw2IVO7A)
* [Как развернуть условный доступ?](https://youtu.be/c_izIRNJNuk)
* [Как развернуть политики условного доступа для пользователей?](https://youtu.be/0_Fze7Zpyvc)
* [Условный доступ с использованием элементов управления для устройств](https://youtu.be/NcONUf-jeS4)
* [Условный доступ с использованием Azure MFA](https://youtu.be/Tbc-SU97G-w)
* [Условный доступ в Enterprise Mobility + Security](https://youtu.be/A7IrxAH87wc)


#### <a name="online-courses-on-pluralsight"></a>Онлайн-курсы на сайте PluralSight

* [Проектирование управления удостоверениями в Microsoft Azure](https://www.pluralsight.com/courses/microsoft-azure-identity-management-design)
* [Проектирование аутентификации для Microsoft Azure](https://www.pluralsight.com/courses/microsoft-azure-authentication-design)
* [Проектирование авторизации для Microsoft Azure](https://www.pluralsight.com/courses/microsoft-azure-authorization-design)

## <a name="plan-the-deployment-project"></a>Планирование проекта развертывания

Учитывайте потребности организации при определении стратегии развертывания в вашей среде.

### <a name="engage-the-right-stakeholders"></a>Привлечение соответствующих заинтересованных лиц

Причиной неудач технических проектов обычно являются неоправданные ожидания относительно влияния, результатов и обязанностей. Чтобы избежать этих ловушек, [убедитесь, что вы привлекаете соответствующих заинтересованных лиц](../fundamentals/active-directory-deployment-plans.md) и их роли в проекте очевидны.

### <a name="plan-communications"></a>Планирование информирования

Информирование важно для успеха любой новой службы. Заблаговременное сообщайте пользователям, как изменится их взаимодействие с системой, когда это произойдет и как получить поддержку в случае возникновения проблем.

### <a name="plan-a-pilot"></a>Планирование пилотного проекта

Когда новые политики будут готовы для вашей среды, поэтапно разверните их в рабочей среде. Сначала примените политику к небольшому набору пользователей в тестовой среде и проверьте, правильно ли она себя ведет. Ознакомьтесь с [рекомендациями по пилотным проектам](../fundamentals/active-directory-deployment-plans.md).

> [!NOTE]
> Для развертывания новых политик, не относящихся к администраторам, исключите всех администраторов. Это гарантирует, что администраторы смогут получить доступ к политике и изменить или отозвать ее, если ее влияние слишком значительное. Всегда проверяйте политику на небольших группах пользователей, прежде чем применять ее ко всем пользователям.

## <a name="understand-ca-policy-components"></a>Общие сведения о компонентах политики условного доступа
Политики ЦС являются операторами if-then: Если назначение выполнено, примените эти элементы управления доступом.

При настройке политик условного доступа условия называются *назначениями*. Политики условного доступа позволяют принудительно применять элементы управления доступом к приложениям в организации на основе определенных назначений.


Дополнительные сведения см. в разделе [Building a CA policy](concept-conditional-access-policies.md) (Создание политики условного доступа).

![Экран создания политики](media/plan-conditional-access/create-policy.png)

[Назначения](concept-conditional-access-policies.md#assignments) определяют

* [Пользователи и группы](concept-conditional-access-users-groups.md) , на которые распространяется политика

* [Облачные приложения или действия](concept-conditional-access-cloud-apps.md) , к которым будет применяться политика 

* [Условия](concept-conditional-access-conditions.md) , при которых будет применяться политика.

Параметры [элементов управления доступом](concept-conditional-access-policies.md) определяют, как применять политику.

* Можно [предоставить или заблокировать](concept-conditional-access-grant.md) доступ к облачным приложениям.

* [Элементы управления сеансом](concept-conditional-access-session.md) позволяют ограничивать возможности работы в облачных приложениях.

### <a name="ask-the-right-questions-to-build-your-policies"></a>Задайте правильные вопросы для создания политик

Политики отвечают на вопросы о том, кто должен получать доступ к ресурсам, к каким ресурсам они должны обращаться и при каких условиях. Можно создать политики для предоставления или блокировки доступа. Обязательно задавайте правильные вопросы о том, что должна делать политика. 

Задокументируйте ответы на вопросы о каждой политике, прежде чем создавать ее. 

#### <a name="common-questions-about-assignments"></a>Часто задаваемые вопросы о назначениях

[Пользователи и группы](concept-conditional-access-users-groups.md)

* Какие пользователи и группы будут включены в политику или исключены из нее?

* Включает ли эта политика всех пользователей, определенные группы пользователей, роли каталогов или внешних пользователей?

[Облачные приложения или действия](concept-conditional-access-cloud-apps.md)

* К каким приложениям будет применяться политика?

* Какие действия пользователя будет регулировать эта политика?

[Условия](concept-conditional-access-conditions.md)

* Какие платформы устройств будут включены в политику или исключены из нее?

* Какие надежные расположения есть в организации?

* Какие расположения будут включены в политику или исключены из нее?

* Какие типы клиентских приложений (браузер, мобильные приложения, классические клиенты, приложения с устаревшими методами аутентификации) будут включены в политику или исключены из нее?

* Есть ли у вас политики, которые будут исключать из политик устройства, присоединенные к Azure AD, или устройства с гибридным присоединением к Azure AD? 

* Если вы используете [Защиту идентификации](../identity-protection/concept-identity-protection-risks.md), хотите ли вы включить защиту от рисков при входе?

#### <a name="common-questions-about-access-controls"></a>Распространенные вопросы об элементах управления доступом

[Предоставление или блокирование доступа](concept-conditional-access-grant.md) 

Вы хотите предоставлять доступ к ресурсам с использованием одного из следующих способов?

* Требовать многофакторную идентификацию.

* Требовать, чтобы устройство было отмечено как соответствующее.

* Требовать устройство с гибридным присоединением к Azure AD.

* Требовать утвержденное клиентское приложение.

* Требовать политику защиты приложений.

[Управление сеансами](concept-conditional-access-session.md)

Вы хотите применить какой-либо из приведенных ниже элементов управления доступом в облачных приложениях?

* Использовать разрешения приложений.

* Использовать Управление условным доступом к приложениям.

* Контроль частоты входа.

* Использование постоянных сеансов браузера.

### <a name="access-token-issuance"></a>Выдавать маркер доступа.

Важно понимать, как выдаются маркеры доступа. 

![Схема выдачи маркера доступа](media/plan-conditional-access/CA-policy-token-issuance.png)

> [!NOTE]
> Если назначение не требуется и политика ЦС не действует, то поведение по умолчанию — выдача маркера доступа. 

Например, рассмотрим политику, в которой:

ЕСЛИ пользователь входит в группу 1, ТО необходимо применить MFA для доступа к приложению 1.

Если пользователь, не входящий в группу 1, пытается получить доступ к приложению, условие "ЕСЛИ" не выполняется и выдается маркер. Чтобы исключить пользователей не из группы 1, требуется отдельная политика для блокировки всех остальных пользователей.

## <a name="follow-best-practices"></a>Применение рекомендаций

Платформа условного доступа обеспечивает исключительную гибкость конфигурации. Тем не менее исключительная гибкость также означает, что во избежание нежелательных результатов необходимо внимательно просмотреть каждую политику конфигурации, прежде чем выпускать ее.

### <a name="apply-ca-policies-to-every-app"></a>Применение политик условного доступа ко всем приложениям

Маркеры доступа по умолчанию выдаются, если условие политики условного доступа не активирует управление доступом. Убедитесь, что к каждому приложению применена хотя бы одна политика условного доступа.

> [!IMPORTANT]
> Будьте внимательны при использовании блокировки и всех приложений в одной политике. Это может привести к блокированию работы администраторов на портале администрирования Azure, так как невозможно настроить исключения для важных конечных точек, таких как Microsoft Graph.

### <a name="minimize-the-number-of-ca-policies"></a>Минимальное число политик условного доступа

Создание политики для каждого приложения не эффективно и усложняет администрирование. Условный доступ будет применяться только к первым 195 политикам на пользователя. Рекомендуется проанализировать приложения и сгруппировать приложения с одинаковыми требованиями к ресурсам для одних и тех же пользователей. Например, если все приложения Microsoft 365 или все приложения HR имеют одинаковые требования для одних и тех же пользователей, создайте единую политику и включите в нее все приложения, к которым она применяется. 

### <a name="set-up-emergency-access-accounts"></a>Настройка учетных записей для аварийного доступа

Если политика неправильно настроена, она может блокировать работу организаций на портале Azure. Уменьшить ущерб от случайного блокирования администраторов можно, создав в организации одну или две [учетные записи для аварийного доступа](../roles/security-emergency-access.md).

* Создайте учетную запись пользователя, предназначенную для администрирования политик и исключенную из всех политик.

* Аварийный сценарий для гибридных сред.

  * Создайте локальную группу безопасности и синхронизируйте ее с Azure AD. Эта группа безопасности должна содержать выделенную учетную запись для администрирования политик. 

   * ИСКЛЮЧИТЕ эту группу безопасности из всех политик условного доступа.

   * В случае сбоя службы при необходимости добавьте других администраторов в эту локальную группу и принудительно выполните синхронизацию. Это позволит исключить их из политик условного доступа.

### <a name="set-up-report-only-mode"></a>Настройка режима "Только отчет"

Сложно прогнозировать количество и имена пользователей, затрагиваемых общими инициативами по развертыванию, например следующими:

* блокировка устаревших методов аутентификации;
* требование MFA;
* применение политик рисков при входе.

Режим [Только отчет](concept-conditional-access-report-only.md) позволяет администраторам оценить влияние политик условного доступа, прежде чем включить их в своей среде.

Узнайте, как [настроить режим "Только отчет" для политики условного доступа](howto-conditional-access-insights-reporting.md).

### <a name="plan-for-disruption"></a>Планирование нарушений

Если вы используете единую систему управления доступом, например MFA или расположение в сети, для защиты своих ИТ-систем, то в случае сбоя или неправильной настройки этой единой системы возможны сбои доступа к приложениям и ресурсам. Чтобы снизить риск блокировки во время непредвиденных нарушений работы, [составьте соответствующие стратегии](../authentication/concept-resilient-controls.md) для внедрения в организации.

### <a name="set-naming-standards-for-your-policies"></a>Задание стандартов именования для политик

Стандарт именования позволит быстро находить нужные политики и понимать их назначение, не открывая настройки политики на портале администрирования Azure. Рекомендуется присвоить политике имя, содержащее:

* порядковый номер;

* облачное приложение, к которому она применяется;

* реакцию;

* к кому она применяется;

* когда применяется (если применима).

![Снимок экрана, на котором показаны стандарты именования для политик.](media/plan-conditional-access/11.png)

**Пример**. Политика, требующая использования MFA для пользователей маркетингового отдела, которые обращаются к приложению Dynamics CRP из внешних сетей, может быть следующей.

![Стандарт именования](media/plan-conditional-access/naming-example.png)

Описательное имя помогает быть следить за реализацией условного доступа. Порядковый номер удобен, если необходимо сослаться на политику в беседе. Например, если вы разговариваете с администратором по телефону, вы можете попросить его открыть политику CA01, чтобы устранить проблему.

#### <a name="naming-standards-for-emergency-access-controls"></a>Стандарты именования для элементов управления аварийным доступом

Помимо активных политик следует определить отключенные политики, которые будут служить дополнительными [устойчивыми элементами управления доступом при сбоях или в авариях](../authentication/concept-resilient-controls.md). Стандарт именования для политик на непредвиденные случаи должен содержать:
* "ENABLE IN EMERGENCY" в начале, чтобы выделить имя среди других политик;

* имя нарушения, к которому должна применяться политика;

* порядковый номер, помогающий администратору узнать, какой по счету должна быть включена эта политика.

**Пример**

Следующее имя указывает, что эта политика является первой из четырех политик, которые можно включить при нарушении работы MFA:

EM01 - ENABLE IN EMERGENCY: MFA Disruption [1/4] - Exchange SharePoint: Require hybrid Azure AD join For VIP users.

### <a name="exclude-countries-from-which-you-never-expect-a-sign-in"></a>Исключите страны, входа в систему из которых вы не ожидаете.

Azure Active Directory позволяет создавать [именованные расположения](location-condition.md). Создайте именованное расположение, включающее в себя все страны, из которых никогда не будет происходить вход в систему. Затем создайте политику для всех приложений, которая блокирует вход из этого именованного расположения. **Обязательно исключите администраторов из этой политики**.

### <a name="plan-your-policy-deployment"></a>Планирование развертывания политик

Когда новые политики будут готовы к работе в среде, обязательно проверьте каждую политику перед ее внедрением, чтобы избежать нежелательных результатов.

## <a name="common-policies"></a>Общие политики

При планировании решения на основе политик условного доступа следует оценить, нужны ли вам настраиваемые политики для достижения перечисленных ниже результатов.

* [Требовать многофакторную идентификацию](#require-mfa)
* [Реагирование на потенциально скомпрометированные учетные записи](#respond-to-potentially-compromised-accounts)
* [Требование доступа с управляемых устройств](#require-managed-devices)
* [Требовать утвержденные клиентские приложения](#require-approved-client-apps)
* [Блокировка доступа](#block-access)

### <a name="require-mfa"></a>Требовать многофакторную идентификацию

Вот несколько вариантов, в которых обычно требуется MFA:

* [вход с правами администратора](howto-conditional-access-policy-admin-mfa.md);

* [доступ к конкретным приложениям](../authentication/tutorial-enable-azure-mfa.md);

* [все пользователи](howto-conditional-access-policy-all-users-mfa.md);

* [вход из сетевых расположений, которым вы не доверяете](untrusted-networks.md);

* [управление Azure](howto-conditional-access-policy-azure-management.md).

### <a name="respond-to-potentially-compromised-accounts"></a>Реагирование на потенциально скомпрометированные учетные записи

Политики условного доступа позволяют реализовать автоматическое реагирование на события входа с потенциально скомпрометированными удостоверениями. Вероятность компрометации учетной записи выражается в виде уровней риска. Защита идентификации вычисляет два уровня риска: риск при входе и риск пользователя. Ниже приведены три политики по умолчанию, которые можно включить.

* [Требование регистрации всех пользователей для прохождения MFA](howto-conditional-access-policy-risk.md)

* [Требование изменения пароля для пользователей с высоким риском](howto-conditional-access-policy-risk.md)

* [Требование MFA для пользователей со средним или высоким уровнем риска при входе](howto-conditional-access-policy-risk.md)

### <a name="require-managed-devices"></a>Требование доступа с управляемых устройств

Широкое разнообразие поддерживаемых устройств для доступа к облачным ресурсам помогает повысить эффективность работы пользователей. Вы наверняка захотите оградить некоторые ресурсы в корпоративной среде от доступа устройств с неизвестным уровнем защиты. Для таких ресурсов нужно [настроить ограничение, разрешающее доступ только с управляемых устройств](require-managed-devices.md).

### <a name="require-approved-client-apps"></a>Требование доступа из утвержденных клиентских приложений

Ваши сотрудники используют мобильные устройства как в личных целях, так и для выполнения рабочих задач. Для сценариев BYOD необходимо решить, следует ли управлять всем устройством или только данными на нем. Для управления только данными и доступом можно [требовать утвержденные облачные приложения](app-based-conditional-access.md), которые могут защищать корпоративные данные. Например, доступ к электронной почте можно получить только через Outlook Mobile, а не через универсальную почтовую программу.

### <a name="block-access"></a>Заблокировать доступ

Действие [полной блокировки доступа](howto-conditional-access-policy-block-access.md) — это очень мощный инструмент. Его можно использовать, например, при переносе в Azure AD приложения, которое пока не готово ко входу пользователей. "Запретить доступ": 

* переопределяет любые другие назначения для пользователя;

* позволяет блокировать вход в клиент для всей организации сразу.

> [!IMPORTANT]
> Если вы создаете политику для блокирования доступа всех пользователей, обязательно из нее исключите учетные записи для аварийного доступа и рассмотрите возможность исключения всех администраторов.

Ниже приведены распространенные сценарии, в которых можно заблокировать доступ пользователей.

* [Блокирование доступа определенных сетевых расположений](howto-conditional-access-policy-location.md) к облачным приложениям. Эту политику можно использовать для блокирования определенных стран, из которых не должен поступать трафик.

* Поддержка устаревшей аутентификации в Azure AD. Устаревшая аутентификация не поддерживает MFA, и многие среды нуждаются в защите идентификации. В этом случае можно запретить доступ к ресурсам арендатора [приложениям, которые используют устаревшую аутентификацию](block-legacy-authentication.md).

## <a name="build-and-test-policies"></a>Создание и тестирование политик

На каждом этапе развертывания обязательно оценивайте результаты, чтобы убедиться, что они соответствуют ожиданиям. 

Когда новые политики будут готовы, поэтапно разверните их в рабочей среде.

* Проинформируйте пользователей об изменениях.

* Для начала примените политику к небольшой группе пользователей и убедитесь, что она правильно работает.

* Развертывая политику для остальных пользователей, временно исключите из нее всех администраторов. Исключение администраторов из политики позволит сохранить доступ на случай, если потребуются изменения этой политики.

* Примените политику ко всем пользователям только после тщательного тестирования. Убедитесь, что у вас есть по крайней мере одна учетная запись администратора, к которой политика не применяется.

### <a name="create-test-users"></a>Создание тестовых пользователей

Создайте набор тестовых пользователей, отражающих пользователей в рабочей среде. Создав тестовых пользователей, вы убедитесь, что все политики работают правильно, прежде чем применять их к реальным пользователям и создавать риск нарушения доступа к приложениям и ресурсам.

Некоторые организации используют для таких целей тестовые клиенты. Но воссоздание всех условий и приложений из реальной среды в тестовом клиенте, чтобы полностью протестировать результат применения политики, может оказаться сложной задачей.

### <a name="create-a-test-plan"></a>Создание плана тестирования

План тестирования нужен для того, чтобы сравнить ожидаемые и фактически полученные результаты. Прежде, чем тестировать любые компоненты, вы должны знать, что вы ожидаете получить. В следующей таблице приведены примеры тестовых случаев. Скорректируйте эти сценарии и ожидаемые результаты с учетом параметров ваших политик условного доступа.

| Политика| Сценарий| Ожидаемый результат |
| - | - | - |
| [Требовать MFA для доступа не с рабочего места](untrusted-networks.md)| Авторизованный пользователь входит в приложение, находясь в надежном расположении (на рабочем месте).| Пользователю не нужно выполнять MFA. |
| [Требовать MFA для доступа не с рабочего места](untrusted-networks.md)| Авторизованный пользователь входит в приложение, находясь в ненадежном расположении (не на рабочем месте).| Пользователю предлагается выполнить MFA и он может успешно войти |
| [Требовать MFA для администраторов](../fundamentals/concept-fundamentals-security-defaults.md)| Глобальный администратор входит в приложение.| Администратору предлагается выполнить MFA |
| [Вход, представляющий риск](../identity-protection/howto-identity-protection-configure-risk-policies.md)| Пользователь входит в приложение с помощью неутвержденного браузера| Администратору предлагается выполнить MFA |
| [Управление устройствами](require-managed-devices.md)| Авторизованный пользователь пытается войти с авторизованного устройства| Предоставляется доступ |
| [Управление устройствами](require-managed-devices.md)| Авторизованный пользователь пытается войти с неавторизованного устройства| Доступ блокируется |
| [Изменение пароля для пользователей с высоким уровнем риска](../identity-protection/howto-identity-protection-configure-risk-policies.md)| Авторизованный пользователь пытается войти с использованием скомпрометированных учетных данных (высокий риск входа)| В соответствии с политикой пользователю предлагается изменить пароль, иначе доступ блокируется |


### <a name="configure-the-test-policy"></a>Настройка тестовой политики

На [портале Azure](https://portal.azure.com/) можно настроить политики условного доступа, выбрав "Azure Active Directory" > "Безопасность" > "Условный доступ".

Если вы хотите узнать больше о создании политик условного доступа, ознакомьтесь со следующим примером: [Политика условного доступа для запроса MFA при входе пользователя на портал Azure](../authentication/tutorial-enable-azure-mfa.md?bc=%2fazure%2factive-directory%2fconditional-access%2fbreadcrumb%2ftoc.json&toc=%2fazure%2factive-directory%2fconditional-access%2ftoc.json). Это краткое руководство поможет вам:

* ознакомиться с пользовательским интерфейсом;

* получить первое впечатление о работе условного доступа.

### <a name="enable-the-policy-in-report-only-mode"></a>Включение политики в режиме "Только отчет"

Чтобы оценить влияние политики, начните с включения политики в [режиме "Только отчет"](concept-conditional-access-report-only.md). Политики в режиме "Только отчет" вычисляются во время входа, но элементы управления доступом и сеансами не применяются. После сохранения политики в режиме "Только отчет" в журналах входа можно будет увидеть, как она влияет на вход в систему в реальном времени. В журналах входа выберите событие и перейдите на вкладку "Только отчет", чтобы просмотреть результат каждой политики в режиме "Только отчет".


![Режим "Только отчет" ](media/plan-conditional-access/report-only-mode.png)

Выбрав политику, на странице "Сведения о политике" можно также увидеть, как вычисляются ее назначения и элементы управления доступом. Чтобы политика была применена ко входу в систему, должны быть выполнены условия всех настроенных назначений. 

### <a name="understand-the-impact-of-your-policies-using-the-insights-and-reporting-workbook"></a>Изучение влияния политик с помощью книги "Аналитические сведения и отчеты"

Вы можете просмотреть общее влияние политик условного доступа в книге "Аналитические сведения и отчеты". Для доступа к этой книге требуется подписка Azure Monitor. Кроме того, необходимо настроить [потоковую передачу журналов входа в рабочую область Log Analytics](../reports-monitoring/howto-integrate-activity-logs-with-log-analytics.md). 

### <a name="simulate-sign-ins-using-the-what-if-tool"></a>Имитация входа с помощью инструмента what-if

Еще один способ проверить политики условного доступа — с помощью инструмента [what-if](troubleshoot-conditional-access-what-if.md), который имитирует политики, применяемые к пользователю, выполняющему вход в гипотетических обстоятельствах. Выберите атрибуты входа, которые требуется протестировать (например, пользователя, приложение, платформу устройства и расположение), и узнайте, какие политики будут применяться.

> [!NOTE] 
> Имитация выполнения позволяет лучше изучить влияние политики условного доступа, но она не может заменить реальное тестирование.

### <a name="test-your-policy"></a>Тестирование политики

Выполните каждый пункт в плане тестирования на тестовых пользователях.

**Обязательно проверьте определенные в политике критерии исключения.** Предположим, что вы исключили пользователя или группу из политики, которая требует использовать MFA. В этом случае вам нужно проверить, получают ли исключенные пользователи приглашение MFA, так как сочетание других политик может налагать на них требование выполнить MFA.

### <a name="roll-back-policies"></a>Откат политик

Если требуется выполнить откат примененных новых политик, попробуйте осуществить одно или несколько из следующих действий.

* **Отключите политику.** Отключение политики гарантирует, что она не применяется при попытке пользователя выполнить вход. Вы всегда можете вернуться и включить политику, когда потребуется ее использовать.

![Рисунок включения политики](media/plan-conditional-access/enable-policy.png)

* **Исключите пользователя или группу из политики.** Если пользователь не может получить доступ к приложению, попробуйте исключить его из политики.

![Исключение пользователя и групп](media/plan-conditional-access/exclude-users-groups.png)

> [!NOTE]
>  Этот вариант следует применять ограниченно и только к тем пользователям, которым вы доверяете. Пользователь или группа должны быть добавлены обратно в политику, как только это станет возможным.

* **Удалите политику.** Если политика больше не требуется, [удалите](../authentication/tutorial-enable-azure-mfa.md?bc=%2fazure%2factive-directory%2fconditional-access%2fbreadcrumb%2ftoc.json&toc=%2fazure%2factive-directory%2fconditional-access%2ftoc.json) ее.

## <a name="manage-access-to-cloud-apps"></a>Управление доступом к облачным приложениям

Используйте приведенные ниже параметры, чтобы контролировать политики условного доступа и управлять ими.

![На снимке экрана показаны параметры управления для C политиками, включая именованные расположения, пользовательские элементы управления, подключение Условия использования, V P N и выбранные классические политики.](media/plan-conditional-access/manage-access.png)


### <a name="named-locations"></a>Именованные расположения

Условие расположения политики условного доступа позволяет привязать параметры управления доступом к расположениям пользователей в сети. С помощью [именованных расположений](location-condition.md) можно создать логические группы диапазонов IP-адресов, стран и регионов.

### <a name="custom-controls"></a>Пользовательские элементы управления

[Пользовательские элементы управления](controls.md) перенаправляют пользователей в совместимую службу для удовлетворения требований аутентификации вне Azure AD. В этом случае пользователь перенаправляется во внешнюю службу, выполняет все действия для аутентификации и затем перенаправляется обратно в Azure AD. Azure AD проверяет ответ, и если пользователь успешно прошел аутентификацию или проверку, то он продолжает работу в потоке условного доступа.

### <a name="terms-of-use"></a>Условия использования

Прежде чем обращаться к определенным облачным приложениям в существующей среде, можно получить согласие от пользователей в форме принятия условий использования (ToU). Следуйте этому [краткому руководству по созданию условий использования](require-tou.md).

## <a name="troubleshoot-conditional-access"></a>Устранение неполадок условного доступа

Если у пользователя возникают проблемы с политикой условного доступа, соберите приведенные ниже сведения, чтобы упростить устранение неполадок:

* имя субъекта-пользователя;

* отображаемое имя пользователя;

* имя операционной системы;

* метка времени (допускается приблизительное время);

* целевое приложение;

* тип клиентского приложения (браузер или клиент);

* идентификатор корреляции (уникальный для входа).

Если пользователь получил сообщение со ссылкой на дополнительные сведения, он может получить большую часть этих сведений.

![Не удается получить сообщение об ошибке приложения](media/plan-conditional-access/cant-get-to-app.png)

Собрав сведения, следует обратиться к следующим ресурсам:

* [Проблемы при входе с условным доступом](troubleshoot-conditional-access.md). Описание неожиданных результатов входа, связанных с условным доступом, на примере сообщений об ошибке и журнала входа в Azure AD.

* [Использование инструмента what-if](troubleshoot-conditional-access-what-if.md). Описывается, почему политика была или не была применена к пользователю в определенном случае или почему она будет применена в известном состоянии.

## <a name="next-steps"></a>Next Steps

[Узнайте больше о Многофакторной идентификации](../authentication/concept-mfa-howitworks.md).

[Узнайте больше о поставщиках удостоверений](../identity-protection/overview-identity-protection.md).

[Управление политиками условного доступа с помощью API Microsoft Graph](/graph/api/resources/conditionalaccesspolicy?view=graph-rest-beta.md)