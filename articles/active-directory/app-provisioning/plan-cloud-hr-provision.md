---
title: Планирование облачного приложения отдела кадров для Azure Active Directory подготовки пользователей
description: В этой статье описывается процесс развертывания облачных систем отдела кадров, таких как Workday и SuccessFactors, с Azure Active Directory. Интеграция Azure AD с облачной системой управления персоналом приводит к полному управлению жизненным циклом удостоверений.
services: active-directory
author: kenwith
manager: celestedg
ms.service: active-directory
ms.subservice: app-provisioning
ms.topic: conceptual
ms.workload: identity
ms.date: 11/22/2019
ms.author: kenwith
ms.reviewer: arvindha, celested
ms.openlocfilehash: 3a3f461941bfcd5091ebb14818bac05d6844b3fe
ms.sourcegitcommit: 7374b41bb1469f2e3ef119ffaf735f03f5fad484
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2020
ms.locfileid: "90706352"
---
# <a name="plan-cloud-hr-application-to-azure-active-directory-user-provisioning"></a>Планирование облачного приложения отдела кадров для Azure Active Directory подготовки пользователей

Исторически ИТ-специалисты полагается на ручные методы создания, обновления и удаления сотрудников. Они использовали такие методы, как отправка CSV-файлов или пользовательские скрипты для синхронизации данных сотрудников. Эти процессы подготовки являются подверженными ошибкам, небезопасными и трудно управляемыми.

Для управления жизненным циклом удостоверений сотрудников, поставщиков или работников, использующих зависимости, [Azure Active Directory (Azure AD) служба подготовки пользователей](../app-provisioning/user-provisioning.md) обеспечивает интеграцию с облачными приложениями для работы с персоналом (HR). Примерами приложений могут служить Workday или SuccessFactors.

Azure AD использует эту интеграцию для реализации следующих рабочих процессов облачных приложений (приложений).

- **Подготавливайте пользователей к Active Directory:** Подготавливайте выбранные наборы пользователей от облачного приложения отдела кадров к одному или нескольким доменам Active Directory.
- **Подготавливайте облачных пользователей к Azure AD:** В сценариях, где Active Directory не используется, подготавливайте пользователей непосредственно из облачного приложения HR в Azure AD.
- **Обратная запись в облачное приложение отдела кадров:** Запишите адреса электронной почты и атрибуты имени пользователя из Azure AD обратно в облачное приложение отдела кадров.

> [!NOTE]
> В этом плане развертывания показано, как развернуть рабочие процессы облачного приложения HR с помощью подготовки пользователей Azure AD. Сведения о том, как развернуть автоматическую подготовку пользователей в приложениях SaaS, см. в статье [Планирование развертывания автоматической подготовки пользователей](https://aka.ms/deploymentplans/provisioning).

## <a name="enabled-hr-scenarios"></a>Включенные сценарии HR

Служба подготовки пользователей Azure AD позволяет автоматизировать следующие сценарии управления жизненным циклом удостоверений на основе кадров:

- **Новый прием сотрудников:** При добавлении нового сотрудника в облачное приложение отдела кадров учетная запись пользователя автоматически создается в Active Directory и Azure AD с возможностью записи адресов электронной почты и атрибутов имени пользователя в облачное приложение отдела кадров.
- **Обновление атрибутов и профилей сотрудников:** Когда запись сотрудника, например имя, должность или руководитель, обновляется в облачном приложении отдела кадров, их учетная запись пользователя автоматически обновляется в Active Directory и Azure AD.
- **Завершение сотрудников:** Когда сотрудник завершает работу в облачном приложении отдела кадров, его учетная запись пользователя автоматически отключается в Active Directory и Azure AD.
- **Перенайм сотрудников:** Когда сотрудник переключается из облачного приложения отдела кадров, его старая учетная запись может быть автоматически реактивирована или повторно подготавливаться к Active Directory и Azure AD.

## <a name="who-is-this-integration-best-suited-for"></a>Для чего лучше всего подходит эта интеграция?

Интеграция облачных приложений отдела кадров с подготовкой пользователей Azure AD идеально подходит для организаций, которые:

- Требуется предварительно созданное облачное решение для подготовки пользователей в облачной отделе кадров.
- Требовать прямую подготовку пользователей из облачного приложения отдела кадров для Active Directory или Azure AD.
- Требовать подготовку пользователей с помощью данных, полученных из облачного приложения отдела кадров.
- Требуется синхронизация, перемещение и покидает синхронизацию пользователей с одним или несколькими Active Directory лесами, доменами и подразделениями на основе сведений об изменениях, обнаруженных в облачном приложении отдела кадров.
- Используйте Microsoft 365 для электронной почты.

## <a name="learn"></a>Learn

Подготовка пользователей создает основу для постоянного управления удостоверениями. Он улучшает качество бизнес-процессов, использующих достоверные данные удостоверений.

### <a name="terms"></a>Термины

В этой статье используются следующие термины:

- **Исходная система**: репозиторий пользователей, от которых заготавливается Azure AD. Примером является облачное приложение для отдела кадров, например Workday или SuccessFactors.
- **Целевая система**: репозиторий пользователей, на которые подготавливается Azure AD. Примеры: Active Directory, Azure AD, Microsoft 365 или другие приложения SaaS.
- **Присоединение-перевозчики — леаверс процесс**: термин, используемый для новых сотрудников, переносов и увольнения с помощью облачного приложения отдела кадров в качестве системы записей. Процесс завершается, когда служба успешно подготавливает необходимые атрибуты к целевой системе.

### <a name="key-benefits"></a>Основные преимущества

Эта возможность подготовки ИТ-ОТДЕЛов ИТ обеспечивает следующие значительные преимущества для бизнеса:

- **Повышение производительности:** Теперь можно автоматизировать назначение учетных записей пользователей и лицензий Microsoft 365 и предоставить доступ к группам ключей. Автоматизация назначений дает новым наймам немедленный доступ к своим средствам работы и повышает производительность.
- **Управление риском:** Вы можете повысить уровень безопасности, автоматизируя изменения на основе состояния сотрудника или членства в группах с данными, передаваемыми из облачного приложения отдела кадров. Автоматизация изменений гарантирует, что удостоверения пользователей и доступ к основным приложениям обновляются автоматически при переходе или выходе пользователей из Организации.
- **Соответствие и управление:** Azure AD поддерживает собственные журналы аудита для запросов подготовки пользователей, выполняемых приложениями как исходной, так и целевой системы. С помощью аудита можно отслеживать, кто имеет доступ к приложениям с одного экрана.
- **Управление затратами:** Автоматическая подготовка сокращает затраты за счет предотвращения неэффективного использования и ошибок пользователя, связанных с подготовкой вручную. Это сокращает потребность в создании настраиваемых решений подготовки пользователей с течением времени, используя устаревшие и устаревшие платформы.

### <a name="licensing"></a>Лицензирование

Чтобы настроить облачное приложение HR для интеграции подготовки пользователей Azure AD, требуется действительная [лицензия Azure AD Premium](https://azure.microsoft.com/pricing/details/active-directory/) и лицензия для облачного приложения отдела кадров, например Workday или SuccessFactors.

Кроме того, вам потребуется действительная лицензия на подписку Azure AD Premium P1 или более поздней версии для каждого пользователя, который будет источником из облачного приложения отдела кадров и подготовленных для Active Directory или Azure AD. Любое неправильное количество лицензий, принадлежащих облачному приложению отдела кадров, может привести к ошибкам во время подготовки пользователей.

### <a name="prerequisites"></a>Предварительные условия

- [Администратор гибридных удостоверений](../users-groups-roles/directory-assign-admin-roles.md#hybrid-identity-administrator) Azure AD для настройки агента подготовки Azure AD Connect.
- Роль [администратора приложения](../users-groups-roles/directory-assign-admin-roles.md#application-administrator) Azure AD для настройки приложения подготовки в портал Azure
- Тестовый и рабочий экземпляр облачного приложения отдела кадров.
- Разрешения администратора в облачном приложении отдела кадров для создания пользователя системной интеграции и внесения изменений в тестовые данные о сотрудниках в целях тестирования.
- Для подготовки пользователей к Active Directoryу требуется сервер под Windows Server 2012 или более поздней версии с .NET 4.7.1 + Runtime для размещения агента подготовки Azure AD Connect.
- [Azure AD Connect](../hybrid/whatis-azure-ad-connect.md) для синхронизации пользователей между Active Directory и Azure AD.

### <a name="training-resources"></a>Учебные ресурсы

| **Ресурсы** | **Ссылка и описание** |
|:-|:-|
| Видео | [Что такое подготовка пользователей в активном каталоге Azure?](https://youtu.be/_ZjARPpI6NI) |
| | [Развертывание подготовки пользователей в активном каталоге Azure](https://youtu.be/pKzyts6kfrw) |
| Учебники | [Учебники по интеграции приложений SaaS с Azure Active Directory](../saas-apps/tutorial-list.md) |
| | [Руководство по Настройка Workday для автоматической подготовки пользователей](../saas-apps/workday-inbound-tutorial.md#frequently-asked-questions-faq) |
| ВОПРОСЫ И ОТВЕТЫ | [Автоматическая подготовка пользователей](../app-provisioning/user-provisioning.md#what-applications-and-systems-can-i-use-with-azure-ad-automatic-user-provisioning) |
| | [Подготовка из Workday в Azure AD](../saas-apps/workday-inbound-tutorial.md#frequently-asked-questions-faq) |

### <a name="solution-architecture"></a>Архитектура решения

В следующем примере описывается комплексная архитектура решения подготовки пользователей для распространенных гибридных сред и включает в себя:

- **Достоверный поток данных отдела кадров из облачного приложения отдела кадров для Active Directory.** В этом потоке событие HR (соединение-перевозчики — процесс Леаверс) инициируется в облачном клиенте приложения для отдела кадров. Служба подготовки Azure AD и Azure AD Connect агент подготовки подготавливает данные пользователя из облачного приложения отдела кадров в Active Directory. В зависимости от события это может привести к созданию, обновлению, включению и отключению операций в Active Directory.
- **Синхронизация с Azure AD и обратная запись электронной почты и имени пользователя из локальной Active Directory в облачное приложение отдела кадров.** После обновления учетных записей в Active Directory они синхронизируются с Azure AD с помощью Azure AD Connect. Адреса электронной почты и атрибуты имени пользователя можно записать обратно в облачный клиент Cloud App.

![Схема рабочих процессов](media/plan-cloud-hr-provision/plan-cloudhr-provisioning-img1.png)

#### <a name="description-of-workflow"></a>Описание рабочего процесса

На схеме отображаются следующие основные шаги.  

1. Отдел **кадров** выполняет транзакции в облачном клиенте приложения для отдела кадров.
2. **Служба подготовки Azure AD** запускает запланированные циклы от клиента облачного приложения отдела кадров и определяет изменения, которые необходимо обработать для синхронизации с Active Directory.
3. **Служба подготовки Azure AD** вызывает агент подготовки Azure AD Connect с полезными данными запроса, содержащими Active Directory учетной записи, операции создания, обновления, включения и отключения.
4. **Azure AD Connect агент подготовки** использует учетную запись службы для управления данными учетной записи Active Directory.
5. **Azure AD Connect** выполняет разностную [синхронизацию](../hybrid/how-to-connect-sync-whatis.md) для извлечения обновлений в Active Directory.
6. **Active Directory** обновления синхронизируются с Azure AD.
7. **Служба подготовки Azure AD** записывает атрибут электронной почты и имя пользователя из Azure AD в клиент облачного приложения для отдела кадров.

## <a name="plan-the-deployment-project"></a>Планирование проекта развертывания

Учитывайте потребности организации при определении стратегии развертывания в вашей среде.

### <a name="engage-the-right-stakeholders"></a>Привлечение соответствующих заинтересованных лиц

При сбое технологических проектов они, как правило, за нечувствительногося к несоответствию ожиданиям в отношении влияния, результатов и обязанностей. Чтобы избежать этих ловушек, [Убедитесь, что вы подрабатываете нужные заинтересованные лица](https://aka.ms/deploymentplans). Также убедитесь, что роли заинтересованных лиц в проекте хорошо понятны. Документирование заинтересованных лиц и их входных и подотчетностиных проектов.

Включите в организацию отдела кадров представителя, который может предоставлять входные данные для существующих бизнес-процессов и удостоверения рабочего процесса, а также требования к обработке данных заданий.

### <a name="plan-communications"></a>Планирование информирования

Информирование важно для успеха любой новой службы. Заблаговременное взаимодействие с пользователями о том, когда и как изменится их опыт. Сообщите им о том, как получить поддержку, если у них возникнут проблемы.

### <a name="plan-a-pilot"></a>Планирование пилотного проекта

Для интеграции бизнес-процессов и рабочих процессов персонала из облачного приложения отдела кадров к целевым системам требуется значительный объем проверки данных, преобразования данных, очистки данных и сквозного тестирования, прежде чем можно будет развернуть решение в рабочей среде.

Запустите начальную конфигурацию в [экспериментальной среде](../fundamentals/active-directory-deployment-plans.md#best-practices-for-a-pilot) перед тем, как масштабировать ее для всех пользователей в рабочем окружении.

## <a name="select-cloud-hr-provisioning-connector-apps"></a>Выбор облачных приложений соединителя для подготовки кадров

Чтобы упростить рабочие процессы подготовки Azure AD между облачным приложением отдела кадров и Active Directory, можно добавить несколько приложений соединителя подготовки из коллекции приложений Azure AD:

- **Облачное приложение отдела кадров для Active Directory подготовки пользователей**. это приложение соединителя подготовки упрощает подготовку учетных записей пользователей из облачного приложения HR в один домен Active Directory. Если имеется несколько доменов, можно добавить один экземпляр этого приложения из коллекции приложений Azure AD для каждого домена Active Directory, в котором требуется подготовка.
- **Облачное приложение отдела кадров для подготовки пользователей Azure AD**. Хотя Azure AD Connect — это средство, которое следует использовать для синхронизации пользователей Active Directory с Azure AD, это приложение соединителя подготовки можно использовать для упрощения подготовки облачных пользователей из облачного приложения отдела кадров к одному клиенту Azure AD.
- **Обратная запись облачного приложения HR**. это приложение соединителя подготовки упрощает обратную запись адресов электронной почты пользователей из Azure AD в облачное приложение отдела кадров.

Например, на следующем рисунке приведен список приложений соединителя Workday, доступных в коллекции приложений Azure AD.

![Коллекция приложений портала Azure Active Directory](media/plan-cloud-hr-provision/plan-cloudhr-provisioning-img2.png)

### <a name="decision-flow-chart"></a>Схема потока принятия решений

Используйте следующую диаграмму потока принятия решений, чтобы определить, какие облачные приложения для подготовки персонала относятся к вашему сценарию.

![Схема потока принятия решений](media/plan-cloud-hr-provision/plan-cloudhr-provisioning-img3.png)

## <a name="design-the-azure-ad-connect-provisioning-agent-deployment-topology"></a>Проектирование топологии развертывания агента подготовки Azure AD Connect

Для интеграции подготовки между облачным приложением отдела кадров и Active Directory требуется четыре компонента:

- Клиент облачного приложения для отдела кадров
- Приложение соединителя подготовки
- Агент подготовки Azure AD Connect
- Домен Active Directory

Топология развертывания Azure AD Connect подготовки агента зависит от количества клиентов облачных приложений отдела кадров и Active Directory дочерних доменов, которые планируется интегрировать. Если у вас несколько доменов Active Directory, это зависит от того, являются ли домены Active Directory [смежными или](/windows-server/identity/ad-ds/plan/disjoint-namespace)несвязанными.

В зависимости от вашего решения выберите один из сценариев развертывания:

- Клиент облачного приложения для одного облака — > назначение одного или нескольких Active Directory дочерних доменов в доверенном лесу
- Клиент облачного приложения отдела кадров с одним облаком — > нацеливание нескольких дочерних доменов в несвязанном Active Directory лесу

### <a name="single-cloud-hr-app-tenant---target-single-or-multiple-active-directory-child-domains-in-a-trusted-forest"></a>Клиент облачного приложения для одного облака — > назначение одного или нескольких Active Directory дочерних доменов в доверенном лесу

Мы рекомендуем использовать следующую рабочую конфигурацию:

|Требование|Рекомендация|
|:-|:-|
|Число Azure AD Connect агентов подготовки к развертыванию|Два (для обеспечения высокой доступности и отработки отказа)
|Число настраиваемых приложений соединителя подготовки|Одно приложение на дочерний домен|
|Узел сервера для агента подготовки Azure AD Connect|Windows 2012 R2 + с линейкой для георазмещенных Active Directory контроллеров домена</br>Может сосуществовать со службой Azure AD Connect|

![Потоковая передача в локальные агенты](media/plan-cloud-hr-provision/plan-cloudhr-provisioning-img4.png)

### <a name="single-cloud-hr-app-tenant---target-multiple-child-domains-in-a-disjoint-active-directory-forest"></a>Клиент облачного приложения отдела кадров с одним облаком — > нацеливание нескольких дочерних доменов в несвязанном Active Directory лесу

В этом сценарии предполагается подготовка пользователей из облачного приложения отдела кадров к доменам в неприсоединенных Active Directory лесах.

Мы рекомендуем использовать следующую рабочую конфигурацию:

|Требование|Рекомендация|
|:-|:-|
|Число агентов подготовки Azure AD Connect для развертывания в локальной среде|Два неприсоединенных Active Directory леса|
|Число настраиваемых приложений соединителя подготовки|Одно приложение на дочерний домен|
|Узел сервера для агента подготовки Azure AD Connect|Windows 2012 R2 + с линейкой для георазмещенных Active Directory контроллеров домена</br>Может сосуществовать со службой Azure AD Connect|

![НеActive Directoryный лес несвязанного облачного приложения отдела кадров](media/plan-cloud-hr-provision/plan-cloudhr-provisioning-img5.png)

### <a name="azure-ad-connect-provisioning-agent-requirements"></a>Требования к агенту подготовки Azure AD Connect

Облачное приложение отдела кадров для Active Directory решение подготовки пользователей требует развертывания одного или нескольких агентов подготовки Azure AD Connect на серверах под управлением Windows 2012 R2 или более поздней версии. На серверах должно быть не менее 4 ГБ ОЗУ и .NET 4.7.1 + Runtime. Убедитесь, что сервер узла имеет сетевой доступ к целевому домену Active Directory.

Чтобы подготовить локальную среду, мастер настройки агента Azure AD Connect подготовки регистрирует агент в клиенте Azure AD, [открывает порты](../manage-apps/application-proxy-add-on-premises-application.md#open-ports), [разрешает доступ к URL-адресам](../manage-apps/application-proxy-add-on-premises-application.md#allow-access-to-urls)и поддерживает [исходящую конфигурацию прокси-сервера HTTPS](../saas-apps/workday-inbound-tutorial.md#how-do-i-configure-the-provisioning-agent-to-use-a-proxy-server-for-outbound-http-communication).

Агент подготовки использует учетную запись службы для взаимодействия с доменами Active Directory. Перед установкой агента создайте учетную запись службы в Active Directory пользователи и компьютеры, которые соответствуют следующим требованиям:

- Пароль, срок действия которого не истекает
- Делегированные разрешения CONTROL на чтение, создание, удаление учетных записей пользователей и управление ими

Вы можете выбрать контроллеры домена, которые должны выполнять запросы на подготовку. При наличии нескольких географически распределенных контроллеров домена установите агент подготовки на том же сайте, что и предпочитаемый контроллер домена. Это размещение повышает надежность и производительность комплексного решения.

Для обеспечения высокой доступности можно развернуть более одного агента подготовки Azure AD Connect. Зарегистрируйте агент, чтобы он обрабатывал один и тот же набор локальных Active Directory доменов.

## <a name="plan-scoping-filters-and-attribute-mapping"></a>Планирование фильтров области и сопоставления атрибутов

При включении подготовки из облачного приложения отдела кадров к Active Directory или Azure AD портал Azure определяет значения атрибутов с помощью сопоставления атрибутов.

### <a name="define-scoping-filters"></a>Определение фильтров области

Используйте [фильтры области](../app-provisioning/define-conditional-rules-for-provisioning-user-accounts.md) , чтобы определить правила на основе атрибутов, которые определяют, какие пользователи должны быть подготовлены из облачного приложения отдела кадров для Active Directory или Azure AD.

При запуске процесса соединений необходимо выполнить следующие требования.

- Используется ли облачное приложение для отдела кадров, которое позволяет использовать как сотрудников, так и работников зависимости?
- Планируете ли вы использовать облачное приложение HR для подготовки пользователей в Azure AD для управления сотрудниками и рабочими работниками?
- Планируется ли развертывание облачного приложения отдела кадров в службе подготовки пользователей Azure AD только для подмножества облачных пользователей приложения отдела кадров? Примером может быть только сотрудники.

В зависимости от требований при настройке сопоставлений атрибутов можно задать поле **область исходного объекта** , чтобы выбрать, какие наборы пользователей в облачном приложении отдела кадров должны находиться в области подготовки для Active Directory. Дополнительные сведения см. в руководстве по облачному приложению для работы с персоналом для часто используемых фильтров области.

### <a name="determine-matching-attributes"></a>Определение соответствующих атрибутов

С помощью подготовки вы получаете возможность сопоставлять существующие учетные записи между исходной и целевой системами. При интеграции облачного приложения отдела кадров с помощью службы подготовки Azure AD можно [настроить сопоставление атрибутов](../app-provisioning/configure-automatic-user-provisioning-portal.md#mappings) , чтобы определить, какие данные пользователя должны передаваться из облачного приложения отдела кадров в Active Directory или Azure AD.

При запуске процесса соединений необходимо выполнить следующие требования.

- Какой уникальный идентификатор в этом облачном приложении отдела кадров используется для идентификации каждого пользователя?
- С точки зрения жизненного цикла идентификации, как вы обрабатываете перенять? Сохраняют ли вы старые идентификаторы сотрудников?
- Вы обрабатываете свои сотрудники в будущем и создаете Active Directory учетные записи для них заранее?
- С точки зрения жизненного цикла идентификации, как вы обрабатываете преобразование сотрудника в зависимости от работника или иным образом?
- Будут ли преобразованные пользователи удерживать старые учетные записи Active Directory или они получат новые?

В зависимости от требований Azure AD поддерживает прямое сопоставление атрибута с атрибутом, предоставляя постоянные значения или [записывая выражения для сопоставлений атрибутов](../app-provisioning/functions-for-customizing-application-data.md). Такая гибкость позволяет получить максимальный контроль над тем, что заполняется в атрибуте целевого приложения. Вы можете использовать [API Microsoft Graph](../app-provisioning/export-import-provisioning-configuration.md) и Graph Explorer, чтобы экспортировать сопоставления атрибутов подготовки пользователей и схемы в JSON-файл и импортировать их обратно в Azure AD.

По умолчанию атрибут в облачном приложении HR, представляющий уникальный идентификатор сотрудника, используется в качестве соответствующего атрибута, *сопоставленного с уникальным атрибутом в Active Directory.* Например, в сценарии с приложением Workday атрибут **workday** **воркерид** сопоставляется с атрибутом Active Directory **EmployeeID** .

Можно задать несколько совпадающих атрибутов и назначить приоритет сопоставления. Они оцениваются по приоритету сопоставления. Как только соответствие найдено, дальнейшие атрибуты сопоставления не вычисляются.

Можно также [настроить сопоставления атрибутов по умолчанию](../app-provisioning/customize-application-attributes.md#understanding-attribute-mapping-types), такие как изменение или удаление существующих сопоставлений атрибутов. Вы также можете создавать новые сопоставления атрибутов в соответствии с потребностями бизнеса. Дополнительные сведения см. в руководстве по облачному приложению для работы с персоналом (например, [Workday](../saas-apps/workday-inbound-tutorial.md#managing-your-configuration)) для получения списка настраиваемых атрибутов для сопоставлений.

### <a name="determine-user-account-status"></a>Определение состояния учетной записи пользователя

По умолчанию приложение соединителя подготовки сопоставляет состояние профиля пользователя HR с состоянием учетной записи пользователя в Active Directory или Azure AD, чтобы определить, следует ли включить или отключить учетную запись пользователя.

При запуске процесса Joins-Леаверс, соберите следующие требования.

| Как это работает | Требования |
| - | - |
| **Отсоединение** | С точки зрения жизненного цикла идентификации, как вы обрабатываете перенять? Сохраняют ли вы старые идентификаторы сотрудников? |
| | Вы обрабатываете свои сотрудники в будущем и создаете Active Directory учетные записи для них заранее? Созданы ли эти учетные записи в включенном или отключенном состоянии? |
| | С точки зрения жизненного цикла идентификации, как вы обрабатываете преобразование сотрудника в зависимости от работника или иным образом? |
| | Будут ли преобразованные пользователи удерживать старые учетные записи Active Directory или они получат новые? |
| **леаверс** | Обрабатываются ли прерывания по-разному для сотрудников и рабочих работников в Active Directory? |
| | Какие эффективные даты учитываются при обработке завершения работы пользователя? |
| | Как преобразование «сотрудник» и «исполнитель работника» влияет на существующие учетные записи Active Directory? |
| | Как обработать операцию «отменить» в Active Directory? Операции «отменить» необходимо обрабатывать, если в Active Directory в рамках процесса объединения создаются будущие сотрудники. |

В зависимости от требований вы можете настроить логику сопоставления с помощью [выражений Azure AD](../app-provisioning/functions-for-customizing-application-data.md) , чтобы учетная запись Active Directory была включена или отключена на основе сочетания точек данных.

### <a name="map-cloud-hr-app-to-active-directory-user-attributes"></a>Сопоставьте облачное приложение отдела кадров с Active Directory пользовательскими атрибутами

Каждое облачное приложение отдела кадров поставляется с облачным приложением по умолчанию для Active Directory сопоставлений.

При запуске процесса отсоединений-перевозчиков-Леаверс, соберите следующие требования.

| Как это работает | Требования |
| - | - |
| **Отсоединение** | Active Directory процесс создания учетной записи вручную, автоматически или частично автоматизирован? |
| | Вы планируете распространить пользовательские атрибуты из облачного приложения отдела кадров, чтобы Active Directory? |
| **Перевозчик** | Какие атрибуты вы хотите обработать при каждом выполнении операции перевозчика в облачном приложении отдела кадров? |
| | Выполняются ли во время обновлений пользователей конкретные проверки атрибутов? Если да, укажите сведения. |
| **леаверс** | Обрабатываются ли прерывания по-разному для сотрудников и рабочих работников в Active Directory? |
| | Какие эффективные даты учитываются при обработке завершения работы пользователя? |
| | Как преобразовываются сотрудники и взаимозависимости работников на существующие Active Directory учетные записи? |

В зависимости от требований вы можете изменить сопоставления в соответствии с целями интеграции. Дополнительные сведения см. в руководстве по облачному приложению для работы с персоналом (например, [Workday](../saas-apps/workday-inbound-tutorial.md#part-4-configure-attribute-mappings)) для получения списка настраиваемых атрибутов для сопоставлений.

### <a name="generate-a-unique-attribute-value"></a>Создание уникального значения атрибута

При запуске процесса объединения может потребоваться создать уникальные значения атрибутов при задании таких атрибутов, как CN, samAccountName и UPN, имеющих ограничения UNIQUE.

Функция Azure AD [селектуникуевалуес](../app-provisioning/functions-for-customizing-application-data.md#selectuniquevalue) оценивает каждое правило, а затем проверяет значение, созданное для уникальности в целевой системе. Пример см. в разделе [Создание уникального значения для атрибута userPrincipalName (UPN)](../app-provisioning/functions-for-customizing-application-data.md#generate-unique-value-for-userprincipalname-upn-attribute).

> [!NOTE]
> Эта функция в настоящее время поддерживается только для Active Directory рабочего дня для подготовки пользователей. Его нельзя использовать с другими приложениями подготовки.

### <a name="configure-active-directory-ou-container-assignment"></a>Настройка назначения контейнера Active Directory подразделения

Распространенным требованием является размещение Active Directory учетных записей пользователей в контейнерах на основе бизнес-подразделений, расположений и отделов. При инициации процесса перевозчика и при изменении организационной Организации может потребоваться переместить пользователя из одного подразделения в другое в Active Directory.

Используйте функцию [switch ()](../app-provisioning/functions-for-customizing-application-data.md#switch) для настройки бизнес-логики назначения подразделения и сопоставьте ее с Active Directory атрибутом **парентдистингуишеднаме**.

Например, если вы хотите создать пользователей в подразделении, основанном на **органе власти**атрибута HR, можно использовать следующее выражение:

`
Switch([Municipality], "OU=Default,OU=Users,DC=contoso,DC=com", "Dallas", "OU=Dallas,OU=Users,DC=contoso,DC=com", "Austin", "OU=Austin,OU=Users,DC=contoso,DC=com", "Seattle", "OU=Seattle,OU=Users,DC=contoso,DC=com", "London", "OU=London,OU=Users,DC=contoso,DC=com")
`

В этом выражении, если значение органа государственной власти — Dallas, Остин, Сиэтл или Лондон, учетная запись пользователя будет создана в соответствующем подразделении. Если совпадений нет, учетная запись создается в подразделении по умолчанию.

## <a name="plan-for-password-delivery-of-new-user-accounts"></a>Планирование доставки паролей для новых учетных записей пользователей

При запуске процесса объединения необходимо задать и доставить временный пароль для новых учетных записей пользователей. С облачным персоналом для подготовки пользователей в Azure AD вы можете развернуть возможность [самостоятельного сброса пароля](../authentication/tutorial-enable-sspr.md) Azure AD (SSPR) для пользователя в первый день.

SSPR — это простое средство для ИТ-администраторов, позволяющих пользователям сбрасывать пароли или разблокирование их учетных записей. Вы можете подготавливать атрибут **номера мобильного устройства** из облачного приложения отдела кадров, чтобы Active Directory и синхронизировать его с Azure AD. После использования атрибута **номер мобильного устройства** в Azure AD можно включить SSPR для учетной записи пользователя. Затем в первый раз новый пользователь может использовать зарегистрированный и проверенный номер мобильного устройства для проверки подлинности.

## <a name="plan-for-initial-cycle"></a>Планирование начального цикла

Когда служба подготовки Azure AD запускается впервые, она выполняет [первоначальный цикл](../app-provisioning/how-provisioning-works.md#initial-cycle) работы с облачным приложением отдела кадров для создания моментального снимка всех объектов-пользователей в облачном приложении отдела кадров. Время, затрачиваемое на начальные циклы, непосредственно зависит от количества пользователей, имеющихся в исходной системе. Начальный цикл для некоторых клиентов облачных приложений отдела кадров с более чем 100 000 пользователями может занять много времени.

**Для больших клиентов облачных приложений отдела кадров (>30 000 пользователей)** запустите начальный цикл в прогрессивных стадиях. Запускайте добавочные обновления только после проверки того, что в Active Directory для различных сценариев подготовки пользователей заданы правильные атрибуты. Следуйте указаниям в этом порядке.

1. Запустите начальный цикл только для ограниченного набора пользователей, задав [Фильтр области](#plan-scoping-filters-and-attribute-mapping).
2. Проверьте Active Directory подготовки учетных записей и значения атрибутов, заданные для пользователей, выбранных для первого запуска. Если результат соответствует ожиданиям, разверните фильтр области, чтобы добавить больше пользователей и проверить результаты второго запуска.

Когда вы удовлетворены результатами начального цикла для тестовых пользователей, запустите [добавочные обновления](../app-provisioning/how-provisioning-works.md#incremental-cycles).

## <a name="plan-testing-and-security"></a>Планирование тестирования и безопасности

На каждом этапе развертывания из начального пилотного проекта путем включения подготовки пользователей убедитесь, что вы тестируете ожидаемые результаты и аудит циклов подготовки.

### <a name="plan-testing"></a>Планирование тестирования

После настройки облачного приложения HR для подготовки пользователей в Azure AD выполните тестовые случаи, чтобы проверить, соответствует ли это решение требованиям вашей организации.

|Сценарии|Ожидаемые результаты|
|:-|:-|
|Новый сотрудник принят на работу в облачном приложении отдела кадров.| — Учетная запись пользователя подготовлена в Active Directory.</br>— Пользователь может войти в Active Directory приложения домена и выполнить необходимые действия.</br>— Если настроена синхронизация Azure AD Connect, учетная запись пользователя также создается в Azure AD.
|Пользователь завершает работу в облачном приложении отдела кадров.|— Учетная запись пользователя отключена в Active Directory.</br>— Пользователь не может войти в корпоративные приложения, защищенные Active Directory.
|Пользовательская организация обновляется в облачном приложении отдела кадров.|На основе сопоставления атрибутов учетная запись пользователя перемещается из одного подразделения в другое в Active Directory.|
|HR обновляет руководителя пользователя в облачном приложении отдела кадров.|Поле руководителя в Active Directory обновляется в соответствии с именем нового руководителя.|
|HR перенимает сотрудника на новую роль.|Поведение зависит от того, как облачное приложение отдела кадров настроено для создания идентификаторов сотрудников:</br>— Если старый идентификатор сотрудника повторно используется для перенайма, соединитель включает существующую учетную запись Active Directory для пользователя.</br>— Если при повторном найме получается новый идентификатор сотрудника, соединитель создает для пользователя новую учетную запись Active Directory.|
|HR преобразует сотрудника в контрактный работник или наоборот.|Новая учетная запись Active Directory создается для нового персонажа, а старая учетная запись отключается на период действия преобразования.|

Используйте предыдущие результаты, чтобы определить, как перенести автоматическую реализацию подготовки пользователей в рабочую среду на основе установленных временных шкал.

> [!TIP]
> Используйте такие методы, как сокращение данных и очистка данных при обновлении тестовой среды с рабочими данными для удаления или маскирования конфиденциальных персональных данных в соответствии со стандартами конфиденциальности и безопасности. 

### <a name="plan-security"></a>Планирование безопасности

Как правило, проверка безопасности должна быть необходима в рамках развертывания новой службы. Если проверка безопасности обязательна или не была проведена, ознакомьтесь с [техническими](https://www.microsoft.com/download/details.aspx?id=36391) документами Azure AD, содержащими общие сведения об удостоверении в качестве службы.

### <a name="plan-rollback"></a>Планирование отката

Реализация подготовки пользователей в Cloud HR может не работать, как требуется в рабочей среде. Если да, то следующие шаги отката могут помочь при возврате к предыдущему известному работоспособному состоянию.

1. Ознакомьтесь с [сводным отчетом по подготовке](../app-provisioning/check-status-user-account-provisioning.md#getting-provisioning-reports-from-the-azure-portal) и [журналами подготовки](../app-provisioning/check-status-user-account-provisioning.md#provisioning-logs-preview) , чтобы определить, какие неправильные операции выполнялись для затронутых пользователей или групп. Дополнительные сведения о сводном отчете по подготовке и журналах см. в статье [Управление подготовкой пользователей облачных приложений управления персоналом](#manage-your-configuration).
2. Последнее известное хорошее состояние затронутых пользователей или групп можно определить с помощью журналов аудита подготовки или путем просмотра целевых систем (Azure AD или Active Directory).
3. Обратитесь к владельцу приложения для обновления пользователей или групп, затронутых непосредственно в приложении, с помощью последних известных значений состояния.

## <a name="deploy-the-cloud-hr-app"></a>Развертывание облачного приложения отдела кадров

Выберите облачное приложение отдела кадров, которое соответствует требованиям вашего решения.

**Workday**: чтобы импортировать профили рабочих ролей из Workday в Active Directory и Azure AD, см. [руководство по настройке Workday для автоматической подготовки пользователей](../saas-apps/workday-inbound-tutorial.md#planning-your-deployment). При необходимости можно записать адрес электронной почты, имя пользователя и номер телефона в Workday.

**SAP SuccessFactors**: чтобы импортировать профили рабочих ролей из SuccessFactors в Active Directory и Azure AD, см. [руководство по настройке SAP SuccessFactors для автоматической подготовки пользователей](../saas-apps/sap-successfactors-inbound-provisioning-tutorial.md). При необходимости можно записать адрес электронной почты и имя пользователя в SuccessFactors.

## <a name="manage-your-configuration"></a>Управление конфигурацией

Azure AD может предоставить дополнительные сведения об использовании и работоспособности подготовки пользователей в Организации с помощью журналов аудита и отчетов.

### <a name="gain-insights-from-reports-and-logs"></a>Получение ценных сведений из отчетов и журналов

После успешного выполнения [начального цикла](../app-provisioning/how-provisioning-works.md#initial-cycle)служба подготовки Azure AD продолжит выполнять добавочные обновления на неопределенное время с интервалами, определенными в руководствах для каждого приложения, до тех пор, пока не произойдет одно из следующих событий:

- Служба остановлена вручную. Новый начальный цикл запускается с помощью [портал Azure](https://portal.azure.com/) или соответствующей команды [API Microsoft Graph](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-overview) .
- Новый начальный цикл активируется за нечувствительного изменения сопоставления атрибутов или фильтров области.
- Процесс подготовки переходит в карантин из-за высокой частоты ошибок. Он остается в карантине более четырех недель, после чего он автоматически отключается.

Чтобы просмотреть эти события и все другие действия, выполняемые службой подготовки, Узнайте, [как просматривать журналы и получать отчеты о действиях по подготовке](../app-provisioning/check-status-user-account-provisioning.md).

#### <a name="azure-monitor-logs"></a>Журналы Azure Monitor

Все действия, выполняемые службой подготовки, записываются в журналы аудита Azure AD. Вы можете направить журналы аудита Azure AD в журналы Azure Monitor для дальнейшего анализа. С помощью журналов Azure Monitor (также называемых Log Analytics рабочей областью) можно запрашивать данные для поиска событий, анализа тенденций и выполнения корреляции между различными источниками данных. Просмотрите это [видео](https://youtu.be/MP5IaCTwkQg) , чтобы узнать о преимуществах использования журналов Azure Monitor для журналов Azure AD в практических сценариях пользователя.

Установите [представления log Analytics для журналов действий Azure AD](../reports-monitoring/howto-install-use-log-analytics-views.md) , чтобы получить доступ к предварительно [созданным отчетам о](https://github.com/AzureAD/Deployment-Plans/tree/master/Log%20Analytics%20Views) событиях подготовки в вашей среде.

Дополнительные сведения см. в статье [Анализ журналов действий Azure AD с помощью журналов Azure Monitor](../reports-monitoring/howto-analyze-activity-logs-log-analytics.md).

### <a name="manage-personal-data"></a>Управление персональными данными

Azure AD Connect агент подготовки, установленный на сервере Windows Server, создает журналы в журнале событий Windows, которые могут содержать персональные данные в зависимости от облачного приложения отдела кадров для Active Directory сопоставлений атрибутов. Чтобы обеспечить соблюдение требований к конфиденциальности пользователей, настройте запланированную задачу Windows на очистку журнала событий и убедитесь, что данные не хранятся дольше 48 часов.

Служба подготовки Azure AD не создает отчеты, не выполняет аналитику или предоставляет подробные сведения за 30 дней, так как служба не хранит, не обрабатывает и не сохраняет данные за 30 дней.

### <a name="troubleshoot"></a>Диагностика

Сведения об устранении неполадок, которые могут возникать во время подготовки, см. в следующих статьях:

- [Проблема при настройке подготовки пользователей для приложения из коллекции Azure AD](application-provisioning-config-problem.md)
- [Синхронизация атрибута из локального Active Directory с Azure AD для подготовки приложения](user-provisioning-sync-attributes-for-mapping.md)
- [Проблема сохранения учетных данных администратора при настройке подготовки пользователей для приложения из коллекции Azure Active Directory](application-provisioning-config-problem-storage-limit.md)
- [Пользователи для приложения в коллекции Azure AD не подготавливаются](application-provisioning-config-problem-no-users-provisioned.md)
- [Подготовка неправильного набора пользователей для приложения в коллекции Azure AD](application-provisioning-config-problem-wrong-users-provisioned.md)
- [Настройка средства просмотра событий Windows для устранения неполадок агента](../saas-apps/workday-inbound-tutorial.md#setting-up-windows-event-viewer-for-agent-troubleshooting)
- [Настройка журналов аудита на портале Azure для устранения неполадок службы](../saas-apps/workday-inbound-tutorial.md#setting-up-azure-portal-audit-logs-for-service-troubleshooting)
- [Общие сведения о журналах операций создания учетных записей пользователей AD](../saas-apps/workday-inbound-tutorial.md#understanding-logs-for-ad-user-account-create-operations)
- [Общие сведения о журналах операций обновления руководителя](../saas-apps/workday-inbound-tutorial.md#understanding-logs-for-manager-update-operations)
- [Устранение распространенных ошибок](../saas-apps/workday-inbound-tutorial.md#resolving-commonly-encountered-errors)

### <a name="next-steps"></a>Дальнейшие действия

- [Запись выражений для сопоставления атрибутов](functions-for-customizing-application-data.md)
- [Общие сведения об API синхронизации Azure AD](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-overview)
- [Пропуск удаления учетных записей пользователей, которые выходят за пределы области](skip-out-of-scope-deletions.md)
- [Агент подготовки Azure AD Connect: журнал выпусков версий](provisioning-agent-release-version-history.md)