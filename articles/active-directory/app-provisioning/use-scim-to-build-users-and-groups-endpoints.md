---
title: Создание конечной точки SCIM для подготовки пользователей к приложениям из Azure Active Directory
description: Научитесь разрабатывать конечную точку SCIM, интегрировать API SCIM с Azure AD и автоматически подготавливая пользователей и группы в облачных приложениях с помощью Azure Active Directory.
services: active-directory
author: kenwith
manager: daveba
ms.service: active-directory
ms.subservice: app-provisioning
ms.workload: identity
ms.topic: conceptual
ms.date: 01/27/2021
ms.author: kenwith
ms.reviewer: arvinh
ms.openlocfilehash: 9fac8db6747d1e081fa884ed794e55b98f44577f
ms.sourcegitcommit: 227b9a1c120cd01f7a39479f20f883e75d86f062
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/18/2021
ms.locfileid: "100652043"
---
# <a name="tutorial-develop-a-sample-scim-endpoint"></a>Руководство. Разработка образца конечной точки SCIM

Никто не хочет создавать новую конечную точку с нуля, поэтому мы создали некоторый [справочный код](https://aka.ms/scimreferencecode) , чтобы приступить к работе с [системой для управления междоменными удостоверениями (scim)](https://aka.ms/scimoverview). Вы можете получить и запустить конечную точку SCIM без кода всего за пять минут.

В этом руководстве описывается, как развернуть справочный код SCIM в Azure и протестировать его с помощью процедуры POST или путем интеграции с клиентом Azure Active Directory (Azure AD) SCIM. Это руководство предназначено для разработчиков, желающих начать работу с SCIM или любым пользователем, заинтересованным в тестировании конечной точки SCIM.

В этом руководстве описано следующее:

> [!div class="checklist"]
>
> * Разверните конечную точку SCIM в Azure.
> * Протестируйте конечную точку SCIM.

## <a name="deploy-your-scim-endpoint-in-azure"></a>Развертывание конечной точки SCIM в Azure

В этом разделе описывается развертывание конечной точки SCIM в службе с помощью [Visual Studio 2019](https://visualstudio.microsoft.com/downloads/) и [службы приложений Azure](https://docs.microsoft.com/azure/app-service/). Справочный код SCIM также можно запустить локально, разместить на локальном сервере или развернуть в другой внешней службе.

1. Перейдите к [коду ссылки](https://github.com/AzureAD/SCIMReferenceCode) из GitHub и выберите **клонировать или скачать**.

1. Выберите **Открыть в рабочем столе** или скопируйте ссылку, откройте Visual Studio и выберите Копировать **или извлечь код** , чтобы ввести скопированную ссылку и создать локальную копию.

1. В Visual Studio обязательно войдите в учетную запись, которая имеет доступ к ресурсам размещения.

1. В обозреватель решений откройте *Microsoft. scim. sln* и щелкните правой кнопкой мыши файл *Microsoft. scim. вебхостсампле* . Нажмите кнопку **Опубликовать**.

    ![Снимок экрана, на котором показан пример файла.](media/use-scim-to-build-users-and-groups-endpoints/cloud-publish.png)

    > [!NOTE]
    > Чтобы запустить это решение локально, дважды щелкните проект и выберите **IIS Express** , чтобы запустить проект как веб-страницу с URL-адресом локального узла.

1. Выберите **создать профиль** и убедитесь, что выбран пункт **служба приложений** и **создать новую** .

    ![Снимок экрана, на котором показано окно публикации.](media/use-scim-to-build-users-and-groups-endpoints/cloud-publish-2.png)

1. Пошаговое применение параметров диалогового окна и переименование приложения в нужное имя. Это имя используется как в приложении, так и в URL-адресе конечной точки SCIM.

    ![Снимок экрана, показывающий создание новой службы приложений.](media/use-scim-to-build-users-and-groups-endpoints/cloud-publish-3.png)

1. Выберите группу ресурсов для использования и нажмите кнопку **опубликовать**.

1. Перейдите к приложению в конфигурации **службы приложений Azure**  >   и выберите **новый параметр приложения** , чтобы добавить параметр *Token__TokenIssuer* со значением `https://sts.windows.net/<tenant_id>/` . Замените `<tenant_id>` идентификатором клиента Azure AD. Если вы хотите протестировать конечную точку SCIM с помощью [процедуры POST](https://github.com/AzureAD/SCIMReferenceCode/wiki/Test-Your-SCIM-Endpoint), добавьте параметр *ASPNETCORE_ENVIRONMENT* со значением `Development` .

   ![Снимок экрана, на котором показано окно параметров приложения.](media/use-scim-to-build-users-and-groups-endpoints/app-service-settings.png)

   При тестировании конечной точки с корпоративным приложением в [портал Azure](use-scim-to-provision-users-and-groups.md#integrate-your-scim-endpoint-with-the-aad-scim-client)есть два варианта. Среду можно сохранить в среде `Development` и предоставить маркер тестирования из `/scim/token` конечной точки. Кроме того, можно изменить среду на `Production` и оставить поле токена пустым.

Вот и все! Теперь конечная точка SCIM опубликована, и вы можете использовать URL-адрес службы приложений Azure для проверки конечной точки SCIM.

## <a name="test-your-scim-endpoint"></a>Тестирование конечной точки SCIM

Для запросов к конечной точке SCIM требуется авторизация. SCIM Standard имеет несколько вариантов проверки подлинности и авторизации, включая файлы cookie, обычную проверку подлинности клиента TLS или любой из методов, перечисленных в [RFC 7644](https://tools.ietf.org/html/rfc7644#section-2).

Не забудьте избежать безопасных методов, таких как имя пользователя и пароль, в пользу более безопасного метода, такого как OAuth. Azure AD поддерживает долгосрочные токены носителя (для приложений коллекции и не из коллекции) и предоставление авторизации OAuth (для приложений из коллекции).

> [!NOTE]
> Методы авторизации, предоставляемые в репозитории, предназначены только для тестирования. При интеграции с Azure AD можно ознакомиться с руководством по авторизации. См. раздел [Подготовка плана для конечной точки scim](use-scim-to-provision-users-and-groups.md).

Среда разработки включает функции, которые не являются надежными для рабочей среды, например справочный код для управления поведением проверки маркера безопасности. Код проверки маркера использует самозаверяющий маркер безопасности, а ключ подписывания хранится в файле конфигурации. См. параметр **Token: иссуерсигнингкэй** в *appsettings.Development.js* в файле.

```json
"Token": {
    "TokenAudience": "Microsoft.Security.Bearer",
    "TokenIssuer": "Microsoft.Security.Bearer",
    "IssuerSigningKey": "A1B2C3D4E5F6A1B2C3D4E5F6",
    "TokenLifetimeInMins": "120"
}
```

> [!NOTE]
> При отправке запроса **Get** к `/scim/token` конечной точке выдается маркер с помощью настроенного ключа. Этот маркер можно использовать в качестве токена носителя для последующей авторизации.

Код проверки токена по умолчанию настроен для использования маркера Azure AD и требует настройки выдающего клиента с помощью параметра **Token: токениссуер** в *appsettings.js* в файле.

``` json
"Token": {
    "TokenAudience": "8adf8e6e-67b2-4cf2-a259-e3dc5476c621",
    "TokenIssuer": "https://sts.windows.net/<tenant_id>/"
}
```

### <a name="use-postman-to-test-endpoints"></a>Использование POST для тестирования конечных точек

После развертывания конечной точки SCIM можно проверить, чтобы убедиться, что она совместима с SCIM RFC. В этом примере представлен набор тестов в POST, проверяющих операции CRUD (создание, чтение, обновление и удаление) для пользователей и групп, фильтрацию, обновление членства в группах и отключение пользователей.

Конечные точки находятся в `{host}/scim/` каталоге, и для взаимодействия с ними можно использовать стандартные HTTP-запросы. Сведения об изменении `/scim/` маршрута см. в разделе *ControllerConstant.CS* in **азуреадпровисионингсЦимреференце**  >  **сЦимреференцеапи**  >  **Controllers**.

> [!NOTE]
> Конечные точки HTTP можно использовать только для локальных тестов. Служба подготовки Azure AD требует, чтобы конечная точка поддерживала HTTPS.

1. Загрузите программу [POST](https://www.getpostman.com/downloads/) и запустите приложение.
1. Скопируйте и вставьте эту ссылку в POST, чтобы импортировать тестовую коллекцию: `https://aka.ms/ProvisioningPostman` .

    ![Снимок экрана, показывающий импорт тестовой коллекции в POST.](media/use-scim-to-build-users-and-groups-endpoints/postman-collection.png)

1. Создайте тестовую среду, которая содержит следующие переменные:

   |Среда|Переменная|Значение|
   |-|-|-|
   |Запуск проекта в локальной среде с помощью IIS Express|||
   ||**Server**|`localhost`|
   ||**порт**.|`:44359`*(не забывайте **`:`** )*|
   ||**API**|`scim`|
   |Запуск проекта в локальной среде с помощью Kestrel|||
   ||**Server**|`localhost`|
   ||**порт**.|`:5001`*(не забывайте **`:`** )*|
   ||**API**|`scim`|
   |Размещение конечной точки в Azure|||
   ||**Server**|*(введите URL-адрес SCIM)*|
   ||**порт**.|*(оставьте пустым)*|
   ||**API**|`scim`|

1. Чтобы отправить запрос **Get** в конечную точку маркера и получить маркер безопасности, который будет храниться в переменной **токена** для последующих запросов, используйте для **получения ключа** из коллекции POST.

   ![Снимок экрана, показывающий папку после получения ключа.](media/use-scim-to-build-users-and-groups-endpoints/postman-get-key.png)

   > [!NOTE]
   > Чтобы обеспечить безопасность конечной точки SCIM, необходимо получить маркер безопасности перед подключением. В руководстве используется `{host}/scim/token` Конечная точка для создания самозаверяющего маркера.

Вот и все! Теперь можно запустить коллекцию **posts** для проверки функции КОНЕЧНОЙ точки scim.

## <a name="next-steps"></a>Дальнейшие действия

Сведения о разработке SCIM-совместимой конечной точки пользователя и группы с поддержкой взаимодействия для клиента см. в разделе [Реализация клиента scim](http://www.simplecloud.info/#Implementations2).

> [!div class="nextstepaction"]
> [Учебник. Разработка и планирование подготовки для конечной точки scim](use-scim-to-provision-users-and-groups.md) 
>  [Учебник. Настройка подготовки для приложения из коллекции](configure-automatic-user-provisioning-portal.md)
