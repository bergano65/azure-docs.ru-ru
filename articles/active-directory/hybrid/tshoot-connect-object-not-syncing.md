---
title: Устранение неполадок синхронизации объекта с Azure Active Directory | Документация Майкрософт
description: Устранение неполадок синхронизации объекта с Azure Active Directory.
services: active-directory
documentationcenter: ''
author: billmath
manager: daveba
editor: ''
ms.assetid: ''
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/10/2018
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 931865803328189d89c0fbae15caa801c3f7f7c6
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60455236"
---
# <a name="troubleshoot-an-object-that-is-not-synchronizing-with-azure-active-directory"></a>Устранение неполадок синхронизации объекта с Azure Active Directory

Объект может не синхронизироваться должным образом с Microsoft Azure Active Directory (Azure AD) из-за нескольких причин. Если вы получили от Azure AD сообщение об ошибке по электронной почте или ошибка отображается в службе Azure AD Connect Health, ознакомьтесь со статьей [Устранение ошибок синхронизации](tshoot-connect-sync-errors.md). Но если возникла ситуация, при которой объект не находится в Azure AD, эта статья как раз для такого случая. Здесь описывается, как найти ошибки в локальном компоненте под названием "Синхронизация Azure AD Connect".

>[!IMPORTANT]
>Чтобы устранить неполадки с синхронизацией объектов в развертывании Azure AD Connect версии 1.1.749.0 и выше, используйте [задачу устранения неполадок](tshoot-connect-objectsync.md) в мастере. 

## <a name="synchronization-process"></a>Этап синхронизации

Прежде чем исследовать проблемы синхронизации, давайте разберемся с процессом синхронизации Azure AD Connect.

  ![Схема процесса синхронизации Azure AD Connect](./media/tshoot-connect-object-not-syncing/syncingprocess.png)

### <a name="terminology"></a>**Терминология**

* **CS** — пространство соединителя, таблица в базе данных.
* **MV** — метавселенная, таблица в базе данных.

### <a name="synchronization-steps"></a>**Шаги синхронизации**
Процесс синхронизации включает следующие шаги.

1. **Импорт из AD.** Объекты Active Directory переносятся в CS Active Directory.

2. **Импорт из Azure AD.** Объекты Azure AD переносятся в CS Azure AD.

3. **Синхронизация.** Правила входящей и исходящей синхронизации выполняются в порядке номера приоритета от меньшего к большему. Чтобы просмотреть правила синхронизации, перейдите в редактор правил синхронизации из приложений рабочего стола. Правила входящей синхронизации перемещают данные из CS в MV. Правила исходящей синхронизации перемещают данные из MV в CS.

4. **Экспорт в AD.** После синхронизации объекты экспортируются из CS Active Directory в Active Directory.

5. **Экспорт в Azure AD.** После синхронизации объекты экспортируются из CS Azure AD в Azure AD.

## <a name="troubleshooting"></a>Устранение неполадок

Чтобы найти ошибки, просмотрите несколько различных расположений в следующем порядке:

1. [Журналы операций](#operations), чтобы найти зафиксированные ошибки, определяемые модулем синхронизации во время импорта и синхронизации.
2. [Пространство соединителя](#connector-space-object-properties), чтобы найти отсутствующие объекты и ошибки синхронизации.
3. [Метавселенная](#metaverse-object-properties), чтобы найти проблемы, связанные с данными.

Прежде чем выполнять эти действия, запустите [Synchronization Service Manager](how-to-connect-sync-service-manager-ui.md).

## <a name="operations"></a>Операции
Начните устранение неполадок с вкладки **Operations** (Операции) в Synchronization Service Manager. На этой вкладке отображаются результаты последних операций. 

![Снимок экрана Synchronization Service Manager с выбранной вкладкой "Operations" (Операции)](./media/tshoot-connect-object-not-syncing/operations.png)  

В верхней части вкладки **Operations** (Операции) отображены все операции выполнения в хронологическом порядке. По умолчанию журнал операций содержит сведения за последние семь дней, но эту цифру можно изменить с помощью [планировщика](how-to-connect-sync-feature-scheduler.md). Ищите любые операции выполнения, которые не были завершены **успешно**. Вы также можете изменить порядок сортировки, щелкая заголовки.

Столбец **Status** (Состояние) содержит самую важную информацию, он показывает наиболее серьезные проблемы при выполнении. Ниже приводится краткая сводка наиболее распространенных состояний в порядке приоритета исследования (где * означает, что возможно несколько строк ошибки).

| Статус | Комментарий |
| --- | --- |
| stopped-* |Не удалось завершить выполнение. Это могло случиться, например, по причине того, что удаленная система не работает и с ней не удается связаться. |
| stopped-error-limit |Обнаружено более 5000 ошибок. Выполнение было автоматически остановлено из-за большого количества ошибок. |
| completed-\*-errors |Выполнение завершено, но есть ошибки (меньше 5000), которые необходимо изучить. |
| completed-\*-warnings |Запуск завершен, но некоторые данные не находятся в ожидаемом состоянии. Если обнаружены ошибки, такое сообщение обычно является указателем. Не изучайте предупреждения, если вы еще не исправили ошибки. |
| Успешное завершение |Проблемы отсутствуют. |

При выборе строки обновляется нижняя часть вкладки **Operations** (Операции) и отображаются сведения об этой операции выполнения. В крайней левой части этой области может отображаться список с названием **Step #** (Шаг №). Он отображается, только если у вас в лесу несколько доменов и каждый домен представлен шагом. Имя домена можно найти в разделе **Partition**(Секция). В разделе **Synchronization Statistics** (Статистика синхронизации) можно найти дополнительные сведения о числе обработанных изменений. Щелкните ссылки, чтобы получить список измененных объектов. Если у вас есть объекты с ошибками, эти ошибки отображаются в разделе **Synchronization Errors** (Ошибки синхронизации).

### <a name="errors-on-the-operations-tab"></a>Ошибки на вкладке "Operations" (Операции)
Если есть ошибки, Synchronization Service Manager показывает отображаемый в них объект и саму ошибку, представленные ссылками, перейдя по которым можно получить дополнительные сведения.

![Снимок экрана ошибок в Synchronization Service Manager](./media/tshoot-connect-object-not-syncing/errorsync.png)  
Начните с выбора строки ошибки. (На приведенном выше рисунке ошибкой является **sync-rule-error-function-triggered**). Сначала отображается обзор объекта. Чтобы просмотреть фактическую ошибку, щелкните **Stack Trace** (Трассировка стека). Эта трассировка отображает информацию об ошибке уровня отладки.

Щелкните правой кнопкой мыши поле **Call Stack Information** (Сведения о стеке вызовов), после этого щелкните **Select All** (Выбрать все), а затем **Copy** (Копировать). После этого скопируйте стек и просмотрите ошибку в любом редакторе на ваше усмотрение, например в Блокноте.

Если получена ошибка из **SyncRulesEngine**, сведения о стеке вызовов сначала показывают список всех атрибутов объекта. Прокрутите вниз до заголовка **InnerException =>**.  

  ![Снимок экрана Synchronization Service Manager со сведениями об ошибке после заголовка InnerException =>](./media/tshoot-connect-object-not-syncing/errorinnerexception.png)
  
В строке после заголовка отображается ошибка. На предыдущем рисунке ошибка получена из-за создания пользовательского правила синхронизации в Fabrikam.

Если ошибка не содержит достаточно сведений, пора изучить данные. Щелкните ссылку с идентификатором объекта и продолжите устранение неполадок в [импортированном объекте пространства соединителя](#cs-import).

## <a name="connector-space-object-properties"></a>Свойства объекта пространства соединителя
Если на вкладке [**Operations**](#operations) (Операции) не отображаются ошибки, то необходимо отследить объект пространства соединителя, перейдя из Active Directory в метавселенную, а затем — в Azure AD. На этом пути проблема должна быть выявлена.

### <a name="searching-for-an-object-in-the-cs"></a>Поиск объекта в пространстве соединителя

В Synchronization Service Manager откройте раздел **Connectors** (Соединители), выберите соединитель Active Directory, а затем щелкните **Search Connector Space** (Поиск в пространстве соединителя).

В поле **Scope** (Область) выберите **RDN**, если требуется выполнить поиск по атрибуту CN, или **DN or anchor** (Различающееся имя или привязка), если требуется выполнить поиск по атрибуту **distinguishedName**. Введите значение и нажмите кнопку **Search** (Поиск). 
 
![Снимок экрана поиска в пространстве соединителя](./media/tshoot-connect-object-not-syncing/cssearch.png)  

Если не удается найти искомый объект, то он мог быть отфильтрован с помощью [фильтрации по доменам](how-to-connect-sync-configure-filtering.md#domain-based-filtering) или [фильтрации по подразделениям](how-to-connect-sync-configure-filtering.md#organizational-unitbased-filtering). Чтобы проверить правильность настроек фильтрации, ознакомьтесь со статьей [Синхронизация Azure AD Connect: настройка фильтрации](how-to-connect-sync-configure-filtering.md).

Вы можете выполнить другой полезный вариант поиска — выбрать соединитель Azure AD. В поле **Scope** выберите **Pending Import** (Ожидание импорта), а затем установите флажок **Add** (Добавить). При таком поиске отображаются все синхронизируемые в Azure AD объекты, которые не могут быть связаны с локальным объектом.  

![Снимок экрана поиска потерянных объектов в пространстве соединителя](./media/tshoot-connect-object-not-syncing/cssearchorphan.png) 
 
Эти объекты созданы другим модулем синхронизации или модулем синхронизации с другими настройками фильтрации. Управление этими потерянными объектами больше не осуществляется. Просмотрите список и по возможности удалите эти объекты с помощью командлетов [Azure AD PowerShell](https://aka.ms/aadposh).

### <a name="cs-import"></a>Импорт в пространстве соединителя
При открытии объекта CS в верхней части отображаются несколько вкладок. На вкладке **импорта** отображаются данные, добавленные после импорта.  

![Снимок экрана окна со свойствами объекта пространства соединителя с выбранной вкладкой "Import" (Импорт)](./media/tshoot-connect-object-not-syncing/csobject.png)    

В столбце **Old Value** (Старое значение) отображаются объекты, в настоящее время хранящиеся в Connect. В столбце **New Value** (Новое значение) отображаются объекты, полученные из исходной системы и еще не примененные. Если в объекте имеется ошибка,изменения не обрабатываются.

Вкладка **Synchronization Error** (Ошибка синхронизации) отображается в окне **Connector Space Object Properties** (Свойства объекта пространства соединителя) только в том случае, если с объектом есть проблемы. Для получение дополнительных сведений ознакомьтесь с [устранением ошибок синхронизации на вкладке **Operations** (Операции)](#errors-on-the-operations-tab).

![Снимок экрана вкладки "Synchronization Error" (Ошибка синхронизации) в окне "Connector Space Object Properties" (Свойства объекта пространства соединителя)](./media/tshoot-connect-object-not-syncing/cssyncerror.png)  

### <a name="cs-lineage"></a>Журнал преобразований CS
На вкладке **Lineage** (Журнал преобразований) в окне **Connector Space Object Properties** (Свойства объекта пространства соединителя) показано, как объект пространства соединителя связан с объектом метавселенной. Можно увидеть, когда соединитель в последний раз импортировал изменение из подключенной системы и какие правила были применены для внесения данных в метавселенную.  

![Снимок экрана с вкладкой "Lineage" (Журнал преобразований) в окне "Connector Space Object Properties" (Свойства объекта пространства соединителя)](./media/tshoot-connect-object-not-syncing/cslineage.png)  

На предыдущем рисунке в столбце **Action** (Действие) отображается правило входящей синхронизации с действием **подготовки**. Это значит, что объект метавселенной хранится, пока существует этот объект пространства соединителя. Если в списке правил синхронизации отображается правило исходящей синхронизации с действием **подготовки**, это значит, что объект удаляется вместе с объектом метавселенной.  

![Снимок экрана окна журнала преобразований на вкладке "Lineage" (Журнал преобразований) в окне "Connector Space Object Properties" (Свойства объекта пространства соединителя)](./media/tshoot-connect-object-not-syncing/cslineageout.png)  

На предыдущем рисунке в столбце **PasswordSync** (Синхронизация паролей) также видно, что входящее пространство соединителя может вносить изменения в пароль, так как одно правило синхронизации имеет значение **True**. Этот пароль отправляется в Azure AD с помощью правила для исходящего трафика.

Со вкладки **Lineage** (Журнал преобразований) можно перейти к метавселенной. Для этого нужно выбрать [**Metaverse Object Properties**](#mv-attributes) (Свойства объекта метавселенной).

### <a name="preview"></a>Предварительный просмотр
В левом нижнем углу окна **Connector Space Object Properties** (Свойства объекта пространства соединителя) находится кнопка **предварительного просмотра**. Нажмите эту кнопку, чтобы открыть страницу **предварительного просмотра**, на которой вы можете синхронизировать один объект. Эта страница полезна, если необходимо устранить ошибки некоторых пользовательских правил синхронизации и увидеть результат изменения одного объекта. Вы можете выбрать **полную синхронизацию** или **синхронизацию изменений**, а также нажать кнопку **Generate Preview** (Создать предварительный просмотр), чтобы сохранить изменения в памяти, или **Commit Preview** (Просмотр перед фиксацией), чтобы обновить метавселенную и передать все изменения в целевые пространства соединителей.  

![Снимок экрана страницы предварительного просмотра с нажатой кнопкой Start Preview (Начать предварительный просмотр)](./media/tshoot-connect-object-not-syncing/preview.png)  

В предварительном просмотре можно проверить объект и увидеть, какое правило применено к конкретному потоку атрибутов.  

![Снимок экрана страницы предварительного просмотра с потоком атрибутов импорта](./media/tshoot-connect-object-not-syncing/previewresult.png)

### <a name="log"></a>Журнал
Нажмите кнопку **Log** (журнал), которая находится рядом с кнопкой **предварительного просмотра**, чтобы открыть страницу **журнала**. Здесь можно проверить состояние синхронизации пароля и просмотреть историю. Дополнительные сведения см. в статье [Устранение неполадок синхронизации хэшированных паролей в службе синхронизации Azure AD Connect](tshoot-connect-password-hash-synchronization.md).

## <a name="metaverse-object-properties"></a>Свойства объекта метавселенной
Как правило, лучше начинать поиск с исходного пространства соединителя Active Directory. Но также можно начать поиск с метавселенной.

### <a name="searching-for-an-object-in-the-mv"></a>Поиск объекта в метавселенной (MV)
В Synchronization Service Manager щелкните **Metaverse Search** (Поиск в метавселенной), как показано на следующем снимке экрана. Создайте запрос, который точно найдет пользователя. Проведите поиск по распространенным атрибутам, таким как **accountName** (**sAMAccountName**) или **userPrincipalName**. Дополнительные сведения см. в статье [Поиск в метавселенной Synchronization Service Manager](how-to-connect-sync-service-manager-ui-mvsearch.md).

![Снимок экрана Synchronization Service Manager с выбранной вкладкой "Metaverse Search" (Поиск в метавселенной)](./media/tshoot-connect-object-not-syncing/mvsearch.png)  

В окне **Search Results** (Результаты поиска) выберите объект.

Если объект не найден, то он еще не достиг метавселенной. Продолжайте поиск объекта в [пространстве соединителя](#connector-space-object-properties) Active Directory. Если вы найдете объект в пространстве соединителя Active Directory, может произойти ошибка синхронизации, которая блокирует попадание объекта в метавселенную, или может быть применен фильтр области правила синхронизации.

### <a name="object-not-found-in-the-mv"></a>Объект не найден в MV
Если объект находится в CS Active Directory, но отсутствует в MV, применяется фильтр области действия. Чтобы посмотреть фильтр области действия, перейдите в меню классического приложения и выберите **Редактор правил синхронизации**. Отфильтруйте правила, применимые к объекту, настроив фильтр, указанный ниже.

  ![Снимок экрана редактора правил синхронизации, показывающий поиск правил входящей синхронизации](./media/tshoot-connect-object-not-syncing/syncrulessearch.png)

Просмотрите каждое правило в списке выше и проверьте **Фильтр области действия**. Если значение **isCriticalSystemObject** в приведенном далее фильтре области действия пустое или равно NULL или FALSE, оно находится в области действия.

  ![Снимок экрана фильтра области действия в разделе поиска правил входящей синхронизации](./media/tshoot-connect-object-not-syncing/scopingfilter.png)

Перейдите к списку атрибутов [Импорт CS](#cs-import) и проверьте, какой фильтр блокирует перемещение объекта в MV. Список атрибутов **пространства соединителя** будет отображать только непустые атрибуты и атрибуты, которые не равны NULL. Например, если **isCriticalSystemObject** не отображается в списке, значение этого атрибута пустое или равно NULL.

### <a name="object-not-found-in-the-azure-ad-cs"></a>Объект не найден в пространстве соединителя Azure AD
Если объект отсутствует в пространстве соединителя Azure AD, но присутствует в MV, просмотрите фильтр области действия правил исходящего трафика соответствующего пространства соединителя и проверьте, отфильтрован ли объект в связи с несоответствием критериям [атрибутов MV](#mv-attributes).

Чтобы посмотреть исходящий фильтр области действия, выберите соответствующие правила для объекта, настроив фильтр, указанный ниже. Просмотрите каждое правило и соответствующее значение [атрибута MV](#mv-attributes).

  ![Снимок экрана поиска правил исходящей синхронизации в редакторе правил синхронизации](./media/tshoot-connect-object-not-syncing/outboundfilter.png)


### <a name="mv-attributes"></a>Атрибуты метавселенной
На вкладке **Attributes** (Атрибуты) можно просмотреть значения и узнать, какой соединитель их передал.  

![Снимок экрана окна со свойствами объекта метавселенной с выбранной вкладкой "Attributes" (Атрибуты)](./media/tshoot-connect-object-not-syncing/mvobject.png)  

Если объект не синхронизируется, задайте следующие вопросы о состояниях атрибутов в метавселенной.
- Присутствует ли атрибут **cloudFiltered** и задано ли ему значение **True**? Если да, то это значит, что он был отфильтрован, как указано в разделе [Фильтрация по атрибутам](how-to-connect-sync-configure-filtering.md#attribute-based-filtering).
- Присутствует ли атрибут **sourceAnchor**? Если нет, то есть у вас топология леса ресурсов учетной записи? Если объект определяется как связанный почтовый ящик (атрибут **msExchRecipientTypeDetails** имеет значение **2**), атрибут **sourceAnchor** заполняется из леса с действующей учетной записью Active Directory. Убедитесь, что главная учетная запись правильно импортирована и синхронизирована. Главная учетная запись должна быть указана в списке [соединителей](#mv-connectors) для объекта.

### <a name="mv-connectors"></a>Соединители метавселенной
На вкладке **соединителей** отображаются все пространства соединителя, которые включают представление объекта. 
 
![Снимок экрана окна со свойствами объекта метавселенной с выбранной вкладкой "Connectors" (Соединители)](./media/tshoot-connect-object-not-syncing/mvconnectors.png)  

Необходимо иметь соединитель для:

- каждого леса Active Directory, в котором представлен пользователь (это представление может содержать объекты **foreignSecurityPrincipals** и **Contact**).
- соединителя в Azure AD.

Если у вас нет соединителя для Azure AD, ознакомьтесь с разделом об [атрибутах метавселенной](#mv-attributes), чтобы проверить критерии для подготовки в Azure AD.

Из вкладки **соединителей** также можно перейти к [объекту пространства соединителя](#connector-space-object-properties). Выберите строку и щелкните **Свойства**.

## <a name="next-steps"></a>Дальнейшие действия
- [Синхронизация Azure AD Connect: общие сведения о синхронизации и ее настройка](how-to-connect-sync-whatis.md)
- [Что собой представляет гибридная идентификация](whatis-hybrid-identity.md)
