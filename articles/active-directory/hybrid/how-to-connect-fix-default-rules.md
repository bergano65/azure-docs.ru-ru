---
title: Как устранить правила измененные по умолчанию - Azure AD Connect | Документация Майкрософт
description: Сведения об устранении измененные по умолчанию правила, входящие в состав Azure AD Connect.
services: active-directory
author: billmath
manager: daveba
editor: curtand
ms.reviewer: darora10
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 03/21/2019
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 761f3e6e72319a2e63d6b66f2893130ec5a82ebf
ms.sourcegitcommit: c174d408a5522b58160e17a87d2b6ef4482a6694
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59698170"
---
# <a name="fix-modified-default-rules-in-azure-ad-connect"></a>Исправление правила измененные по умолчанию в Azure AD Connect

Azure AD Connect поставляется с правила по умолчанию для синхронизации.  К сожалению, эти правила не применяются глобально ко всем организациям и могут возникнуть ситуации, в соответствии с требованиями, при необходимости измените их.

 Если вы изменили правила по умолчанию или планируете изменить их, сделайте это сейчас, чтобы ознакомиться с этим документом.

В этом документе представлены 2 примеры наиболее распространенных настройки, выполненные пользователями и объясняется правильный способ достижения этих настроек.

>[!NOTE] 
> Изменение существующих правил по умолчанию для достижения необходимые настройки не поддерживается - Это предотвратит обновление до последней версии в будущих выпусках этих правил. Это не позволит начало необходимые исправления ошибок и новые функции.  В этом документе объясняется, как добиться того же результата без изменения существующих правил по умолчанию. 

## <a name="how-to-identify-modified-default-rules"></a>Как определить правила измененные по умолчанию?
Начиная с версии 1.3.7.0 **Azure AD Connect**, теперь стало легче идентифицировать правило измененные по умолчанию. Можно перейти к приложениям на рабочем столе и выберите команду **редактор правил синхронизации**.

![Редактор](media/how-to-connect-fix-default-rules/default1.png)

В редакторе какие-либо правила измененные по умолчанию отображается со значком перед именем как показано ниже:

![icon](media/how-to-connect-fix-default-rules/default2.png)

 Также вы увидите отключенное правило с таким именем рядом с ним, которое является правилом по умолчанию:

![правила по умолчанию](media/how-to-connect-fix-default-rules/default2a.png)

## <a name="common-customizations"></a>Стандартные настройки
Ниже приведены общие настройки для правила по умолчанию.

- [Изменение потока атрибута](#changing-attribute-flow)
- [Изменение фильтра области](#changing-scoping-filter)
- [Изменение условия соединения](#changing-join-condition)

## <a name="before-changing-any-rules"></a>Прежде чем изменять какие-либо правила
- Отключите планировщик синхронизации.  По умолчанию планировщик запускается каждые 30 минут. Чтобы внести изменения и устранить неполадки, связанные с новыми правилами, может потребоваться отключить его. Чтобы временно отключить планировщик, запустите PowerShell и выполните команду `Set-ADSyncScheduler -SyncCycleEnabled $false`.
 ![правила по умолчанию](media/how-to-connect-fix-default-rules/default3.png)

- Изменение фильтра области может привести удалению объектов в целевом каталоге. Будьте внимательны перед внесением любых изменений в определение областей объектов. Рекомендуется вносить изменения на промежуточном сервере, прежде чем вносить изменения на активном сервере.
- Запустите Предварительный просмотр одного объекта, как упоминалось в [проверить правило синхронизации](#validate-sync-rule) раздела, после добавления любое новое правило.
- Запустите полную синхронизацию после добавления нового правила или изменение любого правила синхронизации. Эта синхронизация будет применять новые правила ко всем объектам.

## <a name="changing-attribute-flow"></a>Изменение потока атрибута
Существует 3 различных сценариев для потока атрибута, рассмотрим, как добиться этого без изменения правила по умолчанию.
- При добавлении нового атрибута
- Переопределение значения существующего атрибута.
- Не синхронизировать существующий атрибут

### <a name="adding-new-attribute"></a>Добавление нового атрибута.
Если обнаружится, что атрибут не поступают из исходного каталога в целевом каталоге, а затем можно использовать [синхронизации Azure AD Connect: Расширения каталогов](how-to-connect-sync-feature-directory-extensions.md) к передаче новых атрибутов.

Обратите внимание, что в первую очередь следует использовать [синхронизации Azure AD Connect: Расширения каталогов](how-to-connect-sync-feature-directory-extensions.md), функцию поля, предоставляемые Azure AD Connect. Тем не менее если он не работать на вас, затем выполните следующие действия для потока для атрибута без изменения существующего правила синхронизации по умолчанию, можно сделать это, добавив два новых правила синхронизации.


#### <a name="add-an-inbound-sync-rule"></a>Добавление правила входящей синхронизации:
Входящее правило синхронизации означает, что источником атрибута является пространства соединителя и метавселенной является целевой. Например, для передачи нового атрибута из локальной службы Active Directory в Azure Active Directory, можно создать новое правило входящей синхронизации, запустив **редактор правил синхронизации**, затем выберите направление как **Inbound** и нажмите кнопку **добавить новое правило**. 

 ![правила по умолчанию](media/how-to-connect-fix-default-rules/default3a.png)

Выполните собственные соглашения об именовании для присвойте правилу имя, здесь мы использовали **пользовательских In from AD — пользователь**, это означает, что правила — настраиваемое правило и правило входящего трафика из пространства соединителя AD в метавселенной.   

 ![правила по умолчанию](media/how-to-connect-fix-default-rules/default3b.png)

Предоставить собственное описание правила, чтобы последующее обслуживание правила легко, как и Какова цель это правило и зачем она нужна.
Выберите подключенная система (лес) - источник атрибута. Выберите тип объекта подключенной системы и типа объекта метавселенной.

Укажите значение приоритета в диапазоне от 0 до 99 (понизить приоритет номер выше). Оставьте другие поля, такие как «Tag», «Включить синхронизацию паролей» и «Отключено» по умолчанию.

Keep «фильтр области» пустое, это означает, что правило применяется ко всем объектам, присоединенных к AD подключенные системы с метавселенной.

Оставаться пустым «Правила присоединения», который означает, что это правило будет использовать абстрактное представление при условии объединения, в правиле по умолчанию. Это еще одна причина не отключите или удалите правило по умолчанию так, как если условие отсутствует соединения, чтобы использовать абстрактное представление затем атрибута не будет проходить. 

Добавить преобразования для атрибута, можно назначить константу, которая будет потока постоянное значение для вашей целевой атрибут, или прямое сопоставление между исходной или целевой атрибут, или выражение для атрибута. Ниже приведены различные [функции выражений](https://docs.microsoft.com/azure/active-directory/hybrid/reference-connect-sync-functions-reference) можно использовать.

#### <a name="add-an-outbound-sync-rule"></a>Добавьте исходящее правило синхронизации:
До сих, добавив правило входящей синхронизации мы проделали половина работы, так как в целевой каталог еще не связан атрибут. Для связи с руководителем целевого атрибута необходимо создать правило исходящего трафика, который означает, что источником является метавселенной и целевой объект подключенная система. Чтобы создать правило для исходящего трафика, запустите **редактор правил синхронизации**, изменить **направление** для **Outbound** и нажмите кнопку **добавить новое правило**. 

![правила по умолчанию](media/how-to-connect-fix-default-rules/default3c.png)

Как правило для входящего трафика, можно использовать собственные соглашения об именовании для **имя** правило. Выберите **подключенная система** клиент Azure AD, выберите объект подключенная система, к которому вы хотите установить значение атрибута. Задайте приоритет между 0 - 99. 

![правила по умолчанию](media/how-to-connect-fix-default-rules/default3d.png)

Сохранить **фильтр области** пустой, keep **правила присоединения** пуст, заполните преобразование как константа, Direct или выражение. 

В этом примере мы увидели, как для передачи нового атрибута для объекта-пользователя из Active Directory в Azure Active Directory. Эти действия можно использовать для сопоставления все атрибуты из любого объекта в исходной и целевой.  Дополнительные сведения см. в разделе [Создание настраиваемых правил синхронизации](how-to-connect-create-custom-sync-rule.md) и [подготовки для подготовки пользователей](https://docs.microsoft.com/office365/enterprise/prepare-for-directory-synchronization).

### <a name="overriding-value-of-existing-attribute"></a>Переопределение значения существующего атрибута.
Возможно, что вы хотите переопределить значение атрибута уже сопоставленную, например всегда можно задать значение Null для атрибута в Azure AD, это можно сделать, просто создав только правило для входящего трафика, как упоминалось в предыдущем шаге и поток  **AuthoritativeNull** постоянное значение для целевого атрибута. Обратите внимание на то, что мы использовали AuthoritativeNulll вместо значения Null в этом случае. Это обусловлено тем, отличных от null значение заменит значение Null, даже если он имеет более низкий приоритет (выше числовое значение в правиле). Тем не менее AuthoritativeNull будет рассматриваться как значение Null и не заменяются отличное от NULL, другие правила. 

### <a name="dont-sync-existing-attribute"></a>Не синхронизировать существующий атрибут
Если вы хотите исключить из синхронизации атрибут, можно использовать атрибут, фильтрацию функцией в Azure AD Connect. Запустите **Azure AD Connect** значок на рабочем столе, а затем выберите **настроить параметры синхронизации**.

![правила по умолчанию](media/how-to-connect-fix-default-rules/default4.png)

 Убедитесь, что **приложения Azure AD и фильтрации атрибутов** выбран и нажмите кнопку **Далее**.

![правила по умолчанию](media/how-to-connect-fix-default-rules/default5.png)

Снимите флажок атрибуты, которые требуется исключить из синхронизации.

![правила по умолчанию](media/how-to-connect-fix-default-rules/default6a.png)

## <a name="changing-scoping-filter"></a>Изменение фильтра области
Azure AD Sync берет на себя большую часть объектов, можно уменьшить область объектов и уменьшить его меньше объектов должны быть экспортированы в определенном поддерживаемых без изменения правил синхронизации по умолчанию. В случае, если вы хотите увеличить область объектов, то вы можете **изменить** существующее правило, создайте его копию и отключите исходное правило. Корпорация Майкрософт рекомендует не для того, чтобы увеличить область, настроена с помощью Azure AD Connect. Расширение области применения объектов сделает его сложно представить, службу поддержки, чтобы понять, настройки и поддержки продукта.

Вот, как можно уменьшить область объектов, которые будут синхронизированы с Azure AD. Следует учитывать, что если снизить объем **пользователей** , синхронизируя синхронизации хэша паролей для пользователей, отфильтрованные горизонтального также останавливается. Если объекты уже синхронизируется, затем после сокращения области поиска, горизонтального отфильтрованные объекты будут удалены из целевой каталог, мы рекомендуем связаться области видимости очень осторожно.
Ниже приведены поддерживаемые способы снижения область объектов, выполняется синхронизация.

- [атрибут cloudFiltered](#cloudfiltered-attribute)
- [Фильтрацию Подразделений](#ou-filtering)

### <a name="cloudfiltered-attribute"></a>атрибут cloudFiltered
Обратите внимание на то, что это не атрибут, который может быть установлен в Active Directory. Необходимо задать значение этого атрибута, добавив новое входящее правило, как упоминалось в **переопределяет значение существующего атрибута** раздел. Затем можно использовать **преобразования** и использовать **выражение** для установки этого атрибута в метавселенной. Ниже приведен пример, в котором не требуется синхронизировать всех пользователей с отдела, имя которого начинается с без учета регистра **HRD**:

`cloudFiltered <= IIF(Left(LCase([department]), 3) = "hrd", True, NULL)`

Отдел из источника (Active Directory) сначала преобразования в нижний регистр. Затем с помощью функции Left, мы заняло только первые 3 символа и сравнить его с обнаружения домашней области. Если он соответствует, а затем задайте значение True, в противном случае — значение NULL. Обратите внимание, что мы указываем значение NULL, таким образом, чтобы другие правила с более низким приоритетом (числовое значение в более поздней версии) доступна для записи с другим условием. Запустите предварительной версии на один объект для проверки правила синхронизации, как упоминалось в [проверить правило синхронизации](#validate-sync-rule) раздел.

![правила по умолчанию](media/how-to-connect-fix-default-rules/default7a.png)



### <a name="ou-filtering"></a>Фильтрацию Подразделений
Можно создать один или несколько подразделений и переместить объекты, которые вы не хотите синхронизировать эти подразделения. Затем настраивает это Подразделение фильтрации в Azure AD Connect, запустив **Azure AD Connect** из значка на рабочем столе и выберите параметры, как показано ниже. Можно также настроить фильтрации во время установки Azure AD Connect Подразделений. 

![правила по умолчанию](media/how-to-connect-fix-default-rules/default8.png)

Следуйте указаниям мастера и снимите флажок подразделений, вы не хотите синхронизировать.

![правила по умолчанию](media/how-to-connect-fix-default-rules/default9.png)

## <a name="changing-join-condition"></a>Изменение условия соединения
Корпорация Майкрософт рекомендует использовать значение по умолчанию присоединения положения, настроенные с помощью Azure AD Connect. Изменение условия соединения по умолчанию будет делают затруднительным службу поддержки, чтобы понять, настройки и поддержки продукта.

## <a name="validate-sync-rule"></a>Проверить правило синхронизации
Правило синхронизации вновь добавленный можно проверить с помощью функции предварительной версии без запуска цикл полной синхронизации. Запустите **служба синхронизации** пользовательского интерфейса.

![правила по умолчанию](media/how-to-connect-fix-default-rules/default10.png)

Щелкните **поиск в метавселенной**, выберите объект области как **person**, **добавить предложение** и упомянуть условиям поиска. Щелкните **поиска** кнопку и дважды щелкните его в **результаты поиска** Обратите внимание, что необходимо выполнить импорт и синхронизация на лес, прежде чем выполнить этот шаг, это позволяет обеспечить данные в Azure AD Connect не требуется обновление для этого объекта.

![правила по умолчанию](media/how-to-connect-fix-default-rules/default11.png)



Выберите **соединители**, выберите объект в соответствующий connector(forest), нажмите кнопку **свойства...** .

![правила по умолчанию](media/how-to-connect-fix-default-rules/default12.png)

Щелкните **Предварительный просмотр...**

![правила по умолчанию](media/how-to-connect-fix-default-rules/default13a.png)

Щелкните **создать предварительный просмотр** и **импорта потока атрибута** в левой области.

![правила по умолчанию](media/how-to-connect-fix-default-rules/default14.png)
 
Здесь можно заметить, что только что добавленного правила для объекта и установки для свойства атрибут cloudFiltered значение True.

![правила по умолчанию](media/how-to-connect-fix-default-rules/default15a.png)
 
Сведения о сравнении измененные правила с правилом по умолчанию?
Вы можете экспортировать оба правила отдельно как текстовые файлы. Эти правила будут экспортированы как файл сценария powershell. Вы можете сравнить их с помощью любого средства сравнения файлов, чтобы увидеть, какие изменения выполняются. В этом примере я использую windiff для сравнения двух файлов.
 
Можно заметить в пользователя изменить правило, атрибут msExchMailboxGuid заменен на **выражение** вместо типа **прямой** с значением, что **NULL** и  **ExecuteOnce** параметр. Можно игнорировать различия идентификатор и приоритет. 

![правила по умолчанию](media/how-to-connect-fix-default-rules/default17.png)
 
Способы устранения правило измененные по умолчанию?
Для устранения правил к параметрам по умолчанию, можно удалить измененные правила и включить правило по умолчанию, как показано ниже и затем запустите **полную синхронизацию**. Перед выполнением операции, необходимо выполнить корректирующие действия, как было сказано выше, чтобы не потерять настройки вы стремитесь достичь ## дальнейшие действия

## <a name="next-steps"></a>Следующие шаги
- [Оборудование и предварительные требования](how-to-connect-install-prerequisites.md) 
- [Стандартные параметры](how-to-connect-install-express.md)
- [Настраиваемые параметры](how-to-connect-install-custom.md)

