---
title: Использование Azure AD Connect при наличии существующего клиента Azure AD | Документация Майкрософт
description: В этом разделе описывается использование Connect при наличии существующего клиента Azure AD.
services: active-directory
documentationcenter: ''
author: billmath
manager: daveba
editor: ''
ms.assetid: ''
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: how-to
ms.date: 04/25/2019
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 9398fc9ee61bed41cd1e8c227fc4b4068e4b3e69
ms.sourcegitcommit: f8d2ae6f91be1ab0bc91ee45c379811905185d07
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2020
ms.locfileid: "89662243"
---
# <a name="azure-ad-connect-when-you-have-an-existing-tenant"></a>Azure AD Connect: при наличии существующего клиента
В большинстве разделов об использовании Azure AD Connect предполагается, что вы начинаете с нового клиента Azure AD, в котором отсутствуют какие-либо пользователи или другие объекты. Но если вы начали с клиента Azure AD, заполнили его пользователями и другими объектами, а теперь хотите использовать Connect, то этот раздел предназначен именно для вас.

## <a name="the-basics"></a>Основные сведения
Объект в Azure AD управляется в облаке (Azure AD) или в локальной среде. Невозможно управлять одними атрибутами отдельного объекта в локальной среде, а другими — в Azure AD. У каждого объекта имеется флаг, указывающий, где осуществляется управление этим объектом.

Можно управлять одними пользователями в локальной среде, а другими — в облаке. Распространенный сценарий для этой конфигурации — организация, состоящая из сотрудников отдела бухгалтерии и отдела продаж. Сотрудники отдела бухгалтерии используют локальную учетную запись AD, а сотрудники отдела продаж  — учетную запись в Azure AD. Будет удобно управлять одними пользователями в локальной среде, а другими — в Azure AD.

Если вы начали управлять пользователями в Azure AD, и некоторые пользователи также имеются в локальной среде AD, и вам потребовалось использовать Connect, то следует учесть некоторые дополнительные моменты.

## <a name="sync-with-existing-users-in-azure-ad"></a>Синхронизация с существующими пользователями в Azure AD
При установке Azure AD Connect и запуске синхронизации служба синхронизации Azure AD (в Azure AD) выполняет проверку каждого нового объекта и пытается найти существующий объект для сопоставления. Для этого используются три атрибута: **userPrincipalName**, **proxyAddresses** и **sourceAnchor**/**immutableID**. Сопоставление по **userPrincipalName** и **proxyAddresses** называется **нестрогим сопоставлением**. Сопоставление по**sourceAnchor** называется **строгим сопоставлением**. Для оценки по атрибуту **proxyAddresses** используются только значения с **SMTP:**, представляющие собой основной электронный адрес.

Соответствие оценивается только для новых объектов, поступающих из Connect. Если изменить существующий объект, чтобы он соответствовал какому-либо из этих атрибутов, то появится сообщение об ошибке.

Если Azure AD находит объект, значения атрибутов которого совпадают с объектом, поступившим из Connect, и он уже существует в Azure AD, то предпочтение отдается объекту из Connect. Объект, ранее управляемый облаком, помечается как управляемый локально. Все атрибуты в Azure AD, значения которых есть в локальной среде AD, перезаписываются локальными значениями. Исключением является ситуация, когда атрибут имеет значение **NULL** в локальной среде. В этом случае значение в Azure AD остается, но вы можете изменить его в локальной среде на другое.

> [!WARNING]
> Так как все атрибуты в Azure AD будут перезаписаны значениями из локальной среды, убедитесь, что в ней хранятся корректные данные. Например, если у вас есть только управляемый адрес электронной почты в Microsoft 365 и он не обновлялся в локальной AD DS, вы потеряли все значения в Azure AD или Microsoft 365, отсутствующие в AD DS.

> [!IMPORTANT]
> Если используется синхронизация паролей, которая всегда включена при стандартных параметрах, то пароль в Azure AD перезаписывается паролем в локальной среде AD. Если пользователи управляли разными паролями, то после установки Connect им необходимо сообщить о том, что следует использовать локальный пароль.

При планировании необходимо учитывать предыдущий раздел и приведенные предупреждения. В случае внесения множества изменений в Azure AD, которые не отражены в локальной среде AD DS, нужно запланировать заполнение AD DS обновленными значениями перед синхронизацией объектов с помощью Azure AD Connect.

Если объекты были сопоставлены нестрого, то в объект в Azure AD добавляется атрибут **sourceAnchor**, позволяющий в дальнейшем использовать строгое сопоставление.

>[!IMPORTANT]
> Корпорация Майкрософт настоятельно не рекомендует синхронизировать локальные учетные записи с уже существующими учетными записями администраторов в Azure Active Directory.

### <a name="hard-match-vs-soft-match"></a>Строгое и нестрогое сопоставление
Для нового установленного экземпляра Connect нет практической разницы между строгим и нестрогим сопоставлением. Различие имеется в случае аварийного восстановления. В случае потери сервера с Azure AD Connect можно повторно установить новый экземпляр без потери данных. Во время первоначальной установки в Connect передается объект с атрибутом sourceAnchor. Затем клиент (Azure AD Connect) может оценить соответствие, что будет гораздо быстрее, чем оценка соответствия в Azure AD. Строгое сопоставление оценивается Connect и Azure AD. Нестрогое сопоставление оценивается только Azure AD.

### <a name="other-objects-than-users"></a>Объекты, отличные от пользователей
Группы и контакты с поддержкой электронной почты можно нестрого сопоставить на основе proxyAddresses. Строгое сопоставление не применимо, так как вы можете обновить только sourceAnchor/immutableID (с помощью PowerShell) для пользователей. Для групп без электронной почты в настоящее время не поддерживается нестрогое и строгое сопоставления.

### <a name="admin-role-considerations"></a>Рекомендации по ролям администраторов
Чтобы предотвратить сопоставление недоверенных локальных пользователей с пользователем облака, имеющего роль администратора, Azure AD Connect не будет сопоставлять локальные объекты пользователей с объектами, имеющими роль администратора. Это выполняется по умолчанию. Чтобы решить эту проблему, можно выполнить следующие действия.

1.  Удалите роли каталога из облачного объекта-пользователя.
2.  При неудачной попытке синхронизации пользователей необходимо удалить объект, помещенный в карантин в облаке.
3.  Запуск синхронизации.
4.  При необходимости добавьте роли каталога обратно в объект пользователя в облаке после возникновения сопоставления.



## <a name="create-a-new-on-premises-active-directory-from-data-in-azure-ad"></a>Создание локальной службы Active Directory на основе данных в Azure AD
Некоторые клиенты начинают с облачного решения на основе Azure AD и не используют локальную среду AD. Позднее возникает необходимость использовать локальные ресурсы, и они создают локальную среду AD на основании данных Azure AD. В этом случае Azure AD Connect ничем не поможет. Это решение не позволяет создать пользователей в локальной среде и не дает возможности установить локальный пароль так же, как и в Azure AD.

Если единственная причина, по которой планируется добавить локальную среду AD, это поддержка бизнес-приложений, то вам следует рассмотреть возможность использования [доменных служб Azure AD](../../active-directory-domain-services/index.yml).

## <a name="next-steps"></a>Дальнейшие действия
Узнайте больше об [интеграции локальных удостоверений с Azure Active Directory](whatis-hybrid-identity.md).
