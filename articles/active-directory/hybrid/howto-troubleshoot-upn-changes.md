---
title: Планирование и устранение неполадок в изменениях имени участника-пользователя Azure (UPN)
description: Общие сведения об известных проблемах и их устранении при изменениях имени участника-пользователя
services: active-directory
ms.service: active-directory
ms.subservice: hybrid
ms.topic: how-to
ms.date: 03/13/2020
ms.author: baselden
author: barbaraselden
manager: daveba
ms.reviewer: jsimmons
ms.collection: M365-identity-device-management
ms.openlocfilehash: 885d30305ba2b186052e17b9b455b2248bca541b
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85608523"
---
# <a name="plan-and-troubleshoot-user-principal-name-changes-in-azure-active-directory"></a>Планирование и устранение неполадок при изменении имени субъекта-пользователя в Azure Active Directory

Имя участника-пользователя (UPN) — это атрибут, который является стандартом Интернет-коммуникаций для учетных записей пользователей. Имя участника-пользователя состоит из префикса (имя участника-пользователя) и суффикса (имя субъекта-пользователя). Префикс соединяет суффикс, используя символ "@". Например, someone@example.com. Имя участника-пользователя должно быть уникальным среди всех объектов субъекта безопасности в пределах леса каталога. 

**В этой статье предполагается, что вы используете UPN в качестве идентификатора пользователя. Он предназначен для планирования изменений имени участника-пользователя и восстановления после проблем, которые могут возникнуть в результате изменений имени участника-пользователя.**

> [!NOTE]
> Для разработчиков рекомендуется использовать идентификатор пользователя (objectID) в качестве неизменяемого идентификатора вместо имени участника-пользователя или адреса электронной почты, так как их значения могут изменяться.


## <a name="learn-about-upns-and-upn-changes"></a>Сведения об изменениях UPN и имени участника-пользователя
Страницы входа часто запрашивают у пользователей ввод адреса электронной почты, если требуемое значение действительно является именем участника-пользователя. Поэтому при изменении основного адреса электронной почты следует обязательно изменить UPN пользователя.

Основные адреса электронной почты пользователей могут измениться по многим причинам.

* Фирменная символика компании

* Сотрудники, перемещающиеся на разные подразделения компании 

* слияния и приобретения

* изменения имени сотрудника

### <a name="types-of-upn-changes"></a>Типы изменений имени участника-пользователя

Имя участника-пользователя можно изменить, изменив префикс, суффикс или и то, и другое.

* **Изменение префикса**.

   *  Например, если имя пользователя изменилось, можно изменить его имя учетной записи:  
BSimon@contoso.comдляBJohnson@contoso.com

   * Вы также можете изменить корпоративный стандарт для префиксов:  
Bsimon@contoso.comдляBritta.Simon@contoso.com

* **Изменение суффикса**. <br>

    Например, если пользователь изменил подразделения, вы можете изменить его домен: 

   * Britta.Simon@contoso.com — Britta.Simon@contosolabs.com <br>
     либо<br>
    * Britta.Simon@corp.contoso.com — Britta.Simon@labs.contoso.com 

Рекомендуется изменять UPN пользователя каждый раз при обновлении своего основного адреса электронной почты.

Во время начальной синхронизации из Active Directory в Azure AD убедитесь, что сообщения электронной почты пользователей идентичны их именам участников.

### <a name="upns-in-active-directory"></a>UPN в Active Directory

В Active Directory суффикс UPN по умолчанию — это DNS-имя домена, в котором была создана учетная запись пользователя. В большинстве случаев это доменное имя, регистрируемое в качестве домена предприятия в Интернете. При создании учетной записи пользователя в домене contoso.com имя участника-пользователя по умолчанию —

username@contoso.com

 Однако можно [добавить дополнительные UPN-суффиксы](https://docs.microsoft.com/azure/active-directory/fundamentals/add-custom-domain) с помощью Active Directory доменов и доверий. 

Например, может потребоваться добавить labs.contoso.com и поразить в них имена участников и сообщений пользователей. Затем они станут

username@labs.contoso.com.

>[!IMPORTANT]
> При [изменении суффикса в Active Directory](https://docs.microsoft.com/azure/active-directory/fundamentals/add-custom-domain)необходимо убедиться, что соответствующее имя пользовательского домена было [добавлено и проверено в Azure AD](https://docs.microsoft.com/azure/active-directory/fundamentals/add-custom-domain). 

![Снимок экрана проверенных доменов](./media/howto-troubleshoot-upn-changes/custom-domains.png)

### <a name="upns-in-azure-active-directory"></a>UPN в Azure Active Directory

Пользователи входят в Azure AD со значением в атрибуте userPrincipalName. 

При использовании Azure AD совместно с локальными Active Directory учетные записи пользователей синхронизируются с помощью службы Azure AD Connect. По умолчанию мастер Azure AD Connect использует атрибут userPrincipalName из локальной Active Directory в качестве имени участника-пользователя в Azure AD. Его можно изменить на другой атрибут в пользовательской установке.

При обновлении имени участника-пользователя (UPN) одного пользователя или всей Организации важно иметь определенный процесс. 

Ознакомьтесь с известными проблемами и способами их обхода в этом документе.

При синхронизации учетных записей пользователей из Active Directory в Azure AD убедитесь, что имена участников домена в Active Directory сопоставляются с проверенными доменами в Azure AD.

![Снимок экрана проверенных доменов](./media/howto-troubleshoot-upn-changes/verified-domains.png)

Если значение атрибута userPrincipalName не соответствует проверенному домену в Azure AD, то процесс синхронизации заменяет суффикс на значение Default. onmicrosoft.com.


### <a name="roll-out-bulk-upn-changes"></a>Полное развертывание изменений имени участника-пользователя

Следуйте рекомендациям [по пилотному развертыванию](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-deployment-plans) для полного изменения имени участника-пользователя. Также имеется проверенный план отката для изменения имен участников-пользователей, если обнаружены проблемы, которые невозможно быстро устранить. После запуска пилотного проекта можно начать нацеливание небольших наборов пользователей с помощью различных ролей Организации и их конкретных наборов приложений или устройств.

Пройдите это первое подмножество пользователей, чтобы получить хорошее представление о том, какие пользователи должны быть в процессе изменения. Включите эти сведения для взаимодействия с пользователем.

Создайте определенную процедуру для изменения имен участников-пользователей в рамках обычных операций. Рекомендуется использовать проверенную процедуру, включающую документацию по известным проблемам и решениям.

В следующих разделах описаны потенциальные известные проблемы и способы их решения при изменении имен участников.

## <a name="apps-known-issues-and-workarounds"></a>Известные проблемы и решения для приложений

[Программное обеспечение как услуга (SaaS)](https://azure.microsoft.com/overview/what-is-saas/) и бизнес-приложения часто используют UPN для поиска пользователей и хранения сведений о профилях пользователей, включая роли. Приложения, использующие [JIT-подготовку](https://docs.microsoft.com/azure/active-directory/app-provisioning/user-provisioning) для создания профиля пользователя при первом входе пользователей в приложение, могут повлиять на изменения имени участника-пользователя.

**Известная проблема**<br>
Изменение имени участника-пользователя может привести к нарушению связи между пользователем Azure AD и профилем пользователя, созданным в приложении. Если приложение использует [JIT-подготовку](https://docs.microsoft.com/azure/active-directory/app-provisioning/user-provisioning), оно может создать новый профиль пользователя. Это потребует от администратора приложения внести изменения вручную, чтобы исправить эту связь.

**Обходное решение**<br>
[Автоматическая подготовка пользователей Azure AD](https://docs.microsoft.com/azure/active-directory/manage-apps/user-provisioning) позволяет автоматически создавать, обслуживать и удалять удостоверения пользователей в поддерживаемых облачных приложениях. Настройка автоматической подготовки пользователей в приложениях автоматически обновляет UPN в приложениях. Протестируйте приложения в рамках последовательного развертывания, чтобы убедиться, что на них не влияет изменение имени участника-пользователя.
Если вы являетесь разработчиком, попробуйте [Добавить поддержку scim в приложение](https://docs.microsoft.com/azure/active-directory/app-provisioning/use-scim-to-provision-users-and-groups) , чтобы включить автоматическую подготовку пользователей из Azure Active Directory. 

## <a name="managed-devices-known-issues-and-workarounds"></a>Известные проблемы и решения для управляемых устройств

[Переводя устройства в Azure AD](https://docs.microsoft.com/azure/active-directory/devices/overview), вы повышаете производительность пользователей с помощью единого входа (SSO) в облачных и локальных ресурсах.

### <a name="azure-ad-joined-devices"></a>Устройства, присоединенные к Azure AD

[Присоединенные к Azure AD](https://docs.microsoft.com/azure/active-directory/devices/concept-azure-ad-join) устройства присоединяются непосредственно к Azure AD и позволяют пользователям входить на устройство, используя удостоверение своей организации.

**Известные проблемы** <br>
Пользователи могут столкнуться с проблемами единого входа в приложениях, которые зависят от Azure AD для проверки подлинности.

**Способы устранения:** <br>
Проблемы, упомянутые в этом разделе, исправлены в обновлении Windows 10 2020 мая (2004).

**Обходное решение** <br>
Подождите достаточно времени, чтобы изменение имени участника-пользователя было синхронизировано с Azure AD. Убедившись, что новое имя участника-пользователя отображается на портале Azure AD, попросите пользователя выбрать плитку "другой пользователь", чтобы войти в систему с помощью нового UPN. Вы также можете проверить с помощью [PowerShell](https://docs.microsoft.com/powershell/module/azuread/get-azureaduser?view=azureadps-2.0). После входа в систему с новым именем участника-пользователя ссылки на старый UPN могут отображаться в параметре Windows "доступ к рабочей или учебной заведению".

![Снимок экрана проверенных доменов](./media/howto-troubleshoot-upn-changes/other-user.png)


### <a name="hybrid-azure-ad-joined-devices"></a>Гибридные устройства, присоединенные к Azure AD

[Гибридные устройства, присоединенные к Azure AD](https://docs.microsoft.com/azure/active-directory/devices/concept-azure-ad-join-hybrid) , присоединяются к Active Directory и Azure AD. Гибридное присоединение к Azure AD можно реализовать, если в вашей среде используется локальная Active Directory и вы также хотите воспользоваться преимуществами, предоставляемыми Azure AD.

**Известные проблемы** 

Гибридные устройства, присоединенные к Windows 10, могут столкнуться с непредвиденными перезапусками и проблемами доступа.

Если пользователи входят в Windows перед синхронизацией нового имени участника-пользователя с Azure AD или продолжают использовать существующий сеанс Windows, они могут столкнуться с проблемами единого входа в приложениях, использующих Azure AD для проверки подлинности, если условный доступ настроен на принудительное использование гибридных присоединенных устройств для доступа к ресурсам. 

Кроме того, появится следующее сообщение: принудительная перезагрузка через одну минуту. 

"Ваш компьютер будет автоматически перезапущен через одну минуту. В Windows возникла проблема, необходимо перезагрузить компьютер. Теперь следует закрыть это сообщение и сохранить работу.

**Способы устранения:** <br>
Проблемы, упомянутые в этом разделе, исправлены в обновлении Windows 10 2020 мая (2004).

**Обходное решение** 

Устройство должно быть отсоединено от Azure AD и перезапущено. После перезагрузки устройство будет автоматически присоединено к Azure AD, и пользователь должен войти с помощью нового имени участника-пользователя, выбрав плитку "другой пользователь". Чтобы отсоединить устройство от Azure AD, выполните в командной строке следующую команду:

**dsregcmd/Leave**

Пользователь должен будет [повторно зарегистрироваться](https://docs.microsoft.com/windows/security/identity-protection/hello-for-business/hello-hybrid-cert-whfb-provision) для использования Windows Hello для бизнеса, если он используется. После изменения имени участника-пользователя на устройства Windows 7 и 8,1 Эта проблема не затрагивается.


## <a name="microsoft-authenticator-known-issues-and-workarounds"></a>Microsoft Authenticator известные проблемы и способы их решения

Организация может потребовать использования [приложения Microsoft Authenticator](https://docs.microsoft.com/azure/active-directory/user-help/user-help-auth-app-overview) для входа и доступа к организационным приложениям и данным. Хотя имя пользователя может появиться в приложении, учетная запись не настраивается как метод проверки до тех пор, пока пользователь не завершит процесс регистрации.

[Приложение Microsoft Authenticator](https://docs.microsoft.com/azure/active-directory/user-help/user-help-auth-app-overview) имеет четыре основные функции:

* Многофакторная проверка подлинности с помощью push-уведомления или кода проверки

* Выступают в качестве брокера проверки подлинности на устройствах iOS и Android для предоставления единого входа для приложений, использующих [аутентификацию через посредника](https://docs.microsoft.com/azure/active-directory/develop/brokered-auth) .

* Регистрация устройства (также известная как Workplace Join) в Azure AD, которая является обязательным требованием для других функций, таких как Защита приложений Intune, регистрациии устройств и управления ими,

* Вход с телефона, для которого требуется MFA и регистрация устройства.

### <a name="multi-factor-authentication-with-android-devices"></a>Многофакторная идентификация на устройствах Android

Microsoft Authenticator приложение предлагает вариант проверки по внештатному каналу. Вместо автоматической отправки телефонных вызовов или SMS пользователю во время входа [многофакторная идентификация (MFA)](https://docs.microsoft.com/azure/active-directory/authentication/concept-mfa-howitworks) отправляет уведомление в Microsoft Authenticator приложение на смартфоне или планшете пользователя. Пользователь просто отменяет утверждение (или вводит ПИН-код или биометрию и применяет проверку подлинности) в приложении для завершения входа.

**Известные проблемы** 

При изменении имени участника-пользователя старый UPN все еще отображается в учетной записи пользователя, и уведомление может быть не получено. [Коды проверки](https://docs.microsoft.com/azure/active-directory/user-help/user-help-auth-app-faq) продолжают работать.

**Обходное решение**

Если уведомление получено, попросите пользователя закрыть уведомление, откройте приложение Authenticator, коснитесь параметра "проверить наличие уведомлений" и утвердите запрос MFA. После этого имя участника-пользователя, отображаемое в учетной записи, будет обновлено. Обратите внимание, что обновленное имя участника-пользователя может отображаться как новая учетная запись, это связано с тем, что используются другие функциональные возможности средства проверки подлинности. Дополнительные сведения см. в разделе Дополнительные известные проблемы в этой статье.

### <a name="brokered-authentication"></a>Аутентификация через посредника

В таких брокерах Android и iOS, как Microsoft Authenticator включить:

* Единый вход (SSO) — пользователям не потребуется входить в каждое приложение.

* Идентификация устройства. брокер обращается к сертификату устройства, созданному на устройстве при присоединении к рабочей области.

* Проверка идентификации приложения. когда приложение вызывает брокер, ему передается URL-адрес перенаправления, и брокер проверяет его.

Кроме того, он позволяет приложениям участвовать в более сложных функциях, таких как [Условный доступ](https://docs.microsoft.com/azure/active-directory/conditional-access/), и поддерживает [сценарии Microsoft Intune](https://docs.microsoft.com/azure/active-directory/develop/msal-net-use-brokers-with-xamarin-apps).

**Известные проблемы**<br>
Пользователю предлагается больше интерактивных запросов на проверку подлинности в новых приложениях, использующих вход с помощью брокера, из-за несоответствия login_hint, переданного приложением, и имени пользователя, хранящегося в брокере.

**Обходное решение** <br> Пользователь должен вручную удалить учетную запись из Microsoft Authenticator и начать новый вход из приложения, поддерживающего брокер. Учетная запись будет автоматически добавлена после первоначальной проверки подлинности.

### <a name="device-registration"></a>Регистрация устройства

Приложение Microsoft Authenticator отвечает за регистрацию устройства в Azure AD. Регистрация устройства позволяет устройству проходить проверку подлинности в Azure AD и является обязательным для следующих сценариев:

* Защита приложений Intune

* Регистрация устройств в Intune

* Вход с телефона

**Известные проблемы**<br>
При изменении имени участника-пользователя в приложении Microsoft Authenticator отображается новая учетная запись с новым UPN, в то время как учетная запись со старым UPN все еще присутствует в списке. Кроме того, старое имя участника-пользователя отображается в разделе Регистрация устройства в параметрах приложения. В обычной функциональности регистрации устройств или зависимых сценариев нет изменений.

**Обходное решение** <br> Чтобы удалить все ссылки на старое имя участника-пользователя в приложении Microsoft Authenticator, попросите пользователя вручную удалить старые и новые учетные записи из Microsoft Authenticator, повторно зарегистрироваться для MFA и заново присоединить устройство.

### <a name="phone-sign-in"></a>Вход с телефона

Вход с помощью телефона позволяет пользователям входить в Azure AD без пароля. Чтобы включить вход с помощью телефона, пользователю необходимо зарегистрироваться для использования многофакторной проверки подлинности, а затем включить вход с использованием телефона непосредственно на устройстве проверки подлинности. В рамках конфигурации устройство регистрируется в Azure AD.

**Известные проблемы** <br>
Пользователи не могут использовать вход с помощью телефона, так как они не получают уведомлений. Если пользователь отменяет проверку на наличие уведомлений, он получает сообщение об ошибке.

**Обходное решение**<br>
Пользователю необходимо выбрать раскрывающееся меню учетной записи, для которой включено вход с помощью телефона, и выбрать отключить вход с помощью телефона. При необходимости можно снова включить вход с телефона.

## <a name="security-key-fido2-known-issues-and-workarounds"></a>Известные проблемы и решения для ключа безопасности (FIDO2)

**Известные проблемы** <br>
При регистрации нескольких пользователей в одном и том же ключе на экране входа отображается страница выбора учетной записи, где отображается старое имя участника-пользователя. Операции входа, использующие ключи безопасности, не затрагиваются изменением имени участника-пользователя.  

**Обходное решение**<br>
Чтобы удалить ссылки на старые имена участников-пользователей, необходимо [сбросить ключ безопасности и повторно зарегистрировать его](https://docs.microsoft.com/azure/active-directory/authentication/howto-authentication-passwordless-security-key#known-issues).

## <a name="onedrive-known-issues-and-workarounds"></a>Известные проблемы и решения для OneDrive

Пользователи OneDrive могут столкнуться с проблемами после изменения имени участника-пользователя. Дополнительные сведения см. [в статье влияние изменений UPN на URL-адрес onedrive и функции onedrive](https://docs.microsoft.com/onedrive/upn-changes).

## <a name="next-steps"></a>Дальнейшие шаги

См. следующие ресурсы:
* [Azure AD Connect: принципы проектирования](https://docs.microsoft.com/azure/active-directory/hybrid/plan-connect-design-concepts)

* [Указание атрибута UserPrincipalName в Azure AD](https://docs.microsoft.com/azure/active-directory/hybrid/plan-connect-userprincipalname)

* [Маркеры ИДЕНТИФИКАТОРов платформы Microsoft Identity](https://docs.microsoft.com/azure/active-directory/develop/id-tokens)
