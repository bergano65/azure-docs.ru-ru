---
title: Руководство. Применение многофакторной проверки подлинности для гостевых пользователей Azure Active Directory B2B
description: Сведения о том, как требовать Многофакторную идентификацию (MFA) при использовании Azure AD B2B для совместной работы с внешними пользователями и партнерскими организациями.
services: active-directory
ms.service: active-directory
ms.component: B2B
ms.topic: tutorial
ms.date: 06/25/2018
ms.author: mimart
author: msmimart
manager: daveba
ms.reviewer: sasubram
ms.openlocfilehash: 88225ee7aeefd9030e754f2b1abc66e4c05e5c6b
ms.sourcegitcommit: 9999fe6e2400cf734f79e2edd6f96a8adf118d92
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2019
ms.locfileid: "54431184"
---
# <a name="tutorial-enforce-multi-factor-authentication-for-b2b-guest-users"></a>Руководство. Применение многофакторной проверки подлинности для гостевых пользователей B2B

При взаимодействии с внешними гостевыми пользователями B2B рекомендуется защитить свои приложения с помощью политик Многофакторной идентификации (MFA). После такой защиты для доступа к вашим ресурсам внешним пользователям потребуется больше, чем просто имя пользователя и пароль. В Azure Active Directory (Azure AD) это можно сделать с помощью политики условного доступа, требующей MFA для доступа. Эти политики можно применять на уровне клиента, приложения или отдельных гостевых пользователей точно так же, как для сотрудников и членов организации.

Пример:

![Приложение B2B, требующее Многофакторной идентификации](media/tutorial-mfa/aad-b2b-mfa-example.png)

1.  Администратор или сотрудник компании A приглашает гостевого пользователя использовать облачное или локальное приложение, настроенное на прохождение Многофакторной идентификации для получения доступа.
2.  Гостевой пользователь входит в систему, используя собственный рабочий, учебный идентификатор или идентификатор в социальной сети. 
3.  Пользователю предлагается пройти Многофакторную идентификацию. 
4.  Ему нужно согласовать параметры прохождения MFA с компанией A и выбрать приемлемый вариант. После этого пользователь получит доступ к приложению.

Изучив данный учебник, вы научитесь:

> [!div class="checklist"]
> * Перед настройкой MFA проверьте работу входа в систему.
> * Создайте политику условного доступа, которая требует прохождения MFA для доступа к облачному приложению в вашей среде. В этом руководстве мы используем приложение управления Microsoft Azure для демонстрации процесса.
> * Используйте инструмент What If для имитации входа через MFA.
> * Проверьте политику условного доступа.
> * Очистите тестового пользователя и политику.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

Для выполнения сценария в этом руководстве вам понадобится следующее.

 - **Доступ к выпуску Azure AD Premium**, который включает возможности политики условного доступа. Для принудительного применения Многофакторной идентификации вам необходимо создать политику условного доступа Azure AD. Обратите внимание, что политики MFA всегда применяются в организации независимо от того, есть ли у партнера возможности прохождения MFA. Если вы настраиваете MFA для своей организации, вам необходимо приобрести соответствующие лицензии Azure AD Premium для своих гостевых пользователей. 
 - **Допустимая внешняя учетная запись электронной почты**, которую вы можете добавить в свой каталог клиента в качестве гостевого пользователя и использовать для входа. Если вы не знаете, как создать гостевую учетную запись, ознакомьтесь со статьей [Добавление пользователей службы совместной работы B2B на портале Azure](add-users-administrator.md).

## <a name="create-a-test-guest-user-in-azure-ad"></a>Создание тестового гостевого пользователя в Azure AD

1. Войдите на [портал Azure](https://portal.azure.com/) с учетной записью администратора Azure AD.
2. В области слева выберите **Azure Active Directory**.
3.  В разделе **Управление** выберите **Пользователи**.
4.  Затем выберите **Новый гостевой пользователь**.

    ![Выберите Azure Active Directory.](media/tutorial-mfa/tutorial-mfa-user-3.png)

5.  В колонке **Имя пользователя** введите адрес электронной почты внешнего пользователя. При желании допишите приветственное сообщение. 

    ![Выберите Azure Active Directory.](media/tutorial-mfa/tutorial-mfa-user-4.png)

6.  Чтобы автоматически отправить приглашение гостевому пользователю, нажмите кнопку **Пригласить**. Появится сообщение **Пользователь успешно приглашен**. 
7.  После отправки приглашения учетная запись пользователя автоматически добавляется в каталог в качестве гостя.

## <a name="test-the-sign-in-experience-before-mfa-setup"></a>Проверка входа в систему перед настройкой MFA
1.  Используйте свое имя тестового пользователя и пароль для входа на [портал Azure](https://portal.azure.com/).
2.  Обратите внимание, что вы можете получить доступ к порталу Azure, используя только свои учетные данные входа. Дополнительная аутентификация не требуется.
3.  Выполните выход.

## <a name="create-a-conditional-access-policy-that-requires-mfa"></a>Создание политики условного доступа, которая требует MFA
1.  Войдите на [портал Azure](https://portal.azure.com/) с правами глобального администратора, администратора безопасности или администратора условного доступа.
2.  На портале Azure выберите **Azure Active Directory**. 
3.  На странице **Azure Active Directory** в разделе **Безопасность** щелкните **Условный доступ**.
4.  На странице **условного доступа** на панели инструментов сверху выберите **Создать политику**.
5.  На странице **создания** в поле **Имя** введите **Require MFA for B2B portal access** (Требовать Многофакторную идентификацию для доступа к порталу B2B).
6.  В разделе **Назначения** щелкните **Пользователи и группы**.
7.  На странице **Пользователи и группы** щелкните **Выбрать пользователей и группы**, а затем — **Все гостевые пользователи (предварительная версия)**.

    ![Выберите Azure Active Directory.](media/tutorial-mfa/tutorial-mfa-policy-6.png)
9.  Нажмите кнопку **Готово**.
10. На странице **создания** в разделе **назначений** выберите **Облачные приложения**.
11. На странице **Облачные приложения** щелкните **Выбрать приложения**, а затем нажмите кнопку **Выбрать**.

    ![Выберите Azure Active Directory.](media/tutorial-mfa/tutorial-mfa-policy-10.png)

12. На странице **выбора** выберите **управление Microsoft Azure**, а затем нажмите кнопку **Выбрать**.

    ![Выберите Azure Active Directory.](media/tutorial-mfa/tutorial-mfa-policy-11.png)

13. На странице **Облачные приложения** нажмите кнопку **Готово**.
14. На странице **создания** в разделе **Элементы управления доступом** выберите **Предоставление**.
15. На странице **Предоставление** выберите **Разрешить доступ**, затем установите флажок в поле **Требовать многофакторную проверку подлинности** и щелкните **Выбрать**.

    ![Выберите Azure Active Directory.](media/tutorial-mfa/tutorial-mfa-policy-13.png)

16. В разделе **Включить политику** нажмите кнопку **Вкл**.

    ![Выберите Azure Active Directory.](media/tutorial-mfa/tutorial-mfa-policy-14.png)

17. Нажмите кнопку **Создать**.

## <a name="use-the-what-if-option-to-simulate-sign-in"></a>Использование параметра What If для имитации входа

1.  На странице **Conditional access — Policies** (Условный доступ — политики) выберите **Параметр "What If"**. 

    ![Выберите Azure Active Directory.](media/tutorial-mfa/tutorial-mfa-whatif-1.png)

2.  Выберите раздел **пользователей**, затем щелкните тестового гостевого пользователя и нажмите кнопку **Выбрать**.

    ![Выберите Azure Active Directory.](media/tutorial-mfa/tutorial-mfa-whatif-2.png)

3.  Выберите **Облачные приложения**.
4.  На странице **Облачные приложения** щелкните **Выбрать приложения**, а затем нажмите кнопку **Выбрать**. В списке приложений выберите **управление Microsoft Azure**, а затем нажмите кнопку **Выбрать**. 

    ![Выберите Azure Active Directory.](media/tutorial-mfa/tutorial-mfa-whatif-3.png)

5.  На странице **Облачные приложения** нажмите кнопку **Готово**.
6.  Нажмите кнопку **Параметр " What If"** и убедитесь, что новая политика отображается в разделе **результатов оценки** на вкладке **Политики, которые будут применяться**.

    ![Выберите Azure Active Directory.](media/tutorial-mfa/tutorial-mfa-whatif-4.png)

## <a name="test-your-conditional-access-policy"></a>Проверка политики условного доступа
1.  Используйте свое имя тестового пользователя и пароль для входа на [портал Azure](https://portal.azure.com/).
2.  Вы должны увидеть запрос на дополнительные методы аутентификации. Обратите внимание, что для вступления политики в силу может потребоваться некоторое время.

    ![Выберите Azure Active Directory.](media/tutorial-mfa/mfa-required.png)
 
3.  Выполните выход.

## <a name="clean-up-resources"></a>Очистка ресурсов
Если тестовый пользователь и тестовая политика условного доступа больше не нужны, удалите их.
1.  Войдите на [портал Azure](https://portal.azure.com/) с учетной записью администратора Azure AD.
2.  В области слева выберите **Azure Active Directory**.
3.  В разделе **Управление** выберите **Пользователи**.
4.  Выберите тестового пользователя, а затем — команду **Удалить пользователя**.
5.  В области слева выберите **Azure Active Directory**.
6.  В разделе **Безопасность** выберите **Условный доступ**.
7.  В списке **имен политики** выберите контекстное меню (…) для тестовой политики, а затем — **Удалить**. Выберите **Да** для подтверждения.
## <a name="next-steps"></a>Дополнительная информация
В этом руководстве вы создали политику условного доступа, которая требует прохождения гостевыми пользователями Многофакторной идентификации при входе в одно из облачных приложений. Дополнительные сведения о добавлении гостевых пользователей для совместной работы см. в статье [Добавление пользователей службы совместной работы B2B на портале Azure](add-users-administrator.md).
