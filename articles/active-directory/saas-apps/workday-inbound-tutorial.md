---
title: Руководство. Настройка Workday для автоматической подготовки пользователей с помощью Azure Active Directory | Документация Майкрософт
description: Узнайте, как настроить Azure Active Directory для автоматической подготовки и отзыва учетных записей пользователей в Workday.
services: active-directory
author: cmmdesai
documentationcenter: na
manager: daveba
ms.assetid: 1a2c375a-1bb1-4a61-8115-5a69972c6ad6
ms.service: active-directory
ms.subservice: saas-app-tutorial
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 05/16/2019
ms.author: chmutali
ms.collection: M365-identity-device-management
ms.openlocfilehash: 31cf1f6da515aa9b453987383e78f466c5ba4fb9
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65827297"
---
# <a name="tutorial-configure-workday-for-automatic-user-provisioning"></a>Руководство по Настройка Workday для автоматической подготовки пользователей

Цель этого учебника — Показать, что необходимо выполнить для импорта рабочих профилей из Workday в Active Directory и Azure Active Directory, с необязательным обратной записью адреса электронной почты и имя пользователя в Workday.

## <a name="overview"></a>Обзор

Для подготовки учетных записей пользователей [служба подготовки пользователей Azure Active Directory](../manage-apps/user-provisioning.md) интегрируется с [API отдела кадров Workday](https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Get_Workers.html). Azure AD использует это подключение для включения следующих рабочих процессов подготовки пользователей:

* **Подготовка пользователей в Active Directory** — подготовка выбранных групп пользователей из Workday в одном или нескольких доменах Active Directory.

* **Подготовка только облачных пользователей в Azure Active Directory** — в сценариях, где локальный Active Directory не используется, пользователей можно перенести непосредственно из Workday в Azure Active Directory с помощью службы подготовки пользователя Azure AD.

* **Записать адрес электронной почты и имя пользователя в Workday** -служба подготовки пользователей Azure AD можно записи адреса электронной почты и имя пользователя Azure AD обратно в Workday.

### <a name="what-human-resources-scenarios-does-it-cover"></a>Для каких сценариев работы отдела кадров это подходит?

Рабочие процессы подготовки пользователей Workday, поддерживаемые службой подготовки пользователей Azure AD, позволяют автоматизировать следующие сценарии работы отдела кадров и управления жизненным циклом удостоверений.

* **Наем новых сотрудников.** При добавлении нового сотрудника в Workday учетная запись пользователя автоматически создается в Active Directory, Azure Active Directory и при необходимости в Office 365, а также в [других приложениях SaaS, поддерживаемых Azure AD](../manage-apps/user-provisioning.md), с обратной записью адреса электронной почты в Workday.

* **Обновления атрибута и профиля сотрудника**. При обновлении записи сотрудника в Workday (например, имени, должности или руководителя) его учетная запись пользователя будет автоматически обновлена в Active Directory, Azure Active Directory и при необходимости в Office 365 и [других приложениях SaaS, поддерживаемых Azure AD](../manage-apps/user-provisioning.md).

* **Увольнения сотрудников**. При увольнении сотрудника в Workday его учетная запись пользователя будет автоматически отключена в Active Directory, Azure Active Directory и при необходимости в Office 365 и [других приложениях SaaS, поддерживаемых Azure AD](../manage-apps/user-provisioning.md).

* **Повторные наймы сотрудников**. При повторном поступлении сотрудника на работу в Workday его старая учетная запись может быть автоматически активирована повторно или повторно подготовлена (в зависимости от вашего желания) в Active Directory, Azure Active Directory и при необходимости в Office 365 и [других приложениях SaaS, поддерживаемых Azure AD](../manage-apps/user-provisioning.md).

### <a name="who-is-this-user-provisioning-solution-best-suited-for"></a>Кому это решение подготовки пользователей подходит лучше всего?

Это решение подготовки пользователей Workday идеально подходит для:

* организаций, которым необходимо готовое облачное решение для подготовки пользователей в Workday;

* организаций, которым требуется прямая подготовка пользователей из Workday в Active Directory или Azure Active Directory;

* организаций, которым требуется подготавливать пользователей с помощью данных, полученных из модуля HCM Workday (см. раздел об [операции Get_Workers](https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Get_Workers.html));

* организаций, которым необходимо синхронизировать процессы присоединения, перемещения и удаления пользователей с одним или несколькими лесами Active Directory, доменами и подразделениями на основе только данных изменений, обнаруженных в модуле HCM Workday (см. раздел об [операции Get_Workers](https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Get_Workers.html));

* организаций, использующих Office 365 для электронной почты.

## <a name="solution-architecture"></a>Архитектура решения

В этом разделе описывается архитектура полноценного решения для подготовки пользователей в распространенных гибридных средах. Имеется два связанных потока:

* **Полномочный поток данных отдела кадров Workday в локальную службу Active Directory.** В этом потоке связанные с работниками события (например, наем, перевод и увольнение) сначала происходят в облачном клиенте отдела кадров Workday, а затем данные событий передаются в локальную службу Active Directory через Azure AD и агент подготовки. В зависимости от события, это может приводить к операциям создания, обновления, включения или отключения в AD.
* **Адрес электронной почты и обратная запись имени пользователя потока — из локальной службы Active Directory в Workday:** По завершении создания учетной записи в Active Directory, они синхронизируются с Azure AD с помощью Azure AD Connect, и атрибут электронной почты и имя пользователя можно записать обратно в Workday.

![Обзор](./media/workday-inbound-tutorial/wd_overview.png)

### <a name="end-to-end-user-data-flow"></a>Полноценный поток данных пользователей

1. Команда отдела кадров выполняет транзакции с работниками (присоединение, перемещение и удаление или найм, перевод и увольнение) в Workday HCM.
2. Служба подготовки Azure AD выполняет плановую синхронизацию удостоверений из Workday HR и определяет изменения, которые требуется обработать для синхронизации с локальной службой Active Directory.
3. Служба подготовки Azure AD вызывает локальный агент подготовки AAD Connect, включив операции создания, обновления, включения или отключения учетных записей AD в полезные данные запроса.
4. Агент подготовки Azure AD Connect использует учетную запись службы для добавления или обновления данных учетной записи AD.
5. Модуль Azure AD Connect/AD Sync выполняет разностную синхронизацию, чтобы получить обновления в AD.
6. Обновления Active Directory синхронизируются с Azure Active Directory.
7. Если обратная запись Workday соединитель настроен, он записывает атрибут электронной почты и имя пользователя в Workday, на основе сопоставления атрибута используется.

## <a name="planning-your-deployment"></a>Планирование развертывания

Прежде чем приступить к интеграции Workday, проверьте, выполнены ли указанные ниже предварительные условия, и прочтите следующее руководство о том, как сопоставить текущую архитектуру Active Directory и требования к подготовке пользователей с решениями, предоставляемыми Azure Active Directory. Кроме того, доступен комплексный [план развертывания](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-deployment-plans) с рабочими таблицами планирования, чтобы помочь вам в сотрудничестве с вашим партнером по интеграции Workday и заинтересованными лицами по работе с персоналом.

В этом разделе описываются следующие аспекты планирования:

* [Предварительные требования](#prerequisites)
* [Выбор развертываемых приложений соединителей подготовки](#selecting-provisioning-connector-apps-to-deploy).
* [Планирование развертывания агента подготовки Azure AD Connect](#planning-deployment-of-azure-ad-connect-provisioning-agent).
* [Интеграция с несколькими доменами Active Directory](#integrating-with-multiple-active-directory-domains).
* [Планирование трансформации и сопоставления атрибутов пользователей Workday и Active Directory](#planning-workday-to-active-directory-user-attribute-mapping-and-transformations).

### <a name="prerequisites"></a>Технические условия

Сценарий, описанный в этом учебнике, предполагает, что у вас уже имеется:

* Действительная подписка AD Premium P1 или выше с правами глобального администратора.
* Клиент реализации Workday для целей тестирования и интеграции.
* Права администратора в Workday для создания пользователя системы интеграции и внесения изменений для проверки данных о сотруднике в целях тестирования.
* Для подготовки пользователей в Active Directory на сервере Windows Server 2012 (или более поздней версии) со средой выполнения .NET 4.7.1+ должен быть размещен [локальный агент подготовки](https://go.microsoft.com/fwlink/?linkid=847801).
* [Azure AD Connect](../hybrid/whatis-hybrid-identity.md) для синхронизации пользователей между Active Directory и Azure AD.

### <a name="selecting-provisioning-connector-apps-to-deploy"></a>Выбор развертываемых приложений соединителей подготовки

Чтобы упростить подготовку рабочих процессов между Workday и Active Directory, Azure AD предоставляет ряд приложений соединителей подготовки, которые можно добавлять из коллекции приложений Azure AD.

![Коллекция приложений Azure AD](./media/workday-inbound-tutorial/wd_gallery.png)

* **Workday to Active Directory User Provisioning** — это приложение упрощает подготовку учетной записи пользователя из Workday в одном домене Active Directory. Если имеется несколько доменов, можно добавить один экземпляр этого приложения из коллекции приложений Azure AD для каждого домена Active Directory, в котором требуется подготовка.

* **Workday to Azure AD User Provisioning** — так как AAD Connect представляет собой инструмент, который должен использоваться для синхронизации пользователей Active Directory с Azure Active Directory, это приложение можно применять для упрощения подготовки только облачных пользователей из Workday в одном клиенте Azure Active Directory.

* **Workday Writeback** — это приложение упрощает обратную запись электронных адресов пользователей из Azure Active Directory в Workday.

> [!TIP]
> Стандартное приложение Workday используется для настройки единого входа между Workday и Azure Active Directory.

Воспользуйтесь приведенной ниже схемой принятия решений, чтобы определить, какие приложения подготовки Workday подходят для вашего сценария.
    ![Блок-схема принятия решений](./media/workday-inbound-tutorial/wday_app_flowchart.png "Decision Flowchart")

Используйте оглавление, чтобы перейти к соответствующему разделу этого руководства.

### <a name="planning-deployment-of-azure-ad-connect-provisioning-agent"></a>Планирование развертывания агента подготовки Azure AD Connect

> [!NOTE]
> Этот раздел актуален только в том случае, если вы планируете развернуть приложение Workday to Active Directory User Provisioning. Вы можете пропустить этот шаг, если развертываете приложение Workday Writeback или Workday to Azure AD User Provisioning.

Решение для подготовки пользователей из Workday в AD требует развертывания одного или нескольких агентов подготовки на серверах под управлением Windows 2012 R2 или более поздней версии, содержащих не менее 4 ГБ ОЗУ, со средой выполнения .NET 4.7.1+. Перед установкой агента подготовки следует учитывать следующие факторы:

* Убедитесь, что у хост-сервера, на котором выполняется агент подготовки, есть доступ к целевому домену AD.
* Мастер настройки агента подготовки регистрирует агент в клиенте Azure AD, для чего требуется доступ к домену *.msappproxy.net на порту SSL 443. Убедитесь в наличии правил брандмауэра для исходящего трафика, обеспечивающих такую связь. Агент поддерживает [конфигурацию прокси-сервера исходящих HTTPS-подключений](#how-do-i-configure-the-provisioning-agent-to-use-a-proxy-server-for-outbound-http-communication).
* Агент подготовки использует учетную запись службы для связи с локальными доменами AD. Перед установкой агента рекомендуем создать учетную запись службы с разрешениями администратора домена, а также паролем, срок действия которого не ограничен.  
* Во время настройки агента подготовки можно выбрать контроллеры домена, которые должны обрабатывать запросы на подготовку. Если у вас есть несколько географически распределенных контроллеров домена, установите агент подготовки на том же сайте, что и предпочитаемые контроллеры домена, чтобы повысить надежность и производительность полноценного решения.
* Для обеспечения высокого уровня доступности вы можете развернуть несколько агентов подготовки и зарегистрировать их для обработки одного набора локальных доменов AD.

> [!IMPORTANT]
> В рабочих средах корпорация Майкрософт рекомендует настроить не менее 3 агентов подготовки с клиентом Azure AD для обеспечения высокого уровня доступности.

### <a name="integrating-with-multiple-active-directory-domains"></a>Интеграция с несколькими доменами Active Directory

> [!NOTE]
> Этот раздел актуален только в том случае, если вы планируете развернуть приложение Workday to Active Directory User Provisioning. Вы можете пропустить этот шаг, если развертываете приложение Workday Writeback или Workday to Azure AD User Provisioning.

В зависимости от топологии Active Directory вам нужно будет определить количество приложений соединителя подготовки пользователей и количество агентов подготовки, которые необходимо настроить. Ниже перечислены некоторые из распространенных шаблонов развертывания, которые можно использовать при планировании развертывания.

#### <a name="deployment-scenario-1--single-workday-tenant---single-ad-domain"></a>Сценарий развертывания № 1: один клиент Workday -> один домен AD

В этом сценарии у вас есть один клиент Workday и вы хотели бы подготовить пользователей для одного целевого домена AD. Ниже приведена рекомендуемая рабочая конфигурация для этого развертывания.

|   |   |
| - | - |
| № агентов подготовки для развертывания в локальной среде | 3 (для высокого уровня доступности и отработки отказа) |
| № приложений подготовки пользователей Workday в AD для настройки на портале Azure | 1 |

  ![Сценарий 1](./media/workday-inbound-tutorial/dep_scenario1.png)

#### <a name="deployment-scenario-2--single-workday-tenant---multiple-child-ad-domains"></a>Сценарий развертывания № 2: один клиент Workday -> несколько дочерних доменов AD

Этот сценарий предусматривает подготовку пользователей Workday для нескольких целевых дочерних доменов AD в лесу. Ниже приведена рекомендуемая рабочая конфигурация для этого развертывания.

|   |   |
| - | - |
| № агентов подготовки для развертывания в локальной среде | 3 (для высокого уровня доступности и отработки отказа) |
| № приложений подготовки пользователей Workday в AD для настройки на портале Azure | одно приложение на дочерний домен |

  ![Сценарий 2](./media/workday-inbound-tutorial/dep_scenario2.png)

#### <a name="deployment-scenario-3--single-workday-tenant---disjoint-ad-forests"></a>Сценарий развертывания № 3: один клиент Workday -> несвязанные леса AD

Этот сценарий предусматривает подготовку пользователей из Workday в домены в несвязанных лесах AD. Ниже приведена рекомендуемая рабочая конфигурация для этого развертывания.

|   |   |
| - | - |
| № агентов подготовки для развертывания в локальной среде | 3 на несвязанный лес AD |
| № приложений подготовки пользователей Workday в AD для настройки на портале Azure | одно приложение на дочерний домен |

  ![Сценарий 3](./media/workday-inbound-tutorial/dep_scenario3.png)

### <a name="planning-workday-to-active-directory-user-attribute-mapping-and-transformations"></a>Планирование трансформации и сопоставления атрибутов пользователей Workday и Active Directory

> [!NOTE]
> Этот раздел актуален только в том случае, если вы планируете развернуть приложение Workday to Active Directory User Provisioning. Вы можете пропустить этот шаг, если развертываете приложение Workday Writeback или Workday to Azure AD User Provisioning.

Перед началом настройки подготовки пользователей для домена Active Directory ответьте на приведенные ниже вопросы. Ответы на эти вопросы определяют, как необходимо задать фильтры области и атрибуты сопоставления.

* **Каких пользователей в Workday нужно подготовить в этот лес Active Directory?**

  * *Пример. Пользователи, у которых атрибут "Company" Workday содержит значение "Contoso", а атрибут "Worker_Type" — "Regular"* .

* **Каким образом пользователи направляются в разные подразделения организации (OU)?**

  * *Пример. Пользователи направляются в подразделения, соответствующие расположению офиса, как определено в атрибутах "Municipality" и "Country_Region_Reference" Workday*.

* **Как необходимо заполнить следующие атрибуты в Active Directory?**

  * Общее имя (cn)
    * *Пример. Используйте значение User_ID Workday, задаваемое отделом кадров*.

  * Идентификатор сотрудника (employeeId)
    * *Пример. Используйте значение Worker_ID Workday*.

  * Имя учетной записи SAM (sAMAccountName)
    * *Пример. Используйте значение User_ID Workday, отфильтрованное с помощью выражения подготовки Azure AD для удаления недопустимых символов*.

  * Имя участника-пользователя (userPrincipalName)
    * *Пример. Используйте значение User_ID Workday с выражением подготовки Azure AD для добавления доменного имени*.

* **Каким образом необходимо сопоставить пользователей Workday и Active Directory?**

  * *Пример. Пользователи с определенным значением "Worker_ID" Workday сопоставляются с пользователями Active Directory, у которых "employeeID" имеет то же значение. Если значение Worker_ID не найдено в Active Directory, создайте пользователя.*
  
* **Содержит ли лес Active Directory идентификаторы пользователей, необходимые для работы логики сопоставления?**

  * *Пример. Если это новое развертывание Workday, мы советуем предварительно заполнить Active Directory правильными значениями Worker_ID Workday (или значением выбранного уникального идентификатора) с целью максимального упрощения логики сопоставления.*

В оставшихся разделах этого руководства рассматриваются процедуры установки и настройки этих специальных приложений соединителей подготовки. Выбор приложений, которые требуется настроить, будет зависеть от того, в каких системах необходимо выполнить подготовку и сколько доменов Active Directory и клиентов Azure AD находится в вашей среде.

## <a name="configure-integration-system-user-in-workday"></a>Настройка пользователя системы интеграции в Workday

Общее требование всех соединителей подготовки Workday состоит в том, что для подключения к API отдела кадров Workday необходимы учетные данные для пользователя системы интеграции Workday. В следующих разделах описывается создание пользователя системы интеграции в Workday:

* [Создание пользователя системы интеграции](#creating-an-integration-system-user)
* [Создание группы безопасности интеграции](#creating-an-integration-security-group)
* [Настройка разрешений политики безопасности домена](#configuring-domain-security-policy-permissions)
* [Настройка разрешений политики безопасности для бизнес-процессов](#configuring-business-process-security-policy-permissions)
* [Активация изменений политики безопасности](#activating-security-policy-changes)

> [!NOTE]
> Эту процедуру можно обойти и использовать учетную запись глобального администратора Workday в качестве учетной записи системной интеграции. Такой вариант подойдет для демонстраций, но не рекомендуется для рабочих развертываний.

### <a name="creating-an-integration-system-user"></a>Создание пользователя системы интеграции

**Создание пользователя системы интеграции:**

1. Войдите в клиент Workday с помощью учетной записи администратора. В области **Workday Application** введите в поле поиска "create user", а затем щелкните ссылку **Create Integration System User** (Создать пользователя системы интеграции).

    ![Создание пользователя](./media/workday-inbound-tutorial/wd_isu_01.png "Создание пользователя")
2. Завершите задачу **Создание пользователя системы интеграции** , указав имя пользователя и пароль для нового пользователя системы интеграции.  
  
* Не устанавливайте флажок **Require New Password at Next Sign In** (Запросить новый пароль при следующем входе), так как этот пользователь будет осуществлять вход в систему программными средствами.
* Для параметра **Session Timeout Minutes** (Время ожидания сеанса в минутах) оставьте значение по умолчанию 0, что не позволит сеансам пользователя завершаться раньше времени.
* Выберите параметр **Do Not Allow UI Sessions** (Не разрешать сеансы пользовательского интерфейса), так как он предоставляет пользователю пароль системы интеграции при входе в Workday.

    ![Создание пользователя системы интеграции](./media/workday-inbound-tutorial/wd_isu_02.png "Создание пользователя системы интеграции")

### <a name="creating-an-integration-security-group"></a>Создание группы безопасности интеграции

На этом этапе вы создадите неограниченную или ограниченную группу безопасности системы интеграции в Workday и назначите этой группе систему интеграции, созданную пользователем на предыдущем этапе.

**Создание группы безопасности:**

1. Введите в поле поиска текст "создать группу безопасности", а затем щелкните **Создать группу безопасности**.

    ![Создание группы безопасности](./media/workday-inbound-tutorial/wd_isu_03.png "Создание группы безопасности")
2. Завершите задачу **создания группы безопасности**. 

   * Есть два типа групп безопасности в Workday:
     * **Без ограничений.** Все участники группы безопасности могут получить доступ ко всем экземплярам данных, защищенным группой безопасности.
     * **С ограничениями.** Все участники группы безопасности имеют контекстный доступ к подмножеству экземпляров данных (строк), к которым группа безопасности может получить доступ.
   * Обратитесь к партнеру по интеграции Workday, чтобы выбрать подходящий тип группы безопасности для интеграции.
   * Зная тип группы, выберите **Integration System Security Group (Unconstrained)** (Группа безопасности системы интеграции без ограничений) или **Integration System Security Group (Сonstrained)** (Группа безопасности системы интеграции с ограничениями) в раскрывающемся списке **Type of Tenanted Security Group** (Тип клиентской группы безопасности).

     ![Создание группы безопасности](./media/workday-inbound-tutorial/wd_isu_04.png "Создание группы безопасности")

3. После успешного создания группы безопасности вы увидите страницу, где можно назначать участников группе безопасности. Добавьте в эту группу безопасности нового пользователя системы интеграции, созданного на предыдущем шаге. Если вы используете *группу безопасности с ограничениями*, вам также нужно будет выбрать соответствующую область организации.

    ![Изменение группы безопасности](./media/workday-inbound-tutorial/wd_isu_05.png "Изменение группы безопасности")

### <a name="configuring-domain-security-policy-permissions"></a>Настройка разрешений политики безопасности домена

На этом этапе вы предоставите группе безопасности разрешения политики "безопасности домена" для данных рабочей роли.

**Настройка разрешений политики безопасности домена:**

1. В поле поиска введите **Domain Security Configuration**, а затем перейдите по ссылке **Domain Security Configuration Report** (Отчет о конфигурации безопасности домена).  

    ![Политики безопасности домена](./media/workday-inbound-tutorial/wd_isu_06.png "Политики безопасности домена")  
2. С помощью текстового поля **Domain** (Домен) найдите указанные ниже домены и добавьте их к фильтру по одному.  
   * *External Account Provisioning* (Подготовка внешних учетных записей)
   * *Worker Data: Public Worker Reports* (Данные о работниках: общедоступные отчеты о работниках)
   * *Person Data: Work Contact Information* (Данные о людях: рабочие контактные данные)
   * *Worker Data: All Positions* (Данные о работниках: все должности)
   * *Worker Data: Current Staffing Information* (Данные о работниках: сведения о текущем персонале)
   * *Worker Data: Business Title on Worker Profile* (Данные о работниках: рабочая должность в профиле работника)
   * *Учетные записи workday*
   
     ![Политики безопасности домена](./media/workday-inbound-tutorial/wd_isu_07.png "Политики безопасности домена")  

     ![Политики безопасности домена](./media/workday-inbound-tutorial/wd_isu_08.png "Политики безопасности домена") 

     Последовательно выберите **ОК**.

3. В открывшемся отчете нажмите многоточие (...) рядом с элементом **External Account Provisioning** и выберите пункт меню **Domain -> Edit Security Policy Permissions** (Домен -> Изменить разрешения политики безопасности).

    ![Политики безопасности домена](./media/workday-inbound-tutorial/wd_isu_09.png "Политики безопасности домена")  

4. Прокрутите страницу **Edit Domain Security Policy Permissions** (Изменение разрешений политики безопасности для домена) до раздела **Integration Permissions** (Разрешения интеграции). Нажмите значок "+", чтобы добавить группу системы интеграции в список групп безопасности с разрешениями интеграции **Get** и **Put**.

    ![Изменение разрешения](./media/workday-inbound-tutorial/wd_isu_10.png "Изменение разрешения")  

5. Нажмите значок "+", чтобы добавить группу системы интеграции в список групп безопасности с разрешениями интеграции **Get** и **Put**.

    ![Изменение разрешения](./media/workday-inbound-tutorial/wd_isu_11.png "Изменение разрешения")  

6. Повторите указанные выше этапы 3–5 для каждой из оставшихся политик безопасности:

   | Операция | Политика безопасности домена |
   | ---------- | ---------- |
   | Get и Put | Worker Data: Public Worker Reports (Данные о работниках: общедоступные отчеты о работниках) |
   | Get и Put | Person Data: Work Contact Information (Данные о людях: рабочие контактные данные) |
   | Получить | Worker Data: All Positions (Данные о работниках: все должности) |
   | Получить | Worker Data: Current Staffing Information (Данные о работниках: сведения о текущем персонале) |
   | Получить | Worker Data: Business Title on Worker Profile (Данные о работниках: рабочая должность в профиле работника) |
   | Get и Put | Учетные записи workday |

### <a name="configuring-business-process-security-policy-permissions"></a>Настройка разрешений политики безопасности для бизнес-процессов

На этом этапе вы предоставите группе безопасности разрешения политики безопасности бизнес-процессов для данных рабочей роли. Этот шаг необходим для настройки соединителя приложения Workday Writeback.

**Настройка разрешений политики безопасности для бизнес-процессов:**

1. Введите **Business Process Policy** в поле поиска и выберите задачу **Edit Business Process Security Policy** (Изменение политики безопасности бизнес-процессов).  

    ![Политики безопасности бизнес-процессов](./media/workday-inbound-tutorial/wd_isu_12.png "Политики безопасности бизнес-процессов")  

2. В текстовом поле **Business Process Type** (Тип бизнес-процесса) выполните поиск по запросу *Contact*, выберите бизнес-процесс **Contact Change** (Изменение контакта) и нажмите кнопку **ОК**.

    ![Политики безопасности бизнес-процессов](./media/workday-inbound-tutorial/wd_isu_13.png "Политики безопасности бизнес-процессов")  

3. Прокрутите страницу **Edit Business Process Security Policy** (Изменение политики безопасности бизнес-процессов) до раздела **Maintain Contact Information (Web Service)** (Хранение контактных данных — веб-служба).

    ![Политики безопасности бизнес-процессов](./media/workday-inbound-tutorial/wd_isu_14.png "Политики безопасности бизнес-процессов")  

4. Выберите новую группу безопасности системы интеграции и добавьте ее в список групп безопасности, которая может инициировать запрос к веб-службам. Нажмите кнопку **Готово**. 

    ![Политики безопасности бизнес-процессов](./media/workday-inbound-tutorial/wd_isu_15.png "Политики безопасности бизнес-процессов")  

### <a name="activating-security-policy-changes"></a>Активация изменений политики безопасности

**Активация изменений политики безопасности:**

1. Введите "активировать" в поле поиска и затем нажмите ссылку **Активировать ожидающие изменения политики безопасности**.

    ![Активация](./media/workday-inbound-tutorial/wd_isu_16.png "Активация")

1. Начните выполнять задачу активации ожидающих изменений политики безопасности: введите комментарий для проведения аудита и нажмите кнопку **ОК**.
1. Завершите задачу на следующем экране, установив флажок **Confirm** (Подтверждаю) и нажав кнопку **ОК**.

    ![Активация ожидающих изменений безопасности](./media/workday-inbound-tutorial/wd_isu_18.png "Активация ожидающих изменений безопасности")  

## <a name="configuring-user-provisioning-from-workday-to-active-directory"></a>Настройка подготовки пользователей из Workday в Active Directory

В этом разделе описаны шаги для подготовки учетных записей пользователей из Workday в каждом домене Active Directory в области интеграции.

* [Установка и настройка локальных агентов подготовки](#part-1-install-and-configure-on-premises-provisioning-agents)
* [Добавление приложения соединителя подготовки и создание подключения к Workday](#part-2-adding-the-provisioning-connector-app-and-creating-the-connection-to-workday)
* [Настройка сопоставлений атрибутов](#part-3-configure-attribute-mappings)
* [Включение и запуск подготовки пользователей](#enable-and-launch-user-provisioning)

### <a name="part-1-install-and-configure-on-premises-provisioning-agents"></a>Часть 1. Установка и настройка локальных агентов подготовки

Чтобы подготовить локальную службу Active Directory, необходимо установить агент на сервере с .NET 4.7.1+ Framework и сетевым доступом к нужным доменам Active Directory.

> [!TIP]
> Вы можете проверить версию платформы .NET на вашем сервере, воспользовавшись представленными [здесь](https://docs.microsoft.com/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed) инструкциями.
> Если на сервере не установлена платформа .NET 4.7.1 или более поздней версии, вы можете скачать ее [здесь](https://support.microsoft.com/help/4033342/the-net-framework-4-7-1-offline-installer-for-windows).  

Развернув .NET 4.7.1+, вы можете скачать **[локальный агент подготовки здесь](https://go.microsoft.com/fwlink/?linkid=847801)** и выполнить указанные ниже действия, чтобы завершить настройку агента.

1. Войдите в Windows Server, где вы хотите установить новый агент.

1. Запустите установщик агента подготовки, принять условия и щелкнуть **установить** кнопки.

   ![Экран установки](./media/workday-inbound-tutorial/pa_install_screen_1.png "Экран установки")
   
1. По завершении установки запустится мастер, и вы увидите экран **Connect Azure AD** (Подключение Azure AD). Нажмите кнопку **Authenticate** (Проверка подлинности), чтобы подключиться к экземпляру Azure AD.

   ![Подключение Azure AD](./media/workday-inbound-tutorial/pa_install_screen_2.png "Подключение Azure AD")
   
1. Пройдите проверку подлинности в экземпляре Azure AD, используя учетные данные глобального администратора.

   ![Проверка подлинности администратора](./media/workday-inbound-tutorial/pa_install_screen_3.png "Проверка подлинности администратора")

   > [!NOTE]
   > Учетные данные администратора Azure AD используются только для того, чтобы подключиться к клиенту Azure AD. Агент не хранит учетные данные локально на сервере.

1. После успешной проверки подлинности в Azure AD вы увидите экран **Connect Active Directory** (Подключение Active Directory). Теперь введите доменное имя AD и нажмите кнопку **Add Directory** (Добавить каталог).

   ![Добавление каталога](./media/workday-inbound-tutorial/pa_install_screen_4.png "Добавление каталога")
  
1. Вам будет предложено ввести учетные данные, необходимые для подключения к домену AD. На том же экране можно использовать команду **Select domain controller priority** (Выбрать приоритет контроллеров домена), чтобы указать контроллеры домена, которые агент должен использовать для отправки запросов на подготовку.

   ![Учетные данные домена](./media/workday-inbound-tutorial/pa_install_screen_5.png)
   
1. После настройки домена установщик выводит список настроенных доменов. На этом экране можно повторить действия 5 и 6, чтобы добавить другие домены, или нажать кнопку **Next** (Далее), чтобы перейти к регистрации агента.

   ![Настроенные домены](./media/workday-inbound-tutorial/pa_install_screen_6.png "Настроенные домены")

   > [!NOTE]
   > Если у вас несколько доменов AD (например, na.contoso.com, emea.contoso.com), добавляйте домены в список по отдельности.
   > Просто добавить родительский домен (например, contoso.com) недостаточно. Необходимо зарегистрировать каждый дочерний домен с агентом.
   
1. Просмотрите данные конфигурации и нажмите кнопку **Confirm** (Подтвердить), чтобы зарегистрировать агент.
  
   ![Экран подтверждения](./media/workday-inbound-tutorial/pa_install_screen_7.png "Экран подтверждения")
   
1. В мастере настройки отображается ход регистрации агента.
  
   ![Регистрация агента](./media/workday-inbound-tutorial/pa_install_screen_8.png "Регистрация агента")
   
1. После успешной регистрации агента вы можете нажать кнопку **Exit** (Выход), чтобы выйти из мастера.
  
   ![Экран выхода](./media/workday-inbound-tutorial/pa_install_screen_9.png "Экран выхода")
   
1. Проверьте установку агента и убедитесь, что он работает, открыв оснастку "Services" (Службы) и обнаружив службу "Microsoft Azure AD Connect Provisioning Agent".
  
   ![Службы](./media/workday-inbound-tutorial/services.png)

### <a name="part-2-adding-the-provisioning-connector-app-and-creating-the-connection-to-workday"></a>Часть 2. Добавление приложения соединителя подготовки и создание подключения к Workday

**Настройка подготовки Workday в Active Directory.**

1. Перейдите на сайт <https://portal.azure.com>.

2. В области навигации слева выберите **Azure Active Directory**.

3. Щелкните **Корпоративные приложения**, а затем — **Все приложения**.

4. Выберите **Добавить приложение** и выберите категорию **Все**.

5. Выполните поиск по условию **Подготовка Workday в Active Directory** и добавьте это приложение из коллекции.

6. После добавления приложения и отображения экрана сведений о приложений выберите **Подготовка**.

7. Для параметра **Режим подготовки** **к работе** выберите значение **Автоматически**.

8. В разделе **Учетные данные администратора** заполните поля следующим образом.

   * **Имя пользователя администратора** — введите имя пользователя учетной записи системы интеграции Workday с указанием имени домена клиента. Он должен выглядеть примерно так: **username\@имя_клиента**

   * **Пароль администратора** — введите пароль учетной записи системы интеграции Workday.

   * **URL-адрес клиента** — введите URL-адрес конечной точки веб-служб Workday для вашего клиента. Значение должно иметь следующий вид: https://wd3-impl-services1.workday.com/ccx/service/contoso4, где *contoso4* заменяется правильным именем клиента, а *wd3-impl* — правильной строкой среды.

   * **Лес Active Directory** — имя домена Active Directory, зарегистрированное в агенте. В раскрывающемся списке выберите целевой домен для подготовки. Как правило, это строка вида: *contoso.com*.

   * **Контейнер Active Directory** — выберите различающееся имя контейнера, в котором агент должен по умолчанию создавать учетные записи пользователей.
        Пример: *OU=Standard Users,OU=Users,DC=contoso,DC=test*
        
     > [!NOTE]
     > Этот параметр используется только при создании учетных записей, если в сопоставлениях атрибутов не настроен атрибут *parentDistinguishedName*. Этот параметр не используется для операций обновления и поиска пользователей. Областью действия операции поиска является все дочернее дерево домена.

   * **Адрес электронной почты для уведомлений** — введите адрес электронной почты и установите флажок "send email if failure occurs" (Отправлять по электронной почте в случае сбоя).

     > [!NOTE]
     > Служба подготовки Azure AD отправляет уведомление по электронной почте, если задание подготовки переходит в состояние [Карантин](https://docs.microsoft.com/azure/active-directory/manage-apps/user-provisioning#quarantine).

   * Нажмите кнопку **Проверить подключение**. Если проверка подключения выполнена успешно, нажмите кнопку **Сохранить** в верхней части. В случае неудачи убедитесь, что учетные данные Workday и AD, заданные в настройках агента, действительны.

     ![Портал Azure](./media/workday-inbound-tutorial/wd_1.png)

   * После успешного сохранения учетных данных в разделе **Сопоставления** отобразится сопоставление по умолчанию **Synchronize Workday Workers to On Premises Active Directory** (Синхронизировать работников Workday с локальной средой Active Directory).

### <a name="part-3-configure-attribute-mappings"></a>Часть 3. Настройка сопоставлений атрибутов

В этом разделе вы настроите потоки данных пользователя из Workday в Active Directory.

1. На вкладке "Подготовка" в разделе **Сопоставления** щелкните **Synchronize Workday Workers to On Premises Active Directory** (Синхронизировать работников Workday с локальной средой Active Directory).

1. В поле **Область исходного объекта** можно выбрать, какие наборы пользователей в Workday должны учитываться при подготовке в AD, определив набор фильтров на основе атрибутов. Область по умолчанию — "Все пользователи в Workday". Примеры фильтров

   * Пример: Охват пользователей с идентификаторами рабочих от 1000000 до 2000000 (за исключением 2000000)

      * Атрибут: WorkerID.

      * Оператор: REGEX MATCH.

      * Значение: (1[0–9][0–9][0–9][0–9][0–9][0–9]).

   * Пример: Только сотрудники, а не временные работники.

      * Атрибут: EmployeeID

      * Оператор: IS NOT NULL.

   > [!TIP]
   > При первой настройке приложения подготовки необходимо проверить сопоставления атрибутов и выражения, чтобы получить желаемый результат. Корпорация Майкрософт рекомендует использовать фильтры области действия в разделе **Область исходного объекта** для проверки сопоставлений с несколькими тестовыми пользователями из Workday. После проверки работоспособности сопоставлений можно либо удалить фильтр, либо постепенно расширять его, добавляя больше пользователей.

1. В поле **Действия с целевыми объектами** можно в глобальном масштабе отфильтровать, какие действия доступны для выполнения в Active Directory. Самыми распространенными являются **создание** и **обновление**.

1. В разделе **Сопоставление атрибутов** можно определить, как отдельные атрибуты Workday сопоставляются с атрибутами Active Directory.

1. Щелкните существующее сопоставление атрибута, чтобы его обновить, или **Добавить новое сопоставление** в нижней части экрана, чтобы добавить новые сопоставления. Отдельное сопоставление атрибутов поддерживает следующие свойства:

      * **Тип сопоставления**

         * **Прямой** — записывает значение атрибута Workday без изменений в атрибут AD.

         * **Константа** — записывает статическое постоянное строковое значение в атрибут AD.

         * **Выражение** — позволяет записывать пользовательское значение в атрибут AD на основании одного или нескольких атрибутов Workday. [Дополнительные сведения см. в статье о выражениях](../manage-apps/functions-for-customizing-application-data.md).

      * **Исходный атрибут** — атрибут пользователя из Workday. Если нужный вам атрибут отсутствует, см. раздел [Настройка списка атрибутов пользователя Workday](#customizing-the-list-of-workday-user-attributes).

      * **Значение по умолчанию** — необязательно. Если исходный атрибут имеет пустое значение, сопоставление запишет это значение.
            В наиболее распространенной конфигурации это поле остается пустым.

      * **Целевой атрибут** — атрибут пользователя в Active Directory.

      * **Сопоставление объектов с помощью этого атрибута** — должно ли это сопоставление использоваться для уникальной идентификации пользователей между Workday и Active Directory. Как правило, значение задается в поле ИД работника для Workday, который обычно сопоставляется с одним из атрибутов ИД сотрудника в Active Directory.

      * **Приоритет сопоставления** — возможность указания нескольких атрибутов сопоставления. При указании нескольких атрибутов сопоставления они вычисляются в порядке, заданном в этом поле. Как только соответствие найдено, дальнейшие атрибуты сопоставления не вычисляются.

      * **Применить это сопоставление**

         * **Всегда** — применить это сопоставление как при создании, так и при обновлении пользователей

         * **Только при создании** — применить это сопоставление только при создании пользователей

1. Чтобы сохранить сопоставления, щелкните **Сохранить** в верхней части раздела "Сопоставление атрибутов".

   ![Портал Azure](./media/workday-inbound-tutorial/wd_2.png)

#### <a name="below-are-some-example-attribute-mappings-between-workday-and-active-directory-with-some-common-expressions"></a>Ниже приведено несколько примеров сопоставлений атрибутов между Workday и Active Directory с некоторыми общими выражениями.

* Выражение, которое сопоставляется с атрибутом *parentDistinguishedName*, используется для подготовки пользователей для разных подразделений на основе одного или нескольких исходных атрибутов Workday. В этом примере пользователи помещаются в разные подразделения в зависимости от города, в котором они находятся.

* Атрибут *userPrincipalName* в Active Directory создается с использованием функции дедупликации [SelectUniqueValue](../manage-apps/functions-for-customizing-application-data.md#selectuniquevalue), которая проверяет наличие созданного значения в целевом домене AD и задает его только в том случае, если оно уникально.  

* [Документацию о написании выражений см. здесь](../manage-apps/functions-for-customizing-application-data.md). В этот раздел входят примеры, демонстрирующие удаление специальных символов.

| АТРИБУТ WORKDAY | АТРИБУТ ACTIVE DIRECTORY |  ИДЕНТИФИКАТОР СОПОСТАВЛЕНИЯ? | СОЗДАНИЕ ИЛИ ОБНОВЛЕНИЕ |
| ---------- | ---------- | ---------- | ---------- |
| **WorkerID**  |  EmployeeID | **Да** | Записывается только при создании |
| **PreferredNameData**    |  cn    |   |   Записывается только при создании |
| **SelectUniqueValue (Join (»\@«, присоединиться к (".", \[FirstName\], \[LastName\]), «contoso.com»), присоединиться к (»\@«, Join (".", Mid (\[FirstName\], 1, 1 (), \[LastName\]), «contoso.com»), Join (»\@«, Join (".", Mid (\[FirstName\], 1, 2), \[LastName\]), «contoso.com»))**   | userPrincipalName     |     | Записывается только при создании 
| **Replace(Mid(Replace(\[UserID\], , "(\[\\\\/\\\\\\\\\\\\\[\\\\\]\\\\:\\\\;\\\\\|\\\\=\\\\,\\\\+\\\\\*\\\\?\\\\&lt;\\\\&gt;\])", , "", , ), 1, 20), , "([\\\\.)\*\$](file:///\\.)*$)", , "", , )**      |    sAMAccountName            |     |         Записывается только при создании |
| **Switch(\[Active\], , "0", "True", "1", "False")** |  accountDisabled      |     | Создание и обновление |
| **FirstName**   | givenName       |     |    Создание и обновление |
| **LastName**   |   sn   |     |  Создание и обновление |
| **PreferredNameData**  |  displayName |     |   Создание и обновление |
| **Company**         | company   |     |  Создание и обновление |
| **SupervisoryOrganization**  | department  |     |  Создание и обновление |
| **ManagerReference**   | manager  |     |  Создание и обновление |
| **BusinessTitle**   |  title     |     |  Создание и обновление | 
| **AddressLineData**    |  streetAddress  |     |   Создание и обновление |
| **Municipality**   |   l   |     | Создание и обновление |
| **CountryReferenceTwoLetter**      |   co |     |   Создание и обновление |
| **CountryReferenceTwoLetter**    |  c  |     |         Создание и обновление |
| **CountryRegionReference** |  st     |     | Создание и обновление |
| **WorkSpaceReference** | physicalDeliveryOfficeName    |     |  Создание и обновление |
| **PostalCode**  |   postalCode  |     | Создание и обновление |
| **PrimaryWorkTelephone**  |  TelephoneNumber   |     | Создание и обновление |
| **Fax**      | facsimileTelephoneNumber     |     |    Создание и обновление |
| **Mobile**  |    mobile       |     |       Создание и обновление |
| **LocalReference** |  preferredLanguage  |     |  Создание и обновление |                                               
| **Switch(\[Municipality\], "OU=Standard Users,OU=Users,OU=Default,OU=Locations,DC=contoso,DC=com", "Dallas", "OU=Standard Users,OU=Users,OU=Dallas,OU=Locations,DC=contoso,DC=com", "Austin", "OU=Standard Users,OU=Users,OU=Austin,OU=Locations,DC=contoso,DC=com", "Seattle", "OU=Standard Users,OU=Users,OU=Seattle,OU=Locations,DC=contoso,DC=com", “London", "OU=Standard Users,OU=Users,OU=London,OU=Locations,DC=contoso,DC=com")**  | parentDistinguishedName     |     |  Создание и обновление |

После завершения настройки сопоставления атрибутов [можно включить и запустить службу подготовки пользователей](#enable-and-launch-user-provisioning).

## <a name="configuring-user-provisioning-to-azure-ad"></a>Настройка подготовки учетных записей пользователей в Azure AD

В следующих разделах описаны действия по настройке подготовки пользователей из Workday в Azure AD для развертываний только в облаке.

* [Добавление приложения соединителя подготовки Azure AD и создание подключения к Workday](#part-1-adding-the-azure-ad-provisioning-connector-app-and-creating-the-connection-to-workday)
* [Настройка сопоставлений атрибутов Workday и Azure AD](#part-2-configure-workday-and-azure-ad-attribute-mappings)
* [Включение и запуск подготовки пользователей](#enable-and-launch-user-provisioning)

> [!IMPORTANT]
> Выполните следующую процедуру только в том случае, если существуют только облачные пользователи, которых необходимо подготовить в Azure AD, а не в локальной службе Active Directory.

### <a name="part-1-adding-the-azure-ad-provisioning-connector-app-and-creating-the-connection-to-workday"></a>Часть 1. Добавление приложения соединителя подготовки Azure AD и создание подключения к Workday

**Настройка подготовки только облачных пользователей Workday в Azure Active Directory**

1. Перейдите на сайт <https://portal.azure.com>.

2. В области навигации слева выберите **Azure Active Directory**.

3. Щелкните **Корпоративные приложения**, а затем — **Все приложения**.

4. Выберите **Добавить приложение**, а затем выберите категорию **Все**.

5. Выполните поиск по условию **Подготовка Workday в Azure AD** и добавьте это приложение из коллекции.

6. После добавления приложения и отображения экрана сведений о приложений выберите **Подготовка**.

7. Для параметра **Режим подготовки** **к работе** выберите значение **Автоматически**.

8. В разделе **Учетные данные администратора** заполните поля следующим образом.

   * **Имя пользователя администратора** — введите имя пользователя учетной записи системы интеграции Workday с указанием имени домена клиента. Оно должно иметь примерно следующий вид: username@contoso4

   * **Пароль администратора** — введите пароль учетной записи системы интеграции Workday.

   * **URL-адрес клиента** — введите URL-адрес конечной точки веб-служб Workday для вашего клиента. Значение должно иметь следующий вид: https://wd3-impl-services1.workday.com/ccx/service/contoso4/Human_Resources, где *contoso4* заменяется правильным именем клиента, а *wd3-impl* — правильной строкой среды. Если этот URL-адрес неизвестен, свяжитесь с вашим партнером по интеграции Workday или представителем службы поддержки, чтобы определить правильный URL-адрес для использования.

   * **Адрес электронной почты для уведомлений** — введите адрес электронной почты и установите флажок "send email if failure occurs" (Отправлять по электронной почте в случае сбоя).

   * Нажмите кнопку **Проверить подключение**.

   * Если проверка подключения выполнена успешно, нажмите кнопку **Сохранить** в верхней части. В случае неудачи дважды проверьте правильность URL-адреса и учетных данных Workday в приложении Workday.

### <a name="part-2-configure-workday-and-azure-ad-attribute-mappings"></a>Часть 2. Настройка сопоставлений атрибутов Workday и Azure AD

В этом разделе вы настроите потоки данных пользователя из Workday в Active Directory только для облачных пользователей.

1. На вкладке "Подготовка" в разделе **Сопоставления** щелкните **Synchronize Workers to Azure AD** (Синхронизировать работников с Azure AD).

2. В поле **Область исходного объекта** можно выбрать, какие наборы пользователей в Workday должны учитываться при подготовке в Azure AD, определив набор фильтров на основе атрибутов. Область по умолчанию — "Все пользователи в Workday". Примеры фильтров

   * Пример: Охват пользователей с идентификаторами рабочих ролей в диапазоне от 1000000 до 2000000

      * Атрибут: WorkerID.

      * Оператор: REGEX MATCH.

      * Значение: (1[0–9][0–9][0–9][0–9][0–9][0–9]).

   * Пример: Только временные работники, а не сотрудники

      * Атрибут: ContingentID.

      * Оператор: IS NOT NULL.

3. В поле **Действия с целевыми объектами** можно в глобальном масштабе отфильтровать, какие действия выполняются в Azure AD. Самыми распространенными являются **создание** и **обновление**.

4. В разделе **Сопоставление атрибутов** можно определить, как отдельные атрибуты Workday сопоставляются с атрибутами Active Directory.

5. Щелкните существующее сопоставление атрибута, чтобы его обновить, или **Добавить новое сопоставление** в нижней части экрана, чтобы добавить новые сопоставления. Отдельное сопоставление атрибутов поддерживает следующие свойства:

   * **Тип сопоставления**

      * **Прямой** — записывает значение атрибута Workday без изменений в атрибут AD.

      * **Константа** — записывает статическое постоянное строковое значение в атрибут AD.

      * **Выражение** — позволяет записывать пользовательское значение в атрибут AD на основании одного или нескольких атрибутов Workday. [Дополнительные сведения см. в статье о выражениях](../manage-apps/functions-for-customizing-application-data.md).

   * **Исходный атрибут** — атрибут пользователя из Workday. Если нужный вам атрибут отсутствует, см. раздел [Настройка списка атрибутов пользователя Workday](#customizing-the-list-of-workday-user-attributes).

   * **Значение по умолчанию** — необязательно. Если исходный атрибут имеет пустое значение, сопоставление запишет это значение.
            В наиболее распространенной конфигурации это поле остается пустым.

   * **Целевой атрибут** — атрибут пользователя в Azure AD.

   * **Сопоставление объектов с помощью этого атрибута** — должен ли этот атрибут использоваться для уникальной идентификации пользователей между Workday и Azure AD. Как правило, значение задается в поле ИД работника для Workday, который обычно сопоставляется с атрибутом ИД сотрудника (новым) или атрибутом расширения в Azure AD.

   * **Приоритет сопоставления** — возможность указания нескольких атрибутов сопоставления. При указании нескольких атрибутов сопоставления они вычисляются в порядке, заданном в этом поле. Как только соответствие найдено, дальнейшие атрибуты сопоставления не вычисляются.

   * **Применить это сопоставление**

     * **Всегда** — применить это сопоставление как при создании, так и при обновлении пользователей

     * **Только при создании** — применить это сопоставление только при создании пользователей

6. Чтобы сохранить сопоставления, щелкните **Сохранить** в верхней части раздела "Сопоставление атрибутов".

После завершения настройки сопоставления атрибутов [можно включить и запустить службу подготовки пользователей](#enable-and-launch-user-provisioning).

## <a name="configuring-azure-ad-attribute-writeback-to-workday"></a>Настройка компонента обратной записи атрибутов Azure AD в Workday

Выполните эти инструкции по настройке обратной записи адресов электронной почты пользователя и имени пользователя из Azure Active Directory в Workday.

* [Добавление приложения соединителя обратной записи и создание подключения к Workday](#part-1-adding-the-writeback-connector-app-and-creating-the-connection-to-workday)
* [Настройка сопоставлений атрибутов обратной записи](#part-2-configure-writeback-attribute-mappings)
* [Включение и запуск подготовки пользователей](#enable-and-launch-user-provisioning)

### <a name="part-1-adding-the-writeback-connector-app-and-creating-the-connection-to-workday"></a>Часть 1. Добавление приложения соединителя обратной записи и создание подключения к Workday

**Настройка соединителя обратной записи Workday:**

1. Перейдите на сайт <https://portal.azure.com>.

2. В области навигации слева выберите **Azure Active Directory**.

3. Щелкните **Корпоративные приложения**, а затем — **Все приложения**.

4. Выберите **Добавить приложение**, а затем выберите категорию **Все**.

5. Выполните поиск по условию **Обратная запись Workday** и добавьте это приложение из коллекции.

6. После добавления приложения и отображения экрана сведений о приложений выберите **Подготовка**.

7. Для параметра **Режим подготовки** **к работе** выберите значение **Автоматически**.

8. В разделе **Учетные данные администратора** заполните поля следующим образом.

   * **Имя пользователя администратора** — введите имя пользователя учетной записи системы интеграции Workday с указанием имени домена клиента. Должен выглядеть примерно так: *username\@contoso4*

   * **Пароль администратора** — введите пароль учетной записи системы интеграции Workday.

   * **URL-адрес клиента** — введите URL-адрес конечной точки веб-служб Workday для вашего клиента. Значение должно иметь следующий вид: https://wd3-impl-services1.workday.com/ccx/service/contoso4/Human_Resources, где *contoso4* заменяется правильным именем клиента, а *wd3-impl* — правильной строкой среды (если необходимо).

   * **Адрес электронной почты для уведомлений** — введите адрес электронной почты и установите флажок "send email if failure occurs" (Отправлять по электронной почте в случае сбоя).

   * Нажмите кнопку **Проверить подключение**. Если проверка подключения выполнена успешно, нажмите кнопку **Сохранить** в верхней части. В случае неудачи дважды проверьте правильность URL-адреса и учетных данных Workday в приложении Workday.

### <a name="part-2-configure-writeback-attribute-mappings"></a>Часть 2. Настройка сопоставлений атрибутов обратной записи

В этом разделе описывается настройка потока атрибутов обратной записи из Azure AD в Workday. В настоящее время соединитель будет поддерживать только обратной записи, адрес электронной почты и имя пользователя в Workday.

1. На вкладке "Подготовка" в разделе **Сопоставления** щелкните **Synchronize Azure Active Directory Users to Workday** (Синхронизировать пользователей Azure Active Directory с Workday).

2. В поле **Область исходного объекта** при необходимости можно отфильтровать, для каких групп пользователей в Azure Active Directory нужно выполнить обратную запись адресов электронной почты в Workday. Область по умолчанию — "Все пользователи в Azure AD".

3. В разделе **Сопоставление атрибутов**, обновите соответствующий идентификатор, чтобы указать атрибут в Azure Active Directory, где хранится идентификатор рабочей роли или идентификатор сотрудника для Workday. Распространенный метод сопоставления заключается в синхронизации ИД работника или ИД сотрудника Workday с extensionAttribute1-15 в Azure AD. Затем этот атрибут используется в Azure AD для обратного сопоставления пользователей в Workday.

4. Обычно сопоставляются Azure AD *userPrincipalName* атрибут Workday *UserID* атрибут и сопоставить Azure AD *mail* атрибут Workday  *EmailAddress* атрибута. Чтобы сохранить сопоставления, щелкните **Сохранить** в верхней части раздела "Сопоставление атрибутов".

После завершения настройки сопоставления атрибутов [можно включить и запустить службу подготовки пользователей](#enable-and-launch-user-provisioning).

## <a name="enable-and-launch-user-provisioning"></a>Включение и запуск подготовки пользователей

После завершения настройки приложения подготовки Workday можно включить службу подготовки на портале Azure.

> [!TIP]
> По умолчанию при включении службы подготовки она инициализирует операции подготовки для всех пользователей в области. При наличии ошибок в сопоставлении или проблем с данными Workday задание подготовки может завершиться ошибкой и перейти в состояние карантина. Чтобы избежать этого, рекомендуется настроить фильтр **Область исходного объекта** и протестировать сопоставления атрибутов с несколькими тестовыми пользователями перед запуском полной синхронизации всех пользователей. После проверки работоспособности сопоставлений и получения желаемых результатов можно либо удалить фильтр, либо постепенно расширять его, добавляя больше пользователей.

1. На вкладке **Подготовка** установите для параметра **Состояние подготовки** значение **Вкл**.

2. Выберите команду **Сохранить**.

3. Будет запущена начальная синхронизация, которая может длиться переменное число часов в зависимости от количества пользователей в клиенте Workday. 

4. В любой момент можно проверить вкладку **Журналы аудита** на портале Azure, чтобы узнать, какие действия выполнила служба подготовки. В журналах аудита перечислены все отдельные события синхронизации, выполняемые службой подготовки, например, какие пользователи считываются из Workday и впоследствии будут добавлены или обновлены в Active Directory. Инструкции по просмотру журналов аудита и исправлению ошибок подготовки см. в разделе об устранении неполадок.

5. После завершения первичной синхронизации на вкладке **Подготовка** будет создан сводный отчет аудита, как показано ниже.

   ![Портал Azure](./media/workday-inbound-tutorial/wd_3.png)

## <a name="frequently-asked-questions-faq"></a>Вопросы и ответы

* **Вопросы о возможностях решения**
  * [Как решение устанавливает пароль для новой учетной записи пользователя в Active Directory при обработке найма нового сотрудника из Workday?](#when-processing-a-new-hire-from-workday-how-does-the-solution-set-the-password-for-the-new-user-account-in-active-directory)
  * [Поддерживает ли решение отправку уведомлений по электронной почте после завершения подготовки?](#does-the-solution-support-sending-email-notifications-after-provisioning-operations-complete)
  * [Как управлять предоставлением паролей для новых сотрудников и безопасно предоставлять механизм сброса паролей?](#how-do-i-manage-delivery-of-passwords-for-new-hires-and-securely-provide-a-mechanism-to-reset-their-password)
  * [Решение кэширует профили пользователей Workday в облаке Azure AD или на уровне подготовки агента?](#does-the-solution-cache-workday-user-profiles-in-the-azure-ad-cloud-or-at-the-provisioning-agent-layer)
  * [Поддерживает ли решение назначение локальных групп AD пользователю?](#does-the-solution-support-assigning-on-premises-ad-groups-to-the-user)
  * [Какие API-интерфейсы Workday решение использует для запроса и обновления профилей работников Workday?](#which-workday-apis-does-the-solution-use-to-query-and-update-workday-worker-profiles)
  * [Можно ли настроить клиент Workday HCM с двумя клиентами Azure AD?](#can-i-configure-my-workday-hcm-tenant-with-two-azure-ad-tenants)
  * [Почему приложение подготовки пользователей из Workday в Azure AD не поддерживается, если мы развернули Azure AD Connect?](#why-workday-to-azure-ad-user-provisioning-app-is-not-supported-if-we-have-deployed-azure-ad-connect)
  * [Как предложить улучшения или запросить новые функции, связанные с интеграцией Workday и Azure AD?](#how-do-i-suggest-improvements-or-request-new-features-related-to-workday-and-azure-ad-integration)

* **Вопросы по работе агента подготовки**
  * [Какая версия агента подготовки является общедоступной?](#what-is-the-ga-version-of-the-provisioning-agent)
  * [Как узнать версию моего агента подготовки?](#how-do-i-know-the-version-of-my-provisioning-agent)
  * [Автоматически ли корпорация Майкрософт отправляет обновления агента подготовки?](#does-microsoft-automatically-push-provisioning-agent-updates)
  * [Можно ли установить агент подготовки на том же сервере, на котором выполняется AAD Connect?](#can-i-install-the-provisioning-agent-on-the-same-server-running-aad-connect)
  * [Как настроить агент подготовки для использования прокси-сервера исходящих HTTP-подключений?](#how-do-i-configure-the-provisioning-agent-to-use-a-proxy-server-for-outbound-http-communication)
  * [Как убедиться, что агент подготовки может взаимодействовать с клиентом Azure AD и никакие брандмауэры не блокируют порты, необходимые агенту?](#how-do-i-ensure-that-the-provisioning-agent-is-able-to-communicate-with-the-azure-ad-tenant-and-no-firewalls-are-blocking-ports-required-by-the-agent)
  * [Как отменить регистрацию домена, связанного с агентом подготовки?](#how-do-i-de-register-the-domain-associated-with-my-provisioning-agent)
  * [Как удалить агент подготовки?](#how-do-i-uninstall-the-provisioning-agent)
  
* **Вопросы по конфигурации и сопоставлению атрибутов Workday и AD**
  * [Как создать резервную копию или экспортировать рабочую копию сопоставления атрибутов подготовки Workday и схемы?](#how-do-i-back-up-or-export-a-working-copy-of-my-workday-provisioning-attribute-mapping-and-schema)
  * [У меня есть настраиваемые атрибуты в Workday и Active Directory. Как настроить решение для работы с настраиваемыми атрибутами?](#i-have-custom-attributes-in-workday-and-active-directory-how-do-i-configure-the-solution-to-work-with-my-custom-attributes)
  * [Можно ли подготовить фотографию пользователя из Workday в Active Directory?](#can-i-provision-users-photo-from-workday-to-active-directory)
  * [Как на основе согласия пользователя синхронизировать мобильные номера из Workday для публичного использования?](#how-do-i-sync-mobile-numbers-from-workday-based-on-user-consent-for-public-usage)
  * [Как форматировать отображаемые имена в AD на основе атрибутов отдела, страны и города пользователя и обрабатывать региональные различия?](#how-do-i-format-display-names-in-ad-based-on-the-users-departmentcountrycity-attributes-and-handle-regional-variances)
  * [Как использовать SelectUniqueValue для создания уникальных значений атрибута samAccountName?](#how-can-i-use-selectuniquevalue-to-generate-unique-values-for-samaccountname-attribute)
  * [Как удалить символы с диакритическими знаками и преобразовать их в обычный английский алфавит?](#how-do-i-remove-characters-with-diacritics-and-convert-them-into-normal-english-alphabets)

### <a name="solution-capability-questions"></a>Вопросы о возможностях решения

#### <a name="when-processing-a-new-hire-from-workday-how-does-the-solution-set-the-password-for-the-new-user-account-in-active-directory"></a>Как решение устанавливает пароль для новой учетной записи пользователя в Active Directory при обработке найма нового сотрудника из Workday?

Когда локальный агент подготовки получает запрос на создание новой учетной записи AD, он автоматически создает сложный случайный пароль, соответствующий требованиям сложности, определенным сервером AD, и устанавливает его для объекта пользователя. Этот пароль нигде не регистрируется.

#### <a name="does-the-solution-support-sending-email-notifications-after-provisioning-operations-complete"></a>Поддерживает ли решение отправку уведомлений по электронной почте после завершения подготовки?

Нет, отправка уведомлений по электронной почте после завершения операций подготовки в текущем выпуске не поддерживается.

#### <a name="how-do-i-manage-delivery-of-passwords-for-new-hires-and-securely-provide-a-mechanism-to-reset-their-password"></a>Как управлять предоставлением паролей для новых сотрудников и безопасно предоставлять механизм сброса паролей?

Одним из последних шагов подготовки новой учетной записи AD пользователя является предоставление назначенного ей временного пароля. Многие предприятия по-прежнему используют традиционный подход предоставления временного пароля руководителю пользователя, который затем передает его новому сотруднику или временному работнику. Этот процесс имеет недостаток, связанный с безопасностью. Есть возможность реализовать лучший подход с использованием возможностей Azure AD.

В рамках процесса найма команды отдела кадров обычно проводят фоновую проверку и проверяют номер мобильного телефона нового сотрудника. С помощью интеграции подготовки пользователей из Workday в AD вы можете внедрить и развернуть возможность самостоятельного сброса пароля для пользователя в первый день. Это достигается путем распространения атрибута "Номер мобильного телефона" нового сотрудника из Workday в AD, а затем из AD в Azure AD с помощью AAD Connect. Как только атрибут "Номер мобильного телефона" появится в Azure AD, можно включить функцию [самостоятельного сброса пароля (SSPR)](../authentication/howto-sspr-authenticationdata.md) для учетной записи пользователя, чтобы в первый день новый сотрудник мог использовать зарегистрированный и проверенный номер мобильного телефона для аутентификации.

#### <a name="does-the-solution-cache-workday-user-profiles-in-the-azure-ad-cloud-or-at-the-provisioning-agent-layer"></a>Решение кэширует профили пользователей Workday в облаке Azure AD или на уровне подготовки агента?

Нет, решение не поддерживает кэширование профилей пользователей. Служба подготовки Azure AD просто действует как обработчик данных, считывая данные из Workday и записывая их в целевую службу Active Directory или Azure AD. Дополнительные сведения о конфиденциальности пользователей и хранении данных см. в разделе [Управление персональными данными](#managing-personal-data).

#### <a name="does-the-solution-support-assigning-on-premises-ad-groups-to-the-user"></a>Поддерживает ли решение назначение локальных групп AD пользователю?

Сейчас такая возможность не поддерживается. Рекомендуется развернуть сценарий PowerShell, запрашивающий конечную точку API Graph Azure AD для получения данных журнала аудита, и использовать его для запуска сценариев, таких как назначение групп. Этот сценарий PowerShell можно присоединить к планировщику задач и развернуть в том же окне, где запущен агент подготовки.  

#### <a name="which-workday-apis-does-the-solution-use-to-query-and-update-workday-worker-profiles"></a>Какие API-интерфейсы Workday решение использует для запроса и обновления профилей работников Workday?

В настоящее время решение использует следующие API Workday:

* Get_Workers (версии 21.1) для получения информации о работнике;
* Maintain_Contact_Information (версии 26.1) для функции обратной записи рабочего электронного адреса.
* Update_Workday_Account (v31.2) для функции обратной записи имени пользователя

#### <a name="can-i-configure-my-workday-hcm-tenant-with-two-azure-ad-tenants"></a>Можно ли настроить клиент Workday HCM с двумя клиентами Azure AD?

Да, эта конфигурация поддерживается. Ниже приведены основные действия, необходимые для настройки такого сценария.

* Разверните агент подготовки 1 и зарегистрируйте его в клиенте Azure AD 1.
* Разверните агент подготовки 2 и зарегистрируйте его в клиенте Azure AD 2.
* На основе "дочерних доменов", которыми будет управлять каждый агент подготовки, настройте домены для каждого агента. Один агент может обрабатывать несколько доменов.
* На портале Azure настройте приложение для подготовки пользователей из Workday в AD в каждом клиенте и настройте для него соответствующие домены.

#### <a name="why-workday-to-azure-ad-user-provisioning-app-is-not-supported-if-we-have-deployed-azure-ad-connect"></a>Почему приложение подготовки пользователей из Workday в Azure AD не поддерживается, если мы развернули Azure AD Connect?

При использовании службы Azure AD в гибридном режиме (когда она содержит сочетание облачных и локальных пользователей) важно иметь четкое определение "главного источника". Обычно для гибридных сценариев требуется развертывание Azure AD Connect. При развертывании Azure AD Connect главным источником является локальная служба AD. Использование соединителя для переноса из Workday в Azure AD может привести к ситуации, когда значения атрибутов Workday могут перезаписать значения, заданные Azure AD Connect. Поэтому использование приложения для подготовки пользователей из Workday в Azure AD не поддерживается при включенном Azure AD Connect. В таких ситуациях рекомендуется использовать приложение для подготовки пользователей из Workday в AD, чтобы перенести пользователей в локальную службу AD, а затем синхронизировать их с Azure AD с помощью Azure AD Connect.

#### <a name="how-do-i-suggest-improvements-or-request-new-features-related-to-workday-and-azure-ad-integration"></a>Как предложить улучшения или запросить новые функции, связанные с интеграцией Workday и Azure AD?

Мы очень ценим ваши отзывы, так как они помогают нам задать направление для будущих выпусков и улучшений. Мы приветствуем все отзывы и рекомендуем вам отправлять свои идеи или предложения по улучшению на [форуме отзывов Azure AD](https://feedback.azure.com/forums/169401-azure-active-directory). Чтобы просмотреть конкретные идеи, связанные с интеграцией Workday, выберите категорию *Приложения SaaS* и выполните поиск по ключевому слову *Workday*, чтобы найти существующие идеи и предложения по Workday.

![Приложения UserVoice SaaS](media/workday-inbound-tutorial/uservoice_saas_apps.png)

![UserVoice Workday](media/workday-inbound-tutorial/uservoice_workday_feedback.png)

Когда предлагаете новую идею, проверьте, не предложил ли кто-то еще аналогичную функцию. В этом случае вы можете проголосовать за возможность или запрос на усовершенствование. Вы также можете оставить комментарий относительно вашего варианта использования, чтобы поддержать идею и продемонстрировать, чем эта функция будет ценна для вас.

### <a name="provisioning-agent-questions"></a>Вопросы по работе агента подготовки

#### <a name="what-is-the-ga-version-of-the-provisioning-agent"></a>Какая версия агента подготовки является общедоступной?

* Общедоступная версия агента подготовки — 1.1.30 и более поздние.
* Если версия агента меньше 1.1.30, значит, вы работаете с общедоступной предварительной версией, которая будет автоматически обновлена до общедоступной версии, если сервер, на котором размещен агент, использует среду выполнения NET 4.7.1.
  * Вы можете [проверить версию .NET](https://docs.microsoft.com/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed), установленную на вашем сервере. Если сервер не работает под управлением .NET 4.7.1, вы можете [скачать и установить эту версию](https://support.microsoft.com/help/4033342/the-net-framework-4-7-1-offline-installer-for-windows). Когда вы установите .NET 4.7.1, агент подготовки будет автоматически обновлен до общедоступной версии.

#### <a name="how-do-i-know-the-version-of-my-provisioning-agent"></a>Как узнать версию моего агента подготовки?

* Войдите на сервер Windows, где установлен агент подготовки.
* Перейдите в меню **Панель управления** -> **Uninstall or Change a Program** (Удаление или изменение программ).
* Найдите версию, соответствующую записи **агента подготовки Microsoft Azure AD Connect**.

  ![Портал Azure](./media/workday-inbound-tutorial/pa_version.png)

#### <a name="does-microsoft-automatically-push-provisioning-agent-updates"></a>Автоматически ли корпорация Майкрософт отправляет обновления агента подготовки?

Да, корпорация Майкрософт автоматически обновляет агент подготовки. Автоматическое обновление можно отключить, остановив службу Windows **Microsoft Azure AD Connect Agent Updater**.

#### <a name="can-i-install-the-provisioning-agent-on-the-same-server-running-aad-connect"></a>Можно ли установить агент подготовки на том же сервере, на котором выполняется AAD Connect?

Да, агент подготовки можно установить на том же сервере, на котором выполняется AAD Connect.

#### <a name="at-the-time-of-configuration-the-provisioning-agent-prompts-for-azure-ad-admin-credentials-does-the-agent-store-the-credentials-locally-on-the-server"></a>Во время настройки агент подготовки запрашивает учетные данные администратора Azure AD. Агент хранит учетные данные локально на сервере?

Во время настройки агент подготовки запрашивает учетные данные администратора Azure AD только для подключения к клиенту Azure AD. Агент не хранит учетные данные локально на сервере. Однако он хранит учетные данные, используемые для подключения к *локальному домену Active Directory*, в локальном хранилище паролей Windows.

#### <a name="how-do-i-configure-the-provisioning-agent-to-use-a-proxy-server-for-outbound-http-communication"></a>Как настроить агент подготовки для использования прокси-сервера исходящих HTTP-подключений?

Агент подготовки поддерживает использование исходящего прокси-сервера. Это можно настроить, изменив файл конфигурации агента **C:\Program Files\Microsoft Azure AD Connect Provisioning Agent\AADConnectProvisioningAgent.exe.config**. Добавьте в него следующие строки в конце файла непосредственно перед закрывающим тегом `</configuration>`.
Замените переменные [proxy-server] и [proxy-port] значениями имени прокси-сервера и номера порта.

```xml
    <system.net>
          <defaultProxy enabled="true" useDefaultCredentials="true">
             <proxy
                usesystemdefault="true"
                proxyaddress="http://[proxy-server]:[proxy-port]"
                bypassonlocal="true"
             />
         </defaultProxy>
    </system.net>
```

#### <a name="how-do-i-ensure-that-the-provisioning-agent-is-able-to-communicate-with-the-azure-ad-tenant-and-no-firewalls-are-blocking-ports-required-by-the-agent"></a>Как убедиться, что агент подготовки может взаимодействовать с клиентом Azure AD и никакие брандмауэры не блокируют порты, необходимые агенту?

Вы также можете проверить, есть ли у вас все необходимые порты открыты, открыв [средством проверки портов соединителей](https://aadap-portcheck.connectorporttest.msappproxy.net/) из локальной сети. Большее число зеленых флажков означает большую устойчивость.

Чтобы получить правильные результаты, необходимо:

* Откройте средство в браузере на сервере, где установлен агент подготовки.
* Убедитесь, что все прокси-серверы или брандмауэры, которые применяются к агенту подготовки, также применяются к этой странице. Это можно сделать в Internet Explorer, выбрав **параметры -> Свойства обозревателя -> подключения -> Параметры локальной сети**. На этой странице появится флажок "Использовать прокси-сервер для локальной сети". Установите этот флажок и укажите адрес прокси-сервера в поле "Адрес".

#### <a name="can-one-provisioning-agent-be-configured-to-provision-multiple-ad-domains"></a>Можно ли настроить один агент подготовки для подготовки нескольких доменов AD?

Да, один агент подготовки можно настроить для обработки нескольких доменов AD, если он может напрямую подключаться к соответствующим контроллерам домена. Корпорация Майкрософт рекомендует создать группу из 3 агентов подготовки, обслуживающих один и тот же набор доменов AD, чтобы обеспечить высокую доступность и поддержку при отработке отказа.

#### <a name="how-do-i-de-register-the-domain-associated-with-my-provisioning-agent"></a>Как отменить регистрацию домена, связанного с агентом подготовки?

* На портале Azure получите *идентификатор клиента* Azure AD.
* Войдите на сервер Windows, под управлением агента подготовки.
* Откройте PowerShell от имени администратора Windows.
* Перейдите в каталог, содержащий сценарии регистрации, и выполните следующие команды, заменив параметр \[tenant ID\] значением вашего идентификатора клиента.

  ```powershell
  cd “C:\Program Files\Microsoft Azure AD Connect Provisioning Agent\RegistrationPowershell\Modules\PSModulesFolder”
  Import-Module "C:\Program Files\Microsoft Azure AD Connect Provisioning Agent\RegistrationPowershell\Modules\PSModulesFolder\AppProxyPSModule.psd1"
  Get-PublishedResources -TenantId "[tenant ID]"
  ```

* В появившемся списке агентов скопируйте значение поля id из ресурса, значение *resourceName* которого соответствует вашему доменному имени AD.
* Вставьте значение идентификатора в следующую команду и выполните команду в PowerShell.

  ```powershell
  Remove-PublishedResource -ResourceId "[resource ID]" -TenantId "[tenant ID]"
  ```

* Повторно запустите мастер настройки агента.
* Любые другие агенты, которые ранее были назначены этому домену, необходимо будет перенастроить.

#### <a name="how-do-i-uninstall-the-provisioning-agent"></a>Как удалить агент подготовки?

* Войдите на сервер Windows, где установлен агент подготовки.
* Перейдите в меню **Панель управления** -> **Uninstall or Change a Program** (Удаление или изменение программ).
* Удалите следующие программы:
  * агент подготовки Microsoft Azure AD Connect;
  * Microsoft Azure AD Connect Agent Updater;
  * пакет агента подготовки Microsoft Azure AD Connect.

### <a name="workday-to-ad-attribute-mapping-and-configuration-questions"></a>Вопросы по конфигурации и сопоставлению атрибутов Workday и AD

#### <a name="how-do-i-back-up-or-export-a-working-copy-of-my-workday-provisioning-attribute-mapping-and-schema"></a>Как создать резервную копию или экспортировать рабочую копию сопоставления атрибутов подготовки Workday и схемы?

С помощью API Microsoft Graph можно экспортировать конфигурацию подготовки пользователей Workday. Дополнительные сведения см. в разделе [Экспорт и импорт конфигурации](#exporting-and-importing-your-configuration).

#### <a name="i-have-custom-attributes-in-workday-and-active-directory-how-do-i-configure-the-solution-to-work-with-my-custom-attributes"></a>У меня есть настраиваемые атрибуты в Workday и Active Directory. Как настроить решение для работы с настраиваемыми атрибутами?

Решение поддерживает настраиваемые атрибуты Workday и Active Directory. Чтобы добавить такие атрибуты в схему сопоставления, откройте колонку **Сопоставление атрибутов** и прокрутите вниз, чтобы развернуть раздел **Показать дополнительные параметры**. 

![Изменение списка атрибутов](./media/workday-inbound-tutorial/wd_edit_attr_list.png)

Чтобы добавить настраиваемые атрибуты Workday, щелкните параметр *Edit attribute list for Workday* (Изменить список атрибутов для Workday), а чтобы добавить настраиваемые атрибуты AD — параметр *Edit attribute list for On Premises Active Directory* (Изменить список атрибутов для локальной службы Active Directory).

См. также:

* [Настройка списка атрибутов пользователя Workday](#customizing-the-list-of-workday-user-attributes)

#### <a name="how-do-i-configure-the-solution-to-only-update-attributes-in-ad-based-on-workday-changes-and-not-create-any-new-ad-accounts"></a>Как настроить решение так, чтобы обновлять только атрибуты в AD с учетом изменений Workday и не создавать новые учетные записи AD?

Это можно сделать, выбрав параметр **Действия с целевыми объектами** в колонке **Сопоставления атрибутов**, как показано ниже:

![Действие обновления](./media/workday-inbound-tutorial/wd_target_update_only.png)

Установите флажок "Обновить", чтобы принимать только операции обновления из Workday в AD. 

#### <a name="can-i-provision-users-photo-from-workday-to-active-directory"></a>Можно ли подготовить фотографию пользователя из Workday в Active Directory?

В настоящее время решение не поддерживает установку двоичных атрибутов, таких как *thumbnailPhoto* и *jpegPhoto*, в Active Directory.

#### <a name="how-do-i-sync-mobile-numbers-from-workday-based-on-user-consent-for-public-usage"></a>Как на основе согласия пользователя синхронизировать мобильные номера из Workday для публичного использования?

* Перейдите в колонку "Подготовка" в приложении подготовки Workday.
* Щелкните "Сопоставления атрибутов". 
* В разделе **Сопоставления** выберите **Synchronize Workday Workers to On Premises Active Directory** (Синхронизировать сотрудников Workday с локальной средой Active Directory) или **Synchronize Workday Workers to Azure AD** (Синхронизировать сотрудников Workday с Azure AD).
* На странице сопоставления атрибутов прокрутите экран вниз и установите флажок "Показать дополнительные параметры".  Щелкните **Edit attribute list for Workday** (Изменить список атрибутов для Workday).
* В открывшейся колонке найдите атрибут Mobile и щелкните строку, чтобы отредактировать **выражение API** ![GDPR для мобильных номеров](./media/workday-inbound-tutorial/mobile_gdpr.png).

* Замените **выражение API** следующим новым выражением, которое извлекает номер рабочего мобильного телефона только в том случае, если для параметра публичного использования установлено значение True в Workday.

    ```
     wd:Worker/wd:Worker_Data/wd:Personal_Data/wd:Contact_Data/wd:Phone_Data[translate(string(wd:Phone_Device_Type_Reference/@wd:Descriptor),'abcdefghijklmnopqrstuvwxyz','ABCDEFGHIJKLMNOPQRSTUVWXYZ')='MOBILE' and translate(string(wd:Usage_Data/wd:Type_Data/wd:Type_Reference/@wd:Descriptor),'abcdefghijklmnopqrstuvwxyz','ABCDEFGHIJKLMNOPQRSTUVWXYZ')='WORK' and string(wd:Usage_Data/@wd:Public)='1']/@wd:Formatted_Phone
    ```

* Сохраните список атрибутов.
* Сохраните сопоставление атрибутов.
* Очистите текущее состояние и перезапустите полную синхронизацию.

#### <a name="how-do-i-format-display-names-in-ad-based-on-the-users-departmentcountrycity-attributes-and-handle-regional-variances"></a>Как форматировать отображаемые имена в AD на основе атрибутов отдела, страны и города пользователя и обрабатывать региональные различия?

Он часто используется для настройки *displayName* атрибут в AD, таким образом, чтобы он также предоставляет сведения об отделе и страны или региона пользователя. Например, если Иван Воронков работает в отделе маркетинга в США, можно настроить так, чтобы его значение *displayName* отображалось как *Воронков, Иван (Маркетинг-Россия)* .

Вот как можно обрабатывать такие требования для построения *CN* или *displayName* включать атрибуты, такие как компании, подразделения, города или страны или региона.

* Каждый атрибут Workday извлекается с помощью базового выражения XPath API, которое настраивается в меню **Сопоставление атрибутов -> раздел Advanced (Дополнительно) -> Edit attribute list for Workday (Изменить список атрибутов для Workday)** . Ниже приведено выражение XPath API по умолчанию для атрибутов Workday *PreferredFirstName*, *PreferredLastName*, *Company* и *SupervisoryOrganization*.

     | Атрибут Workday | Выражение XPath API |
     | ----------------- | -------------------- |
     | PreferredFirstName | wd:Worker/wd:Worker_Data/wd:Personal_Data/wd:Name_Data/wd:Preferred_Name_Data/wd:Name_Detail_Data/wd:First_Name/text() |
     | PreferredLastName | wd:Worker/wd:Worker_Data/wd:Personal_Data/wd:Name_Data/wd:Preferred_Name_Data/wd:Name_Detail_Data/wd:Last_Name/text() |
     | Компания | wd:Worker/wd:Worker_Data/wd:Organization_Data/wd:Worker_Organization_Data[wd:Organization_Data/wd:Organization_Type_Reference/wd:ID[@wd:type='Organization_Type_ID']='Company']/wd:Organization_Reference/@wd:Descriptor |
     | SupervisoryOrganization | wd:Worker/wd:Worker_Data/wd:Organization_Data/wd:Worker_Organization_Data/wd:Organization_Data[wd:Organization_Type_Reference/wd:ID[@wd:type='Organization_Type_ID']='Supervisory']/wd:Organization_Name/text() |
  
   Согласуйте с командой Workday, допустимо ли приведенное выше выражение API для конфигурации клиента Workday. При необходимости эти выражения можно отредактировать, как описано в разделе [Настройка списка атрибутов пользователя Workday](#customizing-the-list-of-workday-user-attributes).

* Аналогичным образом информация о стране, присутствующая в Workday, извлекается с помощью следующего выражения XPATH: *wd:Worker/wd:Worker_Data/wd:Employment_Data/wd:Position_Data/wd:Business_Site_Summary_Data/wd:Address_Data/wd:Country_Reference*.

     В разделе списка атрибутов Workday доступны 5 атрибутов, связанных со страной.

     | Атрибут Workday | Выражение XPath API |
     | ----------------- | -------------------- |
     | CountryReference | wd:Worker/wd:Worker_Data/wd:Employment_Data/wd:Position_Data/wd:Business_Site_Summary_Data/wd:Address_Data/wd:Country_Reference/wd:ID[@wd:type='ISO_3166-1_Alpha-3_Code']/text() |
     | CountryReferenceFriendly | wd:Worker/wd:Worker_Data/wd:Employment_Data/wd:Position_Data/wd:Business_Site_Summary_Data/wd:Address_Data/wd:Country_Reference/@wd:Descriptor |
     | CountryReferenceNumeric | wd:Worker/wd:Worker_Data/wd:Employment_Data/wd:Position_Data/wd:Business_Site_Summary_Data/wd:Address_Data/wd:Country_Reference/wd:ID[@wd:type='ISO_3166-1_Numeric-3_Code']/text() |
     | CountryReferenceTwoLetter | wd:Worker/wd:Worker_Data/wd:Employment_Data/wd:Position_Data/wd:Business_Site_Summary_Data/wd:Address_Data/wd:Country_Reference/wd:ID[@wd:type='ISO_3166-1_Alpha-2_Code']/text() |
     | CountryRegionReference | wd:Worker/wd:Worker_Data/wd:Employment_Data/wd:Position_Data/wd:Business_Site_Summary_Data/wd:Address_Data/wd:Country_Region_Reference/@wd:Descriptor |

  Согласуйте с командой Workday, допустимы ли приведенные выше выражения API для конфигурации клиента Workday. При необходимости эти выражения можно отредактировать, как описано в разделе [Настройка списка атрибутов пользователя Workday](#customizing-the-list-of-workday-user-attributes).

* Чтобы построить выражение справа атрибут сопоставления, определите, какой атрибут Workday «принудительно» представляет пользователя имя, имя, страны или региона и последнего отдела. Предположим, у нас есть атрибуты *PreferredFirstName*, *PreferredLastName*, *CountryReferenceTwoLetter* и *SupervisoryOrganization* соответственно. Их можно использовать, чтобы создать приведенное ниже выражение для атрибута AD *displayName* и получить отображаемое имя, например *Воронков, Иван (Маркетинг-Россия)* .

    ```
     Append(Join(", ",[PreferredLastName],[PreferredFirstName]), Join(""," (",[SupervisoryOrganization],"-",[CountryReferenceTwoLetter],")"))
    ```
    Как только у вас будет правильное выражение, отредактируйте таблицу сопоставлений атрибутов и измените сопоставление атрибута *displayName*, как показано ниже.   ![Сопоставление атрибута DisplayName](./media/workday-inbound-tutorial/wd_displayname_map.png)

* Расширим приведенный выше пример. Допустим, вы хотите преобразовать названия городов из Workday в сокращенные значения, а затем использовать их, чтобы создать отображаемые имена, например *Воронков, Иван (MOS)* или *Сазанова, Мария (SPT)* . Это можно сделать с использованием выражения оператора switch с атрибутом Workday *Municipality* в качестве определяющей переменной.

     ```
    Switch
    (
      [Municipality],
      Join(", ", [PreferredLastName], [PreferredFirstName]),  
           "Chicago", Append(Join(", ",[PreferredLastName], [PreferredFirstName]), "(CHI)"),
           "New York", Append(Join(", ",[PreferredLastName], [PreferredFirstName]), "(NYC)"),
           "Phoenix", Append(Join(", ",[PreferredLastName], [PreferredFirstName]), "(PHX)")
    )
     ```
    См. также:
  * [Синтаксис функции Switch](../manage-apps/functions-for-customizing-application-data.md#switch)
  * [Синтаксис функции Join](../manage-apps/functions-for-customizing-application-data.md#join)
  * [Синтаксис функции Append](../manage-apps/functions-for-customizing-application-data.md#append)

#### <a name="how-can-i-use-selectuniquevalue-to-generate-unique-values-for-samaccountname-attribute"></a>Как использовать SelectUniqueValue для создания уникальных значений атрибута samAccountName?

Предположим, вы хотите создать уникальные значения для атрибута *samAccountName*, используя комбинацию атрибутов *FirstName* и *LastName* из Workday. Ниже приведено выражение, с которого можно начать:

```
SelectUniqueValue(
    Replace(Mid(Replace(NormalizeDiacritics(StripSpaces(Join("",  Mid([FirstName],1,1), [LastName]))), , "([\\/\\\\\\[\\]\\:\\;\\|\\=\\,\\+\\*\\?\\<\\>])", , "", , ), 1, 20), , "(\\.)*$", , "", , ),
    Replace(Mid(Replace(NormalizeDiacritics(StripSpaces(Join("",  Mid([FirstName],1,2), [LastName]))), , "([\\/\\\\\\[\\]\\:\\;\\|\\=\\,\\+\\*\\?\\<\\>])", , "", , ), 1, 20), , "(\\.)*$", , "", , ),
    Replace(Mid(Replace(NormalizeDiacritics(StripSpaces(Join("",  Mid([FirstName],1,3), [LastName]))), , "([\\/\\\\\\[\\]\\:\\;\\|\\=\\,\\+\\*\\?\\<\\>])", , "", , ), 1, 20), , "(\\.)*$", , "", , )
)
```

Приведенное выше выражение работает следующим образом: Если пользователем является Иван Воронков, выражение сначала пытается создать IVoronkov. Если IVoronkov уже существует, то оно создает IvVoronkov. Если и это значение уже существует, создается IvaVoronkov. Выражение также проверяет, чтобы созданное значение соответствовало ограничениям длины и специальных знаков, связанных с *samAccountName*.

См. также:

* [Синтаксис функции Mid](../manage-apps/functions-for-customizing-application-data.md#mid)
* [Синтаксис функции Replace](../manage-apps/functions-for-customizing-application-data.md#replace)
* [Синтаксис функции SelectUniqueValue](../manage-apps/functions-for-customizing-application-data.md#selectuniquevalue)

#### <a name="how-do-i-remove-characters-with-diacritics-and-convert-them-into-normal-english-alphabets"></a>Как удалить символы с диакритическими знаками и преобразовать их в обычный английский алфавит?

Используйте функцию [NormalizeDiacritics](../manage-apps/functions-for-customizing-application-data.md#normalizediacritics), чтобы удалить специальные символы в имени и фамилии пользователя при создании адреса электронной почты или значения CN для пользователя.

## <a name="troubleshooting-tips"></a>Советы по устранению неполадок

В этом разделе приведены рекомендации по устранению неполадок подготовки, возникающих во время интеграции Workday, с помощью журналов аудита Azure AD и журналов средства просмотра событий Windows Server. Он основан на общих шагах по устранению неполадок и концепциях, описанных в статье [Руководство по отчетам об автоматической подготовке учетных записей пользователей](../manage-apps/check-status-user-account-provisioning.md).

В этом разделе описываются следующие аспекты устранения неполадок:

* [Настройка средства просмотра событий Windows для устранения неполадок агента](#setting-up-windows-event-viewer-for-agent-troubleshooting)
* [Настройка журналов аудита на портале Azure для устранения неполадок службы](#setting-up-azure-portal-audit-logs-for-service-troubleshooting)
* [Общие сведения о журналах операций создания учетных записей пользователей AD](#understanding-logs-for-ad-user-account-create-operations)
* [Общие сведения о журналах операций обновления руководителя](#understanding-logs-for-manager-update-operations)
* [Устранение распространенных ошибок](#resolving-commonly-encountered-errors)

### <a name="setting-up-windows-event-viewer-for-agent-troubleshooting"></a>Настройка средства просмотра событий Windows для устранения неполадок агента

* Войдите в систему компьютера Windows Server, где развертывается агента подготовки
* Откройте настольное приложение **просмотра событий Windows Server**.
* Выберите **Журналы Windows > Приложение**.
* Используйте параметр **Фильтровать текущий журнал...** , чтобы просмотреть все события, зарегистрированные в источнике **AAD.Connect.ProvisioningAgent**, и исключить события с идентификатором 5, указав фильтр "-5", как показано ниже.

  ![Средство просмотра событий Windows](media/workday-inbound-tutorial/wd_event_viewer_01.png))

* Нажмите кнопку **ОК** и отсортируйте полученное представление по столбцу **Дата и время**.

### <a name="setting-up-azure-portal-audit-logs-for-service-troubleshooting"></a>Настройка журналов аудита на портале Azure для устранения неполадок службы

* Откройте [портал Azure](https://portal.azure.com) и перейдите к разделу **Журналы аудита** приложения подготовки Workday, как описано ранее в этом руководстве.
* Нажмите кнопку **Столбцы** на странице "Журналы аудита", чтобы отобразить в представлении только следующие столбцы ("Дата", "Действие", "Состояние", "Причина состояния"). Эта конфигурация гарантирует, что вы сосредоточитесь только на данных, которые имеют отношение к устранению неполадок.

  ![Столбцы журнала аудита](media/workday-inbound-tutorial/wd_audit_logs_00.png)

* Отфильтруйте представление, используя параметры запроса **Целевой объект** и **Диапазон дат**. 
  * Задайте для параметра запроса **Целевой объект** значение "ИД работника" или "ИД сотрудника" объекта работника Workday.
  * Задайте для **диапазона дат** соответствующий период времени, за который необходимо проверить наличие ошибок или проблем с подготовкой.

  ![Фильтры журнала аудита](media/workday-inbound-tutorial/wd_audit_logs_01.png)

### <a name="understanding-logs-for-ad-user-account-create-operations"></a>Общие сведения о журналах операций создания учетных записей пользователей AD

При обнаружении нового сотрудника в Workday (например, с идентификатором *21023*) служба подготовки Azure AD пытается создать новую учетную запись пользователя AD для него и в процессе создает 4 записи журнала аудита, как описано ниже.

  [![Журнал аудита создать ops](media/workday-inbound-tutorial/wd_audit_logs_02.png)](media/workday-inbound-tutorial/wd_audit_logs_02.png#lightbox)

Если щелкнуть любую из записей журнала аудита, откроется страница **Сведения о действии**. Так будет выглядеть страница **Сведения о действии** для каждого типа записей журнала.

* Запись **импорта Workday**: эта запись журнала отображает сведения о работнике, полученные из Workday. Используйте информацию, приведенную в разделе *Дополнительные сведения* для записи журнала, чтобы устранить неполадки, связанные с извлечением данных из Workday. Ниже показан пример записи вместе с указателями того, как интерпретировать каждое поле.

  ```JSON
  ErrorCode : None  // Use the error code captured here to troubleshoot Workday issues
  EventName : EntryImportAdd // For full sync, value is "EntryImportAdd" and for delta sync, value is "EntryImport"
  JoiningProperty : 21023 // Value of the Workday attribute that serves as the Matching ID (usually the Worker ID or Employee ID field)
  SourceAnchor : a071861412de4c2486eb10e5ae0834c3 // set to the WorkdayID (WID) associated with the record
  ```

* Запись **импорта AD**: эта запись журнала отображает информацию об учетной записи, извлеченной из AD. Так как при первоначальном создании пользователя учетная запись AD отсутствует, в столбцах *причины, состояния и активности* будет указано, что в Active Directory не найдена учетная запись с таким значением атрибута идентификатора сопоставления. Используйте информацию, приведенную в разделе *Дополнительные сведения* для записи журнала, чтобы устранить неполадки, связанные с извлечением данных из Workday. Ниже показан пример записи вместе с указателями того, как интерпретировать каждое поле.

  ```JSON
  ErrorCode : None // Use the error code captured here to troubleshoot Workday issues
  EventName : EntryImportObjectNotFound // Implies that object was not found in AD
  JoiningProperty : 21023 // Value of the Workday attribute that serves as the Matching ID
  ```

  Чтобы найти записи журнала агента подготовки, соответствующие этой операции импорта AD, откройте журналы средства просмотра событий Windows и используйте параметр меню **Найти...** для поиска записей журнала, содержащих значение атрибута свойства или идентификатора сопоставления (в данном случае *21023*).

  ![Найти](media/workday-inbound-tutorial/wd_event_viewer_02.png)

  Найдите запись с *идентификатором события 9*, которая предоставит вам фильтр поиска LDAP, используемый агентом для получения учетной записи AD. Вы можете проверить, является ли он подходящим фильтром поиска для получения уникальных записей пользователей.

  ![Поиск LDAP](media/workday-inbound-tutorial/wd_event_viewer_03.png)

  Запись, которая немедленно следует за ней (с *идентификатором события 2*), фиксирует результат операции поиска и возвращенные результаты.

  ![Результаты LDAP](media/workday-inbound-tutorial/wd_event_viewer_04.png)

* Запись **действия правила синхронизации**: в этой записи журнала отображаются результаты правил сопоставления атрибутов и настроенные фильтры области действия, а также действия по подготовке, которые будут выполняться для обработки входящего события Workday. Используйте информацию, приведенную в разделе *Дополнительные сведения* записи журнала, чтобы устранить неполадки, связанные с действием синхронизации. Ниже показан пример записи вместе с указателями того, как интерпретировать каждое поле.

  ```JSON
  ErrorCode : None // Use the error code captured here to troubleshoot sync issues
  EventName : EntrySynchronizationAdd // Implies that the object will be added
  JoiningProperty : 21023 // Value of the Workday attribute that serves as the Matching ID
  SourceAnchor : a071861412de4c2486eb10e5ae0834c3 // set to the WorkdayID (WID) associated with the profile in Workday
  ```

  Если возникли проблемы с выражениями сопоставления атрибутов или со входящими данными Workday (например, пустое или нулевое значение для обязательных атрибутов), на этом этапе вы увидите сбой с кодом ошибки, содержащим сведения о ней.

* Запись **экспорта AD**: в этой записи журнала отображается результат операции создания учетной записи AD, а также значения атрибутов, заданные в процессе. Используйте информацию, приведенную в разделе *Дополнительные сведения* записи журнала, чтобы устранить неполадки, связанные с операцией создания учетной записи. Ниже показан пример записи вместе с указателями того, как интерпретировать каждое поле. В разделе "Дополнительные сведения" для параметра EventName задано значение EntryExportAdd, для параметра JoiningProperty устанавливается значение атрибута идентификатора сопоставления, для параметра SourceAnchor — значение WorkdayID (WID), связанное с записью, а для параметра TargetAnchor — значение атрибута ObjectGuid AD созданного пользователя. 

  ```JSON
  ErrorCode : None // Use the error code captured here to troubleshoot AD account creation issues
  EventName : EntryExportAdd // Implies that object will be created
  JoiningProperty : 21023 // Value of the Workday attribute that serves as the Matching ID
  SourceAnchor : a071861412de4c2486eb10e5ae0834c3 // set to the WorkdayID (WID) associated with the profile in Workday
  TargetAnchor : 83f0156c-3222-407e-939c-56677831d525 // set to the value of the AD "objectGuid" attribute of the new user
  ```

  Чтобы найти записи журнала агента подготовки, соответствующие этой операции экспорта AD, откройте журналы средства просмотра событий Windows и используйте параметр меню **Найти...** для поиска записей журнала, содержащих значение атрибута свойства или идентификатора сопоставления (в данном случае *21023*).  

  Найдите запись об HTTP-операции POST, соответствующую метке времени операции экспорта с *идентификатором события 2*. Эта запись будет содержать значения атрибутов, отправленные службой подготовки агенту подготовки.

  [![Добавление SCIM](media/workday-inbound-tutorial/wd_event_viewer_05.png)](media/workday-inbound-tutorial/wd_event_viewer_05.png#lightbox)

  Сразу после указанного выше события должно быть другое событие, которое фиксирует ответ операции создания учетной записи AD. Это событие возвращает новый идентификатор objectGuid, созданный в AD, который задается как атрибут TargetAnchor в службе подготовки.

  [![Добавление SCIM](media/workday-inbound-tutorial/wd_event_viewer_06.png)](media/workday-inbound-tutorial/wd_event_viewer_06.png#lightbox)

### <a name="understanding-logs-for-manager-update-operations"></a>Общие сведения о журналах операций обновления руководителя

Атрибут руководителя является ссылочным атрибутом в AD. Служба подготовки не устанавливает атрибут руководителя как часть операции создания пользователя. Скорее, атрибут руководителя устанавливается как часть операции *обновления* после создания учетной записи AD для пользователя. Предположим, что новый сотрудник с идентификатором 21451 активирован в Workday, а у руководителя нового сотрудника (*21023*) уже есть учетная запись AD. В этом случае в результате поиска пользователя 21451 в журналах аудита отобразится 5 записей.

  [![Обновление диспетчера](media/workday-inbound-tutorial/wd_audit_logs_03.png)](media/workday-inbound-tutorial/wd_audit_logs_03.png#lightbox)

Первые 4 записи похожи на те, которые мы рассматривали в рамках операции создания пользователя. 5-я запись — это экспорт, связанный с обновлением атрибута руководителя. В записи журнала отображается результат операции обновления руководителя учетной записи AD, которая выполняется с использованием атрибута *objectGuid* руководителя.

  ```JSON
  // Modified Properties
  Name : manager
  New Value : "83f0156c-3222-407e-939c-56677831d525" // objectGuid of the user 21023

  // Additional Details
  ErrorCode : None // Use the error code captured here to troubleshoot AD account creation issues
  EventName : EntryExportUpdate // Implies that object will be created
  JoiningProperty : 21451 // Value of the Workday attribute that serves as the Matching ID
  SourceAnchor : 9603bf594b9901693f307815bf21870a // WorkdayID of the user
  TargetAnchor : 43b668e7-1d73-401c-a00a-fed14d31a1a8 // objectGuid of the user 21451

  ```

### <a name="resolving-commonly-encountered-errors"></a>Устранение распространенных ошибок

В этом разделе рассматриваются распространенные ошибки при подготовке пользователей Workday и способы их устранения. Ошибки разделены на следующие группы:

* [ошибки подготовки агента](#provisioning-agent-errors);
* [Ошибки подключения](#connectivity-errors).
* [ошибки создания учетной записи пользователя AD](#ad-user-account-creation-errors);
* [ошибки обновления учетной записи пользователя AD](#ad-user-account-update-errors).

#### <a name="provisioning-agent-errors"></a>Ошибки подготовки агента

|#|Сценарий ошибки |Возможные причины|Рекомендуемое решение|
|--|---|---|---|
|1.| Ошибка установки агента подготовки с таким сообщением:  *Service 'Microsoft Azure AD Connect Provisioning Agent' (AADConnectProvisioningAgent) failed to start (Не удалось запустить службу агента подготовки Microsoft Azure AD Connect (AADConnectProvisioningAgent)). Verify that you have sufficient privileges to start the system (Проверьте наличие необходимых прав на запуск системы).* | Эта ошибка обычно появляется при попытке установить агент подготовки на контроллере домена, а групповая политика запрещает запуск службы.  Она также отображается, если у вас работает предыдущая версия агента и вы не удалили ее перед началом новой установки.| Установите агент подготовки на сервере, отличном от сервера контроллера домена. Перед установкой нового агента убедитесь, что предыдущие версии агента удалены.|
|2.| Служба Windows "Агент подготовки Microsoft Azure AD Connect" находится в состоянии *Запускается* и не переходит в состояние *Выполняется*. | В ходе установки мастер агента создает локальную учетную запись (**NT Service\\AADConnectProvisioningAgent**) на сервере, и эта учетная запись **для входа в систему** используется для запуска службы. Эта ошибка возникнет, если политика безопасности на сервере Windows запрещает локальным учетным записям запускать службы. | Откройте *консоль служб*. Щелкните правой кнопкой мыши службу Windows "Агент подготовки Microsoft Azure AD Connect" и на вкладке входа укажите учетную запись администратора домена, которая будет использоваться для запуска службы. Перезапустите службу. |
|3.| При настройке агента подготовки с доменом AD на шаге *подключения Active Directory* мастер долго загружает схему AD, но в конечном итоге время ожидания истекает. | Эта ошибка обычно отображается, если мастеру не удается связаться с сервером контроллера домена AD из-за проблем брандмауэра. | На шаге *подключения Active Directory* в мастере при вводе учетных данных домена AD есть параметр *Select domain controller priority* (Выбрать приоритет контроллеров домена). Используя этот параметр, выберите контроллер домена, который находится на том же сайте, что и сервер агента, и убедитесь в отсутствии правил брандмауэра, блокирующих связь. |

#### <a name="connectivity-errors"></a>Ошибки подключения.

Если службе подготовки не удается подключиться к Workday или Active Directory, подготовка может перейти в состояние карантина. В следующей таблице приведены сведения по устранению неполадок с подключением.

|#|Сценарий ошибки |Возможные причины|Рекомендуемое решение|
|--|---|---|---|
|1.| Если щелкнуть **Проверить соединение**, появляется сообщение об ошибке: *Произошла ошибка при подключении к Active Directory. Убедитесь, что локальный агент подготовки запущен и настроен с помощью правильного домена Active Directory.* | Эта ошибка обычно отображается, если агент подготовки не запущен или брандмауэр блокирует подключение между Azure AD и агентом подготовки. Эта ошибка также может появиться, если домен не настроен в мастере агента. | Откройте консоль *Службы* на сервере Windows, чтобы убедиться, что агент запущен. Откройте мастер агента подготовки и убедитесь, что нужный домен зарегистрирован в агенте.  |
|2.| Задание подготовки переходит в состояние карантина в выходные дни (пятница и суббота), и мы получаем уведомление по электронной почте о том, что произошла ошибка синхронизации. | Одной из распространенных причин этой ошибки является запланированный простой Workday. Если вы используете клиент реализации Workday, обратите внимание, что Workday запланировал для своих клиентов реализации простой на выходные дни (обычно с вечера пятницы до утра субботы). В течение этого периода приложения подготовки Workday могут перейти в состояние карантина, так как не могут подключиться к Workday. Задание возвращается в нормальное состояние, как только клиент реализации Workday возвращается в сеть. В редких случаях эта ошибка может также появиться, если пароль пользователя системы интеграции был изменен из-за обновления клиента или если учетная запись заблокирована либо истек срок ее действия. | Обратитесь к администратору Workday или партнеру по интеграции, чтобы узнать, когда Workday планирует время простоя, чтобы игнорировать предупреждения в период простоя и подтвердить доступность после подключения экземпляра Workday.  |


#### <a name="ad-user-account-creation-errors"></a>Ошибки создания учетной записи пользователя AD

|#|Сценарий ошибки |Возможные причины|Рекомендуемое решение|
|--|---|---|---|
|1.| Сбой операции экспорта в журнале аудита с сообщением *Ошибка. OperationsError-SvcErr: An operation error occurred (Произошла ошибка операции). No superior reference has been configured for the directory service (Для службы каталогов не была настроена ссылка верхнего уровня). The directory service is therefore unable to issue referrals to objects outside this forest (Поэтому служба каталогов не может выдавать ссылки на объекты за пределами этого леса).* | Эта ошибка обычно появляется, если подразделение *контейнера Active Directory* установлено неправильно или есть проблемы с сопоставлением выражений, используемым для *parentDistinguishedName*. | Проверьте параметр подразделения *контейнера Active Directory* на наличие опечаток. Если вы используете атрибут *parentDistinguishedName* в сопоставлении атрибутов, убедитесь, что он всегда соответствует известному контейнеру в домене AD. Проверьте событие *экспорта* в журналах аудита, чтобы увидеть созданное значение. |
|2.| Сбой операции экспорта в журнале аудита с кодом ошибки *SystemForCrossDomainIdentityManagementBadResponse* и сообщением *Ошибка. ConstraintViolation-AtrErr: A value in the request is invalid (Неправильное значение в запросе). A value for the attribute was not in the acceptable range of values. (Значение атрибута не входило в допустимый диапазон значений). \nСведения об ошибке: CONSTRAINT_ATT_TYPE - company*. | Хотя эта ошибка относится только к атрибуту *company*, она может возникнуть и для других атрибутов, таких как *CN*. Эта ошибка появляется из-за принудительного ограничения схемы AD. По умолчанию такие атрибуты, как *company* и *CN* в AD, имеют верхний предел длины в 64 знака. Если длина значения из Workday превышает 64 знака, вы увидите это сообщение об ошибке. | Проверьте событие *экспорта* в журналах аудита, чтобы увидеть значение атрибута, указанное в сообщении об ошибке. Попробуйте обрезать значение, полученное из Workday, с помощью функции [Mid](../manage-apps/functions-for-customizing-application-data.md#mid), или изменить сопоставления на атрибут AD, который не имеет аналогичных ограничений длины.  |

#### <a name="ad-user-account-update-errors"></a>Ошибки обновления учетной записи пользователя AD

В процессе обновления учетной записи пользователя AD служба подготовки считывает информацию из Workday и AD, запускает правила сопоставления атрибутов и определяет, нужно ли применить какое-либо изменение. Соответственно инициируется событие обновления. Если на каком-либо из этих шагов происходит сбой, он регистрируется в журналах аудита. В следующей таблице приведены сведения по устранению распространенных ошибок обновления.

|#|Сценарий ошибки |Возможные причины|Рекомендуемое решение|
|--|---|---|---|
|1.| Сбой действия правила синхронизации в журнале аудита с сообщением *EventName = EntrySynchronizationError и ErrorCode = EndpointUnavailable*. | Эта ошибка отображается, если служба сопоставления не может получить данные профиля пользователя из Active Directory из-за ошибки обработки, обнаруженной локальным агентом подготовки. | Проверьте журналы средства просмотра событий агента подготовки на наличие ошибок, которые указывают на проблемы с операцией чтения (отфильтруйте по идентификатору события 2). |
|2.| Атрибут руководителя в AD не обновляется для определенных пользователей в AD. | Наиболее вероятная причина этой ошибки — использование правил области действия, где настроена область, в которую руководитель пользователя не входит. Вы также можете столкнуться с этой проблемой, если атрибут идентификатора сопоставления руководителя (например, EmployeeID) не найден в целевом домене AD или имеет неверное значение. | Просмотрите фильтр области действия и добавьте руководителя в нужную область. Проверьте профиль руководителя в AD, чтобы убедиться в наличии значения для атрибута идентификатора сопоставления. |

## <a name="managing-your-configuration"></a>Управление конфигурацией

В этом разделе описывается, как вы можете дополнительно расширять и настраивать вашу конфигурацию подготовки пользователей на основе Workday, а также управлять ею. В нем рассматриваются следующие темы:

* [Настройка списка атрибутов пользователя Workday](#customizing-the-list-of-workday-user-attributes)  
* [Экспорт и импорт конфигурации](#exporting-and-importing-your-configuration)

### <a name="customizing-the-list-of-workday-user-attributes"></a>Настройка списка атрибутов пользователя Workday

Подготовка приложений Workday для Active Directory и Azure AD включает стандартный список атрибутов пользователей Workday, которые вы можете выбирать. Но эти списки не являются исчерпывающими. Приложение Workday поддерживает сотни пользовательских атрибутов, которые могут быть стандартными или уникальными для клиента Workday.

Служба подготовки Azure AD позволяет настроить список или атрибут Workday, чтобы включить все атрибуты, отображаемые в операции [Get_Workers](https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Get_Workers.html), в API Human Resources.

Чтобы сделать это, в [Workday Studio](https://community.workday.com/studio-download) извлеките выражения XPath, представляющие атрибуты, которые вы хотите использовать. Затем добавьте их в конфигурацию подготовки с помощью расширенного редактора атрибутов на портале Azure.

**Чтобы получить выражение XPath для атрибута пользователя Workday, сделайте следующее:**

1. Скачайте и установите [Workday Studio](https://community.workday.com/studio-download). Вам потребуется учетная запись сообщества Workday для доступа к установщику.

2. Скачайте WSDL-файл Workday Human_Resources по этому URL-адресу: https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Human_Resources.wsdl

3. Запустите Workday Studio.

4. На панели команд выберите **Workday > Test Web Service (Workday > Тестировать веб-службу) в параметре Tester (Тестер)** .

5. Щелкните **External** (Внешний) и выберите WSDL-файл Human_Resources, скачанный на шаге 2.

    ![Workday Studio](./media/workday-inbound-tutorial/wdstudio1.png)

6. Задайте для поля **Location** (Расположение) значение `https://IMPL-CC.workday.com/ccx/service/TENANT/Human_Resources`. Замените значение IMPL-CC фактическим типом экземпляра и значение TENANT (Клиент) реальным именем клиента.

7. Задайте для параметра **Operation** значение **Get_Workers**.

8.  Щелкните ссылку **configure** (Настроить) под областями Request/Response (Запрос/Ответ), чтобы задать учетные данные Workday. Установите флажок **Authentication** (Аутентификация), а затем введите имя пользователя и пароль учетной записи системы интеграции Workday. Убедитесь, что имя пользователя, например имя формата\@клиента и оставить **WS-Security UsernameToken** выбранный параметр.

    ![Workday Studio](./media/workday-inbound-tutorial/wdstudio2.png)

9. Нажмите кнопку **ОК**.

10. В области **запроса** вставьте XML-код, показанный ниже, и задайте для параметра **Employee_ID** идентификатор сотрудника реального пользователя в клиенте Workday. Выберите пользователя, у которого заполнен атрибут, который вы хотите извлечь.

    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="https://www.w3.org/2001/XMLSchema">
      <env:Body>
        <wd:Get_Workers_Request xmlns:wd="urn:com.workday/bsvc" wd:version="v21.1">
          <wd:Request_References wd:Skip_Non_Existing_Instances="true">
            <wd:Worker_Reference>
              <wd:ID wd:type="Employee_ID">21008</wd:ID>
            </wd:Worker_Reference>
          </wd:Request_References>
          <wd:Response_Group>
            <wd:Include_Reference>true</wd:Include_Reference>
            <wd:Include_Personal_Information>true</wd:Include_Personal_Information>
            <wd:Include_Employment_Information>true</wd:Include_Employment_Information>
            <wd:Include_Management_Chain_Data>true</wd:Include_Management_Chain_Data>
            <wd:Include_Organizations>true</wd:Include_Organizations>
            <wd:Include_Reference>true</wd:Include_Reference>
            <wd:Include_Transaction_Log_Data>true</wd:Include_Transaction_Log_Data>
            <wd:Include_Photo>true</wd:Include_Photo>
            <wd:Include_User_Account>true</wd:Include_User_Account>
          <wd:Include_Roles>true</wd:Include_Roles>
          </wd:Response_Group>
        </wd:Get_Workers_Request>
      </env:Body>
    </env:Envelope>
    ```

11. Нажмите кнопку **Send Request** (Отправить запрос) (с зеленой стрелкой), чтобы выполнить команду. Если команда выполнена успешно, ответ должен отображаться в области **Response** (Ответ). Убедитесь, что ответ содержит данные идентификатора пользователя, которые вы ввели, и не содержит ошибок.

12. Если команда выполнена успешно, скопируйте XML-код из области **Response** (Ответ) и сохраните его как XML-файл.

13. В командной строке Workday Studio последовательно выберите **File (Файл) > Open File (Открыть файл)** и откройте только что сохраненный XML-файл. После этого в редакторе XML Workday Studio откроется файл.

    ![Workday Studio](./media/workday-inbound-tutorial/wdstudio3.png)

14. В дереве файлов перейдите к файлу **/env: Envelope > env: Body > wd:Get_Workers_Response > wd:Response_Data > wd: Worker**, чтобы найти данные пользователя.

15. В разделе **wd: Worker** найдите атрибут, который нужно добавить и выберите его.

16. Скопируйте выражение XPath для выбранного атрибута из поля **Document Path** (Путь к документу).

17. Удалите префикс **/env:Envelope/env:Body/wd:Get_Workers_Response/wd:Response_Data/** из скопированного выражения.

18. Если последний элемент в скопированном выражении является узлом (например, "/wd: Birth_Date"), тогда добавьте **/text()** в конце выражения. Это можно не делать, если последний элемент является атрибутом (например, "/@wd: type").

19. Результат должен выглядеть приблизительно так: `wd:Worker/wd:Worker_Data/wd:Personal_Data/wd:Birth_Date/text()`. Это значение нужно скопировать на портал Azure.

**Чтобы добавить настраиваемый атрибут пользователя Workday в конфигурацию подготовки, сделайте следующее:**

1. Откройте [портал Azure](https://portal.azure.com) и перейдите к разделу "Подготовка" приложения подготовки Workday, как описано ранее в этом руководстве.

2. Задайте для параметра **Состояние подготовки** значение **Выкл.** и нажмите кнопку **Сохранить**. После этих действий внесенные вами изменения вступят в силу, только когда вы закончите процедуру.

3. В разделе **Сопоставления** выберите **Synchronize Workday Workers to On Premises Active Directory** (Синхронизировать сотрудников Workday с локальной средой Active Directory) или **Synchronize Workday Workers to Azure AD** (Синхронизировать сотрудников Workday с Azure AD).

4. Прокрутите вниз до следующего экрана и выберите **Показать расширенные параметры**.

5. Выберите ссылку **Изменить список атрибутов для Workday**.

    ![Workday Studio](./media/workday-inbound-tutorial/wdstudio_aad1.png)

6. Прокрутите страницу вниз до списка атрибутов, где находятся поля для заполнения.

7. В поле **Имя** введите отображаемое имя для атрибута.

8. В поле **Тип** выберите тип, соответствующий атрибуту (чаще всего это **строка**).

9. В поле **Выражение API** введите выражение XPath, скопированное из Workday Studio. Пример: `wd:Worker/wd:Worker_Data/wd:Personal_Data/wd:Birth_Date/text()`

10. Нажмите кнопку **Добавить атрибут**.

    ![Workday Studio](./media/workday-inbound-tutorial/wdstudio_aad2.png)

11. Нажмите кнопку **Сохранить** выше, а затем — **Да** в диалоговом окне. Закройте экран сопоставления атрибутов, если он еще открыт.

12. Вернитесь на вкладку **Подготовка** и снова выберите **Synchronize Workday Workers to On Premises Active Directory** (Синхронизировать работников Workday с локальной средой Active Directory) или **Synchronize Workers to Azure AD** (Синхронизировать сотрудников с Azure AD).

13. Выберите **Добавить новое сопоставление**.

14. Новый атрибут должен появиться в **Атрибут источника**.

15. В случае необходимости добавьте сопоставление для нового атрибута.

16. В конце не забудьте задать для параметра **Состояние подготовки** значение **Вкл.** и сохранить это изменение.

### <a name="exporting-and-importing-your-configuration"></a>Экспорт и импорт конфигурации

В этом разделе описывается, как использовать API Microsoft Graph и обозреватель Graph, чтобы экспортировать сопоставления атрибутов подготовки Workday и схему в файл JSON и импортировать его обратно в Azure AD.

#### <a name="step-1-retrieve-your-workday-provisioning-app-service-principal-id-object-id"></a>Шаг 1. Получение идентификатора субъекта-службы (идентификатора объекта) приложения подготовки Workday

1. Откройте [портал Azure](https://portal.azure.com) и перейдите к разделу "Свойства" приложения подготовки Workday.
1. В разделе "Свойства" вашего приложения подготовки скопируйте значение GUID, связанное с полем *Идентификатор объекта*. Это значение также называется идентификатором **ServicePrincipalId** вашего приложения, и оно будет использоваться в операциях обозревателя Graph.

   ![Идентификатор субъекта-службы приложения Workday](./media/workday-inbound-tutorial/wd_export_01.png)

#### <a name="step-2-sign-into-microsoft-graph-explorer"></a>Шаг 2. Выполнение входа в обозреватель Microsoft Graph

1. Запустите [обозреватель Microsoft Graph](https://developer.microsoft.com/graph/graph-explorer)
1. Нажмите кнопку "Вход с помощью учетной записи Майкрософт" и войдите, используя учетные данные глобального администратора Azure AD или администратора приложения.

    ![Выполнение входа в Graph](./media/workday-inbound-tutorial/wd_export_02.png)

1. После выполнения входа вы увидите данные учетной записи пользователя на левой панели.

#### <a name="step-3-retrieve-the-provisioning-job-id-of-the-workday-provisioning-app"></a>Шаг 3. Получение идентификатора задания подготовки приложения подготовки Workday

В обозревателе Microsoft Graph выполните следующий запрос GET, заменив [servicePrincipalId] на атрибут **ServicePrincipalId**, извлеченный на [шаге 1](#step-1-retrieve-your-workday-provisioning-app-service-principal-id-object-id).

```http
   GET https://graph.microsoft.com/beta/servicePrincipals/[servicePrincipalId]/synchronization/jobs
```

Вы получите ответ, похожий на показанный ниже. Скопируйте атрибут идентификатора из ответа. Это значение представляет собой **ProvisioningJobId** и будет использоваться для получения метаданных базовой схемы.

   [![Идентификатор подготовки задания](./media/workday-inbound-tutorial/wd_export_03.png)](./media/workday-inbound-tutorial/wd_export_03.png#lightbox)

#### <a name="step-4-download-the-provisioning-schema"></a>Шаг 4. Скачивание схемы подготовки

В обозревателе Microsoft Graph выполните следующий запрос GET, заменив [servicePrincipalId] и [ProvisioningJobId] на значения ServicePrincipalId и ProvisioningJobId, полученные на предыдущих шагах.

```http
   GET https://graph.microsoft.com/beta/servicePrincipals/[servicePrincipalId]/synchronization/jobs/[ProvisioningJobId]/schema
```

Скопируйте объект JSON из ответа и сохраните его в файл, чтобы создать резервную копию схемы.

#### <a name="step-5-import-the-provisioning-schema"></a>Шаг 5. Импорт схемы подготовки

> [!CAUTION]
> Выполните этот шаг только в том случае, если необходимо изменить схему конфигурации, которую нельзя изменить с помощью портала Azure, или если требуется восстановить конфигурацию из ранее сохраненной резервной копии с допустимой и рабочей схемой.

В обозревателе Microsoft Graph настройте следующий запрос PUT, заменив [servicePrincipalId] и [ProvisioningJobId] на значения ServicePrincipalId и ProvisioningJobId, полученные на предыдущих шагах.

```http
    PUT https://graph.microsoft.com/beta/servicePrincipals/[servicePrincipalId]/synchronization/jobs/[ProvisioningJobId]/schema
```

На вкладке текста запроса скопируйте содержимое файла схемы JSON.

   [![Текст запроса](./media/workday-inbound-tutorial/wd_export_04.png)](./media/workday-inbound-tutorial/wd_export_04.png#lightbox)

На вкладке заголовков запроса добавьте атрибут заголовка Content-Type со значением "application/json".

   [![Заголовки запроса](./media/workday-inbound-tutorial/wd_export_05.png)](./media/workday-inbound-tutorial/wd_export_05.png#lightbox)

Нажмите кнопку "Выполнить запрос", чтобы импортировать новую схему.

## <a name="managing-personal-data"></a>Управление персональными данными

Для решения подготовки Workday для Active Directory требуется, чтобы агент подготовки был установлен на локальном сервере Windows. Этот агент создает журналы в журнале событий Windows, который может содержать персональные данные в зависимости от сопоставления атрибутов Workday и AD. Чтобы обеспечить соблюдение обязательств по обеспечению конфиденциальности пользователей, можно настроить так, чтобы никакие данные не хранились в журналах событий более 48 часов, создав запланированную задачу Windows для очистки журнала событий.

Служба подготовки Azure AD относится к категории **обработчиков данных** по классификации Общего регламента по защите данных. В качестве конвейера обработчика данных Azure AD Connect Health предоставляет службы обработки данных ключевым партнерам и пользователям. Служба подготовки Azure AD не создает пользовательские данные и не может независимо управлять сбором каких-либо персональных данных и их использованием. Получение данных, агрегация, анализ и отчетность в службе подготовки Azure AD основаны на имеющихся данных организации.

[!INCLUDE [GDPR-related guidance](../../../includes/gdpr-hybrid-note.md)]

Что касается хранения данных, служба подготовки Azure AD не создает отчеты, не выполняет аналитику и не предоставляет аналитику более чем за 30 дней. Таким образом, в службе подготовки Azure AD не хранятся и не обрабатываются данные за период более 30 дней. Такой подход является совместимым с нормами GDPR, требованиями соответствия нормативам корпорации Майкрософт о конфиденциальности и политике хранения данных Azure AD.

## <a name="next-steps"></a>Дальнейшие действия

* [Сведения о просмотре журналов и получении отчетов о действиях по подготовке](../manage-apps/check-status-user-account-provisioning.md)
* [Узнайте, как настроить единый вход Azure Active Directory в Workday](workday-tutorial.md).
* [Узнайте, как интегрировать другие приложения SaaS с Azure Active Directory](tutorial-list.md).
* [Сведения об использовании API Microsoft Graph для управления конфигурациями подготовки](https://developer.microsoft.com/graph/docs/api-reference/beta/resources/synchronization-overview)
