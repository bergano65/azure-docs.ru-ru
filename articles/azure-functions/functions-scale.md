---
title: Масштабирование и размещение Функций Azure | Документация Майкрософт
description: Дополнительные сведения о выборе между планом потребления функций Azure и план "премиум".
services: functions
documentationcenter: na
author: ggailey777
manager: jeconnoc
keywords: Azure функции, функции, план потребления, план "премиум", обработка событий, веб-перехватчики, динамические вычисления, бессерверная архитектура
ms.assetid: 5b63649c-ec7f-4564-b168-e0a74cb7e0f3
ms.service: azure-functions
ms.devlang: multiple
ms.topic: reference
ms.date: 03/27/2019
ms.author: glenga
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 459758142c94ddfd244df1427dd5632186efc0de
ms.sourcegitcommit: c174d408a5522b58160e17a87d2b6ef4482a6694
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59266945"
---
# <a name="azure-functions-scale-and-hosting"></a>Масштабирование и размещение Функций Azure

Функции Azure выполняется в два разных плана: План потребления и план "премиум" (Предварительная версия). План потребления автоматически добавляет вычислительной мощности, когда ваш код выполняется. Ваше приложение масштабировать при необходимости для обработки нагрузки и уменьшения масштаба, при остановке выполнения кода. Нет необходимости платить за бездействующие виртуальные машины или заранее резервировать ресурсы.  План "премиум" также автоматически масштабировать и добавить дополнительные вычислительной мощности, когда ваш код выполняется.  План "премиум" поставляется с дополнительные функции, например "премиум" вычислительных операций, возможность хранить бессрочно "горячего" резервирования экземпляров и подключение к виртуальной сети.  При наличии существующего плана службы приложений, можно также запустить приложения-функции в них.

> [!NOTE]  
> Оба [план "премиум"](https://aka.ms/functions-premiumplan) и [план потребления для Linux](https://azure.microsoft.com/updates/azure-functions-consumption-plan-for-linux-preview/) в настоящее время доступны в предварительной версии.

Если вы не знакомы с Функциями Azure, см. [эту статью](functions-overview.md).

При создании приложения-функции необходимо выбрать план размещения для функций в приложении. В любом плане функции выполняет экземпляр *узла службы "Функции Azure"*. Тип плана определяет следующее:

* Способ развертывания экземпляров узла.
* Ресурсы, доступные для каждого узла.
* Компоненты экземпляра, например подключение к виртуальной сети.

> [!NOTE]
> Можно переключаться между планы потребления и "премиум", изменив свойство плана ресурс приложения-функции.

## <a name="consumption-plan"></a>План потребления

При использовании плана потребления экземпляры узла функций Azure динамически добавляются и удаляются в зависимости от числа входящих событий. Этот бессерверный план автоматически масштабируется, и вы платите за вычислительные ресурсы только тогда, когда ваши функции запущены. В плане потребления функция должна выполняться в течение настроенного времени (время ожидания).

Плата начисляется на основе числа операций выполнения, времени выполнения и объема использованной памяти. Плата начисляется совокупно за использование всех функций приложения-функции. Дополнительные сведения см. на [странице цен на Функции Azure].

План потребления является планом размещения по умолчанию. Он включает следующие преимущества:

* Оплата насчитывается только при выполнении функций.
* Масштабирование выполняется автоматически, даже во время периодов высокой нагрузки.

## <a name="premium-plan-public-preview"></a>План "премиум" (Предварительная версия)

Если вы используете план "премиум", экземпляров узла функций Azure быстро добавляются и удаляются в зависимости от числа входящих событий, как и в плане потребления.  Тем не менее план "премиум" также предлагает:

* Всегда «горячего» резервирования экземпляры, чтобы избежать любой холодного запуска.
* Подключение к виртуальной сети.
* Длительность выполнения неограниченное количество.
* Размеры экземпляров уровня "премиум" (одно ядро, два ядра и четыре экземпляра core).
* Прогнозируемый вариантах оплаты.
* Выделение с высокой плотностью приложения для планов с помощью нескольких приложений-функций.

Сведения о настройке этих параметров можно найти в [план "премиум" функции Azure](functions-premium-plan.md).

Вместо выставления счетов за выполнение и память, занятая другими, выставление счетов основано на число ядер в секунду и используется по необходимости и зарезервированным экземплярам ГБ / с.  Хотя бы один экземпляр, должен быть "горячего" резервирования вообще раз, существует Фиксированные ежемесячные затраты на план, который активен (независимо от количества выполнений).

Допустим, план "премиум" функции Azure в следующих случаях:
* Приложения-функции выполняются непрерывно или почти непрерывно. В этом случае план службы приложений может быть более экономичным.
* Вам требуется больше ресурсов ЦП или памяти, чем доступно в плане потребления.
* Ваш код должен выполнять функции дольше [максимально допустимое время выполнения](#timeout) в плане потребления.
* Вам требуются функции, доступные только в плане службы приложений, например поддержка среды службы приложений, подключение к виртуальной сети или VPN и виртуальные машины больших размеров.

> [!NOTE]
> Предварительная версия плана "премиум" поддерживает функций, выполняемых в .NET, Java или узел через инфраструктуру Windows.

При выполнении функций JavaScript на план "премиум", необходимо выбрать экземпляр с меньшим количеством виртуальных процессоров. Дополнительные сведения см. в разделе [Выбор одноядерных планов уровня "премиум"](functions-reference-node.md#considerations-for-javascript-functions).  

## <a name="app-service-plan"></a>План службы приложений

Приложения-функции могут выполняться в те же выделенные виртуальные машины, как другие приложения службы приложений (Basic, Standard, Premium и изолированной номера SKU). Планы служб приложений поддерживают Linux.

План службы приложений стоит использовать в следующих случаях:

* У вас есть неиспользуемые виртуальные машины, в которых уже запущены другие экземпляры служб приложений.
* Вы хотите запустить приложение-функцию в Linux или вы хотите предоставить пользовательский образ, в котором будут выполняться функции.

Же платите за приложения-функции в плане службы приложений, как это делается для других ресурсов службы приложений, например веб-приложений. Дополнительную информацию о том, как действует план службы приложений, см. в статье [Подробный обзор планов службы приложений Azure](../app-service/overview-hosting-plans.md). 

С помощью плана службы приложений вы можете выполнить развертывание вручную, добавив дополнительные экземпляры виртуальных машин, или же включить автоматическое масштабирование. Дополнительные сведения см. в статье [Масштабирование числа экземпляров вручную или автоматически](../azure-monitor/platform/autoscale-get-started.md?toc=%2fazure%2fapp-service%2ftoc.json). Вы можете также увеличивать масштаб, используя разные планы службы приложений. Дополнительные сведения см. в статье [Увеличение масштаба приложения в Azure](../app-service/web-sites-scale.md). 

При запуске функций JavaScript в плане службы приложений нужно выбрать план с меньшим количеством виртуальных ЦП. Дополнительные сведения см. в разделе [Выбор одноядерных планов службы приложений](functions-reference-node.md#choose-single-vcpu-app-service-plans). 
<!-- Note: the portal links to this section via fwlink https://go.microsoft.com/fwlink/?linkid=830855 --> 

### <a name="always-on"></a> Always On

При использовании плана службы приложений следует включить параметр **Всегда включено**, чтобы ваше приложение-функция выполнялось правильно. В плане службы приложений среда выполнения функции переходит в состояние бездействия через несколько минут отсутствия активности, поэтому только триггеры HTTP могут на самом деле "пробудить" ваши функции. Параметр "Всегда включено" доступен только для плана службы приложений. В плане потребления платформа активирует приложения-функции автоматически.

[!INCLUDE [Timeout Duration section](../../includes/functions-timeout-duration.md)]

## <a name="what-is-my-hosting-plan"></a>Что представляет собой план размещения

Чтобы определить план размещения, используемый приложением-функцией, на [портале Azure](https://portal.azure.com) просмотрите для приложения-функции раздел **План службы приложений/ценовая категория** на вкладке **Обзор**. Для планов службы приложений также указывается ценовая категория. 

![Просмотр плана масштабирования на портале](./media/functions-scale/function-app-overview-portal.png)

Для определения плана можно также использовать Azure CLI, как показано ниже:

```azurecli-interactive
appServicePlanId=$(az functionapp show --name <my_function_app_name> --resource-group <my_resource_group> --query appServicePlanId --output tsv)
az appservice plan list --query "[?id=='$appServicePlanId'].sku.tier" --output tsv
```  

Если в результате выполнения команды возвращается значение `dynamic`, ваше приложение-функция находится в плане потребления. Если выходные данные этой команды имеет `ElasticPremium`, является приложение-функцию в плане "премиум".  Все другие значения указывают уровни плана службы приложений.

Даже с включенным параметром "Всегда включено" время ожидания выполнения для отдельных функций управляется с помощью параметра `functionTimeout` в файле проекта [host.json](functions-host-json.md#functiontimeout).

## <a name="storage-account-requirements"></a>Требования к учетной записи хранения

На любой план приложения-функции требуется общая учетной записи хранения Azure, которая поддерживает хранилища BLOB-объектов Azure, очереди, файлы и таблицы. Это обусловлено функции используют службу хранилища Azure для операций, таких как управление триггерами и ведение журнала выполнения функций, но некоторые учетные записи хранения не поддерживают очереди и таблицы. Эти учетные записи, которые включают учетные записи хранения только для больших двоичных объектов (включая хранилище класса Premium) и учетные записи хранения общего назначения с репликацией ZRS, отфильтровываются на основе выбранных вариантов **учетной записи хранения** при создании приложения-функции.

<!-- JH: Does using a Premium Storage account improve perf? -->

Дополнительные сведения о типах учетных записей хранилища см. в разделе [Введение в службы хранилища Azure](../storage/common/storage-introduction.md#azure-storage-services).

## <a name="how-the-consumption-and-premium-plans-work"></a>Как работают планы потребления и "премиум"

Потребление и планами "премиум" контроллер масштабирования автоматически масштабирует ресурсы ЦП и памяти, добавив дополнительные экземпляры узлов функций в зависимости от количества событий, которые активируют функции на. Каждый экземпляр узла в плане потребления функций ограничен 1,5 ГБ памяти и 1 ЦП.  Экземпляра узла — всего приложения-функции, то есть все функции в ресурс приложения-функции общего ресурса в пределах экземпляра и в то же время. Приложения-функции, которые совместно используют один и тот же план потребления масштабируются независимо друг от друга.  В план "премиум" размер вашего плана определяет объем доступной памяти и ЦП для всех приложений в этом плане на этом экземпляре.  

Файлы кода функции хранятся в файловых ресурсах Azure в функции основной учетной записи хранения. При удалении основной учетной записи хранения приложения-функции, файлы кода функции будут удалены без возможности восстановления.

> [!NOTE]
> При использовании триггера большого двоичного объекта в плане потребления обработка новых больших двоичных объектов может осуществляться с задержкой до 10 минут, если приложение-функция стало неактивным. После запуска приложения-функции большие двоичные объекты обрабатываются немедленно. Чтобы избежать этой задержки холодного запуска, использовать план "премиум" или [триггер сетки событий](functions-bindings-event-grid.md). Дополнительные сведения см. в разделе [Триггер](functions-bindings-storage-blob.md#trigger).

### <a name="runtime-scaling"></a>Масштабирование среды выполнения

Решение "Функции Azure" использует компонент, называемый *контроллером масштабирования*, чтобы отслеживать скорость событий и определять, необходимо ли выполнять масштабирование. Контроллер масштабирования использует эвристику для каждого типа триггеров. Например, при использовании триггера хранилища очередей Azure масштабирование выполняется в зависимости от длины запроса и возраста самого старого сообщения в очереди.

Единицей масштаба является приложение-функция. При масштабировании приложения-функции выделяются дополнительные ресурсы для выполнения нескольких экземпляров узла службы "Функции Azure". И наоборот, когда потребность в вычислительных ресурсах уменьшается, контроллер масштабирования удаляет экземпляры узла функции. Если никакие функции не выполняются, то число экземпляров в приложении-функции в конечном итоге сократится до нуля.

![Мониторинг событий и создание экземпляров с помощью контроллера масштабирования](./media/functions-scale/central-listener.png)

### <a name="understanding-scaling-behaviors"></a>Основные сведения о действиях при масштабировании

Масштабирование может зависеть от ряда факторов и выполняться по-разному в зависимости от выбранного триггера и языка. Однако существуют некоторые аспекты масштабирования, присутствующие в системе сегодня:

* Отдельное приложение-функция масштабируется максимум до 200 экземпляров. Один экземпляр может обрабатывать одновременно более одного сообщения или запроса, поэтому для количества одновременных выполнений не установлено ограничение.
* Для триггеров HTTP новые экземпляры только выделяется не более одного раза каждую секунду.
* Для триггеров, отличных от HTTP новые экземпляры только выделяется не более одного раза каждые 30 секунд.

Для различных триггеров также могут быть установлены разные ограничения масштабирования, а также ограничения, указанные в следующем документе:

* [Концентратор событий](functions-bindings-event-hubs.md#trigger---scaling)

### <a name="best-practices-and-patterns-for-scalable-apps"></a>Рекомендации и шаблоны для масштабируемых приложений

В приложении-функции существует множество аспектов, влияющих на качество его масштабирования, в том числе конфигурация узла, используемый объем среды выполнения и эффективность использования ресурсов.  Дополнительные сведения см. в разделе [Рекомендации по масштабируемости](functions-best-practices.md#scalability-best-practices). Вам также следует учитывать поведение подключений при масштабировании приложения-функции. См. дополнительные сведения об [управлении подключениями в службе "Функции Azure"](manage-connections.md).

### <a name="billing-model"></a>Модель выставления счетов

Выставление счетов для плана потребления подробно описано на [странице цен на Функции Azure]. Использование вычисляется на уровне приложения-функции. При этом учитывается только время выполнения кода функции. Счета выставляются по следующим единицам:

* **Потребление ресурсов в гигабайтах в секунду (ГБ/с)**. Вычисляется как сочетание объема памяти и времени выполнения для всех функций, выполняемых в приложении-функции. 
* **Выполнения**. Вычисляются при каждом выполнении функции в ответ на событие.

Можно найти полезные запросы и сведения о том, как расшифровка счета потребления [на выставления счетов вопросов и Ответов](https://github.com/Azure/Azure-Functions/wiki/Consumption-Plan-Cost-Billing-FAQ).

[странице цен на Функции Azure]: https://azure.microsoft.com/pricing/details/functions
