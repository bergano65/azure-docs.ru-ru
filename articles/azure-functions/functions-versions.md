---
title: Обзор версий среды выполнения для решения "Функции Azure"
description: Решение "Функции Azure" поддерживает разные версии среды выполнения. В этой статье приводятся различия между ними и рекомендации по выбору подходящей для вас версии.
ms.topic: conceptual
ms.date: 12/09/2019
ms.openlocfilehash: 874d2e657c2c9d7cba7874ff9815c61f9bbe8ef7
ms.sourcegitcommit: b5ff5abd7a82eaf3a1df883c4247e11cdfe38c19
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/09/2019
ms.locfileid: "74941740"
---
# <a name="azure-functions-runtime-versions-overview"></a>Обзор версий среды выполнения для решения "Функции Azure"

Основные версии среды выполнения функций Azure связаны с версией .NET, на которой основана среда выполнения. В следующей таблице указывается текущая версия среды выполнения, уровень выпуска и связанная версия .NET. 

| Версия среды выполнения | Уровень выпуска<sup>1</sup> | Версия .NET | 
| --------------- | ------------- | ------------ |
| 3.x | Общая доступность | .NET Core 3.1 | 
| 2.x | Общая доступность | .NET Core 2.2 |
| 1.x | Общедоступная версия<sup>2</sup> | .NET Framework 4,6<sup>3</sup> |

<sup>1</sup> общедоступные версии поддерживаются в рабочих сценариях.   
<sup>2</sup> версия 1. x находится в режиме обслуживания. Усовершенствования предоставляются только в более поздних версиях.   
<sup>3</sup> поддерживает только разработку на портал Azure или локально на компьютерах Windows.

В этой статье описаны некоторые различия между различными версиями, способы создания каждой версии и изменения версий.

## <a name="languages"></a>Языки

Начиная с версии 2. x, среда выполнения использует модель расширяемости языка, и все функции в приложении-функции должны использовать один и тот же язык. Язык функций в приложении-функции выбирается при создании приложения и сохраняется в параметрах [\_рабочего\_времени выполнения для функций](functions-app-settings.md#functions_worker_runtime) . 

Функции Azure 1. x экспериментальные языки не могут использовать новую модель, поэтому они не поддерживаются в 2. x. В следующей таблице перечислены языки программирования, которые в настоящее время поддерживаются для каждой версии среды выполнения.

[!INCLUDE [functions-supported-languages](../../includes/functions-supported-languages.md)]

Дополнительные сведения см. в [списке поддерживаемых языков](supported-languages.md).

## <a name="creating-1x-apps"></a>Запуск в определенной версии

По умолчанию приложения функций, созданные в портал Azure и Azure CLI, имеют значение версии 2. x. При необходимости эту версию можно изменить. Вы можете изменить версию среды выполнения до 1. x после создания приложения функции, но перед добавлением каких бы то ни было функций.  Перемещение между 2. x и 3. x разрешено даже с приложениями, которые имеют функции, но по-прежнему рекомендуется сначала проверить в новом приложении.

## <a name="migrating-from-1x-to-later-versions"></a>Переход с версии 1. x на более позднюю версию

Вы можете выбрать миграцию существующего приложения, написанного для использования среды выполнения версии 1. x, вместо этого использовать более новую версию. Большинство изменений, которые необходимо внести, связаны с изменениями в языковой среде выполнения, такими как C# изменения API между .NET Framework 4,7 и .NET Core. Также нужно убедиться, что код и библиотеки совместимы с выбранными языковыми средами выполнения. И наконец, обязательно обратите внимание на все изменения в триггерах, привязках и функциях, указанные ниже. Для достижения наилучших результатов миграции следует создать новое приложение-функцию в новой версии и перенести существующий код функции версии 1. x в новое приложение.  

Хотя можно выполнить обновление на месте путем ручного обновления конфигурации приложения, переход от 1. x к более поздней версии включает некоторые критические изменения. Например, в C#параметре объект отладки изменяется с `TraceWriter` на `ILogger`. Создание нового проекта версии 3. x начинается с обновленных функций на основе последних шаблонов версии 3. x.

### <a name="changes-in-triggers-and-bindings-after-version-1x"></a>Изменения в триггерах и привязках после версии 1. x

Начиная с версии 2. x, необходимо установить расширения для конкретных триггеров и привязок, используемых функциями в приложении. Единственное исключение — триггеры HTTP и таймера, для которых не требуется расширение.  Для получения дополнительной информации ознакомьтесь с разделом [Регистрация расширений привязки](./functions-bindings-register.md).

Существует также несколько изменений в *Function. JSON* или атрибутов функции между версиями. Например, свойство `path` для концентратора событий теперь имеет атрибут `eventHubName`. Для получения ссылок на документацию для каждой привязки см. [таблицу существующих привязок](#bindings).

### <a name="changes-in-features-and-functionality-after-version-1x"></a>Изменения в функциях и функциях после версии 1. x

Некоторые функции были удалены, обновлены или заменены после версии 1. x. В этом разделе описаны изменения, которые отображаются в более поздних версиях после использования версии 1. x.

В версии 2.x внесены следующие изменения.

* Ключи для вызова конечных точек HTTP всегда хранятся в зашифрованном виде в хранилище BLOB-объектов Azure. В версии 1.x эти ключи по умолчанию хранились в хранилище файлов Azure. При обновлении приложения с версии 1.x до версии 2.x выполняется сброс существующих секретных данных, которые находятся в хранилище файлов.

* Среда выполнения версии 2.x не имеет встроенной поддержки для поставщиков веб-перехватчиков. Это изменение внесено для повышения производительности. Вы по-прежнему можете использовать HTTP-триггеры как конечные точки для веб-перехватчиков.

* Файл конфигурации узла (host.json) должен быть пустым или содержать строку `"version": "2.0"`.

* Чтобы улучшить мониторинг, панель веб-заданий на портале с параметром [`AzureWebJobsDashboard`](functions-app-settings.md#azurewebjobsdashboard) замерена Azure Application Insights с параметром [`APPINSIGHTS_INSTRUMENTATIONKEY`](functions-app-settings.md#appinsights_instrumentationkey). Дополнительные сведения см. в разделе [Мониторинг функций Azure](functions-monitoring.md).

* Все функции в приложении-функции должны использовать один язык. При создании приложения-функции необходимо выбрать для приложения стек среды выполнения. Стек среды выполнения указан значением [`FUNCTIONS_WORKER_RUNTIME`](functions-app-settings.md#functions_worker_runtime) в параметрах приложения. Это требование добавлено для уменьшения занимаемого места и ускорения запуска. При локальной разработке также необходимо включить этот параметр в [файл local.settings.json](functions-run-local.md#local-settings-file).

* По умолчанию для функций в плане службы приложений устанавливается время ожидания 30 минут. Вы можете вручную снять это ограничение, изменив параметр [functionTimeout](functions-host-json.md#functiontimeout) в файле host.json.

* Регулирование параллельной обработки HTTP по умолчанию применяется для функций плана потребления, по умолчанию допуская не более 100 одновременных запросов на один экземпляр. Этот параметр можно изменить в параметре [`maxConcurrentRequests`](functions-host-json.md#http) файла host.json.

* Из-за [ограничений .NET Core](https://github.com/Azure/azure-functions-host/issues/3414) удалена поддержка функций в виде скриптов F# (.fsx). Скомпилированные функции F# (.fs) по-прежнему поддерживаются.

* Для веб-перехватчиков триггера сетки событий формат URL-адреса изменен на `https://{app}/runtime/webhooks/{triggerName}`.

## <a name="migrating-from-2x-to-3x"></a>Миграция с 2. x на 3. x

Функции Azure версии 3. x — это очень обратная совместимость с версией 2. x.  Многие приложения должны иметь возможность безопасно выполнить обновление до 3. x без каких бы то ни было изменений кода.  При переходе на 3. x рекомендуется выполнять сложные тесты перед изменением основной версии в рабочих приложениях.

### <a name="breaking-changes-between-2x-and-3x"></a>Критические изменения между 2. x и 3. x

Ниже приведены изменения, которые следует учитывать перед обновлением приложения 2. x до 3. x.

#### <a name="javascript"></a>JavaScript

* Выходные привязки, назначенные с помощью `context.done` или возвращаемых значений, теперь ведут себя так же, как и параметр в `context.bindings`.

* Объект триггера таймера — это camelCase, а не PascalCase

* Функции, активируемые концентратором событий с `dataType` двоичными данными, получают массив `binary` вместо `string`.

* Полезные данные HTTP-запроса больше не могут быть доступны через `context.bindingData.req`.  Доступ к нему по-прежнему можно получить в качестве входного параметра, `context.req`и в `context.bindings`.

* Node. js 8 больше не поддерживается и не будет выполняться в функциях 3. x.

#### <a name="net"></a>.NET

* [Синхронные операции сервера по умолчанию отключены](https://docs.microsoft.com/dotnet/core/compatibility/2.2-3.0#http-synchronous-io-disabled-in-all-servers).

### <a name="changing-version-of-apps-in-azure"></a>Изменение версии приложений в Azure

Версия среды выполнения для Функций Azure, используемая опубликованными в Azure приложениями, зависит от параметра приложения [`FUNCTIONS_EXTENSION_VERSION`](functions-app-settings.md#functions_extension_version). Поддерживаются следующие основные значения версии среды выполнения:

| Value | Целевой объект среды выполнения |
| ------ | -------- |
| `~3` | 3.x |
| `~2` | 2.x |
| `~1` | 1.x |

>[!IMPORTANT]
> Не меняйте этот параметр произвольно, так как могут потребоваться другие изменения параметров приложения и изменения кода функции.

### <a name="locally-developed-application-versions"></a>Локально разработанные версии приложений

Вы можете сделать следующие обновления для приложений функций локально изменяют целевые версии.

#### <a name="visual-studio-runtime-versions"></a>Версии среды выполнения Visual Studio

В Visual Studio вы выбираете версию среды выполнения при создании проекта. Средства Функций Azure для Visual Studio поддерживают обе основные версии среды выполнения. При отладке и публикации правильная версия применяется автоматически на основе настроек проекта. Параметры версии определяются в файле `.csproj` в следующих свойствах:

##### <a name="version-1x"></a>Версия 1.x

```xml
<TargetFramework>net461</TargetFramework>
<AzureFunctionsVersion>v1</AzureFunctionsVersion>
```

##### <a name="version-2x"></a>Версия 2.x

```xml
<TargetFramework>netcoreapp2.1</TargetFramework>
<AzureFunctionsVersion>v2</AzureFunctionsVersion>
```

##### <a name="version-3x"></a>Версия 3.x

```xml
<TargetFramework>netcoreapp3.1</TargetFramework>
<AzureFunctionsVersion>v3</AzureFunctionsVersion>
```

> [!NOTE]
> Для функций Azure 3. x и .NET требуется, чтобы расширение `Microsoft.Sdk.NET.Functions` было как минимум `3.0.0`.

###### <a name="updating-2x-apps-to-3x-in-visual-studio"></a>Обновление приложений 2. x до 3. x в Visual Studio

Можно открыть существующую функцию, предназначенную для 2. x, и переместить ее в 3. x, изменив файл `.csproj` и обновив значения, приведенные выше.  Visual Studio управляет версиями среды выполнения автоматически на основе метаданных проекта.  Однако это возможно, если вы никогда не создавали приложение 3. x, а пока Visual Studio еще не создали шаблоны и среду выполнения для 3. x на вашем компьютере.  Это может представлять собой сообщение об ошибке, например "не доступна среда выполнения функций, соответствующая версии, указанной в проекте".  Чтобы получить последние шаблоны и среду выполнения, ознакомьтесь с возможностями по созданию нового проекта функции.  При появлении страницы Выбор версии и шаблона подождите, пока Visual Studio не завершит выборку последних шаблонов.  После того как последние шаблоны .NET Core 3 будут доступны и будут отображены, вы сможете запустить и отладить любой проект, настроенный для версии 3. x.

> [!IMPORTANT]
> Функции версии 3. x можно разрабатывать только в Visual Studio, если используется версия 16,4 или более поздняя.

#### <a name="vs-code-and-azure-functions-core-tools"></a>Основные инструменты VS Code и Функций Azure

[Основные инструменты службы функции Azure](functions-run-local.md) используются для разработки из командной строки, а также в [расширении Функций Azure](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions) для Visual Studio Code. Для разработки на базе версии 3. x установите версию 3. x основных средств. Для разработки версии 2. x требуется версия 2. x основных средств и т. д. Дополнительные сведения см. в разделе [Установка основных инструментов Функций Azure](functions-run-local.md#install-the-azure-functions-core-tools).

Для разработки в Visual Studio Code следует также изменить параметры пользователя, чтобы `azureFunctions.projectRuntime` соответствовал версии установленных инструментов.  Этот параметр также обновляет шаблоны и языки, используемые при создании приложения-функции.  Для создания приложений в `~3` необходимо обновить пользовательский параметр `azureFunctions.projectRuntime` на `~3`.

![Параметр среды выполнения расширения функций Azure](./media/functions-versions/vs-code-version-runtime.png)

#### <a name="maven-and-java-apps"></a>Приложения Maven и Java

Вы можете перенести приложения Java с версии 2. x на 3. x, [установив версию 3. x основных средств](functions-run-local.md#install-the-azure-functions-core-tools) , необходимых для локального запуска.  Убедившись, что приложение правильно работает локально в версии 3. x, обновите файл `POM.xml` приложения, чтобы изменить `FUNCTIONS_EXTENSION_VERSION` параметр на `~3`, как показано в следующем примере:

```xml
<configuration>
    <resourceGroup>${functionResourceGroup}</resourceGroup>
    <appName>${functionAppName}</appName>
    <region>${functionAppRegion}</region>
    <appSettings>
        <property>
            <name>WEBSITE_RUN_FROM_PACKAGE</name>
            <value>1</value>
        </property>
        <property>
            <name>FUNCTIONS_EXTENSION_VERSION</name>
            <value>~3</value>
        </property>
    </appSettings>
</configuration>
```

## <a name="bindings"></a>Привязки

Начиная с версии 2. x среда выполнения использует новую [модель расширяемости привязки](https://github.com/Azure/azure-webjobs-sdk-extensions/wiki/Binding-Extensions-Overview) , которая предоставляет следующие преимущества:

* Поддержка сторонних расширений привязок.

* Разделение среды выполнения и привязок. Это изменение позволяет отдельно управлять версиями расширений привязок и выпускать эти расширения. Например, можно выполнить обновление до версии расширения на основе более новой версии базового пакета SDK.

* Менее ресурсоемкая среда выполнения, где в среде выполнения известны только используемые привязки и только они загружаются в нее.

За исключением триггеров HTTP и таймера, все привязки теперь необходимо вручную добавлять в проект приложения-функции или регистрировать на портале. Для получения дополнительной информации ознакомьтесь с разделом [Регистрация расширений привязки](./functions-bindings-expressions-patterns.md).

В следующей таблице перечислены поддерживаемые привязки для каждой версии среды выполнения.

[!INCLUDE [Full bindings table](../../includes/functions-bindings.md)]

[!INCLUDE [Timeout Duration section](../../includes/functions-timeout-duration.md)]

## <a name="next-steps"></a>Дальнейшие действия

Для получения дополнительных сведений см. следующие ресурсы:

* [Как программировать и тестировать функции Azure в локальной среде](functions-run-local.md)
* [Выбор целевых версий среды выполнения Функций Azure](set-runtime-version.md)
* [Заметки о выпуске](https://github.com/Azure/azure-functions-host/releases)
