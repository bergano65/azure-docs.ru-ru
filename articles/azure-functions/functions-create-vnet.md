---
title: Интеграция функций Azure с виртуальной сетью Azure
description: Пошаговое руководство, в котором показано, как подключиться к виртуальной сети Azure функции
services: functions
author: alexkarcher-msft
manager: jehollan
ms.service: azure-functions
ms.topic: article
ms.date: 4/11/2019
ms.author: alkarche
ms.openlocfilehash: 96ab479d3373eb6e575a00898f7007a4df252e39
ms.sourcegitcommit: bf509e05e4b1dc5553b4483dfcc2221055fa80f2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2019
ms.locfileid: "60002800"
---
# <a name="integrate-a-function-app-with-an-azure-virtual-network"></a>Интеграция приложения-функции с виртуальной сетью Azure

Этом руководстве показано, как с помощью функций Azure для подключения к ресурсам в виртуальной сети Azure.

В этом учебнике мы будем развертывать веб-сайта WordPress на виртуальной Машине в виртуальной сети, которая не будет доступна из Интернета. Затем мы будем развертывать функции с доступом к Интернету и виртуальной сети. Мы будем использовать эту функцию для доступа к ресурсам из сайта WordPress, развернутых в виртуальной сети.

Дополнительные сведения о работе системы, устранение неполадок и расширенную конфигурацию, см. в разделе [интеграция приложения с виртуальной сетью Azure](https://docs.microsoft.com/azure/app-service/web-sites-integrate-with-vnet). Функции Azure в план "премиум" имеют те же возможности размещения веб-приложений, поэтому все функциональные возможности и ограничения в этой статье применяются к функциям.

## <a name="topology"></a>Топология

 ![Пользовательский Интерфейс для интеграции виртуальной сети][1]

## <a name="create-a-vm-inside-a-virtual-network"></a>Создание виртуальной Машины в виртуальной сети

Для начала мы создадим предварительно настроенной виртуальной Машины, работающей WordPress внутри виртуальной сети. 

Мы выбрали WordPress на виртуальной Машине, так как это экономичный вариант — ресурсы, которые могут быть развернуты в виртуальной сети. Обратите внимание, что этот сценарий также можно использовать с любым ресурсом в виртуальной сети, например REST API, сред службы приложений и других служб Azure.

1. Перейдите на портал Azure.
2. Добавьте новый ресурс, открыв **создать ресурс** колонке.
3. Поиск "[производительности Max LEMP7 WordPress на виртуальной машине CentOS](https://jetware.io/appliances/jetware/wordpress4_lemp7-170526/profile?us=azure)" и откройте колонку его создания. 
4. На **основы** вкладке, настройте виртуальную Машину, указав следующую информацию:
    1. Создайте для этой виртуальной машины группу ресурсов, чтобы упростить удаление ресурсов в конце этого руководства. Здесь мы используем «Функция-VNET-Tutorial» в качестве примера.
    1. Введите уникальное имя виртуальной машины. В качестве примера мы используем «Wordpress для виртуальной сети».
    1. Выберите регион, ближайший к вам.
    1. Выберите размер как B1s (1 виртуальный ЦП и 1 ГБ памяти).
    1. Для учетной записи администратора включите аутентификацию на основе пароля и введите уникальное имя пользователя и пароль. Для этого руководства не нужно будет войти на виртуальную машину, если вам не требуются для устранения неполадок.
    
        ![Вкладка основы для создания виртуальной Машины](./media/functions-create-vnet/create-vm-1.png)

1. Переместить **сети** вкладку и введите следующие сведения:
    1.  Создайте новую виртуальную сеть.
    1.  Введите частным диапазоном адресов и подсети в пределах диапазона адресов. Размер этой подсети определяет, сколько виртуальных машин можно использовать в плане службы приложений. Если IP-адресацию и выделение не знакомы с, есть [документа, который охватывает основные](https://support.microsoft.com/en-us/help/164015/understanding-tcp-ip-addressing-and-subnetting-basics). IP-адресов и подсетей важны в этом сценарии, поэтому мы рекомендуем прочитать несколько статей и просмотрите ряд видео в Интернете, пока не имеет смысл. 
    
        В этом примере мы при переходе на использование 10.10.0.0/16 сети с подсетью 10.10.1.0/24. Мы избыточной подготовки и с помощью /16 подсети так, как легко вычислить, какой подсети доступны в сети 10.10.0.0/16.
        
        <img src="./media/functions-create-vnet/create-vm-2.png" width="700">

1. Вернитесь на **сети** вкладку, задайте общедоступный IP-адрес **None**. Этот шаг будет разворачивать ВМ с доступом только к виртуальной сети.
       
    <img src="./media/functions-create-vnet/create-vm-2-1.png" width="700">

7. Создайте виртуальную машину. Процесс может занять около 5 минут.
8. После создания виртуальной Машины, перейдите к его **сети** вкладку и запишите частный IP-адрес для последующего использования. Не выделяйте для виртуальной машины общедоступный IP-адрес.

    ![14]

Теперь у вас есть веб-сайта WordPress развернут целиком в пределах виртуальной сети. Этот сайт не будет доступен из Интернета.

## <a name="create-a-function-app-in-a-premium-plan"></a>Создание приложения-функции в плане "премиум"

Следующим шагом является создание приложения-функции в плане "премиум". План "премиум" обеспечивает бессерверной масштабирования со всеми преимуществами выделенного плана службы приложений. Функции приложения, созданные с помощью плана потребления не поддерживают Интеграция виртуальной сети.

[!INCLUDE [functions-premium-create](../../includes/functions-premium-create.md)]  

## <a name="connect-your-function-app-to-your-virtual-network"></a>Подключение к виртуальной сети приложение-функция

С сайта WordPress, где размещены файлы из виртуальной сети теперь можно подключиться к виртуальной сети приложения-функции.

1.  На портале для приложения-функции из предыдущего шага, выберите **функции платформы**. Затем выберите **сети**.

    <img src="./media/functions-create-vnet/networking-0.png" width="850">

1.  Выберите **щелкните здесь для настройки** под **интеграции с виртуальной сетью**.

    ![Состояние для Настройка сети](./media/functions-create-vnet/Networking-1.png)

1. На странице интеграции с виртуальной сети, выберите **Добавление виртуальной сети (Предварительная версия)**.

    <img src="./media/functions-create-vnet/networking-2.png" width="600"> 
    
1.  Создайте новую подсеть для функции и план службы приложений для использования. Обратите внимание на то, что размер подсети ограничит общее число виртуальных машин, которые можно добавить в план службы приложений. Виртуальная сеть автоматически направит трафик между подсетями в виртуальной сети, поэтому он не имеет значения, что функция находится в другой подсети виртуальной машины. 
    
    <img src="./media/functions-create-vnet/networking-3.png" width="600">

## <a name="create-a-function-that-accesses-a-resource-in-your-virtual-network"></a>Создайте функцию, которая обращается к ресурсу в виртуальной сети

Приложения-функции теперь можно получить доступ к виртуальной сети с наш сайт WordPress. Поэтому мы будем использовать функции для доступа к этому файлу и доставлять их обратно пользователю. В этом примере мы будем использовать веб-сайта WordPress API и прокси-сервер как вызывающей функции, так как они оба легко настроить и визуализировать. 

Так же легко можно использовать любой другой интерфейс API, развернутым в виртуальной сети. Также можно применить другую функцию с кодом, который выполняет вызовы API-Интерфейс API, развернутые в виртуальной сети. Экземпляр SQL Server, развернутых в виртуальной сети является прекрасным подтверждением.

1. На портале откройте приложение-функцию из предыдущего шага.
1. Создайте учетную запись-посредник, выбрав **учетные записи-посредники** > **+**.

    <img src="./media/functions-create-vnet/new-proxy.png" width="250">

1. Настройте имя прокси-сервера и маршрутов. В этом примере используется «/ растения» как маршрут.
1. Введите IP-адрес сайта WordPress из более ранней версии и задайте **URL-адрес внутреннего** для `http://{YOUR VM IP}/wp-content/themes/twentyseventeen/assets/images/header.jpg`
    
    <img src="./media/functions-create-vnet/create-proxy.png" width="900">

Теперь при попытке открыть URL-адрес серверной части напрямую, вставив его в новой вкладке браузера, страницы должно времени ожидания. Это обусловлено сайт WordPress подключен только к виртуальной сети и не через Интернет. Если вставить URL-адрес прокси-сервера в браузере, вы увидите (полученные с сайта WordPress) Материальная база изображения внутри виртуальной сети. 

Приложения-функции подключен к Интернету и виртуальной сетью. Прокси-сервер получает запрос из общедоступного сегмента Интернета и выполняет роль простого HTTP-прокси, пересылая этот запрос в виртуальную сеть. Затем прокси-сервер передает ответ обратно через общедоступный сегмент Интернета. 

<img src="./media/functions-create-vnet/plant.png" width="900">

## <a name="next-steps"></a>Дальнейшие действия

Функций, выполняемых в план "премиум" совместное использование одной базовой инфраструктуре службы приложений как веб-приложения на планы премиум v2. Вся документация по веб-приложений применяется к функции плана "премиум".

* [Дополнительные сведения о сетевых параметрах в функциях](./functions-networking-options.md)
* [Функции, часто задаваемые вопросы по сети чтения](./functions-networking-faq.md)
* [Дополнительные сведения о виртуальных сетях в Azure](../virtual-network/virtual-networks-overview.md)
* [Включить дополнительные сетевые компоненты и элемент управления со средами службы приложений](../app-service/environment/intro.md)
* [Подключение к отдельным локальным ресурсам без изменений брандмауэра с помощью гибридных подключений](../app-service/app-service-hybrid-connections.md)
* [Дополнительные сведения о прокси-серверы функций](./functions-proxies.md)

<!--Image references -->
[1]: ./media/functions-create-vnet/topology.png
[2]: ./media/functions-create-vnet/create-function-app.png
[3]: ./media/functions-create-vnet/create-app-service-plan.png
[4]: ./media/functions-create-vnet/configure-vnet.png
[5]: ./media/functions-create-vnet/create-vm-1.png
[6]: ./media/functions-create-vnet/create-vm-2.png
[7]: ./media/functions-create-vnet/create-vm-2-1.png
[8]: ./media/functions-create-vnet/networking-1.png
[9]: ./media/functions-create-vnet/networking-2.png
[10]: ./media/functions-create-vnet/networking-3.png
[11]: ./media/functions-create-vnet/new-proxy.png
[12]: ./media/functions-create-vnet/create-proxy.png
[14]: ./media/functions-create-vnet/vm-networking.png
