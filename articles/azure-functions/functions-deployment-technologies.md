---
title: Технологии развертывания в функциях Azure
description: Узнайте о различных способах развертывания кода в функциях Azure.
ms.custom: vs-azure
ms.topic: conceptual
ms.date: 04/25/2019
ms.openlocfilehash: 3865e6906b39633e14c86619770188f1c73fed8e
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "88641965"
---
# <a name="deployment-technologies-in-azure-functions"></a>Технологии развертывания в функциях Azure

Вы можете использовать несколько различных технологий для развертывания кода проекта функций Azure в Azure. В этой статье приводятся общие сведения о доступных методах развертывания и рекомендации для лучшего способа использования в различных сценариях. Он также содержит исчерпывающий список и основные сведения о базовых технологиях развертывания. 

## <a name="deployment-methods"></a>Методы развертывания

Технология развертывания, используемая для публикации кода в Azure, обычно определяется способом публикации приложения. Соответствующий метод развертывания определяется конкретными потребностями и точкой в цикле разработки. Например, во время разработки и тестирования развертывание можно выполнить непосредственно из средства разработки, например Visual Studio Code. Когда приложение находится в рабочей среде, вероятность непрерывной публикации из системы управления версиями или с помощью конвейера автоматической публикации, который включает в себя дополнительную проверку и тестирование, может оказаться более высокой.  

В следующей таблице описаны доступные методы развертывания для проекта функции.

| &nbsp;Тип развертывания | Методы | Лучше для... |
| -- | -- | -- |
| На основе инструментов | &bull;&nbsp;[&nbsp;Публикация Visual Studio &nbsp; Code &nbsp;](functions-develop-vs-code.md#publish-to-azure)<br/>&bull;&nbsp;[Публикация в Visual Studio](functions-develop-vs.md#publish-to-azure)<br/>&bull;&nbsp;[Публикация основных средств](functions-run-local.md#publish) | Развертывания во время разработки и другие развертывания AD-хокк. Управление развертываниями осуществляется локально с помощью инструментов. | 
| Управляемая службой приложений| &bull;&nbsp;[&nbsp;Центр развертывания &nbsp; (CI/CD)](functions-continuous-deployment.md)<br/>&bull;&nbsp;[&nbsp;Развертывания контейнеров](functions-create-function-linux-custom-image.md#enable-continuous-deployment-to-azure) |  Непрерывное развертывание (CI/CD) из системы управления версиями или из реестра контейнеров. Развертывания управляются платформой службы приложений (KUDU).|
| Внешние конвейеры|&bull;&nbsp;[Конвейеры DevOps](functions-how-to-azure-devops.md)<br/>&bull;&nbsp;[Действия GitHub](functions-how-to-github-actions.md) | Рабочие и DevOps конвейеры, включающие дополнительные проверки, тестирование и другие действия, выполняются как часть автоматизированного развертывания. Развертывания управляются конвейером. |

Хотя развертывания конкретных функций используют лучшие технологии в зависимости от контекста, большинство методов развертывания основаны на [развертывании ZIP](#zip-deploy).

## <a name="deployment-technology-availability"></a>Доступность технологии развертывания

Функции Azure поддерживают локальную разработку и размещение на разных платформах в Windows и Linux. Сейчас доступны три плана размещения:

+ [Потребление](functions-scale.md#consumption-plan)
+ [Премиальный](functions-scale.md#premium-plan)
+ [Выделенная (служба приложений)](functions-scale.md#app-service-plan)

Каждый план имеет разные поведения. Для каждой разновидности функций Azure доступны не все технологии развертывания. На следующей диаграмме показано, какие технологии развертывания поддерживаются для каждого сочетания операционной системы и плана размещения.

| Технология развертывания | Использование Windows | Windows Premium | Выделенные Windows  | Использование Linux | Linux Premium | Выделенные Linux |
|-----------------------|:-------------------:|:-------------------------:|:------------------:|:---------------------------:|:-------------:|:---------------:|
| URL-адрес внешнего пакета<sup>1</sup> |✔|✔|✔|✔|✔|✔|
| ZIP-развертывание |✔|✔|✔|✔|✔|✔|
| Контейнер Docker | | | | |✔|✔|
| Web Deploy |✔|✔|✔| | | |
| Система управления версиями |✔|✔|✔| |✔|✔|
| Локальный Git<sup>1</sup> |✔|✔|✔| |✔|✔|
| Синхронизация Cloud<sup>1</sup> |✔|✔|✔| |✔|✔|
| FTP<sup>1</sup> |✔|✔|✔| |✔|✔|
| Редактирование на портале |✔|✔|✔| |✔<sup>2</sup>|✔<sup>2</sup>|

<sup>1</sup> технология развертывания, требующая [синхронизации триггеров вручную](#trigger-syncing).
<sup>2</sup> редактирование на портале включено только для триггеров HTTP и таймера для функций в Linux, использующих Premium и выделенные планы.

## <a name="key-concepts"></a>Основные понятия

Некоторые ключевые понятия важны для понимания работы развертываний в функциях Azure.

### <a name="trigger-syncing"></a>Синхронизация триггеров

При изменении любого из триггеров инфраструктура функций должна учитывать изменения. Синхронизация происходит автоматически для многих технологий развертывания. Однако в некоторых случаях необходимо вручную синхронизировать триггеры. При развертывании обновлений путем ссылки на внешний URL-адрес пакета, локальный репозиторий Git, облачная синхронизация или FTP, необходимо вручную синхронизировать триггеры. Синхронизировать триггеры можно одним из трех способов:

* Перезапустите приложение функции в портал Azure
* Отправка запроса HTTP POST на `https://{functionappname}.azurewebsites.net/admin/host/synctriggers?code=<API_KEY>` использование [главного ключа](functions-bindings-http-webhook-trigger.md#authorization-keys).
* Отправьте запрос HTTP POST в `https://management.azure.com/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP_NAME>/providers/Microsoft.Web/sites/<FUNCTION_APP_NAME>/syncfunctiontriggers?api-version=2016-08-01` . Замените заполнители ИДЕНТИФИКАТОРом подписки, именем группы ресурсов и именем приложения функции.

### <a name="remote-build"></a>Удаленная сборка

Функции Azure могут автоматически выполнять сборки по коду, который он получает после развертывания ZIP. Эти сборки ведут себя немного иначе в зависимости от того, выполняется ли приложение в Windows или Linux. Удаленные сборки не выполняются, если приложение ранее было настроено для запуска в режиме [запуска из пакета](run-functions-from-deployment-package.md) . Чтобы узнать, как использовать удаленную сборку, перейдите к папке [ZIP Deploy](#zip-deploy).

> [!NOTE]
> Если возникают проблемы с удаленной сборкой, это может быть вызвано тем, что приложение было создано до того, как функция стала доступной (1 августа 2019 г.). Попробуйте создать новое приложение-функцию или запустите `az functionapp update -g <RESOURCE_GROUP_NAME> -n <APP_NAME>` его для обновления приложения-функции. Для выполнения этой команды может потребоваться две попытки.

#### <a name="remote-build-on-windows"></a>Удаленная сборка в Windows

Все приложения-функции, работающие в Windows, имеют небольшое приложение управления, SCM (или [KUDU](https://github.com/projectkudu/kudu)). Этот сайт обрабатывает большую часть логики развертывания и сборки для функций Azure.

При развертывании приложения в Windows выполняются команды для конкретного языка, например `dotnet restore` (C#) или `npm install` (JavaScript).

#### <a name="remote-build-on-linux"></a>Удаленная сборка в Linux

Чтобы включить удаленную сборку в Linux, необходимо задать следующие [Параметры приложения](functions-how-to-use-azure-function-app-settings.md#settings) :

* `ENABLE_ORYX_BUILD=true`
* `SCM_DO_BUILD_DURING_DEPLOYMENT=true`

По умолчанию как [Azure functions Core Tools](functions-run-local.md) , так и [расширение функций Azure для Visual Studio Code](functions-create-first-function-vs-code.md#publish-the-project-to-azure) выполнять удаленные сборки при развертывании в Linux. По этой причине оба средства автоматически создают эти параметры в Azure.

Когда приложения создаются удаленно в Linux, они [запускаются из пакета развертывания](run-functions-from-deployment-package.md).

##### <a name="consumption-plan"></a>План потребления

В приложениях-функциях Linux, выполняющихся в плане потребления, отсутствует сайт SCM или KUDU, который ограничивает возможности развертывания. Однако приложения функций в Linux, работающие в плане потребления, поддерживают удаленные сборки.

##### <a name="dedicated-and-premium-plans"></a>Планы "Специальный" и "Премиум"

Приложения-функции, работающие в Linux в [специальном плане (служба приложений)](functions-scale.md#app-service-plan) и [план Premium](functions-scale.md#premium-plan) , также имеют ограниченный сайт SCM или KUDU.

## <a name="deployment-technology-details"></a>Сведения о технологии развертывания

В функциях Azure доступны следующие методы развертывания.

### <a name="external-package-url"></a>URL-адрес внешнего пакета

URL-адрес внешнего пакета можно использовать для ссылки на файл удаленного пакета (ZIP), содержащий приложение-функцию. Файл загружается по указанному URL-адресу, и приложение запускается в режиме [запуска из пакета](run-functions-from-deployment-package.md) .

>__Как его использовать:__ Добавьте `WEBSITE_RUN_FROM_PACKAGE` в параметры приложения. Значение этого параметра должно быть URL-адресом (расположением определенного файла пакета, который требуется выполнить). Параметры можно добавить либо [на портале](functions-how-to-use-azure-function-app-settings.md#settings) , либо с [помощью Azure CLI](/cli/azure/functionapp/config/appsettings#az-functionapp-config-appsettings-set).
>
>При использовании хранилища BLOB-объектов Azure используйте частный контейнер с [подписанным URL-адресом (SAS)](../vs-azure-tools-storage-manage-with-storage-explorer.md#generate-a-sas-in-storage-explorer) , чтобы предоставить функциям доступ к пакету. При каждом перезапуске приложения он получает копию содержимого. Ссылка должна быть действительна в течение времени существования приложения.

>__Когда его использовать:__ URL-адрес внешнего пакета — это единственный поддерживаемый метод развертывания для функций Azure, выполняющихся в Linux в плане потребления, если пользователь не хочет, чтобы [удаленная сборка](#remote-build) выполнялась. При обновлении файла пакета, на который ссылается приложение-функция, необходимо [вручную синхронизировать триггеры](#trigger-syncing) , чтобы сообщить Azure о том, что ваше приложение изменилось.

### <a name="zip-deploy"></a>ZIP-развертывание

Используйте ZIP deploy, чтобы отправить zip-файл, содержащий приложение-функцию, в Azure. При необходимости можно настроить приложение для запуска [из пакета](run-functions-from-deployment-package.md)или указать, что выполняется [удаленная сборка](#remote-build) .

>__Как его использовать:__ Выполните развертывание с помощью любимого клиентского средства: [Visual Studio Code](functions-develop-vs-code.md#publish-to-azure), [Visual Studio](functions-develop-vs.md#publish-to-azure)или из командной строки с помощью [Azure functions Core Tools](functions-run-local.md#project-file-deployment). По умолчанию эти средства используют ZIP-развертывание и [запускаются из пакета](run-functions-from-deployment-package.md). Основные средства и расширение Visual Studio Code позволяют включить [удаленную сборку](#remote-build) при развертывании в Linux. Чтобы вручную развернуть ZIP-файл в приложении-функции, следуйте инструкциям в разделе [развертывание из файла с расширением ZIP или URL-адреса](https://github.com/projectkudu/kudu/wiki/Deploying-from-a-zip-file-or-url).

>При развертывании с помощью ZIP-развертывания можно настроить приложение для [запуска из пакета](run-functions-from-deployment-package.md). Чтобы запустить из пакета, задайте `WEBSITE_RUN_FROM_PACKAGE` для параметра приложения значение `1` . Рекомендуется использовать ZIP-развертывание. Это позволяет ускорить загрузку приложений, и это значение по умолчанию для VS Code, Visual Studio и Azure CLI.

>__Когда его использовать:__ ZIP Deploy — это рекомендуемая технология развертывания для функций Azure.

### <a name="docker-container"></a>Контейнер Docker

Вы можете развернуть образ контейнера Linux, содержащий приложение-функцию.

>__Как его использовать:__ Создайте приложение-функцию Linux в плане "Премиум" или "выделенный" и укажите образ контейнера для запуска. Это можно сделать двумя способами.
>
>* Создайте приложение-функцию Linux в плане службы приложений Azure на портал Azure. Для **публикации**выберите **образ DOCKER**, а затем настройте контейнер. Введите расположение, в котором размещен образ.
>* Создайте приложение-функцию Linux в плане службы приложений с помощью Azure CLI. Дополнительные сведения см. в статье [Создание функции в Linux с помощью пользовательского образа](functions-create-function-linux-custom-image.md#create-supporting-azure-resources-for-your-function).
>
>Чтобы выполнить развертывание в существующем приложении с помощью пользовательского контейнера, в [Azure functions Core Tools](functions-run-local.md)используйте [`func deploy`](functions-run-local.md#publish) команду.

>__Когда его использовать:__ Используйте параметр контейнер DOCKER, если требуется больший контроль над средой Linux, в которой выполняется приложение функции. Этот механизм развертывания доступен только для функций, работающих в Linux.

### <a name="web-deploy-msdeploy"></a>Веб-развертывание (MSDeploy)

Веб-развертывание пакеты и развертывает приложения Windows на любом сервере IIS, включая приложения функций, работающие в Windows в Azure.

>__Как его использовать:__ Используйте [инструменты Visual Studio для функций Azure](functions-create-your-first-function-visual-studio.md). Снимите флажок **запускать из файла пакета (рекомендуется)** .
>
>Можно также загрузить [веб-развертывание 3,6](https://www.iis.net/downloads/microsoft/web-deploy) и вызвать `MSDeploy.exe` напрямую.

>__Когда его использовать:__ Веб-развертывание поддерживается и не имеет проблем, но предпочтительным механизмом является [развертывание ZIP с включенным запуском из пакета](#zip-deploy). Дополнительные сведения см. в разделе с [руководством по разработке для Visual Studio](functions-develop-vs.md#publish-to-azure).

### <a name="source-control"></a>Система управления версиями

Используйте систему управления версиями для подключения приложения-функции к репозиторию Git. Обновление кода в этом репозитории активирует развертывание. Дополнительные сведения см. на [вики-сайте KUDU](https://github.com/projectkudu/kudu/wiki/VSTS-vs-Kudu-deployments).

>__Как его использовать:__ Используйте центр развертывания в области "функции" на портале, чтобы настроить публикацию из системы управления версиями. Дополнительные сведения см. в статье [Непрерывное развертывание для функций Azure](functions-continuous-deployment.md).

>__Когда его использовать:__ Использование системы управления версиями — это оптимальная практика для команд, совместно работающих с приложениями-функциями. Система управления версиями — хороший вариант развертывания, обеспечивающий более сложные конвейеры развертывания.

### <a name="local-git"></a>Локальный репозиторий Git

Вы можете использовать локальный Git для отправки кода с локального компьютера в функции Azure с помощью Git.

>__Как его использовать:__ Следуйте инструкциям в [локальном развертывании Git в службе приложений Azure](../app-service/deploy-local-git.md).

>__Когда его использовать:__ Как правило, рекомендуется использовать другой метод развертывания. При публикации из локального репозитория Git необходимо [вручную синхронизировать триггеры](#trigger-syncing).

### <a name="cloud-sync"></a>Синхронизация в облаке

Используйте облачную синхронизацию для синхронизации содержимого из Dropbox и OneDrive в функции Azure.

>__Как его использовать:__ Следуйте инструкциям в разделе [Синхронизация содержимого из облачной папки](../app-service/deploy-content-sync.md).

>__Когда его использовать:__ Как правило, мы рекомендуем использовать другие методы развертывания. При публикации с помощью синхронизации Cloud необходимо [вручную синхронизировать триггеры](#trigger-syncing).

### <a name="ftp"></a>FTP

Вы можете использовать FTP для непосредственного перемещения файлов в функции Azure.

>__Как его использовать:__ Следуйте инструкциям в разделе [развертывание содержимого с помощью FTP/s](../app-service/deploy-ftp.md).

>__Когда его использовать:__ Как правило, мы рекомендуем использовать другие методы развертывания. При публикации с помощью FTP необходимо [вручную синхронизировать триггеры](#trigger-syncing).

### <a name="portal-editing"></a>Редактирование на портале

В редакторе на основе портала можно изменять файлы, которые находятся в приложении-функции (по сути, развертывая каждый раз при сохранении изменений).

>__Как его использовать:__ Чтобы иметь возможность изменять функции в портал Azure, необходимо [создать функции на портале](functions-create-first-azure-function.md). Чтобы сохранить один источник истинности, использование любого другого метода развертывания сделает функцию только для чтения и не позволит продолжить редактирование на портале. Чтобы вернуться к состоянию, в котором можно изменить файлы в портал Azure, можно вручную снова включить режим редактирования `Read/Write` и удалить все параметры приложения, связанные с развертыванием (например `WEBSITE_RUN_FROM_PACKAGE` ,).

>__Когда его использовать:__ Портал — хороший способ начать работу с функциями Azure. Для более интенсивной работы по разработке рекомендуется использовать одно из следующих клиентских средств:
>
>* [Visual Studio Code](functions-create-first-function-vs-code.md)
>* [Azure Functions Core Tools (Командная строка)](functions-run-local.md)
>* [Visual Studio](functions-create-your-first-function-visual-studio.md)

В следующей таблице показаны операционные системы и языки, поддерживающие редактирование на портале.

| Язык | Использование Windows | Windows Premium | Выделенные Windows | Использование Linux | Linux Premium | Выделенные Linux |
|-|:-----------------: |:----------------:|:-----------------:|:-----------------:|:-------------:|:---------------:|
| C# | | | | | |
| Скрипт C# |✔|✔|✔| |✔<sup>\*</sup> |✔<sup>\*</sup>|
| F# | | | | | | |
| Java | | | | | | |
| JavaScript (Node.js) |✔|✔|✔| |✔<sup>\*</sup>|✔<sup>\*</sup>|
| Python (предварительная версия) | | | | | | |
| PowerShell (предварительная версия) |✔|✔|✔| | | |
| TypeScript (Node.js) | | | | | | |

<sup>*</sup> Редактирование на портале включено только для триггеров HTTP и таймера для функций в Linux, использующих Premium и выделенные планы.

## <a name="deployment-behaviors"></a>Поведение развертывания

При развертывании все существующие выполнения разрешаются до завершения или истечения времени ожидания, после чего новый код загружается для начала обработки запросов.

Если вам требуется больший контроль над этим переходом, следует использовать слоты развертывания.

## <a name="deployment-slots"></a>Слоты развертывания

При развертывании приложения-функции в Azure можно выполнить развертывание в отдельном слоте развертывания, а не непосредственно в рабочей среде. Дополнительные сведения о слотах развертывания см. в документации по [слотам развертывания функций Azure](../app-service/deploy-staging-slots.md) .

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь со следующими статьями, чтобы узнать больше о развертывании приложений функций.

+ [Непрерывное развертывание для Функций Azure](functions-continuous-deployment.md)
+ [Непрерывная поставка с помощью Azure DevOps](functions-how-to-azure-devops.md)
+ [Развертывание ZIP-файлов для функций Azure](deployment-zip-push.md)
+ [Запуск функций Azure из файла пакета](run-functions-from-deployment-package.md)
+ [Автоматизация развертывания ресурсов приложения-функции для службы "Функции Azure"](functions-infrastructure-as-code.md)
