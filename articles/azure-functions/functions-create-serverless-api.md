---
title: Настройка конечной точки HTTP в функциях Azure
description: Узнайте, как настроить конечную точку триггера HTTP в функциях Azure.
author: mattchenderson
ms.topic: conceptual
ms.date: 04/27/2020
ms.author: mahender
ms.custom: mvc
ms.openlocfilehash: d683ef92c4e8d11e9defbed5454e5849211bf8f7
ms.sourcegitcommit: ae6e7057a00d95ed7b828fc8846e3a6281859d40
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2020
ms.locfileid: "92104756"
---
# <a name="customize-an-http-endpoint-in-azure-functions"></a>Настройка конечной точки HTTP в функциях Azure

В этой статье вы узнаете, как функции Azure позволяют создавать масштабируемые API. Функции Azure поставляются с набором встроенных триггеров и привязок HTTP, которые упрощают создание конечной точки на различных языках, включая Node.js, C# и т. д. В этой статье вы настроите триггер HTTP для выполнения определенных действий в структуре API. Вы также подготовитесь к увеличению API, интегрируя его с Прокси-серверы Функций Azure и настроив макеты API. Эти задачи выполняются поверх среды вычислений без сервера, поэтому вам не нужно беспокоиться о масштабировании ресурсов. Вы можете просто сосредоточиться на логике API.

## <a name="prerequisites"></a>Предварительные требования 

[!INCLUDE [Previous quickstart note](../../includes/functions-quickstart-previous-topics.md)]

Итоговая функция будет использоваться в оставшейся части этой статьи.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com) с помощью своей учетной записи Azure.

## <a name="customize-your-http-function"></a>Настройка функции HTTP

По умолчанию функция триггера HTTP настроена для приема любого HTTP-метода. Можно также использовать URL-адрес по умолчанию, `http://<yourapp>.azurewebsites.net/api/<funcname>?code=<functionkey>` . В этом разделе вы измените функцию, чтобы она отвечала только на запросы GET с помощью `/api/hello` . 

1. Перейдите к своей функции на портале Azure. В меню слева выберите **Интеграция** , а затем в разделе **триггер**выберите **http (REQ)** .

    :::image type="content" source="./media/functions-create-serverless-api/customizing-http.png" alt-text="Настройка функции HTTP":::

1. Используйте параметры триггера HTTP, как указано в следующей таблице.

    | Поле | Образец значения | Описание |
    |---|---|---|
    | Шаблон маршрута | /hello | Определяет пути, используемые для вызова этой функции |
    | Уровень авторизации | Анонимные | (Необязательно.) Предоставляет доступ к функции без ключа API |
    | Выбранные методы HTTP | GET | Разрешает использовать только выбранные методы HTTP для вызова этой функции |

    `/api`Префикс базового пути не был включен в шаблон маршрута, так как он обрабатывается глобальным параметром.

1. Щелкните **Сохранить**.

Дополнительные сведения о настройке функций HTTP см. в статье [привязки HTTP в функциях Azure](./functions-bindings-http-webhook.md).

### <a name="test-your-api"></a>Тестирование API

Затем протестируйте функцию, чтобы увидеть, как она работает с новой поверхностью API:
1. На странице функция в меню слева выберите **код + тест** .

1. Выберите **получить URL-адрес функции** в верхнем меню и скопируйте URL-адрес. Убедитесь, что теперь используется `/api/hello` путь.
 
1. Скопируйте URL-адрес в новую вкладку браузера или в предпочтительный клиент REST. 

   Браузеры используют GET по умолчанию.
 
1. Добавьте параметры в строку запроса в URL-адресе. 

   Например, `/api/hello/?name=John`.
 
1. Нажмите клавишу ВВОД, чтобы подтвердить, что он работает. Вы должны увидеть ответ "*Привет Джон*".

1. Можно также попробовать вызвать конечную точку с помощью другого метода HTTP, чтобы убедиться, что функция не выполняется. Для этого используйте клиент RESTFUL, например, фигурную скобку, POST или Fiddler.

## <a name="proxies-overview"></a>Общие сведения о прокси-серверах

В следующем разделе вы создадите API через прокси-сервер. Функция "Прокси-серверы Функций Azure" позволяет вам перенаправлять запросы к другим ресурсам. Конечная точка HTTP определяется так же, как и триггер HTTP. Однако вместо написания кода для выполнения при вызове этой конечной точки вы предоставляете URL-адрес удаленной реализации. Это позволяет объединить несколько источников API в одну поверхность API, что очень удобно для использования клиентами, что полезно, если вы хотите создать API как микрослужбы.

Прокси-сервер может указывать на любой ресурс HTTP, например:
- Функции Azure 
- Приложения API в [службе приложений Azure](../app-service/overview.md).
- Контейнеры Docker в [службе приложений под управлением Linux](../app-service/overview.md#app-service-on-linux).
- Любой другой размещенный API.

Дополнительные сведения о прокси-серверах см. в статье [Работа с функцией "Прокси-серверы Функций Azure"].

## <a name="create-your-first-proxy"></a>Создание первого прокси-сервера

В этом разделе вы создадите новый прокси-сервер, который выступает в качестве внешнего интерфейса для общего API. 

### <a name="setting-up-the-frontend-environment"></a>Настройка среды интерфейса

Повторите шаги для [создания приложения-функции](./functions-create-first-azure-function.md#create-a-function-app), чтобы создать приложение-функцию, в котором вы создадите свой прокси-сервер. Этот URL-адрес нового приложения выступает в качестве внешнего интерфейса для нашего API, а приложение-функция, которое вы ранее редактировали, выступает в качестве серверной части.

1. Перейдите к своему новому приложению-функции интерфейса на портале.
1. Выберите **Функции платформы**, а затем — **Параметры приложения**.
1. Прокрутите вниз до пункта **Параметры приложения**, где хранятся пары "ключ-значение" и создайте новый параметр с ключом `HELLO_HOST` . Задайте узел приложения-функции внутреннего сервера, например `<YourBackendApp>.azurewebsites.net`, в качестве его значения. Это значение является частью URL-адреса, скопированного ранее при тестировании функции HTTP. Вы укажете этот параметр при конфигурации позднее.

    > [!NOTE] 
    > Мы рекомендуем использовать параметры приложения для настройки узла, чтобы прокси-сервер не зависел от жестко заданной среды. Использование настроек приложения означает, что вы можете перемещать конфигурацию прокси-сервера между средами. Параметры приложения для конкретной среды будут применяться.

1. Щелкните **Сохранить**.

### <a name="creating-a-proxy-on-the-frontend"></a>Создание прокси-сервера в интерфейсе

1. Вернитесь к своему внешнему приложению-функции на портале.

1. В меню слева выберите учетные записи- **посредники**и нажмите кнопку **Добавить**. 

1. На странице **Новая учетная запись-посредник** используйте параметры, приведенные в следующей таблице, а затем выберите **создать**.

    | Поле | Образец значения | Описание |
    |---|---|---|
    | Имя | HelloProxy | Понятное имя, используемое только для управления |
    | Шаблон маршрута | /api/remotehello | Определяет пути, используемые для вызова этого прокси-сервера |
    | Внутренний URL-адрес | https://%HELLO_HOST%/api/hello | Определяет конечную точку, к которой должен быть отправлен запрос |

    
    :::image type="content" source="./media/functions-create-serverless-api/creating-proxy.png" alt-text="Настройка функции HTTP":::

    Прокси-серверы Функций Azure не предоставляет `/api` префикс базового пути, который должен быть добавлен в шаблон маршрута. `%HELLO_HOST%`Синтаксис ссылается на созданный ранее параметр приложения. Разрешенный URL-адрес будет указывать на исходную функцию.

1. Попробуйте создать новый прокси-сервер, скопировав URL-адрес прокси-сервера и проверив его в браузере или с помощью избранного HTTP-клиента:
    - Для анонимной функции используйте:   `https://YOURPROXYAPP.azurewebsites.net/api/remotehello?name="Proxies"` .
    - Для функции с использованием авторизации:   `https://YOURPROXYAPP.azurewebsites.net/api/remotehello?code=YOURCODE&name="Proxies"` .

## <a name="create-a-mock-api"></a>Создание макета API

Далее вы будете использовать прокси-сервер для создания макета API для вашего решения. Этот прокси-сервер позволяет выполнять разработку клиентов, не требуя полностью реализованной серверной части. В дальнейшем в разработке можно создать новое приложение-функцию, которое поддерживает эту логику и перенаправить прокси-сервер.

Чтобы создать этот макет API, мы создадим новый прокси-сервер, на этот раз используя [редактор службы приложений](https://github.com/projectkudu/kudu/wiki/App-Service-Editor). Чтобы начать работу, перейдите к своему приложению-функции на портале. Выберите **функции платформы**и в разделе **средства разработки** найдите **редактор службы приложений**. Редактор службы приложений откроется на новой вкладке.

В левой области навигации выберите `proxies.json`. В этом файле хранится конфигурация всех прокси-серверов. Если вы используете один из [методов развертывания функций](./functions-continuous-deployment.md), этот файл будет поддерживаться в системе управления версиями. Дополнительные сведения об этом файле см. в разделе [Расширенная конфигурация](./functions-proxies.md#advanced-configuration).

Если вы выполнили следующие действия, proxies.jsдолжны выглядеть следующим образом:

```json
{
    "$schema": "http://json.schemastore.org/proxies",
    "proxies": {
        "HelloProxy": {
            "matchCondition": {
                "route": "/api/remotehello"
            },
            "backendUri": "https://%HELLO_HOST%/api/hello"
        }
    }
}
```

Затем добавьте макет API. Замените proxies.jsв файле следующим кодом:

```json
{
    "$schema": "http://json.schemastore.org/proxies",
    "proxies": {
        "HelloProxy": {
            "matchCondition": {
                "route": "/api/remotehello"
            },
            "backendUri": "https://%HELLO_HOST%/api/hello"
        },
        "GetUserByName" : {
            "matchCondition": {
                "methods": [ "GET" ],
                "route": "/api/users/{username}"
            },
            "responseOverrides": {
                "response.statusCode": "200",
                "response.headers.Content-Type" : "application/json",
                "response.body": {
                    "name": "{username}",
                    "description": "Awesome developer and master of serverless APIs",
                    "skills": [
                        "Serverless",
                        "APIs",
                        "Azure",
                        "Cloud"
                    ]
                }
            }
        }
    }
}
```

Этот код добавляет новый прокси, `GetUserByName` без `backendUri` Свойства. Вместо вызова другого ресурса он изменяет ответ по умолчанию от прокси-серверов, используя переопределение ответа. Переопределение запроса и ответа может также использоваться в сочетании с URL-адресом внутреннего сервера. Эта методика особенно полезна при создании прокси-сервера для устаревшей системы, где может потребоваться изменить заголовки, параметры запроса и т. д. Дополнительные сведения о переопределении запроса и ответа см. в [этой статье](./functions-proxies.md).

Протестируйте макет API, вызвав конечную точку `<YourProxyApp>.azurewebsites.net/api/users/{username}` с помощью браузера или избранного клиента REST. Замените _{username}_ строковым значением, представляющим имя пользователя.

## <a name="next-steps"></a>Дальнейшие действия

В этой статье вы узнали, как создавать и настраивать API в функциях Azure. а также объединять несколько API, включая макеты, в единую поверхность API. Вы можете использовать эти методы для создания API любой сложности, работая в бессерверной вычислительной модели, предоставляемой Функциями Azure.

Следующие ссылки могут оказаться полезными при дальнейшей разработке API:

- [Привязки HTTP и webhook в Функциях Azure](./functions-bindings-http-webhook.md)
- [Работа с функцией "Прокси-серверы Функций Azure"]
- [Создание метаданных OpenAPI 2.0 (Swagger) для приложения-функции (предварительная версия)](./functions-openapi-definition.md)


[Create your first function]: ./functions-create-first-azure-function.md
[Работа с функцией "Прокси-серверы Функций Azure"]: ./functions-proxies.md