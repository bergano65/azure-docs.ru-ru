---
title: Вызов, активация или вкладывание приложений логики
description: Настройка конечных точек HTTP для вызова, активации или вложения рабочих процессов приложения логики в Azure Logic Apps
services: logic-apps
ms.workload: integration
ms.reviewer: klam, jehollan, logicappspm
ms.topic: article
ms.date: 11/04/2019
ms.openlocfilehash: dbb91106ad00e1a82e2e6e9c470e61764a4ad4c4
ms.sourcegitcommit: 76b48a22257a2244024f05eb9fe8aa6182daf7e2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/03/2019
ms.locfileid: "74792028"
---
# <a name="call-trigger-or-nest-logic-apps-by-using-http-endpoints-in-azure-logic-apps"></a>Вызов, активация или вложение приложений логики с помощью конечных точек HTTP в Azure Logic Apps

Чтобы приложение логики вызывало через URL-адрес, чтобы приложение логики получало входящие запросы от других служб, вы можете предоставить синхронную конечную точку HTTP в качестве триггера для этого приложения логики. При настройке этой возможности можно также вложить приложение логики в другие приложения логики, которые позволяют создать шаблон вызываемых конечных точек.

Чтобы настроить конечную точку HTTP, можно использовать любой из следующих типов триггеров, которые позволяют приложениям логики получать входящие запросы:

* [Запрос](../connectors/connectors-native-reqres.md)
* [webhook HTTP](../connectors/connectors-native-webhook.md).
* Триггеры управляемых соединителей, которые имеют [тип ApiConnectionWebhook](../logic-apps/logic-apps-workflow-actions-triggers.md#apiconnectionwebhook-trigger) и могут принимать входящие HTTP-запросы

> [!NOTE]
> В этих примерах используется триггер запроса, но можно использовать любой триггер на основе HTTP-запроса, который находится в предыдущем списке. Все принципы аналогично применяются к этим другим типам триггеров.

Если вы не знакомы с приложениями логики, см. статью [что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md) и [Краткое руководство. Создание первого приложения логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

## <a name="prerequisites"></a>Технические условия

* Подписка Azure. Если у вас нет ее, вы можете [зарегистрироваться для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/).

* Приложение логики, в котором необходимо настроить конечную точку HTTP в качестве триггера. Можно начать с пустого приложения логики или существующего приложения логики, в котором необходимо заменить текущий триггер. Этот пример начинается с пустого приложения логики.

## <a name="create-a-callable-endpoint"></a>Создание вызываемой конечной точки

1. Войдите на [портале Azure](https://portal.azure.com). Создайте и откройте пустое приложение логики в конструкторе приложений логики.

   В этом примере используется триггер запроса, но можно использовать любой триггер, который может принимать входящие HTTP-запросы. Все принципы одинаково применяются к этим триггерам. Дополнительные сведения о триггере запросов см. [в разделе Получение и реагирование на входящие вызовы HTTPS с помощью Azure Logic Apps](../connectors/connectors-native-reqres.md).

1. В поле поиска выберите **встроенный**. В поле поиска введите `request` в качестве фильтра. В списке триггеры выберите **время получения HTTP-запроса**.

   ![Поиск и выбор триггера запроса](./media/logic-apps-http-endpoint/find-and-select-request-trigger.png)

1. При необходимости в поле **схема JSON текста запроса** можно ввести схему JSON, описывающую полезную нагрузку или данные, которые должны быть получены триггером.

   Конструктор использует эту схему для создания токенов, представляющих выходные данные триггера. Затем вы можете легко ссылаться на эти выходные данные по всему рабочему процессу приложения логики. Дополнительные сведения о [маркерах, созданных из схем JSON](#generated-tokens).

   В этом примере введите следующую схему:

   ```json
      {
      "type": "object",
      "properties": {
         "address": {
            "type": "object",
            "properties": {
               "streetNumber": {
                  "type": "string"
               },
               "streetName": {
                  "type": "string"
               },
               "town": {
                  "type": "string"
               },
               "postalCode": {
                  "type": "string"
               }
            }
         }
      }
   }
    ```

   ![Укажите схему JSON для действия запроса](./media/logic-apps-http-endpoint/manual-request-trigger-schema.png)

   Можно также создать схему JSON, предоставив пример полезных данных:

   1. В триггере **запроса** выберите **использовать образец полезных данных для создания схемы**.

   1. В поле **введите или вставьте образец полезных данных JSON** введите образец полезных данных, например:

      ```json
      {
         "address": {
            "streetNumber": "00000",
            "streetName": "AnyStreet",
            "town": "AnyTown",
            "postalCode": "11111-1111"
        }
      }
      ```

   1. Когда будете готовы, нажмите кнопку **Готово**.

      Теперь в поле **схема JSON текста запроса** отображается созданная схема.

1. Сохраните приложение логики.

   В поле **HTTP Post to this URL** теперь отображается созданный URL-адрес обратного вызова, который другие службы могут использовать для вызова и активации приложения логики. Этот URL-адрес содержит ключ подписи общего доступа (SAS), который используется для проверки подлинности в параметрах запроса, например:

   ![Созданный URL-адрес обратного вызова для конечной точки](./media/logic-apps-http-endpoint/generated-endpoint-url.png)

   URL-адрес конечной точки HTTP можно также получить из панели **Обзор** приложения логики.

   1. В меню приложения логики выберите **Обзор**.

   1. В разделе **Сводка** выберите **Просмотреть журнал триггеров**.

      ![Получение URL-адреса конечной точки HTTP на портале Azure](./media/logic-apps-http-endpoint/find-manual-trigger-url.png)

   1. В разделе **URL-адрес обратного вызова [Post]** скопируйте URL-адрес:

      ![Копировать URL-адрес конечной точки HTTP из портал Azure](./media/logic-apps-http-endpoint/copy-manual-trigger-callback-url.png)

      URL-адрес также можно получить, выполнив этот вызов:

      ```http
      POST https://management.azure.com/{logic-app-resource-ID}/triggers/{endpoint-trigger-name}/listCallbackURL?api-version=2016-06-01
      ```

<a name="set-method"></a>

## <a name="set-expected-http-method"></a>Задать ожидаемый метод HTTP

По умолчанию триггер Request ожидает запрос HTTP POST. Однако можно указать другой метод для ожидания, но только один метод.

1. В триггере запроса откройте список **Добавить новый параметр** и выберите **метод**, который добавляет это свойство в триггер.

   ![Добавление свойства "Method" в триггер](./media/logic-apps-http-endpoint/select-add-new-parameter-for-method.png)

1. В списке **метод** выберите другой метод, который вместо него принимает триггер. Или можно указать пользовательский метод.

   Например, выберите метод **Get** , чтобы позже можно было проверить URL-адрес КОНЕЧНОЙ точки HTTP.

   ![Выбор метода HTTP, используемого для триггера](./media/logic-apps-http-endpoint/select-method-request-trigger.png)

## <a name="accept-parameters-in-endpoint-url"></a>Принять параметры в URL-адресе конечной точки

Если URL-адрес конечной точки должен принимать параметры, укажите относительный путь в триггере. Кроме того, необходимо явно [задать метод](#set-method) , который должен дождаться HTTP-запрос.

1. В триггере запроса откройте список **Добавить новый параметр** и выберите **относительный путь**, который добавляет это свойство в триггер.

   ![Добавление свойства "Relative Path" в триггер](./media/logic-apps-http-endpoint/select-add-new-parameter-for-relative-path.png)

1. В свойстве **относительного пути** укажите относительный путь для параметра в схеме JSON, который должен быть принят URL-адресом, например `address/{postalCode}`.

   ![Укажите относительный путь для параметра](./media/logic-apps-http-endpoint/relative-path-url-value.png)

1. Чтобы использовать параметр, найдите и добавьте действие **ответа** в приложение логики.

   1. В разделе триггер запроса выберите **новый шаг** > **Добавить действие**.

   1. В разделе **Выберите действие** введите фильтр `response` в поле поиска.

   1. В списке действия выберите действие **ответ** .

1. В свойстве **Body** действия ответа добавьте маркер, представляющий параметр, указанный в относительных пути триггера.

   Например, предположим, что ответное действие должно возвращать `Postal Code: {postalCode}`.

   В свойстве **Body** введите `Postal Code: ` с конечным пробелом. В появившемся списке динамического содержимого выберите токен **PostalCode** .

   ![Добавление указанного параметра в текст ответа](./media/logic-apps-http-endpoint/relative-url-with-parameter-token.png)

   Свойство **Body** теперь включает выбранный параметр:

   ![Пример текста ответа с параметром](./media/logic-apps-http-endpoint/relative-url-with-parameter.png)

1. Сохраните приложение логики.

    URL-адрес конечной точки HTTP теперь включает относительный путь, например:

    ```http
    https://prod-25.westus.logic.azure.com/workflows/{logic-app-resource-ID}/triggers/manual/paths/invoke/address/{postalCode}?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig={shared-access-signature}
    ```

1. Для проверки конечной точки HTTP скопируйте и вставьте обновленный URL-адрес в другом окне браузера, но замените `{postalCode}` на `123456` и нажмите клавишу ВВОД.

   В браузере отобразится следующий текст: `Postal Code: 123456`

## <a name="call-logic-app-through-http-endpoint"></a>Вызов приложения логики через конечную точку HTTP

После создания конечной точки HTTP можно запустить приложение логики, отправив запрос HTTP `POST` в полный URL-адрес конечной точки. Приложения логики имеют встроенную поддержку конечных точек прямого доступа.

<a name="generated-tokens"></a>

## <a name="tokens-generated-from-schema"></a>Токены, созданные из схемы

При предоставлении схемы JSON в триггере запроса конструктор приложений логики создает маркеры для свойств в этой схеме. Затем эти токены можно использовать для передачи данных через рабочий процесс приложения логики.

Например, при добавлении в схему JSON дополнительных свойств, например `"suite"`, маркеры для этих свойств будут доступны для использования в последующих шагах для приложения логики. Ниже приведена полная схема JSON.

```json
   {
   "type": "object",
   "properties": {
      "address": {
         "type": "object",
         "properties": {
            "streetNumber": {
               "type": "string"
            },
            "streetName": {
               "type": "string"
            },
            "suite": {
               "type": "string"
            },
            "town": {
               "type": "string"
            },
            "postalCode": {
               "type": "string"
            }
         }
      }
   }
}
```

## <a name="create-nested-logic-apps"></a>Создание вложенных приложений логики

Вы можете вкладывать рабочие процессы в свое приложение логики путем добавления других приложений логики, которые могут принимать запросы. Чтобы включить эти приложения логики, выполните следующие действия.

1. На шаге, где необходимо вызвать другое приложение логики, выберите **новый шаг** > **Добавить действие**.

1. В разделе **Выберите действие** выберите **Встроенный**. В поле поиска введите `logic apps` в качестве фильтра. В списке действия выберите **пункт выбрать Logic Apps рабочий процесс**.

   ![Вложение приложения логики в текущее приложение логики](./media/logic-apps-http-endpoint/choose-logic-apps-workflow.png)

   В конструкторе отображаются доступные приложения логики для выбора.

1. Выберите приложение логики для вызова из текущего приложения логики.

   ![Выбор приложения логики для вызова из текущего приложения логики](./media/logic-apps-http-endpoint/select-logic-app-to-nest.png)

## <a name="reference-content-from-an-incoming-request"></a>Ссылка на содержимое входящего запроса

Если тип содержимого входящего запроса — `application/json`, можно сослаться на свойства во входящем запросе. В противном случае это содержимое рассматривается как одна двоичная единица, которую можно передать другим API. Чтобы сослаться на это содержимое в рабочем процессе приложения логики, необходимо сначала преобразовать это содержимое.

Например, при передаче содержимого, имеющего тип `application/xml`, можно использовать [выражение`@xpath()`](../logic-apps/workflow-definition-language-functions-reference.md#xpath) для выполнения извлечения XPath или использовать [выражение`@json()`](../logic-apps/workflow-definition-language-functions-reference.md#json) для преобразования XML в JSON. Дополнительные сведения о работе с поддерживаемыми [типами содержимого](../logic-apps/logic-apps-content-type.md).

Чтобы получить выходные данные входящего запроса, можно использовать [выражение`@triggerOutputs`](../logic-apps/workflow-definition-language-functions-reference.md#triggerOutputs). Например, предположим, что у вас есть выходные данные, которые выглядят, как в следующем примере:

```json
{
   "headers": {
      "content-type" : "application/json"
   },
   "body": {
      "myProperty" : "property value"
   }
}
```

Для доступа к конкретному свойству `body` можно использовать [выражение`@triggerBody()`](../logic-apps/workflow-definition-language-functions-reference.md#triggerBody) в качестве ярлыка.

## <a name="respond-to-requests"></a>Ответ на запросы

Иногда требуется ответить на определенные запросы, которые активируют приложение логики, возвращая содержимое вызывающему объекту. Чтобы создать код состояния, заголовок и текст для ответа, используйте действие ответ. Это действие может находиться в любом месте приложения логики, а не только в конце рабочего процесса. Если приложение логики не включает в себя действие ответа, то конечная точка HTTP *немедленно* реагирует на 202 с состоянием " **принято** ".

Чтобы исходный вызывающий объект успешно получил ответ, все необходимые действия для ответа должны завершиться в пределах [предела времени ожидания запроса](./logic-apps-limits-and-config.md) , если только Активируемое приложение логики не вызвано как вложенное приложение логики. Если в рамках этого ограничения ответ не возвращается, истекает время ожидания входящего запроса и получает ответ **времени ожидания клиента 408** .

Для вложенных приложений логики родительское приложение логики по-своему будет ждать ответа до тех пор, пока не будут выполнены все необходимые действия, независимо от того, сколько времени требуется.

### <a name="construct-the-response"></a>Создание ответа

В тексте ответа можно включить несколько заголовков и любого типа содержимого. Например, заголовок ответа указывает, что тип содержимого ответа является `application/json` и что текст содержит значения свойств `town` и `postalCode` на основе схемы JSON, описанной ранее в этом разделе для триггера запроса.

![Укажите содержимое ответа для действия ответа HTTP](./media/logic-apps-http-endpoint/content-for-response-action.png)

У ответов есть следующие свойства:

| Свойство (отображение) | Свойство (JSON) | Описание |
|--------------------|-----------------|-------------|
| **Код состояния** | `statusCode` | Код состояния HTTP, используемый в ответе для входящего запроса. Это может быть любой допустимый код состояния, который начинается с 2xx, 4xx или 5xx. Но коды состояния 3xx не допускаются. |
| **Заголовки** | `headers` | Один или несколько заголовков для включения в ответ |
| **Текст** | `body` | Объект Body, который может быть строкой, объектом JSON или даже двоичным содержимым, на которое ссылается предыдущий шаг. |
||||

Чтобы просмотреть определение JSON для действия ответ и полное определение JSON приложения логики, на панели инструментов конструктора приложений логики выберите **представление кода**.

``` json
"Response": {
   "type": "Response",
   "kind": "http",
   "inputs": {
      "body": {
         "postalCode": "@triggerBody()?['address']?['postalCode']",
         "town": "@triggerBody()?['address']?['town']"
      },
      "headers": {
         "content-type": "application/json"
      },
      "statusCode": 200
   },
   "runAfter": {}
}
```

## <a name="q--a"></a>Контроль качества

#### <a name="q-what-about-url-security"></a>Вопрос. Как обеспечивается безопасность URL-адресов?

Ответ **. Azure**безопасно создает URL-адреса обратного вызова приложения логики с помощью [подписанного общего доступа (SAS)](https://docs.microsoft.com/rest/api/storageservices/delegate-access-with-shared-access-signature). Эта подпись передается в качестве параметра запроса и должна быть проверена перед запуском приложения логики. Azure создает эту подпись на основе уникального сочетания секретного ключа для каждого приложения логики, имени триггера и выполняемой операции. Не имея доступа к секретному ключу приложения логики, создать действительную подпись невозможно.

> [!IMPORTANT]
> Для рабочих и безопасных систем мы настоятельно рекомендуем вызывать приложение логики непосредственно из браузера по следующим причинам:
>
> * ключ общего доступа отображается в URL-адресе;
> * Вы не можете управлять политиками безопасного содержимого из-за общих доменов для клиентов Azure Logic Apps.

#### <a name="q-can-i-configure-http-endpoints-further"></a>Вопрос. Могу ли я дополнительно настроить конечные точки HTTP?

Ответ **. Да**, конечные точки HTTP поддерживают более сложную конфигурацию с помощью службы [управления API Azure](../api-management/api-management-key-concepts.md). Эта служба также предлагает вам возможность согласованно управлять всеми своими API, включая приложения логики, настраивать имена домена, использовать дополнительные методы проверки подлинности и т. д. В частности она предоставляет следующие возможности:

* [Изменение метода запроса](../api-management/api-management-advanced-policies.md#SetRequestMethod)
* [Изменение сегментов URL-адреса запроса](../api-management/api-management-transformation-policies.md#RewriteURL)
* Настройка доменов управления API в [портал Azure](https://portal.azure.com/)
* настройка политики для проверки базовой проверки подлинности.

## <a name="next-steps"></a>Дальнейшие действия

* [Получение и реагирование на входящие вызовы HTTPS с помощью Azure Logic Apps](../connectors/connectors-native-reqres.md)