---
title: Обмен сообщениями для сценариев интеграции B2B Enterprise
description: Получение и отправка сообщений B2B между торговыми партнерами в Azure Logic Apps с помощью Пакет интеграции Enterprise
services: logic-apps
ms.suite: integration
author: divyaswarnkar
ms.author: divswa
ms.reviewer: jonfan, estfan, logicappspm
ms.topic: article
ms.date: 02/10/2020
ms.openlocfilehash: 2fd96777a5fe74d44aeed5f6de82e54b2663a024
ms.sourcegitcommit: 3d79f737ff34708b48dd2ae45100e2516af9ed78
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "87090388"
---
# <a name="receive-and-confirm--b2b-as2-messages-by-using-azure-logic-apps-and-enterprise-integration-pack"></a>Получение и подтверждение сообщений AS2 для B2B с помощью Azure Logic Apps и Пакет интеграции Enterprise

Если у вас есть учетная запись интеграции, которая определяет торговые партнеры и соглашения, вы можете создать автоматизированный рабочий процесс B2B, который обменивается сообщениями между торговыми партнерами с помощью [Azure Logic Apps](../logic-apps/logic-apps-overview.md) с [пакет интеграции Enterprise](../logic-apps/logic-apps-enterprise-integration-overview.md). Azure Logic Apps работает с соединителями, поддерживающими стандартные отраслевые протоколы AS2, X12, EDIFACT и RosettaNet. Эти соединители также можно сочетать с другими [соединителями, доступными в Logic Apps](../connectors/apis-list.md), например Salesforce и Office 365 Outlook.

В этой статье показано, как создать приложение логики, которое получает HTTP-запрос с помощью триггера запроса, декодирует содержимое сообщения с помощью действий AS2 и X12, а затем возвращает ответ с помощью действия Response.

## <a name="prerequisites"></a>Обязательные условия

* Подписка Azure. Если у вас еще нет подписки, зарегистрируйтесь, чтобы [получить бесплатную учетную запись Azure](https://azure.microsoft.com/free/).

* Пустое приложение логики, которое позволяет создать рабочий процесс B2B с помощью триггера [запроса](../connectors/connectors-native-reqres.md) , за которым следуют следующие действия:

  * [Декодирование AS2](../logic-apps/logic-apps-enterprise-integration-as2.md)

  * [Условие](../logic-apps/logic-apps-control-flow-conditional-statement.md), которое отправляет [ответ](../connectors/connectors-native-reqres.md) в зависимости от успешности или неудачи действия декодирования AS2

  * [Декодировать сообщение X12](../logic-apps/logic-apps-enterprise-integration-x12.md) 

  Если вы не знакомы с приложениями логики, ознакомьтесь с [Azure Logic Apps?](../logic-apps/logic-apps-overview.md) и [Краткое руководство. Создание первого приложения логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

* [Учетная запись интеграции](./logic-apps-enterprise-integration-create-integration-account.md) , связанная с подпиской Azure и связанная с приложением логики. Как приложение логики, так и учетная запись интеграции должны находиться в одном расположении или регионе Azure.

* По крайней мере два [торговых партнера](../logic-apps/logic-apps-enterprise-integration-partners.md) , которые вы уже определили в вашей учетной записи интеграции вместе с [соглашениями AS2 и X12](logic-apps-enterprise-integration-agreements.md) для этих партнеров.

## <a name="add-request-trigger"></a>Добавление триггера запроса

В этом примере используется конструктор приложений логики в портал Azure, но вы можете выполнить аналогичные действия в конструкторе приложений логики в Visual Studio.

1. В [портал Azure](https://portal.azure.com)откройте пустое приложение логики в конструкторе приложений логики.

1. В поле поиска введите `when a http request` и выберите, **когда получен HTTP-запрос** для использования в качестве триггера.

   ![Выберите триггер запроса, чтобы запустить рабочий процесс приложения логики](./media/logic-apps-enterprise-integration-b2b/select-http-request-trigger.png)

1. Оставьте поле " **схема JSON тела запроса** " пустым, так как сообщение X12 является неструктурированным файлом.

   ![Оставьте пустым "схему JSON тела запроса".](./media/logic-apps-enterprise-integration-b2b/receive-trigger-message-body-json-schema.png)

1. По завершении нажмите кнопку **Сохранить** на панели инструментов конструктора.

   На этом шаге создается **URL-адрес HTTP POST** , который будет использоваться для отправки запроса, запускающего приложение логики. Чтобы скопировать этот URL-адрес, щелкните значок копирования рядом с URL-адресом.

   ![URL-адрес, созданный для триггера запроса на получение вызовов](./media/logic-apps-enterprise-integration-b2b/generated-url-request-trigger.png)

## <a name="add-as2-decode-action"></a>Добавить действие декодирования AS2

Теперь добавьте действия B2B, которые вы хотите использовать. В этом примере используются действия AS2 и X12.

1. В разделе триггера щелкните **Добавить шаг**. Чтобы скрыть сведения о триггере, щелкните заголовок окна триггера.

   ![Добавление еще одного шага в рабочий процесс приложения логики](./media/logic-apps-enterprise-integration-b2b/add-new-action-under-trigger.png)

1. В разделе **выберите действие**в поле поиска введите `as2 decode` и выберите **декодирование AS2 (v2)**.

   ![Найдите и выберите "декодирование AS2 (v2)".](./media/logic-apps-enterprise-integration-b2b/add-as2-decode-action.png)

1. Для свойства **сообщение для декодирования** введите входные данные, которые должно декодировать действие AS2, которое является `body` содержимым, полученным триггером HTTP-запроса. Существует несколько способов указать это содержимое в качестве входных данных из списка динамического содержимого или в виде выражения:

   * Чтобы выбрать из списка Доступные выходные данные триггера, щелкните внутри **сообщения, чтобы декодировать** поле. После появления списка динамического содержимого в разделе **при получении HTTP-запроса**выберите значение свойства **Body** , например:

     ![Выберите значение "текст" из триггера.](./media/logic-apps-enterprise-integration-b2b/select-body-content-from-trigger.png)

   * Чтобы ввести выражение, которое ссылается на `body` выходные данные триггера, щелкните внутри **сообщения для декодирования** . После появления списка динамического содержимого выберите **выражение**. В редакторе выражений введите здесь выражение и нажмите кнопку **ОК**:

     `triggerOutputs()['body']`

     В поле **сообщение для декодирования** введите следующее выражение:

     `@triggerBody()`

     Выражение разрешается в маркер **тела** .

     ![Разрешенный вывод текста из триггера](./media/logic-apps-enterprise-integration-b2b/resolved-trigger-outputs-body-expression.png)

1. Для свойства **заголовки сообщений** введите все заголовки, необходимые для действия AS2, которое описывается `headers` содержимым, полученным триггером HTTP-запроса.

   Чтобы ввести выражение, которое ссылается на `headers` выходные данные триггера, щелкните внутри поля **заголовки сообщений** . После появления списка динамического содержимого выберите **выражение**. В редакторе выражений введите здесь выражение и нажмите кнопку **ОК**:

   `triggerOutputs()['Headers']`

   Чтобы получить это выражение для разрешения в качестве маркера, переключитесь между конструктором и представлением кода, например:

   ![Разрешенные выходные данные заголовков из триггера](./media/logic-apps-enterprise-integration-b2b/resolved-trigger-outputs-headers-expression.png)

## <a name="add-response-action-for-message-receipt-notification"></a>Добавление действия ответа для уведомления о получении сообщения

Чтобы уведомить торгового партнера о получении сообщения, можно вернуть ответ, содержащий уведомление о расстановке сообщения AS2 (MDN), с помощью действия **ответа** . Если добавить это действие сразу после действия **декодирования AS2** , в случае сбоя этого действия приложение логики не продолжит обработку.

1. В разделе действие **декодирования AS2** выберите **новый шаг**.

1. В разделе **Выбор действия**в поле поиска выберите **встроенный**. В поле поиска введите `condition`. В списке **Действия** выберите **Условие**.

   ![Добавить действие "условие"](./media/logic-apps-enterprise-integration-b2b/add-condition-action.png)

   Теперь отображается форма условия, в том числе пути, где выполняется условие.

   ![Форма условия с путями принятия решений](./media/logic-apps-enterprise-integration-b2b/added-condition-action.png)

1. Теперь укажите условие для вычисления. В поле **выберите значение** введите следующее выражение:

   `@body('AS2_Decode')?['AS2Message']?['MdnExpected']`

   В среднем поле убедитесь, что для операции сравнения задано значение `is equal to` . В правой части поля введите значение `Expected` . Чтобы получить выражение для разрешения в качестве маркера, переключитесь между конструктором и представлением кода.

   ![Форма условия с путями принятия решений](./media/logic-apps-enterprise-integration-b2b/expression-for-evaluating-condition.png)

1. Теперь укажите ответы, которые будут возвращать результат операции **декодирования AS2** .

   1. В случае успеха при выполнении действия **декодирования AS2** в форме **If true** выберите **Добавить действие**. В разделе **выберите действие**в поле поиска введите `response` и выберите **ответ**.

      ![Поиск и выбор действия "ответ"](./media/logic-apps-enterprise-integration-b2b/select-http-response-action.png)

   1. Чтобы получить доступ к MDN AS2 из выходных данных действия **декодирования AS2** , укажите следующие выражения:

      * В свойстве **заголовки** действия **ответа** введите следующее выражение:

        `@body('AS2_Decode')?['OutgoingMdn']?['OutboundHeaders']`

      * В свойстве **текст** действия **ответа** введите следующее выражение:

        `@body('AS2_Decode')?['OutgoingMdn']?['Content']`

   1. Чтобы получить выражения для разрешения в виде маркеров, переключитесь между конструктором и представлением кода:

      ![Разрешенное выражение для доступа к AS2 MDN](./media/logic-apps-enterprise-integration-b2b/response-action-success-resolved-expression.png)

   1. В случае сбоя действия **декодирования AS2** в фигуре **If false** выберите **Добавить действие**. В разделе **выберите действие**в поле поиска введите `response` и выберите **ответ**. Настройте действие **ответ** , чтобы вернуть требуемое состояние и ошибку.

1. Сохраните приложение логики.

## <a name="add-decode-x12-message-action"></a>Добавление действия декодирования X12 сообщения

1. Теперь добавьте действие **декодирование X12 сообщения** . В разделе действие **ответа** выберите **Добавить действие**.

1. В разделе **выберите действие**в поле поиска введите `x12 decode` и выберите **декодирование сообщения X12**.

   ![Найдите и выберите действие "декодирование сообщения X12"](./media/logic-apps-enterprise-integration-b2b/add-x12-decode-action.png)

1. Если действие X12 запрашивает сведения о подключении, укажите имя для подключения, выберите учетную запись интеграции, которую вы хотите использовать, и нажмите кнопку **создать**.

   ![Создание подключения X12 к учетной записи интеграции](./media/logic-apps-enterprise-integration-b2b/create-x12-integration-account-connection.png)

1. Теперь укажите входные данные для действия X12. В этом примере используются выходные данные действия AS2, которое является содержимым сообщения, но обратите внимание, что это содержимое имеет формат объекта JSON и кодируется в кодировке Base64. Поэтому необходимо преобразовать это содержимое в строку.

   В поле **декодирование сообщения неструктурированного файла X12** введите это выражение для преобразования выходных данных AS2:

   `@base64ToString(body('AS2_Decode')?['AS2Message']?['Content'])`

    Чтобы получить выражение для разрешения в качестве маркера, переключитесь между конструктором и представлением кода.

    ![Преобразование содержимого в кодировке Base64 в строку](./media/logic-apps-enterprise-integration-b2b/x12-decode-message-content.png)

1. Сохраните приложение логики.

   Если вам нужны дополнительные действия для этого приложения логики, например, чтобы декодировать содержимое сообщения и выводить содержимое в формате объекта JSON, продолжите сборку приложения логики.

Настройка приложения логики B2B завершена. В реальных приложениях может потребоваться сохранить декодированные данные X12 в бизнес-приложении или хранилище данных, в котором они хранятся. Например, см. следующие статьи:

* [Подключение к системам SAP из Azure Logic Apps](../logic-apps/logic-apps-using-sap-connector.md)
* [Мониторинг и создание SFTP-файлов, а также управление ими с помощью SSH и Azure Logic Apps](../connectors/connectors-sftp-ssh.md)

Чтобы подключить собственные бизнес-приложения и использовать эти API в приложении логики, можно добавить дополнительные действия или [написать пользовательские API](../logic-apps/logic-apps-create-api-app.md).

## <a name="next-steps"></a>Дальнейшие действия

* [Получение и реагирование на входящие вызовы HTTPS](../connectors/connectors-native-reqres.md)
* [Обмен сообщениями AS2 для интеграции B2B Enterprise](../logic-apps/logic-apps-enterprise-integration-as2.md)
* [Обмен сообщениями X12 для интеграции B2B Enterprise](../logic-apps/logic-apps-enterprise-integration-x12.md)
* Дополнительные сведения о [пакет интеграции Enterprise](../logic-apps/logic-apps-enterprise-integration-overview.md)
