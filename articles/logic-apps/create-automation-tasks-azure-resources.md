---
title: Создание задач автоматизации для мониторинга ресурсов Azure и управления ими
description: Настройте автоматизированные задачи, которые помогут управлять ресурсами Azure и отслеживать затраты путем создания рабочих процессов, выполняемых на Azure Logic Apps.
services: logic-apps
ms.suite: integration
ms.reviewer: deli, jonfan, logicappspm
ms.topic: conceptual
ms.date: 09/23/2020
ms.openlocfilehash: 1826b17a971b49fdfe8d5df02d71eb682b15db6f
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91269732"
---
# <a name="manage-azure-resources-and-monitor-costs-by-creating-automation-tasks-preview"></a>Управление ресурсами Azure и мониторинг затрат путем создания задач автоматизации (Предварительная версия)

> [!IMPORTANT]
> Эта возможность доступна в общедоступной предварительной версии. она предоставляется без соглашения об уровне обслуживания и не рекомендуется для рабочих нагрузок в рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Чтобы упростить управление [ресурсами Azure](../azure-resource-manager/management/overview.md#terminology) , можно создать автоматизированные задачи управления для определенного ресурса или группы ресурсов с помощью шаблонов задач автоматизации, которые в зависимости от типа ресурса будут иметь разную доступность. Например, для [учетной записи хранения Azure](../storage/common/storage-account-overview.md)можно настроить задачу автоматизации, которая будет отправлять вам ежемесячные затраты на эту учетную запись хранения. Для [виртуальной машины Azure](https://azure.microsoft.com/services/virtual-machines/)можно создать задачу автоматизации, которая включает или выключает эту виртуальную машину по стандартному расписанию.

В фоновом режиме задача автоматизации на самом деле является рабочим процессом, который выполняется в [Azure Logic Appsной](../logic-apps/logic-apps-overview.md) службе и оплачивается с использованием тех же [ценовых цен](https://azure.microsoft.com/pricing/details/logic-apps/) и [моделей ценообразования](../logic-apps/logic-apps-pricing.md). После создания задачи можно просмотреть и изменить базовый рабочий процесс, открыв задачу в конструкторе приложений логики. По завершении выполнения задачи по крайней мере одного запуска можно просматривать состояние, историю, входные и выходные данные для каждого запуска.

Ниже приведены доступные в настоящее время шаблоны задач в этой предварительной версии.

| Тип ресурса | Шаблоны задач автоматизации |
|---------------|---------------------------|
| Группы ресурсов Azure | **При удалении ресурса** |
| Все ресурсы Azure | **Отправка ежемесячных затрат на ресурс** |
| Виртуальные машины Azure | Дополнительно <p>- **Выключение виртуальной машины** <br>- **Запустить виртуальную машину** |
| Учетные записи хранения Azure | Дополнительно <p>- **Удалить старые большие двоичные объекты** |
| Azure Cosmos DB | Дополнительно, <p>- **Отправить результат запроса по электронной почте** |
|||

В этой статье показано, как выполнить следующие задачи.

* [Создание задачи автоматизации](#create-automation-task) для конкретного ресурса Azure.

* [Проверьте журнал задачи](#review-task-history), включающий состояние выполнения, входы, выходные данные и другие исторические данные.

* [Измените задачу](#edit-task) , чтобы можно было обновить задачу, или настройте базовый рабочий процесс задачи в конструкторе приложений логики.

<a name="differences"></a>

## <a name="how-do-automation-tasks-differ-from-azure-automation"></a>Чем отличаются задачи автоматизации от службы автоматизации Azure?

В настоящее время задачу автоматизации можно создать только на уровне ресурса, просмотреть историю выполнения задачи и изменить базовый рабочий процесс приложения логики, который работает на базе службы [Azure Logic Apps](../logic-apps/logic-apps-overview.md) . Задачи автоматизации являются более базовыми и упрощенными, чем служба [автоматизации Azure](../automation/automation-intro.md).

По сравнению, служба автоматизации Azure является облачной службой автоматизации и конфигурацией, которая поддерживает согласованное управление в средах Azure и не в Azure. Служба включает в себя [автоматизацию процессов для оркестрации процессов](../automation/automation-intro.md#process-automation) с помощью [модулей Runbook](../automation/automation-runbook-execution.md), управления конфигурацией с [отслеживанием изменений и инвентаризацией](../automation/change-tracking.md), управлением обновлениями, общими возможностями и разнородными функциями. Служба автоматизации обеспечивает полный контроль во время развертывания, использования и вывода из эксплуатации рабочих нагрузок и ресурсов.

## <a name="prerequisites"></a>Предварительные требования

* Учетная запись и подписка Azure. Если у вас нет ее, вы можете [зарегистрироваться для получения бесплатной учетной записи Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

* Ресурс Azure, которым вы хотите управлять. В этой статье в качестве примера используется учетная запись хранения Azure.

* Учетная запись Office 365, если вы хотите перейти к примеру, который отправляет сообщение электронной почты с помощью Office 365 Outlook.

<a name="create-automation-task"></a>

## <a name="create-an-automation-task"></a>Создание задачи автоматизации

1. В [портал Azure](https://portal.azure.com)найдите ресурс, которым требуется управлять.

1. В меню ресурсов прокрутите вниз до раздела **Автоматизация** и выберите **задачи** .

   ![Снимок экрана, на котором показаны портал Azure и меню ресурсов учетной записи хранения, в котором в разделе "Автоматизация" выбран пункт меню "задачи".](./media/create-automation-tasks-azure-resources/storage-account-menu-automation-section.png)

1. В области **задачи** выберите **Добавить** , чтобы можно было выбрать шаблон задачи.

   ![Снимок экрана: панель "задачи" для учетной записи хранения, в которой выбрана панель инструментов "Добавить"](./media/create-automation-tasks-azure-resources/add-automation-task.png)

1. В области **Добавить задачу** в разделе **Выбор шаблона**выберите шаблон для задачи, которую требуется создать, и нажмите кнопку **Далее: проверка подлинности**.

   Этот пример можно продолжить, выбрав шаблон задачи « **Отправка ежемесячных затрат для ресурса** ».

   ![Снимок экрана с выбранными параметрами: "Отправить ежемесячные затраты для ресурса" и "Далее: проверка подлинности"](./media/create-automation-tasks-azure-resources/select-task-template.png)

1. В разделе « **Проверка подлинности**» раздела **подключения** выберите **создать** для каждого подключения, чтобы предоставить учетные данные для проверки подлинности для этого подключения. Типы подключений в каждой задаче зависят от задачи.

   ![Снимок экрана, на котором показан выбранный параметр "создать" для подключения Azure Resource Manager](./media/create-automation-tasks-azure-resources/create-authenticate-connections.png)

1. При появлении запроса войдите с помощью учетных данных учетной записи Azure.

   ![Снимок экрана с выбранным параметром "вход"](./media/create-automation-tasks-azure-resources/create-connection-sign-in.png)

   Каждое успешное подключение с проверкой подлинности выглядит как в следующем примере:

   ![Снимок экрана, на котором показано успешное создание подключения](./media/create-automation-tasks-azure-resources/create-connection-success.png)

1. После проверки подлинности всех необходимых подключений нажмите кнопку **Далее: Конфигурация**.

1. В разделе **Конфигурация**укажите имя задачи и другие сведения, необходимые для задачи. Когда все будет готово, выберите **Создать**.

   > [!NOTE]
   > Имя задачи нельзя изменить после создания, поэтому следует принять во внимание имя, которое по-прежнему применяется при [изменении базового рабочего процесса](#edit-task-workflow). Изменения, вносимые в базовый рабочий процесс, применяются только к созданной задаче, а не к шаблону задачи.
   >
   > Например, если вы назначите имя задачи `Send monthly cost` , но затем измените базовый рабочий процесс, чтобы он выполнялся еженедельно, нельзя изменить имя задачи на `Send weekly cost` .

   Для задач, отправляющих уведомления по электронной почте, требуется адрес электронной почты.

   ![Снимок экрана, на котором показаны необходимые сведения для выбранной задачи](./media/create-automation-tasks-azure-resources/provide-task-information.png)

   Созданная задача, которая автоматически работает и выполняется, теперь отображается в списке **задачи автоматизации** .

   ![Снимок экрана, на котором показан список задач автоматизации](./media/create-automation-tasks-azure-resources/automation-tasks-list.png)

   > [!TIP]
   > Если задача не отображается немедленно, попробуйте обновить список задач или немного подождите, прежде чем выполнять обновление. На панели инструментов нажмите кнопку **Обновить**.

   После запуска выбранной задачи вы получите сообщение электронной почты, которое выглядит следующим образом:

   ![Снимок экрана, на котором показано уведомление по электронной почте, отправленное задачей](./media/create-automation-tasks-azure-resources/email-notification-received.png)

<a name="review-task-history"></a>

## <a name="review-task-history"></a>Проверка журнала задач

Чтобы просмотреть историю выполнений задачи вместе с их состояниями, входными данными, выходными данными и другими сведениями, выполните следующие действия.

1. В [портал Azure](https://portal.azure.com)найдите ресурс, в котором находится журнал задач, который необходимо просмотреть.

1. В меню ресурса в разделе **Параметры**выберите **задачи автоматизации**.

1. В списке Задачи найдите задачу, которую требуется просмотреть. В столбце **выполнения** этой задачи выберите **представление**.

   ![Снимок экрана, на котором показана задача и выбран параметр "View"](./media/create-automation-tasks-azure-resources/view-runs-for-task.png)

   На панели **журнал запусков** отображаются все запуски задачи вместе с их состояниями, временем начала, идентификаторами и длительностью выполнения.

   ![Снимок экрана, показывающий выполнение задачи, их состояние и другие сведения](./media/create-automation-tasks-azure-resources/view-runs-history.png)

   Возможные состояния для запуска:

   | Состояние | Описание |
   |--------|-------------|
   | **Клонения** | Задача была отменена во время выполнения. |
   | **Сбой** | Задача имеет по крайней мере одно действие, завершившееся сбоем, но последующие действия для его устранения не существовали. |
   | **Выполнение** | Задача выполняется в данный момент. |
   | **Успешно** | Все действия выполнены успешно. Задача по-прежнему может завершиться успешно в случае сбоя действия, но при этом существовало последующее действие для ее устранения. |
   | **Ожидание** | Запуск еще не начался и приостановлен, так как еще выполняется более ранний экземпляр задачи. |
   |||

   Дополнительные сведения см. в статье [Журнал выполнений проверки](../logic-apps/monitor-logic-apps.md#review-runs-history) .

1. Чтобы просмотреть состояния и другие сведения о каждом шаге выполнения, выберите этот запуск.

   Откроется панель **Запуск приложения логики** , в которой будет показан базовый рабочий процесс, который выполнялся.

   * Рабочий процесс всегда начинается с [*триггера*](../connectors/apis-list.md#triggers-actions). Для этой задачи рабочий процесс начинается с [триггера **повторения** ](../connectors/connectors-native-recurrence.md).

   * На каждом шаге отображается его состояние и длительность выполнения. Шаги, длительность которых составляет 0 секунд, заняли меньше 1 секунды для выполнения.

   ![Снимок экрана, показывающий каждый шаг в ходе выполнения, состояния и длительности выполнения](./media/create-automation-tasks-azure-resources/runs-history-details.png)

1. Чтобы проверить входные и выходные данные для каждого шага, выберите шаг, который разворачивается.

   В этом примере показаны входные данные для триггера повторения, не имеющего выходов, так как триггер указывает только время выполнения рабочего процесса и не предоставляет выходные данные для последующих действий для обработки.

   ![Снимок экрана, показывающий развернутый триггер и входные данные](./media/create-automation-tasks-azure-resources/view-trigger-inputs.png)

   Напротив, действие **Отправить электронное письмо** имеет входные данные из предыдущих действий в рабочем процессе и выходных данных.

   ![Снимок экрана, показывающий развернутое действие, входные и выходные данные](./media/create-automation-tasks-azure-resources/view-action-inputs-outputs.png)

Сведения о создании собственных автоматизированных рабочих процессов для интеграции приложений, данных, служб и систем помимо контекста задач автоматизации для ресурсов Azure см. в разделе [Краткое руководство. Создание первого рабочего процесса интеграции с помощью Azure Logic Apps-портал Azure](../logic-apps/quickstart-create-first-logic-app-workflow.md).

<a name="edit-task"></a>

## <a name="edit-the-task"></a>Изменение задачи

Для изменения задачи доступны следующие параметры.

* [Измените задачу "inline"](#edit-task-inline) , чтобы изменить свойства задачи, например сведения о подключении или сведения о конфигурации, например адрес электронной почты.

* [Измените базовый рабочий процесс задачи](#edit-task-workflow) в конструкторе приложений логики.

<a name="edit-task-inline"></a>

### <a name="edit-the-task-inline"></a>Изменить встроенную задачу

1. В [портал Azure](https://portal.azure.com)найдите ресурс, содержащий задачу, которую требуется обновить.

1. В меню ресурса в разделе **Автоматизация**выберите **задачи**.

1. В списке Задачи найдите задачу, которую требуется обновить. Откройте меню с многоточием (**...**) задачи и выберите **изменить в строке**.

   ![Снимок экрана, на котором показано открытое меню с многоточием и выбранный параметр "изменить в строке"](./media/create-automation-tasks-azure-resources/view-task-inline.png)

   По умолчанию на вкладке **Проверка подлинности** отображаются существующие соединения.

1. Чтобы добавить новые учетные данные для проверки подлинности или выбрать другие существующие учетные данные для подключения, откройте меню с многоточием (**...**) и выберите команду **Добавить новое подключение** или использовать другие учетные данные для проверки подлинности.

   ![Снимок экрана, на котором показана вкладка "Проверка подлинности", существующие соединения и меню "выбранное многоточие"](./media/create-automation-tasks-azure-resources/edit-connections.png)

1. Чтобы обновить другие свойства задачи, нажмите кнопку **Далее: Конфигурация**.

   Для задачи в этом примере единственным доступным для редактирования свойством является адрес электронной почты.

   ![Снимок экрана, на котором показана вкладка "Конфигурация"](./media/create-automation-tasks-azure-resources/edit-task-configuration.png)

1. Когда все будет готово, нажмите кнопку **Сохранить**.

<a name="edit-task-workflow"></a>

### <a name="edit-the-tasks-underlying-workflow"></a>Изменение базового рабочего процесса задачи

При изменении базового рабочего процесса для задачи автоматизации изменения влияют только на созданный экземпляр задачи, а не на шаблон, создающий задачу. После внесения и сохранения изменений имя, указанное для исходной задачи, может не точнее описать задачу, поэтому может потребоваться повторно создать задачу с другим именем.

> [!TIP]
> Рекомендуется клонировать базовый рабочий процесс, чтобы вместо него можно было редактировать скопированную версию. Таким образом, можно вносить и тестировать изменения в копии, в то время как исходная задача автоматизации будет работать и выполняться без риска нарушения или нарушения существующей функциональности. После завершения изменений и успешного выполнения новой версии можно отключить или удалить исходную задачу автоматизации и использовать клонированную версию для задачи автоматизации. Следующие шаги включают сведения о том, как клонировать рабочий процесс.

1. В [портал Azure](https://portal.azure.com)найдите ресурс, содержащий задачу, которую требуется обновить.

1. В меню ресурса в разделе **Автоматизация**выберите **задачи**.

1. В списке Задачи найдите задачу, которую требуется обновить. Откройте меню многоточия (**...**) задачи и выберите пункт **Открыть в Logic Apps**.

   ![Снимок экрана, на котором показано открытое меню с многоточием, и выбранный параметр "открыть в Logic Apps"](./media/create-automation-tasks-azure-resources/edit-task-logic-app-designer.png)

   Базовый рабочий процесс задачи открывается в службе Azure Logic Apps и отображает область **обзора** , в которой можно просмотреть тот же журнал запусков, который доступен для задачи.

   ![Снимок экрана, на котором отображается задача в Azure Logic Apps представлении с выбранной областью обзора](./media/create-automation-tasks-azure-resources/task-logic-apps-view.png)

1. Чтобы открыть базовый рабочий процесс в конструкторе приложений логики, в меню приложения логики выберите **Конструктор приложений**логики.

   ![Снимок экрана, на котором показан выбранный пункт меню "Конструктор приложений логики" и область конструктора с базовым рабочим процессом](./media/create-automation-tasks-azure-resources/view-task-workflow-logic-app-designer.png)

   Теперь можно изменить свойства триггера и действий рабочего процесса, а также изменить триггер и действия, определяющие сам рабочий процесс. Однако в качестве оптимальной методики выполните действия по клонированию рабочего процесса, чтобы можно было внести изменения в копию, пока исходный рабочий процесс продолжит работать и запуститься.

1. Чтобы клонировать рабочий процесс и изменить скопированную версию, выполните следующие действия.

   1. В меню Рабочий процесс приложения логики выберите **Обзор**.

   1. На панели инструментов панели обзора выберите **клонировать**.

   1. В области создание приложения логики в поле **имя**введите новое имя для скопированного рабочего процесса приложения логики.

      За исключением **состояния приложения логики**, другие свойства недоступны для редактирования. 
      
   1. В разделе **состояние приложения логики**выберите **отключено** , чтобы клонированный рабочий процесс не выполнялся во время внесения изменений. Вы можете включить рабочий процесс, когда будете готовы к тестированию изменений.

   1. После того как Azure завершит подготовку клонированного рабочего процесса, найдите и откройте этот рабочий процесс в конструкторе приложений логики.

1. Чтобы просмотреть свойства триггера или действия, разверните этот триггер или действие.

   Например, можно изменить триггер повторения так, чтобы он выполнялся еженедельно, а не ежемесячно.

   ![Снимок экрана с развернутым триггером повторения с списком частот, открытым для отображения доступных параметров частоты](./media/create-automation-tasks-azure-resources/edit-recurrence-trigger.png)

   Дополнительные сведения о триггере повторения см. [в разделе Создание, планирование и выполнение повторяющихся задач и рабочих процессов с помощью триггера повторения](../connectors/connectors-native-recurrence.md). Дополнительные сведения о других триггерах и действиях, которые можно использовать, см. в разделе [соединители для Azure Logic Apps](../connectors/apis-list.md).

1. Чтобы сохранить изменения, на панели инструментов конструктора нажмите кнопку **сохранить**.

   ![Снимок экрана, на котором показана панель инструментов конструктора и выбранная команда "Сохранить"](./media/create-automation-tasks-azure-resources/save-updated-workflow.png)

1. Чтобы проверить и запустить обновленный рабочий процесс, на панели инструментов конструктора выберите **выполнить**.

   После завершения выполнения конструктор отображает сведения о выполнении рабочего процесса.

   ![Снимок экрана, показывающий сведения о выполнении рабочего процесса в конструкторе](./media/create-automation-tasks-azure-resources/view-run-details-designer.png)

1. Чтобы отключить рабочий процесс, чтобы выполнение задачи не продолжалось, см. раздел [Управление приложениями логики в портал Azure](../logic-apps/manage-logic-apps-with-azure-portal.md).

## <a name="provide-feedback"></a>Предоставление отзыва

Мы хотели бы слышать вас! Чтобы сообщить об ошибках, отправить отзыв или задать вопросы о функции предварительной версии, [обратитесь к группе Azure Logic Apps](mailto:logicapps@microsoft.com).

## <a name="next-steps"></a>Дальнейшие шаги

* [Управление приложениями логики в портал Azure](../logic-apps/manage-logic-apps-with-azure-portal.md)
