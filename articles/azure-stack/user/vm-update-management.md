---
title: Обновление и администрирование виртуальной машины с помощью Azure Stack | Документация Майкрософт
description: Узнайте, как использовать решения "Управление обновлениями", "Отслеживание изменений" и инвентаризации в службе автоматизации Azure для управления виртуальными машинами Windows, развернутыми в Azure Stack.
services: azure-stack
documentationcenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/15/2018
ms.author: jeffgilb
ms.reviewer: rtiberiu
ms.openlocfilehash: 1ef20dc35b069c5f12c2f31d0979949be27271e0
ms.sourcegitcommit: 74941e0d60dbfd5ab44395e1867b2171c4944dbe
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/15/2018
ms.locfileid: "49323648"
---
# <a name="azure-stack-vm-update-and-management"></a>Обновление и администрирование виртуальной машины Azure Stack
Для управления виртуальными машинами Windows, развернутыми с помощью Azure Stack, можно использовать следующие функции решения службы автоматизации Azure.

- **[Управление обновлениями](https://docs.microsoft.com/azure/automation/automation-update-management)**. Благодаря решению "Управление обновлениями" можно быстро оценить состояние доступных обновлений на всех компьютерах агентов и управлять установкой необходимых обновлений для виртуальных машин Windows.

- **[Отслеживание изменений](https://docs.microsoft.com/azure/automation/automation-change-tracking)**. Данные об изменениях установленного ПО, служб, файлов и реестров Windows на наблюдаемых серверах отправляются в службу Log Analytics в облаке для обработки. К полученным данным применяется логика и облачная служба записывает данные. С помощью сведений на панели мониторинга «Отслеживание изменений» можно без труда обнаружить изменения, внесенные в инфраструктуру серверов.

- **[Инвентаризация](https://docs.microsoft.com/azure/automation/automation-vm-inventory)**. Отслеживание данных для виртуальной машины Azure Stack для Windows предоставляет пользовательский интерфейс на основе веб-браузера для установки и настройки сбора данных инвентаризации. 

> [!IMPORTANT]
> Эти решения идентичны тем, которые используются для управления виртуальными машинами Azure. Виртуальные машины как Azure, так и Windows в Azure Stack управляются одинаково с помощью одного и того же интерфейса и инструментов. При использовании решений "Управление обновлениями", "Отслеживание изменений" и инвентаризации в Azure Stack на виртуальные машины Azure Stack цена такая же, как и на виртуальные машины Azure.

## <a name="prerequisites"></a>Предварительные требования
Прежде чем использовать эти возможности обновления и управления виртуальными машинами Windows в Azure Stack, необходимо выполнить несколько предварительных условий. К ним относятся действия, которые необходимо выполнить на портале Azure, а также на портале администрирования Azure Stack.

### <a name="in-the-azure-portal"></a>На портале Azure
Чтобы использовать такие возможности автоматизации, как инвентаризация, Отслеживание изменений и Управление обновлениями для виртуальных машин Windows в Azure Stack, необходимо сначала включить эти решения в Azure.

> [!TIP]
> Если эти возможности уже включены для виртуальных машин Azure, можно использовать учетные данные существующей рабочей области LogAnalytics. Если уже существует идентификатор рабочей области и первичный ключ LogAnalytics, которые необходимо использовать, сразу перейдите к [следующему разделу](.\vm-update-management.md#in-the-azure-stack-administration-portal). В противном случае оставайтесь в этом разделе, чтобы создать новую рабочую область LogAnalytics и учетную запись службы автоматизации.

Первый шаг в обеспечении этих решений — [создание рабочей области LogAnalytics](https://docs.microsoft.com/azure/log-analytics/log-analytics-quick-create-workspace) в подписке Azure. Рабочая область Log Analytics — это уникальная среда Log Analytics со своим собственным репозиторием данных, источниками данных и решениями. После создания рабочей области запишите идентификатор рабочей области и ключ. Чтобы просмотреть эти сведения, перейдите к колонке "Рабочая область", щелкните **Дополнительные параметры** и просмотрите значения **Идентификатор рабочей области** и **Первичный ключ**. 

Затем нужно [создать учетную запись службы автоматизации](https://docs.microsoft.com/azure/automation/automation-create-standalone-account). Учетная запись автоматизации — это контейнер для ресурсов в службе автоматизации Azure. Он позволяет разделять среды и дополнительно упорядочивать рабочие процессы автоматизации и ресурсы. После создания учетной записи службы автоматизации необходимо включить возможности инвентаризации, отслеживания изменений и управления обновлениями. Для включения каждого из компонентов выполните следующие шаги.

1. На портале Azure перейдите к учетной записи службы автоматизации, которую нужно использовать.

2. Выберите решение, которое нужно включить (**Инвентаризация**, **Отслеживание изменений** или **Управление обновлениями**).

3. Используйте раскрывающийся список **Выберите рабочую область...**, чтобы выбрать для использования рабочую область Log Analytics.

4. Проверьте на правильность остальные сведения, а затем щелкните **Включить**, чтобы включить решение.

5. Повторите шаги 2–4, чтобы включить все три решения. 

   [![](media/vm-update-management/1-sm.PNG "Возможности включения учетной записи службы автоматизации")](media/vm-update-management/1-lg.PNG#lightbox)

### <a name="in-the-azure-stack-administration-portal"></a>На портале администрирования Azure Stack
После включения решений службы автоматизации на портале Azure необходимо войти на портал администрирования Azure Stack как администратор облака и загрузить элемент Marketplace расширения **Azure Update and Configuration Management** (Управление конфигурацией и обновлениями Azure) для Azure Stack. 

   ![Элемент Marketplace расширения Azure Update and Configuration Management (Управление конфигурацией и обновлениями Azure)](media/vm-update-management/2.PNG) 

## <a name="enable-update-management-for-azure-stack-virtual-machines"></a>Включение Управления обновлениями для виртуальных машин Azure Stack
Чтобы включить управление обновлениями для виртуальных машин Windows в Azure Stack, выполните следующие действия.

1. Войдите на пользовательский портал Azure Stack.

2. На пользовательском портале Azure Stack перейдите в колонку "Расширения" виртуальных машин Windows, для которых необходимо включить эти решения, щелкните **+ Добавить**, выберите расширение **Azure Update and Configuration Management** (Управление конфигурацией и обновлениями Azure) и щелкните **Создать**.

   [![](media/vm-update-management/3-sm.PNG "Колонка расширений виртуальной машины Windows")](media/vm-update-management/3-lg.PNG#lightbox)

3. Укажите созданный ранее идентификатор рабочей области и первичный ключ для связи агента с рабочей областью LogAnalytics и щелкните **ОК**, чтобы развернуть расширение.

   [![](media/vm-update-management/4-sm.PNG "Указание идентификатора рабочей области и ключа")](media/vm-update-management/4-lg.PNG#lightbox) 

4. Как описано в статье [Решение для управления обновлениями в Azure](https://docs.microsoft.com/azure/automation/automation-update-management), необходимо включить решение "Управление обновлениями" для каждой виртуальной машины, которой нужно управлять. Чтобы включить решение для всех виртуальных машин, которые отправляют отчеты в рабочую область, выберите **Управление обновлениями**, щелкните **Управление компьютерами**, а затем выберите параметр **Включить для всех доступных и будущих компьютеров**.

   [![](media/vm-update-management/5-sm.PNG "Указание идентификатора рабочей области и ключа")](media/vm-update-management/5-lg.PNG#lightbox) 

   > [!TIP]
   > Повторите этот шаг, чтобы включить каждое решение для виртуальных машин Windows в Azure Stack, отправляющих отчетные данные в эту рабочую область. 
  
После включения расширения Azure Update and Configuration Management (Управление конфигурацией и обновлениями Azure) проверка для каждой управляемой виртуальной машины Windows выполняется дважды в день. Каждые 15 минут вызывается API Windows, чтобы запросить время последнего обновления и определить, изменилось ли состояние. Если состояние изменилось, запускается проверка на соответствие.

После проверки виртуальные машины будут отображаться в учетной записи службы автоматизации Azure в решении "Управление обновлениями". 

   [![](media/vm-update-management/6-sm.PNG "Указание идентификатора рабочей области и ключа")](media/vm-update-management/6-lg.PNG#lightbox) 

> [!IMPORTANT]
> Отображение обновленных данных с управляемых компьютеров на панели мониторинга может занять от 30 минут до 6 часов.

Теперь виртуальные машины Windows в Azure Stack можно включить в запланированные развертывания обновлений вместе с виртуальными машинами Azure.

## <a name="enable-update-management-using-a-resource-manager-template"></a>Включение Управления обновлениями с помощью шаблона Resource Manager
При наличии большого количества виртуальных машин Windows в Azure Stack можно использовать [этот шаблон Azure Resource Manager](https://github.com/Azure/AzureStack-QuickStart-Templates/tree/master/MicrosoftMonitoringAgent-ext-win) для упрощения развертывания решения на виртуальных машинах Windows. Шаблон развертывает расширение Microsoft Monitoring Agent на существующей виртуальной машине Windows и добавляет его в существующую рабочую область LogAnalytics Azure.
 
## <a name="next-steps"></a>Дополнительная информация
[Оптимизация производительности SQL Server](azure-stack-sql-server-vm-considerations.md)
