---
title: Руководство. Развертывание приложения ASP.NET Core в Службе Azure Kubernetes с помощью Azure DevOps Projects
description: Azure DevOps Projects упрощает начало работы с Azure. С помощью DevOps Projects вы можете развернуть приложение ASP.NET Core в Службе Azure Kubernetes, выполнив несколько простых действий.
ms.author: mlearned
ms.manager: douge
ms.prod: devops
ms.technology: devops-cicd
ms.topic: tutorial
ms.date: 07/09/2018
author: mlearned
monikerRange: vsts
ms.openlocfilehash: 7980ea439cfd3eaefcaa308795836a909f980043
ms.sourcegitcommit: eba6841a8b8c3cb78c94afe703d4f83bf0dcab13
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/29/2018
ms.locfileid: "52620648"
---
# <a name="tutorial-deploy-aspnet-core-apps-to-azure-kubernetes-service-with-azure-devops-projects"></a>Руководство. Развертывание приложения ASP.NET Core в Службе Azure Kubernetes с помощью Azure DevOps Projects

Azure DevOps Projects — это упрощенный интерфейс, который позволяет добавить существующий код и репозиторий Git либо выбрать пример приложения, чтобы создать конвейер непрерывной интеграции (CI) и непрерывной поставки (CD) в Azure. 

DevOps Projects также позволяет:
* автоматически создавать ресурсы Azure, например Службу Azure Kubernetes (AKS);
* создавать и настраивать конвейер выпуска для CI/CD в Azure DevOps;
* создавать ресурс Azure Application Insights для мониторинга.
* позволяет выполнять мониторинг производительности рабочих нагрузок контейнера в кластере AKS с помощью [Azure Monitor для контейнеров](https://docs.microsoft.com/azure/azure-monitor/insights/container-insights-overview).

Изучив данный учебник, вы научитесь:

> [!div class="checklist"]
> * Использование DevOps Projects для развертывания приложения ASP.NET Core в AKS
> * настройка Azure DevOps и подписки Azure; 
> * Изучение кластера AKS
> * Просмотр конвейера CI
> * Просмотр конвейера CD
> * фиксация изменений в Git и их автоматическое развертывание в Azure;
> * Очистка ресурсов

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Вы можете получить бесплатную подписку с помощью [Visual Studio Dev Essentials](https://visualstudio.microsoft.com/dev-essentials/).

## <a name="use-devops-projects-to-deploy-an-aspnet-core-app-to-aks"></a>Использование DevOps Projects для развертывания приложения ASP.NET Core в AKS

DevOps Projects создает конвейер CI/CD в Azure Pipelines. Вы можете создать новую организацию Azure DevOps или использовать существующую. Проект Azure DevOps также создает ресурсы Azure, такие как кластер AKS, в нужной подписке Azure.

1. Войдите на [портале Azure](https://portal.azure.com).

1. В области слева выберите **Создать ресурс**.

1. В поле поиска введите **DevOps Projects**, а затем выберите **Создать**.

    ![Панель мониторинга DevOps Projects](_img/azure-devops-project-github/fullbrowser.png)

1. Выберите **.NET**, а затем **Далее**.

1. В поле **Выберите платформу приложений** выберите **ASP.NET Core**.

1. Выберите **Служба Kubernetes** и щелкните **Далее**. 

## <a name="configure-azure-devops-and-an-azure-subscription"></a>Настройка Azure DevOps и подписки Azure

1. Создайте новую организацию Azure DevOps или выберите существующую. 

1. Задайте имя проекта Azure DevOps. 

1. Выберите подписку Azure.

1. Чтобы просмотреть дополнительные параметры конфигурации Azure и определить количество узлов в кластере AKS, щелкните **Изменить**.  
    В этой области отображаются параметры для настройки типа и расположения служб Azure.
 
1. Выйдите из области конфигурации Azure и щелкните **Готово**.  
    Через несколько минут процесс будет завершен. В результате настраивается пример приложения ASP.NET Core в репозитории Git для вашей организации Azure DevOps, создается кластер AKS, выполняется конвейер CI/CD и приложение развертывается в Azure. 

    После завершения процесса на портале Azure отобразится панель мониторинга Azure DevOps Projects. К панели мониторинга DevOps Projects можно также перейти непосредственно из вкладки **Все ресурсы** на портале Azure. 

    Панель мониторинга позволяет просматривать репозиторий кода Azure DevOps, конвейер CI/CD и кластер AKS. В конвейере Azure DevOps можно настроить дополнительные параметры CI/CD. В области справа выберите **Обзор** для просмотра выполняющегося приложения.

## <a name="examine-the-aks-cluster"></a>Изучение кластера AKS

Служба DevOps Projects автоматически настраивает кластер AKS, который можно просмотреть и настроить. Чтобы просмотреть кластер AKS, выполните следующие действия:

1. Перейдите к панели мониторинга DevOps Projects.

1. В области справа выберите службу AKS.  
    Откроется область кластера AKS. Это представление позволяет выполнять различные действия, например отслеживать работоспособность контейнеров, выполнять поиск в журналах и открывать панель мониторинга Kubernetes.

1. В области справа щелкните **Просмотреть панель мониторинга Kubernetes**.  
    При необходимости выполните следующие действия, чтобы открыть панель мониторинга Kubernetes.

## <a name="examine-the-ci-pipeline"></a>Просмотр конвейера CI

DevOps Projects автоматически настраивает конвейер CI/CD в вашей организации Azure DevOps. Вы можете изучить и настроить конвейер. Для этого сделайте следующее:

1. Перейдите к панели мониторинга DevOps Projects.

1. В верхней части панели мониторинга DevOps Projects выберите **Конвейеры сборки**.  
    На вкладке браузера отобразится конвейер сборки нового проекта.

1. Выберите поле **Состояние** и щелкните значок многоточия (…).  
    В появившемся меню содержится несколько пунктов, таких как постановка новой сборки в очередь, приостановка сборки и изменение конвейера сборки.

1. Выберите **Изменить**

1. В этой области можно просмотреть различные задачи для конвейера сборки.  
    При сборке выполняются различные задачи, такие как получение исходного кода из репозитория Git, восстановление зависимостей и публикация результатов, используемых для развертывания.

1. Выберите имя конвейера сборки в верхней части соответствующей области.

1. Замените имя конвейера сборки более понятным для себя, выберите **Сохранить и поместить в очередь** и нажмите кнопку **Сохранить**.

1. Под именем конвейера сборки щелкните **Журнал**.  
    В этой области отображается журнал аудита последних изменений сборки. Azure DevOps отслеживает все изменения, внесенные в конвейер сборки, и позволяет сравнивать версии.

1. Выберите **Триггеры**.  
    DevOps Projects автоматически создает триггер CI, а каждая фиксация в репозитории запускает новую сборку. При необходимости выберите для процесса непрерывной интеграции включение или исключение ветвей.

1. Щелкните **Период удержания**.  
    В зависимости от сценария можно указать политики для хранения или удаления определенного количества сборок.

## <a name="examine-the-cd-release-pipeline"></a>Просмотр конвейера выпуска CD

DevOps Projects автоматически создает и настраивает необходимые шаги для выполнения развертывания из вашей организации Azure DevOps в подписку Azure. Эти шаги включают настройку подключения к службе Azure для аутентификации Azure DevOps в подписке Azure. Также автоматически создается конвейер выпуска, обеспечивающий непрерывное развертывание в Azure. Чтобы получить дополнительные сведения о конвейере выпуска, сделайте следующее:

1. Последовательно выберите **Сборка и выпуск** и **Выпуски**.  
    DevOps Projects создаст конвейер выпуска для управления развертываниями в Azure.

1. Щелкните многоточие (…) рядом с конвейером выпуска и выберите **Изменить**.  
    Конвейер выпуска содержит *конвейер*, в котором определен процесс выпуска.

1. В разделе **Артефакты** выберите **Удалить**.  
    Конвейер сборки, который вы изучали на предыдущих этапах, создаст выходные данные для артефакта. 

1. Справа от значка **Удалить** выберите **Триггер непрерывного развертывания**.  
    В этом конвейере выпуска активирован триггер непрерывного развертывания, выполняющий развертывание каждый раз, когда становится доступным новый артефакт сборки. При желании можно отключить триггер, чтобы выполнить развертывание вручную. 

1. В области справа выберите **Просмотреть выпуски**, чтобы отобразился журнал выпусков.

1. Щелкните многоточие (…) рядом с одним из выпусков и выберите **Открыть**.  
    Отобразится меню с несколькими элементами, такими как сводка выпуска, связанные рабочие элементы и тесты.

1. Щелкните **Фиксации**.  
    В этом представлении отображаются фиксации кода, связанные с текущим развертыванием. Сравните выпуски, чтобы просмотреть различия между развертываниями.

1. Выберите **Журналы**.  
    Журналы содержат полезную информацию о процессе развертывания. Их можно просматривать во время и после развертывания.

## <a name="commit-changes-to-azure-repos-and-automatically-deploy-them-to-azure"></a>Фиксация изменений в Azure Repos и их автоматическое развертывание в Azure 

 > [!NOTE]
 > В следующей процедуре выполняется проверка конвейера CI/CD путем внесения небольших изменений в текст.

Теперь вы готовы к совместной работе над приложением с использованием процесса CI/CD, который позволяет автоматически развернуть последние результаты работы на веб-сайте. При каждом изменении в репозитории Git запускается сборка в Azure DevOps и конвейер CD выполняет развертывание в Azure. Используйте описанную в этом разделе процедуру или другой метод, чтобы зафиксировать изменения в репозитории. Например, можно скопировать репозиторий Git в предпочитаемое вами средство или интегрированную среду разработки, а затем отправить изменения в этот репозиторий.

1. В меню Azure DevOps последовательно выберите **Код** > **Файлы** и перейдите к репозиторию.

1. Откройте каталог *Views\Home*, затем нажмите многоточие (...) рядом с файлом *Index.cshtml* и щелкните **Изменить**.

1. Внесите изменения в файл, например, измените определенный текст внутри одного из тегов div. 

1. В правом верхнем углу выберите **Зафиксировать**, после чего снова нажмите **Зафиксировать**, чтобы отправить изменения.  
    Через несколько секунд начнется процесс сборки в Azure DevOps, после чего будет выполнена операция выпуска для развертывания изменений. Вы можете отслеживать состояние сборки на панели мониторинга DevOps Projects или в браузере в своей организации Azure DevOps.

1. По завершения выпуска обновите приложение, чтобы проверить внесенные изменения.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы выполняете тестирование, можно очистить ресурсы, чтобы избежать дополнительных расходов. Ненужный кластер AKS и связанные с ним ресурсы, созданные в рамках этого руководства, можно удалить. Для этого воспользуйтесь функцией **Удалить** на панели мониторинга DevOps Projects.

> [!IMPORTANT]
> Следующая процедура безвозвратно удаляет ресурсы. Функция *Удалить* безвозвратно удаляет в Azure и в Azure DevOps данные, созданные в проекте DevOps Projects. Выполняйте эту процедуру только после того, как прочли предупреждение.

1. На портале Azure перейдите к панели мониторинга DevOps Projects.
2. В правом верхнем углу выберите **Удалить**. 
3. В окне предупреждения выберите **Да**, чтобы *удалить ресурсы без возможности восстановления*.

## <a name="next-steps"></a>Дополнительная информация

Вы можете по желанию изменить эти конвейеры сборки и выпуска в соответствии с потребностями вашей команды. Вы также можете использовать этот шаблон CI/CD в качестве шаблона для других конвейеров. Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * Использование DevOps Projects для развертывания приложения ASP.NET Core в AKS
> * настройка Azure DevOps и подписки Azure; 
> * Изучение кластера AKS
> * Просмотр конвейера CI
> * Просмотр конвейера CD
> * фиксация изменений в Git и их автоматическое развертывание в Azure;
> * Очистка ресурсов

См. дополнительные сведения об использовании панели мониторинга Kubernetes:

> [!div class="nextstepaction"]
> [Define your multi-stage continuous deployment (CD) process](https://docs.microsoft.com/en-us/azure/aks/kubernetes-dashboard) (Определение процесса многоэтапного непрерывного развертывания (CD))
