---
title: Руководство. Развертывание приложения ASP.NET в виртуальных машинах Azure с помощью Azure DevOps Projects
description: Служба DevOps Projects упрощает начало работы с Azure и позволяет развернуть приложение ASP.NET в виртуальных машинах Azure за несколько простых шагов.
ms.author: mlearned
ms.manager: douge
ms.prod: devops
ms.technology: devops-cicd
ms.topic: tutorial
ms.date: 07/09/2018
author: mlearned
monikerRange: vsts
ms.openlocfilehash: 05643f342d51d99645d3c9204d6e63adcf2a0a73
ms.sourcegitcommit: ebf2f2fab4441c3065559201faf8b0a81d575743
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2018
ms.locfileid: "52165702"
---
# <a name="tutorial-deploy-your-aspnet-app-to-azure-virtual-machines-by-using-azure-devops-projects"></a>Руководство. Развертывание приложения ASP.NET в виртуальных машинах Azure с помощью Azure DevOps Projects

Azure DevOps Projects — это упрощенный интерфейс, который позволяет добавить существующий код и репозиторий Git либо выбрать пример приложения, чтобы создать конвейер непрерывной интеграции (CI) и непрерывной поставки (CD) в Azure. 

DevOps Projects также позволяет:
* автоматически создавать ресурсы Azure, например виртуальные машины Azure;
* создавать и настраивать конвейеры выпуска в Azure DevOps, которые включают конвейеры сборки для CI;
* настраивать конвейер выпуска для непрерывного развертывания; 
* создавать ресурс Azure Application Insights для мониторинга.

Изучив данный учебник, вы научитесь:

> [!div class="checklist"]
> * использовать DevOps Projects для развертывания приложения ASP.NET;
> * настраивать Azure DevOps и подписку Azure; 
> * просматривать конвейер CI;
> * просматривать конвейер CD;
> * Фиксация изменений в Azure Repos и их автоматическое развертывание в Azure
> * настраивать мониторинг с помощью Azure Application Insights;
> * очищать ресурсы.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Вы можете получить бесплатную подписку с помощью [Visual Studio Dev Essentials](https://visualstudio.microsoft.com/dev-essentials/).

## <a name="use-devops-projects-to-deploy-your-aspnet-app"></a>Использование DevOps Projects для развертывания приложения ASP.NET

Служба DevOps Projects создает конвейер CI/CD в Azure Pipelines. Вы можете создать новую организацию Azure DevOps или использовать существующую. Служба DevOps Projects также создает ресурсы Azure, например виртуальные машины, в выбранной подписке Azure.

1. Войдите на [портале Azure](https://portal.azure.com).

1. В области слева выберите **Создать**.

1. В поле поиска введите **DevOps Projects**, а затем выберите **Создать**.

    ![Панель мониторинга DevOps Projects](_img/azure-devops-project-github/fullbrowser.png)

1. Выберите **.NET**, а затем **Далее**.

1. В поле **Выберите платформу приложений** щелкните **ASP.NET**, а затем выберите **Далее**.  
    Платформа приложений, выбранная ранее, определяет доступный тип целевого объекта развертывания службы Azure. 

1. Выберите виртуальную машину и щелкните **Далее**.

## <a name="configure-azure-devops-and-an-azure-subscription"></a>Настройка Azure DevOps и подписки Azure

1. Создайте новую организацию Azure DevOps или выберите существующую. 

1. Введите имя проекта Azure DevOps. 

1. Выберите службы подписки Azure.  
    Дополнительно можно щелкнуть **Изменить** и ввести дополнительные сведения о конфигурации, например расположение ресурсов Azure.
 
1. Введите имя виртуальной машины, имя пользователя и пароль для нового ресурса виртуальной машины Azure, затем щелкните **Готово**.  
    Через несколько минут виртуальная машина Azure будет готова. Пример приложения ASP.NET будет настроен в репозитории вашей организации Azure DevOps, затем будут выполнены операции сборки и выпуска, после чего приложение будет развернуто в созданной виртуальной машине Azure. 

    После завершения всех операций панель мониторинга DevOps Projects отобразится на портале Azure. К панели мониторинга также можно перейти непосредственно из представления **Все ресурсы** на портале Azure. 

    Панель мониторинга позволяет просматривать репозиторий кода Azure DevOps, конвейер CI/CD и приложение, запущенное в Azure.   

    ![Представление панели мониторинга](_img/azure-devops-project-vms/dashboardnopreview.png)

Служба DevOps Projects автоматически настраивает сборку CI и триггер выпуска, который развертывает изменения кода в вашем репозитории. Вы можете настроить дополнительные параметры в Azure DevOps. Для просмотра запущенного приложения щелкните **Обзор**.
    
## <a name="examine-the-ci-pipeline"></a>Просмотр конвейера CI
 
DevOps Projects автоматически настраивает конвейер CI/CD в Azure Pipelines. Вы можете изучить и настроить конвейер. Чтобы изучить конвейер сборки, выполните следующие действия:

1. В верхней части панели мониторинга DevOps Projects выберите **Конвейеры сборки**.  
    На вкладке браузера отобразится конвейер сборки нового проекта.

1. Выберите поле **Состояние** и щелкните значок многоточия (…).  
    В появившемся меню содержится несколько вариантов действий, таких как постановка в очередь новой сборки, приостановка сборки и изменение конвейера сборки.

1. Выберите **Изменить**

1. В этой области можно просмотреть различные задачи для конвейера сборки.  
    Конвейер сборки выполняет различные задачи, такие как получение исходного кода из репозитория Git, восстановление зависимостей и публикация результатов, используемых для развертывания.

1. Выберите имя конвейера сборки в верхней части соответствующей области.

1. Замените имя конвейера сборки более понятным для себя, выберите **Сохранить и поместить в очередь** и нажмите кнопку **Сохранить**.

1. Под именем конвейера сборки щелкните **Журнал**.  
    В этой области отображается журнал аудита последних изменений сборки. Azure DevOps отслеживает все изменения, внесенные в конвейер сборки, и позволяет сравнивать версии.

1. Выберите **Триггеры**.  
    DevOps Projects автоматически создает триггер CI, а каждая фиксация в репозитории запускает новую сборку. При необходимости выберите для процесса непрерывной интеграции включение или исключение ветвей.

1. Щелкните **Период удержания**.  
    В зависимости от сценария можно указать политики для хранения или удаления определенного количества сборок.

## <a name="examine-the-cd-pipeline"></a>Просмотр конвейера CD

DevOps Projects автоматически создает и настраивает необходимые шаги для выполнения развертывания из вашей организации Azure DevOps в подписку Azure. Эти шаги включают настройку подключения к службе Azure для аутентификации Azure DevOps в подписке Azure. Средства автоматизации также создают конвейер CD, который обеспечивает непрерывное развертывание в виртуальной машине Azure. Для получения дополнительных сведений о конвейере CD в Azure DevOps выполните следующие действия:

1. Выберите **Сборка и выпуск**, а затем щелкните **Выпуски**.  
    DevOps Projects создает конвейер выпуска для управления развертываниями в Azure.

1. Щелкните многоточие (…) рядом с конвейером выпуска и выберите **Изменить**.  
    Конвейер выпуска содержит *конвейер*, в котором определен процесс выпуска.

1. В разделе **Артефакты** выберите **Удалить**.  
    Конвейер сборки, который вы изучали на предыдущих этапах, создает выходные файлы, используемые в качестве артефакта. 

1. Рядом со значком **Удалить** выберите **Триггер непрерывного развертывания**.  
    В этом конвейере выпуска активирован триггер непрерывного развертывания, выполняющий развертывание каждый раз, когда становится доступным новый артефакт сборки. При желании можно отключить триггер, чтобы выполнить развертывание вручную. 

1. В области слева выберите **Задачи**, а затем выберите свою среду.  
    Задачи — это действия, которые выполняются в процессе развертывания. Эти действия объединены в этапы. Конвейер выпуска включает два этапа:
    * Первый этап содержит задачу развертывания для группы ресурсов Azure, которая выполняет две операции:
      * настраивает виртуальную машину для развертывания;
      * добавляет новую виртуальную машину в группу развертывания Azure DevOps. Группа развертывания виртуальных машин в Azure DevOps управляет логическими группами, объединяющими целевые компьютеры развертывания.
    * На втором этапе задача управления веб-приложением IIS создает веб-сайт IIS в виртуальной машине. Для развертывания сайта создана вторая задача развертывания веб-приложения IIS.

1. В области справа выберите **Просмотреть выпуски**, чтобы отобразить журнал выпусков.

1. Щелкните многоточие (…) рядом с конвейером выпуска и выберите **Открыть**.  
    Отобразится меню с несколькими элементами, такими как сводка выпуска, связанные рабочие элементы и тесты.

1. Щелкните **Фиксации**.  
    В этом представлении отображаются фиксации кода, связанные с этим развертыванием. Сравните выпуски, чтобы просмотреть различия между развертываниями.

1. Выберите **Журналы**.  
    Журналы содержат полезную информацию о процессе развертывания. Их можно просматривать во время и после развертывания.

## <a name="commit-changes-to-azure-repos-and-automatically-deploy-them-to-azure"></a>Фиксация изменений в Azure Repos и их автоматическое развертывание в Azure 

Теперь вы готовы к совместной работе над приложением, используя процесс CI/CD для автоматического развертывания последних результатов работы на своем веб-сайте. При каждом изменении в репозитории Git запускается сборка в Azure DevOps и конвейер CD выполняет развертывание в Azure. Используйте описанную в этом разделе процедуру или другой метод, чтобы зафиксировать изменения в репозитории. Изменения кода инициируют процесс CI/CD и автоматически развертывают ваши новые изменения на веб-сайте IIS на виртуальной машине Azure.

1. В области слева щелкните **Код** и откройте репозиторий.

1. Перейдите в каталог *Views\Home*, затем щелкните многоточие (…) рядом с файлом *Index.cshtml* и выберите **Изменить**.

1. Внесите изменения в файл, например, измените текст внутри одного из тегов div. 

1. В правом верхнем углу выберите **Зафиксировать**, после чего снова нажмите **Зафиксировать**, чтобы отправить изменения.  
    Через несколько секунд начнется процесс сборки в Azure DevOps, после чего будет выполнена операция выпуска для развертывания изменений. Вы можете отслеживать состояние сборки на панели мониторинга DevOps Projects или в браузере в своей организации Azure DevOps.

1. После завершения операции выпуска обновите приложение, чтобы проверить изменения.

## <a name="configure-azure-application-insights-monitoring"></a>Настройка мониторинга Azure Application Insights

С помощью Azure Application Insights можно легко отслеживать производительность и использование своего приложения. Azure DevOps Projects автоматически настраивает ресурс Application Insights для вашего приложения. Вы можете дополнительно настроить различные предупреждения и возможности мониторинга по мере необходимости.

1. На портале Azure перейдите к панели мониторинга DevOps Projects. 

1. В правом нижнем углу щелкните ссылку **Application Insights** для вашего приложения.  
    Откроется панель **Application Insights**. Это представление содержит информацию об использовании, производительности и доступности приложения.

    ![Панель Application Insights](_img/azure-devops-project-github/appinsights.png) 

1. Щелкните **Диапазон времени**, а затем выберите **За последний час**. Щелкните **Обновить**, чтобы отфильтровать результаты.  
    Теперь вы можете просмотреть все действия за последние 60 минут. 
    
1. Чтобы закрыть представление временного диапазона, щелкните **x**.

1. Выберите **Оповещения** и щелкните **Добавить оповещение метрики**. 

1. Введите имя оповещения.

1. В раскрывающемся списке **Метрика** просмотрите различные оповещения метрик.  
    По умолчанию оповещение отображается, если **время отклика сервера превышает 1 секунду**. Различные оповещения можно легко настроить, чтобы улучшить возможности мониторинга приложения.

1. Установите флажок **Notify via Email owners, contributors, and readers** (Уведомлять по электронной почте владельцев, участников и читателей).  
    При желании вы можете выполнять дополнительные действия, когда срабатывает оповещение, реализовав приложение логики в Azure.

1. Нажмите кнопку **ОК**, чтобы создать оповещение.  
    Через несколько секунд предупреждение появится на панели мониторинга как активное. 

1. Выйдите из области **оповещений** и вернитесь на панель **Application Insights**.

1. Выберите **Доступность**, а затем щелкните **Добавить тест**. 

1. Введите имя теста и нажмите кнопку **Создать**.  
    Создается простой тест проверки связи для проверки доступности вашего приложения. Через несколько минут результаты тестирования будут доступны, а на панели мониторинга Application Insights отобразится состояние доступности.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы выполняете тестирование, можно очистить ресурсы, чтобы избежать дополнительных расходов. Ненужную виртуальную машину Azure и связанные ресурсы, созданные в рамках этого руководства, можно удалить. Для этого воспользуйтесь функцией **Удалить** на панели мониторинга DevOps Projects. 

> [!IMPORTANT]
> Следующая процедура безвозвратно удаляет ресурсы. Функция *Удалить* безвозвратно удаляет в Azure и в Azure DevOps данные, созданные в проекте DevOps Projects. Выполняйте эту процедуру только после того, как прочли предупреждение.

1. На портале Azure перейдите к панели мониторинга DevOps Projects.
1. В правом верхнем углу выберите **Удалить**. 
1. В окне предупреждения выберите **Да**, чтобы *безвозвратно удалить* ресурсы.

Вы можете по желанию изменить эти конвейеры сборки и выпуска в соответствии с потребностями вашей команды. Вы также можете использовать этот шаблон CI/CD в качестве шаблона для других конвейеров. 

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * использовать DevOps Projects для развертывания приложения ASP.NET;
> * настраивать Azure DevOps и подписку Azure; 
> * просматривать конвейер CI;
> * просматривать конвейер CD;
> * Фиксация изменений в Azure Repos и их автоматическое развертывание в Azure
> * настраивать мониторинг с помощью Azure Application Insights;
> * очищать ресурсы.

Дополнительные сведения о конвейере CI/CD

> [!div class="nextstepaction"]
> [Define your multi-stage continuous deployment (CD) pipeline](https://docs.microsoft.com/azure/devops/pipelines/release/define-multistage-release-process?view=vsts) (Настройка многоэтапного конвейера для непрерывного развертывания)
