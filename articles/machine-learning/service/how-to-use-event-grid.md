---
title: Создание рабочих процессов машинного обучения на основе событий
titleSuffix: Azure Machine Learning
description: Узнайте, как использовать сетку событий с Машинное обучение Azure для включения решений, управляемых событиями.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.author: shipatel
author: shivp950
ms.reviewer: larryfr
ms.date: 11/04/2019
ms.openlocfilehash: b10b848918fda7a1f271a4e617b1706971f103d7
ms.sourcegitcommit: 6c2c97445f5d44c5b5974a5beb51a8733b0c2be7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2019
ms.locfileid: "73622224"
---
# <a name="create-event-driven-machine-learning-workflows-preview"></a>Создание рабочих процессов машинного обучения на основе событий (Предварительная версия)

Служба " [Сетка событий Azure](https://docs.microsoft.com/azure/event-grid/) " поддерживает события машинное обучение Azure службы. Например, можно использовать события завершения выполнения, регистрации модели, развертывания модели и обнаружения отклонения данных в рабочей области.

Дополнительные сведения см. в статье [интеграция машинное обучение Azure с помощью сетки событий](concept-event-grid-integration.md) и [машинное обучение Azure схемы сетки событий](/azure/event-grid/event-schema-machine-learning).

Используйте сетку событий, чтобы включить такие распространенные сценарии, как:

* Активация конвейеров для повторного обучения
* Потоковая передача событий из Машинное обучение Azure в различные конечные точки

## <a name="prerequisites"></a>Предварительные требования

* Участник или владелец доступ к рабочей области службы "машинное обучение Azure", для которой создаются события.
* Выберите конечную точку обработчика событий, например веб-перехватчик или концентратор событий. Дополнительные сведения см. в разделе [обработчики событий](https://docs.microsoft.com/azure/event-grid/event-handlers). 

## <a name="register-resource-providers"></a>Регистрация поставщиков ресурсов

Если вы использовали службу "Сетка событий Azure" или Машинное обучение до 1 2019 ноября, может потребоваться повторная регистрация поставщиков ресурсов, чтобы выполнить действия, описанные в этом документе. Чтобы повторно зарегистрировать поставщики, выполните следующие действия.

1. Перейдите в портал Azure и выберите __подписки__. Выберите подписку, с которой вы хотите работать.
1. Выберите __поставщики ресурсов__и выполните поиск по запросу __EventGrid__.
1. Выберите запись __Microsoft. EventGrid__ и нажмите кнопку __Повторная регистрация__.

    ![Повторная регистрация-поставщик ресурсов](media/how-to-use-event-grid/re-register-resource-provider.png)

1. Выполните поиск по запросу __мачинелеарнингсервицес__, выберите запись и нажмите кнопку __Повторная регистрация__.

> [!TIP]
> Если у вас нет разрешений на выполнение этих действий, попросите администратора подписки выполнить их.

## <a name="configure-machine-learning-events-using-the-azure-portal"></a>Настройка событий машинного обучения с помощью портал Azure

1. Откройте [портал Azure](https://portal.azure.com) и перейдите в рабочую область машинное обучение Azure.

1. На панели слева выберите __события__ и щелкните **подписки на события**. 

    ![Селект-евентс-ин-воркспаце. png](media/how-to-use-event-grid/select-event.png)

1. Выберите тип события для использования. Например, на следующем снимке экрана выбрана __Зарегистрированная модель__, __Развернутая модель__, __выполненная работа__и __обнаружено смещение набора данных__:

    ![Тип добавления события](media/how-to-use-event-grid/add-event-type.png)

1. Выберите конечную точку, в которую будет опубликовано событие. На следующем снимке экрана __концентратор событий__ является выбранной конечной точкой:

    ![выбор обработчика событий](media/how-to-use-event-grid/select-event-handler.png)

После подтверждения выбора нажмите кнопку __создать__. После настройки эти события будут отправлены в конечную точку.

## <a name="set-up-azure-event-grid-using-cli"></a>Настройка службы "Сетка событий Azure" с помощью интерфейса командной строки

Можно либо установить последнюю [Azure CLI](https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest), либо использовать Azure Cloud Shell, предоставляемый в рамках подписки Azure.

Чтобы установить расширение сетки событий, используйте следующую команду в CLI:

```azurecli-interactive
az add extension --name eventgrid
```

В следующем примере показано, как выбрать подписку Azure, а затем создать новую подписку на события для Машинное обучение Azure:

```azurecli-interactive
# Select the Azure subscription that contains the workspace
az account set --subscription "<name or ID of the subscription>"

# Subscribe to the machine learning workspace.
az eventgrid event-subscription create \
  --name {eventGridFilterName} \
  --source-resource-id "/subscriptions/{subId}/resourceGroups/{rgName}/ \providers/Microsoft.MachineLearningServices/workspaces/{wsName}" \
  --endpoint {event handler endpoint} \
  --included-event-types Microsoft.MachineLearningServices.ModelRegistered \
  --subject-begins-with "models/mymodelname"
```

## <a name="sample-scenarios"></a>Примеры сценариев

### <a name="use-a-logic-app-to-send-email-alerts"></a>Использование приложения логики для отправки оповещений по электронной почте

Используйте [Azure Logic Apps](https://docs.microsoft.com/azure/logic-apps/) , чтобы настроить сообщения электронной почты для всех событий. Настройте с условиями и укажите получателей, чтобы обеспечить совместную работу и осведомленность в разных командах.

1. В портал Azure перейдите в рабочую область Машинное обучение Azure и выберите вкладку события на панели слева. Здесь выберите __Logic Apps (приложения логики__). 

    ![SELECT-Logic-AP](media/how-to-use-event-grid/select-logic-ap.png)

1. Войдите в пользовательский интерфейс приложения логики и выберите Машинное обучение служба в качестве типа раздела. 

    ![SELECT-Topic-Type](media/how-to-use-event-grid/select-topic-type.png)

1. Выберите события для уведомления. Например, на следующем снимке экрана __рункомплетед__.

    ![SELECT-Event-рункомплете](media/how-to-use-event-grid/select-event-runcomplete.png)

1. Можно также добавить фильтры, чтобы активировать приложение логики только для подмножества типов событий. На следующем снимке экрана используется __Фильтр префикса__ __/датадрифтид/рунс/__ .

    ![Filter — события](media/how-to-use-event-grid/filtering-events.png)

1. Затем добавьте шаг для использования этого события и выполните поиск по электронной почте. Существует несколько разных учетных записей почты, которые можно использовать для получения событий. Также можно настроить условия отправки оповещений по электронной почте.

    ![SELECT-email — действие](media/how-to-use-event-grid/select-email-action.png)

1. Выберите __Отправить сообщение электронной почты__ и заполните параметры. В теме можно включить __Тип события__ и __раздел__ , помогающие отфильтровать события. Также можно включить ссылку на страницу рабочей области для выполнения в тексте сообщения. 

    ![Настройка — текст сообщения](media/how-to-use-event-grid/configure-email-body.png)

1. Чтобы сохранить это действие, выберите **Сохранить как** в левом углу страницы. На появившейся правой панели Подтвердите создание этого действия.

    ![подтверждение-Logic-App-CREATE](media/how-to-use-event-grid/confirm-logic-app-create.png)


### <a name="use-a-logic-app-to-trigger-retraining-workflows-when-data-drift-occurs"></a>Использование приложения логики для запуска рабочих процессов переобучения при возникновении смещения данных

Модели со временем устаревают и не остаются полезными в контексте, в котором они выполняются. Одним из способов определить, стоит ли переучить модель, является обнаружение смещения данных. 

В этом примере показано, как использовать службу "Сетка событий" с приложением логики Azure для запуска повторного обучения. В примере конвейер фабрики данных Azure активируется, когда происходит смещение данных между обучением модели и обслуживанием наборов данных.

Перед началом работы выполните следующие действия.

* Настройка монитора набора данных для [обнаружения смещения данных]( https://aka.ms/datadrift) в рабочей области
* Создайте опубликованный [конвейер фабрики данных Azure](https://docs.microsoft.com/azure/data-factory/).

В этом примере простой конвейер фабрики данных используется для копирования файлов в хранилище больших двоичных объектов и запуска опубликованного конвейера Машинное обучение. Дополнительные сведения об этом сценарии см. в [статье настройка машинное обучение шага в фабрике данных Azure](https://docs.microsoft.com/azure/data-factory/transform-data-machine-learning-service) .

![ADF-млпипелине-Stage](media/how-to-use-event-grid/adf-mlpipeline-stage.png)

1. Начните с создания приложения логики. Перейдите в [портал Azure](https://portal.azure.com), выполните поиск по запросу Logic Apps и выберите Создать.

    ![Поиск — Logic-App](media/how-to-use-event-grid/search-for-logic-app.png)

1. Введите запрошенные сведения. Чтобы упростить работу, используйте ту же подписку и группу ресурсов, что и конвейер фабрики данных Azure, и Машинное обучение Azure рабочую область.

    ![Настройка-Logic-App-for-ADF](media/how-to-use-event-grid/set-up-logic-app-for-adf.png)

1. После создания приложения логики выберите __при возникновении события ресурса сетки событий__. 

    ![Выбор-событие-сетка-триггер](media/how-to-use-event-grid/select-event-grid-trigger.png)

1. Войдите в систему и укажите сведения о событии. В качестве __имени ресурса__ укажите имя рабочей области. Задайте для __типа события__ значение __датасетдрифтдетектед__.

    ![имя входа и Добавление события](media/how-to-use-event-grid/login-and-add-event.png)

1. Добавьте новый шаг и выполните поиск по запросу __фабрики данных Azure__. Выберите __создать запуск конвейера__. 

    ![Create-адфпипелине — запуск](media/how-to-use-event-grid/create-adfpipeline-run.png)

1. Войдите в систему и укажите опубликованный конвейер фабрики данных Azure для запуска.

    ![Укажите-ADF-конвейер](media/how-to-use-event-grid/specify-adf-pipeline.png)

1. Сохраните и создайте приложение логики с помощью кнопки **сохранить** в верхнем левом углу страницы. Чтобы просмотреть приложение, перейдите к рабочей области в [портал Azure](https://portal.azure.com) и щелкните **события**.

    ![Отображение логики приложения в веб-перехватчике](media/how-to-use-event-grid/show-logic-app-webhook.png)

Теперь конвейер фабрики данных активируется при отсмещении. Просмотрите сведения о выполнении смещения данных и конвейера машинного обучения на [новом портале рабочей области](https://ml.azure.com). 

![представление — в рабочей области](media/how-to-use-event-grid/view-in-workspace.png)


### <a name="use-azure-functions-to-deploy-a-model-based-on-tags"></a>Развертывание модели на основе тегов с помощью функций Azure

Объект модели Машинное обучение Azure содержит параметры, на которых можно выполнить сведение развертываний, таких как имя модели, версия, тег и свойство. Событие регистрации модели может активировать конечную точку, и вы можете использовать функцию Azure для развертывания модели на основе значений этих параметров.

Пример см. в репозитории [https://github.com/Azure-Samples/MachineLearningSamples-NoCodeDeploymentTriggeredByEventGrid](https://github.com/Azure-Samples/MachineLearningSamples-NoCodeDeploymentTriggeredByEventGrid) и выполните действия, описанные в файле **сведений** .

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о доступных событиях см. в описании [схемы событий машинное обучение Azure](/azure/event-grid/event-schema-machine-learning) .