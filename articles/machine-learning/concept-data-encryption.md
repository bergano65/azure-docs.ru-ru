---
title: Шифрование данных с помощью машинного обучения Azure
titleSuffix: Azure Machine Learning
description: Узнайте, как Машинное обучение Azureные вычислений и хранилища данных обеспечивают шифрование данных при хранении и передаче.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.author: jhirono
author: jhirono
ms.reviewer: larryfr
ms.date: 11/09/2020
ms.openlocfilehash: a133cdb72e304a254305833b9ae6e8a7ebe30ab3
ms.sourcegitcommit: 6ab718e1be2767db2605eeebe974ee9e2c07022b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2020
ms.locfileid: "94540014"
---
# <a name="data-encryption-with-azure-machine-learning"></a>Шифрование данных с помощью Машинное обучение Azure

При обучении моделей и выполнении вывода в Машинное обучение Azure используются разнообразные службы хранилища данных Azure и ресурсы для вычислений. Каждый из них имеет собственное описание того, как они обеспечивают шифрование неактивных и транзитных данных. В этой статье вы узнаете о каждой из них, которая лучше подходит для вашего сценария.

> [!IMPORTANT]
> Для шифрования производственного уровня во время __обучения__ Майкрософт рекомендует использовать кластер машинное обучение Azure COMPUTE. Для шифрования производственного уровня во время __вывода__ Корпорация Майкрософт рекомендует использовать службу Kubernetes Azure.
>
> Машинное обучение Azure вычислительным экземпляром является среда разработки и тестирования. При его использовании рекомендуется хранить файлы, такие как записные книжки и сценарии, в общей папке. Данные должны храниться в хранилище данных.

## <a name="encryption-at-rest"></a>Шифрование при хранении

> [!IMPORTANT]
> Если рабочая область будет содержать конфиденциальные данные, рекомендуем при ее создании установить [флаг hbi_workspace](/python/api/azureml-core/azureml.core.workspace%28class%29?preserve-view=true&view=azure-ml-py#&preserve-view=truecreate-name--auth-none--subscription-id-none--resource-group-none--location-none--create-resource-group-true--sku--basic---friendly-name-none--storage-account-none--key-vault-none--app-insights-none--container-registry-none--cmk-keyvault-none--resource-cmk-uri-none--hbi-workspace-false--default-cpu-compute-target-none--default-gpu-compute-target-none--exist-ok-false--show-output-true-). `hbi_workspace`Флаг можно задать только при создании рабочей области. Его нельзя изменить для существующей рабочей области.

Этот `hbi_workspace` флаг управляет объемом [данных, собираемых корпорацией Майкрософт в целях диагностики](#microsoft-collected-data) , и обеспечивает [дополнительное шифрование в средах, управляемых корпорацией Майкрософт](../security/fundamentals/encryption-atrest.md). Кроме того, он включает следующие действия:

* Запускает шифрование локального рабочего диска в кластере Машинное обучение Azure COMPUTE, если вы не создали предыдущие кластеры в этой подписке. В противном случае необходимо создать запрос в службу поддержки, чтобы включить шифрование временных дисков для вычислительных кластеров. 
* Очищает локальный временный диск между запусками.
* Безопасно передает учетные данные для учетной записи хранения, реестра контейнеров и учетной записи SSH из уровня выполнения в вычислительные кластеры с помощью хранилища ключей.
* Включает IP-фильтрацию для того, чтобы базовые пулы пакетов невозможно было вызывать из внешних служб, отличных от AzureMachineLearningService.
* Обратите внимание, что в рабочей области HBI не поддерживаются экземпляры вычислений.

### <a name="azure-blob-storage"></a>Хранилище BLOB-объектов Azure

Машинное обучение Azure сохраняет моментальные снимки, выходные данные и журналы в учетной записи хранилища BLOB-объектов Azure, привязанной к рабочей области Машинного обучения Azure и вашей подписке. Все хранимые данные в хранилище BLOB-объектов Azure шифруются при хранении с помощью ключей под управлением корпорации Майкрософт.

Сведения о том, как использовать собственные ключи для хранимых данных в хранилище BLOB-объектов Azure, см. в статье [Настройка управляемых клиентом ключей с помощью Azure Key Vault на портале Azure](../storage/common/customer-managed-keys-configure-key-vault.md).

Данные для обучения, как правило, также хранятся в хранилище BLOB-объектов Azure, чтобы они были доступны для обучения целевых объектов вычислений. Это хранилище не управляется Машинным обучением Azure, а подключено к целевым объектам вычислений в качестве удаленной файловой системы.

__Сменить или отменить__ ключ можно в любое время. После смены ключа учетная запись хранения начнет использовать новый ключ (последняя версия) для шифрования неактивных данных. При отмене (отключении) ключа учетная запись обрабатывает неудачные запросы. Для вступления в силу операции смены или отмены обычно требуется час.

Дополнительные сведения см. в статье [Повторное создание ключей доступа к хранилищу](how-to-change-storage-access-key.md).

### <a name="azure-cosmos-db"></a>Azure Cosmos DB

Машинное обучение Azure сохраняет метаданные в экземпляре Azure Cosmos DB. Этот экземпляр связан с подпиской Майкрософт, управляемой Машинным обучением Azure. Все хранимые данные в Azure Cosmos DB шифруются при хранении с помощью ключей под управлением корпорации Майкрософт.

Чтобы использовать собственные ключи (управляемые пользователем) для шифрования экземпляра Azure Cosmos DB, можно создать выделенный экземпляр Cosmos DB для использования с рабочей областью. Рекомендуем использовать этот подход, если вы хотите хранить данные, например данные журнала выполнения, за пределами мультитенантного экземпляра Cosmos DB, размещенного в подписке Майкрософт. 

Чтобы включить подготовку экземпляра Cosmos DB в подписке с помощью управляемых клиентом ключей, выполните следующие действия.

* Зарегистрируйте поставщики ресурсов Microsoft. MachineLearning и Microsoft.DocУментдб в подписке, если это еще не сделано.

* При создании рабочей области Машинного обучения Azure используйте следующие параметры. Оба параметра являются обязательными и поддерживаются в пакетах SDK, CLI, интерфейсах API и шаблонах Resource Manager.

    * `resource_cmk_uri`: Этот параметр является полным универсальным кодом ресурса (URI) для ключа, управляемого клиентом, в хранилище ключей, включая [сведения о версии для ключа](../key-vault/general/about-keys-secrets-certificates.md#objects-identifiers-and-versioning). 

    * `cmk_keyvault`: Этот параметр является ИД ресурса хранилища ключей в подписке. Это хранилище ключей должно находиться в одном регионе с подпиской, которая будет использоваться для рабочей области Машинного обучения Azure. 
    
        > [!NOTE]
        > Этот экземпляр хранилища ключей может отличаться от хранилища ключей, созданного Машинным обучением Azure при подготовке к работе рабочей области. Если вы хотите использовать один и тот же экземпляр хранилища ключей для рабочей области, передайте это же хранилище ключей при подготовке рабочей области с помощью [параметра key_vault](/python/api/azureml-core/azureml.core.workspace%28class%29?preserve-view=true&view=azure-ml-py#&preserve-view=truecreate-name--auth-none--subscription-id-none--resource-group-none--location-none--create-resource-group-true--sku--basic---friendly-name-none--storage-account-none--key-vault-none--app-insights-none--container-registry-none--cmk-keyvault-none--resource-cmk-uri-none--hbi-workspace-false--default-cpu-compute-target-none--default-gpu-compute-target-none--exist-ok-false--show-output-true-). 

[!INCLUDE [machine-learning-customer-managed-keys.md](../../includes/machine-learning-customer-managed-keys.md)]

__Сменить или отменить__ ключ можно в любое время. После смены ключа Cosmos DB начнет использовать новый ключ (последняя версия) для шифрования неактивных данных. При отмене (отключении) ключа Cosmos DB обрабатывает неудачные запросы. Для вступления в силу операции смены или отмены обычно требуется час.

Дополнительные сведения см. в статье [Настройка управляемых клиентом ключей для учетной записи Azure Cosmos с помощью Azure Key Vault](../cosmos-db/how-to-setup-cmk.md).

### <a name="azure-container-registry"></a>Реестр контейнеров Azure

Все образы контейнеров в реестре (Реестр контейнеров Azure) шифруются при хранении. Azure автоматически шифрует образ перед сохранением и расшифровывает его при извлечении Машинным обучением Azure.

Чтобы использовать собственные ключи (управляемые пользователем) для шифрования Реестра контейнеров Azure, необходимо создать собственную запись контроля доступа и подключить ее при подготовке рабочей области или шифровать экземпляр по умолчанию, который создается во время подготовки рабочей области.

> [!IMPORTANT]
> Для Машинное обучение Azure требуется включить учетную запись администратора в реестре контейнеров Azure. По умолчанию этот параметр отключен при создании реестра контейнеров. Сведения о включении учетной записи администратора см. в разделе [учетная запись администратора](../container-registry/container-registry-authentication.md#admin-account).
>
> После создания реестра контейнеров Azure для рабочей области не удаляйте его. В противном случае будет нарушена функциональность рабочей области машинного обучения Azure.

Пример создания рабочей области с помощью существующего Реестра контейнеров Azure см. в следующих статьях:

* [Создание рабочей области для Машинного обучения Azure с помощью Azure CLI](how-to-manage-workspace-cli.md).
* [Создание рабочей области с помощью пакета SDK для Python](how-to-manage-workspace.md?tabs=python#create-a-workspace).
* [Создание рабочей области для Машинного обучения Azure с помощью шаблона Azure Resource Manager](how-to-create-workspace-template.md).

### <a name="azure-container-instance"></a>Экземпляр контейнера Azure

Развернутый ресурс экземпляра контейнера Azure (ACI) можно зашифровать с помощью управляемых клиентом ключей. Управляемый клиентом ключ, используемый для ACI, может храниться в Azure Key Vault вашей рабочей области. Сведения о создании ключа см. в разделе [Создание ключа](../container-instances/container-instances-encrypt-data.md#generate-a-new-key).

Чтобы использовать ключ при развертывании модели в экземпляре контейнера Azure, создайте конфигурацию развертывания с помощью `AciWebservice.deploy_configuration()`. Укажите основные сведения, используя следующие параметры:

* `cmk_vault_base_url`: URL-адрес хранилища ключей, содержащего ключ.
* `cmk_key_name`: Имя ключа.
* `cmk_key_version`: версия ключа.

Дополнительные сведения о создании и использовании конфигурации развертывания см. в следующих статьях:

* Справочник по [AciWebservice.deploy_configuration()](/python/api/azureml-core/azureml.core.webservice.aci.aciwebservice?preserve-view=true&view=azure-ml-py#&preserve-view=truedeploy-configuration-cpu-cores-none--memory-gb-none--tags-none--properties-none--description-none--location-none--auth-enabled-none--ssl-enabled-none--enable-app-insights-none--ssl-cert-pem-file-none--ssl-key-pem-file-none--ssl-cname-none--dns-name-label-none--primary-key-none--secondary-key-none--collect-model-data-none--cmk-vault-base-url-none--cmk-key-name-none--cmk-key-version-none-)
* [Где и как развернуть службы](how-to-deploy-and-where.md)
* [Развертывание веб-служб в Экземплярах контейнеров Azure](how-to-deploy-azure-container-instance.md).

Дополнительные сведения см. в разделе [Шифрование данных с помощью управляемого клиентом ключа](../container-instances/container-instances-encrypt-data.md#encrypt-data-with-a-customer-managed-key).

### <a name="azure-kubernetes-service"></a>Служба Azure Kubernetes

Развернутый ресурс Службы Azure Kubernetes можно зашифровать с помощью управляемых клиентом ключей в любое время. Дополнительные сведения см. в статье [Использование собственных ключей (BYOK) с помощью Службы Azure Kubernetes (AKS)](../aks/azure-disk-customer-managed-keys.md). 

Этот процесс позволяет шифровать данные и диск операционной системы развернутых виртуальных машин в кластере Kubernetes.

> [!IMPORTANT]
> Он работает только с AKS K8s версии 1.17 или выше. 13 января 2020 г. в Машинное обучение Azure добавлена поддержка AKS 1.17.

### <a name="machine-learning-compute"></a>Вычислительная среда Машинного обучения

Диск операционной системы для каждого вычислительного узла, хранящегося в службе хранилища Azure, шифруется с помощью управляемых корпорацией Майкрософт ключей в учетных записях хранения Машинного обучения Azure. Этот целевой объект вычислений является временным, и кластеры, как правило, уменьшаются в масштабе, если в очереди нет запусков. Базовая виртуальная машина освобождается, а диск ОС удаляется. Шифрование дисков Azure не поддерживается для диска ОС.

Каждая виртуальная машина также имеет локальный временный диск для операций ОС. При необходимости можно использовать диск для размещения данных для обучения. По умолчанию диск шифруется для рабочих областей с параметром `hbi_workspace`, для которого задано значение `TRUE`. Эта среда кратковременно используется только во время выполнения, а поддержка шифрования ограничена только ключами, управляемыми системой.

### <a name="azure-databricks"></a>Azure Databricks

Azure Databricks можно использовать в конвейерах Машинного обучения. По умолчанию файловая система Databricks (DBFS), используемая Azure Databricks, шифруется с помощью ключа, управляемого корпорацией Майкрософт. Сведения о настройке Azure Databricks для использования управляемых клиентом ключей см. в статье [Настройка ключей, управляемых клиентом, в DBFS по умолчанию (корневой файловой системе)](/azure/databricks/security/customer-managed-keys-dbfs).

## <a name="encryption-in-transit"></a>Шифрование при передаче

Машинное обучение Azure использует TLS для защиты внутренней связи между различными микрослужбами Машинного обучения Azure. Доступ к службе хранилища Azure также осуществляется по безопасному каналу.

Для защиты внешних вызовов, сделанных в конечной точке оценки, Машинное обучение Azure использует TLS. Дополнительные сведения см. в статье [Использование TLS для защиты веб-службы с помощью Машинного обучения Azure](./how-to-secure-web-service.md).

## <a name="data-collection-and-handling"></a>Сбор и обработка данных

### <a name="microsoft-collected-data"></a>Данные, собранные корпорацией Майкрософт

Майкрософт может собирать обезличенные данные, такие как имена ресурсов (например, имя набора данных или имя эксперимента машинного обучения) или переменные среды задания для диагностики. Все эти данные хранятся с помощью управляемых корпорацией Майкрософт ключей в хранилище, размещенном в собственных подписках Майкрософт, с соблюдением [стандартной политики конфиденциальности и стандартов обработки данных корпорации Майкрософт](https://privacy.microsoft.com/privacystatement).

Также рекомендуем не хранить конфиденциальные сведения (например, секретные ключи учетной записи) в переменных среды. Переменные среды записываются, шифруются и сохраняются. Аналогично при именовании [run_id](/python/api/azureml-core/azureml.core.run%28class%29?preserve-view=true&view=azure-ml-py) не следует включать конфиденциальные сведения, такие как имена пользователей или секретные имена проектов. Эти сведения могут отображаться в журналах телеметрии, доступных инженерам службы поддержки Майкрософт.

Вы можете отказаться от сбора диагностических данных, задав для параметра `hbi_workspace` значение `TRUE` при подготовке рабочей области. Эта функция поддерживается при использовании пакета SDK Python для AzureML, интерфейса командной строки, интерфейсов REST API или шаблонов Resource Manager.

## <a name="using-azure-key-vault"></a>Использование Azure Key Vault

Машинное обучение Azure использует экземпляр Azure Key Vault, связанный с рабочей областью, для хранения учетных данных разных видов:

* строка подключения связанной учетной записи хранения;
* пароли для экземпляров репозитория контейнеров Azure;
* строки подключения к хранилищам данных.

Пароли и ключи SSH для целевых объектов вычислений, таких как Azure HDInsight и виртуальные машины, хранятся в отдельном хранилище ключей, связанном с подпиской Майкрософт. Машинное обучение Azure не хранит пароли или ключи, предоставленные пользователями. Вместо этого оно создает, авторизует и сохраняет собственные ключи SSH для подключения к виртуальным машинам и HDInsight для выполнения экспериментов.

У каждой рабочей области есть связанное управляемое удостоверение, назначаемое системой, которое имеет то же имя, что и рабочая область. Это управляемое удостоверение имеет доступ ко всем ключам, секретам и сертификатам в хранилище ключей.

## <a name="next-steps"></a>Дальнейшие действия

* [Подключение к службе хранилища Azure](how-to-access-data.md)
* [Получение данных из хранилища данных](how-to-create-register-datasets.md)
* [Подключение к данным](how-to-connect-data-ui.md)
* [Обучение с наборами данных](how-to-train-with-datasets.md)