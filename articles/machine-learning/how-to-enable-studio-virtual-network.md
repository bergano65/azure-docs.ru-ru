---
title: Включение Машинное обучение Azure Studio в виртуальной сети
titleSuffix: Azure Machine Learning
description: Узнайте, как настроить Машинное обучение Azure Studio для доступа к данным, хранящимся в виртуальной сети.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: how-to
ms.reviewer: larryfr
ms.author: aashishb
author: aashishb
ms.date: 10/21/2020
ms.custom: contperf-fy20q4, tracking-python
ms.openlocfilehash: 3f128b7ee7fa8f690c2097a5d27e274ec1eb2a8a
ms.sourcegitcommit: 77ab078e255034bd1a8db499eec6fe9b093a8e4f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/16/2020
ms.locfileid: "97559545"
---
# <a name="use-azure-machine-learning-studio-in-an-azure-virtual-network"></a>Использование Машинное обучение Azure Studio в виртуальной сети Azure

Из этой статьи вы узнаете, как использовать Машинное обучение Azure Studio в виртуальной сети. В состав Studio входят такие функции, как Аутомл, конструктор и метки данных. Чтобы использовать эти функции в виртуальной сети, необходимо выполнить действия, описанные в этой статье.

Вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> - Предоставьте Studio доступ к данным, хранящимся в виртуальной сети.
> - Доступ к студии из ресурса в виртуальной сети.
> - Узнайте, как в Studio влияет безопасность хранилища.

Эта статья содержит пять статей, посвященных обеспечению безопасности Машинное обучение Azure рабочего процесса. Мы настоятельно рекомендуем ознакомиться с предыдущими частями, чтобы настроить среду виртуальной сети.

См. Другие статьи в этой серии:

[1. Обзор виртуальной сети](how-to-network-security-overview.md)  >  [2. Обеспечьте безопасность рабочей области](how-to-secure-workspace-vnet.md)  >  [3. Обеспечьте безопасность среды обучения](how-to-secure-training-vnet.md)  >  [4. Обеспечьте безопасность окружения](how-to-secure-inferencing-vnet.md)  >  **5. Включить функциональные возможности студии**


> [!IMPORTANT]
> Если Рабочая область находится в __независимых облаке__(например, Azure для государственных организаций или Azure для Китая), интегрированные записные книжки _не_ поддерживают использование хранилища в виртуальной сети. Вместо этого можно использовать записные книжки Jupyter из вычислительного экземпляра. Дополнительные сведения см. в разделе [доступ к данным в записной книжке для вычислительных экземпляров](how-to-secure-training-vnet.md#access-data-in-a-compute-instance-notebook) .


## <a name="prerequisites"></a>Предварительные требования

+ Ознакомьтесь с [обзором сетевой безопасности](how-to-network-security-overview.md) , чтобы ознакомиться с общими сценариями и архитектурой виртуальной сети.

+ Уже имеющаяся виртуальная сеть и подсеть для использования.

+ Существующая [машинное обучение Azure Рабочая область с включенной закрытой ссылкой](how-to-secure-workspace-vnet.md#secure-the-workspace-with-private-endpoint).

+ Существующая [учетная запись хранения Azure добавила свою виртуальную сеть](how-to-secure-workspace-vnet.md#secure-azure-storage-accounts-with-service-endpoints).

## <a name="configure-data-access-in-the-studio"></a>Настройка доступа к данным в студии

Некоторые компоненты Studio по умолчанию отключены в виртуальной сети. Чтобы повторно включить эти функции, необходимо включить управляемое удостоверение для учетных записей хранения, которые будут использоваться в студии. 

По умолчанию в виртуальной сети отключены следующие операции:

* Предварительный просмотр данных в студии.
* Визуализируйте данные в конструкторе.
* Развертывание модели в конструкторе ([учетная запись хранения по умолчанию](#enable-managed-identity-authentication-for-default-storage-accounts)).
* Отправка Аутомл эксперимента ([учетная запись хранения по умолчанию](#enable-managed-identity-authentication-for-default-storage-accounts)).
* Запустите проект меток.

В виртуальной сети Studio поддерживает чтение данных из следующих типов:

* Большой двоичный объект Azure
* Хранилище Azure Data Lake Storage 1-го поколения
* Azure Data Lake Storage 2-го поколения
* База данных SQL Azure

### <a name="configure-datastores-to-use-workspace-managed-identity"></a>Настройка хранилищ данных для использования удостоверения, управляемого рабочей областью

После добавления учетной записи хранения Azure в виртуальную сеть с [конечной точкой службы](how-to-secure-workspace-vnet.md#secure-azure-storage-accounts-with-service-endpoints) или [частной конечной точкой](how-to-secure-workspace-vnet.md#secure-azure-storage-accounts-with-private-endpoints)необходимо настроить хранилище данных для использования проверки подлинности с помощью [управляемого удостоверения](../active-directory/managed-identities-azure-resources/overview.md) . Это позволит Studio получить доступ к данным в вашей учетной записи хранения.

Машинное обучение Azure использует [хранилища](concept-data.md#datastores) данных для подключения к учетным записям хранения. Чтобы настроить хранилище данных для использования управляемого удостоверения, выполните следующие действия.

1. В студии выберите __хранилища данных__.

1. Чтобы обновить существующее хранилище данных, выберите хранилище данных и щелкните __обновить учетные данные__.

    Чтобы создать новое хранилище данных, выберите __+ создать хранилище данных__.

1. В параметрах хранилища данных выберите __Да__ для параметра  __использовать управляемое удостоверение рабочей области для предварительного просмотра и профилирования в машинное обучение Azure Studio__.

    ![Снимок экрана, показывающий, как включить удостоверение управляемой рабочей области](./media/how-to-enable-studio-virtual-network/enable-managed-identity.png)

Эти действия позволяют добавить управляемое рабочей областью удостоверение как __читателя__ в службу хранилища с помощью Azure RBAC. Доступ для __чтения__ позволяет рабочей области получать параметры брандмауэра, чтобы гарантировать, что данные не покидают виртуальную сеть. Для вступления изменений в силу может потребоваться до 10 минут.

### <a name="enable-managed-identity-authentication-for-default-storage-accounts"></a>Включение проверки подлинности управляемого удостоверения для учетных записей хранения по умолчанию

Каждая Рабочая область Машинное обучение Azure имеет две учетные записи хранения по умолчанию, учетную запись хранения BLOB-объектов по умолчанию и учетную запись хранилища файлов по умолчанию, которые определяются при создании рабочей области. Можно также задать новые значения по умолчанию на странице Управление **хранилищем данных** .

![Снимок экрана, на котором показано, где можно найти хранилища данных по умолчанию](./media/how-to-enable-studio-virtual-network/default-datastores.png)

В следующей таблице описано, почему необходимо включить аутентификацию управляемого удостоверения для учетных записей хранения по умолчанию рабочей области.

|Учетная запись хранения  | Примечания  |
|---------|---------|
|Хранилище BLOB-объектов по умолчанию для рабочей области| Хранит активы модели из конструктора. Для развертывания моделей в конструкторе необходимо включить аутентификацию управляемого удостоверения в этой учетной записи хранения. <br> <br> Вы можете визуализировать и запустить конвейер конструктора, если он использует хранилище данных, отличное от используемого по умолчанию, которое было настроено для использования управляемого удостоверения. Однако при попытке развернуть обученную модель без поддержки управляемого удостоверения в хранилище данных по умолчанию развертывание завершится ошибкой независимо от других используемых хранилищ данных.|
|Хранилище файлов по умолчанию для рабочей области| Хранит ресурсы экспериментов Аутомл. Для отправки экспериментов Аутомл необходимо включить аутентификацию управляемого удостоверения в этой учетной записи хранения. |

> [!WARNING]
> Существует известная ситуация, когда хранилище файлов по умолчанию не создает папку автоматически `azureml-filestore` , которая необходима для отправки экспериментов аутомл. Это происходит, когда пользователи переносят существующий хранилище файлов в качестве хранилища данных по умолчанию во время создания рабочей области.
> 
> Чтобы избежать этой проблемы, у вас есть два варианта: 1) используйте хранилище файлов по умолчанию, которое создается автоматически при создании рабочей области. 2) чтобы создать собственный хранилище, убедитесь, что хранилище файлов находится за пределами виртуальной сети во время создания рабочей области. После создания рабочей области добавьте учетную запись хранения в виртуальную сеть.
>
> Чтобы устранить эту проблему, удалите учетную запись хранилища файлов из виртуальной сети и добавьте ее обратно в виртуальную сеть.


### <a name="grant-workspace-managed-identity-__reader__-access-to-storage-private-link"></a>Предоставить защищенной ссылке на хранилище управляемый __идентификатор рабочей области доступ к__ частному каналу хранилища

Если ваша учетная запись хранения Azure использует закрытую конечную точку, необходимо предоставить службе **чтения** удостоверений, управляемой рабочей областью, доступ к частной ссылке. Дополнительные сведения см. в разделе Встроенная роль [читателя](../role-based-access-control/built-in-roles.md#reader) . 

Если ваша учетная запись хранения использует конечную точку службы, этот шаг можно пропустить.

## <a name="access-the-studio-from-a-resource-inside-the-vnet"></a>Доступ к студии из ресурса в виртуальной сети

При доступе к студии из ресурса внутри виртуальной сети (например, вычислительного экземпляра или виртуальной машины) необходимо разрешить исходящий трафик из виртуальной сети в студии. 

Например, если вы используете группы безопасности сети (NSG) для ограничения исходящего трафика, добавьте правило в назначение __тега службы__ для __азурефронтдур. интерфейс__.

## <a name="technical-notes-for-managed-identity"></a>Технические примечания по управляемому удостоверению

Использование управляемого удостоверения для доступа к службам хранилища влияет на вопросы безопасности. В этом разделе описаны изменения для каждого типа учетной записи хранения. 

Эти соображения уникальны для __типа учетной записи хранения__ , к которой осуществляется доступ.

### <a name="azure-blob-storage"></a>Хранилище BLOB-объектов Azure

Для __хранилища BLOB-объектов Azure__ удостоверение, управляемое рабочей областью, также добавляется как [модуль чтения данных большого двоичного объекта](../role-based-access-control/built-in-roles.md#storage-blob-data-reader) , чтобы он мог считывать данные из хранилища больших двоичных объектов.

### <a name="azure-data-lake-storage-gen2-access-control"></a>Azure Data Lake Storage 2-го поколения контроля доступа

Для управления доступом к данным в виртуальной сети можно использовать как Azure RBAC, так и списки управления доступом (ACL) в стиле POSIX.

Чтобы использовать Azure RBAC, добавьте удостоверение, управляемое рабочей областью, в роль [модуля чтения BLOB-объектов](../role-based-access-control/built-in-roles.md#storage-blob-data-reader) . Дополнительные сведения см. в статье [Управление доступом на основе ролей в Azure](../storage/blobs/data-lake-storage-access-control-model.md#role-based-access-control).

Чтобы использовать списки управления доступом, идентификатору, управляемому рабочей областью, можно назначить доступ, как и любой другой принцип безопасности. Дополнительные сведения см. [в разделе списки управления доступом для файлов и каталогов](../storage/blobs/data-lake-storage-access-control.md#access-control-lists-on-files-and-directories).

### <a name="azure-data-lake-storage-gen1-access-control"></a>Azure Data Lake Storage 1-го поколения контроля доступа

Azure Data Lake Storage 1-го поколения поддерживает только списки управления доступом в стиле POSIX. Можно назначить доступ удостоверений, управляемых рабочей областью, к ресурсам, как и любой другой принцип безопасности. Дополнительные сведения см. [в разделе Контроль доступа в Azure Data Lake Storage 1-го поколения](../data-lake-store/data-lake-store-access-control.md).

### <a name="azure-sql-database-contained-user"></a>Автономный пользователь базы данных SQL Azure

Чтобы получить доступ к данным, хранящимся в базе данных SQL Azure с помощью управляемого удостоверения, необходимо создать автономного пользователя SQL, сопоставляемого с управляемым удостоверением. Дополнительные сведения о создании пользователя из внешнего поставщика см. в статье [Создание автономных пользователей, сопоставленных с удостоверениями Azure AD](../azure-sql/database/authentication-aad-configure.md#create-contained-users-mapped-to-azure-ad-identities).

После создания автономного пользователя SQL предоставьте ему разрешения с помощью [команды T-SQL GRANT](/sql/t-sql/statements/grant-object-permissions-transact-sql).

### <a name="azure-machine-learning-designer-intermediate-module-output"></a>Выходные данные промежуточного модуля конструктора Машинное обучение Azure

Можно указать расположение выходных данных для любого модуля в конструкторе. Используйте этот параметр для хранения промежуточных наборов данных в отдельном расположении для обеспечения безопасности, ведения журнала или аудита. Чтобы указать выходные данные:

1. Выберите модуль, выходные данные которого вы хотите указать.
1. В области Параметры модуля справа выберите **Параметры вывода**.
1. Укажите хранилище данных, которое будет использоваться для каждого выходного модуля.
 
Убедитесь, что у вас есть доступ к промежуточным учетным записям хранения в виртуальной сети. В противном случае произойдет сбой конвейера.

Также следует [включить проверку подлинности управляемого удостоверения](#configure-datastores-to-use-workspace-managed-identity) для промежуточных учетных записей хранения, чтобы визуализировать выходные данные.

## <a name="next-steps"></a>Дальнейшие шаги

Эта статья является необязательной частью серии виртуальных сетей из четырех частей. Ознакомьтесь с остальными статьями, чтобы узнать, как защитить виртуальную сеть.

* [Часть 1. Обзор виртуальной сети](how-to-network-security-overview.md)
* [Часть 2. Защита ресурсов рабочей области](how-to-secure-workspace-vnet.md)
* [Часть 3. Защита среды обучения](how-to-secure-training-vnet.md)
* [Часть 4. Защита окружения](how-to-secure-inferencing-vnet.md)