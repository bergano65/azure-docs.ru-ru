---
title: Выполнение сценариев машинного обучения Python
titleSuffix: Azure Machine Learning Studio
description: Узнайте, как использовать Python в Машинное обучение Azure Studio.
services: machine-learning
ms.service: machine-learning
ms.subservice: studio
ms.topic: conceptual
author: xiaoharper
ms.author: amlstudiodocs
ms.custom: previous-author=heatherbshapiro, previous-ms.author=hshapiro
ms.date: 03/12/2019
ms.openlocfilehash: 64030cac73b6fbd750b2ed681d85642cc6ad1146
ms.sourcegitcommit: f176e5bb926476ec8f9e2a2829bda48d510fbed7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/04/2019
ms.locfileid: "70308861"
---
# <a name="execute-python-machine-learning-scripts-in-azure-machine-learning-studio"></a>Выполнение сценариев Python в Студии машинного обучения Azure

Python — это ценное средство в сундука многих специалистов по обработке и анализу данных. Он используется на каждом этапе стандартных рабочих процессов машинного обучения, включая исследование данных, извлечение компонентов, обучение и проверку модели, а также развертывание.

В этой статье описывается, как с помощью модуля выполнить скрипт Python можно использовать код Python в экспериментах и веб-службах Машинное обучение Azure Studio.

## <a name="using-the-execute-python-script-module"></a>Использование модуля выполнения скрипта Python

Основным интерфейсом Python в студии является [выполнение модуля выполнения скрипта Python][execute-python-script] . Он принимает до трех входов и создает до двух выходов, аналогично модулю [EXECUTE R Script][execute-r-script] . Код Python помещается в поле параметров через специально именованную функцию `azureml_main`точки входа с именем.

![Выполнить модуль скрипта Python](./media/execute-python-scripts/execute-machine-learning-python-scripts-module.png)

![Пример кода Python в поле параметра модуля](./media/execute-python-scripts/embedded-machine-learning-python-script.png)

### <a name="input-parameters"></a>Входные параметры

Входные данные модуля Python предоставляются в виде кадров данных Pandas. `azureml_main` Функция принимает до двух необязательных кадров данных Pandas в качестве параметров.

Сопоставление входных портов и параметров функции выполняется по позиционному принципу:

- Первый подключенный входной порт сопоставляется с первым параметром функции.
- Второй входной порт (если он подключен) сопоставляется со вторым параметром функции.
- Третий ввод используется для [импорта дополнительных модулей Python](#import-modules).

Ниже показана более подробная семантика сопоставления входных портов с параметрами `azureml_main` функции.

![Таблица конфигураций входных портов и результирующая подпись Python](./media/execute-python-scripts/python-script-inputs-mapped-to-parameters.png)

### <a name="output-return-values"></a>Выходные возвращаемые значения

Функция `azureml_main` должна возвращать один кадр данных Pandas, упакованный в [последовательность](https://docs.python.org/2/c-api/sequence.html) Python, например кортеж, список или массив NumPy. Первый элемент этой последовательности возвращается к первому выходному порту модуля. Второй выходной порт модуля используется для [визуализаций](#visualizations) и не требует возвращаемого значения. Эта схема показана ниже.

![Сопоставление входных портов с параметрами и возвращаемым значением для порта вывода](./media/execute-python-scripts/map-of-python-script-inputs-outputs.png)

## <a name="translation-of-input-and-output-data-types"></a>Преобразование входных и выходных типов данных

Наборы данных Studio не совпадают с Panda кадрами. В результате входные наборы данных в Studio преобразуются в таблицу данных Pandas, а выходные кадры выходной таблицы преобразуются обратно в наборы данных Studio. В ходе этого процесса преобразования также выполняются следующие переводы:

 **Тип данных Python** | **Процедура перевода Studio** |
| --- | --- |
| Строки и числовые значения| Переведено как есть |
| Pandas "НД" | Переведено как "отсутствующее значение" |
| Векторы индекса | Неподдерживаемый |
| Имена столбцов, не являющихся строками | Вызов `str` для имен столбцов |
| Дублирующиеся имена столбцов | Добавить числовой суффикс: (1), (2), (3) и т. д.

**Все кадры входных данных в функции Python всегда имеют 64-разрядный числовой индекс от 0 до числа строк минус 1*

## <a id="import-modules"></a>Импорт существующих модулей скриптов Python

Серверная часть, используемая для выполнения Python, основана на [Anaconda](https://www.anaconda.com/distribution/), широко используемом научном распределении Python. Он поставляется с близким к 200 наиболее распространенным пакетам Python, используемым в рабочих нагрузках, ориентированных на данные. В настоящее время Studio не поддерживает использование систем управления пакетами, таких как PIP или Conda, для установки внешних библиотек и управления ими.  Если требуется включить дополнительные библиотеки, используйте следующий сценарий в качестве рекомендации.

Типичный сценарий использования заключается в том, чтобы внедрять существующие сценарии Python в эксперименты Studio. Модуль [выполнение скрипта Python][execute-python-script] принимает ZIP-файл, содержащий модули Python по третьему порту ввода. Этот файл распаковывается во время выполнения в среда выполнения, а его содержимое добавляется в путь к библиотеке интерпретатора Python. После этого функция точки входа `azureml_main` может импортировать эти модули напрямую. 

Рассмотрим в качестве примера файл Hello.py, содержащий простую функцию Hello, World.

![Определяемая пользователем функция в файле Hello.py](./media/execute-python-scripts/figure4.png)

Далее мы создаем файл Hello.zip, содержащий файл Hello.py:

![ZIP-файл, содержащий определяемый пользователем код Python](./media/execute-python-scripts/figure5.png)

Отправьте ZIP-файл в качестве набора данных в Studio. Затем создайте и запустите эксперимент, использующий код Python в файле Hello. zip, присоединив его к третьему входному порту модуля **EXECUTE Python Script (выполнение скрипта** ), как показано на следующем рисунке.

![Пример эксперимента с Hello. zip в качестве входных данных для модуля выполнения скрипта Python](./media/execute-python-scripts/figure6a.png)

![Определяемый пользователем код Python отправлен как ZIP-файл](./media/execute-python-scripts/figure6b.png)

В выходных данных модуля можно увидеть, что ZIP-файл был распакован, и функция `print_hello` была выполнена.

![Выходные данные модуля, отображающие определяемую пользователем функцию](./media/execute-python-scripts/figure7.png)

## <a name="accessing-azure-storage-blobs"></a>Доступ к BLOB-объектам службы хранилища Azure

Доступ к данным, хранящимся в учетной записи хранилища BLOB-объектов Azure, можно получить, выполнив следующие действия.

1. Скачайте [пакет хранилища BLOB-объектов Azure для Python](https://azuremlpackagesupport.blob.core.windows.net/python/azure.zip) локально.
1. Отправьте ZIP-файл в рабочую область Studio в качестве набора данных.
1. Создайте объект BlobService с помощью`protocol='http'`

```
from azure.storage.blob import BlockBlobService

# Create the BlockBlockService that is used to call the Blob service for the storage account
block_blob_service = BlockBlobService(account_name='account_name', account_key='account_key', protocol='http')
```

1. На вкладке "Параметры **конфигурации** хранилища" **требуется отключить безопасное перемещение**

![Отключите безопасное перемещение, требуемое в портал Azure](./media/execute-python-scripts/disable-secure-transfer-required.png)

## <a name="operationalizing-python-scripts"></a>Выполнение сценариев Python

Любые модули [выполнения скриптов Python][execute-python-script] , используемые в эксперименте оценки, вызываются при публикации в виде веб-службы. Например, на рисунке ниже показан эксперимент оценки, содержащий код для вычисления одного выражения Python.

![Рабочая область Studio для веб-службы](./media/execute-python-scripts/figure3a.png)

![Выражение Pandas Python](./media/execute-python-scripts/python-script-with-python-pandas.png)

Веб-служба, созданная из этого эксперимента, будет выполнять следующие действия:

1. Возьмем выражение Python в качестве входных данных (строка)
1. Отправка выражения Python в интерпретатор Python
1. Возвращает таблицу, содержащую выражение и вычисленный результат.

## <a id="visualizations"></a>Работа с визуализациями

Графики, созданные с помощью MatplotLib, могут быть возвращены [сценарием Execute Python][execute-python-script]. Однако графики не перенаправляются автоматически на изображения, как при использовании языка R. Поэтому пользователь должен явно сохранять все графики в PNG-файлы.

Чтобы создать изображения из MatplotLib, необходимо выполнить следующие действия.

1. Переключите серверную часть на "AGG" из визуализатора по умолчанию, основанного на Qt.
1. Создайте новый объект Figure.
1. Получение оси и создание в ней всех диаграмм.
1. Сохраните рисунок в PNG-файл.

Этот процесс показан на следующих изображениях, которые создают точечную диаграмму с помощью функции scatter_matrix в Pandas.

![Код для сохранения MatplotLibных фигур в изображениях](./media/execute-python-scripts/figure-v1-8.png)

![Щелкните визуализировать в модуле выполнение скрипта Python, чтобы просмотреть данные](./media/execute-python-scripts/figure-v2-9a.png)

![Визуализация графиков для примера эксперимента с помощью кода Python](./media/execute-python-scripts/figure-v2-9b.png)

Можно вернуть несколько иллюстраций, сохранив их в разных изображениях. Среда выполнения Studio выбирает все образы и объединяет их для визуализации.

## <a name="advanced-examples"></a>Дополнительные примеры

Среда Anaconda, установленная в студии, содержит общие пакеты, такие как NumPy, SciPy и Scikits-учиться. Эти пакеты можно эффективно использовать для обработки данных в конвейере машинного обучения.

Например, в приведенном ниже эксперименте и сценарии демонстрируется использование ансамблейных средств обучения в Scikits — изучение оценки важности функций для набора данных. Оценки можно использовать для выполнения контролируемого выбора компонентов до их подачи в другую модель.

Ниже показана функция Python, используемая для вычисления оценки важности и упорядочивания компонентов на основе этой оценки:

![Функция для ранжирования характеристик по показателям](./media/execute-python-scripts/figure8.png)

Затем следующий эксперимент вычисляет и возвращает оценки важности компонентов в наборе данных "Диабет у индейцев пима" в Студии машинного обучения Azure.

![Экспериментируйте с возможностями ранжирования функций в наборе данных диабет у в Индийском диабета с помощью Python](./media/execute-python-scripts/figure9a.png)

![Визуализация выходных данных модуля выполнения сценария Python](./media/execute-python-scripts/figure9b.png)

## <a name="limitations"></a>Ограничения

Модуль [выполнение сценария Python][execute-python-script] в настоящее время имеет следующие ограничения.

### <a name="sandboxed-execution"></a>Изолированное выполнение

Среда выполнения Python в настоящее время изолирована и не разрешает постоянный доступ к сети или локальной файловой системе. Все файлы, сохраненные локально, изолированы и удаляются после завершения выполнения модуля. С помощью кода Python нельзя получить доступ к большинству каталогов на компьютере, на котором он выполняется, за исключением текущего каталога и его подкаталогов.

### <a name="lack-of-sophisticated-development-and-debugging-support"></a>Отсутствие сложной поддержки для разработки и отладки

В настоящее время модуль Python не поддерживает возможности интегрированной среды разработки, такие как Intellisense и отладка. Кроме того, при сбое модуля во время выполнения доступен полный стек трассировки Python. Его необходимо просматривать в журнале выходных данных для модуля. Сейчас мы советуем вам разрабатывать и отлаживать сценарии Python в таких средах, как IPython, а затем импортировать код в модуль.

### <a name="single-data-frame-output"></a>Выходные данные одного кадра данных

Точке входа Python разрешено возвращать только один кадр данных в качестве выходных данных. В настоящее время невозможно вернуть произвольные объекты Python, такие как обученные модели, непосредственно в среду выполнения Studio. Как и при [выполнении скрипта R][execute-r-script]с тем же ограничением, во многих случаях можно выбрать объекты в виде массива байтов, а затем вернуть их в кадре данных.

### <a name="inability-to-customize-python-installation"></a>Невозможность настройки установки Python

Сейчас единственный возможный способ добавить пользовательские модули Python — применение механизма с использованием ZIP-файла, описанного выше. Хотя это и возможно для небольших модулей, это удобно для больших модулей (особенно для модулей с собственными библиотеками DLL) или для большого количества модулей.

## <a name="next-steps"></a>Следующие шаги

Дополнительную информацию можно найти в [Центре разработчика Python](https://azure.microsoft.com/develop/python/).

<!-- Module References -->
[execute-python-script]: https://docs.microsoft.com/azure/machine-learning/studio-module-reference/execute-python-script
[execute-r-script]: https://docs.microsoft.com/azure/machine-learning/studio-module-reference/execute-r-script