---
title: 'Обнаружение аномалий PCA-Based: Справочник по модулям'
titleSuffix: Azure Machine Learning
description: Узнайте, как использовать модуль обнаружения аномалий PCA-Based для создания модели обнаружения аномалий на основе анализа основных компонентов (PCA).
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 02/22/2020
ms.openlocfilehash: fa90fcb9ebc17be9a658b08873234eada98b0fba
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "90898468"
---
# <a name="pca-based-anomaly-detection-module"></a>Модуль обнаружения аномалий PCA-Based

В этой статье описывается использование модуля обнаружения аномалий PCA-Based в конструкторе Машинное обучение Azure для создания модели обнаружения аномалий на основе анализа основных компонентов (PCA).

Этот модуль помогает создать модель в сценариях, где можно легко получить обучающие данные из одного класса, например допустимые транзакции, но трудно получить достаточное количество выборок целевых аномалий. 

Например, для обнаружения мошеннических транзакций часто не существует достаточных примеров мошенничества для обучения. Но у вас может быть много примеров хороших транзакций. Модуль обнаружения аномалий PCA-Based решает проблему, анализируя доступные функции, чтобы определить, что составляет "нормальный" класс. Затем модуль применяет метрики расстояния для определения вариантов, представляющих аномалии. Такой подход позволяет обучить модель с помощью существующих несбалансированных данных.

## <a name="more-about-principal-component-analysis"></a>Дополнительные сведения об анализе основных компонентов

PCA — это установленный метод в машинном обучении. Он часто используется в анализе исследовательских данных, поскольку он отображает внутреннюю структуру данных и объясняет дисперсию данных.

PCA выполняется путем анализа данных с несколькими переменными. Он выполняет поиск корреляции между переменными и определяет сочетание значений, которые лучше всего фиксируют различия результатов. Эти объединенные значения функций используются для создания более компактного пространства функций, называемого *основными компонентами*.

Для обнаружения аномалий анализируются все новые входные данные. Алгоритм обнаружения аномалий рассчитывает свою проекцию в основе собственных векторов, а также нормализованную ошибку реконструкции. Нормализованная ошибка используется в качестве оценки аномалии. Чем больше значение ошибки, тем больше аномалий в экземпляре.

Дополнительные сведения о работе PCA и о реализации обнаружения аномалий см. в следующих документах:

- [Случайный алгоритм для анализа основных компонентов](https://arxiv.org/abs/0809.2274), Рокхлин, Сзлан и тижерт

- [Поиск структуры со случайностью: алгоритмы вероятностная для создания приблизительных декомпозиций матриц](http://users.cms.caltech.edu/~jtropp/papers/HMT11-Finding-Structure-SIREV.pdf) (скачивание в формате PDF), по Халко, Мартинссон и тропп

## <a name="how-to-configure-pca-based-anomaly-detection"></a>Настройка обнаружения аномалий PCA-Based

1. Добавьте модуль **обнаружения аномалий на основе PCA** в конвейер в конструкторе. Этот модуль можно найти в категории **обнаружение аномалий** .

2. На правой панели модуля выберите параметр **режим обучения** . Укажите, нужно ли обучить модель с помощью определенного набора параметров, или используйте параметр очистки для поиска лучших параметров.

    Если вы умеете настраивать модель, выберите параметр **одиночный параметр** и укажите в качестве аргументов конкретный набор значений.

3. Для **количества компонентов, используемых в PCA**, укажите количество требуемых функций или компонентов выходных данных.

    Решение о том, сколько компонентов следует включить, является важной частью разработки экспериментов, в которой используется PCA. Общее руководство заключается в том, что не следует включать то же количество компонентов PCA, что и переменные. Вместо этого следует начать с меньшего числа компонентов и увеличить их до тех пор, пока не будет выполнено определенное условие.

    Наилучшие результаты получаются, когда количество выходных компонентов *меньше* числа доступных столбцов в наборе данных.

4. Укажите объем избыточной выборки для выполнения случайного обучения PCA. При проблемах обнаружения аномалий несбалансированные данные затрудняют применение стандартных методик PCA. Указав некоторый объем избыточной выборки, можно увеличить количество целевых экземпляров.

    Если указано значение **1**, то избыточная выборка не выполняется. Если указать любое значение выше **1**, то для обучения модели будут созданы дополнительные примеры.

    В зависимости от того, используете ли вы параметр или нет, можно использовать два варианта:

    - **Параметр избыточной выборки для случайного PCA**: введите одно целое число, представляющее отношение избыточной выборки к классу с обычным классом. (Этот параметр доступен, если вы используете метод обучения с **одним параметром** ).

    > [!NOTE]
    > Невозможно просмотреть набор данных с перевыборкой. Дополнительные сведения о том, как избыточная выборка используется с PCA, см. в разделе [Технические примечания](#technical-notes).

5. Установите флажок **включить входные функции = нормализация** , чтобы нормализовать все функции ввода в среднее значение, равное нулю. Обычно для PCA рекомендуется нормализация или масштабирование до нуля, так как целью PCA является максимально увеличить дисперсию между переменными.

    Этот параметр установлен по умолчанию. Снимите флажок, если значения уже нормализованы с помощью другого метода или масштаба.

6. Подключите обучающий набор данных с тегами и один из обучающих модулей.

   Если для параметра **создать режим** обучения задано значение **один параметр**, используйте модуль " [обучение модели обнаружения аномалий](train-anomaly-detection-model.md) ".

7. Отправьте конвейер.

## <a name="results"></a>Результаты

По завершении обучения можно сохранить обученную модель. Или можно подключить его к модулю [Оценка модели](score-model.md) для прогнозирования оценок аномалий.

Чтобы оценить результаты модели обнаружения аномалий, выполните следующие действия.

1. Убедитесь, что столбец оценки доступен в обоих наборах данных.

    Если вы попытаетесь оценить модель обнаружения аномалий и получите ошибку «для сравнения нет столбца Score в вычисляемом наборе данных», то используется стандартный набор данных, который содержит столбец меток, но не имеет оценки вероятности. Выберите набор данных, соответствующий выходным данным схемы для моделей обнаружения аномалий, включая оцененные **метки** и столбцы с **оценкой вероятности** .

2. Убедитесь, что столбцы меток помечены.

    Иногда метаданные, связанные со столбцом меток, удаляются на графе конвейера. В этом случае при использовании модуля " [Анализ модели](evaluate-model.md) " для сравнения результатов двух моделей обнаружения аномалий может возникнуть ошибка "нет столбца меток в наборе данных, подсчитанном". Кроме того, может появиться сообщение об ошибке "отсутствует столбец меток в вычисляемом наборе данных для сравнения".

    Эти ошибки можно избежать, добавив модуль [изменить метаданные](edit-metadata.md) перед модулем [Анализ модели](evaluate-model.md) . С помощью селектора столбцов выберите столбец класс, а в списке **поля** выберите **Метка**.

3. Используйте модуль [выполнить сценарий Python](execute-python-script.md) для настройки категорий столбцов меток как **1 (положительный, нормальный)** и **0 (отрицательное, нормальное)**.

    ````
    label_column_name = 'XXX'
    anomaly_label_category = YY
    dataframe1[label_column_name] = dataframe1[label_column_name].apply(lambda x: 0 if x == anomaly_label_category else 1)
    ````

    
## <a name="technical-notes"></a>Технические примечания

Этот алгоритм использует PCA для приблизительного подпространства, содержащего класс нормали. Подпространство состоит из основе собственных векторов, связанного с верхним еиженвалуес матрицы ковариации данных. 

Для каждого нового входа детектор аномалий сначала рассчитывает свою проекцию на основе собственных векторов, а затем вычислит нормализованную ошибку реконструкции. Эта ошибка является показателем аномалии. Чем выше эта ошибка, тем более аномальным является экземпляр. Дополнительные сведения о вычислении обычного пространства см. в разделе Википедии: [основной анализ компонентов](https://wikipedia.org/wiki/Principal_component_analysis). 


## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с [набором доступных модулей](module-reference.md) в службе Машинного обучения Azure. 

Список ошибок, характерных для модулей конструктора, см. [в разделе исключения и коды ошибок для конструктора](designer-error-codes.md) .