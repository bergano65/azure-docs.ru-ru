---
title: Использование модуля углубленной рекомендацией для оценки уровня &
titleSuffix: Azure Machine Learning
description: Узнайте, как использовать модуль глубоких рекомендаций & Deep в Машинное обучение Azure, чтобы оценить прогнозы для набора данных.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 06/12/2020
ms.openlocfilehash: df723824b2d80694913e32904ed81972381c5bcb
ms.sourcegitcommit: 3543d3b4f6c6f496d22ea5f97d8cd2700ac9a481
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/20/2020
ms.locfileid: "86536221"
---
# <a name="score-wide-and-deep-recommender"></a>Оценка Wide and Deep Recommender

В этой статье описывается, как использовать модуль рекомендации " **Оценка уровня и глубокий** уровень" в машинное обучение Azure Designer (Предварительная версия) для создания прогнозов на основе обученной модели рекомендаций на основе широкого & глубокого обучения от Google.

Широкий и глубокий рекомендации могут формировать два различных типа прогнозов:

- [прогнозировать оценки для данного пользователя и объекта;](#predict-ratings)

- [Рекомендация объекта указанному пользователю](#recommend-items)


При создании прогнозов второго типа можно выполнять операции в *рабочем режиме* или в *режиме оценки*.

- В **рабочем режиме** учитываются все пользователи и элементы и обычно используется в веб-службе. Вы можете создавать оценки для новых пользователей, а не только для пользователей во время обучения. 

- **Режим оценки** применяется к ограниченному набору пользователей или элементов, которые можно оценивать, и обычно используются во время эксперимента.

Дополнительные сведения о расширенных и глубоких рекомендациях, а также о его базовой теории можно найти в соответствующем справочном документе: [широкие & глубокое обучение для систем рекомендаций](https://arxiv.org/pdf/1606.07792.pdf).  

## <a name="how-to-configure-score-wide-and-deep-recommender"></a>Настройка расширенного и глубокого рекомендаций оценки

Этот модуль поддерживает различные типы рекомендаций, каждый из которых имеет различные требования. Щелкните ссылку для типа данных и тип рекомендации, которую необходимо создать.

+ [Прогнозирование оценок](#predict-ratings)
+ [Рекомендовать элементы](#recommend-items)

### <a name="predict-ratings"></a>Прогнозирование оценок

При прогнозировании оценок модель вычисляет, как заданный пользователь будет реагировать на конкретный элемент, учитывая данные для обучения. Поэтому входные данные для оценки должны обеспечивать оценку как пользователя, так и элемента.

1. Добавьте обученную детальную модель рекомендаций & в эксперимент и подключите ее к **обученной модели расширенной и углубленной рекомендации**.  Модель необходимо создать с помощью инструкции обучения с использованием [углубленных и глубоких рекомендаций](train-wide-and-deep-recommender.md).

2. **Тип рекомендуемого прогноза**: выберите **Прогноз рейтинга**. Дополнительные параметры не требуются.

3. Добавьте данные, для которых вы хотите сделать прогнозы, и подключите их к **набору данных для оценки**.

    Для прогнозирования оценок входной набор данных должен содержать пары "пользователь-элемент".

    Набор данных может содержать необязательный третий столбец оценок для пары "пользователь-элемент" в первом и втором столбцах, но третий столбец будет игнорироваться во время прогнозирования.

4.  (Необязательно). Если у вас есть набор данных о функциях пользователя, подключите его к **функциям пользователя**.

    Набор данных пользовательских функций должен содержать идентификатор пользователя в первом столбце. Остальные столбцы должны содержать значения, характеризующие пользователей, такие как пол, предпочтения, расположение и т. д.
  
    Функции пользователей, имеющих оценку элементов в наборе данных для обучения, пропускаются с помощью **рекомендаций по ширине и глубоким рекомендациям**, так как они уже были получены во время обучения. Поэтому отфильтруйте набор данных заранее, чтобы включить только *холодных пользователей*или пользователей, которые не оценили какие-либо элементы.

    > [!WARNING]
    > Если модель была обучена без использования функций пользователя, вы не сможете ввести пользовательские функции во время оценки.

5. Если у вас есть набор данных о функциях элементов, их можно подключить к **функциям элементов**.

    Набор данных "функции элемента" должен содержать идентификатор элемента в первом столбце. Остальные столбцы должны содержать значения, характеризующие элементы.

    Функции оцененных элементов в наборе данных для обучения пропускаются с помощью **рекомендаций Wide и Deep** , так как они уже были получены во время обучения. Таким образом, Ограничьте набор данных оценки для *холодного запуска элементов*или элементов, которые не были оценены пользователями.

    > [!WARNING]
    > Если модель была обучена без использования функций элемента, вы не сможете внедрить функции элементов во время оценки.

7. Запустите эксперимент.

### <a name="results-for-rating-predictions"></a>Результаты прогнозов оценок 

Выходной набор данных содержит три столбца, содержащие пользователя, элемент и прогнозируемую оценку для каждого входного пользователя и элемента.

Кроме того, во время оценки применяются следующие изменения:

-  При использовании числового столбца пользователя или элемента отсутствующие значения автоматически заменяются **средним** значением неотсутствующих обучающих наборов. Для функции категоризации отсутствующие значения заменяются на те же значения категорий, что и любые возможные значения этой функции.
-  К значениям компонентов не применяется перевод, чтобы поддерживать их Незаполненность.

### <a name="recommend-items"></a>Рекомендовать элементы

Чтобы рекомендовать элементы для пользователей, необходимо предоставить список пользователей и элементов в качестве входных данных. На основе этих данных модель использует свои знания о существующих элементах и пользователях для создания списка элементов, которые могут оказаться привлекательными для каждого пользователя. Можно настроить количество возвращаемых рекомендаций и задать пороговое значение для числа предыдущих рекомендаций, необходимых для создания рекомендации.

1. Добавьте обученную расширенную и глубокую модель рекомендаций в эксперимент и подсоедините ее к **обученной модели расширенной и углубленной рекомендации**.  Модель необходимо создать с помощью инструкции обучения с использованием [углубленных и глубоких рекомендаций](train-wide-and-deep-recommender.md).

2. Чтобы рекомендовать элементы для заданного списка пользователей, установите рекомендацию **прогнозирования** по **элементу**.

3. **Рекомендуемый выбор элементов**: укажите, используется ли модуль оценки в рабочей среде или для оценки модели, выбрав одно из следующих значений:

    - **Из элементов с оценкой (для оценки модели)**. Выберите этот параметр при разработке или тестировании модели. Этот параметр включает **режим оценки**, и модуль предоставляет рекомендации только из тех элементов во входном наборе данных, которые были оценены.
    - **Из всех элементов**: Выберите этот параметр, если вы настраиваете эксперимент для использования в веб-службе или рабочей среде.  Этот параметр включает **режим рабочей среды**, и модуль предоставляет рекомендации во всех элементах, отображаемых во время обучения.
    - **Из элементов без оценок (для предложения новых элементов пользователям)**: Выберите этот параметр, если требуется, чтобы модуль имел рекомендации только из тех элементов в наборе данных для обучения, которые не были оценены. 
4. Добавьте набор данных, для которого требуется создать прогнозы, и подключите его к **набору данных для оценки**.

    - При выборе параметра **из всех элементов**входной набор данных должен состоять из одного и только одного столбца, содержащего идентификаторы пользователей, для которых необходимо выполнить рекомендации.

        Набор данных может включать два дополнительных столбца идентификаторов элементов и оценок, но эти два столбца игнорируются. 

    - Если выбран параметр **от оценки элементов (для оценки модели)**, входной набор данных должен состоять из **пар "пользователь-элемент"**. Первый столбец должен содержать идентификатор **пользователя** . Второй столбец должен содержать соответствующие идентификаторы **элементов** .

        Набор данных может включать в себя третий столбец оценок пользовательских элементов, но этот столбец игнорируется.
        
    - Для **из элементов без оценки (для предложения новых элементов пользователям)** входной набор данных должен состоять из пар "пользователь-элемент". Первый столбец должен содержать идентификатор пользователя. Второй столбец должен содержать соответствующие идентификаторы элементов.

        Набор данных может включать в себя третий столбец оценок пользовательских элементов, но этот столбец игнорируется.

5. (Необязательно). Если у вас есть набор данных о **функциях пользователя**, подключите его к **функциям пользователя**.

    Первый столбец в наборе данных пользовательских функций должен содержать идентификатор пользователя. Остальные столбцы должны содержать значения, характеризующие пользователя, такие как пол, предпочтения, расположение и т. д.

    Функции пользователей, имеющих оцененные элементы, игнорируются **рекомендацией оценки Wide и Deep**, так как эти функции уже были получены во время обучения. Таким образом, можно заранее отфильтровать набор данных, чтобы включить только *холодных пользователей*или пользователей, которые не оценили элементы.

    > [!WARNING]
    >  Если модель была обучена без использования пользовательских функций, нельзя использовать функции Apply во время оценки.

6. Используемых Если у вас есть набор данных о **функциях элементов**, их можно подключить к **функциям элементов**.

    Первый столбец в наборе данных "функции элемента" должен содержать идентификатор элемента. Остальные столбцы должны содержать значения, характеризующие элементы.

    Функции оцененных элементов игнорируются **рекомендацией оценки Wide и Deep**, так как эти функции уже были получены во время обучения. Таким образом, можно ограничить набор данных оценки для *холодного запуска элементов*или элементов, которые не были оценены пользователями.

    > [!WARNING]
    >  Если модель была обучена без использования функций элемента, не используйте функции элементов при оценке.  

7. **Максимальное число элементов, которые следует рекомендовать пользователю**: введите число возвращаемых элементов для каждого пользователя. По умолчанию рекомендуется 5 элементов.

8. **Минимальный размер пула рекомендаций на пользователя**: введите значение, указывающее, сколько предыдущих рекомендаций требуется.  По умолчанию этот параметр имеет значение 2, что означает, что элемент должен быть рекомендован по крайней мере двумя другими пользователями.

    Этот параметр следует использовать только в том случае, если оценка выполняется в режиме оценки. Этот параметр недоступен, если выбран вариант **из всех элементов** или **из элементов без оценок (для предложения новых элементов пользователям)**.

9. Для **элементов из категории без оценки (для предложения новых элементов пользователям)** используйте третий входной порт с именем **обучающие данные**, чтобы удалить элементы, которые уже были оценены из результатов прогноза.

    Чтобы применить этот фильтр, Подключите исходный набор данных для обучения с портом ввода.

10. Запустите эксперимент.
### <a name="results-of-item-recommendation"></a>Результаты рекомендации по элементу

Оцененный набор данных, возвращенный с помощью **рекомендаций Wide и Deep** , содержит список рекомендуемых элементов для каждого пользователя.

- Первый столбец содержит идентификаторы пользователей.
- Будет создано несколько дополнительных столбцов в зависимости от значения, заданного для **максимального числа элементов, которое следует рекомендовать пользователю**. Каждый столбец содержит рекомендуемый элемент (по идентификатору). Рекомендации упорядочиваются по сходству пользователей с элементом с наибольшим сходством, размещенным в столбце, **элемент 1**.

> [!WARNING]
> Этот оцененный набор данных нельзя вычислить с помощью модуля " [Оценка](evaluate-recommender.md) программы".

##  <a name="technical-notes"></a>Технические примечания

В этом разделе содержатся ответы на некоторые распространенные вопросы об использовании расширенного & глубоких рекомендаций для создания прогнозов.  

###  <a name="cold-start-users-and-recommendations"></a>Пользователи и рекомендации для холодного запуска

Как правило, для создания рекомендаций модуль **рекомендуемых для оценки и глубокой** практики требует те же входные данные, которые использовались при обучении модели, включая идентификатор пользователя. Это связано с тем, что алгоритму необходимо узнать, изучило ли что-то об этом пользователе во время обучения. 

Однако для новых пользователей может отсутствовать идентификатор пользователя, а только некоторые пользовательские функции, такие как Age, Gender и т. д.

Вы по-прежнему можете создавать рекомендации для новых пользователей в вашей системе, обрабатывая их как *пользователей начального запуска*. Для таких пользователей алгоритм рекомендаций не использует журнал или предыдущие оценки, только характеристики пользователя.

В целях прогнозирования пользователь с именем «холодный запуск» определяется как пользователь с ИДЕНТИФИКАТОРом, который не используется для обучения. Чтобы гарантировать, что идентификаторы не совпадают с идентификаторами, используемыми в обучении, можно создать новые идентификаторы. Например, можно создать случайные идентификаторы в пределах указанного диапазона или выделить серии идентификаторов заранее для пользователей с холодного начала работы.

Однако если у вас нет никаких данных совместной фильтрации, таких как вектор характеристик пользователя, лучше использовать ученика классификации или регрессии.

###  <a name="production-use-of-the-wide-and-deep-recommender"></a>Использование расширенных и глубоких рекомендаций в рабочей среде

Если вы выполнили эксперимент с расширенным и глубоким рекомендацией, а затем перенесите модель в рабочую среду, учитывайте эти ключевые различия при использовании рекомендаций в режиме оценки и в рабочем режиме.

- Для оценки по определению требуется прогнозы, которые можно проверить на соответствие *экспериментальным данным* в тестовом наборе. Таким образом, когда вы оцениваете рекомендатель, он должен прогнозировать только элементы, которые были оценены в тестовом наборе. Это неизбежно ограничивает возможные предсказываемые значения.

    Однако когда вы вводите эту модель в эксплуатацию, то обычно изменяете режим прогнозирования на создание рекомендаций на основе всех возможных элементов для получения наилучшей точности прогнозов. Для многих из этих прогнозов нет соответствующей истинности, поэтому точность рекомендации не может быть проверена так же, как во время эксперимента.

- Если вы не указываете идентификатор пользователя в рабочей среде и предоставляете только характеристический вектор, то можете получить в ответ список всех рекомендаций для всех возможных пользователей. Не забудьте предоставить идентификаторы пользователей.

    Чтобы ограничить количество возвращаемых рекомендаций, можно также указать максимальное количество возвращаемых элементов для пользователя. 



## <a name="next-steps"></a>Дальнейшие действия

См. [набор модулей, доступных](module-reference.md) в машинное обучение Azure. 
