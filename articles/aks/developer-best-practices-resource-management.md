---
title: Рекомендации по управлению ресурсами
titleSuffix: Azure Kubernetes Service
description: Ознакомьтесь с рекомендациями для разработчиков приложений по управлению ресурсами в службе Azure Kubernetes (AKS)
services: container-service
author: zr-msft
ms.topic: conceptual
ms.date: 11/13/2019
ms.author: zarhoads
ms.openlocfilehash: e52bd150f72ba663c504b81832ce83d3e38cbf04
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "90986776"
---
# <a name="best-practices-for-application-developers-to-manage-resources-in-azure-kubernetes-service-aks"></a>Рекомендации для разработчиков приложений по управлению ресурсами в службе Azure Kubernetes (AKS)

В процессе разработки и запуска приложений в службе Azure Kubernetes (AKS) следует учитывать несколько важных моментов. То, как вы управляете развертываниями приложений, может негативно повлиять на восприятие предоставляемых услуг конечными пользователями. Чтобы добиться успеха, следуйте нашим рекомендациям по разработке и запуску приложений в AKS.

В этой статье с рекомендациями рассматривается запуск кластера и рабочих нагрузок с точки зрения разработчика приложения. Рекомендации для администраторов см. в [этой статье][operator-best-practices-isolation]. В этой статье раскрываются следующие темы.

> [!div class="checklist"]
> * Что такое запросы и ограничения ресурсов pod
> * Способы разработки и развертывания приложений с помощью моста для Kubernetes и Visual Studio Code
> * Как использовать средство `kube-advisor` для проверки развертываний на наличие проблем

## <a name="define-pod-resource-requests-and-limits"></a>Определение запросов и ограничений ресурсов pod

**Рекомендация**. Установите запросы и ограничения для всех контейнеров pod в манифестах YAML. При использовании *квот ресурсов* в кластере AKS развертывание может быть отклонено, если вы не определите эти значения.

Основной способ управлять вычислительными ресурсами в кластере AKS — использовать запросы и ограничения pod. Из этих запросов и ограничений планировщик Kubernetes узнает, какие вычислительные ресурсы необходимо назначить контейнерам pod.

* **Запросы ЦП и памяти Pod** определяют определенный объем ресурсов ЦП и памяти, который необходим на регулярной основе.
    * Когда планировщик Kubernetes пытается поместить Pod на узел, для определения узла достаточно ресурсов, доступных для планирования, используются запросы Pod.
    * При отсутствии настройки запрос Pod будет по умолчанию заданный предел.
    * Очень важно отслеживать производительность приложения для настройки этих запросов. В случае недостаточного количества запросов приложение может получить снижение производительности из-за перепланирования узла. Если запросы имеют слишком высокую оценку, возможно, ваше приложение может увеличить сложность.
* **Ограничения ЦП и памяти Pod** — это максимальный объем ресурсов ЦП и памяти, который может использоваться в Pod. Ограничения памяти помогают определить, какие модули в случае нестабильной работы узла должны быть уничтожены из-за недостатка ресурсов. Без соответствующих ограничений набор Pod будет уничтожен до тех пор, пока не будет снято давление ресурсов. Модуль POD может превысить ограничение на использование ЦП в течение определенного периода времени, но модуль Pod не будет завершен для превышения предельного количества ЦП. 
    * Ограничения Pod помогают определить, когда модуль управления теряет потребление ресурсов. При превышении лимита для него назначается приоритет, что позволяет поддерживать работоспособность узла и сократить влияние на модули, совместно использующие этот узел.
    * Если не задать ограничение Pod, по умолчанию он будет иметь наибольшее доступное значение для данного узла.
    * Не разрешайте контейнерам pod использовать больше ресурсов ЦП и памяти, чем могут обеспечить ваши узлы. Каждый узел AKS резервирует определенный объем ресурсов ЦП и памяти для основных компонентов Kubernetes. Использование слишком большого количества ресурсов на узле будет мешать успешному выполнению других контейнеров pod.
    * Опять же, очень важно отслеживать производительность приложения в разное время в течение дня или недели. Определите время пиковой нагрузки и выровняйте ограничения Pod по ресурсам, необходимым для удовлетворения максимальных потребностей приложения.

В спецификациях Pod рекомендуется **и очень важно** определить эти запросы и ограничения на основе приведенных выше сведений. Если эти значения не включены, планировщик Kubernetes не может учитывать ресурсы, необходимые вашим приложениям для принятия решений по планированию.

Если планировщик помещает модуль на узел с недостаточными ресурсами, производительность приложения будет снижена. Настоятельно рекомендуется, чтобы администраторы кластера установили *квоты ресурсов* в пространстве имен, требующем задания запросов и ограничений ресурсов. Дополнительную информацию см. в разделе [Квоты ресурсов в кластерах AKS][resource-quotas].

Когда вы определяете запрос или ограничение по ресурсам ЦП, значение измеряется в единицах ЦП. 
* *1.0* ЦП соответствует одному базовому виртуальному ядру ЦП на узле. 
* Для графических процессоров используется та же единица измерения.
* Можно определить дроби, измеряемые в миллиардах. Например, *100 млн* является *0,1* базового виртуальных ЦП ядра.

В следующем примере pod NGINX запрашивает *100m* времени ЦП и *128Mi* памяти. Ограничения ресурсов для контейнеров pod составляют *250m* ЦП и *256Mi* памяти:

```yaml
kind: Pod
apiVersion: v1
metadata:
  name: mypod
spec:
  containers:
  - name: mypod
    image: nginx:1.15.5
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 250m
        memory: 256Mi
```

Дополнительную информацию об измерениях и назначениях ресурсов см. в разделе [Управление вычислительными ресурсами для контейнеров][k8s-resource-limits].

## <a name="develop-and-debug-applications-against-an-aks-cluster"></a>Разработка и отладка приложений в кластере AKS

**Рекомендации — группы** разработки должны развертывать и выполнять отладку в кластере AKS с помощью моста для Kubernetes.

С помощью моста Kubernetes можно разрабатывать, отлаживать и тестировать приложения непосредственно в кластере AKS. Разработчики в команде работают вместе над созданием и тестированием на протяжении всего жизненного цикла приложения. Вы можете использовать существующие средства, такие как Visual Studio или Visual Studio Code. Расширение устанавливается для моста в Kubernetes, которое позволяет разрабатывать непосредственно в кластере AKS.

Этот интегрированный процесс разработки и тестирования с мостом для Kubernetes снижает потребность в локальных тестовых средах, таких как [minikube][minikube]. Вы разрабатываете и тестируете приложение в кластере AKS. Этот кластер можно защитить и изолировать, как отмечалось в предыдущем разделе об использовании пространств имен для логической изоляции кластера.

Bridge to Kubernetes предназначен для использования с приложениями, которые работают в ОС и узлах Linux.

## <a name="use-the-visual-studio-code-extension-for-kubernetes"></a>Использование расширения Visual Studio Code для Kubernetes

**Рекомендация**. Установите и используйте расширение VS Code для Kubernetes при написании манифестов YAML. Вы также можете использовать расширение для интегрированного решения по развертыванию, которое поможет владельцам приложений, которые редко взаимодействуют с кластером AKS.

[Расширение Visual Studio Code для Kubernetes][vscode-kubernetes] помогает разрабатывать и развертывать приложения в AKS. Расширение предоставляет intellisense для ресурсов Kubernetes, а также диаграммы и шаблоны Helm. Вы также можете просматривать, развертывать и редактировать ресурсы Kubernetes из VS Code. Intellisense также проверяет запросы или ограничения ресурсов, заданные в спецификациях pod:

![Предупреждение расширения VS Code для Kubernetes об отсутствии ограничений памяти](media/developer-best-practices-resource-management/vs-code-kubernetes-extension.png)

## <a name="regularly-check-for-application-issues-with-kube-advisor"></a>Регулярная проверка наличия проблем в приложении с помощью kube-advisor

**Рекомендации —** регулярное выполнение последней версии `kube-advisor` средства с открытым исходным кодом для обнаружения проблем в кластере. Если вы применяете квоты ресурсов в существующем кластере AKS, сначала запустите `kube-advisor`, чтобы найти контейнеры pod без запросов и ограничений ресурсов.

Средство [KUBE-Advisor][kube-advisor] — это связанный проект AKS с открытым исходным кодом, который сканирует кластер Kubernetes и сообщает о найденных проблемах. Полезная проверка — поиск контейнеров pod без установленных запросов и ограничений ресурсов.

Средство kube-advisor может сообщать о запросах на ресурсы и отсутствующих ограничениях в PodSpecs для приложений Windows, а также приложений Linux, но средство kube-advisor должно при этом быть запланировано в объекте pod Linux. Вы можете запланировать запуск объекта pod в пуле узлов с определенной ОС с помощью [селектора узла][k8s-node-selector] в конфигурации объекта pod.

В кластере AKS с большим количеством групп разработчиков и приложений может быть сложно отслеживать контейнеры pod без установленных запросов и ограничений ресурсов. Рекомендуем регулярно запускать `kube-advisor` в кластерах AKS.

## <a name="next-steps"></a>Дальнейшие шаги

В этой статье с рекомендациями мы рассмотрели запуск кластера и рабочих нагрузок с точки зрения оператора кластера. Рекомендации для администраторов см. в [этой статье][operator-best-practices-isolation].

Чтобы реализовать некоторые из этих рекомендаций, ознакомьтесь со следующими статьями:

* [Разработка с помощью моста для Kubernetes][btk]
* [Проверка наличия проблем с помощью kube-advisor][aks-kubeadvisor]

<!-- EXTERNAL LINKS -->
[k8s-resource-limits]: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/
[vscode-kubernetes]: https://github.com/Azure/vscode-kubernetes-tools
[kube-advisor]: https://github.com/Azure/kube-advisor
[minikube]: https://kubernetes.io/docs/setup/minikube/

<!-- INTERNAL LINKS -->
[aks-kubeadvisor]: kube-advisor-tool.md
[btk]: /visualstudio/containers/overview-bridge-to-kubernetes
[operator-best-practices-isolation]: operator-best-practices-cluster-isolation.md
[resource-quotas]: operator-best-practices-scheduler.md#enforce-resource-quotas
[k8s-node-selector]: concepts-clusters-workloads.md#node-selectors
