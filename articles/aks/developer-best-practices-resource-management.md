---
title: Рекомендации для разработчиков по управлению ресурсами в службах Azure Kubernetes (AKS)
description: Ознакомьтесь с рекомендациями для разработчиков приложений по управлению ресурсами в службе Azure Kubernetes (AKS)
services: container-service
author: zr-msft
ms.service: container-service
ms.topic: conceptual
ms.date: 11/13/2019
ms.author: zarhoads
ms.openlocfilehash: bfce7d77f214762a69857e74f0bb533ad1ce0f1b
ms.sourcegitcommit: 598c5a280a002036b1a76aa6712f79d30110b98d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2019
ms.locfileid: "74107638"
---
# <a name="best-practices-for-application-developers-to-manage-resources-in-azure-kubernetes-service-aks"></a>Рекомендации для разработчиков приложений по управлению ресурсами в службе Azure Kubernetes (AKS)

В процессе разработки и запуска приложений в службе Azure Kubernetes (AKS) следует учитывать несколько важных моментов. То, как вы управляете развертываниями приложений, может негативно повлиять на восприятие предоставляемых услуг конечными пользователями. Чтобы добиться успеха, следуйте нашим рекомендациям по разработке и запуску приложений в AKS.

В этой статье с рекомендациями рассматривается запуск кластера и рабочих нагрузок с точки зрения разработчика приложения. Сведения о рекомендациях по администрированию см. в разделе рекомендации [по использованию кластерного оператора для изоляции и управления ресурсами в службе Azure Kubernetes (AKS)][operator-best-practices-isolation]. В этой статье раскрываются следующие темы.

> [!div class="checklist"]
> * Что такое запросы и ограничения ресурсов pod
> * Способы разработки и развертывания приложений с помощью Dev Spaces и Visual Studio Code
> * Как использовать средство `kube-advisor` для проверки развертываний на наличие проблем

## <a name="define-pod-resource-requests-and-limits"></a>Определение запросов и ограничений ресурсов pod

**Рекомендация**. Установите запросы и ограничения для всех контейнеров pod в манифестах YAML. При использовании *квот ресурсов* в кластере AKS развертывание может быть отклонено, если вы не определите эти значения.

Основной способ управлять вычислительными ресурсами в кластере AKS — использовать запросы и ограничения pod. Из этих запросов и ограничений планировщик Kubernetes узнает, какие вычислительные ресурсы необходимо назначить контейнерам pod.

* **Запросы ЦП и памяти Pod** определяют определенный объем ресурсов ЦП и памяти, который необходим на регулярной основе.
    * Когда планировщик Kubernetes пытается поместить Pod на узел, для определения узла достаточно ресурсов, доступных для планирования, используются запросы Pod.
    * При отсутствии настройки запрос Pod будет по умолчанию заданный предел.
    * Очень важно отслеживать производительность приложения для настройки этих запросов. В случае недостаточного количества запросов приложение может получить снижение производительности из-за перепланирования узла. Если запросы имеют слишком высокую оценку, возможно, ваше приложение может увеличить сложность.
* **Ограничения ЦП и памяти Pod** — это максимальный объем ресурсов ЦП и памяти, который может использоваться в Pod. Эти ограничения помогают определить, какие модули в случае нестабильной работы узла должны быть уничтожены из-за недостатка ресурсов. Без соответствующих ограничений набор Pod будет уничтожен до тех пор, пока не будет снято давление ресурсов.
    * Ограничения Pod помогают определить, когда Pod теряет Управление потреблением ресурсов. При превышении лимита для него назначается приоритет, что позволяет поддерживать работоспособность узла и сократить влияние на модули, совместно использующие этот узел.
    * Если не задать ограничение Pod, по умолчанию он будет иметь наибольшее доступное значение для данного узла.
    * Не разрешайте контейнерам pod использовать больше ресурсов ЦП и памяти, чем могут обеспечить ваши узлы. Каждый узел AKS резервирует определенный объем ресурсов ЦП и памяти для основных компонентов Kubernetes. Использование слишком большого количества ресурсов на узле будет мешать успешному выполнению других контейнеров pod.
    * Опять же, очень важно отслеживать производительность приложения в разное время в течение дня или недели. Определите время пиковой нагрузки и выровняйте ограничения Pod по ресурсам, необходимым для удовлетворения максимальных потребностей приложения.

В спецификациях Pod рекомендуется **и очень важно** определить эти запросы и ограничения на основе приведенных выше сведений. Если эти значения не включены, планировщик Kubernetes не может учитывать ресурсы, необходимые вашим приложениям для принятия решений по планированию.

Если планировщик помещает модуль на узел с недостаточными ресурсами, производительность приложения будет снижена. Настоятельно рекомендуется, чтобы администраторы кластера установили *квоты ресурсов* в пространстве имен, требующем задания запросов и ограничений ресурсов. Дополнительные сведения см. [в статье квоты ресурсов для кластеров AKS][resource-quotas].

Когда вы определяете запрос или ограничение по ресурсам ЦП, значение измеряется в единицах ЦП. 
* *1.0* ЦП соответствует одному базовому виртуальному ядру ЦП на узле. 
* Для графических процессоров используется та же единица измерения.
* Можно определить дроби, измеряемые в миллиардах. Например, *100 млн* является *0,1* базового виртуальных ЦП ядра.

В следующем примере pod NGINX запрашивает *100m* времени ЦП и *128Mi* памяти. Ограничения ресурсов для контейнеров pod составляют *250m* ЦП и *256Mi* памяти:

```yaml
kind: Pod
apiVersion: v1
metadata:
  name: mypod
spec:
  containers:
  - name: mypod
    image: nginx:1.15.5
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 250m
        memory: 256Mi
```

Дополнительные сведения об измерениях и назначениях ресурсов см. в разделе [Управление ресурсами вычислений для контейнеров][k8s-resource-limits].

## <a name="develop-and-debug-applications-against-an-aks-cluster"></a>Разработка и отладка приложений в кластере AKS

**Рекомендация**. Команды разработчиков должны развертывать и отлаживать приложения в кластере AKS, используя Dev Spaces. Эта модель разработки гарантирует реализацию требований к элементам управления доступом на основе ролей, сети или хранилищу перед развертыванием приложения в рабочей среде.

Azure Dev Spaces позволяет разрабатывать, отлаживать и тестировать приложения непосредственно в кластере AKS. Разработчики в команде работают вместе над созданием и тестированием на протяжении всего жизненного цикла приложения. Вы можете использовать существующие средства, такие как Visual Studio или Visual Studio Code. Установив расширение Dev Spaces, вы сможете выполнять и отлаживать приложение в кластере AKS:

![Отладка приложений в кластере AKS с помощью Dev Spaces](media/developer-best-practices-resource-management/dev-spaces-debug.png)

Этот интегрированный процесс разработки и тестирования с использованием пространств разработки сокращает потребность в локальных тестовых средах, таких как [minikube][minikube]. Вы разрабатываете и тестируете приложение в кластере AKS. Этот кластер можно защитить и изолировать, как отмечалось в предыдущем разделе об использовании пространств имен для логической изоляции кластера. Когда ваши приложения будут готовы к развертыванию в рабочей среде, можете уверенно их развертывать, так как разработка выполнялась в реальном кластере AKS.

Azure Dev Spaces предназначен для использования с приложениями, которые выполняются на узлах и в среде Linux.

## <a name="use-the-visual-studio-code-extension-for-kubernetes"></a>Использование расширения Visual Studio Code для Kubernetes

**Рекомендация**. Установите и используйте расширение VS Code для Kubernetes при написании манифестов YAML. Вы также можете использовать расширение для интегрированного решения по развертыванию, которое поможет владельцам приложений, которые редко взаимодействуют с кластером AKS.

[Расширение Visual Studio Code для Kubernetes][vscode-kubernetes] помогает разрабатывать и развертывать приложения для AKS. Расширение предоставляет intellisense для ресурсов Kubernetes, а также диаграммы и шаблоны Helm. Вы также можете просматривать, развертывать и редактировать ресурсы Kubernetes из VS Code. Intellisense также проверяет запросы или ограничения ресурсов, заданные в спецификациях pod:

![Предупреждение расширения VS Code для Kubernetes об отсутствии ограничений памяти](media/developer-best-practices-resource-management/vs-code-kubernetes-extension.png)

## <a name="regularly-check-for-application-issues-with-kube-advisor"></a>Регулярная проверка наличия проблем в приложении с помощью kube-advisor

**Рекомендации.** регулярно запускайте последнюю версию средства `kube-advisor` с открытым исходным кодом для обнаружения проблем в кластере. Если вы применяете квоты ресурсов в существующем кластере AKS, сначала запустите `kube-advisor`, чтобы найти контейнеры pod без запросов и ограничений ресурсов.

Средство [KUBE-Advisor][kube-advisor] — это связанный проект AKS с открытым исходным кодом, который сканирует кластер Kubernetes и сообщает о найденных проблемах. Полезная проверка — поиск контейнеров pod без установленных запросов и ограничений ресурсов.

Средство KUBE-Advisor может сообщать о запросах ресурсов и ограничениях, отсутствующих в Подспекс для приложений Windows, а также в приложениях Linux, но само средство KUBE Advisor должно быть запланировано на Pod Linux. Вы можете запланировать запуск модуля Pod в пуле узлов с определенной ОС с помощью [селектора узла][k8s-node-selector] в конфигурации Pod.

В кластере AKS с большим количеством групп разработчиков и приложений может быть сложно отслеживать контейнеры pod без установленных запросов и ограничений ресурсов. Рекомендуем регулярно запускать `kube-advisor` в кластерах AKS.

## <a name="next-steps"></a>Дополнительная информация

В этой статье с рекомендациями мы рассмотрели запуск кластера и рабочих нагрузок с точки зрения оператора кластера. Сведения о рекомендациях по администрированию см. в разделе рекомендации [по использованию кластерного оператора для изоляции и управления ресурсами в службе Azure Kubernetes (AKS)][operator-best-practices-isolation].

Чтобы реализовать некоторые из этих рекомендаций, ознакомьтесь со следующими статьями:

* [Рабочие среды Azure для разработчиков][dev-spaces]
* [Проверка на наличие проблем с KUBE-Advisor][aks-kubeadvisor]

<!-- EXTERNAL LINKS -->
[k8s-resource-limits]: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/
[vscode-kubernetes]: https://github.com/Azure/vscode-kubernetes-tools
[kube-advisor]: https://github.com/Azure/kube-advisor
[minikube]: https://kubernetes.io/docs/setup/minikube/

<!-- INTERNAL LINKS -->
[aks-kubeadvisor]: kube-advisor-tool.md
[dev-spaces]: ../dev-spaces/get-started-netcore.md
[operator-best-practices-isolation]: operator-best-practices-cluster-isolation.md
[resource-quotas]: operator-best-practices-scheduler.md#enforce-resource-quotas
[k8s-node-selector]: concepts-clusters-workloads.md#node-selectors
