---
title: Рекомендации для разработчиков по управлению ресурсами в службах Azure Kubernetes (AKS)
description: Ознакомьтесь с рекомендациями для разработчиков приложений по управлению ресурсами в службе Azure Kubernetes (AKS)
services: container-service
author: zr-msft
ms.service: container-service
ms.topic: conceptual
ms.date: 11/26/2018
ms.author: zarhoads
ms.openlocfilehash: aebade14f3a8a1095925d17325ce99b78031dc32
ms.sourcegitcommit: 563f8240f045620b13f9a9a3ebfe0ff10d6787a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2019
ms.locfileid: "58757248"
---
# <a name="best-practices-for-application-developers-to-manage-resources-in-azure-kubernetes-service-aks"></a>Рекомендации для разработчиков приложений по управлению ресурсами в службе Azure Kubernetes (AKS)

В процессе разработки и запуска приложений в службе Azure Kubernetes (AKS) следует учитывать несколько важных моментов. То, как вы управляете развертываниями приложений, может негативно повлиять на восприятие предоставляемых услуг конечными пользователями. Чтобы добиться успеха, следуйте нашим рекомендациям по разработке и запуску приложений в AKS.

В этой статье с рекомендациями рассматривается запуск кластера и рабочих нагрузок с точки зрения разработчика приложения. Рекомендации для администраторов см. в [этой статье][operator-best-practices-isolation]. В этой статье раскрываются следующие темы.

> [!div class="checklist"]
> * Что такое запросы и ограничения ресурсов pod
> * Способы разработки и развертывания приложений с помощью Dev Spaces и Visual Studio Code
> * Как использовать средство `kube-advisor` для проверки развертываний на наличие проблем

## <a name="define-pod-resource-requests-and-limits"></a>Определение запросов и ограничений ресурсов pod

**Рекомендация**. Установите запросы и ограничения для всех контейнеров pod в манифестах YAML. При использовании *квот ресурсов* в кластере AKS развертывание может быть отклонено, если вы не определите эти значения.

Основной способ управлять вычислительными ресурсами в кластере AKS — использовать запросы и ограничения pod. Из этих запросов и ограничений планировщик Kubernetes узнает, какие вычислительные ресурсы необходимо назначить контейнерам pod.

* **Запросы pod** определяют объем ресурсов ЦП и памяти, необходимый контейнерам pod. Эти запросы определяют объем вычислительных ресурсов, необходимый контейнерам pod для обеспечения приемлемого уровня производительности.
    * Когда планировщик Kubernetes пытается разместить контейнеры pod на узле, запросы pod используются для определения узла с достаточным объемом ресурсов.
    * Контролируйте производительность приложения и настраивайте эти запросы, чтобы выделяемых ресурсов было достаточно для поддержания приемлемого уровня производительности.
* **Ограничения pod** — максимальный объем ресурсов ЦП и памяти, который могут использовать контейнеры pod. Эти ограничения помогают предотвратить чрезмерное использование ресурсов ЦП и памяти одним или двумя неуправляемыми контейнерами pod. Этот сценарий снизит производительность узла и других запущенных на нем контейнеров pod.
    * Не разрешайте контейнерам pod использовать больше ресурсов ЦП и памяти, чем могут обеспечить ваши узлы. Каждый узел AKS резервирует определенный объем ресурсов ЦП и памяти для основных компонентов Kubernetes. Использование слишком большого количества ресурсов на узле будет мешать успешному выполнению других контейнеров pod.
    * Контролируйте производительность своего приложения в разное время в течение дня или недели. Определите пиковое потребление и согласуйте ограничения pod с ресурсами, необходимыми для удовлетворения потребностей приложения.

Рекомендуем определить эти запросы и ограничения в спецификациях pod. Если вы не включите эти значения, планировщик Kubernetes не будет знать, какие ресурсы необходимы. Планировщик может запланировать запуск контейнеров pod на узле без достаточных ресурсов для обеспечения приемлемой производительности приложения. Администратор кластера может установить *квоты ресурсов* для пространства имен, и вам потребуется установить запросы и ограничения ресурсов. Дополнительную информацию см. в разделе [Квоты ресурсов в кластерах AKS][resource-quotas].

Когда вы определяете запрос или ограничение по ресурсам ЦП, значение измеряется в единицах ЦП. *1.0* ЦП соответствует одному базовому виртуальному ядру ЦП на узле. Для графических процессоров используется та же единица измерения. Вы также можете определить дробный запрос или ограничение, как правило, в millicpu. Например, *100m* — это *0,1* базового виртуального ядра ЦП.

В следующем примере pod NGINX запрашивает *100m* времени ЦП и *128Mi* памяти. Ограничения ресурсов для контейнеров pod составляют *250m* ЦП и *256Mi* памяти:

```yaml
kind: Pod
apiVersion: v1
metadata:
  name: mypod
spec:
  containers:
  - name: mypod
    image: nginx:1.15.5
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 250m
        memory: 256Mi
```

Дополнительную информацию об измерениях и назначениях ресурсов см. в разделе [Управление вычислительными ресурсами для контейнеров][k8s-resource-limits].

## <a name="develop-and-debug-applications-against-an-aks-cluster"></a>Разработка и отладка приложений в кластере AKS

**Рекомендация**. Команды разработчиков должны развертывать и отлаживать приложения в кластере AKS, используя Dev Spaces. Эта модель разработки гарантирует реализацию требований к элементам управления доступом на основе ролей, сети или хранилищу перед развертыванием приложения в рабочей среде.

Azure Dev Spaces позволяет разрабатывать, отлаживать и тестировать приложения непосредственно в кластере AKS. Разработчики в команде работают вместе над созданием и тестированием на протяжении всего жизненного цикла приложения. Вы можете использовать существующие средства, такие как Visual Studio или Visual Studio Code. Установив расширение Dev Spaces, вы сможете выполнять и отлаживать приложение в кластере AKS:

![Отладка приложений в кластере AKS с помощью Dev Spaces](media/developer-best-practices-resource-management/dev-spaces-debug.png)

Этот интегрированный процесс разработки и тестирования с помощью Dev Spaces избавляет от необходимости использовать локальные среды тестирования, такие как [minikube][minikube]. Вы разрабатываете и тестируете приложение в кластере AKS. Этот кластер можно защитить и изолировать, как отмечалось в предыдущем разделе об использовании пространств имен для логической изоляции кластера. Когда ваши приложения будут готовы к развертыванию в рабочей среде, можете уверенно их развертывать, так как разработка выполнялась в реальном кластере AKS.

## <a name="use-the-visual-studio-code-extension-for-kubernetes"></a>Использование расширения Visual Studio Code для Kubernetes

**Рекомендация**. Установите и используйте расширение VS Code для Kubernetes при написании манифестов YAML. Вы также можете использовать расширение для интегрированного решения по развертыванию, которое поможет владельцам приложений, которые редко взаимодействуют с кластером AKS.

[Расширение Visual Studio Code для Kubernetes][vscode-kubernetes] помогает разрабатывать и развертывать приложения в AKS. Расширение предоставляет intellisense для ресурсов Kubernetes, а также диаграммы и шаблоны Helm. Вы также можете просматривать, развертывать и редактировать ресурсы Kubernetes из VS Code. Intellisense также проверяет запросы или ограничения ресурсов, заданные в спецификациях pod:

![Предупреждение расширения VS Code для Kubernetes об отсутствии ограничений памяти](media/developer-best-practices-resource-management/vs-code-kubernetes-extension.png)

## <a name="regularly-check-for-application-issues-with-kube-advisor"></a>Регулярная проверка наличия проблем в приложении с помощью kube-advisor

**Советы и рекомендации** -регулярно запускать последнюю версию `kube-advisor` инструмент с открытым кодом для обнаружения проблем в кластере. Если вы применяете квоты ресурсов в существующем кластере AKS, сначала запустите `kube-advisor`, чтобы найти контейнеры pod без запросов и ограничений ресурсов.

[Kube-advisor] [ kube-advisor] средство — связанный проект с открытым кодом AKS, просматривают кластер Kubernetes и сообщают о проблемах, которые она находит. Полезная проверка — поиск контейнеров pod без установленных запросов и ограничений ресурсов.

В кластере AKS с большим количеством групп разработчиков и приложений может быть сложно отслеживать контейнеры pod без установленных запросов и ограничений ресурсов. Рекомендуем регулярно запускать `kube-advisor` в кластерах AKS.

## <a name="next-steps"></a>Дальнейшие действия

В этой статье с рекомендациями мы рассмотрели запуск кластера и рабочих нагрузок с точки зрения оператора кластера. Рекомендации для администраторов см. в [этой статье][operator-best-practices-isolation].

Чтобы реализовать некоторые из этих рекомендаций, ознакомьтесь со следующими статьями:

* [Разработка с помощью Dev Spaces][dev-spaces]
* [Проверка наличия проблем с помощью kube-advisor][aks-kubeadvisor]

<!-- EXTERNAL LINKS -->
[k8s-resource-limits]: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/
[vscode-kubernetes]: https://github.com/Azure/vscode-kubernetes-tools
[kube-advisor]: https://github.com/Azure/kube-advisor
[minikube]: https://kubernetes.io/docs/setup/minikube/

<!-- INTERNAL LINKS -->
[aks-kubeadvisor]: kube-advisor-tool.md
[dev-spaces]: ../dev-spaces/get-started-netcore.md
[operator-best-practices-isolation]: operator-best-practices-cluster-isolation.md
[resource-quotas]: operator-best-practices-scheduler.md#enforce-resource-quotas
