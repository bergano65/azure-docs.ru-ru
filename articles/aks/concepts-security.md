---
title: Основные понятия безопасности в Службе Azure Kubernetes (AKS)
description: Узнайте о безопасности в Службе Azure Kubernetes (AKS), включая взаимодействие главных компонентов и узлов, политики сети и секреты Kubernetes.
services: container-service
author: mlearned
ms.topic: conceptual
ms.date: 07/01/2020
ms.author: mlearned
ms.openlocfilehash: a0fe0803b0961b3aaa89627823b4867fac0d5d61
ms.sourcegitcommit: 3541c9cae8a12bdf457f1383e3557eb85a9b3187
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2020
ms.locfileid: "86206317"
---
# <a name="security-concepts-for-applications-and-clusters-in-azure-kubernetes-service-aks"></a>Основные понятия безопасности приложений и кластеров в Службе Azure Kubernetes (AKS)

Чтобы защитить данные клиентов при выполнении рабочих нагрузок приложений в Службе Azure Kubernetes (AKS), в первую очередь следует обеспечить безопасность кластера. Kubernetes включает в себя компоненты системы безопасности, такие как *политики сети* и *секреты*. Azure добавляет такие компоненты, как группы безопасности сети и управляемые обновления кластера. Эти компоненты системы безопасности используются совместно, чтобы обеспечить работу кластера AKS с использованием последних обновлений безопасности операционной системы и выпусков Kubernetes, а также защитить трафик pod и доступ к конфиденциальным учетным данным.

В этой статье приводится обзор ключевых понятий безопасности приложений в AKS:

- [Основные понятия безопасности для приложений и кластеров в Службе Azure Kubernetes (AKS)](#security-concepts-for-applications-and-clusters-in-azure-kubernetes-service-aks)
  - [Безопасность главных компонентов](#master-security)
  - [безопасность узлов](#node-security);
    - [Изоляция вычислений](#compute-isolation)
  - [Обновления кластера](#cluster-upgrades)
    - [Блокировка и остановка](#cordon-and-drain)
  - [Безопасность сети](#network-security)
    - [Группы безопасности сети Azure](#azure-network-security-groups)
  - [секреты Kubernetes](#kubernetes-secrets).
  - [Следующие шаги](#next-steps)

## <a name="master-security"></a>Безопасность главных компонентов

В AKS главные компоненты Kubernetes являются частью управляемой службы, предоставляемой корпорацией Майкрософт. У каждого кластера AKS есть выделенный главный экземпляр Kubernetes с одним клиентом, обеспечивающий работу сервера API, планировщика и т. д. Управление этим главным экземпляром и его обслуживание осуществляет корпорация Майкрософт.

По умолчанию сервер API Kubernetes использует общедоступный IP-адрес и полное доменное имя (FQDN). Вы можете ограничить доступ к конечной точке сервера API, используя [диапазоны разрешенных IP-адресов][authorized-ip-ranges]. Кроме того, можно создать полностью [частный кластер][private-clusters], чтобы ограничить доступ сервера API к виртуальной сети.

Вы можете управлять доступом к серверу API с помощью управления доступом на основе ролей Kubernetes и Azure Active Directory. Дополнительные сведения см. в статье об [интеграции Azure AD с AKS][aks-aad].

## <a name="node-security"></a>Безопасность узлов

Узлы AKS — это виртуальные машины Azure, которыми вы управляете и которые вы обслуживаете. В узлах Linux используется оптимизированный дистрибутив Ubuntu со средой выполнения контейнеров Moby. Узлы Windows Server используют оптимизированный выпуск Windows Server 2019, а также среду выполнения контейнеров Moby. При создании или масштабировании кластера AKS узлы автоматически развертываются с последними обновлениями и конфигурациями безопасности операционной системы.

Каждую ночь платформа Azure автоматически применяет исправления системы безопасности операционной системы к узлам Linux. Если для установки обновления операционной системы Linux требуется перезагрузка узла, она не выполняется автоматически. Вы можете вручную перезагрузить узлы Linux, но, как правило, для этого используется [Kured][kured] — управляющая программа перезагрузки с открытым кодом для Kubernetes. Kured работает в виде [DaemonSet][aks-daemonsets] и проверяет каждый узел на наличие файла, указывающего на необходимость перезагрузки. Для управления перезагрузками в кластере используется тот же [процесс блокировки и остановки](#cordon-and-drain), что и при обновлении кластера.

Для узлов Windows Server Центр обновления Windows не выполняет автоматический запуск и применение последних обновлений. Вам необходимо выполнять обновление пулов узлов Windows Server в кластере AKS по регулярному расписанию, основанному на цикле выпуска Центра обновления Windows и вашем собственном процессе проверки. При обновлении создаются узлы, в которых запускается последняя версия образа и исправления Windows Server. Затем более старые версии узлов удаляются. Дополнительные сведения об обновлении пула узлов в AKS см. в [этой статье][nodepool-upgrade].

Узлы развертываются в подсети частной виртуальной сети без назначения общедоступных IP-адресов. В целях устранения неполадок и управления по умолчанию включен протокол SSH. Этот протокол обеспечивает доступ только при использовании внутреннего IP-адреса.

Для хранения данных узлы используют Управляемые диски Azure. Для большинства размеров узлов виртуальных машин используются высокоскоростные диски SSD ценовой категории "Премиум". Неактивные данные, хранящиеся на управляемых дисках, автоматически шифруются платформой Azure. Для повышения избыточности эти диски также безопасно реплицируются в центре обработки данных Azure.

Среды Kubernetes в AKS или в другой службе сейчас не полностью безопасны для использования в неблагоприятных мультитенантных средах. Дополнительные функциональные возможности безопасности, такие как *политики безопасности pod* или более точные элементы управления доступом на основе ролей (RBAC) для узлов усложняют эксплойты. Однако для обеспечения полноценной безопасности при выполнении неблагоприятных мультитенантных рабочих нагрузок гипервизор является единственным уровнем безопасности, которому следует доверять. Домен безопасности для Kubernetes становится целым кластером, а не отдельным узлом. Для таких типов неблагоприятных мультитенантных рабочих нагрузок следует использовать физически изолированные кластеры. Дополнительные сведения о способах изоляции рабочих нагрузок см. в разделе рекомендации [по изоляции кластера в AKS][cluster-isolation].

### <a name="compute-isolation"></a>Изоляция вычислений

 Некоторые рабочие нагрузки могут потребовать высокой степени изоляции от других рабочих нагрузок клиентов из-за соответствия требованиям или соблюдению нормативных требований. Для этих рабочих нагрузок Azure предоставляет [изолированные виртуальные машины](../virtual-machines/linux/isolation.md), которые можно использовать в качестве узлов агентов в кластере AKS. Эти изолированные виртуальные машины изолированы относительно определенного типа оборудования и предназначены для одного клиента. 

 Чтобы использовать эти изолированные виртуальные машины с кластером AKS, выберите один из перечисленных [ниже](../virtual-machines/linux/isolation.md) размеров изолированных виртуальных машин в качестве **размера узла** при создании кластера AKS или добавлении пула узлов.


## <a name="cluster-upgrades"></a>Обновления кластера

Чтобы обеспечить безопасность и соответствие или использование последних компонентов, платформа Azure предоставляет инструменты для оркестрации обновления кластера AKS и его компонентов. Эта оркестрация охватывает главные компоненты и компоненты агента Kubernetes. Вы можете просмотреть [список доступных версий Kubernetes](supported-kubernetes-versions.md) для кластера AKS. Чтобы начать обновление, следует указать одну из этих доступных версий. Затем Azure безопасно заблокирует и остановит каждый узел AKS и выполнит обновление.

### <a name="cordon-and-drain"></a>Блокировка и остановка

При обновлении узлы AKS в кластере по отдельности блокируются, чтобы на них не планировался запуск новых элементов pod. Затем узлы останавливаются и обновляются, как показано ниже.

- В пуле узлов развертывается новый узел. В этом узле выполняется последняя версия образа ОС и его исправления.
- Один из существующих узлов выбирается для обновления. Работа модулей pod в этом узле корректно завершается и планируется в других узлах пула.
- Этот существующий узел удаляется из кластера AKS.
- Затем блокируется и останавливается следующий узел в кластере. Процесс повторяется, пока все узлы не будут заменены в процессе обновления.

Дополнительные сведения см. в статье [Обновление кластера службы Azure Kubernetes (AKS)][aks-upgrade-cluster].

## <a name="network-security"></a>Безопасность сети

Для подключения к локальным сетям и обеспечения безопасности можно развернуть кластер AKS в имеющейся подсети виртуальной сети Azure. Эти виртуальные сети могут использовать VPN-подключение Azure типа "сеть – сеть" или подключение ExpressRoute к локальной сети. Для контроллеров входящего трафика Kubernetes можно определить частные внутренние IP-адреса, чтобы службы были доступны только через это подключение к внутренней сети.

### <a name="azure-network-security-groups"></a>Группы безопасности сети Azure

Чтобы фильтровать поток трафика в виртуальных сетях, платформа Azure использует правила групп безопасности сети. Эти правила определяют диапазоны IP-адресов источника и назначения, порты и протоколы, использование которых разрешено или запрещено для доступа к ресурсам. Чтобы разрешить трафик TLS для сервера API Kubernetes, создаются правила по умолчанию. При создании служб с подсистемами балансировки нагрузки, сопоставлением портов или входящими маршрутами AKS автоматически изменяет группу безопасности сети, чтобы трафик передавался соответствующим образом.

### <a name="kubernetes-network-policy"></a>Политика сети Kubernetes

Чтобы ограничить сетевой трафик между модулями pod в кластере, AKS предлагает поддержку [политик сети Kubernetes][network-policy]. С помощью политик сети можно разрешить или запретить определенные сетевые пути в кластере на основе пространств имен и селекторов меток.

## <a name="kubernetes-secrets"></a>Секреты Kubernetes

*Секрет* Kubernetes используется для внедрения в элементы pod конфиденциальных данных, например учетных данных или ключей доступа. Сначала создается Secret с помощью API Kubernetes. При определении pod или развертывания можно запросить определенный Secret. Secret предоставляются только узлам, на которых запланирован запуск элемента pod, требующего этот Secret. Secret сохраняется в *tmpfs*, а не записывается на диск. При удалении с узла последнего pod, которому нужен секрет, данный Secret удаляется из tmpfs. Тома Secret хранятся в указанном пространстве имен и доступны только элементам pod в этом пространстве имен.

Использование секретов уменьшает объем конфиденциальных сведений, определяемых в pod или YAML-файле манифеста службы. Вместо этого запрашивается секрет, хранимый на сервере API Kubernetes в YAML-файле манифеста. Это позволяет предоставлять секрет только определенным элементам pod. Примечание. Необработанные файлы манифеста секрета содержат данные секретов в формате Base64 (дополнительные сведения см. в [официальной документации][secret-risks]). Поэтому этот файл следует считать конфиденциальной информацией. Его нельзя передавать в систему управления версиями.

Секреты Kubernetes хранятся в etcd, распределенном хранилище "ключ — значение". Хранилище Etcd полностью управляется с помощью AKS, и [данные шифруются при хранении в пределах платформы Azure][encryption-atrest]. 

## <a name="next-steps"></a>Дальнейшие действия

Чтобы приступить к защите кластеров AKS, ознакомьтесь со статьей об [обновлении кластера AKS][aks-upgrade-cluster].

См. соответствующие рекомендации [по обеспечению безопасности и обновлению кластера в AKS][operator-best-practices-cluster-security] и [обеспечению безопасности модулей pod в AKS][developer-best-practices-pod-security].

Дополнительные сведения о ключевых концепциях Kubernetes и AKS вы получите в следующих статьях:

- [Кластеры и рабочие нагрузки Kubernetes и AKS][aks-concepts-clusters-workloads]
- [Идентификация в Kubernetes и AKS][aks-concepts-identity]
- [Виртуальные сети Kubernetes и AKS][aks-concepts-network]
- [Хранилище Kubernetes и AKS][aks-concepts-storage]
- [Масштабирование Kubernetes и AKS][aks-concepts-scale]

<!-- LINKS - External -->
[kured]: https://github.com/weaveworks/kured
[kubernetes-network-policies]: https://kubernetes.io/docs/concepts/services-networking/network-policies/
[secret-risks]: https://kubernetes.io/docs/concepts/configuration/secret/#risks
[encryption-atrest]: https://docs.microsoft.com/azure/security/fundamentals/encryption-atrest

<!-- LINKS - Internal -->
[aks-daemonsets]: concepts-clusters-workloads.md#daemonsets
[aks-upgrade-cluster]: upgrade-cluster.md
[aks-aad]: azure-ad-integration.md
[aks-concepts-clusters-workloads]: concepts-clusters-workloads.md
[aks-concepts-identity]: concepts-identity.md
[aks-concepts-scale]: concepts-scale.md
[aks-concepts-storage]: concepts-storage.md
[aks-concepts-network]: concepts-network.md
[cluster-isolation]: operator-best-practices-cluster-isolation.md
[operator-best-practices-cluster-security]: operator-best-practices-cluster-security.md
[developer-best-practices-pod-security]:developer-best-practices-pod-security.md
[nodepool-upgrade]: use-multiple-node-pools.md#upgrade-a-node-pool
[authorized-ip-ranges]: api-server-authorized-ip-ranges.md
[private-clusters]: private-clusters.md
[network-policy]: use-network-policies.md
