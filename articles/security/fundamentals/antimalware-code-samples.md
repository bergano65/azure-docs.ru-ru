---
title: Примеры кода антивредоносного по Майкрософт для Azure | Документация Майкрософт
description: Примеры кода PowerShell для включения и настройки антивредоносного по Майкрософт.
services: security
documentationcenter: na
author: terrylanfear
manager: rkarlin
editor: ''
ms.assetid: 265683c8-30d7-4f2b-b66c-5082a18f7a8b
ms.service: security
ms.subservice: security-fundamentals
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 11/04/2020
ms.author: terrylan
ms.openlocfilehash: 23e1960e1719ed5cb72e418a84286a999b75136f
ms.sourcegitcommit: 6a902230296a78da21fbc68c365698709c579093
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/05/2020
ms.locfileid: "93364979"
---
# <a name="enable-and-configure-microsoft-antimalware-for-azure-resource-manager-vms"></a>Включение и настройка антивредоносного по Майкрософт для Azure Resource Manager виртуальных машин
Вы можете включить и настроить антивредоносное по Майкрософт для Azure Resource Manager виртуальных машин. В этой статье приведены примеры кода с помощью командлетов PowerShell.

## <a name="deploy-microsoft-antimalware-on-azure-resource-manager-vms"></a>Развертывание антивредоносного по Майкрософт на Azure Resource Manager виртуальных машинах

> [!NOTE]
> Перед выполнением этого примера кода необходимо раскомментировать переменные и предоставить соответствующие значения.

```powershell
# Script to add Microsoft Antimalware extension to Azure Resource Manager VMs
# Specify your subscription ID
$subscriptionId= " SUBSCRIPTION ID HERE "
# specify location, resource group, and VM for the extension
$location = " LOCATION HERE " # eg., “Southeast Asia” or “Central US”
$resourceGroupName = " RESOURCE GROUP NAME HERE "
$vmName = " VM NAME HERE "

# Enable Antimalware with default policies
$settingString = ‘{"AntimalwareEnabled": true}’;
# Enable Antimalware with custom policies
# $settingString = ‘{
# "AntimalwareEnabled": true,
# "RealtimeProtectionEnabled": true,
# "ScheduledScanSettings": {
#                             "isEnabled": true,
#                             "day": 0,
#                             "time": 120,
#                             "scanType": "Quick"
#                             },
# "Exclusions": {
#            "Extensions": ".ext1,.ext2",
#                  "Paths":"",
#                  "Processes":"sampl1e1.exe, sample2.exe"
#             },
# "SignatureUpdates": {
#                               "FileSharesSources": “”,
#                               "FallbackOrder”: “”,
#                               "ScheduleDay": 0,
#                               "UpdateInterval": 0,
#                       },
# "CloudProtection": true         
#
# }’;
# Login to your Azure Resource Manager Account and select the Subscription to use
Login-AzureRmAccount
 
Select-AzureRmSubscription -SubscriptionId $subscriptionId
# retrieve the most recent version number of the extension
$allVersions= (Get-AzureRmVMExtensionImage -Location $location -PublisherName “Microsoft.Azure.Security” -Type “IaaSAntimalware”).Version
$versionString = $allVersions[($allVersions.count)-1].Split(“.”)[0] + “.” + $allVersions[($allVersions.count)-1].Split(“.”)[1]
# set the extension using prepared values
# ****—-Use this script till cmdlets address the -SettingsString format issue we observed ****—-
Set-AzureRmVMExtension -ResourceGroupName $resourceGroupName -Location $location -VMName $vmName -Name "IaaSAntimalware" -Publisher “Microsoft.Azure.Security” -ExtensionType “IaaSAntimalware” -TypeHandlerVersion $versionString -SettingString $settingString  
```

## <a name="add-microsoft-antimalware-to-azure-service-fabric-clusters"></a>Добавление антивредоносного по Майкрософт в кластеры Service Fabric Azure
Azure Service Fabric использует масштабируемые наборы виртуальных машин Azure для создания кластеров Service Fabric. В настоящее время шаблон масштабируемых наборов виртуальных машин, используемый для создания кластеров Service Fabric, не включен с расширением антивредоносного по. Таким образом, антивредоносная программа должна быть включена отдельно в масштабируемых наборах. При включении в масштабируемые наборы все узлы, созданные в масштабируемых наборах виртуальных машин, наследуют и получают расширение автоматически.

В примере кода ниже показано, как включить расширение для защиты от вредоносных программ IaaS с помощью командлетов AzureRmVmss PS.

> [!NOTE]
> Перед выполнением этого примера кода необходимо раскомментировать переменные и предоставить соответствующие значения.

```powershell
# Script to add Microsoft Antimalware extension to VM Scale Set(VMSS) and Service Fabric Cluster(in turn it used VMSS)
# Login to your Azure Resource Manager Account and select the Subscription to use
Login-AzureRmAccount
# Specify your subscription ID
$subscriptionId="SUBSCRIPTION ID HERE"
Select-AzureRmSubscription -SubscriptionId $subscriptionId
# Specify location, resource group, and VM Scaleset for the extension
$location = "LOCATION HERE" # eg., “West US or Southeast Asia” or “Central US”
$resourceGroupName = "RESOURCE GROUP NAME HERE"
$vmScaleSetName = "YOUR VM SCALE SET NAME"

# Configuration.JSON configuration file can be customized as per MSDN documentation: https://msdn.microsoft.com/en-us/library/dn771716.aspx
$settingString = ‘{"AntimalwareEnabled": true}’;
# Enable Antimalware with custom policies
# $settingString = ‘{
# "AntimalwareEnabled": true,
# "RealtimeProtectionEnabled": true,
# "ScheduledScanSettings": {
#                             "isEnabled": true,
#                             "day": 0,
#                             "time": 120,
#                             "scanType": "Quick"
#                             },
# "Exclusions": {
#            "Extensions": ".ext1,.ext2",
#                  "Paths":"",
#                  "Processes":"sampl1e1.exe, sample2.exe"
#             } ,
# "SignatureUpdates": {
#                               "FileSharesSources": “”,
#                               "FallbackOrder”: “”,
#                               "ScheduleDay": 0,
#                               "UpdateInterval": 0,
#                       },
# "CloudProtection": true         
           
# }’;

# retrieve the most recent version number of the extension
$allVersions= (Get-AzureRmVMExtensionImage -Location $location -PublisherName “Microsoft.Azure.Security” -Type “IaaSAntimalware”).Version
$versionString = $allVersions[($allVersions.count)-1].Split(“.”)[0] + “.” + $allVersions[($allVersions.count)-1].Split(“.”)[1]
$VMSS = Get-AzureRmVmss -ResourceGroupName $resourceGroupName -VMScaleSetName $vmScaleSetName
Add-AzureRmVmssExtension -VirtualMachineScaleSet $VMSS -Name “IaaSAntimalware” -Publisher “Microsoft.Azure.Security” -Type “IaaSAntimalware” -TypeHandlerVersion $versionString
Update-AzureRmVmss -ResourceGroupName $resourceGroupName -Name $vmScaleSetName -VirtualMachineScaleSet $VMSS 
```

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о [антивредоносном по Майкрософт](antimalware.md) для Azure.